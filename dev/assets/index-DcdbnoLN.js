import{b as $t,g as kt,h as It,j as Nt,m as At,k as Bt,l as Ut,n as Vt,f as W,d as Dt,a as Mt,o as Ve,t as ut,C as _e,e as Ge,q as We,r as Ot}from"./index-BCGjRJjR.js";import{g as Rt}from"./index-Bt481Q-W.js";const ie=1e3,ue=ie*60,se=ue*60,Z=se*24,ge=Z*7,ae=Z*365.25,ye=ae/12;function Lt(e,t){if(typeof e=="string")return zt(e);if(typeof e=="number")return jt(e,t);throw Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(e)}`)}var st=Lt;function zt(e){if(typeof e!="string"||e.length===0||e.length>100)throw Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(e)}`);let t=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(e);if(!t?.groups)return NaN;let{value:n,unit:r="ms"}=t.groups,o=parseFloat(n),u=r.toLowerCase();switch(u){case"years":case"year":case"yrs":case"yr":case"y":return o*ae;case"months":case"month":case"mo":return o*ye;case"weeks":case"week":case"w":return o*ge;case"days":case"day":case"d":return o*Z;case"hours":case"hour":case"hrs":case"hr":case"h":return o*se;case"minutes":case"minute":case"mins":case"min":case"m":return o*ue;case"seconds":case"second":case"secs":case"sec":case"s":return o*ie;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:throw Error(`Unknown unit "${u}" provided to ms.parse(). value=${JSON.stringify(e)}`)}}function qt(e){let t=Math.abs(e);return t>=ae?`${Math.round(e/ae)}y`:t>=ye?`${Math.round(e/ye)}mo`:t>=ge?`${Math.round(e/ge)}w`:t>=Z?`${Math.round(e/Z)}d`:t>=se?`${Math.round(e/se)}h`:t>=ue?`${Math.round(e/ue)}m`:t>=ie?`${Math.round(e/ie)}s`:`${e}ms`}function Pt(e){let t=Math.abs(e);return t>=ae?G(e,t,ae,"year"):t>=ye?G(e,t,ye,"month"):t>=ge?G(e,t,ge,"week"):t>=Z?G(e,t,Z,"day"):t>=se?G(e,t,se,"hour"):t>=ue?G(e,t,ue,"minute"):t>=ie?G(e,t,ie,"second"):`${e} ms`}function jt(e,t){if(typeof e!="number"||!Number.isFinite(e))throw Error("Value provided to ms.format() must be of type number.");return t?.long?Pt(e):qt(e)}function G(e,t,n,r){let o=t>=n*1.5;return`${Math.round(e/n)} ${r}${o?"s":""}`}function Kt(e){n.debug=n,n.default=n,n.coerce=C,n.disable=u,n.enable=o,n.enabled=a,n.humanize=st,n.destroy=k,Object.keys(e).forEach(f=>{n[f]=e[f]}),n.names=[],n.skips=[],n.formatters={};function t(f){let d=0;for(let E=0;E<f.length;E++)d=(d<<5)-d+f.charCodeAt(E),d|=0;return n.colors[Math.abs(d)%n.colors.length]}n.selectColor=t;function n(f,d){let E,N=null,R,K;function T(...S){if(!T.enabled)return;const D=T,J=Number(new Date),Ee=J-(E||J);D.diff=Ee,D.prev=E,D.curr=J,E=J,S[0]=n.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let H=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(L,Y)=>{if(L==="%%")return"%";H++;const l=n.formatters[Y];if(typeof l=="function"){const g=S[H];L=l.call(D,g),S.splice(H,1),H--}return L}),n.formatArgs.call(D,S),d?.onLog!=null&&d.onLog(...S),(D.log||n.log).apply(D,S)}return T.namespace=f,T.useColors=n.useColors(),T.color=n.selectColor(f),T.extend=r,T.destroy=n.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>N!==null?N:(R!==n.namespaces&&(R=n.namespaces,K=n.enabled(f)),K),set:S=>{N=S}}),typeof n.init=="function"&&n.init(T),T}function r(f,d){const E=n(this.namespace+(typeof d>"u"?":":d)+f);return E.log=this.log,E}function o(f){n.save(f),n.namespaces=f,n.names=[],n.skips=[];let d;const E=(typeof f=="string"?f:"").split(/[\s,]+/),N=E.length;for(d=0;d<N;d++)E[d]&&(f=E[d].replace(/\*/g,".*?"),f[0]==="-"?n.skips.push(new RegExp("^"+f.substr(1)+"$")):n.names.push(new RegExp("^"+f+"$")))}function u(){const f=[...n.names.map(h),...n.skips.map(h).map(d=>"-"+d)].join(",");return n.enable(""),f}function a(f){if(f[f.length-1]==="*")return!0;let d,E;for(d=0,E=n.skips.length;d<E;d++)if(n.skips[d].test(f))return!1;for(d=0,E=n.names.length;d<E;d++)if(n.names[d].test(f))return!0;return!1}function h(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function C(f){return f instanceof Error?f.stack??f.message:f}function k(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.setupFormatters(n.formatters),n.enable(n.load()),n}var Jt={};const Se=Qt(),Ht=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Yt(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)!=null?!1:typeof document<"u"&&document.documentElement?.style?.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/)}function Gt(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+st(this.diff),!this.useColors)return;const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(n++,o==="%c"&&(r=n))}),e.splice(r,0,t)}const Wt=console.debug??console.log??(()=>{});function Zt(e){try{e?Se?.setItem("debug",e):Se?.removeItem("debug")}catch{}}function Xt(){let e;try{e=Se?.getItem("debug")}catch{}return!e&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(e=Jt.DEBUG),e}function Qt(){try{return localStorage}catch{}}function en(e){e.j=function(t){try{return JSON.stringify(t)}catch(n){return"[UnexpectedJSONParseError]: "+n.message}}}const A=Kt({formatArgs:Gt,save:Zt,load:Xt,useColors:Yt,setupFormatters:en,colors:Ht,storage:Se,log:Wt});A.formatters.b=e=>e==null?"undefined":$t.baseEncode(e);A.formatters.t=e=>e==null?"undefined":kt.baseEncode(e);A.formatters.m=e=>e==null?"undefined":It.baseEncode(e);A.formatters.p=e=>e==null?"undefined":e.toString();A.formatters.c=e=>e==null?"undefined":e.toString();A.formatters.k=e=>e==null?"undefined":e.toString();A.formatters.a=e=>e==null?"undefined":e.toString();function Ze(e,t=""){const n=Xe(e.message),r=Xe(e.stack);return n!=null&&r!=null?r.includes(n)?`${r.split(`
`).join(`
${t}`)}`:`${n}
${t}${r.split(`
`).join(`
${t}`)}`:r!=null?`${r.split(`
`).join(`
${t}`)}`:n!=null?`${n}`:`${e.toString()}`}function tn(e){return e instanceof AggregateError||e?.name==="AggregateError"&&Array.isArray(e.errors)}function at(e,t=""){if(tn(e)){let n=Ze(e,t);return e.errors.length>0?(t=`${t}    `,n+=`
${t}${e.errors.map(r=>`${at(r,`${t}`)}`).join(`
${t}`)}`):n+=`
${t}[Error list was empty]`,n.trim()}return Ze(e,t)}A.formatters.e=e=>e==null?"undefined":at(e);function nn(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}function De(e,t){let n=nn(`${e}:trace`);return A.enabled(`${e}:trace`)&&A.names.map(r=>r.toString()).find(r=>r.includes(":trace"))!=null&&(n=A(`${e}:trace`,t)),Object.assign(A(e,t),{error:A(`${e}:error`,t),trace:n,newScope:r=>De(`${e}:${r}`,t)})}function Xe(e){if(e!=null&&(e=e.trim(),e.length!==0))return e}var Ue={exports:{}},Qe;function rn(){return Qe||(Qe=1,(function(e){(function(){e.exports=T;var t=86400,n=3200,r=146097*n/400,o=t*r,u=1e3*o,a=864e13,h=4294967296,C=1e6,k="000000000",f=Math.trunc||function(l){var g=l-l%1;return g==0&&(l<0||l===0&&1/l!=1/0)?-0:g},d=T.prototype,E=(T.fromDate=function(l){return new T(+l)},T.fromInt64BE=H(0,1,2,3,0,4),T.fromInt64LE=H(3,2,1,0,4,0),T.fromString=function(p){var g,b=new T,p=(p+="").replace(/^\s*[+\-]?\d+/,function(F){var F=+F,v=1970+(F-1970)%400;return b.year=F-v,v}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(y,F,v){return F<0&&(v*=-1),g=6e4*(60*+F+ +v),""}).replace(/\.\d+$/,function(y){return b.nano=+(y+k).substr(1,9),""}).split(/\D+/);if(1<p.length?p[1]--:p[1]=0,b.time=g=Date.UTC.apply(Date,p)-(g||0),isNaN(g))throw new TypeError("Invalid Date");return S(b)},T.fromTimeT=function(l){return J(l,0)},d.year=0,d.time=0,d.nano=0,d.addNano=function(l){return this.nano+=+l||0,this},d.getNano=function(){var l=S(this);return(l.time%1e3*C+ +l.nano+1e9)%1e9},d.getTimeT=function(){var g=S(this),l=Math.floor(g.time/1e3),g=g.year;return g&&(l+=g*r*t/n),l},d.getYear=function(){return this.toDate().getUTCFullYear()+this.year},d.toDate=function(){return D(S(this).time)},d.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},d.toString=function(l){var g=this,b=g.toDate(),p={H:function(){return L(b.getUTCHours())},L:function(){return Y(b.getUTCMilliseconds(),3)},M:function(){return L(b.getUTCMinutes())},N:function(){return Y(g.getNano(),9)},S:function(){return L(b.getUTCSeconds())},Y:function(){var y=g.getYear();return 999999<y?"+"+y:9999<y?"+"+Y(y,6):0<=y?Y(y,4):-999999<=y?"-"+Y(-y,6):y},a:function(){return R[b.getUTCDay()]},b:function(){return N[b.getUTCMonth()]},d:function(){return L(b.getUTCDate())},e:function(){return(function(y){return(9<y?"":" ")+(0|y)})(b.getUTCDate())},m:function(){return L(b.getUTCMonth()+1)}};return(function y(F){return F.replace(/%./g,function(v){var _=v[1],x=K[_],_=p[_];return x?y(x):_?_():v})})(l||E)},d.writeInt64BE=Ee(0,1,2,3,0,4),d.writeInt64LE=Ee(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],R=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],K={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return T;function T(l,g,b){var p=this;if(!(p instanceof T))return new T(l,g,b);p.time=+l||0,p.nano=+g||0,p.year=+b||0,S(p)}function S(l){var g,b,p,y=l.year,F=l.time,v=l.nano,x=((v<0||C<=v)&&(v-=(b=Math.floor(v/C))*C,F+=b,b=1),y%n);return(F<-a||a<F||x)&&((g=f(F/u))&&(y+=g*n,F-=g*u),(p=D(F)).setUTCFullYear(x+p.getUTCFullYear()),p=(F=+p)+(g=f((y-=x)/n))*u,g&&-a<=p&&p<=a&&(y-=g*n,F=p),b=1),b&&(l.year=y,l.time=F,l.nano=v),l}function D(l){var g=new Date(0);return g.setTime(l),g}function J(y,p){y=+y||0;var b=f((p=(p|0)*h)/o)+f(y/o),p=p%o+y%o,y=f(p/o);return y&&(b+=y,p-=y*o),new T(1e3*p,0,b*n)}function Ee(l,g,b,p,y,F){return function(x,_){var q=S(this);x=x||new Array(8),Be(x,_|=0);var re=Math.floor(q.time/1e3),q=q.year*(r*t/n),z=f(q/h)+f(re/h),q=q%h+re%h,re=Math.floor(q/h);return re&&(z+=re,q-=re*h),v(x,_+y,z),v(x,_+F,q),x};function v(x,_,z){x[_+l]=z>>24&255,x[_+g]=z>>16&255,x[_+b]=z>>8&255,x[_+p]=255&z}}function H(l,g,b,p,y,F){return function(x,_){Be(x,_|=0);var z=v(x,_+y);return J(v(x,_+F),z)};function v(x,_){return 16777216*x[_+l]+(x[_+g]<<16|x[_+b]<<8|x[_+p])}}function Be(l,g){if(l=l&&l.length,l==null)throw new TypeError("Invalid Buffer");if(l<g+8)throw new RangeError("Out of range")}function L(l){return(9<l?"":"0")+(0|l)}function Y(l,g){return(k+(0|l)).substr(-g)}})()})(Ue)),Ue.exports}var on=rn();const ct=Rt(on);class un extends Error{static name="SignatureCreationError";constructor(t="Record signature creation failed"){super(t),this.name="SignatureCreationError"}}class oe extends Error{static name="SignatureVerificationError";constructor(t="Record signature verification failed"){super(t),this.name="SignatureVerificationError"}}class ft extends Error{static name="UnsupportedValidityError";constructor(t="The validity type is unsupported"){super(t),this.name="UnsupportedValidityError"}}class lt extends Error{static name="InvalidValueError";constructor(t="Value must be a valid content path starting with /"){super(t),this.name="InvalidValueError"}}class sn extends Error{static name="InvalidRecordDataError";constructor(t="Invalid record data"){super(t),this.name="InvalidRecordDataError"}}var V;(function(e){(function(r){r.EOL="EOL"})(e.ValidityType||(e.ValidityType={}));let t;(function(r){r[r.EOL=0]="EOL"})(t||(t={})),(function(r){r.codec=()=>Nt(t)})(e.ValidityType||(e.ValidityType={}));let n;e.codec=()=>(n==null&&(n=At((r,o,u={})=>{u.lengthDelimited!==!1&&o.fork(),r.value!=null&&(o.uint32(10),o.bytes(r.value)),r.signatureV1!=null&&(o.uint32(18),o.bytes(r.signatureV1)),r.validityType!=null&&(o.uint32(24),e.ValidityType.codec().encode(r.validityType,o)),r.validity!=null&&(o.uint32(34),o.bytes(r.validity)),r.sequence!=null&&(o.uint32(40),o.uint64(r.sequence)),r.ttl!=null&&(o.uint32(48),o.uint64(r.ttl)),r.pubKey!=null&&(o.uint32(58),o.bytes(r.pubKey)),r.signatureV2!=null&&(o.uint32(66),o.bytes(r.signatureV2)),r.data!=null&&(o.uint32(74),o.bytes(r.data)),u.lengthDelimited!==!1&&o.ldelim()},(r,o,u={})=>{const a={},h=o==null?r.len:r.pos+o;for(;r.pos<h;){const C=r.uint32();switch(C>>>3){case 1:{a.value=r.bytes();break}case 2:{a.signatureV1=r.bytes();break}case 3:{a.validityType=e.ValidityType.codec().decode(r);break}case 4:{a.validity=r.bytes();break}case 5:{a.sequence=r.uint64();break}case 6:{a.ttl=r.uint64();break}case 7:{a.pubKey=r.bytes();break}case 8:{a.signatureV2=r.bytes();break}case 9:{a.data=r.bytes();break}default:{r.skipType(C&7);break}}}return a})),n),e.encode=r=>Bt(r,e.codec()),e.decode=(r,o)=>Ut(r,e.codec(),o)})(V||(V={}));const an=["Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function dt(e){if(e===null)return"null";if(e===void 0)return"undefined";if(e===!0||e===!1)return"boolean";const t=typeof e;if(t==="string"||t==="number"||t==="bigint"||t==="symbol")return t;if(t==="function")return"Function";if(Array.isArray(e))return"Array";if(e instanceof Uint8Array)return"Uint8Array";if(e.constructor===Object)return"Object";const n=cn(e);return n||"Object"}function cn(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(an.includes(t))return t}class i{constructor(t,n,r){this.major=t,this.majorEncoded=t<<5,this.name=n,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(t){return this.major<t.major?-1:this.major>t.major?1:0}static equals(t,n){return t===n||t.major===n.major&&t.name===n.name}}i.uint=new i(0,"uint",!0);i.negint=new i(1,"negint",!0);i.bytes=new i(2,"bytes",!0);i.string=new i(3,"string",!0);i.array=new i(4,"array",!1);i.map=new i(5,"map",!1);i.tag=new i(6,"tag",!1);i.float=new i(7,"float",!0);i.false=new i(7,"false",!0);i.true=new i(7,"true",!0);i.null=new i(7,"null",!0);i.undefined=new i(7,"undefined",!0);i.break=new i(7,"break",!0);class c{constructor(t,n,r){this.type=t,this.value=n,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const be=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",fn=new TextEncoder;function ve(e){return be&&globalThis.Buffer.isBuffer(e)}function Me(e){return e instanceof Uint8Array?ve(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const ln=24,dn=200,ht=be?e=>e.length>=ln?globalThis.Buffer.from(e):et(e):e=>e.length>=dn?fn.encode(e):et(e),P=e=>Uint8Array.from(e),hn=be?(e,t,n)=>ve(e)?new Uint8Array(e.subarray(t,n)):e.slice(t,n):(e,t,n)=>e.slice(t,n),gn=be?(e,t)=>(e=e.map(n=>n instanceof Uint8Array?n:globalThis.Buffer.from(n)),Me(globalThis.Buffer.concat(e,t))):(e,t)=>{const n=new Uint8Array(t);let r=0;for(let o of e)r+o.length>n.length&&(o=o.subarray(0,n.length-r)),n.set(o,r),r+=o.length;return n},yn=be?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function mn(e,t){if(ve(e)&&ve(t))return e.compare(t);for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return 0}function et(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let o=e.charCodeAt(r);o<128?t[n++]=o:o<2048?(t[n++]=o>>6|192,t[n++]=o&63|128):(o&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320?(o=65536+((o&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=o>>18|240,t[n++]=o>>12&63|128,t[n++]=o>>6&63|128,t[n++]=o&63|128):(o>=55296&&o<=57343&&(o=65533),t[n++]=o>>12|224,t[n++]=o>>6&63|128,t[n++]=o&63|128)}return t}const pn=256;class gt{constructor(t=pn){this.chunkSize=t,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(t){let n=this.chunks[this.chunks.length-1];if(this.cursor+t.length<=this.maxCursor+1){const o=n.length-(this.maxCursor-this.cursor)-1;n.set(t,o)}else{if(n){const o=n.length-(this.maxCursor-this.cursor)-1;o<n.length&&(this.chunks[this.chunks.length-1]=n.subarray(0,o),this.maxCursor=this.cursor-1)}t.length<64&&t.length<this.chunkSize?(n=yn(this.chunkSize),this.chunks.push(n),this.maxCursor+=n.length,this._initReuseChunk===null&&(this._initReuseChunk=n),n.set(t,0)):(this.chunks.push(t),this.maxCursor+=t.length)}this.cursor+=t.length}toBytes(t=!1){let n;if(this.chunks.length===1){const r=this.chunks[0];t&&this.cursor>r.length/2?(n=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):n=hn(r,0,this.cursor)}else n=gn(this.chunks,this.cursor);return t&&this.reset(),n}}class wn{constructor(t){this.dest=t,this.cursor=0,this.chunks=[t]}reset(){this.cursor=0}push(t){if(this.cursor+t.length>this.dest.length)throw new Error("write out of bounds, destination buffer is too small");this.dest.set(t,this.cursor),this.cursor+=t.length}toBytes(t=!1){const n=this.dest.subarray(0,this.cursor);return t&&this.reset(),n}}const m="CBOR decode error:",Oe="CBOR encode error:";function ce(e,t,n){if(e.length-t<n)throw new Error(`${m} not enough data for type`)}const I=[24,256,65536,4294967296,BigInt("18446744073709551616")];function X(e,t,n){ce(e,t,1);const r=e[t];if(n.strict===!0&&r<I[0])throw new Error(`${m} integer encoded in more bytes than necessary (strict decode)`);return r}function Q(e,t,n){ce(e,t,2);const r=e[t]<<8|e[t+1];if(n.strict===!0&&r<I[1])throw new Error(`${m} integer encoded in more bytes than necessary (strict decode)`);return r}function ee(e,t,n){ce(e,t,4);const r=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(n.strict===!0&&r<I[2])throw new Error(`${m} integer encoded in more bytes than necessary (strict decode)`);return r}function te(e,t,n){ce(e,t,8);const r=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],o=e[t+4]*16777216+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],u=(BigInt(r)<<BigInt(32))+BigInt(o);if(n.strict===!0&&u<I[3])throw new Error(`${m} integer encoded in more bytes than necessary (strict decode)`);if(u<=Number.MAX_SAFE_INTEGER)return Number(u);if(n.allowBigInt===!0)return u;throw new Error(`${m} integers outside of the safe integer range are not supported`)}function bn(e,t,n,r){return new c(i.uint,X(e,t+1,r),2)}function Cn(e,t,n,r){return new c(i.uint,Q(e,t+1,r),3)}function xn(e,t,n,r){return new c(i.uint,ee(e,t+1,r),5)}function En(e,t,n,r){return new c(i.uint,te(e,t+1,r),9)}function ne(e,t){return $(e,0,t.value)}function $(e,t,n){if(n<I[0]){const r=Number(n);e.push([t|r])}else if(n<I[1]){const r=Number(n);e.push([t|24,r])}else if(n<I[2]){const r=Number(n);e.push([t|25,r>>>8,r&255])}else if(n<I[3]){const r=Number(n);e.push([t|26,r>>>24&255,r>>>16&255,r>>>8&255,r&255])}else{const r=BigInt(n);if(r<I[4]){const o=[t|27,0,0,0,0,0,0,0];let u=Number(r&BigInt(4294967295)),a=Number(r>>BigInt(32)&BigInt(4294967295));o[8]=u&255,u=u>>8,o[7]=u&255,u=u>>8,o[6]=u&255,u=u>>8,o[5]=u&255,o[4]=a&255,a=a>>8,o[3]=a&255,a=a>>8,o[2]=a&255,a=a>>8,o[1]=a&255,e.push(o)}else throw new Error(`${m} encountered BigInt larger than allowable range`)}}ne.encodedSize=function(t){return $.encodedSize(t.value)};$.encodedSize=function(t){return t<I[0]?1:t<I[1]?2:t<I[2]?3:t<I[3]?5:9};ne.compareTokens=function(t,n){return t.value<n.value?-1:t.value>n.value?1:0};function Tn(e,t,n,r){return new c(i.negint,-1-X(e,t+1,r),2)}function Fn(e,t,n,r){return new c(i.negint,-1-Q(e,t+1,r),3)}function _n(e,t,n,r){return new c(i.negint,-1-ee(e,t+1,r),5)}const Re=BigInt(-1),yt=BigInt(1);function Sn(e,t,n,r){const o=te(e,t+1,r);if(typeof o!="bigint"){const u=-1-o;if(u>=Number.MIN_SAFE_INTEGER)return new c(i.negint,u,9)}if(r.allowBigInt!==!0)throw new Error(`${m} integers outside of the safe integer range are not supported`);return new c(i.negint,Re-BigInt(o),9)}function Le(e,t){const n=t.value,r=typeof n=="bigint"?n*Re-yt:n*-1-1;$(e,t.type.majorEncoded,r)}Le.encodedSize=function(t){const n=t.value,r=typeof n=="bigint"?n*Re-yt:n*-1-1;return r<I[0]?1:r<I[1]?2:r<I[2]?3:r<I[3]?5:9};Le.compareTokens=function(t,n){return t.value<n.value?1:t.value>n.value?-1:0};function Ce(e,t,n,r){ce(e,t,n+r);const o=e.slice(t+n,t+n+r);return new c(i.bytes,o,n+r)}function vn(e,t,n,r){return Ce(e,t,1,n)}function $n(e,t,n,r){return Ce(e,t,2,X(e,t+1,r))}function kn(e,t,n,r){return Ce(e,t,3,Q(e,t+1,r))}function In(e,t,n,r){return Ce(e,t,5,ee(e,t+1,r))}function Nn(e,t,n,r){const o=te(e,t+1,r);if(typeof o=="bigint")throw new Error(`${m} 64-bit integer bytes lengths not supported`);return Ce(e,t,9,o)}function $e(e){return e.encodedBytes===void 0&&(e.encodedBytes=i.equals(e.type,i.string)?ht(e.value):e.value),e.encodedBytes}function ke(e,t){const n=$e(t);$(e,t.type.majorEncoded,n.length),e.push(n)}ke.encodedSize=function(t){const n=$e(t);return $.encodedSize(n.length)+n.length};ke.compareTokens=function(t,n){return An($e(t),$e(n))};function An(e,t){return e.length<t.length?-1:e.length>t.length?1:mn(e,t)}const tt=new TextDecoder,Bn=32;function Un(e,t,n){if(n-t<Bn){let o="";for(let u=t;u<n;u++){const a=e[u];if(a&128)return tt.decode(e.subarray(t,n));o+=String.fromCharCode(a)}return o}return tt.decode(e.subarray(t,n))}function xe(e,t,n,r,o){const u=n+r;ce(e,t,u);const a=new c(i.string,Un(e,t+n,t+u),u);return o.retainStringBytes===!0&&(a.byteValue=e.slice(t+n,t+u)),a}function Vn(e,t,n,r){return xe(e,t,1,n,r)}function Dn(e,t,n,r){return xe(e,t,2,X(e,t+1,r),r)}function Mn(e,t,n,r){return xe(e,t,3,Q(e,t+1,r),r)}function On(e,t,n,r){return xe(e,t,5,ee(e,t+1,r),r)}function Rn(e,t,n,r){const o=te(e,t+1,r);if(typeof o=="bigint")throw new Error(`${m} 64-bit integer string lengths not supported`);return xe(e,t,9,o,r)}const Ln=ke;function fe(e,t,n,r){return new c(i.array,r,n)}function zn(e,t,n,r){return fe(e,t,1,n)}function qn(e,t,n,r){return fe(e,t,2,X(e,t+1,r))}function Pn(e,t,n,r){return fe(e,t,3,Q(e,t+1,r))}function jn(e,t,n,r){return fe(e,t,5,ee(e,t+1,r))}function Kn(e,t,n,r){const o=te(e,t+1,r);if(typeof o=="bigint")throw new Error(`${m} 64-bit integer array lengths not supported`);return fe(e,t,9,o)}function Jn(e,t,n,r){if(r.allowIndefinite===!1)throw new Error(`${m} indefinite length items not allowed`);return fe(e,t,1,1/0)}function ze(e,t){$(e,i.array.majorEncoded,t.value)}ze.compareTokens=ne.compareTokens;ze.encodedSize=function(t){return $.encodedSize(t.value)};function le(e,t,n,r){return new c(i.map,r,n)}function Hn(e,t,n,r){return le(e,t,1,n)}function Yn(e,t,n,r){return le(e,t,2,X(e,t+1,r))}function Gn(e,t,n,r){return le(e,t,3,Q(e,t+1,r))}function Wn(e,t,n,r){return le(e,t,5,ee(e,t+1,r))}function Zn(e,t,n,r){const o=te(e,t+1,r);if(typeof o=="bigint")throw new Error(`${m} 64-bit integer map lengths not supported`);return le(e,t,9,o)}function Xn(e,t,n,r){if(r.allowIndefinite===!1)throw new Error(`${m} indefinite length items not allowed`);return le(e,t,1,1/0)}function qe(e,t){$(e,i.map.majorEncoded,t.value)}qe.compareTokens=ne.compareTokens;qe.encodedSize=function(t){return $.encodedSize(t.value)};function Qn(e,t,n,r){return new c(i.tag,n,1)}function er(e,t,n,r){return new c(i.tag,X(e,t+1,r),2)}function tr(e,t,n,r){return new c(i.tag,Q(e,t+1,r),3)}function nr(e,t,n,r){return new c(i.tag,ee(e,t+1,r),5)}function rr(e,t,n,r){return new c(i.tag,te(e,t+1,r),9)}function Pe(e,t){$(e,i.tag.majorEncoded,t.value)}Pe.compareTokens=ne.compareTokens;Pe.encodedSize=function(t){return $.encodedSize(t.value)};const mt=20,pt=21,wt=22,bt=23;function or(e,t,n,r){if(r.allowUndefined===!1)throw new Error(`${m} undefined values are not supported`);return r.coerceUndefinedToNull===!0?new c(i.null,null,1):new c(i.undefined,void 0,1)}function ir(e,t,n,r){if(r.allowIndefinite===!1)throw new Error(`${m} indefinite length items not allowed`);return new c(i.break,void 0,1)}function je(e,t,n){if(n){if(n.allowNaN===!1&&Number.isNaN(e))throw new Error(`${m} NaN values are not supported`);if(n.allowInfinity===!1&&(e===1/0||e===-1/0))throw new Error(`${m} Infinity values are not supported`)}return new c(i.float,e,t)}function ur(e,t,n,r){return je(Ke(e,t+1),3,r)}function sr(e,t,n,r){return je(Je(e,t+1),5,r)}function ar(e,t,n,r){return je(Tt(e,t+1),9,r)}function Ie(e,t,n){const r=t.value;if(r===!1)e.push([i.float.majorEncoded|mt]);else if(r===!0)e.push([i.float.majorEncoded|pt]);else if(r===null)e.push([i.float.majorEncoded|wt]);else if(r===void 0)e.push([i.float.majorEncoded|bt]);else{let o,u=!1;(!n||n.float64!==!0)&&(xt(r),o=Ke(U,1),r===o||Number.isNaN(r)?(U[0]=249,e.push(U.slice(0,3)),u=!0):(Et(r),o=Je(U,1),r===o&&(U[0]=250,e.push(U.slice(0,5)),u=!0))),u||(cr(r),o=Tt(U,1),U[0]=251,e.push(U.slice(0,9)))}}Ie.encodedSize=function(t,n){const r=t.value;if(r===!1||r===!0||r===null||r===void 0)return 1;if(!n||n.float64!==!0){xt(r);let o=Ke(U,1);if(r===o||Number.isNaN(r))return 3;if(Et(r),o=Je(U,1),r===o)return 5}return 9};const Ct=new ArrayBuffer(9),B=new DataView(Ct,1),U=new Uint8Array(Ct,0);function xt(e){if(e===1/0)B.setUint16(0,31744,!1);else if(e===-1/0)B.setUint16(0,64512,!1);else if(Number.isNaN(e))B.setUint16(0,32256,!1);else{B.setFloat32(0,e);const t=B.getUint32(0),n=(t&2139095040)>>23,r=t&8388607;if(n===255)B.setUint16(0,31744,!1);else if(n===0)B.setUint16(0,(e&2147483648)>>16|r>>13,!1);else{const o=n-127;o<-24?B.setUint16(0,0):o<-14?B.setUint16(0,(t&2147483648)>>16|1<<24+o,!1):B.setUint16(0,(t&2147483648)>>16|o+15<<10|r>>13,!1)}}}function Ke(e,t){if(e.length-t<2)throw new Error(`${m} not enough data for float16`);const n=(e[t]<<8)+e[t+1];if(n===31744)return 1/0;if(n===64512)return-1/0;if(n===32256)return NaN;const r=n>>10&31,o=n&1023;let u;return r===0?u=o*2**-24:r!==31?u=(o+1024)*2**(r-25):u=o===0?1/0:NaN,n&32768?-u:u}function Et(e){B.setFloat32(0,e,!1)}function Je(e,t){if(e.length-t<4)throw new Error(`${m} not enough data for float32`);const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,4).getFloat32(0,!1)}function cr(e){B.setFloat64(0,e,!1)}function Tt(e,t){if(e.length-t<8)throw new Error(`${m} not enough data for float64`);const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,8).getFloat64(0,!1)}Ie.compareTokens=ne.compareTokens;function w(e,t,n){throw new Error(`${m} encountered invalid minor (${n}) for major ${e[t]>>>5}`)}function Ne(e){return()=>{throw new Error(`${m} ${e}`)}}const s=[];for(let e=0;e<=23;e++)s[e]=w;s[24]=bn;s[25]=Cn;s[26]=xn;s[27]=En;s[28]=w;s[29]=w;s[30]=w;s[31]=w;for(let e=32;e<=55;e++)s[e]=w;s[56]=Tn;s[57]=Fn;s[58]=_n;s[59]=Sn;s[60]=w;s[61]=w;s[62]=w;s[63]=w;for(let e=64;e<=87;e++)s[e]=vn;s[88]=$n;s[89]=kn;s[90]=In;s[91]=Nn;s[92]=w;s[93]=w;s[94]=w;s[95]=Ne("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)s[e]=Vn;s[120]=Dn;s[121]=Mn;s[122]=On;s[123]=Rn;s[124]=w;s[125]=w;s[126]=w;s[127]=Ne("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)s[e]=zn;s[152]=qn;s[153]=Pn;s[154]=jn;s[155]=Kn;s[156]=w;s[157]=w;s[158]=w;s[159]=Jn;for(let e=160;e<=183;e++)s[e]=Hn;s[184]=Yn;s[185]=Gn;s[186]=Wn;s[187]=Zn;s[188]=w;s[189]=w;s[190]=w;s[191]=Xn;for(let e=192;e<=215;e++)s[e]=Qn;s[216]=er;s[217]=tr;s[218]=nr;s[219]=rr;s[220]=w;s[221]=w;s[222]=w;s[223]=w;for(let e=224;e<=243;e++)s[e]=Ne("simple values are not supported");s[244]=w;s[245]=w;s[246]=w;s[247]=or;s[248]=Ne("simple values are not supported");s[249]=ur;s[250]=sr;s[251]=ar;s[252]=w;s[253]=w;s[254]=w;s[255]=ir;const O=[];for(let e=0;e<24;e++)O[e]=new c(i.uint,e,1);for(let e=-1;e>=-24;e--)O[31-e]=new c(i.negint,e,1);O[64]=new c(i.bytes,new Uint8Array(0),1);O[96]=new c(i.string,"",1);O[128]=new c(i.array,0,1);O[160]=new c(i.map,0,1);O[244]=new c(i.false,!1,1);O[245]=new c(i.true,!0,1);O[246]=new c(i.null,null,1);function fr(e){switch(e.type){case i.false:return P([244]);case i.true:return P([245]);case i.null:return P([246]);case i.bytes:return e.value.length?void 0:P([64]);case i.string:return e.value===""?P([96]):void 0;case i.array:return e.value===0?P([128]):void 0;case i.map:return e.value===0?P([160]):void 0;case i.uint:return e.value<24?P([Number(e.value)]):void 0;case i.negint:if(e.value>=-24)return P([31-Number(e.value)])}}const lr={float64:!1,mapSorter:gr,quickEncodeToken:fr};function dr(){const e=[];return e[i.uint.major]=ne,e[i.negint.major]=Le,e[i.bytes.major]=ke,e[i.string.major]=Ln,e[i.array.major]=ze,e[i.map.major]=qe,e[i.tag.major]=Pe,e[i.float.major]=Ie,e}const de=dr(),Te=new gt;class me{constructor(t,n){this.obj=t,this.parent=n}includes(t){let n=this;do if(n.obj===t)return!0;while(n=n.parent);return!1}static createCheck(t,n){if(t&&t.includes(n))throw new Error(`${Oe} object contains circular references`);return new me(n,t)}}const j={null:new c(i.null,null),undefined:new c(i.undefined,void 0),true:new c(i.true,!0),false:new c(i.false,!1),emptyArray:new c(i.array,0),emptyMap:new c(i.map,0)},M={number(e,t,n,r){return!Number.isInteger(e)||!Number.isSafeInteger(e)?new c(i.float,e):e>=0?new c(i.uint,e):new c(i.negint,e)},bigint(e,t,n,r){return e>=BigInt(0)?new c(i.uint,e):new c(i.negint,e)},Uint8Array(e,t,n,r){return new c(i.bytes,e)},string(e,t,n,r){return new c(i.string,e)},boolean(e,t,n,r){return e?j.true:j.false},null(e,t,n,r){return j.null},undefined(e,t,n,r){return j.undefined},ArrayBuffer(e,t,n,r){return new c(i.bytes,new Uint8Array(e))},DataView(e,t,n,r){return new c(i.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))},Array(e,t,n,r){if(!e.length)return n.addBreakTokens===!0?[j.emptyArray,new c(i.break)]:j.emptyArray;r=me.createCheck(r,e);const o=[];let u=0;for(const a of e)o[u++]=Fe(a,n,r);return n.addBreakTokens?[new c(i.array,e.length),o,new c(i.break)]:[new c(i.array,e.length),o]},Object(e,t,n,r){const o=t!=="Object",u=o?e.keys():Object.keys(e),a=o?e.size:u.length;let h;if(a){h=new Array(a),r=me.createCheck(r,e);const C=!o&&n.ignoreUndefinedProperties;let k=0;for(const f of u){const d=o?e.get(f):e[f];C&&d===void 0||(h[k++]=[Fe(f,n,r),Fe(d,n,r)])}k<a&&(h.length=k)}return h?.length?(hr(h,n),n.addBreakTokens?[new c(i.map,h.length),h,new c(i.break)]:[new c(i.map,h.length),h]):n.addBreakTokens===!0?[j.emptyMap,new c(i.break)]:j.emptyMap}};M.Map=M.Object;M.Buffer=M.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))M[`${e}Array`]=M.DataView;function Fe(e,t={},n){const r=dt(e),o=t&&t.typeEncoders&&t.typeEncoders[r]||M[r];if(typeof o=="function"){const a=o(e,r,t,n);if(a!=null)return a}const u=M[r];if(!u)throw new Error(`${Oe} unsupported type: ${r}`);return u(e,r,t,n)}function hr(e,t){t.mapSorter&&e.sort(t.mapSorter)}function gr(e,t){const n=Array.isArray(e[0])?e[0][0]:e[0],r=Array.isArray(t[0])?t[0][0]:t[0];if(n.type!==r.type)return n.type.compare(r.type);const o=n.type.major,u=de[o].compareTokens(n,r);return u===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),u}function he(e,t,n,r){if(Array.isArray(t))for(const o of t)he(e,o,n,r);else n[t.type.major](e,t,r)}const nt=i.uint.majorEncoded,rt=i.negint.majorEncoded,yr=i.bytes.majorEncoded,mr=i.string.majorEncoded,ot=i.array.majorEncoded,pr=i.float.majorEncoded|mt,wr=i.float.majorEncoded|pt,br=i.float.majorEncoded|wt,Cr=i.float.majorEncoded|bt,xr=BigInt(-1),Er=BigInt(1);function Tr(e){return e.addBreakTokens!==!0}function Ft(e,t,n,r){const o=dt(t),u=n.typeEncoders&&n.typeEncoders[o];if(u){const a=u(t,o,n,r);if(a!=null){he(e,a,de,n);return}}switch(o){case"null":e.push([br]);return;case"undefined":e.push([Cr]);return;case"boolean":e.push([t?wr:pr]);return;case"number":!Number.isInteger(t)||!Number.isSafeInteger(t)?Ie(e,new c(i.float,t),n):t>=0?$(e,nt,t):$(e,rt,t*-1-1);return;case"bigint":t>=BigInt(0)?$(e,nt,t):$(e,rt,t*xr-Er);return;case"string":{const a=ht(t);$(e,mr,a.length),e.push(a);return}case"Uint8Array":$(e,yr,t.length),e.push(t);return;case"Array":if(!t.length){e.push([ot]);return}r=me.createCheck(r,t),$(e,ot,t.length);for(const a of t)Ft(e,a,n,r);return;case"Object":case"Map":{const a=M.Object(t,o,n,r);he(e,a,de,n)}return;default:{const a=M[o];if(!a)throw new Error(`${Oe} unsupported type: ${o}`);const h=a(t,o,n,r);he(e,h,de,n)}}}function Fr(e,t,n,r){const o=r instanceof Uint8Array;let u=o?new wn(r):Te;const a=Fe(e,n);if(!Array.isArray(a)&&n.quickEncodeToken){const h=n.quickEncodeToken(a);if(h)return o?(u.push(h),u.toBytes()):h;const C=t[a.type.major];if(C.encodedSize){const k=C.encodedSize(a,n);if(o||(u=new gt(k)),C(u,a,n),u.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${a} was wrong`);return o?u.toBytes():Me(u.chunks[0])}}return u.reset(),he(u,a,t,n),u.toBytes(!0)}function _r(e,t){return t=Object.assign({},lr,t),Tr(t)?(Te.reset(),Ft(Te,e,t,void 0),Te.toBytes(!0)):Fr(e,de,t)}const Sr={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class vr{constructor(t,n={}){this._pos=0,this.data=t,this.options=n}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const t=this.data[this._pos];let n=O[t];if(n===void 0){const r=s[t];if(!r)throw new Error(`${m} no decoder for major type ${t>>>5} (byte 0x${t.toString(16).padStart(2,"0")})`);const o=t&31;n=r(this.data,this._pos,o,this.options)}return this._pos+=n.encodedLength,n}}const pe=Symbol.for("DONE"),Ae=Symbol.for("BREAK");function $r(e,t,n){const r=[];for(let o=0;o<e.value;o++){const u=we(t,n);if(u===Ae){if(e.value===1/0)break;throw new Error(`${m} got unexpected break to lengthed array`)}if(u===pe)throw new Error(`${m} found array but not enough entries (got ${o}, expected ${e.value})`);r[o]=u}return r}function kr(e,t,n){const r=n.useMaps===!0,o=n.rejectDuplicateMapKeys===!0,u=r?void 0:{},a=r?new Map:void 0;for(let h=0;h<e.value;h++){const C=we(t,n);if(C===Ae){if(e.value===1/0)break;throw new Error(`${m} got unexpected break to lengthed map`)}if(C===pe)throw new Error(`${m} found map but not enough entries (got ${h} [no key], expected ${e.value})`);if(!r&&typeof C!="string")throw new Error(`${m} non-string keys not supported (got ${typeof C})`);if(o&&(r&&a.has(C)||!r&&Object.hasOwn(u,C)))throw new Error(`${m} found repeat map key "${C}"`);const k=we(t,n);if(k===pe)throw new Error(`${m} found map but not enough entries (got ${h} [no value], expected ${e.value})`);r?a.set(C,k):u[C]=k}return r?a:u}function we(e,t){if(e.done())return pe;const n=e.next();if(i.equals(n.type,i.break))return Ae;if(n.type.terminal)return n.value;if(i.equals(n.type,i.array))return $r(n,e,t);if(i.equals(n.type,i.map))return kr(n,e,t);if(i.equals(n.type,i.tag)){if(t.tags&&typeof t.tags[n.value]=="function"){const r=we(e,t);return t.tags[n.value](r)}throw new Error(`${m} tag not supported (${n.value})`)}throw new Error("unsupported")}function Ir(e,t){if(!(e instanceof Uint8Array))throw new Error(`${m} data to decode must be a Uint8Array`);t=Object.assign({},Sr,t);const n=Me(e),r=t.tokenizer||new vr(n,t),o=we(r,t);if(o===pe)throw new Error(`${m} did not find any content to decode`);if(o===Ae)throw new Error(`${m} got unexpected break`);return[o,e.subarray(r.pos())]}function Nr(e,t){const[n,r]=Ir(e,t);if(r.length>0)throw new Error(`${m} too many terminals, data makes no sense`);return n}const Ar=De("ipns:utils"),_t=W("/ipns/"),Br=114,Ur=0,Vr=18;function Wr(e){let t;if(e.pubKey!=null)try{t=Vt(e.pubKey)}catch(n){throw Ar.error(n),n}if(t!=null)return t}function Dr(e,t,n){const r=W(t);return Ve([e,n,r])}function Mr(e){const t=W("ipns-signature:");return Ve([t,e])}function Zr(e){return"signatureV1"in e?V.encode({value:W(e.value),signatureV1:e.signatureV1,validityType:e.validityType,validity:W(e.validity),sequence:e.sequence,ttl:e.ttl,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data}):V.encode({pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data})}function Xr(e){const t=V.decode(e);if(t.sequence!=null&&(t.sequence=BigInt(t.sequence)),t.ttl!=null&&(t.ttl=BigInt(t.ttl)),t.signatureV2==null||t.data==null)throw new oe("Missing data or signatureV2");const n=St(t.data),r=Rr(n.Value),o=ut(n.Validity);if(t.value!=null&&t.signatureV1!=null)return zr(t),{value:r,validityType:V.ValidityType.EOL,validity:o,sequence:n.Sequence,ttl:n.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(t.signatureV2!=null)return{value:r,validityType:V.ValidityType.EOL,validity:o,sequence:n.Sequence,ttl:n.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function Qr(e){return Ve([_t,e.bytes])}function eo(e){const t=Dt(e.slice(_t.length));if(!it(t,Ur)&&!it(t,Vr))throw new Mt("Multihash in IPNS key was not identity or sha2-256");return t}function Or(e,t,n,r,o){let u;if(t===V.ValidityType.EOL)u=0;else throw new ft("The validity type is unsupported");return _r({Value:e,Validity:n,ValidityType:u,Sequence:r,TTL:o})}function St(e){const t=Nr(e);if(t.ValidityType===0)t.ValidityType=V.ValidityType.EOL;else throw new ft("The validity type is unsupported");return Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t}function Rr(e){const t=ut(e).trim();if(t.startsWith("/"))return t;try{return`/ipfs/${_e.decode(e).toV1().toString()}`}catch{}try{return`/ipfs/${_e.parse(t).toV1().toString()}`}catch{}throw new lt("Value must be a valid content path starting with /")}function Lr(e){if(e!=null){const t=jr(e);if(t!=null)return t.code===Br?`/ipns/${t.toString(We)}`:`/ipfs/${t.toV1().toString()}`;if(qr(e))return`/ipns/${We.encode(e.bytes)}`;const n=e.toString().trim();if(n.startsWith("/")&&n.length>1)return n}throw new lt("Value must be a valid content path starting with /")}function zr(e){if(e.data==null)throw new sn("Record data is missing");const t=St(e.data);if(!Ge(t.Value,e.value??new Uint8Array(0)))throw new oe('Field "value" did not match between protobuf and CBOR');if(!Ge(t.Validity,e.validity??new Uint8Array(0)))throw new oe('Field "validity" did not match between protobuf and CBOR');if(t.ValidityType!==e.validityType)throw new oe('Field "validityType" did not match between protobuf and CBOR');if(t.Sequence!==e.sequence)throw new oe('Field "sequence" did not match between protobuf and CBOR');if(t.TTL!==e.ttl)throw new oe('Field "ttl" did not match between protobuf and CBOR')}function qr(e){return e.bytes instanceof Uint8Array}function Pr(e){return typeof e?.toCID=="function"}function jr(e){if(Pr(e))return e.toCID();try{return _e.parse(e)}catch{}return _e.asCID(e)}function it(e,t){return e.code===t}const Kr=De("ipns"),He=300*1e9,Jr="/ipns/",to=Jr.length,Ye={v1Compatible:!0,ttlNs:He};async function no(e,t,n,r,o=Ye){const u=new ct(Date.now()+Number(r)),a=V.ValidityType.EOL,h=BigInt(o.ttlNs??He);return vt(e,t,n,a,u.toString(),h,o)}async function ro(e,t,n,r,o=Ye){const u=ct.fromString(r),a=V.ValidityType.EOL,h=BigInt(o.ttlNs??He);return vt(e,t,n,a,u.toString(),h,o)}const vt=async(e,t,n,r,o,u,a=Ye)=>{n=BigInt(n);const h=W(o),C=Lr(t),k=W(C),f=Or(k,r,h,n,u),d=Mr(f),E=await e.sign(d);let N;if(e.type==="RSA"&&(N=Ot(e.publicKey)),a.v1Compatible===!0){const R=await Hr(e,k,r,h),K={value:C,signatureV1:R,validity:o,validityType:r,sequence:n,ttl:u,signatureV2:E,data:f};return N!=null&&(K.pubKey=N),K}else{const R={value:C,validity:o,validityType:r,sequence:n,ttl:u,signatureV2:E,data:f};return N!=null&&(R.pubKey=N),R}},Hr=async(e,t,n,r)=>{try{const o=Dr(t,n,r);return await e.sign(o)}catch(o){throw Kr.error("record signature creation failed",o),new un("Record signature creation failed")}};export{no as createIPNSRecord,ro as createIPNSRecordWithExpiration,Wr as extractPublicKeyFromIPNSRecord,Zr as marshalIPNSRecord,eo as multihashFromIPNSRoutingKey,Qr as multihashToIPNSRoutingKey,Jr as namespace,to as namespaceLength,Xr as unmarshalIPNSRecord};
