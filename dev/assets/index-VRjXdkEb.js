(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))v(b);new MutationObserver(b=>{for(const w of b)if(w.type==="childList")for(const E of w.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&v(E)}).observe(document,{childList:!0,subtree:!0});function g(b){const w={};return b.integrity&&(w.integrity=b.integrity),b.referrerPolicy&&(w.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?w.credentials="include":b.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function v(b){if(b.ep)return;b.ep=!0;const w=g(b);fetch(b.href,w)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$3(y){return y&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y}var jsxRuntime={exports:{}},reactJsxRuntime_production={};var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var y=Symbol.for("react.transitional.element"),u=Symbol.for("react.fragment");function g(v,b,w){var E=null;if(w!==void 0&&(E=""+w),b.key!==void 0&&(E=""+b.key),"key"in b){w={};for(var S in b)S!=="key"&&(w[S]=b[S])}else w=b;return b=w.ref,{$$typeof:y,type:v,key:E,ref:b!==void 0?b:null,props:w}}return reactJsxRuntime_production.Fragment=u,reactJsxRuntime_production.jsx=g,reactJsxRuntime_production.jsxs=g,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),react={exports:{}};function getDefaultExportFromCjs$2(y){return y&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y}var browser$f={exports:{}},process=browser$f.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(y){if(cachedSetTimeout===setTimeout)return setTimeout(y,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(y,0);try{return cachedSetTimeout(y,0)}catch{try{return cachedSetTimeout.call(null,y,0)}catch{return cachedSetTimeout.call(this,y,0)}}}function runClearTimeout(y){if(cachedClearTimeout===clearTimeout)return clearTimeout(y);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(y);try{return cachedClearTimeout(y)}catch{try{return cachedClearTimeout.call(null,y)}catch{return cachedClearTimeout.call(this,y)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var y=runTimeout(cleanUpNextTick);draining=!0;for(var u=queue.length;u;){for(currentQueue=queue,queue=[];++queueIndex<u;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,u=queue.length}currentQueue=null,draining=!1,runClearTimeout(y)}}process.nextTick=function(y){var u=new Array(arguments.length-1);if(arguments.length>1)for(var g=1;g<arguments.length;g++)u[g-1]=arguments[g];queue.push(new Item(y,u)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item(y,u){this.fun=y,this.array=u}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=!0;process.env={};process.argv=[];process.version="";process.versions={};function noop$4(){}process.on=noop$4;process.addListener=noop$4;process.once=noop$4;process.off=noop$4;process.removeListener=noop$4;process.removeAllListeners=noop$4;process.emit=noop$4;process.prependListener=noop$4;process.prependOnceListener=noop$4;process.listeners=function(y){return[]};process.binding=function(y){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(y){throw new Error("process.chdir is not supported")};process.umask=function(){return 0};var browserExports=browser$f.exports;const process$1=getDefaultExportFromCjs$2(browserExports);var react_production={},hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var y=Symbol.for("react.transitional.element"),u=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),w=Symbol.for("react.consumer"),E=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),$=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),T=Symbol.for("react.activity"),O=Symbol.iterator;function B(ee){return ee===null||typeof ee!="object"?null:(ee=O&&ee[O]||ee["@@iterator"],typeof ee=="function"?ee:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},U=Object.assign,q={};function J(ee,Z,ue){this.props=ee,this.context=Z,this.refs=q,this.updater=ue||F}J.prototype.isReactComponent={},J.prototype.setState=function(ee,Z){if(typeof ee!="object"&&typeof ee!="function"&&ee!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ee,Z,"setState")},J.prototype.forceUpdate=function(ee){this.updater.enqueueForceUpdate(this,ee,"forceUpdate")};function ie(){}ie.prototype=J.prototype;function oe(ee,Z,ue){this.props=ee,this.context=Z,this.refs=q,this.updater=ue||F}var le=oe.prototype=new ie;le.constructor=oe,U(le,J.prototype),le.isPureReactComponent=!0;var de=Array.isArray;function fe(){}var ye={H:null,A:null,T:null,S:null},we=Object.prototype.hasOwnProperty;function pe(ee,Z,ue){var _e=ue.ref;return{$$typeof:y,type:ee,key:Z,ref:_e!==void 0?_e:null,props:ue}}function ve(ee,Z){return pe(ee.type,Z,ee.props)}function he(ee){return typeof ee=="object"&&ee!==null&&ee.$$typeof===y}function ae(ee){var Z={"=":"=0",":":"=2"};return"$"+ee.replace(/[=:]/g,function(ue){return Z[ue]})}var Q=/\/+/g;function j(ee,Z){return typeof ee=="object"&&ee!==null&&ee.key!=null?ae(""+ee.key):Z.toString(36)}function z(ee){switch(ee.status){case"fulfilled":return ee.value;case"rejected":throw ee.reason;default:switch(typeof ee.status=="string"?ee.then(fe,fe):(ee.status="pending",ee.then(function(Z){ee.status==="pending"&&(ee.status="fulfilled",ee.value=Z)},function(Z){ee.status==="pending"&&(ee.status="rejected",ee.reason=Z)})),ee.status){case"fulfilled":return ee.value;case"rejected":throw ee.reason}}throw ee}function re(ee,Z,ue,_e,Re){var Ae=typeof ee;(Ae==="undefined"||Ae==="boolean")&&(ee=null);var ge=!1;if(ee===null)ge=!0;else switch(Ae){case"bigint":case"string":case"number":ge=!0;break;case"object":switch(ee.$$typeof){case y:case u:ge=!0;break;case R:return ge=ee._init,re(ge(ee._payload),Z,ue,_e,Re)}}if(ge)return Re=Re(ee),ge=_e===""?"."+j(ee,0):_e,de(Re)?(ue="",ge!=null&&(ue=ge.replace(Q,"$&/")+"/"),re(Re,Z,ue,"",function(De){return De})):Re!=null&&(he(Re)&&(Re=ve(Re,ue+(Re.key==null||ee&&ee.key===Re.key?"":(""+Re.key).replace(Q,"$&/")+"/")+ge)),Z.push(Re)),1;ge=0;var be=_e===""?".":_e+":";if(de(ee))for(var Te=0;Te<ee.length;Te++)_e=ee[Te],Ae=be+j(_e,Te),ge+=re(_e,Z,ue,Ae,Re);else if(Te=B(ee),typeof Te=="function")for(ee=Te.call(ee),Te=0;!(_e=ee.next()).done;)_e=_e.value,Ae=be+j(_e,Te++),ge+=re(_e,Z,ue,Ae,Re);else if(Ae==="object"){if(typeof ee.then=="function")return re(z(ee),Z,ue,_e,Re);throw Z=String(ee),Error("Objects are not valid as a React child (found: "+(Z==="[object Object]"?"object with keys {"+Object.keys(ee).join(", ")+"}":Z)+"). If you meant to render a collection of children, use an array instead.")}return ge}function Y(ee,Z,ue){if(ee==null)return ee;var _e=[],Re=0;return re(ee,_e,"","",function(Ae){return Z.call(ue,Ae,Re++)}),_e}function te(ee){if(ee._status===-1){var Z=ee._result;Z=Z(),Z.then(function(ue){(ee._status===0||ee._status===-1)&&(ee._status=1,ee._result=ue)},function(ue){(ee._status===0||ee._status===-1)&&(ee._status=2,ee._result=ue)}),ee._status===-1&&(ee._status=0,ee._result=Z)}if(ee._status===1)return ee._result.default;throw ee._result}var ne=typeof reportError=="function"?reportError:function(ee){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ee=="object"&&ee!==null&&typeof ee.message=="string"?String(ee.message):String(ee),error:ee});if(!window.dispatchEvent(Z))return}else if(typeof process$1=="object"&&typeof process$1.emit=="function"){process$1.emit("uncaughtException",ee);return}console.error(ee)},se={map:Y,forEach:function(ee,Z,ue){Y(ee,function(){Z.apply(this,arguments)},ue)},count:function(ee){var Z=0;return Y(ee,function(){Z++}),Z},toArray:function(ee){return Y(ee,function(Z){return Z})||[]},only:function(ee){if(!he(ee))throw Error("React.Children.only expected to receive a single React element child.");return ee}};return react_production.Activity=T,react_production.Children=se,react_production.Component=J,react_production.Fragment=g,react_production.Profiler=b,react_production.PureComponent=oe,react_production.StrictMode=v,react_production.Suspense=A,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ye,react_production.__COMPILER_RUNTIME={__proto__:null,c:function(ee){return ye.H.useMemoCache(ee)}},react_production.cache=function(ee){return function(){return ee.apply(null,arguments)}},react_production.cacheSignal=function(){return null},react_production.cloneElement=function(ee,Z,ue){if(ee==null)throw Error("The argument must be a React element, but you passed "+ee+".");var _e=U({},ee.props),Re=ee.key;if(Z!=null)for(Ae in Z.key!==void 0&&(Re=""+Z.key),Z)!we.call(Z,Ae)||Ae==="key"||Ae==="__self"||Ae==="__source"||Ae==="ref"&&Z.ref===void 0||(_e[Ae]=Z[Ae]);var Ae=arguments.length-2;if(Ae===1)_e.children=ue;else if(1<Ae){for(var ge=Array(Ae),be=0;be<Ae;be++)ge[be]=arguments[be+2];_e.children=ge}return pe(ee.type,Re,_e)},react_production.createContext=function(ee){return ee={$$typeof:E,_currentValue:ee,_currentValue2:ee,_threadCount:0,Provider:null,Consumer:null},ee.Provider=ee,ee.Consumer={$$typeof:w,_context:ee},ee},react_production.createElement=function(ee,Z,ue){var _e,Re={},Ae=null;if(Z!=null)for(_e in Z.key!==void 0&&(Ae=""+Z.key),Z)we.call(Z,_e)&&_e!=="key"&&_e!=="__self"&&_e!=="__source"&&(Re[_e]=Z[_e]);var ge=arguments.length-2;if(ge===1)Re.children=ue;else if(1<ge){for(var be=Array(ge),Te=0;Te<ge;Te++)be[Te]=arguments[Te+2];Re.children=be}if(ee&&ee.defaultProps)for(_e in ge=ee.defaultProps,ge)Re[_e]===void 0&&(Re[_e]=ge[_e]);return pe(ee,Ae,Re)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(ee){return{$$typeof:S,render:ee}},react_production.isValidElement=he,react_production.lazy=function(ee){return{$$typeof:R,_payload:{_status:-1,_result:ee},_init:te}},react_production.memo=function(ee,Z){return{$$typeof:$,type:ee,compare:Z===void 0?null:Z}},react_production.startTransition=function(ee){var Z=ye.T,ue={};ye.T=ue;try{var _e=ee(),Re=ye.S;Re!==null&&Re(ue,_e),typeof _e=="object"&&_e!==null&&typeof _e.then=="function"&&_e.then(fe,ne)}catch(Ae){ne(Ae)}finally{Z!==null&&ue.types!==null&&(Z.types=ue.types),ye.T=Z}},react_production.unstable_useCacheRefresh=function(){return ye.H.useCacheRefresh()},react_production.use=function(ee){return ye.H.use(ee)},react_production.useActionState=function(ee,Z,ue){return ye.H.useActionState(ee,Z,ue)},react_production.useCallback=function(ee,Z){return ye.H.useCallback(ee,Z)},react_production.useContext=function(ee){return ye.H.useContext(ee)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(ee,Z){return ye.H.useDeferredValue(ee,Z)},react_production.useEffect=function(ee,Z){return ye.H.useEffect(ee,Z)},react_production.useEffectEvent=function(ee){return ye.H.useEffectEvent(ee)},react_production.useId=function(){return ye.H.useId()},react_production.useImperativeHandle=function(ee,Z,ue){return ye.H.useImperativeHandle(ee,Z,ue)},react_production.useInsertionEffect=function(ee,Z){return ye.H.useInsertionEffect(ee,Z)},react_production.useLayoutEffect=function(ee,Z){return ye.H.useLayoutEffect(ee,Z)},react_production.useMemo=function(ee,Z){return ye.H.useMemo(ee,Z)},react_production.useOptimistic=function(ee,Z){return ye.H.useOptimistic(ee,Z)},react_production.useReducer=function(ee,Z,ue){return ye.H.useReducer(ee,Z,ue)},react_production.useRef=function(ee){return ye.H.useRef(ee)},react_production.useState=function(ee){return ye.H.useState(ee)},react_production.useSyncExternalStore=function(ee,Z,ue){return ye.H.useSyncExternalStore(ee,Z,ue)},react_production.useTransition=function(){return ye.H.useTransition()},react_production.version="19.2.0",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactExports=requireReact();const React=getDefaultExportFromCjs$3(reactExports);var client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,(function(y){function u(re,Y){var te=re.length;re.push(Y);e:for(;0<te;){var ne=te-1>>>1,se=re[ne];if(0<b(se,Y))re[ne]=Y,re[te]=se,te=ne;else break e}}function g(re){return re.length===0?null:re[0]}function v(re){if(re.length===0)return null;var Y=re[0],te=re.pop();if(te!==Y){re[0]=te;e:for(var ne=0,se=re.length,ee=se>>>1;ne<ee;){var Z=2*(ne+1)-1,ue=re[Z],_e=Z+1,Re=re[_e];if(0>b(ue,te))_e<se&&0>b(Re,ue)?(re[ne]=Re,re[_e]=te,ne=_e):(re[ne]=ue,re[Z]=te,ne=Z);else if(_e<se&&0>b(Re,te))re[ne]=Re,re[_e]=te,ne=_e;else break e}}return Y}function b(re,Y){var te=re.sortIndex-Y.sortIndex;return te!==0?te:re.id-Y.id}if(y.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var w=performance;y.unstable_now=function(){return w.now()}}else{var E=Date,S=E.now();y.unstable_now=function(){return E.now()-S}}var A=[],$=[],R=1,T=null,O=3,B=!1,F=!1,U=!1,q=!1,J=typeof setTimeout=="function"?setTimeout:null,ie=typeof clearTimeout=="function"?clearTimeout:null,oe=typeof setImmediate<"u"?setImmediate:null;function le(re){for(var Y=g($);Y!==null;){if(Y.callback===null)v($);else if(Y.startTime<=re)v($),Y.sortIndex=Y.expirationTime,u(A,Y);else break;Y=g($)}}function de(re){if(U=!1,le(re),!F)if(g(A)!==null)F=!0,fe||(fe=!0,ae());else{var Y=g($);Y!==null&&z(de,Y.startTime-re)}}var fe=!1,ye=-1,we=5,pe=-1;function ve(){return q?!0:!(y.unstable_now()-pe<we)}function he(){if(q=!1,fe){var re=y.unstable_now();pe=re;var Y=!0;try{e:{F=!1,U&&(U=!1,ie(ye),ye=-1),B=!0;var te=O;try{t:{for(le(re),T=g(A);T!==null&&!(T.expirationTime>re&&ve());){var ne=T.callback;if(typeof ne=="function"){T.callback=null,O=T.priorityLevel;var se=ne(T.expirationTime<=re);if(re=y.unstable_now(),typeof se=="function"){T.callback=se,le(re),Y=!0;break t}T===g(A)&&v(A),le(re)}else v(A);T=g(A)}if(T!==null)Y=!0;else{var ee=g($);ee!==null&&z(de,ee.startTime-re),Y=!1}}break e}finally{T=null,O=te,B=!1}Y=void 0}}finally{Y?ae():fe=!1}}}var ae;if(typeof oe=="function")ae=function(){oe(he)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,j=Q.port2;Q.port1.onmessage=he,ae=function(){j.postMessage(null)}}else ae=function(){J(he,0)};function z(re,Y){ye=J(function(){re(y.unstable_now())},Y)}y.unstable_IdlePriority=5,y.unstable_ImmediatePriority=1,y.unstable_LowPriority=4,y.unstable_NormalPriority=3,y.unstable_Profiling=null,y.unstable_UserBlockingPriority=2,y.unstable_cancelCallback=function(re){re.callback=null},y.unstable_forceFrameRate=function(re){0>re||125<re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):we=0<re?Math.floor(1e3/re):5},y.unstable_getCurrentPriorityLevel=function(){return O},y.unstable_next=function(re){switch(O){case 1:case 2:case 3:var Y=3;break;default:Y=O}var te=O;O=Y;try{return re()}finally{O=te}},y.unstable_requestPaint=function(){q=!0},y.unstable_runWithPriority=function(re,Y){switch(re){case 1:case 2:case 3:case 4:case 5:break;default:re=3}var te=O;O=re;try{return Y()}finally{O=te}},y.unstable_scheduleCallback=function(re,Y,te){var ne=y.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?ne+te:ne):te=ne,re){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=te+se,re={id:R++,callback:Y,priorityLevel:re,startTime:te,expirationTime:se,sortIndex:-1},te>ne?(re.sortIndex=te,u($,re),g(A)===null&&re===g($)&&(U?(ie(ye),ye=-1):U=!0,z(de,te-ne))):(re.sortIndex=se,u(A,re),F||B||(F=!0,fe||(fe=!0,ae()))),re},y.unstable_shouldYield=ve,y.unstable_wrapCallback=function(re){var Y=O;return function(){var te=O;O=Y;try{return re.apply(this,arguments)}finally{O=te}}}})(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var reactDom={exports:{}},reactDom_production={};var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var y=requireReact();function u(A){var $="https://react.dev/errors/"+A;if(1<arguments.length){$+="?args[]="+encodeURIComponent(arguments[1]);for(var R=2;R<arguments.length;R++)$+="&args[]="+encodeURIComponent(arguments[R])}return"Minified React error #"+A+"; visit "+$+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function g(){}var v={d:{f:g,r:function(){throw Error(u(522))},D:g,C:g,L:g,m:g,X:g,S:g,M:g},p:0,findDOMNode:null},b=Symbol.for("react.portal");function w(A,$,R){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:b,key:T==null?null:""+T,children:A,containerInfo:$,implementation:R}}var E=y.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function S(A,$){if(A==="font")return"";if(typeof $=="string")return $==="use-credentials"?$:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=v,reactDom_production.createPortal=function(A,$){var R=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!$||$.nodeType!==1&&$.nodeType!==9&&$.nodeType!==11)throw Error(u(299));return w(A,$,null,R)},reactDom_production.flushSync=function(A){var $=E.T,R=v.p;try{if(E.T=null,v.p=2,A)return A()}finally{E.T=$,v.p=R,v.d.f()}},reactDom_production.preconnect=function(A,$){typeof A=="string"&&($?($=$.crossOrigin,$=typeof $=="string"?$==="use-credentials"?$:"":void 0):$=null,v.d.C(A,$))},reactDom_production.prefetchDNS=function(A){typeof A=="string"&&v.d.D(A)},reactDom_production.preinit=function(A,$){if(typeof A=="string"&&$&&typeof $.as=="string"){var R=$.as,T=S(R,$.crossOrigin),O=typeof $.integrity=="string"?$.integrity:void 0,B=typeof $.fetchPriority=="string"?$.fetchPriority:void 0;R==="style"?v.d.S(A,typeof $.precedence=="string"?$.precedence:void 0,{crossOrigin:T,integrity:O,fetchPriority:B}):R==="script"&&v.d.X(A,{crossOrigin:T,integrity:O,fetchPriority:B,nonce:typeof $.nonce=="string"?$.nonce:void 0})}},reactDom_production.preinitModule=function(A,$){if(typeof A=="string")if(typeof $=="object"&&$!==null){if($.as==null||$.as==="script"){var R=S($.as,$.crossOrigin);v.d.M(A,{crossOrigin:R,integrity:typeof $.integrity=="string"?$.integrity:void 0,nonce:typeof $.nonce=="string"?$.nonce:void 0})}}else $==null&&v.d.M(A)},reactDom_production.preload=function(A,$){if(typeof A=="string"&&typeof $=="object"&&$!==null&&typeof $.as=="string"){var R=$.as,T=S(R,$.crossOrigin);v.d.L(A,R,{crossOrigin:T,integrity:typeof $.integrity=="string"?$.integrity:void 0,nonce:typeof $.nonce=="string"?$.nonce:void 0,type:typeof $.type=="string"?$.type:void 0,fetchPriority:typeof $.fetchPriority=="string"?$.fetchPriority:void 0,referrerPolicy:typeof $.referrerPolicy=="string"?$.referrerPolicy:void 0,imageSrcSet:typeof $.imageSrcSet=="string"?$.imageSrcSet:void 0,imageSizes:typeof $.imageSizes=="string"?$.imageSizes:void 0,media:typeof $.media=="string"?$.media:void 0})}},reactDom_production.preloadModule=function(A,$){if(typeof A=="string")if($){var R=S($.as,$.crossOrigin);v.d.m(A,{as:typeof $.as=="string"&&$.as!=="script"?$.as:void 0,crossOrigin:R,integrity:typeof $.integrity=="string"?$.integrity:void 0})}else v.d.m(A)},reactDom_production.requestFormReset=function(A){v.d.r(A)},reactDom_production.unstable_batchedUpdates=function(A,$){return A($)},reactDom_production.useFormState=function(A,$,R){return E.H.useFormState(A,$,R)},reactDom_production.useFormStatus=function(){return E.H.useHostTransitionStatus()},reactDom_production.version="19.2.0",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function y(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(y)}catch(u){console.error(u)}}return y(),reactDom.exports=requireReactDom_production(),reactDom.exports}var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var y=requireScheduler(),u=requireReact(),g=requireReactDom();function v(k){var D="https://react.dev/errors/"+k;if(1<arguments.length){D+="?args[]="+encodeURIComponent(arguments[1]);for(var H=2;H<arguments.length;H++)D+="&args[]="+encodeURIComponent(arguments[H])}return"Minified React error #"+k+"; visit "+D+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function b(k){return!(!k||k.nodeType!==1&&k.nodeType!==9&&k.nodeType!==11)}function w(k){var D=k,H=k;if(k.alternate)for(;D.return;)D=D.return;else{k=D;do D=k,(D.flags&4098)!==0&&(H=D.return),k=D.return;while(k)}return D.tag===3?H:null}function E(k){if(k.tag===13){var D=k.memoizedState;if(D===null&&(k=k.alternate,k!==null&&(D=k.memoizedState)),D!==null)return D.dehydrated}return null}function S(k){if(k.tag===31){var D=k.memoizedState;if(D===null&&(k=k.alternate,k!==null&&(D=k.memoizedState)),D!==null)return D.dehydrated}return null}function A(k){if(w(k)!==k)throw Error(v(188))}function $(k){var D=k.alternate;if(!D){if(D=w(k),D===null)throw Error(v(188));return D!==k?null:k}for(var H=k,ce=D;;){var me=H.return;if(me===null)break;var xe=me.alternate;if(xe===null){if(ce=me.return,ce!==null){H=ce;continue}break}if(me.child===xe.child){for(xe=me.child;xe;){if(xe===H)return A(me),k;if(xe===ce)return A(me),D;xe=xe.sibling}throw Error(v(188))}if(H.return!==ce.return)H=me,ce=xe;else{for(var Ne=!1,Fe=me.child;Fe;){if(Fe===H){Ne=!0,H=me,ce=xe;break}if(Fe===ce){Ne=!0,ce=me,H=xe;break}Fe=Fe.sibling}if(!Ne){for(Fe=xe.child;Fe;){if(Fe===H){Ne=!0,H=xe,ce=me;break}if(Fe===ce){Ne=!0,ce=xe,H=me;break}Fe=Fe.sibling}if(!Ne)throw Error(v(189))}}if(H.alternate!==ce)throw Error(v(190))}if(H.tag!==3)throw Error(v(188));return H.stateNode.current===H?k:D}function R(k){var D=k.tag;if(D===5||D===26||D===27||D===6)return k;for(k=k.child;k!==null;){if(D=R(k),D!==null)return D;k=k.sibling}return null}var T=Object.assign,O=Symbol.for("react.element"),B=Symbol.for("react.transitional.element"),F=Symbol.for("react.portal"),U=Symbol.for("react.fragment"),q=Symbol.for("react.strict_mode"),J=Symbol.for("react.profiler"),ie=Symbol.for("react.consumer"),oe=Symbol.for("react.context"),le=Symbol.for("react.forward_ref"),de=Symbol.for("react.suspense"),fe=Symbol.for("react.suspense_list"),ye=Symbol.for("react.memo"),we=Symbol.for("react.lazy"),pe=Symbol.for("react.activity"),ve=Symbol.for("react.memo_cache_sentinel"),he=Symbol.iterator;function ae(k){return k===null||typeof k!="object"?null:(k=he&&k[he]||k["@@iterator"],typeof k=="function"?k:null)}var Q=Symbol.for("react.client.reference");function j(k){if(k==null)return null;if(typeof k=="function")return k.$$typeof===Q?null:k.displayName||k.name||null;if(typeof k=="string")return k;switch(k){case U:return"Fragment";case J:return"Profiler";case q:return"StrictMode";case de:return"Suspense";case fe:return"SuspenseList";case pe:return"Activity"}if(typeof k=="object")switch(k.$$typeof){case F:return"Portal";case oe:return k.displayName||"Context";case ie:return(k._context.displayName||"Context")+".Consumer";case le:var D=k.render;return k=k.displayName,k||(k=D.displayName||D.name||"",k=k!==""?"ForwardRef("+k+")":"ForwardRef"),k;case ye:return D=k.displayName||null,D!==null?D:j(k.type)||"Memo";case we:D=k._payload,k=k._init;try{return j(k(D))}catch{}}return null}var z=Array.isArray,re=u.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y=g.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},ne=[],se=-1;function ee(k){return{current:k}}function Z(k){0>se||(k.current=ne[se],ne[se]=null,se--)}function ue(k,D){se++,ne[se]=k.current,k.current=D}var _e=ee(null),Re=ee(null),Ae=ee(null),ge=ee(null);function be(k,D){switch(ue(Ae,D),ue(Re,k),ue(_e,null),D.nodeType){case 9:case 11:k=(k=D.documentElement)&&(k=k.namespaceURI)?Tf(k):0;break;default:if(k=D.tagName,D=D.namespaceURI)D=Tf(D),k=kf(D,k);else switch(k){case"svg":k=1;break;case"math":k=2;break;default:k=0}}Z(_e),ue(_e,k)}function Te(){Z(_e),Z(Re),Z(Ae)}function De(k){k.memoizedState!==null&&ue(ge,k);var D=_e.current,H=kf(D,k.type);D!==H&&(ue(Re,k),ue(_e,H))}function Ie(k){Re.current===k&&(Z(_e),Z(Re)),ge.current===k&&(Z(ge),Vs._currentValue=te)}var Se,Be;function Le(k){if(Se===void 0)try{throw Error()}catch(H){var D=H.stack.trim().match(/\n( *(at )?)/);Se=D&&D[1]||"",Be=-1<H.stack.indexOf(`
    at`)?" (<anonymous>)":-1<H.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Se+k+Be}var qe=!1;function Ke(k,D){if(!k||qe)return"";qe=!0;var H=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var ce={DetermineComponentFrameRoot:function(){try{if(D){var Et=function(){throw Error()};if(Object.defineProperty(Et.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Et,[])}catch(pt){var ct=pt}Reflect.construct(k,[],Et)}else{try{Et.call()}catch(pt){ct=pt}k.call(Et.prototype)}}else{try{throw Error()}catch(pt){ct=pt}(Et=k())&&typeof Et.catch=="function"&&Et.catch(function(){})}}catch(pt){if(pt&&ct&&typeof pt.stack=="string")return[pt.stack,ct.stack]}return[null,null]}};ce.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var me=Object.getOwnPropertyDescriptor(ce.DetermineComponentFrameRoot,"name");me&&me.configurable&&Object.defineProperty(ce.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var xe=ce.DetermineComponentFrameRoot(),Ne=xe[0],Fe=xe[1];if(Ne&&Fe){var Ye=Ne.split(`
`),st=Fe.split(`
`);for(me=ce=0;ce<Ye.length&&!Ye[ce].includes("DetermineComponentFrameRoot");)ce++;for(;me<st.length&&!st[me].includes("DetermineComponentFrameRoot");)me++;if(ce===Ye.length||me===st.length)for(ce=Ye.length-1,me=st.length-1;1<=ce&&0<=me&&Ye[ce]!==st[me];)me--;for(;1<=ce&&0<=me;ce--,me--)if(Ye[ce]!==st[me]){if(ce!==1||me!==1)do if(ce--,me--,0>me||Ye[ce]!==st[me]){var yt=`
`+Ye[ce].replace(" at new "," at ");return k.displayName&&yt.includes("<anonymous>")&&(yt=yt.replace("<anonymous>",k.displayName)),yt}while(1<=ce&&0<=me);break}}}finally{qe=!1,Error.prepareStackTrace=H}return(H=k?k.displayName||k.name:"")?Le(H):""}function Ge(k,D){switch(k.tag){case 26:case 27:case 5:return Le(k.type);case 16:return Le("Lazy");case 13:return k.child!==D&&D!==null?Le("Suspense Fallback"):Le("Suspense");case 19:return Le("SuspenseList");case 0:case 15:return Ke(k.type,!1);case 11:return Ke(k.type.render,!1);case 1:return Ke(k.type,!0);case 31:return Le("Activity");default:return""}}function Xe(k){try{var D="",H=null;do D+=Ge(k,H),H=k,k=k.return;while(k);return D}catch(ce){return`
Error generating stack: `+ce.message+`
`+ce.stack}}var ze=Object.prototype.hasOwnProperty,et=y.unstable_scheduleCallback,Ze=y.unstable_cancelCallback,nt=y.unstable_shouldYield,ut=y.unstable_requestPaint,ot=y.unstable_now,vt=y.unstable_getCurrentPriorityLevel,bt=y.unstable_ImmediatePriority,lt=y.unstable_UserBlockingPriority,kt=y.unstable_NormalPriority,Ct=y.unstable_LowPriority,Me=y.unstable_IdlePriority,Ce=y.log,Ee=y.unstable_setDisableYieldValue,Pe=null,je=null;function He(k){if(typeof Ce=="function"&&Ee(k),je&&typeof je.setStrictMode=="function")try{je.setStrictMode(Pe,k)}catch{}}var Ve=Math.clz32?Math.clz32:mt,dt=Math.log,xt=Math.LN2;function mt(k){return k>>>=0,k===0?32:31-(dt(k)/xt|0)|0}var gt=256,at=262144,ht=4194304;function _t(k){var D=k&42;if(D!==0)return D;switch(k&-k){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return k&261888;case 262144:case 524288:case 1048576:case 2097152:return k&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return k&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return k}}function $t(k,D,H){var ce=k.pendingLanes;if(ce===0)return 0;var me=0,xe=k.suspendedLanes,Ne=k.pingedLanes;k=k.warmLanes;var Fe=ce&134217727;return Fe!==0?(ce=Fe&~xe,ce!==0?me=_t(ce):(Ne&=Fe,Ne!==0?me=_t(Ne):H||(H=Fe&~k,H!==0&&(me=_t(H))))):(Fe=ce&~xe,Fe!==0?me=_t(Fe):Ne!==0?me=_t(Ne):H||(H=ce&~k,H!==0&&(me=_t(H)))),me===0?0:D!==0&&D!==me&&(D&xe)===0&&(xe=me&-me,H=D&-D,xe>=H||xe===32&&(H&4194048)!==0)?D:me}function St(k,D){return(k.pendingLanes&~(k.suspendedLanes&~k.pingedLanes)&D)===0}function ft(k,D){switch(k){case 1:case 2:case 4:case 8:case 64:return D+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return D+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function At(){var k=ht;return ht<<=1,(ht&62914560)===0&&(ht=4194304),k}function Oe(k){for(var D=[],H=0;31>H;H++)D.push(k);return D}function $e(k,D){k.pendingLanes|=D,D!==268435456&&(k.suspendedLanes=0,k.pingedLanes=0,k.warmLanes=0)}function ke(k,D,H,ce,me,xe){var Ne=k.pendingLanes;k.pendingLanes=H,k.suspendedLanes=0,k.pingedLanes=0,k.warmLanes=0,k.expiredLanes&=H,k.entangledLanes&=H,k.errorRecoveryDisabledLanes&=H,k.shellSuspendCounter=0;var Fe=k.entanglements,Ye=k.expirationTimes,st=k.hiddenUpdates;for(H=Ne&~H;0<H;){var yt=31-Ve(H),Et=1<<yt;Fe[yt]=0,Ye[yt]=-1;var ct=st[yt];if(ct!==null)for(st[yt]=null,yt=0;yt<ct.length;yt++){var pt=ct[yt];pt!==null&&(pt.lane&=-536870913)}H&=~Et}ce!==0&&Ue(k,ce,0),xe!==0&&me===0&&k.tag!==0&&(k.suspendedLanes|=xe&~(Ne&~D))}function Ue(k,D,H){k.pendingLanes|=D,k.suspendedLanes&=~D;var ce=31-Ve(D);k.entangledLanes|=D,k.entanglements[ce]=k.entanglements[ce]|1073741824|H&261930}function We(k,D){var H=k.entangledLanes|=D;for(k=k.entanglements;H;){var ce=31-Ve(H),me=1<<ce;me&D|k[ce]&D&&(k[ce]|=D),H&=~me}}function Qe(k,D){var H=D&-D;return H=(H&42)!==0?1:tt(H),(H&(k.suspendedLanes|D))!==0?0:H}function tt(k){switch(k){case 2:k=1;break;case 8:k=4;break;case 32:k=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:k=128;break;case 268435456:k=134217728;break;default:k=0}return k}function Pt(k){return k&=-k,2<k?8<k?(k&134217727)!==0?32:268435456:8:2}function Nt(){var k=Y.p;return k!==0?k:(k=window.event,k===void 0?32:Qf(k.type))}function Rt(k,D){var H=Y.p;try{return Y.p=k,D()}finally{Y.p=H}}var Dt=Math.random().toString(36).slice(2),Tt="__reactFiber$"+Dt,It="__reactProps$"+Dt,Wt="__reactContainer$"+Dt,jt="__reactEvents$"+Dt,Ft="__reactListeners$"+Dt,Kr="__reactHandles$"+Dt,Mr="__reactResources$"+Dt,Cr="__reactMarker$"+Dt;function Pr(k){delete k[Tt],delete k[It],delete k[jt],delete k[Ft],delete k[Kr]}function wr(k){var D=k[Tt];if(D)return D;for(var H=k.parentNode;H;){if(D=H[Wt]||H[Tt]){if(H=D.alternate,D.child!==null||H!==null&&H.child!==null)for(k=Bf(k);k!==null;){if(H=k[Tt])return H;k=Bf(k)}return D}k=H,H=k.parentNode}return null}function Er(k){if(k=k[Tt]||k[Wt]){var D=k.tag;if(D===5||D===6||D===13||D===31||D===26||D===27||D===3)return k}return null}function $r(k){var D=k.tag;if(D===5||D===26||D===27||D===6)return k.stateNode;throw Error(v(33))}function _r(k){var D=k[Mr];return D||(D=k[Mr]={hoistableStyles:new Map,hoistableScripts:new Map}),D}function Jt(k){k[Cr]=!0}var Or=new Set,Dr={};function br(k,D){Sr(k,D),Sr(k+"Capture",D)}function Sr(k,D){for(Dr[k]=D,k=0;k<D.length;k++)Or.add(D[k])}var Vr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Br={},Lr={};function Gr(k){return ze.call(Lr,k)?!0:ze.call(Br,k)?!1:Vr.test(k)?Lr[k]=!0:(Br[k]=!0,!1)}function tn(k,D,H){if(Gr(D))if(H===null)k.removeAttribute(D);else{switch(typeof H){case"undefined":case"function":case"symbol":k.removeAttribute(D);return;case"boolean":var ce=D.toLowerCase().slice(0,5);if(ce!=="data-"&&ce!=="aria-"){k.removeAttribute(D);return}}k.setAttribute(D,""+H)}}function rn(k,D,H){if(H===null)k.removeAttribute(D);else{switch(typeof H){case"undefined":case"function":case"symbol":case"boolean":k.removeAttribute(D);return}k.setAttribute(D,""+H)}}function _n(k,D,H,ce){if(ce===null)k.removeAttribute(H);else{switch(typeof ce){case"undefined":case"function":case"symbol":case"boolean":k.removeAttribute(H);return}k.setAttributeNS(D,H,""+ce)}}function nn(k){switch(typeof k){case"bigint":case"boolean":case"number":case"string":case"undefined":return k;case"object":return k;default:return""}}function gl(k){var D=k.type;return(k=k.nodeName)&&k.toLowerCase()==="input"&&(D==="checkbox"||D==="radio")}function fh(k,D,H){var ce=Object.getOwnPropertyDescriptor(k.constructor.prototype,D);if(!k.hasOwnProperty(D)&&typeof ce<"u"&&typeof ce.get=="function"&&typeof ce.set=="function"){var me=ce.get,xe=ce.set;return Object.defineProperty(k,D,{configurable:!0,get:function(){return me.call(this)},set:function(Ne){H=""+Ne,xe.call(this,Ne)}}),Object.defineProperty(k,D,{enumerable:ce.enumerable}),{getValue:function(){return H},setValue:function(Ne){H=""+Ne},stopTracking:function(){k._valueTracker=null,delete k[D]}}}}function aa(k){if(!k._valueTracker){var D=gl(k)?"checked":"value";k._valueTracker=fh(k,D,""+k[D])}}function yl(k){if(!k)return!1;var D=k._valueTracker;if(!D)return!0;var H=D.getValue(),ce="";return k&&(ce=gl(k)?k.checked?"true":"false":k.value),k=ce,k!==H?(D.setValue(k),!0):!1}function Zs(k){if(k=k||(typeof document<"u"?document:void 0),typeof k>"u")return null;try{return k.activeElement||k.body}catch{return k.body}}var hh=/[\n"\\]/g;function sn(k){return k.replace(hh,function(D){return"\\"+D.charCodeAt(0).toString(16)+" "})}function ca(k,D,H,ce,me,xe,Ne,Fe){k.name="",Ne!=null&&typeof Ne!="function"&&typeof Ne!="symbol"&&typeof Ne!="boolean"?k.type=Ne:k.removeAttribute("type"),D!=null?Ne==="number"?(D===0&&k.value===""||k.value!=D)&&(k.value=""+nn(D)):k.value!==""+nn(D)&&(k.value=""+nn(D)):Ne!=="submit"&&Ne!=="reset"||k.removeAttribute("value"),D!=null?la(k,Ne,nn(D)):H!=null?la(k,Ne,nn(H)):ce!=null&&k.removeAttribute("value"),me==null&&xe!=null&&(k.defaultChecked=!!xe),me!=null&&(k.checked=me&&typeof me!="function"&&typeof me!="symbol"),Fe!=null&&typeof Fe!="function"&&typeof Fe!="symbol"&&typeof Fe!="boolean"?k.name=""+nn(Fe):k.removeAttribute("name")}function vl(k,D,H,ce,me,xe,Ne,Fe){if(xe!=null&&typeof xe!="function"&&typeof xe!="symbol"&&typeof xe!="boolean"&&(k.type=xe),D!=null||H!=null){if(!(xe!=="submit"&&xe!=="reset"||D!=null)){aa(k);return}H=H!=null?""+nn(H):"",D=D!=null?""+nn(D):H,Fe||D===k.value||(k.value=D),k.defaultValue=D}ce=ce??me,ce=typeof ce!="function"&&typeof ce!="symbol"&&!!ce,k.checked=Fe?k.checked:!!ce,k.defaultChecked=!!ce,Ne!=null&&typeof Ne!="function"&&typeof Ne!="symbol"&&typeof Ne!="boolean"&&(k.name=Ne),aa(k)}function la(k,D,H){D==="number"&&Zs(k.ownerDocument)===k||k.defaultValue===""+H||(k.defaultValue=""+H)}function $i(k,D,H,ce){if(k=k.options,D){D={};for(var me=0;me<H.length;me++)D["$"+H[me]]=!0;for(H=0;H<k.length;H++)me=D.hasOwnProperty("$"+k[H].value),k[H].selected!==me&&(k[H].selected=me),me&&ce&&(k[H].defaultSelected=!0)}else{for(H=""+nn(H),D=null,me=0;me<k.length;me++){if(k[me].value===H){k[me].selected=!0,ce&&(k[me].defaultSelected=!0);return}D!==null||k[me].disabled||(D=k[me])}D!==null&&(D.selected=!0)}}function bl(k,D,H){if(D!=null&&(D=""+nn(D),D!==k.value&&(k.value=D),H==null)){k.defaultValue!==D&&(k.defaultValue=D);return}k.defaultValue=H!=null?""+nn(H):""}function xl(k,D,H,ce){if(D==null){if(ce!=null){if(H!=null)throw Error(v(92));if(z(ce)){if(1<ce.length)throw Error(v(93));ce=ce[0]}H=ce}H==null&&(H=""),D=H}H=nn(D),k.defaultValue=H,ce=k.textContent,ce===H&&ce!==""&&ce!==null&&(k.value=ce),aa(k)}function Ri(k,D){if(D){var H=k.firstChild;if(H&&H===k.lastChild&&H.nodeType===3){H.nodeValue=D;return}}k.textContent=D}var ph=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function wl(k,D,H){var ce=D.indexOf("--")===0;H==null||typeof H=="boolean"||H===""?ce?k.setProperty(D,""):D==="float"?k.cssFloat="":k[D]="":ce?k.setProperty(D,H):typeof H!="number"||H===0||ph.has(D)?D==="float"?k.cssFloat=H:k[D]=(""+H).trim():k[D]=H+"px"}function El(k,D,H){if(D!=null&&typeof D!="object")throw Error(v(62));if(k=k.style,H!=null){for(var ce in H)!H.hasOwnProperty(ce)||D!=null&&D.hasOwnProperty(ce)||(ce.indexOf("--")===0?k.setProperty(ce,""):ce==="float"?k.cssFloat="":k[ce]="");for(var me in D)ce=D[me],D.hasOwnProperty(me)&&H[me]!==ce&&wl(k,me,ce)}else for(var xe in D)D.hasOwnProperty(xe)&&wl(k,xe,D[xe])}function ua(k){if(k.indexOf("-")===-1)return!1;switch(k){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mh=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),gh=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Xs(k){return gh.test(""+k)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":k}function Sn(){}var da=null;function fa(k){return k=k.target||k.srcElement||window,k.correspondingUseElement&&(k=k.correspondingUseElement),k.nodeType===3?k.parentNode:k}var Ti=null,ki=null;function _l(k){var D=Er(k);if(D&&(k=D.stateNode)){var H=k[It]||null;e:switch(k=D.stateNode,D.type){case"input":if(ca(k,H.value,H.defaultValue,H.defaultValue,H.checked,H.defaultChecked,H.type,H.name),D=H.name,H.type==="radio"&&D!=null){for(H=k;H.parentNode;)H=H.parentNode;for(H=H.querySelectorAll('input[name="'+sn(""+D)+'"][type="radio"]'),D=0;D<H.length;D++){var ce=H[D];if(ce!==k&&ce.form===k.form){var me=ce[It]||null;if(!me)throw Error(v(90));ca(ce,me.value,me.defaultValue,me.defaultValue,me.checked,me.defaultChecked,me.type,me.name)}}for(D=0;D<H.length;D++)ce=H[D],ce.form===k.form&&yl(ce)}break e;case"textarea":bl(k,H.value,H.defaultValue);break e;case"select":D=H.value,D!=null&&$i(k,!!H.multiple,D,!1)}}}var ha=!1;function Sl(k,D,H){if(ha)return k(D,H);ha=!0;try{var ce=k(D);return ce}finally{if(ha=!1,(Ti!==null||ki!==null)&&(jo(),Ti&&(D=Ti,k=ki,ki=Ti=null,_l(D),k)))for(D=0;D<k.length;D++)_l(k[D])}}function cs(k,D){var H=k.stateNode;if(H===null)return null;var ce=H[It]||null;if(ce===null)return null;H=ce[D];e:switch(D){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(ce=!ce.disabled)||(k=k.type,ce=!(k==="button"||k==="input"||k==="select"||k==="textarea")),k=!ce;break e;default:k=!1}if(k)return null;if(H&&typeof H!="function")throw Error(v(231,D,typeof H));return H}var An=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pa=!1;if(An)try{var ls={};Object.defineProperty(ls,"passive",{get:function(){pa=!0}}),window.addEventListener("test",ls,ls),window.removeEventListener("test",ls,ls)}catch{pa=!1}var qn=null,ma=null,Js=null;function Al(){if(Js)return Js;var k,D=ma,H=D.length,ce,me="value"in qn?qn.value:qn.textContent,xe=me.length;for(k=0;k<H&&D[k]===me[k];k++);var Ne=H-k;for(ce=1;ce<=Ne&&D[H-ce]===me[xe-ce];ce++);return Js=me.slice(k,1<ce?1-ce:void 0)}function Qs(k){var D=k.keyCode;return"charCode"in k?(k=k.charCode,k===0&&D===13&&(k=13)):k=D,k===10&&(k=13),32<=k||k===13?k:0}function eo(){return!0}function Cl(){return!1}function jr(k){function D(H,ce,me,xe,Ne){this._reactName=H,this._targetInst=me,this.type=ce,this.nativeEvent=xe,this.target=Ne,this.currentTarget=null;for(var Fe in k)k.hasOwnProperty(Fe)&&(H=k[Fe],this[Fe]=H?H(xe):xe[Fe]);return this.isDefaultPrevented=(xe.defaultPrevented!=null?xe.defaultPrevented:xe.returnValue===!1)?eo:Cl,this.isPropagationStopped=Cl,this}return T(D.prototype,{preventDefault:function(){this.defaultPrevented=!0;var H=this.nativeEvent;H&&(H.preventDefault?H.preventDefault():typeof H.returnValue!="unknown"&&(H.returnValue=!1),this.isDefaultPrevented=eo)},stopPropagation:function(){var H=this.nativeEvent;H&&(H.stopPropagation?H.stopPropagation():typeof H.cancelBubble!="unknown"&&(H.cancelBubble=!0),this.isPropagationStopped=eo)},persist:function(){},isPersistent:eo}),D}var di={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(k){return k.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},to=jr(di),us=T({},di,{view:0,detail:0}),yh=jr(us),ga,ya,ds,ro=T({},us,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ba,button:0,buttons:0,relatedTarget:function(k){return k.relatedTarget===void 0?k.fromElement===k.srcElement?k.toElement:k.fromElement:k.relatedTarget},movementX:function(k){return"movementX"in k?k.movementX:(k!==ds&&(ds&&k.type==="mousemove"?(ga=k.screenX-ds.screenX,ya=k.screenY-ds.screenY):ya=ga=0,ds=k),ga)},movementY:function(k){return"movementY"in k?k.movementY:ya}}),$l=jr(ro),bh=T({},ro,{dataTransfer:0}),xh=jr(bh),wh=T({},us,{relatedTarget:0}),va=jr(wh),Eh=T({},di,{animationName:0,elapsedTime:0,pseudoElement:0}),_h=jr(Eh),Sh=T({},di,{clipboardData:function(k){return"clipboardData"in k?k.clipboardData:window.clipboardData}}),Ah=jr(Sh),Ch=T({},di,{data:0}),Rl=jr(Ch),$h={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Th={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kh(k){var D=this.nativeEvent;return D.getModifierState?D.getModifierState(k):(k=Th[k])?!!D[k]:!1}function ba(){return kh}var Ih=T({},us,{key:function(k){if(k.key){var D=$h[k.key]||k.key;if(D!=="Unidentified")return D}return k.type==="keypress"?(k=Qs(k),k===13?"Enter":String.fromCharCode(k)):k.type==="keydown"||k.type==="keyup"?Rh[k.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ba,charCode:function(k){return k.type==="keypress"?Qs(k):0},keyCode:function(k){return k.type==="keydown"||k.type==="keyup"?k.keyCode:0},which:function(k){return k.type==="keypress"?Qs(k):k.type==="keydown"||k.type==="keyup"?k.keyCode:0}}),Ph=jr(Ih),Nh=T({},ro,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tl=jr(Nh),Mh=T({},us,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ba}),Oh=jr(Mh),Dh=T({},di,{propertyName:0,elapsedTime:0,pseudoElement:0}),Bh=jr(Dh),Lh=T({},ro,{deltaX:function(k){return"deltaX"in k?k.deltaX:"wheelDeltaX"in k?-k.wheelDeltaX:0},deltaY:function(k){return"deltaY"in k?k.deltaY:"wheelDeltaY"in k?-k.wheelDeltaY:"wheelDelta"in k?-k.wheelDelta:0},deltaZ:0,deltaMode:0}),jh=jr(Lh),Fh=T({},di,{newState:0,oldState:0}),Uh=jr(Fh),qh=[9,13,27,32],xa=An&&"CompositionEvent"in window,fs=null;An&&"documentMode"in document&&(fs=document.documentMode);var Hh=An&&"TextEvent"in window&&!fs,kl=An&&(!xa||fs&&8<fs&&11>=fs),Il=" ",Pl=!1;function Nl(k,D){switch(k){case"keyup":return qh.indexOf(D.keyCode)!==-1;case"keydown":return D.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ml(k){return k=k.detail,typeof k=="object"&&"data"in k?k.data:null}var Ii=!1;function zh(k,D){switch(k){case"compositionend":return Ml(D);case"keypress":return D.which!==32?null:(Pl=!0,Il);case"textInput":return k=D.data,k===Il&&Pl?null:k;default:return null}}function Kh(k,D){if(Ii)return k==="compositionend"||!xa&&Nl(k,D)?(k=Al(),Js=ma=qn=null,Ii=!1,k):null;switch(k){case"paste":return null;case"keypress":if(!(D.ctrlKey||D.altKey||D.metaKey)||D.ctrlKey&&D.altKey){if(D.char&&1<D.char.length)return D.char;if(D.which)return String.fromCharCode(D.which)}return null;case"compositionend":return kl&&D.locale!=="ko"?null:D.data;default:return null}}var Vh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ol(k){var D=k&&k.nodeName&&k.nodeName.toLowerCase();return D==="input"?!!Vh[k.type]:D==="textarea"}function Dl(k,D,H,ce){Ti?ki?ki.push(ce):ki=[ce]:Ti=ce,D=Vo(D,"onChange"),0<D.length&&(H=new to("onChange","change",null,H,ce),k.push({event:H,listeners:D}))}var hs=null,ps=null;function Gh(k){_f(k,0)}function no(k){var D=$r(k);if(yl(D))return k}function Ll(k,D){if(k==="change")return D}var jl=!1;if(An){var wa;if(An){var Ea="oninput"in document;if(!Ea){var Fl=document.createElement("div");Fl.setAttribute("oninput","return;"),Ea=typeof Fl.oninput=="function"}wa=Ea}else wa=!1;jl=wa&&(!document.documentMode||9<document.documentMode)}function Ul(){hs&&(hs.detachEvent("onpropertychange",ql),ps=hs=null)}function ql(k){if(k.propertyName==="value"&&no(ps)){var D=[];Dl(D,ps,k,fa(k)),Sl(Gh,D)}}function Wh(k,D,H){k==="focusin"?(Ul(),hs=D,ps=H,hs.attachEvent("onpropertychange",ql)):k==="focusout"&&Ul()}function Yh(k){if(k==="selectionchange"||k==="keyup"||k==="keydown")return no(ps)}function Zh(k,D){if(k==="click")return no(D)}function Xh(k,D){if(k==="input"||k==="change")return no(D)}function Jh(k,D){return k===D&&(k!==0||1/k===1/D)||k!==k&&D!==D}var Wr=typeof Object.is=="function"?Object.is:Jh;function ms(k,D){if(Wr(k,D))return!0;if(typeof k!="object"||k===null||typeof D!="object"||D===null)return!1;var H=Object.keys(k),ce=Object.keys(D);if(H.length!==ce.length)return!1;for(ce=0;ce<H.length;ce++){var me=H[ce];if(!ze.call(D,me)||!Wr(k[me],D[me]))return!1}return!0}function Hl(k){for(;k&&k.firstChild;)k=k.firstChild;return k}function zl(k,D){var H=Hl(k);k=0;for(var ce;H;){if(H.nodeType===3){if(ce=k+H.textContent.length,k<=D&&ce>=D)return{node:H,offset:D-k};k=ce}e:{for(;H;){if(H.nextSibling){H=H.nextSibling;break e}H=H.parentNode}H=void 0}H=Hl(H)}}function Kl(k,D){return k&&D?k===D?!0:k&&k.nodeType===3?!1:D&&D.nodeType===3?Kl(k,D.parentNode):"contains"in k?k.contains(D):k.compareDocumentPosition?!!(k.compareDocumentPosition(D)&16):!1:!1}function Vl(k){k=k!=null&&k.ownerDocument!=null&&k.ownerDocument.defaultView!=null?k.ownerDocument.defaultView:window;for(var D=Zs(k.document);D instanceof k.HTMLIFrameElement;){try{var H=typeof D.contentWindow.location.href=="string"}catch{H=!1}if(H)k=D.contentWindow;else break;D=Zs(k.document)}return D}function Sa(k){var D=k&&k.nodeName&&k.nodeName.toLowerCase();return D&&(D==="input"&&(k.type==="text"||k.type==="search"||k.type==="tel"||k.type==="url"||k.type==="password")||D==="textarea"||k.contentEditable==="true")}var Qh=An&&"documentMode"in document&&11>=document.documentMode,Pi=null,Aa=null,gs=null,Ca=!1;function Gl(k,D,H){var ce=H.window===H?H.document:H.nodeType===9?H:H.ownerDocument;Ca||Pi==null||Pi!==Zs(ce)||(ce=Pi,"selectionStart"in ce&&Sa(ce)?ce={start:ce.selectionStart,end:ce.selectionEnd}:(ce=(ce.ownerDocument&&ce.ownerDocument.defaultView||window).getSelection(),ce={anchorNode:ce.anchorNode,anchorOffset:ce.anchorOffset,focusNode:ce.focusNode,focusOffset:ce.focusOffset}),gs&&ms(gs,ce)||(gs=ce,ce=Vo(Aa,"onSelect"),0<ce.length&&(D=new to("onSelect","select",null,D,H),k.push({event:D,listeners:ce}),D.target=Pi)))}function fi(k,D){var H={};return H[k.toLowerCase()]=D.toLowerCase(),H["Webkit"+k]="webkit"+D,H["Moz"+k]="moz"+D,H}var Ni={animationend:fi("Animation","AnimationEnd"),animationiteration:fi("Animation","AnimationIteration"),animationstart:fi("Animation","AnimationStart"),transitionrun:fi("Transition","TransitionRun"),transitionstart:fi("Transition","TransitionStart"),transitioncancel:fi("Transition","TransitionCancel"),transitionend:fi("Transition","TransitionEnd")},$a={},Wl={};An&&(Wl=document.createElement("div").style,"AnimationEvent"in window||(delete Ni.animationend.animation,delete Ni.animationiteration.animation,delete Ni.animationstart.animation),"TransitionEvent"in window||delete Ni.transitionend.transition);function hi(k){if($a[k])return $a[k];if(!Ni[k])return k;var D=Ni[k],H;for(H in D)if(D.hasOwnProperty(H)&&H in Wl)return $a[k]=D[H];return k}var Yl=hi("animationend"),Zl=hi("animationiteration"),Xl=hi("animationstart"),e0=hi("transitionrun"),t0=hi("transitionstart"),r0=hi("transitioncancel"),Jl=hi("transitionend"),Ql=new Map,Ra="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ra.push("scrollEnd");function mn(k,D){Ql.set(k,D),br(D,[k])}var io=typeof reportError=="function"?reportError:function(k){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var D=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof k=="object"&&k!==null&&typeof k.message=="string"?String(k.message):String(k),error:k});if(!window.dispatchEvent(D))return}else if(typeof process$1=="object"&&typeof process$1.emit=="function"){process$1.emit("uncaughtException",k);return}console.error(k)},an=[],Mi=0,Ta=0;function so(){for(var k=Mi,D=Ta=Mi=0;D<k;){var H=an[D];an[D++]=null;var ce=an[D];an[D++]=null;var me=an[D];an[D++]=null;var xe=an[D];if(an[D++]=null,ce!==null&&me!==null){var Ne=ce.pending;Ne===null?me.next=me:(me.next=Ne.next,Ne.next=me),ce.pending=me}xe!==0&&eu(H,me,xe)}}function oo(k,D,H,ce){an[Mi++]=k,an[Mi++]=D,an[Mi++]=H,an[Mi++]=ce,Ta|=ce,k.lanes|=ce,k=k.alternate,k!==null&&(k.lanes|=ce)}function ka(k,D,H,ce){return oo(k,D,H,ce),ao(k)}function pi(k,D){return oo(k,null,null,D),ao(k)}function eu(k,D,H){k.lanes|=H;var ce=k.alternate;ce!==null&&(ce.lanes|=H);for(var me=!1,xe=k.return;xe!==null;)xe.childLanes|=H,ce=xe.alternate,ce!==null&&(ce.childLanes|=H),xe.tag===22&&(k=xe.stateNode,k===null||k._visibility&1||(me=!0)),k=xe,xe=xe.return;return k.tag===3?(xe=k.stateNode,me&&D!==null&&(me=31-Ve(H),k=xe.hiddenUpdates,ce=k[me],ce===null?k[me]=[D]:ce.push(D),D.lane=H|536870912),xe):null}function ao(k){if(50<js)throw js=0,Fc=null,Error(v(185));for(var D=k.return;D!==null;)k=D,D=k.return;return k.tag===3?k.stateNode:null}var Oi={};function n0(k,D,H,ce){this.tag=k,this.key=H,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=D,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=ce,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yr(k,D,H,ce){return new n0(k,D,H,ce)}function Ia(k){return k=k.prototype,!(!k||!k.isReactComponent)}function Cn(k,D){var H=k.alternate;return H===null?(H=Yr(k.tag,D,k.key,k.mode),H.elementType=k.elementType,H.type=k.type,H.stateNode=k.stateNode,H.alternate=k,k.alternate=H):(H.pendingProps=D,H.type=k.type,H.flags=0,H.subtreeFlags=0,H.deletions=null),H.flags=k.flags&65011712,H.childLanes=k.childLanes,H.lanes=k.lanes,H.child=k.child,H.memoizedProps=k.memoizedProps,H.memoizedState=k.memoizedState,H.updateQueue=k.updateQueue,D=k.dependencies,H.dependencies=D===null?null:{lanes:D.lanes,firstContext:D.firstContext},H.sibling=k.sibling,H.index=k.index,H.ref=k.ref,H.refCleanup=k.refCleanup,H}function tu(k,D){k.flags&=65011714;var H=k.alternate;return H===null?(k.childLanes=0,k.lanes=D,k.child=null,k.subtreeFlags=0,k.memoizedProps=null,k.memoizedState=null,k.updateQueue=null,k.dependencies=null,k.stateNode=null):(k.childLanes=H.childLanes,k.lanes=H.lanes,k.child=H.child,k.subtreeFlags=0,k.deletions=null,k.memoizedProps=H.memoizedProps,k.memoizedState=H.memoizedState,k.updateQueue=H.updateQueue,k.type=H.type,D=H.dependencies,k.dependencies=D===null?null:{lanes:D.lanes,firstContext:D.firstContext}),k}function co(k,D,H,ce,me,xe){var Ne=0;if(ce=k,typeof k=="function")Ia(k)&&(Ne=1);else if(typeof k=="string")Ne=cp(k,H,_e.current)?26:k==="html"||k==="head"||k==="body"?27:5;else e:switch(k){case pe:return k=Yr(31,H,D,me),k.elementType=pe,k.lanes=xe,k;case U:return mi(H.children,me,xe,D);case q:Ne=8,me|=24;break;case J:return k=Yr(12,H,D,me|2),k.elementType=J,k.lanes=xe,k;case de:return k=Yr(13,H,D,me),k.elementType=de,k.lanes=xe,k;case fe:return k=Yr(19,H,D,me),k.elementType=fe,k.lanes=xe,k;default:if(typeof k=="object"&&k!==null)switch(k.$$typeof){case oe:Ne=10;break e;case ie:Ne=9;break e;case le:Ne=11;break e;case ye:Ne=14;break e;case we:Ne=16,ce=null;break e}Ne=29,H=Error(v(130,k===null?"null":typeof k,"")),ce=null}return D=Yr(Ne,H,D,me),D.elementType=k,D.type=ce,D.lanes=xe,D}function mi(k,D,H,ce){return k=Yr(7,k,ce,D),k.lanes=H,k}function Pa(k,D,H){return k=Yr(6,k,null,D),k.lanes=H,k}function ru(k){var D=Yr(18,null,null,0);return D.stateNode=k,D}function Na(k,D,H){return D=Yr(4,k.children!==null?k.children:[],k.key,D),D.lanes=H,D.stateNode={containerInfo:k.containerInfo,pendingChildren:null,implementation:k.implementation},D}var nu=new WeakMap;function cn(k,D){if(typeof k=="object"&&k!==null){var H=nu.get(k);return H!==void 0?H:(D={value:k,source:D,stack:Xe(D)},nu.set(k,D),D)}return{value:k,source:D,stack:Xe(D)}}var Di=[],Bi=0,lo=null,ys=0,ln=[],un=0,Hn=null,vn=1,xn="";function $n(k,D){Di[Bi++]=ys,Di[Bi++]=lo,lo=k,ys=D}function iu(k,D,H){ln[un++]=vn,ln[un++]=xn,ln[un++]=Hn,Hn=k;var ce=vn;k=xn;var me=32-Ve(ce)-1;ce&=~(1<<me),H+=1;var xe=32-Ve(D)+me;if(30<xe){var Ne=me-me%5;xe=(ce&(1<<Ne)-1).toString(32),ce>>=Ne,me-=Ne,vn=1<<32-Ve(D)+me|H<<me|ce,xn=xe+k}else vn=1<<xe|H<<me|ce,xn=k}function Ma(k){k.return!==null&&($n(k,1),iu(k,1,0))}function Oa(k){for(;k===lo;)lo=Di[--Bi],Di[Bi]=null,ys=Di[--Bi],Di[Bi]=null;for(;k===Hn;)Hn=ln[--un],ln[un]=null,xn=ln[--un],ln[un]=null,vn=ln[--un],ln[un]=null}function su(k,D){ln[un++]=vn,ln[un++]=xn,ln[un++]=Hn,vn=D.id,xn=D.overflow,Hn=k}var Rr=null,sr=null,Gt=!1,zn=null,dn=!1,Da=Error(v(519));function Kn(k){var D=Error(v(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw vs(cn(D,k)),Da}function ou(k){var D=k.stateNode,H=k.type,ce=k.memoizedProps;switch(D[Tt]=k,D[It]=ce,H){case"dialog":zt("cancel",D),zt("close",D);break;case"iframe":case"object":case"embed":zt("load",D);break;case"video":case"audio":for(H=0;H<Us.length;H++)zt(Us[H],D);break;case"source":zt("error",D);break;case"img":case"image":case"link":zt("error",D),zt("load",D);break;case"details":zt("toggle",D);break;case"input":zt("invalid",D),vl(D,ce.value,ce.defaultValue,ce.checked,ce.defaultChecked,ce.type,ce.name,!0);break;case"select":zt("invalid",D);break;case"textarea":zt("invalid",D),xl(D,ce.value,ce.defaultValue,ce.children)}H=ce.children,typeof H!="string"&&typeof H!="number"&&typeof H!="bigint"||D.textContent===""+H||ce.suppressHydrationWarning===!0||$f(D.textContent,H)?(ce.popover!=null&&(zt("beforetoggle",D),zt("toggle",D)),ce.onScroll!=null&&zt("scroll",D),ce.onScrollEnd!=null&&zt("scrollend",D),ce.onClick!=null&&(D.onclick=Sn),D=!0):D=!1,D||Kn(k,!0)}function au(k){for(Rr=k.return;Rr;)switch(Rr.tag){case 5:case 31:case 13:dn=!1;return;case 27:case 3:dn=!0;return;default:Rr=Rr.return}}function Li(k){if(k!==Rr)return!1;if(!Gt)return au(k),Gt=!0,!1;var D=k.tag,H;if((H=D!==3&&D!==27)&&((H=D===5)&&(H=k.type,H=!(H!=="form"&&H!=="button")||tl(k.type,k.memoizedProps)),H=!H),H&&sr&&Kn(k),au(k),D===13){if(k=k.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(v(317));sr=Df(k)}else if(D===31){if(k=k.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(v(317));sr=Df(k)}else D===27?(D=sr,si(k.type)?(k=ol,ol=null,sr=k):sr=D):sr=Rr?hn(k.stateNode.nextSibling):null;return!0}function gi(){sr=Rr=null,Gt=!1}function Ba(){var k=zn;return k!==null&&(Hr===null?Hr=k:Hr.push.apply(Hr,k),zn=null),k}function vs(k){zn===null?zn=[k]:zn.push(k)}var La=ee(null),yi=null,Rn=null;function Vn(k,D,H){ue(La,D._currentValue),D._currentValue=H}function Tn(k){k._currentValue=La.current,Z(La)}function ja(k,D,H){for(;k!==null;){var ce=k.alternate;if((k.childLanes&D)!==D?(k.childLanes|=D,ce!==null&&(ce.childLanes|=D)):ce!==null&&(ce.childLanes&D)!==D&&(ce.childLanes|=D),k===H)break;k=k.return}}function Fa(k,D,H,ce){var me=k.child;for(me!==null&&(me.return=k);me!==null;){var xe=me.dependencies;if(xe!==null){var Ne=me.child;xe=xe.firstContext;e:for(;xe!==null;){var Fe=xe;xe=me;for(var Ye=0;Ye<D.length;Ye++)if(Fe.context===D[Ye]){xe.lanes|=H,Fe=xe.alternate,Fe!==null&&(Fe.lanes|=H),ja(xe.return,H,k),ce||(Ne=null);break e}xe=Fe.next}}else if(me.tag===18){if(Ne=me.return,Ne===null)throw Error(v(341));Ne.lanes|=H,xe=Ne.alternate,xe!==null&&(xe.lanes|=H),ja(Ne,H,k),Ne=null}else Ne=me.child;if(Ne!==null)Ne.return=me;else for(Ne=me;Ne!==null;){if(Ne===k){Ne=null;break}if(me=Ne.sibling,me!==null){me.return=Ne.return,Ne=me;break}Ne=Ne.return}me=Ne}}function ji(k,D,H,ce){k=null;for(var me=D,xe=!1;me!==null;){if(!xe){if((me.flags&524288)!==0)xe=!0;else if((me.flags&262144)!==0)break}if(me.tag===10){var Ne=me.alternate;if(Ne===null)throw Error(v(387));if(Ne=Ne.memoizedProps,Ne!==null){var Fe=me.type;Wr(me.pendingProps.value,Ne.value)||(k!==null?k.push(Fe):k=[Fe])}}else if(me===ge.current){if(Ne=me.alternate,Ne===null)throw Error(v(387));Ne.memoizedState.memoizedState!==me.memoizedState.memoizedState&&(k!==null?k.push(Vs):k=[Vs])}me=me.return}k!==null&&Fa(D,k,H,ce),D.flags|=262144}function uo(k){for(k=k.firstContext;k!==null;){if(!Wr(k.context._currentValue,k.memoizedValue))return!0;k=k.next}return!1}function vi(k){yi=k,Rn=null,k=k.dependencies,k!==null&&(k.firstContext=null)}function Tr(k){return cu(yi,k)}function fo(k,D){return yi===null&&vi(k),cu(k,D)}function cu(k,D){var H=D._currentValue;if(D={context:D,memoizedValue:H,next:null},Rn===null){if(k===null)throw Error(v(308));Rn=D,k.dependencies={lanes:0,firstContext:D},k.flags|=524288}else Rn=Rn.next=D;return H}var i0=typeof AbortController<"u"?AbortController:function(){var k=[],D=this.signal={aborted:!1,addEventListener:function(H,ce){k.push(ce)}};this.abort=function(){D.aborted=!0,k.forEach(function(H){return H()})}},s0=y.unstable_scheduleCallback,o0=y.unstable_NormalPriority,pr={$$typeof:oe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ua(){return{controller:new i0,data:new Map,refCount:0}}function bs(k){k.refCount--,k.refCount===0&&s0(o0,function(){k.controller.abort()})}var xs=null,qa=0,Fi=0,Ui=null;function a0(k,D){if(xs===null){var H=xs=[];qa=0,Fi=Vc(),Ui={status:"pending",value:void 0,then:function(ce){H.push(ce)}}}return qa++,D.then(lu,lu),D}function lu(){if(--qa===0&&xs!==null){Ui!==null&&(Ui.status="fulfilled");var k=xs;xs=null,Fi=0,Ui=null;for(var D=0;D<k.length;D++)(0,k[D])()}}function c0(k,D){var H=[],ce={status:"pending",value:null,reason:null,then:function(me){H.push(me)}};return k.then(function(){ce.status="fulfilled",ce.value=D;for(var me=0;me<H.length;me++)(0,H[me])(D)},function(me){for(ce.status="rejected",ce.reason=me,me=0;me<H.length;me++)(0,H[me])(void 0)}),ce}var uu=re.S;re.S=function(k,D){Zd=ot(),typeof D=="object"&&D!==null&&typeof D.then=="function"&&a0(k,D),uu!==null&&uu(k,D)};var bi=ee(null);function Ha(){var k=bi.current;return k!==null?k:ir.pooledCache}function ho(k,D){D===null?ue(bi,bi.current):ue(bi,D.pool)}function du(){var k=Ha();return k===null?null:{parent:pr._currentValue,pool:k}}var qi=Error(v(460)),za=Error(v(474)),po=Error(v(542)),mo={then:function(){}};function fu(k){return k=k.status,k==="fulfilled"||k==="rejected"}function hu(k,D,H){switch(H=k[H],H===void 0?k.push(D):H!==D&&(D.then(Sn,Sn),D=H),D.status){case"fulfilled":return D.value;case"rejected":throw k=D.reason,mu(k),k;default:if(typeof D.status=="string")D.then(Sn,Sn);else{if(k=ir,k!==null&&100<k.shellSuspendCounter)throw Error(v(482));k=D,k.status="pending",k.then(function(ce){if(D.status==="pending"){var me=D;me.status="fulfilled",me.value=ce}},function(ce){if(D.status==="pending"){var me=D;me.status="rejected",me.reason=ce}})}switch(D.status){case"fulfilled":return D.value;case"rejected":throw k=D.reason,mu(k),k}throw wi=D,qi}}function xi(k){try{var D=k._init;return D(k._payload)}catch(H){throw H!==null&&typeof H=="object"&&typeof H.then=="function"?(wi=H,qi):H}}var wi=null;function pu(){if(wi===null)throw Error(v(459));var k=wi;return wi=null,k}function mu(k){if(k===qi||k===po)throw Error(v(483))}var Hi=null,Es=0;function go(k){var D=Es;return Es+=1,Hi===null&&(Hi=[]),hu(Hi,k,D)}function _s(k,D){D=D.props.ref,k.ref=D!==void 0?D:null}function yo(k,D){throw D.$$typeof===O?Error(v(525)):(k=Object.prototype.toString.call(D),Error(v(31,k==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":k)))}function gu(k){function D(rt,Je){if(k){var it=rt.deletions;it===null?(rt.deletions=[Je],rt.flags|=16):it.push(Je)}}function H(rt,Je){if(!k)return null;for(;Je!==null;)D(rt,Je),Je=Je.sibling;return null}function ce(rt){for(var Je=new Map;rt!==null;)rt.key!==null?Je.set(rt.key,rt):Je.set(rt.index,rt),rt=rt.sibling;return Je}function me(rt,Je){return rt=Cn(rt,Je),rt.index=0,rt.sibling=null,rt}function xe(rt,Je,it){return rt.index=it,k?(it=rt.alternate,it!==null?(it=it.index,it<Je?(rt.flags|=67108866,Je):it):(rt.flags|=67108866,Je)):(rt.flags|=1048576,Je)}function Ne(rt){return k&&rt.alternate===null&&(rt.flags|=67108866),rt}function Fe(rt,Je,it,wt){return Je===null||Je.tag!==6?(Je=Pa(it,rt.mode,wt),Je.return=rt,Je):(Je=me(Je,it),Je.return=rt,Je)}function Ye(rt,Je,it,wt){var Bt=it.type;return Bt===U?yt(rt,Je,it.props.children,wt,it.key):Je!==null&&(Je.elementType===Bt||typeof Bt=="object"&&Bt!==null&&Bt.$$typeof===we&&xi(Bt)===Je.type)?(Je=me(Je,it.props),_s(Je,it),Je.return=rt,Je):(Je=co(it.type,it.key,it.props,null,rt.mode,wt),_s(Je,it),Je.return=rt,Je)}function st(rt,Je,it,wt){return Je===null||Je.tag!==4||Je.stateNode.containerInfo!==it.containerInfo||Je.stateNode.implementation!==it.implementation?(Je=Na(it,rt.mode,wt),Je.return=rt,Je):(Je=me(Je,it.children||[]),Je.return=rt,Je)}function yt(rt,Je,it,wt,Bt){return Je===null||Je.tag!==7?(Je=mi(it,rt.mode,wt,Bt),Je.return=rt,Je):(Je=me(Je,it),Je.return=rt,Je)}function Et(rt,Je,it){if(typeof Je=="string"&&Je!==""||typeof Je=="number"||typeof Je=="bigint")return Je=Pa(""+Je,rt.mode,it),Je.return=rt,Je;if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case B:return it=co(Je.type,Je.key,Je.props,null,rt.mode,it),_s(it,Je),it.return=rt,it;case F:return Je=Na(Je,rt.mode,it),Je.return=rt,Je;case we:return Je=xi(Je),Et(rt,Je,it)}if(z(Je)||ae(Je))return Je=mi(Je,rt.mode,it,null),Je.return=rt,Je;if(typeof Je.then=="function")return Et(rt,go(Je),it);if(Je.$$typeof===oe)return Et(rt,fo(rt,Je),it);yo(rt,Je)}return null}function ct(rt,Je,it,wt){var Bt=Je!==null?Je.key:null;if(typeof it=="string"&&it!==""||typeof it=="number"||typeof it=="bigint")return Bt!==null?null:Fe(rt,Je,""+it,wt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case B:return it.key===Bt?Ye(rt,Je,it,wt):null;case F:return it.key===Bt?st(rt,Je,it,wt):null;case we:return it=xi(it),ct(rt,Je,it,wt)}if(z(it)||ae(it))return Bt!==null?null:yt(rt,Je,it,wt,null);if(typeof it.then=="function")return ct(rt,Je,go(it),wt);if(it.$$typeof===oe)return ct(rt,Je,fo(rt,it),wt);yo(rt,it)}return null}function pt(rt,Je,it,wt,Bt){if(typeof wt=="string"&&wt!==""||typeof wt=="number"||typeof wt=="bigint")return rt=rt.get(it)||null,Fe(Je,rt,""+wt,Bt);if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case B:return rt=rt.get(wt.key===null?it:wt.key)||null,Ye(Je,rt,wt,Bt);case F:return rt=rt.get(wt.key===null?it:wt.key)||null,st(Je,rt,wt,Bt);case we:return wt=xi(wt),pt(rt,Je,it,wt,Bt)}if(z(wt)||ae(wt))return rt=rt.get(it)||null,yt(Je,rt,wt,Bt,null);if(typeof wt.then=="function")return pt(rt,Je,it,go(wt),Bt);if(wt.$$typeof===oe)return pt(rt,Je,it,fo(Je,wt),Bt);yo(Je,wt)}return null}function Mt(rt,Je,it,wt){for(var Bt=null,Yt=null,Ot=Je,qt=Je=0,Vt=null;Ot!==null&&qt<it.length;qt++){Ot.index>qt?(Vt=Ot,Ot=null):Vt=Ot.sibling;var Zt=ct(rt,Ot,it[qt],wt);if(Zt===null){Ot===null&&(Ot=Vt);break}k&&Ot&&Zt.alternate===null&&D(rt,Ot),Je=xe(Zt,Je,qt),Yt===null?Bt=Zt:Yt.sibling=Zt,Yt=Zt,Ot=Vt}if(qt===it.length)return H(rt,Ot),Gt&&$n(rt,qt),Bt;if(Ot===null){for(;qt<it.length;qt++)Ot=Et(rt,it[qt],wt),Ot!==null&&(Je=xe(Ot,Je,qt),Yt===null?Bt=Ot:Yt.sibling=Ot,Yt=Ot);return Gt&&$n(rt,qt),Bt}for(Ot=ce(Ot);qt<it.length;qt++)Vt=pt(Ot,rt,qt,it[qt],wt),Vt!==null&&(k&&Vt.alternate!==null&&Ot.delete(Vt.key===null?qt:Vt.key),Je=xe(Vt,Je,qt),Yt===null?Bt=Vt:Yt.sibling=Vt,Yt=Vt);return k&&Ot.forEach(function(ui){return D(rt,ui)}),Gt&&$n(rt,qt),Bt}function Lt(rt,Je,it,wt){if(it==null)throw Error(v(151));for(var Bt=null,Yt=null,Ot=Je,qt=Je=0,Vt=null,Zt=it.next();Ot!==null&&!Zt.done;qt++,Zt=it.next()){Ot.index>qt?(Vt=Ot,Ot=null):Vt=Ot.sibling;var ui=ct(rt,Ot,Zt.value,wt);if(ui===null){Ot===null&&(Ot=Vt);break}k&&Ot&&ui.alternate===null&&D(rt,Ot),Je=xe(ui,Je,qt),Yt===null?Bt=ui:Yt.sibling=ui,Yt=ui,Ot=Vt}if(Zt.done)return H(rt,Ot),Gt&&$n(rt,qt),Bt;if(Ot===null){for(;!Zt.done;qt++,Zt=it.next())Zt=Et(rt,Zt.value,wt),Zt!==null&&(Je=xe(Zt,Je,qt),Yt===null?Bt=Zt:Yt.sibling=Zt,Yt=Zt);return Gt&&$n(rt,qt),Bt}for(Ot=ce(Ot);!Zt.done;qt++,Zt=it.next())Zt=pt(Ot,rt,qt,Zt.value,wt),Zt!==null&&(k&&Zt.alternate!==null&&Ot.delete(Zt.key===null?qt:Zt.key),Je=xe(Zt,Je,qt),Yt===null?Bt=Zt:Yt.sibling=Zt,Yt=Zt);return k&&Ot.forEach(function(bp){return D(rt,bp)}),Gt&&$n(rt,qt),Bt}function nr(rt,Je,it,wt){if(typeof it=="object"&&it!==null&&it.type===U&&it.key===null&&(it=it.props.children),typeof it=="object"&&it!==null){switch(it.$$typeof){case B:e:{for(var Bt=it.key;Je!==null;){if(Je.key===Bt){if(Bt=it.type,Bt===U){if(Je.tag===7){H(rt,Je.sibling),wt=me(Je,it.props.children),wt.return=rt,rt=wt;break e}}else if(Je.elementType===Bt||typeof Bt=="object"&&Bt!==null&&Bt.$$typeof===we&&xi(Bt)===Je.type){H(rt,Je.sibling),wt=me(Je,it.props),_s(wt,it),wt.return=rt,rt=wt;break e}H(rt,Je);break}else D(rt,Je);Je=Je.sibling}it.type===U?(wt=mi(it.props.children,rt.mode,wt,it.key),wt.return=rt,rt=wt):(wt=co(it.type,it.key,it.props,null,rt.mode,wt),_s(wt,it),wt.return=rt,rt=wt)}return Ne(rt);case F:e:{for(Bt=it.key;Je!==null;){if(Je.key===Bt)if(Je.tag===4&&Je.stateNode.containerInfo===it.containerInfo&&Je.stateNode.implementation===it.implementation){H(rt,Je.sibling),wt=me(Je,it.children||[]),wt.return=rt,rt=wt;break e}else{H(rt,Je);break}else D(rt,Je);Je=Je.sibling}wt=Na(it,rt.mode,wt),wt.return=rt,rt=wt}return Ne(rt);case we:return it=xi(it),nr(rt,Je,it,wt)}if(z(it))return Mt(rt,Je,it,wt);if(ae(it)){if(Bt=ae(it),typeof Bt!="function")throw Error(v(150));return it=Bt.call(it),Lt(rt,Je,it,wt)}if(typeof it.then=="function")return nr(rt,Je,go(it),wt);if(it.$$typeof===oe)return nr(rt,Je,fo(rt,it),wt);yo(rt,it)}return typeof it=="string"&&it!==""||typeof it=="number"||typeof it=="bigint"?(it=""+it,Je!==null&&Je.tag===6?(H(rt,Je.sibling),wt=me(Je,it),wt.return=rt,rt=wt):(H(rt,Je),wt=Pa(it,rt.mode,wt),wt.return=rt,rt=wt),Ne(rt)):H(rt,Je)}return function(rt,Je,it,wt){try{Es=0;var Bt=nr(rt,Je,it,wt);return Hi=null,Bt}catch(Ot){if(Ot===qi||Ot===po)throw Ot;var Yt=Yr(29,Ot,null,rt.mode);return Yt.lanes=wt,Yt.return=rt,Yt}finally{}}}var Ei=gu(!0),yu=gu(!1),Gn=!1;function Ka(k){k.updateQueue={baseState:k.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Va(k,D){k=k.updateQueue,D.updateQueue===k&&(D.updateQueue={baseState:k.baseState,firstBaseUpdate:k.firstBaseUpdate,lastBaseUpdate:k.lastBaseUpdate,shared:k.shared,callbacks:null})}function Wn(k){return{lane:k,tag:0,payload:null,callback:null,next:null}}function Yn(k,D,H){var ce=k.updateQueue;if(ce===null)return null;if(ce=ce.shared,(Xt&2)!==0){var me=ce.pending;return me===null?D.next=D:(D.next=me.next,me.next=D),ce.pending=D,D=ao(k),eu(k,null,H),D}return oo(k,ce,D,H),ao(k)}function Ss(k,D,H){if(D=D.updateQueue,D!==null&&(D=D.shared,(H&4194048)!==0)){var ce=D.lanes;ce&=k.pendingLanes,H|=ce,D.lanes=H,We(k,H)}}function Ga(k,D){var H=k.updateQueue,ce=k.alternate;if(ce!==null&&(ce=ce.updateQueue,H===ce)){var me=null,xe=null;if(H=H.firstBaseUpdate,H!==null){do{var Ne={lane:H.lane,tag:H.tag,payload:H.payload,callback:null,next:null};xe===null?me=xe=Ne:xe=xe.next=Ne,H=H.next}while(H!==null);xe===null?me=xe=D:xe=xe.next=D}else me=xe=D;H={baseState:ce.baseState,firstBaseUpdate:me,lastBaseUpdate:xe,shared:ce.shared,callbacks:ce.callbacks},k.updateQueue=H;return}k=H.lastBaseUpdate,k===null?H.firstBaseUpdate=D:k.next=D,H.lastBaseUpdate=D}var Wa=!1;function As(){if(Wa){var k=Ui;if(k!==null)throw k}}function Cs(k,D,H,ce){Wa=!1;var me=k.updateQueue;Gn=!1;var xe=me.firstBaseUpdate,Ne=me.lastBaseUpdate,Fe=me.shared.pending;if(Fe!==null){me.shared.pending=null;var Ye=Fe,st=Ye.next;Ye.next=null,Ne===null?xe=st:Ne.next=st,Ne=Ye;var yt=k.alternate;yt!==null&&(yt=yt.updateQueue,Fe=yt.lastBaseUpdate,Fe!==Ne&&(Fe===null?yt.firstBaseUpdate=st:Fe.next=st,yt.lastBaseUpdate=Ye))}if(xe!==null){var Et=me.baseState;Ne=0,yt=st=Ye=null,Fe=xe;do{var ct=Fe.lane&-536870913,pt=ct!==Fe.lane;if(pt?(Kt&ct)===ct:(ce&ct)===ct){ct!==0&&ct===Fi&&(Wa=!0),yt!==null&&(yt=yt.next={lane:0,tag:Fe.tag,payload:Fe.payload,callback:null,next:null});e:{var Mt=k,Lt=Fe;ct=D;var nr=H;switch(Lt.tag){case 1:if(Mt=Lt.payload,typeof Mt=="function"){Et=Mt.call(nr,Et,ct);break e}Et=Mt;break e;case 3:Mt.flags=Mt.flags&-65537|128;case 0:if(Mt=Lt.payload,ct=typeof Mt=="function"?Mt.call(nr,Et,ct):Mt,ct==null)break e;Et=T({},Et,ct);break e;case 2:Gn=!0}}ct=Fe.callback,ct!==null&&(k.flags|=64,pt&&(k.flags|=8192),pt=me.callbacks,pt===null?me.callbacks=[ct]:pt.push(ct))}else pt={lane:ct,tag:Fe.tag,payload:Fe.payload,callback:Fe.callback,next:null},yt===null?(st=yt=pt,Ye=Et):yt=yt.next=pt,Ne|=ct;if(Fe=Fe.next,Fe===null){if(Fe=me.shared.pending,Fe===null)break;pt=Fe,Fe=pt.next,pt.next=null,me.lastBaseUpdate=pt,me.shared.pending=null}}while(!0);yt===null&&(Ye=Et),me.baseState=Ye,me.firstBaseUpdate=st,me.lastBaseUpdate=yt,xe===null&&(me.shared.lanes=0),ei|=Ne,k.lanes=Ne,k.memoizedState=Et}}function vu(k,D){if(typeof k!="function")throw Error(v(191,k));k.call(D)}function bu(k,D){var H=k.callbacks;if(H!==null)for(k.callbacks=null,k=0;k<H.length;k++)vu(H[k],D)}var zi=ee(null),vo=ee(0);function xu(k,D){k=Ln,ue(vo,k),ue(zi,D),Ln=k|D.baseLanes}function Ya(){ue(vo,Ln),ue(zi,zi.current)}function Za(){Ln=vo.current,Z(zi),Z(vo)}var Zr=ee(null),fn=null;function Zn(k){var D=k.alternate;ue(fr,fr.current&1),ue(Zr,k),fn===null&&(D===null||zi.current!==null||D.memoizedState!==null)&&(fn=k)}function Xa(k){ue(fr,fr.current),ue(Zr,k),fn===null&&(fn=k)}function wu(k){k.tag===22?(ue(fr,fr.current),ue(Zr,k),fn===null&&(fn=k)):Xn()}function Xn(){ue(fr,fr.current),ue(Zr,Zr.current)}function Xr(k){Z(Zr),fn===k&&(fn=null),Z(fr)}var fr=ee(0);function bo(k){for(var D=k;D!==null;){if(D.tag===13){var H=D.memoizedState;if(H!==null&&(H=H.dehydrated,H===null||il(H)||sl(H)))return D}else if(D.tag===19&&(D.memoizedProps.revealOrder==="forwards"||D.memoizedProps.revealOrder==="backwards"||D.memoizedProps.revealOrder==="unstable_legacy-backwards"||D.memoizedProps.revealOrder==="together")){if((D.flags&128)!==0)return D}else if(D.child!==null){D.child.return=D,D=D.child;continue}if(D===k)break;for(;D.sibling===null;){if(D.return===null||D.return===k)return null;D=D.return}D.sibling.return=D.return,D=D.sibling}return null}var kn=0,Ut=null,tr=null,gr=null,xo=!1,Ki=!1,_i=!1,wo=0,$s=0,Vi=null,l0=0;function ur(){throw Error(v(321))}function Ja(k,D){if(D===null)return!1;for(var H=0;H<D.length&&H<k.length;H++)if(!Wr(k[H],D[H]))return!1;return!0}function Qa(k,D,H,ce,me,xe){return kn=xe,Ut=D,D.memoizedState=null,D.updateQueue=null,D.lanes=0,re.H=k===null||k.memoizedState===null?od:mc,_i=!1,xe=H(ce,me),_i=!1,Ki&&(xe=_u(D,H,ce,me)),Eu(k),xe}function Eu(k){re.H=ks;var D=tr!==null&&tr.next!==null;if(kn=0,gr=tr=Ut=null,xo=!1,$s=0,Vi=null,D)throw Error(v(300));k===null||yr||(k=k.dependencies,k!==null&&uo(k)&&(yr=!0))}function _u(k,D,H,ce){Ut=k;var me=0;do{if(Ki&&(Vi=null),$s=0,Ki=!1,25<=me)throw Error(v(301));if(me+=1,gr=tr=null,k.updateQueue!=null){var xe=k.updateQueue;xe.lastEffect=null,xe.events=null,xe.stores=null,xe.memoCache!=null&&(xe.memoCache.index=0)}re.H=ad,xe=D(H,ce)}while(Ki);return xe}function u0(){var k=re.H,D=k.useState()[0];return D=typeof D.then=="function"?Rs(D):D,k=k.useState()[0],(tr!==null?tr.memoizedState:null)!==k&&(Ut.flags|=1024),D}function tc(){var k=wo!==0;return wo=0,k}function rc(k,D,H){D.updateQueue=k.updateQueue,D.flags&=-2053,k.lanes&=~H}function nc(k){if(xo){for(k=k.memoizedState;k!==null;){var D=k.queue;D!==null&&(D.pending=null),k=k.next}xo=!1}kn=0,gr=tr=Ut=null,Ki=!1,$s=wo=0,Vi=null}function Nr(){var k={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gr===null?Ut.memoizedState=gr=k:gr=gr.next=k,gr}function hr(){if(tr===null){var k=Ut.alternate;k=k!==null?k.memoizedState:null}else k=tr.next;var D=gr===null?Ut.memoizedState:gr.next;if(D!==null)gr=D,tr=k;else{if(k===null)throw Ut.alternate===null?Error(v(467)):Error(v(310));tr=k,k={memoizedState:tr.memoizedState,baseState:tr.baseState,baseQueue:tr.baseQueue,queue:tr.queue,next:null},gr===null?Ut.memoizedState=gr=k:gr=gr.next=k}return gr}function Eo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Rs(k){var D=$s;return $s+=1,Vi===null&&(Vi=[]),k=hu(Vi,k,D),D=Ut,(gr===null?D.memoizedState:gr.next)===null&&(D=D.alternate,re.H=D===null||D.memoizedState===null?od:mc),k}function _o(k){if(k!==null&&typeof k=="object"){if(typeof k.then=="function")return Rs(k);if(k.$$typeof===oe)return Tr(k)}throw Error(v(438,String(k)))}function ic(k){var D=null,H=Ut.updateQueue;if(H!==null&&(D=H.memoCache),D==null){var ce=Ut.alternate;ce!==null&&(ce=ce.updateQueue,ce!==null&&(ce=ce.memoCache,ce!=null&&(D={data:ce.data.map(function(me){return me.slice()}),index:0})))}if(D==null&&(D={data:[],index:0}),H===null&&(H=Eo(),Ut.updateQueue=H),H.memoCache=D,H=D.data[D.index],H===void 0)for(H=D.data[D.index]=Array(k),ce=0;ce<k;ce++)H[ce]=ve;return D.index++,H}function In(k,D){return typeof D=="function"?D(k):D}function So(k){var D=hr();return sc(D,tr,k)}function sc(k,D,H){var ce=k.queue;if(ce===null)throw Error(v(311));ce.lastRenderedReducer=H;var me=k.baseQueue,xe=ce.pending;if(xe!==null){if(me!==null){var Ne=me.next;me.next=xe.next,xe.next=Ne}D.baseQueue=me=xe,ce.pending=null}if(xe=k.baseState,me===null)k.memoizedState=xe;else{D=me.next;var Fe=Ne=null,Ye=null,st=D,yt=!1;do{var Et=st.lane&-536870913;if(Et!==st.lane?(Kt&Et)===Et:(kn&Et)===Et){var ct=st.revertLane;if(ct===0)Ye!==null&&(Ye=Ye.next={lane:0,revertLane:0,gesture:null,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null}),Et===Fi&&(yt=!0);else if((kn&ct)===ct){st=st.next,ct===Fi&&(yt=!0);continue}else Et={lane:0,revertLane:st.revertLane,gesture:null,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null},Ye===null?(Fe=Ye=Et,Ne=xe):Ye=Ye.next=Et,Ut.lanes|=ct,ei|=ct;Et=st.action,_i&&H(xe,Et),xe=st.hasEagerState?st.eagerState:H(xe,Et)}else ct={lane:Et,revertLane:st.revertLane,gesture:st.gesture,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null},Ye===null?(Fe=Ye=ct,Ne=xe):Ye=Ye.next=ct,Ut.lanes|=Et,ei|=Et;st=st.next}while(st!==null&&st!==D);if(Ye===null?Ne=xe:Ye.next=Fe,!Wr(xe,k.memoizedState)&&(yr=!0,yt&&(H=Ui,H!==null)))throw H;k.memoizedState=xe,k.baseState=Ne,k.baseQueue=Ye,ce.lastRenderedState=xe}return me===null&&(ce.lanes=0),[k.memoizedState,ce.dispatch]}function oc(k){var D=hr(),H=D.queue;if(H===null)throw Error(v(311));H.lastRenderedReducer=k;var ce=H.dispatch,me=H.pending,xe=D.memoizedState;if(me!==null){H.pending=null;var Ne=me=me.next;do xe=k(xe,Ne.action),Ne=Ne.next;while(Ne!==me);Wr(xe,D.memoizedState)||(yr=!0),D.memoizedState=xe,D.baseQueue===null&&(D.baseState=xe),H.lastRenderedState=xe}return[xe,ce]}function Su(k,D,H){var ce=Ut,me=hr(),xe=Gt;if(xe){if(H===void 0)throw Error(v(407));H=H()}else H=D();var Ne=!Wr((tr||me).memoizedState,H);if(Ne&&(me.memoizedState=H,yr=!0),me=me.queue,lc($u.bind(null,ce,me,k),[k]),me.getSnapshot!==D||Ne||gr!==null&&gr.memoizedState.tag&1){if(ce.flags|=2048,Gi(9,{destroy:void 0},Cu.bind(null,ce,me,H,D),null),ir===null)throw Error(v(349));xe||(kn&127)!==0||Au(ce,D,H)}return H}function Au(k,D,H){k.flags|=16384,k={getSnapshot:D,value:H},D=Ut.updateQueue,D===null?(D=Eo(),Ut.updateQueue=D,D.stores=[k]):(H=D.stores,H===null?D.stores=[k]:H.push(k))}function Cu(k,D,H,ce){D.value=H,D.getSnapshot=ce,Ru(D)&&Tu(k)}function $u(k,D,H){return H(function(){Ru(D)&&Tu(k)})}function Ru(k){var D=k.getSnapshot;k=k.value;try{var H=D();return!Wr(k,H)}catch{return!0}}function Tu(k){var D=pi(k,2);D!==null&&zr(D,k,2)}function ac(k){var D=Nr();if(typeof k=="function"){var H=k;if(k=H(),_i){He(!0);try{H()}finally{He(!1)}}}return D.memoizedState=D.baseState=k,D.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:In,lastRenderedState:k},D}function ku(k,D,H,ce){return k.baseState=H,sc(k,tr,typeof ce=="function"?ce:In)}function d0(k,D,H,ce,me){if($o(k))throw Error(v(485));if(k=D.action,k!==null){var xe={payload:me,action:k,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Ne){xe.listeners.push(Ne)}};re.T!==null?H(!0):xe.isTransition=!1,ce(xe),H=D.pending,H===null?(xe.next=D.pending=xe,Iu(D,xe)):(xe.next=H.next,D.pending=H.next=xe)}}function Iu(k,D){var H=D.action,ce=D.payload,me=k.state;if(D.isTransition){var xe=re.T,Ne={};re.T=Ne;try{var Fe=H(me,ce),Ye=re.S;Ye!==null&&Ye(Ne,Fe),Pu(k,D,Fe)}catch(st){cc(k,D,st)}finally{xe!==null&&Ne.types!==null&&(xe.types=Ne.types),re.T=xe}}else try{xe=H(me,ce),Pu(k,D,xe)}catch(st){cc(k,D,st)}}function Pu(k,D,H){H!==null&&typeof H=="object"&&typeof H.then=="function"?H.then(function(ce){Nu(k,D,ce)},function(ce){return cc(k,D,ce)}):Nu(k,D,H)}function Nu(k,D,H){D.status="fulfilled",D.value=H,Mu(D),k.state=H,D=k.pending,D!==null&&(H=D.next,H===D?k.pending=null:(H=H.next,D.next=H,Iu(k,H)))}function cc(k,D,H){var ce=k.pending;if(k.pending=null,ce!==null){ce=ce.next;do D.status="rejected",D.reason=H,Mu(D),D=D.next;while(D!==ce)}k.action=null}function Mu(k){k=k.listeners;for(var D=0;D<k.length;D++)(0,k[D])()}function Ou(k,D){return D}function Du(k,D){if(Gt){var H=ir.formState;if(H!==null){e:{var ce=Ut;if(Gt){if(sr){t:{for(var me=sr,xe=dn;me.nodeType!==8;){if(!xe){me=null;break t}if(me=hn(me.nextSibling),me===null){me=null;break t}}xe=me.data,me=xe==="F!"||xe==="F"?me:null}if(me){sr=hn(me.nextSibling),ce=me.data==="F!";break e}}Kn(ce)}ce=!1}ce&&(D=H[0])}}return H=Nr(),H.memoizedState=H.baseState=D,ce={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ou,lastRenderedState:D},H.queue=ce,H=rd.bind(null,Ut,ce),ce.dispatch=H,ce=ac(!1),xe=pc.bind(null,Ut,!1,ce.queue),ce=Nr(),me={state:D,dispatch:null,action:k,pending:null},ce.queue=me,H=d0.bind(null,Ut,me,xe,H),me.dispatch=H,ce.memoizedState=k,[D,H,!1]}function Bu(k){var D=hr();return Lu(D,tr,k)}function Lu(k,D,H){if(D=sc(k,D,Ou)[0],k=So(In)[0],typeof D=="object"&&D!==null&&typeof D.then=="function")try{var ce=Rs(D)}catch(Ne){throw Ne===qi?po:Ne}else ce=D;D=hr();var me=D.queue,xe=me.dispatch;return H!==D.memoizedState&&(Ut.flags|=2048,Gi(9,{destroy:void 0},f0.bind(null,me,H),null)),[ce,xe,k]}function f0(k,D){k.action=D}function ju(k){var D=hr(),H=tr;if(H!==null)return Lu(D,H,k);hr(),D=D.memoizedState,H=hr();var ce=H.queue.dispatch;return H.memoizedState=k,[D,ce,!1]}function Gi(k,D,H,ce){return k={tag:k,create:H,deps:ce,inst:D,next:null},D=Ut.updateQueue,D===null&&(D=Eo(),Ut.updateQueue=D),H=D.lastEffect,H===null?D.lastEffect=k.next=k:(ce=H.next,H.next=k,k.next=ce,D.lastEffect=k),k}function Fu(){return hr().memoizedState}function Ao(k,D,H,ce){var me=Nr();Ut.flags|=k,me.memoizedState=Gi(1|D,{destroy:void 0},H,ce===void 0?null:ce)}function Co(k,D,H,ce){var me=hr();ce=ce===void 0?null:ce;var xe=me.memoizedState.inst;tr!==null&&ce!==null&&Ja(ce,tr.memoizedState.deps)?me.memoizedState=Gi(D,xe,H,ce):(Ut.flags|=k,me.memoizedState=Gi(1|D,xe,H,ce))}function Uu(k,D){Ao(8390656,8,k,D)}function lc(k,D){Co(2048,8,k,D)}function h0(k){Ut.flags|=4;var D=Ut.updateQueue;if(D===null)D=Eo(),Ut.updateQueue=D,D.events=[k];else{var H=D.events;H===null?D.events=[k]:H.push(k)}}function qu(k){var D=hr().memoizedState;return h0({ref:D,nextImpl:k}),function(){if((Xt&2)!==0)throw Error(v(440));return D.impl.apply(void 0,arguments)}}function Hu(k,D){return Co(4,2,k,D)}function zu(k,D){return Co(4,4,k,D)}function Ku(k,D){if(typeof D=="function"){k=k();var H=D(k);return function(){typeof H=="function"?H():D(null)}}if(D!=null)return k=k(),D.current=k,function(){D.current=null}}function Vu(k,D,H){H=H!=null?H.concat([k]):null,Co(4,4,Ku.bind(null,D,k),H)}function uc(){}function Gu(k,D){var H=hr();D=D===void 0?null:D;var ce=H.memoizedState;return D!==null&&Ja(D,ce[1])?ce[0]:(H.memoizedState=[k,D],k)}function Wu(k,D){var H=hr();D=D===void 0?null:D;var ce=H.memoizedState;if(D!==null&&Ja(D,ce[1]))return ce[0];if(ce=k(),_i){He(!0);try{k()}finally{He(!1)}}return H.memoizedState=[ce,D],ce}function dc(k,D,H){return H===void 0||(kn&1073741824)!==0&&(Kt&261930)===0?k.memoizedState=D:(k.memoizedState=H,k=Jd(),Ut.lanes|=k,ei|=k,H)}function Yu(k,D,H,ce){return Wr(H,D)?H:zi.current!==null?(k=dc(k,H,ce),Wr(k,D)||(yr=!0),k):(kn&42)===0||(kn&1073741824)!==0&&(Kt&261930)===0?(yr=!0,k.memoizedState=H):(k=Jd(),Ut.lanes|=k,ei|=k,D)}function Zu(k,D,H,ce,me){var xe=Y.p;Y.p=xe!==0&&8>xe?xe:8;var Ne=re.T,Fe={};re.T=Fe,pc(k,!1,D,H);try{var Ye=me(),st=re.S;if(st!==null&&st(Fe,Ye),Ye!==null&&typeof Ye=="object"&&typeof Ye.then=="function"){var yt=c0(Ye,ce);Ts(k,D,yt,en(k))}else Ts(k,D,ce,en(k))}catch(Et){Ts(k,D,{then:function(){},status:"rejected",reason:Et},en())}finally{Y.p=xe,Ne!==null&&Fe.types!==null&&(Ne.types=Fe.types),re.T=Ne}}function p0(){}function fc(k,D,H,ce){if(k.tag!==5)throw Error(v(476));var me=Xu(k).queue;Zu(k,me,D,te,H===null?p0:function(){return Ju(k),H(ce)})}function Xu(k){var D=k.memoizedState;if(D!==null)return D;D={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:In,lastRenderedState:te},next:null};var H={};return D.next={memoizedState:H,baseState:H,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:In,lastRenderedState:H},next:null},k.memoizedState=D,k=k.alternate,k!==null&&(k.memoizedState=D),D}function Ju(k){var D=Xu(k);D.next===null&&(D=k.alternate.memoizedState),Ts(k,D.next.queue,{},en())}function hc(){return Tr(Vs)}function Qu(){return hr().memoizedState}function td(){return hr().memoizedState}function m0(k){for(var D=k.return;D!==null;){switch(D.tag){case 24:case 3:var H=en();k=Wn(H);var ce=Yn(D,k,H);ce!==null&&(zr(ce,D,H),Ss(ce,D,H)),D={cache:Ua()},k.payload=D;return}D=D.return}}function g0(k,D,H){var ce=en();H={lane:ce,revertLane:0,gesture:null,action:H,hasEagerState:!1,eagerState:null,next:null},$o(k)?nd(D,H):(H=ka(k,D,H,ce),H!==null&&(zr(H,k,ce),sd(H,D,ce)))}function rd(k,D,H){var ce=en();Ts(k,D,H,ce)}function Ts(k,D,H,ce){var me={lane:ce,revertLane:0,gesture:null,action:H,hasEagerState:!1,eagerState:null,next:null};if($o(k))nd(D,me);else{var xe=k.alternate;if(k.lanes===0&&(xe===null||xe.lanes===0)&&(xe=D.lastRenderedReducer,xe!==null))try{var Ne=D.lastRenderedState,Fe=xe(Ne,H);if(me.hasEagerState=!0,me.eagerState=Fe,Wr(Fe,Ne))return oo(k,D,me,0),ir===null&&so(),!1}catch{}finally{}if(H=ka(k,D,me,ce),H!==null)return zr(H,k,ce),sd(H,D,ce),!0}return!1}function pc(k,D,H,ce){if(ce={lane:2,revertLane:Vc(),gesture:null,action:ce,hasEagerState:!1,eagerState:null,next:null},$o(k)){if(D)throw Error(v(479))}else D=ka(k,H,ce,2),D!==null&&zr(D,k,2)}function $o(k){var D=k.alternate;return k===Ut||D!==null&&D===Ut}function nd(k,D){Ki=xo=!0;var H=k.pending;H===null?D.next=D:(D.next=H.next,H.next=D),k.pending=D}function sd(k,D,H){if((H&4194048)!==0){var ce=D.lanes;ce&=k.pendingLanes,H|=ce,D.lanes=H,We(k,H)}}var ks={readContext:Tr,use:_o,useCallback:ur,useContext:ur,useEffect:ur,useImperativeHandle:ur,useLayoutEffect:ur,useInsertionEffect:ur,useMemo:ur,useReducer:ur,useRef:ur,useState:ur,useDebugValue:ur,useDeferredValue:ur,useTransition:ur,useSyncExternalStore:ur,useId:ur,useHostTransitionStatus:ur,useFormState:ur,useActionState:ur,useOptimistic:ur,useMemoCache:ur,useCacheRefresh:ur};ks.useEffectEvent=ur;var od={readContext:Tr,use:_o,useCallback:function(k,D){return Nr().memoizedState=[k,D===void 0?null:D],k},useContext:Tr,useEffect:Uu,useImperativeHandle:function(k,D,H){H=H!=null?H.concat([k]):null,Ao(4194308,4,Ku.bind(null,D,k),H)},useLayoutEffect:function(k,D){return Ao(4194308,4,k,D)},useInsertionEffect:function(k,D){Ao(4,2,k,D)},useMemo:function(k,D){var H=Nr();D=D===void 0?null:D;var ce=k();if(_i){He(!0);try{k()}finally{He(!1)}}return H.memoizedState=[ce,D],ce},useReducer:function(k,D,H){var ce=Nr();if(H!==void 0){var me=H(D);if(_i){He(!0);try{H(D)}finally{He(!1)}}}else me=D;return ce.memoizedState=ce.baseState=me,k={pending:null,lanes:0,dispatch:null,lastRenderedReducer:k,lastRenderedState:me},ce.queue=k,k=k.dispatch=g0.bind(null,Ut,k),[ce.memoizedState,k]},useRef:function(k){var D=Nr();return k={current:k},D.memoizedState=k},useState:function(k){k=ac(k);var D=k.queue,H=rd.bind(null,Ut,D);return D.dispatch=H,[k.memoizedState,H]},useDebugValue:uc,useDeferredValue:function(k,D){var H=Nr();return dc(H,k,D)},useTransition:function(){var k=ac(!1);return k=Zu.bind(null,Ut,k.queue,!0,!1),Nr().memoizedState=k,[!1,k]},useSyncExternalStore:function(k,D,H){var ce=Ut,me=Nr();if(Gt){if(H===void 0)throw Error(v(407));H=H()}else{if(H=D(),ir===null)throw Error(v(349));(Kt&127)!==0||Au(ce,D,H)}me.memoizedState=H;var xe={value:H,getSnapshot:D};return me.queue=xe,Uu($u.bind(null,ce,xe,k),[k]),ce.flags|=2048,Gi(9,{destroy:void 0},Cu.bind(null,ce,xe,H,D),null),H},useId:function(){var k=Nr(),D=ir.identifierPrefix;if(Gt){var H=xn,ce=vn;H=(ce&~(1<<32-Ve(ce)-1)).toString(32)+H,D="_"+D+"R_"+H,H=wo++,0<H&&(D+="H"+H.toString(32)),D+="_"}else H=l0++,D="_"+D+"r_"+H.toString(32)+"_";return k.memoizedState=D},useHostTransitionStatus:hc,useFormState:Du,useActionState:Du,useOptimistic:function(k){var D=Nr();D.memoizedState=D.baseState=k;var H={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return D.queue=H,D=pc.bind(null,Ut,!0,H),H.dispatch=D,[k,D]},useMemoCache:ic,useCacheRefresh:function(){return Nr().memoizedState=m0.bind(null,Ut)},useEffectEvent:function(k){var D=Nr(),H={impl:k};return D.memoizedState=H,function(){if((Xt&2)!==0)throw Error(v(440));return H.impl.apply(void 0,arguments)}}},mc={readContext:Tr,use:_o,useCallback:Gu,useContext:Tr,useEffect:lc,useImperativeHandle:Vu,useInsertionEffect:Hu,useLayoutEffect:zu,useMemo:Wu,useReducer:So,useRef:Fu,useState:function(){return So(In)},useDebugValue:uc,useDeferredValue:function(k,D){var H=hr();return Yu(H,tr.memoizedState,k,D)},useTransition:function(){var k=So(In)[0],D=hr().memoizedState;return[typeof k=="boolean"?k:Rs(k),D]},useSyncExternalStore:Su,useId:Qu,useHostTransitionStatus:hc,useFormState:Bu,useActionState:Bu,useOptimistic:function(k,D){var H=hr();return ku(H,tr,k,D)},useMemoCache:ic,useCacheRefresh:td};mc.useEffectEvent=qu;var ad={readContext:Tr,use:_o,useCallback:Gu,useContext:Tr,useEffect:lc,useImperativeHandle:Vu,useInsertionEffect:Hu,useLayoutEffect:zu,useMemo:Wu,useReducer:oc,useRef:Fu,useState:function(){return oc(In)},useDebugValue:uc,useDeferredValue:function(k,D){var H=hr();return tr===null?dc(H,k,D):Yu(H,tr.memoizedState,k,D)},useTransition:function(){var k=oc(In)[0],D=hr().memoizedState;return[typeof k=="boolean"?k:Rs(k),D]},useSyncExternalStore:Su,useId:Qu,useHostTransitionStatus:hc,useFormState:ju,useActionState:ju,useOptimistic:function(k,D){var H=hr();return tr!==null?ku(H,tr,k,D):(H.baseState=k,[k,H.queue.dispatch])},useMemoCache:ic,useCacheRefresh:td};ad.useEffectEvent=qu;function gc(k,D,H,ce){D=k.memoizedState,H=H(ce,D),H=H==null?D:T({},D,H),k.memoizedState=H,k.lanes===0&&(k.updateQueue.baseState=H)}var yc={enqueueSetState:function(k,D,H){k=k._reactInternals;var ce=en(),me=Wn(ce);me.payload=D,H!=null&&(me.callback=H),D=Yn(k,me,ce),D!==null&&(zr(D,k,ce),Ss(D,k,ce))},enqueueReplaceState:function(k,D,H){k=k._reactInternals;var ce=en(),me=Wn(ce);me.tag=1,me.payload=D,H!=null&&(me.callback=H),D=Yn(k,me,ce),D!==null&&(zr(D,k,ce),Ss(D,k,ce))},enqueueForceUpdate:function(k,D){k=k._reactInternals;var H=en(),ce=Wn(H);ce.tag=2,D!=null&&(ce.callback=D),D=Yn(k,ce,H),D!==null&&(zr(D,k,H),Ss(D,k,H))}};function cd(k,D,H,ce,me,xe,Ne){return k=k.stateNode,typeof k.shouldComponentUpdate=="function"?k.shouldComponentUpdate(ce,xe,Ne):D.prototype&&D.prototype.isPureReactComponent?!ms(H,ce)||!ms(me,xe):!0}function ld(k,D,H,ce){k=D.state,typeof D.componentWillReceiveProps=="function"&&D.componentWillReceiveProps(H,ce),typeof D.UNSAFE_componentWillReceiveProps=="function"&&D.UNSAFE_componentWillReceiveProps(H,ce),D.state!==k&&yc.enqueueReplaceState(D,D.state,null)}function Si(k,D){var H=D;if("ref"in D){H={};for(var ce in D)ce!=="ref"&&(H[ce]=D[ce])}if(k=k.defaultProps){H===D&&(H=T({},H));for(var me in k)H[me]===void 0&&(H[me]=k[me])}return H}function ud(k){io(k)}function dd(k){console.error(k)}function fd(k){io(k)}function Ro(k,D){try{var H=k.onUncaughtError;H(D.value,{componentStack:D.stack})}catch(ce){setTimeout(function(){throw ce})}}function hd(k,D,H){try{var ce=k.onCaughtError;ce(H.value,{componentStack:H.stack,errorBoundary:D.tag===1?D.stateNode:null})}catch(me){setTimeout(function(){throw me})}}function vc(k,D,H){return H=Wn(H),H.tag=3,H.payload={element:null},H.callback=function(){Ro(k,D)},H}function pd(k){return k=Wn(k),k.tag=3,k}function md(k,D,H,ce){var me=H.type.getDerivedStateFromError;if(typeof me=="function"){var xe=ce.value;k.payload=function(){return me(xe)},k.callback=function(){hd(D,H,ce)}}var Ne=H.stateNode;Ne!==null&&typeof Ne.componentDidCatch=="function"&&(k.callback=function(){hd(D,H,ce),typeof me!="function"&&(ti===null?ti=new Set([this]):ti.add(this));var Fe=ce.stack;this.componentDidCatch(ce.value,{componentStack:Fe!==null?Fe:""})})}function y0(k,D,H,ce,me){if(H.flags|=32768,ce!==null&&typeof ce=="object"&&typeof ce.then=="function"){if(D=H.alternate,D!==null&&ji(D,H,me,!0),H=Zr.current,H!==null){switch(H.tag){case 31:case 13:return fn===null?Fo():H.alternate===null&&dr===0&&(dr=3),H.flags&=-257,H.flags|=65536,H.lanes=me,ce===mo?H.flags|=16384:(D=H.updateQueue,D===null?H.updateQueue=new Set([ce]):D.add(ce),Hc(k,ce,me)),!1;case 22:return H.flags|=65536,ce===mo?H.flags|=16384:(D=H.updateQueue,D===null?(D={transitions:null,markerInstances:null,retryQueue:new Set([ce])},H.updateQueue=D):(H=D.retryQueue,H===null?D.retryQueue=new Set([ce]):H.add(ce)),Hc(k,ce,me)),!1}throw Error(v(435,H.tag))}return Hc(k,ce,me),Fo(),!1}if(Gt)return D=Zr.current,D!==null?((D.flags&65536)===0&&(D.flags|=256),D.flags|=65536,D.lanes=me,ce!==Da&&(k=Error(v(422),{cause:ce}),vs(cn(k,H)))):(ce!==Da&&(D=Error(v(423),{cause:ce}),vs(cn(D,H))),k=k.current.alternate,k.flags|=65536,me&=-me,k.lanes|=me,ce=cn(ce,H),me=vc(k.stateNode,ce,me),Ga(k,me),dr!==4&&(dr=2)),!1;var xe=Error(v(520),{cause:ce});if(xe=cn(xe,H),Ls===null?Ls=[xe]:Ls.push(xe),dr!==4&&(dr=2),D===null)return!0;ce=cn(ce,H),H=D;do{switch(H.tag){case 3:return H.flags|=65536,k=me&-me,H.lanes|=k,k=vc(H.stateNode,ce,k),Ga(H,k),!1;case 1:if(D=H.type,xe=H.stateNode,(H.flags&128)===0&&(typeof D.getDerivedStateFromError=="function"||xe!==null&&typeof xe.componentDidCatch=="function"&&(ti===null||!ti.has(xe))))return H.flags|=65536,me&=-me,H.lanes|=me,me=pd(me),md(me,k,H,ce),Ga(H,me),!1}H=H.return}while(H!==null);return!1}var bc=Error(v(461)),yr=!1;function kr(k,D,H,ce){D.child=k===null?yu(D,null,H,ce):Ei(D,k.child,H,ce)}function gd(k,D,H,ce,me){H=H.render;var xe=D.ref;if("ref"in ce){var Ne={};for(var Fe in ce)Fe!=="ref"&&(Ne[Fe]=ce[Fe])}else Ne=ce;return vi(D),ce=Qa(k,D,H,Ne,xe,me),Fe=tc(),k!==null&&!yr?(rc(k,D,me),Pn(k,D,me)):(Gt&&Fe&&Ma(D),D.flags|=1,kr(k,D,ce,me),D.child)}function yd(k,D,H,ce,me){if(k===null){var xe=H.type;return typeof xe=="function"&&!Ia(xe)&&xe.defaultProps===void 0&&H.compare===null?(D.tag=15,D.type=xe,vd(k,D,xe,ce,me)):(k=co(H.type,null,ce,D,D.mode,me),k.ref=D.ref,k.return=D,D.child=k)}if(xe=k.child,!$c(k,me)){var Ne=xe.memoizedProps;if(H=H.compare,H=H!==null?H:ms,H(Ne,ce)&&k.ref===D.ref)return Pn(k,D,me)}return D.flags|=1,k=Cn(xe,ce),k.ref=D.ref,k.return=D,D.child=k}function vd(k,D,H,ce,me){if(k!==null){var xe=k.memoizedProps;if(ms(xe,ce)&&k.ref===D.ref)if(yr=!1,D.pendingProps=ce=xe,$c(k,me))(k.flags&131072)!==0&&(yr=!0);else return D.lanes=k.lanes,Pn(k,D,me)}return xc(k,D,H,ce,me)}function bd(k,D,H,ce){var me=ce.children,xe=k!==null?k.memoizedState:null;if(k===null&&D.stateNode===null&&(D.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),ce.mode==="hidden"){if((D.flags&128)!==0){if(xe=xe!==null?xe.baseLanes|H:H,k!==null){for(ce=D.child=k.child,me=0;ce!==null;)me=me|ce.lanes|ce.childLanes,ce=ce.sibling;ce=me&~xe}else ce=0,D.child=null;return xd(k,D,xe,H,ce)}if((H&536870912)!==0)D.memoizedState={baseLanes:0,cachePool:null},k!==null&&ho(D,xe!==null?xe.cachePool:null),xe!==null?xu(D,xe):Ya(),wu(D);else return ce=D.lanes=536870912,xd(k,D,xe!==null?xe.baseLanes|H:H,H,ce)}else xe!==null?(ho(D,xe.cachePool),xu(D,xe),Xn(),D.memoizedState=null):(k!==null&&ho(D,null),Ya(),Xn());return kr(k,D,me,H),D.child}function Is(k,D){return k!==null&&k.tag===22||D.stateNode!==null||(D.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),D.sibling}function xd(k,D,H,ce,me){var xe=Ha();return xe=xe===null?null:{parent:pr._currentValue,pool:xe},D.memoizedState={baseLanes:H,cachePool:xe},k!==null&&ho(D,null),Ya(),wu(D),k!==null&&ji(k,D,ce,!0),D.childLanes=me,null}function To(k,D){return D=Io({mode:D.mode,children:D.children},k.mode),D.ref=k.ref,k.child=D,D.return=k,D}function wd(k,D,H){return Ei(D,k.child,null,H),k=To(D,D.pendingProps),k.flags|=2,Xr(D),D.memoizedState=null,k}function v0(k,D,H){var ce=D.pendingProps,me=(D.flags&128)!==0;if(D.flags&=-129,k===null){if(Gt){if(ce.mode==="hidden")return k=To(D,ce),D.lanes=536870912,Is(null,k);if(Xa(D),(k=sr)?(k=Of(k,dn),k=k!==null&&k.data==="&"?k:null,k!==null&&(D.memoizedState={dehydrated:k,treeContext:Hn!==null?{id:vn,overflow:xn}:null,retryLane:536870912,hydrationErrors:null},H=ru(k),H.return=D,D.child=H,Rr=D,sr=null)):k=null,k===null)throw Kn(D);return D.lanes=536870912,null}return To(D,ce)}var xe=k.memoizedState;if(xe!==null){var Ne=xe.dehydrated;if(Xa(D),me)if(D.flags&256)D.flags&=-257,D=wd(k,D,H);else if(D.memoizedState!==null)D.child=k.child,D.flags|=128,D=null;else throw Error(v(558));else if(yr||ji(k,D,H,!1),me=(H&k.childLanes)!==0,yr||me){if(ce=ir,ce!==null&&(Ne=Qe(ce,H),Ne!==0&&Ne!==xe.retryLane))throw xe.retryLane=Ne,pi(k,Ne),zr(ce,k,Ne),bc;Fo(),D=wd(k,D,H)}else k=xe.treeContext,sr=hn(Ne.nextSibling),Rr=D,Gt=!0,zn=null,dn=!1,k!==null&&su(D,k),D=To(D,ce),D.flags|=4096;return D}return k=Cn(k.child,{mode:ce.mode,children:ce.children}),k.ref=D.ref,D.child=k,k.return=D,k}function ko(k,D){var H=D.ref;if(H===null)k!==null&&k.ref!==null&&(D.flags|=4194816);else{if(typeof H!="function"&&typeof H!="object")throw Error(v(284));(k===null||k.ref!==H)&&(D.flags|=4194816)}}function xc(k,D,H,ce,me){return vi(D),H=Qa(k,D,H,ce,void 0,me),ce=tc(),k!==null&&!yr?(rc(k,D,me),Pn(k,D,me)):(Gt&&ce&&Ma(D),D.flags|=1,kr(k,D,H,me),D.child)}function Ed(k,D,H,ce,me,xe){return vi(D),D.updateQueue=null,H=_u(D,ce,H,me),Eu(k),ce=tc(),k!==null&&!yr?(rc(k,D,xe),Pn(k,D,xe)):(Gt&&ce&&Ma(D),D.flags|=1,kr(k,D,H,xe),D.child)}function Sd(k,D,H,ce,me){if(vi(D),D.stateNode===null){var xe=Oi,Ne=H.contextType;typeof Ne=="object"&&Ne!==null&&(xe=Tr(Ne)),xe=new H(ce,xe),D.memoizedState=xe.state!==null&&xe.state!==void 0?xe.state:null,xe.updater=yc,D.stateNode=xe,xe._reactInternals=D,xe=D.stateNode,xe.props=ce,xe.state=D.memoizedState,xe.refs={},Ka(D),Ne=H.contextType,xe.context=typeof Ne=="object"&&Ne!==null?Tr(Ne):Oi,xe.state=D.memoizedState,Ne=H.getDerivedStateFromProps,typeof Ne=="function"&&(gc(D,H,Ne,ce),xe.state=D.memoizedState),typeof H.getDerivedStateFromProps=="function"||typeof xe.getSnapshotBeforeUpdate=="function"||typeof xe.UNSAFE_componentWillMount!="function"&&typeof xe.componentWillMount!="function"||(Ne=xe.state,typeof xe.componentWillMount=="function"&&xe.componentWillMount(),typeof xe.UNSAFE_componentWillMount=="function"&&xe.UNSAFE_componentWillMount(),Ne!==xe.state&&yc.enqueueReplaceState(xe,xe.state,null),Cs(D,ce,xe,me),As(),xe.state=D.memoizedState),typeof xe.componentDidMount=="function"&&(D.flags|=4194308),ce=!0}else if(k===null){xe=D.stateNode;var Fe=D.memoizedProps,Ye=Si(H,Fe);xe.props=Ye;var st=xe.context,yt=H.contextType;Ne=Oi,typeof yt=="object"&&yt!==null&&(Ne=Tr(yt));var Et=H.getDerivedStateFromProps;yt=typeof Et=="function"||typeof xe.getSnapshotBeforeUpdate=="function",Fe=D.pendingProps!==Fe,yt||typeof xe.UNSAFE_componentWillReceiveProps!="function"&&typeof xe.componentWillReceiveProps!="function"||(Fe||st!==Ne)&&ld(D,xe,ce,Ne),Gn=!1;var ct=D.memoizedState;xe.state=ct,Cs(D,ce,xe,me),As(),st=D.memoizedState,Fe||ct!==st||Gn?(typeof Et=="function"&&(gc(D,H,Et,ce),st=D.memoizedState),(Ye=Gn||cd(D,H,Ye,ce,ct,st,Ne))?(yt||typeof xe.UNSAFE_componentWillMount!="function"&&typeof xe.componentWillMount!="function"||(typeof xe.componentWillMount=="function"&&xe.componentWillMount(),typeof xe.UNSAFE_componentWillMount=="function"&&xe.UNSAFE_componentWillMount()),typeof xe.componentDidMount=="function"&&(D.flags|=4194308)):(typeof xe.componentDidMount=="function"&&(D.flags|=4194308),D.memoizedProps=ce,D.memoizedState=st),xe.props=ce,xe.state=st,xe.context=Ne,ce=Ye):(typeof xe.componentDidMount=="function"&&(D.flags|=4194308),ce=!1)}else{xe=D.stateNode,Va(k,D),Ne=D.memoizedProps,yt=Si(H,Ne),xe.props=yt,Et=D.pendingProps,ct=xe.context,st=H.contextType,Ye=Oi,typeof st=="object"&&st!==null&&(Ye=Tr(st)),Fe=H.getDerivedStateFromProps,(st=typeof Fe=="function"||typeof xe.getSnapshotBeforeUpdate=="function")||typeof xe.UNSAFE_componentWillReceiveProps!="function"&&typeof xe.componentWillReceiveProps!="function"||(Ne!==Et||ct!==Ye)&&ld(D,xe,ce,Ye),Gn=!1,ct=D.memoizedState,xe.state=ct,Cs(D,ce,xe,me),As();var pt=D.memoizedState;Ne!==Et||ct!==pt||Gn||k!==null&&k.dependencies!==null&&uo(k.dependencies)?(typeof Fe=="function"&&(gc(D,H,Fe,ce),pt=D.memoizedState),(yt=Gn||cd(D,H,yt,ce,ct,pt,Ye)||k!==null&&k.dependencies!==null&&uo(k.dependencies))?(st||typeof xe.UNSAFE_componentWillUpdate!="function"&&typeof xe.componentWillUpdate!="function"||(typeof xe.componentWillUpdate=="function"&&xe.componentWillUpdate(ce,pt,Ye),typeof xe.UNSAFE_componentWillUpdate=="function"&&xe.UNSAFE_componentWillUpdate(ce,pt,Ye)),typeof xe.componentDidUpdate=="function"&&(D.flags|=4),typeof xe.getSnapshotBeforeUpdate=="function"&&(D.flags|=1024)):(typeof xe.componentDidUpdate!="function"||Ne===k.memoizedProps&&ct===k.memoizedState||(D.flags|=4),typeof xe.getSnapshotBeforeUpdate!="function"||Ne===k.memoizedProps&&ct===k.memoizedState||(D.flags|=1024),D.memoizedProps=ce,D.memoizedState=pt),xe.props=ce,xe.state=pt,xe.context=Ye,ce=yt):(typeof xe.componentDidUpdate!="function"||Ne===k.memoizedProps&&ct===k.memoizedState||(D.flags|=4),typeof xe.getSnapshotBeforeUpdate!="function"||Ne===k.memoizedProps&&ct===k.memoizedState||(D.flags|=1024),ce=!1)}return xe=ce,ko(k,D),ce=(D.flags&128)!==0,xe||ce?(xe=D.stateNode,H=ce&&typeof H.getDerivedStateFromError!="function"?null:xe.render(),D.flags|=1,k!==null&&ce?(D.child=Ei(D,k.child,null,me),D.child=Ei(D,null,H,me)):kr(k,D,H,me),D.memoizedState=xe.state,k=D.child):k=Pn(k,D,me),k}function Ad(k,D,H,ce){return gi(),D.flags|=256,kr(k,D,H,ce),D.child}var wc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ec(k){return{baseLanes:k,cachePool:du()}}function _c(k,D,H){return k=k!==null?k.childLanes&~H:0,D&&(k|=Qr),k}function Cd(k,D,H){var ce=D.pendingProps,me=!1,xe=(D.flags&128)!==0,Ne;if((Ne=xe)||(Ne=k!==null&&k.memoizedState===null?!1:(fr.current&2)!==0),Ne&&(me=!0,D.flags&=-129),Ne=(D.flags&32)!==0,D.flags&=-33,k===null){if(Gt){if(me?Zn(D):Xn(),(k=sr)?(k=Of(k,dn),k=k!==null&&k.data!=="&"?k:null,k!==null&&(D.memoizedState={dehydrated:k,treeContext:Hn!==null?{id:vn,overflow:xn}:null,retryLane:536870912,hydrationErrors:null},H=ru(k),H.return=D,D.child=H,Rr=D,sr=null)):k=null,k===null)throw Kn(D);return sl(k)?D.lanes=32:D.lanes=536870912,null}var Fe=ce.children;return ce=ce.fallback,me?(Xn(),me=D.mode,Fe=Io({mode:"hidden",children:Fe},me),ce=mi(ce,me,H,null),Fe.return=D,ce.return=D,Fe.sibling=ce,D.child=Fe,ce=D.child,ce.memoizedState=Ec(H),ce.childLanes=_c(k,Ne,H),D.memoizedState=wc,Is(null,ce)):(Zn(D),Sc(D,Fe))}var Ye=k.memoizedState;if(Ye!==null&&(Fe=Ye.dehydrated,Fe!==null)){if(xe)D.flags&256?(Zn(D),D.flags&=-257,D=Ac(k,D,H)):D.memoizedState!==null?(Xn(),D.child=k.child,D.flags|=128,D=null):(Xn(),Fe=ce.fallback,me=D.mode,ce=Io({mode:"visible",children:ce.children},me),Fe=mi(Fe,me,H,null),Fe.flags|=2,ce.return=D,Fe.return=D,ce.sibling=Fe,D.child=ce,Ei(D,k.child,null,H),ce=D.child,ce.memoizedState=Ec(H),ce.childLanes=_c(k,Ne,H),D.memoizedState=wc,D=Is(null,ce));else if(Zn(D),sl(Fe)){if(Ne=Fe.nextSibling&&Fe.nextSibling.dataset,Ne)var st=Ne.dgst;Ne=st,ce=Error(v(419)),ce.stack="",ce.digest=Ne,vs({value:ce,source:null,stack:null}),D=Ac(k,D,H)}else if(yr||ji(k,D,H,!1),Ne=(H&k.childLanes)!==0,yr||Ne){if(Ne=ir,Ne!==null&&(ce=Qe(Ne,H),ce!==0&&ce!==Ye.retryLane))throw Ye.retryLane=ce,pi(k,ce),zr(Ne,k,ce),bc;il(Fe)||Fo(),D=Ac(k,D,H)}else il(Fe)?(D.flags|=192,D.child=k.child,D=null):(k=Ye.treeContext,sr=hn(Fe.nextSibling),Rr=D,Gt=!0,zn=null,dn=!1,k!==null&&su(D,k),D=Sc(D,ce.children),D.flags|=4096);return D}return me?(Xn(),Fe=ce.fallback,me=D.mode,Ye=k.child,st=Ye.sibling,ce=Cn(Ye,{mode:"hidden",children:ce.children}),ce.subtreeFlags=Ye.subtreeFlags&65011712,st!==null?Fe=Cn(st,Fe):(Fe=mi(Fe,me,H,null),Fe.flags|=2),Fe.return=D,ce.return=D,ce.sibling=Fe,D.child=ce,Is(null,ce),ce=D.child,Fe=k.child.memoizedState,Fe===null?Fe=Ec(H):(me=Fe.cachePool,me!==null?(Ye=pr._currentValue,me=me.parent!==Ye?{parent:Ye,pool:Ye}:me):me=du(),Fe={baseLanes:Fe.baseLanes|H,cachePool:me}),ce.memoizedState=Fe,ce.childLanes=_c(k,Ne,H),D.memoizedState=wc,Is(k.child,ce)):(Zn(D),H=k.child,k=H.sibling,H=Cn(H,{mode:"visible",children:ce.children}),H.return=D,H.sibling=null,k!==null&&(Ne=D.deletions,Ne===null?(D.deletions=[k],D.flags|=16):Ne.push(k)),D.child=H,D.memoizedState=null,H)}function Sc(k,D){return D=Io({mode:"visible",children:D},k.mode),D.return=k,k.child=D}function Io(k,D){return k=Yr(22,k,null,D),k.lanes=0,k}function Ac(k,D,H){return Ei(D,k.child,null,H),k=Sc(D,D.pendingProps.children),k.flags|=2,D.memoizedState=null,k}function $d(k,D,H){k.lanes|=D;var ce=k.alternate;ce!==null&&(ce.lanes|=D),ja(k.return,D,H)}function Cc(k,D,H,ce,me,xe){var Ne=k.memoizedState;Ne===null?k.memoizedState={isBackwards:D,rendering:null,renderingStartTime:0,last:ce,tail:H,tailMode:me,treeForkCount:xe}:(Ne.isBackwards=D,Ne.rendering=null,Ne.renderingStartTime=0,Ne.last=ce,Ne.tail=H,Ne.tailMode=me,Ne.treeForkCount=xe)}function Rd(k,D,H){var ce=D.pendingProps,me=ce.revealOrder,xe=ce.tail;ce=ce.children;var Ne=fr.current,Fe=(Ne&2)!==0;if(Fe?(Ne=Ne&1|2,D.flags|=128):Ne&=1,ue(fr,Ne),kr(k,D,ce,H),ce=Gt?ys:0,!Fe&&k!==null&&(k.flags&128)!==0)e:for(k=D.child;k!==null;){if(k.tag===13)k.memoizedState!==null&&$d(k,H,D);else if(k.tag===19)$d(k,H,D);else if(k.child!==null){k.child.return=k,k=k.child;continue}if(k===D)break e;for(;k.sibling===null;){if(k.return===null||k.return===D)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}switch(me){case"forwards":for(H=D.child,me=null;H!==null;)k=H.alternate,k!==null&&bo(k)===null&&(me=H),H=H.sibling;H=me,H===null?(me=D.child,D.child=null):(me=H.sibling,H.sibling=null),Cc(D,!1,me,H,xe,ce);break;case"backwards":case"unstable_legacy-backwards":for(H=null,me=D.child,D.child=null;me!==null;){if(k=me.alternate,k!==null&&bo(k)===null){D.child=me;break}k=me.sibling,me.sibling=H,H=me,me=k}Cc(D,!0,H,null,xe,ce);break;case"together":Cc(D,!1,null,null,void 0,ce);break;default:D.memoizedState=null}return D.child}function Pn(k,D,H){if(k!==null&&(D.dependencies=k.dependencies),ei|=D.lanes,(H&D.childLanes)===0)if(k!==null){if(ji(k,D,H,!1),(H&D.childLanes)===0)return null}else return null;if(k!==null&&D.child!==k.child)throw Error(v(153));if(D.child!==null){for(k=D.child,H=Cn(k,k.pendingProps),D.child=H,H.return=D;k.sibling!==null;)k=k.sibling,H=H.sibling=Cn(k,k.pendingProps),H.return=D;H.sibling=null}return D.child}function $c(k,D){return(k.lanes&D)!==0?!0:(k=k.dependencies,!!(k!==null&&uo(k)))}function b0(k,D,H){switch(D.tag){case 3:be(D,D.stateNode.containerInfo),Vn(D,pr,k.memoizedState.cache),gi();break;case 27:case 5:De(D);break;case 4:be(D,D.stateNode.containerInfo);break;case 10:Vn(D,D.type,D.memoizedProps.value);break;case 31:if(D.memoizedState!==null)return D.flags|=128,Xa(D),null;break;case 13:var ce=D.memoizedState;if(ce!==null)return ce.dehydrated!==null?(Zn(D),D.flags|=128,null):(H&D.child.childLanes)!==0?Cd(k,D,H):(Zn(D),k=Pn(k,D,H),k!==null?k.sibling:null);Zn(D);break;case 19:var me=(k.flags&128)!==0;if(ce=(H&D.childLanes)!==0,ce||(ji(k,D,H,!1),ce=(H&D.childLanes)!==0),me){if(ce)return Rd(k,D,H);D.flags|=128}if(me=D.memoizedState,me!==null&&(me.rendering=null,me.tail=null,me.lastEffect=null),ue(fr,fr.current),ce)break;return null;case 22:return D.lanes=0,bd(k,D,H,D.pendingProps);case 24:Vn(D,pr,k.memoizedState.cache)}return Pn(k,D,H)}function Td(k,D,H){if(k!==null)if(k.memoizedProps!==D.pendingProps)yr=!0;else{if(!$c(k,H)&&(D.flags&128)===0)return yr=!1,b0(k,D,H);yr=(k.flags&131072)!==0}else yr=!1,Gt&&(D.flags&1048576)!==0&&iu(D,ys,D.index);switch(D.lanes=0,D.tag){case 16:e:{var ce=D.pendingProps;if(k=xi(D.elementType),D.type=k,typeof k=="function")Ia(k)?(ce=Si(k,ce),D.tag=1,D=Sd(null,D,k,ce,H)):(D.tag=0,D=xc(null,D,k,ce,H));else{if(k!=null){var me=k.$$typeof;if(me===le){D.tag=11,D=gd(null,D,k,ce,H);break e}else if(me===ye){D.tag=14,D=yd(null,D,k,ce,H);break e}}throw D=j(k)||k,Error(v(306,D,""))}}return D;case 0:return xc(k,D,D.type,D.pendingProps,H);case 1:return ce=D.type,me=Si(ce,D.pendingProps),Sd(k,D,ce,me,H);case 3:e:{if(be(D,D.stateNode.containerInfo),k===null)throw Error(v(387));ce=D.pendingProps;var xe=D.memoizedState;me=xe.element,Va(k,D),Cs(D,ce,null,H);var Ne=D.memoizedState;if(ce=Ne.cache,Vn(D,pr,ce),ce!==xe.cache&&Fa(D,[pr],H,!0),As(),ce=Ne.element,xe.isDehydrated)if(xe={element:ce,isDehydrated:!1,cache:Ne.cache},D.updateQueue.baseState=xe,D.memoizedState=xe,D.flags&256){D=Ad(k,D,ce,H);break e}else if(ce!==me){me=cn(Error(v(424)),D),vs(me),D=Ad(k,D,ce,H);break e}else{switch(k=D.stateNode.containerInfo,k.nodeType){case 9:k=k.body;break;default:k=k.nodeName==="HTML"?k.ownerDocument.body:k}for(sr=hn(k.firstChild),Rr=D,Gt=!0,zn=null,dn=!0,H=yu(D,null,ce,H),D.child=H;H;)H.flags=H.flags&-3|4096,H=H.sibling}else{if(gi(),ce===me){D=Pn(k,D,H);break e}kr(k,D,ce,H)}D=D.child}return D;case 26:return ko(k,D),k===null?(H=Uf(D.type,null,D.pendingProps,null))?D.memoizedState=H:Gt||(H=D.type,k=D.pendingProps,ce=Go(Ae.current).createElement(H),ce[Tt]=D,ce[It]=k,Ir(ce,H,k),Jt(ce),D.stateNode=ce):D.memoizedState=Uf(D.type,k.memoizedProps,D.pendingProps,k.memoizedState),null;case 27:return De(D),k===null&&Gt&&(ce=D.stateNode=Lf(D.type,D.pendingProps,Ae.current),Rr=D,dn=!0,me=sr,si(D.type)?(ol=me,sr=hn(ce.firstChild)):sr=me),kr(k,D,D.pendingProps.children,H),ko(k,D),k===null&&(D.flags|=4194304),D.child;case 5:return k===null&&Gt&&((me=ce=sr)&&(ce=Y0(ce,D.type,D.pendingProps,dn),ce!==null?(D.stateNode=ce,Rr=D,sr=hn(ce.firstChild),dn=!1,me=!0):me=!1),me||Kn(D)),De(D),me=D.type,xe=D.pendingProps,Ne=k!==null?k.memoizedProps:null,ce=xe.children,tl(me,xe)?ce=null:Ne!==null&&tl(me,Ne)&&(D.flags|=32),D.memoizedState!==null&&(me=Qa(k,D,u0,null,null,H),Vs._currentValue=me),ko(k,D),kr(k,D,ce,H),D.child;case 6:return k===null&&Gt&&((k=H=sr)&&(H=Z0(H,D.pendingProps,dn),H!==null?(D.stateNode=H,Rr=D,sr=null,k=!0):k=!1),k||Kn(D)),null;case 13:return Cd(k,D,H);case 4:return be(D,D.stateNode.containerInfo),ce=D.pendingProps,k===null?D.child=Ei(D,null,ce,H):kr(k,D,ce,H),D.child;case 11:return gd(k,D,D.type,D.pendingProps,H);case 7:return kr(k,D,D.pendingProps,H),D.child;case 8:return kr(k,D,D.pendingProps.children,H),D.child;case 12:return kr(k,D,D.pendingProps.children,H),D.child;case 10:return ce=D.pendingProps,Vn(D,D.type,ce.value),kr(k,D,ce.children,H),D.child;case 9:return me=D.type._context,ce=D.pendingProps.children,vi(D),me=Tr(me),ce=ce(me),D.flags|=1,kr(k,D,ce,H),D.child;case 14:return yd(k,D,D.type,D.pendingProps,H);case 15:return vd(k,D,D.type,D.pendingProps,H);case 19:return Rd(k,D,H);case 31:return v0(k,D,H);case 22:return bd(k,D,H,D.pendingProps);case 24:return vi(D),ce=Tr(pr),k===null?(me=Ha(),me===null&&(me=ir,xe=Ua(),me.pooledCache=xe,xe.refCount++,xe!==null&&(me.pooledCacheLanes|=H),me=xe),D.memoizedState={parent:ce,cache:me},Ka(D),Vn(D,pr,me)):((k.lanes&H)!==0&&(Va(k,D),Cs(D,null,null,H),As()),me=k.memoizedState,xe=D.memoizedState,me.parent!==ce?(me={parent:ce,cache:ce},D.memoizedState=me,D.lanes===0&&(D.memoizedState=D.updateQueue.baseState=me),Vn(D,pr,ce)):(ce=xe.cache,Vn(D,pr,ce),ce!==me.cache&&Fa(D,[pr],H,!0))),kr(k,D,D.pendingProps.children,H),D.child;case 29:throw D.pendingProps}throw Error(v(156,D.tag))}function Nn(k){k.flags|=4}function Rc(k,D,H,ce,me){if((D=(k.mode&32)!==0)&&(D=!1),D){if(k.flags|=16777216,(me&335544128)===me)if(k.stateNode.complete)k.flags|=8192;else if(rf())k.flags|=8192;else throw wi=mo,za}else k.flags&=-16777217}function kd(k,D){if(D.type!=="stylesheet"||(D.state.loading&4)!==0)k.flags&=-16777217;else if(k.flags|=16777216,!Vf(D))if(rf())k.flags|=8192;else throw wi=mo,za}function Po(k,D){D!==null&&(k.flags|=4),k.flags&16384&&(D=k.tag!==22?At():536870912,k.lanes|=D,Xi|=D)}function Ps(k,D){if(!Gt)switch(k.tailMode){case"hidden":D=k.tail;for(var H=null;D!==null;)D.alternate!==null&&(H=D),D=D.sibling;H===null?k.tail=null:H.sibling=null;break;case"collapsed":H=k.tail;for(var ce=null;H!==null;)H.alternate!==null&&(ce=H),H=H.sibling;ce===null?D||k.tail===null?k.tail=null:k.tail.sibling=null:ce.sibling=null}}function ar(k){var D=k.alternate!==null&&k.alternate.child===k.child,H=0,ce=0;if(D)for(var me=k.child;me!==null;)H|=me.lanes|me.childLanes,ce|=me.subtreeFlags&65011712,ce|=me.flags&65011712,me.return=k,me=me.sibling;else for(me=k.child;me!==null;)H|=me.lanes|me.childLanes,ce|=me.subtreeFlags,ce|=me.flags,me.return=k,me=me.sibling;return k.subtreeFlags|=ce,k.childLanes=H,D}function x0(k,D,H){var ce=D.pendingProps;switch(Oa(D),D.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ar(D),null;case 1:return ar(D),null;case 3:return H=D.stateNode,ce=null,k!==null&&(ce=k.memoizedState.cache),D.memoizedState.cache!==ce&&(D.flags|=2048),Tn(pr),Te(),H.pendingContext&&(H.context=H.pendingContext,H.pendingContext=null),(k===null||k.child===null)&&(Li(D)?Nn(D):k===null||k.memoizedState.isDehydrated&&(D.flags&256)===0||(D.flags|=1024,Ba())),ar(D),null;case 26:var me=D.type,xe=D.memoizedState;return k===null?(Nn(D),xe!==null?(ar(D),kd(D,xe)):(ar(D),Rc(D,me,null,ce,H))):xe?xe!==k.memoizedState?(Nn(D),ar(D),kd(D,xe)):(ar(D),D.flags&=-16777217):(k=k.memoizedProps,k!==ce&&Nn(D),ar(D),Rc(D,me,k,ce,H)),null;case 27:if(Ie(D),H=Ae.current,me=D.type,k!==null&&D.stateNode!=null)k.memoizedProps!==ce&&Nn(D);else{if(!ce){if(D.stateNode===null)throw Error(v(166));return ar(D),null}k=_e.current,Li(D)?ou(D):(k=Lf(me,ce,H),D.stateNode=k,Nn(D))}return ar(D),null;case 5:if(Ie(D),me=D.type,k!==null&&D.stateNode!=null)k.memoizedProps!==ce&&Nn(D);else{if(!ce){if(D.stateNode===null)throw Error(v(166));return ar(D),null}if(xe=_e.current,Li(D))ou(D);else{var Ne=Go(Ae.current);switch(xe){case 1:xe=Ne.createElementNS("http://www.w3.org/2000/svg",me);break;case 2:xe=Ne.createElementNS("http://www.w3.org/1998/Math/MathML",me);break;default:switch(me){case"svg":xe=Ne.createElementNS("http://www.w3.org/2000/svg",me);break;case"math":xe=Ne.createElementNS("http://www.w3.org/1998/Math/MathML",me);break;case"script":xe=Ne.createElement("div"),xe.innerHTML="<script><\/script>",xe=xe.removeChild(xe.firstChild);break;case"select":xe=typeof ce.is=="string"?Ne.createElement("select",{is:ce.is}):Ne.createElement("select"),ce.multiple?xe.multiple=!0:ce.size&&(xe.size=ce.size);break;default:xe=typeof ce.is=="string"?Ne.createElement(me,{is:ce.is}):Ne.createElement(me)}}xe[Tt]=D,xe[It]=ce;e:for(Ne=D.child;Ne!==null;){if(Ne.tag===5||Ne.tag===6)xe.appendChild(Ne.stateNode);else if(Ne.tag!==4&&Ne.tag!==27&&Ne.child!==null){Ne.child.return=Ne,Ne=Ne.child;continue}if(Ne===D)break e;for(;Ne.sibling===null;){if(Ne.return===null||Ne.return===D)break e;Ne=Ne.return}Ne.sibling.return=Ne.return,Ne=Ne.sibling}D.stateNode=xe;e:switch(Ir(xe,me,ce),me){case"button":case"input":case"select":case"textarea":ce=!!ce.autoFocus;break e;case"img":ce=!0;break e;default:ce=!1}ce&&Nn(D)}}return ar(D),Rc(D,D.type,k===null?null:k.memoizedProps,D.pendingProps,H),null;case 6:if(k&&D.stateNode!=null)k.memoizedProps!==ce&&Nn(D);else{if(typeof ce!="string"&&D.stateNode===null)throw Error(v(166));if(k=Ae.current,Li(D)){if(k=D.stateNode,H=D.memoizedProps,ce=null,me=Rr,me!==null)switch(me.tag){case 27:case 5:ce=me.memoizedProps}k[Tt]=D,k=!!(k.nodeValue===H||ce!==null&&ce.suppressHydrationWarning===!0||$f(k.nodeValue,H)),k||Kn(D,!0)}else k=Go(k).createTextNode(ce),k[Tt]=D,D.stateNode=k}return ar(D),null;case 31:if(H=D.memoizedState,k===null||k.memoizedState!==null){if(ce=Li(D),H!==null){if(k===null){if(!ce)throw Error(v(318));if(k=D.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(v(557));k[Tt]=D}else gi(),(D.flags&128)===0&&(D.memoizedState=null),D.flags|=4;ar(D),k=!1}else H=Ba(),k!==null&&k.memoizedState!==null&&(k.memoizedState.hydrationErrors=H),k=!0;if(!k)return D.flags&256?(Xr(D),D):(Xr(D),null);if((D.flags&128)!==0)throw Error(v(558))}return ar(D),null;case 13:if(ce=D.memoizedState,k===null||k.memoizedState!==null&&k.memoizedState.dehydrated!==null){if(me=Li(D),ce!==null&&ce.dehydrated!==null){if(k===null){if(!me)throw Error(v(318));if(me=D.memoizedState,me=me!==null?me.dehydrated:null,!me)throw Error(v(317));me[Tt]=D}else gi(),(D.flags&128)===0&&(D.memoizedState=null),D.flags|=4;ar(D),me=!1}else me=Ba(),k!==null&&k.memoizedState!==null&&(k.memoizedState.hydrationErrors=me),me=!0;if(!me)return D.flags&256?(Xr(D),D):(Xr(D),null)}return Xr(D),(D.flags&128)!==0?(D.lanes=H,D):(H=ce!==null,k=k!==null&&k.memoizedState!==null,H&&(ce=D.child,me=null,ce.alternate!==null&&ce.alternate.memoizedState!==null&&ce.alternate.memoizedState.cachePool!==null&&(me=ce.alternate.memoizedState.cachePool.pool),xe=null,ce.memoizedState!==null&&ce.memoizedState.cachePool!==null&&(xe=ce.memoizedState.cachePool.pool),xe!==me&&(ce.flags|=2048)),H!==k&&H&&(D.child.flags|=8192),Po(D,D.updateQueue),ar(D),null);case 4:return Te(),k===null&&Zc(D.stateNode.containerInfo),ar(D),null;case 10:return Tn(D.type),ar(D),null;case 19:if(Z(fr),ce=D.memoizedState,ce===null)return ar(D),null;if(me=(D.flags&128)!==0,xe=ce.rendering,xe===null)if(me)Ps(ce,!1);else{if(dr!==0||k!==null&&(k.flags&128)!==0)for(k=D.child;k!==null;){if(xe=bo(k),xe!==null){for(D.flags|=128,Ps(ce,!1),k=xe.updateQueue,D.updateQueue=k,Po(D,k),D.subtreeFlags=0,k=H,H=D.child;H!==null;)tu(H,k),H=H.sibling;return ue(fr,fr.current&1|2),Gt&&$n(D,ce.treeForkCount),D.child}k=k.sibling}ce.tail!==null&&ot()>Bo&&(D.flags|=128,me=!0,Ps(ce,!1),D.lanes=4194304)}else{if(!me)if(k=bo(xe),k!==null){if(D.flags|=128,me=!0,k=k.updateQueue,D.updateQueue=k,Po(D,k),Ps(ce,!0),ce.tail===null&&ce.tailMode==="hidden"&&!xe.alternate&&!Gt)return ar(D),null}else 2*ot()-ce.renderingStartTime>Bo&&H!==536870912&&(D.flags|=128,me=!0,Ps(ce,!1),D.lanes=4194304);ce.isBackwards?(xe.sibling=D.child,D.child=xe):(k=ce.last,k!==null?k.sibling=xe:D.child=xe,ce.last=xe)}return ce.tail!==null?(k=ce.tail,ce.rendering=k,ce.tail=k.sibling,ce.renderingStartTime=ot(),k.sibling=null,H=fr.current,ue(fr,me?H&1|2:H&1),Gt&&$n(D,ce.treeForkCount),k):(ar(D),null);case 22:case 23:return Xr(D),Za(),ce=D.memoizedState!==null,k!==null?k.memoizedState!==null!==ce&&(D.flags|=8192):ce&&(D.flags|=8192),ce?(H&536870912)!==0&&(D.flags&128)===0&&(ar(D),D.subtreeFlags&6&&(D.flags|=8192)):ar(D),H=D.updateQueue,H!==null&&Po(D,H.retryQueue),H=null,k!==null&&k.memoizedState!==null&&k.memoizedState.cachePool!==null&&(H=k.memoizedState.cachePool.pool),ce=null,D.memoizedState!==null&&D.memoizedState.cachePool!==null&&(ce=D.memoizedState.cachePool.pool),ce!==H&&(D.flags|=2048),k!==null&&Z(bi),null;case 24:return H=null,k!==null&&(H=k.memoizedState.cache),D.memoizedState.cache!==H&&(D.flags|=2048),Tn(pr),ar(D),null;case 25:return null;case 30:return null}throw Error(v(156,D.tag))}function w0(k,D){switch(Oa(D),D.tag){case 1:return k=D.flags,k&65536?(D.flags=k&-65537|128,D):null;case 3:return Tn(pr),Te(),k=D.flags,(k&65536)!==0&&(k&128)===0?(D.flags=k&-65537|128,D):null;case 26:case 27:case 5:return Ie(D),null;case 31:if(D.memoizedState!==null){if(Xr(D),D.alternate===null)throw Error(v(340));gi()}return k=D.flags,k&65536?(D.flags=k&-65537|128,D):null;case 13:if(Xr(D),k=D.memoizedState,k!==null&&k.dehydrated!==null){if(D.alternate===null)throw Error(v(340));gi()}return k=D.flags,k&65536?(D.flags=k&-65537|128,D):null;case 19:return Z(fr),null;case 4:return Te(),null;case 10:return Tn(D.type),null;case 22:case 23:return Xr(D),Za(),k!==null&&Z(bi),k=D.flags,k&65536?(D.flags=k&-65537|128,D):null;case 24:return Tn(pr),null;case 25:return null;default:return null}}function Id(k,D){switch(Oa(D),D.tag){case 3:Tn(pr),Te();break;case 26:case 27:case 5:Ie(D);break;case 4:Te();break;case 31:D.memoizedState!==null&&Xr(D);break;case 13:Xr(D);break;case 19:Z(fr);break;case 10:Tn(D.type);break;case 22:case 23:Xr(D),Za(),k!==null&&Z(bi);break;case 24:Tn(pr)}}function Ns(k,D){try{var H=D.updateQueue,ce=H!==null?H.lastEffect:null;if(ce!==null){var me=ce.next;H=me;do{if((H.tag&k)===k){ce=void 0;var xe=H.create,Ne=H.inst;ce=xe(),Ne.destroy=ce}H=H.next}while(H!==me)}}catch(Fe){er(D,D.return,Fe)}}function Jn(k,D,H){try{var ce=D.updateQueue,me=ce!==null?ce.lastEffect:null;if(me!==null){var xe=me.next;ce=xe;do{if((ce.tag&k)===k){var Ne=ce.inst,Fe=Ne.destroy;if(Fe!==void 0){Ne.destroy=void 0,me=D;var Ye=H,st=Fe;try{st()}catch(yt){er(me,Ye,yt)}}}ce=ce.next}while(ce!==xe)}}catch(yt){er(D,D.return,yt)}}function Pd(k){var D=k.updateQueue;if(D!==null){var H=k.stateNode;try{bu(D,H)}catch(ce){er(k,k.return,ce)}}}function Nd(k,D,H){H.props=Si(k.type,k.memoizedProps),H.state=k.memoizedState;try{H.componentWillUnmount()}catch(ce){er(k,D,ce)}}function Ms(k,D){try{var H=k.ref;if(H!==null){switch(k.tag){case 26:case 27:case 5:var ce=k.stateNode;break;case 30:ce=k.stateNode;break;default:ce=k.stateNode}typeof H=="function"?k.refCleanup=H(ce):H.current=ce}}catch(me){er(k,D,me)}}function wn(k,D){var H=k.ref,ce=k.refCleanup;if(H!==null)if(typeof ce=="function")try{ce()}catch(me){er(k,D,me)}finally{k.refCleanup=null,k=k.alternate,k!=null&&(k.refCleanup=null)}else if(typeof H=="function")try{H(null)}catch(me){er(k,D,me)}else H.current=null}function Md(k){var D=k.type,H=k.memoizedProps,ce=k.stateNode;try{e:switch(D){case"button":case"input":case"select":case"textarea":H.autoFocus&&ce.focus();break e;case"img":H.src?ce.src=H.src:H.srcSet&&(ce.srcset=H.srcSet)}}catch(me){er(k,k.return,me)}}function Tc(k,D,H){try{var ce=k.stateNode;H0(ce,k.type,H,D),ce[It]=D}catch(me){er(k,k.return,me)}}function Od(k){return k.tag===5||k.tag===3||k.tag===26||k.tag===27&&si(k.type)||k.tag===4}function kc(k){e:for(;;){for(;k.sibling===null;){if(k.return===null||Od(k.return))return null;k=k.return}for(k.sibling.return=k.return,k=k.sibling;k.tag!==5&&k.tag!==6&&k.tag!==18;){if(k.tag===27&&si(k.type)||k.flags&2||k.child===null||k.tag===4)continue e;k.child.return=k,k=k.child}if(!(k.flags&2))return k.stateNode}}function Ic(k,D,H){var ce=k.tag;if(ce===5||ce===6)k=k.stateNode,D?(H.nodeType===9?H.body:H.nodeName==="HTML"?H.ownerDocument.body:H).insertBefore(k,D):(D=H.nodeType===9?H.body:H.nodeName==="HTML"?H.ownerDocument.body:H,D.appendChild(k),H=H._reactRootContainer,H!=null||D.onclick!==null||(D.onclick=Sn));else if(ce!==4&&(ce===27&&si(k.type)&&(H=k.stateNode,D=null),k=k.child,k!==null))for(Ic(k,D,H),k=k.sibling;k!==null;)Ic(k,D,H),k=k.sibling}function No(k,D,H){var ce=k.tag;if(ce===5||ce===6)k=k.stateNode,D?H.insertBefore(k,D):H.appendChild(k);else if(ce!==4&&(ce===27&&si(k.type)&&(H=k.stateNode),k=k.child,k!==null))for(No(k,D,H),k=k.sibling;k!==null;)No(k,D,H),k=k.sibling}function Dd(k){var D=k.stateNode,H=k.memoizedProps;try{for(var ce=k.type,me=D.attributes;me.length;)D.removeAttributeNode(me[0]);Ir(D,ce,H),D[Tt]=k,D[It]=H}catch(xe){er(k,k.return,xe)}}var Mn=!1,vr=!1,Pc=!1,Bd=typeof WeakSet=="function"?WeakSet:Set,Ar=null;function E0(k,D){if(k=k.containerInfo,Qc=ea,k=Vl(k),Sa(k)){if("selectionStart"in k)var H={start:k.selectionStart,end:k.selectionEnd};else e:{H=(H=k.ownerDocument)&&H.defaultView||window;var ce=H.getSelection&&H.getSelection();if(ce&&ce.rangeCount!==0){H=ce.anchorNode;var me=ce.anchorOffset,xe=ce.focusNode;ce=ce.focusOffset;try{H.nodeType,xe.nodeType}catch{H=null;break e}var Ne=0,Fe=-1,Ye=-1,st=0,yt=0,Et=k,ct=null;t:for(;;){for(var pt;Et!==H||me!==0&&Et.nodeType!==3||(Fe=Ne+me),Et!==xe||ce!==0&&Et.nodeType!==3||(Ye=Ne+ce),Et.nodeType===3&&(Ne+=Et.nodeValue.length),(pt=Et.firstChild)!==null;)ct=Et,Et=pt;for(;;){if(Et===k)break t;if(ct===H&&++st===me&&(Fe=Ne),ct===xe&&++yt===ce&&(Ye=Ne),(pt=Et.nextSibling)!==null)break;Et=ct,ct=Et.parentNode}Et=pt}H=Fe===-1||Ye===-1?null:{start:Fe,end:Ye}}else H=null}H=H||{start:0,end:0}}else H=null;for(el={focusedElem:k,selectionRange:H},ea=!1,Ar=D;Ar!==null;)if(D=Ar,k=D.child,(D.subtreeFlags&1028)!==0&&k!==null)k.return=D,Ar=k;else for(;Ar!==null;){switch(D=Ar,xe=D.alternate,k=D.flags,D.tag){case 0:if((k&4)!==0&&(k=D.updateQueue,k=k!==null?k.events:null,k!==null))for(H=0;H<k.length;H++)me=k[H],me.ref.impl=me.nextImpl;break;case 11:case 15:break;case 1:if((k&1024)!==0&&xe!==null){k=void 0,H=D,me=xe.memoizedProps,xe=xe.memoizedState,ce=H.stateNode;try{var Mt=Si(H.type,me);k=ce.getSnapshotBeforeUpdate(Mt,xe),ce.__reactInternalSnapshotBeforeUpdate=k}catch(Lt){er(H,H.return,Lt)}}break;case 3:if((k&1024)!==0){if(k=D.stateNode.containerInfo,H=k.nodeType,H===9)nl(k);else if(H===1)switch(k.nodeName){case"HEAD":case"HTML":case"BODY":nl(k);break;default:k.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((k&1024)!==0)throw Error(v(163))}if(k=D.sibling,k!==null){k.return=D.return,Ar=k;break}Ar=D.return}}function Ld(k,D,H){var ce=H.flags;switch(H.tag){case 0:case 11:case 15:Dn(k,H),ce&4&&Ns(5,H);break;case 1:if(Dn(k,H),ce&4)if(k=H.stateNode,D===null)try{k.componentDidMount()}catch(Ne){er(H,H.return,Ne)}else{var me=Si(H.type,D.memoizedProps);D=D.memoizedState;try{k.componentDidUpdate(me,D,k.__reactInternalSnapshotBeforeUpdate)}catch(Ne){er(H,H.return,Ne)}}ce&64&&Pd(H),ce&512&&Ms(H,H.return);break;case 3:if(Dn(k,H),ce&64&&(k=H.updateQueue,k!==null)){if(D=null,H.child!==null)switch(H.child.tag){case 27:case 5:D=H.child.stateNode;break;case 1:D=H.child.stateNode}try{bu(k,D)}catch(Ne){er(H,H.return,Ne)}}break;case 27:D===null&&ce&4&&Dd(H);case 26:case 5:Dn(k,H),D===null&&ce&4&&Md(H),ce&512&&Ms(H,H.return);break;case 12:Dn(k,H);break;case 31:Dn(k,H),ce&4&&Ud(k,H);break;case 13:Dn(k,H),ce&4&&qd(k,H),ce&64&&(k=H.memoizedState,k!==null&&(k=k.dehydrated,k!==null&&(H=I0.bind(null,H),X0(k,H))));break;case 22:if(ce=H.memoizedState!==null||Mn,!ce){D=D!==null&&D.memoizedState!==null||vr,me=Mn;var xe=vr;Mn=ce,(vr=D)&&!xe?Bn(k,H,(H.subtreeFlags&8772)!==0):Dn(k,H),Mn=me,vr=xe}break;case 30:break;default:Dn(k,H)}}function jd(k){var D=k.alternate;D!==null&&(k.alternate=null,jd(D)),k.child=null,k.deletions=null,k.sibling=null,k.tag===5&&(D=k.stateNode,D!==null&&Pr(D)),k.stateNode=null,k.return=null,k.dependencies=null,k.memoizedProps=null,k.memoizedState=null,k.pendingProps=null,k.stateNode=null,k.updateQueue=null}var lr=null,Fr=!1;function On(k,D,H){for(H=H.child;H!==null;)Fd(k,D,H),H=H.sibling}function Fd(k,D,H){if(je&&typeof je.onCommitFiberUnmount=="function")try{je.onCommitFiberUnmount(Pe,H)}catch{}switch(H.tag){case 26:vr||wn(H,D),On(k,D,H),H.memoizedState?H.memoizedState.count--:H.stateNode&&(H=H.stateNode,H.parentNode.removeChild(H));break;case 27:vr||wn(H,D);var ce=lr,me=Fr;si(H.type)&&(lr=H.stateNode,Fr=!1),On(k,D,H),Hs(H.stateNode),lr=ce,Fr=me;break;case 5:vr||wn(H,D);case 6:if(ce=lr,me=Fr,lr=null,On(k,D,H),lr=ce,Fr=me,lr!==null)if(Fr)try{(lr.nodeType===9?lr.body:lr.nodeName==="HTML"?lr.ownerDocument.body:lr).removeChild(H.stateNode)}catch(xe){er(H,D,xe)}else try{lr.removeChild(H.stateNode)}catch(xe){er(H,D,xe)}break;case 18:lr!==null&&(Fr?(k=lr,Nf(k.nodeType===9?k.body:k.nodeName==="HTML"?k.ownerDocument.body:k,H.stateNode),os(k)):Nf(lr,H.stateNode));break;case 4:ce=lr,me=Fr,lr=H.stateNode.containerInfo,Fr=!0,On(k,D,H),lr=ce,Fr=me;break;case 0:case 11:case 14:case 15:Jn(2,H,D),vr||Jn(4,H,D),On(k,D,H);break;case 1:vr||(wn(H,D),ce=H.stateNode,typeof ce.componentWillUnmount=="function"&&Nd(H,D,ce)),On(k,D,H);break;case 21:On(k,D,H);break;case 22:vr=(ce=vr)||H.memoizedState!==null,On(k,D,H),vr=ce;break;default:On(k,D,H)}}function Ud(k,D){if(D.memoizedState===null&&(k=D.alternate,k!==null&&(k=k.memoizedState,k!==null))){k=k.dehydrated;try{os(k)}catch(H){er(D,D.return,H)}}}function qd(k,D){if(D.memoizedState===null&&(k=D.alternate,k!==null&&(k=k.memoizedState,k!==null&&(k=k.dehydrated,k!==null))))try{os(k)}catch(H){er(D,D.return,H)}}function _0(k){switch(k.tag){case 31:case 13:case 19:var D=k.stateNode;return D===null&&(D=k.stateNode=new Bd),D;case 22:return k=k.stateNode,D=k._retryCache,D===null&&(D=k._retryCache=new Bd),D;default:throw Error(v(435,k.tag))}}function Mo(k,D){var H=_0(k);D.forEach(function(ce){if(!H.has(ce)){H.add(ce);var me=P0.bind(null,k,ce);ce.then(me,me)}})}function Ur(k,D){var H=D.deletions;if(H!==null)for(var ce=0;ce<H.length;ce++){var me=H[ce],xe=k,Ne=D,Fe=Ne;e:for(;Fe!==null;){switch(Fe.tag){case 27:if(si(Fe.type)){lr=Fe.stateNode,Fr=!1;break e}break;case 5:lr=Fe.stateNode,Fr=!1;break e;case 3:case 4:lr=Fe.stateNode.containerInfo,Fr=!0;break e}Fe=Fe.return}if(lr===null)throw Error(v(160));Fd(xe,Ne,me),lr=null,Fr=!1,xe=me.alternate,xe!==null&&(xe.return=null),me.return=null}if(D.subtreeFlags&13886)for(D=D.child;D!==null;)Hd(D,k),D=D.sibling}var gn=null;function Hd(k,D){var H=k.alternate,ce=k.flags;switch(k.tag){case 0:case 11:case 14:case 15:Ur(D,k),qr(k),ce&4&&(Jn(3,k,k.return),Ns(3,k),Jn(5,k,k.return));break;case 1:Ur(D,k),qr(k),ce&512&&(vr||H===null||wn(H,H.return)),ce&64&&Mn&&(k=k.updateQueue,k!==null&&(ce=k.callbacks,ce!==null&&(H=k.shared.hiddenCallbacks,k.shared.hiddenCallbacks=H===null?ce:H.concat(ce))));break;case 26:var me=gn;if(Ur(D,k),qr(k),ce&512&&(vr||H===null||wn(H,H.return)),ce&4){var xe=H!==null?H.memoizedState:null;if(ce=k.memoizedState,H===null)if(ce===null)if(k.stateNode===null){e:{ce=k.type,H=k.memoizedProps,me=me.ownerDocument||me;t:switch(ce){case"title":xe=me.getElementsByTagName("title")[0],(!xe||xe[Cr]||xe[Tt]||xe.namespaceURI==="http://www.w3.org/2000/svg"||xe.hasAttribute("itemprop"))&&(xe=me.createElement(ce),me.head.insertBefore(xe,me.querySelector("head > title"))),Ir(xe,ce,H),xe[Tt]=k,Jt(xe),ce=xe;break e;case"link":var Ne=zf("link","href",me).get(ce+(H.href||""));if(Ne){for(var Fe=0;Fe<Ne.length;Fe++)if(xe=Ne[Fe],xe.getAttribute("href")===(H.href==null||H.href===""?null:H.href)&&xe.getAttribute("rel")===(H.rel==null?null:H.rel)&&xe.getAttribute("title")===(H.title==null?null:H.title)&&xe.getAttribute("crossorigin")===(H.crossOrigin==null?null:H.crossOrigin)){Ne.splice(Fe,1);break t}}xe=me.createElement(ce),Ir(xe,ce,H),me.head.appendChild(xe);break;case"meta":if(Ne=zf("meta","content",me).get(ce+(H.content||""))){for(Fe=0;Fe<Ne.length;Fe++)if(xe=Ne[Fe],xe.getAttribute("content")===(H.content==null?null:""+H.content)&&xe.getAttribute("name")===(H.name==null?null:H.name)&&xe.getAttribute("property")===(H.property==null?null:H.property)&&xe.getAttribute("http-equiv")===(H.httpEquiv==null?null:H.httpEquiv)&&xe.getAttribute("charset")===(H.charSet==null?null:H.charSet)){Ne.splice(Fe,1);break t}}xe=me.createElement(ce),Ir(xe,ce,H),me.head.appendChild(xe);break;default:throw Error(v(468,ce))}xe[Tt]=k,Jt(xe),ce=xe}k.stateNode=ce}else Kf(me,k.type,k.stateNode);else k.stateNode=Hf(me,ce,k.memoizedProps);else xe!==ce?(xe===null?H.stateNode!==null&&(H=H.stateNode,H.parentNode.removeChild(H)):xe.count--,ce===null?Kf(me,k.type,k.stateNode):Hf(me,ce,k.memoizedProps)):ce===null&&k.stateNode!==null&&Tc(k,k.memoizedProps,H.memoizedProps)}break;case 27:Ur(D,k),qr(k),ce&512&&(vr||H===null||wn(H,H.return)),H!==null&&ce&4&&Tc(k,k.memoizedProps,H.memoizedProps);break;case 5:if(Ur(D,k),qr(k),ce&512&&(vr||H===null||wn(H,H.return)),k.flags&32){me=k.stateNode;try{Ri(me,"")}catch(Mt){er(k,k.return,Mt)}}ce&4&&k.stateNode!=null&&(me=k.memoizedProps,Tc(k,me,H!==null?H.memoizedProps:me)),ce&1024&&(Pc=!0);break;case 6:if(Ur(D,k),qr(k),ce&4){if(k.stateNode===null)throw Error(v(162));ce=k.memoizedProps,H=k.stateNode;try{H.nodeValue=ce}catch(Mt){er(k,k.return,Mt)}}break;case 3:if(Zo=null,me=gn,gn=Wo(D.containerInfo),Ur(D,k),gn=me,qr(k),ce&4&&H!==null&&H.memoizedState.isDehydrated)try{os(D.containerInfo)}catch(Mt){er(k,k.return,Mt)}Pc&&(Pc=!1,zd(k));break;case 4:ce=gn,gn=Wo(k.stateNode.containerInfo),Ur(D,k),qr(k),gn=ce;break;case 12:Ur(D,k),qr(k);break;case 31:Ur(D,k),qr(k),ce&4&&(ce=k.updateQueue,ce!==null&&(k.updateQueue=null,Mo(k,ce)));break;case 13:Ur(D,k),qr(k),k.child.flags&8192&&k.memoizedState!==null!=(H!==null&&H.memoizedState!==null)&&(Do=ot()),ce&4&&(ce=k.updateQueue,ce!==null&&(k.updateQueue=null,Mo(k,ce)));break;case 22:me=k.memoizedState!==null;var Ye=H!==null&&H.memoizedState!==null,st=Mn,yt=vr;if(Mn=st||me,vr=yt||Ye,Ur(D,k),vr=yt,Mn=st,qr(k),ce&8192)e:for(D=k.stateNode,D._visibility=me?D._visibility&-2:D._visibility|1,me&&(H===null||Ye||Mn||vr||Ai(k)),H=null,D=k;;){if(D.tag===5||D.tag===26){if(H===null){Ye=H=D;try{if(xe=Ye.stateNode,me)Ne=xe.style,typeof Ne.setProperty=="function"?Ne.setProperty("display","none","important"):Ne.display="none";else{Fe=Ye.stateNode;var Et=Ye.memoizedProps.style,ct=Et!=null&&Et.hasOwnProperty("display")?Et.display:null;Fe.style.display=ct==null||typeof ct=="boolean"?"":(""+ct).trim()}}catch(Mt){er(Ye,Ye.return,Mt)}}}else if(D.tag===6){if(H===null){Ye=D;try{Ye.stateNode.nodeValue=me?"":Ye.memoizedProps}catch(Mt){er(Ye,Ye.return,Mt)}}}else if(D.tag===18){if(H===null){Ye=D;try{var pt=Ye.stateNode;me?Mf(pt,!0):Mf(Ye.stateNode,!1)}catch(Mt){er(Ye,Ye.return,Mt)}}}else if((D.tag!==22&&D.tag!==23||D.memoizedState===null||D===k)&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===k)break e;for(;D.sibling===null;){if(D.return===null||D.return===k)break e;H===D&&(H=null),D=D.return}H===D&&(H=null),D.sibling.return=D.return,D=D.sibling}ce&4&&(ce=k.updateQueue,ce!==null&&(H=ce.retryQueue,H!==null&&(ce.retryQueue=null,Mo(k,H))));break;case 19:Ur(D,k),qr(k),ce&4&&(ce=k.updateQueue,ce!==null&&(k.updateQueue=null,Mo(k,ce)));break;case 30:break;case 21:break;default:Ur(D,k),qr(k)}}function qr(k){var D=k.flags;if(D&2){try{for(var H,ce=k.return;ce!==null;){if(Od(ce)){H=ce;break}ce=ce.return}if(H==null)throw Error(v(160));switch(H.tag){case 27:var me=H.stateNode,xe=kc(k);No(k,xe,me);break;case 5:var Ne=H.stateNode;H.flags&32&&(Ri(Ne,""),H.flags&=-33);var Fe=kc(k);No(k,Fe,Ne);break;case 3:case 4:var Ye=H.stateNode.containerInfo,st=kc(k);Ic(k,st,Ye);break;default:throw Error(v(161))}}catch(yt){er(k,k.return,yt)}k.flags&=-3}D&4096&&(k.flags&=-4097)}function zd(k){if(k.subtreeFlags&1024)for(k=k.child;k!==null;){var D=k;zd(D),D.tag===5&&D.flags&1024&&D.stateNode.reset(),k=k.sibling}}function Dn(k,D){if(D.subtreeFlags&8772)for(D=D.child;D!==null;)Ld(k,D.alternate,D),D=D.sibling}function Ai(k){for(k=k.child;k!==null;){var D=k;switch(D.tag){case 0:case 11:case 14:case 15:Jn(4,D,D.return),Ai(D);break;case 1:wn(D,D.return);var H=D.stateNode;typeof H.componentWillUnmount=="function"&&Nd(D,D.return,H),Ai(D);break;case 27:Hs(D.stateNode);case 26:case 5:wn(D,D.return),Ai(D);break;case 22:D.memoizedState===null&&Ai(D);break;case 30:Ai(D);break;default:Ai(D)}k=k.sibling}}function Bn(k,D,H){for(H=H&&(D.subtreeFlags&8772)!==0,D=D.child;D!==null;){var ce=D.alternate,me=k,xe=D,Ne=xe.flags;switch(xe.tag){case 0:case 11:case 15:Bn(me,xe,H),Ns(4,xe);break;case 1:if(Bn(me,xe,H),ce=xe,me=ce.stateNode,typeof me.componentDidMount=="function")try{me.componentDidMount()}catch(st){er(ce,ce.return,st)}if(ce=xe,me=ce.updateQueue,me!==null){var Fe=ce.stateNode;try{var Ye=me.shared.hiddenCallbacks;if(Ye!==null)for(me.shared.hiddenCallbacks=null,me=0;me<Ye.length;me++)vu(Ye[me],Fe)}catch(st){er(ce,ce.return,st)}}H&&Ne&64&&Pd(xe),Ms(xe,xe.return);break;case 27:Dd(xe);case 26:case 5:Bn(me,xe,H),H&&ce===null&&Ne&4&&Md(xe),Ms(xe,xe.return);break;case 12:Bn(me,xe,H);break;case 31:Bn(me,xe,H),H&&Ne&4&&Ud(me,xe);break;case 13:Bn(me,xe,H),H&&Ne&4&&qd(me,xe);break;case 22:xe.memoizedState===null&&Bn(me,xe,H),Ms(xe,xe.return);break;case 30:break;default:Bn(me,xe,H)}D=D.sibling}}function Nc(k,D){var H=null;k!==null&&k.memoizedState!==null&&k.memoizedState.cachePool!==null&&(H=k.memoizedState.cachePool.pool),k=null,D.memoizedState!==null&&D.memoizedState.cachePool!==null&&(k=D.memoizedState.cachePool.pool),k!==H&&(k!=null&&k.refCount++,H!=null&&bs(H))}function Mc(k,D){k=null,D.alternate!==null&&(k=D.alternate.memoizedState.cache),D=D.memoizedState.cache,D!==k&&(D.refCount++,k!=null&&bs(k))}function yn(k,D,H,ce){if(D.subtreeFlags&10256)for(D=D.child;D!==null;)Kd(k,D,H,ce),D=D.sibling}function Kd(k,D,H,ce){var me=D.flags;switch(D.tag){case 0:case 11:case 15:yn(k,D,H,ce),me&2048&&Ns(9,D);break;case 1:yn(k,D,H,ce);break;case 3:yn(k,D,H,ce),me&2048&&(k=null,D.alternate!==null&&(k=D.alternate.memoizedState.cache),D=D.memoizedState.cache,D!==k&&(D.refCount++,k!=null&&bs(k)));break;case 12:if(me&2048){yn(k,D,H,ce),k=D.stateNode;try{var xe=D.memoizedProps,Ne=xe.id,Fe=xe.onPostCommit;typeof Fe=="function"&&Fe(Ne,D.alternate===null?"mount":"update",k.passiveEffectDuration,-0)}catch(Ye){er(D,D.return,Ye)}}else yn(k,D,H,ce);break;case 31:yn(k,D,H,ce);break;case 13:yn(k,D,H,ce);break;case 23:break;case 22:xe=D.stateNode,Ne=D.alternate,D.memoizedState!==null?xe._visibility&2?yn(k,D,H,ce):Os(k,D):xe._visibility&2?yn(k,D,H,ce):(xe._visibility|=2,Wi(k,D,H,ce,(D.subtreeFlags&10256)!==0||!1)),me&2048&&Nc(Ne,D);break;case 24:yn(k,D,H,ce),me&2048&&Mc(D.alternate,D);break;default:yn(k,D,H,ce)}}function Wi(k,D,H,ce,me){for(me=me&&((D.subtreeFlags&10256)!==0||!1),D=D.child;D!==null;){var xe=k,Ne=D,Fe=H,Ye=ce,st=Ne.flags;switch(Ne.tag){case 0:case 11:case 15:Wi(xe,Ne,Fe,Ye,me),Ns(8,Ne);break;case 23:break;case 22:var yt=Ne.stateNode;Ne.memoizedState!==null?yt._visibility&2?Wi(xe,Ne,Fe,Ye,me):Os(xe,Ne):(yt._visibility|=2,Wi(xe,Ne,Fe,Ye,me)),me&&st&2048&&Nc(Ne.alternate,Ne);break;case 24:Wi(xe,Ne,Fe,Ye,me),me&&st&2048&&Mc(Ne.alternate,Ne);break;default:Wi(xe,Ne,Fe,Ye,me)}D=D.sibling}}function Os(k,D){if(D.subtreeFlags&10256)for(D=D.child;D!==null;){var H=k,ce=D,me=ce.flags;switch(ce.tag){case 22:Os(H,ce),me&2048&&Nc(ce.alternate,ce);break;case 24:Os(H,ce),me&2048&&Mc(ce.alternate,ce);break;default:Os(H,ce)}D=D.sibling}}var Ds=8192;function Yi(k,D,H){if(k.subtreeFlags&Ds)for(k=k.child;k!==null;)Vd(k,D,H),k=k.sibling}function Vd(k,D,H){switch(k.tag){case 26:Yi(k,D,H),k.flags&Ds&&k.memoizedState!==null&&lp(H,gn,k.memoizedState,k.memoizedProps);break;case 5:Yi(k,D,H);break;case 3:case 4:var ce=gn;gn=Wo(k.stateNode.containerInfo),Yi(k,D,H),gn=ce;break;case 22:k.memoizedState===null&&(ce=k.alternate,ce!==null&&ce.memoizedState!==null?(ce=Ds,Ds=16777216,Yi(k,D,H),Ds=ce):Yi(k,D,H));break;default:Yi(k,D,H)}}function Gd(k){var D=k.alternate;if(D!==null&&(k=D.child,k!==null)){D.child=null;do D=k.sibling,k.sibling=null,k=D;while(k!==null)}}function Bs(k){var D=k.deletions;if((k.flags&16)!==0){if(D!==null)for(var H=0;H<D.length;H++){var ce=D[H];Ar=ce,Yd(ce,k)}Gd(k)}if(k.subtreeFlags&10256)for(k=k.child;k!==null;)Wd(k),k=k.sibling}function Wd(k){switch(k.tag){case 0:case 11:case 15:Bs(k),k.flags&2048&&Jn(9,k,k.return);break;case 3:Bs(k);break;case 12:Bs(k);break;case 22:var D=k.stateNode;k.memoizedState!==null&&D._visibility&2&&(k.return===null||k.return.tag!==13)?(D._visibility&=-3,Oo(k)):Bs(k);break;default:Bs(k)}}function Oo(k){var D=k.deletions;if((k.flags&16)!==0){if(D!==null)for(var H=0;H<D.length;H++){var ce=D[H];Ar=ce,Yd(ce,k)}Gd(k)}for(k=k.child;k!==null;){switch(D=k,D.tag){case 0:case 11:case 15:Jn(8,D,D.return),Oo(D);break;case 22:H=D.stateNode,H._visibility&2&&(H._visibility&=-3,Oo(D));break;default:Oo(D)}k=k.sibling}}function Yd(k,D){for(;Ar!==null;){var H=Ar;switch(H.tag){case 0:case 11:case 15:Jn(8,H,D);break;case 23:case 22:if(H.memoizedState!==null&&H.memoizedState.cachePool!==null){var ce=H.memoizedState.cachePool.pool;ce!=null&&ce.refCount++}break;case 24:bs(H.memoizedState.cache)}if(ce=H.child,ce!==null)ce.return=H,Ar=ce;else e:for(H=k;Ar!==null;){ce=Ar;var me=ce.sibling,xe=ce.return;if(jd(ce),ce===H){Ar=null;break e}if(me!==null){me.return=xe,Ar=me;break e}Ar=xe}}}var S0={getCacheForType:function(k){var D=Tr(pr),H=D.data.get(k);return H===void 0&&(H=k(),D.data.set(k,H)),H},cacheSignal:function(){return Tr(pr).controller.signal}},A0=typeof WeakMap=="function"?WeakMap:Map,Xt=0,ir=null,Ht=null,Kt=0,Qt=0,Jr=null,Qn=!1,Zi=!1,Oc=!1,Ln=0,dr=0,ei=0,Ci=0,Dc=0,Qr=0,Xi=0,Ls=null,Hr=null,Bc=!1,Do=0,Zd=0,Bo=1/0,Lo=null,ti=null,xr=0,ri=null,Ji=null,jn=0,Lc=0,jc=null,Xd=null,js=0,Fc=null;function en(){return(Xt&2)!==0&&Kt!==0?Kt&-Kt:re.T!==null?Vc():Nt()}function Jd(){if(Qr===0)if((Kt&536870912)===0||Gt){var k=at;at<<=1,(at&3932160)===0&&(at=262144),Qr=k}else Qr=536870912;return k=Zr.current,k!==null&&(k.flags|=32),Qr}function zr(k,D,H){(k===ir&&(Qt===2||Qt===9)||k.cancelPendingCommit!==null)&&(Qi(k,0),ni(k,Kt,Qr,!1)),$e(k,H),((Xt&2)===0||k!==ir)&&(k===ir&&((Xt&2)===0&&(Ci|=H),dr===4&&ni(k,Kt,Qr,!1)),En(k))}function Qd(k,D,H){if((Xt&6)!==0)throw Error(v(327));var ce=!H&&(D&127)===0&&(D&k.expiredLanes)===0||St(k,D),me=ce?R0(k,D):qc(k,D,!0),xe=ce;do{if(me===0){Zi&&!ce&&ni(k,D,0,!1);break}else{if(H=k.current.alternate,xe&&!C0(H)){me=qc(k,D,!1),xe=!1;continue}if(me===2){if(xe=D,k.errorRecoveryDisabledLanes&xe)var Ne=0;else Ne=k.pendingLanes&-536870913,Ne=Ne!==0?Ne:Ne&536870912?536870912:0;if(Ne!==0){D=Ne;e:{var Fe=k;me=Ls;var Ye=Fe.current.memoizedState.isDehydrated;if(Ye&&(Qi(Fe,Ne).flags|=256),Ne=qc(Fe,Ne,!1),Ne!==2){if(Oc&&!Ye){Fe.errorRecoveryDisabledLanes|=xe,Ci|=xe,me=4;break e}xe=Hr,Hr=me,xe!==null&&(Hr===null?Hr=xe:Hr.push.apply(Hr,xe))}me=Ne}if(xe=!1,me!==2)continue}}if(me===1){Qi(k,0),ni(k,D,0,!0);break}e:{switch(ce=k,xe=me,xe){case 0:case 1:throw Error(v(345));case 4:if((D&4194048)!==D)break;case 6:ni(ce,D,Qr,!Qn);break e;case 2:Hr=null;break;case 3:case 5:break;default:throw Error(v(329))}if((D&62914560)===D&&(me=Do+300-ot(),10<me)){if(ni(ce,D,Qr,!Qn),$t(ce,0,!0)!==0)break e;jn=D,ce.timeoutHandle=If(ef.bind(null,ce,H,Hr,Lo,Bc,D,Qr,Ci,Xi,Qn,xe,"Throttled",-0,0),me);break e}ef(ce,H,Hr,Lo,Bc,D,Qr,Ci,Xi,Qn,xe,null,-0,0)}}break}while(!0);En(k)}function ef(k,D,H,ce,me,xe,Ne,Fe,Ye,st,yt,Et,ct,pt){if(k.timeoutHandle=-1,Et=D.subtreeFlags,Et&8192||(Et&16785408)===16785408){Et={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Sn},Vd(D,xe,Et);var Mt=(xe&62914560)===xe?Do-ot():(xe&4194048)===xe?Zd-ot():0;if(Mt=up(Et,Mt),Mt!==null){jn=xe,k.cancelPendingCommit=Mt(lf.bind(null,k,D,xe,H,ce,me,Ne,Fe,Ye,yt,Et,null,ct,pt)),ni(k,xe,Ne,!st);return}}lf(k,D,xe,H,ce,me,Ne,Fe,Ye)}function C0(k){for(var D=k;;){var H=D.tag;if((H===0||H===11||H===15)&&D.flags&16384&&(H=D.updateQueue,H!==null&&(H=H.stores,H!==null)))for(var ce=0;ce<H.length;ce++){var me=H[ce],xe=me.getSnapshot;me=me.value;try{if(!Wr(xe(),me))return!1}catch{return!1}}if(H=D.child,D.subtreeFlags&16384&&H!==null)H.return=D,D=H;else{if(D===k)break;for(;D.sibling===null;){if(D.return===null||D.return===k)return!0;D=D.return}D.sibling.return=D.return,D=D.sibling}}return!0}function ni(k,D,H,ce){D&=~Dc,D&=~Ci,k.suspendedLanes|=D,k.pingedLanes&=~D,ce&&(k.warmLanes|=D),ce=k.expirationTimes;for(var me=D;0<me;){var xe=31-Ve(me),Ne=1<<xe;ce[xe]=-1,me&=~Ne}H!==0&&Ue(k,H,D)}function jo(){return(Xt&6)===0?(Fs(0),!1):!0}function Uc(){if(Ht!==null){if(Qt===0)var k=Ht.return;else k=Ht,Rn=yi=null,nc(k),Hi=null,Es=0,k=Ht;for(;k!==null;)Id(k.alternate,k),k=k.return;Ht=null}}function Qi(k,D){var H=k.timeoutHandle;H!==-1&&(k.timeoutHandle=-1,V0(H)),H=k.cancelPendingCommit,H!==null&&(k.cancelPendingCommit=null,H()),jn=0,Uc(),ir=k,Ht=H=Cn(k.current,null),Kt=D,Qt=0,Jr=null,Qn=!1,Zi=St(k,D),Oc=!1,Xi=Qr=Dc=Ci=ei=dr=0,Hr=Ls=null,Bc=!1,(D&8)!==0&&(D|=D&32);var ce=k.entangledLanes;if(ce!==0)for(k=k.entanglements,ce&=D;0<ce;){var me=31-Ve(ce),xe=1<<me;D|=k[me],ce&=~xe}return Ln=D,so(),H}function tf(k,D){Ut=null,re.H=ks,D===qi||D===po?(D=pu(),Qt=3):D===za?(D=pu(),Qt=4):Qt=D===bc?8:D!==null&&typeof D=="object"&&typeof D.then=="function"?6:1,Jr=D,Ht===null&&(dr=1,Ro(k,cn(D,k.current)))}function rf(){var k=Zr.current;return k===null?!0:(Kt&4194048)===Kt?fn===null:(Kt&62914560)===Kt||(Kt&536870912)!==0?k===fn:!1}function nf(){var k=re.H;return re.H=ks,k===null?ks:k}function sf(){var k=re.A;return re.A=S0,k}function Fo(){dr=4,Qn||(Kt&4194048)!==Kt&&Zr.current!==null||(Zi=!0),(ei&134217727)===0&&(Ci&134217727)===0||ir===null||ni(ir,Kt,Qr,!1)}function qc(k,D,H){var ce=Xt;Xt|=2;var me=nf(),xe=sf();(ir!==k||Kt!==D)&&(Lo=null,Qi(k,D)),D=!1;var Ne=dr;e:do try{if(Qt!==0&&Ht!==null){var Fe=Ht,Ye=Jr;switch(Qt){case 8:Uc(),Ne=6;break e;case 3:case 2:case 9:case 6:Zr.current===null&&(D=!0);var st=Qt;if(Qt=0,Jr=null,es(k,Fe,Ye,st),H&&Zi){Ne=0;break e}break;default:st=Qt,Qt=0,Jr=null,es(k,Fe,Ye,st)}}$0(),Ne=dr;break}catch(yt){tf(k,yt)}while(!0);return D&&k.shellSuspendCounter++,Rn=yi=null,Xt=ce,re.H=me,re.A=xe,Ht===null&&(ir=null,Kt=0,so()),Ne}function $0(){for(;Ht!==null;)of(Ht)}function R0(k,D){var H=Xt;Xt|=2;var ce=nf(),me=sf();ir!==k||Kt!==D?(Lo=null,Bo=ot()+500,Qi(k,D)):Zi=St(k,D);e:do try{if(Qt!==0&&Ht!==null){D=Ht;var xe=Jr;t:switch(Qt){case 1:Qt=0,Jr=null,es(k,D,xe,1);break;case 2:case 9:if(fu(xe)){Qt=0,Jr=null,af(D);break}D=function(){Qt!==2&&Qt!==9||ir!==k||(Qt=7),En(k)},xe.then(D,D);break e;case 3:Qt=7;break e;case 4:Qt=5;break e;case 7:fu(xe)?(Qt=0,Jr=null,af(D)):(Qt=0,Jr=null,es(k,D,xe,7));break;case 5:var Ne=null;switch(Ht.tag){case 26:Ne=Ht.memoizedState;case 5:case 27:var Fe=Ht;if(Ne?Vf(Ne):Fe.stateNode.complete){Qt=0,Jr=null;var Ye=Fe.sibling;if(Ye!==null)Ht=Ye;else{var st=Fe.return;st!==null?(Ht=st,Uo(st)):Ht=null}break t}}Qt=0,Jr=null,es(k,D,xe,5);break;case 6:Qt=0,Jr=null,es(k,D,xe,6);break;case 8:Uc(),dr=6;break e;default:throw Error(v(462))}}T0();break}catch(yt){tf(k,yt)}while(!0);return Rn=yi=null,re.H=ce,re.A=me,Xt=H,Ht!==null?0:(ir=null,Kt=0,so(),dr)}function T0(){for(;Ht!==null&&!nt();)of(Ht)}function of(k){var D=Td(k.alternate,k,Ln);k.memoizedProps=k.pendingProps,D===null?Uo(k):Ht=D}function af(k){var D=k,H=D.alternate;switch(D.tag){case 15:case 0:D=Ed(H,D,D.pendingProps,D.type,void 0,Kt);break;case 11:D=Ed(H,D,D.pendingProps,D.type.render,D.ref,Kt);break;case 5:nc(D);default:Id(H,D),D=Ht=tu(D,Ln),D=Td(H,D,Ln)}k.memoizedProps=k.pendingProps,D===null?Uo(k):Ht=D}function es(k,D,H,ce){Rn=yi=null,nc(D),Hi=null,Es=0;var me=D.return;try{if(y0(k,me,D,H,Kt)){dr=1,Ro(k,cn(H,k.current)),Ht=null;return}}catch(xe){if(me!==null)throw Ht=me,xe;dr=1,Ro(k,cn(H,k.current)),Ht=null;return}D.flags&32768?(Gt||ce===1?k=!0:Zi||(Kt&536870912)!==0?k=!1:(Qn=k=!0,(ce===2||ce===9||ce===3||ce===6)&&(ce=Zr.current,ce!==null&&ce.tag===13&&(ce.flags|=16384))),cf(D,k)):Uo(D)}function Uo(k){var D=k;do{if((D.flags&32768)!==0){cf(D,Qn);return}k=D.return;var H=x0(D.alternate,D,Ln);if(H!==null){Ht=H;return}if(D=D.sibling,D!==null){Ht=D;return}Ht=D=k}while(D!==null);dr===0&&(dr=5)}function cf(k,D){do{var H=w0(k.alternate,k);if(H!==null){H.flags&=32767,Ht=H;return}if(H=k.return,H!==null&&(H.flags|=32768,H.subtreeFlags=0,H.deletions=null),!D&&(k=k.sibling,k!==null)){Ht=k;return}Ht=k=H}while(k!==null);dr=6,Ht=null}function lf(k,D,H,ce,me,xe,Ne,Fe,Ye){k.cancelPendingCommit=null;do qo();while(xr!==0);if((Xt&6)!==0)throw Error(v(327));if(D!==null){if(D===k.current)throw Error(v(177));if(xe=D.lanes|D.childLanes,xe|=Ta,ke(k,H,xe,Ne,Fe,Ye),k===ir&&(Ht=ir=null,Kt=0),Ji=D,ri=k,jn=H,Lc=xe,jc=me,Xd=ce,(D.subtreeFlags&10256)!==0||(D.flags&10256)!==0?(k.callbackNode=null,k.callbackPriority=0,N0(kt,function(){return pf(),null})):(k.callbackNode=null,k.callbackPriority=0),ce=(D.flags&13878)!==0,(D.subtreeFlags&13878)!==0||ce){ce=re.T,re.T=null,me=Y.p,Y.p=2,Ne=Xt,Xt|=4;try{E0(k,D,H)}finally{Xt=Ne,Y.p=me,re.T=ce}}xr=1,uf(),df(),ff()}}function uf(){if(xr===1){xr=0;var k=ri,D=Ji,H=(D.flags&13878)!==0;if((D.subtreeFlags&13878)!==0||H){H=re.T,re.T=null;var ce=Y.p;Y.p=2;var me=Xt;Xt|=4;try{Hd(D,k);var xe=el,Ne=Vl(k.containerInfo),Fe=xe.focusedElem,Ye=xe.selectionRange;if(Ne!==Fe&&Fe&&Fe.ownerDocument&&Kl(Fe.ownerDocument.documentElement,Fe)){if(Ye!==null&&Sa(Fe)){var st=Ye.start,yt=Ye.end;if(yt===void 0&&(yt=st),"selectionStart"in Fe)Fe.selectionStart=st,Fe.selectionEnd=Math.min(yt,Fe.value.length);else{var Et=Fe.ownerDocument||document,ct=Et&&Et.defaultView||window;if(ct.getSelection){var pt=ct.getSelection(),Mt=Fe.textContent.length,Lt=Math.min(Ye.start,Mt),nr=Ye.end===void 0?Lt:Math.min(Ye.end,Mt);!pt.extend&&Lt>nr&&(Ne=nr,nr=Lt,Lt=Ne);var rt=zl(Fe,Lt),Je=zl(Fe,nr);if(rt&&Je&&(pt.rangeCount!==1||pt.anchorNode!==rt.node||pt.anchorOffset!==rt.offset||pt.focusNode!==Je.node||pt.focusOffset!==Je.offset)){var it=Et.createRange();it.setStart(rt.node,rt.offset),pt.removeAllRanges(),Lt>nr?(pt.addRange(it),pt.extend(Je.node,Je.offset)):(it.setEnd(Je.node,Je.offset),pt.addRange(it))}}}}for(Et=[],pt=Fe;pt=pt.parentNode;)pt.nodeType===1&&Et.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof Fe.focus=="function"&&Fe.focus(),Fe=0;Fe<Et.length;Fe++){var wt=Et[Fe];wt.element.scrollLeft=wt.left,wt.element.scrollTop=wt.top}}ea=!!Qc,el=Qc=null}finally{Xt=me,Y.p=ce,re.T=H}}k.current=D,xr=2}}function df(){if(xr===2){xr=0;var k=ri,D=Ji,H=(D.flags&8772)!==0;if((D.subtreeFlags&8772)!==0||H){H=re.T,re.T=null;var ce=Y.p;Y.p=2;var me=Xt;Xt|=4;try{Ld(k,D.alternate,D)}finally{Xt=me,Y.p=ce,re.T=H}}xr=3}}function ff(){if(xr===4||xr===3){xr=0,ut();var k=ri,D=Ji,H=jn,ce=Xd;(D.subtreeFlags&10256)!==0||(D.flags&10256)!==0?xr=5:(xr=0,Ji=ri=null,hf(k,k.pendingLanes));var me=k.pendingLanes;if(me===0&&(ti=null),Pt(H),D=D.stateNode,je&&typeof je.onCommitFiberRoot=="function")try{je.onCommitFiberRoot(Pe,D,void 0,(D.current.flags&128)===128)}catch{}if(ce!==null){D=re.T,me=Y.p,Y.p=2,re.T=null;try{for(var xe=k.onRecoverableError,Ne=0;Ne<ce.length;Ne++){var Fe=ce[Ne];xe(Fe.value,{componentStack:Fe.stack})}}finally{re.T=D,Y.p=me}}(jn&3)!==0&&qo(),En(k),me=k.pendingLanes,(H&261930)!==0&&(me&42)!==0?k===Fc?js++:(js=0,Fc=k):js=0,Fs(0)}}function hf(k,D){(k.pooledCacheLanes&=D)===0&&(D=k.pooledCache,D!=null&&(k.pooledCache=null,bs(D)))}function qo(){return uf(),df(),ff(),pf()}function pf(){if(xr!==5)return!1;var k=ri,D=Lc;Lc=0;var H=Pt(jn),ce=re.T,me=Y.p;try{Y.p=32>H?32:H,re.T=null,H=jc,jc=null;var xe=ri,Ne=jn;if(xr=0,Ji=ri=null,jn=0,(Xt&6)!==0)throw Error(v(331));var Fe=Xt;if(Xt|=4,Wd(xe.current),Kd(xe,xe.current,Ne,H),Xt=Fe,Fs(0,!1),je&&typeof je.onPostCommitFiberRoot=="function")try{je.onPostCommitFiberRoot(Pe,xe)}catch{}return!0}finally{Y.p=me,re.T=ce,hf(k,D)}}function mf(k,D,H){D=cn(H,D),D=vc(k.stateNode,D,2),k=Yn(k,D,2),k!==null&&($e(k,2),En(k))}function er(k,D,H){if(k.tag===3)mf(k,k,H);else for(;D!==null;){if(D.tag===3){mf(D,k,H);break}else if(D.tag===1){var ce=D.stateNode;if(typeof D.type.getDerivedStateFromError=="function"||typeof ce.componentDidCatch=="function"&&(ti===null||!ti.has(ce))){k=cn(H,k),H=pd(2),ce=Yn(D,H,2),ce!==null&&(md(H,ce,D,k),$e(ce,2),En(ce));break}}D=D.return}}function Hc(k,D,H){var ce=k.pingCache;if(ce===null){ce=k.pingCache=new A0;var me=new Set;ce.set(D,me)}else me=ce.get(D),me===void 0&&(me=new Set,ce.set(D,me));me.has(H)||(Oc=!0,me.add(H),k=k0.bind(null,k,D,H),D.then(k,k))}function k0(k,D,H){var ce=k.pingCache;ce!==null&&ce.delete(D),k.pingedLanes|=k.suspendedLanes&H,k.warmLanes&=~H,ir===k&&(Kt&H)===H&&(dr===4||dr===3&&(Kt&62914560)===Kt&&300>ot()-Do?(Xt&2)===0&&Qi(k,0):Dc|=H,Xi===Kt&&(Xi=0)),En(k)}function gf(k,D){D===0&&(D=At()),k=pi(k,D),k!==null&&($e(k,D),En(k))}function I0(k){var D=k.memoizedState,H=0;D!==null&&(H=D.retryLane),gf(k,H)}function P0(k,D){var H=0;switch(k.tag){case 31:case 13:var ce=k.stateNode,me=k.memoizedState;me!==null&&(H=me.retryLane);break;case 19:ce=k.stateNode;break;case 22:ce=k.stateNode._retryCache;break;default:throw Error(v(314))}ce!==null&&ce.delete(D),gf(k,H)}function N0(k,D){return et(k,D)}var Ho=null,ts=null,zc=!1,zo=!1,Kc=!1,ii=0;function En(k){k!==ts&&k.next===null&&(ts===null?Ho=ts=k:ts=ts.next=k),zo=!0,zc||(zc=!0,O0())}function Fs(k,D){if(!Kc&&zo){Kc=!0;do for(var H=!1,ce=Ho;ce!==null;){if(k!==0){var me=ce.pendingLanes;if(me===0)var xe=0;else{var Ne=ce.suspendedLanes,Fe=ce.pingedLanes;xe=(1<<31-Ve(42|k)+1)-1,xe&=me&~(Ne&~Fe),xe=xe&201326741?xe&201326741|1:xe?xe|2:0}xe!==0&&(H=!0,xf(ce,xe))}else xe=Kt,xe=$t(ce,ce===ir?xe:0,ce.cancelPendingCommit!==null||ce.timeoutHandle!==-1),(xe&3)===0||St(ce,xe)||(H=!0,xf(ce,xe));ce=ce.next}while(H);Kc=!1}}function M0(){yf()}function yf(){zo=zc=!1;var k=0;ii!==0&&K0()&&(k=ii);for(var D=ot(),H=null,ce=Ho;ce!==null;){var me=ce.next,xe=vf(ce,D);xe===0?(ce.next=null,H===null?Ho=me:H.next=me,me===null&&(ts=H)):(H=ce,(k!==0||(xe&3)!==0)&&(zo=!0)),ce=me}xr!==0&&xr!==5||Fs(k),ii!==0&&(ii=0)}function vf(k,D){for(var H=k.suspendedLanes,ce=k.pingedLanes,me=k.expirationTimes,xe=k.pendingLanes&-62914561;0<xe;){var Ne=31-Ve(xe),Fe=1<<Ne,Ye=me[Ne];Ye===-1?((Fe&H)===0||(Fe&ce)!==0)&&(me[Ne]=ft(Fe,D)):Ye<=D&&(k.expiredLanes|=Fe),xe&=~Fe}if(D=ir,H=Kt,H=$t(k,k===D?H:0,k.cancelPendingCommit!==null||k.timeoutHandle!==-1),ce=k.callbackNode,H===0||k===D&&(Qt===2||Qt===9)||k.cancelPendingCommit!==null)return ce!==null&&ce!==null&&Ze(ce),k.callbackNode=null,k.callbackPriority=0;if((H&3)===0||St(k,H)){if(D=H&-H,D===k.callbackPriority)return D;switch(ce!==null&&Ze(ce),Pt(H)){case 2:case 8:H=lt;break;case 32:H=kt;break;case 268435456:H=Me;break;default:H=kt}return ce=bf.bind(null,k),H=et(H,ce),k.callbackPriority=D,k.callbackNode=H,D}return ce!==null&&ce!==null&&Ze(ce),k.callbackPriority=2,k.callbackNode=null,2}function bf(k,D){if(xr!==0&&xr!==5)return k.callbackNode=null,k.callbackPriority=0,null;var H=k.callbackNode;if(qo()&&k.callbackNode!==H)return null;var ce=Kt;return ce=$t(k,k===ir?ce:0,k.cancelPendingCommit!==null||k.timeoutHandle!==-1),ce===0?null:(Qd(k,ce,D),vf(k,ot()),k.callbackNode!=null&&k.callbackNode===H?bf.bind(null,k):null)}function xf(k,D){if(qo())return null;Qd(k,D,!0)}function O0(){G0(function(){(Xt&6)!==0?et(bt,M0):yf()})}function Vc(){if(ii===0){var k=Fi;k===0&&(k=gt,gt<<=1,(gt&261888)===0&&(gt=256)),ii=k}return ii}function wf(k){return k==null||typeof k=="symbol"||typeof k=="boolean"?null:typeof k=="function"?k:Xs(""+k)}function Ef(k,D){var H=D.ownerDocument.createElement("input");return H.name=D.name,H.value=D.value,k.id&&H.setAttribute("form",k.id),D.parentNode.insertBefore(H,D),k=new FormData(k),H.parentNode.removeChild(H),k}function D0(k,D,H,ce,me){if(D==="submit"&&H&&H.stateNode===me){var xe=wf((me[It]||null).action),Ne=ce.submitter;Ne&&(D=(D=Ne[It]||null)?wf(D.formAction):Ne.getAttribute("formAction"),D!==null&&(xe=D,Ne=null));var Fe=new to("action","action",null,ce,me);k.push({event:Fe,listeners:[{instance:null,listener:function(){if(ce.defaultPrevented){if(ii!==0){var Ye=Ne?Ef(me,Ne):new FormData(me);fc(H,{pending:!0,data:Ye,method:me.method,action:xe},null,Ye)}}else typeof xe=="function"&&(Fe.preventDefault(),Ye=Ne?Ef(me,Ne):new FormData(me),fc(H,{pending:!0,data:Ye,method:me.method,action:xe},xe,Ye))},currentTarget:me}]})}}for(var Gc=0;Gc<Ra.length;Gc++){var Wc=Ra[Gc],B0=Wc.toLowerCase(),L0=Wc[0].toUpperCase()+Wc.slice(1);mn(B0,"on"+L0)}mn(Yl,"onAnimationEnd"),mn(Zl,"onAnimationIteration"),mn(Xl,"onAnimationStart"),mn("dblclick","onDoubleClick"),mn("focusin","onFocus"),mn("focusout","onBlur"),mn(e0,"onTransitionRun"),mn(t0,"onTransitionStart"),mn(r0,"onTransitionCancel"),mn(Jl,"onTransitionEnd"),Sr("onMouseEnter",["mouseout","mouseover"]),Sr("onMouseLeave",["mouseout","mouseover"]),Sr("onPointerEnter",["pointerout","pointerover"]),Sr("onPointerLeave",["pointerout","pointerover"]),br("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),br("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),br("onBeforeInput",["compositionend","keypress","textInput","paste"]),br("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),br("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),br("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Us="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),j0=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Us));function _f(k,D){D=(D&4)!==0;for(var H=0;H<k.length;H++){var ce=k[H],me=ce.event;ce=ce.listeners;e:{var xe=void 0;if(D)for(var Ne=ce.length-1;0<=Ne;Ne--){var Fe=ce[Ne],Ye=Fe.instance,st=Fe.currentTarget;if(Fe=Fe.listener,Ye!==xe&&me.isPropagationStopped())break e;xe=Fe,me.currentTarget=st;try{xe(me)}catch(yt){io(yt)}me.currentTarget=null,xe=Ye}else for(Ne=0;Ne<ce.length;Ne++){if(Fe=ce[Ne],Ye=Fe.instance,st=Fe.currentTarget,Fe=Fe.listener,Ye!==xe&&me.isPropagationStopped())break e;xe=Fe,me.currentTarget=st;try{xe(me)}catch(yt){io(yt)}me.currentTarget=null,xe=Ye}}}}function zt(k,D){var H=D[jt];H===void 0&&(H=D[jt]=new Set);var ce=k+"__bubble";H.has(ce)||(Sf(D,k,2,!1),H.add(ce))}function Yc(k,D,H){var ce=0;D&&(ce|=4),Sf(H,k,ce,D)}var Ko="_reactListening"+Math.random().toString(36).slice(2);function Zc(k){if(!k[Ko]){k[Ko]=!0,Or.forEach(function(H){H!=="selectionchange"&&(j0.has(H)||Yc(H,!1,k),Yc(H,!0,k))});var D=k.nodeType===9?k:k.ownerDocument;D===null||D[Ko]||(D[Ko]=!0,Yc("selectionchange",!1,D))}}function Sf(k,D,H,ce){switch(Qf(D)){case 2:var me=hp;break;case 8:me=pp;break;default:me=dl}H=me.bind(null,D,H,k),me=void 0,!pa||D!=="touchstart"&&D!=="touchmove"&&D!=="wheel"||(me=!0),ce?me!==void 0?k.addEventListener(D,H,{capture:!0,passive:me}):k.addEventListener(D,H,!0):me!==void 0?k.addEventListener(D,H,{passive:me}):k.addEventListener(D,H,!1)}function Xc(k,D,H,ce,me){var xe=ce;if((D&1)===0&&(D&2)===0&&ce!==null)e:for(;;){if(ce===null)return;var Ne=ce.tag;if(Ne===3||Ne===4){var Fe=ce.stateNode.containerInfo;if(Fe===me)break;if(Ne===4)for(Ne=ce.return;Ne!==null;){var Ye=Ne.tag;if((Ye===3||Ye===4)&&Ne.stateNode.containerInfo===me)return;Ne=Ne.return}for(;Fe!==null;){if(Ne=wr(Fe),Ne===null)return;if(Ye=Ne.tag,Ye===5||Ye===6||Ye===26||Ye===27){ce=xe=Ne;continue e}Fe=Fe.parentNode}}ce=ce.return}Sl(function(){var st=xe,yt=fa(H),Et=[];e:{var ct=Ql.get(k);if(ct!==void 0){var pt=to,Mt=k;switch(k){case"keypress":if(Qs(H)===0)break e;case"keydown":case"keyup":pt=Ph;break;case"focusin":Mt="focus",pt=va;break;case"focusout":Mt="blur",pt=va;break;case"beforeblur":case"afterblur":pt=va;break;case"click":if(H.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pt=$l;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pt=xh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pt=Oh;break;case Yl:case Zl:case Xl:pt=_h;break;case Jl:pt=Bh;break;case"scroll":case"scrollend":pt=yh;break;case"wheel":pt=jh;break;case"copy":case"cut":case"paste":pt=Ah;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pt=Tl;break;case"toggle":case"beforetoggle":pt=Uh}var Lt=(D&4)!==0,nr=!Lt&&(k==="scroll"||k==="scrollend"),rt=Lt?ct!==null?ct+"Capture":null:ct;Lt=[];for(var Je=st,it;Je!==null;){var wt=Je;if(it=wt.stateNode,wt=wt.tag,wt!==5&&wt!==26&&wt!==27||it===null||rt===null||(wt=cs(Je,rt),wt!=null&&Lt.push(qs(Je,wt,it))),nr)break;Je=Je.return}0<Lt.length&&(ct=new pt(ct,Mt,null,H,yt),Et.push({event:ct,listeners:Lt}))}}if((D&7)===0){e:{if(ct=k==="mouseover"||k==="pointerover",pt=k==="mouseout"||k==="pointerout",ct&&H!==da&&(Mt=H.relatedTarget||H.fromElement)&&(wr(Mt)||Mt[Wt]))break e;if((pt||ct)&&(ct=yt.window===yt?yt:(ct=yt.ownerDocument)?ct.defaultView||ct.parentWindow:window,pt?(Mt=H.relatedTarget||H.toElement,pt=st,Mt=Mt?wr(Mt):null,Mt!==null&&(nr=w(Mt),Lt=Mt.tag,Mt!==nr||Lt!==5&&Lt!==27&&Lt!==6)&&(Mt=null)):(pt=null,Mt=st),pt!==Mt)){if(Lt=$l,wt="onMouseLeave",rt="onMouseEnter",Je="mouse",(k==="pointerout"||k==="pointerover")&&(Lt=Tl,wt="onPointerLeave",rt="onPointerEnter",Je="pointer"),nr=pt==null?ct:$r(pt),it=Mt==null?ct:$r(Mt),ct=new Lt(wt,Je+"leave",pt,H,yt),ct.target=nr,ct.relatedTarget=it,wt=null,wr(yt)===st&&(Lt=new Lt(rt,Je+"enter",Mt,H,yt),Lt.target=it,Lt.relatedTarget=nr,wt=Lt),nr=wt,pt&&Mt)t:{for(Lt=F0,rt=pt,Je=Mt,it=0,wt=rt;wt;wt=Lt(wt))it++;wt=0;for(var Bt=Je;Bt;Bt=Lt(Bt))wt++;for(;0<it-wt;)rt=Lt(rt),it--;for(;0<wt-it;)Je=Lt(Je),wt--;for(;it--;){if(rt===Je||Je!==null&&rt===Je.alternate){Lt=rt;break t}rt=Lt(rt),Je=Lt(Je)}Lt=null}else Lt=null;pt!==null&&Af(Et,ct,pt,Lt,!1),Mt!==null&&nr!==null&&Af(Et,nr,Mt,Lt,!0)}}e:{if(ct=st?$r(st):window,pt=ct.nodeName&&ct.nodeName.toLowerCase(),pt==="select"||pt==="input"&&ct.type==="file")var Yt=Ll;else if(Ol(ct))if(jl)Yt=Xh;else{Yt=Yh;var Ot=Wh}else pt=ct.nodeName,!pt||pt.toLowerCase()!=="input"||ct.type!=="checkbox"&&ct.type!=="radio"?st&&ua(st.elementType)&&(Yt=Ll):Yt=Zh;if(Yt&&(Yt=Yt(k,st))){Dl(Et,Yt,H,yt);break e}Ot&&Ot(k,ct,st),k==="focusout"&&st&&ct.type==="number"&&st.memoizedProps.value!=null&&la(ct,"number",ct.value)}switch(Ot=st?$r(st):window,k){case"focusin":(Ol(Ot)||Ot.contentEditable==="true")&&(Pi=Ot,Aa=st,gs=null);break;case"focusout":gs=Aa=Pi=null;break;case"mousedown":Ca=!0;break;case"contextmenu":case"mouseup":case"dragend":Ca=!1,Gl(Et,H,yt);break;case"selectionchange":if(Qh)break;case"keydown":case"keyup":Gl(Et,H,yt)}var qt;if(xa)e:{switch(k){case"compositionstart":var Vt="onCompositionStart";break e;case"compositionend":Vt="onCompositionEnd";break e;case"compositionupdate":Vt="onCompositionUpdate";break e}Vt=void 0}else Ii?Nl(k,H)&&(Vt="onCompositionEnd"):k==="keydown"&&H.keyCode===229&&(Vt="onCompositionStart");Vt&&(kl&&H.locale!=="ko"&&(Ii||Vt!=="onCompositionStart"?Vt==="onCompositionEnd"&&Ii&&(qt=Al()):(qn=yt,ma="value"in qn?qn.value:qn.textContent,Ii=!0)),Ot=Vo(st,Vt),0<Ot.length&&(Vt=new Rl(Vt,k,null,H,yt),Et.push({event:Vt,listeners:Ot}),qt?Vt.data=qt:(qt=Ml(H),qt!==null&&(Vt.data=qt)))),(qt=Hh?zh(k,H):Kh(k,H))&&(Vt=Vo(st,"onBeforeInput"),0<Vt.length&&(Ot=new Rl("onBeforeInput","beforeinput",null,H,yt),Et.push({event:Ot,listeners:Vt}),Ot.data=qt)),D0(Et,k,st,H,yt)}_f(Et,D)})}function qs(k,D,H){return{instance:k,listener:D,currentTarget:H}}function Vo(k,D){for(var H=D+"Capture",ce=[];k!==null;){var me=k,xe=me.stateNode;if(me=me.tag,me!==5&&me!==26&&me!==27||xe===null||(me=cs(k,H),me!=null&&ce.unshift(qs(k,me,xe)),me=cs(k,D),me!=null&&ce.push(qs(k,me,xe))),k.tag===3)return ce;k=k.return}return[]}function F0(k){if(k===null)return null;do k=k.return;while(k&&k.tag!==5&&k.tag!==27);return k||null}function Af(k,D,H,ce,me){for(var xe=D._reactName,Ne=[];H!==null&&H!==ce;){var Fe=H,Ye=Fe.alternate,st=Fe.stateNode;if(Fe=Fe.tag,Ye!==null&&Ye===ce)break;Fe!==5&&Fe!==26&&Fe!==27||st===null||(Ye=st,me?(st=cs(H,xe),st!=null&&Ne.unshift(qs(H,st,Ye))):me||(st=cs(H,xe),st!=null&&Ne.push(qs(H,st,Ye)))),H=H.return}Ne.length!==0&&k.push({event:D,listeners:Ne})}var U0=/\r\n?/g,q0=/\u0000|\uFFFD/g;function Cf(k){return(typeof k=="string"?k:""+k).replace(U0,`
`).replace(q0,"")}function $f(k,D){return D=Cf(D),Cf(k)===D}function rr(k,D,H,ce,me,xe){switch(H){case"children":typeof ce=="string"?D==="body"||D==="textarea"&&ce===""||Ri(k,ce):(typeof ce=="number"||typeof ce=="bigint")&&D!=="body"&&Ri(k,""+ce);break;case"className":rn(k,"class",ce);break;case"tabIndex":rn(k,"tabindex",ce);break;case"dir":case"role":case"viewBox":case"width":case"height":rn(k,H,ce);break;case"style":El(k,ce,xe);break;case"data":if(D!=="object"){rn(k,"data",ce);break}case"src":case"href":if(ce===""&&(D!=="a"||H!=="href")){k.removeAttribute(H);break}if(ce==null||typeof ce=="function"||typeof ce=="symbol"||typeof ce=="boolean"){k.removeAttribute(H);break}ce=Xs(""+ce),k.setAttribute(H,ce);break;case"action":case"formAction":if(typeof ce=="function"){k.setAttribute(H,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof xe=="function"&&(H==="formAction"?(D!=="input"&&rr(k,D,"name",me.name,me,null),rr(k,D,"formEncType",me.formEncType,me,null),rr(k,D,"formMethod",me.formMethod,me,null),rr(k,D,"formTarget",me.formTarget,me,null)):(rr(k,D,"encType",me.encType,me,null),rr(k,D,"method",me.method,me,null),rr(k,D,"target",me.target,me,null)));if(ce==null||typeof ce=="symbol"||typeof ce=="boolean"){k.removeAttribute(H);break}ce=Xs(""+ce),k.setAttribute(H,ce);break;case"onClick":ce!=null&&(k.onclick=Sn);break;case"onScroll":ce!=null&&zt("scroll",k);break;case"onScrollEnd":ce!=null&&zt("scrollend",k);break;case"dangerouslySetInnerHTML":if(ce!=null){if(typeof ce!="object"||!("__html"in ce))throw Error(v(61));if(H=ce.__html,H!=null){if(me.children!=null)throw Error(v(60));k.innerHTML=H}}break;case"multiple":k.multiple=ce&&typeof ce!="function"&&typeof ce!="symbol";break;case"muted":k.muted=ce&&typeof ce!="function"&&typeof ce!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(ce==null||typeof ce=="function"||typeof ce=="boolean"||typeof ce=="symbol"){k.removeAttribute("xlink:href");break}H=Xs(""+ce),k.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",H);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":ce!=null&&typeof ce!="function"&&typeof ce!="symbol"?k.setAttribute(H,""+ce):k.removeAttribute(H);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":ce&&typeof ce!="function"&&typeof ce!="symbol"?k.setAttribute(H,""):k.removeAttribute(H);break;case"capture":case"download":ce===!0?k.setAttribute(H,""):ce!==!1&&ce!=null&&typeof ce!="function"&&typeof ce!="symbol"?k.setAttribute(H,ce):k.removeAttribute(H);break;case"cols":case"rows":case"size":case"span":ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&!isNaN(ce)&&1<=ce?k.setAttribute(H,ce):k.removeAttribute(H);break;case"rowSpan":case"start":ce==null||typeof ce=="function"||typeof ce=="symbol"||isNaN(ce)?k.removeAttribute(H):k.setAttribute(H,ce);break;case"popover":zt("beforetoggle",k),zt("toggle",k),tn(k,"popover",ce);break;case"xlinkActuate":_n(k,"http://www.w3.org/1999/xlink","xlink:actuate",ce);break;case"xlinkArcrole":_n(k,"http://www.w3.org/1999/xlink","xlink:arcrole",ce);break;case"xlinkRole":_n(k,"http://www.w3.org/1999/xlink","xlink:role",ce);break;case"xlinkShow":_n(k,"http://www.w3.org/1999/xlink","xlink:show",ce);break;case"xlinkTitle":_n(k,"http://www.w3.org/1999/xlink","xlink:title",ce);break;case"xlinkType":_n(k,"http://www.w3.org/1999/xlink","xlink:type",ce);break;case"xmlBase":_n(k,"http://www.w3.org/XML/1998/namespace","xml:base",ce);break;case"xmlLang":_n(k,"http://www.w3.org/XML/1998/namespace","xml:lang",ce);break;case"xmlSpace":_n(k,"http://www.w3.org/XML/1998/namespace","xml:space",ce);break;case"is":tn(k,"is",ce);break;case"innerText":case"textContent":break;default:(!(2<H.length)||H[0]!=="o"&&H[0]!=="O"||H[1]!=="n"&&H[1]!=="N")&&(H=mh.get(H)||H,tn(k,H,ce))}}function Jc(k,D,H,ce,me,xe){switch(H){case"style":El(k,ce,xe);break;case"dangerouslySetInnerHTML":if(ce!=null){if(typeof ce!="object"||!("__html"in ce))throw Error(v(61));if(H=ce.__html,H!=null){if(me.children!=null)throw Error(v(60));k.innerHTML=H}}break;case"children":typeof ce=="string"?Ri(k,ce):(typeof ce=="number"||typeof ce=="bigint")&&Ri(k,""+ce);break;case"onScroll":ce!=null&&zt("scroll",k);break;case"onScrollEnd":ce!=null&&zt("scrollend",k);break;case"onClick":ce!=null&&(k.onclick=Sn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Dr.hasOwnProperty(H))e:{if(H[0]==="o"&&H[1]==="n"&&(me=H.endsWith("Capture"),D=H.slice(2,me?H.length-7:void 0),xe=k[It]||null,xe=xe!=null?xe[H]:null,typeof xe=="function"&&k.removeEventListener(D,xe,me),typeof ce=="function")){typeof xe!="function"&&xe!==null&&(H in k?k[H]=null:k.hasAttribute(H)&&k.removeAttribute(H)),k.addEventListener(D,ce,me);break e}H in k?k[H]=ce:ce===!0?k.setAttribute(H,""):tn(k,H,ce)}}}function Ir(k,D,H){switch(D){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":zt("error",k),zt("load",k);var ce=!1,me=!1,xe;for(xe in H)if(H.hasOwnProperty(xe)){var Ne=H[xe];if(Ne!=null)switch(xe){case"src":ce=!0;break;case"srcSet":me=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(v(137,D));default:rr(k,D,xe,Ne,H,null)}}me&&rr(k,D,"srcSet",H.srcSet,H,null),ce&&rr(k,D,"src",H.src,H,null);return;case"input":zt("invalid",k);var Fe=xe=Ne=me=null,Ye=null,st=null;for(ce in H)if(H.hasOwnProperty(ce)){var yt=H[ce];if(yt!=null)switch(ce){case"name":me=yt;break;case"type":Ne=yt;break;case"checked":Ye=yt;break;case"defaultChecked":st=yt;break;case"value":xe=yt;break;case"defaultValue":Fe=yt;break;case"children":case"dangerouslySetInnerHTML":if(yt!=null)throw Error(v(137,D));break;default:rr(k,D,ce,yt,H,null)}}vl(k,xe,Fe,Ye,st,Ne,me,!1);return;case"select":zt("invalid",k),ce=Ne=xe=null;for(me in H)if(H.hasOwnProperty(me)&&(Fe=H[me],Fe!=null))switch(me){case"value":xe=Fe;break;case"defaultValue":Ne=Fe;break;case"multiple":ce=Fe;default:rr(k,D,me,Fe,H,null)}D=xe,H=Ne,k.multiple=!!ce,D!=null?$i(k,!!ce,D,!1):H!=null&&$i(k,!!ce,H,!0);return;case"textarea":zt("invalid",k),xe=me=ce=null;for(Ne in H)if(H.hasOwnProperty(Ne)&&(Fe=H[Ne],Fe!=null))switch(Ne){case"value":ce=Fe;break;case"defaultValue":me=Fe;break;case"children":xe=Fe;break;case"dangerouslySetInnerHTML":if(Fe!=null)throw Error(v(91));break;default:rr(k,D,Ne,Fe,H,null)}xl(k,ce,me,xe);return;case"option":for(Ye in H)if(H.hasOwnProperty(Ye)&&(ce=H[Ye],ce!=null))switch(Ye){case"selected":k.selected=ce&&typeof ce!="function"&&typeof ce!="symbol";break;default:rr(k,D,Ye,ce,H,null)}return;case"dialog":zt("beforetoggle",k),zt("toggle",k),zt("cancel",k),zt("close",k);break;case"iframe":case"object":zt("load",k);break;case"video":case"audio":for(ce=0;ce<Us.length;ce++)zt(Us[ce],k);break;case"image":zt("error",k),zt("load",k);break;case"details":zt("toggle",k);break;case"embed":case"source":case"link":zt("error",k),zt("load",k);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(st in H)if(H.hasOwnProperty(st)&&(ce=H[st],ce!=null))switch(st){case"children":case"dangerouslySetInnerHTML":throw Error(v(137,D));default:rr(k,D,st,ce,H,null)}return;default:if(ua(D)){for(yt in H)H.hasOwnProperty(yt)&&(ce=H[yt],ce!==void 0&&Jc(k,D,yt,ce,H,void 0));return}}for(Fe in H)H.hasOwnProperty(Fe)&&(ce=H[Fe],ce!=null&&rr(k,D,Fe,ce,H,null))}function H0(k,D,H,ce){switch(D){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var me=null,xe=null,Ne=null,Fe=null,Ye=null,st=null,yt=null;for(pt in H){var Et=H[pt];if(H.hasOwnProperty(pt)&&Et!=null)switch(pt){case"checked":break;case"value":break;case"defaultValue":Ye=Et;default:ce.hasOwnProperty(pt)||rr(k,D,pt,null,ce,Et)}}for(var ct in ce){var pt=ce[ct];if(Et=H[ct],ce.hasOwnProperty(ct)&&(pt!=null||Et!=null))switch(ct){case"type":xe=pt;break;case"name":me=pt;break;case"checked":st=pt;break;case"defaultChecked":yt=pt;break;case"value":Ne=pt;break;case"defaultValue":Fe=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(v(137,D));break;default:pt!==Et&&rr(k,D,ct,pt,ce,Et)}}ca(k,Ne,Fe,Ye,st,yt,xe,me);return;case"select":pt=Ne=Fe=ct=null;for(xe in H)if(Ye=H[xe],H.hasOwnProperty(xe)&&Ye!=null)switch(xe){case"value":break;case"multiple":pt=Ye;default:ce.hasOwnProperty(xe)||rr(k,D,xe,null,ce,Ye)}for(me in ce)if(xe=ce[me],Ye=H[me],ce.hasOwnProperty(me)&&(xe!=null||Ye!=null))switch(me){case"value":ct=xe;break;case"defaultValue":Fe=xe;break;case"multiple":Ne=xe;default:xe!==Ye&&rr(k,D,me,xe,ce,Ye)}D=Fe,H=Ne,ce=pt,ct!=null?$i(k,!!H,ct,!1):!!ce!=!!H&&(D!=null?$i(k,!!H,D,!0):$i(k,!!H,H?[]:"",!1));return;case"textarea":pt=ct=null;for(Fe in H)if(me=H[Fe],H.hasOwnProperty(Fe)&&me!=null&&!ce.hasOwnProperty(Fe))switch(Fe){case"value":break;case"children":break;default:rr(k,D,Fe,null,ce,me)}for(Ne in ce)if(me=ce[Ne],xe=H[Ne],ce.hasOwnProperty(Ne)&&(me!=null||xe!=null))switch(Ne){case"value":ct=me;break;case"defaultValue":pt=me;break;case"children":break;case"dangerouslySetInnerHTML":if(me!=null)throw Error(v(91));break;default:me!==xe&&rr(k,D,Ne,me,ce,xe)}bl(k,ct,pt);return;case"option":for(var Mt in H)if(ct=H[Mt],H.hasOwnProperty(Mt)&&ct!=null&&!ce.hasOwnProperty(Mt))switch(Mt){case"selected":k.selected=!1;break;default:rr(k,D,Mt,null,ce,ct)}for(Ye in ce)if(ct=ce[Ye],pt=H[Ye],ce.hasOwnProperty(Ye)&&ct!==pt&&(ct!=null||pt!=null))switch(Ye){case"selected":k.selected=ct&&typeof ct!="function"&&typeof ct!="symbol";break;default:rr(k,D,Ye,ct,ce,pt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Lt in H)ct=H[Lt],H.hasOwnProperty(Lt)&&ct!=null&&!ce.hasOwnProperty(Lt)&&rr(k,D,Lt,null,ce,ct);for(st in ce)if(ct=ce[st],pt=H[st],ce.hasOwnProperty(st)&&ct!==pt&&(ct!=null||pt!=null))switch(st){case"children":case"dangerouslySetInnerHTML":if(ct!=null)throw Error(v(137,D));break;default:rr(k,D,st,ct,ce,pt)}return;default:if(ua(D)){for(var nr in H)ct=H[nr],H.hasOwnProperty(nr)&&ct!==void 0&&!ce.hasOwnProperty(nr)&&Jc(k,D,nr,void 0,ce,ct);for(yt in ce)ct=ce[yt],pt=H[yt],!ce.hasOwnProperty(yt)||ct===pt||ct===void 0&&pt===void 0||Jc(k,D,yt,ct,ce,pt);return}}for(var rt in H)ct=H[rt],H.hasOwnProperty(rt)&&ct!=null&&!ce.hasOwnProperty(rt)&&rr(k,D,rt,null,ce,ct);for(Et in ce)ct=ce[Et],pt=H[Et],!ce.hasOwnProperty(Et)||ct===pt||ct==null&&pt==null||rr(k,D,Et,ct,ce,pt)}function Rf(k){switch(k){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function z0(){if(typeof performance.getEntriesByType=="function"){for(var k=0,D=0,H=performance.getEntriesByType("resource"),ce=0;ce<H.length;ce++){var me=H[ce],xe=me.transferSize,Ne=me.initiatorType,Fe=me.duration;if(xe&&Fe&&Rf(Ne)){for(Ne=0,Fe=me.responseEnd,ce+=1;ce<H.length;ce++){var Ye=H[ce],st=Ye.startTime;if(st>Fe)break;var yt=Ye.transferSize,Et=Ye.initiatorType;yt&&Rf(Et)&&(Ye=Ye.responseEnd,Ne+=yt*(Ye<Fe?1:(Fe-st)/(Ye-st)))}if(--ce,D+=8*(xe+Ne)/(me.duration/1e3),k++,10<k)break}}if(0<k)return D/k/1e6}return navigator.connection&&(k=navigator.connection.downlink,typeof k=="number")?k:5}var Qc=null,el=null;function Go(k){return k.nodeType===9?k:k.ownerDocument}function Tf(k){switch(k){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function kf(k,D){if(k===0)switch(D){case"svg":return 1;case"math":return 2;default:return 0}return k===1&&D==="foreignObject"?0:k}function tl(k,D){return k==="textarea"||k==="noscript"||typeof D.children=="string"||typeof D.children=="number"||typeof D.children=="bigint"||typeof D.dangerouslySetInnerHTML=="object"&&D.dangerouslySetInnerHTML!==null&&D.dangerouslySetInnerHTML.__html!=null}var rl=null;function K0(){var k=window.event;return k&&k.type==="popstate"?k===rl?!1:(rl=k,!0):(rl=null,!1)}var If=typeof setTimeout=="function"?setTimeout:void 0,V0=typeof clearTimeout=="function"?clearTimeout:void 0,Pf=typeof Promise=="function"?Promise:void 0,G0=typeof queueMicrotask=="function"?queueMicrotask:typeof Pf<"u"?function(k){return Pf.resolve(null).then(k).catch(W0)}:If;function W0(k){setTimeout(function(){throw k})}function si(k){return k==="head"}function Nf(k,D){var H=D,ce=0;do{var me=H.nextSibling;if(k.removeChild(H),me&&me.nodeType===8)if(H=me.data,H==="/$"||H==="/&"){if(ce===0){k.removeChild(me),os(D);return}ce--}else if(H==="$"||H==="$?"||H==="$~"||H==="$!"||H==="&")ce++;else if(H==="html")Hs(k.ownerDocument.documentElement);else if(H==="head"){H=k.ownerDocument.head,Hs(H);for(var xe=H.firstChild;xe;){var Ne=xe.nextSibling,Fe=xe.nodeName;xe[Cr]||Fe==="SCRIPT"||Fe==="STYLE"||Fe==="LINK"&&xe.rel.toLowerCase()==="stylesheet"||H.removeChild(xe),xe=Ne}}else H==="body"&&Hs(k.ownerDocument.body);H=me}while(H);os(D)}function Mf(k,D){var H=k;k=0;do{var ce=H.nextSibling;if(H.nodeType===1?D?(H._stashedDisplay=H.style.display,H.style.display="none"):(H.style.display=H._stashedDisplay||"",H.getAttribute("style")===""&&H.removeAttribute("style")):H.nodeType===3&&(D?(H._stashedText=H.nodeValue,H.nodeValue=""):H.nodeValue=H._stashedText||""),ce&&ce.nodeType===8)if(H=ce.data,H==="/$"){if(k===0)break;k--}else H!=="$"&&H!=="$?"&&H!=="$~"&&H!=="$!"||k++;H=ce}while(H)}function nl(k){var D=k.firstChild;for(D&&D.nodeType===10&&(D=D.nextSibling);D;){var H=D;switch(D=D.nextSibling,H.nodeName){case"HTML":case"HEAD":case"BODY":nl(H),Pr(H);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(H.rel.toLowerCase()==="stylesheet")continue}k.removeChild(H)}}function Y0(k,D,H,ce){for(;k.nodeType===1;){var me=H;if(k.nodeName.toLowerCase()!==D.toLowerCase()){if(!ce&&(k.nodeName!=="INPUT"||k.type!=="hidden"))break}else if(ce){if(!k[Cr])switch(D){case"meta":if(!k.hasAttribute("itemprop"))break;return k;case"link":if(xe=k.getAttribute("rel"),xe==="stylesheet"&&k.hasAttribute("data-precedence"))break;if(xe!==me.rel||k.getAttribute("href")!==(me.href==null||me.href===""?null:me.href)||k.getAttribute("crossorigin")!==(me.crossOrigin==null?null:me.crossOrigin)||k.getAttribute("title")!==(me.title==null?null:me.title))break;return k;case"style":if(k.hasAttribute("data-precedence"))break;return k;case"script":if(xe=k.getAttribute("src"),(xe!==(me.src==null?null:me.src)||k.getAttribute("type")!==(me.type==null?null:me.type)||k.getAttribute("crossorigin")!==(me.crossOrigin==null?null:me.crossOrigin))&&xe&&k.hasAttribute("async")&&!k.hasAttribute("itemprop"))break;return k;default:return k}}else if(D==="input"&&k.type==="hidden"){var xe=me.name==null?null:""+me.name;if(me.type==="hidden"&&k.getAttribute("name")===xe)return k}else return k;if(k=hn(k.nextSibling),k===null)break}return null}function Z0(k,D,H){if(D==="")return null;for(;k.nodeType!==3;)if((k.nodeType!==1||k.nodeName!=="INPUT"||k.type!=="hidden")&&!H||(k=hn(k.nextSibling),k===null))return null;return k}function Of(k,D){for(;k.nodeType!==8;)if((k.nodeType!==1||k.nodeName!=="INPUT"||k.type!=="hidden")&&!D||(k=hn(k.nextSibling),k===null))return null;return k}function il(k){return k.data==="$?"||k.data==="$~"}function sl(k){return k.data==="$!"||k.data==="$?"&&k.ownerDocument.readyState!=="loading"}function X0(k,D){var H=k.ownerDocument;if(k.data==="$~")k._reactRetry=D;else if(k.data!=="$?"||H.readyState!=="loading")D();else{var ce=function(){D(),H.removeEventListener("DOMContentLoaded",ce)};H.addEventListener("DOMContentLoaded",ce),k._reactRetry=ce}}function hn(k){for(;k!=null;k=k.nextSibling){var D=k.nodeType;if(D===1||D===3)break;if(D===8){if(D=k.data,D==="$"||D==="$!"||D==="$?"||D==="$~"||D==="&"||D==="F!"||D==="F")break;if(D==="/$"||D==="/&")return null}}return k}var ol=null;function Df(k){k=k.nextSibling;for(var D=0;k;){if(k.nodeType===8){var H=k.data;if(H==="/$"||H==="/&"){if(D===0)return hn(k.nextSibling);D--}else H!=="$"&&H!=="$!"&&H!=="$?"&&H!=="$~"&&H!=="&"||D++}k=k.nextSibling}return null}function Bf(k){k=k.previousSibling;for(var D=0;k;){if(k.nodeType===8){var H=k.data;if(H==="$"||H==="$!"||H==="$?"||H==="$~"||H==="&"){if(D===0)return k;D--}else H!=="/$"&&H!=="/&"||D++}k=k.previousSibling}return null}function Lf(k,D,H){switch(D=Go(H),k){case"html":if(k=D.documentElement,!k)throw Error(v(452));return k;case"head":if(k=D.head,!k)throw Error(v(453));return k;case"body":if(k=D.body,!k)throw Error(v(454));return k;default:throw Error(v(451))}}function Hs(k){for(var D=k.attributes;D.length;)k.removeAttributeNode(D[0]);Pr(k)}var pn=new Map,jf=new Set;function Wo(k){return typeof k.getRootNode=="function"?k.getRootNode():k.nodeType===9?k:k.ownerDocument}var Fn=Y.d;Y.d={f:J0,r:Q0,D:ep,C:tp,L:rp,m:np,X:sp,S:ip,M:op};function J0(){var k=Fn.f(),D=jo();return k||D}function Q0(k){var D=Er(k);D!==null&&D.tag===5&&D.type==="form"?Ju(D):Fn.r(k)}var rs=typeof document>"u"?null:document;function Ff(k,D,H){var ce=rs;if(ce&&typeof D=="string"&&D){var me=sn(D);me='link[rel="'+k+'"][href="'+me+'"]',typeof H=="string"&&(me+='[crossorigin="'+H+'"]'),jf.has(me)||(jf.add(me),k={rel:k,crossOrigin:H,href:D},ce.querySelector(me)===null&&(D=ce.createElement("link"),Ir(D,"link",k),Jt(D),ce.head.appendChild(D)))}}function ep(k){Fn.D(k),Ff("dns-prefetch",k,null)}function tp(k,D){Fn.C(k,D),Ff("preconnect",k,D)}function rp(k,D,H){Fn.L(k,D,H);var ce=rs;if(ce&&k&&D){var me='link[rel="preload"][as="'+sn(D)+'"]';D==="image"&&H&&H.imageSrcSet?(me+='[imagesrcset="'+sn(H.imageSrcSet)+'"]',typeof H.imageSizes=="string"&&(me+='[imagesizes="'+sn(H.imageSizes)+'"]')):me+='[href="'+sn(k)+'"]';var xe=me;switch(D){case"style":xe=ns(k);break;case"script":xe=ss(k)}pn.has(xe)||(k=T({rel:"preload",href:D==="image"&&H&&H.imageSrcSet?void 0:k,as:D},H),pn.set(xe,k),ce.querySelector(me)!==null||D==="style"&&ce.querySelector(zs(xe))||D==="script"&&ce.querySelector(Ks(xe))||(D=ce.createElement("link"),Ir(D,"link",k),Jt(D),ce.head.appendChild(D)))}}function np(k,D){Fn.m(k,D);var H=rs;if(H&&k){var ce=D&&typeof D.as=="string"?D.as:"script",me='link[rel="modulepreload"][as="'+sn(ce)+'"][href="'+sn(k)+'"]',xe=me;switch(ce){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":xe=ss(k)}if(!pn.has(xe)&&(k=T({rel:"modulepreload",href:k},D),pn.set(xe,k),H.querySelector(me)===null)){switch(ce){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(H.querySelector(Ks(xe)))return}ce=H.createElement("link"),Ir(ce,"link",k),Jt(ce),H.head.appendChild(ce)}}}function ip(k,D,H){Fn.S(k,D,H);var ce=rs;if(ce&&k){var me=_r(ce).hoistableStyles,xe=ns(k);D=D||"default";var Ne=me.get(xe);if(!Ne){var Fe={loading:0,preload:null};if(Ne=ce.querySelector(zs(xe)))Fe.loading=5;else{k=T({rel:"stylesheet",href:k,"data-precedence":D},H),(H=pn.get(xe))&&al(k,H);var Ye=Ne=ce.createElement("link");Jt(Ye),Ir(Ye,"link",k),Ye._p=new Promise(function(st,yt){Ye.onload=st,Ye.onerror=yt}),Ye.addEventListener("load",function(){Fe.loading|=1}),Ye.addEventListener("error",function(){Fe.loading|=2}),Fe.loading|=4,Yo(Ne,D,ce)}Ne={type:"stylesheet",instance:Ne,count:1,state:Fe},me.set(xe,Ne)}}}function sp(k,D){Fn.X(k,D);var H=rs;if(H&&k){var ce=_r(H).hoistableScripts,me=ss(k),xe=ce.get(me);xe||(xe=H.querySelector(Ks(me)),xe||(k=T({src:k,async:!0},D),(D=pn.get(me))&&cl(k,D),xe=H.createElement("script"),Jt(xe),Ir(xe,"link",k),H.head.appendChild(xe)),xe={type:"script",instance:xe,count:1,state:null},ce.set(me,xe))}}function op(k,D){Fn.M(k,D);var H=rs;if(H&&k){var ce=_r(H).hoistableScripts,me=ss(k),xe=ce.get(me);xe||(xe=H.querySelector(Ks(me)),xe||(k=T({src:k,async:!0,type:"module"},D),(D=pn.get(me))&&cl(k,D),xe=H.createElement("script"),Jt(xe),Ir(xe,"link",k),H.head.appendChild(xe)),xe={type:"script",instance:xe,count:1,state:null},ce.set(me,xe))}}function Uf(k,D,H,ce){var me=(me=Ae.current)?Wo(me):null;if(!me)throw Error(v(446));switch(k){case"meta":case"title":return null;case"style":return typeof H.precedence=="string"&&typeof H.href=="string"?(D=ns(H.href),H=_r(me).hoistableStyles,ce=H.get(D),ce||(ce={type:"style",instance:null,count:0,state:null},H.set(D,ce)),ce):{type:"void",instance:null,count:0,state:null};case"link":if(H.rel==="stylesheet"&&typeof H.href=="string"&&typeof H.precedence=="string"){k=ns(H.href);var xe=_r(me).hoistableStyles,Ne=xe.get(k);if(Ne||(me=me.ownerDocument||me,Ne={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},xe.set(k,Ne),(xe=me.querySelector(zs(k)))&&!xe._p&&(Ne.instance=xe,Ne.state.loading=5),pn.has(k)||(H={rel:"preload",as:"style",href:H.href,crossOrigin:H.crossOrigin,integrity:H.integrity,media:H.media,hrefLang:H.hrefLang,referrerPolicy:H.referrerPolicy},pn.set(k,H),xe||ap(me,k,H,Ne.state))),D&&ce===null)throw Error(v(528,""));return Ne}if(D&&ce!==null)throw Error(v(529,""));return null;case"script":return D=H.async,H=H.src,typeof H=="string"&&D&&typeof D!="function"&&typeof D!="symbol"?(D=ss(H),H=_r(me).hoistableScripts,ce=H.get(D),ce||(ce={type:"script",instance:null,count:0,state:null},H.set(D,ce)),ce):{type:"void",instance:null,count:0,state:null};default:throw Error(v(444,k))}}function ns(k){return'href="'+sn(k)+'"'}function zs(k){return'link[rel="stylesheet"]['+k+"]"}function qf(k){return T({},k,{"data-precedence":k.precedence,precedence:null})}function ap(k,D,H,ce){k.querySelector('link[rel="preload"][as="style"]['+D+"]")?ce.loading=1:(D=k.createElement("link"),ce.preload=D,D.addEventListener("load",function(){return ce.loading|=1}),D.addEventListener("error",function(){return ce.loading|=2}),Ir(D,"link",H),Jt(D),k.head.appendChild(D))}function ss(k){return'[src="'+sn(k)+'"]'}function Ks(k){return"script[async]"+k}function Hf(k,D,H){if(D.count++,D.instance===null)switch(D.type){case"style":var ce=k.querySelector('style[data-href~="'+sn(H.href)+'"]');if(ce)return D.instance=ce,Jt(ce),ce;var me=T({},H,{"data-href":H.href,"data-precedence":H.precedence,href:null,precedence:null});return ce=(k.ownerDocument||k).createElement("style"),Jt(ce),Ir(ce,"style",me),Yo(ce,H.precedence,k),D.instance=ce;case"stylesheet":me=ns(H.href);var xe=k.querySelector(zs(me));if(xe)return D.state.loading|=4,D.instance=xe,Jt(xe),xe;ce=qf(H),(me=pn.get(me))&&al(ce,me),xe=(k.ownerDocument||k).createElement("link"),Jt(xe);var Ne=xe;return Ne._p=new Promise(function(Fe,Ye){Ne.onload=Fe,Ne.onerror=Ye}),Ir(xe,"link",ce),D.state.loading|=4,Yo(xe,H.precedence,k),D.instance=xe;case"script":return xe=ss(H.src),(me=k.querySelector(Ks(xe)))?(D.instance=me,Jt(me),me):(ce=H,(me=pn.get(xe))&&(ce=T({},H),cl(ce,me)),k=k.ownerDocument||k,me=k.createElement("script"),Jt(me),Ir(me,"link",ce),k.head.appendChild(me),D.instance=me);case"void":return null;default:throw Error(v(443,D.type))}else D.type==="stylesheet"&&(D.state.loading&4)===0&&(ce=D.instance,D.state.loading|=4,Yo(ce,H.precedence,k));return D.instance}function Yo(k,D,H){for(var ce=H.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),me=ce.length?ce[ce.length-1]:null,xe=me,Ne=0;Ne<ce.length;Ne++){var Fe=ce[Ne];if(Fe.dataset.precedence===D)xe=Fe;else if(xe!==me)break}xe?xe.parentNode.insertBefore(k,xe.nextSibling):(D=H.nodeType===9?H.head:H,D.insertBefore(k,D.firstChild))}function al(k,D){k.crossOrigin==null&&(k.crossOrigin=D.crossOrigin),k.referrerPolicy==null&&(k.referrerPolicy=D.referrerPolicy),k.title==null&&(k.title=D.title)}function cl(k,D){k.crossOrigin==null&&(k.crossOrigin=D.crossOrigin),k.referrerPolicy==null&&(k.referrerPolicy=D.referrerPolicy),k.integrity==null&&(k.integrity=D.integrity)}var Zo=null;function zf(k,D,H){if(Zo===null){var ce=new Map,me=Zo=new Map;me.set(H,ce)}else me=Zo,ce=me.get(H),ce||(ce=new Map,me.set(H,ce));if(ce.has(k))return ce;for(ce.set(k,null),H=H.getElementsByTagName(k),me=0;me<H.length;me++){var xe=H[me];if(!(xe[Cr]||xe[Tt]||k==="link"&&xe.getAttribute("rel")==="stylesheet")&&xe.namespaceURI!=="http://www.w3.org/2000/svg"){var Ne=xe.getAttribute(D)||"";Ne=k+Ne;var Fe=ce.get(Ne);Fe?Fe.push(xe):ce.set(Ne,[xe])}}return ce}function Kf(k,D,H){k=k.ownerDocument||k,k.head.insertBefore(H,D==="title"?k.querySelector("head > title"):null)}function cp(k,D,H){if(H===1||D.itemProp!=null)return!1;switch(k){case"meta":case"title":return!0;case"style":if(typeof D.precedence!="string"||typeof D.href!="string"||D.href==="")break;return!0;case"link":if(typeof D.rel!="string"||typeof D.href!="string"||D.href===""||D.onLoad||D.onError)break;switch(D.rel){case"stylesheet":return k=D.disabled,typeof D.precedence=="string"&&k==null;default:return!0}case"script":if(D.async&&typeof D.async!="function"&&typeof D.async!="symbol"&&!D.onLoad&&!D.onError&&D.src&&typeof D.src=="string")return!0}return!1}function Vf(k){return!(k.type==="stylesheet"&&(k.state.loading&3)===0)}function lp(k,D,H,ce){if(H.type==="stylesheet"&&(typeof ce.media!="string"||matchMedia(ce.media).matches!==!1)&&(H.state.loading&4)===0){if(H.instance===null){var me=ns(ce.href),xe=D.querySelector(zs(me));if(xe){D=xe._p,D!==null&&typeof D=="object"&&typeof D.then=="function"&&(k.count++,k=Xo.bind(k),D.then(k,k)),H.state.loading|=4,H.instance=xe,Jt(xe);return}xe=D.ownerDocument||D,ce=qf(ce),(me=pn.get(me))&&al(ce,me),xe=xe.createElement("link"),Jt(xe);var Ne=xe;Ne._p=new Promise(function(Fe,Ye){Ne.onload=Fe,Ne.onerror=Ye}),Ir(xe,"link",ce),H.instance=xe}k.stylesheets===null&&(k.stylesheets=new Map),k.stylesheets.set(H,D),(D=H.state.preload)&&(H.state.loading&3)===0&&(k.count++,H=Xo.bind(k),D.addEventListener("load",H),D.addEventListener("error",H))}}var ll=0;function up(k,D){return k.stylesheets&&k.count===0&&Qo(k,k.stylesheets),0<k.count||0<k.imgCount?function(H){var ce=setTimeout(function(){if(k.stylesheets&&Qo(k,k.stylesheets),k.unsuspend){var xe=k.unsuspend;k.unsuspend=null,xe()}},6e4+D);0<k.imgBytes&&ll===0&&(ll=62500*z0());var me=setTimeout(function(){if(k.waitingForImages=!1,k.count===0&&(k.stylesheets&&Qo(k,k.stylesheets),k.unsuspend)){var xe=k.unsuspend;k.unsuspend=null,xe()}},(k.imgBytes>ll?50:800)+D);return k.unsuspend=H,function(){k.unsuspend=null,clearTimeout(ce),clearTimeout(me)}}:null}function Xo(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Qo(this,this.stylesheets);else if(this.unsuspend){var k=this.unsuspend;this.unsuspend=null,k()}}}var Jo=null;function Qo(k,D){k.stylesheets=null,k.unsuspend!==null&&(k.count++,Jo=new Map,D.forEach(dp,k),Jo=null,Xo.call(k))}function dp(k,D){if(!(D.state.loading&4)){var H=Jo.get(k);if(H)var ce=H.get(null);else{H=new Map,Jo.set(k,H);for(var me=k.querySelectorAll("link[data-precedence],style[data-precedence]"),xe=0;xe<me.length;xe++){var Ne=me[xe];(Ne.nodeName==="LINK"||Ne.getAttribute("media")!=="not all")&&(H.set(Ne.dataset.precedence,Ne),ce=Ne)}ce&&H.set(null,ce)}me=D.instance,Ne=me.getAttribute("data-precedence"),xe=H.get(Ne)||ce,xe===ce&&H.set(null,me),H.set(Ne,me),this.count++,ce=Xo.bind(this),me.addEventListener("load",ce),me.addEventListener("error",ce),xe?xe.parentNode.insertBefore(me,xe.nextSibling):(k=k.nodeType===9?k.head:k,k.insertBefore(me,k.firstChild)),D.state.loading|=4}}var Vs={$$typeof:oe,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function fp(k,D,H,ce,me,xe,Ne,Fe,Ye){this.tag=1,this.containerInfo=k,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Oe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Oe(0),this.hiddenUpdates=Oe(null),this.identifierPrefix=ce,this.onUncaughtError=me,this.onCaughtError=xe,this.onRecoverableError=Ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ye,this.incompleteTransitions=new Map}function Gf(k,D,H,ce,me,xe,Ne,Fe,Ye,st,yt,Et){return k=new fp(k,D,H,Ne,Ye,st,yt,Et,Fe),D=1,xe===!0&&(D|=24),xe=Yr(3,null,null,D),k.current=xe,xe.stateNode=k,D=Ua(),D.refCount++,k.pooledCache=D,D.refCount++,xe.memoizedState={element:ce,isDehydrated:H,cache:D},Ka(xe),k}function Wf(k){return k?(k=Oi,k):Oi}function Yf(k,D,H,ce,me,xe){me=Wf(me),ce.context===null?ce.context=me:ce.pendingContext=me,ce=Wn(D),ce.payload={element:H},xe=xe===void 0?null:xe,xe!==null&&(ce.callback=xe),H=Yn(k,ce,D),H!==null&&(zr(H,k,D),Ss(H,k,D))}function Zf(k,D){if(k=k.memoizedState,k!==null&&k.dehydrated!==null){var H=k.retryLane;k.retryLane=H!==0&&H<D?H:D}}function ul(k,D){Zf(k,D),(k=k.alternate)&&Zf(k,D)}function Xf(k){if(k.tag===13||k.tag===31){var D=pi(k,67108864);D!==null&&zr(D,k,67108864),ul(k,67108864)}}function Jf(k){if(k.tag===13||k.tag===31){var D=en();D=tt(D);var H=pi(k,D);H!==null&&zr(H,k,D),ul(k,D)}}var ea=!0;function hp(k,D,H,ce){var me=re.T;re.T=null;var xe=Y.p;try{Y.p=2,dl(k,D,H,ce)}finally{Y.p=xe,re.T=me}}function pp(k,D,H,ce){var me=re.T;re.T=null;var xe=Y.p;try{Y.p=8,dl(k,D,H,ce)}finally{Y.p=xe,re.T=me}}function dl(k,D,H,ce){if(ea){var me=fl(ce);if(me===null)Xc(k,D,ce,ta,H),eh(k,ce);else if(gp(me,k,D,H,ce))ce.stopPropagation();else if(eh(k,ce),D&4&&-1<mp.indexOf(k)){for(;me!==null;){var xe=Er(me);if(xe!==null)switch(xe.tag){case 3:if(xe=xe.stateNode,xe.current.memoizedState.isDehydrated){var Ne=_t(xe.pendingLanes);if(Ne!==0){var Fe=xe;for(Fe.pendingLanes|=2,Fe.entangledLanes|=2;Ne;){var Ye=1<<31-Ve(Ne);Fe.entanglements[1]|=Ye,Ne&=~Ye}En(xe),(Xt&6)===0&&(Bo=ot()+500,Fs(0))}}break;case 31:case 13:Fe=pi(xe,2),Fe!==null&&zr(Fe,xe,2),jo(),ul(xe,2)}if(xe=fl(ce),xe===null&&Xc(k,D,ce,ta,H),xe===me)break;me=xe}me!==null&&ce.stopPropagation()}else Xc(k,D,ce,null,H)}}function fl(k){return k=fa(k),hl(k)}var ta=null;function hl(k){if(ta=null,k=wr(k),k!==null){var D=w(k);if(D===null)k=null;else{var H=D.tag;if(H===13){if(k=E(D),k!==null)return k;k=null}else if(H===31){if(k=S(D),k!==null)return k;k=null}else if(H===3){if(D.stateNode.current.memoizedState.isDehydrated)return D.tag===3?D.stateNode.containerInfo:null;k=null}else D!==k&&(k=null)}}return ta=k,null}function Qf(k){switch(k){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(vt()){case bt:return 2;case lt:return 8;case kt:case Ct:return 32;case Me:return 268435456;default:return 32}default:return 32}}var pl=!1,oi=null,ai=null,ci=null,Gs=new Map,Ws=new Map,li=[],mp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function eh(k,D){switch(k){case"focusin":case"focusout":oi=null;break;case"dragenter":case"dragleave":ai=null;break;case"mouseover":case"mouseout":ci=null;break;case"pointerover":case"pointerout":Gs.delete(D.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ws.delete(D.pointerId)}}function Ys(k,D,H,ce,me,xe){return k===null||k.nativeEvent!==xe?(k={blockedOn:D,domEventName:H,eventSystemFlags:ce,nativeEvent:xe,targetContainers:[me]},D!==null&&(D=Er(D),D!==null&&Xf(D)),k):(k.eventSystemFlags|=ce,D=k.targetContainers,me!==null&&D.indexOf(me)===-1&&D.push(me),k)}function gp(k,D,H,ce,me){switch(D){case"focusin":return oi=Ys(oi,k,D,H,ce,me),!0;case"dragenter":return ai=Ys(ai,k,D,H,ce,me),!0;case"mouseover":return ci=Ys(ci,k,D,H,ce,me),!0;case"pointerover":var xe=me.pointerId;return Gs.set(xe,Ys(Gs.get(xe)||null,k,D,H,ce,me)),!0;case"gotpointercapture":return xe=me.pointerId,Ws.set(xe,Ys(Ws.get(xe)||null,k,D,H,ce,me)),!0}return!1}function th(k){var D=wr(k.target);if(D!==null){var H=w(D);if(H!==null){if(D=H.tag,D===13){if(D=E(H),D!==null){k.blockedOn=D,Rt(k.priority,function(){Jf(H)});return}}else if(D===31){if(D=S(H),D!==null){k.blockedOn=D,Rt(k.priority,function(){Jf(H)});return}}else if(D===3&&H.stateNode.current.memoizedState.isDehydrated){k.blockedOn=H.tag===3?H.stateNode.containerInfo:null;return}}}k.blockedOn=null}function ra(k){if(k.blockedOn!==null)return!1;for(var D=k.targetContainers;0<D.length;){var H=fl(k.nativeEvent);if(H===null){H=k.nativeEvent;var ce=new H.constructor(H.type,H);da=ce,H.target.dispatchEvent(ce),da=null}else return D=Er(H),D!==null&&Xf(D),k.blockedOn=H,!1;D.shift()}return!0}function rh(k,D,H){ra(k)&&H.delete(D)}function yp(){pl=!1,oi!==null&&ra(oi)&&(oi=null),ai!==null&&ra(ai)&&(ai=null),ci!==null&&ra(ci)&&(ci=null),Gs.forEach(rh),Ws.forEach(rh)}function na(k,D){k.blockedOn===D&&(k.blockedOn=null,pl||(pl=!0,y.unstable_scheduleCallback(y.unstable_NormalPriority,yp)))}var ia=null;function nh(k){ia!==k&&(ia=k,y.unstable_scheduleCallback(y.unstable_NormalPriority,function(){ia===k&&(ia=null);for(var D=0;D<k.length;D+=3){var H=k[D],ce=k[D+1],me=k[D+2];if(typeof ce!="function"){if(hl(ce||H)===null)continue;break}var xe=Er(H);xe!==null&&(k.splice(D,3),D-=3,fc(xe,{pending:!0,data:me,method:H.method,action:ce},ce,me))}}))}function os(k){function D(Ye){return na(Ye,k)}oi!==null&&na(oi,k),ai!==null&&na(ai,k),ci!==null&&na(ci,k),Gs.forEach(D),Ws.forEach(D);for(var H=0;H<li.length;H++){var ce=li[H];ce.blockedOn===k&&(ce.blockedOn=null)}for(;0<li.length&&(H=li[0],H.blockedOn===null);)th(H),H.blockedOn===null&&li.shift();if(H=(k.ownerDocument||k).$$reactFormReplay,H!=null)for(ce=0;ce<H.length;ce+=3){var me=H[ce],xe=H[ce+1],Ne=me[It]||null;if(typeof xe=="function")Ne||nh(H);else if(Ne){var Fe=null;if(xe&&xe.hasAttribute("formAction")){if(me=xe,Ne=xe[It]||null)Fe=Ne.formAction;else if(hl(me)!==null)continue}else Fe=Ne.action;typeof Fe=="function"?H[ce+1]=Fe:(H.splice(ce,3),ce-=3),nh(H)}}}function ih(){function k(xe){xe.canIntercept&&xe.info==="react-transition"&&xe.intercept({handler:function(){return new Promise(function(Ne){return me=Ne})},focusReset:"manual",scroll:"manual"})}function D(){me!==null&&(me(),me=null),ce||setTimeout(H,20)}function H(){if(!ce&&!navigation.transition){var xe=navigation.currentEntry;xe&&xe.url!=null&&navigation.navigate(xe.url,{state:xe.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var ce=!1,me=null;return navigation.addEventListener("navigate",k),navigation.addEventListener("navigatesuccess",D),navigation.addEventListener("navigateerror",D),setTimeout(H,100),function(){ce=!0,navigation.removeEventListener("navigate",k),navigation.removeEventListener("navigatesuccess",D),navigation.removeEventListener("navigateerror",D),me!==null&&(me(),me=null)}}}function ml(k){this._internalRoot=k}sa.prototype.render=ml.prototype.render=function(k){var D=this._internalRoot;if(D===null)throw Error(v(409));var H=D.current,ce=en();Yf(H,ce,k,D,null,null)},sa.prototype.unmount=ml.prototype.unmount=function(){var k=this._internalRoot;if(k!==null){this._internalRoot=null;var D=k.containerInfo;Yf(k.current,2,null,k,null,null),jo(),D[Wt]=null}};function sa(k){this._internalRoot=k}sa.prototype.unstable_scheduleHydration=function(k){if(k){var D=Nt();k={blockedOn:null,target:k,priority:D};for(var H=0;H<li.length&&D!==0&&D<li[H].priority;H++);li.splice(H,0,k),H===0&&th(k)}};var sh=u.version;if(sh!=="19.2.0")throw Error(v(527,sh,"19.2.0"));Y.findDOMNode=function(k){var D=k._reactInternals;if(D===void 0)throw typeof k.render=="function"?Error(v(188)):(k=Object.keys(k).join(","),Error(v(268,k)));return k=$(D),k=k!==null?R(k):null,k=k===null?null:k.stateNode,k};var vp={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:re,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var oa=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!oa.isDisabled&&oa.supportsFiber)try{Pe=oa.inject(vp),je=oa}catch{}}return reactDomClient_production.createRoot=function(k,D){if(!b(k))throw Error(v(299));var H=!1,ce="",me=ud,xe=dd,Ne=fd;return D!=null&&(D.unstable_strictMode===!0&&(H=!0),D.identifierPrefix!==void 0&&(ce=D.identifierPrefix),D.onUncaughtError!==void 0&&(me=D.onUncaughtError),D.onCaughtError!==void 0&&(xe=D.onCaughtError),D.onRecoverableError!==void 0&&(Ne=D.onRecoverableError)),D=Gf(k,1,!1,null,null,H,ce,null,me,xe,Ne,ih),k[Wt]=D.current,Zc(k),new ml(D)},reactDomClient_production.hydrateRoot=function(k,D,H){if(!b(k))throw Error(v(299));var ce=!1,me="",xe=ud,Ne=dd,Fe=fd,Ye=null;return H!=null&&(H.unstable_strictMode===!0&&(ce=!0),H.identifierPrefix!==void 0&&(me=H.identifierPrefix),H.onUncaughtError!==void 0&&(xe=H.onUncaughtError),H.onCaughtError!==void 0&&(Ne=H.onCaughtError),H.onRecoverableError!==void 0&&(Fe=H.onRecoverableError),H.formState!==void 0&&(Ye=H.formState)),D=Gf(k,1,!0,D,H??null,ce,me,Ye,xe,Ne,Fe,ih),D.context=Wf(null),H=D.current,ce=en(),ce=tt(ce),me=Wn(ce),me.callback=null,Yn(H,me,ce),H=ce,D.current.lanes=H,$e(D,H),En(D),k[Wt]=D.current,Zc(k),new sa(D)},reactDomClient_production.version="19.2.0",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function y(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(y)}catch(u){console.error(u)}}return y(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient();const global$1=globalThis||void 0||self;var PopStateEventType="popstate";function createHashHistory(y={}){function u(b,w){let{pathname:E="/",search:S="",hash:A=""}=parsePath(b.location.hash.substring(1));return!E.startsWith("/")&&!E.startsWith(".")&&(E="/"+E),createLocation("",{pathname:E,search:S,hash:A},w.state&&w.state.usr||null,w.state&&w.state.key||"default")}function g(b,w){let E=b.document.querySelector("base"),S="";if(E&&E.getAttribute("href")){let A=b.location.href,$=A.indexOf("#");S=$===-1?A:A.slice(0,$)}return S+"#"+(typeof w=="string"?w:createPath(w))}function v(b,w){warning$2(b.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(w)})`)}return getUrlBasedHistory(u,g,v,y)}function invariant$1(y,u){if(y===!1||y===null||typeof y>"u")throw new Error(u)}function warning$2(y,u){if(!y){typeof console<"u"&&console.warn(u);try{throw new Error(u)}catch{}}}function createKey(){return Math.random().toString(36).substring(2,10)}function getHistoryState(y,u){return{usr:y.state,key:y.key,idx:u}}function createLocation(y,u,g=null,v){return{pathname:typeof y=="string"?y:y.pathname,search:"",hash:"",...typeof u=="string"?parsePath(u):u,state:g,key:u&&u.key||v||createKey()}}function createPath({pathname:y="/",search:u="",hash:g=""}){return u&&u!=="?"&&(y+=u.charAt(0)==="?"?u:"?"+u),g&&g!=="#"&&(y+=g.charAt(0)==="#"?g:"#"+g),y}function parsePath(y){let u={};if(y){let g=y.indexOf("#");g>=0&&(u.hash=y.substring(g),y=y.substring(0,g));let v=y.indexOf("?");v>=0&&(u.search=y.substring(v),y=y.substring(0,v)),y&&(u.pathname=y)}return u}function getUrlBasedHistory(y,u,g,v={}){let{window:b=document.defaultView,v5Compat:w=!1}=v,E=b.history,S="POP",A=null,$=R();$==null&&($=0,E.replaceState({...E.state,idx:$},""));function R(){return(E.state||{idx:null}).idx}function T(){S="POP";let q=R(),J=q==null?null:q-$;$=q,A&&A({action:S,location:U.location,delta:J})}function O(q,J){S="PUSH";let ie=createLocation(U.location,q,J);g&&g(ie,q),$=R()+1;let oe=getHistoryState(ie,$),le=U.createHref(ie);try{E.pushState(oe,"",le)}catch(de){if(de instanceof DOMException&&de.name==="DataCloneError")throw de;b.location.assign(le)}w&&A&&A({action:S,location:U.location,delta:1})}function B(q,J){S="REPLACE";let ie=createLocation(U.location,q,J);g&&g(ie,q),$=R();let oe=getHistoryState(ie,$),le=U.createHref(ie);E.replaceState(oe,"",le),w&&A&&A({action:S,location:U.location,delta:0})}function F(q){return createBrowserURLImpl(q)}let U={get action(){return S},get location(){return y(b,E)},listen(q){if(A)throw new Error("A history only accepts one active listener");return b.addEventListener(PopStateEventType,T),A=q,()=>{b.removeEventListener(PopStateEventType,T),A=null}},createHref(q){return u(b,q)},createURL:F,encodeLocation(q){let J=F(q);return{pathname:J.pathname,search:J.search,hash:J.hash}},push:O,replace:B,go(q){return E.go(q)}};return U}function createBrowserURLImpl(y,u=!1){let g="http://localhost";typeof window<"u"&&(g=window.location.origin!=="null"?window.location.origin:window.location.href),invariant$1(g,"No window.location.(origin|href) available to create URL");let v=typeof y=="string"?y:createPath(y);return v=v.replace(/ $/,"%20"),!u&&v.startsWith("//")&&(v=g+v),new URL(v,g)}function matchRoutes(y,u,g="/"){return matchRoutesImpl(y,u,g,!1)}function matchRoutesImpl(y,u,g,v){let b=typeof u=="string"?parsePath(u):u,w=stripBasename(b.pathname||"/",g);if(w==null)return null;let E=flattenRoutes(y);rankRouteBranches(E);let S=null;for(let A=0;S==null&&A<E.length;++A){let $=decodePath(w);S=matchRouteBranch(E[A],$,v)}return S}function flattenRoutes(y,u=[],g=[],v="",b=!1){let w=(E,S,A=b,$)=>{let R={relativePath:$===void 0?E.path||"":$,caseSensitive:E.caseSensitive===!0,childrenIndex:S,route:E};if(R.relativePath.startsWith("/")){if(!R.relativePath.startsWith(v)&&A)return;invariant$1(R.relativePath.startsWith(v),`Absolute route path "${R.relativePath}" nested under path "${v}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),R.relativePath=R.relativePath.slice(v.length)}let T=joinPaths([v,R.relativePath]),O=g.concat(R);E.children&&E.children.length>0&&(invariant$1(E.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${T}".`),flattenRoutes(E.children,u,O,T,A)),!(E.path==null&&!E.index)&&u.push({path:T,score:computeScore(T,E.index),routesMeta:O})};return y.forEach((E,S)=>{if(E.path===""||!E.path?.includes("?"))w(E,S);else for(let A of explodeOptionalSegments(E.path))w(E,S,!0,A)}),u}function explodeOptionalSegments(y){let u=y.split("/");if(u.length===0)return[];let[g,...v]=u,b=g.endsWith("?"),w=g.replace(/\?$/,"");if(v.length===0)return b?[w,""]:[w];let E=explodeOptionalSegments(v.join("/")),S=[];return S.push(...E.map(A=>A===""?w:[w,A].join("/"))),b&&S.push(...E),S.map(A=>y.startsWith("/")&&A===""?"/":A)}function rankRouteBranches(y){y.sort((u,g)=>u.score!==g.score?g.score-u.score:compareIndexes(u.routesMeta.map(v=>v.childrenIndex),g.routesMeta.map(v=>v.childrenIndex)))}var paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=y=>y==="*";function computeScore(y,u){let g=y.split("/"),v=g.length;return g.some(isSplat)&&(v+=splatPenalty),u&&(v+=indexRouteValue),g.filter(b=>!isSplat(b)).reduce((b,w)=>b+(paramRe.test(w)?dynamicSegmentValue:w===""?emptySegmentValue:staticSegmentValue),v)}function compareIndexes(y,u){return y.length===u.length&&y.slice(0,-1).every((v,b)=>v===u[b])?y[y.length-1]-u[u.length-1]:0}function matchRouteBranch(y,u,g=!1){let{routesMeta:v}=y,b={},w="/",E=[];for(let S=0;S<v.length;++S){let A=v[S],$=S===v.length-1,R=w==="/"?u:u.slice(w.length)||"/",T=matchPath({path:A.relativePath,caseSensitive:A.caseSensitive,end:$},R),O=A.route;if(!T&&$&&g&&!v[v.length-1].route.index&&(T=matchPath({path:A.relativePath,caseSensitive:A.caseSensitive,end:!1},R)),!T)return null;Object.assign(b,T.params),E.push({params:b,pathname:joinPaths([w,T.pathname]),pathnameBase:normalizePathname(joinPaths([w,T.pathnameBase])),route:O}),T.pathnameBase!=="/"&&(w=joinPaths([w,T.pathnameBase]))}return E}function matchPath(y,u){typeof y=="string"&&(y={path:y,caseSensitive:!1,end:!0});let[g,v]=compilePath(y.path,y.caseSensitive,y.end),b=u.match(g);if(!b)return null;let w=b[0],E=w.replace(/(.)\/+$/,"$1"),S=b.slice(1);return{params:v.reduce(($,{paramName:R,isOptional:T},O)=>{if(R==="*"){let F=S[O]||"";E=w.slice(0,w.length-F.length).replace(/(.)\/+$/,"$1")}const B=S[O];return T&&!B?$[R]=void 0:$[R]=(B||"").replace(/%2F/g,"/"),$},{}),pathname:w,pathnameBase:E,pattern:y}}function compilePath(y,u=!1,g=!0){warning$2(y==="*"||!y.endsWith("*")||y.endsWith("/*"),`Route path "${y}" will be treated as if it were "${y.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${y.replace(/\*$/,"/*")}".`);let v=[],b="^"+y.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(E,S,A)=>(v.push({paramName:S,isOptional:A!=null}),A?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return y.endsWith("*")?(v.push({paramName:"*"}),b+=y==="*"||y==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):g?b+="\\/*$":y!==""&&y!=="/"&&(b+="(?:(?=\\/|$))"),[new RegExp(b,u?void 0:"i"),v]}function decodePath(y){try{return y.split("/").map(u=>decodeURIComponent(u).replace(/\//g,"%2F")).join("/")}catch(u){return warning$2(!1,`The URL path "${y}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${u}).`),y}}function stripBasename(y,u){if(u==="/")return y;if(!y.toLowerCase().startsWith(u.toLowerCase()))return null;let g=u.endsWith("/")?u.length-1:u.length,v=y.charAt(g);return v&&v!=="/"?null:y.slice(g)||"/"}var ABSOLUTE_URL_REGEX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,isAbsoluteUrl=y=>ABSOLUTE_URL_REGEX.test(y);function resolvePath(y,u="/"){let{pathname:g,search:v="",hash:b=""}=typeof y=="string"?parsePath(y):y,w;if(g)if(isAbsoluteUrl(g))w=g;else{if(g.includes("//")){let E=g;g=g.replace(/\/\/+/g,"/"),warning$2(!1,`Pathnames cannot have embedded double slashes - normalizing ${E} -> ${g}`)}g.startsWith("/")?w=resolvePathname(g.substring(1),"/"):w=resolvePathname(g,u)}else w=u;return{pathname:w,search:normalizeSearch(v),hash:normalizeHash(b)}}function resolvePathname(y,u){let g=u.replace(/\/+$/,"").split("/");return y.split("/").forEach(b=>{b===".."?g.length>1&&g.pop():b!=="."&&g.push(b)}),g.length>1?g.join("/"):"/"}function getInvalidPathError(y,u,g,v){return`Cannot include a '${y}' character in a manually specified \`to.${u}\` field [${JSON.stringify(v)}].  Please separate it out to the \`to.${g}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function getPathContributingMatches(y){return y.filter((u,g)=>g===0||u.route.path&&u.route.path.length>0)}function getResolveToMatches(y){let u=getPathContributingMatches(y);return u.map((g,v)=>v===u.length-1?g.pathname:g.pathnameBase)}function resolveTo(y,u,g,v=!1){let b;typeof y=="string"?b=parsePath(y):(b={...y},invariant$1(!b.pathname||!b.pathname.includes("?"),getInvalidPathError("?","pathname","search",b)),invariant$1(!b.pathname||!b.pathname.includes("#"),getInvalidPathError("#","pathname","hash",b)),invariant$1(!b.search||!b.search.includes("#"),getInvalidPathError("#","search","hash",b)));let w=y===""||b.pathname==="",E=w?"/":b.pathname,S;if(E==null)S=g;else{let T=u.length-1;if(!v&&E.startsWith("..")){let O=E.split("/");for(;O[0]==="..";)O.shift(),T-=1;b.pathname=O.join("/")}S=T>=0?u[T]:"/"}let A=resolvePath(b,S),$=E&&E!=="/"&&E.endsWith("/"),R=(w||E===".")&&g.endsWith("/");return!A.pathname.endsWith("/")&&($||R)&&(A.pathname+="/"),A}var joinPaths=y=>y.join("/").replace(/\/\/+/g,"/"),normalizePathname=y=>y.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=y=>!y||y==="?"?"":y.startsWith("?")?y:"?"+y,normalizeHash=y=>!y||y==="#"?"":y.startsWith("#")?y:"#"+y;function isRouteErrorResponse(y){return y!=null&&typeof y.status=="number"&&typeof y.statusText=="string"&&typeof y.internal=="boolean"&&"data"in y}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var validMutationMethodsArr=["POST","PUT","PATCH","DELETE"];new Set(validMutationMethodsArr);var validRequestMethodsArr=["GET",...validMutationMethodsArr];new Set(validRequestMethodsArr);var DataRouterContext=reactExports.createContext(null);DataRouterContext.displayName="DataRouter";var DataRouterStateContext=reactExports.createContext(null);DataRouterStateContext.displayName="DataRouterState";reactExports.createContext(!1);var ViewTransitionContext=reactExports.createContext({isTransitioning:!1});ViewTransitionContext.displayName="ViewTransition";var FetchersContext=reactExports.createContext(new Map);FetchersContext.displayName="Fetchers";var AwaitContext=reactExports.createContext(null);AwaitContext.displayName="Await";var NavigationContext=reactExports.createContext(null);NavigationContext.displayName="Navigation";var LocationContext=reactExports.createContext(null);LocationContext.displayName="Location";var RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1});RouteContext.displayName="Route";var RouteErrorContext=reactExports.createContext(null);RouteErrorContext.displayName="RouteError";function useHref(y,{relative:u}={}){invariant$1(useInRouterContext(),"useHref() may be used only in the context of a <Router> component.");let{basename:g,navigator:v}=reactExports.useContext(NavigationContext),{hash:b,pathname:w,search:E}=useResolvedPath(y,{relative:u}),S=w;return g!=="/"&&(S=w==="/"?g:joinPaths([g,w])),v.createHref({pathname:S,search:E,hash:b})}function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return invariant$1(useInRouterContext(),"useLocation() may be used only in the context of a <Router> component."),reactExports.useContext(LocationContext).location}var navigateEffectWarning="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function useIsomorphicLayoutEffect$1(y){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(y)}function useNavigate(){let{isDataRoute:y}=reactExports.useContext(RouteContext);return y?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){invariant$1(useInRouterContext(),"useNavigate() may be used only in the context of a <Router> component.");let y=reactExports.useContext(DataRouterContext),{basename:u,navigator:g}=reactExports.useContext(NavigationContext),{matches:v}=reactExports.useContext(RouteContext),{pathname:b}=useLocation(),w=JSON.stringify(getResolveToMatches(v)),E=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>{E.current=!0}),reactExports.useCallback((A,$={})=>{if(warning$2(E.current,navigateEffectWarning),!E.current)return;if(typeof A=="number"){g.go(A);return}let R=resolveTo(A,JSON.parse(w),b,$.relative==="path");y==null&&u!=="/"&&(R.pathname=R.pathname==="/"?u:joinPaths([u,R.pathname])),($.replace?g.replace:g.push)(R,$.state,$)},[u,g,w,b,y])}var OutletContext=reactExports.createContext(null);function useOutlet(y){let u=reactExports.useContext(RouteContext).outlet;return reactExports.useMemo(()=>u&&reactExports.createElement(OutletContext.Provider,{value:y},u),[u,y])}function useParams(){let{matches:y}=reactExports.useContext(RouteContext),u=y[y.length-1];return u?u.params:{}}function useResolvedPath(y,{relative:u}={}){let{matches:g}=reactExports.useContext(RouteContext),{pathname:v}=useLocation(),b=JSON.stringify(getResolveToMatches(g));return reactExports.useMemo(()=>resolveTo(y,JSON.parse(b),v,u==="path"),[y,b,v,u])}function useRoutes(y,u){return useRoutesImpl(y,u)}function useRoutesImpl(y,u,g,v,b){invariant$1(useInRouterContext(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:w}=reactExports.useContext(NavigationContext),{matches:E}=reactExports.useContext(RouteContext),S=E[E.length-1],A=S?S.params:{},$=S?S.pathname:"/",R=S?S.pathnameBase:"/",T=S&&S.route;{let ie=T&&T.path||"";warningOnce($,!T||ie.endsWith("*")||ie.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${$}" (under <Route path="${ie}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ie}"> to <Route path="${ie==="/"?"*":`${ie}/*`}">.`)}let O=useLocation(),B;if(u){let ie=typeof u=="string"?parsePath(u):u;invariant$1(R==="/"||ie.pathname?.startsWith(R),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${R}" but pathname "${ie.pathname}" was given in the \`location\` prop.`),B=ie}else B=O;let F=B.pathname||"/",U=F;if(R!=="/"){let ie=R.replace(/^\//,"").split("/");U="/"+F.replace(/^\//,"").split("/").slice(ie.length).join("/")}let q=matchRoutes(y,{pathname:U});warning$2(T||q!=null,`No routes matched location "${B.pathname}${B.search}${B.hash}" `),warning$2(q==null||q[q.length-1].route.element!==void 0||q[q.length-1].route.Component!==void 0||q[q.length-1].route.lazy!==void 0,`Matched leaf route at location "${B.pathname}${B.search}${B.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let J=_renderMatches(q&&q.map(ie=>Object.assign({},ie,{params:Object.assign({},A,ie.params),pathname:joinPaths([R,w.encodeLocation?w.encodeLocation(ie.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ie.pathname]),pathnameBase:ie.pathnameBase==="/"?R:joinPaths([R,w.encodeLocation?w.encodeLocation(ie.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ie.pathnameBase])})),E,g,v,b);return u&&J?reactExports.createElement(LocationContext.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...B},navigationType:"POP"}},J):J}function DefaultErrorComponent(){let y=useRouteError(),u=isRouteErrorResponse(y)?`${y.status} ${y.statusText}`:y instanceof Error?y.message:JSON.stringify(y),g=y instanceof Error?y.stack:null,v="rgba(200,200,200, 0.5)",b={padding:"0.5rem",backgroundColor:v},w={padding:"2px 4px",backgroundColor:v},E=null;return console.error("Error handled by React Router default ErrorBoundary:",y),E=reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("p",null," Hey developer "),reactExports.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",reactExports.createElement("code",{style:w},"ErrorBoundary")," or"," ",reactExports.createElement("code",{style:w},"errorElement")," prop on your route.")),reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},u),g?reactExports.createElement("pre",{style:b},g):null,E)}var defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null),RenderErrorBoundary=class extends reactExports.Component{constructor(y){super(y),this.state={location:y.location,revalidation:y.revalidation,error:y.error}}static getDerivedStateFromError(y){return{error:y}}static getDerivedStateFromProps(y,u){return u.location!==y.location||u.revalidation!=="idle"&&y.revalidation==="idle"?{error:y.error,location:y.location,revalidation:y.revalidation}:{error:y.error!==void 0?y.error:u.error,location:u.location,revalidation:y.revalidation||u.revalidation}}componentDidCatch(y,u){this.props.onError?this.props.onError(y,u):console.error("React Router caught the following error during render",y)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function RenderedRoute({routeContext:y,match:u,children:g}){let v=reactExports.useContext(DataRouterContext);return v&&v.static&&v.staticContext&&(u.route.errorElement||u.route.ErrorBoundary)&&(v.staticContext._deepestRenderedBoundaryId=u.route.id),reactExports.createElement(RouteContext.Provider,{value:y},g)}function _renderMatches(y,u=[],g=null,v=null,b=null){if(y==null){if(!g)return null;if(g.errors)y=g.matches;else if(u.length===0&&!g.initialized&&g.matches.length>0)y=g.matches;else return null}let w=y,E=g?.errors;if(E!=null){let R=w.findIndex(T=>T.route.id&&E?.[T.route.id]!==void 0);invariant$1(R>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(E).join(",")}`),w=w.slice(0,Math.min(w.length,R+1))}let S=!1,A=-1;if(g)for(let R=0;R<w.length;R++){let T=w[R];if((T.route.HydrateFallback||T.route.hydrateFallbackElement)&&(A=R),T.route.id){let{loaderData:O,errors:B}=g,F=T.route.loader&&!O.hasOwnProperty(T.route.id)&&(!B||B[T.route.id]===void 0);if(T.route.lazy||F){S=!0,A>=0?w=w.slice(0,A+1):w=[w[0]];break}}}let $=g&&v?(R,T)=>{v(R,{location:g.location,params:g.matches?.[0]?.params??{},errorInfo:T})}:void 0;return w.reduceRight((R,T,O)=>{let B,F=!1,U=null,q=null;g&&(B=E&&T.route.id?E[T.route.id]:void 0,U=T.route.errorElement||defaultErrorElement,S&&(A<0&&O===0?(warningOnce("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),F=!0,q=null):A===O&&(F=!0,q=T.route.hydrateFallbackElement||null)));let J=u.concat(w.slice(0,O+1)),ie=()=>{let oe;return B?oe=U:F?oe=q:T.route.Component?oe=reactExports.createElement(T.route.Component,null):T.route.element?oe=T.route.element:oe=R,reactExports.createElement(RenderedRoute,{match:T,routeContext:{outlet:R,matches:J,isDataRoute:g!=null},children:oe})};return g&&(T.route.ErrorBoundary||T.route.errorElement||O===0)?reactExports.createElement(RenderErrorBoundary,{location:g.location,revalidation:g.revalidation,component:U,error:B,children:ie(),routeContext:{outlet:null,matches:J,isDataRoute:!0},onError:$}):ie()},null)}function getDataRouterConsoleError(y){return`${y} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext(y){let u=reactExports.useContext(DataRouterContext);return invariant$1(u,getDataRouterConsoleError(y)),u}function useDataRouterState(y){let u=reactExports.useContext(DataRouterStateContext);return invariant$1(u,getDataRouterConsoleError(y)),u}function useRouteContext(y){let u=reactExports.useContext(RouteContext);return invariant$1(u,getDataRouterConsoleError(y)),u}function useCurrentRouteId(y){let u=useRouteContext(y),g=u.matches[u.matches.length-1];return invariant$1(g.route.id,`${y} can only be used on routes that contain a unique "id"`),g.route.id}function useRouteId(){return useCurrentRouteId("useRouteId")}function useRouteError(){let y=reactExports.useContext(RouteErrorContext),u=useDataRouterState("useRouteError"),g=useCurrentRouteId("useRouteError");return y!==void 0?y:u.errors?.[g]}function useNavigateStable(){let{router:y}=useDataRouterContext("useNavigate"),u=useCurrentRouteId("useNavigate"),g=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>{g.current=!0}),reactExports.useCallback(async(b,w={})=>{warning$2(g.current,navigateEffectWarning),g.current&&(typeof b=="number"?y.navigate(b):await y.navigate(b,{fromRouteId:u,...w}))},[y,u])}var alreadyWarned={};function warningOnce(y,u,g){!u&&!alreadyWarned[y]&&(alreadyWarned[y]=!0,warning$2(!1,g))}reactExports.memo(DataRoutes);function DataRoutes({routes:y,future:u,state:g,unstable_onError:v}){return useRoutesImpl(y,void 0,g,v,u)}function Navigate({to:y,replace:u,state:g,relative:v}){invariant$1(useInRouterContext(),"<Navigate> may be used only in the context of a <Router> component.");let{static:b}=reactExports.useContext(NavigationContext);warning$2(!b,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:w}=reactExports.useContext(RouteContext),{pathname:E}=useLocation(),S=useNavigate(),A=resolveTo(y,getResolveToMatches(w),E,v==="path"),$=JSON.stringify(A);return reactExports.useEffect(()=>{S(JSON.parse($),{replace:u,state:g,relative:v})},[S,$,v,u,g]),null}function Outlet(y){return useOutlet(y.context)}function Route(y){invariant$1(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Router({basename:y="/",children:u=null,location:g,navigationType:v="POP",navigator:b,static:w=!1}){invariant$1(!useInRouterContext(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let E=y.replace(/^\/*/,"/"),S=reactExports.useMemo(()=>({basename:E,navigator:b,static:w,future:{}}),[E,b,w]);typeof g=="string"&&(g=parsePath(g));let{pathname:A="/",search:$="",hash:R="",state:T=null,key:O="default"}=g,B=reactExports.useMemo(()=>{let F=stripBasename(A,E);return F==null?null:{location:{pathname:F,search:$,hash:R,state:T,key:O},navigationType:v}},[E,A,$,R,T,O,v]);return warning$2(B!=null,`<Router basename="${E}"> is not able to match the URL "${A}${$}${R}" because it does not start with the basename, so the <Router> won't render anything.`),B==null?null:reactExports.createElement(NavigationContext.Provider,{value:S},reactExports.createElement(LocationContext.Provider,{children:u,value:B}))}function Routes({children:y,location:u}){return useRoutes(createRoutesFromChildren(y),u)}function createRoutesFromChildren(y,u=[]){let g=[];return reactExports.Children.forEach(y,(v,b)=>{if(!reactExports.isValidElement(v))return;let w=[...u,b];if(v.type===reactExports.Fragment){g.push.apply(g,createRoutesFromChildren(v.props.children,w));return}invariant$1(v.type===Route,`[${typeof v.type=="string"?v.type:v.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),invariant$1(!v.props.index||!v.props.children,"An index route cannot have child routes.");let E={id:v.props.id||w.join("-"),caseSensitive:v.props.caseSensitive,element:v.props.element,Component:v.props.Component,index:v.props.index,path:v.props.path,middleware:v.props.middleware,loader:v.props.loader,action:v.props.action,hydrateFallbackElement:v.props.hydrateFallbackElement,HydrateFallback:v.props.HydrateFallback,errorElement:v.props.errorElement,ErrorBoundary:v.props.ErrorBoundary,hasErrorBoundary:v.props.hasErrorBoundary===!0||v.props.ErrorBoundary!=null||v.props.errorElement!=null,shouldRevalidate:v.props.shouldRevalidate,handle:v.props.handle,lazy:v.props.lazy};v.props.children&&(E.children=createRoutesFromChildren(v.props.children,w)),g.push(E)}),g}var defaultMethod="get",defaultEncType="application/x-www-form-urlencoded";function isHtmlElement(y){return y!=null&&typeof y.tagName=="string"}function isButtonElement(y){return isHtmlElement(y)&&y.tagName.toLowerCase()==="button"}function isFormElement(y){return isHtmlElement(y)&&y.tagName.toLowerCase()==="form"}function isInputElement(y){return isHtmlElement(y)&&y.tagName.toLowerCase()==="input"}function isModifiedEvent(y){return!!(y.metaKey||y.altKey||y.ctrlKey||y.shiftKey)}function shouldProcessLinkClick(y,u){return y.button===0&&(!u||u==="_self")&&!isModifiedEvent(y)}function createSearchParams(y=""){return new URLSearchParams(typeof y=="string"||Array.isArray(y)||y instanceof URLSearchParams?y:Object.keys(y).reduce((u,g)=>{let v=y[g];return u.concat(Array.isArray(v)?v.map(b=>[g,b]):[[g,v]])},[]))}function getSearchParamsForLocation(y,u){let g=createSearchParams(y);return u&&u.forEach((v,b)=>{g.has(b)||u.getAll(b).forEach(w=>{g.append(b,w)})}),g}var _formDataSupportsSubmitter=null;function isFormDataSubmitterSupported(){if(_formDataSupportsSubmitter===null)try{new FormData(document.createElement("form"),0),_formDataSupportsSubmitter=!1}catch{_formDataSupportsSubmitter=!0}return _formDataSupportsSubmitter}var supportedFormEncTypes=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function getFormEncType(y){return y!=null&&!supportedFormEncTypes.has(y)?(warning$2(!1,`"${y}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${defaultEncType}"`),null):y}function getFormSubmissionInfo(y,u){let g,v,b,w,E;if(isFormElement(y)){let S=y.getAttribute("action");v=S?stripBasename(S,u):null,g=y.getAttribute("method")||defaultMethod,b=getFormEncType(y.getAttribute("enctype"))||defaultEncType,w=new FormData(y)}else if(isButtonElement(y)||isInputElement(y)&&(y.type==="submit"||y.type==="image")){let S=y.form;if(S==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let A=y.getAttribute("formaction")||S.getAttribute("action");if(v=A?stripBasename(A,u):null,g=y.getAttribute("formmethod")||S.getAttribute("method")||defaultMethod,b=getFormEncType(y.getAttribute("formenctype"))||getFormEncType(S.getAttribute("enctype"))||defaultEncType,w=new FormData(S,y),!isFormDataSubmitterSupported()){let{name:$,type:R,value:T}=y;if(R==="image"){let O=$?`${$}.`:"";w.append(`${O}x`,"0"),w.append(`${O}y`,"0")}else $&&w.append($,T)}}else{if(isHtmlElement(y))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');g=defaultMethod,v=null,b=defaultEncType,E=y}return w&&b==="text/plain"&&(E=w,w=void 0),{action:v,method:g.toLowerCase(),encType:b,formData:w,body:E}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function invariant2(y,u){if(y===!1||y===null||typeof y>"u")throw new Error(u)}function singleFetchUrl(y,u,g){let v=typeof y=="string"?new URL(y,typeof window>"u"?"server://singlefetch/":window.location.origin):y;return v.pathname==="/"?v.pathname=`_root.${g}`:u&&stripBasename(v.pathname,u)==="/"?v.pathname=`${u.replace(/\/$/,"")}/_root.${g}`:v.pathname=`${v.pathname.replace(/\/$/,"")}.${g}`,v}async function loadRouteModule(y,u){if(y.id in u)return u[y.id];try{let g=await import(y.module);return u[y.id]=g,g}catch(g){return console.error(`Error loading route module \`${y.module}\`, reloading page...`),console.error(g),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function isHtmlLinkDescriptor(y){return y==null?!1:y.href==null?y.rel==="preload"&&typeof y.imageSrcSet=="string"&&typeof y.imageSizes=="string":typeof y.rel=="string"&&typeof y.href=="string"}async function getKeyedPrefetchLinks(y,u,g){let v=await Promise.all(y.map(async b=>{let w=u.routes[b.route.id];if(w){let E=await loadRouteModule(w,g);return E.links?E.links():[]}return[]}));return dedupeLinkDescriptors(v.flat(1).filter(isHtmlLinkDescriptor).filter(b=>b.rel==="stylesheet"||b.rel==="preload").map(b=>b.rel==="stylesheet"?{...b,rel:"prefetch",as:"style"}:{...b,rel:"prefetch"}))}function getNewMatchesForLinks(y,u,g,v,b,w){let E=(A,$)=>g[$]?A.route.id!==g[$].route.id:!0,S=(A,$)=>g[$].pathname!==A.pathname||g[$].route.path?.endsWith("*")&&g[$].params["*"]!==A.params["*"];return w==="assets"?u.filter((A,$)=>E(A,$)||S(A,$)):w==="data"?u.filter((A,$)=>{let R=v.routes[A.route.id];if(!R||!R.hasLoader)return!1;if(E(A,$)||S(A,$))return!0;if(A.route.shouldRevalidate){let T=A.route.shouldRevalidate({currentUrl:new URL(b.pathname+b.search+b.hash,window.origin),currentParams:g[0]?.params||{},nextUrl:new URL(y,window.origin),nextParams:A.params,defaultShouldRevalidate:!0});if(typeof T=="boolean")return T}return!0}):[]}function getModuleLinkHrefs(y,u,{includeHydrateFallback:g}={}){return dedupeHrefs(y.map(v=>{let b=u.routes[v.route.id];if(!b)return[];let w=[b.module];return b.clientActionModule&&(w=w.concat(b.clientActionModule)),b.clientLoaderModule&&(w=w.concat(b.clientLoaderModule)),g&&b.hydrateFallbackModule&&(w=w.concat(b.hydrateFallbackModule)),b.imports&&(w=w.concat(b.imports)),w}).flat(1))}function dedupeHrefs(y){return[...new Set(y)]}function sortKeys(y){let u={},g=Object.keys(y).sort();for(let v of g)u[v]=y[v];return u}function dedupeLinkDescriptors(y,u){let g=new Set;return new Set(u),y.reduce((v,b)=>{let w=JSON.stringify(sortKeys(b));return g.has(w)||(g.add(w),v.push({key:w,link:b})),v},[])}function useDataRouterContext2(){let y=reactExports.useContext(DataRouterContext);return invariant2(y,"You must render this element inside a <DataRouterContext.Provider> element"),y}function useDataRouterStateContext(){let y=reactExports.useContext(DataRouterStateContext);return invariant2(y,"You must render this element inside a <DataRouterStateContext.Provider> element"),y}var FrameworkContext=reactExports.createContext(void 0);FrameworkContext.displayName="FrameworkContext";function useFrameworkContext(){let y=reactExports.useContext(FrameworkContext);return invariant2(y,"You must render this element inside a <HydratedRouter> element"),y}function usePrefetchBehavior(y,u){let g=reactExports.useContext(FrameworkContext),[v,b]=reactExports.useState(!1),[w,E]=reactExports.useState(!1),{onFocus:S,onBlur:A,onMouseEnter:$,onMouseLeave:R,onTouchStart:T}=u,O=reactExports.useRef(null);reactExports.useEffect(()=>{if(y==="render"&&E(!0),y==="viewport"){let U=J=>{J.forEach(ie=>{E(ie.isIntersecting)})},q=new IntersectionObserver(U,{threshold:.5});return O.current&&q.observe(O.current),()=>{q.disconnect()}}},[y]),reactExports.useEffect(()=>{if(v){let U=setTimeout(()=>{E(!0)},100);return()=>{clearTimeout(U)}}},[v]);let B=()=>{b(!0)},F=()=>{b(!1),E(!1)};return g?y!=="intent"?[w,O,{}]:[w,O,{onFocus:composeEventHandlers(S,B),onBlur:composeEventHandlers(A,F),onMouseEnter:composeEventHandlers($,B),onMouseLeave:composeEventHandlers(R,F),onTouchStart:composeEventHandlers(T,B)}]:[!1,O,{}]}function composeEventHandlers(y,u){return g=>{y&&y(g),g.defaultPrevented||u(g)}}function PrefetchPageLinks({page:y,...u}){let{router:g}=useDataRouterContext2(),v=reactExports.useMemo(()=>matchRoutes(g.routes,y,g.basename),[g.routes,y,g.basename]);return v?reactExports.createElement(PrefetchPageLinksImpl,{page:y,matches:v,...u}):null}function useKeyedPrefetchLinks(y){let{manifest:u,routeModules:g}=useFrameworkContext(),[v,b]=reactExports.useState([]);return reactExports.useEffect(()=>{let w=!1;return getKeyedPrefetchLinks(y,u,g).then(E=>{w||b(E)}),()=>{w=!0}},[y,u,g]),v}function PrefetchPageLinksImpl({page:y,matches:u,...g}){let v=useLocation(),{manifest:b,routeModules:w}=useFrameworkContext(),{basename:E}=useDataRouterContext2(),{loaderData:S,matches:A}=useDataRouterStateContext(),$=reactExports.useMemo(()=>getNewMatchesForLinks(y,u,A,b,v,"data"),[y,u,A,b,v]),R=reactExports.useMemo(()=>getNewMatchesForLinks(y,u,A,b,v,"assets"),[y,u,A,b,v]),T=reactExports.useMemo(()=>{if(y===v.pathname+v.search+v.hash)return[];let F=new Set,U=!1;if(u.forEach(J=>{let ie=b.routes[J.route.id];!ie||!ie.hasLoader||(!$.some(oe=>oe.route.id===J.route.id)&&J.route.id in S&&w[J.route.id]?.shouldRevalidate||ie.hasClientLoader?U=!0:F.add(J.route.id))}),F.size===0)return[];let q=singleFetchUrl(y,E,"data");return U&&F.size>0&&q.searchParams.set("_routes",u.filter(J=>F.has(J.route.id)).map(J=>J.route.id).join(",")),[q.pathname+q.search]},[E,S,v,b,$,u,y,w]),O=reactExports.useMemo(()=>getModuleLinkHrefs(R,b),[R,b]),B=useKeyedPrefetchLinks(R);return reactExports.createElement(reactExports.Fragment,null,T.map(F=>reactExports.createElement("link",{key:F,rel:"prefetch",as:"fetch",href:F,...g})),O.map(F=>reactExports.createElement("link",{key:F,rel:"modulepreload",href:F,...g})),B.map(({key:F,link:U})=>reactExports.createElement("link",{key:F,nonce:g.nonce,...U})))}function mergeRefs(...y){return u=>{y.forEach(g=>{typeof g=="function"?g(u):g!=null&&(g.current=u)})}}var isBrowser$1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{isBrowser$1&&(window.__reactRouterVersion="7.9.6")}catch{}function HashRouter({basename:y,children:u,window:g}){let v=reactExports.useRef();v.current==null&&(v.current=createHashHistory({window:g,v5Compat:!0}));let b=v.current,[w,E]=reactExports.useState({action:b.action,location:b.location}),S=reactExports.useCallback(A=>{reactExports.startTransition(()=>E(A))},[E]);return reactExports.useLayoutEffect(()=>b.listen(S),[b,S]),reactExports.createElement(Router,{basename:y,children:u,location:w.location,navigationType:w.action,navigator:b})}var ABSOLUTE_URL_REGEX2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link$1=reactExports.forwardRef(function({onClick:u,discover:g="render",prefetch:v="none",relative:b,reloadDocument:w,replace:E,state:S,target:A,to:$,preventScrollReset:R,viewTransition:T,...O},B){let{basename:F}=reactExports.useContext(NavigationContext),U=typeof $=="string"&&ABSOLUTE_URL_REGEX2.test($),q,J=!1;if(typeof $=="string"&&U&&(q=$,isBrowser$1))try{let pe=new URL(window.location.href),ve=$.startsWith("//")?new URL(pe.protocol+$):new URL($),he=stripBasename(ve.pathname,F);ve.origin===pe.origin&&he!=null?$=he+ve.search+ve.hash:J=!0}catch{warning$2(!1,`<Link to="${$}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ie=useHref($,{relative:b}),[oe,le,de]=usePrefetchBehavior(v,O),fe=useLinkClickHandler($,{replace:E,state:S,target:A,preventScrollReset:R,relative:b,viewTransition:T});function ye(pe){u&&u(pe),pe.defaultPrevented||fe(pe)}let we=reactExports.createElement("a",{...O,...de,href:q||ie,onClick:J||w?u:ye,ref:mergeRefs(B,le),target:A,"data-discover":!U&&g==="render"?"true":void 0});return oe&&!U?reactExports.createElement(reactExports.Fragment,null,we,reactExports.createElement(PrefetchPageLinks,{page:ie})):we});Link$1.displayName="Link";var NavLink=reactExports.forwardRef(function({"aria-current":u="page",caseSensitive:g=!1,className:v="",end:b=!1,style:w,to:E,viewTransition:S,children:A,...$},R){let T=useResolvedPath(E,{relative:$.relative}),O=useLocation(),B=reactExports.useContext(DataRouterStateContext),{navigator:F,basename:U}=reactExports.useContext(NavigationContext),q=B!=null&&useViewTransitionState(T)&&S===!0,J=F.encodeLocation?F.encodeLocation(T).pathname:T.pathname,ie=O.pathname,oe=B&&B.navigation&&B.navigation.location?B.navigation.location.pathname:null;g||(ie=ie.toLowerCase(),oe=oe?oe.toLowerCase():null,J=J.toLowerCase()),oe&&U&&(oe=stripBasename(oe,U)||oe);const le=J!=="/"&&J.endsWith("/")?J.length-1:J.length;let de=ie===J||!b&&ie.startsWith(J)&&ie.charAt(le)==="/",fe=oe!=null&&(oe===J||!b&&oe.startsWith(J)&&oe.charAt(J.length)==="/"),ye={isActive:de,isPending:fe,isTransitioning:q},we=de?u:void 0,pe;typeof v=="function"?pe=v(ye):pe=[v,de?"active":null,fe?"pending":null,q?"transitioning":null].filter(Boolean).join(" ");let ve=typeof w=="function"?w(ye):w;return reactExports.createElement(Link$1,{...$,"aria-current":we,className:pe,ref:R,style:ve,to:E,viewTransition:S},typeof A=="function"?A(ye):A)});NavLink.displayName="NavLink";var Form=reactExports.forwardRef(({discover:y="render",fetcherKey:u,navigate:g,reloadDocument:v,replace:b,state:w,method:E=defaultMethod,action:S,onSubmit:A,relative:$,preventScrollReset:R,viewTransition:T,...O},B)=>{let F=useSubmit(),U=useFormAction(S,{relative:$}),q=E.toLowerCase()==="get"?"get":"post",J=typeof S=="string"&&ABSOLUTE_URL_REGEX2.test(S),ie=oe=>{if(A&&A(oe),oe.defaultPrevented)return;oe.preventDefault();let le=oe.nativeEvent.submitter,de=le?.getAttribute("formmethod")||E;F(le||oe.currentTarget,{fetcherKey:u,method:de,navigate:g,replace:b,state:w,relative:$,preventScrollReset:R,viewTransition:T})};return reactExports.createElement("form",{ref:B,method:q,action:U,onSubmit:v?A:ie,...O,"data-discover":!J&&y==="render"?"true":void 0})});Form.displayName="Form";function getDataRouterConsoleError2(y){return`${y} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext3(y){let u=reactExports.useContext(DataRouterContext);return invariant$1(u,getDataRouterConsoleError2(y)),u}function useLinkClickHandler(y,{target:u,replace:g,state:v,preventScrollReset:b,relative:w,viewTransition:E}={}){let S=useNavigate(),A=useLocation(),$=useResolvedPath(y,{relative:w});return reactExports.useCallback(R=>{if(shouldProcessLinkClick(R,u)){R.preventDefault();let T=g!==void 0?g:createPath(A)===createPath($);S(y,{replace:T,state:v,preventScrollReset:b,relative:w,viewTransition:E})}},[A,S,$,g,v,u,y,b,w,E])}function useSearchParams(y){warning$2(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let u=reactExports.useRef(createSearchParams(y)),g=reactExports.useRef(!1),v=useLocation(),b=reactExports.useMemo(()=>getSearchParamsForLocation(v.search,g.current?null:u.current),[v.search]),w=useNavigate(),E=reactExports.useCallback((S,A)=>{const $=createSearchParams(typeof S=="function"?S(new URLSearchParams(b)):S);g.current=!0,w("?"+$,A)},[w,b]);return[b,E]}var fetcherId=0,getUniqueFetcherId=()=>`__${String(++fetcherId)}__`;function useSubmit(){let{router:y}=useDataRouterContext3("useSubmit"),{basename:u}=reactExports.useContext(NavigationContext),g=useRouteId();return reactExports.useCallback(async(v,b={})=>{let{action:w,method:E,encType:S,formData:A,body:$}=getFormSubmissionInfo(v,u);if(b.navigate===!1){let R=b.fetcherKey||getUniqueFetcherId();await y.fetch(R,g,b.action||w,{preventScrollReset:b.preventScrollReset,formData:A,body:$,formMethod:b.method||E,formEncType:b.encType||S,flushSync:b.flushSync})}else await y.navigate(b.action||w,{preventScrollReset:b.preventScrollReset,formData:A,body:$,formMethod:b.method||E,formEncType:b.encType||S,replace:b.replace,state:b.state,fromRouteId:g,flushSync:b.flushSync,viewTransition:b.viewTransition})},[y,u,g])}function useFormAction(y,{relative:u}={}){let{basename:g}=reactExports.useContext(NavigationContext),v=reactExports.useContext(RouteContext);invariant$1(v,"useFormAction must be used inside a RouteContext");let[b]=v.matches.slice(-1),w={...useResolvedPath(y||".",{relative:u})},E=useLocation();if(y==null){w.search=E.search;let S=new URLSearchParams(w.search),A=S.getAll("index");if(A.some(R=>R==="")){S.delete("index"),A.filter(T=>T).forEach(T=>S.append("index",T));let R=S.toString();w.search=R?`?${R}`:""}}return(!y||y===".")&&b.route.index&&(w.search=w.search?w.search.replace(/^\?/,"?index&"):"?index"),g!=="/"&&(w.pathname=w.pathname==="/"?g:joinPaths([g,w.pathname])),createPath(w)}function useViewTransitionState(y,{relative:u}={}){let g=reactExports.useContext(ViewTransitionContext);invariant$1(g!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:v}=useDataRouterContext3("useViewTransitionState"),b=useResolvedPath(y,{relative:u});if(!g.isTransitioning)return!1;let w=stripBasename(g.currentLocation.pathname,v)||g.currentLocation.pathname,E=stripBasename(g.nextLocation.pathname,v)||g.nextLocation.pathname;return matchPath(b.pathname,E)!=null||matchPath(b.pathname,w)!=null}var dist$1={},hasRequiredDist$1;function requireDist$1(){if(hasRequiredDist$1)return dist$1;hasRequiredDist$1=1,Object.defineProperty(dist$1,"__esModule",{value:!0}),dist$1.parseCookie=S,dist$1.parse=S,dist$1.stringifyCookie=A,dist$1.stringifySetCookie=$,dist$1.serialize=$,dist$1.parseSetCookie=R,dist$1.stringifySetCookie=$,dist$1.serialize=$;const y=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,u=/^[\u0021-\u003A\u003C-\u007E]*$/,g=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,v=/^[\u0020-\u003A\u003D-\u007E]*$/,b=/^-?\d+$/,w=Object.prototype.toString,E=(()=>{const q=function(){};return q.prototype=Object.create(null),q})();function S(q,J){const ie=new E,oe=q.length;if(oe<2)return ie;const le=J?.decode||F;let de=0;do{const fe=O(q,de,oe);if(fe===-1)break;const ye=T(q,de,oe);if(fe>ye){de=q.lastIndexOf(";",fe-1)+1;continue}const we=B(q,de,fe);ie[we]===void 0&&(ie[we]=le(B(q,fe+1,ye))),de=ye+1}while(de<oe);return ie}function A(q,J){const ie=J?.encode||encodeURIComponent,oe=[];for(const le of Object.keys(q)){const de=q[le];if(de===void 0)continue;if(!y.test(le))throw new TypeError(`cookie name is invalid: ${le}`);const fe=ie(de);if(!u.test(fe))throw new TypeError(`cookie val is invalid: ${de}`);oe.push(`${le}=${fe}`)}return oe.join("; ")}function $(q,J,ie){const oe=typeof q=="object"?q:{...ie,name:q,value:String(J)},de=(typeof J=="object"?J:ie)?.encode||encodeURIComponent;if(!y.test(oe.name))throw new TypeError(`argument name is invalid: ${oe.name}`);const fe=oe.value?de(oe.value):"";if(!u.test(fe))throw new TypeError(`argument val is invalid: ${oe.value}`);let ye=oe.name+"="+fe;if(oe.maxAge!==void 0){if(!Number.isInteger(oe.maxAge))throw new TypeError(`option maxAge is invalid: ${oe.maxAge}`);ye+="; Max-Age="+oe.maxAge}if(oe.domain){if(!g.test(oe.domain))throw new TypeError(`option domain is invalid: ${oe.domain}`);ye+="; Domain="+oe.domain}if(oe.path){if(!v.test(oe.path))throw new TypeError(`option path is invalid: ${oe.path}`);ye+="; Path="+oe.path}if(oe.expires){if(!U(oe.expires)||!Number.isFinite(oe.expires.valueOf()))throw new TypeError(`option expires is invalid: ${oe.expires}`);ye+="; Expires="+oe.expires.toUTCString()}if(oe.httpOnly&&(ye+="; HttpOnly"),oe.secure&&(ye+="; Secure"),oe.partitioned&&(ye+="; Partitioned"),oe.priority)switch(typeof oe.priority=="string"?oe.priority.toLowerCase():void 0){case"low":ye+="; Priority=Low";break;case"medium":ye+="; Priority=Medium";break;case"high":ye+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${oe.priority}`)}if(oe.sameSite)switch(typeof oe.sameSite=="string"?oe.sameSite.toLowerCase():oe.sameSite){case!0:case"strict":ye+="; SameSite=Strict";break;case"lax":ye+="; SameSite=Lax";break;case"none":ye+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${oe.sameSite}`)}return ye}function R(q,J){const ie=J?.decode||F,oe=q.length,le=T(q,0,oe),de=O(q,0,le),fe=de===-1?{name:"",value:ie(B(q,0,le))}:{name:B(q,0,de),value:ie(B(q,de+1,le))};let ye=le+1;for(;ye<oe;){const we=T(q,ye,oe),pe=O(q,ye,we),ve=pe===-1?B(q,ye,we):B(q,ye,pe),he=pe===-1?void 0:B(q,pe+1,we);switch(ve.toLowerCase()){case"httponly":fe.httpOnly=!0;break;case"secure":fe.secure=!0;break;case"partitioned":fe.partitioned=!0;break;case"domain":fe.domain=he;break;case"path":fe.path=he;break;case"max-age":he&&b.test(he)&&(fe.maxAge=Number(he));break;case"expires":if(!he)break;const ae=new Date(he);Number.isFinite(ae.valueOf())&&(fe.expires=ae);break;case"priority":if(!he)break;const Q=he.toLowerCase();(Q==="low"||Q==="medium"||Q==="high")&&(fe.priority=Q);break;case"samesite":if(!he)break;const j=he.toLowerCase();(j==="lax"||j==="strict"||j==="none")&&(fe.sameSite=j);break}ye=we+1}return fe}function T(q,J,ie){const oe=q.indexOf(";",J);return oe===-1?ie:oe}function O(q,J,ie){const oe=q.indexOf("=",J);return oe<ie?oe:-1}function B(q,J,ie){let oe=J,le=ie;do{const de=q.charCodeAt(oe);if(de!==32&&de!==9)break}while(++oe<le);for(;le>oe;){const de=q.charCodeAt(le-1);if(de!==32&&de!==9)break;le--}return q.slice(oe,le)}function F(q){if(q.indexOf("%")===-1)return q;try{return decodeURIComponent(q)}catch{return q}}function U(q){return w.call(q)==="[object Date]"}return dist$1}var distExports=requireDist$1();const cookie=getDefaultExportFromCjs$3(distExports),LayoutGroupContext=reactExports.createContext({});function useConstant(y){const u=reactExports.useRef(null);return u.current===null&&(u.current=y()),u.current}const isBrowser=typeof window<"u",useIsomorphicLayoutEffect=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,PresenceContext=reactExports.createContext(null);function addUniqueItem(y,u){y.indexOf(u)===-1&&y.push(u)}function removeItem(y,u){const g=y.indexOf(u);g>-1&&y.splice(g,1)}const clamp=(y,u,g)=>g>u?u:g<y?y:g;let invariant=()=>{};const MotionGlobalConfig={},isNumericalString=y=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(y);function isObject$4(y){return typeof y=="object"&&y!==null}const isZeroValueString=y=>/^0[^.\s]+$/u.test(y);function memo(y){let u;return()=>(u===void 0&&(u=y()),u)}const noop$3=y=>y,combineFunctions=(y,u)=>g=>u(y(g)),pipe$2=(...y)=>y.reduce(combineFunctions),progress=(y,u,g)=>{const v=u-y;return v===0?1:(g-y)/v};class SubscriptionManager{constructor(){this.subscriptions=[]}add(u){return addUniqueItem(this.subscriptions,u),()=>removeItem(this.subscriptions,u)}notify(u,g,v){const b=this.subscriptions.length;if(b)if(b===1)this.subscriptions[0](u,g,v);else for(let w=0;w<b;w++){const E=this.subscriptions[w];E&&E(u,g,v)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const secondsToMilliseconds=y=>y*1e3,millisecondsToSeconds=y=>y/1e3;function velocityPerSecond(y,u){return u?y*(1e3/u):0}const calcBezier=(y,u,g)=>(((1-3*g+3*u)*y+(3*g-6*u))*y+3*u)*y,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(y,u,g,v,b){let w,E,S=0;do E=u+(g-u)/2,w=calcBezier(E,v,b)-y,w>0?g=E:u=E;while(Math.abs(w)>subdivisionPrecision&&++S<subdivisionMaxIterations);return E}function cubicBezier(y,u,g,v){if(y===u&&g===v)return noop$3;const b=w=>binarySubdivide(w,0,1,y,g);return w=>w===0||w===1?w:calcBezier(b(w),u,v)}const mirrorEasing=y=>u=>u<=.5?y(2*u)/2:(2-y(2*(1-u)))/2,reverseEasing=y=>u=>1-y(1-u),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=y=>(y*=2)<1?.5*backIn(y):.5*(2-Math.pow(2,-10*(y-1))),circIn=y=>1-Math.sin(Math.acos(y)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=y=>Array.isArray(y)&&typeof y[0]!="number",isBezierDefinition=y=>Array.isArray(y)&&typeof y[0]=="number",easingLookup={linear:noop$3,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},isValidEasing=y=>typeof y=="string",easingDefinitionToFunction=y=>{if(isBezierDefinition(y)){invariant(y.length===4);const[u,g,v,b]=y;return cubicBezier(u,g,v,b)}else if(isValidEasing(y))return easingLookup[y];return y},stepsOrder=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function createRenderStep(y,u){let g=new Set,v=new Set,b=!1,w=!1;const E=new WeakSet;let S={delta:0,timestamp:0,isProcessing:!1};function A(R){E.has(R)&&($.schedule(R),y()),R(S)}const $={schedule:(R,T=!1,O=!1)=>{const F=O&&b?g:v;return T&&E.add(R),F.has(R)||F.add(R),R},cancel:R=>{v.delete(R),E.delete(R)},process:R=>{if(S=R,b){w=!0;return}b=!0,[g,v]=[v,g],g.forEach(A),g.clear(),b=!1,w&&(w=!1,$.process(R))}};return $}const maxElapsed=40;function createRenderBatcher(y,u){let g=!1,v=!0;const b={delta:0,timestamp:0,isProcessing:!1},w=()=>g=!0,E=stepsOrder.reduce((oe,le)=>(oe[le]=createRenderStep(w),oe),{}),{setup:S,read:A,resolveKeyframes:$,preUpdate:R,update:T,preRender:O,render:B,postRender:F}=E,U=()=>{const oe=MotionGlobalConfig.useManualTiming?b.timestamp:performance.now();g=!1,MotionGlobalConfig.useManualTiming||(b.delta=v?1e3/60:Math.max(Math.min(oe-b.timestamp,maxElapsed),1)),b.timestamp=oe,b.isProcessing=!0,S.process(b),A.process(b),$.process(b),R.process(b),T.process(b),O.process(b),B.process(b),F.process(b),b.isProcessing=!1,g&&u&&(v=!1,y(U))},q=()=>{g=!0,v=!0,b.isProcessing||y(U)};return{schedule:stepsOrder.reduce((oe,le)=>{const de=E[le];return oe[le]=(fe,ye=!1,we=!1)=>(g||q(),de.schedule(fe,ye,we)),oe},{}),cancel:oe=>{for(let le=0;le<stepsOrder.length;le++)E[stepsOrder[le]].cancel(oe)},state:b,steps:E}}const{schedule:frame,cancel:cancelFrame,state:frameData,steps:frameSteps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop$3,!0);let now;function clearTime(){now=void 0}const time$2={now:()=>(now===void 0&&time$2.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:y=>{now=y,queueMicrotask(clearTime)}},checkStringStartsWith=y=>u=>typeof u=="string"&&u.startsWith(y),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=y=>startsAsVariableToken(y)?singleCssVariableRegex.test(y.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,number$2={test:y=>typeof y=="number",parse:parseFloat,transform:y=>y},alpha={...number$2,transform:y=>clamp(0,1,y)},scale={...number$2,default:1},sanitize$1=y=>Math.round(y*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function isNullish(y){return y==null}const singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,isColorString=(y,u)=>g=>!!(typeof g=="string"&&singleColorRegex.test(g)&&g.startsWith(y)||u&&!isNullish(g)&&Object.prototype.hasOwnProperty.call(g,u)),splitColor=(y,u,g)=>v=>{if(typeof v!="string")return v;const[b,w,E,S]=v.match(floatRegex);return{[y]:parseFloat(b),[u]:parseFloat(w),[g]:parseFloat(E),alpha:S!==void 0?parseFloat(S):1}},clampRgbUnit=y=>clamp(0,255,y),rgbUnit={...number$2,transform:y=>Math.round(clampRgbUnit(y))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:y,green:u,blue:g,alpha:v=1})=>"rgba("+rgbUnit.transform(y)+", "+rgbUnit.transform(u)+", "+rgbUnit.transform(g)+", "+sanitize$1(alpha.transform(v))+")"};function parseHex(y){let u="",g="",v="",b="";return y.length>5?(u=y.substring(1,3),g=y.substring(3,5),v=y.substring(5,7),b=y.substring(7,9)):(u=y.substring(1,2),g=y.substring(2,3),v=y.substring(3,4),b=y.substring(4,5),u+=u,g+=g,v+=v,b+=b),{red:parseInt(u,16),green:parseInt(g,16),blue:parseInt(v,16),alpha:b?parseInt(b,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},createUnitType=y=>({test:u=>typeof u=="string"&&u.endsWith(y)&&u.split(" ").length===1,parse:parseFloat,transform:u=>`${u}${y}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:y=>percent.parse(y)/100,transform:y=>percent.transform(y*100)},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:y,saturation:u,lightness:g,alpha:v=1})=>"hsla("+Math.round(y)+", "+percent.transform(sanitize$1(u))+", "+percent.transform(sanitize$1(g))+", "+sanitize$1(alpha.transform(v))+")"},color={test:y=>rgba.test(y)||hex.test(y)||hsla.test(y),parse:y=>rgba.test(y)?rgba.parse(y):hsla.test(y)?hsla.parse(y):hex.parse(y),transform:y=>typeof y=="string"?y:y.hasOwnProperty("red")?rgba.transform(y):hsla.transform(y),getAnimatableNone:y=>{const u=color.parse(y);return u.alpha=0,color.transform(u)}},colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function test$1(y){return isNaN(y)&&typeof y=="string"&&(y.match(floatRegex)?.length||0)+(y.match(colorRegex)?.length||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(y){const u=y.toString(),g=[],v={color:[],number:[],var:[]},b=[];let w=0;const S=u.replace(complexRegex,A=>(color.test(A)?(v.color.push(w),b.push(COLOR_TOKEN),g.push(color.parse(A))):A.startsWith(VAR_FUNCTION_TOKEN)?(v.var.push(w),b.push(VAR_TOKEN),g.push(A)):(v.number.push(w),b.push(NUMBER_TOKEN),g.push(parseFloat(A))),++w,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:g,split:S,indexes:v,types:b}}function parseComplexValue(y){return analyseComplexValue(y).values}function createTransformer(y){const{split:u,types:g}=analyseComplexValue(y),v=u.length;return b=>{let w="";for(let E=0;E<v;E++)if(w+=u[E],b[E]!==void 0){const S=g[E];S===NUMBER_TOKEN?w+=sanitize$1(b[E]):S===COLOR_TOKEN?w+=color.transform(b[E]):w+=b[E]}return w}}const convertNumbersToZero=y=>typeof y=="number"?0:color.test(y)?color.getAnimatableNone(y):y;function getAnimatableNone$1(y){const u=parseComplexValue(y);return createTransformer(y)(u.map(convertNumbersToZero))}const complex={test:test$1,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1};function hueToRgb(y,u,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?y+(u-y)*6*g:g<1/2?u:g<2/3?y+(u-y)*(2/3-g)*6:y}function hslaToRgba({hue:y,saturation:u,lightness:g,alpha:v}){y/=360,u/=100,g/=100;let b=0,w=0,E=0;if(!u)b=w=E=g;else{const S=g<.5?g*(1+u):g+u-g*u,A=2*g-S;b=hueToRgb(A,S,y+1/3),w=hueToRgb(A,S,y),E=hueToRgb(A,S,y-1/3)}return{red:Math.round(b*255),green:Math.round(w*255),blue:Math.round(E*255),alpha:v}}function mixImmediate(y,u){return g=>g>0?u:y}const mixNumber$1=(y,u,g)=>y+(u-y)*g,mixLinearColor=(y,u,g)=>{const v=y*y,b=g*(u*u-v)+v;return b<0?0:Math.sqrt(b)},colorTypes=[hex,rgba,hsla],getColorType=y=>colorTypes.find(u=>u.test(y));function asRGBA(y){const u=getColorType(y);if(!u)return!1;let g=u.parse(y);return u===hsla&&(g=hslaToRgba(g)),g}const mixColor=(y,u)=>{const g=asRGBA(y),v=asRGBA(u);if(!g||!v)return mixImmediate(y,u);const b={...g};return w=>(b.red=mixLinearColor(g.red,v.red,w),b.green=mixLinearColor(g.green,v.green,w),b.blue=mixLinearColor(g.blue,v.blue,w),b.alpha=mixNumber$1(g.alpha,v.alpha,w),rgba.transform(b))},invisibleValues=new Set(["none","hidden"]);function mixVisibility(y,u){return invisibleValues.has(y)?g=>g<=0?y:u:g=>g>=1?u:y}function mixNumber(y,u){return g=>mixNumber$1(y,u,g)}function getMixer(y){return typeof y=="number"?mixNumber:typeof y=="string"?isCSSVariableToken(y)?mixImmediate:color.test(y)?mixColor:mixComplex:Array.isArray(y)?mixArray:typeof y=="object"?color.test(y)?mixColor:mixObject:mixImmediate}function mixArray(y,u){const g=[...y],v=g.length,b=y.map((w,E)=>getMixer(w)(w,u[E]));return w=>{for(let E=0;E<v;E++)g[E]=b[E](w);return g}}function mixObject(y,u){const g={...y,...u},v={};for(const b in g)y[b]!==void 0&&u[b]!==void 0&&(v[b]=getMixer(y[b])(y[b],u[b]));return b=>{for(const w in v)g[w]=v[w](b);return g}}function matchOrder(y,u){const g=[],v={color:0,var:0,number:0};for(let b=0;b<u.values.length;b++){const w=u.types[b],E=y.indexes[w][v[w]],S=y.values[E]??0;g[b]=S,v[w]++}return g}const mixComplex=(y,u)=>{const g=complex.createTransformer(u),v=analyseComplexValue(y),b=analyseComplexValue(u);return v.indexes.var.length===b.indexes.var.length&&v.indexes.color.length===b.indexes.color.length&&v.indexes.number.length>=b.indexes.number.length?invisibleValues.has(y)&&!b.values.length||invisibleValues.has(u)&&!v.values.length?mixVisibility(y,u):pipe$2(mixArray(matchOrder(v,b),b.values),g):mixImmediate(y,u)};function mix(y,u,g){return typeof y=="number"&&typeof u=="number"&&typeof g=="number"?mixNumber$1(y,u,g):getMixer(y)(y,u)}const frameloopDriver=y=>{const u=({timestamp:g})=>y(g);return{start:(g=!0)=>frame.update(u,g),stop:()=>cancelFrame(u),now:()=>frameData.isProcessing?frameData.timestamp:time$2.now()}},generateLinearEasing=(y,u,g=10)=>{let v="";const b=Math.max(Math.round(u/g),2);for(let w=0;w<b;w++)v+=Math.round(y(w/(b-1))*1e4)/1e4+", ";return`linear(${v.substring(0,v.length-2)})`},maxGeneratorDuration=2e4;function calcGeneratorDuration(y){let u=0;const g=50;let v=y.next(u);for(;!v.done&&u<maxGeneratorDuration;)u+=g,v=y.next(u);return u>=maxGeneratorDuration?1/0:u}function createGeneratorEasing(y,u=100,g){const v=g({...y,keyframes:[0,u]}),b=Math.min(calcGeneratorDuration(v),maxGeneratorDuration);return{type:"keyframes",ease:w=>v.next(b*w).value/u,duration:millisecondsToSeconds(b)}}const velocitySampleDuration=5;function calcGeneratorVelocity(y,u,g){const v=Math.max(u-velocitySampleDuration,0);return velocityPerSecond(g-y(v),u-v)}const springDefaults={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},safeMin=.001;function findSpring({duration:y=springDefaults.duration,bounce:u=springDefaults.bounce,velocity:g=springDefaults.velocity,mass:v=springDefaults.mass}){let b,w,E=1-u;E=clamp(springDefaults.minDamping,springDefaults.maxDamping,E),y=clamp(springDefaults.minDuration,springDefaults.maxDuration,millisecondsToSeconds(y)),E<1?(b=$=>{const R=$*E,T=R*y,O=R-g,B=calcAngularFreq($,E),F=Math.exp(-T);return safeMin-O/B*F},w=$=>{const T=$*E*y,O=T*g+g,B=Math.pow(E,2)*Math.pow($,2)*y,F=Math.exp(-T),U=calcAngularFreq(Math.pow($,2),E);return(-b($)+safeMin>0?-1:1)*((O-B)*F)/U}):(b=$=>{const R=Math.exp(-$*y),T=($-g)*y+1;return-safeMin+R*T},w=$=>{const R=Math.exp(-$*y),T=(g-$)*(y*y);return R*T});const S=5/y,A=approximateRoot(b,w,S);if(y=secondsToMilliseconds(y),isNaN(A))return{stiffness:springDefaults.stiffness,damping:springDefaults.damping,duration:y};{const $=Math.pow(A,2)*v;return{stiffness:$,damping:E*2*Math.sqrt(v*$),duration:y}}}const rootIterations=12;function approximateRoot(y,u,g){let v=g;for(let b=1;b<rootIterations;b++)v=v-y(v)/u(v);return v}function calcAngularFreq(y,u){return y*Math.sqrt(1-u*u)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(y,u){return u.some(g=>y[g]!==void 0)}function getSpringOptions(y){let u={velocity:springDefaults.velocity,stiffness:springDefaults.stiffness,damping:springDefaults.damping,mass:springDefaults.mass,isResolvedFromDuration:!1,...y};if(!isSpringType(y,physicsKeys)&&isSpringType(y,durationKeys))if(y.visualDuration){const g=y.visualDuration,v=2*Math.PI/(g*1.2),b=v*v,w=2*clamp(.05,1,1-(y.bounce||0))*Math.sqrt(b);u={...u,mass:springDefaults.mass,stiffness:b,damping:w}}else{const g=findSpring(y);u={...u,...g,mass:springDefaults.mass},u.isResolvedFromDuration=!0}return u}function spring(y=springDefaults.visualDuration,u=springDefaults.bounce){const g=typeof y!="object"?{visualDuration:y,keyframes:[0,1],bounce:u}:y;let{restSpeed:v,restDelta:b}=g;const w=g.keyframes[0],E=g.keyframes[g.keyframes.length-1],S={done:!1,value:w},{stiffness:A,damping:$,mass:R,duration:T,velocity:O,isResolvedFromDuration:B}=getSpringOptions({...g,velocity:-millisecondsToSeconds(g.velocity||0)}),F=O||0,U=$/(2*Math.sqrt(A*R)),q=E-w,J=millisecondsToSeconds(Math.sqrt(A/R)),ie=Math.abs(q)<5;v||(v=ie?springDefaults.restSpeed.granular:springDefaults.restSpeed.default),b||(b=ie?springDefaults.restDelta.granular:springDefaults.restDelta.default);let oe;if(U<1){const de=calcAngularFreq(J,U);oe=fe=>{const ye=Math.exp(-U*J*fe);return E-ye*((F+U*J*q)/de*Math.sin(de*fe)+q*Math.cos(de*fe))}}else if(U===1)oe=de=>E-Math.exp(-J*de)*(q+(F+J*q)*de);else{const de=J*Math.sqrt(U*U-1);oe=fe=>{const ye=Math.exp(-U*J*fe),we=Math.min(de*fe,300);return E-ye*((F+U*J*q)*Math.sinh(we)+de*q*Math.cosh(we))/de}}const le={calculatedDuration:B&&T||null,next:de=>{const fe=oe(de);if(B)S.done=de>=T;else{let ye=de===0?F:0;U<1&&(ye=de===0?secondsToMilliseconds(F):calcGeneratorVelocity(oe,de,fe));const we=Math.abs(ye)<=v,pe=Math.abs(E-fe)<=b;S.done=we&&pe}return S.value=S.done?E:fe,S},toString:()=>{const de=Math.min(calcGeneratorDuration(le),maxGeneratorDuration),fe=generateLinearEasing(ye=>le.next(de*ye).value,de,30);return de+"ms "+fe},toTransition:()=>{}};return le}spring.applyToOptions=y=>{const u=createGeneratorEasing(y,100,spring);return y.ease=u.ease,y.duration=secondsToMilliseconds(u.duration),y.type="keyframes",y};function inertia({keyframes:y,velocity:u=0,power:g=.8,timeConstant:v=325,bounceDamping:b=10,bounceStiffness:w=500,modifyTarget:E,min:S,max:A,restDelta:$=.5,restSpeed:R}){const T=y[0],O={done:!1,value:T},B=we=>S!==void 0&&we<S||A!==void 0&&we>A,F=we=>S===void 0?A:A===void 0||Math.abs(S-we)<Math.abs(A-we)?S:A;let U=g*u;const q=T+U,J=E===void 0?q:E(q);J!==q&&(U=J-T);const ie=we=>-U*Math.exp(-we/v),oe=we=>J+ie(we),le=we=>{const pe=ie(we),ve=oe(we);O.done=Math.abs(pe)<=$,O.value=O.done?J:ve};let de,fe;const ye=we=>{B(O.value)&&(de=we,fe=spring({keyframes:[O.value,F(O.value)],velocity:calcGeneratorVelocity(oe,we,O.value),damping:b,stiffness:w,restDelta:$,restSpeed:R}))};return ye(0),{calculatedDuration:null,next:we=>{let pe=!1;return!fe&&de===void 0&&(pe=!0,le(we),ye(we)),de!==void 0&&we>=de?fe.next(we-de):(!pe&&le(we),O)}}}function createMixers(y,u,g){const v=[],b=g||MotionGlobalConfig.mix||mix,w=y.length-1;for(let E=0;E<w;E++){let S=b(y[E],y[E+1]);if(u){const A=Array.isArray(u)?u[E]||noop$3:u;S=pipe$2(A,S)}v.push(S)}return v}function interpolate(y,u,{clamp:g=!0,ease:v,mixer:b}={}){const w=y.length;if(invariant(w===u.length),w===1)return()=>u[0];if(w===2&&u[0]===u[1])return()=>u[1];const E=y[0]===y[1];y[0]>y[w-1]&&(y=[...y].reverse(),u=[...u].reverse());const S=createMixers(u,v,b),A=S.length,$=R=>{if(E&&R<y[0])return u[0];let T=0;if(A>1)for(;T<y.length-2&&!(R<y[T+1]);T++);const O=progress(y[T],y[T+1],R);return S[T](O)};return g?R=>$(clamp(y[0],y[w-1],R)):$}function fillOffset(y,u){const g=y[y.length-1];for(let v=1;v<=u;v++){const b=progress(0,u,v);y.push(mixNumber$1(g,1,b))}}function defaultOffset(y){const u=[0];return fillOffset(u,y.length-1),u}function convertOffsetToTimes(y,u){return y.map(g=>g*u)}function defaultEasing(y,u){return y.map(()=>u||easeInOut).splice(0,y.length-1)}function keyframes({duration:y=300,keyframes:u,times:g,ease:v="easeInOut"}){const b=isEasingArray(v)?v.map(easingDefinitionToFunction):easingDefinitionToFunction(v),w={done:!1,value:u[0]},E=convertOffsetToTimes(g&&g.length===u.length?g:defaultOffset(u),y),S=interpolate(E,u,{ease:Array.isArray(b)?b:defaultEasing(u,b)});return{calculatedDuration:y,next:A=>(w.value=S(A),w.done=A>=y,w)}}const isNotNull$1=y=>y!==null;function getFinalKeyframe$1(y,{repeat:u,repeatType:g="loop"},v,b=1){const w=y.filter(isNotNull$1),S=b<0||u&&g!=="loop"&&u%2===1?0:w.length-1;return!S||v===void 0?w[S]:v}const transitionTypeMap={decay:inertia,inertia,tween:keyframes,keyframes,spring};function replaceTransitionType(y){typeof y.type=="string"&&(y.type=transitionTypeMap[y.type])}class WithPromise{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(u=>{this.resolve=u})}notifyFinished(){this.resolve()}then(u,g){return this.finished.then(u,g)}}const percentToProgress=y=>y/100;class JSAnimation extends WithPromise{constructor(u){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:g}=this.options;g&&g.updatedAt!==time$2.now()&&this.tick(time$2.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=u,this.initAnimation(),this.play(),u.autoplay===!1&&this.pause()}initAnimation(){const{options:u}=this;replaceTransitionType(u);const{type:g=keyframes,repeat:v=0,repeatDelay:b=0,repeatType:w,velocity:E=0}=u;let{keyframes:S}=u;const A=g||keyframes;A!==keyframes&&typeof S[0]!="number"&&(this.mixKeyframes=pipe$2(percentToProgress,mix(S[0],S[1])),S=[0,100]);const $=A({...u,keyframes:S});w==="mirror"&&(this.mirroredGenerator=A({...u,keyframes:[...S].reverse(),velocity:-E})),$.calculatedDuration===null&&($.calculatedDuration=calcGeneratorDuration($));const{calculatedDuration:R}=$;this.calculatedDuration=R,this.resolvedDuration=R+b,this.totalDuration=this.resolvedDuration*(v+1)-b,this.generator=$}updateTime(u){const g=Math.round(u-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=g}tick(u,g=!1){const{generator:v,totalDuration:b,mixKeyframes:w,mirroredGenerator:E,resolvedDuration:S,calculatedDuration:A}=this;if(this.startTime===null)return v.next(0);const{delay:$=0,keyframes:R,repeat:T,repeatType:O,repeatDelay:B,type:F,onUpdate:U,finalKeyframe:q}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,u):this.speed<0&&(this.startTime=Math.min(u-b/this.speed,this.startTime)),g?this.currentTime=u:this.updateTime(u);const J=this.currentTime-$*(this.playbackSpeed>=0?1:-1),ie=this.playbackSpeed>=0?J<0:J>b;this.currentTime=Math.max(J,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=b);let oe=this.currentTime,le=v;if(T){const we=Math.min(this.currentTime,b)/S;let pe=Math.floor(we),ve=we%1;!ve&&we>=1&&(ve=1),ve===1&&pe--,pe=Math.min(pe,T+1),!!(pe%2)&&(O==="reverse"?(ve=1-ve,B&&(ve-=B/S)):O==="mirror"&&(le=E)),oe=clamp(0,1,ve)*S}const de=ie?{done:!1,value:R[0]}:le.next(oe);w&&(de.value=w(de.value));let{done:fe}=de;!ie&&A!==null&&(fe=this.playbackSpeed>=0?this.currentTime>=b:this.currentTime<=0);const ye=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&fe);return ye&&F!==inertia&&(de.value=getFinalKeyframe$1(R,this.options,q,this.speed)),U&&U(de.value),ye&&this.finish(),de}then(u,g){return this.finished.then(u,g)}get duration(){return millisecondsToSeconds(this.calculatedDuration)}get iterationDuration(){const{delay:u=0}=this.options||{};return this.duration+millisecondsToSeconds(u)}get time(){return millisecondsToSeconds(this.currentTime)}set time(u){u=secondsToMilliseconds(u),this.currentTime=u,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=u:this.driver&&(this.startTime=this.driver.now()-u/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(u){this.updateTime(time$2.now());const g=this.playbackSpeed!==u;this.playbackSpeed=u,g&&(this.time=millisecondsToSeconds(this.currentTime))}play(){if(this.isStopped)return;const{driver:u=frameloopDriver,startTime:g}=this.options;this.driver||(this.driver=u(b=>this.tick(b))),this.options.onPlay?.();const v=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=v):this.holdTime!==null?this.startTime=v-this.holdTime:this.startTime||(this.startTime=g??v),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(time$2.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(u){return this.startTime=0,this.tick(u,!0)}attachTimeline(u){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),u.observe(this)}}function fillWildcards(y){for(let u=1;u<y.length;u++)y[u]??(y[u]=y[u-1])}const radToDeg=y=>y*180/Math.PI,rotate=y=>{const u=radToDeg(Math.atan2(y[1],y[0]));return rebaseAngle(u)},matrix2dParsers={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:y=>(Math.abs(y[0])+Math.abs(y[3]))/2,rotate,rotateZ:rotate,skewX:y=>radToDeg(Math.atan(y[1])),skewY:y=>radToDeg(Math.atan(y[2])),skew:y=>(Math.abs(y[1])+Math.abs(y[2]))/2},rebaseAngle=y=>(y=y%360,y<0&&(y+=360),y),rotateZ=rotate,scaleX=y=>Math.sqrt(y[0]*y[0]+y[1]*y[1]),scaleY=y=>Math.sqrt(y[4]*y[4]+y[5]*y[5]),matrix3dParsers={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX,scaleY,scale:y=>(scaleX(y)+scaleY(y))/2,rotateX:y=>rebaseAngle(radToDeg(Math.atan2(y[6],y[5]))),rotateY:y=>rebaseAngle(radToDeg(Math.atan2(-y[2],y[0]))),rotateZ,rotate:rotateZ,skewX:y=>radToDeg(Math.atan(y[4])),skewY:y=>radToDeg(Math.atan(y[1])),skew:y=>(Math.abs(y[1])+Math.abs(y[4]))/2};function defaultTransformValue(y){return y.includes("scale")?1:0}function parseValueFromTransform(y,u){if(!y||y==="none")return defaultTransformValue(u);const g=y.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let v,b;if(g)v=matrix3dParsers,b=g;else{const S=y.match(/^matrix\(([-\d.e\s,]+)\)$/u);v=matrix2dParsers,b=S}if(!b)return defaultTransformValue(u);const w=v[u],E=b[1].split(",").map(convertTransformToNumber);return typeof w=="function"?w(E):E[w]}const readTransformValue=(y,u)=>{const{transform:g="none"}=getComputedStyle(y);return parseValueFromTransform(g,u)};function convertTransformToNumber(y){return parseFloat(y.trim())}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder),isNumOrPxType=y=>y===number$2||y===px,transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(y=>!transformKeys.has(y));function removeNonTranslationalTransform(y){const u=[];return nonTranslationalTransformKeys.forEach(g=>{const v=y.getValue(g);v!==void 0&&(u.push([g,v.get()]),v.set(g.startsWith("scale")?1:0))}),u}const positionalValues={width:({x:y},{paddingLeft:u="0",paddingRight:g="0"})=>y.max-y.min-parseFloat(u)-parseFloat(g),height:({y},{paddingTop:u="0",paddingBottom:g="0"})=>y.max-y.min-parseFloat(u)-parseFloat(g),top:(y,{top:u})=>parseFloat(u),left:(y,{left:u})=>parseFloat(u),bottom:({y},{top:u})=>parseFloat(u)+(y.max-y.min),right:({x:y},{left:u})=>parseFloat(u)+(y.max-y.min),x:(y,{transform:u})=>parseValueFromTransform(u,"x"),y:(y,{transform:u})=>parseValueFromTransform(u,"y")};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1,isForced=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const y=Array.from(toResolve).filter(v=>v.needsMeasurement),u=new Set(y.map(v=>v.element)),g=new Map;u.forEach(v=>{const b=removeNonTranslationalTransform(v);b.length&&(g.set(v,b),v.render())}),y.forEach(v=>v.measureInitialState()),u.forEach(v=>{v.render();const b=g.get(v);b&&b.forEach(([w,E])=>{v.getValue(w)?.set(E)})}),y.forEach(v=>v.measureEndState()),y.forEach(v=>{v.suspendedScrollY!==void 0&&window.scrollTo(0,v.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(y=>y.complete(isForced)),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(y=>{y.readKeyframes(),y.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){isForced=!0,readAllKeyframes(),measureAllKeyframes(),isForced=!1}class KeyframeResolver{constructor(u,g,v,b,w,E=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...u],this.onComplete=g,this.name=v,this.motionValue=b,this.element=w,this.isAsync=E}scheduleResolve(){this.state="scheduled",this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:u,name:g,element:v,motionValue:b}=this;if(u[0]===null){const w=b?.get(),E=u[u.length-1];if(w!==void 0)u[0]=w;else if(v&&g){const S=v.readValue(g,E);S!=null&&(u[0]=S)}u[0]===void 0&&(u[0]=E),b&&w===void 0&&b.set(u[0])}fillWildcards(u)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(u=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,u),toResolve.delete(this)}cancel(){this.state==="scheduled"&&(toResolve.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const isCSSVar=y=>y.startsWith("--");function setStyle(y,u,g){isCSSVar(u)?y.style.setProperty(u,g):y.style[u]=g}const supportsScrollTimeline=memo(()=>window.ScrollTimeline!==void 0),supportsFlags={};function memoSupports(y,u){const g=memo(y);return()=>supportsFlags[u]??g()}const supportsLinearEasing=memoSupports(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cubicBezierAsString=([y,u,g,v])=>`cubic-bezier(${y}, ${u}, ${g}, ${v})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasing(y,u){if(y)return typeof y=="function"?supportsLinearEasing()?generateLinearEasing(y,u):"ease-out":isBezierDefinition(y)?cubicBezierAsString(y):Array.isArray(y)?y.map(g=>mapEasingToNativeEasing(g,u)||supportedWaapiEasing.easeOut):supportedWaapiEasing[y]}function startWaapiAnimation(y,u,g,{delay:v=0,duration:b=300,repeat:w=0,repeatType:E="loop",ease:S="easeOut",times:A}={},$=void 0){const R={[u]:g};A&&(R.offset=A);const T=mapEasingToNativeEasing(S,b);Array.isArray(T)&&(R.easing=T);const O={delay:v,duration:b,easing:Array.isArray(T)?"linear":T,fill:"both",iterations:w+1,direction:E==="reverse"?"alternate":"normal"};return $&&(O.pseudoElement=$),y.animate(R,O)}function isGenerator(y){return typeof y=="function"&&"applyToOptions"in y}function applyGeneratorOptions({type:y,...u}){return isGenerator(y)&&supportsLinearEasing()?y.applyToOptions(u):(u.duration??(u.duration=300),u.ease??(u.ease="easeOut"),u)}class NativeAnimation extends WithPromise{constructor(u){if(super(),this.finishedTime=null,this.isStopped=!1,!u)return;const{element:g,name:v,keyframes:b,pseudoElement:w,allowFlatten:E=!1,finalKeyframe:S,onComplete:A}=u;this.isPseudoElement=!!w,this.allowFlatten=E,this.options=u,invariant(typeof u.type!="string");const $=applyGeneratorOptions(u);this.animation=startWaapiAnimation(g,v,b,$,w),$.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!w){const R=getFinalKeyframe$1(b,this.options,S,this.speed);this.updateMotionValue?this.updateMotionValue(R):setStyle(g,v,R),this.animation.cancel()}A?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:u}=this;u==="idle"||u==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const u=this.animation.effect?.getComputedTiming?.().duration||0;return millisecondsToSeconds(Number(u))}get iterationDuration(){const{delay:u=0}=this.options||{};return this.duration+millisecondsToSeconds(u)}get time(){return millisecondsToSeconds(Number(this.animation.currentTime)||0)}set time(u){this.finishedTime=null,this.animation.currentTime=secondsToMilliseconds(u)}get speed(){return this.animation.playbackRate}set speed(u){u<0&&(this.finishedTime=null),this.animation.playbackRate=u}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(u){this.animation.startTime=u}attachTimeline({timeline:u,observe:g}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,u&&supportsScrollTimeline()?(this.animation.timeline=u,noop$3):g(this)}}const unsupportedEasingFunctions={anticipate,backInOut,circInOut};function isUnsupportedEase(y){return y in unsupportedEasingFunctions}function replaceStringEasing(y){typeof y.ease=="string"&&isUnsupportedEase(y.ease)&&(y.ease=unsupportedEasingFunctions[y.ease])}const sampleDelta=10;class NativeAnimationExtended extends NativeAnimation{constructor(u){replaceStringEasing(u),replaceTransitionType(u),super(u),u.startTime&&(this.startTime=u.startTime),this.options=u}updateMotionValue(u){const{motionValue:g,onUpdate:v,onComplete:b,element:w,...E}=this.options;if(!g)return;if(u!==void 0){g.set(u);return}const S=new JSAnimation({...E,autoplay:!1}),A=secondsToMilliseconds(this.finishedTime??this.time);g.setWithVelocity(S.sample(A-sampleDelta).value,S.sample(A).value,sampleDelta),S.stop()}}const isAnimatable=(y,u)=>u==="zIndex"?!1:!!(typeof y=="number"||Array.isArray(y)||typeof y=="string"&&(complex.test(y)||y==="0")&&!y.startsWith("url("));function hasKeyframesChanged(y){const u=y[0];if(y.length===1)return!0;for(let g=0;g<y.length;g++)if(y[g]!==u)return!0}function canAnimate(y,u,g,v){const b=y[0];if(b===null)return!1;if(u==="display"||u==="visibility")return!0;const w=y[y.length-1],E=isAnimatable(b,u),S=isAnimatable(w,u);return!E||!S?!1:hasKeyframesChanged(y)||(g==="spring"||isGenerator(g))&&v}function makeAnimationInstant(y){y.duration=0,y.type="keyframes"}const acceleratedValues=new Set(["opacity","clipPath","filter","transform"]),supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function supportsBrowserAnimation(y){const{motionValue:u,name:g,repeatDelay:v,repeatType:b,damping:w,type:E}=y;if(!(u?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:A,transformTemplate:$}=u.owner.getProps();return supportsWaapi()&&g&&acceleratedValues.has(g)&&(g!=="transform"||!$)&&!A&&!v&&b!=="mirror"&&w!==0&&E!=="inertia"}const MAX_RESOLVE_DELAY=40;class AsyncMotionValueAnimation extends WithPromise{constructor({autoplay:u=!0,delay:g=0,type:v="keyframes",repeat:b=0,repeatDelay:w=0,repeatType:E="loop",keyframes:S,name:A,motionValue:$,element:R,...T}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=time$2.now();const O={autoplay:u,delay:g,type:v,repeat:b,repeatDelay:w,repeatType:E,name:A,motionValue:$,element:R,...T},B=R?.KeyframeResolver||KeyframeResolver;this.keyframeResolver=new B(S,(F,U,q)=>this.onKeyframesResolved(F,U,O,!q),A,$,R),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(u,g,v,b){this.keyframeResolver=void 0;const{name:w,type:E,velocity:S,delay:A,isHandoff:$,onUpdate:R}=v;this.resolvedAt=time$2.now(),canAnimate(u,w,E,S)||((MotionGlobalConfig.instantAnimations||!A)&&R?.(getFinalKeyframe$1(u,v,g)),u[0]=u[u.length-1],makeAnimationInstant(v),v.repeat=0);const O={startTime:b?this.resolvedAt?this.resolvedAt-this.createdAt>MAX_RESOLVE_DELAY?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:g,...v,keyframes:u},B=!$&&supportsBrowserAnimation(O)?new NativeAnimationExtended({...O,element:O.motionValue.owner.current}):new JSAnimation(O);B.finished.then(()=>this.notifyFinished()).catch(noop$3),this.pendingTimeline&&(this.stopTimeline=B.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=B}get finished(){return this._animation?this.animation.finished:this._finished}then(u,g){return this.finished.finally(u).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),flushKeyframeResolvers()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(u){this.animation.time=u}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(u){this.animation.speed=u}get startTime(){return this.animation.startTime}attachTimeline(u){return this._animation?this.stopTimeline=this.animation.attachTimeline(u):this.pendingTimeline=u,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(y){const u=splitCSSVariableRegex.exec(y);if(!u)return[,];const[,g,v,b]=u;return[`--${g??v}`,b]}function getVariableValue(y,u,g=1){const[v,b]=parseCSSVariable(y);if(!v)return;const w=window.getComputedStyle(u).getPropertyValue(v);if(w){const E=w.trim();return isNumericalString(E)?parseFloat(E):E}return isCSSVariableToken(b)?getVariableValue(b,u,g+1):b}function getValueTransition(y,u){return y?.[u]??y?.default??y}const positionalKeys=new Set(["width","height","top","left","right","bottom",...transformPropOrder]),auto={test:y=>y==="auto",parse:y=>y},testValueType=y=>u=>u.test(y),dimensionValueTypes=[number$2,px,percent,degrees,vw,vh,auto],findDimensionValueType=y=>dimensionValueTypes.find(testValueType(y));function isNone(y){return typeof y=="number"?y===0:y!==null?y==="none"||y==="0"||isZeroValueString(y):!0}const maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(y){const[u,g]=y.slice(0,-1).split("(");if(u==="drop-shadow")return y;const[v]=g.match(floatRegex)||[];if(!v)return y;const b=g.replace(v,"");let w=maxDefaults.has(u)?1:0;return v!==g&&(w*=100),u+"("+w+b+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter$1={...complex,getAnimatableNone:y=>{const u=y.match(functionRegex);return u?u.map(applyDefaultFilter).join(" "):y}},int$1={...number$2,transform:Math.round},transformValueTypes={rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px},numberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,top:px,right:px,bottom:px,left:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,backgroundPositionX:px,backgroundPositionY:px,...transformValueTypes,zIndex:int$1,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int$1},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter:filter$1,WebkitFilter:filter$1},getDefaultValueType=y=>defaultValueTypes[y];function getAnimatableNone(y,u){let g=getDefaultValueType(y);return g!==filter$1&&(g=complex),g.getAnimatableNone?g.getAnimatableNone(u):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(y,u,g){let v=0,b;for(;v<y.length&&!b;){const w=y[v];typeof w=="string"&&!invalidTemplates.has(w)&&analyseComplexValue(w).values.length&&(b=y[v]),v++}if(b&&g)for(const w of u)y[w]=getAnimatableNone(g,b)}class DOMKeyframesResolver extends KeyframeResolver{constructor(u,g,v,b,w){super(u,g,v,b,w,!0)}readKeyframes(){const{unresolvedKeyframes:u,element:g,name:v}=this;if(!g||!g.current)return;super.readKeyframes();for(let A=0;A<u.length;A++){let $=u[A];if(typeof $=="string"&&($=$.trim(),isCSSVariableToken($))){const R=getVariableValue($,g.current);R!==void 0&&(u[A]=R),A===u.length-1&&(this.finalKeyframe=$)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(v)||u.length!==2)return;const[b,w]=u,E=findDimensionValueType(b),S=findDimensionValueType(w);if(E!==S)if(isNumOrPxType(E)&&isNumOrPxType(S))for(let A=0;A<u.length;A++){const $=u[A];typeof $=="string"&&(u[A]=parseFloat($))}else positionalValues[v]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:u,name:g}=this,v=[];for(let b=0;b<u.length;b++)(u[b]===null||isNone(u[b]))&&v.push(b);v.length&&makeNoneKeyframesAnimatable(u,v,g)}measureInitialState(){const{element:u,unresolvedKeyframes:g,name:v}=this;if(!u||!u.current)return;v==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[v](u.measureViewportBox(),window.getComputedStyle(u.current)),g[0]=this.measuredOrigin;const b=g[g.length-1];b!==void 0&&u.getValue(v,b).jump(b,!1)}measureEndState(){const{element:u,name:g,unresolvedKeyframes:v}=this;if(!u||!u.current)return;const b=u.getValue(g);b&&b.jump(this.measuredOrigin,!1);const w=v.length-1,E=v[w];v[w]=positionalValues[g](u.measureViewportBox(),window.getComputedStyle(u.current)),E!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=E),this.removedTransforms?.length&&this.removedTransforms.forEach(([S,A])=>{u.getValue(S).set(A)}),this.resolveNoneKeyframes()}}function resolveElements(y,u,g){if(y instanceof EventTarget)return[y];if(typeof y=="string"){let v=document;const b=g?.[y]??v.querySelectorAll(y);return b?Array.from(b):[]}return Array.from(y)}const getValueAsType=(y,u)=>u&&typeof y=="number"?u.transform(y):y;function isHTMLElement(y){return isObject$4(y)&&"offsetHeight"in y}const MAX_VELOCITY_DELTA=30,isFloat=y=>!isNaN(parseFloat(y));class MotionValue{constructor(u,g={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=v=>{const b=time$2.now();if(this.updatedAt!==b&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(v),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const w of this.dependents)w.dirty()},this.hasAnimated=!1,this.setCurrent(u),this.owner=g.owner}setCurrent(u){this.current=u,this.updatedAt=time$2.now(),this.canTrackVelocity===null&&u!==void 0&&(this.canTrackVelocity=isFloat(this.current))}setPrevFrameValue(u=this.current){this.prevFrameValue=u,this.prevUpdatedAt=this.updatedAt}onChange(u){return this.on("change",u)}on(u,g){this.events[u]||(this.events[u]=new SubscriptionManager);const v=this.events[u].add(g);return u==="change"?()=>{v(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:v}clearListeners(){for(const u in this.events)this.events[u].clear()}attach(u,g){this.passiveEffect=u,this.stopPassiveEffect=g}set(u){this.passiveEffect?this.passiveEffect(u,this.updateAndNotify):this.updateAndNotify(u)}setWithVelocity(u,g,v){this.set(g),this.prev=void 0,this.prevFrameValue=u,this.prevUpdatedAt=this.updatedAt-v}jump(u,g=!0){this.updateAndNotify(u),this.prev=u,this.prevUpdatedAt=this.prevFrameValue=void 0,g&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(u){this.dependents||(this.dependents=new Set),this.dependents.add(u)}removeDependent(u){this.dependents&&this.dependents.delete(u)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const u=time$2.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||u-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const g=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),g)}start(u){return this.stop(),new Promise(g=>{this.hasAnimated=!0,this.animation=u(g),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(y,u){return new MotionValue(y,u)}const{schedule:microtask}=createRenderBatcher(queueMicrotask,!1),isDragging={x:!1,y:!1};function isDragActive(){return isDragging.x||isDragging.y}function setDragLock(y){return y==="x"||y==="y"?isDragging[y]?null:(isDragging[y]=!0,()=>{isDragging[y]=!1}):isDragging.x||isDragging.y?null:(isDragging.x=isDragging.y=!0,()=>{isDragging.x=isDragging.y=!1})}function setupGesture(y,u){const g=resolveElements(y),v=new AbortController,b={passive:!0,...u,signal:v.signal};return[g,b,()=>v.abort()]}function isValidHover(y){return!(y.pointerType==="touch"||isDragActive())}function hover(y,u,g={}){const[v,b,w]=setupGesture(y,g),E=S=>{if(!isValidHover(S))return;const{target:A}=S,$=u(A,S);if(typeof $!="function"||!A)return;const R=T=>{isValidHover(T)&&($(T),A.removeEventListener("pointerleave",R))};A.addEventListener("pointerleave",R,b)};return v.forEach(S=>{S.addEventListener("pointerenter",E,b)}),w}const isNodeOrChild=(y,u)=>u?y===u?!0:isNodeOrChild(y,u.parentElement):!1,isPrimaryPointer=y=>y.pointerType==="mouse"?typeof y.button!="number"||y.button<=0:y.isPrimary!==!1,focusableElements=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function isElementKeyboardAccessible(y){return focusableElements.has(y.tagName)||y.tabIndex!==-1}const isPressing=new WeakSet;function filterEvents(y){return u=>{u.key==="Enter"&&y(u)}}function firePointerEvent(y,u){y.dispatchEvent(new PointerEvent("pointer"+u,{isPrimary:!0,bubbles:!0}))}const enableKeyboardPress=(y,u)=>{const g=y.currentTarget;if(!g)return;const v=filterEvents(()=>{if(isPressing.has(g))return;firePointerEvent(g,"down");const b=filterEvents(()=>{firePointerEvent(g,"up")}),w=()=>firePointerEvent(g,"cancel");g.addEventListener("keyup",b,u),g.addEventListener("blur",w,u)});g.addEventListener("keydown",v,u),g.addEventListener("blur",()=>g.removeEventListener("keydown",v),u)};function isValidPressEvent(y){return isPrimaryPointer(y)&&!isDragActive()}function press(y,u,g={}){const[v,b,w]=setupGesture(y,g),E=S=>{const A=S.currentTarget;if(!isValidPressEvent(S))return;isPressing.add(A);const $=u(A,S),R=(B,F)=>{window.removeEventListener("pointerup",T),window.removeEventListener("pointercancel",O),isPressing.has(A)&&isPressing.delete(A),isValidPressEvent(B)&&typeof $=="function"&&$(B,{success:F})},T=B=>{R(B,A===window||A===document||g.useGlobalTarget||isNodeOrChild(A,B.target))},O=B=>{R(B,!1)};window.addEventListener("pointerup",T,b),window.addEventListener("pointercancel",O,b)};return v.forEach(S=>{(g.useGlobalTarget?window:S).addEventListener("pointerdown",E,b),isHTMLElement(S)&&(S.addEventListener("focus",$=>enableKeyboardPress($,b)),!isElementKeyboardAccessible(S)&&!S.hasAttribute("tabindex")&&(S.tabIndex=0))}),w}function isSVGElement$1(y){return isObject$4(y)&&"ownerSVGElement"in y}function isSVGSVGElement(y){return isSVGElement$1(y)&&y.tagName==="svg"}const isMotionValue=y=>!!(y&&y.getVelocity),valueTypes=[...dimensionValueTypes,color,complex],findValueType=y=>valueTypes.find(testValueType(y)),MotionConfigContext=reactExports.createContext({transformPagePoint:y=>y,isStatic:!1,reducedMotion:"never"});function setRef(y,u){if(typeof y=="function")return y(u);y!=null&&(y.current=u)}function composeRefs(...y){return u=>{let g=!1;const v=y.map(b=>{const w=setRef(b,u);return!g&&typeof w=="function"&&(g=!0),w});if(g)return()=>{for(let b=0;b<v.length;b++){const w=v[b];typeof w=="function"?w():setRef(y[b],null)}}}}function useComposedRefs(...y){return reactExports.useCallback(composeRefs(...y),y)}class PopChildMeasure extends reactExports.Component{getSnapshotBeforeUpdate(u){const g=this.props.childRef.current;if(g&&u.isPresent&&!this.props.isPresent){const v=g.offsetParent,b=isHTMLElement(v)&&v.offsetWidth||0,w=this.props.sizeRef.current;w.height=g.offsetHeight||0,w.width=g.offsetWidth||0,w.top=g.offsetTop,w.left=g.offsetLeft,w.right=b-w.width-w.left}return null}componentDidUpdate(){}render(){return this.props.children}}function PopChild({children:y,isPresent:u,anchorX:g,root:v}){const b=reactExports.useId(),w=reactExports.useRef(null),E=reactExports.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:S}=reactExports.useContext(MotionConfigContext),A=useComposedRefs(w,y?.ref);return reactExports.useInsertionEffect(()=>{const{width:$,height:R,top:T,left:O,right:B}=E.current;if(u||!w.current||!$||!R)return;const F=g==="left"?`left: ${O}`:`right: ${B}`;w.current.dataset.motionPopId=b;const U=document.createElement("style");S&&(U.nonce=S);const q=v??document.head;return q.appendChild(U),U.sheet&&U.sheet.insertRule(`
          [data-motion-pop-id="${b}"] {
            position: absolute !important;
            width: ${$}px !important;
            height: ${R}px !important;
            ${F}px !important;
            top: ${T}px !important;
          }
        `),()=>{q.contains(U)&&q.removeChild(U)}},[u]),jsxRuntimeExports.jsx(PopChildMeasure,{isPresent:u,childRef:w,sizeRef:E,children:reactExports.cloneElement(y,{ref:A})})}const PresenceChild=({children:y,initial:u,isPresent:g,onExitComplete:v,custom:b,presenceAffectsLayout:w,mode:E,anchorX:S,root:A})=>{const $=useConstant(newChildrenMap),R=reactExports.useId();let T=!0,O=reactExports.useMemo(()=>(T=!1,{id:R,initial:u,isPresent:g,custom:b,onExitComplete:B=>{$.set(B,!0);for(const F of $.values())if(!F)return;v&&v()},register:B=>($.set(B,!1),()=>$.delete(B))}),[g,$,v]);return w&&T&&(O={...O}),reactExports.useMemo(()=>{$.forEach((B,F)=>$.set(F,!1))},[g]),reactExports.useEffect(()=>{!g&&!$.size&&v&&v()},[g]),E==="popLayout"&&(y=jsxRuntimeExports.jsx(PopChild,{isPresent:g,anchorX:S,root:A,children:y})),jsxRuntimeExports.jsx(PresenceContext.Provider,{value:O,children:y})};function newChildrenMap(){return new Map}function usePresence(y=!0){const u=reactExports.useContext(PresenceContext);if(u===null)return[!0,null];const{isPresent:g,onExitComplete:v,register:b}=u,w=reactExports.useId();reactExports.useEffect(()=>{if(y)return b(w)},[y]);const E=reactExports.useCallback(()=>y&&v&&v(w),[w,v,y]);return!g&&v?[!1,E]:[!0]}const getChildKey=y=>y.key||"";function onlyElements(y){const u=[];return reactExports.Children.forEach(y,g=>{reactExports.isValidElement(g)&&u.push(g)}),u}const AnimatePresence=({children:y,custom:u,initial:g=!0,onExitComplete:v,presenceAffectsLayout:b=!0,mode:w="sync",propagate:E=!1,anchorX:S="left",root:A})=>{const[$,R]=usePresence(E),T=reactExports.useMemo(()=>onlyElements(y),[y]),O=E&&!$?[]:T.map(getChildKey),B=reactExports.useRef(!0),F=reactExports.useRef(T),U=useConstant(()=>new Map),[q,J]=reactExports.useState(T),[ie,oe]=reactExports.useState(T);useIsomorphicLayoutEffect(()=>{B.current=!1,F.current=T;for(let fe=0;fe<ie.length;fe++){const ye=getChildKey(ie[fe]);O.includes(ye)?U.delete(ye):U.get(ye)!==!0&&U.set(ye,!1)}},[ie,O.length,O.join("-")]);const le=[];if(T!==q){let fe=[...T];for(let ye=0;ye<ie.length;ye++){const we=ie[ye],pe=getChildKey(we);O.includes(pe)||(fe.splice(ye,0,we),le.push(we))}return w==="wait"&&le.length&&(fe=le),oe(onlyElements(fe)),J(T),null}const{forceRender:de}=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:ie.map(fe=>{const ye=getChildKey(fe),we=E&&!$?!1:T===ie||O.includes(ye),pe=()=>{if(U.has(ye))U.set(ye,!0);else return;let ve=!0;U.forEach(he=>{he||(ve=!1)}),ve&&(de?.(),oe(F.current),E&&R?.(),v&&v())};return jsxRuntimeExports.jsx(PresenceChild,{isPresent:we,initial:!B.current||g?void 0:!1,custom:u,presenceAffectsLayout:b,mode:w,root:A,onExitComplete:we?void 0:pe,anchorX:S,children:fe},ye)})})},LazyContext=reactExports.createContext({strict:!1}),featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const y in featureProps)featureDefinitions[y]={isEnabled:u=>featureProps[y].some(g=>!!u[g])};function loadFeatures(y){for(const u in y)featureDefinitions[u]={...featureDefinitions[u],...y[u]}}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(y){return y.startsWith("while")||y.startsWith("drag")&&y!=="draggable"||y.startsWith("layout")||y.startsWith("onTap")||y.startsWith("onPan")||y.startsWith("onLayout")||validMotionProps.has(y)}let shouldForward=y=>!isValidMotionProp(y);function loadExternalIsValidProp(y){typeof y=="function"&&(shouldForward=u=>u.startsWith("on")?!isValidMotionProp(u):y(u))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch{}function filterProps(y,u,g){const v={};for(const b in y)b==="values"&&typeof y.values=="object"||(shouldForward(b)||g===!0&&isValidMotionProp(b)||!u&&!isValidMotionProp(b)||y.draggable&&b.startsWith("onDrag"))&&(v[b]=y[b]);return v}const MotionContext=reactExports.createContext({});function isAnimationControls(y){return y!==null&&typeof y=="object"&&typeof y.start=="function"}function isVariantLabel(y){return typeof y=="string"||Array.isArray(y)}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(y){return isAnimationControls(y.animate)||variantProps.some(u=>isVariantLabel(y[u]))}function isVariantNode(y){return!!(isControllingVariants(y)||y.variants)}function getCurrentTreeVariants(y,u){if(isControllingVariants(y)){const{initial:g,animate:v}=y;return{initial:g===!1||isVariantLabel(g)?g:void 0,animate:isVariantLabel(v)?v:void 0}}return y.inherit!==!1?u:{}}function useCreateMotionContext(y){const{initial:u,animate:g}=getCurrentTreeVariants(y,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:u,animate:g}),[variantLabelsAsDependency(u),variantLabelsAsDependency(g)])}function variantLabelsAsDependency(y){return Array.isArray(y)?y.join(" "):y}const scaleCorrectors={};function addScaleCorrector(y){for(const u in y)scaleCorrectors[u]=y[u],isCSSVariableName(u)&&(scaleCorrectors[u].isCSSVariable=!0)}function isForcedMotionValue(y,{layout:u,layoutId:g}){return transformProps.has(y)||y.startsWith("origin")||(u||g!==void 0)&&(!!scaleCorrectors[y]||y==="opacity")}const translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(y,u,g){let v="",b=!0;for(let w=0;w<numTransforms;w++){const E=transformPropOrder[w],S=y[E];if(S===void 0)continue;let A=!0;if(typeof S=="number"?A=S===(E.startsWith("scale")?1:0):A=parseFloat(S)===0,!A||g){const $=getValueAsType(S,numberValueTypes[E]);if(!A){b=!1;const R=translateAlias[E]||E;v+=`${R}(${$}) `}g&&(u[E]=$)}}return v=v.trim(),g?v=g(u,b?"":v):b&&(v="none"),v}function buildHTMLStyles(y,u,g){const{style:v,vars:b,transformOrigin:w}=y;let E=!1,S=!1;for(const A in u){const $=u[A];if(transformProps.has(A)){E=!0;continue}else if(isCSSVariableName(A)){b[A]=$;continue}else{const R=getValueAsType($,numberValueTypes[A]);A.startsWith("origin")?(S=!0,w[A]=R):v[A]=R}}if(u.transform||(E||g?v.transform=buildTransform(u,y.transform,g):v.transform&&(v.transform="none")),S){const{originX:A="50%",originY:$="50%",originZ:R=0}=w;v.transformOrigin=`${A} ${$} ${R}`}}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function copyRawValuesOnly(y,u,g){for(const v in u)!isMotionValue(u[v])&&!isForcedMotionValue(v,g)&&(y[v]=u[v])}function useInitialMotionValues({transformTemplate:y},u){return reactExports.useMemo(()=>{const g=createHtmlRenderState();return buildHTMLStyles(g,u,y),Object.assign({},g.vars,g.style)},[u])}function useStyle(y,u){const g=y.style||{},v={};return copyRawValuesOnly(v,g,y),Object.assign(v,useInitialMotionValues(y,u)),v}function useHTMLProps(y,u){const g={},v=useStyle(y,u);return y.drag&&y.dragListener!==!1&&(g.draggable=!1,v.userSelect=v.WebkitUserSelect=v.WebkitTouchCallout="none",v.touchAction=y.drag===!0?"none":`pan-${y.drag==="x"?"y":"x"}`),y.tabIndex===void 0&&(y.onTap||y.onTapStart||y.whileTap)&&(g.tabIndex=0),g.style=v,g}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(y,u,g=1,v=0,b=!0){y.pathLength=1;const w=b?dashKeys:camelKeys;y[w.offset]=px.transform(-v);const E=px.transform(u),S=px.transform(g);y[w.array]=`${E} ${S}`}function buildSVGAttrs(y,{attrX:u,attrY:g,attrScale:v,pathLength:b,pathSpacing:w=1,pathOffset:E=0,...S},A,$,R){if(buildHTMLStyles(y,S,$),A){y.style.viewBox&&(y.attrs.viewBox=y.style.viewBox);return}y.attrs=y.style,y.style={};const{attrs:T,style:O}=y;T.transform&&(O.transform=T.transform,delete T.transform),(O.transform||T.transformOrigin)&&(O.transformOrigin=T.transformOrigin??"50% 50%",delete T.transformOrigin),O.transform&&(O.transformBox=R?.transformBox??"fill-box",delete T.transformBox),u!==void 0&&(T.x=u),g!==void 0&&(T.y=g),v!==void 0&&(T.scale=v),b!==void 0&&buildSVGPath(T,b,w,E,!1)}const createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),isSVGTag=y=>typeof y=="string"&&y.toLowerCase()==="svg";function useSVGProps(y,u,g,v){const b=reactExports.useMemo(()=>{const w=createSvgRenderState();return buildSVGAttrs(w,u,isSVGTag(v),y.transformTemplate,y.style),{...w.attrs,style:{...w.style}}},[u]);if(y.style){const w={};copyRawValuesOnly(w,y.style,y),b.style={...w,...b.style}}return b}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(y){return typeof y!="string"||y.includes("-")?!1:!!(lowercaseSVGElements.indexOf(y)>-1||/[A-Z]/u.test(y))}function useRender(y,u,g,{latestValues:v},b,w=!1){const S=(isSVGComponent(y)?useSVGProps:useHTMLProps)(u,v,b,y),A=filterProps(u,typeof y=="string",w),$=y!==reactExports.Fragment?{...A,...S,ref:g}:{},{children:R}=u,T=reactExports.useMemo(()=>isMotionValue(R)?R.get():R,[R]);return reactExports.createElement(y,{...$,children:T})}function getValueState(y){const u=[{},{}];return y?.values.forEach((g,v)=>{u[0][v]=g.get(),u[1][v]=g.getVelocity()}),u}function resolveVariantFromProps(y,u,g,v){if(typeof u=="function"){const[b,w]=getValueState(v);u=u(g!==void 0?g:y.custom,b,w)}if(typeof u=="string"&&(u=y.variants&&y.variants[u]),typeof u=="function"){const[b,w]=getValueState(v);u=u(g!==void 0?g:y.custom,b,w)}return u}function resolveMotionValue(y){return isMotionValue(y)?y.get():y}function makeState({scrapeMotionValuesFromProps:y,createRenderState:u},g,v,b){return{latestValues:makeLatestValues(g,v,b,y),renderState:u()}}function makeLatestValues(y,u,g,v){const b={},w=v(y,{});for(const O in w)b[O]=resolveMotionValue(w[O]);let{initial:E,animate:S}=y;const A=isControllingVariants(y),$=isVariantNode(y);u&&$&&!A&&y.inherit!==!1&&(E===void 0&&(E=u.initial),S===void 0&&(S=u.animate));let R=g?g.initial===!1:!1;R=R||E===!1;const T=R?S:E;if(T&&typeof T!="boolean"&&!isAnimationControls(T)){const O=Array.isArray(T)?T:[T];for(let B=0;B<O.length;B++){const F=resolveVariantFromProps(y,O[B]);if(F){const{transitionEnd:U,transition:q,...J}=F;for(const ie in J){let oe=J[ie];if(Array.isArray(oe)){const le=R?oe.length-1:0;oe=oe[le]}oe!==null&&(b[ie]=oe)}for(const ie in U)b[ie]=U[ie]}}}return b}const makeUseVisualState=y=>(u,g)=>{const v=reactExports.useContext(MotionContext),b=reactExports.useContext(PresenceContext),w=()=>makeState(y,u,v,b);return g?w():useConstant(w)};function scrapeMotionValuesFromProps$1(y,u,g){const{style:v}=y,b={};for(const w in v)(isMotionValue(v[w])||u.style&&isMotionValue(u.style[w])||isForcedMotionValue(w,y)||g?.getValue(w)?.liveStyle!==void 0)&&(b[w]=v[w]);return b}const useHTMLVisualState=makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState});function scrapeMotionValuesFromProps(y,u,g){const v=scrapeMotionValuesFromProps$1(y,u,g);for(const b in y)if(isMotionValue(y[b])||isMotionValue(u[b])){const w=transformPropOrder.indexOf(b)!==-1?"attr"+b.charAt(0).toUpperCase()+b.substring(1):b;v[w]=y[b]}return v}const useSVGVisualState=makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState}),motionComponentSymbol=Symbol.for("motionComponentSymbol");function isRefObject(y){return y&&typeof y=="object"&&Object.prototype.hasOwnProperty.call(y,"current")}function useMotionRef(y,u,g){return reactExports.useCallback(v=>{v&&y.onMount&&y.onMount(v),u&&(v?u.mount(v):u.unmount()),g&&(typeof g=="function"?g(v):isRefObject(g)&&(g.current=v))},[u])}const camelToDash=y=>y.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId),SwitchLayoutGroupContext=reactExports.createContext({});function useVisualElement(y,u,g,v,b){const{visualElement:w}=reactExports.useContext(MotionContext),E=reactExports.useContext(LazyContext),S=reactExports.useContext(PresenceContext),A=reactExports.useContext(MotionConfigContext).reducedMotion,$=reactExports.useRef(null);v=v||E.renderer,!$.current&&v&&($.current=v(y,{visualState:u,parent:w,props:g,presenceContext:S,blockInitialAnimation:S?S.initial===!1:!1,reducedMotionConfig:A}));const R=$.current,T=reactExports.useContext(SwitchLayoutGroupContext);R&&!R.projection&&b&&(R.type==="html"||R.type==="svg")&&createProjectionNode$1($.current,g,b,T);const O=reactExports.useRef(!1);reactExports.useInsertionEffect(()=>{R&&O.current&&R.update(g,S)});const B=g[optimizedAppearDataAttribute],F=reactExports.useRef(!!B&&!window.MotionHandoffIsComplete?.(B)&&window.MotionHasOptimisedAnimation?.(B));return useIsomorphicLayoutEffect(()=>{R&&(O.current=!0,window.MotionIsMounted=!0,R.updateFeatures(),R.scheduleRenderMicrotask(),F.current&&R.animationState&&R.animationState.animateChanges())}),reactExports.useEffect(()=>{R&&(!F.current&&R.animationState&&R.animationState.animateChanges(),F.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(B)}),F.current=!1),R.enteringChildren=void 0)}),R}function createProjectionNode$1(y,u,g,v){const{layoutId:b,layout:w,drag:E,dragConstraints:S,layoutScroll:A,layoutRoot:$,layoutCrossfade:R}=u;y.projection=new g(y.latestValues,u["data-framer-portal-id"]?void 0:getClosestProjectingNode(y.parent)),y.projection.setOptions({layoutId:b,layout:w,alwaysMeasureLayout:!!E||S&&isRefObject(S),visualElement:y,animationType:typeof w=="string"?w:"both",initialPromotionConfig:v,crossfade:R,layoutScroll:A,layoutRoot:$})}function getClosestProjectingNode(y){if(y)return y.options.allowProjection!==!1?y.projection:getClosestProjectingNode(y.parent)}function createMotionComponent(y,{forwardMotionProps:u=!1}={},g,v){g&&loadFeatures(g);const b=isSVGComponent(y)?useSVGVisualState:useHTMLVisualState;function w(S,A){let $;const R={...reactExports.useContext(MotionConfigContext),...S,layoutId:useLayoutId(S)},{isStatic:T}=R,O=useCreateMotionContext(S),B=b(S,T);if(!T&&isBrowser){useStrictMode();const F=getProjectionFunctionality(R);$=F.MeasureLayout,O.visualElement=useVisualElement(y,B,R,v,F.ProjectionNode)}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:O,children:[$&&O.visualElement?jsxRuntimeExports.jsx($,{visualElement:O.visualElement,...R}):null,useRender(y,S,useMotionRef(B,O.visualElement,A),B,T,u)]})}w.displayName=`motion.${typeof y=="string"?y:`create(${y.displayName??y.name??""})`}`;const E=reactExports.forwardRef(w);return E[motionComponentSymbol]=y,E}function useLayoutId({layoutId:y}){const u=reactExports.useContext(LayoutGroupContext).id;return u&&y!==void 0?u+"-"+y:y}function useStrictMode(y,u){reactExports.useContext(LazyContext).strict}function getProjectionFunctionality(y){const{drag:u,layout:g}=featureDefinitions;if(!u&&!g)return{};const v={...u,...g};return{MeasureLayout:u?.isEnabled(y)||g?.isEnabled(y)?v.MeasureLayout:void 0,ProjectionNode:v.ProjectionNode}}function createMotionProxy(y,u){if(typeof Proxy>"u")return createMotionComponent;const g=new Map,v=(w,E)=>createMotionComponent(w,E,y,u),b=(w,E)=>v(w,E);return new Proxy(b,{get:(w,E)=>E==="create"?v:(g.has(E)||g.set(E,createMotionComponent(E,void 0,y,u)),g.get(E))})}function convertBoundingBoxToBox({top:y,left:u,right:g,bottom:v}){return{x:{min:u,max:g},y:{min:y,max:v}}}function convertBoxToBoundingBox({x:y,y:u}){return{top:u.min,right:y.max,bottom:u.max,left:y.min}}function transformBoxPoints(y,u){if(!u)return y;const g=u({x:y.left,y:y.top}),v=u({x:y.right,y:y.bottom});return{top:g.y,left:g.x,bottom:v.y,right:v.x}}function isIdentityScale(y){return y===void 0||y===1}function hasScale({scale:y,scaleX:u,scaleY:g}){return!isIdentityScale(y)||!isIdentityScale(u)||!isIdentityScale(g)}function hasTransform(y){return hasScale(y)||has2DTranslate(y)||y.z||y.rotate||y.rotateX||y.rotateY||y.skewX||y.skewY}function has2DTranslate(y){return is2DTranslate(y.x)||is2DTranslate(y.y)}function is2DTranslate(y){return y&&y!=="0%"}function scalePoint(y,u,g){const v=y-g,b=u*v;return g+b}function applyPointDelta(y,u,g,v,b){return b!==void 0&&(y=scalePoint(y,b,v)),scalePoint(y,g,v)+u}function applyAxisDelta(y,u=0,g=1,v,b){y.min=applyPointDelta(y.min,u,g,v,b),y.max=applyPointDelta(y.max,u,g,v,b)}function applyBoxDelta(y,{x:u,y:g}){applyAxisDelta(y.x,u.translate,u.scale,u.originPoint),applyAxisDelta(y.y,g.translate,g.scale,g.originPoint)}const TREE_SCALE_SNAP_MIN=.999999999999,TREE_SCALE_SNAP_MAX=1.0000000000001;function applyTreeDeltas(y,u,g,v=!1){const b=g.length;if(!b)return;u.x=u.y=1;let w,E;for(let S=0;S<b;S++){w=g[S],E=w.projectionDelta;const{visualElement:A}=w.options;A&&A.props.style&&A.props.style.display==="contents"||(v&&w.options.layoutScroll&&w.scroll&&w!==w.root&&transformBox(y,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),E&&(u.x*=E.x.scale,u.y*=E.y.scale,applyBoxDelta(y,E)),v&&hasTransform(w.latestValues)&&transformBox(y,w.latestValues))}u.x<TREE_SCALE_SNAP_MAX&&u.x>TREE_SCALE_SNAP_MIN&&(u.x=1),u.y<TREE_SCALE_SNAP_MAX&&u.y>TREE_SCALE_SNAP_MIN&&(u.y=1)}function translateAxis(y,u){y.min=y.min+u,y.max=y.max+u}function transformAxis(y,u,g,v,b=.5){const w=mixNumber$1(y.min,y.max,b);applyAxisDelta(y,u,g,w,v)}function transformBox(y,u){transformAxis(y.x,u.x,u.scaleX,u.scale,u.originX),transformAxis(y.y,u.y,u.scaleY,u.scale,u.originY)}function measureViewportBox(y,u){return convertBoundingBoxToBox(transformBoxPoints(y.getBoundingClientRect(),u))}function measurePageBox(y,u,g){const v=measureViewportBox(y,g),{scroll:b}=u;return b&&(translateAxis(v.x,b.offset.x),translateAxis(v.y,b.offset.y)),v}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()}),prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const y=window.matchMedia("(prefers-reduced-motion)"),u=()=>prefersReducedMotion.current=y.matches;y.addEventListener("change",u),u()}else prefersReducedMotion.current=!1}const visualElementStore=new WeakMap;function updateMotionValuesFromProps(y,u,g){for(const v in u){const b=u[v],w=g[v];if(isMotionValue(b))y.addValue(v,b);else if(isMotionValue(w))y.addValue(v,motionValue(b,{owner:y}));else if(w!==b)if(y.hasValue(v)){const E=y.getValue(v);E.liveStyle===!0?E.jump(b):E.hasAnimated||E.set(b)}else{const E=y.getStaticValue(v);y.addValue(v,motionValue(E!==void 0?E:b,{owner:y}))}}for(const v in g)u[v]===void 0&&y.removeValue(v);return u}const propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class VisualElement{scrapeMotionValuesFromProps(u,g,v){return{}}constructor({parent:u,props:g,presenceContext:v,reducedMotionConfig:b,blockInitialAnimation:w,visualState:E},S={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const O=time$2.now();this.renderScheduledAt<O&&(this.renderScheduledAt=O,frame.render(this.render,!1,!0))};const{latestValues:A,renderState:$}=E;this.latestValues=A,this.baseTarget={...A},this.initialValues=g.initial?{...A}:{},this.renderState=$,this.parent=u,this.props=g,this.presenceContext=v,this.depth=u?u.depth+1:0,this.reducedMotionConfig=b,this.options=S,this.blockInitialAnimation=!!w,this.isControllingVariants=isControllingVariants(g),this.isVariantNode=isVariantNode(g),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(u&&u.current);const{willChange:R,...T}=this.scrapeMotionValuesFromProps(g,{},this);for(const O in T){const B=T[O];A[O]!==void 0&&isMotionValue(B)&&B.set(A[O])}}mount(u){this.current=u,visualElementStore.set(u,this),this.projection&&!this.projection.instance&&this.projection.mount(u),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((g,v)=>this.bindToMotionValue(v,g)),hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:prefersReducedMotion.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(u=>u()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const u in this.events)this.events[u].clear();for(const u in this.features){const g=this.features[u];g&&(g.unmount(),g.isMounted=!1)}this.current=null}addChild(u){this.children.add(u),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(u)}removeChild(u){this.children.delete(u),this.enteringChildren&&this.enteringChildren.delete(u)}bindToMotionValue(u,g){this.valueSubscriptions.has(u)&&this.valueSubscriptions.get(u)();const v=transformProps.has(u);v&&this.onBindTransform&&this.onBindTransform();const b=g.on("change",E=>{this.latestValues[u]=E,this.props.onUpdate&&frame.preRender(this.notifyUpdate),v&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let w;window.MotionCheckAppearSync&&(w=window.MotionCheckAppearSync(this,u,g)),this.valueSubscriptions.set(u,()=>{b(),w&&w(),g.owner&&g.stop()})}sortNodePosition(u){return!this.current||!this.sortInstanceNodePosition||this.type!==u.type?0:this.sortInstanceNodePosition(this.current,u.current)}updateFeatures(){let u="animation";for(u in featureDefinitions){const g=featureDefinitions[u];if(!g)continue;const{isEnabled:v,Feature:b}=g;if(!this.features[u]&&b&&v(this.props)&&(this.features[u]=new b(this)),this.features[u]){const w=this.features[u];w.isMounted?w.update():(w.mount(),w.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(u){return this.latestValues[u]}setStaticValue(u,g){this.latestValues[u]=g}update(u,g){(u.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=u,this.prevPresenceContext=this.presenceContext,this.presenceContext=g;for(let v=0;v<propEventHandlers.length;v++){const b=propEventHandlers[v];this.propEventSubscriptions[b]&&(this.propEventSubscriptions[b](),delete this.propEventSubscriptions[b]);const w="on"+b,E=u[w];E&&(this.propEventSubscriptions[b]=this.on(b,E))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(u,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(u){return this.props.variants?this.props.variants[u]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(u){const g=this.getClosestVariantNode();if(g)return g.variantChildren&&g.variantChildren.add(u),()=>g.variantChildren.delete(u)}addValue(u,g){const v=this.values.get(u);g!==v&&(v&&this.removeValue(u),this.bindToMotionValue(u,g),this.values.set(u,g),this.latestValues[u]=g.get())}removeValue(u){this.values.delete(u);const g=this.valueSubscriptions.get(u);g&&(g(),this.valueSubscriptions.delete(u)),delete this.latestValues[u],this.removeValueFromRenderState(u,this.renderState)}hasValue(u){return this.values.has(u)}getValue(u,g){if(this.props.values&&this.props.values[u])return this.props.values[u];let v=this.values.get(u);return v===void 0&&g!==void 0&&(v=motionValue(g===null?void 0:g,{owner:this}),this.addValue(u,v)),v}readValue(u,g){let v=this.latestValues[u]!==void 0||!this.current?this.latestValues[u]:this.getBaseTargetFromProps(this.props,u)??this.readValueFromInstance(this.current,u,this.options);return v!=null&&(typeof v=="string"&&(isNumericalString(v)||isZeroValueString(v))?v=parseFloat(v):!findValueType(v)&&complex.test(g)&&(v=getAnimatableNone(u,g)),this.setBaseTarget(u,isMotionValue(v)?v.get():v)),isMotionValue(v)?v.get():v}setBaseTarget(u,g){this.baseTarget[u]=g}getBaseTarget(u){const{initial:g}=this.props;let v;if(typeof g=="string"||typeof g=="object"){const w=resolveVariantFromProps(this.props,g,this.presenceContext?.custom);w&&(v=w[u])}if(g&&v!==void 0)return v;const b=this.getBaseTargetFromProps(this.props,u);return b!==void 0&&!isMotionValue(b)?b:this.initialValues[u]!==void 0&&v===void 0?void 0:this.baseTarget[u]}on(u,g){return this.events[u]||(this.events[u]=new SubscriptionManager),this.events[u].add(g)}notify(u,...g){this.events[u]&&this.events[u].notify(...g)}scheduleRenderMicrotask(){microtask.render(this.render)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(u,g){return u.compareDocumentPosition(g)&2?1:-1}getBaseTargetFromProps(u,g){return u.style?u.style[g]:void 0}removeValueFromRenderState(u,{vars:g,style:v}){delete g[u],delete v[u]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:u}=this.props;isMotionValue(u)&&(this.childSubscription=u.on("change",g=>{this.current&&(this.current.textContent=`${g}`)}))}}function renderHTML(y,{style:u,vars:g},v,b){const w=y.style;let E;for(E in u)w[E]=u[E];b?.applyProjectionStyles(w,v);for(E in g)w.setProperty(E,g[E])}function getComputedStyle$1(y){return window.getComputedStyle(y)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html",this.renderInstance=renderHTML}readValueFromInstance(u,g){if(transformProps.has(g))return this.projection?.isProjecting?defaultTransformValue(g):readTransformValue(u,g);{const v=getComputedStyle$1(u),b=(isCSSVariableName(g)?v.getPropertyValue(g):v[g])||0;return typeof b=="string"?b.trim():b}}measureInstanceViewportBox(u,{transformPagePoint:g}){return measureViewportBox(u,g)}build(u,g,v){buildHTMLStyles(u,g,v.transformTemplate)}scrapeMotionValuesFromProps(u,g,v){return scrapeMotionValuesFromProps$1(u,g,v)}}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(y,u,g,v){renderHTML(y,u,void 0,v);for(const b in u.attrs)y.setAttribute(camelCaseAttributes.has(b)?b:camelToDash(b),u.attrs[b])}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=createBox}getBaseTargetFromProps(u,g){return u[g]}readValueFromInstance(u,g){if(transformProps.has(g)){const v=getDefaultValueType(g);return v&&v.default||0}return g=camelCaseAttributes.has(g)?g:camelToDash(g),u.getAttribute(g)}scrapeMotionValuesFromProps(u,g,v){return scrapeMotionValuesFromProps(u,g,v)}build(u,g,v){buildSVGAttrs(u,g,this.isSVGTag,v.transformTemplate,v.style)}renderInstance(u,g,v,b){renderSVG(u,g,v,b)}mount(u){this.isSVGTag=isSVGTag(u.tagName),super.mount(u)}}const createDomVisualElement=(y,u)=>isSVGComponent(y)?new SVGVisualElement(u):new HTMLVisualElement(u,{allowProjection:y!==reactExports.Fragment});function resolveVariant(y,u,g){const v=y.getProps();return resolveVariantFromProps(v,u,g!==void 0?g:v.custom,y)}const isKeyframesTarget=y=>Array.isArray(y);function setMotionValue(y,u,g){y.hasValue(u)?y.getValue(u).set(g):y.addValue(u,motionValue(g))}function resolveFinalValueInKeyframes(y){return isKeyframesTarget(y)?y[y.length-1]||0:y}function setTarget(y,u){const g=resolveVariant(y,u);let{transitionEnd:v={},transition:b={},...w}=g||{};w={...w,...v};for(const E in w){const S=resolveFinalValueInKeyframes(w[E]);setMotionValue(y,E,S)}}function isWillChangeMotionValue(y){return!!(isMotionValue(y)&&y.add)}function addValueToWillChange(y,u){const g=y.getValue("willChange");if(isWillChangeMotionValue(g))return g.add(u);if(!g&&MotionGlobalConfig.WillChange){const v=new MotionGlobalConfig.WillChange("auto");y.addValue("willChange",v),v.add(u)}}function getOptimisedAppearId(y){return y.props[optimizedAppearDataAttribute]}const isNotNull=y=>y!==null;function getFinalKeyframe(y,{repeat:u,repeatType:g="loop"},v){const b=y.filter(isNotNull),w=u&&g!=="loop"&&u%2===1?0:b.length-1;return b[w]}const underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=y=>({type:"spring",stiffness:550,damping:y===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(y,{keyframes:u})=>u.length>2?keyframesTransition:transformProps.has(y)?y.startsWith("scale")?criticallyDampedSpring(u[1]):underDampedSpring:ease;function isTransitionDefined({when:y,delay:u,delayChildren:g,staggerChildren:v,staggerDirection:b,repeat:w,repeatType:E,repeatDelay:S,from:A,elapsed:$,...R}){return!!Object.keys(R).length}const animateMotionValue=(y,u,g,v={},b,w)=>E=>{const S=getValueTransition(v,y)||{},A=S.delay||v.delay||0;let{elapsed:$=0}=v;$=$-secondsToMilliseconds(A);const R={keyframes:Array.isArray(g)?g:[null,g],ease:"easeOut",velocity:u.getVelocity(),...S,delay:-$,onUpdate:O=>{u.set(O),S.onUpdate&&S.onUpdate(O)},onComplete:()=>{E(),S.onComplete&&S.onComplete()},name:y,motionValue:u,element:w?void 0:b};isTransitionDefined(S)||Object.assign(R,getDefaultTransition(y,R)),R.duration&&(R.duration=secondsToMilliseconds(R.duration)),R.repeatDelay&&(R.repeatDelay=secondsToMilliseconds(R.repeatDelay)),R.from!==void 0&&(R.keyframes[0]=R.from);let T=!1;if((R.type===!1||R.duration===0&&!R.repeatDelay)&&(makeAnimationInstant(R),R.delay===0&&(T=!0)),(MotionGlobalConfig.instantAnimations||MotionGlobalConfig.skipAnimations)&&(T=!0,makeAnimationInstant(R),R.delay=0),R.allowFlatten=!S.type&&!S.ease,T&&!w&&u.get()!==void 0){const O=getFinalKeyframe(R.keyframes,S);if(O!==void 0){frame.update(()=>{R.onUpdate(O),R.onComplete()});return}}return S.isSync?new JSAnimation(R):new AsyncMotionValueAnimation(R)};function shouldBlockAnimation({protectedKeys:y,needsAnimating:u},g){const v=y.hasOwnProperty(g)&&u[g]!==!0;return u[g]=!1,v}function animateTarget(y,u,{delay:g=0,transitionOverride:v,type:b}={}){let{transition:w=y.getDefaultTransition(),transitionEnd:E,...S}=u;v&&(w=v);const A=[],$=b&&y.animationState&&y.animationState.getState()[b];for(const R in S){const T=y.getValue(R,y.latestValues[R]??null),O=S[R];if(O===void 0||$&&shouldBlockAnimation($,R))continue;const B={delay:g,...getValueTransition(w||{},R)},F=T.get();if(F!==void 0&&!T.isAnimating&&!Array.isArray(O)&&O===F&&!B.velocity)continue;let U=!1;if(window.MotionHandoffAnimation){const J=getOptimisedAppearId(y);if(J){const ie=window.MotionHandoffAnimation(J,R,frame);ie!==null&&(B.startTime=ie,U=!0)}}addValueToWillChange(y,R),T.start(animateMotionValue(R,T,O,y.shouldReduceMotion&&positionalKeys.has(R)?{type:!1}:B,y,U));const q=T.animation;q&&A.push(q)}return E&&Promise.all(A).then(()=>{frame.update(()=>{E&&setTarget(y,E)})}),A}function calcChildStagger(y,u,g,v=0,b=1){const w=Array.from(y).sort(($,R)=>$.sortNodePosition(R)).indexOf(u),E=y.size,S=(E-1)*v;return typeof g=="function"?g(w,E):b===1?w*v:S-w*v}function animateVariant(y,u,g={}){const v=resolveVariant(y,u,g.type==="exit"?y.presenceContext?.custom:void 0);let{transition:b=y.getDefaultTransition()||{}}=v||{};g.transitionOverride&&(b=g.transitionOverride);const w=v?()=>Promise.all(animateTarget(y,v,g)):()=>Promise.resolve(),E=y.variantChildren&&y.variantChildren.size?(A=0)=>{const{delayChildren:$=0,staggerChildren:R,staggerDirection:T}=b;return animateChildren(y,u,A,$,R,T,g)}:()=>Promise.resolve(),{when:S}=b;if(S){const[A,$]=S==="beforeChildren"?[w,E]:[E,w];return A().then(()=>$())}else return Promise.all([w(),E(g.delay)])}function animateChildren(y,u,g=0,v=0,b=0,w=1,E){const S=[];for(const A of y.variantChildren)A.notify("AnimationStart",u),S.push(animateVariant(A,u,{...E,delay:g+(typeof v=="function"?0:v)+calcChildStagger(y.variantChildren,A,v,b,w)}).then(()=>A.notify("AnimationComplete",u)));return Promise.all(S)}function animateVisualElement(y,u,g={}){y.notify("AnimationStart",u);let v;if(Array.isArray(u)){const b=u.map(w=>animateVariant(y,w,g));v=Promise.all(b)}else if(typeof u=="string")v=animateVariant(y,u,g);else{const b=typeof u=="function"?resolveVariant(y,u,g.custom):u;v=Promise.all(animateTarget(y,b,g))}return v.then(()=>{y.notify("AnimationComplete",u)})}function shallowCompare(y,u){if(!Array.isArray(u))return!1;const g=u.length;if(g!==y.length)return!1;for(let v=0;v<g;v++)if(u[v]!==y[v])return!1;return!0}const numVariantProps=variantProps.length;function getVariantContext(y){if(!y)return;if(!y.isControllingVariants){const g=y.parent?getVariantContext(y.parent)||{}:{};return y.props.initial!==void 0&&(g.initial=y.props.initial),g}const u={};for(let g=0;g<numVariantProps;g++){const v=variantProps[g],b=y.props[v];(isVariantLabel(b)||b===!1)&&(u[v]=b)}return u}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(y){return u=>Promise.all(u.map(({animation:g,options:v})=>animateVisualElement(y,g,v)))}function createAnimationState(y){let u=animateList(y),g=createState(),v=!0;const b=A=>($,R)=>{const T=resolveVariant(y,R,A==="exit"?y.presenceContext?.custom:void 0);if(T){const{transition:O,transitionEnd:B,...F}=T;$={...$,...F,...B}}return $};function w(A){u=A(y)}function E(A){const{props:$}=y,R=getVariantContext(y.parent)||{},T=[],O=new Set;let B={},F=1/0;for(let q=0;q<numAnimationTypes;q++){const J=reversePriorityOrder[q],ie=g[J],oe=$[J]!==void 0?$[J]:R[J],le=isVariantLabel(oe),de=J===A?ie.isActive:null;de===!1&&(F=q);let fe=oe===R[J]&&oe!==$[J]&&le;if(fe&&v&&y.manuallyAnimateOnMount&&(fe=!1),ie.protectedKeys={...B},!ie.isActive&&de===null||!oe&&!ie.prevProp||isAnimationControls(oe)||typeof oe=="boolean")continue;const ye=checkVariantsDidChange(ie.prevProp,oe);let we=ye||J===A&&ie.isActive&&!fe&&le||q>F&&le,pe=!1;const ve=Array.isArray(oe)?oe:[oe];let he=ve.reduce(b(J),{});de===!1&&(he={});const{prevResolvedValues:ae={}}=ie,Q={...ae,...he},j=Y=>{we=!0,O.has(Y)&&(pe=!0,O.delete(Y)),ie.needsAnimating[Y]=!0;const te=y.getValue(Y);te&&(te.liveStyle=!1)};for(const Y in Q){const te=he[Y],ne=ae[Y];if(B.hasOwnProperty(Y))continue;let se=!1;isKeyframesTarget(te)&&isKeyframesTarget(ne)?se=!shallowCompare(te,ne):se=te!==ne,se?te!=null?j(Y):O.add(Y):te!==void 0&&O.has(Y)?j(Y):ie.protectedKeys[Y]=!0}ie.prevProp=oe,ie.prevResolvedValues=he,ie.isActive&&(B={...B,...he}),v&&y.blockInitialAnimation&&(we=!1);const z=fe&&ye;we&&(!z||pe)&&T.push(...ve.map(Y=>{const te={type:J};if(typeof Y=="string"&&v&&!z&&y.manuallyAnimateOnMount&&y.parent){const{parent:ne}=y,se=resolveVariant(ne,Y);if(ne.enteringChildren&&se){const{delayChildren:ee}=se.transition||{};te.delay=calcChildStagger(ne.enteringChildren,y,ee)}}return{animation:Y,options:te}}))}if(O.size){const q={};if(typeof $.initial!="boolean"){const J=resolveVariant(y,Array.isArray($.initial)?$.initial[0]:$.initial);J&&J.transition&&(q.transition=J.transition)}O.forEach(J=>{const ie=y.getBaseTarget(J),oe=y.getValue(J);oe&&(oe.liveStyle=!0),q[J]=ie??null}),T.push({animation:q})}let U=!!T.length;return v&&($.initial===!1||$.initial===$.animate)&&!y.manuallyAnimateOnMount&&(U=!1),v=!1,U?u(T):Promise.resolve()}function S(A,$){if(g[A].isActive===$)return Promise.resolve();y.variantChildren?.forEach(T=>T.animationState?.setActive(A,$)),g[A].isActive=$;const R=E(A);for(const T in g)g[T].protectedKeys={};return R}return{animateChanges:E,setActive:S,setAnimateFunction:w,getState:()=>g,reset:()=>{g=createState()}}}function checkVariantsDidChange(y,u){return typeof u=="string"?u!==y:Array.isArray(u)?!shallowCompare(u,y):!1}function createTypeState(y=!1){return{isActive:y,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}class Feature{constructor(u){this.isMounted=!1,this.node=u}update(){}}class AnimationFeature extends Feature{constructor(u){super(u),u.animationState||(u.animationState=createAnimationState(u))}updateAnimationControlsSubscription(){const{animate:u}=this.node.getProps();isAnimationControls(u)&&(this.unmountControls=u.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:u}=this.node.getProps(),{animate:g}=this.node.prevProps||{};u!==g&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let id$1=0;class ExitAnimationFeature extends Feature{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:u,onExitComplete:g}=this.node.presenceContext,{isPresent:v}=this.node.prevPresenceContext||{};if(!this.node.animationState||u===v)return;const b=this.node.animationState.setActive("exit",!u);g&&!u&&b.then(()=>{g(this.id)})}mount(){const{register:u,onExitComplete:g}=this.node.presenceContext||{};g&&g(this.id),u&&(this.unmount=u(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}};function addDomEvent(y,u,g,v={passive:!0}){return y.addEventListener(u,g,v),()=>y.removeEventListener(u,g)}function extractEventInfo(y){return{point:{x:y.pageX,y:y.pageY}}}const addPointerInfo=y=>u=>isPrimaryPointer(u)&&y(u,extractEventInfo(u));function addPointerEvent(y,u,g,v){return addDomEvent(y,u,addPointerInfo(g),v)}const SCALE_PRECISION=1e-4,SCALE_MIN=1-SCALE_PRECISION,SCALE_MAX=1+SCALE_PRECISION,TRANSLATE_PRECISION=.01,TRANSLATE_MIN=0-TRANSLATE_PRECISION,TRANSLATE_MAX=0+TRANSLATE_PRECISION;function calcLength(y){return y.max-y.min}function isNear(y,u,g){return Math.abs(y-u)<=g}function calcAxisDelta(y,u,g,v=.5){y.origin=v,y.originPoint=mixNumber$1(u.min,u.max,y.origin),y.scale=calcLength(g)/calcLength(u),y.translate=mixNumber$1(g.min,g.max,y.origin)-y.originPoint,(y.scale>=SCALE_MIN&&y.scale<=SCALE_MAX||isNaN(y.scale))&&(y.scale=1),(y.translate>=TRANSLATE_MIN&&y.translate<=TRANSLATE_MAX||isNaN(y.translate))&&(y.translate=0)}function calcBoxDelta(y,u,g,v){calcAxisDelta(y.x,u.x,g.x,v?v.originX:void 0),calcAxisDelta(y.y,u.y,g.y,v?v.originY:void 0)}function calcRelativeAxis(y,u,g){y.min=g.min+u.min,y.max=y.min+calcLength(u)}function calcRelativeBox(y,u,g){calcRelativeAxis(y.x,u.x,g.x),calcRelativeAxis(y.y,u.y,g.y)}function calcRelativeAxisPosition(y,u,g){y.min=u.min-g.min,y.max=y.min+calcLength(u)}function calcRelativePosition(y,u,g){calcRelativeAxisPosition(y.x,u.x,g.x),calcRelativeAxisPosition(y.y,u.y,g.y)}function eachAxis(y){return[y("x"),y("y")]}const getContextWindow=({current:y})=>y?y.ownerDocument.defaultView:null,distance=(y,u)=>Math.abs(y-u);function distance2D(y,u){const g=distance(y.x,u.x),v=distance(y.y,u.y);return Math.sqrt(g**2+v**2)}class PanSession{constructor(u,g,{transformPagePoint:v,contextWindow:b=window,dragSnapToOrigin:w=!1,distanceThreshold:E=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const O=getPanInfo(this.lastMoveEventInfo,this.history),B=this.startEvent!==null,F=distance2D(O.offset,{x:0,y:0})>=this.distanceThreshold;if(!B&&!F)return;const{point:U}=O,{timestamp:q}=frameData;this.history.push({...U,timestamp:q});const{onStart:J,onMove:ie}=this.handlers;B||(J&&J(this.lastMoveEvent,O),this.startEvent=this.lastMoveEvent),ie&&ie(this.lastMoveEvent,O)},this.handlePointerMove=(O,B)=>{this.lastMoveEvent=O,this.lastMoveEventInfo=transformPoint(B,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(O,B)=>{this.end();const{onEnd:F,onSessionEnd:U,resumeAnimation:q}=this.handlers;if(this.dragSnapToOrigin&&q&&q(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const J=getPanInfo(O.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(B,this.transformPagePoint),this.history);this.startEvent&&F&&F(O,J),U&&U(O,J)},!isPrimaryPointer(u))return;this.dragSnapToOrigin=w,this.handlers=g,this.transformPagePoint=v,this.distanceThreshold=E,this.contextWindow=b||window;const S=extractEventInfo(u),A=transformPoint(S,this.transformPagePoint),{point:$}=A,{timestamp:R}=frameData;this.history=[{...$,timestamp:R}];const{onSessionStart:T}=g;T&&T(u,getPanInfo(A,this.history)),this.removeListeners=pipe$2(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(u){this.handlers=u}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(y,u){return u?{point:u(y.point)}:y}function subtractPoint(y,u){return{x:y.x-u.x,y:y.y-u.y}}function getPanInfo({point:y},u){return{point:y,delta:subtractPoint(y,lastDevicePoint(u)),offset:subtractPoint(y,startDevicePoint(u)),velocity:getVelocity(u,.1)}}function startDevicePoint(y){return y[0]}function lastDevicePoint(y){return y[y.length-1]}function getVelocity(y,u){if(y.length<2)return{x:0,y:0};let g=y.length-1,v=null;const b=lastDevicePoint(y);for(;g>=0&&(v=y[g],!(b.timestamp-v.timestamp>secondsToMilliseconds(u)));)g--;if(!v)return{x:0,y:0};const w=millisecondsToSeconds(b.timestamp-v.timestamp);if(w===0)return{x:0,y:0};const E={x:(b.x-v.x)/w,y:(b.y-v.y)/w};return E.x===1/0&&(E.x=0),E.y===1/0&&(E.y=0),E}function applyConstraints(y,{min:u,max:g},v){return u!==void 0&&y<u?y=v?mixNumber$1(u,y,v.min):Math.max(y,u):g!==void 0&&y>g&&(y=v?mixNumber$1(g,y,v.max):Math.min(y,g)),y}function calcRelativeAxisConstraints(y,u,g){return{min:u!==void 0?y.min+u:void 0,max:g!==void 0?y.max+g-(y.max-y.min):void 0}}function calcRelativeConstraints(y,{top:u,left:g,bottom:v,right:b}){return{x:calcRelativeAxisConstraints(y.x,g,b),y:calcRelativeAxisConstraints(y.y,u,v)}}function calcViewportAxisConstraints(y,u){let g=u.min-y.min,v=u.max-y.max;return u.max-u.min<y.max-y.min&&([g,v]=[v,g]),{min:g,max:v}}function calcViewportConstraints(y,u){return{x:calcViewportAxisConstraints(y.x,u.x),y:calcViewportAxisConstraints(y.y,u.y)}}function calcOrigin(y,u){let g=.5;const v=calcLength(y),b=calcLength(u);return b>v?g=progress(u.min,u.max-v,y.min):v>b&&(g=progress(y.min,y.max-b,u.min)),clamp(0,1,g)}function rebaseAxisConstraints(y,u){const g={};return u.min!==void 0&&(g.min=u.min-y.min),u.max!==void 0&&(g.max=u.max-y.min),g}const defaultElastic=.35;function resolveDragElastic(y=defaultElastic){return y===!1?y=0:y===!0&&(y=defaultElastic),{x:resolveAxisElastic(y,"left","right"),y:resolveAxisElastic(y,"top","bottom")}}function resolveAxisElastic(y,u,g){return{min:resolvePointElastic(y,u),max:resolvePointElastic(y,g)}}function resolvePointElastic(y,u){return typeof y=="number"?y:y[u]||0}const elementDragControls=new WeakMap;class VisualElementDragControls{constructor(u){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=u}start(u,{snapToCursor:g=!1,distanceThreshold:v}={}){const{presenceContext:b}=this.visualElement;if(b&&b.isPresent===!1)return;const w=T=>{const{dragSnapToOrigin:O}=this.getProps();O?this.pauseAnimation():this.stopAnimation(),g&&this.snapToCursor(extractEventInfo(T).point)},E=(T,O)=>{const{drag:B,dragPropagation:F,onDragStart:U}=this.getProps();if(B&&!F&&(this.openDragLock&&this.openDragLock(),this.openDragLock=setDragLock(B),!this.openDragLock))return;this.latestPointerEvent=T,this.latestPanInfo=O,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(J=>{let ie=this.getAxisMotionValue(J).get()||0;if(percent.test(ie)){const{projection:oe}=this.visualElement;if(oe&&oe.layout){const le=oe.layout.layoutBox[J];le&&(ie=calcLength(le)*(parseFloat(ie)/100))}}this.originPoint[J]=ie}),U&&frame.postRender(()=>U(T,O)),addValueToWillChange(this.visualElement,"transform");const{animationState:q}=this.visualElement;q&&q.setActive("whileDrag",!0)},S=(T,O)=>{this.latestPointerEvent=T,this.latestPanInfo=O;const{dragPropagation:B,dragDirectionLock:F,onDirectionLock:U,onDrag:q}=this.getProps();if(!B&&!this.openDragLock)return;const{offset:J}=O;if(F&&this.currentDirection===null){this.currentDirection=getCurrentDirection(J),this.currentDirection!==null&&U&&U(this.currentDirection);return}this.updateAxis("x",O.point,J),this.updateAxis("y",O.point,J),this.visualElement.render(),q&&q(T,O)},A=(T,O)=>{this.latestPointerEvent=T,this.latestPanInfo=O,this.stop(T,O),this.latestPointerEvent=null,this.latestPanInfo=null},$=()=>eachAxis(T=>this.getAnimationState(T)==="paused"&&this.getAxisMotionValue(T).animation?.play()),{dragSnapToOrigin:R}=this.getProps();this.panSession=new PanSession(u,{onSessionStart:w,onStart:E,onMove:S,onSessionEnd:A,resumeAnimation:$},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:R,distanceThreshold:v,contextWindow:getContextWindow(this.visualElement)})}stop(u,g){const v=u||this.latestPointerEvent,b=g||this.latestPanInfo,w=this.isDragging;if(this.cancel(),!w||!b||!v)return;const{velocity:E}=b;this.startAnimation(E);const{onDragEnd:S}=this.getProps();S&&frame.postRender(()=>S(v,b))}cancel(){this.isDragging=!1;const{projection:u,animationState:g}=this.visualElement;u&&(u.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:v}=this.getProps();!v&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),g&&g.setActive("whileDrag",!1)}updateAxis(u,g,v){const{drag:b}=this.getProps();if(!v||!shouldDrag(u,b,this.currentDirection))return;const w=this.getAxisMotionValue(u);let E=this.originPoint[u]+v[u];this.constraints&&this.constraints[u]&&(E=applyConstraints(E,this.constraints[u],this.elastic[u])),w.set(E)}resolveConstraints(){const{dragConstraints:u,dragElastic:g}=this.getProps(),v=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,b=this.constraints;u&&isRefObject(u)?this.constraints||(this.constraints=this.resolveRefConstraints()):u&&v?this.constraints=calcRelativeConstraints(v.layoutBox,u):this.constraints=!1,this.elastic=resolveDragElastic(g),b!==this.constraints&&v&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(w=>{this.constraints!==!1&&this.getAxisMotionValue(w)&&(this.constraints[w]=rebaseAxisConstraints(v.layoutBox[w],this.constraints[w]))})}resolveRefConstraints(){const{dragConstraints:u,onMeasureDragConstraints:g}=this.getProps();if(!u||!isRefObject(u))return!1;const v=u.current,{projection:b}=this.visualElement;if(!b||!b.layout)return!1;const w=measurePageBox(v,b.root,this.visualElement.getTransformPagePoint());let E=calcViewportConstraints(b.layout.layoutBox,w);if(g){const S=g(convertBoxToBoundingBox(E));this.hasMutatedConstraints=!!S,S&&(E=convertBoundingBoxToBox(S))}return E}startAnimation(u){const{drag:g,dragMomentum:v,dragElastic:b,dragTransition:w,dragSnapToOrigin:E,onDragTransitionEnd:S}=this.getProps(),A=this.constraints||{},$=eachAxis(R=>{if(!shouldDrag(R,g,this.currentDirection))return;let T=A&&A[R]||{};E&&(T={min:0,max:0});const O=b?200:1e6,B=b?40:1e7,F={type:"inertia",velocity:v?u[R]:0,bounceStiffness:O,bounceDamping:B,timeConstant:750,restDelta:1,restSpeed:10,...w,...T};return this.startAxisValueAnimation(R,F)});return Promise.all($).then(S)}startAxisValueAnimation(u,g){const v=this.getAxisMotionValue(u);return addValueToWillChange(this.visualElement,u),v.start(animateMotionValue(u,v,0,g,this.visualElement,!1))}stopAnimation(){eachAxis(u=>this.getAxisMotionValue(u).stop())}pauseAnimation(){eachAxis(u=>this.getAxisMotionValue(u).animation?.pause())}getAnimationState(u){return this.getAxisMotionValue(u).animation?.state}getAxisMotionValue(u){const g=`_drag${u.toUpperCase()}`,v=this.visualElement.getProps(),b=v[g];return b||this.visualElement.getValue(u,(v.initial?v.initial[u]:void 0)||0)}snapToCursor(u){eachAxis(g=>{const{drag:v}=this.getProps();if(!shouldDrag(g,v,this.currentDirection))return;const{projection:b}=this.visualElement,w=this.getAxisMotionValue(g);if(b&&b.layout){const{min:E,max:S}=b.layout.layoutBox[g];w.set(u[g]-mixNumber$1(E,S,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:u,dragConstraints:g}=this.getProps(),{projection:v}=this.visualElement;if(!isRefObject(g)||!v||!this.constraints)return;this.stopAnimation();const b={x:0,y:0};eachAxis(E=>{const S=this.getAxisMotionValue(E);if(S&&this.constraints!==!1){const A=S.get();b[E]=calcOrigin({min:A,max:A},this.constraints[E])}});const{transformTemplate:w}=this.visualElement.getProps();this.visualElement.current.style.transform=w?w({},""):"none",v.root&&v.root.updateScroll(),v.updateLayout(),this.resolveConstraints(),eachAxis(E=>{if(!shouldDrag(E,u,null))return;const S=this.getAxisMotionValue(E),{min:A,max:$}=this.constraints[E];S.set(mixNumber$1(A,$,b[E]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const u=this.visualElement.current,g=addPointerEvent(u,"pointerdown",A=>{const{drag:$,dragListener:R=!0}=this.getProps();$&&R&&this.start(A)}),v=()=>{const{dragConstraints:A}=this.getProps();isRefObject(A)&&A.current&&(this.constraints=this.resolveRefConstraints())},{projection:b}=this.visualElement,w=b.addEventListener("measure",v);b&&!b.layout&&(b.root&&b.root.updateScroll(),b.updateLayout()),frame.read(v);const E=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),S=b.addEventListener("didUpdate",(({delta:A,hasLayoutChanged:$})=>{this.isDragging&&$&&(eachAxis(R=>{const T=this.getAxisMotionValue(R);T&&(this.originPoint[R]+=A[R].translate,T.set(T.get()+A[R].translate))}),this.visualElement.render())}));return()=>{E(),g(),w(),S&&S()}}getProps(){const u=this.visualElement.getProps(),{drag:g=!1,dragDirectionLock:v=!1,dragPropagation:b=!1,dragConstraints:w=!1,dragElastic:E=defaultElastic,dragMomentum:S=!0}=u;return{...u,drag:g,dragDirectionLock:v,dragPropagation:b,dragConstraints:w,dragElastic:E,dragMomentum:S}}}function shouldDrag(y,u,g){return(u===!0||u===y)&&(g===null||g===y)}function getCurrentDirection(y,u=10){let g=null;return Math.abs(y.y)>u?g="y":Math.abs(y.x)>u&&(g="x"),g}class DragGesture extends Feature{constructor(u){super(u),this.removeGroupControls=noop$3,this.removeListeners=noop$3,this.controls=new VisualElementDragControls(u)}mount(){const{dragControls:u}=this.node.getProps();u&&(this.removeGroupControls=u.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop$3}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=y=>(u,g)=>{y&&frame.postRender(()=>y(u,g))};class PanGesture extends Feature{constructor(){super(...arguments),this.removePointerDownListener=noop$3}onPointerDown(u){this.session=new PanSession(u,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:u,onPanStart:g,onPan:v,onPanEnd:b}=this.node.getProps();return{onSessionStart:asyncHandler(u),onStart:asyncHandler(g),onMove:v,onEnd:(w,E)=>{delete this.session,b&&frame.postRender(()=>b(w,E))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",u=>this.onPointerDown(u))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pixelsToPercent(y,u){return u.max===u.min?0:y/(u.max-u.min)*100}const correctBorderRadius={correct:(y,u)=>{if(!u.target)return y;if(typeof y=="string")if(px.test(y))y=parseFloat(y);else return y;const g=pixelsToPercent(y,u.target.x),v=pixelsToPercent(y,u.target.y);return`${g}% ${v}%`}},correctBoxShadow={correct:(y,{treeScale:u,projectionDelta:g})=>{const v=y,b=complex.parse(y);if(b.length>5)return v;const w=complex.createTransformer(y),E=typeof b[0]!="number"?1:0,S=g.x.scale*u.x,A=g.y.scale*u.y;b[0+E]/=S,b[1+E]/=A;const $=mixNumber$1(S,A,.5);return typeof b[2+E]=="number"&&(b[2+E]/=$),typeof b[3+E]=="number"&&(b[3+E]/=$),w(b)}};let hasTakenAnySnapshot=!1;class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:u,layoutGroup:g,switchLayoutGroup:v,layoutId:b}=this.props,{projection:w}=u;addScaleCorrector(defaultScaleCorrectors),w&&(g.group&&g.group.add(w),v&&v.register&&b&&v.register(w),hasTakenAnySnapshot&&w.root.didUpdate(),w.addEventListener("animationComplete",()=>{this.safeToRemove()}),w.setOptions({...w.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(u){const{layoutDependency:g,visualElement:v,drag:b,isPresent:w}=this.props,{projection:E}=v;return E&&(E.isPresent=w,hasTakenAnySnapshot=!0,b||u.layoutDependency!==g||g===void 0||u.isPresent!==w?E.willUpdate():this.safeToRemove(),u.isPresent!==w&&(w?E.promote():E.relegate()||frame.postRender(()=>{const S=E.getStack();(!S||!S.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:u}=this.props.visualElement;u&&(u.root.didUpdate(),microtask.postRender(()=>{!u.currentAnimation&&u.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:u,layoutGroup:g,switchLayoutGroup:v}=this.props,{projection:b}=u;hasTakenAnySnapshot=!0,b&&(b.scheduleCheckAfterUnmount(),g&&g.group&&g.group.remove(b),v&&v.deregister&&v.deregister(b))}safeToRemove(){const{safeToRemove:u}=this.props;u&&u()}render(){return null}}function MeasureLayout(y){const[u,g]=usePresence(),v=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...y,layoutGroup:v,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:u,safeToRemove:g})}const defaultScaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow};function animateSingleValue(y,u,g){const v=isMotionValue(y)?y:motionValue(y);return v.start(animateMotionValue("",v,u,g)),v.animation}const compareByDepth=(y,u)=>y.depth-u.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(u){addUniqueItem(this.children,u),this.isDirty=!0}remove(u){removeItem(this.children,u),this.isDirty=!0}forEach(u){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(u)}}function delay$1(y,u){const g=time$2.now(),v=({timestamp:b})=>{const w=b-g;w>=u&&(cancelFrame(v),y(w-u))};return frame.setup(v,!0),()=>cancelFrame(v)}const borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=y=>typeof y=="string"?parseFloat(y):y,isPx=y=>typeof y=="number"||px.test(y);function mixValues(y,u,g,v,b,w){b?(y.opacity=mixNumber$1(0,g.opacity??1,easeCrossfadeIn(v)),y.opacityExit=mixNumber$1(u.opacity??1,0,easeCrossfadeOut(v))):w&&(y.opacity=mixNumber$1(u.opacity??1,g.opacity??1,v));for(let E=0;E<numBorders;E++){const S=`border${borders[E]}Radius`;let A=getRadius(u,S),$=getRadius(g,S);if(A===void 0&&$===void 0)continue;A||(A=0),$||($=0),A===0||$===0||isPx(A)===isPx($)?(y[S]=Math.max(mixNumber$1(asNumber(A),asNumber($),v),0),(percent.test($)||percent.test(A))&&(y[S]+="%")):y[S]=$}(u.rotate||g.rotate)&&(y.rotate=mixNumber$1(u.rotate||0,g.rotate||0,v))}function getRadius(y,u){return y[u]!==void 0?y[u]:y.borderRadius}const easeCrossfadeIn=compress$1(0,.5,circOut),easeCrossfadeOut=compress$1(.5,.95,noop$3);function compress$1(y,u,g){return v=>v<y?0:v>u?1:g(progress(y,u,v))}function copyAxisInto(y,u){y.min=u.min,y.max=u.max}function copyBoxInto(y,u){copyAxisInto(y.x,u.x),copyAxisInto(y.y,u.y)}function copyAxisDeltaInto(y,u){y.translate=u.translate,y.scale=u.scale,y.originPoint=u.originPoint,y.origin=u.origin}function removePointDelta(y,u,g,v,b){return y-=u,y=scalePoint(y,1/g,v),b!==void 0&&(y=scalePoint(y,1/b,v)),y}function removeAxisDelta(y,u=0,g=1,v=.5,b,w=y,E=y){if(percent.test(u)&&(u=parseFloat(u),u=mixNumber$1(E.min,E.max,u/100)-E.min),typeof u!="number")return;let S=mixNumber$1(w.min,w.max,v);y===w&&(S-=u),y.min=removePointDelta(y.min,u,g,S,b),y.max=removePointDelta(y.max,u,g,S,b)}function removeAxisTransforms(y,u,[g,v,b],w,E){removeAxisDelta(y,u[g],u[v],u[b],u.scale,w,E)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(y,u,g,v){removeAxisTransforms(y.x,u,xKeys,g?g.x:void 0,v?v.x:void 0),removeAxisTransforms(y.y,u,yKeys,g?g.y:void 0,v?v.y:void 0)}function isAxisDeltaZero(y){return y.translate===0&&y.scale===1}function isDeltaZero(y){return isAxisDeltaZero(y.x)&&isAxisDeltaZero(y.y)}function axisEquals(y,u){return y.min===u.min&&y.max===u.max}function boxEquals(y,u){return axisEquals(y.x,u.x)&&axisEquals(y.y,u.y)}function axisEqualsRounded(y,u){return Math.round(y.min)===Math.round(u.min)&&Math.round(y.max)===Math.round(u.max)}function boxEqualsRounded(y,u){return axisEqualsRounded(y.x,u.x)&&axisEqualsRounded(y.y,u.y)}function aspectRatio(y){return calcLength(y.x)/calcLength(y.y)}function axisDeltaEquals(y,u){return y.translate===u.translate&&y.scale===u.scale&&y.originPoint===u.originPoint}class NodeStack{constructor(){this.members=[]}add(u){addUniqueItem(this.members,u),u.scheduleRender()}remove(u){if(removeItem(this.members,u),u===this.prevLead&&(this.prevLead=void 0),u===this.lead){const g=this.members[this.members.length-1];g&&this.promote(g)}}relegate(u){const g=this.members.findIndex(b=>u===b);if(g===0)return!1;let v;for(let b=g;b>=0;b--){const w=this.members[b];if(w.isPresent!==!1){v=w;break}}return v?(this.promote(v),!0):!1}promote(u,g){const v=this.lead;if(u!==v&&(this.prevLead=v,this.lead=u,u.show(),v)){v.instance&&v.scheduleRender(),u.scheduleRender(),u.resumeFrom=v,g&&(u.resumeFrom.preserveOpacity=!0),v.snapshot&&(u.snapshot=v.snapshot,u.snapshot.latestValues=v.animationValues||v.latestValues),u.root&&u.root.isUpdating&&(u.isLayoutDirty=!0);const{crossfade:b}=u.options;b===!1&&v.hide()}}exitAnimationComplete(){this.members.forEach(u=>{const{options:g,resumingFrom:v}=u;g.onExitComplete&&g.onExitComplete(),v&&v.options.onExitComplete&&v.options.onExitComplete()})}scheduleRender(){this.members.forEach(u=>{u.instance&&u.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(y,u,g){let v="";const b=y.x.translate/u.x,w=y.y.translate/u.y,E=g?.z||0;if((b||w||E)&&(v=`translate3d(${b}px, ${w}px, ${E}px) `),(u.x!==1||u.y!==1)&&(v+=`scale(${1/u.x}, ${1/u.y}) `),g){const{transformPerspective:$,rotate:R,rotateX:T,rotateY:O,skewX:B,skewY:F}=g;$&&(v=`perspective(${$}px) ${v}`),R&&(v+=`rotate(${R}deg) `),T&&(v+=`rotateX(${T}deg) `),O&&(v+=`rotateY(${O}deg) `),B&&(v+=`skewX(${B}deg) `),F&&(v+=`skewY(${F}deg) `)}const S=y.x.scale*u.x,A=y.y.scale*u.y;return(S!==1||A!==1)&&(v+=`scale(${S}, ${A})`),v||"none"}const transformAxes=["","X","Y","Z"],animationTarget=1e3;let id=0;function resetDistortingTransform(y,u,g,v){const{latestValues:b}=u;b[y]&&(g[y]=b[y],u.setStaticValue(y,0),v&&(v[y]=0))}function cancelTreeOptimisedTransformAnimations(y){if(y.hasCheckedOptimisedAppear=!0,y.root===y)return;const{visualElement:u}=y.options;if(!u)return;const g=getOptimisedAppearId(u);if(window.MotionHasOptimisedAnimation(g,"transform")){const{layout:b,layoutId:w}=y.options;window.MotionCancelOptimisedAnimation(g,"transform",frame,!(b||w))}const{parent:v}=y;v&&!v.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(v)}function createProjectionNode({attachResizeListener:y,defaultParent:u,measureScroll:g,checkIsScrollRoot:v,resetTransform:b}){return class{constructor(E={},S=u?.()){this.id=id++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=E,this.root=S?S.root||S:this,this.path=S?[...S.path,S]:[],this.parent=S,this.depth=S?S.depth+1:0;for(let A=0;A<this.path.length;A++)this.path[A].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(E,S){return this.eventHandlers.has(E)||this.eventHandlers.set(E,new SubscriptionManager),this.eventHandlers.get(E).add(S)}notifyListeners(E,...S){const A=this.eventHandlers.get(E);A&&A.notify(...S)}hasListeners(E){return this.eventHandlers.has(E)}mount(E){if(this.instance)return;this.isSVG=isSVGElement$1(E)&&!isSVGSVGElement(E),this.instance=E;const{layoutId:S,layout:A,visualElement:$}=this.options;if($&&!$.current&&$.mount(E),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(A||S)&&(this.isLayoutDirty=!0),y){let R,T=0;const O=()=>this.root.updateBlockedByResize=!1;frame.read(()=>{T=window.innerWidth}),y(E,()=>{const B=window.innerWidth;B!==T&&(T=B,this.root.updateBlockedByResize=!0,R&&R(),R=delay$1(O,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation)))})}S&&this.root.registerSharedNode(S,this),this.options.animate!==!1&&$&&(S||A)&&this.addEventListener("didUpdate",({delta:R,hasLayoutChanged:T,hasRelativeLayoutChanged:O,layout:B})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const F=this.options.transition||$.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:U,onLayoutAnimationComplete:q}=$.getProps(),J=!this.targetLayout||!boxEqualsRounded(this.targetLayout,B),ie=!T&&O;if(this.options.layoutRoot||this.resumeFrom||ie||T&&(J||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const oe={...getValueTransition(F,"layout"),onPlay:U,onComplete:q};($.shouldReduceMotion||this.options.layoutRoot)&&(oe.delay=0,oe.type=!1),this.startAnimation(oe),this.setAnimationOrigin(R,ie)}else T||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=B})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const E=this.getStack();E&&E.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:E}=this.options;return E&&E.getProps().transformTemplate}willUpdate(E=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let R=0;R<this.path.length;R++){const T=this.path[R];T.shouldResetTransform=!0,T.updateScroll("snapshot"),T.options.layoutRoot&&T.willUpdate(!1)}const{layoutId:S,layout:A}=this.options;if(S===void 0&&!A)return;const $=this.getTransformTemplate();this.prevTransformTemplateValue=$?$(this.latestValues,""):void 0,this.updateSnapshot(),E&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(clearIsLayoutDirty);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate)):this.nodes.forEach(clearIsLayoutDirty),this.clearAllSnapshots();const S=time$2.now();frameData.delta=clamp(0,1e3/60,S-frameData.timestamp),frameData.timestamp=S,frameData.isProcessing=!0,frameSteps.update.process(frameData),frameSteps.preRender.process(frameData),frameSteps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!calcLength(this.snapshot.measuredBox.x)&&!calcLength(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let A=0;A<this.path.length;A++)this.path[A].updateScroll();const E=this.layout;this.layout=this.measure(!1),this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:S}=this.options;S&&S.notify("LayoutMeasure",this.layout.layoutBox,E?E.layoutBox:void 0)}updateScroll(E="measure"){let S=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===E&&(S=!1),S&&this.instance){const A=v(this.instance);this.scroll={animationId:this.root.animationId,phase:E,isRoot:A,offset:g(this.instance),wasRoot:this.scroll?this.scroll.isRoot:A}}}resetTransform(){if(!b)return;const E=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,S=this.projectionDelta&&!isDeltaZero(this.projectionDelta),A=this.getTransformTemplate(),$=A?A(this.latestValues,""):void 0,R=$!==this.prevTransformTemplateValue;E&&this.instance&&(S||hasTransform(this.latestValues)||R)&&(b(this.instance,$),this.shouldResetTransform=!1,this.scheduleRender())}measure(E=!0){const S=this.measurePageBox();let A=this.removeElementScroll(S);return E&&(A=this.removeTransform(A)),roundBox(A),{animationId:this.root.animationId,measuredBox:S,layoutBox:A,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:E}=this.options;if(!E)return createBox();const S=E.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(checkNodeWasScrollRoot))){const{scroll:$}=this.root;$&&(translateAxis(S.x,$.offset.x),translateAxis(S.y,$.offset.y))}return S}removeElementScroll(E){const S=createBox();if(copyBoxInto(S,E),this.scroll?.wasRoot)return S;for(let A=0;A<this.path.length;A++){const $=this.path[A],{scroll:R,options:T}=$;$!==this.root&&R&&T.layoutScroll&&(R.wasRoot&&copyBoxInto(S,E),translateAxis(S.x,R.offset.x),translateAxis(S.y,R.offset.y))}return S}applyTransform(E,S=!1){const A=createBox();copyBoxInto(A,E);for(let $=0;$<this.path.length;$++){const R=this.path[$];!S&&R.options.layoutScroll&&R.scroll&&R!==R.root&&transformBox(A,{x:-R.scroll.offset.x,y:-R.scroll.offset.y}),hasTransform(R.latestValues)&&transformBox(A,R.latestValues)}return hasTransform(this.latestValues)&&transformBox(A,this.latestValues),A}removeTransform(E){const S=createBox();copyBoxInto(S,E);for(let A=0;A<this.path.length;A++){const $=this.path[A];if(!$.instance||!hasTransform($.latestValues))continue;hasScale($.latestValues)&&$.updateSnapshot();const R=createBox(),T=$.measurePageBox();copyBoxInto(R,T),removeBoxTransforms(S,$.latestValues,$.snapshot?$.snapshot.layoutBox:void 0,R)}return hasTransform(this.latestValues)&&removeBoxTransforms(S,this.latestValues),S}setTargetDelta(E){this.targetDelta=E,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(E){this.options={...this.options,...E,crossfade:E.crossfade!==void 0?E.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(E=!1){const S=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=S.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=S.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=S.isSharedProjectionDirty);const A=!!this.resumingFrom||this!==S;if(!(E||A&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:R,layoutId:T}=this.options;if(!(!this.layout||!(R||T))){if(this.resolvedRelativeTargetAt=frameData.timestamp,!this.targetDelta&&!this.relativeTarget){const O=this.getClosestProjectingParent();O&&O.layout&&this.animationProgress!==1?(this.relativeParent=O,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.layout.layoutBox,O.layout.layoutBox),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const O=this.getClosestProjectingParent();O&&!!O.resumingFrom==!!this.resumingFrom&&!O.options.layoutScroll&&O.target&&this.animationProgress!==1?(this.relativeParent=O,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.target,O.target),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const E=this.getLead(),S=!!this.resumingFrom||this!==E;let A=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(A=!1),S&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(A=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(A=!1),A)return;const{layout:$,layoutId:R}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!($||R))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const T=this.treeScale.x,O=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,S),E.layout&&!E.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(E.target=E.layout.layoutBox,E.targetWithTransforms=createBox());const{target:B}=E;if(!B){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(copyAxisDeltaInto(this.prevProjectionDelta.x,this.projectionDelta.x),copyAxisDeltaInto(this.prevProjectionDelta.y,this.projectionDelta.y)),calcBoxDelta(this.projectionDelta,this.layoutCorrected,B,this.latestValues),(this.treeScale.x!==T||this.treeScale.y!==O||!axisDeltaEquals(this.projectionDelta.x,this.prevProjectionDelta.x)||!axisDeltaEquals(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",B))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(E=!0){if(this.options.visualElement?.scheduleRender(),E){const S=this.getStack();S&&S.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=createDelta(),this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta()}setAnimationOrigin(E,S=!1){const A=this.snapshot,$=A?A.latestValues:{},R={...this.latestValues},T=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!S;const O=createBox(),B=A?A.source:void 0,F=this.layout?this.layout.source:void 0,U=B!==F,q=this.getStack(),J=!q||q.members.length<=1,ie=!!(U&&!J&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let oe;this.mixTargetDelta=le=>{const de=le/1e3;mixAxisDelta(T.x,E.x,de),mixAxisDelta(T.y,E.y,de),this.setTargetDelta(T),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(O,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,O,de),oe&&boxEquals(this.relativeTarget,oe)&&(this.isProjectionDirty=!1),oe||(oe=createBox()),copyBoxInto(oe,this.relativeTarget)),U&&(this.animationValues=R,mixValues(R,$,this.latestValues,de,ie,J)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=de},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(E){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=motionValue(0)),this.currentAnimation=animateSingleValue(this.motionValue,[0,1e3],{...E,velocity:0,isSync:!0,onUpdate:S=>{this.mixTargetDelta(S),E.onUpdate&&E.onUpdate(S)},onStop:()=>{},onComplete:()=>{E.onComplete&&E.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const E=this.getStack();E&&E.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const E=this.getLead();let{targetWithTransforms:S,target:A,layout:$,latestValues:R}=E;if(!(!S||!A||!$)){if(this!==E&&this.layout&&$&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,$.layoutBox)){A=this.target||createBox();const T=calcLength(this.layout.layoutBox.x);A.x.min=E.target.x.min,A.x.max=A.x.min+T;const O=calcLength(this.layout.layoutBox.y);A.y.min=E.target.y.min,A.y.max=A.y.min+O}copyBoxInto(S,A),transformBox(S,R),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,S,R)}}registerSharedNode(E,S){this.sharedNodes.has(E)||this.sharedNodes.set(E,new NodeStack),this.sharedNodes.get(E).add(S);const $=S.options.initialPromotionConfig;S.promote({transition:$?$.transition:void 0,preserveFollowOpacity:$&&$.shouldPreserveFollowOpacity?$.shouldPreserveFollowOpacity(S):void 0})}isLead(){const E=this.getStack();return E?E.lead===this:!0}getLead(){const{layoutId:E}=this.options;return E?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:E}=this.options;return E?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:E}=this.options;if(E)return this.root.sharedNodes.get(E)}promote({needsReset:E,transition:S,preserveFollowOpacity:A}={}){const $=this.getStack();$&&$.promote(this,A),E&&(this.projectionDelta=void 0,this.needsReset=!0),S&&this.setOptions({transition:S})}relegate(){const E=this.getStack();return E?E.relegate(this):!1}resetSkewAndRotation(){const{visualElement:E}=this.options;if(!E)return;let S=!1;const{latestValues:A}=E;if((A.z||A.rotate||A.rotateX||A.rotateY||A.rotateZ||A.skewX||A.skewY)&&(S=!0),!S)return;const $={};A.z&&resetDistortingTransform("z",E,$,this.animationValues);for(let R=0;R<transformAxes.length;R++)resetDistortingTransform(`rotate${transformAxes[R]}`,E,$,this.animationValues),resetDistortingTransform(`skew${transformAxes[R]}`,E,$,this.animationValues);E.render();for(const R in $)E.setStaticValue(R,$[R]),this.animationValues&&(this.animationValues[R]=$[R]);E.scheduleRender()}applyProjectionStyles(E,S){if(!this.instance||this.isSVG)return;if(!this.isVisible){E.visibility="hidden";return}const A=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,E.visibility="",E.opacity="",E.pointerEvents=resolveMotionValue(S?.pointerEvents)||"",E.transform=A?A(this.latestValues,""):"none";return}const $=this.getLead();if(!this.projectionDelta||!this.layout||!$.target){this.options.layoutId&&(E.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,E.pointerEvents=resolveMotionValue(S?.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(E.transform=A?A({},""):"none",this.hasProjected=!1);return}E.visibility="";const R=$.animationValues||$.latestValues;this.applyTransformsToTarget();let T=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,R);A&&(T=A(R,T)),E.transform=T;const{x:O,y:B}=this.projectionDelta;E.transformOrigin=`${O.origin*100}% ${B.origin*100}% 0`,$.animationValues?E.opacity=$===this?R.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:R.opacityExit:E.opacity=$===this?R.opacity!==void 0?R.opacity:"":R.opacityExit!==void 0?R.opacityExit:0;for(const F in scaleCorrectors){if(R[F]===void 0)continue;const{correct:U,applyTo:q,isCSSVariable:J}=scaleCorrectors[F],ie=T==="none"?R[F]:U(R[F],$);if(q){const oe=q.length;for(let le=0;le<oe;le++)E[q[le]]=ie}else J?this.options.visualElement.renderState.vars[F]=ie:E[F]=ie}this.options.layoutId&&(E.pointerEvents=$===this?resolveMotionValue(S?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(E=>E.currentAnimation?.stop()),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(y){y.updateLayout()}function notifyLayoutUpdate(y){const u=y.resumeFrom?.snapshot||y.snapshot;if(y.isLead()&&y.layout&&u&&y.hasListeners("didUpdate")){const{layoutBox:g,measuredBox:v}=y.layout,{animationType:b}=y.options,w=u.source!==y.layout.source;b==="size"?eachAxis(R=>{const T=w?u.measuredBox[R]:u.layoutBox[R],O=calcLength(T);T.min=g[R].min,T.max=T.min+O}):shouldAnimatePositionOnly(b,u.layoutBox,g)&&eachAxis(R=>{const T=w?u.measuredBox[R]:u.layoutBox[R],O=calcLength(g[R]);T.max=T.min+O,y.relativeTarget&&!y.currentAnimation&&(y.isProjectionDirty=!0,y.relativeTarget[R].max=y.relativeTarget[R].min+O)});const E=createDelta();calcBoxDelta(E,g,u.layoutBox);const S=createDelta();w?calcBoxDelta(S,y.applyTransform(v,!0),u.measuredBox):calcBoxDelta(S,g,u.layoutBox);const A=!isDeltaZero(E);let $=!1;if(!y.resumeFrom){const R=y.getClosestProjectingParent();if(R&&!R.resumeFrom){const{snapshot:T,layout:O}=R;if(T&&O){const B=createBox();calcRelativePosition(B,u.layoutBox,T.layoutBox);const F=createBox();calcRelativePosition(F,g,O.layoutBox),boxEqualsRounded(B,F)||($=!0),R.options.layoutRoot&&(y.relativeTarget=F,y.relativeTargetOrigin=B,y.relativeParent=R)}}}y.notifyListeners("didUpdate",{layout:g,snapshot:u,delta:S,layoutDelta:E,hasLayoutChanged:A,hasRelativeLayoutChanged:$})}else if(y.isLead()){const{onExitComplete:g}=y.options;g&&g()}y.options.transition=void 0}function propagateDirtyNodes(y){y.parent&&(y.isProjecting()||(y.isProjectionDirty=y.parent.isProjectionDirty),y.isSharedProjectionDirty||(y.isSharedProjectionDirty=!!(y.isProjectionDirty||y.parent.isProjectionDirty||y.parent.isSharedProjectionDirty)),y.isTransformDirty||(y.isTransformDirty=y.parent.isTransformDirty))}function cleanDirtyNodes(y){y.isProjectionDirty=y.isSharedProjectionDirty=y.isTransformDirty=!1}function clearSnapshot(y){y.clearSnapshot()}function clearMeasurements(y){y.clearMeasurements()}function clearIsLayoutDirty(y){y.isLayoutDirty=!1}function resetTransformStyle(y){const{visualElement:u}=y.options;u&&u.getProps().onBeforeLayoutMeasure&&u.notify("BeforeLayoutMeasure"),y.resetTransform()}function finishAnimation(y){y.finishAnimation(),y.targetDelta=y.relativeTarget=y.target=void 0,y.isProjectionDirty=!0}function resolveTargetDelta(y){y.resolveTargetDelta()}function calcProjection(y){y.calcProjection()}function resetSkewAndRotation(y){y.resetSkewAndRotation()}function removeLeadSnapshots(y){y.removeLeadSnapshot()}function mixAxisDelta(y,u,g){y.translate=mixNumber$1(u.translate,0,g),y.scale=mixNumber$1(u.scale,1,g),y.origin=u.origin,y.originPoint=u.originPoint}function mixAxis(y,u,g,v){y.min=mixNumber$1(u.min,g.min,v),y.max=mixNumber$1(u.max,g.max,v)}function mixBox(y,u,g,v){mixAxis(y.x,u.x,g.x,v),mixAxis(y.y,u.y,g.y,v)}function hasOpacityCrossfade(y){return y.animationValues&&y.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=y=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(y),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop$3;function roundAxis(y){y.min=roundPoint(y.min),y.max=roundPoint(y.max)}function roundBox(y){roundAxis(y.x),roundAxis(y.y)}function shouldAnimatePositionOnly(y,u,g){return y==="position"||y==="preserve-aspect"&&!isNear(aspectRatio(u),aspectRatio(g),.2)}function checkNodeWasScrollRoot(y){return y!==y.root&&y.scroll?.wasRoot}const DocumentProjectionNode=createProjectionNode({attachResizeListener:(y,u)=>addDomEvent(y,"resize",u),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode({measureScroll:y=>({x:y.scrollLeft,y:y.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const y=new DocumentProjectionNode({});y.mount(window),y.setOptions({layoutScroll:!0}),rootProjectionNode.current=y}return rootProjectionNode.current},resetTransform:(y,u)=>{y.style.transform=u!==void 0?u:"none"},checkIsScrollRoot:y=>window.getComputedStyle(y).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}};function handleHoverEvent(y,u,g){const{props:v}=y;y.animationState&&v.whileHover&&y.animationState.setActive("whileHover",g==="Start");const b="onHover"+g,w=v[b];w&&frame.postRender(()=>w(u,extractEventInfo(u)))}class HoverGesture extends Feature{mount(){const{current:u}=this.node;u&&(this.unmount=hover(u,(g,v)=>(handleHoverEvent(this.node,v,"Start"),b=>handleHoverEvent(this.node,b,"End"))))}unmount(){}}class FocusGesture extends Feature{constructor(){super(...arguments),this.isActive=!1}onFocus(){let u=!1;try{u=this.node.current.matches(":focus-visible")}catch{u=!0}!u||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe$2(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function handlePressEvent(y,u,g){const{props:v}=y;if(y.current instanceof HTMLButtonElement&&y.current.disabled)return;y.animationState&&v.whileTap&&y.animationState.setActive("whileTap",g==="Start");const b="onTap"+(g==="End"?"":g),w=v[b];w&&frame.postRender(()=>w(u,extractEventInfo(u)))}class PressGesture extends Feature{mount(){const{current:u}=this.node;u&&(this.unmount=press(u,(g,v)=>(handlePressEvent(this.node,v,"Start"),(b,{success:w})=>handlePressEvent(this.node,b,w?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=y=>{const u=observerCallbacks.get(y.target);u&&u(y)},fireAllObserverCallbacks=y=>{y.forEach(fireObserverCallback)};function initIntersectionObserver({root:y,...u}){const g=y||document;observers.has(g)||observers.set(g,{});const v=observers.get(g),b=JSON.stringify(u);return v[b]||(v[b]=new IntersectionObserver(fireAllObserverCallbacks,{root:y,...u})),v[b]}function observeIntersection(y,u,g){const v=initIntersectionObserver(u);return observerCallbacks.set(y,g),v.observe(y),()=>{observerCallbacks.delete(y),v.unobserve(y)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:u={}}=this.node.getProps(),{root:g,margin:v,amount:b="some",once:w}=u,E={root:g?g.current:void 0,rootMargin:v,threshold:typeof b=="number"?b:thresholdNames[b]},S=A=>{const{isIntersecting:$}=A;if(this.isInView===$||(this.isInView=$,w&&!$&&this.hasEnteredView))return;$&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",$);const{onViewportEnter:R,onViewportLeave:T}=this.node.getProps(),O=$?R:T;O&&O(A)};return observeIntersection(this.node.current,E,S)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:u,prevProps:g}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(u,g))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:y={}},{viewport:u={}}={}){return g=>y[g]!==u[g]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}},layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},featureBundle={...animations,...gestureAnimations,...drag,...layout},motion=createMotionProxy(featureBundle,createDomVisualElement);const toKebabCase=y=>y.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),toCamelCase$1=y=>y.replace(/^([A-Z])|[\s-_]+(\w)/g,(u,g,v)=>v?v.toUpperCase():g.toLowerCase()),toPascalCase=y=>{const u=toCamelCase$1(y);return u.charAt(0).toUpperCase()+u.slice(1)},mergeClasses=(...y)=>y.filter((u,g,v)=>!!u&&u.trim()!==""&&v.indexOf(u)===g).join(" ").trim(),hasA11yProp=y=>{for(const u in y)if(u.startsWith("aria-")||u==="role"||u==="title")return!0};var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Icon=reactExports.forwardRef(({color:y="currentColor",size:u=24,strokeWidth:g=2,absoluteStrokeWidth:v,className:b="",children:w,iconNode:E,...S},A)=>reactExports.createElement("svg",{ref:A,...defaultAttributes,width:u,height:u,stroke:y,strokeWidth:v?Number(g)*24/Number(u):g,className:mergeClasses("lucide",b),...!w&&!hasA11yProp(S)&&{"aria-hidden":"true"},...S},[...E.map(([$,R])=>reactExports.createElement($,R)),...Array.isArray(w)?w:[w]]));const createLucideIcon=(y,u)=>{const g=reactExports.forwardRef(({className:v,...b},w)=>reactExports.createElement(Icon,{ref:w,iconNode:u,className:mergeClasses(`lucide-${toKebabCase(toPascalCase(y))}`,`lucide-${y}`,v),...b}));return g.displayName=toPascalCase(y),g};const __iconNode$1p=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Activity=createLucideIcon("activity",__iconNode$1p);const __iconNode$1o=[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]],ArrowDownLeft=createLucideIcon("arrow-down-left",__iconNode$1o);const __iconNode$1n=[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]],ArrowDownUp=createLucideIcon("arrow-down-up",__iconNode$1n);const __iconNode$1m=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],ArrowDown=createLucideIcon("arrow-down",__iconNode$1m);const __iconNode$1l=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],ArrowLeftRight=createLucideIcon("arrow-left-right",__iconNode$1l);const __iconNode$1k=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ArrowLeft=createLucideIcon("arrow-left",__iconNode$1k);const __iconNode$1j=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],ArrowRightLeft=createLucideIcon("arrow-right-left",__iconNode$1j);const __iconNode$1i=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],ArrowRight=createLucideIcon("arrow-right",__iconNode$1i);const __iconNode$1h=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],ArrowUpRight=createLucideIcon("arrow-up-right",__iconNode$1h);const __iconNode$1g=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]],AtSign=createLucideIcon("at-sign",__iconNode$1g);const __iconNode$1f=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],Banknote=createLucideIcon("banknote",__iconNode$1f);const __iconNode$1e=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Bell=createLucideIcon("bell",__iconNode$1e);const __iconNode$1d=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],Box=createLucideIcon("box",__iconNode$1d);const __iconNode$1c=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Brain=createLucideIcon("brain",__iconNode$1c);const __iconNode$1b=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],CheckCheck=createLucideIcon("check-check",__iconNode$1b);const __iconNode$1a=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Check=createLucideIcon("check",__iconNode$1a);const __iconNode$19=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ChevronDown=createLucideIcon("chevron-down",__iconNode$19);const __iconNode$18=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ChevronLeft=createLucideIcon("chevron-left",__iconNode$18);const __iconNode$17=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ChevronRight=createLucideIcon("chevron-right",__iconNode$17);const __iconNode$16=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ChevronUp=createLucideIcon("chevron-up",__iconNode$16);const __iconNode$15=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],CircleAlert=createLucideIcon("circle-alert",__iconNode$15);const __iconNode$14=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],CircleCheckBig=createLucideIcon("circle-check-big",__iconNode$14);const __iconNode$13=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],CircleCheck=createLucideIcon("circle-check",__iconNode$13);const __iconNode$12=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],CircleX=createLucideIcon("circle-x",__iconNode$12);const __iconNode$11=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Clock=createLucideIcon("clock",__iconNode$11);const __iconNode$10=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Cloud=createLucideIcon("cloud",__iconNode$10);const __iconNode$$=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],Coins=createLucideIcon("coins",__iconNode$$);const __iconNode$_=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Copy=createLucideIcon("copy",__iconNode$_);const __iconNode$Z=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],Cpu=createLucideIcon("cpu",__iconNode$Z);const __iconNode$Y=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],CreditCard=createLucideIcon("credit-card",__iconNode$Y);const __iconNode$X=[["rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2",key:"6agr2n"}],["path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6",key:"1o487t"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 14h.01",key:"ssrbsk"}],["path",{d:"M15 6h.01",key:"cblpky"}],["path",{d:"M18 9h.01",key:"2061c0"}]],Dices=createLucideIcon("dices",__iconNode$X);const __iconNode$W=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Download=createLucideIcon("download",__iconNode$W);const __iconNode$V=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],EllipsisVertical=createLucideIcon("ellipsis-vertical",__iconNode$V);const __iconNode$U=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],ExternalLink=createLucideIcon("external-link",__iconNode$U);const __iconNode$T=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],EyeOff=createLucideIcon("eye-off",__iconNode$T);const __iconNode$S=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Eye=createLucideIcon("eye",__iconNode$S);const __iconNode$R=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],FileBraces=createLucideIcon("file-braces",__iconNode$R);const __iconNode$Q=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],FileText=createLucideIcon("file-text",__iconNode$Q);const __iconNode$P=[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]],Gamepad2=createLucideIcon("gamepad-2",__iconNode$P);const __iconNode$O=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],Github=createLucideIcon("github",__iconNode$O);const __iconNode$N=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Hash$2=createLucideIcon("hash",__iconNode$N);const __iconNode$M=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],History=createLucideIcon("history",__iconNode$M);const __iconNode$L=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Info=createLucideIcon("info",__iconNode$L);const __iconNode$K=[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]],KeyRound=createLucideIcon("key-round",__iconNode$K);const __iconNode$J=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Key$1=createLucideIcon("key",__iconNode$J);const __iconNode$I=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Layers=createLucideIcon("layers",__iconNode$I);const __iconNode$H=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Link=createLucideIcon("link",__iconNode$H);const __iconNode$G=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],LoaderCircle=createLucideIcon("loader-circle",__iconNode$G);const __iconNode$F=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Lock=createLucideIcon("lock",__iconNode$F);const __iconNode$E=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],LogOut=createLucideIcon("log-out",__iconNode$E);const __iconNode$D=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Menu=createLucideIcon("menu",__iconNode$D);const __iconNode$C=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],MessageCircle=createLucideIcon("message-circle",__iconNode$C);const __iconNode$B=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M12 8v6",key:"1ib9pf"}],["path",{d:"M9 11h6",key:"1fldmi"}]],MessageSquarePlus=createLucideIcon("message-square-plus",__iconNode$B);const __iconNode$A=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],MessageSquare=createLucideIcon("message-square",__iconNode$A);const __iconNode$z=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],Moon=createLucideIcon("moon",__iconNode$z);const __iconNode$y=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Package=createLucideIcon("package",__iconNode$y);const __iconNode$x=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],PanelLeftClose=createLucideIcon("panel-left-close",__iconNode$x);const __iconNode$w=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]],PanelLeft=createLucideIcon("panel-left",__iconNode$w);const __iconNode$v=[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]],Pill=createLucideIcon("pill",__iconNode$v);const __iconNode$u=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Plus=createLucideIcon("plus",__iconNode$u);const __iconNode$t=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],QrCode=createLucideIcon("qr-code",__iconNode$t);const __iconNode$s=[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]],Receipt=createLucideIcon("receipt",__iconNode$s);const __iconNode$r=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],RefreshCw=createLucideIcon("refresh-cw",__iconNode$r);const __iconNode$q=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],Repeat=createLucideIcon("repeat",__iconNode$q);const __iconNode$p=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],Rocket=createLucideIcon("rocket",__iconNode$p);const __iconNode$o=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],Scissors=createLucideIcon("scissors",__iconNode$o);const __iconNode$n=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Search=createLucideIcon("search",__iconNode$n);const __iconNode$m=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Send=createLucideIcon("send",__iconNode$m);const __iconNode$l=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Settings=createLucideIcon("settings",__iconNode$l);const __iconNode$k=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],ShieldAlert=createLucideIcon("shield-alert",__iconNode$k);const __iconNode$j=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ShieldCheck=createLucideIcon("shield-check",__iconNode$j);const __iconNode$i=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Shield=createLucideIcon("shield",__iconNode$i);const __iconNode$h=[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]],Shirt=createLucideIcon("shirt",__iconNode$h);const __iconNode$g=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],ShoppingBag=createLucideIcon("shopping-bag",__iconNode$g);const __iconNode$f=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Sparkles=createLucideIcon("sparkles",__iconNode$f);const __iconNode$e=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],SquareCheckBig=createLucideIcon("square-check-big",__iconNode$e);const __iconNode$d=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Square=createLucideIcon("square",__iconNode$d);const __iconNode$c=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Sun=createLucideIcon("sun",__iconNode$c);const __iconNode$b=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Tag$1=createLucideIcon("tag",__iconNode$b);const __iconNode$a=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Trash2=createLucideIcon("trash-2",__iconNode$a);const __iconNode$9=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],TrendingUp=createLucideIcon("trending-up",__iconNode$9);const __iconNode$8=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],TriangleAlert=createLucideIcon("triangle-alert",__iconNode$8);const __iconNode$7=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],Trophy=createLucideIcon("trophy",__iconNode$7);const __iconNode$6=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Upload=createLucideIcon("upload",__iconNode$6);const __iconNode$5=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],User=createLucideIcon("user",__iconNode$5);const __iconNode$4=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Users=createLucideIcon("users",__iconNode$4);const __iconNode$3=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],Wallet$1=createLucideIcon("wallet",__iconNode$3);const __iconNode$2=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],WifiOff=createLucideIcon("wifi-off",__iconNode$2);const __iconNode$1=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],X=createLucideIcon("x",__iconNode$1);const __iconNode=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Zap=createLucideIcon("zap",__iconNode),byteToHex=[];for(let y=0;y<256;++y)byteToHex.push((y+256).toString(16).slice(1));function unsafeStringify(y,u=0){return(byteToHex[y[u+0]]+byteToHex[y[u+1]]+byteToHex[y[u+2]]+byteToHex[y[u+3]]+"-"+byteToHex[y[u+4]]+byteToHex[y[u+5]]+"-"+byteToHex[y[u+6]]+byteToHex[y[u+7]]+"-"+byteToHex[y[u+8]]+byteToHex[y[u+9]]+"-"+byteToHex[y[u+10]]+byteToHex[y[u+11]]+byteToHex[y[u+12]]+byteToHex[y[u+13]]+byteToHex[y[u+14]]+byteToHex[y[u+15]]).toLowerCase()}let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");getRandomValues=crypto.getRandomValues.bind(crypto)}return getRandomValues(rnds8)}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function _v4(y,u,g){y=y||{};const v=y.random??y.rng?.()??rng();if(v.length<16)throw new Error("Random bytes length must be >= 16");return v[6]=v[6]&15|64,v[8]=v[8]&63|128,unsafeStringify(v)}function v4$1(y,u,g){return native.randomUUID&&!y?native.randomUUID():_v4(y)}const mockMatches=[{id:"1",team1:"Finland",team2:"Estonia",team1Flag:"",team2Flag:"",date:"28.12.25",time:"19:00",odds1:1.85,oddsDraw:3.4,odds2:4.2,image:"https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=400&h=200&fit=crop"},{id:"2",team1:"Germany",team2:"France",team1Flag:"",team2Flag:"",date:"29.12.25",time:"21:00",odds1:2.1,oddsDraw:3.2,odds2:2.9,image:"https://images.unsplash.com/photo-1508098682722-e99c43a406b2?w=400&h=200&fit=crop"}],p2pListings=[{id:"1",name:"Leather Sofa",price:450,seller:{id:"1",name:"Sarah Williams",avatar:"SW"},image:"https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=400&h=200&fit=crop",description:"Genuine leather 3-seater sofa in excellent condition",location:"New York"},{id:"2",name:"iPhone 14 Pro",price:800,seller:{id:"2",name:"Mike Johnson",avatar:"MJ"},image:"https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=400&h=200&fit=crop",description:"128GB, Space Black, like new with original box",location:"Los Angeles"},{id:"3",name:"Mountain Bike",price:350,seller:{id:"3",name:"Alex Chen",avatar:"AC"},image:"https://images.unsplash.com/photo-1532298229144-0ec0c57515c7?w=400&h=200&fit=crop",description:"21-speed, aluminum frame, barely used",location:"Chicago"},{id:"4",name:"Gaming PC",price:1200,seller:{id:"4",name:"Emma Davis",avatar:"ED"},image:"https://images.unsplash.com/photo-1587202372775-e229f172b9d7?w=400&h=200&fit=crop",description:"RTX 3070, Ryzen 7, 32GB RAM, RGB setup",location:"Miami"}],merchItems=[{id:"1",name:"Unicity Hoodie",price:59.99,image:"https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=400&h=200&fit=crop",description:"Premium black hoodie with embroidered Unicity logo",sizes:["S","M","L","XL","XXL"]},{id:"2",name:"Crypto T-Shirt",price:29.99,image:"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400&h=200&fit=crop",description:"Classic fit cotton t-shirt with blockchain design",sizes:["S","M","L","XL"]},{id:"3",name:"Dev Cap",price:24.99,image:"https://images.unsplash.com/photo-1588850561407-ed78c282e89b?w=400&h=200&fit=crop",description:'Snapback cap with "Code & Crypto" embroidery',sizes:["One Size"]},{id:"4",name:"Sphere Mug",price:14.99,image:"https://images.unsplash.com/photo-1514228742587-6b1558fcca3d?w=400&h=200&fit=crop",description:"Ceramic mug with color-changing Sphere logo",sizes:["Standard"]}],STORAGE_KEYS={THEME:"sphere_theme",WALLET_ACTIVE_LAYER:"sphere_wallet_active_layer",WELCOME_ACCEPTED:"sphere_welcome_accepted",UNIFIED_WALLET_MNEMONIC:"sphere_wallet_mnemonic",UNIFIED_WALLET_MASTER:"sphere_wallet_master",UNIFIED_WALLET_CHAINCODE:"sphere_wallet_chaincode",UNIFIED_WALLET_SOURCE:"sphere_wallet_source",UNIFIED_WALLET_DERIVATION_MODE:"sphere_wallet_derivation_mode",UNIFIED_WALLET_BASE_PATH:"sphere_wallet_base_path",L3_SELECTED_ADDRESS_PATH:"sphere_l3_selected_address_path",L3_SELECTED_ADDRESS_INDEX_LEGACY:"sphere_l3_selected_address_index",ENCRYPTED_SEED:"sphere_encrypted_seed",TRANSACTION_HISTORY:"sphere_transaction_history",WALLET_DATA_LEGACY:"sphere_wallet_data",WALLET_MAIN:"sphere_wallet_main",OUTBOX:"sphere_outbox",OUTBOX_SPLIT_GROUPS:"sphere_outbox_split_groups",CHAT_CONVERSATIONS:"sphere_chat_conversations",CHAT_MESSAGES:"sphere_chat_messages",GROUP_CHAT_GROUPS:"sphere_group_chat_groups",GROUP_CHAT_MESSAGES:"sphere_group_chat_messages",GROUP_CHAT_MEMBERS:"sphere_group_chat_members",GROUP_CHAT_RELAY_URL:"sphere_group_chat_relay_url",GROUP_CHAT_PROCESSED_EVENTS:"sphere_group_chat_processed_events",AGENT_CHAT_SESSIONS:"sphere_agent_chat_sessions",AGENT_CHAT_TOMBSTONES:"sphere_agent_chat_tombstones",TOKEN_BACKUP_TIMESTAMP:"sphere_token_backup_timestamp",LAST_IPFS_SYNC_SUCCESS:"sphere_last_ipfs_sync_success",ENCRYPTED_TOKEN_BACKUP:"sphere_encrypted_token_backup",UNICITY_IDS_CACHE:"sphere_unicity_ids_cache",UNICITY_IDS_TIMESTAMP:"sphere_unicity_ids_timestamp",NOSTR_LAST_SYNC:"sphere_nostr_last_sync",NOSTR_PROCESSED_EVENTS:"sphere_nostr_processed_events"},STORAGE_KEY_GENERATORS={walletByAddress:y=>`sphere_wallet_${y}`,l1WalletByKey:y=>`sphere_l1_wallet_${y}`,agentMemory:(y,u)=>`sphere_agent_memory:${y}:${u}`,agentChatMessages:y=>`sphere_agent_chat_messages:${y}`,ipfsVersion:y=>`sphere_ipfs_version_${y}`,ipfsLastCid:y=>`sphere_ipfs_last_cid_${y}`,ipfsPendingIpns:y=>`sphere_ipfs_pending_ipns_${y}`,ipfsLastSeq:y=>`sphere_ipfs_last_seq_${y}`,ipfsChatVersion:y=>`sphere_ipfs_chat_version_${y}`,ipfsChatCid:y=>`sphere_ipfs_chat_cid_${y}`,ipfsChatSeq:y=>`sphere_ipfs_chat_seq_${y}`},STORAGE_KEY_PREFIXES={APP:"sphere_",WALLET_ADDRESS:"sphere_wallet_",IPFS_VERSION:"sphere_ipfs_version_",IPFS_LAST_CID:"sphere_ipfs_last_cid_",IPFS_PENDING_IPNS:"sphere_ipfs_pending_ipns_",IPNS_SEQ:"sphere_ipns_seq_"};function clearAllSphereData(){const y=[];for(let u=0;u<localStorage.length;u++){const g=localStorage.key(u);g?.startsWith(STORAGE_KEY_PREFIXES.APP)&&y.push(g)}y.forEach(u=>localStorage.removeItem(u)),console.log(` Cleared ${y.length} sphere_* keys from localStorage`)}function getMemoryKey(y,u){return STORAGE_KEY_GENERATORS.agentMemory(y,u)}function loadMemory(y,u){try{const g=getMemoryKey(y,u),v=localStorage.getItem(g);if(!v)return console.log(`[Memory] No stored memory for ${y}:${u}`),{};const b=JSON.parse(v);return console.log(`[Memory] Loaded memory for ${y}:${u}:`,Object.keys(b)),b}catch(g){return console.warn("[Memory] Failed to load memory:",g),{}}}function saveMemory(y,u,g){try{const v=getMemoryKey(y,u),b=JSON.stringify(g);return localStorage.setItem(v,b),console.log(`[Memory] Saved memory for ${y}:${u}:`,Object.keys(g)),!0}catch(v){return v instanceof DOMException&&(v.name==="QuotaExceededError"||v.name==="NS_ERROR_DOM_QUOTA_REACHED")?console.error("[Memory] localStorage quota exceeded. Unable to save memory."):console.error("[Memory] Failed to save memory:",v),!1}}function isLocalStorageAvailable(){try{const y="__localStorage_test__";return localStorage.setItem(y,y),localStorage.removeItem(y),!0}catch{return!1}}function isMock(){return!1}function getAgentMode(){return"real"}function getAgentApiUrl(){return"https://sphere.unicity.network/api"}function useAgentChat({activityId:y,userId:u}){const[g,v]=reactExports.useState([]),[b,w]=reactExports.useState(!1),[E,S]=reactExports.useState(null),A=reactExports.useRef(v4$1()),$=u||A.current,R=reactExports.useRef(null),T=reactExports.useCallback(()=>{R.current&&(R.current.abort(),R.current=null),w(!1),S(null)},[]),O=reactExports.useCallback(async F=>{const U={id:v4$1(),role:"user",content:F,timestamp:Date.now()};v(J=>[...J,U]);const q={id:v4$1(),role:"assistant",content:"",timestamp:Date.now()};v(J=>[...J,q]),w(!0),S("Thinking...");try{R.current=new AbortController;const J=getAgentApiUrl(),ie=[...g,U].map(pe=>({id:pe.id,role:pe.role,content:[{type:"text",text:pe.content}],timestamp:pe.timestamp})),oe=isLocalStorageAvailable()?loadMemory($,y):{};console.log("[useAgentChat] Sending memory state:",oe);const le=await fetch(`${J}/chat/stream`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({activityId:y,userId:$,messages:ie,userContext:{userId:$,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,locale:navigator.language},memoryState:oe}),signal:R.current.signal});if(!le.ok)throw new Error(`HTTP ${le.status}`);const de=le.body?.getReader();if(!de)throw new Error("No response body");const fe=new TextDecoder;let ye="",we="";for(;;){const{done:pe,value:ve}=await de.read();if(pe)break;ye+=fe.decode(ve,{stream:!0});const he=ye.split(`
`);ye=he.pop()||"";for(const ae of he)if(ae.startsWith("data: "))try{const Q=JSON.parse(ae.slice(6));switch(Q.type){case"text-delta":we+=Q.text,v(j=>j.map(z=>z.id===q.id?{...z,content:we}:z));break;case"tool-call":S(`Using ${Q.toolName}...`);break;case"reasoning":v(j=>j.map(z=>z.id===q.id?{...z,thinking:(z.thinking||"")+Q.text}:z));break;case"memory-update":isLocalStorageAvailable()&&Q.memoryState&&saveMemory($,y,Q.memoryState);break;case"done":w(!1),S(null);break;case"error":v(j=>j.map(z=>z.id===q.id?{...z,content:`Error: ${Q.message}`}:z)),w(!1),S(null);break}}catch{}}}catch(J){if(J instanceof Error&&J.name==="AbortError")return;v(ie=>ie.map(oe=>oe.id===q.id?{...oe,content:"Failed to connect to agent server. Make sure agentic-chatbot is running."}:oe)),w(!1),S(null)}},[y,g,$]),B=reactExports.useCallback(()=>{v([])},[]);return{messages:g,setMessages:v,isStreaming:b,currentStatus:E,sendMessage:O,clearMessages:B,stopGeneration:T,agentMode:getAgentMode()}}var Subscribable=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(y){return this.listeners.add(y),this.onSubscribe(),()=>{this.listeners.delete(y),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},defaultTimeoutProvider={setTimeout:(y,u)=>setTimeout(y,u),clearTimeout:y=>clearTimeout(y),setInterval:(y,u)=>setInterval(y,u),clearInterval:y=>clearInterval(y)},TimeoutManager=class{#e=defaultTimeoutProvider;#t=!1;setTimeoutProvider(y){this.#e=y}setTimeout(y,u){return this.#e.setTimeout(y,u)}clearTimeout(y){this.#e.clearTimeout(y)}setInterval(y,u){return this.#e.setInterval(y,u)}clearInterval(y){this.#e.clearInterval(y)}},timeoutManager=new TimeoutManager;function systemSetTimeoutZero(y){setTimeout(y,0)}var isServer$1=typeof window>"u"||"Deno"in globalThis;function noop$2(){}function functionalUpdate(y,u){return typeof y=="function"?y(u):y}function isValidTimeout(y){return typeof y=="number"&&y>=0&&y!==1/0}function timeUntilStale(y,u){return Math.max(y+(u||0)-Date.now(),0)}function resolveStaleTime(y,u){return typeof y=="function"?y(u):y}function resolveEnabled(y,u){return typeof y=="function"?y(u):y}function matchQuery(y,u){const{type:g="all",exact:v,fetchStatus:b,predicate:w,queryKey:E,stale:S}=y;if(E){if(v){if(u.queryHash!==hashQueryKeyByOptions(E,u.options))return!1}else if(!partialMatchKey(u.queryKey,E))return!1}if(g!=="all"){const A=u.isActive();if(g==="active"&&!A||g==="inactive"&&A)return!1}return!(typeof S=="boolean"&&u.isStale()!==S||b&&b!==u.state.fetchStatus||w&&!w(u))}function matchMutation(y,u){const{exact:g,status:v,predicate:b,mutationKey:w}=y;if(w){if(!u.options.mutationKey)return!1;if(g){if(hashKey(u.options.mutationKey)!==hashKey(w))return!1}else if(!partialMatchKey(u.options.mutationKey,w))return!1}return!(v&&u.state.status!==v||b&&!b(u))}function hashQueryKeyByOptions(y,u){return(u?.queryKeyHashFn||hashKey)(y)}function hashKey(y){return JSON.stringify(y,(u,g)=>isPlainObject$2(g)?Object.keys(g).sort().reduce((v,b)=>(v[b]=g[b],v),{}):g)}function partialMatchKey(y,u){return y===u?!0:typeof y!=typeof u?!1:y&&u&&typeof y=="object"&&typeof u=="object"?Object.keys(u).every(g=>partialMatchKey(y[g],u[g])):!1}var hasOwn=Object.prototype.hasOwnProperty;function replaceEqualDeep(y,u){if(y===u)return y;const g=isPlainArray(y)&&isPlainArray(u);if(!g&&!(isPlainObject$2(y)&&isPlainObject$2(u)))return u;const b=(g?y:Object.keys(y)).length,w=g?u:Object.keys(u),E=w.length,S=g?new Array(E):{};let A=0;for(let $=0;$<E;$++){const R=g?$:w[$],T=y[R],O=u[R];if(T===O){S[R]=T,(g?$<b:hasOwn.call(y,R))&&A++;continue}if(T===null||O===null||typeof T!="object"||typeof O!="object"){S[R]=O;continue}const B=replaceEqualDeep(T,O);S[R]=B,B===T&&A++}return b===E&&A===b?y:S}function shallowEqualObjects(y,u){if(!u||Object.keys(y).length!==Object.keys(u).length)return!1;for(const g in y)if(y[g]!==u[g])return!1;return!0}function isPlainArray(y){return Array.isArray(y)&&y.length===Object.keys(y).length}function isPlainObject$2(y){if(!hasObjectPrototype(y))return!1;const u=y.constructor;if(u===void 0)return!0;const g=u.prototype;return!(!hasObjectPrototype(g)||!g.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(y)!==Object.prototype)}function hasObjectPrototype(y){return Object.prototype.toString.call(y)==="[object Object]"}function sleep$1(y){return new Promise(u=>{timeoutManager.setTimeout(u,y)})}function replaceData(y,u,g){return typeof g.structuralSharing=="function"?g.structuralSharing(y,u):g.structuralSharing!==!1?replaceEqualDeep(y,u):u}function addToEnd(y,u,g=0){const v=[...y,u];return g&&v.length>g?v.slice(1):v}function addToStart(y,u,g=0){const v=[u,...y];return g&&v.length>g?v.slice(0,-1):v}var skipToken=Symbol();function ensureQueryFn(y,u){return!y.queryFn&&u?.initialPromise?()=>u.initialPromise:!y.queryFn||y.queryFn===skipToken?()=>Promise.reject(new Error(`Missing queryFn: '${y.queryHash}'`)):y.queryFn}function shouldThrowError(y,u){return typeof y=="function"?y(...u):!!y}var FocusManager=class extends Subscribable{#e;#t;#r;constructor(){super(),this.#r=y=>{if(!isServer$1&&window.addEventListener){const u=()=>y();return window.addEventListener("visibilitychange",u,!1),()=>{window.removeEventListener("visibilitychange",u)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(y){this.#r=y,this.#t?.(),this.#t=y(u=>{typeof u=="boolean"?this.setFocused(u):this.onFocus()})}setFocused(y){this.#e!==y&&(this.#e=y,this.onFocus())}onFocus(){const y=this.isFocused();this.listeners.forEach(u=>{u(y)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},focusManager=new FocusManager;function pendingThenable(){let y,u;const g=new Promise((b,w)=>{y=b,u=w});g.status="pending",g.catch(()=>{});function v(b){Object.assign(g,b),delete g.resolve,delete g.reject}return g.resolve=b=>{v({status:"fulfilled",value:b}),y(b)},g.reject=b=>{v({status:"rejected",reason:b}),u(b)},g}var defaultScheduler=systemSetTimeoutZero;function createNotifyManager(){let y=[],u=0,g=S=>{S()},v=S=>{S()},b=defaultScheduler;const w=S=>{u?y.push(S):b(()=>{g(S)})},E=()=>{const S=y;y=[],S.length&&b(()=>{v(()=>{S.forEach(A=>{g(A)})})})};return{batch:S=>{let A;u++;try{A=S()}finally{u--,u||E()}return A},batchCalls:S=>(...A)=>{w(()=>{S(...A)})},schedule:w,setNotifyFunction:S=>{g=S},setBatchNotifyFunction:S=>{v=S},setScheduler:S=>{b=S}}}var notifyManager=createNotifyManager(),OnlineManager=class extends Subscribable{#e=!0;#t;#r;constructor(){super(),this.#r=y=>{if(!isServer$1&&window.addEventListener){const u=()=>y(!0),g=()=>y(!1);return window.addEventListener("online",u,!1),window.addEventListener("offline",g,!1),()=>{window.removeEventListener("online",u),window.removeEventListener("offline",g)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(y){this.#r=y,this.#t?.(),this.#t=y(this.setOnline.bind(this))}setOnline(y){this.#e!==y&&(this.#e=y,this.listeners.forEach(g=>{g(y)}))}isOnline(){return this.#e}},onlineManager=new OnlineManager;function defaultRetryDelay(y){return Math.min(1e3*2**y,3e4)}function canFetch(y){return(y??"online")==="online"?onlineManager.isOnline():!0}var CancelledError=class extends Error{constructor(y){super("CancelledError"),this.revert=y?.revert,this.silent=y?.silent}};function createRetryer(y){let u=!1,g=0,v;const b=pendingThenable(),w=()=>b.status!=="pending",E=U=>{if(!w()){const q=new CancelledError(U);O(q),y.onCancel?.(q)}},S=()=>{u=!0},A=()=>{u=!1},$=()=>focusManager.isFocused()&&(y.networkMode==="always"||onlineManager.isOnline())&&y.canRun(),R=()=>canFetch(y.networkMode)&&y.canRun(),T=U=>{w()||(v?.(),b.resolve(U))},O=U=>{w()||(v?.(),b.reject(U))},B=()=>new Promise(U=>{v=q=>{(w()||$())&&U(q)},y.onPause?.()}).then(()=>{v=void 0,w()||y.onContinue?.()}),F=()=>{if(w())return;let U;const q=g===0?y.initialPromise:void 0;try{U=q??y.fn()}catch(J){U=Promise.reject(J)}Promise.resolve(U).then(T).catch(J=>{if(w())return;const ie=y.retry??(isServer$1?0:3),oe=y.retryDelay??defaultRetryDelay,le=typeof oe=="function"?oe(g,J):oe,de=ie===!0||typeof ie=="number"&&g<ie||typeof ie=="function"&&ie(g,J);if(u||!de){O(J);return}g++,y.onFail?.(g,J),sleep$1(le).then(()=>$()?void 0:B()).then(()=>{u?O(J):F()})})};return{promise:b,status:()=>b.status,cancel:E,continue:()=>(v?.(),b),cancelRetry:S,continueRetry:A,canStart:R,start:()=>(R()?F():B().then(F),b)}}var Removable=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),isValidTimeout(this.gcTime)&&(this.#e=timeoutManager.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(y){this.gcTime=Math.max(this.gcTime||0,y??(isServer$1?1/0:300*1e3))}clearGcTimeout(){this.#e&&(timeoutManager.clearTimeout(this.#e),this.#e=void 0)}},Query=class extends Removable{#e;#t;#r;#i;#n;#o;#a;constructor(y){super(),this.#a=!1,this.#o=y.defaultOptions,this.setOptions(y.options),this.observers=[],this.#i=y.client,this.#r=this.#i.getQueryCache(),this.queryKey=y.queryKey,this.queryHash=y.queryHash,this.#e=getDefaultState$1(this.options),this.state=y.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(y){if(this.options={...this.#o,...y},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const u=getDefaultState$1(this.options);u.data!==void 0&&(this.setState(successState(u.data,u.dataUpdatedAt)),this.#e=u)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#r.remove(this)}setData(y,u){const g=replaceData(this.state.data,y,this.options);return this.#c({data:g,type:"success",dataUpdatedAt:u?.updatedAt,manual:u?.manual}),g}setState(y,u){this.#c({type:"setState",state:y,setStateOptions:u})}cancel(y){const u=this.#n?.promise;return this.#n?.cancel(y),u?u.then(noop$2).catch(noop$2):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(y=>resolveEnabled(y.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===skipToken||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(y=>resolveStaleTime(y.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(y=>y.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(y=0){return this.state.data===void 0?!0:y==="static"?!1:this.state.isInvalidated?!0:!timeUntilStale(this.state.dataUpdatedAt,y)}onFocus(){this.observers.find(u=>u.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(u=>u.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(y){this.observers.includes(y)||(this.observers.push(y),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",query:this,observer:y}))}removeObserver(y){this.observers.includes(y)&&(this.observers=this.observers.filter(u=>u!==y),this.observers.length||(this.#n&&(this.#a?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#r.notify({type:"observerRemoved",query:this,observer:y}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#c({type:"invalidate"})}async fetch(y,u){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&u?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(y&&this.setOptions(y),!this.options.queryFn){const S=this.observers.find(A=>A.options.queryFn);S&&this.setOptions(S.options)}const g=new AbortController,v=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(this.#a=!0,g.signal)})},b=()=>{const S=ensureQueryFn(this.options,u),$=(()=>{const R={client:this.#i,queryKey:this.queryKey,meta:this.meta};return v(R),R})();return this.#a=!1,this.options.persister?this.options.persister(S,$,this):S($)},E=(()=>{const S={fetchOptions:u,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:b};return v(S),S})();this.options.behavior?.onFetch(E,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==E.fetchOptions?.meta)&&this.#c({type:"fetch",meta:E.fetchOptions?.meta}),this.#n=createRetryer({initialPromise:u?.initialPromise,fn:E.fetchFn,onCancel:S=>{S instanceof CancelledError&&S.revert&&this.setState({...this.#t,fetchStatus:"idle"}),g.abort()},onFail:(S,A)=>{this.#c({type:"failed",failureCount:S,error:A})},onPause:()=>{this.#c({type:"pause"})},onContinue:()=>{this.#c({type:"continue"})},retry:E.options.retry,retryDelay:E.options.retryDelay,networkMode:E.options.networkMode,canRun:()=>!0});try{const S=await this.#n.start();if(S===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(S),this.#r.config.onSuccess?.(S,this),this.#r.config.onSettled?.(S,this.state.error,this),S}catch(S){if(S instanceof CancelledError){if(S.silent)return this.#n.promise;if(S.revert){if(this.state.data===void 0)throw S;return this.state.data}}throw this.#c({type:"error",error:S}),this.#r.config.onError?.(S,this),this.#r.config.onSettled?.(this.state.data,S,this),S}finally{this.scheduleGc()}}#c(y){const u=g=>{switch(y.type){case"failed":return{...g,fetchFailureCount:y.failureCount,fetchFailureReason:y.error};case"pause":return{...g,fetchStatus:"paused"};case"continue":return{...g,fetchStatus:"fetching"};case"fetch":return{...g,...fetchState(g.data,this.options),fetchMeta:y.meta??null};case"success":const v={...g,...successState(y.data,y.dataUpdatedAt),dataUpdateCount:g.dataUpdateCount+1,...!y.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=y.manual?v:void 0,v;case"error":const b=y.error;return{...g,error:b,errorUpdateCount:g.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:g.fetchFailureCount+1,fetchFailureReason:b,fetchStatus:"idle",status:"error"};case"invalidate":return{...g,isInvalidated:!0};case"setState":return{...g,...y.state}}};this.state=u(this.state),notifyManager.batch(()=>{this.observers.forEach(g=>{g.onQueryUpdate()}),this.#r.notify({query:this,type:"updated",action:y})})}};function fetchState(y,u){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:canFetch(u.networkMode)?"fetching":"paused",...y===void 0&&{error:null,status:"pending"}}}function successState(y,u){return{data:y,dataUpdatedAt:u??Date.now(),error:null,isInvalidated:!1,status:"success"}}function getDefaultState$1(y){const u=typeof y.initialData=="function"?y.initialData():y.initialData,g=u!==void 0,v=g?typeof y.initialDataUpdatedAt=="function"?y.initialDataUpdatedAt():y.initialDataUpdatedAt:0;return{data:u,dataUpdateCount:0,dataUpdatedAt:g?v??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:g?"success":"pending",fetchStatus:"idle"}}var QueryObserver=class extends Subscribable{constructor(y,u){super(),this.options=u,this.#e=y,this.#c=null,this.#a=pendingThenable(),this.bindMethods(),this.setOptions(u)}#e;#t=void 0;#r=void 0;#i=void 0;#n;#o;#a;#c;#g;#u;#f;#s;#p;#l;#h=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),shouldFetchOnMount(this.#t,this.options)?this.#d():this.updateResult(),this.#x())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return shouldFetchOn(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return shouldFetchOn(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#w(),this.#E(),this.#t.removeObserver(this)}setOptions(y){const u=this.options,g=this.#t;if(this.options=this.#e.defaultQueryOptions(y),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof resolveEnabled(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#_(),this.#t.setOptions(this.options),u._defaulted&&!shallowEqualObjects(this.options,u)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const v=this.hasListeners();v&&shouldFetchOptionally(this.#t,g,this.options,u)&&this.#d(),this.updateResult(),v&&(this.#t!==g||resolveEnabled(this.options.enabled,this.#t)!==resolveEnabled(u.enabled,this.#t)||resolveStaleTime(this.options.staleTime,this.#t)!==resolveStaleTime(u.staleTime,this.#t))&&this.#v();const b=this.#m();v&&(this.#t!==g||resolveEnabled(this.options.enabled,this.#t)!==resolveEnabled(u.enabled,this.#t)||b!==this.#l)&&this.#b(b)}getOptimisticResult(y){const u=this.#e.getQueryCache().build(this.#e,y),g=this.createResult(u,y);return shouldAssignObserverCurrentProperties(this,g)&&(this.#i=g,this.#o=this.options,this.#n=this.#t.state),g}getCurrentResult(){return this.#i}trackResult(y,u){return new Proxy(y,{get:(g,v)=>(this.trackProp(v),u?.(v),v==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(g,v))})}trackProp(y){this.#h.add(y)}getCurrentQuery(){return this.#t}refetch({...y}={}){return this.fetch({...y})}fetchOptimistic(y){const u=this.#e.defaultQueryOptions(y),g=this.#e.getQueryCache().build(this.#e,u);return g.fetch().then(()=>this.createResult(g,u))}fetch(y){return this.#d({...y,cancelRefetch:y.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#d(y){this.#_();let u=this.#t.fetch(this.options,y);return y?.throwOnError||(u=u.catch(noop$2)),u}#v(){this.#w();const y=resolveStaleTime(this.options.staleTime,this.#t);if(isServer$1||this.#i.isStale||!isValidTimeout(y))return;const g=timeUntilStale(this.#i.dataUpdatedAt,y)+1;this.#s=timeoutManager.setTimeout(()=>{this.#i.isStale||this.updateResult()},g)}#m(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#b(y){this.#E(),this.#l=y,!(isServer$1||resolveEnabled(this.options.enabled,this.#t)===!1||!isValidTimeout(this.#l)||this.#l===0)&&(this.#p=timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||focusManager.isFocused())&&this.#d()},this.#l))}#x(){this.#v(),this.#b(this.#m())}#w(){this.#s&&(timeoutManager.clearTimeout(this.#s),this.#s=void 0)}#E(){this.#p&&(timeoutManager.clearInterval(this.#p),this.#p=void 0)}createResult(y,u){const g=this.#t,v=this.options,b=this.#i,w=this.#n,E=this.#o,A=y!==g?y.state:this.#r,{state:$}=y;let R={...$},T=!1,O;if(u._optimisticResults){const we=this.hasListeners(),pe=!we&&shouldFetchOnMount(y,u),ve=we&&shouldFetchOptionally(y,g,u,v);(pe||ve)&&(R={...R,...fetchState($.data,y.options)}),u._optimisticResults==="isRestoring"&&(R.fetchStatus="idle")}let{error:B,errorUpdatedAt:F,status:U}=R;O=R.data;let q=!1;if(u.placeholderData!==void 0&&O===void 0&&U==="pending"){let we;b?.isPlaceholderData&&u.placeholderData===E?.placeholderData?(we=b.data,q=!0):we=typeof u.placeholderData=="function"?u.placeholderData(this.#f?.state.data,this.#f):u.placeholderData,we!==void 0&&(U="success",O=replaceData(b?.data,we,u),T=!0)}if(u.select&&O!==void 0&&!q)if(b&&O===w?.data&&u.select===this.#g)O=this.#u;else try{this.#g=u.select,O=u.select(O),O=replaceData(b?.data,O,u),this.#u=O,this.#c=null}catch(we){this.#c=we}this.#c&&(B=this.#c,O=this.#u,F=Date.now(),U="error");const J=R.fetchStatus==="fetching",ie=U==="pending",oe=U==="error",le=ie&&J,de=O!==void 0,ye={status:U,fetchStatus:R.fetchStatus,isPending:ie,isSuccess:U==="success",isError:oe,isInitialLoading:le,isLoading:le,data:O,dataUpdatedAt:R.dataUpdatedAt,error:B,errorUpdatedAt:F,failureCount:R.fetchFailureCount,failureReason:R.fetchFailureReason,errorUpdateCount:R.errorUpdateCount,isFetched:R.dataUpdateCount>0||R.errorUpdateCount>0,isFetchedAfterMount:R.dataUpdateCount>A.dataUpdateCount||R.errorUpdateCount>A.errorUpdateCount,isFetching:J,isRefetching:J&&!ie,isLoadingError:oe&&!de,isPaused:R.fetchStatus==="paused",isPlaceholderData:T,isRefetchError:oe&&de,isStale:isStale(y,u),refetch:this.refetch,promise:this.#a,isEnabled:resolveEnabled(u.enabled,y)!==!1};if(this.options.experimental_prefetchInRender){const we=he=>{ye.status==="error"?he.reject(ye.error):ye.data!==void 0&&he.resolve(ye.data)},pe=()=>{const he=this.#a=ye.promise=pendingThenable();we(he)},ve=this.#a;switch(ve.status){case"pending":y.queryHash===g.queryHash&&we(ve);break;case"fulfilled":(ye.status==="error"||ye.data!==ve.value)&&pe();break;case"rejected":(ye.status!=="error"||ye.error!==ve.reason)&&pe();break}}return ye}updateResult(){const y=this.#i,u=this.createResult(this.#t,this.options);if(this.#n=this.#t.state,this.#o=this.options,this.#n.data!==void 0&&(this.#f=this.#t),shallowEqualObjects(u,y))return;this.#i=u;const g=()=>{if(!y)return!0;const{notifyOnChangeProps:v}=this.options,b=typeof v=="function"?v():v;if(b==="all"||!b&&!this.#h.size)return!0;const w=new Set(b??this.#h);return this.options.throwOnError&&w.add("error"),Object.keys(this.#i).some(E=>{const S=E;return this.#i[S]!==y[S]&&w.has(S)})};this.#S({listeners:g()})}#_(){const y=this.#e.getQueryCache().build(this.#e,this.options);if(y===this.#t)return;const u=this.#t;this.#t=y,this.#r=y.state,this.hasListeners()&&(u?.removeObserver(this),y.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#x()}#S(y){notifyManager.batch(()=>{y.listeners&&this.listeners.forEach(u=>{u(this.#i)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function shouldLoadOnMount(y,u){return resolveEnabled(u.enabled,y)!==!1&&y.state.data===void 0&&!(y.state.status==="error"&&u.retryOnMount===!1)}function shouldFetchOnMount(y,u){return shouldLoadOnMount(y,u)||y.state.data!==void 0&&shouldFetchOn(y,u,u.refetchOnMount)}function shouldFetchOn(y,u,g){if(resolveEnabled(u.enabled,y)!==!1&&resolveStaleTime(u.staleTime,y)!=="static"){const v=typeof g=="function"?g(y):g;return v==="always"||v!==!1&&isStale(y,u)}return!1}function shouldFetchOptionally(y,u,g,v){return(y!==u||resolveEnabled(v.enabled,y)===!1)&&(!g.suspense||y.state.status!=="error")&&isStale(y,g)}function isStale(y,u){return resolveEnabled(u.enabled,y)!==!1&&y.isStaleByTime(resolveStaleTime(u.staleTime,y))}function shouldAssignObserverCurrentProperties(y,u){return!shallowEqualObjects(y.getCurrentResult(),u)}function infiniteQueryBehavior(y){return{onFetch:(u,g)=>{const v=u.options,b=u.fetchOptions?.meta?.fetchMore?.direction,w=u.state.data?.pages||[],E=u.state.data?.pageParams||[];let S={pages:[],pageParams:[]},A=0;const $=async()=>{let R=!1;const T=F=>{Object.defineProperty(F,"signal",{enumerable:!0,get:()=>(u.signal.aborted?R=!0:u.signal.addEventListener("abort",()=>{R=!0}),u.signal)})},O=ensureQueryFn(u.options,u.fetchOptions),B=async(F,U,q)=>{if(R)return Promise.reject();if(U==null&&F.pages.length)return Promise.resolve(F);const ie=(()=>{const fe={client:u.client,queryKey:u.queryKey,pageParam:U,direction:q?"backward":"forward",meta:u.options.meta};return T(fe),fe})(),oe=await O(ie),{maxPages:le}=u.options,de=q?addToStart:addToEnd;return{pages:de(F.pages,oe,le),pageParams:de(F.pageParams,U,le)}};if(b&&w.length){const F=b==="backward",U=F?getPreviousPageParam:getNextPageParam,q={pages:w,pageParams:E},J=U(v,q);S=await B(q,J,F)}else{const F=y??w.length;do{const U=A===0?E[0]??v.initialPageParam:getNextPageParam(v,S);if(A>0&&U==null)break;S=await B(S,U),A++}while(A<F)}return S};u.options.persister?u.fetchFn=()=>u.options.persister?.($,{client:u.client,queryKey:u.queryKey,meta:u.options.meta,signal:u.signal},g):u.fetchFn=$}}}function getNextPageParam(y,{pages:u,pageParams:g}){const v=u.length-1;return u.length>0?y.getNextPageParam(u[v],u,g[v],g):void 0}function getPreviousPageParam(y,{pages:u,pageParams:g}){return u.length>0?y.getPreviousPageParam?.(u[0],u,g[0],g):void 0}var Mutation=class extends Removable{#e;#t;#r;#i;constructor(y){super(),this.#e=y.client,this.mutationId=y.mutationId,this.#r=y.mutationCache,this.#t=[],this.state=y.state||getDefaultState(),this.setOptions(y.options),this.scheduleGc()}setOptions(y){this.options=y,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(y){this.#t.includes(y)||(this.#t.push(y),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",mutation:this,observer:y}))}removeObserver(y){this.#t=this.#t.filter(u=>u!==y),this.scheduleGc(),this.#r.notify({type:"observerRemoved",mutation:this,observer:y})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#r.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(y){const u=()=>{this.#n({type:"continue"})},g={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=createRetryer({fn:()=>this.options.mutationFn?this.options.mutationFn(y,g):Promise.reject(new Error("No mutationFn found")),onFail:(w,E)=>{this.#n({type:"failed",failureCount:w,error:E})},onPause:()=>{this.#n({type:"pause"})},onContinue:u,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#r.canRun(this)});const v=this.state.status==="pending",b=!this.#i.canStart();try{if(v)u();else{this.#n({type:"pending",variables:y,isPaused:b}),await this.#r.config.onMutate?.(y,this,g);const E=await this.options.onMutate?.(y,g);E!==this.state.context&&this.#n({type:"pending",context:E,variables:y,isPaused:b})}const w=await this.#i.start();return await this.#r.config.onSuccess?.(w,y,this.state.context,this,g),await this.options.onSuccess?.(w,y,this.state.context,g),await this.#r.config.onSettled?.(w,null,this.state.variables,this.state.context,this,g),await this.options.onSettled?.(w,null,y,this.state.context,g),this.#n({type:"success",data:w}),w}catch(w){try{throw await this.#r.config.onError?.(w,y,this.state.context,this,g),await this.options.onError?.(w,y,this.state.context,g),await this.#r.config.onSettled?.(void 0,w,this.state.variables,this.state.context,this,g),await this.options.onSettled?.(void 0,w,y,this.state.context,g),w}finally{this.#n({type:"error",error:w})}}finally{this.#r.runNext(this)}}#n(y){const u=g=>{switch(y.type){case"failed":return{...g,failureCount:y.failureCount,failureReason:y.error};case"pause":return{...g,isPaused:!0};case"continue":return{...g,isPaused:!1};case"pending":return{...g,context:y.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:y.isPaused,status:"pending",variables:y.variables,submittedAt:Date.now()};case"success":return{...g,data:y.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...g,data:void 0,error:y.error,failureCount:g.failureCount+1,failureReason:y.error,isPaused:!1,status:"error"}}};this.state=u(this.state),notifyManager.batch(()=>{this.#t.forEach(g=>{g.onMutationUpdate(y)}),this.#r.notify({mutation:this,type:"updated",action:y})})}};function getDefaultState(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var MutationCache=class extends Subscribable{constructor(y={}){super(),this.config=y,this.#e=new Set,this.#t=new Map,this.#r=0}#e;#t;#r;build(y,u,g){const v=new Mutation({client:y,mutationCache:this,mutationId:++this.#r,options:y.defaultMutationOptions(u),state:g});return this.add(v),v}add(y){this.#e.add(y);const u=scopeFor(y);if(typeof u=="string"){const g=this.#t.get(u);g?g.push(y):this.#t.set(u,[y])}this.notify({type:"added",mutation:y})}remove(y){if(this.#e.delete(y)){const u=scopeFor(y);if(typeof u=="string"){const g=this.#t.get(u);if(g)if(g.length>1){const v=g.indexOf(y);v!==-1&&g.splice(v,1)}else g[0]===y&&this.#t.delete(u)}}this.notify({type:"removed",mutation:y})}canRun(y){const u=scopeFor(y);if(typeof u=="string"){const v=this.#t.get(u)?.find(b=>b.state.status==="pending");return!v||v===y}else return!0}runNext(y){const u=scopeFor(y);return typeof u=="string"?this.#t.get(u)?.find(v=>v!==y&&v.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){notifyManager.batch(()=>{this.#e.forEach(y=>{this.notify({type:"removed",mutation:y})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(y){const u={exact:!0,...y};return this.getAll().find(g=>matchMutation(u,g))}findAll(y={}){return this.getAll().filter(u=>matchMutation(y,u))}notify(y){notifyManager.batch(()=>{this.listeners.forEach(u=>{u(y)})})}resumePausedMutations(){const y=this.getAll().filter(u=>u.state.isPaused);return notifyManager.batch(()=>Promise.all(y.map(u=>u.continue().catch(noop$2))))}};function scopeFor(y){return y.options.scope?.id}var MutationObserver$1=class extends Subscribable{#e;#t=void 0;#r;#i;constructor(u,g){super(),this.#e=u,this.setOptions(g),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(u){const g=this.options;this.options=this.#e.defaultMutationOptions(u),shallowEqualObjects(this.options,g)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),g?.mutationKey&&this.options.mutationKey&&hashKey(g.mutationKey)!==hashKey(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(u){this.#n(),this.#o(u)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#n(),this.#o()}mutate(u,g){return this.#i=g,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(u)}#n(){const u=this.#r?.state??getDefaultState();this.#t={...u,isPending:u.status==="pending",isSuccess:u.status==="success",isError:u.status==="error",isIdle:u.status==="idle",mutate:this.mutate,reset:this.reset}}#o(u){notifyManager.batch(()=>{if(this.#i&&this.hasListeners()){const g=this.#t.variables,v=this.#t.context,b={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};u?.type==="success"?(this.#i.onSuccess?.(u.data,g,v,b),this.#i.onSettled?.(u.data,null,g,v,b)):u?.type==="error"&&(this.#i.onError?.(u.error,g,v,b),this.#i.onSettled?.(void 0,u.error,g,v,b))}this.listeners.forEach(g=>{g(this.#t)})})}},QueryCache=class extends Subscribable{constructor(y={}){super(),this.config=y,this.#e=new Map}#e;build(y,u,g){const v=u.queryKey,b=u.queryHash??hashQueryKeyByOptions(v,u);let w=this.get(b);return w||(w=new Query({client:y,queryKey:v,queryHash:b,options:y.defaultQueryOptions(u),state:g,defaultOptions:y.getQueryDefaults(v)}),this.add(w)),w}add(y){this.#e.has(y.queryHash)||(this.#e.set(y.queryHash,y),this.notify({type:"added",query:y}))}remove(y){const u=this.#e.get(y.queryHash);u&&(y.destroy(),u===y&&this.#e.delete(y.queryHash),this.notify({type:"removed",query:y}))}clear(){notifyManager.batch(()=>{this.getAll().forEach(y=>{this.remove(y)})})}get(y){return this.#e.get(y)}getAll(){return[...this.#e.values()]}find(y){const u={exact:!0,...y};return this.getAll().find(g=>matchQuery(u,g))}findAll(y={}){const u=this.getAll();return Object.keys(y).length>0?u.filter(g=>matchQuery(y,g)):u}notify(y){notifyManager.batch(()=>{this.listeners.forEach(u=>{u(y)})})}onFocus(){notifyManager.batch(()=>{this.getAll().forEach(y=>{y.onFocus()})})}onOnline(){notifyManager.batch(()=>{this.getAll().forEach(y=>{y.onOnline()})})}},QueryClient=class{#e;#t;#r;#i;#n;#o;#a;#c;constructor(y={}){this.#e=y.queryCache||new QueryCache,this.#t=y.mutationCache||new MutationCache,this.#r=y.defaultOptions||{},this.#i=new Map,this.#n=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=focusManager.subscribe(async y=>{y&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#c=onlineManager.subscribe(async y=>{y&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#c?.(),this.#c=void 0)}isFetching(y){return this.#e.findAll({...y,fetchStatus:"fetching"}).length}isMutating(y){return this.#t.findAll({...y,status:"pending"}).length}getQueryData(y){const u=this.defaultQueryOptions({queryKey:y});return this.#e.get(u.queryHash)?.state.data}ensureQueryData(y){const u=this.defaultQueryOptions(y),g=this.#e.build(this,u),v=g.state.data;return v===void 0?this.fetchQuery(y):(y.revalidateIfStale&&g.isStaleByTime(resolveStaleTime(u.staleTime,g))&&this.prefetchQuery(u),Promise.resolve(v))}getQueriesData(y){return this.#e.findAll(y).map(({queryKey:u,state:g})=>{const v=g.data;return[u,v]})}setQueryData(y,u,g){const v=this.defaultQueryOptions({queryKey:y}),w=this.#e.get(v.queryHash)?.state.data,E=functionalUpdate(u,w);if(E!==void 0)return this.#e.build(this,v).setData(E,{...g,manual:!0})}setQueriesData(y,u,g){return notifyManager.batch(()=>this.#e.findAll(y).map(({queryKey:v})=>[v,this.setQueryData(v,u,g)]))}getQueryState(y){const u=this.defaultQueryOptions({queryKey:y});return this.#e.get(u.queryHash)?.state}removeQueries(y){const u=this.#e;notifyManager.batch(()=>{u.findAll(y).forEach(g=>{u.remove(g)})})}resetQueries(y,u){const g=this.#e;return notifyManager.batch(()=>(g.findAll(y).forEach(v=>{v.reset()}),this.refetchQueries({type:"active",...y},u)))}cancelQueries(y,u={}){const g={revert:!0,...u},v=notifyManager.batch(()=>this.#e.findAll(y).map(b=>b.cancel(g)));return Promise.all(v).then(noop$2).catch(noop$2)}invalidateQueries(y,u={}){return notifyManager.batch(()=>(this.#e.findAll(y).forEach(g=>{g.invalidate()}),y?.refetchType==="none"?Promise.resolve():this.refetchQueries({...y,type:y?.refetchType??y?.type??"active"},u)))}refetchQueries(y,u={}){const g={...u,cancelRefetch:u.cancelRefetch??!0},v=notifyManager.batch(()=>this.#e.findAll(y).filter(b=>!b.isDisabled()&&!b.isStatic()).map(b=>{let w=b.fetch(void 0,g);return g.throwOnError||(w=w.catch(noop$2)),b.state.fetchStatus==="paused"?Promise.resolve():w}));return Promise.all(v).then(noop$2)}fetchQuery(y){const u=this.defaultQueryOptions(y);u.retry===void 0&&(u.retry=!1);const g=this.#e.build(this,u);return g.isStaleByTime(resolveStaleTime(u.staleTime,g))?g.fetch(u):Promise.resolve(g.state.data)}prefetchQuery(y){return this.fetchQuery(y).then(noop$2).catch(noop$2)}fetchInfiniteQuery(y){return y.behavior=infiniteQueryBehavior(y.pages),this.fetchQuery(y)}prefetchInfiniteQuery(y){return this.fetchInfiniteQuery(y).then(noop$2).catch(noop$2)}ensureInfiniteQueryData(y){return y.behavior=infiniteQueryBehavior(y.pages),this.ensureQueryData(y)}resumePausedMutations(){return onlineManager.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#r}setDefaultOptions(y){this.#r=y}setQueryDefaults(y,u){this.#i.set(hashKey(y),{queryKey:y,defaultOptions:u})}getQueryDefaults(y){const u=[...this.#i.values()],g={};return u.forEach(v=>{partialMatchKey(y,v.queryKey)&&Object.assign(g,v.defaultOptions)}),g}setMutationDefaults(y,u){this.#n.set(hashKey(y),{mutationKey:y,defaultOptions:u})}getMutationDefaults(y){const u=[...this.#n.values()],g={};return u.forEach(v=>{partialMatchKey(y,v.mutationKey)&&Object.assign(g,v.defaultOptions)}),g}defaultQueryOptions(y){if(y._defaulted)return y;const u={...this.#r.queries,...this.getQueryDefaults(y.queryKey),...y,_defaulted:!0};return u.queryHash||(u.queryHash=hashQueryKeyByOptions(u.queryKey,u)),u.refetchOnReconnect===void 0&&(u.refetchOnReconnect=u.networkMode!=="always"),u.throwOnError===void 0&&(u.throwOnError=!!u.suspense),!u.networkMode&&u.persister&&(u.networkMode="offlineFirst"),u.queryFn===skipToken&&(u.enabled=!1),u}defaultMutationOptions(y){return y?._defaulted?y:{...this.#r.mutations,...y?.mutationKey&&this.getMutationDefaults(y.mutationKey),...y,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},QueryClientContext=reactExports.createContext(void 0),useQueryClient=y=>{const u=reactExports.useContext(QueryClientContext);if(!u)throw new Error("No QueryClient set, use QueryClientProvider to set one");return u},QueryClientProvider=({client:y,children:u})=>(reactExports.useEffect(()=>(y.mount(),()=>{y.unmount()}),[y]),jsxRuntimeExports.jsx(QueryClientContext.Provider,{value:y,children:u})),IsRestoringContext=reactExports.createContext(!1),useIsRestoring=()=>reactExports.useContext(IsRestoringContext);IsRestoringContext.Provider;function createValue(){let y=!1;return{clearReset:()=>{y=!1},reset:()=>{y=!0},isReset:()=>y}}var QueryErrorResetBoundaryContext=reactExports.createContext(createValue()),useQueryErrorResetBoundary=()=>reactExports.useContext(QueryErrorResetBoundaryContext),ensurePreventErrorBoundaryRetry=(y,u)=>{(y.suspense||y.throwOnError||y.experimental_prefetchInRender)&&(u.isReset()||(y.retryOnMount=!1))},useClearResetErrorBoundary=y=>{reactExports.useEffect(()=>{y.clearReset()},[y])},getHasError=({result:y,errorResetBoundary:u,throwOnError:g,query:v,suspense:b})=>y.isError&&!u.isReset()&&!y.isFetching&&v&&(b&&y.data===void 0||shouldThrowError(g,[y.error,v])),ensureSuspenseTimers=y=>{if(y.suspense){const g=b=>b==="static"?b:Math.max(b??1e3,1e3),v=y.staleTime;y.staleTime=typeof v=="function"?(...b)=>g(v(...b)):g(v),typeof y.gcTime=="number"&&(y.gcTime=Math.max(y.gcTime,1e3))}},willFetch=(y,u)=>y.isLoading&&y.isFetching&&!u,shouldSuspend=(y,u)=>y?.suspense&&u.isPending,fetchOptimistic=(y,u,g)=>u.fetchOptimistic(y).catch(()=>{g.clearReset()});function useBaseQuery(y,u,g){const v=useIsRestoring(),b=useQueryErrorResetBoundary(),w=useQueryClient(),E=w.defaultQueryOptions(y);w.getDefaultOptions().queries?._experimental_beforeQuery?.(E),E._optimisticResults=v?"isRestoring":"optimistic",ensureSuspenseTimers(E),ensurePreventErrorBoundaryRetry(E,b),useClearResetErrorBoundary(b);const S=!w.getQueryCache().get(E.queryHash),[A]=reactExports.useState(()=>new u(w,E)),$=A.getOptimisticResult(E),R=!v&&y.subscribed!==!1;if(reactExports.useSyncExternalStore(reactExports.useCallback(T=>{const O=R?A.subscribe(notifyManager.batchCalls(T)):noop$2;return A.updateResult(),O},[A,R]),()=>A.getCurrentResult(),()=>A.getCurrentResult()),reactExports.useEffect(()=>{A.setOptions(E)},[E,A]),shouldSuspend(E,$))throw fetchOptimistic(E,A,b);if(getHasError({result:$,errorResetBoundary:b,throwOnError:E.throwOnError,query:w.getQueryCache().get(E.queryHash),suspense:E.suspense}))throw $.error;return w.getDefaultOptions().queries?._experimental_afterQuery?.(E,$),E.experimental_prefetchInRender&&!isServer$1&&willFetch($,v)&&(S?fetchOptimistic(E,A,b):w.getQueryCache().get(E.queryHash)?.promise)?.catch(noop$2).finally(()=>{A.updateResult()}),E.notifyOnChangeProps?$:A.trackResult($)}function useQuery(y,u){return useBaseQuery(y,QueryObserver)}function useMutation(y,u){const g=useQueryClient(),[v]=reactExports.useState(()=>new MutationObserver$1(g,y));reactExports.useEffect(()=>{v.setOptions(y)},[v,y]);const b=reactExports.useSyncExternalStore(reactExports.useCallback(E=>v.subscribe(notifyManager.batchCalls(E)),[v]),()=>v.getCurrentResult(),()=>v.getCurrentResult()),w=reactExports.useCallback((E,S)=>{v.mutate(E,S).catch(noop$2)},[v]);if(b.error&&shouldThrowError(v.options.throwOnError,[b.error]))throw b.error;return{...b,mutate:w,mutateAsync:b.mutate}}const THEME_QUERY_KEY=["theme"];function getStoredTheme(){if(typeof window>"u")return"dark";const y=localStorage.getItem(STORAGE_KEYS.THEME);return y==="light"||y==="dark"?y:window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}function applyTheme(y){const u=document.documentElement;y==="dark"?(u.classList.add("dark"),u.classList.remove("light")):(u.classList.add("light"),u.classList.remove("dark"));const g=document.querySelector('meta[name="theme-color"]');g&&g.setAttribute("content",y==="dark"?"#0a0a0a":"#f5f5f5")}function useTheme(){const y=useQueryClient(),{data:u="dark"}=useQuery({queryKey:THEME_QUERY_KEY,queryFn:getStoredTheme,staleTime:1/0,gcTime:1/0});reactExports.useEffect(()=>{applyTheme(u)},[u]),reactExports.useEffect(()=>{const b=window.matchMedia("(prefers-color-scheme: dark)"),w=E=>{if(!localStorage.getItem(STORAGE_KEYS.THEME)){const A=E.matches?"dark":"light";y.setQueryData(THEME_QUERY_KEY,A)}};return b.addEventListener("change",w),()=>b.removeEventListener("change",w)},[y]);const g=reactExports.useCallback(b=>{localStorage.setItem(STORAGE_KEYS.THEME,b),y.setQueryData(THEME_QUERY_KEY,b),applyTheme(b)},[y]),v=reactExports.useCallback(()=>{g(u==="dark"?"light":"dark")},[u,g]);return{theme:u,setTheme:g,toggleTheme:v,isDark:u==="dark",isLight:u==="light"}}function ThemeToggle(){const{isDark:y,toggleTheme:u}=useTheme();return jsxRuntimeExports.jsxs(motion.button,{onClick:u,whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},transition:{duration:.05},className:"relative p-2 sm:p-2.5 lg:p-3 rounded-lg sm:rounded-xl transition-all group bg-transparent hover:bg-theme-bg-tertiary dark:hover:bg-neutral-800/80","aria-label":y?"Switch to light mode":"Switch to dark mode",children:[jsxRuntimeExports.jsxs("div",{className:"relative w-4 h-4 sm:w-5 sm:h-5",children:[jsxRuntimeExports.jsx(motion.div,{initial:!1,animate:{scale:y?1:0,opacity:y?1:0,rotate:y?0:180},transition:{duration:.2},className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx(Moon,{className:"w-4 h-4 sm:w-5 sm:h-5 text-theme-text-secondary group-hover:text-orange-400 transition-colors"})}),jsxRuntimeExports.jsx(motion.div,{initial:!1,animate:{scale:y?0:1,opacity:y?0:1,rotate:y?-180:0},transition:{duration:.2},className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx(Sun,{className:"w-4 h-4 sm:w-5 sm:h-5 text-theme-text-secondary group-hover:text-orange-400 transition-colors"})})]}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-lg sm:rounded-xl bg-orange-500/0 group-hover:bg-orange-500/10 transition-colors"})]})}function ThemeInitializer({children:y}){const{theme:u}=useTheme();return reactExports.useEffect(()=>{document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add(u)},[u]),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:y})}const logoUrl="/sphere/dev/Union.svg",DiscordIcon$1=({className:y})=>jsxRuntimeExports.jsx("svg",{className:y,viewBox:"0 0 24 24",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"})});function Header(){return jsxRuntimeExports.jsxs("header",{className:"border-b border-neutral-200 dark:border-neutral-800/50 bg-white/80 dark:bg-neutral-900/80 backdrop-blur-2xl sticky top-0 z-50 overflow-hidden theme-transition",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 left-0 w-96 h-full bg-linear-to-r from-orange-500/5 dark:from-orange-500/10 to-transparent blur-3xl"}),jsxRuntimeExports.jsx("div",{className:"absolute top-0 right-0 w-96 h-full bg-linear-to-l from-purple-500/5 dark:from-purple-500/10 to-transparent blur-3xl"}),jsxRuntimeExports.jsx("div",{className:"absolute top-0 left-0 right-0 h-0.5 bg-linear-to-r from-transparent via-orange-500 to-transparent opacity-50"}),jsxRuntimeExports.jsxs("div",{className:"max-w-[1800px] mx-auto px-3 sm:px-6 lg:px-8 h-14 sm:h-14 lg:h-14 flex items-center justify-between relative z-10",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 lg:gap-4",children:[jsxRuntimeExports.jsx(motion.div,{whileHover:{scale:1.05,rotate:5},className:"relative",children:jsxRuntimeExports.jsx("img",{src:logoUrl,alt:"Logo",className:"relative z-10 w-7 h-7 sm:w-9 sm:h-9 lg:w-11 lg:h-11"})}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[jsxRuntimeExports.jsx("h1",{className:"text-base sm:text-lg lg:text-xl text-neutral-900 dark:text-white bg-clip-text",children:"AgentSphere"}),jsxRuntimeExports.jsx(Sparkles,{className:"w-3 h-3 sm:w-4 sm:h-4 text-orange-500 animate-pulse"}),isMock()]}),jsxRuntimeExports.jsx("p",{className:"text-[10px] sm:text-xs text-neutral-500 dark:text-neutral-400",children:"AI-Powered Agent Platform"}),jsxRuntimeExports.jsx("div",{className:"absolute -bottom-1 left-0 w-16 sm:w-20 h-0.5 bg-linear-to-r from-orange-500 to-transparent rounded-full"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 lg:gap-3",children:[jsxRuntimeExports.jsxs(motion.a,{href:"https://github.com/unicitynetwork",target:"_blank",rel:"noopener noreferrer",whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},transition:{duration:.05},className:"relative p-2 sm:p-2.5 lg:p-3 hover:bg-neutral-100 dark:hover:bg-neutral-800/80 rounded-lg sm:rounded-xl transition-all group",children:[jsxRuntimeExports.jsx(Github,{className:"w-4 h-4 sm:w-5 sm:h-5 text-neutral-500 dark:text-neutral-400 group-hover:text-orange-400 transition-colors"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-lg sm:rounded-xl bg-orange-500/0 group-hover:bg-orange-500/10 transition-colors"})]}),jsxRuntimeExports.jsxs(motion.a,{href:"https://discord.gg/S9f57ZKdt",target:"_blank",rel:"noopener noreferrer",whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},transition:{duration:.05},className:"relative p-2 sm:p-2.5 lg:p-3 hover:bg-neutral-100 dark:hover:bg-neutral-800/80 rounded-lg sm:rounded-xl transition-all group",children:[jsxRuntimeExports.jsx(DiscordIcon$1,{className:"w-4 h-4 sm:w-5 sm:h-5 text-neutral-500 dark:text-neutral-400 group-hover:text-orange-400 transition-colors"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-lg sm:rounded-xl bg-orange-500/0 group-hover:bg-orange-500/10 transition-colors"})]}),jsxRuntimeExports.jsx(ThemeToggle,{})]})]}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-px bg-linear-to-r from-transparent via-neutral-300 dark:via-neutral-700 to-transparent"})]})}function DashboardLayout(){return jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col bg-neutral-100 dark:bg-linear-to-br dark:from-neutral-950 dark:via-neutral-900 dark:to-neutral-950 theme-transition lg:overflow-auto",children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-h-0 max-w-[1800px] w-full mx-auto px-4 pt-4 pb-0 md:p-8 lg:pb-8",children:jsxRuntimeExports.jsx(Outlet,{})})]})}const scriptRel="modulepreload",assetsURL=function(y){return"/sphere/dev/"+y},seen={},__vitePreload=function(u,g,v){let b=Promise.resolve();if(g&&g.length>0){let A=function($){return Promise.all($.map(R=>Promise.resolve(R).then(T=>({status:"fulfilled",value:T}),T=>({status:"rejected",reason:T}))))};document.getElementsByTagName("link");const E=document.querySelector("meta[property=csp-nonce]"),S=E?.nonce||E?.getAttribute("nonce");b=A(g.map($=>{if($=assetsURL($),$ in seen)return;seen[$]=!0;const R=$.endsWith(".css"),T=R?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${$}"]${T}`))return;const O=document.createElement("link");if(O.rel=R?"stylesheet":scriptRel,R||(O.as="script"),O.crossOrigin="",O.href=$,S&&O.setAttribute("nonce",S),document.head.appendChild(O),R)return new Promise((B,F)=>{O.addEventListener("load",B),O.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${$}`)))})}))}function w(E){const S=new Event("vite:preloadError",{cancelable:!0});if(S.payload=E,window.dispatchEvent(S),!S.defaultPrevented)throw E}return b.then(E=>{for(const S of E||[])S.status==="rejected"&&w(S.reason);return u().catch(w)})};var buffer$2={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup$1=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code$7="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$2=0,len=code$7.length;i$2<len;++i$2)lookup$1[i$2]=code$7[i$2],revLookup[code$7.charCodeAt(i$2)]=i$2;revLookup[45]=62;revLookup[95]=63;function getLens(y){var u=y.length;if(u%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var g=y.indexOf("=");g===-1&&(g=u);var v=g===u?0:4-g%4;return[g,v]}function byteLength(y){var u=getLens(y),g=u[0],v=u[1];return(g+v)*3/4-v}function _byteLength(y,u,g){return(u+g)*3/4-g}function toByteArray(y){var u,g=getLens(y),v=g[0],b=g[1],w=new Arr(_byteLength(y,v,b)),E=0,S=b>0?v-4:v,A;for(A=0;A<S;A+=4)u=revLookup[y.charCodeAt(A)]<<18|revLookup[y.charCodeAt(A+1)]<<12|revLookup[y.charCodeAt(A+2)]<<6|revLookup[y.charCodeAt(A+3)],w[E++]=u>>16&255,w[E++]=u>>8&255,w[E++]=u&255;return b===2&&(u=revLookup[y.charCodeAt(A)]<<2|revLookup[y.charCodeAt(A+1)]>>4,w[E++]=u&255),b===1&&(u=revLookup[y.charCodeAt(A)]<<10|revLookup[y.charCodeAt(A+1)]<<4|revLookup[y.charCodeAt(A+2)]>>2,w[E++]=u>>8&255,w[E++]=u&255),w}function tripletToBase64(y){return lookup$1[y>>18&63]+lookup$1[y>>12&63]+lookup$1[y>>6&63]+lookup$1[y&63]}function encodeChunk(y,u,g){for(var v,b=[],w=u;w<g;w+=3)v=(y[w]<<16&16711680)+(y[w+1]<<8&65280)+(y[w+2]&255),b.push(tripletToBase64(v));return b.join("")}function fromByteArray(y){for(var u,g=y.length,v=g%3,b=[],w=16383,E=0,S=g-v;E<S;E+=w)b.push(encodeChunk(y,E,E+w>S?S:E+w));return v===1?(u=y[g-1],b.push(lookup$1[u>>2]+lookup$1[u<<4&63]+"==")):v===2&&(u=(y[g-2]<<8)+y[g-1],b.push(lookup$1[u>>10]+lookup$1[u>>4&63]+lookup$1[u<<2&63]+"=")),b.join("")}var ieee754={};ieee754.read=function(y,u,g,v,b){var w,E,S=b*8-v-1,A=(1<<S)-1,$=A>>1,R=-7,T=g?b-1:0,O=g?-1:1,B=y[u+T];for(T+=O,w=B&(1<<-R)-1,B>>=-R,R+=S;R>0;w=w*256+y[u+T],T+=O,R-=8);for(E=w&(1<<-R)-1,w>>=-R,R+=v;R>0;E=E*256+y[u+T],T+=O,R-=8);if(w===0)w=1-$;else{if(w===A)return E?NaN:(B?-1:1)*(1/0);E=E+Math.pow(2,v),w=w-$}return(B?-1:1)*E*Math.pow(2,w-v)};ieee754.write=function(y,u,g,v,b,w){var E,S,A,$=w*8-b-1,R=(1<<$)-1,T=R>>1,O=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=v?0:w-1,F=v?1:-1,U=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(S=isNaN(u)?1:0,E=R):(E=Math.floor(Math.log(u)/Math.LN2),u*(A=Math.pow(2,-E))<1&&(E--,A*=2),E+T>=1?u+=O/A:u+=O*Math.pow(2,1-T),u*A>=2&&(E++,A/=2),E+T>=R?(S=0,E=R):E+T>=1?(S=(u*A-1)*Math.pow(2,b),E=E+T):(S=u*Math.pow(2,T-1)*Math.pow(2,b),E=0));b>=8;y[g+B]=S&255,B+=F,S/=256,b-=8);for(E=E<<b|S,$+=b;$>0;y[g+B]=E&255,B+=F,E/=256,$-=8);y[g+B-F]|=U*128};(function(y){const u=base64Js,g=ieee754,v=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;y.Buffer=R,y.SlowBuffer=de,y.INSPECT_MAX_BYTES=50;const b=2147483647;y.kMaxLength=b;const{Uint8Array:w,ArrayBuffer:E,SharedArrayBuffer:S}=globalThis;R.TYPED_ARRAY_SUPPORT=A(),!R.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function A(){try{const Me=new w(1),Ce={foo:function(){return 42}};return Object.setPrototypeOf(Ce,w.prototype),Object.setPrototypeOf(Me,Ce),Me.foo()===42}catch{return!1}}Object.defineProperty(R.prototype,"parent",{enumerable:!0,get:function(){if(R.isBuffer(this))return this.buffer}}),Object.defineProperty(R.prototype,"offset",{enumerable:!0,get:function(){if(R.isBuffer(this))return this.byteOffset}});function $(Me){if(Me>b)throw new RangeError('The value "'+Me+'" is invalid for option "size"');const Ce=new w(Me);return Object.setPrototypeOf(Ce,R.prototype),Ce}function R(Me,Ce,Ee){if(typeof Me=="number"){if(typeof Ce=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return F(Me)}return T(Me,Ce,Ee)}R.poolSize=8192;function T(Me,Ce,Ee){if(typeof Me=="string")return U(Me,Ce);if(E.isView(Me))return J(Me);if(Me==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Me);if(vt(Me,E)||Me&&vt(Me.buffer,E)||typeof S<"u"&&(vt(Me,S)||Me&&vt(Me.buffer,S)))return ie(Me,Ce,Ee);if(typeof Me=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const Pe=Me.valueOf&&Me.valueOf();if(Pe!=null&&Pe!==Me)return R.from(Pe,Ce,Ee);const je=oe(Me);if(je)return je;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Me[Symbol.toPrimitive]=="function")return R.from(Me[Symbol.toPrimitive]("string"),Ce,Ee);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Me)}R.from=function(Me,Ce,Ee){return T(Me,Ce,Ee)},Object.setPrototypeOf(R.prototype,w.prototype),Object.setPrototypeOf(R,w);function O(Me){if(typeof Me!="number")throw new TypeError('"size" argument must be of type number');if(Me<0)throw new RangeError('The value "'+Me+'" is invalid for option "size"')}function B(Me,Ce,Ee){return O(Me),Me<=0?$(Me):Ce!==void 0?typeof Ee=="string"?$(Me).fill(Ce,Ee):$(Me).fill(Ce):$(Me)}R.alloc=function(Me,Ce,Ee){return B(Me,Ce,Ee)};function F(Me){return O(Me),$(Me<0?0:le(Me)|0)}R.allocUnsafe=function(Me){return F(Me)},R.allocUnsafeSlow=function(Me){return F(Me)};function U(Me,Ce){if((typeof Ce!="string"||Ce==="")&&(Ce="utf8"),!R.isEncoding(Ce))throw new TypeError("Unknown encoding: "+Ce);const Ee=fe(Me,Ce)|0;let Pe=$(Ee);const je=Pe.write(Me,Ce);return je!==Ee&&(Pe=Pe.slice(0,je)),Pe}function q(Me){const Ce=Me.length<0?0:le(Me.length)|0,Ee=$(Ce);for(let Pe=0;Pe<Ce;Pe+=1)Ee[Pe]=Me[Pe]&255;return Ee}function J(Me){if(vt(Me,w)){const Ce=new w(Me);return ie(Ce.buffer,Ce.byteOffset,Ce.byteLength)}return q(Me)}function ie(Me,Ce,Ee){if(Ce<0||Me.byteLength<Ce)throw new RangeError('"offset" is outside of buffer bounds');if(Me.byteLength<Ce+(Ee||0))throw new RangeError('"length" is outside of buffer bounds');let Pe;return Ce===void 0&&Ee===void 0?Pe=new w(Me):Ee===void 0?Pe=new w(Me,Ce):Pe=new w(Me,Ce,Ee),Object.setPrototypeOf(Pe,R.prototype),Pe}function oe(Me){if(R.isBuffer(Me)){const Ce=le(Me.length)|0,Ee=$(Ce);return Ee.length===0||Me.copy(Ee,0,0,Ce),Ee}if(Me.length!==void 0)return typeof Me.length!="number"||bt(Me.length)?$(0):q(Me);if(Me.type==="Buffer"&&Array.isArray(Me.data))return q(Me.data)}function le(Me){if(Me>=b)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+b.toString(16)+" bytes");return Me|0}function de(Me){return+Me!=Me&&(Me=0),R.alloc(+Me)}R.isBuffer=function(Ce){return Ce!=null&&Ce._isBuffer===!0&&Ce!==R.prototype},R.compare=function(Ce,Ee){if(vt(Ce,w)&&(Ce=R.from(Ce,Ce.offset,Ce.byteLength)),vt(Ee,w)&&(Ee=R.from(Ee,Ee.offset,Ee.byteLength)),!R.isBuffer(Ce)||!R.isBuffer(Ee))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(Ce===Ee)return 0;let Pe=Ce.length,je=Ee.length;for(let He=0,Ve=Math.min(Pe,je);He<Ve;++He)if(Ce[He]!==Ee[He]){Pe=Ce[He],je=Ee[He];break}return Pe<je?-1:je<Pe?1:0},R.isEncoding=function(Ce){switch(String(Ce).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},R.concat=function(Ce,Ee){if(!Array.isArray(Ce))throw new TypeError('"list" argument must be an Array of Buffers');if(Ce.length===0)return R.alloc(0);let Pe;if(Ee===void 0)for(Ee=0,Pe=0;Pe<Ce.length;++Pe)Ee+=Ce[Pe].length;const je=R.allocUnsafe(Ee);let He=0;for(Pe=0;Pe<Ce.length;++Pe){let Ve=Ce[Pe];if(vt(Ve,w))He+Ve.length>je.length?(R.isBuffer(Ve)||(Ve=R.from(Ve)),Ve.copy(je,He)):w.prototype.set.call(je,Ve,He);else if(R.isBuffer(Ve))Ve.copy(je,He);else throw new TypeError('"list" argument must be an Array of Buffers');He+=Ve.length}return je};function fe(Me,Ce){if(R.isBuffer(Me))return Me.length;if(E.isView(Me)||vt(Me,E))return Me.byteLength;if(typeof Me!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Me);const Ee=Me.length,Pe=arguments.length>2&&arguments[2]===!0;if(!Pe&&Ee===0)return 0;let je=!1;for(;;)switch(Ce){case"ascii":case"latin1":case"binary":return Ee;case"utf8":case"utf-8":return et(Me).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ee*2;case"hex":return Ee>>>1;case"base64":return ut(Me).length;default:if(je)return Pe?-1:et(Me).length;Ce=(""+Ce).toLowerCase(),je=!0}}R.byteLength=fe;function ye(Me,Ce,Ee){let Pe=!1;if((Ce===void 0||Ce<0)&&(Ce=0),Ce>this.length||((Ee===void 0||Ee>this.length)&&(Ee=this.length),Ee<=0)||(Ee>>>=0,Ce>>>=0,Ee<=Ce))return"";for(Me||(Me="utf8");;)switch(Me){case"hex":return Z(this,Ce,Ee);case"utf8":case"utf-8":return Y(this,Ce,Ee);case"ascii":return se(this,Ce,Ee);case"latin1":case"binary":return ee(this,Ce,Ee);case"base64":return re(this,Ce,Ee);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ue(this,Ce,Ee);default:if(Pe)throw new TypeError("Unknown encoding: "+Me);Me=(Me+"").toLowerCase(),Pe=!0}}R.prototype._isBuffer=!0;function we(Me,Ce,Ee){const Pe=Me[Ce];Me[Ce]=Me[Ee],Me[Ee]=Pe}R.prototype.swap16=function(){const Ce=this.length;if(Ce%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let Ee=0;Ee<Ce;Ee+=2)we(this,Ee,Ee+1);return this},R.prototype.swap32=function(){const Ce=this.length;if(Ce%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let Ee=0;Ee<Ce;Ee+=4)we(this,Ee,Ee+3),we(this,Ee+1,Ee+2);return this},R.prototype.swap64=function(){const Ce=this.length;if(Ce%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let Ee=0;Ee<Ce;Ee+=8)we(this,Ee,Ee+7),we(this,Ee+1,Ee+6),we(this,Ee+2,Ee+5),we(this,Ee+3,Ee+4);return this},R.prototype.toString=function(){const Ce=this.length;return Ce===0?"":arguments.length===0?Y(this,0,Ce):ye.apply(this,arguments)},R.prototype.toLocaleString=R.prototype.toString,R.prototype.equals=function(Ce){if(!R.isBuffer(Ce))throw new TypeError("Argument must be a Buffer");return this===Ce?!0:R.compare(this,Ce)===0},R.prototype.inspect=function(){let Ce="";const Ee=y.INSPECT_MAX_BYTES;return Ce=this.toString("hex",0,Ee).replace(/(.{2})/g,"$1 ").trim(),this.length>Ee&&(Ce+=" ... "),"<Buffer "+Ce+">"},v&&(R.prototype[v]=R.prototype.inspect),R.prototype.compare=function(Ce,Ee,Pe,je,He){if(vt(Ce,w)&&(Ce=R.from(Ce,Ce.offset,Ce.byteLength)),!R.isBuffer(Ce))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof Ce);if(Ee===void 0&&(Ee=0),Pe===void 0&&(Pe=Ce?Ce.length:0),je===void 0&&(je=0),He===void 0&&(He=this.length),Ee<0||Pe>Ce.length||je<0||He>this.length)throw new RangeError("out of range index");if(je>=He&&Ee>=Pe)return 0;if(je>=He)return-1;if(Ee>=Pe)return 1;if(Ee>>>=0,Pe>>>=0,je>>>=0,He>>>=0,this===Ce)return 0;let Ve=He-je,dt=Pe-Ee;const xt=Math.min(Ve,dt),mt=this.slice(je,He),gt=Ce.slice(Ee,Pe);for(let at=0;at<xt;++at)if(mt[at]!==gt[at]){Ve=mt[at],dt=gt[at];break}return Ve<dt?-1:dt<Ve?1:0};function pe(Me,Ce,Ee,Pe,je){if(Me.length===0)return-1;if(typeof Ee=="string"?(Pe=Ee,Ee=0):Ee>2147483647?Ee=2147483647:Ee<-2147483648&&(Ee=-2147483648),Ee=+Ee,bt(Ee)&&(Ee=je?0:Me.length-1),Ee<0&&(Ee=Me.length+Ee),Ee>=Me.length){if(je)return-1;Ee=Me.length-1}else if(Ee<0)if(je)Ee=0;else return-1;if(typeof Ce=="string"&&(Ce=R.from(Ce,Pe)),R.isBuffer(Ce))return Ce.length===0?-1:ve(Me,Ce,Ee,Pe,je);if(typeof Ce=="number")return Ce=Ce&255,typeof w.prototype.indexOf=="function"?je?w.prototype.indexOf.call(Me,Ce,Ee):w.prototype.lastIndexOf.call(Me,Ce,Ee):ve(Me,[Ce],Ee,Pe,je);throw new TypeError("val must be string, number or Buffer")}function ve(Me,Ce,Ee,Pe,je){let He=1,Ve=Me.length,dt=Ce.length;if(Pe!==void 0&&(Pe=String(Pe).toLowerCase(),Pe==="ucs2"||Pe==="ucs-2"||Pe==="utf16le"||Pe==="utf-16le")){if(Me.length<2||Ce.length<2)return-1;He=2,Ve/=2,dt/=2,Ee/=2}function xt(gt,at){return He===1?gt[at]:gt.readUInt16BE(at*He)}let mt;if(je){let gt=-1;for(mt=Ee;mt<Ve;mt++)if(xt(Me,mt)===xt(Ce,gt===-1?0:mt-gt)){if(gt===-1&&(gt=mt),mt-gt+1===dt)return gt*He}else gt!==-1&&(mt-=mt-gt),gt=-1}else for(Ee+dt>Ve&&(Ee=Ve-dt),mt=Ee;mt>=0;mt--){let gt=!0;for(let at=0;at<dt;at++)if(xt(Me,mt+at)!==xt(Ce,at)){gt=!1;break}if(gt)return mt}return-1}R.prototype.includes=function(Ce,Ee,Pe){return this.indexOf(Ce,Ee,Pe)!==-1},R.prototype.indexOf=function(Ce,Ee,Pe){return pe(this,Ce,Ee,Pe,!0)},R.prototype.lastIndexOf=function(Ce,Ee,Pe){return pe(this,Ce,Ee,Pe,!1)};function he(Me,Ce,Ee,Pe){Ee=Number(Ee)||0;const je=Me.length-Ee;Pe?(Pe=Number(Pe),Pe>je&&(Pe=je)):Pe=je;const He=Ce.length;Pe>He/2&&(Pe=He/2);let Ve;for(Ve=0;Ve<Pe;++Ve){const dt=parseInt(Ce.substr(Ve*2,2),16);if(bt(dt))return Ve;Me[Ee+Ve]=dt}return Ve}function ae(Me,Ce,Ee,Pe){return ot(et(Ce,Me.length-Ee),Me,Ee,Pe)}function Q(Me,Ce,Ee,Pe){return ot(Ze(Ce),Me,Ee,Pe)}function j(Me,Ce,Ee,Pe){return ot(ut(Ce),Me,Ee,Pe)}function z(Me,Ce,Ee,Pe){return ot(nt(Ce,Me.length-Ee),Me,Ee,Pe)}R.prototype.write=function(Ce,Ee,Pe,je){if(Ee===void 0)je="utf8",Pe=this.length,Ee=0;else if(Pe===void 0&&typeof Ee=="string")je=Ee,Pe=this.length,Ee=0;else if(isFinite(Ee))Ee=Ee>>>0,isFinite(Pe)?(Pe=Pe>>>0,je===void 0&&(je="utf8")):(je=Pe,Pe=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const He=this.length-Ee;if((Pe===void 0||Pe>He)&&(Pe=He),Ce.length>0&&(Pe<0||Ee<0)||Ee>this.length)throw new RangeError("Attempt to write outside buffer bounds");je||(je="utf8");let Ve=!1;for(;;)switch(je){case"hex":return he(this,Ce,Ee,Pe);case"utf8":case"utf-8":return ae(this,Ce,Ee,Pe);case"ascii":case"latin1":case"binary":return Q(this,Ce,Ee,Pe);case"base64":return j(this,Ce,Ee,Pe);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,Ce,Ee,Pe);default:if(Ve)throw new TypeError("Unknown encoding: "+je);je=(""+je).toLowerCase(),Ve=!0}},R.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function re(Me,Ce,Ee){return Ce===0&&Ee===Me.length?u.fromByteArray(Me):u.fromByteArray(Me.slice(Ce,Ee))}function Y(Me,Ce,Ee){Ee=Math.min(Me.length,Ee);const Pe=[];let je=Ce;for(;je<Ee;){const He=Me[je];let Ve=null,dt=He>239?4:He>223?3:He>191?2:1;if(je+dt<=Ee){let xt,mt,gt,at;switch(dt){case 1:He<128&&(Ve=He);break;case 2:xt=Me[je+1],(xt&192)===128&&(at=(He&31)<<6|xt&63,at>127&&(Ve=at));break;case 3:xt=Me[je+1],mt=Me[je+2],(xt&192)===128&&(mt&192)===128&&(at=(He&15)<<12|(xt&63)<<6|mt&63,at>2047&&(at<55296||at>57343)&&(Ve=at));break;case 4:xt=Me[je+1],mt=Me[je+2],gt=Me[je+3],(xt&192)===128&&(mt&192)===128&&(gt&192)===128&&(at=(He&15)<<18|(xt&63)<<12|(mt&63)<<6|gt&63,at>65535&&at<1114112&&(Ve=at))}}Ve===null?(Ve=65533,dt=1):Ve>65535&&(Ve-=65536,Pe.push(Ve>>>10&1023|55296),Ve=56320|Ve&1023),Pe.push(Ve),je+=dt}return ne(Pe)}const te=4096;function ne(Me){const Ce=Me.length;if(Ce<=te)return String.fromCharCode.apply(String,Me);let Ee="",Pe=0;for(;Pe<Ce;)Ee+=String.fromCharCode.apply(String,Me.slice(Pe,Pe+=te));return Ee}function se(Me,Ce,Ee){let Pe="";Ee=Math.min(Me.length,Ee);for(let je=Ce;je<Ee;++je)Pe+=String.fromCharCode(Me[je]&127);return Pe}function ee(Me,Ce,Ee){let Pe="";Ee=Math.min(Me.length,Ee);for(let je=Ce;je<Ee;++je)Pe+=String.fromCharCode(Me[je]);return Pe}function Z(Me,Ce,Ee){const Pe=Me.length;(!Ce||Ce<0)&&(Ce=0),(!Ee||Ee<0||Ee>Pe)&&(Ee=Pe);let je="";for(let He=Ce;He<Ee;++He)je+=lt[Me[He]];return je}function ue(Me,Ce,Ee){const Pe=Me.slice(Ce,Ee);let je="";for(let He=0;He<Pe.length-1;He+=2)je+=String.fromCharCode(Pe[He]+Pe[He+1]*256);return je}R.prototype.slice=function(Ce,Ee){const Pe=this.length;Ce=~~Ce,Ee=Ee===void 0?Pe:~~Ee,Ce<0?(Ce+=Pe,Ce<0&&(Ce=0)):Ce>Pe&&(Ce=Pe),Ee<0?(Ee+=Pe,Ee<0&&(Ee=0)):Ee>Pe&&(Ee=Pe),Ee<Ce&&(Ee=Ce);const je=this.subarray(Ce,Ee);return Object.setPrototypeOf(je,R.prototype),je};function _e(Me,Ce,Ee){if(Me%1!==0||Me<0)throw new RangeError("offset is not uint");if(Me+Ce>Ee)throw new RangeError("Trying to access beyond buffer length")}R.prototype.readUintLE=R.prototype.readUIntLE=function(Ce,Ee,Pe){Ce=Ce>>>0,Ee=Ee>>>0,Pe||_e(Ce,Ee,this.length);let je=this[Ce],He=1,Ve=0;for(;++Ve<Ee&&(He*=256);)je+=this[Ce+Ve]*He;return je},R.prototype.readUintBE=R.prototype.readUIntBE=function(Ce,Ee,Pe){Ce=Ce>>>0,Ee=Ee>>>0,Pe||_e(Ce,Ee,this.length);let je=this[Ce+--Ee],He=1;for(;Ee>0&&(He*=256);)je+=this[Ce+--Ee]*He;return je},R.prototype.readUint8=R.prototype.readUInt8=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,1,this.length),this[Ce]},R.prototype.readUint16LE=R.prototype.readUInt16LE=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,2,this.length),this[Ce]|this[Ce+1]<<8},R.prototype.readUint16BE=R.prototype.readUInt16BE=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,2,this.length),this[Ce]<<8|this[Ce+1]},R.prototype.readUint32LE=R.prototype.readUInt32LE=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,4,this.length),(this[Ce]|this[Ce+1]<<8|this[Ce+2]<<16)+this[Ce+3]*16777216},R.prototype.readUint32BE=R.prototype.readUInt32BE=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,4,this.length),this[Ce]*16777216+(this[Ce+1]<<16|this[Ce+2]<<8|this[Ce+3])},R.prototype.readBigUInt64LE=kt(function(Ce){Ce=Ce>>>0,Ke(Ce,"offset");const Ee=this[Ce],Pe=this[Ce+7];(Ee===void 0||Pe===void 0)&&Ge(Ce,this.length-8);const je=Ee+this[++Ce]*2**8+this[++Ce]*2**16+this[++Ce]*2**24,He=this[++Ce]+this[++Ce]*2**8+this[++Ce]*2**16+Pe*2**24;return BigInt(je)+(BigInt(He)<<BigInt(32))}),R.prototype.readBigUInt64BE=kt(function(Ce){Ce=Ce>>>0,Ke(Ce,"offset");const Ee=this[Ce],Pe=this[Ce+7];(Ee===void 0||Pe===void 0)&&Ge(Ce,this.length-8);const je=Ee*2**24+this[++Ce]*2**16+this[++Ce]*2**8+this[++Ce],He=this[++Ce]*2**24+this[++Ce]*2**16+this[++Ce]*2**8+Pe;return(BigInt(je)<<BigInt(32))+BigInt(He)}),R.prototype.readIntLE=function(Ce,Ee,Pe){Ce=Ce>>>0,Ee=Ee>>>0,Pe||_e(Ce,Ee,this.length);let je=this[Ce],He=1,Ve=0;for(;++Ve<Ee&&(He*=256);)je+=this[Ce+Ve]*He;return He*=128,je>=He&&(je-=Math.pow(2,8*Ee)),je},R.prototype.readIntBE=function(Ce,Ee,Pe){Ce=Ce>>>0,Ee=Ee>>>0,Pe||_e(Ce,Ee,this.length);let je=Ee,He=1,Ve=this[Ce+--je];for(;je>0&&(He*=256);)Ve+=this[Ce+--je]*He;return He*=128,Ve>=He&&(Ve-=Math.pow(2,8*Ee)),Ve},R.prototype.readInt8=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,1,this.length),this[Ce]&128?(255-this[Ce]+1)*-1:this[Ce]},R.prototype.readInt16LE=function(Ce,Ee){Ce=Ce>>>0,Ee||_e(Ce,2,this.length);const Pe=this[Ce]|this[Ce+1]<<8;return Pe&32768?Pe|4294901760:Pe},R.prototype.readInt16BE=function(Ce,Ee){Ce=Ce>>>0,Ee||_e(Ce,2,this.length);const Pe=this[Ce+1]|this[Ce]<<8;return Pe&32768?Pe|4294901760:Pe},R.prototype.readInt32LE=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,4,this.length),this[Ce]|this[Ce+1]<<8|this[Ce+2]<<16|this[Ce+3]<<24},R.prototype.readInt32BE=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,4,this.length),this[Ce]<<24|this[Ce+1]<<16|this[Ce+2]<<8|this[Ce+3]},R.prototype.readBigInt64LE=kt(function(Ce){Ce=Ce>>>0,Ke(Ce,"offset");const Ee=this[Ce],Pe=this[Ce+7];(Ee===void 0||Pe===void 0)&&Ge(Ce,this.length-8);const je=this[Ce+4]+this[Ce+5]*2**8+this[Ce+6]*2**16+(Pe<<24);return(BigInt(je)<<BigInt(32))+BigInt(Ee+this[++Ce]*2**8+this[++Ce]*2**16+this[++Ce]*2**24)}),R.prototype.readBigInt64BE=kt(function(Ce){Ce=Ce>>>0,Ke(Ce,"offset");const Ee=this[Ce],Pe=this[Ce+7];(Ee===void 0||Pe===void 0)&&Ge(Ce,this.length-8);const je=(Ee<<24)+this[++Ce]*2**16+this[++Ce]*2**8+this[++Ce];return(BigInt(je)<<BigInt(32))+BigInt(this[++Ce]*2**24+this[++Ce]*2**16+this[++Ce]*2**8+Pe)}),R.prototype.readFloatLE=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,4,this.length),g.read(this,Ce,!0,23,4)},R.prototype.readFloatBE=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,4,this.length),g.read(this,Ce,!1,23,4)},R.prototype.readDoubleLE=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,8,this.length),g.read(this,Ce,!0,52,8)},R.prototype.readDoubleBE=function(Ce,Ee){return Ce=Ce>>>0,Ee||_e(Ce,8,this.length),g.read(this,Ce,!1,52,8)};function Re(Me,Ce,Ee,Pe,je,He){if(!R.isBuffer(Me))throw new TypeError('"buffer" argument must be a Buffer instance');if(Ce>je||Ce<He)throw new RangeError('"value" argument is out of bounds');if(Ee+Pe>Me.length)throw new RangeError("Index out of range")}R.prototype.writeUintLE=R.prototype.writeUIntLE=function(Ce,Ee,Pe,je){if(Ce=+Ce,Ee=Ee>>>0,Pe=Pe>>>0,!je){const dt=Math.pow(2,8*Pe)-1;Re(this,Ce,Ee,Pe,dt,0)}let He=1,Ve=0;for(this[Ee]=Ce&255;++Ve<Pe&&(He*=256);)this[Ee+Ve]=Ce/He&255;return Ee+Pe},R.prototype.writeUintBE=R.prototype.writeUIntBE=function(Ce,Ee,Pe,je){if(Ce=+Ce,Ee=Ee>>>0,Pe=Pe>>>0,!je){const dt=Math.pow(2,8*Pe)-1;Re(this,Ce,Ee,Pe,dt,0)}let He=Pe-1,Ve=1;for(this[Ee+He]=Ce&255;--He>=0&&(Ve*=256);)this[Ee+He]=Ce/Ve&255;return Ee+Pe},R.prototype.writeUint8=R.prototype.writeUInt8=function(Ce,Ee,Pe){return Ce=+Ce,Ee=Ee>>>0,Pe||Re(this,Ce,Ee,1,255,0),this[Ee]=Ce&255,Ee+1},R.prototype.writeUint16LE=R.prototype.writeUInt16LE=function(Ce,Ee,Pe){return Ce=+Ce,Ee=Ee>>>0,Pe||Re(this,Ce,Ee,2,65535,0),this[Ee]=Ce&255,this[Ee+1]=Ce>>>8,Ee+2},R.prototype.writeUint16BE=R.prototype.writeUInt16BE=function(Ce,Ee,Pe){return Ce=+Ce,Ee=Ee>>>0,Pe||Re(this,Ce,Ee,2,65535,0),this[Ee]=Ce>>>8,this[Ee+1]=Ce&255,Ee+2},R.prototype.writeUint32LE=R.prototype.writeUInt32LE=function(Ce,Ee,Pe){return Ce=+Ce,Ee=Ee>>>0,Pe||Re(this,Ce,Ee,4,4294967295,0),this[Ee+3]=Ce>>>24,this[Ee+2]=Ce>>>16,this[Ee+1]=Ce>>>8,this[Ee]=Ce&255,Ee+4},R.prototype.writeUint32BE=R.prototype.writeUInt32BE=function(Ce,Ee,Pe){return Ce=+Ce,Ee=Ee>>>0,Pe||Re(this,Ce,Ee,4,4294967295,0),this[Ee]=Ce>>>24,this[Ee+1]=Ce>>>16,this[Ee+2]=Ce>>>8,this[Ee+3]=Ce&255,Ee+4};function Ae(Me,Ce,Ee,Pe,je){qe(Ce,Pe,je,Me,Ee,7);let He=Number(Ce&BigInt(4294967295));Me[Ee++]=He,He=He>>8,Me[Ee++]=He,He=He>>8,Me[Ee++]=He,He=He>>8,Me[Ee++]=He;let Ve=Number(Ce>>BigInt(32)&BigInt(4294967295));return Me[Ee++]=Ve,Ve=Ve>>8,Me[Ee++]=Ve,Ve=Ve>>8,Me[Ee++]=Ve,Ve=Ve>>8,Me[Ee++]=Ve,Ee}function ge(Me,Ce,Ee,Pe,je){qe(Ce,Pe,je,Me,Ee,7);let He=Number(Ce&BigInt(4294967295));Me[Ee+7]=He,He=He>>8,Me[Ee+6]=He,He=He>>8,Me[Ee+5]=He,He=He>>8,Me[Ee+4]=He;let Ve=Number(Ce>>BigInt(32)&BigInt(4294967295));return Me[Ee+3]=Ve,Ve=Ve>>8,Me[Ee+2]=Ve,Ve=Ve>>8,Me[Ee+1]=Ve,Ve=Ve>>8,Me[Ee]=Ve,Ee+8}R.prototype.writeBigUInt64LE=kt(function(Ce,Ee=0){return Ae(this,Ce,Ee,BigInt(0),BigInt("0xffffffffffffffff"))}),R.prototype.writeBigUInt64BE=kt(function(Ce,Ee=0){return ge(this,Ce,Ee,BigInt(0),BigInt("0xffffffffffffffff"))}),R.prototype.writeIntLE=function(Ce,Ee,Pe,je){if(Ce=+Ce,Ee=Ee>>>0,!je){const xt=Math.pow(2,8*Pe-1);Re(this,Ce,Ee,Pe,xt-1,-xt)}let He=0,Ve=1,dt=0;for(this[Ee]=Ce&255;++He<Pe&&(Ve*=256);)Ce<0&&dt===0&&this[Ee+He-1]!==0&&(dt=1),this[Ee+He]=(Ce/Ve>>0)-dt&255;return Ee+Pe},R.prototype.writeIntBE=function(Ce,Ee,Pe,je){if(Ce=+Ce,Ee=Ee>>>0,!je){const xt=Math.pow(2,8*Pe-1);Re(this,Ce,Ee,Pe,xt-1,-xt)}let He=Pe-1,Ve=1,dt=0;for(this[Ee+He]=Ce&255;--He>=0&&(Ve*=256);)Ce<0&&dt===0&&this[Ee+He+1]!==0&&(dt=1),this[Ee+He]=(Ce/Ve>>0)-dt&255;return Ee+Pe},R.prototype.writeInt8=function(Ce,Ee,Pe){return Ce=+Ce,Ee=Ee>>>0,Pe||Re(this,Ce,Ee,1,127,-128),Ce<0&&(Ce=255+Ce+1),this[Ee]=Ce&255,Ee+1},R.prototype.writeInt16LE=function(Ce,Ee,Pe){return Ce=+Ce,Ee=Ee>>>0,Pe||Re(this,Ce,Ee,2,32767,-32768),this[Ee]=Ce&255,this[Ee+1]=Ce>>>8,Ee+2},R.prototype.writeInt16BE=function(Ce,Ee,Pe){return Ce=+Ce,Ee=Ee>>>0,Pe||Re(this,Ce,Ee,2,32767,-32768),this[Ee]=Ce>>>8,this[Ee+1]=Ce&255,Ee+2},R.prototype.writeInt32LE=function(Ce,Ee,Pe){return Ce=+Ce,Ee=Ee>>>0,Pe||Re(this,Ce,Ee,4,2147483647,-2147483648),this[Ee]=Ce&255,this[Ee+1]=Ce>>>8,this[Ee+2]=Ce>>>16,this[Ee+3]=Ce>>>24,Ee+4},R.prototype.writeInt32BE=function(Ce,Ee,Pe){return Ce=+Ce,Ee=Ee>>>0,Pe||Re(this,Ce,Ee,4,2147483647,-2147483648),Ce<0&&(Ce=4294967295+Ce+1),this[Ee]=Ce>>>24,this[Ee+1]=Ce>>>16,this[Ee+2]=Ce>>>8,this[Ee+3]=Ce&255,Ee+4},R.prototype.writeBigInt64LE=kt(function(Ce,Ee=0){return Ae(this,Ce,Ee,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),R.prototype.writeBigInt64BE=kt(function(Ce,Ee=0){return ge(this,Ce,Ee,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function be(Me,Ce,Ee,Pe,je,He){if(Ee+Pe>Me.length)throw new RangeError("Index out of range");if(Ee<0)throw new RangeError("Index out of range")}function Te(Me,Ce,Ee,Pe,je){return Ce=+Ce,Ee=Ee>>>0,je||be(Me,Ce,Ee,4),g.write(Me,Ce,Ee,Pe,23,4),Ee+4}R.prototype.writeFloatLE=function(Ce,Ee,Pe){return Te(this,Ce,Ee,!0,Pe)},R.prototype.writeFloatBE=function(Ce,Ee,Pe){return Te(this,Ce,Ee,!1,Pe)};function De(Me,Ce,Ee,Pe,je){return Ce=+Ce,Ee=Ee>>>0,je||be(Me,Ce,Ee,8),g.write(Me,Ce,Ee,Pe,52,8),Ee+8}R.prototype.writeDoubleLE=function(Ce,Ee,Pe){return De(this,Ce,Ee,!0,Pe)},R.prototype.writeDoubleBE=function(Ce,Ee,Pe){return De(this,Ce,Ee,!1,Pe)},R.prototype.copy=function(Ce,Ee,Pe,je){if(!R.isBuffer(Ce))throw new TypeError("argument should be a Buffer");if(Pe||(Pe=0),!je&&je!==0&&(je=this.length),Ee>=Ce.length&&(Ee=Ce.length),Ee||(Ee=0),je>0&&je<Pe&&(je=Pe),je===Pe||Ce.length===0||this.length===0)return 0;if(Ee<0)throw new RangeError("targetStart out of bounds");if(Pe<0||Pe>=this.length)throw new RangeError("Index out of range");if(je<0)throw new RangeError("sourceEnd out of bounds");je>this.length&&(je=this.length),Ce.length-Ee<je-Pe&&(je=Ce.length-Ee+Pe);const He=je-Pe;return this===Ce&&typeof w.prototype.copyWithin=="function"?this.copyWithin(Ee,Pe,je):w.prototype.set.call(Ce,this.subarray(Pe,je),Ee),He},R.prototype.fill=function(Ce,Ee,Pe,je){if(typeof Ce=="string"){if(typeof Ee=="string"?(je=Ee,Ee=0,Pe=this.length):typeof Pe=="string"&&(je=Pe,Pe=this.length),je!==void 0&&typeof je!="string")throw new TypeError("encoding must be a string");if(typeof je=="string"&&!R.isEncoding(je))throw new TypeError("Unknown encoding: "+je);if(Ce.length===1){const Ve=Ce.charCodeAt(0);(je==="utf8"&&Ve<128||je==="latin1")&&(Ce=Ve)}}else typeof Ce=="number"?Ce=Ce&255:typeof Ce=="boolean"&&(Ce=Number(Ce));if(Ee<0||this.length<Ee||this.length<Pe)throw new RangeError("Out of range index");if(Pe<=Ee)return this;Ee=Ee>>>0,Pe=Pe===void 0?this.length:Pe>>>0,Ce||(Ce=0);let He;if(typeof Ce=="number")for(He=Ee;He<Pe;++He)this[He]=Ce;else{const Ve=R.isBuffer(Ce)?Ce:R.from(Ce,je),dt=Ve.length;if(dt===0)throw new TypeError('The value "'+Ce+'" is invalid for argument "value"');for(He=0;He<Pe-Ee;++He)this[He+Ee]=Ve[He%dt]}return this};const Ie={};function Se(Me,Ce,Ee){Ie[Me]=class extends Ee{constructor(){super(),Object.defineProperty(this,"message",{value:Ce.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Me}]`,this.stack,delete this.name}get code(){return Me}set code(je){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:je,writable:!0})}toString(){return`${this.name} [${Me}]: ${this.message}`}}}Se("ERR_BUFFER_OUT_OF_BOUNDS",function(Me){return Me?`${Me} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Se("ERR_INVALID_ARG_TYPE",function(Me,Ce){return`The "${Me}" argument must be of type number. Received type ${typeof Ce}`},TypeError),Se("ERR_OUT_OF_RANGE",function(Me,Ce,Ee){let Pe=`The value of "${Me}" is out of range.`,je=Ee;return Number.isInteger(Ee)&&Math.abs(Ee)>2**32?je=Be(String(Ee)):typeof Ee=="bigint"&&(je=String(Ee),(Ee>BigInt(2)**BigInt(32)||Ee<-(BigInt(2)**BigInt(32)))&&(je=Be(je)),je+="n"),Pe+=` It must be ${Ce}. Received ${je}`,Pe},RangeError);function Be(Me){let Ce="",Ee=Me.length;const Pe=Me[0]==="-"?1:0;for(;Ee>=Pe+4;Ee-=3)Ce=`_${Me.slice(Ee-3,Ee)}${Ce}`;return`${Me.slice(0,Ee)}${Ce}`}function Le(Me,Ce,Ee){Ke(Ce,"offset"),(Me[Ce]===void 0||Me[Ce+Ee]===void 0)&&Ge(Ce,Me.length-(Ee+1))}function qe(Me,Ce,Ee,Pe,je,He){if(Me>Ee||Me<Ce){const Ve=typeof Ce=="bigint"?"n":"";let dt;throw Ce===0||Ce===BigInt(0)?dt=`>= 0${Ve} and < 2${Ve} ** ${(He+1)*8}${Ve}`:dt=`>= -(2${Ve} ** ${(He+1)*8-1}${Ve}) and < 2 ** ${(He+1)*8-1}${Ve}`,new Ie.ERR_OUT_OF_RANGE("value",dt,Me)}Le(Pe,je,He)}function Ke(Me,Ce){if(typeof Me!="number")throw new Ie.ERR_INVALID_ARG_TYPE(Ce,"number",Me)}function Ge(Me,Ce,Ee){throw Math.floor(Me)!==Me?(Ke(Me,Ee),new Ie.ERR_OUT_OF_RANGE("offset","an integer",Me)):Ce<0?new Ie.ERR_BUFFER_OUT_OF_BOUNDS:new Ie.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${Ce}`,Me)}const Xe=/[^+/0-9A-Za-z-_]/g;function ze(Me){if(Me=Me.split("=")[0],Me=Me.trim().replace(Xe,""),Me.length<2)return"";for(;Me.length%4!==0;)Me=Me+"=";return Me}function et(Me,Ce){Ce=Ce||1/0;let Ee;const Pe=Me.length;let je=null;const He=[];for(let Ve=0;Ve<Pe;++Ve){if(Ee=Me.charCodeAt(Ve),Ee>55295&&Ee<57344){if(!je){if(Ee>56319){(Ce-=3)>-1&&He.push(239,191,189);continue}else if(Ve+1===Pe){(Ce-=3)>-1&&He.push(239,191,189);continue}je=Ee;continue}if(Ee<56320){(Ce-=3)>-1&&He.push(239,191,189),je=Ee;continue}Ee=(je-55296<<10|Ee-56320)+65536}else je&&(Ce-=3)>-1&&He.push(239,191,189);if(je=null,Ee<128){if((Ce-=1)<0)break;He.push(Ee)}else if(Ee<2048){if((Ce-=2)<0)break;He.push(Ee>>6|192,Ee&63|128)}else if(Ee<65536){if((Ce-=3)<0)break;He.push(Ee>>12|224,Ee>>6&63|128,Ee&63|128)}else if(Ee<1114112){if((Ce-=4)<0)break;He.push(Ee>>18|240,Ee>>12&63|128,Ee>>6&63|128,Ee&63|128)}else throw new Error("Invalid code point")}return He}function Ze(Me){const Ce=[];for(let Ee=0;Ee<Me.length;++Ee)Ce.push(Me.charCodeAt(Ee)&255);return Ce}function nt(Me,Ce){let Ee,Pe,je;const He=[];for(let Ve=0;Ve<Me.length&&!((Ce-=2)<0);++Ve)Ee=Me.charCodeAt(Ve),Pe=Ee>>8,je=Ee%256,He.push(je),He.push(Pe);return He}function ut(Me){return u.toByteArray(ze(Me))}function ot(Me,Ce,Ee,Pe){let je;for(je=0;je<Pe&&!(je+Ee>=Ce.length||je>=Me.length);++je)Ce[je+Ee]=Me[je];return je}function vt(Me,Ce){return Me instanceof Ce||Me!=null&&Me.constructor!=null&&Me.constructor.name!=null&&Me.constructor.name===Ce.name}function bt(Me){return Me!==Me}const lt=(function(){const Me="0123456789abcdef",Ce=new Array(256);for(let Ee=0;Ee<16;++Ee){const Pe=Ee*16;for(let je=0;je<16;++je)Ce[Pe+je]=Me[Ee]+Me[je]}return Ce})();function kt(Me){return typeof BigInt>"u"?Ct:Me}function Ct(){throw new Error("BigInt not supported")}})(buffer$2);const Buffer=buffer$2.Buffer,Buffer$1=buffer$2.Buffer,TokenStatus={PENDING:"PENDING",SUBMITTED:"SUBMITTED",TRANSFERRED:"TRANSFERRED",CONFIRMED:"CONFIRMED",BURNED:"BURNED",FAILED:"FAILED"};let Token$3=class{id;name;type;timestamp;unicityAddress;jsonData;sizeBytes;status;transactionId;isOfflineTransfer;pendingOfflineData;amount;coinId;symbol;iconUrl;transferredAt;splitSourceTokenId;splitSentAmount;senderPubkey;constructor(u){this.id=u.id||v4$1(),this.name=u.name||"Unknown Token",this.type=u.type||"Unknown",this.timestamp=u.timestamp||Date.now(),this.unicityAddress=u.unicityAddress,this.jsonData=u.jsonData,this.sizeBytes=u.sizeBytes||0,this.status=u.status||TokenStatus.CONFIRMED,this.transactionId=u.transactionId,this.isOfflineTransfer=u.isOfflineTransfer||!1,this.pendingOfflineData=u.pendingOfflineData,this.amount=u.amount,this.coinId=u.coinId,this.symbol=u.symbol,this.iconUrl=u.iconUrl,this.transferredAt=u.transferredAt,this.splitSourceTokenId=u.splitSourceTokenId,this.splitSentAmount=u.splitSentAmount,this.senderPubkey=u.senderPubkey}getFormattedSize(){return this.sizeBytes<1024?`${this.sizeBytes}B`:this.sizeBytes<1024*1024?`${Math.floor(this.sizeBytes/1024)}KB`:`${Math.floor(this.sizeBytes/(1024*1024))}MB`}getAmountAsBigInteger(){try{return this.amount?BigInt(this.amount):null}catch{return null}}};class AggregatedAsset{coinId;symbol;name;totalAmount;decimals;tokenCount;iconUrl;priceUsd;priceEur;change24h;constructor(u){this.coinId=u.coinId,this.symbol=u.symbol,this.name=u.name||null,this.totalAmount=u.totalAmount,this.decimals=u.decimals,this.tokenCount=u.tokenCount,this.iconUrl=u.iconUrl||null,this.priceUsd=u.priceUsd||0,this.priceEur=u.priceEur||0,this.change24h=u.change24h||0}getAmountAsBigInt(){try{return BigInt(this.totalAmount)}catch{return BigInt(0)}}getFormattedAmount(){const u=this.getAmountAsBigInt();if(u===BigInt(0))return"0";const g=u.toString();if(g.length<=this.decimals){const w=g.padStart(this.decimals+1,"0"),E="0",S=w.slice(-this.decimals);return this.stripTrailingZeros(`${E}.${S}`)}const v=g.slice(0,g.length-this.decimals),b=g.slice(g.length-this.decimals);return this.stripTrailingZeros(`${v}.${b}`)}stripTrailingZeros(u){return u.includes(".")?u.replace(/\.?0+$/,""):u}getAmountAsDecimal(){const u=this.getAmountAsBigInt(),g=Math.pow(10,this.decimals);return Number(u)/g}getTotalFiatValue(u){const g=u==="EUR"?this.priceEur:this.priceUsd;return this.getAmountAsDecimal()*g}getFormattedFiatValue(u){const g=u==="EUR"?"":"$",v=this.getTotalFiatValue(u);return`${g}${v.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}getFormattedChange(){return`${this.change24h>=0?"+":""}${this.change24h.toFixed(2)}%`}}class Wallet{id;name;address;tokens;constructor(u,g,v,b=[]){this.id=u,this.name=g,this.address=v,this.tokens=b}}const PaymentRequestStatus={PENDING:"PENDING",ACCEPTED:"ACCEPTED",REJECTED:"REJECTED",PAID:"PAID"},index$3=Object.freeze(Object.defineProperty({__proto__:null,AggregatedAsset,PaymentRequestStatus,Token:Token$3,TokenStatus,Wallet},Symbol.toStringTag,{value:"Module"}));var AddressScheme;(function(y){y.DIRECT="DIRECT",y.PROXY="PROXY"})(AddressScheme||(AddressScheme={}));function isBytes$8(y){return y instanceof Uint8Array||ArrayBuffer.isView(y)&&y.constructor.name==="Uint8Array"}function anumber$6(y,u=""){if(!Number.isSafeInteger(y)||y<0){const g=u&&`"${u}" `;throw new Error(`${g}expected integer >= 0, got ${y}`)}}function abytes$7(y,u,g=""){const v=isBytes$8(y),b=y?.length,w=u!==void 0;if(!v||w&&b!==u){const E=g&&`"${g}" `,S=w?` of length ${u}`:"",A=v?`length=${b}`:`type=${typeof y}`;throw new Error(E+"expected Uint8Array"+S+", got "+A)}return y}function ahash$5(y){if(typeof y!="function"||typeof y.create!="function")throw new Error("Hash must wrapped by utils.createHasher");anumber$6(y.outputLen),anumber$6(y.blockLen)}function aexists$6(y,u=!0){if(y.destroyed)throw new Error("Hash instance has been destroyed");if(u&&y.finished)throw new Error("Hash#digest() has already been called")}function aoutput$6(y,u){abytes$7(y,void 0,"digestInto() output");const g=u.outputLen;if(y.length<g)throw new Error('"digestInto() output" expected to be of length >='+g)}function clean$6(...y){for(let u=0;u<y.length;u++)y[u].fill(0)}function createView$6(y){return new DataView(y.buffer,y.byteOffset,y.byteLength)}function rotr$4(y,u){return y<<32-u|y>>>u}function rotl$3(y,u){return y<<u|y>>>32-u>>>0}const hasHexBuiltin$3=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes$3=Array.from({length:256},(y,u)=>u.toString(16).padStart(2,"0"));function bytesToHex$6(y){if(abytes$7(y),hasHexBuiltin$3)return y.toHex();let u="";for(let g=0;g<y.length;g++)u+=hexes$3[y[g]];return u}const asciis$3={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$3(y){if(y>=asciis$3._0&&y<=asciis$3._9)return y-asciis$3._0;if(y>=asciis$3.A&&y<=asciis$3.F)return y-(asciis$3.A-10);if(y>=asciis$3.a&&y<=asciis$3.f)return y-(asciis$3.a-10)}function hexToBytes$5(y){if(typeof y!="string")throw new Error("hex string expected, got "+typeof y);if(hasHexBuiltin$3)return Uint8Array.fromHex(y);const u=y.length,g=u/2;if(u%2)throw new Error("hex string expected, got unpadded hex of length "+u);const v=new Uint8Array(g);for(let b=0,w=0;b<g;b++,w+=2){const E=asciiToBase16$3(y.charCodeAt(w)),S=asciiToBase16$3(y.charCodeAt(w+1));if(E===void 0||S===void 0){const A=y[w]+y[w+1];throw new Error('hex string expected, got non-hex character "'+A+'" at index '+w)}v[b]=E*16+S}return v}function concatBytes$3(...y){let u=0;for(let v=0;v<y.length;v++){const b=y[v];abytes$7(b),u+=b.length}const g=new Uint8Array(u);for(let v=0,b=0;v<y.length;v++){const w=y[v];g.set(w,b),b+=w.length}return g}function createHasher$5(y,u={}){const g=(b,w)=>y(w).update(b).digest(),v=y(void 0);return g.outputLen=v.outputLen,g.blockLen=v.blockLen,g.create=b=>y(b),Object.assign(g,u),Object.freeze(g)}function randomBytes$4(y=32){const u=typeof globalThis=="object"?globalThis.crypto:null;if(typeof u?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return u.getRandomValues(new Uint8Array(y))}const oidNist$3=y=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,y])});function Chi$4(y,u,g){return y&u^~y&g}function Maj$4(y,u,g){return y&u^y&g^u&g}let HashMD$5=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(u,g,v,b){this.blockLen=u,this.outputLen=g,this.padOffset=v,this.isLE=b,this.buffer=new Uint8Array(u),this.view=createView$6(this.buffer)}update(u){aexists$6(this),abytes$7(u);const{view:g,buffer:v,blockLen:b}=this,w=u.length;for(let E=0;E<w;){const S=Math.min(b-this.pos,w-E);if(S===b){const A=createView$6(u);for(;b<=w-E;E+=b)this.process(A,E);continue}v.set(u.subarray(E,E+S),this.pos),this.pos+=S,E+=S,this.pos===b&&(this.process(g,0),this.pos=0)}return this.length+=u.length,this.roundClean(),this}digestInto(u){aexists$6(this),aoutput$6(u,this),this.finished=!0;const{buffer:g,view:v,blockLen:b,isLE:w}=this;let{pos:E}=this;g[E++]=128,clean$6(this.buffer.subarray(E)),this.padOffset>b-E&&(this.process(v,0),E=0);for(let T=E;T<b;T++)g[T]=0;v.setBigUint64(b-8,BigInt(this.length*8),w),this.process(v,0);const S=createView$6(u),A=this.outputLen;if(A%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const $=A/4,R=this.get();if($>R.length)throw new Error("_sha2: outputLen bigger than state");for(let T=0;T<$;T++)S.setUint32(4*T,R[T],w)}digest(){const{buffer:u,outputLen:g}=this;this.digestInto(u);const v=u.slice(0,g);return this.destroy(),v}_cloneInto(u){u||=new this.constructor,u.set(...this.get());const{blockLen:g,buffer:v,length:b,finished:w,destroyed:E,pos:S}=this;return u.destroyed=E,u.finished=w,u.length=b,u.pos=S,b%g&&u.buffer.set(v),u}clone(){return this._cloneInto()}};const SHA256_IV$4=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA224_IV=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),SHA384_IV=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),SHA512_IV$3=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Rho160=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Id160=Uint8Array.from(new Array(16).fill(0).map((y,u)=>u)),Pi160=Id160.map(y=>(9*y+5)%16),idxLR=(()=>{const g=[[Id160],[Pi160]];for(let v=0;v<4;v++)for(let b of g)b.push(b[v].map(w=>Rho160[w]));return g})(),idxL=idxLR[0],idxR=idxLR[1],shifts160=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(y=>Uint8Array.from(y)),shiftsL160=idxL.map((y,u)=>y.map(g=>shifts160[u][g])),shiftsR160=idxR.map((y,u)=>y.map(g=>shifts160[u][g])),Kl160=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),Kr160=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function ripemd_f(y,u,g,v){return y===0?u^g^v:y===1?u&g|~u&v:y===2?(u|~g)^v:y===3?u&v|g&~v:u^(g|~v)}const BUF_160=new Uint32Array(16);class _RIPEMD160 extends HashMD$5{h0=1732584193;h1=-271733879;h2=-1732584194;h3=271733878;h4=-1009589776;constructor(){super(64,20,8,!0)}get(){const{h0:u,h1:g,h2:v,h3:b,h4:w}=this;return[u,g,v,b,w]}set(u,g,v,b,w){this.h0=u|0,this.h1=g|0,this.h2=v|0,this.h3=b|0,this.h4=w|0}process(u,g){for(let B=0;B<16;B++,g+=4)BUF_160[B]=u.getUint32(g,!0);let v=this.h0|0,b=v,w=this.h1|0,E=w,S=this.h2|0,A=S,$=this.h3|0,R=$,T=this.h4|0,O=T;for(let B=0;B<5;B++){const F=4-B,U=Kl160[B],q=Kr160[B],J=idxL[B],ie=idxR[B],oe=shiftsL160[B],le=shiftsR160[B];for(let de=0;de<16;de++){const fe=rotl$3(v+ripemd_f(B,w,S,$)+BUF_160[J[de]]+U,oe[de])+T|0;v=T,T=$,$=rotl$3(S,10)|0,S=w,w=fe}for(let de=0;de<16;de++){const fe=rotl$3(b+ripemd_f(F,E,A,R)+BUF_160[ie[de]]+q,le[de])+O|0;b=O,O=R,R=rotl$3(A,10)|0,A=E,E=fe}}this.set(this.h1+S+R|0,this.h2+$+O|0,this.h3+T+b|0,this.h4+v+E|0,this.h0+w+A|0)}roundClean(){clean$6(BUF_160)}destroy(){this.destroyed=!0,clean$6(this.buffer),this.set(0,0,0,0,0)}}const ripemd160$3=createHasher$5(()=>new _RIPEMD160),U32_MASK64$3=BigInt(2**32-1),_32n$3=BigInt(32);function fromBig$3(y,u=!1){return u?{h:Number(y&U32_MASK64$3),l:Number(y>>_32n$3&U32_MASK64$3)}:{h:Number(y>>_32n$3&U32_MASK64$3)|0,l:Number(y&U32_MASK64$3)|0}}function split$3(y,u=!1){const g=y.length;let v=new Uint32Array(g),b=new Uint32Array(g);for(let w=0;w<g;w++){const{h:E,l:S}=fromBig$3(y[w],u);[v[w],b[w]]=[E,S]}return[v,b]}const shrSH$3=(y,u,g)=>y>>>g,shrSL$3=(y,u,g)=>y<<32-g|u>>>g,rotrSH$3=(y,u,g)=>y>>>g|u<<32-g,rotrSL$3=(y,u,g)=>y<<32-g|u>>>g,rotrBH$3=(y,u,g)=>y<<64-g|u>>>g-32,rotrBL$3=(y,u,g)=>y>>>g-32|u<<64-g;function add$3(y,u,g,v){const b=(u>>>0)+(v>>>0);return{h:y+g+(b/2**32|0)|0,l:b|0}}const add3L$3=(y,u,g)=>(y>>>0)+(u>>>0)+(g>>>0),add3H$3=(y,u,g,v)=>u+g+v+(y/2**32|0)|0,add4L$3=(y,u,g,v)=>(y>>>0)+(u>>>0)+(g>>>0)+(v>>>0),add4H$3=(y,u,g,v,b)=>u+g+v+b+(y/2**32|0)|0,add5L$3=(y,u,g,v,b)=>(y>>>0)+(u>>>0)+(g>>>0)+(v>>>0)+(b>>>0),add5H$3=(y,u,g,v,b,w)=>u+g+v+b+w+(y/2**32|0)|0,SHA256_K$4=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W$4=new Uint32Array(64);let SHA2_32B$2=class extends HashMD$5{constructor(u){super(64,u,8,!1)}get(){const{A:u,B:g,C:v,D:b,E:w,F:E,G:S,H:A}=this;return[u,g,v,b,w,E,S,A]}set(u,g,v,b,w,E,S,A){this.A=u|0,this.B=g|0,this.C=v|0,this.D=b|0,this.E=w|0,this.F=E|0,this.G=S|0,this.H=A|0}process(u,g){for(let T=0;T<16;T++,g+=4)SHA256_W$4[T]=u.getUint32(g,!1);for(let T=16;T<64;T++){const O=SHA256_W$4[T-15],B=SHA256_W$4[T-2],F=rotr$4(O,7)^rotr$4(O,18)^O>>>3,U=rotr$4(B,17)^rotr$4(B,19)^B>>>10;SHA256_W$4[T]=U+SHA256_W$4[T-7]+F+SHA256_W$4[T-16]|0}let{A:v,B:b,C:w,D:E,E:S,F:A,G:$,H:R}=this;for(let T=0;T<64;T++){const O=rotr$4(S,6)^rotr$4(S,11)^rotr$4(S,25),B=R+O+Chi$4(S,A,$)+SHA256_K$4[T]+SHA256_W$4[T]|0,U=(rotr$4(v,2)^rotr$4(v,13)^rotr$4(v,22))+Maj$4(v,b,w)|0;R=$,$=A,A=S,S=E+B|0,E=w,w=b,b=v,v=B+U|0}v=v+this.A|0,b=b+this.B|0,w=w+this.C|0,E=E+this.D|0,S=S+this.E|0,A=A+this.F|0,$=$+this.G|0,R=R+this.H|0,this.set(v,b,w,E,S,A,$,R)}roundClean(){clean$6(SHA256_W$4)}destroy(){this.set(0,0,0,0,0,0,0,0),clean$6(this.buffer)}},_SHA256$2=class extends SHA2_32B$2{A=SHA256_IV$4[0]|0;B=SHA256_IV$4[1]|0;C=SHA256_IV$4[2]|0;D=SHA256_IV$4[3]|0;E=SHA256_IV$4[4]|0;F=SHA256_IV$4[5]|0;G=SHA256_IV$4[6]|0;H=SHA256_IV$4[7]|0;constructor(){super(32)}};class _SHA224 extends SHA2_32B$2{A=SHA224_IV[0]|0;B=SHA224_IV[1]|0;C=SHA224_IV[2]|0;D=SHA224_IV[3]|0;E=SHA224_IV[4]|0;F=SHA224_IV[5]|0;G=SHA224_IV[6]|0;H=SHA224_IV[7]|0;constructor(){super(28)}}const K512$3=split$3(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(y=>BigInt(y))),SHA512_Kh$3=K512$3[0],SHA512_Kl$3=K512$3[1],SHA512_W_H$3=new Uint32Array(80),SHA512_W_L$3=new Uint32Array(80);let SHA2_64B$2=class extends HashMD$5{constructor(u){super(128,u,16,!1)}get(){const{Ah:u,Al:g,Bh:v,Bl:b,Ch:w,Cl:E,Dh:S,Dl:A,Eh:$,El:R,Fh:T,Fl:O,Gh:B,Gl:F,Hh:U,Hl:q}=this;return[u,g,v,b,w,E,S,A,$,R,T,O,B,F,U,q]}set(u,g,v,b,w,E,S,A,$,R,T,O,B,F,U,q){this.Ah=u|0,this.Al=g|0,this.Bh=v|0,this.Bl=b|0,this.Ch=w|0,this.Cl=E|0,this.Dh=S|0,this.Dl=A|0,this.Eh=$|0,this.El=R|0,this.Fh=T|0,this.Fl=O|0,this.Gh=B|0,this.Gl=F|0,this.Hh=U|0,this.Hl=q|0}process(u,g){for(let oe=0;oe<16;oe++,g+=4)SHA512_W_H$3[oe]=u.getUint32(g),SHA512_W_L$3[oe]=u.getUint32(g+=4);for(let oe=16;oe<80;oe++){const le=SHA512_W_H$3[oe-15]|0,de=SHA512_W_L$3[oe-15]|0,fe=rotrSH$3(le,de,1)^rotrSH$3(le,de,8)^shrSH$3(le,de,7),ye=rotrSL$3(le,de,1)^rotrSL$3(le,de,8)^shrSL$3(le,de,7),we=SHA512_W_H$3[oe-2]|0,pe=SHA512_W_L$3[oe-2]|0,ve=rotrSH$3(we,pe,19)^rotrBH$3(we,pe,61)^shrSH$3(we,pe,6),he=rotrSL$3(we,pe,19)^rotrBL$3(we,pe,61)^shrSL$3(we,pe,6),ae=add4L$3(ye,he,SHA512_W_L$3[oe-7],SHA512_W_L$3[oe-16]),Q=add4H$3(ae,fe,ve,SHA512_W_H$3[oe-7],SHA512_W_H$3[oe-16]);SHA512_W_H$3[oe]=Q|0,SHA512_W_L$3[oe]=ae|0}let{Ah:v,Al:b,Bh:w,Bl:E,Ch:S,Cl:A,Dh:$,Dl:R,Eh:T,El:O,Fh:B,Fl:F,Gh:U,Gl:q,Hh:J,Hl:ie}=this;for(let oe=0;oe<80;oe++){const le=rotrSH$3(T,O,14)^rotrSH$3(T,O,18)^rotrBH$3(T,O,41),de=rotrSL$3(T,O,14)^rotrSL$3(T,O,18)^rotrBL$3(T,O,41),fe=T&B^~T&U,ye=O&F^~O&q,we=add5L$3(ie,de,ye,SHA512_Kl$3[oe],SHA512_W_L$3[oe]),pe=add5H$3(we,J,le,fe,SHA512_Kh$3[oe],SHA512_W_H$3[oe]),ve=we|0,he=rotrSH$3(v,b,28)^rotrBH$3(v,b,34)^rotrBH$3(v,b,39),ae=rotrSL$3(v,b,28)^rotrBL$3(v,b,34)^rotrBL$3(v,b,39),Q=v&w^v&S^w&S,j=b&E^b&A^E&A;J=U|0,ie=q|0,U=B|0,q=F|0,B=T|0,F=O|0,{h:T,l:O}=add$3($|0,R|0,pe|0,ve|0),$=S|0,R=A|0,S=w|0,A=E|0,w=v|0,E=b|0;const z=add3L$3(ve,ae,j);v=add3H$3(z,pe,he,Q),b=z|0}({h:v,l:b}=add$3(this.Ah|0,this.Al|0,v|0,b|0)),{h:w,l:E}=add$3(this.Bh|0,this.Bl|0,w|0,E|0),{h:S,l:A}=add$3(this.Ch|0,this.Cl|0,S|0,A|0),{h:$,l:R}=add$3(this.Dh|0,this.Dl|0,$|0,R|0),{h:T,l:O}=add$3(this.Eh|0,this.El|0,T|0,O|0),{h:B,l:F}=add$3(this.Fh|0,this.Fl|0,B|0,F|0),{h:U,l:q}=add$3(this.Gh|0,this.Gl|0,U|0,q|0),{h:J,l:ie}=add$3(this.Hh|0,this.Hl|0,J|0,ie|0),this.set(v,b,w,E,S,A,$,R,T,O,B,F,U,q,J,ie)}roundClean(){clean$6(SHA512_W_H$3,SHA512_W_L$3)}destroy(){clean$6(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},_SHA512$2=class extends SHA2_64B$2{Ah=SHA512_IV$3[0]|0;Al=SHA512_IV$3[1]|0;Bh=SHA512_IV$3[2]|0;Bl=SHA512_IV$3[3]|0;Ch=SHA512_IV$3[4]|0;Cl=SHA512_IV$3[5]|0;Dh=SHA512_IV$3[6]|0;Dl=SHA512_IV$3[7]|0;Eh=SHA512_IV$3[8]|0;El=SHA512_IV$3[9]|0;Fh=SHA512_IV$3[10]|0;Fl=SHA512_IV$3[11]|0;Gh=SHA512_IV$3[12]|0;Gl=SHA512_IV$3[13]|0;Hh=SHA512_IV$3[14]|0;Hl=SHA512_IV$3[15]|0;constructor(){super(64)}};class _SHA384 extends SHA2_64B$2{Ah=SHA384_IV[0]|0;Al=SHA384_IV[1]|0;Bh=SHA384_IV[2]|0;Bl=SHA384_IV[3]|0;Ch=SHA384_IV[4]|0;Cl=SHA384_IV[5]|0;Dh=SHA384_IV[6]|0;Dl=SHA384_IV[7]|0;Eh=SHA384_IV[8]|0;El=SHA384_IV[9]|0;Fh=SHA384_IV[10]|0;Fl=SHA384_IV[11]|0;Gh=SHA384_IV[12]|0;Gl=SHA384_IV[13]|0;Hh=SHA384_IV[14]|0;Hl=SHA384_IV[15]|0;constructor(){super(48)}}const sha256$c=createHasher$5(()=>new _SHA256$2,oidNist$3(1)),sha224$4=createHasher$5(()=>new _SHA224,oidNist$3(4)),sha512$a=createHasher$5(()=>new _SHA512$2,oidNist$3(3)),sha384$4=createHasher$5(()=>new _SHA384,oidNist$3(2));var HashAlgorithm;(function(y){y[y.SHA256=0]="SHA256",y[y.SHA224=1]="SHA224",y[y.SHA384=2]="SHA384",y[y.SHA512=3]="SHA512",y[y.RIPEMD160=4]="RIPEMD160"})(HashAlgorithm||(HashAlgorithm={}));class HashError extends Error{constructor(u){super(u),this.name="HashError"}}class CborError extends Error{}class CborMapEntry{_key;_value;constructor(u,g){this._key=u,this._value=g,this._key=new Uint8Array(u),this._value=new Uint8Array(g)}get key(){return new Uint8Array(this._key)}get value(){return new Uint8Array(this._value)}}var MajorType;(function(y){y[y.UNSIGNED_INTEGER=0]="UNSIGNED_INTEGER",y[y.NEGATIVE_INTEGER=32]="NEGATIVE_INTEGER",y[y.BYTE_STRING=64]="BYTE_STRING",y[y.TEXT_STRING=96]="TEXT_STRING",y[y.ARRAY=128]="ARRAY",y[y.MAP=160]="MAP",y[y.TAG=192]="TAG",y[y.FLOAT_SIMPLE_BREAK=224]="FLOAT_SIMPLE_BREAK"})(MajorType||(MajorType={}));class CborReader{data;static MAJOR_TYPE_MASK=224;static ADDITIONAL_INFORMATION_MASK=31;position=0;constructor(u){this.data=u}readByte(){if(this.position>=this.data.length)throw new CborError("Premature end of data.");return this.data[this.position++]}read(u){try{if(this.position+u>this.data.length)throw new CborError("Premature end of data.");return this.data.slice(this.position,this.position+u)}finally{this.position+=u}}readLength(u){const g=this.readByte();if((g&CborReader.MAJOR_TYPE_MASK)!==u)throw new CborError("Major type mismatch.");const v=g&CborReader.ADDITIONAL_INFORMATION_MASK;if(v<24)return BigInt(v);switch(u){case MajorType.ARRAY:case MajorType.BYTE_STRING:case MajorType.TEXT_STRING:if(v==31)throw new CborError("Indefinite length array not supported.");break}if(v>27)throw new CborError("Encoded item is not well-formed.");let b=0n;const w=Math.pow(2,v-24);for(let E=0;E<w;++E)b=b<<8n|BigInt(this.readByte());return b}readRawCbor(){if(this.position>=this.data.length)throw new CborError("Premature end of data.");const u=this.data[this.position]&CborReader.MAJOR_TYPE_MASK,g=this.position,v=this.readLength(u);switch(u){case MajorType.BYTE_STRING:case MajorType.TEXT_STRING:this.read(Number(v));break;case MajorType.ARRAY:for(let b=0;b<v;b++)this.readRawCbor();break;case MajorType.MAP:for(let b=0;b<v;b++)this.readRawCbor(),this.readRawCbor();break;case MajorType.TAG:this.readRawCbor();break}return this.data.slice(g,this.position)}}class HexConverter{static encode(u){return bytesToHex$6(u)}static decode(u){return(u.startsWith("0x")||u.startsWith("0X"))&&(u=u.slice(2)),hexToBytes$5(u)}}class CborDeserializer{static readOptional(u,g){return new CborReader(u).readByte()===246?null:g(u)}static readUnsignedInteger(u){return new CborReader(u).readLength(MajorType.UNSIGNED_INTEGER)}static readNegativeInteger(){throw new CborError("Not implemented.")}static readByteString(u){const g=new CborReader(u),v=g.readLength(MajorType.BYTE_STRING);if(v>BigInt(Number.MAX_SAFE_INTEGER))throw new CborError("Byte string too long.");return g.read(Number(v))}static readTextString(u){const g=new CborReader(u),v=g.readLength(MajorType.TEXT_STRING);if(v>BigInt(Number.MAX_SAFE_INTEGER))throw new CborError("Text string too long.");return new TextDecoder().decode(g.read(Number(v)))}static readArray(u){const g=new CborReader(u),v=g.readLength(MajorType.ARRAY);if(v>BigInt(Number.MAX_SAFE_INTEGER))throw new CborError("Array too long.");const b=[];for(let w=0;w<v;w++)b.push(g.readRawCbor());return b}static readMap(u){const g=new CborReader(u),v=g.readLength(MajorType.MAP);if(v>BigInt(Number.MAX_SAFE_INTEGER))throw new CborError("Map too long.");const b=[],w=new Set;for(let E=0;E<v;E++){const S=g.readRawCbor(),A=g.readRawCbor(),$=HexConverter.encode(S);if(w.has($))throw new CborError("Duplicate map key found.");w.add($),b.push(new CborMapEntry(S,A))}return b}static readTag(u){const g=new CborReader(u),v=g.readLength(MajorType.TAG);return{data:g.readRawCbor(),tag:v}}static readBoolean(u){const g=new CborReader(u).readByte();if(g===245)return!0;if(g===244)return!1;throw new CborError("Type mismatch, expected boolean.")}}class CborSerializer{static encodeOptional(u,g){return u==null?new Uint8Array([246]):g(u)}static encodeUnsignedInteger(u){if(u<0)throw new CborError("Only unsigned numbers are allowed.");if(u<24)return new Uint8Array([MajorType.UNSIGNED_INTEGER|Number(u)]);const g=CborSerializer.getUnsignedIntegerAsPaddedBytes(u);return new Uint8Array([MajorType.UNSIGNED_INTEGER|CborSerializer.getAdditionalInformationBits(g.length),...g])}static encodeByteString(u){if(u.length<24)return new Uint8Array([MajorType.BYTE_STRING|u.length,...u]);const g=CborSerializer.getUnsignedIntegerAsPaddedBytes(u.length);return new Uint8Array([MajorType.BYTE_STRING|CborSerializer.getAdditionalInformationBits(g.length),...g,...u])}static encodeTextString(u){const g=new TextEncoder().encode(u);if(g.length<24)return new Uint8Array([MajorType.TEXT_STRING|g.length,...g]);const v=CborSerializer.getUnsignedIntegerAsPaddedBytes(g.length);return new Uint8Array([MajorType.TEXT_STRING|CborSerializer.getAdditionalInformationBits(v.length),...v,...g])}static encodeArray(...u){const g=new Uint8Array(u.reduce((w,E)=>w+E.length,0));let v=0;for(const w of u)g.set(w,v),v+=w.length;if(u.length<24)return new Uint8Array([MajorType.ARRAY|u.length,...g]);const b=CborSerializer.getUnsignedIntegerAsPaddedBytes(u.length);return new Uint8Array([MajorType.ARRAY|CborSerializer.getAdditionalInformationBits(b.length),...b,...g])}static encodeMap(u){const g=u.entries,v=g.reduce((S,A)=>S+A.key.length+A.value.length,0),b=new Uint8Array(v);let w=0;for(const S of g)b.set(S.key,w),w+=S.key.length,b.set(S.value,w),w+=S.value.length;if(g.length<24)return new Uint8Array([MajorType.MAP|g.length,...b]);const E=CborSerializer.getUnsignedIntegerAsPaddedBytes(g.length);return new Uint8Array([MajorType.MAP|CborSerializer.getAdditionalInformationBits(E.length),...E,...b])}static encodeTag(u,g){if(u<24)return new Uint8Array([MajorType.TAG|Number(u),...g]);const v=CborSerializer.getUnsignedIntegerAsPaddedBytes(u);return new Uint8Array([MajorType.TAG|CborSerializer.getAdditionalInformationBits(v.length),...v,...g])}static encodeBoolean(u){return u?new Uint8Array([245]):new Uint8Array([244])}static encodeNull(){return new Uint8Array([246])}static getAdditionalInformationBits(u){return 24+Math.ceil(Math.log2(u))}static getUnsignedIntegerAsPaddedBytes(u){if(u<0)throw new CborError("Only unsigned numbers are allowed.");let g;const v=[];for(g=BigInt(u);g>0;g=g>>8n)v.push(Number(g&255n));if(v.length>8)throw new CborError("Number is not unsigned long.");v.length===0&&v.push(0),v.reverse();const b=new Uint8Array(Math.pow(2,Math.ceil(Math.log2(v.length))));return b.set(v,b.length-v.length),b}}class DataHash{algorithm;_data;_imprint;constructor(u,g){this.algorithm=u,this._data=g,this._data=new Uint8Array(g),this._imprint=new Uint8Array(g.length+2),this._imprint.set([(u&65280)>>8,u&255]),this._imprint.set(new Uint8Array(g),2)}get data(){return new Uint8Array(this._data)}get imprint(){return new Uint8Array(this._imprint)}static fromImprint(u){if(u.length<3)throw new HashError("Imprint must have 2 bytes of algorithm and at least 1 byte of data.");const g=u[0]<<8|u[1];return new DataHash(g,u.subarray(2))}static fromJSON(u){return DataHash.fromImprint(HexConverter.decode(u))}static fromCBOR(u){return DataHash.fromImprint(CborDeserializer.readByteString(u))}toJSON(){return HexConverter.encode(this._imprint)}toCBOR(){return CborSerializer.encodeByteString(this._imprint)}equals(u){return HexConverter.encode(this._imprint)===HexConverter.encode(u._imprint)}toString(){return`[${HashAlgorithm[this.algorithm]}]${HexConverter.encode(this._data)}`}}let UnsupportedHashAlgorithmError$1=class extends Error{constructor(u){super(`Unsupported hash algorithm: ${u}`),this.name="UnsupportedHashAlgorithm"}};const Algorithm={[HashAlgorithm.RIPEMD160]:ripemd160$3,[HashAlgorithm.SHA224]:sha224$4,[HashAlgorithm.SHA256]:sha256$c,[HashAlgorithm.SHA384]:sha384$4,[HashAlgorithm.SHA512]:sha512$a};class DataHasher{algorithm;_messageDigest;constructor(u){if(this.algorithm=u,!Algorithm[u])throw new UnsupportedHashAlgorithmError$1(u);this._messageDigest=Algorithm[u].create()}update(u){return this._messageDigest.update(u),this}digest(){return Promise.resolve(new DataHash(this.algorithm,this._messageDigest.digest()))}}class DirectAddress{data;checksum;constructor(u,g){this.data=u,this.checksum=g,this.checksum=new Uint8Array(g.slice(0,4))}get scheme(){return AddressScheme.DIRECT}get address(){return this.toString()}static async create(u){const g=await new DataHasher(HashAlgorithm.SHA256).update(u.imprint).digest();return new DirectAddress(u,g.data.slice(0,4))}toString(){return`${this.scheme}://${HexConverter.encode(this.data.imprint)}${HexConverter.encode(this.checksum)}`}}class BigintConverter{static decode(u,g,v){if(g=g??0,v=v??u.length,g<0||v<0||g+v>u.length)throw new Error("Index out of bounds");let b=0n;for(let w=0;w<v;++w)b=b<<8n|BigInt(u[g+w]&255);return b}static encode(u){const g=[];for(let v=u;v>0n;v>>=8n)g.unshift(Number(v&0xffn));return new Uint8Array(g)}}let BitString$2=class oh{value;constructor(u){this.value=BigInt(`0x01${HexConverter.encode(u)}`)}static fromDataHash(u){return new oh(u.imprint)}toBigInt(){return this.value}toBytes(){return BigintConverter.encode(this.value).slice(1)}toString(){return this.value.toString(2).slice(1)}};function areUint8ArraysEqual(y,u){return y===u?!0:!y||!u?!1:compareUint8Arrays(y,u)===0}function compareUint8Arrays(y,u){if(y.length!==u.length)return y.length-u.length;for(let g=0;g<y.length;g++)if(y[g]!==u[g])return y[g]-u[g];return 0}const textEncoder$5=new TextEncoder;class TokenId{_bytes;constructor(u){this._bytes=u,this._bytes=new Uint8Array(u)}get bytes(){return new Uint8Array(this._bytes)}static async fromNameTag(u){const g=await new DataHasher(HashAlgorithm.SHA256).update(textEncoder$5.encode(u)).digest();return new TokenId(g.imprint)}static fromJSON(u){return new TokenId(HexConverter.decode(u))}static fromCBOR(u){return new TokenId(CborDeserializer.readByteString(u))}toJSON(){return HexConverter.encode(this._bytes)}toCBOR(){return CborSerializer.encodeByteString(this._bytes)}toString(){return`TokenId[${HexConverter.encode(this._bytes)}]`}toBitString(){return new BitString$2(this._bytes)}equals(u){return this===u?!0:u instanceof TokenId?areUint8ArraysEqual(this._bytes,u._bytes):!1}}class AddressFactory{static async createAddress(u){const g=u.split("://",2);if(g.length!=2)throw new Error("Invalid address format");let v;const b=HexConverter.decode(g[1]);switch(g.at(0)){case AddressScheme.DIRECT:v=await DirectAddress.create(DataHash.fromImprint(b.slice(0,-4)));break;case AddressScheme.PROXY:v=await ProxyAddress.fromTokenId(new TokenId(b.slice(0,-4)));break;default:throw new Error(`Invalid address format: ${g.at(0)}`)}if(v.address!==u)throw new Error("Address checksum mismatch");return v}}const textDecoder$3=new TextDecoder;class ProxyAddress{data;checksum;constructor(u,g){this.data=u,this.checksum=g,this.checksum=g.slice()}get scheme(){return AddressScheme.PROXY}get address(){return this.toString()}static async fromNameTag(u){return ProxyAddress.fromTokenId(await TokenId.fromNameTag(u))}static async fromTokenId(u){const g=await new DataHasher(HashAlgorithm.SHA256).update(u.bytes).digest();return new ProxyAddress(u,g.data.slice(0,4))}static async resolve(u,g){const v=new Map;for(const w of g){if(w==null)throw new Error("Nametag tokens list cannot contain null elements");const E=await ProxyAddress.fromTokenId(w.id).then(S=>S.address);if(v.has(E))throw new Error(`Nametag tokens list contains duplicate addresses: ${E}`);if(w.data==null)throw new Error("Nametag token data cannot be null");v.set(E,await AddressFactory.createAddress(textDecoder$3.decode(w.data)))}let b=u;for(;b!==null&&b.scheme!=AddressScheme.DIRECT;)b=v.get(b.address)??null;return b}toString(){return`${AddressScheme.PROXY}://${HexConverter.encode(this.data.bytes)}${HexConverter.encode(this.checksum)}`}}class InvalidJsonStructureError extends Error{constructor(){super("Invalid JSON structure.")}}var PredicateEngineType;(function(y){y[y.EMBEDDED=0]="EMBEDDED"})(PredicateEngineType||(PredicateEngineType={}));class EncodedPredicate{engine;_code;_parameters;constructor(u,g,v){this.engine=u,this._code=g,this._parameters=v,this._code=g.slice(),this._parameters=v.slice()}static fromCBOR(u){const g=CborDeserializer.readArray(u),v=CborDeserializer.readUnsignedInteger(g[0]);if(v>Number.MAX_SAFE_INTEGER||!PredicateEngineType[Number(v)])throw new CborError("Invalid predicate engine type");return new EncodedPredicate(Number(v),CborDeserializer.readByteString(g[1]),CborDeserializer.readByteString(g[2]))}encode(){return this._code.slice()}encodeParameters(){return this._parameters.slice()}}function dedent(y,...u){if(y.length===0)return"";let g=y[0].split(`
`);if(g.shift()?.length!==0)throw new Error("First line must be empty");const v=g[0].length-g[0].trimStart().length,b=[];for(let w=0;w<y.length;w++){b.push(`${b.pop()||""}${g[0].slice(Math.min(g[0].length-g[0].trim().length,v))}`);for(let $=1;$<g.length;$++)b.push(g[$].slice(v));const E=b.pop(),S=E.length-E.trimStart().length,A=w<u.length?String(u[w]).split(`
`):[""];b.push(`${E}${A[0]}`);for(let $=1;$<A.length;$++)b.push(`${" ".repeat(S)}${A[$]}`);g=w+1<y.length?y[w+1].split(`
`):[]}return b.join(`
`)}class TokenState{predicate;_data;constructor(u,g){this.predicate=u,this._data=g,this._data=g?new Uint8Array(g):null}get data(){return this._data?new Uint8Array(this._data):null}static fromCBOR(u){const g=CborDeserializer.readArray(u);return new TokenState(EncodedPredicate.fromCBOR(g[0]),CborDeserializer.readOptional(g[1],CborDeserializer.readByteString))}static isJSON(u){return typeof u=="object"&&u!=null&&"predicate"in u&&typeof u.predicate=="string"&&"data"in u&&(typeof u.data=="string"||u.data===null)}static fromJSON(u){if(!TokenState.isJSON(u))throw new InvalidJsonStructureError;return new TokenState(EncodedPredicate.fromCBOR(HexConverter.decode(u.predicate)),u.data?HexConverter.decode(u.data):null)}toCBOR(){return CborSerializer.encodeArray(CborSerializer.encodeArray(CborSerializer.encodeUnsignedInteger(this.predicate.engine),CborSerializer.encodeByteString(this.predicate.encode()),CborSerializer.encodeByteString(this.predicate.encodeParameters())),CborSerializer.encodeOptional(this.data,CborSerializer.encodeByteString))}toJSON(){return{data:this._data?HexConverter.encode(this._data):null,predicate:HexConverter.encode(CborSerializer.encodeArray(CborSerializer.encodeUnsignedInteger(this.predicate.engine),CborSerializer.encodeByteString(this.predicate.encode()),CborSerializer.encodeByteString(this.predicate.encodeParameters())))}}calculateHash(){return new DataHasher(HashAlgorithm.SHA256).update(this.toCBOR()).digest()}toString(){return dedent`
        TokenState:
          ${this.predicate.toString()}
          Data: ${this._data?HexConverter.encode(this._data):null}`}}var EmbeddedPredicateType;(function(y){y[y.UNMASKED=0]="UNMASKED",y[y.MASKED=1]="MASKED",y[y.BURN=2]="BURN"})(EmbeddedPredicateType||(EmbeddedPredicateType={}));class BurnPredicateReference{hash;constructor(u){this.hash=u}static async create(u,g){return new BurnPredicateReference(await new DataHasher(HashAlgorithm.SHA256).update(CborSerializer.encodeArray(CborSerializer.encodeByteString(new Uint8Array([EmbeddedPredicateType.BURN])),CborSerializer.encodeByteString(u.toCBOR()),CborSerializer.encodeByteString(g.imprint))).digest())}toAddress(){return DirectAddress.create(this.hash)}}class TokenType{_bytes;constructor(u){this._bytes=u,this._bytes=new Uint8Array(u)}get bytes(){return new Uint8Array(this._bytes)}static fromJSON(u){return new TokenType(HexConverter.decode(u))}static fromCBOR(u){return new TokenType(CborDeserializer.readByteString(u))}toJSON(){return HexConverter.encode(this._bytes)}toCBOR(){return CborSerializer.encodeByteString(this._bytes)}toString(){return`TokenType[${HexConverter.encode(this._bytes)}]`}equals(u){return this===u?!0:u instanceof TokenType?areUint8ArraysEqual(this._bytes,u._bytes):!1}}class BurnPredicate{tokenId;tokenType;reason;constructor(u,g,v){this.tokenId=u,this.tokenType=g,this.reason=v}get engine(){return PredicateEngineType.EMBEDDED}static fromCBOR(u){const g=CborDeserializer.readArray(u);return new BurnPredicate(TokenId.fromCBOR(g[0]),TokenType.fromCBOR(g[1]),DataHash.fromCBOR(g[2]))}verify(){return Promise.resolve(!1)}isOwner(){return Promise.resolve(!1)}getReference(){return BurnPredicateReference.create(this.tokenType,this.reason)}encode(){return new Uint8Array([EmbeddedPredicateType.BURN])}encodeParameters(){return CborSerializer.encodeArray(this.tokenId.toCBOR(),this.tokenType.toCBOR(),this.reason.toCBOR())}async calculateHash(){const u=await this.getReference();return new DataHasher(HashAlgorithm.SHA256).update(CborSerializer.encodeArray(u.hash.toCBOR(),this.tokenId.toCBOR())).digest()}toString(){return dedent`
          Predicate[${EmbeddedPredicateType[EmbeddedPredicateType.BURN]}]:
            TokenId: ${this.tokenId.toString()}
            TokenType: ${this.tokenType.toString()}
            Reason: ${this.reason.toString()}`}}class RequestId extends DataHash{hash;constructor(u){super(u.algorithm,u.data),this.hash=u}static create(u,g){return RequestId.createFromImprint(u,g.imprint)}static async createFromImprint(u,g){const v=await new DataHasher(HashAlgorithm.SHA256).update(u).update(g).digest();return new RequestId(v)}static fromCBOR(u){return new RequestId(DataHash.fromCBOR(u))}static fromJSON(u){return new RequestId(DataHash.fromJSON(u))}toBitString(){return BitString$2.fromDataHash(this)}toString(){return`RequestId[${this.hash.toString()}]`}}class Signature{_bytes;recovery;algorithm="secp256k1";constructor(u,g){this._bytes=u,this.recovery=g,this._bytes=new Uint8Array(u)}get bytes(){return new Uint8Array(this._bytes)}static fromCBOR(u){return Signature.decode(CborDeserializer.readByteString(u))}static decode(u){if(u.length!==65)throw new Error("Signature must contain signature and recovery byte.");return new Signature(u.slice(0,-1),u[u.length-1])}static fromJSON(u){return Signature.decode(HexConverter.decode(u))}toJSON(){return HexConverter.encode(this.encode())}toCBOR(){return CborSerializer.encodeByteString(this.encode())}encode(){return new Uint8Array([...this._bytes,this.recovery])}toString(){return`${HexConverter.encode(this.encode())}`}}const _0n$c=BigInt(0),_1n$c=BigInt(1);function abool$3(y,u=""){if(typeof y!="boolean"){const g=u&&`"${u}" `;throw new Error(g+"expected boolean, got type="+typeof y)}return y}function abignumber$2(y){if(typeof y=="bigint"){if(!isPosBig$3(y))throw new Error("positive bigint expected, got "+y)}else anumber$6(y);return y}function numberToHexUnpadded$2(y){const u=abignumber$2(y).toString(16);return u.length&1?"0"+u:u}function hexToNumber$3(y){if(typeof y!="string")throw new Error("hex string expected, got "+typeof y);return y===""?_0n$c:BigInt("0x"+y)}function bytesToNumberBE$2(y){return hexToNumber$3(bytesToHex$6(y))}function bytesToNumberLE$3(y){return hexToNumber$3(bytesToHex$6(copyBytes$4(abytes$7(y)).reverse()))}function numberToBytesBE$3(y,u){anumber$6(u),y=abignumber$2(y);const g=hexToBytes$5(y.toString(16).padStart(u*2,"0"));if(g.length!==u)throw new Error("number too large");return g}function numberToBytesLE$3(y,u){return numberToBytesBE$3(y,u).reverse()}function copyBytes$4(y){return Uint8Array.from(y)}const isPosBig$3=y=>typeof y=="bigint"&&_0n$c<=y;function inRange$3(y,u,g){return isPosBig$3(y)&&isPosBig$3(u)&&isPosBig$3(g)&&u<=y&&y<g}function aInRange$3(y,u,g,v){if(!inRange$3(u,g,v))throw new Error("expected valid "+y+": "+g+" <= n < "+v+", got "+u)}function bitLen$2(y){let u;for(u=0;y>_0n$c;y>>=_1n$c,u+=1);return u}const bitMask$2=y=>(_1n$c<<BigInt(y))-_1n$c;function createHmacDrbg$2(y,u,g){if(anumber$6(y,"hashLen"),anumber$6(u,"qByteLen"),typeof g!="function")throw new Error("hmacFn must be a function");const v=q=>new Uint8Array(q),b=Uint8Array.of(),w=Uint8Array.of(0),E=Uint8Array.of(1),S=1e3;let A=v(y),$=v(y),R=0;const T=()=>{A.fill(1),$.fill(0),R=0},O=(...q)=>g($,concatBytes$3(A,...q)),B=(q=b)=>{$=O(w,q),A=O(),q.length!==0&&($=O(E,q),A=O())},F=()=>{if(R++>=S)throw new Error("drbg: tried max amount of iterations");let q=0;const J=[];for(;q<u;){A=O();const ie=A.slice();J.push(ie),q+=A.length}return concatBytes$3(...J)};return(q,J)=>{T(),B(q);let ie;for(;!(ie=J(F()));)B();return T(),ie}}function validateObject$2(y,u={},g={}){if(!y||typeof y!="object")throw new Error("expected valid options object");function v(w,E,S){const A=y[w];if(S&&A===void 0)return;const $=typeof A;if($!==E||A===null)throw new Error(`param "${w}" is invalid: expected ${E}, got ${$}`)}const b=(w,E)=>Object.entries(w).forEach(([S,A])=>v(S,A,E));b(u,!1),b(g,!0)}function memoized$2(y){const u=new WeakMap;return(g,...v)=>{const b=u.get(g);if(b!==void 0)return b;const w=y(g,...v);return u.set(g,w),w}}const _0n$b=BigInt(0),_1n$b=BigInt(1),_2n$a=BigInt(2),_3n$5=BigInt(3),_4n$4=BigInt(4),_5n$4=BigInt(5),_7n$2=BigInt(7),_8n$4=BigInt(8),_9n$2=BigInt(9),_16n$2=BigInt(16);function mod$3(y,u){const g=y%u;return g>=_0n$b?g:u+g}function pow2$4(y,u,g){let v=y;for(;u-- >_0n$b;)v*=v,v%=g;return v}function invert$3(y,u){if(y===_0n$b)throw new Error("invert: expected non-zero number");if(u<=_0n$b)throw new Error("invert: expected positive modulus, got "+u);let g=mod$3(y,u),v=u,b=_0n$b,w=_1n$b;for(;g!==_0n$b;){const S=v/g,A=v%g,$=b-w*S;v=g,g=A,b=w,w=$}if(v!==_1n$b)throw new Error("invert: does not exist");return mod$3(b,u)}function assertIsSquare$2(y,u,g){if(!y.eql(y.sqr(u),g))throw new Error("Cannot find square root")}function sqrt3mod4$2(y,u){const g=(y.ORDER+_1n$b)/_4n$4,v=y.pow(u,g);return assertIsSquare$2(y,v,u),v}function sqrt5mod8$2(y,u){const g=(y.ORDER-_5n$4)/_8n$4,v=y.mul(u,_2n$a),b=y.pow(v,g),w=y.mul(u,b),E=y.mul(y.mul(w,_2n$a),b),S=y.mul(w,y.sub(E,y.ONE));return assertIsSquare$2(y,S,u),S}function sqrt9mod16$2(y){const u=Field$2(y),g=tonelliShanks$2(y),v=g(u,u.neg(u.ONE)),b=g(u,v),w=g(u,u.neg(v)),E=(y+_7n$2)/_16n$2;return(S,A)=>{let $=S.pow(A,E),R=S.mul($,v);const T=S.mul($,b),O=S.mul($,w),B=S.eql(S.sqr(R),A),F=S.eql(S.sqr(T),A);$=S.cmov($,R,B),R=S.cmov(O,T,F);const U=S.eql(S.sqr(R),A),q=S.cmov($,R,U);return assertIsSquare$2(S,q,A),q}}function tonelliShanks$2(y){if(y<_3n$5)throw new Error("sqrt is not defined for small field");let u=y-_1n$b,g=0;for(;u%_2n$a===_0n$b;)u/=_2n$a,g++;let v=_2n$a;const b=Field$2(y);for(;FpLegendre$2(b,v)===1;)if(v++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(g===1)return sqrt3mod4$2;let w=b.pow(v,u);const E=(u+_1n$b)/_2n$a;return function(A,$){if(A.is0($))return $;if(FpLegendre$2(A,$)!==1)throw new Error("Cannot find square root");let R=g,T=A.mul(A.ONE,w),O=A.pow($,u),B=A.pow($,E);for(;!A.eql(O,A.ONE);){if(A.is0(O))return A.ZERO;let F=1,U=A.sqr(O);for(;!A.eql(U,A.ONE);)if(F++,U=A.sqr(U),F===R)throw new Error("Cannot find square root");const q=_1n$b<<BigInt(R-F-1),J=A.pow(T,q);R=F,T=A.sqr(J),O=A.mul(O,T),B=A.mul(B,J)}return B}}function FpSqrt$2(y){return y%_4n$4===_3n$5?sqrt3mod4$2:y%_8n$4===_5n$4?sqrt5mod8$2:y%_16n$2===_9n$2?sqrt9mod16$2(y):tonelliShanks$2(y)}const FIELD_FIELDS$2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$2(y){const u={ORDER:"bigint",BYTES:"number",BITS:"number"},g=FIELD_FIELDS$2.reduce((v,b)=>(v[b]="function",v),u);return validateObject$2(y,g),y}function FpPow$2(y,u,g){if(g<_0n$b)throw new Error("invalid exponent, negatives unsupported");if(g===_0n$b)return y.ONE;if(g===_1n$b)return u;let v=y.ONE,b=u;for(;g>_0n$b;)g&_1n$b&&(v=y.mul(v,b)),b=y.sqr(b),g>>=_1n$b;return v}function FpInvertBatch$2(y,u,g=!1){const v=new Array(u.length).fill(g?y.ZERO:void 0),b=u.reduce((E,S,A)=>y.is0(S)?E:(v[A]=E,y.mul(E,S)),y.ONE),w=y.inv(b);return u.reduceRight((E,S,A)=>y.is0(S)?E:(v[A]=y.mul(E,v[A]),y.mul(E,S)),w),v}function FpLegendre$2(y,u){const g=(y.ORDER-_1n$b)/_2n$a,v=y.pow(u,g),b=y.eql(v,y.ONE),w=y.eql(v,y.ZERO),E=y.eql(v,y.neg(y.ONE));if(!b&&!w&&!E)throw new Error("invalid Legendre symbol result");return b?1:w?0:-1}function nLength$2(y,u){u!==void 0&&anumber$6(u);const g=u!==void 0?u:y.toString(2).length,v=Math.ceil(g/8);return{nBitLength:g,nByteLength:v}}let _Field$1=class{ORDER;BITS;BYTES;isLE;ZERO=_0n$b;ONE=_1n$b;_lengths;_sqrt;_mod;constructor(u,g={}){if(u<=_0n$b)throw new Error("invalid field: expected ORDER > 0, got "+u);let v;this.isLE=!1,g!=null&&typeof g=="object"&&(typeof g.BITS=="number"&&(v=g.BITS),typeof g.sqrt=="function"&&(this.sqrt=g.sqrt),typeof g.isLE=="boolean"&&(this.isLE=g.isLE),g.allowedLengths&&(this._lengths=g.allowedLengths?.slice()),typeof g.modFromBytes=="boolean"&&(this._mod=g.modFromBytes));const{nBitLength:b,nByteLength:w}=nLength$2(u,v);if(w>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=u,this.BITS=b,this.BYTES=w,this._sqrt=void 0,Object.preventExtensions(this)}create(u){return mod$3(u,this.ORDER)}isValid(u){if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return _0n$b<=u&&u<this.ORDER}is0(u){return u===_0n$b}isValidNot0(u){return!this.is0(u)&&this.isValid(u)}isOdd(u){return(u&_1n$b)===_1n$b}neg(u){return mod$3(-u,this.ORDER)}eql(u,g){return u===g}sqr(u){return mod$3(u*u,this.ORDER)}add(u,g){return mod$3(u+g,this.ORDER)}sub(u,g){return mod$3(u-g,this.ORDER)}mul(u,g){return mod$3(u*g,this.ORDER)}pow(u,g){return FpPow$2(this,u,g)}div(u,g){return mod$3(u*invert$3(g,this.ORDER),this.ORDER)}sqrN(u){return u*u}addN(u,g){return u+g}subN(u,g){return u-g}mulN(u,g){return u*g}inv(u){return invert$3(u,this.ORDER)}sqrt(u){return this._sqrt||(this._sqrt=FpSqrt$2(this.ORDER)),this._sqrt(this,u)}toBytes(u){return this.isLE?numberToBytesLE$3(u,this.BYTES):numberToBytesBE$3(u,this.BYTES)}fromBytes(u,g=!1){abytes$7(u);const{_lengths:v,BYTES:b,isLE:w,ORDER:E,_mod:S}=this;if(v){if(!v.includes(u.length)||u.length>b)throw new Error("Field.fromBytes: expected "+v+" bytes, got "+u.length);const $=new Uint8Array(b);$.set(u,w?0:$.length-u.length),u=$}if(u.length!==b)throw new Error("Field.fromBytes: expected "+b+" bytes, got "+u.length);let A=w?bytesToNumberLE$3(u):bytesToNumberBE$2(u);if(S&&(A=mod$3(A,E)),!g&&!this.isValid(A))throw new Error("invalid field element: outside of range 0..ORDER");return A}invertBatch(u){return FpInvertBatch$2(this,u)}cmov(u,g,v){return v?g:u}};function Field$2(y,u={}){return new _Field$1(y,u)}function getFieldBytesLength$2(y){if(typeof y!="bigint")throw new Error("field order must be bigint");const u=y.toString(2).length;return Math.ceil(u/8)}function getMinHashLength$2(y){const u=getFieldBytesLength$2(y);return u+Math.ceil(u/2)}function mapHashToField$2(y,u,g=!1){abytes$7(y);const v=y.length,b=getFieldBytesLength$2(u),w=getMinHashLength$2(u);if(v<16||v<w||v>1024)throw new Error("expected "+w+"-1024 bytes of input, got "+v);const E=g?bytesToNumberLE$3(y):bytesToNumberBE$2(y),S=mod$3(E,u-_1n$b)+_1n$b;return g?numberToBytesLE$3(S,b):numberToBytesBE$3(S,b)}const _0n$a=BigInt(0),_1n$a=BigInt(1);function negateCt$2(y,u){const g=u.negate();return y?g:u}function normalizeZ$2(y,u){const g=FpInvertBatch$2(y.Fp,u.map(v=>v.Z));return u.map((v,b)=>y.fromAffine(v.toAffine(g[b])))}function validateW$2(y,u){if(!Number.isSafeInteger(y)||y<=0||y>u)throw new Error("invalid window size, expected [1.."+u+"], got W="+y)}function calcWOpts$2(y,u){validateW$2(y,u);const g=Math.ceil(u/y)+1,v=2**(y-1),b=2**y,w=bitMask$2(y),E=BigInt(y);return{windows:g,windowSize:v,mask:w,maxNumber:b,shiftBy:E}}function calcOffsets$2(y,u,g){const{windowSize:v,mask:b,maxNumber:w,shiftBy:E}=g;let S=Number(y&b),A=y>>E;S>v&&(S-=w,A+=_1n$a);const $=u*v,R=$+Math.abs(S)-1,T=S===0,O=S<0,B=u%2!==0;return{nextN:A,offset:R,isZero:T,isNeg:O,isNegF:B,offsetF:$}}const pointPrecomputes$2=new WeakMap,pointWindowSizes$2=new WeakMap;function getW$2(y){return pointWindowSizes$2.get(y)||1}function assert0$2(y){if(y!==_0n$a)throw new Error("invalid wNAF")}let wNAF$3=class{BASE;ZERO;Fn;bits;constructor(u,g){this.BASE=u.BASE,this.ZERO=u.ZERO,this.Fn=u.Fn,this.bits=g}_unsafeLadder(u,g,v=this.ZERO){let b=u;for(;g>_0n$a;)g&_1n$a&&(v=v.add(b)),b=b.double(),g>>=_1n$a;return v}precomputeWindow(u,g){const{windows:v,windowSize:b}=calcWOpts$2(g,this.bits),w=[];let E=u,S=E;for(let A=0;A<v;A++){S=E,w.push(S);for(let $=1;$<b;$++)S=S.add(E),w.push(S);E=S.double()}return w}wNAF(u,g,v){if(!this.Fn.isValid(v))throw new Error("invalid scalar");let b=this.ZERO,w=this.BASE;const E=calcWOpts$2(u,this.bits);for(let S=0;S<E.windows;S++){const{nextN:A,offset:$,isZero:R,isNeg:T,isNegF:O,offsetF:B}=calcOffsets$2(v,S,E);v=A,R?w=w.add(negateCt$2(O,g[B])):b=b.add(negateCt$2(T,g[$]))}return assert0$2(v),{p:b,f:w}}wNAFUnsafe(u,g,v,b=this.ZERO){const w=calcWOpts$2(u,this.bits);for(let E=0;E<w.windows&&v!==_0n$a;E++){const{nextN:S,offset:A,isZero:$,isNeg:R}=calcOffsets$2(v,E,w);if(v=S,!$){const T=g[A];b=b.add(R?T.negate():T)}}return assert0$2(v),b}getPrecomputes(u,g,v){let b=pointPrecomputes$2.get(g);return b||(b=this.precomputeWindow(g,u),u!==1&&(typeof v=="function"&&(b=v(b)),pointPrecomputes$2.set(g,b))),b}cached(u,g,v){const b=getW$2(u);return this.wNAF(b,this.getPrecomputes(b,u,v),g)}unsafe(u,g,v,b){const w=getW$2(u);return w===1?this._unsafeLadder(u,g,b):this.wNAFUnsafe(w,this.getPrecomputes(w,u,v),g,b)}createCache(u,g){validateW$2(g,this.bits),pointWindowSizes$2.set(u,g),pointPrecomputes$2.delete(u)}hasCache(u){return getW$2(u)!==1}};function mulEndoUnsafe$2(y,u,g,v){let b=u,w=y.ZERO,E=y.ZERO;for(;g>_0n$a||v>_0n$a;)g&_1n$a&&(w=w.add(b)),v&_1n$a&&(E=E.add(b)),b=b.double(),g>>=_1n$a,v>>=_1n$a;return{p1:w,p2:E}}function createField$2(y,u,g){if(u){if(u.ORDER!==y)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return validateField$2(u),u}else return Field$2(y,{isLE:g})}function createCurveFields$1(y,u,g={},v){if(v===void 0&&(v=y==="edwards"),!u||typeof u!="object")throw new Error(`expected valid ${y} CURVE object`);for(const A of["p","n","h"]){const $=u[A];if(!(typeof $=="bigint"&&$>_0n$a))throw new Error(`CURVE.${A} must be positive bigint`)}const b=createField$2(u.p,g.Fp,v),w=createField$2(u.n,g.Fn,v),S=["Gx","Gy","a","b"];for(const A of S)if(!b.isValid(u[A]))throw new Error(`CURVE.${A} must be valid field element of CURVE.Fp`);return u=Object.freeze(Object.assign({},u)),{CURVE:u,Fp:b,Fn:w}}function createKeygen$2(y,u){return function(v){const b=y(v);return{secretKey:b,publicKey:u(b)}}}let _HMAC$3=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(u,g){if(ahash$5(u),abytes$7(g,void 0,"key"),this.iHash=u.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const v=this.blockLen,b=new Uint8Array(v);b.set(g.length>v?u.create().update(g).digest():g);for(let w=0;w<b.length;w++)b[w]^=54;this.iHash.update(b),this.oHash=u.create();for(let w=0;w<b.length;w++)b[w]^=106;this.oHash.update(b),clean$6(b)}update(u){return aexists$6(this),this.iHash.update(u),this}digestInto(u){aexists$6(this),abytes$7(u,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(u),this.oHash.update(u),this.oHash.digestInto(u),this.destroy()}digest(){const u=new Uint8Array(this.oHash.outputLen);return this.digestInto(u),u}_cloneInto(u){u||=Object.create(Object.getPrototypeOf(this),{});const{oHash:g,iHash:v,finished:b,destroyed:w,blockLen:E,outputLen:S}=this;return u=u,u.finished=b,u.destroyed=w,u.blockLen=E,u.outputLen=S,u.oHash=g._cloneInto(u.oHash),u.iHash=v._cloneInto(u.iHash),u}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$9=(y,u,g)=>new _HMAC$3(y,u).update(g).digest();hmac$9.create=(y,u)=>new _HMAC$3(y,u);const divNearest$2=(y,u)=>(y+(y>=0?u:-u)/_2n$9)/u;function _splitEndoScalar$2(y,u,g){const[[v,b],[w,E]]=u,S=divNearest$2(E*y,g),A=divNearest$2(-b*y,g);let $=y-S*v-A*w,R=-S*b-A*E;const T=$<_0n$9,O=R<_0n$9;T&&($=-$),O&&(R=-R);const B=bitMask$2(Math.ceil(bitLen$2(g)/2))+_1n$9;if($<_0n$9||$>=B||R<_0n$9||R>=B)throw new Error("splitScalar (endomorphism): failed, k="+y);return{k1neg:T,k1:$,k2neg:O,k2:R}}function validateSigFormat$2(y){if(!["compact","recovered","der"].includes(y))throw new Error('Signature format must be "compact", "recovered", or "der"');return y}function validateSigOpts$2(y,u){const g={};for(let v of Object.keys(u))g[v]=y[v]===void 0?u[v]:y[v];return abool$3(g.lowS,"lowS"),abool$3(g.prehash,"prehash"),g.format!==void 0&&validateSigFormat$2(g.format),g}let DERErr$2=class extends Error{constructor(u=""){super(u)}};const DER$2={Err:DERErr$2,_tlv:{encode:(y,u)=>{const{Err:g}=DER$2;if(y<0||y>256)throw new g("tlv.encode: wrong tag");if(u.length&1)throw new g("tlv.encode: unpadded data");const v=u.length/2,b=numberToHexUnpadded$2(v);if(b.length/2&128)throw new g("tlv.encode: long form length too big");const w=v>127?numberToHexUnpadded$2(b.length/2|128):"";return numberToHexUnpadded$2(y)+w+b+u},decode(y,u){const{Err:g}=DER$2;let v=0;if(y<0||y>256)throw new g("tlv.encode: wrong tag");if(u.length<2||u[v++]!==y)throw new g("tlv.decode: wrong tlv");const b=u[v++],w=!!(b&128);let E=0;if(!w)E=b;else{const A=b&127;if(!A)throw new g("tlv.decode(long): indefinite length not supported");if(A>4)throw new g("tlv.decode(long): byte length is too big");const $=u.subarray(v,v+A);if($.length!==A)throw new g("tlv.decode: length bytes not complete");if($[0]===0)throw new g("tlv.decode(long): zero leftmost byte");for(const R of $)E=E<<8|R;if(v+=A,E<128)throw new g("tlv.decode(long): not minimal encoding")}const S=u.subarray(v,v+E);if(S.length!==E)throw new g("tlv.decode: wrong value length");return{v:S,l:u.subarray(v+E)}}},_int:{encode(y){const{Err:u}=DER$2;if(y<_0n$9)throw new u("integer: negative integers are not allowed");let g=numberToHexUnpadded$2(y);if(Number.parseInt(g[0],16)&8&&(g="00"+g),g.length&1)throw new u("unexpected DER parsing assertion: unpadded hex");return g},decode(y){const{Err:u}=DER$2;if(y[0]&128)throw new u("invalid signature integer: negative");if(y[0]===0&&!(y[1]&128))throw new u("invalid signature integer: unnecessary leading zero");return bytesToNumberBE$2(y)}},toSig(y){const{Err:u,_int:g,_tlv:v}=DER$2,b=abytes$7(y,void 0,"signature"),{v:w,l:E}=v.decode(48,b);if(E.length)throw new u("invalid signature: left bytes after parsing");const{v:S,l:A}=v.decode(2,w),{v:$,l:R}=v.decode(2,A);if(R.length)throw new u("invalid signature: left bytes after parsing");return{r:g.decode(S),s:g.decode($)}},hexFromSig(y){const{_tlv:u,_int:g}=DER$2,v=u.encode(2,g.encode(y.r)),b=u.encode(2,g.encode(y.s)),w=v+b;return u.encode(48,w)}},_0n$9=BigInt(0),_1n$9=BigInt(1),_2n$9=BigInt(2),_3n$4=BigInt(3),_4n$3=BigInt(4);function weierstrass$2(y,u={}){const g=createCurveFields$1("weierstrass",y,u),{Fp:v,Fn:b}=g;let w=g.CURVE;const{h:E,n:S}=w;validateObject$2(u,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});const{endo:A}=u;if(A&&(!v.is0(w.a)||typeof A.beta!="bigint"||!Array.isArray(A.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const $=getWLengths$2(v,b);function R(){if(!v.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function T(ae,Q,j){const{x:z,y:re}=Q.toAffine(),Y=v.toBytes(z);if(abool$3(j,"isCompressed"),j){R();const te=!v.isOdd(re);return concatBytes$3(pprefix$2(te),Y)}else return concatBytes$3(Uint8Array.of(4),Y,v.toBytes(re))}function O(ae){abytes$7(ae,void 0,"Point");const{publicKey:Q,publicKeyUncompressed:j}=$,z=ae.length,re=ae[0],Y=ae.subarray(1);if(z===Q&&(re===2||re===3)){const te=v.fromBytes(Y);if(!v.isValid(te))throw new Error("bad point: is not on curve, wrong x");const ne=U(te);let se;try{se=v.sqrt(ne)}catch(ue){const _e=ue instanceof Error?": "+ue.message:"";throw new Error("bad point: is not on curve, sqrt error"+_e)}R();const ee=v.isOdd(se);return(re&1)===1!==ee&&(se=v.neg(se)),{x:te,y:se}}else if(z===j&&re===4){const te=v.BYTES,ne=v.fromBytes(Y.subarray(0,te)),se=v.fromBytes(Y.subarray(te,te*2));if(!q(ne,se))throw new Error("bad point: is not on curve");return{x:ne,y:se}}else throw new Error(`bad point: got length ${z}, expected compressed=${Q} or uncompressed=${j}`)}const B=u.toBytes||T,F=u.fromBytes||O;function U(ae){const Q=v.sqr(ae),j=v.mul(Q,ae);return v.add(v.add(j,v.mul(ae,w.a)),w.b)}function q(ae,Q){const j=v.sqr(Q),z=U(ae);return v.eql(j,z)}if(!q(w.Gx,w.Gy))throw new Error("bad curve params: generator point");const J=v.mul(v.pow(w.a,_3n$4),_4n$3),ie=v.mul(v.sqr(w.b),BigInt(27));if(v.is0(v.add(J,ie)))throw new Error("bad curve params: a or b");function oe(ae,Q,j=!1){if(!v.isValid(Q)||j&&v.is0(Q))throw new Error(`bad point coordinate ${ae}`);return Q}function le(ae){if(!(ae instanceof pe))throw new Error("Weierstrass Point expected")}function de(ae){if(!A||!A.basises)throw new Error("no endo");return _splitEndoScalar$2(ae,A.basises,b.ORDER)}const fe=memoized$2((ae,Q)=>{const{X:j,Y:z,Z:re}=ae;if(v.eql(re,v.ONE))return{x:j,y:z};const Y=ae.is0();Q==null&&(Q=Y?v.ONE:v.inv(re));const te=v.mul(j,Q),ne=v.mul(z,Q),se=v.mul(re,Q);if(Y)return{x:v.ZERO,y:v.ZERO};if(!v.eql(se,v.ONE))throw new Error("invZ was invalid");return{x:te,y:ne}}),ye=memoized$2(ae=>{if(ae.is0()){if(u.allowInfinityPoint&&!v.is0(ae.Y))return;throw new Error("bad point: ZERO")}const{x:Q,y:j}=ae.toAffine();if(!v.isValid(Q)||!v.isValid(j))throw new Error("bad point: x or y not field elements");if(!q(Q,j))throw new Error("bad point: equation left != right");if(!ae.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function we(ae,Q,j,z,re){return j=new pe(v.mul(j.X,ae),j.Y,j.Z),Q=negateCt$2(z,Q),j=negateCt$2(re,j),Q.add(j)}class pe{static BASE=new pe(w.Gx,w.Gy,v.ONE);static ZERO=new pe(v.ZERO,v.ONE,v.ZERO);static Fp=v;static Fn=b;X;Y;Z;constructor(Q,j,z){this.X=oe("x",Q),this.Y=oe("y",j,!0),this.Z=oe("z",z),Object.freeze(this)}static CURVE(){return w}static fromAffine(Q){const{x:j,y:z}=Q||{};if(!Q||!v.isValid(j)||!v.isValid(z))throw new Error("invalid affine point");if(Q instanceof pe)throw new Error("projective point not allowed");return v.is0(j)&&v.is0(z)?pe.ZERO:new pe(j,z,v.ONE)}static fromBytes(Q){const j=pe.fromAffine(F(abytes$7(Q,void 0,"point")));return j.assertValidity(),j}static fromHex(Q){return pe.fromBytes(hexToBytes$5(Q))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(Q=8,j=!0){return he.createCache(this,Q),j||this.multiply(_3n$4),this}assertValidity(){ye(this)}hasEvenY(){const{y:Q}=this.toAffine();if(!v.isOdd)throw new Error("Field doesn't support isOdd");return!v.isOdd(Q)}equals(Q){le(Q);const{X:j,Y:z,Z:re}=this,{X:Y,Y:te,Z:ne}=Q,se=v.eql(v.mul(j,ne),v.mul(Y,re)),ee=v.eql(v.mul(z,ne),v.mul(te,re));return se&&ee}negate(){return new pe(this.X,v.neg(this.Y),this.Z)}double(){const{a:Q,b:j}=w,z=v.mul(j,_3n$4),{X:re,Y,Z:te}=this;let ne=v.ZERO,se=v.ZERO,ee=v.ZERO,Z=v.mul(re,re),ue=v.mul(Y,Y),_e=v.mul(te,te),Re=v.mul(re,Y);return Re=v.add(Re,Re),ee=v.mul(re,te),ee=v.add(ee,ee),ne=v.mul(Q,ee),se=v.mul(z,_e),se=v.add(ne,se),ne=v.sub(ue,se),se=v.add(ue,se),se=v.mul(ne,se),ne=v.mul(Re,ne),ee=v.mul(z,ee),_e=v.mul(Q,_e),Re=v.sub(Z,_e),Re=v.mul(Q,Re),Re=v.add(Re,ee),ee=v.add(Z,Z),Z=v.add(ee,Z),Z=v.add(Z,_e),Z=v.mul(Z,Re),se=v.add(se,Z),_e=v.mul(Y,te),_e=v.add(_e,_e),Z=v.mul(_e,Re),ne=v.sub(ne,Z),ee=v.mul(_e,ue),ee=v.add(ee,ee),ee=v.add(ee,ee),new pe(ne,se,ee)}add(Q){le(Q);const{X:j,Y:z,Z:re}=this,{X:Y,Y:te,Z:ne}=Q;let se=v.ZERO,ee=v.ZERO,Z=v.ZERO;const ue=w.a,_e=v.mul(w.b,_3n$4);let Re=v.mul(j,Y),Ae=v.mul(z,te),ge=v.mul(re,ne),be=v.add(j,z),Te=v.add(Y,te);be=v.mul(be,Te),Te=v.add(Re,Ae),be=v.sub(be,Te),Te=v.add(j,re);let De=v.add(Y,ne);return Te=v.mul(Te,De),De=v.add(Re,ge),Te=v.sub(Te,De),De=v.add(z,re),se=v.add(te,ne),De=v.mul(De,se),se=v.add(Ae,ge),De=v.sub(De,se),Z=v.mul(ue,Te),se=v.mul(_e,ge),Z=v.add(se,Z),se=v.sub(Ae,Z),Z=v.add(Ae,Z),ee=v.mul(se,Z),Ae=v.add(Re,Re),Ae=v.add(Ae,Re),ge=v.mul(ue,ge),Te=v.mul(_e,Te),Ae=v.add(Ae,ge),ge=v.sub(Re,ge),ge=v.mul(ue,ge),Te=v.add(Te,ge),Re=v.mul(Ae,Te),ee=v.add(ee,Re),Re=v.mul(De,Te),se=v.mul(be,se),se=v.sub(se,Re),Re=v.mul(be,Ae),Z=v.mul(De,Z),Z=v.add(Z,Re),new pe(se,ee,Z)}subtract(Q){return this.add(Q.negate())}is0(){return this.equals(pe.ZERO)}multiply(Q){const{endo:j}=u;if(!b.isValidNot0(Q))throw new Error("invalid scalar: out of range");let z,re;const Y=te=>he.cached(this,te,ne=>normalizeZ$2(pe,ne));if(j){const{k1neg:te,k1:ne,k2neg:se,k2:ee}=de(Q),{p:Z,f:ue}=Y(ne),{p:_e,f:Re}=Y(ee);re=ue.add(Re),z=we(j.beta,Z,_e,te,se)}else{const{p:te,f:ne}=Y(Q);z=te,re=ne}return normalizeZ$2(pe,[z,re])[0]}multiplyUnsafe(Q){const{endo:j}=u,z=this;if(!b.isValid(Q))throw new Error("invalid scalar: out of range");if(Q===_0n$9||z.is0())return pe.ZERO;if(Q===_1n$9)return z;if(he.hasCache(this))return this.multiply(Q);if(j){const{k1neg:re,k1:Y,k2neg:te,k2:ne}=de(Q),{p1:se,p2:ee}=mulEndoUnsafe$2(pe,z,Y,ne);return we(j.beta,se,ee,re,te)}else return he.unsafe(z,Q)}toAffine(Q){return fe(this,Q)}isTorsionFree(){const{isTorsionFree:Q}=u;return E===_1n$9?!0:Q?Q(pe,this):he.unsafe(this,S).is0()}clearCofactor(){const{clearCofactor:Q}=u;return E===_1n$9?this:Q?Q(pe,this):this.multiplyUnsafe(E)}isSmallOrder(){return this.multiplyUnsafe(E).is0()}toBytes(Q=!0){return abool$3(Q,"isCompressed"),this.assertValidity(),B(pe,this,Q)}toHex(Q=!0){return bytesToHex$6(this.toBytes(Q))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}const ve=b.BITS,he=new wNAF$3(pe,u.endo?Math.ceil(ve/2):ve);return pe.BASE.precompute(8),pe}function pprefix$2(y){return Uint8Array.of(y?2:3)}function getWLengths$2(y,u){return{secretKey:u.BYTES,publicKey:1+y.BYTES,publicKeyUncompressed:1+2*y.BYTES,publicKeyHasPrefix:!0,signature:2*u.BYTES}}function ecdh$2(y,u={}){const{Fn:g}=y,v=u.randomBytes||randomBytes$4,b=Object.assign(getWLengths$2(y.Fp,g),{seed:getMinHashLength$2(g.ORDER)});function w(B){try{const F=g.fromBytes(B);return g.isValidNot0(F)}catch{return!1}}function E(B,F){const{publicKey:U,publicKeyUncompressed:q}=b;try{const J=B.length;return F===!0&&J!==U||F===!1&&J!==q?!1:!!y.fromBytes(B)}catch{return!1}}function S(B=v(b.seed)){return mapHashToField$2(abytes$7(B,b.seed,"seed"),g.ORDER)}function A(B,F=!0){return y.BASE.multiply(g.fromBytes(B)).toBytes(F)}function $(B){const{secretKey:F,publicKey:U,publicKeyUncompressed:q}=b;if(!isBytes$8(B)||"_lengths"in g&&g._lengths||F===U)return;const J=abytes$7(B,void 0,"key").length;return J===U||J===q}function R(B,F,U=!0){if($(B)===!0)throw new Error("first arg must be private key");if($(F)===!1)throw new Error("second arg must be public key");const q=g.fromBytes(B);return y.fromBytes(F).multiply(q).toBytes(U)}const T={isValidSecretKey:w,isValidPublicKey:E,randomSecretKey:S},O=createKeygen$2(S,A);return Object.freeze({getPublicKey:A,getSharedSecret:R,keygen:O,Point:y,utils:T,lengths:b})}function ecdsa$2(y,u,g={}){ahash$5(u),validateObject$2(g,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),g=Object.assign({},g);const v=g.randomBytes||randomBytes$4,b=g.hmac||((j,z)=>hmac$9(u,j,z)),{Fp:w,Fn:E}=y,{ORDER:S,BITS:A}=E,{keygen:$,getPublicKey:R,getSharedSecret:T,utils:O,lengths:B}=ecdh$2(y,g),F={prehash:!0,lowS:typeof g.lowS=="boolean"?g.lowS:!0,format:"compact",extraEntropy:!1},U=S*_2n$9<w.ORDER;function q(j){const z=S>>_1n$9;return j>z}function J(j,z){if(!E.isValidNot0(z))throw new Error(`invalid signature ${j}: out of range 1..Point.Fn.ORDER`);return z}function ie(){if(U)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function oe(j,z){validateSigFormat$2(z);const re=B.signature,Y=z==="compact"?re:z==="recovered"?re+1:void 0;return abytes$7(j,Y)}class le{r;s;recovery;constructor(z,re,Y){if(this.r=J("r",z),this.s=J("s",re),Y!=null){if(ie(),![0,1,2,3].includes(Y))throw new Error("invalid recovery id");this.recovery=Y}Object.freeze(this)}static fromBytes(z,re=F.format){oe(z,re);let Y;if(re==="der"){const{r:ee,s:Z}=DER$2.toSig(abytes$7(z));return new le(ee,Z)}re==="recovered"&&(Y=z[0],re="compact",z=z.subarray(1));const te=B.signature/2,ne=z.subarray(0,te),se=z.subarray(te,te*2);return new le(E.fromBytes(ne),E.fromBytes(se),Y)}static fromHex(z,re){return this.fromBytes(hexToBytes$5(z),re)}assertRecovery(){const{recovery:z}=this;if(z==null)throw new Error("invalid recovery id: must be present");return z}addRecoveryBit(z){return new le(this.r,this.s,z)}recoverPublicKey(z){const{r:re,s:Y}=this,te=this.assertRecovery(),ne=te===2||te===3?re+S:re;if(!w.isValid(ne))throw new Error("invalid recovery id: sig.r+curve.n != R.x");const se=w.toBytes(ne),ee=y.fromBytes(concatBytes$3(pprefix$2((te&1)===0),se)),Z=E.inv(ne),ue=fe(abytes$7(z,void 0,"msgHash")),_e=E.create(-ue*Z),Re=E.create(Y*Z),Ae=y.BASE.multiplyUnsafe(_e).add(ee.multiplyUnsafe(Re));if(Ae.is0())throw new Error("invalid recovery: point at infinify");return Ae.assertValidity(),Ae}hasHighS(){return q(this.s)}toBytes(z=F.format){if(validateSigFormat$2(z),z==="der")return hexToBytes$5(DER$2.hexFromSig(this));const{r:re,s:Y}=this,te=E.toBytes(re),ne=E.toBytes(Y);return z==="recovered"?(ie(),concatBytes$3(Uint8Array.of(this.assertRecovery()),te,ne)):concatBytes$3(te,ne)}toHex(z){return bytesToHex$6(this.toBytes(z))}}const de=g.bits2int||function(z){if(z.length>8192)throw new Error("input is too large");const re=bytesToNumberBE$2(z),Y=z.length*8-A;return Y>0?re>>BigInt(Y):re},fe=g.bits2int_modN||function(z){return E.create(de(z))},ye=bitMask$2(A);function we(j){return aInRange$3("num < 2^"+A,j,_0n$9,ye),E.toBytes(j)}function pe(j,z){return abytes$7(j,void 0,"message"),z?abytes$7(u(j),void 0,"prehashed message"):j}function ve(j,z,re){const{lowS:Y,prehash:te,extraEntropy:ne}=validateSigOpts$2(re,F);j=pe(j,te);const se=fe(j),ee=E.fromBytes(z);if(!E.isValidNot0(ee))throw new Error("invalid private key");const Z=[we(ee),we(se)];if(ne!=null&&ne!==!1){const Ae=ne===!0?v(B.secretKey):ne;Z.push(abytes$7(Ae,void 0,"extraEntropy"))}const ue=concatBytes$3(...Z),_e=se;function Re(Ae){const ge=de(Ae);if(!E.isValidNot0(ge))return;const be=E.inv(ge),Te=y.BASE.multiply(ge).toAffine(),De=E.create(Te.x);if(De===_0n$9)return;const Ie=E.create(be*E.create(_e+De*ee));if(Ie===_0n$9)return;let Se=(Te.x===De?0:2)|Number(Te.y&_1n$9),Be=Ie;return Y&&q(Ie)&&(Be=E.neg(Ie),Se^=1),new le(De,Be,U?void 0:Se)}return{seed:ue,k2sig:Re}}function he(j,z,re={}){const{seed:Y,k2sig:te}=ve(j,z,re);return createHmacDrbg$2(u.outputLen,E.BYTES,b)(Y,te).toBytes(re.format)}function ae(j,z,re,Y={}){const{lowS:te,prehash:ne,format:se}=validateSigOpts$2(Y,F);if(re=abytes$7(re,void 0,"publicKey"),z=pe(z,ne),!isBytes$8(j)){const ee=j instanceof le?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+ee)}oe(j,se);try{const ee=le.fromBytes(j,se),Z=y.fromBytes(re);if(te&&ee.hasHighS())return!1;const{r:ue,s:_e}=ee,Re=fe(z),Ae=E.inv(_e),ge=E.create(Re*Ae),be=E.create(ue*Ae),Te=y.BASE.multiplyUnsafe(ge).add(Z.multiplyUnsafe(be));return Te.is0()?!1:E.create(Te.x)===ue}catch{return!1}}function Q(j,z,re={}){const{prehash:Y}=validateSigOpts$2(re,F);return z=pe(z,Y),le.fromBytes(j,"recovered").recoverPublicKey(z).toBytes()}return Object.freeze({keygen:$,getPublicKey:R,getSharedSecret:T,utils:O,lengths:B,Point:y,sign:he,verify:ae,recoverPublicKey:Q,Signature:le,hash:u})}const secp256k1_CURVE$2={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},secp256k1_ENDO$2={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_2n$8=BigInt(2);function sqrtMod$2(y){const u=secp256k1_CURVE$2.p,g=BigInt(3),v=BigInt(6),b=BigInt(11),w=BigInt(22),E=BigInt(23),S=BigInt(44),A=BigInt(88),$=y*y*y%u,R=$*$*y%u,T=pow2$4(R,g,u)*R%u,O=pow2$4(T,g,u)*R%u,B=pow2$4(O,_2n$8,u)*$%u,F=pow2$4(B,b,u)*B%u,U=pow2$4(F,w,u)*F%u,q=pow2$4(U,S,u)*U%u,J=pow2$4(q,A,u)*q%u,ie=pow2$4(J,S,u)*U%u,oe=pow2$4(ie,g,u)*R%u,le=pow2$4(oe,E,u)*F%u,de=pow2$4(le,v,u)*$%u,fe=pow2$4(de,_2n$8,u);if(!Fpk1$2.eql(Fpk1$2.sqr(fe),y))throw new Error("Cannot find square root");return fe}const Fpk1$2=Field$2(secp256k1_CURVE$2.p,{sqrt:sqrtMod$2}),Pointk1$2=weierstrass$2(secp256k1_CURVE$2,{Fp:Fpk1$2,endo:secp256k1_ENDO$2}),secp256k1$3=ecdsa$2(Pointk1$2,sha256$c);class SigningService{privateKey;_publicKey;constructor(u){this.privateKey=u,this.privateKey=new Uint8Array(u),this._publicKey=secp256k1$3.getPublicKey(this.privateKey,!0)}get publicKey(){return new Uint8Array(this._publicKey)}get algorithm(){return"secp256k1"}static generatePrivateKey(){return secp256k1$3.utils.randomSecretKey()}static async createFromSecret(u,g){const v=new DataHasher(HashAlgorithm.SHA256);v.update(u),g&&v.update(g);const b=await v.digest();return new SigningService(b.data)}static verifySignatureWithRecoveredPublicKey(u,g){const v=secp256k1$3.Signature.fromBytes(new Uint8Array([g.recovery,...g.bytes]),"recovered").recoverPublicKey(u.data).toBytes();return SigningService.verifyWithPublicKey(u,g.bytes,v)}static verifyWithPublicKey(u,g,v){return Promise.resolve(secp256k1$3.verify(g,u.data,v,{format:"compact",prehash:!1}))}verify(u,g){return SigningService.verifyWithPublicKey(u,g.bytes,this._publicKey)}sign(u){const g=secp256k1$3.sign(u.data,this.privateKey,{format:"recovered",prehash:!1});return Promise.resolve(new Signature(g.slice(1),g[0]))}}class Authenticator{algorithm;_publicKey;signature;stateHash;constructor(u,g,v,b){this.algorithm=u,this._publicKey=g,this.signature=v,this.stateHash=b,this._publicKey=new Uint8Array(g)}get publicKey(){return new Uint8Array(this._publicKey)}static async create(u,g,v){return new Authenticator(u.algorithm,u.publicKey,await u.sign(g),v)}static fromJSON(u){if(!Authenticator.isJSON(u))throw new InvalidJsonStructureError;return new Authenticator(u.algorithm,HexConverter.decode(u.publicKey),Signature.fromJSON(u.signature),DataHash.fromJSON(u.stateHash))}static isJSON(u){return typeof u=="object"&&u!==null&&"publicKey"in u&&typeof u.publicKey=="string"&&"algorithm"in u&&typeof u.algorithm=="string"&&"signature"in u&&typeof u.signature=="string"&&"stateHash"in u&&typeof u.stateHash=="string"}static fromCBOR(u){const g=CborDeserializer.readArray(u);return new Authenticator(CborDeserializer.readTextString(g[0]),CborDeserializer.readByteString(g[1]),Signature.decode(CborDeserializer.readByteString(g[2])),DataHash.fromImprint(CborDeserializer.readByteString(g[3])))}toCBOR(){return CborSerializer.encodeArray(CborSerializer.encodeTextString(this.algorithm),CborSerializer.encodeByteString(this.publicKey),CborSerializer.encodeByteString(this.signature.encode()),CborSerializer.encodeByteString(this.stateHash.imprint))}toJSON(){return{algorithm:this.algorithm,publicKey:HexConverter.encode(this.publicKey),signature:this.signature.toJSON(),stateHash:this.stateHash.toJSON()}}verify(u){return SigningService.verifyWithPublicKey(u,this.signature.bytes,this.publicKey)}calculateRequestId(){return RequestId.create(this._publicKey,this.stateHash)}toString(){return dedent`
      Authenticator
        Public Key: ${HexConverter.encode(this._publicKey)}
        Signature Algorithm: ${this.algorithm}
        Signature: ${this.signature.toString()}
        State Hash: ${this.stateHash.toString()}`}}class LeafValue{_bytes;constructor(u){this._bytes=u,this._bytes=new Uint8Array(u)}get bytes(){return new Uint8Array(this._bytes)}static async create(u,g){const v=await new DataHasher(HashAlgorithm.SHA256).update(u.toCBOR()).update(g.imprint).digest();return new LeafValue(v.imprint)}equals(u){return ArrayBuffer.isView(u)?HexConverter.encode(this.bytes)===HexConverter.encode(new Uint8Array(u.buffer,u.byteOffset,u.byteLength)):!1}toString(){return`LeafValue[${HexConverter.encode(this.bytes)}]`}}class InputRecord{version;roundNumber;epoch;_previousHash;_hash;_summaryValue;timestamp;_blockHash;sumOfEarnedFees;_executedTransactionsHash;constructor(u,g,v,b,w,E,S,A,$,R){this.version=u,this.roundNumber=g,this.epoch=v,this._previousHash=b,this._hash=w,this._summaryValue=E,this.timestamp=S,this._blockHash=A,this.sumOfEarnedFees=$,this._executedTransactionsHash=R,this._previousHash=b?new Uint8Array(b):null,this._hash=new Uint8Array(w),this._summaryValue=new Uint8Array(E),this._blockHash=A?new Uint8Array(A):null,this._executedTransactionsHash=R?new Uint8Array(R):null}get previousHash(){return this._previousHash?new Uint8Array(this._previousHash):null}get hash(){return new Uint8Array(this._hash)}get summaryValue(){return new Uint8Array(this._summaryValue)}get blockHash(){return this._blockHash?new Uint8Array(this._blockHash):null}get executedTransactionsHash(){return this._executedTransactionsHash?new Uint8Array(this._executedTransactionsHash):null}static fromCBOR(u){const g=CborDeserializer.readTag(u),v=CborDeserializer.readArray(g.data);return new InputRecord(CborDeserializer.readUnsignedInteger(v[0]),CborDeserializer.readUnsignedInteger(v[1]),CborDeserializer.readUnsignedInteger(v[2]),CborDeserializer.readOptional(v[3],CborDeserializer.readByteString),CborDeserializer.readByteString(v[4]),CborDeserializer.readByteString(v[5]),CborDeserializer.readUnsignedInteger(v[6]),CborDeserializer.readOptional(v[7],CborDeserializer.readByteString),CborDeserializer.readUnsignedInteger(v[8]),CborDeserializer.readOptional(v[9],CborDeserializer.readByteString))}toCBOR(){return CborSerializer.encodeTag(1008,CborSerializer.encodeArray(CborSerializer.encodeUnsignedInteger(this.version),CborSerializer.encodeUnsignedInteger(this.roundNumber),CborSerializer.encodeUnsignedInteger(this.epoch),CborSerializer.encodeOptional(this.previousHash,CborSerializer.encodeByteString),CborSerializer.encodeByteString(this.hash),CborSerializer.encodeByteString(this.summaryValue),CborSerializer.encodeUnsignedInteger(this.timestamp),CborSerializer.encodeOptional(this.blockHash,CborSerializer.encodeByteString),CborSerializer.encodeUnsignedInteger(this.sumOfEarnedFees),CborSerializer.encodeOptional(this.executedTransactionsHash,CborSerializer.encodeByteString)))}}class ShardTreeCertificate{_shard;_siblingHashList;constructor(u,g){this._shard=u,this._siblingHashList=g,this._shard=new Uint8Array(u),this._siblingHashList=g.map(v=>new Uint8Array(v))}get shard(){return new Uint8Array(this._shard)}get siblingHashList(){return this._siblingHashList.map(u=>new Uint8Array(u))}static fromCBOR(u){const g=CborDeserializer.readArray(u);return new ShardTreeCertificate(CborDeserializer.readByteString(g[0]),CborDeserializer.readArray(g[1]).map(v=>CborDeserializer.readByteString(v)))}toCBOR(){return CborSerializer.encodeArray(CborSerializer.encodeByteString(this.shard),CborSerializer.encodeArray(...this._siblingHashList.map(u=>CborSerializer.encodeByteString(u))))}}class CborMap{_entries;constructor(u){this._entries=u.slice(),this._entries.sort((g,v)=>{if(g.key.length!=v.key.length)return g.key.length-v.key.length;for(let b=0;b<g.key.length;b++)if(g.key[b]!=v.key[b])return g.key[b]-v.key[b];return 0})}get entries(){return this._entries.slice()}}class UnicitySeal{version;networkId;rootChainRoundNumber;epoch;timestamp;_previousHash;_hash;_signatures;constructor(u,g,v,b,w,E,S,A){this.version=u,this.networkId=g,this.rootChainRoundNumber=v,this.epoch=b,this.timestamp=w,this._previousHash=E,this._hash=S,this._signatures=A}get previousHash(){return this._previousHash?new Uint8Array(this._previousHash):null}get hash(){return new Uint8Array(this._hash)}get signatures(){return this._signatures?new Map(Array.from(this._signatures.entries()).map(([u,g])=>[u,new Uint8Array(g)])):null}static fromCBOR(u){const g=CborDeserializer.readTag(u),v=CborDeserializer.readArray(g.data);return new UnicitySeal(CborDeserializer.readUnsignedInteger(v[0]),CborDeserializer.readUnsignedInteger(v[1]),CborDeserializer.readUnsignedInteger(v[2]),CborDeserializer.readUnsignedInteger(v[3]),CborDeserializer.readUnsignedInteger(v[4]),CborDeserializer.readOptional(v[5],CborDeserializer.readByteString),CborDeserializer.readByteString(v[6]),new Map(CborDeserializer.readMap(v[7]).map(b=>[CborDeserializer.readTextString(b.key),CborDeserializer.readByteString(b.value)])))}withoutSignatures(){return new UnicitySeal(this.version,this.networkId,this.rootChainRoundNumber,this.epoch,this.timestamp,this.previousHash,this.hash,null)}toCBOR(){return CborSerializer.encodeTag(1001,CborSerializer.encodeArray(CborSerializer.encodeUnsignedInteger(this.version),CborSerializer.encodeUnsignedInteger(this.networkId),CborSerializer.encodeUnsignedInteger(this.rootChainRoundNumber),CborSerializer.encodeUnsignedInteger(this.epoch),CborSerializer.encodeUnsignedInteger(this.timestamp),CborSerializer.encodeOptional(this.previousHash,CborSerializer.encodeByteString),CborSerializer.encodeByteString(this.hash),CborSerializer.encodeOptional(this.signatures,u=>CborSerializer.encodeMap(new CborMap(Array.from(u.entries()).map(([g,v])=>new CborMapEntry(CborSerializer.encodeTextString(g),CborSerializer.encodeByteString(v))))))))}}class HashStep{key;_hash;constructor(u,g){this.key=u,this._hash=g,this._hash=new Uint8Array(g)}get hash(){return new Uint8Array(this._hash)}static fromCBOR(u){const g=CborDeserializer.readArray(u);return new HashStep(CborDeserializer.readUnsignedInteger(g[0]),CborDeserializer.readByteString(g[1]))}toCBOR(){return CborSerializer.encodeArray(CborSerializer.encodeUnsignedInteger(this.key),CborSerializer.encodeByteString(this.hash))}}class UnicityTreeCertificate{version;partitionIdentifier;_steps;constructor(u,g,v){this.version=u,this.partitionIdentifier=g,this._steps=v,this._steps=v.slice()}get steps(){return this._steps.slice()}static fromCBOR(u){const g=CborDeserializer.readTag(u),v=CborDeserializer.readArray(g.data);return new UnicityTreeCertificate(CborDeserializer.readUnsignedInteger(v[0]),CborDeserializer.readUnsignedInteger(v[1]),CborDeserializer.readArray(v[2]).map(b=>HashStep.fromCBOR(b)))}toCBOR(){return CborSerializer.encodeTag(1014,CborSerializer.encodeArray(CborSerializer.encodeUnsignedInteger(this.version),CborSerializer.encodeUnsignedInteger(this.partitionIdentifier),CborSerializer.encodeArray(...this.steps.map(u=>u.toCBOR()))))}}class UnicityCertificate{version;inputRecord;_technicalRecordHash;_shardConfigurationHash;shardTreeCertificate;unicityTreeCertificate;unicitySeal;constructor(u,g,v,b,w,E,S){this.version=u,this.inputRecord=g,this._technicalRecordHash=v,this._shardConfigurationHash=b,this.shardTreeCertificate=w,this.unicityTreeCertificate=E,this.unicitySeal=S,this._technicalRecordHash=v?new Uint8Array(v):null,this._shardConfigurationHash=new Uint8Array(b)}get technicalRecordHash(){return this._technicalRecordHash?new Uint8Array(this._technicalRecordHash):null}get shardConfigurationHash(){return new Uint8Array(this._shardConfigurationHash)}static async calculateShardTreeCertificateRootHash(u,g,v,b){let w=await new DataHasher(HashAlgorithm.SHA256).update(u.toCBOR()).update(CborSerializer.encodeOptional(g,CborSerializer.encodeByteString)).update(CborSerializer.encodeByteString(v)).digest();const E=b.shard,S=b.siblingHashList;for(let A=0;A<S.length;A++)E[E.length-1-Math.floor(A/8)]===1?w=await new DataHasher(HashAlgorithm.SHA256).update(S[A]).update(w.data).digest():w=await new DataHasher(HashAlgorithm.SHA256).update(w.data).update(S[A]).digest();return w}static fromCBOR(u){const g=CborDeserializer.readTag(u),v=CborDeserializer.readArray(g.data);return new UnicityCertificate(CborDeserializer.readUnsignedInteger(v[0]),InputRecord.fromCBOR(v[1]),CborDeserializer.readOptional(v[2],CborDeserializer.readByteString),CborDeserializer.readByteString(v[3]),ShardTreeCertificate.fromCBOR(v[4]),UnicityTreeCertificate.fromCBOR(v[5]),UnicitySeal.fromCBOR(v[6]))}static fromJSON(u){if(!UnicityCertificate.isJSON(u))throw new InvalidJsonStructureError;return UnicityCertificate.fromCBOR(HexConverter.decode(u))}static isJSON(u){return typeof u=="string"}toCBOR(){return CborSerializer.encodeTag(1007,CborSerializer.encodeArray(CborSerializer.encodeUnsignedInteger(this.version),this.inputRecord.toCBOR(),CborSerializer.encodeOptional(this.technicalRecordHash,CborSerializer.encodeByteString),CborSerializer.encodeByteString(this.shardConfigurationHash),this.shardTreeCertificate.toCBOR(),this.unicityTreeCertificate.toCBOR(),this.unicitySeal.toCBOR()))}toJSON(){return HexConverter.encode(this.toCBOR())}}class UnicityCertificateVerificationContext{inputHash;unicityCertificate;trustBase;constructor(u,g,v){this.inputHash=u,this.unicityCertificate=g,this.trustBase=v}}var VerificationResultCode;(function(y){y[y.OK=0]="OK",y[y.FAIL=1]="FAIL"})(VerificationResultCode||(VerificationResultCode={}));class VerificationResult{status;message;results;constructor(u,g="",v=[]){this.status=u,this.message=g,this.results=v,this.results=v.slice()}get isSuccessful(){return this.status==VerificationResultCode.OK}static fromChildren(u,g){return new VerificationResult(g.reduce((v,b)=>b.isSuccessful?v:VerificationResultCode.FAIL,VerificationResultCode.OK),u,g)}toString(){return dedent`
      VerificationResult:
        status: ${this.status}
        message: ${this.message}
        results: ${this.results.map(u=>u.toString()).join(`
`)}
    `}}class VerificationRule{message;onSuccessRule;onFailureRule;constructor(u,g=null,v=null){this.message=u,this.onSuccessRule=g,this.onFailureRule=v}getNextRule(u){switch(u){case VerificationResultCode.OK:return this.onSuccessRule;case VerificationResultCode.FAIL:return this.onFailureRule;default:return null}}}class InputRecordCurrentHashVerificationRule extends VerificationRule{constructor(u=null,g=null){super("Verifying input record if current hash matches input hash.",u,g)}verify(u){return u.inputHash.equals(DataHash.fromImprint(u.unicityCertificate.inputRecord.hash))?Promise.resolve(new VerificationResult(VerificationResultCode.OK)):Promise.resolve(new VerificationResult(VerificationResultCode.FAIL,"Input record current hash does not match input hash."))}}class UnicitySealHashMatchesWithRootHashRule extends VerificationRule{constructor(u=null,g=null){super("Verifying UnicitySeal hash matches with tree root hash.",u,g)}async verify(u){const g=await UnicityCertificate.calculateShardTreeCertificateRootHash(u.unicityCertificate.inputRecord,u.unicityCertificate.technicalRecordHash,u.unicityCertificate.shardConfigurationHash,u.unicityCertificate.shardTreeCertificate);if(g==null)return new VerificationResult(VerificationResultCode.FAIL,"Could not calculate shard tree certificate root hash.");const v=u.unicityCertificate.unicityTreeCertificate,b=numberToBytesBE$3(v.partitionIdentifier,4);let w=await new DataHasher(HashAlgorithm.SHA256).update(CborSerializer.encodeByteString(new Uint8Array([1]))).update(CborSerializer.encodeByteString(b)).update(CborSerializer.encodeByteString((await new DataHasher(HashAlgorithm.SHA256).update(CborSerializer.encodeByteString(g.data)).digest()).data)).digest();for(const S of v.steps){const A=numberToBytesBE$3(S.key,4),$=new DataHasher(HashAlgorithm.SHA256).update(CborSerializer.encodeByteString(new Uint8Array([0]))).update(CborSerializer.encodeByteString(A));compareUint8Arrays(b,A)>0?$.update(CborSerializer.encodeByteString(S.hash)).update(CborSerializer.encodeByteString(w.data)):$.update(CborSerializer.encodeByteString(w.data)).update(CborSerializer.encodeByteString(S.hash)),w=await $.digest()}const E=u.unicityCertificate.unicitySeal.hash;return areUint8ArraysEqual(E,w.data)?new VerificationResult(VerificationResultCode.OK):new VerificationResult(VerificationResultCode.FAIL,"Unicity seal hash does not match tree root.")}}class UnicitySealQuorumSignaturesVerificationRule extends VerificationRule{constructor(u=null,g=null){super("Verifying UnicitySeal hash matches with tree root hash.",u,g)}static verifySignature(u,g,v){return u==null?new VerificationResult(VerificationResultCode.FAIL,"No root node defined"):SigningService.verifyWithPublicKey(v,g.slice(0,-1),u.signingKey)?new VerificationResult(VerificationResultCode.OK):new VerificationResult(VerificationResultCode.FAIL,"Signature verification failed.")}async verify(u){const g=u.unicityCertificate.unicitySeal,v=u.trustBase,b=[],w=await new DataHasher(HashAlgorithm.SHA256).update(g.withoutSignatures().toCBOR()).digest();let E=0;for(const[S,A]of g.signatures?.entries()??[]){const $=UnicitySealQuorumSignaturesVerificationRule.verifySignature(v.rootNodes.find(R=>R.nodeId===S)??null,A,w);b.push(VerificationResult.fromChildren(`Verifying node '${S}' signature.`,[$])),$.isSuccessful&&E++}return E>=v.quorumThreshold?new VerificationResult(VerificationResultCode.OK,"",b):new VerificationResult(VerificationResultCode.FAIL,"Quorum threshold not reached.",b)}}class CompositeVerificationRule extends VerificationRule{firstRule;constructor(u,g,v=null,b=null){super(g,v,b),this.firstRule=u,this.firstRule=u}async verify(u){let g=this.firstRule;const v=[];for(;g!=null;){const b=await g.verify(u);v.push(b),g=g.getNextRule(b.isSuccessful?VerificationResultCode.OK:VerificationResultCode.FAIL)}return VerificationResult.fromChildren(this.message,v)}}class UnicityCertificateVerificationRule extends CompositeVerificationRule{constructor(){super(new InputRecordCurrentHashVerificationRule(new UnicitySealHashMatchesWithRootHashRule(new UnicitySealQuorumSignaturesVerificationRule,null),null),"Verify unicity certificate")}}class PathVerificationResult{isPathValid;isPathIncluded;isSuccessful;constructor(u,g){this.isPathValid=u,this.isPathIncluded=g,this.isSuccessful=u&&g}}class SparseMerkleTreePathStep{path;_data;constructor(u,g){if(this.path=u,this._data=g,u<0n)throw new Error("Path should be non negative.")}get data(){return this._data?new Uint8Array(this._data):null}static isJSON(u){return typeof u=="object"&&u!==null&&"path"in u&&typeof u.path=="string"&&"data"in u&&(u.data===null||typeof u.data=="string")}static fromJSON(u){if(!SparseMerkleTreePathStep.isJSON(u))throw new InvalidJsonStructureError;return new SparseMerkleTreePathStep(BigInt(u.path),u.data?HexConverter.decode(u.data):null)}static fromCBOR(u){const g=CborDeserializer.readArray(u);return new SparseMerkleTreePathStep(BigintConverter.decode(CborDeserializer.readByteString(g[0])),CborDeserializer.readOptional(g[1],CborDeserializer.readByteString))}toCBOR(){return CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(this.path)),CborSerializer.encodeOptional(this._data,CborSerializer.encodeByteString))}toJSON(){return{data:this._data?HexConverter.encode(this._data):null,path:this.path.toString()}}toString(){return dedent`
      Merkle Tree Path Step
        Path: ${this.path.toString(2)}
        Data: ${this._data?HexConverter.encode(this._data):"null"}`}}class SparseMerkleTreePath{root;steps;constructor(u,g){this.root=u,this.steps=g}static fromJSON(u){if(!SparseMerkleTreePath.isJSON(u))throw new InvalidJsonStructureError;return new SparseMerkleTreePath(DataHash.fromJSON(u.root),u.steps.map(g=>SparseMerkleTreePathStep.fromJSON(g)))}static isJSON(u){return typeof u=="object"&&u!==null&&"root"in u&&typeof u.root=="string"&&"steps"in u&&Array.isArray(u.steps)&&u.steps.length>0}static fromCBOR(u){const g=CborDeserializer.readArray(u),v=CborDeserializer.readArray(g[1]);return new SparseMerkleTreePath(DataHash.fromCBOR(g[0]),v.map(b=>SparseMerkleTreePathStep.fromCBOR(b)))}toCBOR(){return CborSerializer.encodeArray(this.root.toCBOR(),CborSerializer.encodeArray(...this.steps.map(u=>u.toCBOR())))}toJSON(){return{root:this.root.toJSON(),steps:this.steps.map(u=>u.toJSON())}}async verify(u){let g=this.steps[0],v,b=g.path;g.path>1n?v=(await new DataHasher(this.root.algorithm).update(CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(g.path)),CborSerializer.encodeOptional(g.data,CborSerializer.encodeByteString))).digest()).data:(b=1n,v=g.data);for(let S=1;S<this.steps.length;S++){g=this.steps[S];const A=this.steps[S-1].path&1n,$=A?g.data:v,R=A?v:g.data;v=(await new DataHasher(this.root.algorithm).update(CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(g.path)),CborSerializer.encodeOptional($,CborSerializer.encodeByteString),CborSerializer.encodeOptional(R,CborSerializer.encodeByteString))).digest()).data;const O=BigInt(bitLen$2(g.path)-1);if(O<0n)return new PathVerificationResult(!1,!1);b=b<<O|g.path&(1n<<O)-1n}const w=v!=null&&this.root.equals(new DataHash(this.root.algorithm,v)),E=u===b;return new PathVerificationResult(w,E)}toString(){return dedent`
      Merkle Tree Path
        Root: ${this.root.toString()} 
        Steps: [
          ${this.steps.map(u=>u?.toString()??"null").join(`
`)}
        ]`}}var InclusionProofVerificationStatus;(function(y){y.NOT_AUTHENTICATED="NOT_AUTHENTICATED",y.PATH_NOT_INCLUDED="PATH_NOT_INCLUDED",y.PATH_INVALID="PATH_INVALID",y.OK="OK"})(InclusionProofVerificationStatus||(InclusionProofVerificationStatus={}));class InclusionProof{merkleTreePath;authenticator;transactionHash;unicityCertificate;constructor(u,g,v,b){if(this.merkleTreePath=u,this.authenticator=g,this.transactionHash=v,this.unicityCertificate=b,!this.authenticator!=!this.transactionHash)throw new Error("Authenticator and transaction hash must be both set or both null.")}static isJSON(u){return typeof u=="object"&&u!==null&&"merkleTreePath"in u&&"unicityCertificate"in u}static fromJSON(u){if(!InclusionProof.isJSON(u))throw new InvalidJsonStructureError;return new InclusionProof(SparseMerkleTreePath.fromJSON(u.merkleTreePath),u.authenticator?Authenticator.fromJSON(u.authenticator):null,u.transactionHash?DataHash.fromJSON(u.transactionHash):null,UnicityCertificate.fromJSON(u.unicityCertificate))}static fromCBOR(u){const g=CborDeserializer.readArray(u),v=CborDeserializer.readOptional(g[1],Authenticator.fromCBOR),b=CborDeserializer.readOptional(g[2],DataHash.fromCBOR),w=UnicityCertificate.fromCBOR(g[3]);return new InclusionProof(SparseMerkleTreePath.fromCBOR(g[0]),v,b,w)}toJSON(){return{authenticator:this.authenticator?.toJSON()??null,merkleTreePath:this.merkleTreePath.toJSON(),transactionHash:this.transactionHash?.toJSON()??null,unicityCertificate:this.unicityCertificate.toJSON()}}toCBOR(){return CborSerializer.encodeArray(this.merkleTreePath.toCBOR(),this.authenticator?.toCBOR()??CborSerializer.encodeNull(),this.transactionHash?.toCBOR()??CborSerializer.encodeNull(),this.unicityCertificate.toCBOR())}async verify(u,g){if(!(await new UnicityCertificateVerificationRule().verify(new UnicityCertificateVerificationContext(this.merkleTreePath.root,this.unicityCertificate,u))).isSuccessful)return InclusionProofVerificationStatus.NOT_AUTHENTICATED;const b=await this.merkleTreePath.verify(g.toBitString().toBigInt());if(!b.isPathValid)return InclusionProofVerificationStatus.PATH_INVALID;if(this.authenticator&&this.transactionHash){if(!await this.authenticator.verify(this.transactionHash))return InclusionProofVerificationStatus.NOT_AUTHENTICATED;if(!(await LeafValue.create(this.authenticator,this.transactionHash)).equals(this.merkleTreePath.steps.at(0)?.data))return InclusionProofVerificationStatus.PATH_NOT_INCLUDED}return b.isPathIncluded?InclusionProofVerificationStatus.OK:InclusionProofVerificationStatus.PATH_NOT_INCLUDED}toString(){return dedent`
      Inclusion Proof
        ${this.merkleTreePath.toString()}
        ${this.authenticator?.toString()}
        Transaction Hash: ${this.transactionHash?.toString()??null}`}}class DefaultPredicate{type;tokenId;tokenType;_publicKey;signingAlgorithm;hashAlgorithm;_nonce;constructor(u,g,v,b,w,E,S){this.type=u,this.tokenId=g,this.tokenType=v,this._publicKey=b,this.signingAlgorithm=w,this.hashAlgorithm=E,this._nonce=S,this._publicKey=new Uint8Array(b),this._nonce=new Uint8Array(S)}get publicKey(){return this._publicKey}get nonce(){return this._nonce}get engine(){return PredicateEngineType.EMBEDDED}async calculateHash(){const u=await this.getReference();return new DataHasher(HashAlgorithm.SHA256).update(CborSerializer.encodeArray(u.hash.toCBOR(),this.tokenId.toCBOR(),CborSerializer.encodeByteString(this._nonce))).digest()}encode(){return new Uint8Array([this.type])}encodeParameters(){return CborSerializer.encodeArray(this.tokenId.toCBOR(),this.tokenType.toCBOR(),CborSerializer.encodeByteString(this.publicKey),CborSerializer.encodeTextString(this.signingAlgorithm),CborSerializer.encodeUnsignedInteger(this.hashAlgorithm),CborSerializer.encodeByteString(this.nonce))}async verify(u,g,v){if(!this.tokenId.equals(g.id)||!this.tokenType.equals(g.type))return!1;const b=v.inclusionProof.authenticator;if(b==null||!areUint8ArraysEqual(b.publicKey,this.publicKey))return!1;const w=await v.data.calculateHash();if(!await b.verify(w))return!1;const E=await RequestId.create(this.publicKey,await v.data.sourceState.calculateHash());return await v.inclusionProof.verify(u,E)==InclusionProofVerificationStatus.OK}toString(){return dedent`
          Predicate[${this.type}]:
            PublicKey: ${HexConverter.encode(this.publicKey)}
            Algorithm: ${this.signingAlgorithm}
            Hash Algorithm: ${HashAlgorithm[this.hashAlgorithm]}
            Nonce: ${HexConverter.encode(this.nonce)}`}isOwner(u){return Promise.resolve(HexConverter.encode(u)===HexConverter.encode(this.publicKey))}}class MaskedPredicateReference{hash;constructor(u){this.hash=u}static async create(u,g,v,b,w){return new MaskedPredicateReference(await new DataHasher(HashAlgorithm.SHA256).update(CborSerializer.encodeArray(CborSerializer.encodeByteString(new Uint8Array([EmbeddedPredicateType.MASKED])),CborSerializer.encodeByteString(u.toCBOR()),CborSerializer.encodeTextString(g),CborSerializer.encodeUnsignedInteger(b),CborSerializer.encodeByteString(v),CborSerializer.encodeByteString(w))).digest())}static createFromSigningService(u,g,v,b){return MaskedPredicateReference.create(u,g.algorithm,g.publicKey,v,b)}toAddress(){return DirectAddress.create(this.hash)}}class MaskedPredicate extends DefaultPredicate{constructor(u,g,v,b,w,E){super(EmbeddedPredicateType.MASKED,u,g,v,b,w,E)}static create(u,g,v,b,w){return new MaskedPredicate(u,g,v.publicKey,v.algorithm,b,w)}static fromCBOR(u){const g=CborDeserializer.readArray(u),v=CborDeserializer.readUnsignedInteger(g[4]);if(!HashAlgorithm[Number(v)])throw new CborError("Invalid hash algorithm");return new MaskedPredicate(TokenId.fromCBOR(g[0]),TokenType.fromCBOR(g[1]),CborDeserializer.readByteString(g[2]),CborDeserializer.readTextString(g[3]),Number(v),CborDeserializer.readByteString(g[5]))}getReference(){return MaskedPredicateReference.create(this.tokenType,this.signingAlgorithm,this.publicKey,this.hashAlgorithm,this.nonce)}}class UnmaskedPredicateReference{hash;constructor(u){this.hash=u}static async create(u,g,v,b){return new UnmaskedPredicateReference(await new DataHasher(HashAlgorithm.SHA256).update(CborSerializer.encodeArray(CborSerializer.encodeByteString(new Uint8Array([EmbeddedPredicateType.UNMASKED])),CborSerializer.encodeByteString(u.toCBOR()),CborSerializer.encodeTextString(g),CborSerializer.encodeUnsignedInteger(b),CborSerializer.encodeByteString(v))).digest())}static createFromSigningService(u,g,v){return UnmaskedPredicateReference.create(u,g.algorithm,g.publicKey,v)}toAddress(){return DirectAddress.create(this.hash)}}class UnmaskedPredicate extends DefaultPredicate{constructor(u,g,v,b,w,E){super(EmbeddedPredicateType.UNMASKED,u,g,v,b,w,E)}static async create(u,g,v,b,w){const E=await v.sign(await new DataHasher(HashAlgorithm.SHA256).update(w).digest());return new UnmaskedPredicate(u,g,v.publicKey,v.algorithm,b,E.bytes)}static fromCBOR(u){const g=CborDeserializer.readArray(u),v=CborDeserializer.readUnsignedInteger(g[4]);if(!HashAlgorithm[Number(v)])throw new CborError("Invalid hash algorithm");return new UnmaskedPredicate(TokenId.fromCBOR(g[0]),TokenType.fromCBOR(g[1]),CborDeserializer.readByteString(g[2]),CborDeserializer.readTextString(g[3]),Number(v),CborDeserializer.readByteString(g[5]))}async verify(u,g,v){return super.verify(u,g,v)?SigningService.verifyWithPublicKey(await new DataHasher(HashAlgorithm.SHA256).update(g.transactions.length?g.transactions.at(-1)?.data.salt:g.genesis.data.salt).digest(),this.nonce,this.publicKey):!1}getReference(){return UnmaskedPredicateReference.create(this.tokenType,this.signingAlgorithm,this.publicKey,this.hashAlgorithm)}}class EmbeddedPredicateEngine{create(u){const g=u.encode().at(0);switch(g){case EmbeddedPredicateType.MASKED:return u instanceof MaskedPredicate?Promise.resolve(u):Promise.resolve(MaskedPredicate.fromCBOR(u.encodeParameters()));case EmbeddedPredicateType.UNMASKED:return u instanceof UnmaskedPredicate?Promise.resolve(u):Promise.resolve(UnmaskedPredicate.fromCBOR(u.encodeParameters()));case EmbeddedPredicateType.BURN:return u instanceof BurnPredicate?Promise.resolve(u):Promise.resolve(BurnPredicate.fromCBOR(u.encodeParameters()));default:throw new Error(`Unsupported embedded predicate type ${g}`)}}}class PredicateEngineService{static ENGINES=new Map([[PredicateEngineType.EMBEDDED,new EmbeddedPredicateEngine]]);static createPredicate(u){const g=PredicateEngineService.ENGINES.get(u.engine);if(g==null)throw new Error(`Unsupported predicate engine type: ${u.engine}`);return g.create(u)}}class MintTransactionState extends DataHash{static MINT_SUFFIX=HexConverter.decode("9e82002c144d7c5796c50f6db50a0c7bbd7f717ae3af6c6c71a3e9eba3022730");constructor(u){super(u.algorithm,u.data)}static async create(u){return new MintTransactionState(await RequestId.createFromImprint(u.bytes,MintTransactionState.MINT_SUFFIX))}}class CoinId{data;constructor(u){this.data=u,this.data=new Uint8Array(u)}get bytes(){return new Uint8Array(this.data)}static fromJSON(u){return new CoinId(HexConverter.decode(u))}static fromCBOR(u){return new CoinId(CborDeserializer.readByteString(u))}toJSON(){return HexConverter.encode(this.data)}toCBOR(){return CborSerializer.encodeByteString(this.data)}toBitString(){return new BitString$2(this.data)}}class SparseMerkleSumTreePathStep{path;_data;value;constructor(u,g,v){if(this.path=u,this._data=g,this.value=v,u<0n)throw new Error("Path should be non negative.");if(v<0n)throw new Error("Value must be non-negative.")}get data(){return this._data?new Uint8Array(this._data):null}static isJSON(u){return typeof u=="object"&&u!==null&&"path"in u&&typeof u.path=="string"&&"data"in u&&(u.data===null||typeof u.data=="string")&&"value"in u&&typeof u.value=="string"}static fromJSON(u){if(!SparseMerkleSumTreePathStep.isJSON(u))throw new InvalidJsonStructureError;return new SparseMerkleSumTreePathStep(BigInt(u.path),u.data?HexConverter.decode(u.data):null,BigInt(u.value))}static fromCBOR(u){const g=CborDeserializer.readArray(u);return new SparseMerkleSumTreePathStep(BigintConverter.decode(CborDeserializer.readByteString(g[0])),CborDeserializer.readOptional(g[1],CborDeserializer.readByteString),BigintConverter.decode(CborDeserializer.readByteString(g[2])))}toCBOR(){return CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(this.path)),CborSerializer.encodeOptional(this._data,CborSerializer.encodeByteString),CborSerializer.encodeByteString(BigintConverter.encode(this.value)))}toJSON(){return{data:this._data?HexConverter.encode(this._data):null,path:this.path.toString(),value:this.value.toString()}}toString(){return dedent`
      Merkle Tree Path Step
        Path: ${this.path.toString(2)}
        Data: ${this._data?HexConverter.encode(this._data):"null"}
        Value: ${this.value}`}}class SparseMerkleSumTreePath{root;steps;constructor(u,g){this.root=u,this.steps=g}static fromJSON(u){if(!SparseMerkleSumTreePath.isJSON(u))throw new InvalidJsonStructureError;return new SparseMerkleSumTreePath(DataHash.fromJSON(u.root),u.steps.map(g=>SparseMerkleSumTreePathStep.fromJSON(g)))}static isJSON(u){return typeof u=="object"&&u!==null&&"root"in u&&typeof u.root=="string"&&"steps"in u&&Array.isArray(u.steps)&&u.steps.length>0}static fromCBOR(u){const g=CborDeserializer.readArray(u),v=CborDeserializer.readArray(g[1]);return new SparseMerkleSumTreePath(DataHash.fromCBOR(g[0]),v.map(b=>SparseMerkleSumTreePathStep.fromCBOR(b)))}toCBOR(){return CborSerializer.encodeArray(this.root.toCBOR(),CborSerializer.encodeArray(...this.steps.map(u=>u.toCBOR())))}toJSON(){return{root:this.root.toJSON(),steps:this.steps.map(u=>u.toJSON())}}async verify(u){let g=this.steps[0],v,b=g.path,w=g.value;g.path>0?v=(await new DataHasher(this.root.algorithm).update(CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(g.path)),CborSerializer.encodeOptional(g.data,CborSerializer.encodeByteString),CborSerializer.encodeByteString(BigintConverter.encode(g.value)))).digest()).data:(b=1n,v=g.data);for(let A=1;A<this.steps.length;A++){g=this.steps[A];const $=this.steps[A-1].path&1n,R={data:$?g.data:v,value:$?g.value:w},T={data:$?v:g.data,value:$?w:g.value};v=(await new DataHasher(this.root.algorithm).update(CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(g.path)),CborSerializer.encodeOptional(R.data,CborSerializer.encodeByteString),CborSerializer.encodeByteString(BigintConverter.encode(R.value)),CborSerializer.encodeOptional(T.data,CborSerializer.encodeByteString),CborSerializer.encodeByteString(BigintConverter.encode(T.value)))).digest()).data;const B=BigInt(bitLen$2(g.path)-1);if(B<0n)return new PathVerificationResult(!1,!1);b=b<<B|g.path&(1n<<B)-1n,w+=g.value}const E=v!=null&&this.root.equals(new DataHash(this.root.algorithm,v)),S=u===b;return new PathVerificationResult(E,S)}toString(){return dedent`
      Merkle Tree Path
        Root: ${this.root.toString()} 
        Steps: [
          ${this.steps.map(u=>u?.toString()??"null").join(`
`)}
        ]`}}class SplitMintReasonProof{coinId;aggregationPath;coinTreePath;constructor(u,g,v){this.coinId=u,this.aggregationPath=g,this.coinTreePath=v}static fromCBOR(u){const g=CborDeserializer.readArray(u);return new SplitMintReasonProof(CoinId.fromCBOR(g[0]),SparseMerkleTreePath.fromCBOR(g[1]),SparseMerkleSumTreePath.fromCBOR(g[2]))}static isJSON(u){return typeof u=="object"&&u!==null&&"coinId"in u&&"aggregationPath"in u&&"coinTreePath"in u}static fromJSON(u){if(!SplitMintReasonProof.isJSON(u))throw new InvalidJsonStructureError;return new SplitMintReasonProof(CoinId.fromJSON(u.coinId),SparseMerkleTreePath.fromJSON(u.aggregationPath),SparseMerkleSumTreePath.fromJSON(u.coinTreePath))}toJSON(){return{aggregationPath:this.aggregationPath.toJSON(),coinId:this.coinId.toJSON(),coinTreePath:this.coinTreePath.toJSON()}}toCBOR(){return CborSerializer.encodeArray(this.coinId.toCBOR(),this.aggregationPath.toCBOR(),this.coinTreePath.toCBOR())}}var MintReasonType;(function(y){y.TOKEN_SPLIT="TOKEN_SPLIT"})(MintReasonType||(MintReasonType={}));class SplitMintReason{token;_proofs;constructor(u,g){this.token=u,this._proofs=g,this._proofs=g.slice()}get proofs(){return this._proofs.slice()}static async fromCBOR(u){const g=CborDeserializer.readArray(u);return new SplitMintReason(await Token$1.fromCBOR(g[0]),CborDeserializer.readArray(g[1]).map(v=>SplitMintReasonProof.fromCBOR(v)))}static isJSON(u){return typeof u=="object"&&u!==null&&"token"in u&&"proofs"in u}static async fromJSON(u){if(!SplitMintReason.isJSON(u))throw new InvalidJsonStructureError;return new SplitMintReason(await Token$1.fromJSON(u.token),u.proofs.map(g=>SplitMintReasonProof.fromJSON(g)))}async verify(u){if(u.data.coinData==null)return Promise.resolve(new VerificationResult(VerificationResultCode.FAIL,"Coin data is missing."));const g=await PredicateEngineService.createPredicate(this.token.state.predicate);if(!(g instanceof BurnPredicate))return Promise.resolve(new VerificationResult(VerificationResultCode.FAIL,"Token is not burned."));if(u.data.coinData.length!==this._proofs.length)return Promise.resolve(new VerificationResult(VerificationResultCode.FAIL,"Total amount of coins differ in token and proofs."));for(const v of this._proofs){if(!(await v.aggregationPath.verify(v.coinId.toBitString().toBigInt())).isSuccessful)return Promise.resolve(new VerificationResult(VerificationResultCode.FAIL,`Aggregation path verification failed for coin: ${v.coinId}`));if(!(await v.coinTreePath.verify(u.data.tokenId.toBitString().toBigInt())).isSuccessful)return Promise.resolve(new VerificationResult(VerificationResultCode.FAIL,`Coin tree path verification failed for token: ${u.data.tokenId}`));if(!areUint8ArraysEqual(v.coinTreePath.root.imprint,v.aggregationPath.steps.at(0)?.data))return Promise.resolve(new VerificationResult(VerificationResultCode.FAIL,"Coin tree root does not match aggregation path leaf."));const E=u.data.coinData.get(v.coinId);if(E===null)return Promise.resolve(new VerificationResult(VerificationResultCode.FAIL,`Coin id ${v.coinId} not found in coin data.`));if(v.coinTreePath.steps.at(0)?.value!==E)return Promise.resolve(new VerificationResult(VerificationResultCode.FAIL,`Coin amount for coin id ${v.coinId} does not match coin tree leaf.`));if(!v.aggregationPath.root.equals(g.reason))return Promise.resolve(new VerificationResult(VerificationResultCode.FAIL,"Aggregation path root does not match burn reason."))}return Promise.resolve(new VerificationResult(VerificationResultCode.OK))}toCBOR(){return CborSerializer.encodeArray(this.token.toCBOR(),CborSerializer.encodeArray(...this._proofs.map(u=>u.toCBOR())))}toJSON(){return{proofs:this._proofs.map(u=>u.toJSON()),token:this.token.toJSON(),type:MintReasonType.TOKEN_SPLIT}}}class TokenCoinData{_coins;constructor(u){this._coins=u}get coins(){return Array.from(this._coins.entries()).map(([u,g])=>[CoinId.fromJSON(u),g])}get length(){return this._coins.size}static create(u){const g=new Map;for(const[v,b]of u)g.set(v.toJSON(),b);return new TokenCoinData(g)}static fromCBOR(u){const g=new Map,v=CborDeserializer.readArray(u);for(const b of v){const[w,E]=CborDeserializer.readArray(b);g.set(HexConverter.encode(CborDeserializer.readByteString(w)),BigintConverter.decode(CborDeserializer.readByteString(E)))}return new TokenCoinData(g)}static fromJSON(u){if(!Array.isArray(u)||!u.every(g=>Array.isArray(g)&&g.length===2&&typeof g[0]=="string"&&typeof g[1]=="string"))throw new InvalidJsonStructureError;return new TokenCoinData(new Map(u.map(([g,v])=>[g,BigInt(v)])))}get(u){return this._coins.get(u.toJSON())??null}toCBOR(){return CborSerializer.encodeArray(...Array.from(this._coins.entries()).map(([u,g])=>CborSerializer.encodeArray(CborSerializer.encodeByteString(HexConverter.decode(u)),CborSerializer.encodeByteString(BigintConverter.encode(g)))))}toJSON(){return Array.from(this._coins.entries()).map(([u,g])=>[u.toString(),g.toString()])}toString(){return dedent`
      TokenCoinData:
        ${Array.from(this._coins.entries()).map(([u,g])=>`${u}: ${g}`).join(`
`)}`}}const textEncoder$4=new TextEncoder;class MintTransactionData{tokenId;tokenType;sourceState;_tokenData;coinData;recipient;_salt;recipientDataHash;reason;constructor(u,g,v,b,w,E,S,A,$){this.tokenId=u,this.tokenType=g,this.sourceState=v,this._tokenData=b,this.coinData=w,this.recipient=E,this._salt=S,this.recipientDataHash=A,this.reason=$}get tokenData(){return this._tokenData?new Uint8Array(this._tokenData):null}get salt(){return new Uint8Array(this._salt)}static async create(u,g,v,b,w,E,S,A){const $=v?new Uint8Array(v):null,R=new Uint8Array(E);return new MintTransactionData(u,g,await MintTransactionState.create(u),$,b,w,R,S,A)}static async createFromNametag(u,g,v,b,w){return MintTransactionData.create(await TokenId.fromNameTag(u),g,textEncoder$4.encode(w.address),null,v,b,null,null)}static async fromCBOR(u){const g=CborDeserializer.readArray(u);return MintTransactionData.create(TokenId.fromCBOR(g[0]),TokenType.fromCBOR(g[1]),CborDeserializer.readOptional(g[2],CborDeserializer.readByteString),CborDeserializer.readOptional(g[3],TokenCoinData.fromCBOR),await AddressFactory.createAddress(CborDeserializer.readTextString(g[4])),CborDeserializer.readByteString(g[5]),CborDeserializer.readOptional(g[6],DataHash.fromCBOR),await CborDeserializer.readOptional(g[7],SplitMintReason.fromCBOR))}static isJSON(u){return typeof u=="object"&&u!==null&&"tokenId"in u&&"tokenType"in u&&"recipient"in u&&"salt"in u}static async fromJSON(u){if(!MintTransactionData.isJSON(u))throw new InvalidJsonStructureError;return MintTransactionData.create(TokenId.fromJSON(u.tokenId),TokenType.fromJSON(u.tokenType),u.tokenData?HexConverter.decode(u.tokenData):null,u.coinData?TokenCoinData.fromJSON(u.coinData):null,await AddressFactory.createAddress(u.recipient),HexConverter.decode(u.salt),u.recipientDataHash?DataHash.fromJSON(u.recipientDataHash):null,u.reason?await SplitMintReason.fromJSON(u.reason):null)}toCBOR(){return CborSerializer.encodeArray(this.tokenId.toCBOR(),this.tokenType.toCBOR(),CborSerializer.encodeOptional(this.tokenData,CborSerializer.encodeByteString),CborSerializer.encodeOptional(this.coinData,u=>u.toCBOR()),CborSerializer.encodeTextString(this.recipient.address),CborSerializer.encodeByteString(this.salt),CborSerializer.encodeOptional(this.recipientDataHash,u=>u.toCBOR()),CborSerializer.encodeOptional(this.reason,u=>u.toCBOR()))}toJSON(){return{coinData:this.coinData?.toJSON()??null,reason:this.reason?.toJSON()??null,recipient:this.recipient.address,recipientDataHash:this.recipientDataHash?.toJSON()??null,salt:HexConverter.encode(this.salt),tokenData:this.tokenData?HexConverter.encode(this.tokenData):null,tokenId:this.tokenId.toJSON(),tokenType:this.tokenType.toJSON()}}calculateHash(){return new DataHasher(HashAlgorithm.SHA256).update(this.toCBOR()).digest()}toString(){return dedent`
      MintTransactionData:
        Token ID: ${this.tokenId.toString()}
        Token Type: ${this.tokenType.toString()}
        Token Data: ${this._tokenData?HexConverter.encode(this._tokenData):null}
        Coins: ${this.coinData?.toString()??null}
        Recipient: ${this.recipient}
        Salt: ${HexConverter.encode(this.salt)}
        Data: ${this.recipientDataHash?.toString()??null}
        Reason: ${this.reason?.toString()??null}`}}class Transaction{data;inclusionProof;constructor(u,g){this.data=u,this.inclusionProof=g}async containsRecipientData(u){return this.data.recipientDataHash?u?(await new DataHasher(this.data.recipientDataHash.algorithm).update(u).digest()).equals(this.data.recipientDataHash):!1:!u}toString(){return dedent`
        Transaction:
          ${this.data.toString()}
          ${this.inclusionProof.toString()}`}}class MintSigningService{static MINTER_SECRET=HexConverter.decode("495f414d5f554e4956455253414c5f4d494e5445525f464f525f");constructor(){}static create(u){return SigningService.createFromSecret(MintSigningService.MINTER_SECRET,u.bytes)}}class MintTransaction extends Transaction{constructor(u,g){super(u,g)}static async fromCBOR(u){const g=CborDeserializer.readArray(u);return new MintTransaction(await MintTransactionData.fromCBOR(g[0]),InclusionProof.fromCBOR(g[1]))}static isJSON(u){return typeof u=="object"&&u!==null&&"data"in u&&"inclusionProof"in u}static async fromJSON(u){if(!MintTransaction.isJSON(u))throw new InvalidJsonStructureError;return new MintTransaction(await MintTransactionData.fromJSON(u.data),InclusionProof.fromJSON(u.inclusionProof))}async verify(u){if(!this.inclusionProof.authenticator)return new VerificationResult(VerificationResultCode.FAIL,"Missing authenticator.");if(!this.inclusionProof.transactionHash)return new VerificationResult(VerificationResultCode.FAIL,"Missing transaction hash.");if(!this.data.sourceState.equals(await MintTransactionState.create(this.data.tokenId)))return new VerificationResult(VerificationResultCode.FAIL,"Invalid source state");const g=await MintSigningService.create(this.data.tokenId);if(HexConverter.encode(this.inclusionProof.authenticator.publicKey)!==HexConverter.encode(g.publicKey))return new VerificationResult(VerificationResultCode.FAIL,"Authenticator public key mismatch.");if(!await this.inclusionProof.authenticator.verify(this.inclusionProof.transactionHash))return new VerificationResult(VerificationResultCode.FAIL,"Authenticator verification failed.");const v=await this.data.reason?.verify(this)??new VerificationResult(VerificationResultCode.OK);return v.isSuccessful?await this.inclusionProof.verify(u,await RequestId.create(g.publicKey,this.data.sourceState))!==InclusionProofVerificationStatus.OK?new VerificationResult(VerificationResultCode.FAIL,"Inclusion proof verification failed."):new VerificationResult(VerificationResultCode.OK):new VerificationResult(VerificationResultCode.FAIL,"Mint reason verification",[v])}toJSON(){return{data:this.data.toJSON(),inclusionProof:this.inclusionProof.toJSON()}}toCBOR(){return CborSerializer.encodeArray(this.data.toCBOR(),this.inclusionProof.toCBOR())}}class TransferTransactionData{sourceState;recipient;_salt;recipientDataHash;_message;_nametagTokens;constructor(u,g,v,b,w,E=[]){this.sourceState=u,this.recipient=g,this._salt=v,this.recipientDataHash=b,this._message=w,this._nametagTokens=E,this._message=w?new Uint8Array(w):null,this._nametagTokens=Array.from(E)}get salt(){return new Uint8Array(this._salt)}get message(){return this._message?new Uint8Array(this._message):null}get nametagTokens(){return this._nametagTokens.slice()}static create(u,g,v,b,w,E=[]){return new TransferTransactionData(u,g,v,b,w,E)}static async fromCBOR(u){const g=CborDeserializer.readArray(u);return new TransferTransactionData(TokenState.fromCBOR(g[0]),await AddressFactory.createAddress(CborDeserializer.readTextString(g[1])),CborDeserializer.readByteString(g[2]),CborDeserializer.readOptional(g[3],DataHash.fromCBOR),CborDeserializer.readOptional(g[4],CborDeserializer.readByteString),await Promise.all(CborDeserializer.readArray(g[5]).map(v=>Token$1.fromCBOR(v))))}static isJSON(u){return typeof u=="object"&&u!==null&&"sourceState"in u&&"recipient"in u&&"salt"in u&&"recipientDataHash"in u&&"message"in u&&"nametags"in u}static async fromJSON(u){if(!TransferTransactionData.isJSON(u))throw new InvalidJsonStructureError;return new TransferTransactionData(TokenState.fromJSON(u.sourceState),await AddressFactory.createAddress(u.recipient),HexConverter.decode(u.salt),u.recipientDataHash?DataHash.fromJSON(u.recipientDataHash):null,u.message?HexConverter.decode(u.message):null,await Promise.all(u.nametags.map(g=>Token$1.fromJSON(g))))}calculateHash(){return new DataHasher(HashAlgorithm.SHA256).update(this.toCBOR()).digest()}toCBOR(){return CborSerializer.encodeArray(this.sourceState.toCBOR(),CborSerializer.encodeTextString(this.recipient.address),CborSerializer.encodeByteString(this.salt),CborSerializer.encodeOptional(this.recipientDataHash,u=>u.toCBOR()),CborSerializer.encodeOptional(this.message,CborSerializer.encodeByteString),CborSerializer.encodeArray(...this.nametagTokens.map(u=>u.toCBOR())))}toJSON(){return{message:this._message?HexConverter.encode(this._message):null,nametags:this._nametagTokens.map(u=>u.toJSON()),recipient:this.recipient.address,recipientDataHash:this.recipientDataHash?.toJSON()??null,salt:HexConverter.encode(this.salt),sourceState:this.sourceState.toJSON()}}toString(){return dedent`
      TransactionData:
        ${this.sourceState.toString()}
        Recipient: ${this.recipient.toString()}
        Salt: ${HexConverter.encode(this._salt)}
        Data: ${this.recipientDataHash?.toString()??null}
        Message: ${this._message?HexConverter.encode(this._message):null}
        NameTags: [
          ${this._nametagTokens.map(u=>u.toString()).join(`
`)}
        ]`}}class TransferTransaction extends Transaction{constructor(u,g){super(u,g)}static async fromCBOR(u){const g=CborDeserializer.readArray(u);return new TransferTransaction(await TransferTransactionData.fromCBOR(g[0]),InclusionProof.fromCBOR(g[1]))}static isJSON(u){return typeof u=="object"&&u!==null&&"data"in u&&"inclusionProof"in u}static async fromJSON(u){if(!TransferTransaction.isJSON(u))throw new InvalidJsonStructureError;return new TransferTransaction(await TransferTransactionData.fromJSON(u.data),InclusionProof.fromJSON(u.inclusionProof))}async verify(u,g){let v=await g.verifyNametagTokens(u);return v.isSuccessful?(v=await g.verifyRecipient(),!v.isSuccessful||(v=await g.verifyRecipientData(),!v.isSuccessful)?v:await(await PredicateEngineService.createPredicate(g.state.predicate)).verify(u,g,this)?new VerificationResult(VerificationResultCode.OK):new VerificationResult(VerificationResultCode.FAIL,"Predicate verification failed")):new VerificationResult(VerificationResultCode.FAIL,"Nametag tokens verification failed",[v])}toJSON(){return{data:this.data.toJSON(),inclusionProof:this.inclusionProof.toJSON()}}toCBOR(){return CborSerializer.encodeArray(this.data.toCBOR(),this.inclusionProof.toCBOR())}}let VerificationError$1=class extends Error{verificationResult;constructor(u,g){super(u),this.verificationResult=g}};const TOKEN_VERSION="2.0";let Token$1=class Un{state;genesis;_transactions;_nametagTokens;version;constructor(u,g,v=[],b=[],w=TOKEN_VERSION){this.state=u,this.genesis=g,this._transactions=v,this._nametagTokens=b,this.version=w,this._nametagTokens=b.slice(),this._transactions=v.slice()}get id(){return this.genesis.data.tokenId}get type(){return this.genesis.data.tokenType}get data(){return this.genesis.data.tokenData}get coins(){return this.genesis.data.coinData}get nametagTokens(){return this._nametagTokens.slice()}get transactions(){return this._transactions.slice()}static async fromCBOR(u){const g=CborDeserializer.readArray(u),v=CborDeserializer.readTextString(g[0]);if(v!==TOKEN_VERSION)throw new Error(`Unsupported token version: ${v}`);return new Un(TokenState.fromCBOR(g[1]),await MintTransaction.fromCBOR(g[2]),await Promise.all(CborDeserializer.readArray(g[3]).map(b=>TransferTransaction.fromCBOR(b))),await Promise.all(CborDeserializer.readArray(g[4]).map(b=>Un.fromCBOR(b))))}static isJSON(u){return typeof u=="object"&&u!==null&&"version"in u&&u.version===TOKEN_VERSION&&"state"in u&&"genesis"in u&&"transactions"in u&&"nametags"in u}static async fromJSON(u){if(!Un.isJSON(u))throw new InvalidJsonStructureError;return new Un(TokenState.fromJSON(u.state),await MintTransaction.fromJSON(u.genesis),await Promise.all(u.transactions.map(g=>TransferTransaction.fromJSON(g))),await Promise.all(u.nametags.map(g=>Un.fromJSON(g))))}static async mint(u,g,v,b=[]){const w=new Un(g,v,[],b),E=await w.verify(u);if(!E.isSuccessful)throw new VerificationError$1("Token verification failed",E);return w}async update(u,g,v,b=[]){let w=await v.verify(u,this);if(!w.isSuccessful)throw new VerificationError$1("Transaction verification failed",w);const E=this._transactions.slice();E.push(v);const S=new Un(g,this.genesis,E,b);if(w=await S.verifyNametagTokens(u),!w.isSuccessful)throw new VerificationError$1("Nametag tokens verification failed",w);if(w=await S.verifyRecipient(),!w.isSuccessful)throw new VerificationError$1("Recipient verification failed",w);if(w=await S.verifyRecipientData(),!w.isSuccessful)throw new VerificationError$1("Recipient data verification failed",w);return S}async verify(u){const g=[];g.push(VerificationResult.fromChildren("Genesis verification",[await this.genesis.verify(u)]));for(let v=0;v<this._transactions.length;v++){const b=this._transactions[v];g.push(VerificationResult.fromChildren("Transaction verification",[await b.verify(u,new Un(b.data.sourceState,this.genesis,this._transactions.slice(0,v),b.data.nametagTokens))]))}return g.push(VerificationResult.fromChildren("Current state verification",await Promise.all([this.verifyNametagTokens(u),this.verifyRecipient(),this.verifyRecipientData()]))),VerificationResult.fromChildren("Token verification",g)}async verifyNametagTokens(u){const g=[];for(const v of this._nametagTokens)g.push(await v.verify(u));return VerificationResult.fromChildren("Nametag verification",g)}async verifyRecipient(){const v=await(await(await PredicateEngineService.createPredicate(this.state.predicate)).getReference()).toAddress(),b=this.transactions.length?this.transactions.at(-1):this.genesis,w=await ProxyAddress.resolve(b.data.recipient,this.nametagTokens);return v.address!==w?.address?new VerificationResult(VerificationResultCode.FAIL,"Recipient address mismatch"):new VerificationResult(VerificationResultCode.OK,"Recipient verification")}async verifyRecipientData(){return await(this.transactions.length?this.transactions.at(-1):this.genesis).containsRecipientData(this.state.data)?new VerificationResult(VerificationResultCode.OK,"Recipient data verification"):new VerificationResult(VerificationResultCode.FAIL,"State data hash does not match previous transaction recipient data hash")}toJSON(){return{genesis:this.genesis.toJSON(),nametags:this._nametagTokens.map(u=>u.toJSON()),state:this.state.toJSON(),transactions:this._transactions.map(u=>u.toJSON()),version:this.version}}toCBOR(){return CborSerializer.encodeArray(CborSerializer.encodeTextString(this.version),this.state.toCBOR(),this.genesis.toCBOR(),CborSerializer.encodeArray(...this._transactions.map(u=>u.toCBOR())),CborSerializer.encodeArray(...this._nametagTokens.map(u=>u.toCBOR())))}toString(){return dedent`
        Token[${this.version}]:
          State: 
            ${this.state.toString()}
          Genesis: 
            ${this.genesis.toString()}
          Transactions: [
            ${this.transactions.map(u=>u.toString()).join(`
`)}
          ]
          Nametag Tokens: [ 
            ${this.nametagTokens.map(u=>u.toString()).join(`
`)}
          ]
      `}};const Token$2=Object.freeze(Object.defineProperty({__proto__:null,TOKEN_VERSION,Token:Token$1},Symbol.toStringTag,{value:"Module"}));class Commitment{requestId;transactionData;authenticator;constructor(u,g,v){this.requestId=u,this.transactionData=g,this.authenticator=v}}class TransferCommitment extends Commitment{constructor(u,g,v){super(u,g,v)}static async create(u,g,v,b,w,E){const S=TransferTransactionData.create(u.state,g,v,b,w,u.nametagTokens),A=await S.sourceState.calculateHash(),$=await S.calculateHash(),R=await RequestId.create(E.publicKey,A),T=await Authenticator.create(E,$,A);return new TransferCommitment(R,S,T)}static async fromCBOR(u){const g=CborDeserializer.readArray(u);return new TransferCommitment(RequestId.fromCBOR(g[0]),await TransferTransactionData.fromCBOR(g[1]),Authenticator.fromCBOR(g[2]))}static isJSON(u){return typeof u=="object"&&u!==null&&"requestId"in u&&"transactionData"in u&&"authenticator"in u}static async fromJSON(u){if(!TransferCommitment.isJSON(u))throw new InvalidJsonStructureError;return new TransferCommitment(RequestId.fromJSON(u.requestId),await TransferTransactionData.fromJSON(u.transactionData),Authenticator.fromJSON(u.authenticator))}toCBOR(){return CborSerializer.encodeArray(this.requestId.toCBOR(),this.transactionData.toCBOR(),this.authenticator.toCBOR())}toJSON(){return{authenticator:this.authenticator.toJSON(),requestId:this.requestId.toJSON(),transactionData:this.transactionData.toJSON()}}toTransaction(u){return new TransferTransaction(this.transactionData,u)}}const version$4=1,networkId=3,epoch=1,epochStartRound=1,rootNodes=[{nodeId:"16Uiu2HAkyQRiA7pMgzgLj9GgaBJEJa8zmx9dzqUDa6WxQPJ82ghU",sigKey:"0x039afb2acb65f5fbc272d8907f763d0a5d189aadc9b97afdcc5897ea4dd112e68b",stake:1}],quorumThreshold=1,stateHash="",changeRecordHash="",previousEntryHash="",signatures={"16Uiu2HAkyQRiA7pMgzgLj9GgaBJEJa8zmx9dzqUDa6WxQPJ82ghU":"0xf157c9fdd8a378e3ca70d354ccc4475ab2cd8de360127bc46b0aeab4b453a80f07fd9136a5843b60a8babaff23e20acc8879861f7651440a5e2829f7541b31f100"},trustBaseJson={version:version$4,networkId,epoch,epochStartRound,rootNodes,quorumThreshold,stateHash,changeRecordHash,previousEntryHash,signatures};class StateTransitionClient{client;constructor(u){this.client=u}async submitMintCommitment(u){return this.client.submitCommitment(u.requestId,await u.transactionData.calculateHash(),u.authenticator)}async submitTransferCommitment(u){if(!await(await PredicateEngineService.createPredicate(u.transactionData.sourceState.predicate)).isOwner(u.authenticator.publicKey))throw new Error("Ownership verification failed: Authenticator does not match source state predicate.");return this.client.submitCommitment(u.requestId,await u.transactionData.calculateHash(),u.authenticator)}finalizeTransaction(u,g,v,b,w=[]){return g.update(u,v,b,w)}getInclusionProof(u){return this.client.getInclusionProof(u)}async isStateSpent(u,g){const b=await(await this.getInclusionProof(g)).inclusionProof.verify(u,g);switch(b){case InclusionProofVerificationStatus.OK:return!0;case InclusionProofVerificationStatus.PATH_NOT_INCLUDED:return!1;default:throw new Error(`Inclusion proof verification failed with status ${b}`)}}async isTokenStateSpent(u,g,v){const b=new Uint8Array(v);if(!await(await PredicateEngineService.createPredicate(g.state.predicate)).isOwner(b))throw new Error("Given key is not owner of the token.");return this.isStateSpent(u,await RequestId.create(b,await g.state.calculateHash()))}async isMinted(u,g){return this.isStateSpent(u,await RequestId.create(await MintSigningService.create(g).then(v=>v.publicKey),await MintTransactionState.create(g)))}}class InclusionProofResponse{inclusionProof;constructor(u){this.inclusionProof=u,this.inclusionProof=u}static isJSON(u){return typeof u=="object"&&u!==null&&"inclusionProof"in u}static fromJSON(u){if(!InclusionProofResponse.isJSON(u))throw new InvalidJsonStructureError;return new InclusionProofResponse(InclusionProof.fromJSON(u.inclusionProof))}}class JsonRpcDataError{code;message;name="JsonRpcError";constructor({code:u,message:g}){this.code=u,this.message=g}toString(){return`{ code: ${this.code}, message: ${this.message} }`}}class JsonRpcNetworkError{status;message;name="JsonRpcNetworkError";constructor(u,g){this.status=u,this.message=g}}class JsonRpcHttpTransport{url;constructor(u){this.url=u}async request(u,g,v=new Headers){v.set("Content-Type","application/json");const b=await fetch(this.url,{body:JSON.stringify({id:v4$1(),jsonrpc:"2.0",method:u,params:g}),headers:v,method:"POST"});if(!b.ok)throw new JsonRpcNetworkError(b.status,await b.text());const w=await b.json();if(w.error)throw new JsonRpcDataError(w.error);return w.result}}class SubmitCommitmentRequest{requestId;transactionHash;authenticator;receipt;constructor(u,g,v,b){this.requestId=u,this.transactionHash=g,this.authenticator=v,this.receipt=b}static fromJSON(u){if(!SubmitCommitmentRequest.isJSON(u))throw new InvalidJsonStructureError;return new SubmitCommitmentRequest(RequestId.fromJSON(u.requestId),DataHash.fromJSON(u.transactionHash),Authenticator.fromJSON(u.authenticator),u.receipt)}static isJSON(u){return typeof u=="object"&&u!==null&&"authenticator"in u&&typeof u.authenticator=="object"&&u.authenticator!==null&&"requestId"in u&&typeof u.requestId=="string"&&"transactionHash"in u&&typeof u.transactionHash=="string"}toJSON(){return{authenticator:this.authenticator.toJSON(),receipt:this.receipt,requestId:this.requestId.toJSON(),transactionHash:this.transactionHash.toJSON()}}}var SubmitCommitmentStatus;(function(y){y.SUCCESS="SUCCESS",y.AUTHENTICATOR_VERIFICATION_FAILED="AUTHENTICATOR_VERIFICATION_FAILED",y.REQUEST_ID_MISMATCH="REQUEST_ID_MISMATCH",y.REQUEST_ID_EXISTS="REQUEST_ID_EXISTS"})(SubmitCommitmentStatus||(SubmitCommitmentStatus={}));let Request$1=class ah{service;method;requestId;stateHash;transactionHash;hash;constructor(u,g,v,b,w,E){this.service=u,this.method=g,this.requestId=v,this.stateHash=b,this.transactionHash=w,this.hash=E}static async create(u,g,v,b,w){const E=CborSerializer.encodeArray(CborSerializer.encodeTextString(u),CborSerializer.encodeTextString(g),v.toCBOR(),b.toCBOR(),w.toCBOR()),S=await new DataHasher(HashAlgorithm.SHA256).update(E).digest();return new ah(u,g,v,b,w,S)}toCBOR(){return CborSerializer.encodeArray(CborSerializer.encodeTextString(this.service),CborSerializer.encodeTextString(this.method),this.requestId.toCBOR(),this.stateHash.toCBOR(),this.transactionHash.toCBOR())}toJSON(){return{method:this.method,requestId:this.requestId.toJSON(),service:this.service,stateHash:this.stateHash.toJSON(),transactionHash:this.transactionHash.toJSON()}}toString(){return dedent`
      Request
        Service: ${this.service}
        Method: ${this.method}
        Request ID: ${this.requestId.toString()}
        State Hash: ${this.stateHash.toString()}
        Transaction Hash: ${this.transactionHash.toString()}
      `}};class SubmitCommitmentResponse{status;receipt;constructor(u,g){this.status=u,this.receipt=g}static async fromJSON(u){if(!SubmitCommitmentResponse.isJSON(u))throw new InvalidJsonStructureError;let g;if(u.request&&u.algorithm&&u.publicKey&&u.signature){const v=await Request$1.create(u.request.service,u.request.method,RequestId.fromJSON(u.request.requestId),DataHash.fromJSON(u.request.stateHash),DataHash.fromJSON(u.request.transactionHash));g={algorithm:u.algorithm,publicKey:u.publicKey,request:v,signature:Signature.fromJSON(u.signature)}}return new SubmitCommitmentResponse(u.status,g)}static isJSON(u){return typeof u=="object"&&u!==null&&"status"in u&&typeof u.status=="string"}toJSON(){return{algorithm:this.receipt?.algorithm,publicKey:this.receipt?.publicKey,request:this.receipt?.request.toJSON(),signature:this.receipt?.signature.toJSON(),status:this.status}}async addSignedReceipt(u,g,v,b){const w=await Request$1.create("aggregator","submit_commitment",u,g,v),E=await b.sign(w.hash);this.receipt={algorithm:b.algorithm,publicKey:HexConverter.encode(b.publicKey),request:w,signature:E}}verifyReceipt(){return this.receipt?SigningService.verifyWithPublicKey(this.receipt.request.hash,this.receipt.signature.bytes,HexConverter.decode(this.receipt.publicKey)):Promise.resolve(!1)}}class AggregatorClient{key;transport;constructor(u,g=null){this.key=g,this.transport=new JsonRpcHttpTransport(u)}async submitCommitment(u,g,v,b=!1){const w=new SubmitCommitmentRequest(u,g,v,b),E=await this.transport.request("submit_commitment",w.toJSON(),this.key?new Headers([["X-API-Key",this.key]]):void 0);return SubmitCommitmentResponse.fromJSON(E)}async getInclusionProof(u){const g={requestId:u.toJSON()};return InclusionProofResponse.fromJSON(await this.transport.request("get_inclusion_proof",g))}async getBlockHeight(){const u=await this.transport.request("get_block_height",{});if(u&&typeof u=="object"&&"blockNumber"in u&&(typeof u.blockNumber=="string"||typeof u.blockNumber=="number"||typeof u.blockNumber=="bigint"))return BigInt(u.blockNumber);throw new Error("Invalid response format for block height")}}class RootTrustBaseNodeInfo{nodeId;_signingKey;stakedAmount;constructor(u,g,v){this.nodeId=u,this._signingKey=g,this.stakedAmount=v,this._signingKey=new Uint8Array(g)}get signingKey(){return new Uint8Array(this._signingKey)}static isJSON(u){return typeof u=="object"&&u!==null&&"nodeId"in u&&"sigKey"in u&&"stake"in u}static fromJSON(u){if(!RootTrustBaseNodeInfo.isJSON(u))throw new InvalidJsonStructureError;return new RootTrustBaseNodeInfo(u.nodeId,HexConverter.decode(u.sigKey),BigInt(u.stake))}}class RootTrustBase{version;networkId;epoch;epochStartRound;_rootNodes;quorumThreshold;_stateHash;_changeRecordHash;_previousEntryHash;_signatures;constructor(u,g,v,b,w,E,S,A,$,R){this.version=u,this.networkId=g,this.epoch=v,this.epochStartRound=b,this._rootNodes=w,this.quorumThreshold=E,this._stateHash=S,this._changeRecordHash=A,this._previousEntryHash=$,this._signatures=R,this._rootNodes=w.slice(),this._stateHash=new Uint8Array(S),this._changeRecordHash=A?new Uint8Array(A):null,this._previousEntryHash=$?new Uint8Array($):null,this._signatures=new Map(Array.from(R.entries()).map(T=>[T[0],new Uint8Array(T[1])]))}get rootNodes(){return this._rootNodes.slice()}get stateHash(){return new Uint8Array(this._stateHash)}get changeRecordHash(){return this._changeRecordHash?new Uint8Array(this._changeRecordHash):null}get previousEntryHash(){return this._previousEntryHash?new Uint8Array(this._previousEntryHash):null}get signatures(){return new Map(Array.from(this._signatures.entries()).map(u=>[u[0],new Uint8Array(u[1])]))}static isJSON(u){return typeof u=="object"&&u!==null&&"version"in u&&"networkId"in u&&"epoch"in u&&"epochStartRound"in u&&"rootNodes"in u&&Array.isArray(u.rootNodes)&&"quorumThreshold"in u&&"stateHash"in u&&"changeRecordHash"in u&&"previousEntryHash"in u&&"signatures"in u&&typeof u.signatures=="object"&&u.signatures!==null}static fromJSON(u){if(!RootTrustBase.isJSON(u))throw new InvalidJsonStructureError;return new RootTrustBase(BigInt(u.version),u.networkId,BigInt(u.epoch),BigInt(u.epochStartRound),u.rootNodes.map(g=>RootTrustBaseNodeInfo.fromJSON(g)),BigInt(u.quorumThreshold),HexConverter.decode(u.stateHash),u.changeRecordHash?HexConverter.decode(u.changeRecordHash):null,u.previousEntryHash?HexConverter.decode(u.previousEntryHash):null,new Map(Object.entries(u.signatures).map(([g,v])=>[g,HexConverter.decode(v)])))}}const UNICITY_AGGREGATOR_URL="https://goggregator-test.unicity.network",API_KEY="sk_06365a9c44654841a366068bcfc68986",TEST_SIG_KEY="025f37d20e5b18909361e0ead7ed17c69b417bee70746c9e9c2bcb1394d921d4ae";class ServiceProvider{static _aggregatorClient=null;static _stateTransitionClient=null;static _rootTrustBase=null;static get aggregatorClient(){return this._aggregatorClient||(console.log("Initializing AggregatorClient..."),this._aggregatorClient=new AggregatorClient(UNICITY_AGGREGATOR_URL,API_KEY)),this._aggregatorClient}static get stateTransitionClient(){return this._stateTransitionClient||(this._stateTransitionClient=new StateTransitionClient(ServiceProvider.aggregatorClient)),this._stateTransitionClient}static getRootTrustBase(){if(this._rootTrustBase)return this._rootTrustBase;try{if(trustBaseJson)return this._rootTrustBase=RootTrustBase.fromJSON(trustBaseJson),console.log(" TrustBase loaded from local assets"),this._rootTrustBase}catch(u){console.warn(" Failed to load TrustBase from file, attempting fallback...",u)}try{console.log("Generating Fallback TrustBase...");const u={version:"1",networkId:0,epoch:"1",epochStartRound:"1",rootNodes:[{nodeId:"TEST_NODE",sigKey:"0x"+TEST_SIG_KEY,stake:"1"}],quorumThreshold:"1",stateHash:"",changeRecordHash:null,previousEntryHash:null,signatures:{}};return this._rootTrustBase=RootTrustBase.fromJSON(u),console.log(" TrustBase created using Fallback mechanism"),this._rootTrustBase}catch(u){throw console.error("CRITICAL: Failed to initialize TrustBase",u),new Error("Critical: Could not initialize TrustBase")}}}const ServiceProvider$1=Object.freeze(Object.defineProperty({__proto__:null,ServiceProvider},Symbol.toStringTag,{value:"Module"}));class SleepError extends Error{constructor(u){super(u),this.name="SleepError"}}function sleep(y,u){return new Promise((g,v)=>{const b=setTimeout(g,y);u.addEventListener("abort",()=>{clearTimeout(b),v(u.reason)},{once:!0})})}async function waitInclusionProof(y,u,g,v=AbortSignal.timeout(1e4),b=1e3){for(;;){try{const w=await u.getInclusionProof(g.requestId).then(S=>S.inclusionProof),E=await w.verify(y,g.requestId);switch(E){case InclusionProofVerificationStatus.OK:return w;case InclusionProofVerificationStatus.PATH_NOT_INCLUDED:break;default:throw new Error(`Invalid inclusion proof status: ${E}`)}}catch(w){if(!(w instanceof JsonRpcNetworkError&&w.status===404))throw w}try{await sleep(b,v)}catch(w){throw new SleepError(String(w||"Sleep was aborted"))}}}function bind(y,u){return function(){return y.apply(u,arguments)}}const{toString:toString$5}=Object.prototype,{getPrototypeOf}=Object,{iterator,toStringTag}=Symbol,kindOf=(y=>u=>{const g=toString$5.call(u);return y[g]||(y[g]=g.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=y=>(y=y.toLowerCase(),u=>kindOf(u)===y),typeOfTest=y=>u=>typeof u===y,{isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer$2(y){return y!==null&&!isUndefined(y)&&y.constructor!==null&&!isUndefined(y.constructor)&&isFunction$1(y.constructor.isBuffer)&&y.constructor.isBuffer(y)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(y){let u;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?u=ArrayBuffer.isView(y):u=y&&y.buffer&&isArrayBuffer(y.buffer),u}const isString=typeOfTest("string"),isFunction$1=typeOfTest("function"),isNumber=typeOfTest("number"),isObject$3=y=>y!==null&&typeof y=="object",isBoolean=y=>y===!0||y===!1,isPlainObject$1=y=>{if(kindOf(y)!=="object")return!1;const u=getPrototypeOf(y);return(u===null||u===Object.prototype||Object.getPrototypeOf(u)===null)&&!(toStringTag in y)&&!(iterator in y)},isEmptyObject=y=>{if(!isObject$3(y)||isBuffer$2(y))return!1;try{return Object.keys(y).length===0&&Object.getPrototypeOf(y)===Object.prototype}catch{return!1}},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream$1=y=>isObject$3(y)&&isFunction$1(y.pipe),isFormData=y=>{let u;return y&&(typeof FormData=="function"&&y instanceof FormData||isFunction$1(y.append)&&((u=kindOf(y))==="formdata"||u==="object"&&isFunction$1(y.toString)&&y.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=y=>y.trim?y.trim():y.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach$2(y,u,{allOwnKeys:g=!1}={}){if(y===null||typeof y>"u")return;let v,b;if(typeof y!="object"&&(y=[y]),isArray(y))for(v=0,b=y.length;v<b;v++)u.call(null,y[v],v,y);else{if(isBuffer$2(y))return;const w=g?Object.getOwnPropertyNames(y):Object.keys(y),E=w.length;let S;for(v=0;v<E;v++)S=w[v],u.call(null,y[S],S,y)}}function findKey(y,u){if(isBuffer$2(y))return null;u=u.toLowerCase();const g=Object.keys(y);let v=g.length,b;for(;v-- >0;)if(b=g[v],u===b.toLowerCase())return b;return null}const _global=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global$1,isContextDefined=y=>!isUndefined(y)&&y!==_global;function merge$3(){const{caseless:y,skipUndefined:u}=isContextDefined(this)&&this||{},g={},v=(b,w)=>{const E=y&&findKey(g,w)||w;isPlainObject$1(g[E])&&isPlainObject$1(b)?g[E]=merge$3(g[E],b):isPlainObject$1(b)?g[E]=merge$3({},b):isArray(b)?g[E]=b.slice():(!u||!isUndefined(b))&&(g[E]=b)};for(let b=0,w=arguments.length;b<w;b++)arguments[b]&&forEach$2(arguments[b],v);return g}const extend$1=(y,u,g,{allOwnKeys:v}={})=>(forEach$2(u,(b,w)=>{g&&isFunction$1(b)?y[w]=bind(b,g):y[w]=b},{allOwnKeys:v}),y),stripBOM=y=>(y.charCodeAt(0)===65279&&(y=y.slice(1)),y),inherits=(y,u,g,v)=>{y.prototype=Object.create(u.prototype,v),y.prototype.constructor=y,Object.defineProperty(y,"super",{value:u.prototype}),g&&Object.assign(y.prototype,g)},toFlatObject=(y,u,g,v)=>{let b,w,E;const S={};if(u=u||{},y==null)return u;do{for(b=Object.getOwnPropertyNames(y),w=b.length;w-- >0;)E=b[w],(!v||v(E,y,u))&&!S[E]&&(u[E]=y[E],S[E]=!0);y=g!==!1&&getPrototypeOf(y)}while(y&&(!g||g(y,u))&&y!==Object.prototype);return u},endsWith=(y,u,g)=>{y=String(y),(g===void 0||g>y.length)&&(g=y.length),g-=u.length;const v=y.indexOf(u,g);return v!==-1&&v===g},toArray=y=>{if(!y)return null;if(isArray(y))return y;let u=y.length;if(!isNumber(u))return null;const g=new Array(u);for(;u-- >0;)g[u]=y[u];return g},isTypedArray$1=(y=>u=>y&&u instanceof y)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(y,u)=>{const v=(y&&y[iterator]).call(y);let b;for(;(b=v.next())&&!b.done;){const w=b.value;u.call(y,w[0],w[1])}},matchAll=(y,u)=>{let g;const v=[];for(;(g=y.exec(u))!==null;)v.push(g);return v},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=y=>y.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(g,v,b){return v.toUpperCase()+b}),hasOwnProperty$1=(({hasOwnProperty:y})=>(u,g)=>y.call(u,g))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(y,u)=>{const g=Object.getOwnPropertyDescriptors(y),v={};forEach$2(g,(b,w)=>{let E;(E=u(b,w,y))!==!1&&(v[w]=E||b)}),Object.defineProperties(y,v)},freezeMethods=y=>{reduceDescriptors(y,(u,g)=>{if(isFunction$1(y)&&["arguments","caller","callee"].indexOf(g)!==-1)return!1;const v=y[g];if(isFunction$1(v)){if(u.enumerable=!1,"writable"in u){u.writable=!1;return}u.set||(u.set=()=>{throw Error("Can not rewrite read-only method '"+g+"'")})}})},toObjectSet=(y,u)=>{const g={},v=b=>{b.forEach(w=>{g[w]=!0})};return isArray(y)?v(y):v(String(y).split(u)),g},noop$1=()=>{},toFiniteNumber=(y,u)=>y!=null&&Number.isFinite(y=+y)?y:u;function isSpecCompliantForm(y){return!!(y&&isFunction$1(y.append)&&y[toStringTag]==="FormData"&&y[iterator])}const toJSONObject=y=>{const u=new Array(10),g=(v,b)=>{if(isObject$3(v)){if(u.indexOf(v)>=0)return;if(isBuffer$2(v))return v;if(!("toJSON"in v)){u[b]=v;const w=isArray(v)?[]:{};return forEach$2(v,(E,S)=>{const A=g(E,b+1);!isUndefined(A)&&(w[S]=A)}),u[b]=void 0,w}}return v};return g(y,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable$1=y=>y&&(isObject$3(y)||isFunction$1(y))&&isFunction$1(y.then)&&isFunction$1(y.catch),_setImmediate=((y,u)=>y?setImmediate:u?((g,v)=>(_global.addEventListener("message",({source:b,data:w})=>{b===_global&&w===g&&v.length&&v.shift()()},!1),b=>{v.push(b),_global.postMessage(g,"*")}))(`axios@${Math.random()}`,[]):g=>setTimeout(g))(typeof setImmediate=="function",isFunction$1(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process$1<"u"&&process$1.nextTick||_setImmediate,isIterable$1=y=>y!=null&&isFunction$1(y[iterator]),utils$7={isArray,isArrayBuffer,isBuffer:isBuffer$2,isFormData,isArrayBufferView,isString,isNumber,isBoolean,isObject:isObject$3,isPlainObject:isPlainObject$1,isEmptyObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction:isFunction$1,isStream:isStream$1,isURLSearchParams,isTypedArray:isTypedArray$1,isFileList,forEach:forEach$2,merge:merge$3,extend:extend$1,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,forEachEntry,matchAll,isHTMLForm,hasOwnProperty:hasOwnProperty$1,hasOwnProp:hasOwnProperty$1,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop:noop$1,toFiniteNumber,findKey,global:_global,isContextDefined,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable:isThenable$1,setImmediate:_setImmediate,asap,isIterable:isIterable$1};function AxiosError$1(y,u,g,v,b){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=y,this.name="AxiosError",u&&(this.code=u),g&&(this.config=g),v&&(this.request=v),b&&(this.response=b,this.status=b.status?b.status:null)}utils$7.inherits(AxiosError$1,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$7.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError$1.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(y=>{descriptors[y]={value:y}});Object.defineProperties(AxiosError$1,descriptors);Object.defineProperty(prototype$1,"isAxiosError",{value:!0});AxiosError$1.from=(y,u,g,v,b,w)=>{const E=Object.create(prototype$1);utils$7.toFlatObject(y,E,function(R){return R!==Error.prototype},$=>$!=="isAxiosError");const S=y&&y.message?y.message:"Error",A=u==null&&y?y.code:u;return AxiosError$1.call(E,S,A,g,v,b),y&&E.cause==null&&Object.defineProperty(E,"cause",{value:y,configurable:!0}),E.name=y&&y.name||"Error",w&&Object.assign(E,w),E};const httpAdapter=null;function isVisitable(y){return utils$7.isPlainObject(y)||utils$7.isArray(y)}function removeBrackets(y){return utils$7.endsWith(y,"[]")?y.slice(0,-2):y}function renderKey(y,u,g){return y?y.concat(u).map(function(b,w){return b=removeBrackets(b),!g&&w?"["+b+"]":b}).join(g?".":""):u}function isFlatArray(y){return utils$7.isArray(y)&&!y.some(isVisitable)}const predicates=utils$7.toFlatObject(utils$7,{},null,function(u){return/^is[A-Z]/.test(u)});function toFormData$1(y,u,g){if(!utils$7.isObject(y))throw new TypeError("target must be an object");u=u||new FormData,g=utils$7.toFlatObject(g,{metaTokens:!0,dots:!1,indexes:!1},!1,function(U,q){return!utils$7.isUndefined(q[U])});const v=g.metaTokens,b=g.visitor||R,w=g.dots,E=g.indexes,A=(g.Blob||typeof Blob<"u"&&Blob)&&utils$7.isSpecCompliantForm(u);if(!utils$7.isFunction(b))throw new TypeError("visitor must be a function");function $(F){if(F===null)return"";if(utils$7.isDate(F))return F.toISOString();if(utils$7.isBoolean(F))return F.toString();if(!A&&utils$7.isBlob(F))throw new AxiosError$1("Blob is not supported. Use a Buffer instead.");return utils$7.isArrayBuffer(F)||utils$7.isTypedArray(F)?A&&typeof Blob=="function"?new Blob([F]):Buffer.from(F):F}function R(F,U,q){let J=F;if(F&&!q&&typeof F=="object"){if(utils$7.endsWith(U,"{}"))U=v?U:U.slice(0,-2),F=JSON.stringify(F);else if(utils$7.isArray(F)&&isFlatArray(F)||(utils$7.isFileList(F)||utils$7.endsWith(U,"[]"))&&(J=utils$7.toArray(F)))return U=removeBrackets(U),J.forEach(function(oe,le){!(utils$7.isUndefined(oe)||oe===null)&&u.append(E===!0?renderKey([U],le,w):E===null?U:U+"[]",$(oe))}),!1}return isVisitable(F)?!0:(u.append(renderKey(q,U,w),$(F)),!1)}const T=[],O=Object.assign(predicates,{defaultVisitor:R,convertValue:$,isVisitable});function B(F,U){if(!utils$7.isUndefined(F)){if(T.indexOf(F)!==-1)throw Error("Circular reference detected in "+U.join("."));T.push(F),utils$7.forEach(F,function(J,ie){(!(utils$7.isUndefined(J)||J===null)&&b.call(u,J,utils$7.isString(ie)?ie.trim():ie,U,O))===!0&&B(J,U?U.concat(ie):[ie])}),T.pop()}}if(!utils$7.isObject(y))throw new TypeError("data must be an object");return B(y),u}function encode$i(y){const u={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(y).replace(/[!'()~]|%20|%00/g,function(v){return u[v]})}function AxiosURLSearchParams(y,u){this._pairs=[],y&&toFormData$1(y,this,u)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function(u,g){this._pairs.push([u,g])};prototype.toString=function(u){const g=u?function(v){return u.call(this,v,encode$i)}:encode$i;return this._pairs.map(function(b){return g(b[0])+"="+g(b[1])},"").join("&")};function encode$h(y){return encodeURIComponent(y).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function buildURL(y,u,g){if(!u)return y;const v=g&&g.encode||encode$h;utils$7.isFunction(g)&&(g={serialize:g});const b=g&&g.serialize;let w;if(b?w=b(u,g):w=utils$7.isURLSearchParams(u)?u.toString():new AxiosURLSearchParams(u,g).toString(v),w){const E=y.indexOf("#");E!==-1&&(y=y.slice(0,E)),y+=(y.indexOf("?")===-1?"?":"&")+w}return y}class InterceptorManager{constructor(){this.handlers=[]}use(u,g,v){return this.handlers.push({fulfilled:u,rejected:g,synchronous:v?v.synchronous:!1,runWhen:v?v.runWhen:null}),this.handlers.length-1}eject(u){this.handlers[u]&&(this.handlers[u]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(u){utils$7.forEach(this.handlers,function(v){v!==null&&u(v)})}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",origin=hasBrowserEnv&&window.location.href||"http://localhost",utils$6=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils$6,...platform$1};function toURLEncodedForm(y,u){return toFormData$1(y,new platform.classes.URLSearchParams,{visitor:function(g,v,b,w){return platform.isNode&&utils$7.isBuffer(g)?(this.append(v,g.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)},...u})}function parsePropPath(y){return utils$7.matchAll(/\w+|\[(\w*)]/g,y).map(u=>u[0]==="[]"?"":u[1]||u[0])}function arrayToObject(y){const u={},g=Object.keys(y);let v;const b=g.length;let w;for(v=0;v<b;v++)w=g[v],u[w]=y[w];return u}function formDataToJSON(y){function u(g,v,b,w){let E=g[w++];if(E==="__proto__")return!0;const S=Number.isFinite(+E),A=w>=g.length;return E=!E&&utils$7.isArray(b)?b.length:E,A?(utils$7.hasOwnProp(b,E)?b[E]=[b[E],v]:b[E]=v,!S):((!b[E]||!utils$7.isObject(b[E]))&&(b[E]=[]),u(g,v,b[E],w)&&utils$7.isArray(b[E])&&(b[E]=arrayToObject(b[E])),!S)}if(utils$7.isFormData(y)&&utils$7.isFunction(y.entries)){const g={};return utils$7.forEachEntry(y,(v,b)=>{u(parsePropPath(v),b,g,0)}),g}return null}function stringifySafely(y,u,g){if(utils$7.isString(y))try{return(u||JSON.parse)(y),utils$7.trim(y)}catch(v){if(v.name!=="SyntaxError")throw v}return(g||JSON.stringify)(y)}const defaults$1={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function(u,g){const v=g.getContentType()||"",b=v.indexOf("application/json")>-1,w=utils$7.isObject(u);if(w&&utils$7.isHTMLForm(u)&&(u=new FormData(u)),utils$7.isFormData(u))return b?JSON.stringify(formDataToJSON(u)):u;if(utils$7.isArrayBuffer(u)||utils$7.isBuffer(u)||utils$7.isStream(u)||utils$7.isFile(u)||utils$7.isBlob(u)||utils$7.isReadableStream(u))return u;if(utils$7.isArrayBufferView(u))return u.buffer;if(utils$7.isURLSearchParams(u))return g.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),u.toString();let S;if(w){if(v.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(u,this.formSerializer).toString();if((S=utils$7.isFileList(u))||v.indexOf("multipart/form-data")>-1){const A=this.env&&this.env.FormData;return toFormData$1(S?{"files[]":u}:u,A&&new A,this.formSerializer)}}return w||b?(g.setContentType("application/json",!1),stringifySafely(u)):u}],transformResponse:[function(u){const g=this.transitional||defaults$1.transitional,v=g&&g.forcedJSONParsing,b=this.responseType==="json";if(utils$7.isResponse(u)||utils$7.isReadableStream(u))return u;if(u&&utils$7.isString(u)&&(v&&!this.responseType||b)){const E=!(g&&g.silentJSONParsing)&&b;try{return JSON.parse(u,this.parseReviver)}catch(S){if(E)throw S.name==="SyntaxError"?AxiosError$1.from(S,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response):S}}return u}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(u){return u>=200&&u<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$7.forEach(["delete","get","head","post","put","patch"],y=>{defaults$1.headers[y]={}});const ignoreDuplicateOf=utils$7.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=y=>{const u={};let g,v,b;return y&&y.split(`
`).forEach(function(E){b=E.indexOf(":"),g=E.substring(0,b).trim().toLowerCase(),v=E.substring(b+1).trim(),!(!g||u[g]&&ignoreDuplicateOf[g])&&(g==="set-cookie"?u[g]?u[g].push(v):u[g]=[v]:u[g]=u[g]?u[g]+", "+v:v)}),u},$internals=Symbol("internals");function normalizeHeader(y){return y&&String(y).trim().toLowerCase()}function normalizeValue$1(y){return y===!1||y==null?y:utils$7.isArray(y)?y.map(normalizeValue$1):String(y)}function parseTokens(y){const u=Object.create(null),g=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let v;for(;v=g.exec(y);)u[v[1]]=v[2];return u}const isValidHeaderName=y=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(y.trim());function matchHeaderValue(y,u,g,v,b){if(utils$7.isFunction(v))return v.call(this,u,g);if(b&&(u=g),!!utils$7.isString(u)){if(utils$7.isString(v))return u.indexOf(v)!==-1;if(utils$7.isRegExp(v))return v.test(u)}}function formatHeader(y){return y.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(u,g,v)=>g.toUpperCase()+v)}function buildAccessors(y,u){const g=utils$7.toCamelCase(" "+u);["get","set","has"].forEach(v=>{Object.defineProperty(y,v+g,{value:function(b,w,E){return this[v].call(this,u,b,w,E)},configurable:!0})})}let AxiosHeaders$1=class{constructor(u){u&&this.set(u)}set(u,g,v){const b=this;function w(S,A,$){const R=normalizeHeader(A);if(!R)throw new Error("header name must be a non-empty string");const T=utils$7.findKey(b,R);(!T||b[T]===void 0||$===!0||$===void 0&&b[T]!==!1)&&(b[T||A]=normalizeValue$1(S))}const E=(S,A)=>utils$7.forEach(S,($,R)=>w($,R,A));if(utils$7.isPlainObject(u)||u instanceof this.constructor)E(u,g);else if(utils$7.isString(u)&&(u=u.trim())&&!isValidHeaderName(u))E(parseHeaders(u),g);else if(utils$7.isObject(u)&&utils$7.isIterable(u)){let S={},A,$;for(const R of u){if(!utils$7.isArray(R))throw TypeError("Object iterator must return a key-value pair");S[$=R[0]]=(A=S[$])?utils$7.isArray(A)?[...A,R[1]]:[A,R[1]]:R[1]}E(S,g)}else u!=null&&w(g,u,v);return this}get(u,g){if(u=normalizeHeader(u),u){const v=utils$7.findKey(this,u);if(v){const b=this[v];if(!g)return b;if(g===!0)return parseTokens(b);if(utils$7.isFunction(g))return g.call(this,b,v);if(utils$7.isRegExp(g))return g.exec(b);throw new TypeError("parser must be boolean|regexp|function")}}}has(u,g){if(u=normalizeHeader(u),u){const v=utils$7.findKey(this,u);return!!(v&&this[v]!==void 0&&(!g||matchHeaderValue(this,this[v],v,g)))}return!1}delete(u,g){const v=this;let b=!1;function w(E){if(E=normalizeHeader(E),E){const S=utils$7.findKey(v,E);S&&(!g||matchHeaderValue(v,v[S],S,g))&&(delete v[S],b=!0)}}return utils$7.isArray(u)?u.forEach(w):w(u),b}clear(u){const g=Object.keys(this);let v=g.length,b=!1;for(;v--;){const w=g[v];(!u||matchHeaderValue(this,this[w],w,u,!0))&&(delete this[w],b=!0)}return b}normalize(u){const g=this,v={};return utils$7.forEach(this,(b,w)=>{const E=utils$7.findKey(v,w);if(E){g[E]=normalizeValue$1(b),delete g[w];return}const S=u?formatHeader(w):String(w).trim();S!==w&&delete g[w],g[S]=normalizeValue$1(b),v[S]=!0}),this}concat(...u){return this.constructor.concat(this,...u)}toJSON(u){const g=Object.create(null);return utils$7.forEach(this,(v,b)=>{v!=null&&v!==!1&&(g[b]=u&&utils$7.isArray(v)?v.join(", "):v)}),g}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([u,g])=>u+": "+g).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(u){return u instanceof this?u:new this(u)}static concat(u,...g){const v=new this(u);return g.forEach(b=>v.set(b)),v}static accessor(u){const v=(this[$internals]=this[$internals]={accessors:{}}).accessors,b=this.prototype;function w(E){const S=normalizeHeader(E);v[S]||(buildAccessors(b,E),v[S]=!0)}return utils$7.isArray(u)?u.forEach(w):w(u),this}};AxiosHeaders$1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils$7.reduceDescriptors(AxiosHeaders$1.prototype,({value:y},u)=>{let g=u[0].toUpperCase()+u.slice(1);return{get:()=>y,set(v){this[g]=v}}});utils$7.freezeMethods(AxiosHeaders$1);function transformData(y,u){const g=this||defaults$1,v=u||g,b=AxiosHeaders$1.from(v.headers);let w=v.data;return utils$7.forEach(y,function(S){w=S.call(g,w,b.normalize(),u?u.status:void 0)}),b.normalize(),w}function isCancel$1(y){return!!(y&&y.__CANCEL__)}function CanceledError$1(y,u,g){AxiosError$1.call(this,y??"canceled",AxiosError$1.ERR_CANCELED,u,g),this.name="CanceledError"}utils$7.inherits(CanceledError$1,AxiosError$1,{__CANCEL__:!0});function settle(y,u,g){const v=g.config.validateStatus;!g.status||!v||v(g.status)?y(g):u(new AxiosError$1("Request failed with status code "+g.status,[AxiosError$1.ERR_BAD_REQUEST,AxiosError$1.ERR_BAD_RESPONSE][Math.floor(g.status/100)-4],g.config,g.request,g))}function parseProtocol(y){const u=/^([-+\w]{1,25})(:?\/\/|:)/.exec(y);return u&&u[1]||""}function speedometer(y,u){y=y||10;const g=new Array(y),v=new Array(y);let b=0,w=0,E;return u=u!==void 0?u:1e3,function(A){const $=Date.now(),R=v[w];E||(E=$),g[b]=A,v[b]=$;let T=w,O=0;for(;T!==b;)O+=g[T++],T=T%y;if(b=(b+1)%y,b===w&&(w=(w+1)%y),$-E<u)return;const B=R&&$-R;return B?Math.round(O*1e3/B):void 0}}function throttle$1(y,u){let g=0,v=1e3/u,b,w;const E=($,R=Date.now())=>{g=R,b=null,w&&(clearTimeout(w),w=null),y(...$)};return[(...$)=>{const R=Date.now(),T=R-g;T>=v?E($,R):(b=$,w||(w=setTimeout(()=>{w=null,E(b)},v-T)))},()=>b&&E(b)]}const progressEventReducer=(y,u,g=3)=>{let v=0;const b=speedometer(50,250);return throttle$1(w=>{const E=w.loaded,S=w.lengthComputable?w.total:void 0,A=E-v,$=b(A),R=E<=S;v=E;const T={loaded:E,total:S,progress:S?E/S:void 0,bytes:A,rate:$||void 0,estimated:$&&S&&R?(S-E)/$:void 0,event:w,lengthComputable:S!=null,[u?"download":"upload"]:!0};y(T)},g)},progressEventDecorator=(y,u)=>{const g=y!=null;return[v=>u[0]({lengthComputable:g,total:y,loaded:v}),u[1]]},asyncDecorator=y=>(...u)=>utils$7.asap(()=>y(...u)),isURLSameOrigin=platform.hasStandardBrowserEnv?((y,u)=>g=>(g=new URL(g,platform.origin),y.protocol===g.protocol&&y.host===g.host&&(u||y.port===g.port)))(new URL(platform.origin),platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent)):()=>!0,cookies=platform.hasStandardBrowserEnv?{write(y,u,g,v,b,w,E){if(typeof document>"u")return;const S=[`${y}=${encodeURIComponent(u)}`];utils$7.isNumber(g)&&S.push(`expires=${new Date(g).toUTCString()}`),utils$7.isString(v)&&S.push(`path=${v}`),utils$7.isString(b)&&S.push(`domain=${b}`),w===!0&&S.push("secure"),utils$7.isString(E)&&S.push(`SameSite=${E}`),document.cookie=S.join("; ")},read(y){if(typeof document>"u")return null;const u=document.cookie.match(new RegExp("(?:^|; )"+y+"=([^;]*)"));return u?decodeURIComponent(u[1]):null},remove(y){this.write(y,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(y){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(y)}function combineURLs(y,u){return u?y.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):y}function buildFullPath(y,u,g){let v=!isAbsoluteURL(u);return y&&(v||g==!1)?combineURLs(y,u):u}const headersToObject=y=>y instanceof AxiosHeaders$1?{...y}:y;function mergeConfig$1(y,u){u=u||{};const g={};function v($,R,T,O){return utils$7.isPlainObject($)&&utils$7.isPlainObject(R)?utils$7.merge.call({caseless:O},$,R):utils$7.isPlainObject(R)?utils$7.merge({},R):utils$7.isArray(R)?R.slice():R}function b($,R,T,O){if(utils$7.isUndefined(R)){if(!utils$7.isUndefined($))return v(void 0,$,T,O)}else return v($,R,T,O)}function w($,R){if(!utils$7.isUndefined(R))return v(void 0,R)}function E($,R){if(utils$7.isUndefined(R)){if(!utils$7.isUndefined($))return v(void 0,$)}else return v(void 0,R)}function S($,R,T){if(T in u)return v($,R);if(T in y)return v(void 0,$)}const A={url:w,method:w,data:w,baseURL:E,transformRequest:E,transformResponse:E,paramsSerializer:E,timeout:E,timeoutMessage:E,withCredentials:E,withXSRFToken:E,adapter:E,responseType:E,xsrfCookieName:E,xsrfHeaderName:E,onUploadProgress:E,onDownloadProgress:E,decompress:E,maxContentLength:E,maxBodyLength:E,beforeRedirect:E,transport:E,httpAgent:E,httpsAgent:E,cancelToken:E,socketPath:E,responseEncoding:E,validateStatus:S,headers:($,R,T)=>b(headersToObject($),headersToObject(R),T,!0)};return utils$7.forEach(Object.keys({...y,...u}),function(R){const T=A[R]||b,O=T(y[R],u[R],R);utils$7.isUndefined(O)&&T!==S||(g[R]=O)}),g}const resolveConfig=y=>{const u=mergeConfig$1({},y);let{data:g,withXSRFToken:v,xsrfHeaderName:b,xsrfCookieName:w,headers:E,auth:S}=u;if(u.headers=E=AxiosHeaders$1.from(E),u.url=buildURL(buildFullPath(u.baseURL,u.url,u.allowAbsoluteUrls),y.params,y.paramsSerializer),S&&E.set("Authorization","Basic "+btoa((S.username||"")+":"+(S.password?unescape(encodeURIComponent(S.password)):""))),utils$7.isFormData(g)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)E.setContentType(void 0);else if(utils$7.isFunction(g.getHeaders)){const A=g.getHeaders(),$=["content-type","content-length"];Object.entries(A).forEach(([R,T])=>{$.includes(R.toLowerCase())&&E.set(R,T)})}}if(platform.hasStandardBrowserEnv&&(v&&utils$7.isFunction(v)&&(v=v(u)),v||v!==!1&&isURLSameOrigin(u.url))){const A=b&&w&&cookies.read(w);A&&E.set(b,A)}return u},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(y){return new Promise(function(g,v){const b=resolveConfig(y);let w=b.data;const E=AxiosHeaders$1.from(b.headers).normalize();let{responseType:S,onUploadProgress:A,onDownloadProgress:$}=b,R,T,O,B,F;function U(){B&&B(),F&&F(),b.cancelToken&&b.cancelToken.unsubscribe(R),b.signal&&b.signal.removeEventListener("abort",R)}let q=new XMLHttpRequest;q.open(b.method.toUpperCase(),b.url,!0),q.timeout=b.timeout;function J(){if(!q)return;const oe=AxiosHeaders$1.from("getAllResponseHeaders"in q&&q.getAllResponseHeaders()),de={data:!S||S==="text"||S==="json"?q.responseText:q.response,status:q.status,statusText:q.statusText,headers:oe,config:y,request:q};settle(function(ye){g(ye),U()},function(ye){v(ye),U()},de),q=null}"onloadend"in q?q.onloadend=J:q.onreadystatechange=function(){!q||q.readyState!==4||q.status===0&&!(q.responseURL&&q.responseURL.indexOf("file:")===0)||setTimeout(J)},q.onabort=function(){q&&(v(new AxiosError$1("Request aborted",AxiosError$1.ECONNABORTED,y,q)),q=null)},q.onerror=function(le){const de=le&&le.message?le.message:"Network Error",fe=new AxiosError$1(de,AxiosError$1.ERR_NETWORK,y,q);fe.event=le||null,v(fe),q=null},q.ontimeout=function(){let le=b.timeout?"timeout of "+b.timeout+"ms exceeded":"timeout exceeded";const de=b.transitional||transitionalDefaults;b.timeoutErrorMessage&&(le=b.timeoutErrorMessage),v(new AxiosError$1(le,de.clarifyTimeoutError?AxiosError$1.ETIMEDOUT:AxiosError$1.ECONNABORTED,y,q)),q=null},w===void 0&&E.setContentType(null),"setRequestHeader"in q&&utils$7.forEach(E.toJSON(),function(le,de){q.setRequestHeader(de,le)}),utils$7.isUndefined(b.withCredentials)||(q.withCredentials=!!b.withCredentials),S&&S!=="json"&&(q.responseType=b.responseType),$&&([O,F]=progressEventReducer($,!0),q.addEventListener("progress",O)),A&&q.upload&&([T,B]=progressEventReducer(A),q.upload.addEventListener("progress",T),q.upload.addEventListener("loadend",B)),(b.cancelToken||b.signal)&&(R=oe=>{q&&(v(!oe||oe.type?new CanceledError$1(null,y,q):oe),q.abort(),q=null)},b.cancelToken&&b.cancelToken.subscribe(R),b.signal&&(b.signal.aborted?R():b.signal.addEventListener("abort",R)));const ie=parseProtocol(b.url);if(ie&&platform.protocols.indexOf(ie)===-1){v(new AxiosError$1("Unsupported protocol "+ie+":",AxiosError$1.ERR_BAD_REQUEST,y));return}q.send(w||null)})},composeSignals=(y,u)=>{const{length:g}=y=y?y.filter(Boolean):[];if(u||g){let v=new AbortController,b;const w=function($){if(!b){b=!0,S();const R=$ instanceof Error?$:this.reason;v.abort(R instanceof AxiosError$1?R:new CanceledError$1(R instanceof Error?R.message:R))}};let E=u&&setTimeout(()=>{E=null,w(new AxiosError$1(`timeout ${u} of ms exceeded`,AxiosError$1.ETIMEDOUT))},u);const S=()=>{y&&(E&&clearTimeout(E),E=null,y.forEach($=>{$.unsubscribe?$.unsubscribe(w):$.removeEventListener("abort",w)}),y=null)};y.forEach($=>$.addEventListener("abort",w));const{signal:A}=v;return A.unsubscribe=()=>utils$7.asap(S),A}},streamChunk=function*(y,u){let g=y.byteLength;if(g<u){yield y;return}let v=0,b;for(;v<g;)b=v+u,yield y.slice(v,b),v=b},readBytes=async function*(y,u){for await(const g of readStream(y))yield*streamChunk(g,u)},readStream=async function*(y){if(y[Symbol.asyncIterator]){yield*y;return}const u=y.getReader();try{for(;;){const{done:g,value:v}=await u.read();if(g)break;yield v}}finally{await u.cancel()}},trackStream=(y,u,g,v)=>{const b=readBytes(y,u);let w=0,E,S=A=>{E||(E=!0,v&&v(A))};return new ReadableStream({async pull(A){try{const{done:$,value:R}=await b.next();if($){S(),A.close();return}let T=R.byteLength;if(g){let O=w+=T;g(O)}A.enqueue(new Uint8Array(R))}catch($){throw S($),$}},cancel(A){return S(A),b.return()}},{highWaterMark:2})},DEFAULT_CHUNK_SIZE=64*1024,{isFunction}=utils$7,globalFetchAPI=(({Request:y,Response:u})=>({Request:y,Response:u}))(utils$7.global),{ReadableStream:ReadableStream$1,TextEncoder:TextEncoder$1}=utils$7.global,test=(y,...u)=>{try{return!!y(...u)}catch{return!1}},factory=y=>{y=utils$7.merge.call({skipUndefined:!0},globalFetchAPI,y);const{fetch:u,Request:g,Response:v}=y,b=u?isFunction(u):typeof fetch=="function",w=isFunction(g),E=isFunction(v);if(!b)return!1;const S=b&&isFunction(ReadableStream$1),A=b&&(typeof TextEncoder$1=="function"?(F=>U=>F.encode(U))(new TextEncoder$1):async F=>new Uint8Array(await new g(F).arrayBuffer())),$=w&&S&&test(()=>{let F=!1;const U=new g(platform.origin,{body:new ReadableStream$1,method:"POST",get duplex(){return F=!0,"half"}}).headers.has("Content-Type");return F&&!U}),R=E&&S&&test(()=>utils$7.isReadableStream(new v("").body)),T={stream:R&&(F=>F.body)};b&&["text","arrayBuffer","blob","formData","stream"].forEach(F=>{!T[F]&&(T[F]=(U,q)=>{let J=U&&U[F];if(J)return J.call(U);throw new AxiosError$1(`Response type '${F}' is not supported`,AxiosError$1.ERR_NOT_SUPPORT,q)})});const O=async F=>{if(F==null)return 0;if(utils$7.isBlob(F))return F.size;if(utils$7.isSpecCompliantForm(F))return(await new g(platform.origin,{method:"POST",body:F}).arrayBuffer()).byteLength;if(utils$7.isArrayBufferView(F)||utils$7.isArrayBuffer(F))return F.byteLength;if(utils$7.isURLSearchParams(F)&&(F=F+""),utils$7.isString(F))return(await A(F)).byteLength},B=async(F,U)=>{const q=utils$7.toFiniteNumber(F.getContentLength());return q??O(U)};return async F=>{let{url:U,method:q,data:J,signal:ie,cancelToken:oe,timeout:le,onDownloadProgress:de,onUploadProgress:fe,responseType:ye,headers:we,withCredentials:pe="same-origin",fetchOptions:ve}=resolveConfig(F),he=u||fetch;ye=ye?(ye+"").toLowerCase():"text";let ae=composeSignals([ie,oe&&oe.toAbortSignal()],le),Q=null;const j=ae&&ae.unsubscribe&&(()=>{ae.unsubscribe()});let z;try{if(fe&&$&&q!=="get"&&q!=="head"&&(z=await B(we,J))!==0){let ee=new g(U,{method:"POST",body:J,duplex:"half"}),Z;if(utils$7.isFormData(J)&&(Z=ee.headers.get("content-type"))&&we.setContentType(Z),ee.body){const[ue,_e]=progressEventDecorator(z,progressEventReducer(asyncDecorator(fe)));J=trackStream(ee.body,DEFAULT_CHUNK_SIZE,ue,_e)}}utils$7.isString(pe)||(pe=pe?"include":"omit");const re=w&&"credentials"in g.prototype,Y={...ve,signal:ae,method:q.toUpperCase(),headers:we.normalize().toJSON(),body:J,duplex:"half",credentials:re?pe:void 0};Q=w&&new g(U,Y);let te=await(w?he(Q,ve):he(U,Y));const ne=R&&(ye==="stream"||ye==="response");if(R&&(de||ne&&j)){const ee={};["status","statusText","headers"].forEach(Re=>{ee[Re]=te[Re]});const Z=utils$7.toFiniteNumber(te.headers.get("content-length")),[ue,_e]=de&&progressEventDecorator(Z,progressEventReducer(asyncDecorator(de),!0))||[];te=new v(trackStream(te.body,DEFAULT_CHUNK_SIZE,ue,()=>{_e&&_e(),j&&j()}),ee)}ye=ye||"text";let se=await T[utils$7.findKey(T,ye)||"text"](te,F);return!ne&&j&&j(),await new Promise((ee,Z)=>{settle(ee,Z,{data:se,headers:AxiosHeaders$1.from(te.headers),status:te.status,statusText:te.statusText,config:F,request:Q})})}catch(re){throw j&&j(),re&&re.name==="TypeError"&&/Load failed|fetch/i.test(re.message)?Object.assign(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,F,Q),{cause:re.cause||re}):AxiosError$1.from(re,re&&re.code,F,Q)}}},seedCache=new Map,getFetch=y=>{let u=y&&y.env||{};const{fetch:g,Request:v,Response:b}=u,w=[v,b,g];let E=w.length,S=E,A,$,R=seedCache;for(;S--;)A=w[S],$=R.get(A),$===void 0&&R.set(A,$=S?new Map:factory(u)),R=$;return $};getFetch();const knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:{get:getFetch}};utils$7.forEach(knownAdapters,(y,u)=>{if(y){try{Object.defineProperty(y,"name",{value:u})}catch{}Object.defineProperty(y,"adapterName",{value:u})}});const renderReason=y=>`- ${y}`,isResolvedHandle=y=>utils$7.isFunction(y)||y===null||y===!1;function getAdapter$1(y,u){y=utils$7.isArray(y)?y:[y];const{length:g}=y;let v,b;const w={};for(let E=0;E<g;E++){v=y[E];let S;if(b=v,!isResolvedHandle(v)&&(b=knownAdapters[(S=String(v)).toLowerCase()],b===void 0))throw new AxiosError$1(`Unknown adapter '${S}'`);if(b&&(utils$7.isFunction(b)||(b=b.get(u))))break;w[S||"#"+E]=b}if(!b){const E=Object.entries(w).map(([A,$])=>`adapter ${A} `+($===!1?"is not supported by the environment":"is not available in the build"));let S=g?E.length>1?`since :
`+E.map(renderReason).join(`
`):" "+renderReason(E[0]):"as no adapter specified";throw new AxiosError$1("There is no suitable adapter to dispatch the request "+S,"ERR_NOT_SUPPORT")}return b}const adapters={getAdapter:getAdapter$1,adapters:knownAdapters};function throwIfCancellationRequested(y){if(y.cancelToken&&y.cancelToken.throwIfRequested(),y.signal&&y.signal.aborted)throw new CanceledError$1(null,y)}function dispatchRequest(y){return throwIfCancellationRequested(y),y.headers=AxiosHeaders$1.from(y.headers),y.data=transformData.call(y,y.transformRequest),["post","put","patch"].indexOf(y.method)!==-1&&y.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(y.adapter||defaults$1.adapter,y)(y).then(function(v){return throwIfCancellationRequested(y),v.data=transformData.call(y,y.transformResponse,v),v.headers=AxiosHeaders$1.from(v.headers),v},function(v){return isCancel$1(v)||(throwIfCancellationRequested(y),v&&v.response&&(v.response.data=transformData.call(y,y.transformResponse,v.response),v.response.headers=AxiosHeaders$1.from(v.response.headers))),Promise.reject(v)})}const VERSION$2="1.13.2",validators$2={};["object","boolean","number","function","string","symbol"].forEach((y,u)=>{validators$2[y]=function(v){return typeof v===y||"a"+(u<1?"n ":" ")+y}});const deprecatedWarnings={};validators$2.transitional=function(u,g,v){function b(w,E){return"[Axios v"+VERSION$2+"] Transitional option '"+w+"'"+E+(v?". "+v:"")}return(w,E,S)=>{if(u===!1)throw new AxiosError$1(b(E," has been removed"+(g?" in "+g:"")),AxiosError$1.ERR_DEPRECATED);return g&&!deprecatedWarnings[E]&&(deprecatedWarnings[E]=!0,console.warn(b(E," has been deprecated since v"+g+" and will be removed in the near future"))),u?u(w,E,S):!0}};validators$2.spelling=function(u){return(g,v)=>(console.warn(`${v} is likely a misspelling of ${u}`),!0)};function assertOptions(y,u,g){if(typeof y!="object")throw new AxiosError$1("options must be an object",AxiosError$1.ERR_BAD_OPTION_VALUE);const v=Object.keys(y);let b=v.length;for(;b-- >0;){const w=v[b],E=u[w];if(E){const S=y[w],A=S===void 0||E(S,w,y);if(A!==!0)throw new AxiosError$1("option "+w+" must be "+A,AxiosError$1.ERR_BAD_OPTION_VALUE);continue}if(g!==!0)throw new AxiosError$1("Unknown option "+w,AxiosError$1.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$2},validators$1=validator.validators;let Axios$1=class{constructor(u){this.defaults=u||{},this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(u,g){try{return await this._request(u,g)}catch(v){if(v instanceof Error){let b={};Error.captureStackTrace?Error.captureStackTrace(b):b=new Error;const w=b.stack?b.stack.replace(/^.+\n/,""):"";try{v.stack?w&&!String(v.stack).endsWith(w.replace(/^.+\n.+\n/,""))&&(v.stack+=`
`+w):v.stack=w}catch{}}throw v}}_request(u,g){typeof u=="string"?(g=g||{},g.url=u):g=u||{},g=mergeConfig$1(this.defaults,g);const{transitional:v,paramsSerializer:b,headers:w}=g;v!==void 0&&validator.assertOptions(v,{silentJSONParsing:validators$1.transitional(validators$1.boolean),forcedJSONParsing:validators$1.transitional(validators$1.boolean),clarifyTimeoutError:validators$1.transitional(validators$1.boolean)},!1),b!=null&&(utils$7.isFunction(b)?g.paramsSerializer={serialize:b}:validator.assertOptions(b,{encode:validators$1.function,serialize:validators$1.function},!0)),g.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?g.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:g.allowAbsoluteUrls=!0),validator.assertOptions(g,{baseUrl:validators$1.spelling("baseURL"),withXsrfToken:validators$1.spelling("withXSRFToken")},!0),g.method=(g.method||this.defaults.method||"get").toLowerCase();let E=w&&utils$7.merge(w.common,w[g.method]);w&&utils$7.forEach(["delete","get","head","post","put","patch","common"],F=>{delete w[F]}),g.headers=AxiosHeaders$1.concat(E,w);const S=[];let A=!0;this.interceptors.request.forEach(function(U){typeof U.runWhen=="function"&&U.runWhen(g)===!1||(A=A&&U.synchronous,S.unshift(U.fulfilled,U.rejected))});const $=[];this.interceptors.response.forEach(function(U){$.push(U.fulfilled,U.rejected)});let R,T=0,O;if(!A){const F=[dispatchRequest.bind(this),void 0];for(F.unshift(...S),F.push(...$),O=F.length,R=Promise.resolve(g);T<O;)R=R.then(F[T++],F[T++]);return R}O=S.length;let B=g;for(;T<O;){const F=S[T++],U=S[T++];try{B=F(B)}catch(q){U.call(this,q);break}}try{R=dispatchRequest.call(this,B)}catch(F){return Promise.reject(F)}for(T=0,O=$.length;T<O;)R=R.then($[T++],$[T++]);return R}getUri(u){u=mergeConfig$1(this.defaults,u);const g=buildFullPath(u.baseURL,u.url,u.allowAbsoluteUrls);return buildURL(g,u.params,u.paramsSerializer)}};utils$7.forEach(["delete","get","head","options"],function(u){Axios$1.prototype[u]=function(g,v){return this.request(mergeConfig$1(v||{},{method:u,url:g,data:(v||{}).data}))}});utils$7.forEach(["post","put","patch"],function(u){function g(v){return function(w,E,S){return this.request(mergeConfig$1(S||{},{method:u,headers:v?{"Content-Type":"multipart/form-data"}:{},url:w,data:E}))}}Axios$1.prototype[u]=g(),Axios$1.prototype[u+"Form"]=g(!0)});let CancelToken$1=class ch{constructor(u){if(typeof u!="function")throw new TypeError("executor must be a function.");let g;this.promise=new Promise(function(w){g=w});const v=this;this.promise.then(b=>{if(!v._listeners)return;let w=v._listeners.length;for(;w-- >0;)v._listeners[w](b);v._listeners=null}),this.promise.then=b=>{let w;const E=new Promise(S=>{v.subscribe(S),w=S}).then(b);return E.cancel=function(){v.unsubscribe(w)},E},u(function(w,E,S){v.reason||(v.reason=new CanceledError$1(w,E,S),g(v.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(u){if(this.reason){u(this.reason);return}this._listeners?this._listeners.push(u):this._listeners=[u]}unsubscribe(u){if(!this._listeners)return;const g=this._listeners.indexOf(u);g!==-1&&this._listeners.splice(g,1)}toAbortSignal(){const u=new AbortController,g=v=>{u.abort(v)};return this.subscribe(g),u.signal.unsubscribe=()=>this.unsubscribe(g),u.signal}static source(){let u;return{token:new ch(function(b){u=b}),cancel:u}}};function spread$1(y){return function(g){return y.apply(null,g)}}function isAxiosError$1(y){return utils$7.isObject(y)&&y.isAxiosError===!0}const HttpStatusCode$1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(HttpStatusCode$1).forEach(([y,u])=>{HttpStatusCode$1[u]=y});function createInstance(y){const u=new Axios$1(y),g=bind(Axios$1.prototype.request,u);return utils$7.extend(g,Axios$1.prototype,u,{allOwnKeys:!0}),utils$7.extend(g,u,null,{allOwnKeys:!0}),g.create=function(b){return createInstance(mergeConfig$1(y,b))},g}const axios=createInstance(defaults$1);axios.Axios=Axios$1;axios.CanceledError=CanceledError$1;axios.CancelToken=CancelToken$1;axios.isCancel=isCancel$1;axios.VERSION=VERSION$2;axios.toFormData=toFormData$1;axios.AxiosError=AxiosError$1;axios.Cancel=axios.CanceledError;axios.all=function(u){return Promise.all(u)};axios.spread=spread$1;axios.isAxiosError=isAxiosError$1;axios.mergeConfig=mergeConfig$1;axios.AxiosHeaders=AxiosHeaders$1;axios.formToJSON=y=>formDataToJSON(utils$7.isHTMLForm(y)?new FormData(y):y);axios.getAdapter=adapters.getAdapter;axios.HttpStatusCode=HttpStatusCode$1;axios.default=axios;const{Axios,AxiosError,CanceledError,isCancel,CancelToken,VERSION:VERSION$1,all:all$1,Cancel,isAxiosError,spread,toFormData,AxiosHeaders,HttpStatusCode,formToJSON,getAdapter,mergeConfig}=axios,REGISTRY_URL$1="https://raw.githubusercontent.com/unicitynetwork/unicity-ids/refs/heads/main/unicity-ids.testnet.json",COINGECKO_URL="https://api.coingecko.com/api/v3/simple/price",DEFAULT_PRICES={bitcoin:{priceUsd:98500,priceEur:91200,change24h:2.3,timestamp:Date.now()},ethereum:{priceUsd:3850,priceEur:3560,change24h:1.8,timestamp:Date.now()},tether:{priceUsd:1,priceEur:.92,change24h:.01,timestamp:Date.now()},solana:{priceUsd:220,priceEur:218.92,change24h:.11,timestamp:Date.now()},efranc:{priceUsd:.00169,priceEur:.00152,change24h:.01,timestamp:Date.now()},enaira:{priceUsd:647e-6,priceEur:564e-6,change24h:.02,timestamp:Date.now()}},ApiService={fetchPrices:async()=>{try{const y=await axios.get(COINGECKO_URL,{params:{ids:"bitcoin,ethereum,tether,solana",vs_currencies:"usd,eur",include_24hr_change:"true"},timeout:5e3}),u={},g=y.data,v=Date.now();return Object.keys(g).forEach(b=>{u[b]={priceUsd:g[b].usd||DEFAULT_PRICES[b]?.priceUsd||0,priceEur:g[b].eur||DEFAULT_PRICES[b]?.priceEur||0,change24h:g[b].usd_24h_change||DEFAULT_PRICES[b]?.change24h||0,timestamp:v}}),{...DEFAULT_PRICES,...u}}catch(y){return console.warn("API: Failed to fetch prices (using defaults)",y),DEFAULT_PRICES}},fetchRegistry:async()=>{try{const y=await axios.get(REGISTRY_URL$1,{timeout:1e4});return Array.isArray(y.data)?y.data:[]}catch(y){return console.error("API: Failed to fetch registry",y),[]}},getBestIconUrl:y=>{if(y.icons&&y.icons.length>0){const u=y.icons.find(g=>g.url.toLowerCase().includes(".png"));return u?u.url:y.icons[0].url}return y.icon||null}};class WalletRepository{static instance;_wallet=null;_currentAddress=null;_migrationComplete=!1;_nametag=null;_tombstones=[];_transactionHistory=[];_archivedTokens=new Map;_forkedTokens=new Map;_refreshDebounceTimer=null;constructor(){this.loadTransactionHistory()}static getInstance(){return WalletRepository.instance||(WalletRepository.instance=new WalletRepository),WalletRepository.instance}static checkNametagForAddress(u){if(!u)return null;const g=STORAGE_KEY_GENERATORS.walletByAddress(u);try{const v=localStorage.getItem(g);if(v)return JSON.parse(v).nametag||null}catch(v){console.error("Error checking nametag for address:",v)}return null}static checkTokensForAddress(u){if(!u)return!1;const g=STORAGE_KEY_GENERATORS.walletByAddress(u);try{const v=localStorage.getItem(g);if(v){const b=JSON.parse(v);return Array.isArray(b.tokens)&&b.tokens.length>0}}catch(v){console.error("Error checking tokens for address:",v)}return!1}static saveNametagForAddress(u,g){if(!u||!g)return;const v=STORAGE_KEY_GENERATORS.walletByAddress(u);try{let b;const w=localStorage.getItem(v);w?(b=JSON.parse(w),b.nametag=g):b={id:crypto.randomUUID?crypto.randomUUID():`wallet-${Date.now()}`,name:"Wallet",address:u,tokens:[],nametag:g},localStorage.setItem(v,JSON.stringify(b)),console.log(` Saved IPNS-fetched nametag "${g.name}" for address ${u.slice(0,20)}...`)}catch(b){console.error("Error saving nametag for address:",b)}}validateAddress(u){if(!u||typeof u!="string")return!1;const g=u.trim();return!(g.length<20||/[<>"'\\]|\.\./.test(g))}getStorageKey(u){return STORAGE_KEY_GENERATORS.walletByAddress(u)}migrateLegacyWallet(){if(!this._migrationComplete)try{const u=localStorage.getItem(STORAGE_KEYS.WALLET_DATA_LEGACY);if(!u){this._migrationComplete=!0;return}console.log("Migrating legacy wallet data to address-based storage...");const g=JSON.parse(u);if(!g.address){console.warn("Legacy wallet has no address, cannot migrate"),this._migrationComplete=!0;return}if(!this.validateAddress(g.address)){console.error(`Legacy wallet has invalid address: ${g.address}`),this._migrationComplete=!0;return}const v=this.getStorageKey(g.address);if(localStorage.getItem(v)){console.log("Wallet already migrated, removing legacy key"),localStorage.removeItem(STORAGE_KEYS.WALLET_DATA_LEGACY),this._migrationComplete=!0;return}localStorage.setItem(v,u),localStorage.removeItem(STORAGE_KEYS.WALLET_DATA_LEGACY),console.log(`Successfully migrated wallet for ${g.address}`),this._migrationComplete=!0}catch(u){console.error("Failed to migrate legacy wallet",u),this._migrationComplete=!0}}loadWalletForAddress(u){if(!this.validateAddress(u))return console.error(`Invalid address format: ${u}`),null;try{this.migrateLegacyWallet();const g=this.getStorageKey(u),v=localStorage.getItem(g);if(v){const b=JSON.parse(v);if(!b.id||!b.address||!Array.isArray(b.tokens))return console.error(`Invalid wallet structure in storage for ${u}`),localStorage.removeItem(g),null;if(b.address!==u)return console.error(`Address mismatch: requested ${u}, stored ${b.address}. Removing corrupted data.`),localStorage.removeItem(g),null;const w=b.tokens.map($=>new Token$3($)),E=new Wallet(b.id,b.name,b.address,w);if(this._wallet=E,this._currentAddress=u,this._nametag=b.nametag||null,this._tombstones=[],b.tombstones&&Array.isArray(b.tombstones))for(const $ of b.tombstones)typeof $=="object"&&$!==null&&typeof $.tokenId=="string"&&typeof $.stateHash=="string"&&typeof $.timestamp=="number"&&this._tombstones.push($);if(this._archivedTokens=new Map,b.archivedTokens&&typeof b.archivedTokens=="object")for(const[$,R]of Object.entries(b.archivedTokens))R&&typeof R=="object"&&R.genesis&&this._archivedTokens.set($,R);if(this._forkedTokens=new Map,b.forkedTokens&&typeof b.forkedTokens=="object")for(const[$,R]of Object.entries(b.forkedTokens))R&&typeof R=="object"&&R.genesis&&this._forkedTokens.set($,R);const S=this._archivedTokens.size>0?`, ${this._archivedTokens.size} archived`:"",A=this._forkedTokens.size>0?`, ${this._forkedTokens.size} forked`:"";return console.log(`Loaded wallet for address ${u} with ${w.length} tokens${this._nametag?`, nametag: ${this._nametag.name}`:""}${this._tombstones.length>0?`, ${this._tombstones.length} tombstones`:""}${S}${A}`),E}return null}catch(g){return console.error(`Failed to load wallet for address ${u}`,g),null}}switchToAddress(u){return this.validateAddress(u)?this._currentAddress===u&&this._wallet?.address===u?this._wallet:(console.log(`Switching from ${this._currentAddress||"none"} to ${u}`),this.loadWalletForAddress(u)):(console.error(`Cannot switch to invalid address: ${u}`),null)}loadTransactionHistory(){try{const u=localStorage.getItem(STORAGE_KEYS.TRANSACTION_HISTORY);u&&(this._transactionHistory=JSON.parse(u))}catch(u){console.error("Failed to load transaction history",u),this._transactionHistory=[]}}saveTransactionHistory(){try{localStorage.setItem(STORAGE_KEYS.TRANSACTION_HISTORY,JSON.stringify(this._transactionHistory))}catch(u){console.error("Failed to save transaction history",u)}}addTransactionToHistory(u){const g={id:v4$1(),...u};this._transactionHistory.push(g),this.saveTransactionHistory(),this.refreshWallet()}getTransactionHistory(){return[...this._transactionHistory].sort((u,g)=>g.timestamp-u.timestamp)}addSentTransaction(u,g,v,b,w){this.addTransactionToHistory({type:"SENT",amount:u,coinId:g,symbol:v,iconUrl:b,timestamp:Date.now(),recipientNametag:w})}createWallet(u,g="My Wallet"){if(!this.validateAddress(u))throw new Error(`Cannot create wallet with invalid address: ${u}`);const v=this.loadWalletForAddress(u);if(v)return console.log(`Wallet already exists for address ${u}, using existing wallet`),v;const b=new Wallet(v4$1(),g,u,[]);return this._currentAddress=u,this.saveWallet(b),console.log(`Created new wallet for address ${u}`),this.refreshWallet(),window.dispatchEvent(new Event("wallet-loaded")),b}saveWallet(u){this._wallet=u,this._currentAddress=u.address;const g=this.getStorageKey(u.address),v={id:u.id,name:u.name,address:u.address,tokens:u.tokens,nametag:this._nametag||void 0,tombstones:this._tombstones.length>0?this._tombstones:void 0,archivedTokens:this._archivedTokens.size>0?Object.fromEntries(this._archivedTokens):void 0,forkedTokens:this._forkedTokens.size>0?Object.fromEntries(this._forkedTokens):void 0};localStorage.setItem(g,JSON.stringify(v))}getWallet(){return this._wallet}getTokens(){return this._wallet?.tokens||[]}isSameToken(u,g){if(u.id===g.id)return!0;try{const v=JSON.parse(u.jsonData||"{}"),b=JSON.parse(g.jsonData||"{}"),w=v.genesis?.data?.tokenId,E=b.genesis?.data?.tokenId;if(w&&E&&w===E)return!0}catch{return!1}return!1}addToken(u,g=!1){if(console.log(" Repository: Adding token...",u.id),!this._wallet){console.error(" Repository: Wallet not initialized!");return}const v=this._wallet.tokens;if(v.some(S=>this.isSameToken(S,u))){console.warn(` Duplicate token detected (CoinID: ${u.coinId}). Skipping add.`);return}if(v.some(S=>S.id===u.id)){console.warn(`Token ${u.id} already exists`);return}const w=[u,...v],E=new Wallet(this._wallet.id,this._wallet.name,this._wallet.address,w);this.saveWallet(E),this.archiveToken(u),!g&&u.coinId&&u.amount&&this.addTransactionToHistory({type:"RECEIVED",amount:u.amount,coinId:u.coinId,symbol:u.symbol||"UNK",iconUrl:u.iconUrl,timestamp:u.timestamp,senderPubkey:u.senderPubkey}),console.log(` Repository: Saved! Total tokens: ${w.length}`),this.refreshWallet()}updateToken(u){if(console.log(" Repository: Updating token...",u.id),!this._wallet){console.error(" Repository: Wallet not initialized!");return}let g=-1,v=null;for(let E=0;E<this._wallet.tokens.length;E++){const S=this._wallet.tokens[E];if(S.jsonData&&u.jsonData)try{const A=JSON.parse(S.jsonData),$=JSON.parse(u.jsonData);if(A?.genesis?.data?.tokenId===$?.genesis?.data?.tokenId){g=E,v=S;break}}catch{}if(S.id===u.id){g=E,v=S;break}}if(g===-1||!v){console.warn(` Repository: Token ${u.id} not found for update, adding instead`),this.addToken(u,!0);return}const b=[...this._wallet.tokens];b[g]=u;const w=new Wallet(this._wallet.id,this._wallet.name,this._wallet.address,b);this.saveWallet(w),this.archiveToken(u),console.log(` Repository: Updated token ${u.id.slice(0,8)}...`),this.refreshWallet()}removeToken(u,g,v=!1){if(!this._wallet)return;const b=this._wallet.tokens.find(R=>R.id===u);b?.jsonData&&this.archiveToken(b);const w=this._wallet.tokens.filter(R=>R.id!==u),E=new Wallet(this._wallet.id,this._wallet.name,this._wallet.address,w);let S="";if(b?.jsonData)try{const R=JSON.parse(b.jsonData);R.transactions&&R.transactions.length>0?S=R.transactions[R.transactions.length-1].newStateHash||"":R.genesis?.inclusionProof?.authenticator?.stateHash&&(S=R.genesis.inclusionProof.authenticator.stateHash)}catch{console.warn(` Could not extract state hash for token ${u.slice(0,8)}...`)}let A=u;if(b?.jsonData)try{const R=JSON.parse(b.jsonData);R.genesis?.data?.tokenId&&(A=R.genesis.data.tokenId)}catch{}if(!this._tombstones.some(R=>R.tokenId===A&&R.stateHash===S)){const R={tokenId:A,stateHash:S,timestamp:Date.now()};this._tombstones.push(R),console.log(` Token ${A.slice(0,8)}... state ${S.slice(0,12)}... added to tombstones`)}this.saveWallet(E),!v&&b&&b.coinId&&b.amount&&this.addTransactionToHistory({type:"SENT",amount:b.amount,coinId:b.coinId,symbol:b.symbol||"UNK",iconUrl:b.iconUrl,timestamp:Date.now(),recipientNametag:g}),this.refreshWallet()}clearWallet(){if(this._currentAddress){const u=this.getStorageKey(this._currentAddress);localStorage.removeItem(u)}localStorage.removeItem(STORAGE_KEYS.WALLET_DATA_LEGACY),this._wallet=null,this._currentAddress=null,this._nametag=null,this._tombstones=[],this._archivedTokens=new Map,this._forkedTokens=new Map,this.refreshWallet()}resetInMemoryState(){this._wallet=null,this._currentAddress=null,this._nametag=null,this._tombstones=[],this._archivedTokens=new Map,this._forkedTokens=new Map,this.refreshWallet()}static clearAllWalletStorage(){console.log(" Clearing all wallet storage from localStorage...");const u=[];for(let g=0;g<localStorage.length;g++){const v=localStorage.key(g);v&&v.startsWith(STORAGE_KEY_PREFIXES.WALLET_ADDRESS)&&u.push(v)}u.push(STORAGE_KEYS.WALLET_DATA_LEGACY),u.push(STORAGE_KEYS.TRANSACTION_HISTORY);for(const g of u)localStorage.removeItem(g),console.log(`  Removed: ${g}`);console.log(` Cleared ${u.length} wallet storage keys`)}getCurrentAddress(){return this._currentAddress}setNametag(u){if(!this._wallet){console.error("Cannot set nametag: wallet not initialized");return}this._nametag=u,this.saveWallet(this._wallet),console.log(` Nametag set for ${this._wallet.address}: ${u.name}`),this.refreshWallet()}getNametag(){return this._nametag}clearNametag(){this._wallet&&(this._nametag=null,this.saveWallet(this._wallet),console.log(` Nametag cleared for ${this._wallet.address}`),this.refreshWallet())}hasNametag(){return this._nametag!==null}refreshWallet(){this._refreshDebounceTimer&&clearTimeout(this._refreshDebounceTimer),this._refreshDebounceTimer=setTimeout(()=>{this._refreshDebounceTimer=null,window.dispatchEvent(new Event("wallet-updated"))},100)}getTombstones(){return[...this._tombstones]}isStateTombstoned(u,g){return this._tombstones.some(v=>v.tokenId===u&&v.stateHash===g)}mergeTombstones(u){if(!this._wallet)return 0;let g=0;const v=new Set(u.map(w=>`${w.tokenId}:${w.stateHash}`)),b=[];for(const w of this._wallet.tokens)if(w.jsonData)try{const E=JSON.parse(w.jsonData),S=E.genesis?.data?.tokenId;let A="";E.transactions&&E.transactions.length>0?A=E.transactions[E.transactions.length-1].newStateHash||"":E.genesis?.inclusionProof?.authenticator?.stateHash&&(A=E.genesis.inclusionProof.authenticator.stateHash);const $=`${S}:${A}`;v.has($)&&b.push(w)}catch{}for(const w of b){if(!this._wallet)break;const S=this._wallet.tokens.filter(A=>A.id!==w.id);this._wallet=new Wallet(this._wallet.id,this._wallet.name,this._wallet.address,S),console.log(` Removed tombstoned token ${w.id.slice(0,8)}... from local (state matched)`),g++}for(const w of u)this._tombstones.some(S=>S.tokenId===w.tokenId&&S.stateHash===w.stateHash)||this._tombstones.push(w);return g>0&&(this.saveWallet(this._wallet),this.refreshWallet()),g}pruneTombstones(u=720*60*60*1e3){const g=Date.now(),v=this._tombstones.length;this._tombstones=this._tombstones.filter(b=>g-b.timestamp<u),this._tombstones.length>100&&(this._tombstones.sort((b,w)=>w.timestamp-b.timestamp),this._tombstones=this._tombstones.slice(0,100)),this._tombstones.length<v&&(this._wallet&&this.saveWallet(this._wallet),console.log(` Pruned tombstones from ${v} to ${this._tombstones.length}`))}archiveToken(u){if(!u.jsonData)return;let g;try{g=JSON.parse(u.jsonData)}catch{console.warn(` Cannot archive token ${u.id.slice(0,8)}...: invalid JSON`);return}const v=g.genesis?.data?.tokenId;if(!v){console.warn(` Cannot archive token ${u.id.slice(0,8)}...: missing genesis tokenId`);return}const b=this._archivedTokens.get(v);if(b)if(this.isIncrementalUpdate(b,g))this._archivedTokens.set(v,g),console.log(` Updated archived token ${v.slice(0,8)}... (incremental update: ${b.transactions.length}  ${g.transactions.length} txns)`);else{const w=this.getCurrentStateHash(g);this.storeForkedToken(v,w,g),console.log(` Archived token ${v.slice(0,8)}... is a fork, stored as forked`)}else this._archivedTokens.set(v,g),console.log(` Archived token ${v.slice(0,8)}... (${g.transactions.length} txns)`);this._wallet&&this.saveWallet(this._wallet)}isIncrementalUpdate(u,g){if(u.genesis?.data?.tokenId!==g.genesis?.data?.tokenId)return!1;const v=u.transactions||[],b=g.transactions||[];if(b.length<v.length)return!1;for(let w=0;w<v.length;w++){const E=v[w],S=b[w];if(E.previousStateHash!==S.previousStateHash||E.newStateHash!==S.newStateHash)return!1}for(let w=v.length;w<b.length;w++)if(b[w].inclusionProof===null)return!1;return!0}getCurrentStateHash(u){return u.transactions&&u.transactions.length>0?u.transactions[u.transactions.length-1].newStateHash||"":u.genesis?.inclusionProof?.authenticator?.stateHash||""}storeForkedToken(u,g,v){const b=`${u}_${g}`;this._forkedTokens.has(b)||(this._forkedTokens.set(b,v),console.log(` Stored forked token ${u.slice(0,8)}... state ${g.slice(0,12)}...`),this._wallet&&this.saveWallet(this._wallet))}getArchivedTokens(){return new Map(this._archivedTokens)}getBestArchivedVersion(u){const g=[],v=this._archivedTokens.get(u);v&&g.push(v);for(const[b,w]of this._forkedTokens)b.startsWith(u+"_")&&g.push(w);return g.length===0?null:(g.sort((b,w)=>{const E=(b.transactions||[]).filter(A=>A.inclusionProof!==null).length;return(w.transactions||[]).filter(A=>A.inclusionProof!==null).length-E}),g[0])}restoreTokenFromArchive(u,g){if(!this._wallet)return console.error("Cannot restore token: wallet not initialized"),!1;try{const v=g.genesis?.data?.coinData||[],b=v.reduce((R,[,T])=>R+BigInt(T||"0"),BigInt(0));let w=v[0]?.[0]||"";for(const[R,T]of v)if(BigInt(T||"0")>0){w=R;break}const S=(g.genesis?.data?.tokenType||"")==="455ad8720656b08e8dbd5bac1f3c73eeea5431565f6c1c3af742b1aa12d41d89",A=new Token$3({id:u,name:S?"NFT":"Token",type:S?"NFT":"UCT",timestamp:Date.now(),jsonData:JSON.stringify(g),status:TokenStatus.CONFIRMED,amount:b.toString(),coinId:w,symbol:S?"NFT":"UCT",sizeBytes:JSON.stringify(g).length}),$=this._wallet.tokens.findIndex(R=>{try{return JSON.parse(R.jsonData||"{}").genesis?.data?.tokenId===u}catch{return R.id===u}});if($!==-1){const R=[...this._wallet.tokens];R[$]=A,this._wallet=new Wallet(this._wallet.id,this._wallet.name,this._wallet.address,R)}else{const R=[A,...this._wallet.tokens];this._wallet=new Wallet(this._wallet.id,this._wallet.name,this._wallet.address,R)}return this.saveWallet(this._wallet),console.log(` Restored token ${u.slice(0,8)}... from archive`),!0}catch(v){return console.error(`Failed to restore token ${u}:`,v),!1}}getForkedTokens(){return new Map(this._forkedTokens)}importArchivedToken(u,g){const v=this._archivedTokens.get(u);if(v)if(this.isIncrementalUpdate(v,g))this._archivedTokens.set(u,g),console.log(` Imported remote archived token ${u.slice(0,8)}... (incremental update)`);else if(this.isIncrementalUpdate(g,v))console.log(` Kept local archived token ${u.slice(0,8)}... (local is more advanced)`);else{const b=this.getCurrentStateHash(g);this.storeForkedToken(u,b,g),console.log(` Remote archived token ${u.slice(0,8)}... is a fork, stored as forked`)}else this._archivedTokens.set(u,g),console.log(` Imported remote archived token ${u.slice(0,8)}...`)}importForkedToken(u,g){this._forkedTokens.has(u)||(this._forkedTokens.set(u,g),console.log(` Imported remote forked token ${u.slice(0,20)}...`))}mergeArchivedTokens(u){let g=0;for(const[v,b]of u){const w=this._archivedTokens.get(v);if(!w)this._archivedTokens.set(v,b),g++;else if(this.isIncrementalUpdate(w,b))this._archivedTokens.set(v,b),g++;else if(!this.isIncrementalUpdate(b,w)){const E=this.getCurrentStateHash(b);this.storeForkedToken(v,E,b)}}return g>0&&this._wallet&&this.saveWallet(this._wallet),g}mergeForkedTokens(u){let g=0;for(const[v,b]of u)this._forkedTokens.has(v)||(this._forkedTokens.set(v,b),g++);return g>0&&this._wallet&&this.saveWallet(this._wallet),g}pruneArchivedTokens(u=100){if(this._archivedTokens.size<=u)return;const g=[...this._archivedTokens.entries()],v=g.slice(0,g.length-u);for(const[b]of v)this._archivedTokens.delete(b);this._wallet&&this.saveWallet(this._wallet),console.log(` Pruned archived tokens to ${this._archivedTokens.size}`)}pruneForkedTokens(u=50){if(this._forkedTokens.size<=u)return;const g=[...this._forkedTokens.entries()],v=g.slice(0,g.length-u);for(const[b]of v)this._forkedTokens.delete(b);this._wallet&&this.saveWallet(this._wallet),console.log(` Pruned forked tokens to ${this._forkedTokens.size}`)}}var src$1={},sha256$b={},sha2={},_md={},utils$5={},crypto$2={},hasRequiredCrypto;function requireCrypto(){return hasRequiredCrypto||(hasRequiredCrypto=1,Object.defineProperty(crypto$2,"__esModule",{value:!0}),crypto$2.crypto=void 0,crypto$2.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0),crypto$2}var hasRequiredUtils$4;function requireUtils$4(){return hasRequiredUtils$4||(hasRequiredUtils$4=1,(function(y){Object.defineProperty(y,"__esModule",{value:!0}),y.wrapXOFConstructorWithOpts=y.wrapConstructorWithOpts=y.wrapConstructor=y.Hash=y.nextTick=y.swap32IfBE=y.byteSwapIfBE=y.swap8IfBE=y.isLE=void 0,y.isBytes=g,y.anumber=v,y.abytes=b,y.ahash=w,y.aexists=E,y.aoutput=S,y.u8=A,y.u32=$,y.clean=R,y.createView=T,y.rotr=O,y.rotl=B,y.byteSwap=F,y.byteSwap32=U,y.bytesToHex=ie,y.hexToBytes=de,y.asyncLoop=ye,y.utf8ToBytes=we,y.bytesToUtf8=pe,y.toBytes=ve,y.kdfInputToBytes=he,y.concatBytes=ae,y.checkOpts=Q,y.createHasher=z,y.createOptHasher=re,y.createXOFer=Y,y.randomBytes=te;const u=requireCrypto();function g(ne){return ne instanceof Uint8Array||ArrayBuffer.isView(ne)&&ne.constructor.name==="Uint8Array"}function v(ne){if(!Number.isSafeInteger(ne)||ne<0)throw new Error("positive integer expected, got "+ne)}function b(ne,...se){if(!g(ne))throw new Error("Uint8Array expected");if(se.length>0&&!se.includes(ne.length))throw new Error("Uint8Array expected of length "+se+", got length="+ne.length)}function w(ne){if(typeof ne!="function"||typeof ne.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");v(ne.outputLen),v(ne.blockLen)}function E(ne,se=!0){if(ne.destroyed)throw new Error("Hash instance has been destroyed");if(se&&ne.finished)throw new Error("Hash#digest() has already been called")}function S(ne,se){b(ne);const ee=se.outputLen;if(ne.length<ee)throw new Error("digestInto() expects output buffer of length at least "+ee)}function A(ne){return new Uint8Array(ne.buffer,ne.byteOffset,ne.byteLength)}function $(ne){return new Uint32Array(ne.buffer,ne.byteOffset,Math.floor(ne.byteLength/4))}function R(...ne){for(let se=0;se<ne.length;se++)ne[se].fill(0)}function T(ne){return new DataView(ne.buffer,ne.byteOffset,ne.byteLength)}function O(ne,se){return ne<<32-se|ne>>>se}function B(ne,se){return ne<<se|ne>>>32-se>>>0}y.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function F(ne){return ne<<24&4278190080|ne<<8&16711680|ne>>>8&65280|ne>>>24&255}y.swap8IfBE=y.isLE?ne=>ne:ne=>F(ne),y.byteSwapIfBE=y.swap8IfBE;function U(ne){for(let se=0;se<ne.length;se++)ne[se]=F(ne[se]);return ne}y.swap32IfBE=y.isLE?ne=>ne:U;const q=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",J=Array.from({length:256},(ne,se)=>se.toString(16).padStart(2,"0"));function ie(ne){if(b(ne),q)return ne.toHex();let se="";for(let ee=0;ee<ne.length;ee++)se+=J[ne[ee]];return se}const oe={_0:48,_9:57,A:65,F:70,a:97,f:102};function le(ne){if(ne>=oe._0&&ne<=oe._9)return ne-oe._0;if(ne>=oe.A&&ne<=oe.F)return ne-(oe.A-10);if(ne>=oe.a&&ne<=oe.f)return ne-(oe.a-10)}function de(ne){if(typeof ne!="string")throw new Error("hex string expected, got "+typeof ne);if(q)return Uint8Array.fromHex(ne);const se=ne.length,ee=se/2;if(se%2)throw new Error("hex string expected, got unpadded hex of length "+se);const Z=new Uint8Array(ee);for(let ue=0,_e=0;ue<ee;ue++,_e+=2){const Re=le(ne.charCodeAt(_e)),Ae=le(ne.charCodeAt(_e+1));if(Re===void 0||Ae===void 0){const ge=ne[_e]+ne[_e+1];throw new Error('hex string expected, got non-hex character "'+ge+'" at index '+_e)}Z[ue]=Re*16+Ae}return Z}const fe=async()=>{};y.nextTick=fe;async function ye(ne,se,ee){let Z=Date.now();for(let ue=0;ue<ne;ue++){ee(ue);const _e=Date.now()-Z;_e>=0&&_e<se||(await(0,y.nextTick)(),Z+=_e)}}function we(ne){if(typeof ne!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(ne))}function pe(ne){return new TextDecoder().decode(ne)}function ve(ne){return typeof ne=="string"&&(ne=we(ne)),b(ne),ne}function he(ne){return typeof ne=="string"&&(ne=we(ne)),b(ne),ne}function ae(...ne){let se=0;for(let Z=0;Z<ne.length;Z++){const ue=ne[Z];b(ue),se+=ue.length}const ee=new Uint8Array(se);for(let Z=0,ue=0;Z<ne.length;Z++){const _e=ne[Z];ee.set(_e,ue),ue+=_e.length}return ee}function Q(ne,se){if(se!==void 0&&{}.toString.call(se)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(ne,se)}class j{}y.Hash=j;function z(ne){const se=Z=>ne().update(ve(Z)).digest(),ee=ne();return se.outputLen=ee.outputLen,se.blockLen=ee.blockLen,se.create=()=>ne(),se}function re(ne){const se=(Z,ue)=>ne(ue).update(ve(Z)).digest(),ee=ne({});return se.outputLen=ee.outputLen,se.blockLen=ee.blockLen,se.create=Z=>ne(Z),se}function Y(ne){const se=(Z,ue)=>ne(ue).update(ve(Z)).digest(),ee=ne({});return se.outputLen=ee.outputLen,se.blockLen=ee.blockLen,se.create=Z=>ne(Z),se}y.wrapConstructor=z,y.wrapConstructorWithOpts=re,y.wrapXOFConstructorWithOpts=Y;function te(ne=32){if(u.crypto&&typeof u.crypto.getRandomValues=="function")return u.crypto.getRandomValues(new Uint8Array(ne));if(u.crypto&&typeof u.crypto.randomBytes=="function")return Uint8Array.from(u.crypto.randomBytes(ne));throw new Error("crypto.getRandomValues must be defined")}})(utils$5)),utils$5}var hasRequired_md;function require_md(){if(hasRequired_md)return _md;hasRequired_md=1,Object.defineProperty(_md,"__esModule",{value:!0}),_md.SHA512_IV=_md.SHA384_IV=_md.SHA224_IV=_md.SHA256_IV=_md.HashMD=void 0,_md.setBigUint64=u,_md.Chi=g,_md.Maj=v;const y=requireUtils$4();function u(w,E,S,A){if(typeof w.setBigUint64=="function")return w.setBigUint64(E,S,A);const $=BigInt(32),R=BigInt(4294967295),T=Number(S>>$&R),O=Number(S&R),B=A?4:0,F=A?0:4;w.setUint32(E+B,T,A),w.setUint32(E+F,O,A)}function g(w,E,S){return w&E^~w&S}function v(w,E,S){return w&E^w&S^E&S}class b extends y.Hash{constructor(E,S,A,$){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=E,this.outputLen=S,this.padOffset=A,this.isLE=$,this.buffer=new Uint8Array(E),this.view=(0,y.createView)(this.buffer)}update(E){(0,y.aexists)(this),E=(0,y.toBytes)(E),(0,y.abytes)(E);const{view:S,buffer:A,blockLen:$}=this,R=E.length;for(let T=0;T<R;){const O=Math.min($-this.pos,R-T);if(O===$){const B=(0,y.createView)(E);for(;$<=R-T;T+=$)this.process(B,T);continue}A.set(E.subarray(T,T+O),this.pos),this.pos+=O,T+=O,this.pos===$&&(this.process(S,0),this.pos=0)}return this.length+=E.length,this.roundClean(),this}digestInto(E){(0,y.aexists)(this),(0,y.aoutput)(E,this),this.finished=!0;const{buffer:S,view:A,blockLen:$,isLE:R}=this;let{pos:T}=this;S[T++]=128,(0,y.clean)(this.buffer.subarray(T)),this.padOffset>$-T&&(this.process(A,0),T=0);for(let q=T;q<$;q++)S[q]=0;u(A,$-8,BigInt(this.length*8),R),this.process(A,0);const O=(0,y.createView)(E),B=this.outputLen;if(B%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const F=B/4,U=this.get();if(F>U.length)throw new Error("_sha2: outputLen bigger than state");for(let q=0;q<F;q++)O.setUint32(4*q,U[q],R)}digest(){const{buffer:E,outputLen:S}=this;this.digestInto(E);const A=E.slice(0,S);return this.destroy(),A}_cloneInto(E){E||(E=new this.constructor),E.set(...this.get());const{blockLen:S,buffer:A,length:$,finished:R,destroyed:T,pos:O}=this;return E.destroyed=T,E.finished=R,E.length=$,E.pos=O,$%S&&E.buffer.set(A),E}clone(){return this._cloneInto()}}return _md.HashMD=b,_md.SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),_md.SHA224_IV=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),_md.SHA384_IV=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),_md.SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),_md}var _u64={},hasRequired_u64;function require_u64(){if(hasRequired_u64)return _u64;hasRequired_u64=1,Object.defineProperty(_u64,"__esModule",{value:!0}),_u64.toBig=_u64.shrSL=_u64.shrSH=_u64.rotrSL=_u64.rotrSH=_u64.rotrBL=_u64.rotrBH=_u64.rotr32L=_u64.rotr32H=_u64.rotlSL=_u64.rotlSH=_u64.rotlBL=_u64.rotlBH=_u64.add5L=_u64.add5H=_u64.add4L=_u64.add4H=_u64.add3L=_u64.add3H=void 0,_u64.add=J,_u64.fromBig=g,_u64.split=v;const y=BigInt(2**32-1),u=BigInt(32);function g(pe,ve=!1){return ve?{h:Number(pe&y),l:Number(pe>>u&y)}:{h:Number(pe>>u&y)|0,l:Number(pe&y)|0}}function v(pe,ve=!1){const he=pe.length;let ae=new Uint32Array(he),Q=new Uint32Array(he);for(let j=0;j<he;j++){const{h:z,l:re}=g(pe[j],ve);[ae[j],Q[j]]=[z,re]}return[ae,Q]}const b=(pe,ve)=>BigInt(pe>>>0)<<u|BigInt(ve>>>0);_u64.toBig=b;const w=(pe,ve,he)=>pe>>>he;_u64.shrSH=w;const E=(pe,ve,he)=>pe<<32-he|ve>>>he;_u64.shrSL=E;const S=(pe,ve,he)=>pe>>>he|ve<<32-he;_u64.rotrSH=S;const A=(pe,ve,he)=>pe<<32-he|ve>>>he;_u64.rotrSL=A;const $=(pe,ve,he)=>pe<<64-he|ve>>>he-32;_u64.rotrBH=$;const R=(pe,ve,he)=>pe>>>he-32|ve<<64-he;_u64.rotrBL=R;const T=(pe,ve)=>ve;_u64.rotr32H=T;const O=(pe,ve)=>pe;_u64.rotr32L=O;const B=(pe,ve,he)=>pe<<he|ve>>>32-he;_u64.rotlSH=B;const F=(pe,ve,he)=>ve<<he|pe>>>32-he;_u64.rotlSL=F;const U=(pe,ve,he)=>ve<<he-32|pe>>>64-he;_u64.rotlBH=U;const q=(pe,ve,he)=>pe<<he-32|ve>>>64-he;_u64.rotlBL=q;function J(pe,ve,he,ae){const Q=(ve>>>0)+(ae>>>0);return{h:pe+he+(Q/2**32|0)|0,l:Q|0}}const ie=(pe,ve,he)=>(pe>>>0)+(ve>>>0)+(he>>>0);_u64.add3L=ie;const oe=(pe,ve,he,ae)=>ve+he+ae+(pe/2**32|0)|0;_u64.add3H=oe;const le=(pe,ve,he,ae)=>(pe>>>0)+(ve>>>0)+(he>>>0)+(ae>>>0);_u64.add4L=le;const de=(pe,ve,he,ae,Q)=>ve+he+ae+Q+(pe/2**32|0)|0;_u64.add4H=de;const fe=(pe,ve,he,ae,Q)=>(pe>>>0)+(ve>>>0)+(he>>>0)+(ae>>>0)+(Q>>>0);_u64.add5L=fe;const ye=(pe,ve,he,ae,Q,j)=>ve+he+ae+Q+j+(pe/2**32|0)|0;_u64.add5H=ye;const we={fromBig:g,split:v,toBig:b,shrSH:w,shrSL:E,rotrSH:S,rotrSL:A,rotrBH:$,rotrBL:R,rotr32H:T,rotr32L:O,rotlSH:B,rotlSL:F,rotlBH:U,rotlBL:q,add:J,add3L:ie,add3H:oe,add4L:le,add4H:de,add5H:ye,add5L:fe};return _u64.default=we,_u64}var hasRequiredSha2;function requireSha2(){if(hasRequiredSha2)return sha2;hasRequiredSha2=1,Object.defineProperty(sha2,"__esModule",{value:!0}),sha2.sha512_224=sha2.sha512_256=sha2.sha384=sha2.sha512=sha2.sha224=sha2.sha256=sha2.SHA512_256=sha2.SHA512_224=sha2.SHA384=sha2.SHA512=sha2.SHA224=sha2.SHA256=void 0;const y=require_md(),u=require_u64(),g=requireUtils$4(),v=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),b=new Uint32Array(64);class w extends y.HashMD{constructor(oe=32){super(64,oe,8,!1),this.A=y.SHA256_IV[0]|0,this.B=y.SHA256_IV[1]|0,this.C=y.SHA256_IV[2]|0,this.D=y.SHA256_IV[3]|0,this.E=y.SHA256_IV[4]|0,this.F=y.SHA256_IV[5]|0,this.G=y.SHA256_IV[6]|0,this.H=y.SHA256_IV[7]|0}get(){const{A:oe,B:le,C:de,D:fe,E:ye,F:we,G:pe,H:ve}=this;return[oe,le,de,fe,ye,we,pe,ve]}set(oe,le,de,fe,ye,we,pe,ve){this.A=oe|0,this.B=le|0,this.C=de|0,this.D=fe|0,this.E=ye|0,this.F=we|0,this.G=pe|0,this.H=ve|0}process(oe,le){for(let Q=0;Q<16;Q++,le+=4)b[Q]=oe.getUint32(le,!1);for(let Q=16;Q<64;Q++){const j=b[Q-15],z=b[Q-2],re=(0,g.rotr)(j,7)^(0,g.rotr)(j,18)^j>>>3,Y=(0,g.rotr)(z,17)^(0,g.rotr)(z,19)^z>>>10;b[Q]=Y+b[Q-7]+re+b[Q-16]|0}let{A:de,B:fe,C:ye,D:we,E:pe,F:ve,G:he,H:ae}=this;for(let Q=0;Q<64;Q++){const j=(0,g.rotr)(pe,6)^(0,g.rotr)(pe,11)^(0,g.rotr)(pe,25),z=ae+j+(0,y.Chi)(pe,ve,he)+v[Q]+b[Q]|0,Y=((0,g.rotr)(de,2)^(0,g.rotr)(de,13)^(0,g.rotr)(de,22))+(0,y.Maj)(de,fe,ye)|0;ae=he,he=ve,ve=pe,pe=we+z|0,we=ye,ye=fe,fe=de,de=z+Y|0}de=de+this.A|0,fe=fe+this.B|0,ye=ye+this.C|0,we=we+this.D|0,pe=pe+this.E|0,ve=ve+this.F|0,he=he+this.G|0,ae=ae+this.H|0,this.set(de,fe,ye,we,pe,ve,he,ae)}roundClean(){(0,g.clean)(b)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,g.clean)(this.buffer)}}sha2.SHA256=w;class E extends w{constructor(){super(28),this.A=y.SHA224_IV[0]|0,this.B=y.SHA224_IV[1]|0,this.C=y.SHA224_IV[2]|0,this.D=y.SHA224_IV[3]|0,this.E=y.SHA224_IV[4]|0,this.F=y.SHA224_IV[5]|0,this.G=y.SHA224_IV[6]|0,this.H=y.SHA224_IV[7]|0}}sha2.SHA224=E;const S=u.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(ie=>BigInt(ie))),A=S[0],$=S[1],R=new Uint32Array(80),T=new Uint32Array(80);class O extends y.HashMD{constructor(oe=64){super(128,oe,16,!1),this.Ah=y.SHA512_IV[0]|0,this.Al=y.SHA512_IV[1]|0,this.Bh=y.SHA512_IV[2]|0,this.Bl=y.SHA512_IV[3]|0,this.Ch=y.SHA512_IV[4]|0,this.Cl=y.SHA512_IV[5]|0,this.Dh=y.SHA512_IV[6]|0,this.Dl=y.SHA512_IV[7]|0,this.Eh=y.SHA512_IV[8]|0,this.El=y.SHA512_IV[9]|0,this.Fh=y.SHA512_IV[10]|0,this.Fl=y.SHA512_IV[11]|0,this.Gh=y.SHA512_IV[12]|0,this.Gl=y.SHA512_IV[13]|0,this.Hh=y.SHA512_IV[14]|0,this.Hl=y.SHA512_IV[15]|0}get(){const{Ah:oe,Al:le,Bh:de,Bl:fe,Ch:ye,Cl:we,Dh:pe,Dl:ve,Eh:he,El:ae,Fh:Q,Fl:j,Gh:z,Gl:re,Hh:Y,Hl:te}=this;return[oe,le,de,fe,ye,we,pe,ve,he,ae,Q,j,z,re,Y,te]}set(oe,le,de,fe,ye,we,pe,ve,he,ae,Q,j,z,re,Y,te){this.Ah=oe|0,this.Al=le|0,this.Bh=de|0,this.Bl=fe|0,this.Ch=ye|0,this.Cl=we|0,this.Dh=pe|0,this.Dl=ve|0,this.Eh=he|0,this.El=ae|0,this.Fh=Q|0,this.Fl=j|0,this.Gh=z|0,this.Gl=re|0,this.Hh=Y|0,this.Hl=te|0}process(oe,le){for(let ee=0;ee<16;ee++,le+=4)R[ee]=oe.getUint32(le),T[ee]=oe.getUint32(le+=4);for(let ee=16;ee<80;ee++){const Z=R[ee-15]|0,ue=T[ee-15]|0,_e=u.rotrSH(Z,ue,1)^u.rotrSH(Z,ue,8)^u.shrSH(Z,ue,7),Re=u.rotrSL(Z,ue,1)^u.rotrSL(Z,ue,8)^u.shrSL(Z,ue,7),Ae=R[ee-2]|0,ge=T[ee-2]|0,be=u.rotrSH(Ae,ge,19)^u.rotrBH(Ae,ge,61)^u.shrSH(Ae,ge,6),Te=u.rotrSL(Ae,ge,19)^u.rotrBL(Ae,ge,61)^u.shrSL(Ae,ge,6),De=u.add4L(Re,Te,T[ee-7],T[ee-16]),Ie=u.add4H(De,_e,be,R[ee-7],R[ee-16]);R[ee]=Ie|0,T[ee]=De|0}let{Ah:de,Al:fe,Bh:ye,Bl:we,Ch:pe,Cl:ve,Dh:he,Dl:ae,Eh:Q,El:j,Fh:z,Fl:re,Gh:Y,Gl:te,Hh:ne,Hl:se}=this;for(let ee=0;ee<80;ee++){const Z=u.rotrSH(Q,j,14)^u.rotrSH(Q,j,18)^u.rotrBH(Q,j,41),ue=u.rotrSL(Q,j,14)^u.rotrSL(Q,j,18)^u.rotrBL(Q,j,41),_e=Q&z^~Q&Y,Re=j&re^~j&te,Ae=u.add5L(se,ue,Re,$[ee],T[ee]),ge=u.add5H(Ae,ne,Z,_e,A[ee],R[ee]),be=Ae|0,Te=u.rotrSH(de,fe,28)^u.rotrBH(de,fe,34)^u.rotrBH(de,fe,39),De=u.rotrSL(de,fe,28)^u.rotrBL(de,fe,34)^u.rotrBL(de,fe,39),Ie=de&ye^de&pe^ye&pe,Se=fe&we^fe&ve^we&ve;ne=Y|0,se=te|0,Y=z|0,te=re|0,z=Q|0,re=j|0,{h:Q,l:j}=u.add(he|0,ae|0,ge|0,be|0),he=pe|0,ae=ve|0,pe=ye|0,ve=we|0,ye=de|0,we=fe|0;const Be=u.add3L(be,De,Se);de=u.add3H(Be,ge,Te,Ie),fe=Be|0}({h:de,l:fe}=u.add(this.Ah|0,this.Al|0,de|0,fe|0)),{h:ye,l:we}=u.add(this.Bh|0,this.Bl|0,ye|0,we|0),{h:pe,l:ve}=u.add(this.Ch|0,this.Cl|0,pe|0,ve|0),{h:he,l:ae}=u.add(this.Dh|0,this.Dl|0,he|0,ae|0),{h:Q,l:j}=u.add(this.Eh|0,this.El|0,Q|0,j|0),{h:z,l:re}=u.add(this.Fh|0,this.Fl|0,z|0,re|0),{h:Y,l:te}=u.add(this.Gh|0,this.Gl|0,Y|0,te|0),{h:ne,l:se}=u.add(this.Hh|0,this.Hl|0,ne|0,se|0),this.set(de,fe,ye,we,pe,ve,he,ae,Q,j,z,re,Y,te,ne,se)}roundClean(){(0,g.clean)(R,T)}destroy(){(0,g.clean)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}sha2.SHA512=O;class B extends O{constructor(){super(48),this.Ah=y.SHA384_IV[0]|0,this.Al=y.SHA384_IV[1]|0,this.Bh=y.SHA384_IV[2]|0,this.Bl=y.SHA384_IV[3]|0,this.Ch=y.SHA384_IV[4]|0,this.Cl=y.SHA384_IV[5]|0,this.Dh=y.SHA384_IV[6]|0,this.Dl=y.SHA384_IV[7]|0,this.Eh=y.SHA384_IV[8]|0,this.El=y.SHA384_IV[9]|0,this.Fh=y.SHA384_IV[10]|0,this.Fl=y.SHA384_IV[11]|0,this.Gh=y.SHA384_IV[12]|0,this.Gl=y.SHA384_IV[13]|0,this.Hh=y.SHA384_IV[14]|0,this.Hl=y.SHA384_IV[15]|0}}sha2.SHA384=B;const F=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),U=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class q extends O{constructor(){super(28),this.Ah=F[0]|0,this.Al=F[1]|0,this.Bh=F[2]|0,this.Bl=F[3]|0,this.Ch=F[4]|0,this.Cl=F[5]|0,this.Dh=F[6]|0,this.Dl=F[7]|0,this.Eh=F[8]|0,this.El=F[9]|0,this.Fh=F[10]|0,this.Fl=F[11]|0,this.Gh=F[12]|0,this.Gl=F[13]|0,this.Hh=F[14]|0,this.Hl=F[15]|0}}sha2.SHA512_224=q;class J extends O{constructor(){super(32),this.Ah=U[0]|0,this.Al=U[1]|0,this.Bh=U[2]|0,this.Bl=U[3]|0,this.Ch=U[4]|0,this.Cl=U[5]|0,this.Dh=U[6]|0,this.Dl=U[7]|0,this.Eh=U[8]|0,this.El=U[9]|0,this.Fh=U[10]|0,this.Fl=U[11]|0,this.Gh=U[12]|0,this.Gl=U[13]|0,this.Hh=U[14]|0,this.Hl=U[15]|0}}return sha2.SHA512_256=J,sha2.sha256=(0,g.createHasher)(()=>new w),sha2.sha224=(0,g.createHasher)(()=>new E),sha2.sha512=(0,g.createHasher)(()=>new O),sha2.sha384=(0,g.createHasher)(()=>new B),sha2.sha512_256=(0,g.createHasher)(()=>new J),sha2.sha512_224=(0,g.createHasher)(()=>new q),sha2}var hasRequiredSha256$2;function requireSha256$2(){if(hasRequiredSha256$2)return sha256$b;hasRequiredSha256$2=1,Object.defineProperty(sha256$b,"__esModule",{value:!0}),sha256$b.sha224=sha256$b.SHA224=sha256$b.sha256=sha256$b.SHA256=void 0;const y=requireSha2();return sha256$b.SHA256=y.SHA256,sha256$b.sha256=y.sha256,sha256$b.SHA224=y.SHA224,sha256$b.sha224=y.sha224,sha256$b}var sha512$9={},hasRequiredSha512$2;function requireSha512$2(){if(hasRequiredSha512$2)return sha512$9;hasRequiredSha512$2=1,Object.defineProperty(sha512$9,"__esModule",{value:!0}),sha512$9.sha512_256=sha512$9.SHA512_256=sha512$9.sha512_224=sha512$9.SHA512_224=sha512$9.sha384=sha512$9.SHA384=sha512$9.sha512=sha512$9.SHA512=void 0;const y=requireSha2();return sha512$9.SHA512=y.SHA512,sha512$9.sha512=y.sha512,sha512$9.SHA384=y.SHA384,sha512$9.sha384=y.sha384,sha512$9.SHA512_224=y.SHA512_224,sha512$9.sha512_224=y.sha512_224,sha512$9.SHA512_256=y.SHA512_256,sha512$9.sha512_256=y.sha512_256,sha512$9}var pbkdf2$4={},hmac$8={},hasRequiredHmac$2;function requireHmac$2(){return hasRequiredHmac$2||(hasRequiredHmac$2=1,(function(y){Object.defineProperty(y,"__esModule",{value:!0}),y.hmac=y.HMAC=void 0;const u=requireUtils$4();class g extends u.Hash{constructor(w,E){super(),this.finished=!1,this.destroyed=!1,(0,u.ahash)(w);const S=(0,u.toBytes)(E);if(this.iHash=w.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const A=this.blockLen,$=new Uint8Array(A);$.set(S.length>A?w.create().update(S).digest():S);for(let R=0;R<$.length;R++)$[R]^=54;this.iHash.update($),this.oHash=w.create();for(let R=0;R<$.length;R++)$[R]^=106;this.oHash.update($),(0,u.clean)($)}update(w){return(0,u.aexists)(this),this.iHash.update(w),this}digestInto(w){(0,u.aexists)(this),(0,u.abytes)(w,this.outputLen),this.finished=!0,this.iHash.digestInto(w),this.oHash.update(w),this.oHash.digestInto(w),this.destroy()}digest(){const w=new Uint8Array(this.oHash.outputLen);return this.digestInto(w),w}_cloneInto(w){w||(w=Object.create(Object.getPrototypeOf(this),{}));const{oHash:E,iHash:S,finished:A,destroyed:$,blockLen:R,outputLen:T}=this;return w=w,w.finished=A,w.destroyed=$,w.blockLen=R,w.outputLen=T,w.oHash=E._cloneInto(w.oHash),w.iHash=S._cloneInto(w.iHash),w}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}y.HMAC=g;const v=(b,w,E)=>new g(b,w).update(E).digest();y.hmac=v,y.hmac.create=(b,w)=>new g(b,w)})(hmac$8)),hmac$8}var hasRequiredPbkdf2$1;function requirePbkdf2$1(){if(hasRequiredPbkdf2$1)return pbkdf2$4;hasRequiredPbkdf2$1=1,Object.defineProperty(pbkdf2$4,"__esModule",{value:!0}),pbkdf2$4.pbkdf2=b,pbkdf2$4.pbkdf2Async=w;const y=requireHmac$2(),u=requireUtils$4();function g(E,S,A,$){(0,u.ahash)(E);const R=(0,u.checkOpts)({dkLen:32,asyncTick:10},$),{c:T,dkLen:O,asyncTick:B}=R;if((0,u.anumber)(T),(0,u.anumber)(O),(0,u.anumber)(B),T<1)throw new Error("iterations (c) should be >= 1");const F=(0,u.kdfInputToBytes)(S),U=(0,u.kdfInputToBytes)(A),q=new Uint8Array(O),J=y.hmac.create(E,F),ie=J._cloneInto().update(U);return{c:T,dkLen:O,asyncTick:B,DK:q,PRF:J,PRFSalt:ie}}function v(E,S,A,$,R){return E.destroy(),S.destroy(),$&&$.destroy(),(0,u.clean)(R),A}function b(E,S,A,$){const{c:R,dkLen:T,DK:O,PRF:B,PRFSalt:F}=g(E,S,A,$);let U;const q=new Uint8Array(4),J=(0,u.createView)(q),ie=new Uint8Array(B.outputLen);for(let oe=1,le=0;le<T;oe++,le+=B.outputLen){const de=O.subarray(le,le+B.outputLen);J.setInt32(0,oe,!1),(U=F._cloneInto(U)).update(q).digestInto(ie),de.set(ie.subarray(0,de.length));for(let fe=1;fe<R;fe++){B._cloneInto(U).update(ie).digestInto(ie);for(let ye=0;ye<de.length;ye++)de[ye]^=ie[ye]}}return v(B,F,O,U,ie)}async function w(E,S,A,$){const{c:R,dkLen:T,asyncTick:O,DK:B,PRF:F,PRFSalt:U}=g(E,S,A,$);let q;const J=new Uint8Array(4),ie=(0,u.createView)(J),oe=new Uint8Array(F.outputLen);for(let le=1,de=0;de<T;le++,de+=F.outputLen){const fe=B.subarray(de,de+F.outputLen);ie.setInt32(0,le,!1),(q=U._cloneInto(q)).update(J).digestInto(oe),fe.set(oe.subarray(0,fe.length)),await(0,u.asyncLoop)(R-1,O,()=>{F._cloneInto(q).update(oe).digestInto(oe);for(let ye=0;ye<fe.length;ye++)fe[ye]^=oe[ye]})}return v(F,U,B,q,oe)}return pbkdf2$4}var _wordlists={};const require$$0$1=JSON.parse('["abdikace","abeceda","adresa","agrese","akce","aktovka","alej","alkohol","amputace","ananas","andulka","anekdota","anketa","antika","anulovat","archa","arogance","asfalt","asistent","aspirace","astma","astronom","atlas","atletika","atol","autobus","azyl","babka","bachor","bacil","baculka","badatel","bageta","bagr","bahno","bakterie","balada","baletka","balkon","balonek","balvan","balza","bambus","bankomat","barbar","baret","barman","baroko","barva","baterka","batoh","bavlna","bazalka","bazilika","bazuka","bedna","beran","beseda","bestie","beton","bezinka","bezmoc","beztak","bicykl","bidlo","biftek","bikiny","bilance","biograf","biolog","bitva","bizon","blahobyt","blatouch","blecha","bledule","blesk","blikat","blizna","blokovat","bloudit","blud","bobek","bobr","bodlina","bodnout","bohatost","bojkot","bojovat","bokorys","bolest","borec","borovice","bota","boubel","bouchat","bouda","boule","bourat","boxer","bradavka","brambora","branka","bratr","brepta","briketa","brko","brloh","bronz","broskev","brunetka","brusinka","brzda","brzy","bublina","bubnovat","buchta","buditel","budka","budova","bufet","bujarost","bukvice","buldok","bulva","bunda","bunkr","burza","butik","buvol","buzola","bydlet","bylina","bytovka","bzukot","capart","carevna","cedr","cedule","cejch","cejn","cela","celer","celkem","celnice","cenina","cennost","cenovka","centrum","cenzor","cestopis","cetka","chalupa","chapadlo","charita","chata","chechtat","chemie","chichot","chirurg","chlad","chleba","chlubit","chmel","chmura","chobot","chochol","chodba","cholera","chomout","chopit","choroba","chov","chrapot","chrlit","chrt","chrup","chtivost","chudina","chutnat","chvat","chvilka","chvost","chyba","chystat","chytit","cibule","cigareta","cihelna","cihla","cinkot","cirkus","cisterna","citace","citrus","cizinec","cizost","clona","cokoliv","couvat","ctitel","ctnost","cudnost","cuketa","cukr","cupot","cvaknout","cval","cvik","cvrkot","cyklista","daleko","dareba","datel","datum","dcera","debata","dechovka","decibel","deficit","deflace","dekl","dekret","demokrat","deprese","derby","deska","detektiv","dikobraz","diktovat","dioda","diplom","disk","displej","divadlo","divoch","dlaha","dlouho","dluhopis","dnes","dobro","dobytek","docent","dochutit","dodnes","dohled","dohoda","dohra","dojem","dojnice","doklad","dokola","doktor","dokument","dolar","doleva","dolina","doma","dominant","domluvit","domov","donutit","dopad","dopis","doplnit","doposud","doprovod","dopustit","dorazit","dorost","dort","dosah","doslov","dostatek","dosud","dosyta","dotaz","dotek","dotknout","doufat","doutnat","dovozce","dozadu","doznat","dozorce","drahota","drak","dramatik","dravec","draze","drdol","drobnost","drogerie","drozd","drsnost","drtit","drzost","duben","duchovno","dudek","duha","duhovka","dusit","dusno","dutost","dvojice","dvorec","dynamit","ekolog","ekonomie","elektron","elipsa","email","emise","emoce","empatie","epizoda","epocha","epopej","epos","esej","esence","eskorta","eskymo","etiketa","euforie","evoluce","exekuce","exkurze","expedice","exploze","export","extrakt","facka","fajfka","fakulta","fanatik","fantazie","farmacie","favorit","fazole","federace","fejeton","fenka","fialka","figurant","filozof","filtr","finance","finta","fixace","fjord","flanel","flirt","flotila","fond","fosfor","fotbal","fotka","foton","frakce","freska","fronta","fukar","funkce","fyzika","galeje","garant","genetika","geolog","gilotina","glazura","glejt","golem","golfista","gotika","graf","gramofon","granule","grep","gril","grog","groteska","guma","hadice","hadr","hala","halenka","hanba","hanopis","harfa","harpuna","havran","hebkost","hejkal","hejno","hejtman","hektar","helma","hematom","herec","herna","heslo","hezky","historik","hladovka","hlasivky","hlava","hledat","hlen","hlodavec","hloh","hloupost","hltat","hlubina","hluchota","hmat","hmota","hmyz","hnis","hnojivo","hnout","hoblina","hoboj","hoch","hodiny","hodlat","hodnota","hodovat","hojnost","hokej","holinka","holka","holub","homole","honitba","honorace","horal","horda","horizont","horko","horlivec","hormon","hornina","horoskop","horstvo","hospoda","hostina","hotovost","houba","houf","houpat","houska","hovor","hradba","hranice","hravost","hrazda","hrbolek","hrdina","hrdlo","hrdost","hrnek","hrobka","hromada","hrot","hrouda","hrozen","hrstka","hrubost","hryzat","hubenost","hubnout","hudba","hukot","humr","husita","hustota","hvozd","hybnost","hydrant","hygiena","hymna","hysterik","idylka","ihned","ikona","iluze","imunita","infekce","inflace","inkaso","inovace","inspekce","internet","invalida","investor","inzerce","ironie","jablko","jachta","jahoda","jakmile","jakost","jalovec","jantar","jarmark","jaro","jasan","jasno","jatka","javor","jazyk","jedinec","jedle","jednatel","jehlan","jekot","jelen","jelito","jemnost","jenom","jepice","jeseter","jevit","jezdec","jezero","jinak","jindy","jinoch","jiskra","jistota","jitrnice","jizva","jmenovat","jogurt","jurta","kabaret","kabel","kabinet","kachna","kadet","kadidlo","kahan","kajak","kajuta","kakao","kaktus","kalamita","kalhoty","kalibr","kalnost","kamera","kamkoliv","kamna","kanibal","kanoe","kantor","kapalina","kapela","kapitola","kapka","kaple","kapota","kapr","kapusta","kapybara","karamel","karotka","karton","kasa","katalog","katedra","kauce","kauza","kavalec","kazajka","kazeta","kazivost","kdekoliv","kdesi","kedluben","kemp","keramika","kino","klacek","kladivo","klam","klapot","klasika","klaun","klec","klenba","klepat","klesnout","klid","klima","klisna","klobouk","klokan","klopa","kloub","klubovna","klusat","kluzkost","kmen","kmitat","kmotr","kniha","knot","koalice","koberec","kobka","kobliha","kobyla","kocour","kohout","kojenec","kokos","koktejl","kolaps","koleda","kolize","kolo","komando","kometa","komik","komnata","komora","kompas","komunita","konat","koncept","kondice","konec","konfese","kongres","konina","konkurs","kontakt","konzerva","kopanec","kopie","kopnout","koprovka","korbel","korektor","kormidlo","koroptev","korpus","koruna","koryto","korzet","kosatec","kostka","kotel","kotleta","kotoul","koukat","koupelna","kousek","kouzlo","kovboj","koza","kozoroh","krabice","krach","krajina","kralovat","krasopis","kravata","kredit","krejcar","kresba","kreveta","kriket","kritik","krize","krkavec","krmelec","krmivo","krocan","krok","kronika","kropit","kroupa","krovka","krtek","kruhadlo","krupice","krutost","krvinka","krychle","krypta","krystal","kryt","kudlanka","kufr","kujnost","kukla","kulajda","kulich","kulka","kulomet","kultura","kuna","kupodivu","kurt","kurzor","kutil","kvalita","kvasinka","kvestor","kynolog","kyselina","kytara","kytice","kytka","kytovec","kyvadlo","labrador","lachtan","ladnost","laik","lakomec","lamela","lampa","lanovka","lasice","laso","lastura","latinka","lavina","lebka","leckdy","leden","lednice","ledovka","ledvina","legenda","legie","legrace","lehce","lehkost","lehnout","lektvar","lenochod","lentilka","lepenka","lepidlo","letadlo","letec","letmo","letokruh","levhart","levitace","levobok","libra","lichotka","lidojed","lidskost","lihovina","lijavec","lilek","limetka","linie","linka","linoleum","listopad","litina","litovat","lobista","lodivod","logika","logoped","lokalita","loket","lomcovat","lopata","lopuch","lord","losos","lotr","loudal","louh","louka","louskat","lovec","lstivost","lucerna","lucifer","lump","lusk","lustrace","lvice","lyra","lyrika","lysina","madam","madlo","magistr","mahagon","majetek","majitel","majorita","makak","makovice","makrela","malba","malina","malovat","malvice","maminka","mandle","manko","marnost","masakr","maskot","masopust","matice","matrika","maturita","mazanec","mazivo","mazlit","mazurka","mdloba","mechanik","meditace","medovina","melasa","meloun","mentolka","metla","metoda","metr","mezera","migrace","mihnout","mihule","mikina","mikrofon","milenec","milimetr","milost","mimika","mincovna","minibar","minomet","minulost","miska","mistr","mixovat","mladost","mlha","mlhovina","mlok","mlsat","mluvit","mnich","mnohem","mobil","mocnost","modelka","modlitba","mohyla","mokro","molekula","momentka","monarcha","monokl","monstrum","montovat","monzun","mosaz","moskyt","most","motivace","motorka","motyka","moucha","moudrost","mozaika","mozek","mozol","mramor","mravenec","mrkev","mrtvola","mrzet","mrzutost","mstitel","mudrc","muflon","mulat","mumie","munice","muset","mutace","muzeum","muzikant","myslivec","mzda","nabourat","nachytat","nadace","nadbytek","nadhoz","nadobro","nadpis","nahlas","nahnat","nahodile","nahradit","naivita","najednou","najisto","najmout","naklonit","nakonec","nakrmit","nalevo","namazat","namluvit","nanometr","naoko","naopak","naostro","napadat","napevno","naplnit","napnout","naposled","naprosto","narodit","naruby","narychlo","nasadit","nasekat","naslepo","nastat","natolik","navenek","navrch","navzdory","nazvat","nebe","nechat","necky","nedaleko","nedbat","neduh","negace","nehet","nehoda","nejen","nejprve","neklid","nelibost","nemilost","nemoc","neochota","neonka","nepokoj","nerost","nerv","nesmysl","nesoulad","netvor","neuron","nevina","nezvykle","nicota","nijak","nikam","nikdy","nikl","nikterak","nitro","nocleh","nohavice","nominace","nora","norek","nositel","nosnost","nouze","noviny","novota","nozdra","nuda","nudle","nuget","nutit","nutnost","nutrie","nymfa","obal","obarvit","obava","obdiv","obec","obehnat","obejmout","obezita","obhajoba","obilnice","objasnit","objekt","obklopit","oblast","oblek","obliba","obloha","obluda","obnos","obohatit","obojek","obout","obrazec","obrna","obruba","obrys","obsah","obsluha","obstarat","obuv","obvaz","obvinit","obvod","obvykle","obyvatel","obzor","ocas","ocel","ocenit","ochladit","ochota","ochrana","ocitnout","odboj","odbyt","odchod","odcizit","odebrat","odeslat","odevzdat","odezva","odhadce","odhodit","odjet","odjinud","odkaz","odkoupit","odliv","odluka","odmlka","odolnost","odpad","odpis","odplout","odpor","odpustit","odpykat","odrazka","odsoudit","odstup","odsun","odtok","odtud","odvaha","odveta","odvolat","odvracet","odznak","ofina","ofsajd","ohlas","ohnisko","ohrada","ohrozit","ohryzek","okap","okenice","oklika","okno","okouzlit","okovy","okrasa","okres","okrsek","okruh","okupant","okurka","okusit","olejnina","olizovat","omak","omeleta","omezit","omladina","omlouvat","omluva","omyl","onehdy","opakovat","opasek","operace","opice","opilost","opisovat","opora","opozice","opravdu","oproti","orbital","orchestr","orgie","orlice","orloj","ortel","osada","oschnout","osika","osivo","oslava","oslepit","oslnit","oslovit","osnova","osoba","osolit","ospalec","osten","ostraha","ostuda","ostych","osvojit","oteplit","otisk","otop","otrhat","otrlost","otrok","otruby","otvor","ovanout","ovar","oves","ovlivnit","ovoce","oxid","ozdoba","pachatel","pacient","padouch","pahorek","pakt","palanda","palec","palivo","paluba","pamflet","pamlsek","panenka","panika","panna","panovat","panstvo","pantofle","paprika","parketa","parodie","parta","paruka","paryba","paseka","pasivita","pastelka","patent","patrona","pavouk","pazneht","pazourek","pecka","pedagog","pejsek","peklo","peloton","penalta","pendrek","penze","periskop","pero","pestrost","petarda","petice","petrolej","pevnina","pexeso","pianista","piha","pijavice","pikle","piknik","pilina","pilnost","pilulka","pinzeta","pipeta","pisatel","pistole","pitevna","pivnice","pivovar","placenta","plakat","plamen","planeta","plastika","platit","plavidlo","plaz","plech","plemeno","plenta","ples","pletivo","plevel","plivat","plnit","plno","plocha","plodina","plomba","plout","pluk","plyn","pobavit","pobyt","pochod","pocit","poctivec","podat","podcenit","podepsat","podhled","podivit","podklad","podmanit","podnik","podoba","podpora","podraz","podstata","podvod","podzim","poezie","pohanka","pohnutka","pohovor","pohroma","pohyb","pointa","pojistka","pojmout","pokazit","pokles","pokoj","pokrok","pokuta","pokyn","poledne","polibek","polknout","poloha","polynom","pomalu","pominout","pomlka","pomoc","pomsta","pomyslet","ponechat","ponorka","ponurost","popadat","popel","popisek","poplach","poprosit","popsat","popud","poradce","porce","porod","porucha","poryv","posadit","posed","posila","poskok","poslanec","posoudit","pospolu","postava","posudek","posyp","potah","potkan","potlesk","potomek","potrava","potupa","potvora","poukaz","pouto","pouzdro","povaha","povidla","povlak","povoz","povrch","povstat","povyk","povzdech","pozdrav","pozemek","poznatek","pozor","pozvat","pracovat","prahory","praktika","prales","praotec","praporek","prase","pravda","princip","prkno","probudit","procento","prodej","profese","prohra","projekt","prolomit","promile","pronikat","propad","prorok","prosba","proton","proutek","provaz","prskavka","prsten","prudkost","prut","prvek","prvohory","psanec","psovod","pstruh","ptactvo","puberta","puch","pudl","pukavec","puklina","pukrle","pult","pumpa","punc","pupen","pusa","pusinka","pustina","putovat","putyka","pyramida","pysk","pytel","racek","rachot","radiace","radnice","radon","raft","ragby","raketa","rakovina","rameno","rampouch","rande","rarach","rarita","rasovna","rastr","ratolest","razance","razidlo","reagovat","reakce","recept","redaktor","referent","reflex","rejnok","reklama","rekord","rekrut","rektor","reputace","revize","revma","revolver","rezerva","riskovat","riziko","robotika","rodokmen","rohovka","rokle","rokoko","romaneto","ropovod","ropucha","rorejs","rosol","rostlina","rotmistr","rotoped","rotunda","roubenka","roucho","roup","roura","rovina","rovnice","rozbor","rozchod","rozdat","rozeznat","rozhodce","rozinka","rozjezd","rozkaz","rozloha","rozmar","rozpad","rozruch","rozsah","roztok","rozum","rozvod","rubrika","ruchadlo","rukavice","rukopis","ryba","rybolov","rychlost","rydlo","rypadlo","rytina","ryzost","sadista","sahat","sako","samec","samizdat","samota","sanitka","sardinka","sasanka","satelit","sazba","sazenice","sbor","schovat","sebranka","secese","sedadlo","sediment","sedlo","sehnat","sejmout","sekera","sekta","sekunda","sekvoje","semeno","seno","servis","sesadit","seshora","seskok","seslat","sestra","sesuv","sesypat","setba","setina","setkat","setnout","setrvat","sever","seznam","shoda","shrnout","sifon","silnice","sirka","sirotek","sirup","situace","skafandr","skalisko","skanzen","skaut","skeptik","skica","skladba","sklenice","sklo","skluz","skoba","skokan","skoro","skripta","skrz","skupina","skvost","skvrna","slabika","sladidlo","slanina","slast","slavnost","sledovat","slepec","sleva","slezina","slib","slina","sliznice","slon","sloupek","slovo","sluch","sluha","slunce","slupka","slza","smaragd","smetana","smilstvo","smlouva","smog","smrad","smrk","smrtka","smutek","smysl","snad","snaha","snob","sobota","socha","sodovka","sokol","sopka","sotva","souboj","soucit","soudce","souhlas","soulad","soumrak","souprava","soused","soutok","souviset","spalovna","spasitel","spis","splav","spodek","spojenec","spolu","sponzor","spornost","spousta","sprcha","spustit","sranda","sraz","srdce","srna","srnec","srovnat","srpen","srst","srub","stanice","starosta","statika","stavba","stehno","stezka","stodola","stolek","stopa","storno","stoupat","strach","stres","strhnout","strom","struna","studna","stupnice","stvol","styk","subjekt","subtropy","suchar","sudost","sukno","sundat","sunout","surikata","surovina","svah","svalstvo","svetr","svatba","svazek","svisle","svitek","svoboda","svodidlo","svorka","svrab","sykavka","sykot","synek","synovec","sypat","sypkost","syrovost","sysel","sytost","tabletka","tabule","tahoun","tajemno","tajfun","tajga","tajit","tajnost","taktika","tamhle","tampon","tancovat","tanec","tanker","tapeta","tavenina","tazatel","technika","tehdy","tekutina","telefon","temnota","tendence","tenista","tenor","teplota","tepna","teprve","terapie","termoska","textil","ticho","tiskopis","titulek","tkadlec","tkanina","tlapka","tleskat","tlukot","tlupa","tmel","toaleta","topinka","topol","torzo","touha","toulec","tradice","traktor","tramp","trasa","traverza","trefit","trest","trezor","trhavina","trhlina","trochu","trojice","troska","trouba","trpce","trpitel","trpkost","trubec","truchlit","truhlice","trus","trvat","tudy","tuhnout","tuhost","tundra","turista","turnaj","tuzemsko","tvaroh","tvorba","tvrdost","tvrz","tygr","tykev","ubohost","uboze","ubrat","ubrousek","ubrus","ubytovna","ucho","uctivost","udivit","uhradit","ujednat","ujistit","ujmout","ukazatel","uklidnit","uklonit","ukotvit","ukrojit","ulice","ulita","ulovit","umyvadlo","unavit","uniforma","uniknout","upadnout","uplatnit","uplynout","upoutat","upravit","uran","urazit","usednout","usilovat","usmrtit","usnadnit","usnout","usoudit","ustlat","ustrnout","utahovat","utkat","utlumit","utonout","utopenec","utrousit","uvalit","uvolnit","uvozovka","uzdravit","uzel","uzenina","uzlina","uznat","vagon","valcha","valoun","vana","vandal","vanilka","varan","varhany","varovat","vcelku","vchod","vdova","vedro","vegetace","vejce","velbloud","veletrh","velitel","velmoc","velryba","venkov","veranda","verze","veselka","veskrze","vesnice","vespodu","vesta","veterina","veverka","vibrace","vichr","videohra","vidina","vidle","vila","vinice","viset","vitalita","vize","vizitka","vjezd","vklad","vkus","vlajka","vlak","vlasec","vlevo","vlhkost","vliv","vlnovka","vloupat","vnucovat","vnuk","voda","vodivost","vodoznak","vodstvo","vojensky","vojna","vojsko","volant","volba","volit","volno","voskovka","vozidlo","vozovna","vpravo","vrabec","vracet","vrah","vrata","vrba","vrcholek","vrhat","vrstva","vrtule","vsadit","vstoupit","vstup","vtip","vybavit","vybrat","vychovat","vydat","vydra","vyfotit","vyhledat","vyhnout","vyhodit","vyhradit","vyhubit","vyjasnit","vyjet","vyjmout","vyklopit","vykonat","vylekat","vymazat","vymezit","vymizet","vymyslet","vynechat","vynikat","vynutit","vypadat","vyplatit","vypravit","vypustit","vyrazit","vyrovnat","vyrvat","vyslovit","vysoko","vystavit","vysunout","vysypat","vytasit","vytesat","vytratit","vyvinout","vyvolat","vyvrhel","vyzdobit","vyznat","vzadu","vzbudit","vzchopit","vzdor","vzduch","vzdychat","vzestup","vzhledem","vzkaz","vzlykat","vznik","vzorek","vzpoura","vztah","vztek","xylofon","zabrat","zabydlet","zachovat","zadarmo","zadusit","zafoukat","zahltit","zahodit","zahrada","zahynout","zajatec","zajet","zajistit","zaklepat","zakoupit","zalepit","zamezit","zamotat","zamyslet","zanechat","zanikat","zaplatit","zapojit","zapsat","zarazit","zastavit","zasunout","zatajit","zatemnit","zatknout","zaujmout","zavalit","zavelet","zavinit","zavolat","zavrtat","zazvonit","zbavit","zbrusu","zbudovat","zbytek","zdaleka","zdarma","zdatnost","zdivo","zdobit","zdroj","zdvih","zdymadlo","zelenina","zeman","zemina","zeptat","zezadu","zezdola","zhatit","zhltnout","zhluboka","zhotovit","zhruba","zima","zimnice","zjemnit","zklamat","zkoumat","zkratka","zkumavka","zlato","zlehka","zloba","zlom","zlost","zlozvyk","zmapovat","zmar","zmatek","zmije","zmizet","zmocnit","zmodrat","zmrzlina","zmutovat","znak","znalost","znamenat","znovu","zobrazit","zotavit","zoubek","zoufale","zplodit","zpomalit","zprava","zprostit","zprudka","zprvu","zrada","zranit","zrcadlo","zrnitost","zrno","zrovna","zrychlit","zrzavost","zticha","ztratit","zubovina","zubr","zvednout","zvenku","zvesela","zvon","zvrat","zvukovod","zvyk"]'),require$$1$2=JSON.parse('["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]'),require$$2$3=JSON.parse('["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]'),require$$3=JSON.parse('["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]'),require$$4$1=JSON.parse('["abaisser","abandon","abdiquer","abeille","abolir","aborder","aboutir","aboyer","abrasif","abreuver","abriter","abroger","abrupt","absence","absolu","absurde","abusif","abyssal","academie","acajou","acarien","accabler","accepter","acclamer","accolade","accroche","accuser","acerbe","achat","acheter","aciduler","acier","acompte","acquerir","acronyme","acteur","actif","actuel","adepte","adequat","adhesif","adjectif","adjuger","admettre","admirer","adopter","adorer","adoucir","adresse","adroit","adulte","adverbe","aerer","aeronef","affaire","affecter","affiche","affreux","affubler","agacer","agencer","agile","agiter","agrafer","agreable","agrume","aider","aiguille","ailier","aimable","aisance","ajouter","ajuster","alarmer","alchimie","alerte","algebre","algue","aliener","aliment","alleger","alliage","allouer","allumer","alourdir","alpaga","altesse","alveole","amateur","ambigu","ambre","amenager","amertume","amidon","amiral","amorcer","amour","amovible","amphibie","ampleur","amusant","analyse","anaphore","anarchie","anatomie","ancien","aneantir","angle","angoisse","anguleux","animal","annexer","annonce","annuel","anodin","anomalie","anonyme","anormal","antenne","antidote","anxieux","apaiser","aperitif","aplanir","apologie","appareil","appeler","apporter","appuyer","aquarium","aqueduc","arbitre","arbuste","ardeur","ardoise","argent","arlequin","armature","armement","armoire","armure","arpenter","arracher","arriver","arroser","arsenic","arteriel","article","aspect","asphalte","aspirer","assaut","asservir","assiette","associer","assurer","asticot","astre","astuce","atelier","atome","atrium","atroce","attaque","attentif","attirer","attraper","aubaine","auberge","audace","audible","augurer","aurore","automne","autruche","avaler","avancer","avarice","avenir","averse","aveugle","aviateur","avide","avion","aviser","avoine","avouer","avril","axial","axiome","badge","bafouer","bagage","baguette","baignade","balancer","balcon","baleine","balisage","bambin","bancaire","bandage","banlieue","banniere","banquier","barbier","baril","baron","barque","barrage","bassin","bastion","bataille","bateau","batterie","baudrier","bavarder","belette","belier","belote","benefice","berceau","berger","berline","bermuda","besace","besogne","betail","beurre","biberon","bicycle","bidule","bijou","bilan","bilingue","billard","binaire","biologie","biopsie","biotype","biscuit","bison","bistouri","bitume","bizarre","blafard","blague","blanchir","blessant","blinder","blond","bloquer","blouson","bobard","bobine","boire","boiser","bolide","bonbon","bondir","bonheur","bonifier","bonus","bordure","borne","botte","boucle","boueux","bougie","boulon","bouquin","bourse","boussole","boutique","boxeur","branche","brasier","brave","brebis","breche","breuvage","bricoler","brigade","brillant","brioche","brique","brochure","broder","bronzer","brousse","broyeur","brume","brusque","brutal","bruyant","buffle","buisson","bulletin","bureau","burin","bustier","butiner","butoir","buvable","buvette","cabanon","cabine","cachette","cadeau","cadre","cafeine","caillou","caisson","calculer","calepin","calibre","calmer","calomnie","calvaire","camarade","camera","camion","campagne","canal","caneton","canon","cantine","canular","capable","caporal","caprice","capsule","capter","capuche","carabine","carbone","caresser","caribou","carnage","carotte","carreau","carton","cascade","casier","casque","cassure","causer","caution","cavalier","caverne","caviar","cedille","ceinture","celeste","cellule","cendrier","censurer","central","cercle","cerebral","cerise","cerner","cerveau","cesser","chagrin","chaise","chaleur","chambre","chance","chapitre","charbon","chasseur","chaton","chausson","chavirer","chemise","chenille","chequier","chercher","cheval","chien","chiffre","chignon","chimere","chiot","chlorure","chocolat","choisir","chose","chouette","chrome","chute","cigare","cigogne","cimenter","cinema","cintrer","circuler","cirer","cirque","citerne","citoyen","citron","civil","clairon","clameur","claquer","classe","clavier","client","cligner","climat","clivage","cloche","clonage","cloporte","cobalt","cobra","cocasse","cocotier","coder","codifier","coffre","cogner","cohesion","coiffer","coincer","colere","colibri","colline","colmater","colonel","combat","comedie","commande","compact","concert","conduire","confier","congeler","connoter","consonne","contact","convexe","copain","copie","corail","corbeau","cordage","corniche","corpus","correct","cortege","cosmique","costume","coton","coude","coupure","courage","couteau","couvrir","coyote","crabe","crainte","cravate","crayon","creature","crediter","cremeux","creuser","crevette","cribler","crier","cristal","critere","croire","croquer","crotale","crucial","cruel","crypter","cubique","cueillir","cuillere","cuisine","cuivre","culminer","cultiver","cumuler","cupide","curatif","curseur","cyanure","cycle","cylindre","cynique","daigner","damier","danger","danseur","dauphin","debattre","debiter","deborder","debrider","debutant","decaler","decembre","dechirer","decider","declarer","decorer","decrire","decupler","dedale","deductif","deesse","defensif","defiler","defrayer","degager","degivrer","deglutir","degrafer","dejeuner","delice","deloger","demander","demeurer","demolir","denicher","denouer","dentelle","denuder","depart","depenser","dephaser","deplacer","deposer","deranger","derober","desastre","descente","desert","designer","desobeir","dessiner","destrier","detacher","detester","detourer","detresse","devancer","devenir","deviner","devoir","diable","dialogue","diamant","dicter","differer","digerer","digital","digne","diluer","dimanche","diminuer","dioxyde","directif","diriger","discuter","disposer","dissiper","distance","divertir","diviser","docile","docteur","dogme","doigt","domaine","domicile","dompter","donateur","donjon","donner","dopamine","dortoir","dorure","dosage","doseur","dossier","dotation","douanier","double","douceur","douter","doyen","dragon","draper","dresser","dribbler","droiture","duperie","duplexe","durable","durcir","dynastie","eblouir","ecarter","echarpe","echelle","eclairer","eclipse","eclore","ecluse","ecole","economie","ecorce","ecouter","ecraser","ecremer","ecrivain","ecrou","ecume","ecureuil","edifier","eduquer","effacer","effectif","effigie","effort","effrayer","effusion","egaliser","egarer","ejecter","elaborer","elargir","electron","elegant","elephant","eleve","eligible","elitisme","eloge","elucider","eluder","emballer","embellir","embryon","emeraude","emission","emmener","emotion","emouvoir","empereur","employer","emporter","emprise","emulsion","encadrer","enchere","enclave","encoche","endiguer","endosser","endroit","enduire","energie","enfance","enfermer","enfouir","engager","engin","englober","enigme","enjamber","enjeu","enlever","ennemi","ennuyeux","enrichir","enrobage","enseigne","entasser","entendre","entier","entourer","entraver","enumerer","envahir","enviable","envoyer","enzyme","eolien","epaissir","epargne","epatant","epaule","epicerie","epidemie","epier","epilogue","epine","episode","epitaphe","epoque","epreuve","eprouver","epuisant","equerre","equipe","eriger","erosion","erreur","eruption","escalier","espadon","espece","espiegle","espoir","esprit","esquiver","essayer","essence","essieu","essorer","estime","estomac","estrade","etagere","etaler","etanche","etatique","eteindre","etendoir","eternel","ethanol","ethique","ethnie","etirer","etoffer","etoile","etonnant","etourdir","etrange","etroit","etude","euphorie","evaluer","evasion","eventail","evidence","eviter","evolutif","evoquer","exact","exagerer","exaucer","exceller","excitant","exclusif","excuse","executer","exemple","exercer","exhaler","exhorter","exigence","exiler","exister","exotique","expedier","explorer","exposer","exprimer","exquis","extensif","extraire","exulter","fable","fabuleux","facette","facile","facture","faiblir","falaise","fameux","famille","farceur","farfelu","farine","farouche","fasciner","fatal","fatigue","faucon","fautif","faveur","favori","febrile","feconder","federer","felin","femme","femur","fendoir","feodal","fermer","feroce","ferveur","festival","feuille","feutre","fevrier","fiasco","ficeler","fictif","fidele","figure","filature","filetage","filiere","filleul","filmer","filou","filtrer","financer","finir","fiole","firme","fissure","fixer","flairer","flamme","flasque","flatteur","fleau","fleche","fleur","flexion","flocon","flore","fluctuer","fluide","fluvial","folie","fonderie","fongible","fontaine","forcer","forgeron","formuler","fortune","fossile","foudre","fougere","fouiller","foulure","fourmi","fragile","fraise","franchir","frapper","frayeur","fregate","freiner","frelon","fremir","frenesie","frere","friable","friction","frisson","frivole","froid","fromage","frontal","frotter","fruit","fugitif","fuite","fureur","furieux","furtif","fusion","futur","gagner","galaxie","galerie","gambader","garantir","gardien","garnir","garrigue","gazelle","gazon","geant","gelatine","gelule","gendarme","general","genie","genou","gentil","geologie","geometre","geranium","germe","gestuel","geyser","gibier","gicler","girafe","givre","glace","glaive","glisser","globe","gloire","glorieux","golfeur","gomme","gonfler","gorge","gorille","goudron","gouffre","goulot","goupille","gourmand","goutte","graduel","graffiti","graine","grand","grappin","gratuit","gravir","grenat","griffure","griller","grimper","grogner","gronder","grotte","groupe","gruger","grutier","gruyere","guepard","guerrier","guide","guimauve","guitare","gustatif","gymnaste","gyrostat","habitude","hachoir","halte","hameau","hangar","hanneton","haricot","harmonie","harpon","hasard","helium","hematome","herbe","herisson","hermine","heron","hesiter","heureux","hiberner","hibou","hilarant","histoire","hiver","homard","hommage","homogene","honneur","honorer","honteux","horde","horizon","horloge","hormone","horrible","houleux","housse","hublot","huileux","humain","humble","humide","humour","hurler","hydromel","hygiene","hymne","hypnose","idylle","ignorer","iguane","illicite","illusion","image","imbiber","imiter","immense","immobile","immuable","impact","imperial","implorer","imposer","imprimer","imputer","incarner","incendie","incident","incliner","incolore","indexer","indice","inductif","inedit","ineptie","inexact","infini","infliger","informer","infusion","ingerer","inhaler","inhiber","injecter","injure","innocent","inoculer","inonder","inscrire","insecte","insigne","insolite","inspirer","instinct","insulter","intact","intense","intime","intrigue","intuitif","inutile","invasion","inventer","inviter","invoquer","ironique","irradier","irreel","irriter","isoler","ivoire","ivresse","jaguar","jaillir","jambe","janvier","jardin","jauger","jaune","javelot","jetable","jeton","jeudi","jeunesse","joindre","joncher","jongler","joueur","jouissif","journal","jovial","joyau","joyeux","jubiler","jugement","junior","jupon","juriste","justice","juteux","juvenile","kayak","kimono","kiosque","label","labial","labourer","lacerer","lactose","lagune","laine","laisser","laitier","lambeau","lamelle","lampe","lanceur","langage","lanterne","lapin","largeur","larme","laurier","lavabo","lavoir","lecture","legal","leger","legume","lessive","lettre","levier","lexique","lezard","liasse","liberer","libre","licence","licorne","liege","lievre","ligature","ligoter","ligue","limer","limite","limonade","limpide","lineaire","lingot","lionceau","liquide","lisiere","lister","lithium","litige","littoral","livreur","logique","lointain","loisir","lombric","loterie","louer","lourd","loutre","louve","loyal","lubie","lucide","lucratif","lueur","lugubre","luisant","lumiere","lunaire","lundi","luron","lutter","luxueux","machine","magasin","magenta","magique","maigre","maillon","maintien","mairie","maison","majorer","malaxer","malefice","malheur","malice","mallette","mammouth","mandater","maniable","manquant","manteau","manuel","marathon","marbre","marchand","mardi","maritime","marqueur","marron","marteler","mascotte","massif","materiel","matiere","matraque","maudire","maussade","mauve","maximal","mechant","meconnu","medaille","medecin","mediter","meduse","meilleur","melange","melodie","membre","memoire","menacer","mener","menhir","mensonge","mentor","mercredi","merite","merle","messager","mesure","metal","meteore","methode","metier","meuble","miauler","microbe","miette","mignon","migrer","milieu","million","mimique","mince","mineral","minimal","minorer","minute","miracle","miroiter","missile","mixte","mobile","moderne","moelleux","mondial","moniteur","monnaie","monotone","monstre","montagne","monument","moqueur","morceau","morsure","mortier","moteur","motif","mouche","moufle","moulin","mousson","mouton","mouvant","multiple","munition","muraille","murene","murmure","muscle","museum","musicien","mutation","muter","mutuel","myriade","myrtille","mystere","mythique","nageur","nappe","narquois","narrer","natation","nation","nature","naufrage","nautique","navire","nebuleux","nectar","nefaste","negation","negliger","negocier","neige","nerveux","nettoyer","neurone","neutron","neveu","niche","nickel","nitrate","niveau","noble","nocif","nocturne","noirceur","noisette","nomade","nombreux","nommer","normatif","notable","notifier","notoire","nourrir","nouveau","novateur","novembre","novice","nuage","nuancer","nuire","nuisible","numero","nuptial","nuque","nutritif","obeir","objectif","obliger","obscur","observer","obstacle","obtenir","obturer","occasion","occuper","ocean","octobre","octroyer","octupler","oculaire","odeur","odorant","offenser","officier","offrir","ogive","oiseau","oisillon","olfactif","olivier","ombrage","omettre","onctueux","onduler","onereux","onirique","opale","opaque","operer","opinion","opportun","opprimer","opter","optique","orageux","orange","orbite","ordonner","oreille","organe","orgueil","orifice","ornement","orque","ortie","osciller","osmose","ossature","otarie","ouragan","ourson","outil","outrager","ouvrage","ovation","oxyde","oxygene","ozone","paisible","palace","palmares","palourde","palper","panache","panda","pangolin","paniquer","panneau","panorama","pantalon","papaye","papier","papoter","papyrus","paradoxe","parcelle","paresse","parfumer","parler","parole","parrain","parsemer","partager","parure","parvenir","passion","pasteque","paternel","patience","patron","pavillon","pavoiser","payer","paysage","peigne","peintre","pelage","pelican","pelle","pelouse","peluche","pendule","penetrer","penible","pensif","penurie","pepite","peplum","perdrix","perforer","periode","permuter","perplexe","persil","perte","peser","petale","petit","petrir","peuple","pharaon","phobie","phoque","photon","phrase","physique","piano","pictural","piece","pierre","pieuvre","pilote","pinceau","pipette","piquer","pirogue","piscine","piston","pivoter","pixel","pizza","placard","plafond","plaisir","planer","plaque","plastron","plateau","pleurer","plexus","pliage","plomb","plonger","pluie","plumage","pochette","poesie","poete","pointe","poirier","poisson","poivre","polaire","policier","pollen","polygone","pommade","pompier","ponctuel","ponderer","poney","portique","position","posseder","posture","potager","poteau","potion","pouce","poulain","poumon","pourpre","poussin","pouvoir","prairie","pratique","precieux","predire","prefixe","prelude","prenom","presence","pretexte","prevoir","primitif","prince","prison","priver","probleme","proceder","prodige","profond","progres","proie","projeter","prologue","promener","propre","prospere","proteger","prouesse","proverbe","prudence","pruneau","psychose","public","puceron","puiser","pulpe","pulsar","punaise","punitif","pupitre","purifier","puzzle","pyramide","quasar","querelle","question","quietude","quitter","quotient","racine","raconter","radieux","ragondin","raideur","raisin","ralentir","rallonge","ramasser","rapide","rasage","ratisser","ravager","ravin","rayonner","reactif","reagir","realiser","reanimer","recevoir","reciter","reclamer","recolter","recruter","reculer","recycler","rediger","redouter","refaire","reflexe","reformer","refrain","refuge","regalien","region","reglage","regulier","reiterer","rejeter","rejouer","relatif","relever","relief","remarque","remede","remise","remonter","remplir","remuer","renard","renfort","renifler","renoncer","rentrer","renvoi","replier","reporter","reprise","reptile","requin","reserve","resineux","resoudre","respect","rester","resultat","retablir","retenir","reticule","retomber","retracer","reunion","reussir","revanche","revivre","revolte","revulsif","richesse","rideau","rieur","rigide","rigoler","rincer","riposter","risible","risque","rituel","rival","riviere","rocheux","romance","rompre","ronce","rondin","roseau","rosier","rotatif","rotor","rotule","rouge","rouille","rouleau","routine","royaume","ruban","rubis","ruche","ruelle","rugueux","ruiner","ruisseau","ruser","rustique","rythme","sabler","saboter","sabre","sacoche","safari","sagesse","saisir","salade","salive","salon","saluer","samedi","sanction","sanglier","sarcasme","sardine","saturer","saugrenu","saumon","sauter","sauvage","savant","savonner","scalpel","scandale","scelerat","scenario","sceptre","schema","science","scinder","score","scrutin","sculpter","seance","secable","secher","secouer","secreter","sedatif","seduire","seigneur","sejour","selectif","semaine","sembler","semence","seminal","senateur","sensible","sentence","separer","sequence","serein","sergent","serieux","serrure","serum","service","sesame","sevir","sevrage","sextuple","sideral","siecle","sieger","siffler","sigle","signal","silence","silicium","simple","sincere","sinistre","siphon","sirop","sismique","situer","skier","social","socle","sodium","soigneux","soldat","soleil","solitude","soluble","sombre","sommeil","somnoler","sonde","songeur","sonnette","sonore","sorcier","sortir","sosie","sottise","soucieux","soudure","souffle","soulever","soupape","source","soutirer","souvenir","spacieux","spatial","special","sphere","spiral","stable","station","sternum","stimulus","stipuler","strict","studieux","stupeur","styliste","sublime","substrat","subtil","subvenir","succes","sucre","suffixe","suggerer","suiveur","sulfate","superbe","supplier","surface","suricate","surmener","surprise","sursaut","survie","suspect","syllabe","symbole","symetrie","synapse","syntaxe","systeme","tabac","tablier","tactile","tailler","talent","talisman","talonner","tambour","tamiser","tangible","tapis","taquiner","tarder","tarif","tartine","tasse","tatami","tatouage","taupe","taureau","taxer","temoin","temporel","tenaille","tendre","teneur","tenir","tension","terminer","terne","terrible","tetine","texte","theme","theorie","therapie","thorax","tibia","tiede","timide","tirelire","tiroir","tissu","titane","titre","tituber","toboggan","tolerant","tomate","tonique","tonneau","toponyme","torche","tordre","tornade","torpille","torrent","torse","tortue","totem","toucher","tournage","tousser","toxine","traction","trafic","tragique","trahir","train","trancher","travail","trefle","tremper","tresor","treuil","triage","tribunal","tricoter","trilogie","triomphe","tripler","triturer","trivial","trombone","tronc","tropical","troupeau","tuile","tulipe","tumulte","tunnel","turbine","tuteur","tutoyer","tuyau","tympan","typhon","typique","tyran","ubuesque","ultime","ultrason","unanime","unifier","union","unique","unitaire","univers","uranium","urbain","urticant","usage","usine","usuel","usure","utile","utopie","vacarme","vaccin","vagabond","vague","vaillant","vaincre","vaisseau","valable","valise","vallon","valve","vampire","vanille","vapeur","varier","vaseux","vassal","vaste","vecteur","vedette","vegetal","vehicule","veinard","veloce","vendredi","venerer","venger","venimeux","ventouse","verdure","verin","vernir","verrou","verser","vertu","veston","veteran","vetuste","vexant","vexer","viaduc","viande","victoire","vidange","video","vignette","vigueur","vilain","village","vinaigre","violon","vipere","virement","virtuose","virus","visage","viseur","vision","visqueux","visuel","vital","vitesse","viticole","vitrine","vivace","vivipare","vocation","voguer","voile","voisin","voiture","volaille","volcan","voltiger","volume","vorace","vortex","voter","vouloir","voyage","voyelle","wagon","xenon","yacht","zebre","zenith","zeste","zoologie"]'),require$$5=JSON.parse('["abaco","abbaglio","abbinato","abete","abisso","abolire","abrasivo","abrogato","accadere","accenno","accusato","acetone","achille","acido","acqua","acre","acrilico","acrobata","acuto","adagio","addebito","addome","adeguato","aderire","adipe","adottare","adulare","affabile","affetto","affisso","affranto","aforisma","afoso","africano","agave","agente","agevole","aggancio","agire","agitare","agonismo","agricolo","agrumeto","aguzzo","alabarda","alato","albatro","alberato","albo","albume","alce","alcolico","alettone","alfa","algebra","aliante","alibi","alimento","allagato","allegro","allievo","allodola","allusivo","almeno","alogeno","alpaca","alpestre","altalena","alterno","alticcio","altrove","alunno","alveolo","alzare","amalgama","amanita","amarena","ambito","ambrato","ameba","america","ametista","amico","ammasso","ammenda","ammirare","ammonito","amore","ampio","ampliare","amuleto","anacardo","anagrafe","analista","anarchia","anatra","anca","ancella","ancora","andare","andrea","anello","angelo","angolare","angusto","anima","annegare","annidato","anno","annuncio","anonimo","anticipo","anzi","apatico","apertura","apode","apparire","appetito","appoggio","approdo","appunto","aprile","arabica","arachide","aragosta","araldica","arancio","aratura","arazzo","arbitro","archivio","ardito","arenile","argento","argine","arguto","aria","armonia","arnese","arredato","arringa","arrosto","arsenico","arso","artefice","arzillo","asciutto","ascolto","asepsi","asettico","asfalto","asino","asola","aspirato","aspro","assaggio","asse","assoluto","assurdo","asta","astenuto","astice","astratto","atavico","ateismo","atomico","atono","attesa","attivare","attorno","attrito","attuale","ausilio","austria","autista","autonomo","autunno","avanzato","avere","avvenire","avviso","avvolgere","azione","azoto","azzimo","azzurro","babele","baccano","bacino","baco","badessa","badilata","bagnato","baita","balcone","baldo","balena","ballata","balzano","bambino","bandire","baraonda","barbaro","barca","baritono","barlume","barocco","basilico","basso","batosta","battuto","baule","bava","bavosa","becco","beffa","belgio","belva","benda","benevole","benigno","benzina","bere","berlina","beta","bibita","bici","bidone","bifido","biga","bilancia","bimbo","binocolo","biologo","bipede","bipolare","birbante","birra","biscotto","bisesto","bisnonno","bisonte","bisturi","bizzarro","blando","blatta","bollito","bonifico","bordo","bosco","botanico","bottino","bozzolo","braccio","bradipo","brama","branca","bravura","bretella","brevetto","brezza","briglia","brillante","brindare","broccolo","brodo","bronzina","brullo","bruno","bubbone","buca","budino","buffone","buio","bulbo","buono","burlone","burrasca","bussola","busta","cadetto","caduco","calamaro","calcolo","calesse","calibro","calmo","caloria","cambusa","camerata","camicia","cammino","camola","campale","canapa","candela","cane","canino","canotto","cantina","capace","capello","capitolo","capogiro","cappero","capra","capsula","carapace","carcassa","cardo","carisma","carovana","carretto","cartolina","casaccio","cascata","caserma","caso","cassone","castello","casuale","catasta","catena","catrame","cauto","cavillo","cedibile","cedrata","cefalo","celebre","cellulare","cena","cenone","centesimo","ceramica","cercare","certo","cerume","cervello","cesoia","cespo","ceto","chela","chiaro","chicca","chiedere","chimera","china","chirurgo","chitarra","ciao","ciclismo","cifrare","cigno","cilindro","ciottolo","circa","cirrosi","citrico","cittadino","ciuffo","civetta","civile","classico","clinica","cloro","cocco","codardo","codice","coerente","cognome","collare","colmato","colore","colposo","coltivato","colza","coma","cometa","commando","comodo","computer","comune","conciso","condurre","conferma","congelare","coniuge","connesso","conoscere","consumo","continuo","convegno","coperto","copione","coppia","copricapo","corazza","cordata","coricato","cornice","corolla","corpo","corredo","corsia","cortese","cosmico","costante","cottura","covato","cratere","cravatta","creato","credere","cremoso","crescita","creta","criceto","crinale","crisi","critico","croce","cronaca","crostata","cruciale","crusca","cucire","cuculo","cugino","cullato","cupola","curatore","cursore","curvo","cuscino","custode","dado","daino","dalmata","damerino","daniela","dannoso","danzare","datato","davanti","davvero","debutto","decennio","deciso","declino","decollo","decreto","dedicato","definito","deforme","degno","delegare","delfino","delirio","delta","demenza","denotato","dentro","deposito","derapata","derivare","deroga","descritto","deserto","desiderio","desumere","detersivo","devoto","diametro","dicembre","diedro","difeso","diffuso","digerire","digitale","diluvio","dinamico","dinnanzi","dipinto","diploma","dipolo","diradare","dire","dirotto","dirupo","disagio","discreto","disfare","disgelo","disposto","distanza","disumano","dito","divano","divelto","dividere","divorato","doblone","docente","doganale","dogma","dolce","domato","domenica","dominare","dondolo","dono","dormire","dote","dottore","dovuto","dozzina","drago","druido","dubbio","dubitare","ducale","duna","duomo","duplice","duraturo","ebano","eccesso","ecco","eclissi","economia","edera","edicola","edile","editoria","educare","egemonia","egli","egoismo","egregio","elaborato","elargire","elegante","elencato","eletto","elevare","elfico","elica","elmo","elsa","eluso","emanato","emblema","emesso","emiro","emotivo","emozione","empirico","emulo","endemico","enduro","energia","enfasi","enoteca","entrare","enzima","epatite","epilogo","episodio","epocale","eppure","equatore","erario","erba","erboso","erede","eremita","erigere","ermetico","eroe","erosivo","errante","esagono","esame","esanime","esaudire","esca","esempio","esercito","esibito","esigente","esistere","esito","esofago","esortato","esoso","espanso","espresso","essenza","esso","esteso","estimare","estonia","estroso","esultare","etilico","etnico","etrusco","etto","euclideo","europa","evaso","evidenza","evitato","evoluto","evviva","fabbrica","faccenda","fachiro","falco","famiglia","fanale","fanfara","fango","fantasma","fare","farfalla","farinoso","farmaco","fascia","fastoso","fasullo","faticare","fato","favoloso","febbre","fecola","fede","fegato","felpa","feltro","femmina","fendere","fenomeno","fermento","ferro","fertile","fessura","festivo","fetta","feudo","fiaba","fiducia","fifa","figurato","filo","finanza","finestra","finire","fiore","fiscale","fisico","fiume","flacone","flamenco","flebo","flemma","florido","fluente","fluoro","fobico","focaccia","focoso","foderato","foglio","folata","folclore","folgore","fondente","fonetico","fonia","fontana","forbito","forchetta","foresta","formica","fornaio","foro","fortezza","forzare","fosfato","fosso","fracasso","frana","frassino","fratello","freccetta","frenata","fresco","frigo","frollino","fronde","frugale","frutta","fucilata","fucsia","fuggente","fulmine","fulvo","fumante","fumetto","fumoso","fune","funzione","fuoco","furbo","furgone","furore","fuso","futile","gabbiano","gaffe","galateo","gallina","galoppo","gambero","gamma","garanzia","garbo","garofano","garzone","gasdotto","gasolio","gastrico","gatto","gaudio","gazebo","gazzella","geco","gelatina","gelso","gemello","gemmato","gene","genitore","gennaio","genotipo","gergo","ghepardo","ghiaccio","ghisa","giallo","gilda","ginepro","giocare","gioiello","giorno","giove","girato","girone","gittata","giudizio","giurato","giusto","globulo","glutine","gnomo","gobba","golf","gomito","gommone","gonfio","gonna","governo","gracile","grado","grafico","grammo","grande","grattare","gravoso","grazia","greca","gregge","grifone","grigio","grinza","grotta","gruppo","guadagno","guaio","guanto","guardare","gufo","guidare","ibernato","icona","identico","idillio","idolo","idra","idrico","idrogeno","igiene","ignaro","ignorato","ilare","illeso","illogico","illudere","imballo","imbevuto","imbocco","imbuto","immane","immerso","immolato","impacco","impeto","impiego","importo","impronta","inalare","inarcare","inattivo","incanto","incendio","inchino","incisivo","incluso","incontro","incrocio","incubo","indagine","india","indole","inedito","infatti","infilare","inflitto","ingaggio","ingegno","inglese","ingordo","ingrosso","innesco","inodore","inoltrare","inondato","insano","insetto","insieme","insonnia","insulina","intasato","intero","intonaco","intuito","inumidire","invalido","invece","invito","iperbole","ipnotico","ipotesi","ippica","iride","irlanda","ironico","irrigato","irrorare","isolato","isotopo","isterico","istituto","istrice","italia","iterare","labbro","labirinto","lacca","lacerato","lacrima","lacuna","laddove","lago","lampo","lancetta","lanterna","lardoso","larga","laringe","lastra","latenza","latino","lattuga","lavagna","lavoro","legale","leggero","lembo","lentezza","lenza","leone","lepre","lesivo","lessato","lesto","letterale","leva","levigato","libero","lido","lievito","lilla","limatura","limitare","limpido","lineare","lingua","liquido","lira","lirica","lisca","lite","litigio","livrea","locanda","lode","logica","lombare","londra","longevo","loquace","lorenzo","loto","lotteria","luce","lucidato","lumaca","luminoso","lungo","lupo","luppolo","lusinga","lusso","lutto","macabro","macchina","macero","macinato","madama","magico","maglia","magnete","magro","maiolica","malafede","malgrado","malinteso","malsano","malto","malumore","mana","mancia","mandorla","mangiare","manifesto","mannaro","manovra","mansarda","mantide","manubrio","mappa","maratona","marcire","maretta","marmo","marsupio","maschera","massaia","mastino","materasso","matricola","mattone","maturo","mazurca","meandro","meccanico","mecenate","medesimo","meditare","mega","melassa","melis","melodia","meninge","meno","mensola","mercurio","merenda","merlo","meschino","mese","messere","mestolo","metallo","metodo","mettere","miagolare","mica","micelio","michele","microbo","midollo","miele","migliore","milano","milite","mimosa","minerale","mini","minore","mirino","mirtillo","miscela","missiva","misto","misurare","mitezza","mitigare","mitra","mittente","mnemonico","modello","modifica","modulo","mogano","mogio","mole","molosso","monastero","monco","mondina","monetario","monile","monotono","monsone","montato","monviso","mora","mordere","morsicato","mostro","motivato","motosega","motto","movenza","movimento","mozzo","mucca","mucosa","muffa","mughetto","mugnaio","mulatto","mulinello","multiplo","mummia","munto","muovere","murale","musa","muscolo","musica","mutevole","muto","nababbo","nafta","nanometro","narciso","narice","narrato","nascere","nastrare","naturale","nautica","naviglio","nebulosa","necrosi","negativo","negozio","nemmeno","neofita","neretto","nervo","nessuno","nettuno","neutrale","neve","nevrotico","nicchia","ninfa","nitido","nobile","nocivo","nodo","nome","nomina","nordico","normale","norvegese","nostrano","notare","notizia","notturno","novella","nucleo","nulla","numero","nuovo","nutrire","nuvola","nuziale","oasi","obbedire","obbligo","obelisco","oblio","obolo","obsoleto","occasione","occhio","occidente","occorrere","occultare","ocra","oculato","odierno","odorare","offerta","offrire","offuscato","oggetto","oggi","ognuno","olandese","olfatto","oliato","oliva","ologramma","oltre","omaggio","ombelico","ombra","omega","omissione","ondoso","onere","onice","onnivoro","onorevole","onta","operato","opinione","opposto","oracolo","orafo","ordine","orecchino","orefice","orfano","organico","origine","orizzonte","orma","ormeggio","ornativo","orologio","orrendo","orribile","ortensia","ortica","orzata","orzo","osare","oscurare","osmosi","ospedale","ospite","ossa","ossidare","ostacolo","oste","otite","otre","ottagono","ottimo","ottobre","ovale","ovest","ovino","oviparo","ovocito","ovunque","ovviare","ozio","pacchetto","pace","pacifico","padella","padrone","paese","paga","pagina","palazzina","palesare","pallido","palo","palude","pandoro","pannello","paolo","paonazzo","paprica","parabola","parcella","parere","pargolo","pari","parlato","parola","partire","parvenza","parziale","passivo","pasticca","patacca","patologia","pattume","pavone","peccato","pedalare","pedonale","peggio","peloso","penare","pendice","penisola","pennuto","penombra","pensare","pentola","pepe","pepita","perbene","percorso","perdonato","perforare","pergamena","periodo","permesso","perno","perplesso","persuaso","pertugio","pervaso","pesatore","pesista","peso","pestifero","petalo","pettine","petulante","pezzo","piacere","pianta","piattino","piccino","picozza","piega","pietra","piffero","pigiama","pigolio","pigro","pila","pilifero","pillola","pilota","pimpante","pineta","pinna","pinolo","pioggia","piombo","piramide","piretico","pirite","pirolisi","pitone","pizzico","placebo","planare","plasma","platano","plenario","pochezza","poderoso","podismo","poesia","poggiare","polenta","poligono","pollice","polmonite","polpetta","polso","poltrona","polvere","pomice","pomodoro","ponte","popoloso","porfido","poroso","porpora","porre","portata","posa","positivo","possesso","postulato","potassio","potere","pranzo","prassi","pratica","precluso","predica","prefisso","pregiato","prelievo","premere","prenotare","preparato","presenza","pretesto","prevalso","prima","principe","privato","problema","procura","produrre","profumo","progetto","prolunga","promessa","pronome","proposta","proroga","proteso","prova","prudente","prugna","prurito","psiche","pubblico","pudica","pugilato","pugno","pulce","pulito","pulsante","puntare","pupazzo","pupilla","puro","quadro","qualcosa","quasi","querela","quota","raccolto","raddoppio","radicale","radunato","raffica","ragazzo","ragione","ragno","ramarro","ramingo","ramo","randagio","rantolare","rapato","rapina","rappreso","rasatura","raschiato","rasente","rassegna","rastrello","rata","ravveduto","reale","recepire","recinto","recluta","recondito","recupero","reddito","redimere","regalato","registro","regola","regresso","relazione","remare","remoto","renna","replica","reprimere","reputare","resa","residente","responso","restauro","rete","retina","retorica","rettifica","revocato","riassunto","ribadire","ribelle","ribrezzo","ricarica","ricco","ricevere","riciclato","ricordo","ricreduto","ridicolo","ridurre","rifasare","riflesso","riforma","rifugio","rigare","rigettato","righello","rilassato","rilevato","rimanere","rimbalzo","rimedio","rimorchio","rinascita","rincaro","rinforzo","rinnovo","rinomato","rinsavito","rintocco","rinuncia","rinvenire","riparato","ripetuto","ripieno","riportare","ripresa","ripulire","risata","rischio","riserva","risibile","riso","rispetto","ristoro","risultato","risvolto","ritardo","ritegno","ritmico","ritrovo","riunione","riva","riverso","rivincita","rivolto","rizoma","roba","robotico","robusto","roccia","roco","rodaggio","rodere","roditore","rogito","rollio","romantico","rompere","ronzio","rosolare","rospo","rotante","rotondo","rotula","rovescio","rubizzo","rubrica","ruga","rullino","rumine","rumoroso","ruolo","rupe","russare","rustico","sabato","sabbiare","sabotato","sagoma","salasso","saldatura","salgemma","salivare","salmone","salone","saltare","saluto","salvo","sapere","sapido","saporito","saraceno","sarcasmo","sarto","sassoso","satellite","satira","satollo","saturno","savana","savio","saziato","sbadiglio","sbalzo","sbancato","sbarra","sbattere","sbavare","sbendare","sbirciare","sbloccato","sbocciato","sbrinare","sbruffone","sbuffare","scabroso","scadenza","scala","scambiare","scandalo","scapola","scarso","scatenare","scavato","scelto","scenico","scettro","scheda","schiena","sciarpa","scienza","scindere","scippo","sciroppo","scivolo","sclerare","scodella","scolpito","scomparto","sconforto","scoprire","scorta","scossone","scozzese","scriba","scrollare","scrutinio","scuderia","scultore","scuola","scuro","scusare","sdebitare","sdoganare","seccatura","secondo","sedano","seggiola","segnalato","segregato","seguito","selciato","selettivo","sella","selvaggio","semaforo","sembrare","seme","seminato","sempre","senso","sentire","sepolto","sequenza","serata","serbato","sereno","serio","serpente","serraglio","servire","sestina","setola","settimana","sfacelo","sfaldare","sfamato","sfarzoso","sfaticato","sfera","sfida","sfilato","sfinge","sfocato","sfoderare","sfogo","sfoltire","sforzato","sfratto","sfruttato","sfuggito","sfumare","sfuso","sgabello","sgarbato","sgonfiare","sgorbio","sgrassato","sguardo","sibilo","siccome","sierra","sigla","signore","silenzio","sillaba","simbolo","simpatico","simulato","sinfonia","singolo","sinistro","sino","sintesi","sinusoide","sipario","sisma","sistole","situato","slitta","slogatura","sloveno","smarrito","smemorato","smentito","smeraldo","smilzo","smontare","smottato","smussato","snellire","snervato","snodo","sobbalzo","sobrio","soccorso","sociale","sodale","soffitto","sogno","soldato","solenne","solido","sollazzo","solo","solubile","solvente","somatico","somma","sonda","sonetto","sonnifero","sopire","soppeso","sopra","sorgere","sorpasso","sorriso","sorso","sorteggio","sorvolato","sospiro","sosta","sottile","spada","spalla","spargere","spatola","spavento","spazzola","specie","spedire","spegnere","spelatura","speranza","spessore","spettrale","spezzato","spia","spigoloso","spillato","spinoso","spirale","splendido","sportivo","sposo","spranga","sprecare","spronato","spruzzo","spuntino","squillo","sradicare","srotolato","stabile","stacco","staffa","stagnare","stampato","stantio","starnuto","stasera","statuto","stelo","steppa","sterzo","stiletto","stima","stirpe","stivale","stizzoso","stonato","storico","strappo","stregato","stridulo","strozzare","strutto","stuccare","stufo","stupendo","subentro","succoso","sudore","suggerito","sugo","sultano","suonare","superbo","supporto","surgelato","surrogato","sussurro","sutura","svagare","svedese","sveglio","svelare","svenuto","svezia","sviluppo","svista","svizzera","svolta","svuotare","tabacco","tabulato","tacciare","taciturno","tale","talismano","tampone","tannino","tara","tardivo","targato","tariffa","tarpare","tartaruga","tasto","tattico","taverna","tavolata","tazza","teca","tecnico","telefono","temerario","tempo","temuto","tendone","tenero","tensione","tentacolo","teorema","terme","terrazzo","terzetto","tesi","tesserato","testato","tetro","tettoia","tifare","tigella","timbro","tinto","tipico","tipografo","tiraggio","tiro","titanio","titolo","titubante","tizio","tizzone","toccare","tollerare","tolto","tombola","tomo","tonfo","tonsilla","topazio","topologia","toppa","torba","tornare","torrone","tortora","toscano","tossire","tostatura","totano","trabocco","trachea","trafila","tragedia","tralcio","tramonto","transito","trapano","trarre","trasloco","trattato","trave","treccia","tremolio","trespolo","tributo","tricheco","trifoglio","trillo","trincea","trio","tristezza","triturato","trivella","tromba","trono","troppo","trottola","trovare","truccato","tubatura","tuffato","tulipano","tumulto","tunisia","turbare","turchino","tuta","tutela","ubicato","uccello","uccisore","udire","uditivo","uffa","ufficio","uguale","ulisse","ultimato","umano","umile","umorismo","uncinetto","ungere","ungherese","unicorno","unificato","unisono","unitario","unte","uovo","upupa","uragano","urgenza","urlo","usanza","usato","uscito","usignolo","usuraio","utensile","utilizzo","utopia","vacante","vaccinato","vagabondo","vagliato","valanga","valgo","valico","valletta","valoroso","valutare","valvola","vampata","vangare","vanitoso","vano","vantaggio","vanvera","vapore","varano","varcato","variante","vasca","vedetta","vedova","veduto","vegetale","veicolo","velcro","velina","velluto","veloce","venato","vendemmia","vento","verace","verbale","vergogna","verifica","vero","verruca","verticale","vescica","vessillo","vestale","veterano","vetrina","vetusto","viandante","vibrante","vicenda","vichingo","vicinanza","vidimare","vigilia","vigneto","vigore","vile","villano","vimini","vincitore","viola","vipera","virgola","virologo","virulento","viscoso","visione","vispo","vissuto","visura","vita","vitello","vittima","vivanda","vivido","viziare","voce","voga","volatile","volere","volpe","voragine","vulcano","zampogna","zanna","zappato","zattera","zavorra","zefiro","zelante","zelo","zenzero","zerbino","zibetto","zinco","zircone","zitto","zolla","zotico","zucchero","zufolo","zulu","zuppa"]'),require$$6$1=JSON.parse('["abaco","abdomen","abeja","abierto","abogado","abono","aborto","abrazo","abrir","abuelo","abuso","acabar","academia","acceso","accion","aceite","acelga","acento","aceptar","acido","aclarar","acne","acoger","acoso","activo","acto","actriz","actuar","acudir","acuerdo","acusar","adicto","admitir","adoptar","adorno","aduana","adulto","aereo","afectar","aficion","afinar","afirmar","agil","agitar","agonia","agosto","agotar","agregar","agrio","agua","agudo","aguila","aguja","ahogo","ahorro","aire","aislar","ajedrez","ajeno","ajuste","alacran","alambre","alarma","alba","album","alcalde","aldea","alegre","alejar","alerta","aleta","alfiler","alga","algodon","aliado","aliento","alivio","alma","almeja","almibar","altar","alteza","altivo","alto","altura","alumno","alzar","amable","amante","amapola","amargo","amasar","ambar","ambito","ameno","amigo","amistad","amor","amparo","amplio","ancho","anciano","ancla","andar","anden","anemia","angulo","anillo","animo","anis","anotar","antena","antiguo","antojo","anual","anular","anuncio","anadir","anejo","ano","apagar","aparato","apetito","apio","aplicar","apodo","aporte","apoyo","aprender","aprobar","apuesta","apuro","arado","arana","arar","arbitro","arbol","arbusto","archivo","arco","arder","ardilla","arduo","area","arido","aries","armonia","arnes","aroma","arpa","arpon","arreglo","arroz","arruga","arte","artista","asa","asado","asalto","ascenso","asegurar","aseo","asesor","asiento","asilo","asistir","asno","asombro","aspero","astilla","astro","astuto","asumir","asunto","atajo","ataque","atar","atento","ateo","atico","atleta","atomo","atraer","atroz","atun","audaz","audio","auge","aula","aumento","ausente","autor","aval","avance","avaro","ave","avellana","avena","avestruz","avion","aviso","ayer","ayuda","ayuno","azafran","azar","azote","azucar","azufre","azul","baba","babor","bache","bahia","baile","bajar","balanza","balcon","balde","bambu","banco","banda","bano","barba","barco","barniz","barro","bascula","baston","basura","batalla","bateria","batir","batuta","baul","bazar","bebe","bebida","bello","besar","beso","bestia","bicho","bien","bingo","blanco","bloque","blusa","boa","bobina","bobo","boca","bocina","boda","bodega","boina","bola","bolero","bolsa","bomba","bondad","bonito","bono","bonsai","borde","borrar","bosque","bote","botin","boveda","bozal","bravo","brazo","brecha","breve","brillo","brinco","brisa","broca","broma","bronce","brote","bruja","brusco","bruto","buceo","bucle","bueno","buey","bufanda","bufon","buho","buitre","bulto","burbuja","burla","burro","buscar","butaca","buzon","caballo","cabeza","cabina","cabra","cacao","cadaver","cadena","caer","cafe","caida","caiman","caja","cajon","cal","calamar","calcio","caldo","calidad","calle","calma","calor","calvo","cama","cambio","camello","camino","campo","cancer","candil","canela","canguro","canica","canto","cana","canon","caoba","caos","capaz","capitan","capote","captar","capucha","cara","carbon","carcel","careta","carga","carino","carne","carpeta","carro","carta","casa","casco","casero","caspa","castor","catorce","catre","caudal","causa","cazo","cebolla","ceder","cedro","celda","celebre","celoso","celula","cemento","ceniza","centro","cerca","cerdo","cereza","cero","cerrar","certeza","cesped","cetro","chacal","chaleco","champu","chancla","chapa","charla","chico","chiste","chivo","choque","choza","chuleta","chupar","ciclon","ciego","cielo","cien","cierto","cifra","cigarro","cima","cinco","cine","cinta","cipres","circo","ciruela","cisne","cita","ciudad","clamor","clan","claro","clase","clave","cliente","clima","clinica","cobre","coccion","cochino","cocina","coco","codigo","codo","cofre","coger","cohete","cojin","cojo","cola","colcha","colegio","colgar","colina","collar","colmo","columna","combate","comer","comida","comodo","compra","conde","conejo","conga","conocer","consejo","contar","copa","copia","corazon","corbata","corcho","cordon","corona","correr","coser","cosmos","costa","craneo","crater","crear","crecer","creido","crema","cria","crimen","cripta","crisis","cromo","cronica","croqueta","crudo","cruz","cuadro","cuarto","cuatro","cubo","cubrir","cuchara","cuello","cuento","cuerda","cuesta","cueva","cuidar","culebra","culpa","culto","cumbre","cumplir","cuna","cuneta","cuota","cupon","cupula","curar","curioso","curso","curva","cutis","dama","danza","dar","dardo","datil","deber","debil","decada","decir","dedo","defensa","definir","dejar","delfin","delgado","delito","demora","denso","dental","deporte","derecho","derrota","desayuno","deseo","desfile","desnudo","destino","desvio","detalle","detener","deuda","dia","diablo","diadema","diamante","diana","diario","dibujo","dictar","diente","dieta","diez","dificil","digno","dilema","diluir","dinero","directo","dirigir","disco","diseno","disfraz","diva","divino","doble","doce","dolor","domingo","don","donar","dorado","dormir","dorso","dos","dosis","dragon","droga","ducha","duda","duelo","dueno","dulce","duo","duque","durar","dureza","duro","ebano","ebrio","echar","eco","ecuador","edad","edicion","edificio","editor","educar","efecto","eficaz","eje","ejemplo","elefante","elegir","elemento","elevar","elipse","elite","elixir","elogio","eludir","embudo","emitir","emocion","empate","empeno","empleo","empresa","enano","encargo","enchufe","encia","enemigo","enero","enfado","enfermo","engano","enigma","enlace","enorme","enredo","ensayo","ensenar","entero","entrar","envase","envio","epoca","equipo","erizo","escala","escena","escolar","escribir","escudo","esencia","esfera","esfuerzo","espada","espejo","espia","esposa","espuma","esqui","estar","este","estilo","estufa","etapa","eterno","etica","etnia","evadir","evaluar","evento","evitar","exacto","examen","exceso","excusa","exento","exigir","exilio","existir","exito","experto","explicar","exponer","extremo","fabrica","fabula","fachada","facil","factor","faena","faja","falda","fallo","falso","faltar","fama","familia","famoso","faraon","farmacia","farol","farsa","fase","fatiga","fauna","favor","fax","febrero","fecha","feliz","feo","feria","feroz","fertil","fervor","festin","fiable","fianza","fiar","fibra","ficcion","ficha","fideo","fiebre","fiel","fiera","fiesta","figura","fijar","fijo","fila","filete","filial","filtro","fin","finca","fingir","finito","firma","flaco","flauta","flecha","flor","flota","fluir","flujo","fluor","fobia","foca","fogata","fogon","folio","folleto","fondo","forma","forro","fortuna","forzar","fosa","foto","fracaso","fragil","franja","frase","fraude","freir","freno","fresa","frio","frito","fruta","fuego","fuente","fuerza","fuga","fumar","funcion","funda","furgon","furia","fusil","futbol","futuro","gacela","gafas","gaita","gajo","gala","galeria","gallo","gamba","ganar","gancho","ganga","ganso","garaje","garza","gasolina","gastar","gato","gavilan","gemelo","gemir","gen","genero","genio","gente","geranio","gerente","germen","gesto","gigante","gimnasio","girar","giro","glaciar","globo","gloria","gol","golfo","goloso","golpe","goma","gordo","gorila","gorra","gota","goteo","gozar","grada","grafico","grano","grasa","gratis","grave","grieta","grillo","gripe","gris","grito","grosor","grua","grueso","grumo","grupo","guante","guapo","guardia","guerra","guia","guino","guion","guiso","guitarra","gusano","gustar","haber","habil","hablar","hacer","hacha","hada","hallar","hamaca","harina","haz","hazana","hebilla","hebra","hecho","helado","helio","hembra","herir","hermano","heroe","hervir","hielo","hierro","higado","higiene","hijo","himno","historia","hocico","hogar","hoguera","hoja","hombre","hongo","honor","honra","hora","hormiga","horno","hostil","hoyo","hueco","huelga","huerta","hueso","huevo","huida","huir","humano","humedo","humilde","humo","hundir","huracan","hurto","icono","ideal","idioma","idolo","iglesia","iglu","igual","ilegal","ilusion","imagen","iman","imitar","impar","imperio","imponer","impulso","incapaz","indice","inerte","infiel","informe","ingenio","inicio","inmenso","inmune","innato","insecto","instante","interes","intimo","intuir","inutil","invierno","ira","iris","ironia","isla","islote","jabali","jabon","jamon","jarabe","jardin","jarra","jaula","jazmin","jefe","jeringa","jinete","jornada","joroba","joven","joya","juerga","jueves","juez","jugador","jugo","juguete","juicio","junco","jungla","junio","juntar","jupiter","jurar","justo","juvenil","juzgar","kilo","koala","labio","lacio","lacra","lado","ladron","lagarto","lagrima","laguna","laico","lamer","lamina","lampara","lana","lancha","langosta","lanza","lapiz","largo","larva","lastima","lata","latex","latir","laurel","lavar","lazo","leal","leccion","leche","lector","leer","legion","legumbre","lejano","lengua","lento","lena","leon","leopardo","lesion","letal","letra","leve","leyenda","libertad","libro","licor","lider","lidiar","lienzo","liga","ligero","lima","limite","limon","limpio","lince","lindo","linea","lingote","lino","linterna","liquido","liso","lista","litera","litio","litro","llaga","llama","llanto","llave","llegar","llenar","llevar","llorar","llover","lluvia","lobo","locion","loco","locura","logica","logro","lombriz","lomo","lonja","lote","lucha","lucir","lugar","lujo","luna","lunes","lupa","lustro","luto","luz","maceta","macho","madera","madre","maduro","maestro","mafia","magia","mago","maiz","maldad","maleta","malla","malo","mama","mambo","mamut","manco","mando","manejar","manga","maniqui","manjar","mano","manso","manta","manana","mapa","maquina","mar","marco","marea","marfil","margen","marido","marmol","marron","martes","marzo","masa","mascara","masivo","matar","materia","matiz","matriz","maximo","mayor","mazorca","mecha","medalla","medio","medula","mejilla","mejor","melena","melon","memoria","menor","mensaje","mente","menu","mercado","merengue","merito","mes","meson","meta","meter","metodo","metro","mezcla","miedo","miel","miembro","miga","mil","milagro","militar","millon","mimo","mina","minero","minimo","minuto","miope","mirar","misa","miseria","misil","mismo","mitad","mito","mochila","mocion","moda","modelo","moho","mojar","molde","moler","molino","momento","momia","monarca","moneda","monja","monto","mono","morada","morder","moreno","morir","morro","morsa","mortal","mosca","mostrar","motivo","mover","movil","mozo","mucho","mudar","mueble","muela","muerte","muestra","mugre","mujer","mula","muleta","multa","mundo","muneca","mural","muro","musculo","museo","musgo","musica","muslo","nacar","nacion","nadar","naipe","naranja","nariz","narrar","nasal","natal","nativo","natural","nausea","naval","nave","navidad","necio","nectar","negar","negocio","negro","neon","nervio","neto","neutro","nevar","nevera","nicho","nido","niebla","nieto","ninez","nino","nitido","nivel","nobleza","noche","nomina","noria","norma","norte","nota","noticia","novato","novela","novio","nube","nuca","nucleo","nudillo","nudo","nuera","nueve","nuez","nulo","numero","nutria","oasis","obeso","obispo","objeto","obra","obrero","observar","obtener","obvio","oca","ocaso","oceano","ochenta","ocho","ocio","ocre","octavo","octubre","oculto","ocupar","ocurrir","odiar","odio","odisea","oeste","ofensa","oferta","oficio","ofrecer","ogro","oido","oir","ojo","ola","oleada","olfato","olivo","olla","olmo","olor","olvido","ombligo","onda","onza","opaco","opcion","opera","opinar","oponer","optar","optica","opuesto","oracion","orador","oral","orbita","orca","orden","oreja","organo","orgia","orgullo","oriente","origen","orilla","oro","orquesta","oruga","osadia","oscuro","osezno","oso","ostra","otono","otro","oveja","ovulo","oxido","oxigeno","oyente","ozono","pacto","padre","paella","pagina","pago","pais","pajaro","palabra","palco","paleta","palido","palma","paloma","palpar","pan","panal","panico","pantera","panuelo","papa","papel","papilla","paquete","parar","parcela","pared","parir","paro","parpado","parque","parrafo","parte","pasar","paseo","pasion","paso","pasta","pata","patio","patria","pausa","pauta","pavo","payaso","peaton","pecado","pecera","pecho","pedal","pedir","pegar","peine","pelar","peldano","pelea","peligro","pellejo","pelo","peluca","pena","pensar","penon","peon","peor","pepino","pequeno","pera","percha","perder","pereza","perfil","perico","perla","permiso","perro","persona","pesa","pesca","pesimo","pestana","petalo","petroleo","pez","pezuna","picar","pichon","pie","piedra","pierna","pieza","pijama","pilar","piloto","pimienta","pino","pintor","pinza","pina","piojo","pipa","pirata","pisar","piscina","piso","pista","piton","pizca","placa","plan","plata","playa","plaza","pleito","pleno","plomo","pluma","plural","pobre","poco","poder","podio","poema","poesia","poeta","polen","policia","pollo","polvo","pomada","pomelo","pomo","pompa","poner","porcion","portal","posada","poseer","posible","poste","potencia","potro","pozo","prado","precoz","pregunta","premio","prensa","preso","previo","primo","principe","prision","privar","proa","probar","proceso","producto","proeza","profesor","programa","prole","promesa","pronto","propio","proximo","prueba","publico","puchero","pudor","pueblo","puerta","puesto","pulga","pulir","pulmon","pulpo","pulso","puma","punto","punal","puno","pupa","pupila","pure","quedar","queja","quemar","querer","queso","quieto","quimica","quince","quitar","rabano","rabia","rabo","racion","radical","raiz","rama","rampa","rancho","rango","rapaz","rapido","rapto","rasgo","raspa","rato","rayo","raza","razon","reaccion","realidad","rebano","rebote","recaer","receta","rechazo","recoger","recreo","recto","recurso","red","redondo","reducir","reflejo","reforma","refran","refugio","regalo","regir","regla","regreso","rehen","reino","reir","reja","relato","relevo","relieve","relleno","reloj","remar","remedio","remo","rencor","rendir","renta","reparto","repetir","reposo","reptil","res","rescate","resina","respeto","resto","resumen","retiro","retorno","retrato","reunir","reves","revista","rey","rezar","rico","riego","rienda","riesgo","rifa","rigido","rigor","rincon","rinon","rio","riqueza","risa","ritmo","rito","rizo","roble","roce","rociar","rodar","rodeo","rodilla","roer","rojizo","rojo","romero","romper","ron","ronco","ronda","ropa","ropero","rosa","rosca","rostro","rotar","rubi","rubor","rudo","rueda","rugir","ruido","ruina","ruleta","rulo","rumbo","rumor","ruptura","ruta","rutina","sabado","saber","sabio","sable","sacar","sagaz","sagrado","sala","saldo","salero","salir","salmon","salon","salsa","salto","salud","salvar","samba","sancion","sandia","sanear","sangre","sanidad","sano","santo","sapo","saque","sardina","sarten","sastre","satan","sauna","saxofon","seccion","seco","secreto","secta","sed","seguir","seis","sello","selva","semana","semilla","senda","sensor","senal","senor","separar","sepia","sequia","ser","serie","sermon","servir","sesenta","sesion","seta","setenta","severo","sexo","sexto","sidra","siesta","siete","siglo","signo","silaba","silbar","silencio","silla","simbolo","simio","sirena","sistema","sitio","situar","sobre","socio","sodio","sol","solapa","soldado","soledad","solido","soltar","solucion","sombra","sondeo","sonido","sonoro","sonrisa","sopa","soplar","soporte","sordo","sorpresa","sorteo","sosten","sotano","suave","subir","suceso","sudor","suegra","suelo","sueno","suerte","sufrir","sujeto","sultan","sumar","superar","suplir","suponer","supremo","sur","surco","sureno","surgir","susto","sutil","tabaco","tabique","tabla","tabu","taco","tacto","tajo","talar","talco","talento","talla","talon","tamano","tambor","tango","tanque","tapa","tapete","tapia","tapon","taquilla","tarde","tarea","tarifa","tarjeta","tarot","tarro","tarta","tatuaje","tauro","taza","tazon","teatro","techo","tecla","tecnica","tejado","tejer","tejido","tela","telefono","tema","temor","templo","tenaz","tender","tener","tenis","tenso","teoria","terapia","terco","termino","ternura","terror","tesis","tesoro","testigo","tetera","texto","tez","tibio","tiburon","tiempo","tienda","tierra","tieso","tigre","tijera","tilde","timbre","timido","timo","tinta","tio","tipico","tipo","tira","tiron","titan","titere","titulo","tiza","toalla","tobillo","tocar","tocino","todo","toga","toldo","tomar","tono","tonto","topar","tope","toque","torax","torero","tormenta","torneo","toro","torpedo","torre","torso","tortuga","tos","tosco","toser","toxico","trabajo","tractor","traer","trafico","trago","traje","tramo","trance","trato","trauma","trazar","trebol","tregua","treinta","tren","trepar","tres","tribu","trigo","tripa","triste","triunfo","trofeo","trompa","tronco","tropa","trote","trozo","truco","trueno","trufa","tuberia","tubo","tuerto","tumba","tumor","tunel","tunica","turbina","turismo","turno","tutor","ubicar","ulcera","umbral","unidad","unir","universo","uno","untar","una","urbano","urbe","urgente","urna","usar","usuario","util","utopia","uva","vaca","vacio","vacuna","vagar","vago","vaina","vajilla","vale","valido","valle","valor","valvula","vampiro","vara","variar","varon","vaso","vecino","vector","vehiculo","veinte","vejez","vela","velero","veloz","vena","vencer","venda","veneno","vengar","venir","venta","venus","ver","verano","verbo","verde","vereda","verja","verso","verter","via","viaje","vibrar","vicio","victima","vida","video","vidrio","viejo","viernes","vigor","vil","villa","vinagre","vino","vinedo","violin","viral","virgo","virtud","visor","vispera","vista","vitamina","viudo","vivaz","vivero","vivir","vivo","volcan","volumen","volver","voraz","votar","voto","voz","vuelo","vulgar","yacer","yate","yegua","yema","yerno","yeso","yodo","yoga","yogur","zafiro","zanja","zapato","zarza","zona","zorro","zumo","zurdo"]'),require$$7=JSON.parse('["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]'),require$$8=JSON.parse('["abacate","abaixo","abalar","abater","abduzir","abelha","aberto","abismo","abotoar","abranger","abreviar","abrigar","abrupto","absinto","absoluto","absurdo","abutre","acabado","acalmar","acampar","acanhar","acaso","aceitar","acelerar","acenar","acervo","acessar","acetona","achatar","acidez","acima","acionado","acirrar","aclamar","aclive","acolhida","acomodar","acoplar","acordar","acumular","acusador","adaptar","adega","adentro","adepto","adequar","aderente","adesivo","adeus","adiante","aditivo","adjetivo","adjunto","admirar","adorar","adquirir","adubo","adverso","advogado","aeronave","afastar","aferir","afetivo","afinador","afivelar","aflito","afluente","afrontar","agachar","agarrar","agasalho","agenciar","agilizar","agiota","agitado","agora","agradar","agreste","agrupar","aguardar","agulha","ajoelhar","ajudar","ajustar","alameda","alarme","alastrar","alavanca","albergue","albino","alcatra","aldeia","alecrim","alegria","alertar","alface","alfinete","algum","alheio","aliar","alicate","alienar","alinhar","aliviar","almofada","alocar","alpiste","alterar","altitude","alucinar","alugar","aluno","alusivo","alvo","amaciar","amador","amarelo","amassar","ambas","ambiente","ameixa","amenizar","amido","amistoso","amizade","amolador","amontoar","amoroso","amostra","amparar","ampliar","ampola","anagrama","analisar","anarquia","anatomia","andaime","anel","anexo","angular","animar","anjo","anomalia","anotado","ansioso","anterior","anuidade","anunciar","anzol","apagador","apalpar","apanhado","apego","apelido","apertada","apesar","apetite","apito","aplauso","aplicada","apoio","apontar","aposta","aprendiz","aprovar","aquecer","arame","aranha","arara","arcada","ardente","areia","arejar","arenito","aresta","argiloso","argola","arma","arquivo","arraial","arrebate","arriscar","arroba","arrumar","arsenal","arterial","artigo","arvoredo","asfaltar","asilado","aspirar","assador","assinar","assoalho","assunto","astral","atacado","atadura","atalho","atarefar","atear","atender","aterro","ateu","atingir","atirador","ativo","atoleiro","atracar","atrevido","atriz","atual","atum","auditor","aumentar","aura","aurora","autismo","autoria","autuar","avaliar","avante","avaria","avental","avesso","aviador","avisar","avulso","axila","azarar","azedo","azeite","azulejo","babar","babosa","bacalhau","bacharel","bacia","bagagem","baiano","bailar","baioneta","bairro","baixista","bajular","baleia","baliza","balsa","banal","bandeira","banho","banir","banquete","barato","barbado","baronesa","barraca","barulho","baseado","bastante","batata","batedor","batida","batom","batucar","baunilha","beber","beijo","beirada","beisebol","beldade","beleza","belga","beliscar","bendito","bengala","benzer","berimbau","berlinda","berro","besouro","bexiga","bezerro","bico","bicudo","bienal","bifocal","bifurcar","bigorna","bilhete","bimestre","bimotor","biologia","biombo","biosfera","bipolar","birrento","biscoito","bisneto","bispo","bissexto","bitola","bizarro","blindado","bloco","bloquear","boato","bobagem","bocado","bocejo","bochecha","boicotar","bolada","boletim","bolha","bolo","bombeiro","bonde","boneco","bonita","borbulha","borda","boreal","borracha","bovino","boxeador","branco","brasa","braveza","breu","briga","brilho","brincar","broa","brochura","bronzear","broto","bruxo","bucha","budismo","bufar","bule","buraco","busca","busto","buzina","cabana","cabelo","cabide","cabo","cabrito","cacau","cacetada","cachorro","cacique","cadastro","cadeado","cafezal","caiaque","caipira","caixote","cajado","caju","calafrio","calcular","caldeira","calibrar","calmante","calota","camada","cambista","camisa","camomila","campanha","camuflar","canavial","cancelar","caneta","canguru","canhoto","canivete","canoa","cansado","cantar","canudo","capacho","capela","capinar","capotar","capricho","captador","capuz","caracol","carbono","cardeal","careca","carimbar","carneiro","carpete","carreira","cartaz","carvalho","casaco","casca","casebre","castelo","casulo","catarata","cativar","caule","causador","cautelar","cavalo","caverna","cebola","cedilha","cegonha","celebrar","celular","cenoura","censo","centeio","cercar","cerrado","certeiro","cerveja","cetim","cevada","chacota","chaleira","chamado","chapada","charme","chatice","chave","chefe","chegada","cheiro","cheque","chicote","chifre","chinelo","chocalho","chover","chumbo","chutar","chuva","cicatriz","ciclone","cidade","cidreira","ciente","cigana","cimento","cinto","cinza","ciranda","circuito","cirurgia","citar","clareza","clero","clicar","clone","clube","coado","coagir","cobaia","cobertor","cobrar","cocada","coelho","coentro","coeso","cogumelo","coibir","coifa","coiote","colar","coleira","colher","colidir","colmeia","colono","coluna","comando","combinar","comentar","comitiva","comover","complexo","comum","concha","condor","conectar","confuso","congelar","conhecer","conjugar","consumir","contrato","convite","cooperar","copeiro","copiador","copo","coquetel","coragem","cordial","corneta","coronha","corporal","correio","cortejo","coruja","corvo","cosseno","costela","cotonete","couro","couve","covil","cozinha","cratera","cravo","creche","credor","creme","crer","crespo","criada","criminal","crioulo","crise","criticar","crosta","crua","cruzeiro","cubano","cueca","cuidado","cujo","culatra","culminar","culpar","cultura","cumprir","cunhado","cupido","curativo","curral","cursar","curto","cuspir","custear","cutelo","damasco","datar","debater","debitar","deboche","debulhar","decalque","decimal","declive","decote","decretar","dedal","dedicado","deduzir","defesa","defumar","degelo","degrau","degustar","deitado","deixar","delator","delegado","delinear","delonga","demanda","demitir","demolido","dentista","depenado","depilar","depois","depressa","depurar","deriva","derramar","desafio","desbotar","descanso","desenho","desfiado","desgaste","desigual","deslize","desmamar","desova","despesa","destaque","desviar","detalhar","detentor","detonar","detrito","deusa","dever","devido","devotado","dezena","diagrama","dialeto","didata","difuso","digitar","dilatado","diluente","diminuir","dinastia","dinheiro","diocese","direto","discreta","disfarce","disparo","disquete","dissipar","distante","ditador","diurno","diverso","divisor","divulgar","dizer","dobrador","dolorido","domador","dominado","donativo","donzela","dormente","dorsal","dosagem","dourado","doutor","drenagem","drible","drogaria","duelar","duende","dueto","duplo","duquesa","durante","duvidoso","eclodir","ecoar","ecologia","edificar","edital","educado","efeito","efetivar","ejetar","elaborar","eleger","eleitor","elenco","elevador","eliminar","elogiar","embargo","embolado","embrulho","embutido","emenda","emergir","emissor","empatia","empenho","empinado","empolgar","emprego","empurrar","emulador","encaixe","encenado","enchente","encontro","endeusar","endossar","enfaixar","enfeite","enfim","engajado","engenho","englobar","engomado","engraxar","enguia","enjoar","enlatar","enquanto","enraizar","enrolado","enrugar","ensaio","enseada","ensino","ensopado","entanto","enteado","entidade","entortar","entrada","entulho","envergar","enviado","envolver","enxame","enxerto","enxofre","enxuto","epiderme","equipar","ereto","erguido","errata","erva","ervilha","esbanjar","esbelto","escama","escola","escrita","escuta","esfinge","esfolar","esfregar","esfumado","esgrima","esmalte","espanto","espelho","espiga","esponja","espreita","espumar","esquerda","estaca","esteira","esticar","estofado","estrela","estudo","esvaziar","etanol","etiqueta","euforia","europeu","evacuar","evaporar","evasivo","eventual","evidente","evoluir","exagero","exalar","examinar","exato","exausto","excesso","excitar","exclamar","executar","exemplo","exibir","exigente","exonerar","expandir","expelir","expirar","explanar","exposto","expresso","expulsar","externo","extinto","extrato","fabricar","fabuloso","faceta","facial","fada","fadiga","faixa","falar","falta","familiar","fandango","fanfarra","fantoche","fardado","farelo","farinha","farofa","farpa","fartura","fatia","fator","favorita","faxina","fazenda","fechado","feijoada","feirante","felino","feminino","fenda","feno","fera","feriado","ferrugem","ferver","festejar","fetal","feudal","fiapo","fibrose","ficar","ficheiro","figurado","fileira","filho","filme","filtrar","firmeza","fisgada","fissura","fita","fivela","fixador","fixo","flacidez","flamingo","flanela","flechada","flora","flutuar","fluxo","focal","focinho","fofocar","fogo","foguete","foice","folgado","folheto","forjar","formiga","forno","forte","fosco","fossa","fragata","fralda","frango","frasco","fraterno","freira","frente","fretar","frieza","friso","fritura","fronha","frustrar","fruteira","fugir","fulano","fuligem","fundar","fungo","funil","furador","furioso","futebol","gabarito","gabinete","gado","gaiato","gaiola","gaivota","galega","galho","galinha","galocha","ganhar","garagem","garfo","gargalo","garimpo","garoupa","garrafa","gasoduto","gasto","gata","gatilho","gaveta","gazela","gelado","geleia","gelo","gemada","gemer","gemido","generoso","gengiva","genial","genoma","genro","geologia","gerador","germinar","gesso","gestor","ginasta","gincana","gingado","girafa","girino","glacial","glicose","global","glorioso","goela","goiaba","golfe","golpear","gordura","gorjeta","gorro","gostoso","goteira","governar","gracejo","gradual","grafite","gralha","grampo","granada","gratuito","graveto","graxa","grego","grelhar","greve","grilo","grisalho","gritaria","grosso","grotesco","grudado","grunhido","gruta","guache","guarani","guaxinim","guerrear","guiar","guincho","guisado","gula","guloso","guru","habitar","harmonia","haste","haver","hectare","herdar","heresia","hesitar","hiato","hibernar","hidratar","hiena","hino","hipismo","hipnose","hipoteca","hoje","holofote","homem","honesto","honrado","hormonal","hospedar","humorado","iate","ideia","idoso","ignorado","igreja","iguana","ileso","ilha","iludido","iluminar","ilustrar","imagem","imediato","imenso","imersivo","iminente","imitador","imortal","impacto","impedir","implante","impor","imprensa","impune","imunizar","inalador","inapto","inativo","incenso","inchar","incidir","incluir","incolor","indeciso","indireto","indutor","ineficaz","inerente","infantil","infestar","infinito","inflamar","informal","infrator","ingerir","inibido","inicial","inimigo","injetar","inocente","inodoro","inovador","inox","inquieto","inscrito","inseto","insistir","inspetor","instalar","insulto","intacto","integral","intimar","intocado","intriga","invasor","inverno","invicto","invocar","iogurte","iraniano","ironizar","irreal","irritado","isca","isento","isolado","isqueiro","italiano","janeiro","jangada","janta","jararaca","jardim","jarro","jasmim","jato","javali","jazida","jejum","joaninha","joelhada","jogador","joia","jornal","jorrar","jovem","juba","judeu","judoca","juiz","julgador","julho","jurado","jurista","juro","justa","labareda","laboral","lacre","lactante","ladrilho","lagarta","lagoa","laje","lamber","lamentar","laminar","lampejo","lanche","lapidar","lapso","laranja","lareira","largura","lasanha","lastro","lateral","latido","lavanda","lavoura","lavrador","laxante","lazer","lealdade","lebre","legado","legendar","legista","leigo","leiloar","leitura","lembrete","leme","lenhador","lentilha","leoa","lesma","leste","letivo","letreiro","levar","leveza","levitar","liberal","libido","liderar","ligar","ligeiro","limitar","limoeiro","limpador","linda","linear","linhagem","liquidez","listagem","lisura","litoral","livro","lixa","lixeira","locador","locutor","lojista","lombo","lona","longe","lontra","lorde","lotado","loteria","loucura","lousa","louvar","luar","lucidez","lucro","luneta","lustre","lutador","luva","macaco","macete","machado","macio","madeira","madrinha","magnata","magreza","maior","mais","malandro","malha","malote","maluco","mamilo","mamoeiro","mamute","manada","mancha","mandato","manequim","manhoso","manivela","manobrar","mansa","manter","manusear","mapeado","maquinar","marcador","maresia","marfim","margem","marinho","marmita","maroto","marquise","marreco","martelo","marujo","mascote","masmorra","massagem","mastigar","matagal","materno","matinal","matutar","maxilar","medalha","medida","medusa","megafone","meiga","melancia","melhor","membro","memorial","menino","menos","mensagem","mental","merecer","mergulho","mesada","mesclar","mesmo","mesquita","mestre","metade","meteoro","metragem","mexer","mexicano","micro","migalha","migrar","milagre","milenar","milhar","mimado","minerar","minhoca","ministro","minoria","miolo","mirante","mirtilo","misturar","mocidade","moderno","modular","moeda","moer","moinho","moita","moldura","moleza","molho","molinete","molusco","montanha","moqueca","morango","morcego","mordomo","morena","mosaico","mosquete","mostarda","motel","motim","moto","motriz","muda","muito","mulata","mulher","multar","mundial","munido","muralha","murcho","muscular","museu","musical","nacional","nadador","naja","namoro","narina","narrado","nascer","nativa","natureza","navalha","navegar","navio","neblina","nebuloso","negativa","negociar","negrito","nervoso","neta","neural","nevasca","nevoeiro","ninar","ninho","nitidez","nivelar","nobreza","noite","noiva","nomear","nominal","nordeste","nortear","notar","noticiar","noturno","novelo","novilho","novo","nublado","nudez","numeral","nupcial","nutrir","nuvem","obcecado","obedecer","objetivo","obrigado","obscuro","obstetra","obter","obturar","ocidente","ocioso","ocorrer","oculista","ocupado","ofegante","ofensiva","oferenda","oficina","ofuscado","ogiva","olaria","oleoso","olhar","oliveira","ombro","omelete","omisso","omitir","ondulado","oneroso","ontem","opcional","operador","oponente","oportuno","oposto","orar","orbitar","ordem","ordinal","orfanato","orgasmo","orgulho","oriental","origem","oriundo","orla","ortodoxo","orvalho","oscilar","ossada","osso","ostentar","otimismo","ousadia","outono","outubro","ouvido","ovelha","ovular","oxidar","oxigenar","pacato","paciente","pacote","pactuar","padaria","padrinho","pagar","pagode","painel","pairar","paisagem","palavra","palestra","palheta","palito","palmada","palpitar","pancada","panela","panfleto","panqueca","pantanal","papagaio","papelada","papiro","parafina","parcial","pardal","parede","partida","pasmo","passado","pastel","patamar","patente","patinar","patrono","paulada","pausar","peculiar","pedalar","pedestre","pediatra","pedra","pegada","peitoral","peixe","pele","pelicano","penca","pendurar","peneira","penhasco","pensador","pente","perceber","perfeito","pergunta","perito","permitir","perna","perplexo","persiana","pertence","peruca","pescado","pesquisa","pessoa","petiscar","piada","picado","piedade","pigmento","pilastra","pilhado","pilotar","pimenta","pincel","pinguim","pinha","pinote","pintar","pioneiro","pipoca","piquete","piranha","pires","pirueta","piscar","pistola","pitanga","pivete","planta","plaqueta","platina","plebeu","plumagem","pluvial","pneu","poda","poeira","poetisa","polegada","policiar","poluente","polvilho","pomar","pomba","ponderar","pontaria","populoso","porta","possuir","postal","pote","poupar","pouso","povoar","praia","prancha","prato","praxe","prece","predador","prefeito","premiar","prensar","preparar","presilha","pretexto","prevenir","prezar","primata","princesa","prisma","privado","processo","produto","profeta","proibido","projeto","prometer","propagar","prosa","protetor","provador","publicar","pudim","pular","pulmonar","pulseira","punhal","punir","pupilo","pureza","puxador","quadra","quantia","quarto","quase","quebrar","queda","queijo","quente","querido","quimono","quina","quiosque","rabanada","rabisco","rachar","racionar","radial","raiar","rainha","raio","raiva","rajada","ralado","ramal","ranger","ranhura","rapadura","rapel","rapidez","raposa","raquete","raridade","rasante","rascunho","rasgar","raspador","rasteira","rasurar","ratazana","ratoeira","realeza","reanimar","reaver","rebaixar","rebelde","rebolar","recado","recente","recheio","recibo","recordar","recrutar","recuar","rede","redimir","redonda","reduzida","reenvio","refinar","refletir","refogar","refresco","refugiar","regalia","regime","regra","reinado","reitor","rejeitar","relativo","remador","remendo","remorso","renovado","reparo","repelir","repleto","repolho","represa","repudiar","requerer","resenha","resfriar","resgatar","residir","resolver","respeito","ressaca","restante","resumir","retalho","reter","retirar","retomada","retratar","revelar","revisor","revolta","riacho","rica","rigidez","rigoroso","rimar","ringue","risada","risco","risonho","robalo","rochedo","rodada","rodeio","rodovia","roedor","roleta","romano","roncar","rosado","roseira","rosto","rota","roteiro","rotina","rotular","rouco","roupa","roxo","rubro","rugido","rugoso","ruivo","rumo","rupestre","russo","sabor","saciar","sacola","sacudir","sadio","safira","saga","sagrada","saibro","salada","saleiro","salgado","saliva","salpicar","salsicha","saltar","salvador","sambar","samurai","sanar","sanfona","sangue","sanidade","sapato","sarda","sargento","sarjeta","saturar","saudade","saxofone","sazonal","secar","secular","seda","sedento","sediado","sedoso","sedutor","segmento","segredo","segundo","seiva","seleto","selvagem","semanal","semente","senador","senhor","sensual","sentado","separado","sereia","seringa","serra","servo","setembro","setor","sigilo","silhueta","silicone","simetria","simpatia","simular","sinal","sincero","singular","sinopse","sintonia","sirene","siri","situado","soberano","sobra","socorro","sogro","soja","solda","soletrar","solteiro","sombrio","sonata","sondar","sonegar","sonhador","sono","soprano","soquete","sorrir","sorteio","sossego","sotaque","soterrar","sovado","sozinho","suavizar","subida","submerso","subsolo","subtrair","sucata","sucesso","suco","sudeste","sufixo","sugador","sugerir","sujeito","sulfato","sumir","suor","superior","suplicar","suposto","suprimir","surdina","surfista","surpresa","surreal","surtir","suspiro","sustento","tabela","tablete","tabuada","tacho","tagarela","talher","talo","talvez","tamanho","tamborim","tampa","tangente","tanto","tapar","tapioca","tardio","tarefa","tarja","tarraxa","tatuagem","taurino","taxativo","taxista","teatral","tecer","tecido","teclado","tedioso","teia","teimar","telefone","telhado","tempero","tenente","tensor","tentar","termal","terno","terreno","tese","tesoura","testado","teto","textura","texugo","tiara","tigela","tijolo","timbrar","timidez","tingido","tinteiro","tiragem","titular","toalha","tocha","tolerar","tolice","tomada","tomilho","tonel","tontura","topete","tora","torcido","torneio","torque","torrada","torto","tostar","touca","toupeira","toxina","trabalho","tracejar","tradutor","trafegar","trajeto","trama","trancar","trapo","traseiro","tratador","travar","treino","tremer","trepidar","trevo","triagem","tribo","triciclo","tridente","trilogia","trindade","triplo","triturar","triunfal","trocar","trombeta","trova","trunfo","truque","tubular","tucano","tudo","tulipa","tupi","turbo","turma","turquesa","tutelar","tutorial","uivar","umbigo","unha","unidade","uniforme","urologia","urso","urtiga","urubu","usado","usina","usufruir","vacina","vadiar","vagaroso","vaidoso","vala","valente","validade","valores","vantagem","vaqueiro","varanda","vareta","varrer","vascular","vasilha","vassoura","vazar","vazio","veado","vedar","vegetar","veicular","veleiro","velhice","veludo","vencedor","vendaval","venerar","ventre","verbal","verdade","vereador","vergonha","vermelho","verniz","versar","vertente","vespa","vestido","vetorial","viaduto","viagem","viajar","viatura","vibrador","videira","vidraria","viela","viga","vigente","vigiar","vigorar","vilarejo","vinco","vinheta","vinil","violeta","virada","virtude","visitar","visto","vitral","viveiro","vizinho","voador","voar","vogal","volante","voleibol","voltagem","volumoso","vontade","vulto","vuvuzela","xadrez","xarope","xeque","xeretar","xerife","xingar","zangado","zarpar","zebu","zelador","zombar","zoologia","zumbido"]'),require$$9=JSON.parse('["abandon","ability","able","about","above","absent","absorb","abstract","absurd","abuse","access","accident","account","accuse","achieve","acid","acoustic","acquire","across","act","action","actor","actress","actual","adapt","add","addict","address","adjust","admit","adult","advance","advice","aerobic","affair","afford","afraid","again","age","agent","agree","ahead","aim","air","airport","aisle","alarm","album","alcohol","alert","alien","all","alley","allow","almost","alone","alpha","already","also","alter","always","amateur","amazing","among","amount","amused","analyst","anchor","ancient","anger","angle","angry","animal","ankle","announce","annual","another","answer","antenna","antique","anxiety","any","apart","apology","appear","apple","approve","april","arch","arctic","area","arena","argue","arm","armed","armor","army","around","arrange","arrest","arrive","arrow","art","artefact","artist","artwork","ask","aspect","assault","asset","assist","assume","asthma","athlete","atom","attack","attend","attitude","attract","auction","audit","august","aunt","author","auto","autumn","average","avocado","avoid","awake","aware","away","awesome","awful","awkward","axis","baby","bachelor","bacon","badge","bag","balance","balcony","ball","bamboo","banana","banner","bar","barely","bargain","barrel","base","basic","basket","battle","beach","bean","beauty","because","become","beef","before","begin","behave","behind","believe","below","belt","bench","benefit","best","betray","better","between","beyond","bicycle","bid","bike","bind","biology","bird","birth","bitter","black","blade","blame","blanket","blast","bleak","bless","blind","blood","blossom","blouse","blue","blur","blush","board","boat","body","boil","bomb","bone","bonus","book","boost","border","boring","borrow","boss","bottom","bounce","box","boy","bracket","brain","brand","brass","brave","bread","breeze","brick","bridge","brief","bright","bring","brisk","broccoli","broken","bronze","broom","brother","brown","brush","bubble","buddy","budget","buffalo","build","bulb","bulk","bullet","bundle","bunker","burden","burger","burst","bus","business","busy","butter","buyer","buzz","cabbage","cabin","cable","cactus","cage","cake","call","calm","camera","camp","can","canal","cancel","candy","cannon","canoe","canvas","canyon","capable","capital","captain","car","carbon","card","cargo","carpet","carry","cart","case","cash","casino","castle","casual","cat","catalog","catch","category","cattle","caught","cause","caution","cave","ceiling","celery","cement","census","century","cereal","certain","chair","chalk","champion","change","chaos","chapter","charge","chase","chat","cheap","check","cheese","chef","cherry","chest","chicken","chief","child","chimney","choice","choose","chronic","chuckle","chunk","churn","cigar","cinnamon","circle","citizen","city","civil","claim","clap","clarify","claw","clay","clean","clerk","clever","click","client","cliff","climb","clinic","clip","clock","clog","close","cloth","cloud","clown","club","clump","cluster","clutch","coach","coast","coconut","code","coffee","coil","coin","collect","color","column","combine","come","comfort","comic","common","company","concert","conduct","confirm","congress","connect","consider","control","convince","cook","cool","copper","copy","coral","core","corn","correct","cost","cotton","couch","country","couple","course","cousin","cover","coyote","crack","cradle","craft","cram","crane","crash","crater","crawl","crazy","cream","credit","creek","crew","cricket","crime","crisp","critic","crop","cross","crouch","crowd","crucial","cruel","cruise","crumble","crunch","crush","cry","crystal","cube","culture","cup","cupboard","curious","current","curtain","curve","cushion","custom","cute","cycle","dad","damage","damp","dance","danger","daring","dash","daughter","dawn","day","deal","debate","debris","decade","december","decide","decline","decorate","decrease","deer","defense","define","defy","degree","delay","deliver","demand","demise","denial","dentist","deny","depart","depend","deposit","depth","deputy","derive","describe","desert","design","desk","despair","destroy","detail","detect","develop","device","devote","diagram","dial","diamond","diary","dice","diesel","diet","differ","digital","dignity","dilemma","dinner","dinosaur","direct","dirt","disagree","discover","disease","dish","dismiss","disorder","display","distance","divert","divide","divorce","dizzy","doctor","document","dog","doll","dolphin","domain","donate","donkey","donor","door","dose","double","dove","draft","dragon","drama","drastic","draw","dream","dress","drift","drill","drink","drip","drive","drop","drum","dry","duck","dumb","dune","during","dust","dutch","duty","dwarf","dynamic","eager","eagle","early","earn","earth","easily","east","easy","echo","ecology","economy","edge","edit","educate","effort","egg","eight","either","elbow","elder","electric","elegant","element","elephant","elevator","elite","else","embark","embody","embrace","emerge","emotion","employ","empower","empty","enable","enact","end","endless","endorse","enemy","energy","enforce","engage","engine","enhance","enjoy","enlist","enough","enrich","enroll","ensure","enter","entire","entry","envelope","episode","equal","equip","era","erase","erode","erosion","error","erupt","escape","essay","essence","estate","eternal","ethics","evidence","evil","evoke","evolve","exact","example","excess","exchange","excite","exclude","excuse","execute","exercise","exhaust","exhibit","exile","exist","exit","exotic","expand","expect","expire","explain","expose","express","extend","extra","eye","eyebrow","fabric","face","faculty","fade","faint","faith","fall","false","fame","family","famous","fan","fancy","fantasy","farm","fashion","fat","fatal","father","fatigue","fault","favorite","feature","february","federal","fee","feed","feel","female","fence","festival","fetch","fever","few","fiber","fiction","field","figure","file","film","filter","final","find","fine","finger","finish","fire","firm","first","fiscal","fish","fit","fitness","fix","flag","flame","flash","flat","flavor","flee","flight","flip","float","flock","floor","flower","fluid","flush","fly","foam","focus","fog","foil","fold","follow","food","foot","force","forest","forget","fork","fortune","forum","forward","fossil","foster","found","fox","fragile","frame","frequent","fresh","friend","fringe","frog","front","frost","frown","frozen","fruit","fuel","fun","funny","furnace","fury","future","gadget","gain","galaxy","gallery","game","gap","garage","garbage","garden","garlic","garment","gas","gasp","gate","gather","gauge","gaze","general","genius","genre","gentle","genuine","gesture","ghost","giant","gift","giggle","ginger","giraffe","girl","give","glad","glance","glare","glass","glide","glimpse","globe","gloom","glory","glove","glow","glue","goat","goddess","gold","good","goose","gorilla","gospel","gossip","govern","gown","grab","grace","grain","grant","grape","grass","gravity","great","green","grid","grief","grit","grocery","group","grow","grunt","guard","guess","guide","guilt","guitar","gun","gym","habit","hair","half","hammer","hamster","hand","happy","harbor","hard","harsh","harvest","hat","have","hawk","hazard","head","health","heart","heavy","hedgehog","height","hello","helmet","help","hen","hero","hidden","high","hill","hint","hip","hire","history","hobby","hockey","hold","hole","holiday","hollow","home","honey","hood","hope","horn","horror","horse","hospital","host","hotel","hour","hover","hub","huge","human","humble","humor","hundred","hungry","hunt","hurdle","hurry","hurt","husband","hybrid","ice","icon","idea","identify","idle","ignore","ill","illegal","illness","image","imitate","immense","immune","impact","impose","improve","impulse","inch","include","income","increase","index","indicate","indoor","industry","infant","inflict","inform","inhale","inherit","initial","inject","injury","inmate","inner","innocent","input","inquiry","insane","insect","inside","inspire","install","intact","interest","into","invest","invite","involve","iron","island","isolate","issue","item","ivory","jacket","jaguar","jar","jazz","jealous","jeans","jelly","jewel","job","join","joke","journey","joy","judge","juice","jump","jungle","junior","junk","just","kangaroo","keen","keep","ketchup","key","kick","kid","kidney","kind","kingdom","kiss","kit","kitchen","kite","kitten","kiwi","knee","knife","knock","know","lab","label","labor","ladder","lady","lake","lamp","language","laptop","large","later","latin","laugh","laundry","lava","law","lawn","lawsuit","layer","lazy","leader","leaf","learn","leave","lecture","left","leg","legal","legend","leisure","lemon","lend","length","lens","leopard","lesson","letter","level","liar","liberty","library","license","life","lift","light","like","limb","limit","link","lion","liquid","list","little","live","lizard","load","loan","lobster","local","lock","logic","lonely","long","loop","lottery","loud","lounge","love","loyal","lucky","luggage","lumber","lunar","lunch","luxury","lyrics","machine","mad","magic","magnet","maid","mail","main","major","make","mammal","man","manage","mandate","mango","mansion","manual","maple","marble","march","margin","marine","market","marriage","mask","mass","master","match","material","math","matrix","matter","maximum","maze","meadow","mean","measure","meat","mechanic","medal","media","melody","melt","member","memory","mention","menu","mercy","merge","merit","merry","mesh","message","metal","method","middle","midnight","milk","million","mimic","mind","minimum","minor","minute","miracle","mirror","misery","miss","mistake","mix","mixed","mixture","mobile","model","modify","mom","moment","monitor","monkey","monster","month","moon","moral","more","morning","mosquito","mother","motion","motor","mountain","mouse","move","movie","much","muffin","mule","multiply","muscle","museum","mushroom","music","must","mutual","myself","mystery","myth","naive","name","napkin","narrow","nasty","nation","nature","near","neck","need","negative","neglect","neither","nephew","nerve","nest","net","network","neutral","never","news","next","nice","night","noble","noise","nominee","noodle","normal","north","nose","notable","note","nothing","notice","novel","now","nuclear","number","nurse","nut","oak","obey","object","oblige","obscure","observe","obtain","obvious","occur","ocean","october","odor","off","offer","office","often","oil","okay","old","olive","olympic","omit","once","one","onion","online","only","open","opera","opinion","oppose","option","orange","orbit","orchard","order","ordinary","organ","orient","original","orphan","ostrich","other","outdoor","outer","output","outside","oval","oven","over","own","owner","oxygen","oyster","ozone","pact","paddle","page","pair","palace","palm","panda","panel","panic","panther","paper","parade","parent","park","parrot","party","pass","patch","path","patient","patrol","pattern","pause","pave","payment","peace","peanut","pear","peasant","pelican","pen","penalty","pencil","people","pepper","perfect","permit","person","pet","phone","photo","phrase","physical","piano","picnic","picture","piece","pig","pigeon","pill","pilot","pink","pioneer","pipe","pistol","pitch","pizza","place","planet","plastic","plate","play","please","pledge","pluck","plug","plunge","poem","poet","point","polar","pole","police","pond","pony","pool","popular","portion","position","possible","post","potato","pottery","poverty","powder","power","practice","praise","predict","prefer","prepare","present","pretty","prevent","price","pride","primary","print","priority","prison","private","prize","problem","process","produce","profit","program","project","promote","proof","property","prosper","protect","proud","provide","public","pudding","pull","pulp","pulse","pumpkin","punch","pupil","puppy","purchase","purity","purpose","purse","push","put","puzzle","pyramid","quality","quantum","quarter","question","quick","quit","quiz","quote","rabbit","raccoon","race","rack","radar","radio","rail","rain","raise","rally","ramp","ranch","random","range","rapid","rare","rate","rather","raven","raw","razor","ready","real","reason","rebel","rebuild","recall","receive","recipe","record","recycle","reduce","reflect","reform","refuse","region","regret","regular","reject","relax","release","relief","rely","remain","remember","remind","remove","render","renew","rent","reopen","repair","repeat","replace","report","require","rescue","resemble","resist","resource","response","result","retire","retreat","return","reunion","reveal","review","reward","rhythm","rib","ribbon","rice","rich","ride","ridge","rifle","right","rigid","ring","riot","ripple","risk","ritual","rival","river","road","roast","robot","robust","rocket","romance","roof","rookie","room","rose","rotate","rough","round","route","royal","rubber","rude","rug","rule","run","runway","rural","sad","saddle","sadness","safe","sail","salad","salmon","salon","salt","salute","same","sample","sand","satisfy","satoshi","sauce","sausage","save","say","scale","scan","scare","scatter","scene","scheme","school","science","scissors","scorpion","scout","scrap","screen","script","scrub","sea","search","season","seat","second","secret","section","security","seed","seek","segment","select","sell","seminar","senior","sense","sentence","series","service","session","settle","setup","seven","shadow","shaft","shallow","share","shed","shell","sheriff","shield","shift","shine","ship","shiver","shock","shoe","shoot","shop","short","shoulder","shove","shrimp","shrug","shuffle","shy","sibling","sick","side","siege","sight","sign","silent","silk","silly","silver","similar","simple","since","sing","siren","sister","situate","six","size","skate","sketch","ski","skill","skin","skirt","skull","slab","slam","sleep","slender","slice","slide","slight","slim","slogan","slot","slow","slush","small","smart","smile","smoke","smooth","snack","snake","snap","sniff","snow","soap","soccer","social","sock","soda","soft","solar","soldier","solid","solution","solve","someone","song","soon","sorry","sort","soul","sound","soup","source","south","space","spare","spatial","spawn","speak","special","speed","spell","spend","sphere","spice","spider","spike","spin","spirit","split","spoil","sponsor","spoon","sport","spot","spray","spread","spring","spy","square","squeeze","squirrel","stable","stadium","staff","stage","stairs","stamp","stand","start","state","stay","steak","steel","stem","step","stereo","stick","still","sting","stock","stomach","stone","stool","story","stove","strategy","street","strike","strong","struggle","student","stuff","stumble","style","subject","submit","subway","success","such","sudden","suffer","sugar","suggest","suit","summer","sun","sunny","sunset","super","supply","supreme","sure","surface","surge","surprise","surround","survey","suspect","sustain","swallow","swamp","swap","swarm","swear","sweet","swift","swim","swing","switch","sword","symbol","symptom","syrup","system","table","tackle","tag","tail","talent","talk","tank","tape","target","task","taste","tattoo","taxi","teach","team","tell","ten","tenant","tennis","tent","term","test","text","thank","that","theme","then","theory","there","they","thing","this","thought","three","thrive","throw","thumb","thunder","ticket","tide","tiger","tilt","timber","time","tiny","tip","tired","tissue","title","toast","tobacco","today","toddler","toe","together","toilet","token","tomato","tomorrow","tone","tongue","tonight","tool","tooth","top","topic","topple","torch","tornado","tortoise","toss","total","tourist","toward","tower","town","toy","track","trade","traffic","tragic","train","transfer","trap","trash","travel","tray","treat","tree","trend","trial","tribe","trick","trigger","trim","trip","trophy","trouble","truck","true","truly","trumpet","trust","truth","try","tube","tuition","tumble","tuna","tunnel","turkey","turn","turtle","twelve","twenty","twice","twin","twist","two","type","typical","ugly","umbrella","unable","unaware","uncle","uncover","under","undo","unfair","unfold","unhappy","uniform","unique","unit","universe","unknown","unlock","until","unusual","unveil","update","upgrade","uphold","upon","upper","upset","urban","urge","usage","use","used","useful","useless","usual","utility","vacant","vacuum","vague","valid","valley","valve","van","vanish","vapor","various","vast","vault","vehicle","velvet","vendor","venture","venue","verb","verify","version","very","vessel","veteran","viable","vibrant","vicious","victory","video","view","village","vintage","violin","virtual","virus","visa","visit","visual","vital","vivid","vocal","voice","void","volcano","volume","vote","voyage","wage","wagon","wait","walk","wall","walnut","want","warfare","warm","warrior","wash","wasp","waste","water","wave","way","wealth","weapon","wear","weasel","weather","web","wedding","weekend","weird","welcome","west","wet","whale","what","wheat","wheel","when","where","whip","whisper","wide","width","wife","wild","will","win","window","wine","wing","wink","winner","winter","wire","wisdom","wise","wish","witness","wolf","woman","wonder","wood","wool","word","work","world","worry","worth","wrap","wreck","wrestle","wrist","write","wrong","yard","year","yellow","you","young","youth","zebra","zero","zone","zoo"]');var hasRequired_wordlists;function require_wordlists(){if(hasRequired_wordlists)return _wordlists;hasRequired_wordlists=1,Object.defineProperty(_wordlists,"__esModule",{value:!0});const y={};_wordlists.wordlists=y;let u;_wordlists._default=u;try{_wordlists._default=u=require$$0$1,y.czech=u}catch{}try{_wordlists._default=u=require$$1$2,y.chinese_simplified=u}catch{}try{_wordlists._default=u=require$$2$3,y.chinese_traditional=u}catch{}try{_wordlists._default=u=require$$3,y.korean=u}catch{}try{_wordlists._default=u=require$$4$1,y.french=u}catch{}try{_wordlists._default=u=require$$5,y.italian=u}catch{}try{_wordlists._default=u=require$$6$1,y.spanish=u}catch{}try{_wordlists._default=u=require$$7,y.japanese=u,y.JA=u}catch{}try{_wordlists._default=u=require$$8,y.portuguese=u}catch{}try{_wordlists._default=u=require$$9,y.english=u,y.EN=u}catch{}return _wordlists}var hasRequiredSrc;function requireSrc(){if(hasRequiredSrc)return src$1;hasRequiredSrc=1,Object.defineProperty(src$1,"__esModule",{value:!0});const y=requireSha256$2(),u=requireSha512$2(),g=requirePbkdf2$1(),v=requireUtils$4(),b=require_wordlists();let w=b._default;const E="Invalid mnemonic",S="Invalid entropy",A="Invalid mnemonic checksum",$=`A wordlist is required but a default could not be found.
Please pass a 2048 word array explicitly.`;function R(pe){return(pe||"").normalize("NFKD")}function T(pe,ve,he){for(;pe.length<he;)pe=ve+pe;return pe}function O(pe){return parseInt(pe,2)}function B(pe){return pe.map(ve=>T(ve.toString(2),"0",8)).join("")}function F(pe){const he=pe.length*8/32,ae=y.sha256(Uint8Array.from(pe));return B(Array.from(ae)).slice(0,he)}function U(pe){return"mnemonic"+(pe||"")}function q(pe,ve){const he=Uint8Array.from(Buffer.from(R(pe),"utf8")),ae=Uint8Array.from(Buffer.from(U(R(ve)),"utf8")),Q=g.pbkdf2(u.sha512,he,ae,{c:2048,dkLen:64});return Buffer.from(Q)}src$1.mnemonicToSeedSync=q;function J(pe,ve){const he=Uint8Array.from(Buffer.from(R(pe),"utf8")),ae=Uint8Array.from(Buffer.from(U(R(ve)),"utf8"));return g.pbkdf2Async(u.sha512,he,ae,{c:2048,dkLen:64}).then(Q=>Buffer.from(Q))}src$1.mnemonicToSeed=J;function ie(pe,ve){if(ve=ve||w,!ve)throw new Error($);const he=R(pe).split(" ");if(he.length%3!==0)throw new Error(E);const ae=he.map(ne=>{const se=ve.indexOf(ne);if(se===-1)throw new Error(E);return T(se.toString(2),"0",11)}).join(""),Q=Math.floor(ae.length/33)*32,j=ae.slice(0,Q),z=ae.slice(Q),re=j.match(/(.{1,8})/g).map(O);if(re.length<16)throw new Error(S);if(re.length>32)throw new Error(S);if(re.length%4!==0)throw new Error(S);const Y=Buffer.from(re);if(F(Y)!==z)throw new Error(A);return Y.toString("hex")}src$1.mnemonicToEntropy=ie;function oe(pe,ve){if(Buffer.isBuffer(pe)||(pe=Buffer.from(pe,"hex")),ve=ve||w,!ve)throw new Error($);if(pe.length<16)throw new TypeError(S);if(pe.length>32)throw new TypeError(S);if(pe.length%4!==0)throw new TypeError(S);const he=B(Array.from(pe)),ae=F(pe),z=(he+ae).match(/(.{1,11})/g).map(re=>{const Y=O(re);return ve[Y]});return ve[0]===""?z.join(""):z.join(" ")}src$1.entropyToMnemonic=oe;function le(pe,ve,he){if(pe=pe||128,pe%32!==0)throw new TypeError(S);return ve=ve||(ae=>Buffer.from(v.randomBytes(ae))),oe(ve(pe/8),he)}src$1.generateMnemonic=le;function de(pe,ve){try{ie(pe,ve)}catch{return!1}return!0}src$1.validateMnemonic=de;function fe(pe){const ve=b.wordlists[pe];if(ve)w=ve;else throw new Error('Could not find wordlist for language "'+pe+'"')}src$1.setDefaultWordlist=fe;function ye(){if(!w)throw new Error("No Default Wordlist set");return Object.keys(b.wordlists).filter(pe=>pe==="JA"||pe==="EN"?!1:b.wordlists[pe].every((ve,he)=>ve===w[he]))[0]}src$1.getDefaultWordlist=ye;var we=require_wordlists();return src$1.wordlists=we.wordlists,src$1}var srcExports=requireSrc(),cryptoJs$1={exports:{}};function commonjsRequire(y){throw new Error('Could not dynamically require "'+y+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var core$1={exports:{}},cryptoBrowserify={},browser$e={exports:{}},safeBuffer$2={exports:{}},dist={},hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,(function(y){Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var u={},g={};g.byteLength=R,g.toByteArray=O,g.fromByteArray=U;for(var v=[],b=[],w=typeof Uint8Array<"u"?Uint8Array:Array,E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S=0,A=E.length;S<A;++S)v[S]=E[S],b[E.charCodeAt(S)]=S;b[45]=62,b[95]=63;function $(ie){var oe=ie.length;if(oe%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var le=ie.indexOf("=");le===-1&&(le=oe);var de=le===oe?0:4-le%4;return[le,de]}function R(ie){var oe=$(ie),le=oe[0],de=oe[1];return(le+de)*3/4-de}function T(ie,oe,le){return(oe+le)*3/4-le}function O(ie){var oe,le=$(ie),de=le[0],fe=le[1],ye=new w(T(ie,de,fe)),we=0,pe=fe>0?de-4:de,ve;for(ve=0;ve<pe;ve+=4)oe=b[ie.charCodeAt(ve)]<<18|b[ie.charCodeAt(ve+1)]<<12|b[ie.charCodeAt(ve+2)]<<6|b[ie.charCodeAt(ve+3)],ye[we++]=oe>>16&255,ye[we++]=oe>>8&255,ye[we++]=oe&255;return fe===2&&(oe=b[ie.charCodeAt(ve)]<<2|b[ie.charCodeAt(ve+1)]>>4,ye[we++]=oe&255),fe===1&&(oe=b[ie.charCodeAt(ve)]<<10|b[ie.charCodeAt(ve+1)]<<4|b[ie.charCodeAt(ve+2)]>>2,ye[we++]=oe>>8&255,ye[we++]=oe&255),ye}function B(ie){return v[ie>>18&63]+v[ie>>12&63]+v[ie>>6&63]+v[ie&63]}function F(ie,oe,le){for(var de,fe=[],ye=oe;ye<le;ye+=3)de=(ie[ye]<<16&16711680)+(ie[ye+1]<<8&65280)+(ie[ye+2]&255),fe.push(B(de));return fe.join("")}function U(ie){for(var oe,le=ie.length,de=le%3,fe=[],ye=16383,we=0,pe=le-de;we<pe;we+=ye)fe.push(F(ie,we,we+ye>pe?pe:we+ye));return de===1?(oe=ie[le-1],fe.push(v[oe>>2]+v[oe<<4&63]+"==")):de===2&&(oe=(ie[le-2]<<8)+ie[le-1],fe.push(v[oe>>10]+v[oe>>4&63]+v[oe<<2&63]+"=")),fe.join("")}var q={};q.read=function(ie,oe,le,de,fe){var ye,we,pe=fe*8-de-1,ve=(1<<pe)-1,he=ve>>1,ae=-7,Q=le?fe-1:0,j=le?-1:1,z=ie[oe+Q];for(Q+=j,ye=z&(1<<-ae)-1,z>>=-ae,ae+=pe;ae>0;ye=ye*256+ie[oe+Q],Q+=j,ae-=8);for(we=ye&(1<<-ae)-1,ye>>=-ae,ae+=de;ae>0;we=we*256+ie[oe+Q],Q+=j,ae-=8);if(ye===0)ye=1-he;else{if(ye===ve)return we?NaN:(z?-1:1)*(1/0);we=we+Math.pow(2,de),ye=ye-he}return(z?-1:1)*we*Math.pow(2,ye-de)},q.write=function(ie,oe,le,de,fe,ye){var we,pe,ve,he=ye*8-fe-1,ae=(1<<he)-1,Q=ae>>1,j=fe===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=de?0:ye-1,re=de?1:-1,Y=oe<0||oe===0&&1/oe<0?1:0;for(oe=Math.abs(oe),isNaN(oe)||oe===1/0?(pe=isNaN(oe)?1:0,we=ae):(we=Math.floor(Math.log(oe)/Math.LN2),oe*(ve=Math.pow(2,-we))<1&&(we--,ve*=2),we+Q>=1?oe+=j/ve:oe+=j*Math.pow(2,1-Q),oe*ve>=2&&(we++,ve/=2),we+Q>=ae?(pe=0,we=ae):we+Q>=1?(pe=(oe*ve-1)*Math.pow(2,fe),we=we+Q):(pe=oe*Math.pow(2,Q-1)*Math.pow(2,fe),we=0));fe>=8;ie[le+z]=pe&255,z+=re,pe/=256,fe-=8);for(we=we<<fe|pe,he+=fe;he>0;ie[le+z]=we&255,z+=re,we/=256,he-=8);ie[le+z-re]|=Y*128};(function(ie){const oe=g,le=q,de=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;ie.Buffer=ae,ie.SlowBuffer=ue,ie.INSPECT_MAX_BYTES=50;const fe=2147483647;ie.kMaxLength=fe;const{Uint8Array:ye,ArrayBuffer:we,SharedArrayBuffer:pe}=globalThis;ae.TYPED_ARRAY_SUPPORT=ve(),!ae.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function ve(){try{const Oe=new ye(1),$e={foo:function(){return 42}};return Object.setPrototypeOf($e,ye.prototype),Object.setPrototypeOf(Oe,$e),Oe.foo()===42}catch{return!1}}Object.defineProperty(ae.prototype,"parent",{enumerable:!0,get:function(){if(ae.isBuffer(this))return this.buffer}}),Object.defineProperty(ae.prototype,"offset",{enumerable:!0,get:function(){if(ae.isBuffer(this))return this.byteOffset}});function he(Oe){if(Oe>fe)throw new RangeError('The value "'+Oe+'" is invalid for option "size"');const $e=new ye(Oe);return Object.setPrototypeOf($e,ae.prototype),$e}function ae(Oe,$e,ke){if(typeof Oe=="number"){if(typeof $e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return re(Oe)}return Q(Oe,$e,ke)}ae.poolSize=8192;function Q(Oe,$e,ke){if(typeof Oe=="string")return Y(Oe,$e);if(we.isView(Oe))return ne(Oe);if(Oe==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Oe);if(_t(Oe,we)||Oe&&_t(Oe.buffer,we)||typeof pe<"u"&&(_t(Oe,pe)||Oe&&_t(Oe.buffer,pe)))return se(Oe,$e,ke);if(typeof Oe=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const Ue=Oe.valueOf&&Oe.valueOf();if(Ue!=null&&Ue!==Oe)return ae.from(Ue,$e,ke);const We=ee(Oe);if(We)return We;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Oe[Symbol.toPrimitive]=="function")return ae.from(Oe[Symbol.toPrimitive]("string"),$e,ke);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Oe)}ae.from=function(Oe,$e,ke){return Q(Oe,$e,ke)},Object.setPrototypeOf(ae.prototype,ye.prototype),Object.setPrototypeOf(ae,ye);function j(Oe){if(typeof Oe!="number")throw new TypeError('"size" argument must be of type number');if(Oe<0)throw new RangeError('The value "'+Oe+'" is invalid for option "size"')}function z(Oe,$e,ke){return j(Oe),Oe<=0?he(Oe):$e!==void 0?typeof ke=="string"?he(Oe).fill($e,ke):he(Oe).fill($e):he(Oe)}ae.alloc=function(Oe,$e,ke){return z(Oe,$e,ke)};function re(Oe){return j(Oe),he(Oe<0?0:Z(Oe)|0)}ae.allocUnsafe=function(Oe){return re(Oe)},ae.allocUnsafeSlow=function(Oe){return re(Oe)};function Y(Oe,$e){if((typeof $e!="string"||$e==="")&&($e="utf8"),!ae.isEncoding($e))throw new TypeError("Unknown encoding: "+$e);const ke=_e(Oe,$e)|0;let Ue=he(ke);const We=Ue.write(Oe,$e);return We!==ke&&(Ue=Ue.slice(0,We)),Ue}function te(Oe){const $e=Oe.length<0?0:Z(Oe.length)|0,ke=he($e);for(let Ue=0;Ue<$e;Ue+=1)ke[Ue]=Oe[Ue]&255;return ke}function ne(Oe){if(_t(Oe,ye)){const $e=new ye(Oe);return se($e.buffer,$e.byteOffset,$e.byteLength)}return te(Oe)}function se(Oe,$e,ke){if($e<0||Oe.byteLength<$e)throw new RangeError('"offset" is outside of buffer bounds');if(Oe.byteLength<$e+(ke||0))throw new RangeError('"length" is outside of buffer bounds');let Ue;return $e===void 0&&ke===void 0?Ue=new ye(Oe):ke===void 0?Ue=new ye(Oe,$e):Ue=new ye(Oe,$e,ke),Object.setPrototypeOf(Ue,ae.prototype),Ue}function ee(Oe){if(ae.isBuffer(Oe)){const $e=Z(Oe.length)|0,ke=he($e);return ke.length===0||Oe.copy(ke,0,0,$e),ke}if(Oe.length!==void 0)return typeof Oe.length!="number"||$t(Oe.length)?he(0):te(Oe);if(Oe.type==="Buffer"&&Array.isArray(Oe.data))return te(Oe.data)}function Z(Oe){if(Oe>=fe)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+fe.toString(16)+" bytes");return Oe|0}function ue(Oe){return+Oe!=Oe&&(Oe=0),ae.alloc(+Oe)}ae.isBuffer=function($e){return $e!=null&&$e._isBuffer===!0&&$e!==ae.prototype},ae.compare=function($e,ke){if(_t($e,ye)&&($e=ae.from($e,$e.offset,$e.byteLength)),_t(ke,ye)&&(ke=ae.from(ke,ke.offset,ke.byteLength)),!ae.isBuffer($e)||!ae.isBuffer(ke))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if($e===ke)return 0;let Ue=$e.length,We=ke.length;for(let Qe=0,tt=Math.min(Ue,We);Qe<tt;++Qe)if($e[Qe]!==ke[Qe]){Ue=$e[Qe],We=ke[Qe];break}return Ue<We?-1:We<Ue?1:0},ae.isEncoding=function($e){switch(String($e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ae.concat=function($e,ke){if(!Array.isArray($e))throw new TypeError('"list" argument must be an Array of Buffers');if($e.length===0)return ae.alloc(0);let Ue;if(ke===void 0)for(ke=0,Ue=0;Ue<$e.length;++Ue)ke+=$e[Ue].length;const We=ae.allocUnsafe(ke);let Qe=0;for(Ue=0;Ue<$e.length;++Ue){let tt=$e[Ue];if(_t(tt,ye))Qe+tt.length>We.length?(ae.isBuffer(tt)||(tt=ae.from(tt)),tt.copy(We,Qe)):ye.prototype.set.call(We,tt,Qe);else if(ae.isBuffer(tt))tt.copy(We,Qe);else throw new TypeError('"list" argument must be an Array of Buffers');Qe+=tt.length}return We};function _e(Oe,$e){if(ae.isBuffer(Oe))return Oe.length;if(we.isView(Oe)||_t(Oe,we))return Oe.byteLength;if(typeof Oe!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Oe);const ke=Oe.length,Ue=arguments.length>2&&arguments[2]===!0;if(!Ue&&ke===0)return 0;let We=!1;for(;;)switch($e){case"ascii":case"latin1":case"binary":return ke;case"utf8":case"utf-8":return xt(Oe).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ke*2;case"hex":return ke>>>1;case"base64":return at(Oe).length;default:if(We)return Ue?-1:xt(Oe).length;$e=(""+$e).toLowerCase(),We=!0}}ae.byteLength=_e;function Re(Oe,$e,ke){let Ue=!1;if(($e===void 0||$e<0)&&($e=0),$e>this.length||((ke===void 0||ke>this.length)&&(ke=this.length),ke<=0)||(ke>>>=0,$e>>>=0,ke<=$e))return"";for(Oe||(Oe="utf8");;)switch(Oe){case"hex":return et(this,$e,ke);case"utf8":case"utf-8":return qe(this,$e,ke);case"ascii":return Xe(this,$e,ke);case"latin1":case"binary":return ze(this,$e,ke);case"base64":return Le(this,$e,ke);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ze(this,$e,ke);default:if(Ue)throw new TypeError("Unknown encoding: "+Oe);Oe=(Oe+"").toLowerCase(),Ue=!0}}ae.prototype._isBuffer=!0;function Ae(Oe,$e,ke){const Ue=Oe[$e];Oe[$e]=Oe[ke],Oe[ke]=Ue}ae.prototype.swap16=function(){const $e=this.length;if($e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let ke=0;ke<$e;ke+=2)Ae(this,ke,ke+1);return this},ae.prototype.swap32=function(){const $e=this.length;if($e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let ke=0;ke<$e;ke+=4)Ae(this,ke,ke+3),Ae(this,ke+1,ke+2);return this},ae.prototype.swap64=function(){const $e=this.length;if($e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let ke=0;ke<$e;ke+=8)Ae(this,ke,ke+7),Ae(this,ke+1,ke+6),Ae(this,ke+2,ke+5),Ae(this,ke+3,ke+4);return this},ae.prototype.toString=function(){const $e=this.length;return $e===0?"":arguments.length===0?qe(this,0,$e):Re.apply(this,arguments)},ae.prototype.toLocaleString=ae.prototype.toString,ae.prototype.equals=function($e){if(!ae.isBuffer($e))throw new TypeError("Argument must be a Buffer");return this===$e?!0:ae.compare(this,$e)===0},ae.prototype.inspect=function(){let $e="";const ke=ie.INSPECT_MAX_BYTES;return $e=this.toString("hex",0,ke).replace(/(.{2})/g,"$1 ").trim(),this.length>ke&&($e+=" ... "),"<Buffer "+$e+">"},de&&(ae.prototype[de]=ae.prototype.inspect),ae.prototype.compare=function($e,ke,Ue,We,Qe){if(_t($e,ye)&&($e=ae.from($e,$e.offset,$e.byteLength)),!ae.isBuffer($e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof $e);if(ke===void 0&&(ke=0),Ue===void 0&&(Ue=$e?$e.length:0),We===void 0&&(We=0),Qe===void 0&&(Qe=this.length),ke<0||Ue>$e.length||We<0||Qe>this.length)throw new RangeError("out of range index");if(We>=Qe&&ke>=Ue)return 0;if(We>=Qe)return-1;if(ke>=Ue)return 1;if(ke>>>=0,Ue>>>=0,We>>>=0,Qe>>>=0,this===$e)return 0;let tt=Qe-We,Pt=Ue-ke;const Nt=Math.min(tt,Pt),Rt=this.slice(We,Qe),Dt=$e.slice(ke,Ue);for(let Tt=0;Tt<Nt;++Tt)if(Rt[Tt]!==Dt[Tt]){tt=Rt[Tt],Pt=Dt[Tt];break}return tt<Pt?-1:Pt<tt?1:0};function ge(Oe,$e,ke,Ue,We){if(Oe.length===0)return-1;if(typeof ke=="string"?(Ue=ke,ke=0):ke>2147483647?ke=2147483647:ke<-2147483648&&(ke=-2147483648),ke=+ke,$t(ke)&&(ke=We?0:Oe.length-1),ke<0&&(ke=Oe.length+ke),ke>=Oe.length){if(We)return-1;ke=Oe.length-1}else if(ke<0)if(We)ke=0;else return-1;if(typeof $e=="string"&&($e=ae.from($e,Ue)),ae.isBuffer($e))return $e.length===0?-1:be(Oe,$e,ke,Ue,We);if(typeof $e=="number")return $e=$e&255,typeof ye.prototype.indexOf=="function"?We?ye.prototype.indexOf.call(Oe,$e,ke):ye.prototype.lastIndexOf.call(Oe,$e,ke):be(Oe,[$e],ke,Ue,We);throw new TypeError("val must be string, number or Buffer")}function be(Oe,$e,ke,Ue,We){let Qe=1,tt=Oe.length,Pt=$e.length;if(Ue!==void 0&&(Ue=String(Ue).toLowerCase(),Ue==="ucs2"||Ue==="ucs-2"||Ue==="utf16le"||Ue==="utf-16le")){if(Oe.length<2||$e.length<2)return-1;Qe=2,tt/=2,Pt/=2,ke/=2}function Nt(Dt,Tt){return Qe===1?Dt[Tt]:Dt.readUInt16BE(Tt*Qe)}let Rt;if(We){let Dt=-1;for(Rt=ke;Rt<tt;Rt++)if(Nt(Oe,Rt)===Nt($e,Dt===-1?0:Rt-Dt)){if(Dt===-1&&(Dt=Rt),Rt-Dt+1===Pt)return Dt*Qe}else Dt!==-1&&(Rt-=Rt-Dt),Dt=-1}else for(ke+Pt>tt&&(ke=tt-Pt),Rt=ke;Rt>=0;Rt--){let Dt=!0;for(let Tt=0;Tt<Pt;Tt++)if(Nt(Oe,Rt+Tt)!==Nt($e,Tt)){Dt=!1;break}if(Dt)return Rt}return-1}ae.prototype.includes=function($e,ke,Ue){return this.indexOf($e,ke,Ue)!==-1},ae.prototype.indexOf=function($e,ke,Ue){return ge(this,$e,ke,Ue,!0)},ae.prototype.lastIndexOf=function($e,ke,Ue){return ge(this,$e,ke,Ue,!1)};function Te(Oe,$e,ke,Ue){ke=Number(ke)||0;const We=Oe.length-ke;Ue?(Ue=Number(Ue),Ue>We&&(Ue=We)):Ue=We;const Qe=$e.length;Ue>Qe/2&&(Ue=Qe/2);let tt;for(tt=0;tt<Ue;++tt){const Pt=parseInt($e.substr(tt*2,2),16);if($t(Pt))return tt;Oe[ke+tt]=Pt}return tt}function De(Oe,$e,ke,Ue){return ht(xt($e,Oe.length-ke),Oe,ke,Ue)}function Ie(Oe,$e,ke,Ue){return ht(mt($e),Oe,ke,Ue)}function Se(Oe,$e,ke,Ue){return ht(at($e),Oe,ke,Ue)}function Be(Oe,$e,ke,Ue){return ht(gt($e,Oe.length-ke),Oe,ke,Ue)}ae.prototype.write=function($e,ke,Ue,We){if(ke===void 0)We="utf8",Ue=this.length,ke=0;else if(Ue===void 0&&typeof ke=="string")We=ke,Ue=this.length,ke=0;else if(isFinite(ke))ke=ke>>>0,isFinite(Ue)?(Ue=Ue>>>0,We===void 0&&(We="utf8")):(We=Ue,Ue=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Qe=this.length-ke;if((Ue===void 0||Ue>Qe)&&(Ue=Qe),$e.length>0&&(Ue<0||ke<0)||ke>this.length)throw new RangeError("Attempt to write outside buffer bounds");We||(We="utf8");let tt=!1;for(;;)switch(We){case"hex":return Te(this,$e,ke,Ue);case"utf8":case"utf-8":return De(this,$e,ke,Ue);case"ascii":case"latin1":case"binary":return Ie(this,$e,ke,Ue);case"base64":return Se(this,$e,ke,Ue);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Be(this,$e,ke,Ue);default:if(tt)throw new TypeError("Unknown encoding: "+We);We=(""+We).toLowerCase(),tt=!0}},ae.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Le(Oe,$e,ke){return $e===0&&ke===Oe.length?oe.fromByteArray(Oe):oe.fromByteArray(Oe.slice($e,ke))}function qe(Oe,$e,ke){ke=Math.min(Oe.length,ke);const Ue=[];let We=$e;for(;We<ke;){const Qe=Oe[We];let tt=null,Pt=Qe>239?4:Qe>223?3:Qe>191?2:1;if(We+Pt<=ke){let Nt,Rt,Dt,Tt;switch(Pt){case 1:Qe<128&&(tt=Qe);break;case 2:Nt=Oe[We+1],(Nt&192)===128&&(Tt=(Qe&31)<<6|Nt&63,Tt>127&&(tt=Tt));break;case 3:Nt=Oe[We+1],Rt=Oe[We+2],(Nt&192)===128&&(Rt&192)===128&&(Tt=(Qe&15)<<12|(Nt&63)<<6|Rt&63,Tt>2047&&(Tt<55296||Tt>57343)&&(tt=Tt));break;case 4:Nt=Oe[We+1],Rt=Oe[We+2],Dt=Oe[We+3],(Nt&192)===128&&(Rt&192)===128&&(Dt&192)===128&&(Tt=(Qe&15)<<18|(Nt&63)<<12|(Rt&63)<<6|Dt&63,Tt>65535&&Tt<1114112&&(tt=Tt))}}tt===null?(tt=65533,Pt=1):tt>65535&&(tt-=65536,Ue.push(tt>>>10&1023|55296),tt=56320|tt&1023),Ue.push(tt),We+=Pt}return Ge(Ue)}const Ke=4096;function Ge(Oe){const $e=Oe.length;if($e<=Ke)return String.fromCharCode.apply(String,Oe);let ke="",Ue=0;for(;Ue<$e;)ke+=String.fromCharCode.apply(String,Oe.slice(Ue,Ue+=Ke));return ke}function Xe(Oe,$e,ke){let Ue="";ke=Math.min(Oe.length,ke);for(let We=$e;We<ke;++We)Ue+=String.fromCharCode(Oe[We]&127);return Ue}function ze(Oe,$e,ke){let Ue="";ke=Math.min(Oe.length,ke);for(let We=$e;We<ke;++We)Ue+=String.fromCharCode(Oe[We]);return Ue}function et(Oe,$e,ke){const Ue=Oe.length;(!$e||$e<0)&&($e=0),(!ke||ke<0||ke>Ue)&&(ke=Ue);let We="";for(let Qe=$e;Qe<ke;++Qe)We+=St[Oe[Qe]];return We}function Ze(Oe,$e,ke){const Ue=Oe.slice($e,ke);let We="";for(let Qe=0;Qe<Ue.length-1;Qe+=2)We+=String.fromCharCode(Ue[Qe]+Ue[Qe+1]*256);return We}ae.prototype.slice=function($e,ke){const Ue=this.length;$e=~~$e,ke=ke===void 0?Ue:~~ke,$e<0?($e+=Ue,$e<0&&($e=0)):$e>Ue&&($e=Ue),ke<0?(ke+=Ue,ke<0&&(ke=0)):ke>Ue&&(ke=Ue),ke<$e&&(ke=$e);const We=this.subarray($e,ke);return Object.setPrototypeOf(We,ae.prototype),We};function nt(Oe,$e,ke){if(Oe%1!==0||Oe<0)throw new RangeError("offset is not uint");if(Oe+$e>ke)throw new RangeError("Trying to access beyond buffer length")}ae.prototype.readUintLE=ae.prototype.readUIntLE=function($e,ke,Ue){$e=$e>>>0,ke=ke>>>0,Ue||nt($e,ke,this.length);let We=this[$e],Qe=1,tt=0;for(;++tt<ke&&(Qe*=256);)We+=this[$e+tt]*Qe;return We},ae.prototype.readUintBE=ae.prototype.readUIntBE=function($e,ke,Ue){$e=$e>>>0,ke=ke>>>0,Ue||nt($e,ke,this.length);let We=this[$e+--ke],Qe=1;for(;ke>0&&(Qe*=256);)We+=this[$e+--ke]*Qe;return We},ae.prototype.readUint8=ae.prototype.readUInt8=function($e,ke){return $e=$e>>>0,ke||nt($e,1,this.length),this[$e]},ae.prototype.readUint16LE=ae.prototype.readUInt16LE=function($e,ke){return $e=$e>>>0,ke||nt($e,2,this.length),this[$e]|this[$e+1]<<8},ae.prototype.readUint16BE=ae.prototype.readUInt16BE=function($e,ke){return $e=$e>>>0,ke||nt($e,2,this.length),this[$e]<<8|this[$e+1]},ae.prototype.readUint32LE=ae.prototype.readUInt32LE=function($e,ke){return $e=$e>>>0,ke||nt($e,4,this.length),(this[$e]|this[$e+1]<<8|this[$e+2]<<16)+this[$e+3]*16777216},ae.prototype.readUint32BE=ae.prototype.readUInt32BE=function($e,ke){return $e=$e>>>0,ke||nt($e,4,this.length),this[$e]*16777216+(this[$e+1]<<16|this[$e+2]<<8|this[$e+3])},ae.prototype.readBigUInt64LE=ft(function($e){$e=$e>>>0,je($e,"offset");const ke=this[$e],Ue=this[$e+7];(ke===void 0||Ue===void 0)&&He($e,this.length-8);const We=ke+this[++$e]*2**8+this[++$e]*2**16+this[++$e]*2**24,Qe=this[++$e]+this[++$e]*2**8+this[++$e]*2**16+Ue*2**24;return BigInt(We)+(BigInt(Qe)<<BigInt(32))}),ae.prototype.readBigUInt64BE=ft(function($e){$e=$e>>>0,je($e,"offset");const ke=this[$e],Ue=this[$e+7];(ke===void 0||Ue===void 0)&&He($e,this.length-8);const We=ke*2**24+this[++$e]*2**16+this[++$e]*2**8+this[++$e],Qe=this[++$e]*2**24+this[++$e]*2**16+this[++$e]*2**8+Ue;return(BigInt(We)<<BigInt(32))+BigInt(Qe)}),ae.prototype.readIntLE=function($e,ke,Ue){$e=$e>>>0,ke=ke>>>0,Ue||nt($e,ke,this.length);let We=this[$e],Qe=1,tt=0;for(;++tt<ke&&(Qe*=256);)We+=this[$e+tt]*Qe;return Qe*=128,We>=Qe&&(We-=Math.pow(2,8*ke)),We},ae.prototype.readIntBE=function($e,ke,Ue){$e=$e>>>0,ke=ke>>>0,Ue||nt($e,ke,this.length);let We=ke,Qe=1,tt=this[$e+--We];for(;We>0&&(Qe*=256);)tt+=this[$e+--We]*Qe;return Qe*=128,tt>=Qe&&(tt-=Math.pow(2,8*ke)),tt},ae.prototype.readInt8=function($e,ke){return $e=$e>>>0,ke||nt($e,1,this.length),this[$e]&128?(255-this[$e]+1)*-1:this[$e]},ae.prototype.readInt16LE=function($e,ke){$e=$e>>>0,ke||nt($e,2,this.length);const Ue=this[$e]|this[$e+1]<<8;return Ue&32768?Ue|4294901760:Ue},ae.prototype.readInt16BE=function($e,ke){$e=$e>>>0,ke||nt($e,2,this.length);const Ue=this[$e+1]|this[$e]<<8;return Ue&32768?Ue|4294901760:Ue},ae.prototype.readInt32LE=function($e,ke){return $e=$e>>>0,ke||nt($e,4,this.length),this[$e]|this[$e+1]<<8|this[$e+2]<<16|this[$e+3]<<24},ae.prototype.readInt32BE=function($e,ke){return $e=$e>>>0,ke||nt($e,4,this.length),this[$e]<<24|this[$e+1]<<16|this[$e+2]<<8|this[$e+3]},ae.prototype.readBigInt64LE=ft(function($e){$e=$e>>>0,je($e,"offset");const ke=this[$e],Ue=this[$e+7];(ke===void 0||Ue===void 0)&&He($e,this.length-8);const We=this[$e+4]+this[$e+5]*2**8+this[$e+6]*2**16+(Ue<<24);return(BigInt(We)<<BigInt(32))+BigInt(ke+this[++$e]*2**8+this[++$e]*2**16+this[++$e]*2**24)}),ae.prototype.readBigInt64BE=ft(function($e){$e=$e>>>0,je($e,"offset");const ke=this[$e],Ue=this[$e+7];(ke===void 0||Ue===void 0)&&He($e,this.length-8);const We=(ke<<24)+this[++$e]*2**16+this[++$e]*2**8+this[++$e];return(BigInt(We)<<BigInt(32))+BigInt(this[++$e]*2**24+this[++$e]*2**16+this[++$e]*2**8+Ue)}),ae.prototype.readFloatLE=function($e,ke){return $e=$e>>>0,ke||nt($e,4,this.length),le.read(this,$e,!0,23,4)},ae.prototype.readFloatBE=function($e,ke){return $e=$e>>>0,ke||nt($e,4,this.length),le.read(this,$e,!1,23,4)},ae.prototype.readDoubleLE=function($e,ke){return $e=$e>>>0,ke||nt($e,8,this.length),le.read(this,$e,!0,52,8)},ae.prototype.readDoubleBE=function($e,ke){return $e=$e>>>0,ke||nt($e,8,this.length),le.read(this,$e,!1,52,8)};function ut(Oe,$e,ke,Ue,We,Qe){if(!ae.isBuffer(Oe))throw new TypeError('"buffer" argument must be a Buffer instance');if($e>We||$e<Qe)throw new RangeError('"value" argument is out of bounds');if(ke+Ue>Oe.length)throw new RangeError("Index out of range")}ae.prototype.writeUintLE=ae.prototype.writeUIntLE=function($e,ke,Ue,We){if($e=+$e,ke=ke>>>0,Ue=Ue>>>0,!We){const Pt=Math.pow(2,8*Ue)-1;ut(this,$e,ke,Ue,Pt,0)}let Qe=1,tt=0;for(this[ke]=$e&255;++tt<Ue&&(Qe*=256);)this[ke+tt]=$e/Qe&255;return ke+Ue},ae.prototype.writeUintBE=ae.prototype.writeUIntBE=function($e,ke,Ue,We){if($e=+$e,ke=ke>>>0,Ue=Ue>>>0,!We){const Pt=Math.pow(2,8*Ue)-1;ut(this,$e,ke,Ue,Pt,0)}let Qe=Ue-1,tt=1;for(this[ke+Qe]=$e&255;--Qe>=0&&(tt*=256);)this[ke+Qe]=$e/tt&255;return ke+Ue},ae.prototype.writeUint8=ae.prototype.writeUInt8=function($e,ke,Ue){return $e=+$e,ke=ke>>>0,Ue||ut(this,$e,ke,1,255,0),this[ke]=$e&255,ke+1},ae.prototype.writeUint16LE=ae.prototype.writeUInt16LE=function($e,ke,Ue){return $e=+$e,ke=ke>>>0,Ue||ut(this,$e,ke,2,65535,0),this[ke]=$e&255,this[ke+1]=$e>>>8,ke+2},ae.prototype.writeUint16BE=ae.prototype.writeUInt16BE=function($e,ke,Ue){return $e=+$e,ke=ke>>>0,Ue||ut(this,$e,ke,2,65535,0),this[ke]=$e>>>8,this[ke+1]=$e&255,ke+2},ae.prototype.writeUint32LE=ae.prototype.writeUInt32LE=function($e,ke,Ue){return $e=+$e,ke=ke>>>0,Ue||ut(this,$e,ke,4,4294967295,0),this[ke+3]=$e>>>24,this[ke+2]=$e>>>16,this[ke+1]=$e>>>8,this[ke]=$e&255,ke+4},ae.prototype.writeUint32BE=ae.prototype.writeUInt32BE=function($e,ke,Ue){return $e=+$e,ke=ke>>>0,Ue||ut(this,$e,ke,4,4294967295,0),this[ke]=$e>>>24,this[ke+1]=$e>>>16,this[ke+2]=$e>>>8,this[ke+3]=$e&255,ke+4};function ot(Oe,$e,ke,Ue,We){Pe($e,Ue,We,Oe,ke,7);let Qe=Number($e&BigInt(4294967295));Oe[ke++]=Qe,Qe=Qe>>8,Oe[ke++]=Qe,Qe=Qe>>8,Oe[ke++]=Qe,Qe=Qe>>8,Oe[ke++]=Qe;let tt=Number($e>>BigInt(32)&BigInt(4294967295));return Oe[ke++]=tt,tt=tt>>8,Oe[ke++]=tt,tt=tt>>8,Oe[ke++]=tt,tt=tt>>8,Oe[ke++]=tt,ke}function vt(Oe,$e,ke,Ue,We){Pe($e,Ue,We,Oe,ke,7);let Qe=Number($e&BigInt(4294967295));Oe[ke+7]=Qe,Qe=Qe>>8,Oe[ke+6]=Qe,Qe=Qe>>8,Oe[ke+5]=Qe,Qe=Qe>>8,Oe[ke+4]=Qe;let tt=Number($e>>BigInt(32)&BigInt(4294967295));return Oe[ke+3]=tt,tt=tt>>8,Oe[ke+2]=tt,tt=tt>>8,Oe[ke+1]=tt,tt=tt>>8,Oe[ke]=tt,ke+8}ae.prototype.writeBigUInt64LE=ft(function($e,ke=0){return ot(this,$e,ke,BigInt(0),BigInt("0xffffffffffffffff"))}),ae.prototype.writeBigUInt64BE=ft(function($e,ke=0){return vt(this,$e,ke,BigInt(0),BigInt("0xffffffffffffffff"))}),ae.prototype.writeIntLE=function($e,ke,Ue,We){if($e=+$e,ke=ke>>>0,!We){const Nt=Math.pow(2,8*Ue-1);ut(this,$e,ke,Ue,Nt-1,-Nt)}let Qe=0,tt=1,Pt=0;for(this[ke]=$e&255;++Qe<Ue&&(tt*=256);)$e<0&&Pt===0&&this[ke+Qe-1]!==0&&(Pt=1),this[ke+Qe]=($e/tt>>0)-Pt&255;return ke+Ue},ae.prototype.writeIntBE=function($e,ke,Ue,We){if($e=+$e,ke=ke>>>0,!We){const Nt=Math.pow(2,8*Ue-1);ut(this,$e,ke,Ue,Nt-1,-Nt)}let Qe=Ue-1,tt=1,Pt=0;for(this[ke+Qe]=$e&255;--Qe>=0&&(tt*=256);)$e<0&&Pt===0&&this[ke+Qe+1]!==0&&(Pt=1),this[ke+Qe]=($e/tt>>0)-Pt&255;return ke+Ue},ae.prototype.writeInt8=function($e,ke,Ue){return $e=+$e,ke=ke>>>0,Ue||ut(this,$e,ke,1,127,-128),$e<0&&($e=255+$e+1),this[ke]=$e&255,ke+1},ae.prototype.writeInt16LE=function($e,ke,Ue){return $e=+$e,ke=ke>>>0,Ue||ut(this,$e,ke,2,32767,-32768),this[ke]=$e&255,this[ke+1]=$e>>>8,ke+2},ae.prototype.writeInt16BE=function($e,ke,Ue){return $e=+$e,ke=ke>>>0,Ue||ut(this,$e,ke,2,32767,-32768),this[ke]=$e>>>8,this[ke+1]=$e&255,ke+2},ae.prototype.writeInt32LE=function($e,ke,Ue){return $e=+$e,ke=ke>>>0,Ue||ut(this,$e,ke,4,2147483647,-2147483648),this[ke]=$e&255,this[ke+1]=$e>>>8,this[ke+2]=$e>>>16,this[ke+3]=$e>>>24,ke+4},ae.prototype.writeInt32BE=function($e,ke,Ue){return $e=+$e,ke=ke>>>0,Ue||ut(this,$e,ke,4,2147483647,-2147483648),$e<0&&($e=4294967295+$e+1),this[ke]=$e>>>24,this[ke+1]=$e>>>16,this[ke+2]=$e>>>8,this[ke+3]=$e&255,ke+4},ae.prototype.writeBigInt64LE=ft(function($e,ke=0){return ot(this,$e,ke,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),ae.prototype.writeBigInt64BE=ft(function($e,ke=0){return vt(this,$e,ke,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function bt(Oe,$e,ke,Ue,We,Qe){if(ke+Ue>Oe.length)throw new RangeError("Index out of range");if(ke<0)throw new RangeError("Index out of range")}function lt(Oe,$e,ke,Ue,We){return $e=+$e,ke=ke>>>0,We||bt(Oe,$e,ke,4),le.write(Oe,$e,ke,Ue,23,4),ke+4}ae.prototype.writeFloatLE=function($e,ke,Ue){return lt(this,$e,ke,!0,Ue)},ae.prototype.writeFloatBE=function($e,ke,Ue){return lt(this,$e,ke,!1,Ue)};function kt(Oe,$e,ke,Ue,We){return $e=+$e,ke=ke>>>0,We||bt(Oe,$e,ke,8),le.write(Oe,$e,ke,Ue,52,8),ke+8}ae.prototype.writeDoubleLE=function($e,ke,Ue){return kt(this,$e,ke,!0,Ue)},ae.prototype.writeDoubleBE=function($e,ke,Ue){return kt(this,$e,ke,!1,Ue)},ae.prototype.copy=function($e,ke,Ue,We){if(!ae.isBuffer($e))throw new TypeError("argument should be a Buffer");if(Ue||(Ue=0),!We&&We!==0&&(We=this.length),ke>=$e.length&&(ke=$e.length),ke||(ke=0),We>0&&We<Ue&&(We=Ue),We===Ue||$e.length===0||this.length===0)return 0;if(ke<0)throw new RangeError("targetStart out of bounds");if(Ue<0||Ue>=this.length)throw new RangeError("Index out of range");if(We<0)throw new RangeError("sourceEnd out of bounds");We>this.length&&(We=this.length),$e.length-ke<We-Ue&&(We=$e.length-ke+Ue);const Qe=We-Ue;return this===$e&&typeof ye.prototype.copyWithin=="function"?this.copyWithin(ke,Ue,We):ye.prototype.set.call($e,this.subarray(Ue,We),ke),Qe},ae.prototype.fill=function($e,ke,Ue,We){if(typeof $e=="string"){if(typeof ke=="string"?(We=ke,ke=0,Ue=this.length):typeof Ue=="string"&&(We=Ue,Ue=this.length),We!==void 0&&typeof We!="string")throw new TypeError("encoding must be a string");if(typeof We=="string"&&!ae.isEncoding(We))throw new TypeError("Unknown encoding: "+We);if($e.length===1){const tt=$e.charCodeAt(0);(We==="utf8"&&tt<128||We==="latin1")&&($e=tt)}}else typeof $e=="number"?$e=$e&255:typeof $e=="boolean"&&($e=Number($e));if(ke<0||this.length<ke||this.length<Ue)throw new RangeError("Out of range index");if(Ue<=ke)return this;ke=ke>>>0,Ue=Ue===void 0?this.length:Ue>>>0,$e||($e=0);let Qe;if(typeof $e=="number")for(Qe=ke;Qe<Ue;++Qe)this[Qe]=$e;else{const tt=ae.isBuffer($e)?$e:ae.from($e,We),Pt=tt.length;if(Pt===0)throw new TypeError('The value "'+$e+'" is invalid for argument "value"');for(Qe=0;Qe<Ue-ke;++Qe)this[Qe+ke]=tt[Qe%Pt]}return this};const Ct={};function Me(Oe,$e,ke){Ct[Oe]=class extends ke{constructor(){super(),Object.defineProperty(this,"message",{value:$e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Oe}]`,this.stack,delete this.name}get code(){return Oe}set code(We){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:We,writable:!0})}toString(){return`${this.name} [${Oe}]: ${this.message}`}}}Me("ERR_BUFFER_OUT_OF_BOUNDS",function(Oe){return Oe?`${Oe} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Me("ERR_INVALID_ARG_TYPE",function(Oe,$e){return`The "${Oe}" argument must be of type number. Received type ${typeof $e}`},TypeError),Me("ERR_OUT_OF_RANGE",function(Oe,$e,ke){let Ue=`The value of "${Oe}" is out of range.`,We=ke;return Number.isInteger(ke)&&Math.abs(ke)>2**32?We=Ce(String(ke)):typeof ke=="bigint"&&(We=String(ke),(ke>BigInt(2)**BigInt(32)||ke<-(BigInt(2)**BigInt(32)))&&(We=Ce(We)),We+="n"),Ue+=` It must be ${$e}. Received ${We}`,Ue},RangeError);function Ce(Oe){let $e="",ke=Oe.length;const Ue=Oe[0]==="-"?1:0;for(;ke>=Ue+4;ke-=3)$e=`_${Oe.slice(ke-3,ke)}${$e}`;return`${Oe.slice(0,ke)}${$e}`}function Ee(Oe,$e,ke){je($e,"offset"),(Oe[$e]===void 0||Oe[$e+ke]===void 0)&&He($e,Oe.length-(ke+1))}function Pe(Oe,$e,ke,Ue,We,Qe){if(Oe>ke||Oe<$e){const tt=typeof $e=="bigint"?"n":"";let Pt;throw $e===0||$e===BigInt(0)?Pt=`>= 0${tt} and < 2${tt} ** ${(Qe+1)*8}${tt}`:Pt=`>= -(2${tt} ** ${(Qe+1)*8-1}${tt}) and < 2 ** ${(Qe+1)*8-1}${tt}`,new Ct.ERR_OUT_OF_RANGE("value",Pt,Oe)}Ee(Ue,We,Qe)}function je(Oe,$e){if(typeof Oe!="number")throw new Ct.ERR_INVALID_ARG_TYPE($e,"number",Oe)}function He(Oe,$e,ke){throw Math.floor(Oe)!==Oe?(je(Oe,ke),new Ct.ERR_OUT_OF_RANGE("offset","an integer",Oe)):$e<0?new Ct.ERR_BUFFER_OUT_OF_BOUNDS:new Ct.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${$e}`,Oe)}const Ve=/[^+/0-9A-Za-z-_]/g;function dt(Oe){if(Oe=Oe.split("=")[0],Oe=Oe.trim().replace(Ve,""),Oe.length<2)return"";for(;Oe.length%4!==0;)Oe=Oe+"=";return Oe}function xt(Oe,$e){$e=$e||1/0;let ke;const Ue=Oe.length;let We=null;const Qe=[];for(let tt=0;tt<Ue;++tt){if(ke=Oe.charCodeAt(tt),ke>55295&&ke<57344){if(!We){if(ke>56319){($e-=3)>-1&&Qe.push(239,191,189);continue}else if(tt+1===Ue){($e-=3)>-1&&Qe.push(239,191,189);continue}We=ke;continue}if(ke<56320){($e-=3)>-1&&Qe.push(239,191,189),We=ke;continue}ke=(We-55296<<10|ke-56320)+65536}else We&&($e-=3)>-1&&Qe.push(239,191,189);if(We=null,ke<128){if(($e-=1)<0)break;Qe.push(ke)}else if(ke<2048){if(($e-=2)<0)break;Qe.push(ke>>6|192,ke&63|128)}else if(ke<65536){if(($e-=3)<0)break;Qe.push(ke>>12|224,ke>>6&63|128,ke&63|128)}else if(ke<1114112){if(($e-=4)<0)break;Qe.push(ke>>18|240,ke>>12&63|128,ke>>6&63|128,ke&63|128)}else throw new Error("Invalid code point")}return Qe}function mt(Oe){const $e=[];for(let ke=0;ke<Oe.length;++ke)$e.push(Oe.charCodeAt(ke)&255);return $e}function gt(Oe,$e){let ke,Ue,We;const Qe=[];for(let tt=0;tt<Oe.length&&!(($e-=2)<0);++tt)ke=Oe.charCodeAt(tt),Ue=ke>>8,We=ke%256,Qe.push(We),Qe.push(Ue);return Qe}function at(Oe){return oe.toByteArray(dt(Oe))}function ht(Oe,$e,ke,Ue){let We;for(We=0;We<Ue&&!(We+ke>=$e.length||We>=Oe.length);++We)$e[We+ke]=Oe[We];return We}function _t(Oe,$e){return Oe instanceof $e||Oe!=null&&Oe.constructor!=null&&Oe.constructor.name!=null&&Oe.constructor.name===$e.name}function $t(Oe){return Oe!==Oe}const St=(function(){const Oe="0123456789abcdef",$e=new Array(256);for(let ke=0;ke<16;++ke){const Ue=ke*16;for(let We=0;We<16;++We)$e[Ue+We]=Oe[ke]+Oe[We]}return $e})();function ft(Oe){return typeof BigInt>"u"?At:Oe}function At(){throw new Error("BigInt not supported")}})(u);const J=u.Buffer;y.Blob=u.Blob,y.BlobOptions=u.BlobOptions,y.Buffer=u.Buffer,y.File=u.File,y.FileOptions=u.FileOptions,y.INSPECT_MAX_BYTES=u.INSPECT_MAX_BYTES,y.SlowBuffer=u.SlowBuffer,y.TranscodeEncoding=u.TranscodeEncoding,y.atob=u.atob,y.btoa=u.btoa,y.constants=u.constants,y.default=J,y.isAscii=u.isAscii,y.isUtf8=u.isUtf8,y.kMaxLength=u.kMaxLength,y.kStringMaxLength=u.kStringMaxLength,y.resolveObjectURL=u.resolveObjectURL,y.transcode=u.transcode})(dist)),dist}var hasRequiredSafeBuffer$2;function requireSafeBuffer$2(){return hasRequiredSafeBuffer$2||(hasRequiredSafeBuffer$2=1,(function(y,u){var g=requireDist(),v=g.Buffer;function b(E,S){for(var A in E)S[A]=E[A]}v.from&&v.alloc&&v.allocUnsafe&&v.allocUnsafeSlow?y.exports=g:(b(g,u),u.Buffer=w);function w(E,S,A){return v(E,S,A)}w.prototype=Object.create(v.prototype),b(v,w),w.from=function(E,S,A){if(typeof E=="number")throw new TypeError("Argument must not be a number");return v(E,S,A)},w.alloc=function(E,S,A){if(typeof E!="number")throw new TypeError("Argument must be a number");var $=v(E);return S!==void 0?typeof A=="string"?$.fill(S,A):$.fill(S):$.fill(0),$},w.allocUnsafe=function(E){if(typeof E!="number")throw new TypeError("Argument must be a number");return v(E)},w.allocUnsafeSlow=function(E){if(typeof E!="number")throw new TypeError("Argument must be a number");return g.SlowBuffer(E)}})(safeBuffer$2,safeBuffer$2.exports)),safeBuffer$2.exports}var hasRequiredBrowser$d;function requireBrowser$d(){if(hasRequiredBrowser$d)return browser$e.exports;hasRequiredBrowser$d=1;var y=65536,u=4294967295;function g(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var v=requireSafeBuffer$2().Buffer,b=commonjsGlobal.crypto||commonjsGlobal.msCrypto;b&&b.getRandomValues?browser$e.exports=w:browser$e.exports=g;function w(E,S){if(E>u)throw new RangeError("requested too many random bytes");var A=v.allocUnsafe(E);if(E>0)if(E>y)for(var $=0;$<E;$+=y)b.getRandomValues(A.slice($,$+y));else b.getRandomValues(A);return typeof S=="function"?process$1.nextTick(function(){S(null,A)}):A}return browser$e.exports}var inherits_browser={exports:{}},hasRequiredInherits_browser;function requireInherits_browser(){return hasRequiredInherits_browser||(hasRequiredInherits_browser=1,typeof Object.create=="function"?inherits_browser.exports=function(u,g){g&&(u.super_=g,u.prototype=Object.create(g.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(u,g){if(g){u.super_=g;var v=function(){};v.prototype=g.prototype,u.prototype=new v,u.prototype.constructor=u}}),inherits_browser.exports}var events={exports:{}},hasRequiredEvents;function requireEvents(){if(hasRequiredEvents)return events.exports;hasRequiredEvents=1;var y=typeof Reflect=="object"?Reflect:null,u=y&&typeof y.apply=="function"?y.apply:function(de,fe,ye){return Function.prototype.apply.call(de,fe,ye)},g;y&&typeof y.ownKeys=="function"?g=y.ownKeys:Object.getOwnPropertySymbols?g=function(de){return Object.getOwnPropertyNames(de).concat(Object.getOwnPropertySymbols(de))}:g=function(de){return Object.getOwnPropertyNames(de)};function v(le){console&&console.warn&&console.warn(le)}var b=Number.isNaN||function(de){return de!==de};function w(){w.init.call(this)}events.exports=w,events.exports.once=J,w.EventEmitter=w,w.prototype._events=void 0,w.prototype._eventsCount=0,w.prototype._maxListeners=void 0;var E=10;function S(le){if(typeof le!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof le)}Object.defineProperty(w,"defaultMaxListeners",{enumerable:!0,get:function(){return E},set:function(le){if(typeof le!="number"||le<0||b(le))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+le+".");E=le}}),w.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},w.prototype.setMaxListeners=function(de){if(typeof de!="number"||de<0||b(de))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+de+".");return this._maxListeners=de,this};function A(le){return le._maxListeners===void 0?w.defaultMaxListeners:le._maxListeners}w.prototype.getMaxListeners=function(){return A(this)},w.prototype.emit=function(de){for(var fe=[],ye=1;ye<arguments.length;ye++)fe.push(arguments[ye]);var we=de==="error",pe=this._events;if(pe!==void 0)we=we&&pe.error===void 0;else if(!we)return!1;if(we){var ve;if(fe.length>0&&(ve=fe[0]),ve instanceof Error)throw ve;var he=new Error("Unhandled error."+(ve?" ("+ve.message+")":""));throw he.context=ve,he}var ae=pe[de];if(ae===void 0)return!1;if(typeof ae=="function")u(ae,this,fe);else for(var Q=ae.length,j=F(ae,Q),ye=0;ye<Q;++ye)u(j[ye],this,fe);return!0};function $(le,de,fe,ye){var we,pe,ve;if(S(fe),pe=le._events,pe===void 0?(pe=le._events=Object.create(null),le._eventsCount=0):(pe.newListener!==void 0&&(le.emit("newListener",de,fe.listener?fe.listener:fe),pe=le._events),ve=pe[de]),ve===void 0)ve=pe[de]=fe,++le._eventsCount;else if(typeof ve=="function"?ve=pe[de]=ye?[fe,ve]:[ve,fe]:ye?ve.unshift(fe):ve.push(fe),we=A(le),we>0&&ve.length>we&&!ve.warned){ve.warned=!0;var he=new Error("Possible EventEmitter memory leak detected. "+ve.length+" "+String(de)+" listeners added. Use emitter.setMaxListeners() to increase limit");he.name="MaxListenersExceededWarning",he.emitter=le,he.type=de,he.count=ve.length,v(he)}return le}w.prototype.addListener=function(de,fe){return $(this,de,fe,!1)},w.prototype.on=w.prototype.addListener,w.prototype.prependListener=function(de,fe){return $(this,de,fe,!0)};function R(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function T(le,de,fe){var ye={fired:!1,wrapFn:void 0,target:le,type:de,listener:fe},we=R.bind(ye);return we.listener=fe,ye.wrapFn=we,we}w.prototype.once=function(de,fe){return S(fe),this.on(de,T(this,de,fe)),this},w.prototype.prependOnceListener=function(de,fe){return S(fe),this.prependListener(de,T(this,de,fe)),this},w.prototype.removeListener=function(de,fe){var ye,we,pe,ve,he;if(S(fe),we=this._events,we===void 0)return this;if(ye=we[de],ye===void 0)return this;if(ye===fe||ye.listener===fe)--this._eventsCount===0?this._events=Object.create(null):(delete we[de],we.removeListener&&this.emit("removeListener",de,ye.listener||fe));else if(typeof ye!="function"){for(pe=-1,ve=ye.length-1;ve>=0;ve--)if(ye[ve]===fe||ye[ve].listener===fe){he=ye[ve].listener,pe=ve;break}if(pe<0)return this;pe===0?ye.shift():U(ye,pe),ye.length===1&&(we[de]=ye[0]),we.removeListener!==void 0&&this.emit("removeListener",de,he||fe)}return this},w.prototype.off=w.prototype.removeListener,w.prototype.removeAllListeners=function(de){var fe,ye,we;if(ye=this._events,ye===void 0)return this;if(ye.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):ye[de]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete ye[de]),this;if(arguments.length===0){var pe=Object.keys(ye),ve;for(we=0;we<pe.length;++we)ve=pe[we],ve!=="removeListener"&&this.removeAllListeners(ve);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(fe=ye[de],typeof fe=="function")this.removeListener(de,fe);else if(fe!==void 0)for(we=fe.length-1;we>=0;we--)this.removeListener(de,fe[we]);return this};function O(le,de,fe){var ye=le._events;if(ye===void 0)return[];var we=ye[de];return we===void 0?[]:typeof we=="function"?fe?[we.listener||we]:[we]:fe?q(we):F(we,we.length)}w.prototype.listeners=function(de){return O(this,de,!0)},w.prototype.rawListeners=function(de){return O(this,de,!1)},w.listenerCount=function(le,de){return typeof le.listenerCount=="function"?le.listenerCount(de):B.call(le,de)},w.prototype.listenerCount=B;function B(le){var de=this._events;if(de!==void 0){var fe=de[le];if(typeof fe=="function")return 1;if(fe!==void 0)return fe.length}return 0}w.prototype.eventNames=function(){return this._eventsCount>0?g(this._events):[]};function F(le,de){for(var fe=new Array(de),ye=0;ye<de;++ye)fe[ye]=le[ye];return fe}function U(le,de){for(;de+1<le.length;de++)le[de]=le[de+1];le.pop()}function q(le){for(var de=new Array(le.length),fe=0;fe<de.length;++fe)de[fe]=le[fe].listener||le[fe];return de}function J(le,de){return new Promise(function(fe,ye){function we(ve){le.removeListener(de,pe),ye(ve)}function pe(){typeof le.removeListener=="function"&&le.removeListener("error",we),fe([].slice.call(arguments))}oe(le,de,pe,{once:!0}),de!=="error"&&ie(le,we,{once:!0})})}function ie(le,de,fe){typeof le.on=="function"&&oe(le,"error",de,fe)}function oe(le,de,fe,ye){if(typeof le.on=="function")ye.once?le.once(de,fe):le.on(de,fe);else if(typeof le.addEventListener=="function")le.addEventListener(de,function we(pe){ye.once&&le.removeEventListener(de,we),fe(pe)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof le)}return events.exports}var streamBrowser$2,hasRequiredStreamBrowser$2;function requireStreamBrowser$2(){return hasRequiredStreamBrowser$2||(hasRequiredStreamBrowser$2=1,streamBrowser$2=requireEvents().EventEmitter),streamBrowser$2}var util$1={},types={},shams$1,hasRequiredShams$1;function requireShams$1(){return hasRequiredShams$1||(hasRequiredShams$1=1,shams$1=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var u={},g=Symbol("test"),v=Object(g);if(typeof g=="string"||Object.prototype.toString.call(g)!=="[object Symbol]"||Object.prototype.toString.call(v)!=="[object Symbol]")return!1;var b=42;u[g]=b;for(var w in u)return!1;if(typeof Object.keys=="function"&&Object.keys(u).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(u).length!==0)return!1;var E=Object.getOwnPropertySymbols(u);if(E.length!==1||E[0]!==g||!Object.prototype.propertyIsEnumerable.call(u,g))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var S=Object.getOwnPropertyDescriptor(u,g);if(S.value!==b||S.enumerable!==!0)return!1}return!0}),shams$1}var shams,hasRequiredShams;function requireShams(){if(hasRequiredShams)return shams;hasRequiredShams=1;var y=requireShams$1();return shams=function(){return y()&&!!Symbol.toStringTag},shams}var esObjectAtoms,hasRequiredEsObjectAtoms;function requireEsObjectAtoms(){return hasRequiredEsObjectAtoms||(hasRequiredEsObjectAtoms=1,esObjectAtoms=Object),esObjectAtoms}var esErrors,hasRequiredEsErrors;function requireEsErrors(){return hasRequiredEsErrors||(hasRequiredEsErrors=1,esErrors=Error),esErrors}var _eval,hasRequired_eval;function require_eval(){return hasRequired_eval||(hasRequired_eval=1,_eval=EvalError),_eval}var range,hasRequiredRange;function requireRange(){return hasRequiredRange||(hasRequiredRange=1,range=RangeError),range}var ref,hasRequiredRef;function requireRef(){return hasRequiredRef||(hasRequiredRef=1,ref=ReferenceError),ref}var syntax,hasRequiredSyntax;function requireSyntax(){return hasRequiredSyntax||(hasRequiredSyntax=1,syntax=SyntaxError),syntax}var type,hasRequiredType;function requireType(){return hasRequiredType||(hasRequiredType=1,type=TypeError),type}var uri,hasRequiredUri;function requireUri(){return hasRequiredUri||(hasRequiredUri=1,uri=URIError),uri}var abs,hasRequiredAbs;function requireAbs(){return hasRequiredAbs||(hasRequiredAbs=1,abs=Math.abs),abs}var floor,hasRequiredFloor;function requireFloor(){return hasRequiredFloor||(hasRequiredFloor=1,floor=Math.floor),floor}var max,hasRequiredMax;function requireMax(){return hasRequiredMax||(hasRequiredMax=1,max=Math.max),max}var min,hasRequiredMin;function requireMin(){return hasRequiredMin||(hasRequiredMin=1,min=Math.min),min}var pow,hasRequiredPow;function requirePow(){return hasRequiredPow||(hasRequiredPow=1,pow=Math.pow),pow}var round,hasRequiredRound;function requireRound(){return hasRequiredRound||(hasRequiredRound=1,round=Math.round),round}var _isNaN,hasRequired_isNaN;function require_isNaN(){return hasRequired_isNaN||(hasRequired_isNaN=1,_isNaN=Number.isNaN||function(u){return u!==u}),_isNaN}var sign$2,hasRequiredSign$1;function requireSign$1(){if(hasRequiredSign$1)return sign$2;hasRequiredSign$1=1;var y=require_isNaN();return sign$2=function(g){return y(g)||g===0?g:g<0?-1:1},sign$2}var gOPD,hasRequiredGOPD;function requireGOPD(){return hasRequiredGOPD||(hasRequiredGOPD=1,gOPD=Object.getOwnPropertyDescriptor),gOPD}var gopd,hasRequiredGopd;function requireGopd(){if(hasRequiredGopd)return gopd;hasRequiredGopd=1;var y=requireGOPD();if(y)try{y([],"length")}catch{y=null}return gopd=y,gopd}var esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var y=Object.defineProperty||!1;if(y)try{y({},"a",{value:1})}catch{y=!1}return esDefineProperty=y,esDefineProperty}var hasSymbols,hasRequiredHasSymbols;function requireHasSymbols(){if(hasRequiredHasSymbols)return hasSymbols;hasRequiredHasSymbols=1;var y=typeof Symbol<"u"&&Symbol,u=requireShams$1();return hasSymbols=function(){return typeof y!="function"||typeof Symbol!="function"||typeof y("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:u()},hasSymbols}var Reflect_getPrototypeOf,hasRequiredReflect_getPrototypeOf;function requireReflect_getPrototypeOf(){return hasRequiredReflect_getPrototypeOf||(hasRequiredReflect_getPrototypeOf=1,Reflect_getPrototypeOf=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Reflect_getPrototypeOf}var Object_getPrototypeOf,hasRequiredObject_getPrototypeOf;function requireObject_getPrototypeOf(){if(hasRequiredObject_getPrototypeOf)return Object_getPrototypeOf;hasRequiredObject_getPrototypeOf=1;var y=requireEsObjectAtoms();return Object_getPrototypeOf=y.getPrototypeOf||null,Object_getPrototypeOf}var implementation$1,hasRequiredImplementation;function requireImplementation(){if(hasRequiredImplementation)return implementation$1;hasRequiredImplementation=1;var y="Function.prototype.bind called on incompatible ",u=Object.prototype.toString,g=Math.max,v="[object Function]",b=function(A,$){for(var R=[],T=0;T<A.length;T+=1)R[T]=A[T];for(var O=0;O<$.length;O+=1)R[O+A.length]=$[O];return R},w=function(A,$){for(var R=[],T=$,O=0;T<A.length;T+=1,O+=1)R[O]=A[T];return R},E=function(S,A){for(var $="",R=0;R<S.length;R+=1)$+=S[R],R+1<S.length&&($+=A);return $};return implementation$1=function(A){var $=this;if(typeof $!="function"||u.apply($)!==v)throw new TypeError(y+$);for(var R=w(arguments,1),T,O=function(){if(this instanceof T){var J=$.apply(this,b(R,arguments));return Object(J)===J?J:this}return $.apply(A,b(R,arguments))},B=g(0,$.length-R.length),F=[],U=0;U<B;U++)F[U]="$"+U;if(T=Function("binder","return function ("+E(F,",")+"){ return binder.apply(this,arguments); }")(O),$.prototype){var q=function(){};q.prototype=$.prototype,T.prototype=new q,q.prototype=null}return T},implementation$1}var functionBind,hasRequiredFunctionBind;function requireFunctionBind(){if(hasRequiredFunctionBind)return functionBind;hasRequiredFunctionBind=1;var y=requireImplementation();return functionBind=Function.prototype.bind||y,functionBind}var functionCall,hasRequiredFunctionCall;function requireFunctionCall(){return hasRequiredFunctionCall||(hasRequiredFunctionCall=1,functionCall=Function.prototype.call),functionCall}var functionApply,hasRequiredFunctionApply;function requireFunctionApply(){return hasRequiredFunctionApply||(hasRequiredFunctionApply=1,functionApply=Function.prototype.apply),functionApply}var reflectApply,hasRequiredReflectApply;function requireReflectApply(){return hasRequiredReflectApply||(hasRequiredReflectApply=1,reflectApply=typeof Reflect<"u"&&Reflect&&Reflect.apply),reflectApply}var actualApply,hasRequiredActualApply;function requireActualApply(){if(hasRequiredActualApply)return actualApply;hasRequiredActualApply=1;var y=requireFunctionBind(),u=requireFunctionApply(),g=requireFunctionCall(),v=requireReflectApply();return actualApply=v||y.call(g,u),actualApply}var callBindApplyHelpers,hasRequiredCallBindApplyHelpers;function requireCallBindApplyHelpers(){if(hasRequiredCallBindApplyHelpers)return callBindApplyHelpers;hasRequiredCallBindApplyHelpers=1;var y=requireFunctionBind(),u=requireType(),g=requireFunctionCall(),v=requireActualApply();return callBindApplyHelpers=function(w){if(w.length<1||typeof w[0]!="function")throw new u("a function is required");return v(y,g,w)},callBindApplyHelpers}var get$1,hasRequiredGet;function requireGet(){if(hasRequiredGet)return get$1;hasRequiredGet=1;var y=requireCallBindApplyHelpers(),u=requireGopd(),g;try{g=[].__proto__===Array.prototype}catch(E){if(!E||typeof E!="object"||!("code"in E)||E.code!=="ERR_PROTO_ACCESS")throw E}var v=!!g&&u&&u(Object.prototype,"__proto__"),b=Object,w=b.getPrototypeOf;return get$1=v&&typeof v.get=="function"?y([v.get]):typeof w=="function"?function(S){return w(S==null?S:b(S))}:!1,get$1}var getProto,hasRequiredGetProto;function requireGetProto(){if(hasRequiredGetProto)return getProto;hasRequiredGetProto=1;var y=requireReflect_getPrototypeOf(),u=requireObject_getPrototypeOf(),g=requireGet();return getProto=y?function(b){return y(b)}:u?function(b){if(!b||typeof b!="object"&&typeof b!="function")throw new TypeError("getProto: not an object");return u(b)}:g?function(b){return g(b)}:null,getProto}var hasown,hasRequiredHasown;function requireHasown(){if(hasRequiredHasown)return hasown;hasRequiredHasown=1;var y=Function.prototype.call,u=Object.prototype.hasOwnProperty,g=requireFunctionBind();return hasown=g.call(y,u),hasown}var getIntrinsic,hasRequiredGetIntrinsic;function requireGetIntrinsic(){if(hasRequiredGetIntrinsic)return getIntrinsic;hasRequiredGetIntrinsic=1;var y,u=requireEsObjectAtoms(),g=requireEsErrors(),v=require_eval(),b=requireRange(),w=requireRef(),E=requireSyntax(),S=requireType(),A=requireUri(),$=requireAbs(),R=requireFloor(),T=requireMax(),O=requireMin(),B=requirePow(),F=requireRound(),U=requireSign$1(),q=Function,J=function(Te){try{return q('"use strict"; return ('+Te+").constructor;")()}catch{}},ie=requireGopd(),oe=requireEsDefineProperty(),le=function(){throw new S},de=ie?(function(){try{return arguments.callee,le}catch{try{return ie(arguments,"callee").get}catch{return le}}})():le,fe=requireHasSymbols()(),ye=requireGetProto(),we=requireObject_getPrototypeOf(),pe=requireReflect_getPrototypeOf(),ve=requireFunctionApply(),he=requireFunctionCall(),ae={},Q=typeof Uint8Array>"u"||!ye?y:ye(Uint8Array),j={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?y:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?y:ArrayBuffer,"%ArrayIteratorPrototype%":fe&&ye?ye([][Symbol.iterator]()):y,"%AsyncFromSyncIteratorPrototype%":y,"%AsyncFunction%":ae,"%AsyncGenerator%":ae,"%AsyncGeneratorFunction%":ae,"%AsyncIteratorPrototype%":ae,"%Atomics%":typeof Atomics>"u"?y:Atomics,"%BigInt%":typeof BigInt>"u"?y:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?y:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?y:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?y:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":g,"%eval%":eval,"%EvalError%":v,"%Float16Array%":typeof Float16Array>"u"?y:Float16Array,"%Float32Array%":typeof Float32Array>"u"?y:Float32Array,"%Float64Array%":typeof Float64Array>"u"?y:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?y:FinalizationRegistry,"%Function%":q,"%GeneratorFunction%":ae,"%Int8Array%":typeof Int8Array>"u"?y:Int8Array,"%Int16Array%":typeof Int16Array>"u"?y:Int16Array,"%Int32Array%":typeof Int32Array>"u"?y:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":fe&&ye?ye(ye([][Symbol.iterator]())):y,"%JSON%":typeof JSON=="object"?JSON:y,"%Map%":typeof Map>"u"?y:Map,"%MapIteratorPrototype%":typeof Map>"u"||!fe||!ye?y:ye(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":u,"%Object.getOwnPropertyDescriptor%":ie,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?y:Promise,"%Proxy%":typeof Proxy>"u"?y:Proxy,"%RangeError%":b,"%ReferenceError%":w,"%Reflect%":typeof Reflect>"u"?y:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?y:Set,"%SetIteratorPrototype%":typeof Set>"u"||!fe||!ye?y:ye(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?y:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":fe&&ye?ye(""[Symbol.iterator]()):y,"%Symbol%":fe?Symbol:y,"%SyntaxError%":E,"%ThrowTypeError%":de,"%TypedArray%":Q,"%TypeError%":S,"%Uint8Array%":typeof Uint8Array>"u"?y:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?y:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?y:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?y:Uint32Array,"%URIError%":A,"%WeakMap%":typeof WeakMap>"u"?y:WeakMap,"%WeakRef%":typeof WeakRef>"u"?y:WeakRef,"%WeakSet%":typeof WeakSet>"u"?y:WeakSet,"%Function.prototype.call%":he,"%Function.prototype.apply%":ve,"%Object.defineProperty%":oe,"%Object.getPrototypeOf%":we,"%Math.abs%":$,"%Math.floor%":R,"%Math.max%":T,"%Math.min%":O,"%Math.pow%":B,"%Math.round%":F,"%Math.sign%":U,"%Reflect.getPrototypeOf%":pe};if(ye)try{null.error}catch(Te){var z=ye(ye(Te));j["%Error.prototype%"]=z}var re=function Te(De){var Ie;if(De==="%AsyncFunction%")Ie=J("async function () {}");else if(De==="%GeneratorFunction%")Ie=J("function* () {}");else if(De==="%AsyncGeneratorFunction%")Ie=J("async function* () {}");else if(De==="%AsyncGenerator%"){var Se=Te("%AsyncGeneratorFunction%");Se&&(Ie=Se.prototype)}else if(De==="%AsyncIteratorPrototype%"){var Be=Te("%AsyncGenerator%");Be&&ye&&(Ie=ye(Be.prototype))}return j[De]=Ie,Ie},Y={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},te=requireFunctionBind(),ne=requireHasown(),se=te.call(he,Array.prototype.concat),ee=te.call(ve,Array.prototype.splice),Z=te.call(he,String.prototype.replace),ue=te.call(he,String.prototype.slice),_e=te.call(he,RegExp.prototype.exec),Re=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ae=/\\(\\)?/g,ge=function(De){var Ie=ue(De,0,1),Se=ue(De,-1);if(Ie==="%"&&Se!=="%")throw new E("invalid intrinsic syntax, expected closing `%`");if(Se==="%"&&Ie!=="%")throw new E("invalid intrinsic syntax, expected opening `%`");var Be=[];return Z(De,Re,function(Le,qe,Ke,Ge){Be[Be.length]=Ke?Z(Ge,Ae,"$1"):qe||Le}),Be},be=function(De,Ie){var Se=De,Be;if(ne(Y,Se)&&(Be=Y[Se],Se="%"+Be[0]+"%"),ne(j,Se)){var Le=j[Se];if(Le===ae&&(Le=re(Se)),typeof Le>"u"&&!Ie)throw new S("intrinsic "+De+" exists, but is not available. Please file an issue!");return{alias:Be,name:Se,value:Le}}throw new E("intrinsic "+De+" does not exist!")};return getIntrinsic=function(De,Ie){if(typeof De!="string"||De.length===0)throw new S("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Ie!="boolean")throw new S('"allowMissing" argument must be a boolean');if(_e(/^%?[^%]*%?$/,De)===null)throw new E("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Se=ge(De),Be=Se.length>0?Se[0]:"",Le=be("%"+Be+"%",Ie),qe=Le.name,Ke=Le.value,Ge=!1,Xe=Le.alias;Xe&&(Be=Xe[0],ee(Se,se([0,1],Xe)));for(var ze=1,et=!0;ze<Se.length;ze+=1){var Ze=Se[ze],nt=ue(Ze,0,1),ut=ue(Ze,-1);if((nt==='"'||nt==="'"||nt==="`"||ut==='"'||ut==="'"||ut==="`")&&nt!==ut)throw new E("property names with quotes must have matching quotes");if((Ze==="constructor"||!et)&&(Ge=!0),Be+="."+Ze,qe="%"+Be+"%",ne(j,qe))Ke=j[qe];else if(Ke!=null){if(!(Ze in Ke)){if(!Ie)throw new S("base intrinsic for "+De+" exists, but the property is not available.");return}if(ie&&ze+1>=Se.length){var ot=ie(Ke,Ze);et=!!ot,et&&"get"in ot&&!("originalValue"in ot.get)?Ke=ot.get:Ke=Ke[Ze]}else et=ne(Ke,Ze),Ke=Ke[Ze];et&&!Ge&&(j[qe]=Ke)}}return Ke},getIntrinsic}var callBound,hasRequiredCallBound;function requireCallBound(){if(hasRequiredCallBound)return callBound;hasRequiredCallBound=1;var y=requireGetIntrinsic(),u=requireCallBindApplyHelpers(),g=u([y("%String.prototype.indexOf%")]);return callBound=function(b,w){var E=y(b,!!w);return typeof E=="function"&&g(b,".prototype.")>-1?u([E]):E},callBound}var isArguments,hasRequiredIsArguments;function requireIsArguments(){if(hasRequiredIsArguments)return isArguments;hasRequiredIsArguments=1;var y=requireShams()(),u=requireCallBound(),g=u("Object.prototype.toString"),v=function(S){return y&&S&&typeof S=="object"&&Symbol.toStringTag in S?!1:g(S)==="[object Arguments]"},b=function(S){return v(S)?!0:S!==null&&typeof S=="object"&&"length"in S&&typeof S.length=="number"&&S.length>=0&&g(S)!=="[object Array]"&&"callee"in S&&g(S.callee)==="[object Function]"},w=(function(){return v(arguments)})();return v.isLegacyArguments=b,isArguments=w?v:b,isArguments}var isRegex,hasRequiredIsRegex;function requireIsRegex(){if(hasRequiredIsRegex)return isRegex;hasRequiredIsRegex=1;var y=requireCallBound(),u=requireShams()(),g=requireHasown(),v=requireGopd(),b;if(u){var w=y("RegExp.prototype.exec"),E={},S=function(){throw E},A={toString:S,valueOf:S};typeof Symbol.toPrimitive=="symbol"&&(A[Symbol.toPrimitive]=S),b=function(O){if(!O||typeof O!="object")return!1;var B=v(O,"lastIndex"),F=B&&g(B,"value");if(!F)return!1;try{w(O,A)}catch(U){return U===E}}}else{var $=y("Object.prototype.toString"),R="[object RegExp]";b=function(O){return!O||typeof O!="object"&&typeof O!="function"?!1:$(O)===R}}return isRegex=b,isRegex}var safeRegexTest,hasRequiredSafeRegexTest;function requireSafeRegexTest(){if(hasRequiredSafeRegexTest)return safeRegexTest;hasRequiredSafeRegexTest=1;var y=requireCallBound(),u=requireIsRegex(),g=y("RegExp.prototype.exec"),v=requireType();return safeRegexTest=function(w){if(!u(w))throw new v("`regex` must be a RegExp");return function(S){return g(w,S)!==null}},safeRegexTest}var generatorFunction,hasRequiredGeneratorFunction;function requireGeneratorFunction(){if(hasRequiredGeneratorFunction)return generatorFunction;hasRequiredGeneratorFunction=1;const y=(function*(){}).constructor;return generatorFunction=()=>y,generatorFunction}var isGeneratorFunction,hasRequiredIsGeneratorFunction;function requireIsGeneratorFunction(){if(hasRequiredIsGeneratorFunction)return isGeneratorFunction;hasRequiredIsGeneratorFunction=1;var y=requireCallBound(),u=requireSafeRegexTest(),g=u(/^\s*(?:function)?\*/),v=requireShams()(),b=requireGetProto(),w=y("Object.prototype.toString"),E=y("Function.prototype.toString"),S=requireGeneratorFunction();return isGeneratorFunction=function($){if(typeof $!="function")return!1;if(g(E($)))return!0;if(!v){var R=w($);return R==="[object GeneratorFunction]"}if(!b)return!1;var T=S();return T&&b($)===T.prototype},isGeneratorFunction}var isCallable,hasRequiredIsCallable;function requireIsCallable(){if(hasRequiredIsCallable)return isCallable;hasRequiredIsCallable=1;var y=Function.prototype.toString,u=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,g,v;if(typeof u=="function"&&typeof Object.defineProperty=="function")try{g=Object.defineProperty({},"length",{get:function(){throw v}}),v={},u(function(){throw 42},null,g)}catch(ie){ie!==v&&(u=null)}else u=null;var b=/^\s*class\b/,w=function(oe){try{var le=y.call(oe);return b.test(le)}catch{return!1}},E=function(oe){try{return w(oe)?!1:(y.call(oe),!0)}catch{return!1}},S=Object.prototype.toString,A="[object Object]",$="[object Function]",R="[object GeneratorFunction]",T="[object HTMLAllCollection]",O="[object HTML document.all class]",B="[object HTMLCollection]",F=typeof Symbol=="function"&&!!Symbol.toStringTag,U=!(0 in[,]),q=function(){return!1};if(typeof document=="object"){var J=document.all;S.call(J)===S.call(document.all)&&(q=function(oe){if((U||!oe)&&(typeof oe>"u"||typeof oe=="object"))try{var le=S.call(oe);return(le===T||le===O||le===B||le===A)&&oe("")==null}catch{}return!1})}return isCallable=u?function(oe){if(q(oe))return!0;if(!oe||typeof oe!="function"&&typeof oe!="object")return!1;try{u(oe,null,g)}catch(le){if(le!==v)return!1}return!w(oe)&&E(oe)}:function(oe){if(q(oe))return!0;if(!oe||typeof oe!="function"&&typeof oe!="object")return!1;if(F)return E(oe);if(w(oe))return!1;var le=S.call(oe);return le!==$&&le!==R&&!/^\[object HTML/.test(le)?!1:E(oe)},isCallable}var forEach$1,hasRequiredForEach;function requireForEach(){if(hasRequiredForEach)return forEach$1;hasRequiredForEach=1;var y=requireIsCallable(),u=Object.prototype.toString,g=Object.prototype.hasOwnProperty,v=function(A,$,R){for(var T=0,O=A.length;T<O;T++)g.call(A,T)&&(R==null?$(A[T],T,A):$.call(R,A[T],T,A))},b=function(A,$,R){for(var T=0,O=A.length;T<O;T++)R==null?$(A.charAt(T),T,A):$.call(R,A.charAt(T),T,A)},w=function(A,$,R){for(var T in A)g.call(A,T)&&(R==null?$(A[T],T,A):$.call(R,A[T],T,A))};function E(S){return u.call(S)==="[object Array]"}return forEach$1=function(A,$,R){if(!y($))throw new TypeError("iterator must be a function");var T;arguments.length>=3&&(T=R),E(A)?v(A,$,T):typeof A=="string"?b(A,$,T):w(A,$,T)},forEach$1}var possibleTypedArrayNames,hasRequiredPossibleTypedArrayNames;function requirePossibleTypedArrayNames(){return hasRequiredPossibleTypedArrayNames||(hasRequiredPossibleTypedArrayNames=1,possibleTypedArrayNames=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),possibleTypedArrayNames}var availableTypedArrays,hasRequiredAvailableTypedArrays;function requireAvailableTypedArrays(){if(hasRequiredAvailableTypedArrays)return availableTypedArrays;hasRequiredAvailableTypedArrays=1;var y=requirePossibleTypedArrayNames(),u=typeof globalThis>"u"?commonjsGlobal:globalThis;return availableTypedArrays=function(){for(var v=[],b=0;b<y.length;b++)typeof u[y[b]]=="function"&&(v[v.length]=y[b]);return v},availableTypedArrays}var callBind={exports:{}},defineDataProperty,hasRequiredDefineDataProperty;function requireDefineDataProperty(){if(hasRequiredDefineDataProperty)return defineDataProperty;hasRequiredDefineDataProperty=1;var y=requireEsDefineProperty(),u=requireSyntax(),g=requireType(),v=requireGopd();return defineDataProperty=function(w,E,S){if(!w||typeof w!="object"&&typeof w!="function")throw new g("`obj` must be an object or a function`");if(typeof E!="string"&&typeof E!="symbol")throw new g("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new g("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new g("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new g("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new g("`loose`, if provided, must be a boolean");var A=arguments.length>3?arguments[3]:null,$=arguments.length>4?arguments[4]:null,R=arguments.length>5?arguments[5]:null,T=arguments.length>6?arguments[6]:!1,O=!!v&&v(w,E);if(y)y(w,E,{configurable:R===null&&O?O.configurable:!R,enumerable:A===null&&O?O.enumerable:!A,value:S,writable:$===null&&O?O.writable:!$});else if(T||!A&&!$&&!R)w[E]=S;else throw new u("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},defineDataProperty}var hasPropertyDescriptors_1,hasRequiredHasPropertyDescriptors;function requireHasPropertyDescriptors(){if(hasRequiredHasPropertyDescriptors)return hasPropertyDescriptors_1;hasRequiredHasPropertyDescriptors=1;var y=requireEsDefineProperty(),u=function(){return!!y};return u.hasArrayLengthDefineBug=function(){if(!y)return null;try{return y([],"length",{value:1}).length!==1}catch{return!0}},hasPropertyDescriptors_1=u,hasPropertyDescriptors_1}var setFunctionLength,hasRequiredSetFunctionLength;function requireSetFunctionLength(){if(hasRequiredSetFunctionLength)return setFunctionLength;hasRequiredSetFunctionLength=1;var y=requireGetIntrinsic(),u=requireDefineDataProperty(),g=requireHasPropertyDescriptors()(),v=requireGopd(),b=requireType(),w=y("%Math.floor%");return setFunctionLength=function(S,A){if(typeof S!="function")throw new b("`fn` is not a function");if(typeof A!="number"||A<0||A>4294967295||w(A)!==A)throw new b("`length` must be a positive 32-bit integer");var $=arguments.length>2&&!!arguments[2],R=!0,T=!0;if("length"in S&&v){var O=v(S,"length");O&&!O.configurable&&(R=!1),O&&!O.writable&&(T=!1)}return(R||T||!$)&&(g?u(S,"length",A,!0,!0):u(S,"length",A)),S},setFunctionLength}var applyBind,hasRequiredApplyBind;function requireApplyBind(){if(hasRequiredApplyBind)return applyBind;hasRequiredApplyBind=1;var y=requireFunctionBind(),u=requireFunctionApply(),g=requireActualApply();return applyBind=function(){return g(y,u,arguments)},applyBind}var hasRequiredCallBind;function requireCallBind(){return hasRequiredCallBind||(hasRequiredCallBind=1,(function(y){var u=requireSetFunctionLength(),g=requireEsDefineProperty(),v=requireCallBindApplyHelpers(),b=requireApplyBind();y.exports=function(E){var S=v(arguments),A=E.length-(arguments.length-1);return u(S,1+(A>0?A:0),!0)},g?g(y.exports,"apply",{value:b}):y.exports.apply=b})(callBind)),callBind.exports}var whichTypedArray,hasRequiredWhichTypedArray;function requireWhichTypedArray(){if(hasRequiredWhichTypedArray)return whichTypedArray;hasRequiredWhichTypedArray=1;var y=requireForEach(),u=requireAvailableTypedArrays(),g=requireCallBind(),v=requireCallBound(),b=requireGopd(),w=requireGetProto(),E=v("Object.prototype.toString"),S=requireShams()(),A=typeof globalThis>"u"?commonjsGlobal:globalThis,$=u(),R=v("String.prototype.slice"),T=v("Array.prototype.indexOf",!0)||function(q,J){for(var ie=0;ie<q.length;ie+=1)if(q[ie]===J)return ie;return-1},O={__proto__:null};S&&b&&w?y($,function(U){var q=new A[U];if(Symbol.toStringTag in q&&w){var J=w(q),ie=b(J,Symbol.toStringTag);if(!ie&&J){var oe=w(J);ie=b(oe,Symbol.toStringTag)}O["$"+U]=g(ie.get)}}):y($,function(U){var q=new A[U],J=q.slice||q.set;J&&(O["$"+U]=g(J))});var B=function(q){var J=!1;return y(O,function(ie,oe){if(!J)try{"$"+ie(q)===oe&&(J=R(oe,1))}catch{}}),J},F=function(q){var J=!1;return y(O,function(ie,oe){if(!J)try{ie(q),J=R(oe,1)}catch{}}),J};return whichTypedArray=function(q){if(!q||typeof q!="object")return!1;if(!S){var J=R(E(q),8,-1);return T($,J)>-1?J:J!=="Object"?!1:F(q)}return b?B(q):null},whichTypedArray}var isTypedArray,hasRequiredIsTypedArray;function requireIsTypedArray(){if(hasRequiredIsTypedArray)return isTypedArray;hasRequiredIsTypedArray=1;var y=requireWhichTypedArray();return isTypedArray=function(g){return!!y(g)},isTypedArray}var hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,(function(y){var u=requireIsArguments(),g=requireIsGeneratorFunction(),v=requireWhichTypedArray(),b=requireIsTypedArray();function w(ze){return ze.call.bind(ze)}var E=typeof BigInt<"u",S=typeof Symbol<"u",A=w(Object.prototype.toString),$=w(Number.prototype.valueOf),R=w(String.prototype.valueOf),T=w(Boolean.prototype.valueOf);if(E)var O=w(BigInt.prototype.valueOf);if(S)var B=w(Symbol.prototype.valueOf);function F(ze,et){if(typeof ze!="object")return!1;try{return et(ze),!0}catch{return!1}}y.isArgumentsObject=u,y.isGeneratorFunction=g,y.isTypedArray=b;function U(ze){return typeof Promise<"u"&&ze instanceof Promise||ze!==null&&typeof ze=="object"&&typeof ze.then=="function"&&typeof ze.catch=="function"}y.isPromise=U;function q(ze){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(ze):b(ze)||ue(ze)}y.isArrayBufferView=q;function J(ze){return v(ze)==="Uint8Array"}y.isUint8Array=J;function ie(ze){return v(ze)==="Uint8ClampedArray"}y.isUint8ClampedArray=ie;function oe(ze){return v(ze)==="Uint16Array"}y.isUint16Array=oe;function le(ze){return v(ze)==="Uint32Array"}y.isUint32Array=le;function de(ze){return v(ze)==="Int8Array"}y.isInt8Array=de;function fe(ze){return v(ze)==="Int16Array"}y.isInt16Array=fe;function ye(ze){return v(ze)==="Int32Array"}y.isInt32Array=ye;function we(ze){return v(ze)==="Float32Array"}y.isFloat32Array=we;function pe(ze){return v(ze)==="Float64Array"}y.isFloat64Array=pe;function ve(ze){return v(ze)==="BigInt64Array"}y.isBigInt64Array=ve;function he(ze){return v(ze)==="BigUint64Array"}y.isBigUint64Array=he;function ae(ze){return A(ze)==="[object Map]"}ae.working=typeof Map<"u"&&ae(new Map);function Q(ze){return typeof Map>"u"?!1:ae.working?ae(ze):ze instanceof Map}y.isMap=Q;function j(ze){return A(ze)==="[object Set]"}j.working=typeof Set<"u"&&j(new Set);function z(ze){return typeof Set>"u"?!1:j.working?j(ze):ze instanceof Set}y.isSet=z;function re(ze){return A(ze)==="[object WeakMap]"}re.working=typeof WeakMap<"u"&&re(new WeakMap);function Y(ze){return typeof WeakMap>"u"?!1:re.working?re(ze):ze instanceof WeakMap}y.isWeakMap=Y;function te(ze){return A(ze)==="[object WeakSet]"}te.working=typeof WeakSet<"u"&&te(new WeakSet);function ne(ze){return te(ze)}y.isWeakSet=ne;function se(ze){return A(ze)==="[object ArrayBuffer]"}se.working=typeof ArrayBuffer<"u"&&se(new ArrayBuffer);function ee(ze){return typeof ArrayBuffer>"u"?!1:se.working?se(ze):ze instanceof ArrayBuffer}y.isArrayBuffer=ee;function Z(ze){return A(ze)==="[object DataView]"}Z.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Z(new DataView(new ArrayBuffer(1),0,1));function ue(ze){return typeof DataView>"u"?!1:Z.working?Z(ze):ze instanceof DataView}y.isDataView=ue;var _e=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function Re(ze){return A(ze)==="[object SharedArrayBuffer]"}function Ae(ze){return typeof _e>"u"?!1:(typeof Re.working>"u"&&(Re.working=Re(new _e)),Re.working?Re(ze):ze instanceof _e)}y.isSharedArrayBuffer=Ae;function ge(ze){return A(ze)==="[object AsyncFunction]"}y.isAsyncFunction=ge;function be(ze){return A(ze)==="[object Map Iterator]"}y.isMapIterator=be;function Te(ze){return A(ze)==="[object Set Iterator]"}y.isSetIterator=Te;function De(ze){return A(ze)==="[object Generator]"}y.isGeneratorObject=De;function Ie(ze){return A(ze)==="[object WebAssembly.Module]"}y.isWebAssemblyCompiledModule=Ie;function Se(ze){return F(ze,$)}y.isNumberObject=Se;function Be(ze){return F(ze,R)}y.isStringObject=Be;function Le(ze){return F(ze,T)}y.isBooleanObject=Le;function qe(ze){return E&&F(ze,O)}y.isBigIntObject=qe;function Ke(ze){return S&&F(ze,B)}y.isSymbolObject=Ke;function Ge(ze){return Se(ze)||Be(ze)||Le(ze)||qe(ze)||Ke(ze)}y.isBoxedPrimitive=Ge;function Xe(ze){return typeof Uint8Array<"u"&&(ee(ze)||Ae(ze))}y.isAnyArrayBuffer=Xe,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(ze){Object.defineProperty(y,ze,{enumerable:!1,value:function(){throw new Error(ze+" is not supported in userland")}})})})(types)),types}var isBufferBrowser,hasRequiredIsBufferBrowser;function requireIsBufferBrowser(){return hasRequiredIsBufferBrowser||(hasRequiredIsBufferBrowser=1,isBufferBrowser=function(u){return u&&typeof u=="object"&&typeof u.copy=="function"&&typeof u.fill=="function"&&typeof u.readUInt8=="function"}),isBufferBrowser}var hasRequiredUtil$1;function requireUtil$1(){return hasRequiredUtil$1||(hasRequiredUtil$1=1,(function(y){var u={},g=Object.getOwnPropertyDescriptors||function(_e){for(var Re=Object.keys(_e),Ae={},ge=0;ge<Re.length;ge++)Ae[Re[ge]]=Object.getOwnPropertyDescriptor(_e,Re[ge]);return Ae},v=/%[sdj%]/g;y.format=function(ue){if(!fe(ue)){for(var _e=[],Re=0;Re<arguments.length;Re++)_e.push(S(arguments[Re]));return _e.join(" ")}for(var Re=1,Ae=arguments,ge=Ae.length,be=String(ue).replace(v,function(De){if(De==="%%")return"%";if(Re>=ge)return De;switch(De){case"%s":return String(Ae[Re++]);case"%d":return Number(Ae[Re++]);case"%j":try{return JSON.stringify(Ae[Re++])}catch{return"[Circular]"}default:return De}}),Te=Ae[Re];Re<ge;Te=Ae[++Re])oe(Te)||!ve(Te)?be+=" "+Te:be+=" "+S(Te);return be},y.deprecate=function(ue,_e){if(typeof process$1<"u"&&process$1.noDeprecation===!0)return ue;if(typeof process$1>"u")return function(){return y.deprecate(ue,_e).apply(this,arguments)};var Re=!1;function Ae(){if(!Re){if(process$1.throwDeprecation)throw new Error(_e);process$1.traceDeprecation?console.trace(_e):console.error(_e),Re=!0}return ue.apply(this,arguments)}return Ae};var b={},w=/^$/;if(u.NODE_DEBUG){var E=u.NODE_DEBUG;E=E.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),w=new RegExp("^"+E+"$","i")}y.debuglog=function(ue){if(ue=ue.toUpperCase(),!b[ue])if(w.test(ue)){var _e=process$1.pid;b[ue]=function(){var Re=y.format.apply(y,arguments);console.error("%s %d: %s",ue,_e,Re)}}else b[ue]=function(){};return b[ue]};function S(ue,_e){var Re={seen:[],stylize:$};return arguments.length>=3&&(Re.depth=arguments[2]),arguments.length>=4&&(Re.colors=arguments[3]),ie(_e)?Re.showHidden=_e:_e&&y._extend(Re,_e),we(Re.showHidden)&&(Re.showHidden=!1),we(Re.depth)&&(Re.depth=2),we(Re.colors)&&(Re.colors=!1),we(Re.customInspect)&&(Re.customInspect=!0),Re.colors&&(Re.stylize=A),T(Re,ue,Re.depth)}y.inspect=S,S.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},S.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function A(ue,_e){var Re=S.styles[_e];return Re?"\x1B["+S.colors[Re][0]+"m"+ue+"\x1B["+S.colors[Re][1]+"m":ue}function $(ue,_e){return ue}function R(ue){var _e={};return ue.forEach(function(Re,Ae){_e[Re]=!0}),_e}function T(ue,_e,Re){if(ue.customInspect&&_e&&Q(_e.inspect)&&_e.inspect!==y.inspect&&!(_e.constructor&&_e.constructor.prototype===_e)){var Ae=_e.inspect(Re,ue);return fe(Ae)||(Ae=T(ue,Ae,Re)),Ae}var ge=O(ue,_e);if(ge)return ge;var be=Object.keys(_e),Te=R(be);if(ue.showHidden&&(be=Object.getOwnPropertyNames(_e)),ae(_e)&&(be.indexOf("message")>=0||be.indexOf("description")>=0))return B(_e);if(be.length===0){if(Q(_e)){var De=_e.name?": "+_e.name:"";return ue.stylize("[Function"+De+"]","special")}if(pe(_e))return ue.stylize(RegExp.prototype.toString.call(_e),"regexp");if(he(_e))return ue.stylize(Date.prototype.toString.call(_e),"date");if(ae(_e))return B(_e)}var Ie="",Se=!1,Be=["{","}"];if(J(_e)&&(Se=!0,Be=["[","]"]),Q(_e)){var Le=_e.name?": "+_e.name:"";Ie=" [Function"+Le+"]"}if(pe(_e)&&(Ie=" "+RegExp.prototype.toString.call(_e)),he(_e)&&(Ie=" "+Date.prototype.toUTCString.call(_e)),ae(_e)&&(Ie=" "+B(_e)),be.length===0&&(!Se||_e.length==0))return Be[0]+Ie+Be[1];if(Re<0)return pe(_e)?ue.stylize(RegExp.prototype.toString.call(_e),"regexp"):ue.stylize("[Object]","special");ue.seen.push(_e);var qe;return Se?qe=F(ue,_e,Re,Te,be):qe=be.map(function(Ke){return U(ue,_e,Re,Te,Ke,Se)}),ue.seen.pop(),q(qe,Ie,Be)}function O(ue,_e){if(we(_e))return ue.stylize("undefined","undefined");if(fe(_e)){var Re="'"+JSON.stringify(_e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ue.stylize(Re,"string")}if(de(_e))return ue.stylize(""+_e,"number");if(ie(_e))return ue.stylize(""+_e,"boolean");if(oe(_e))return ue.stylize("null","null")}function B(ue){return"["+Error.prototype.toString.call(ue)+"]"}function F(ue,_e,Re,Ae,ge){for(var be=[],Te=0,De=_e.length;Te<De;++Te)ne(_e,String(Te))?be.push(U(ue,_e,Re,Ae,String(Te),!0)):be.push("");return ge.forEach(function(Ie){Ie.match(/^\d+$/)||be.push(U(ue,_e,Re,Ae,Ie,!0))}),be}function U(ue,_e,Re,Ae,ge,be){var Te,De,Ie;if(Ie=Object.getOwnPropertyDescriptor(_e,ge)||{value:_e[ge]},Ie.get?Ie.set?De=ue.stylize("[Getter/Setter]","special"):De=ue.stylize("[Getter]","special"):Ie.set&&(De=ue.stylize("[Setter]","special")),ne(Ae,ge)||(Te="["+ge+"]"),De||(ue.seen.indexOf(Ie.value)<0?(oe(Re)?De=T(ue,Ie.value,null):De=T(ue,Ie.value,Re-1),De.indexOf(`
`)>-1&&(be?De=De.split(`
`).map(function(Se){return"  "+Se}).join(`
`).slice(2):De=`
`+De.split(`
`).map(function(Se){return"   "+Se}).join(`
`))):De=ue.stylize("[Circular]","special")),we(Te)){if(be&&ge.match(/^\d+$/))return De;Te=JSON.stringify(""+ge),Te.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Te=Te.slice(1,-1),Te=ue.stylize(Te,"name")):(Te=Te.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Te=ue.stylize(Te,"string"))}return Te+": "+De}function q(ue,_e,Re){var Ae=ue.reduce(function(ge,be){return be.indexOf(`
`)>=0,ge+be.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Ae>60?Re[0]+(_e===""?"":_e+`
 `)+" "+ue.join(`,
  `)+" "+Re[1]:Re[0]+_e+" "+ue.join(", ")+" "+Re[1]}y.types=requireTypes();function J(ue){return Array.isArray(ue)}y.isArray=J;function ie(ue){return typeof ue=="boolean"}y.isBoolean=ie;function oe(ue){return ue===null}y.isNull=oe;function le(ue){return ue==null}y.isNullOrUndefined=le;function de(ue){return typeof ue=="number"}y.isNumber=de;function fe(ue){return typeof ue=="string"}y.isString=fe;function ye(ue){return typeof ue=="symbol"}y.isSymbol=ye;function we(ue){return ue===void 0}y.isUndefined=we;function pe(ue){return ve(ue)&&z(ue)==="[object RegExp]"}y.isRegExp=pe,y.types.isRegExp=pe;function ve(ue){return typeof ue=="object"&&ue!==null}y.isObject=ve;function he(ue){return ve(ue)&&z(ue)==="[object Date]"}y.isDate=he,y.types.isDate=he;function ae(ue){return ve(ue)&&(z(ue)==="[object Error]"||ue instanceof Error)}y.isError=ae,y.types.isNativeError=ae;function Q(ue){return typeof ue=="function"}y.isFunction=Q;function j(ue){return ue===null||typeof ue=="boolean"||typeof ue=="number"||typeof ue=="string"||typeof ue=="symbol"||typeof ue>"u"}y.isPrimitive=j,y.isBuffer=requireIsBufferBrowser();function z(ue){return Object.prototype.toString.call(ue)}function re(ue){return ue<10?"0"+ue.toString(10):ue.toString(10)}var Y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function te(){var ue=new Date,_e=[re(ue.getHours()),re(ue.getMinutes()),re(ue.getSeconds())].join(":");return[ue.getDate(),Y[ue.getMonth()],_e].join(" ")}y.log=function(){console.log("%s - %s",te(),y.format.apply(y,arguments))},y.inherits=requireInherits_browser(),y._extend=function(ue,_e){if(!_e||!ve(_e))return ue;for(var Re=Object.keys(_e),Ae=Re.length;Ae--;)ue[Re[Ae]]=_e[Re[Ae]];return ue};function ne(ue,_e){return Object.prototype.hasOwnProperty.call(ue,_e)}var se=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;y.promisify=function(_e){if(typeof _e!="function")throw new TypeError('The "original" argument must be of type Function');if(se&&_e[se]){var Re=_e[se];if(typeof Re!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(Re,se,{value:Re,enumerable:!1,writable:!1,configurable:!0}),Re}function Re(){for(var Ae,ge,be=new Promise(function(Ie,Se){Ae=Ie,ge=Se}),Te=[],De=0;De<arguments.length;De++)Te.push(arguments[De]);Te.push(function(Ie,Se){Ie?ge(Ie):Ae(Se)});try{_e.apply(this,Te)}catch(Ie){ge(Ie)}return be}return Object.setPrototypeOf(Re,Object.getPrototypeOf(_e)),se&&Object.defineProperty(Re,se,{value:Re,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(Re,g(_e))},y.promisify.custom=se;function ee(ue,_e){if(!ue){var Re=new Error("Promise was rejected with a falsy value");Re.reason=ue,ue=Re}return _e(ue)}function Z(ue){if(typeof ue!="function")throw new TypeError('The "original" argument must be of type Function');function _e(){for(var Re=[],Ae=0;Ae<arguments.length;Ae++)Re.push(arguments[Ae]);var ge=Re.pop();if(typeof ge!="function")throw new TypeError("The last argument must be of type Function");var be=this,Te=function(){return ge.apply(be,arguments)};ue.apply(this,Re).then(function(De){process$1.nextTick(Te.bind(null,null,De))},function(De){process$1.nextTick(ee.bind(null,De,Te))})}return Object.setPrototypeOf(_e,Object.getPrototypeOf(ue)),Object.defineProperties(_e,g(ue)),_e}y.callbackify=Z})(util$1)),util$1}var buffer_list,hasRequiredBuffer_list;function requireBuffer_list(){if(hasRequiredBuffer_list)return buffer_list;hasRequiredBuffer_list=1;function y(F,U){var q=Object.keys(F);if(Object.getOwnPropertySymbols){var J=Object.getOwnPropertySymbols(F);U&&(J=J.filter(function(ie){return Object.getOwnPropertyDescriptor(F,ie).enumerable})),q.push.apply(q,J)}return q}function u(F){for(var U=1;U<arguments.length;U++){var q=arguments[U]!=null?arguments[U]:{};U%2?y(Object(q),!0).forEach(function(J){g(F,J,q[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(q)):y(Object(q)).forEach(function(J){Object.defineProperty(F,J,Object.getOwnPropertyDescriptor(q,J))})}return F}function g(F,U,q){return U=E(U),U in F?Object.defineProperty(F,U,{value:q,enumerable:!0,configurable:!0,writable:!0}):F[U]=q,F}function v(F,U){if(!(F instanceof U))throw new TypeError("Cannot call a class as a function")}function b(F,U){for(var q=0;q<U.length;q++){var J=U[q];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(F,E(J.key),J)}}function w(F,U,q){return U&&b(F.prototype,U),Object.defineProperty(F,"prototype",{writable:!1}),F}function E(F){var U=S(F,"string");return typeof U=="symbol"?U:String(U)}function S(F,U){if(typeof F!="object"||F===null)return F;var q=F[Symbol.toPrimitive];if(q!==void 0){var J=q.call(F,U);if(typeof J!="object")return J;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(F)}var A=requireDist(),$=A.Buffer,R=requireUtil$1(),T=R.inspect,O=T&&T.custom||"inspect";function B(F,U,q){$.prototype.copy.call(F,U,q)}return buffer_list=(function(){function F(){v(this,F),this.head=null,this.tail=null,this.length=0}return w(F,[{key:"push",value:function(q){var J={data:q,next:null};this.length>0?this.tail.next=J:this.head=J,this.tail=J,++this.length}},{key:"unshift",value:function(q){var J={data:q,next:this.head};this.length===0&&(this.tail=J),this.head=J,++this.length}},{key:"shift",value:function(){if(this.length!==0){var q=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,q}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(q){if(this.length===0)return"";for(var J=this.head,ie=""+J.data;J=J.next;)ie+=q+J.data;return ie}},{key:"concat",value:function(q){if(this.length===0)return $.alloc(0);for(var J=$.allocUnsafe(q>>>0),ie=this.head,oe=0;ie;)B(ie.data,J,oe),oe+=ie.data.length,ie=ie.next;return J}},{key:"consume",value:function(q,J){var ie;return q<this.head.data.length?(ie=this.head.data.slice(0,q),this.head.data=this.head.data.slice(q)):q===this.head.data.length?ie=this.shift():ie=J?this._getString(q):this._getBuffer(q),ie}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(q){var J=this.head,ie=1,oe=J.data;for(q-=oe.length;J=J.next;){var le=J.data,de=q>le.length?le.length:q;if(de===le.length?oe+=le:oe+=le.slice(0,q),q-=de,q===0){de===le.length?(++ie,J.next?this.head=J.next:this.head=this.tail=null):(this.head=J,J.data=le.slice(de));break}++ie}return this.length-=ie,oe}},{key:"_getBuffer",value:function(q){var J=$.allocUnsafe(q),ie=this.head,oe=1;for(ie.data.copy(J),q-=ie.data.length;ie=ie.next;){var le=ie.data,de=q>le.length?le.length:q;if(le.copy(J,J.length-q,0,de),q-=de,q===0){de===le.length?(++oe,ie.next?this.head=ie.next:this.head=this.tail=null):(this.head=ie,ie.data=le.slice(de));break}++oe}return this.length-=oe,J}},{key:O,value:function(q,J){return T(this,u(u({},J),{},{depth:0,customInspect:!1}))}}]),F})(),buffer_list}var destroy_1$2,hasRequiredDestroy$2;function requireDestroy$2(){if(hasRequiredDestroy$2)return destroy_1$2;hasRequiredDestroy$2=1;function y(E,S){var A=this,$=this._readableState&&this._readableState.destroyed,R=this._writableState&&this._writableState.destroyed;return $||R?(S?S(E):E&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process$1.nextTick(b,this,E)):process$1.nextTick(b,this,E)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(E||null,function(T){!S&&T?A._writableState?A._writableState.errorEmitted?process$1.nextTick(g,A):(A._writableState.errorEmitted=!0,process$1.nextTick(u,A,T)):process$1.nextTick(u,A,T):S?(process$1.nextTick(g,A),S(T)):process$1.nextTick(g,A)}),this)}function u(E,S){b(E,S),g(E)}function g(E){E._writableState&&!E._writableState.emitClose||E._readableState&&!E._readableState.emitClose||E.emit("close")}function v(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function b(E,S){E.emit("error",S)}function w(E,S){var A=E._readableState,$=E._writableState;A&&A.autoDestroy||$&&$.autoDestroy?E.destroy(S):E.emit("error",S)}return destroy_1$2={destroy:y,undestroy:v,errorOrDestroy:w},destroy_1$2}var errorsBrowser={},hasRequiredErrorsBrowser;function requireErrorsBrowser(){if(hasRequiredErrorsBrowser)return errorsBrowser;hasRequiredErrorsBrowser=1;function y(S,A){S.prototype=Object.create(A.prototype),S.prototype.constructor=S,S.__proto__=A}var u={};function g(S,A,$){$||($=Error);function R(O,B,F){return typeof A=="string"?A:A(O,B,F)}var T=(function(O){y(B,O);function B(F,U,q){return O.call(this,R(F,U,q))||this}return B})($);T.prototype.name=$.name,T.prototype.code=S,u[S]=T}function v(S,A){if(Array.isArray(S)){var $=S.length;return S=S.map(function(R){return String(R)}),$>2?"one of ".concat(A," ").concat(S.slice(0,$-1).join(", "),", or ")+S[$-1]:$===2?"one of ".concat(A," ").concat(S[0]," or ").concat(S[1]):"of ".concat(A," ").concat(S[0])}else return"of ".concat(A," ").concat(String(S))}function b(S,A,$){return S.substr(0,A.length)===A}function w(S,A,$){return($===void 0||$>S.length)&&($=S.length),S.substring($-A.length,$)===A}function E(S,A,$){return typeof $!="number"&&($=0),$+A.length>S.length?!1:S.indexOf(A,$)!==-1}return g("ERR_INVALID_OPT_VALUE",function(S,A){return'The value "'+A+'" is invalid for option "'+S+'"'},TypeError),g("ERR_INVALID_ARG_TYPE",function(S,A,$){var R;typeof A=="string"&&b(A,"not ")?(R="must not be",A=A.replace(/^not /,"")):R="must be";var T;if(w(S," argument"))T="The ".concat(S," ").concat(R," ").concat(v(A,"type"));else{var O=E(S,".")?"property":"argument";T='The "'.concat(S,'" ').concat(O," ").concat(R," ").concat(v(A,"type"))}return T+=". Received type ".concat(typeof $),T},TypeError),g("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),g("ERR_METHOD_NOT_IMPLEMENTED",function(S){return"The "+S+" method is not implemented"}),g("ERR_STREAM_PREMATURE_CLOSE","Premature close"),g("ERR_STREAM_DESTROYED",function(S){return"Cannot call "+S+" after a stream was destroyed"}),g("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),g("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),g("ERR_STREAM_WRITE_AFTER_END","write after end"),g("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),g("ERR_UNKNOWN_ENCODING",function(S){return"Unknown encoding: "+S},TypeError),g("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),errorsBrowser.codes=u,errorsBrowser}var state,hasRequiredState;function requireState(){if(hasRequiredState)return state;hasRequiredState=1;var y=requireErrorsBrowser().codes.ERR_INVALID_OPT_VALUE;function u(v,b,w){return v.highWaterMark!=null?v.highWaterMark:b?v[w]:null}function g(v,b,w,E){var S=u(b,E,w);if(S!=null){if(!(isFinite(S)&&Math.floor(S)===S)||S<0){var A=E?w:"highWaterMark";throw new y(A,S)}return Math.floor(S)}return v.objectMode?16:16*1024}return state={getHighWaterMark:g},state}var browser$d,hasRequiredBrowser$c;function requireBrowser$c(){if(hasRequiredBrowser$c)return browser$d;hasRequiredBrowser$c=1,browser$d=y;function y(g,v){if(u("noDeprecation"))return g;var b=!1;function w(){if(!b){if(u("throwDeprecation"))throw new Error(v);u("traceDeprecation")?console.trace(v):console.warn(v),b=!0}return g.apply(this,arguments)}return w}function u(g){try{if(!commonjsGlobal.localStorage)return!1}catch{return!1}var v=commonjsGlobal.localStorage[g];return v==null?!1:String(v).toLowerCase()==="true"}return browser$d}var _stream_writable$2,hasRequired_stream_writable$2;function require_stream_writable$2(){if(hasRequired_stream_writable$2)return _stream_writable$2;hasRequired_stream_writable$2=1,_stream_writable$2=we;function y(Ae){var ge=this;this.next=null,this.entry=null,this.finish=function(){Re(ge,Ae)}}var u;we.WritableState=fe;var g={deprecate:requireBrowser$c()},v=requireStreamBrowser$2(),b=requireDist().Buffer,w=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function E(Ae){return b.from(Ae)}function S(Ae){return b.isBuffer(Ae)||Ae instanceof w}var A=requireDestroy$2(),$=requireState(),R=$.getHighWaterMark,T=requireErrorsBrowser().codes,O=T.ERR_INVALID_ARG_TYPE,B=T.ERR_METHOD_NOT_IMPLEMENTED,F=T.ERR_MULTIPLE_CALLBACK,U=T.ERR_STREAM_CANNOT_PIPE,q=T.ERR_STREAM_DESTROYED,J=T.ERR_STREAM_NULL_VALUES,ie=T.ERR_STREAM_WRITE_AFTER_END,oe=T.ERR_UNKNOWN_ENCODING,le=A.errorOrDestroy;requireInherits_browser()(we,v);function de(){}function fe(Ae,ge,be){u=u||require_stream_duplex$2(),Ae=Ae||{},typeof be!="boolean"&&(be=ge instanceof u),this.objectMode=!!Ae.objectMode,be&&(this.objectMode=this.objectMode||!!Ae.writableObjectMode),this.highWaterMark=R(this,Ae,"writableHighWaterMark",be),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Te=Ae.decodeStrings===!1;this.decodeStrings=!Te,this.defaultEncoding=Ae.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(De){re(ge,De)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=Ae.emitClose!==!1,this.autoDestroy=!!Ae.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new y(this)}fe.prototype.getBuffer=function(){for(var ge=this.bufferedRequest,be=[];ge;)be.push(ge),ge=ge.next;return be},(function(){try{Object.defineProperty(fe.prototype,"buffer",{get:g.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var ye;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(ye=Function.prototype[Symbol.hasInstance],Object.defineProperty(we,Symbol.hasInstance,{value:function(ge){return ye.call(this,ge)?!0:this!==we?!1:ge&&ge._writableState instanceof fe}})):ye=function(ge){return ge instanceof this};function we(Ae){u=u||require_stream_duplex$2();var ge=this instanceof u;if(!ge&&!ye.call(we,this))return new we(Ae);this._writableState=new fe(Ae,this,ge),this.writable=!0,Ae&&(typeof Ae.write=="function"&&(this._write=Ae.write),typeof Ae.writev=="function"&&(this._writev=Ae.writev),typeof Ae.destroy=="function"&&(this._destroy=Ae.destroy),typeof Ae.final=="function"&&(this._final=Ae.final)),v.call(this)}we.prototype.pipe=function(){le(this,new U)};function pe(Ae,ge){var be=new ie;le(Ae,be),process$1.nextTick(ge,be)}function ve(Ae,ge,be,Te){var De;return be===null?De=new J:typeof be!="string"&&!ge.objectMode&&(De=new O("chunk",["string","Buffer"],be)),De?(le(Ae,De),process$1.nextTick(Te,De),!1):!0}we.prototype.write=function(Ae,ge,be){var Te=this._writableState,De=!1,Ie=!Te.objectMode&&S(Ae);return Ie&&!b.isBuffer(Ae)&&(Ae=E(Ae)),typeof ge=="function"&&(be=ge,ge=null),Ie?ge="buffer":ge||(ge=Te.defaultEncoding),typeof be!="function"&&(be=de),Te.ending?pe(this,be):(Ie||ve(this,Te,Ae,be))&&(Te.pendingcb++,De=ae(this,Te,Ie,Ae,ge,be)),De},we.prototype.cork=function(){this._writableState.corked++},we.prototype.uncork=function(){var Ae=this._writableState;Ae.corked&&(Ae.corked--,!Ae.writing&&!Ae.corked&&!Ae.bufferProcessing&&Ae.bufferedRequest&&ne(this,Ae))},we.prototype.setDefaultEncoding=function(ge){if(typeof ge=="string"&&(ge=ge.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((ge+"").toLowerCase())>-1))throw new oe(ge);return this._writableState.defaultEncoding=ge,this},Object.defineProperty(we.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function he(Ae,ge,be){return!Ae.objectMode&&Ae.decodeStrings!==!1&&typeof ge=="string"&&(ge=b.from(ge,be)),ge}Object.defineProperty(we.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function ae(Ae,ge,be,Te,De,Ie){if(!be){var Se=he(ge,Te,De);Te!==Se&&(be=!0,De="buffer",Te=Se)}var Be=ge.objectMode?1:Te.length;ge.length+=Be;var Le=ge.length<ge.highWaterMark;if(Le||(ge.needDrain=!0),ge.writing||ge.corked){var qe=ge.lastBufferedRequest;ge.lastBufferedRequest={chunk:Te,encoding:De,isBuf:be,callback:Ie,next:null},qe?qe.next=ge.lastBufferedRequest:ge.bufferedRequest=ge.lastBufferedRequest,ge.bufferedRequestCount+=1}else Q(Ae,ge,!1,Be,Te,De,Ie);return Le}function Q(Ae,ge,be,Te,De,Ie,Se){ge.writelen=Te,ge.writecb=Se,ge.writing=!0,ge.sync=!0,ge.destroyed?ge.onwrite(new q("write")):be?Ae._writev(De,ge.onwrite):Ae._write(De,Ie,ge.onwrite),ge.sync=!1}function j(Ae,ge,be,Te,De){--ge.pendingcb,be?(process$1.nextTick(De,Te),process$1.nextTick(ue,Ae,ge),Ae._writableState.errorEmitted=!0,le(Ae,Te)):(De(Te),Ae._writableState.errorEmitted=!0,le(Ae,Te),ue(Ae,ge))}function z(Ae){Ae.writing=!1,Ae.writecb=null,Ae.length-=Ae.writelen,Ae.writelen=0}function re(Ae,ge){var be=Ae._writableState,Te=be.sync,De=be.writecb;if(typeof De!="function")throw new F;if(z(be),ge)j(Ae,be,Te,ge,De);else{var Ie=se(be)||Ae.destroyed;!Ie&&!be.corked&&!be.bufferProcessing&&be.bufferedRequest&&ne(Ae,be),Te?process$1.nextTick(Y,Ae,be,Ie,De):Y(Ae,be,Ie,De)}}function Y(Ae,ge,be,Te){be||te(Ae,ge),ge.pendingcb--,Te(),ue(Ae,ge)}function te(Ae,ge){ge.length===0&&ge.needDrain&&(ge.needDrain=!1,Ae.emit("drain"))}function ne(Ae,ge){ge.bufferProcessing=!0;var be=ge.bufferedRequest;if(Ae._writev&&be&&be.next){var Te=ge.bufferedRequestCount,De=new Array(Te),Ie=ge.corkedRequestsFree;Ie.entry=be;for(var Se=0,Be=!0;be;)De[Se]=be,be.isBuf||(Be=!1),be=be.next,Se+=1;De.allBuffers=Be,Q(Ae,ge,!0,ge.length,De,"",Ie.finish),ge.pendingcb++,ge.lastBufferedRequest=null,Ie.next?(ge.corkedRequestsFree=Ie.next,Ie.next=null):ge.corkedRequestsFree=new y(ge),ge.bufferedRequestCount=0}else{for(;be;){var Le=be.chunk,qe=be.encoding,Ke=be.callback,Ge=ge.objectMode?1:Le.length;if(Q(Ae,ge,!1,Ge,Le,qe,Ke),be=be.next,ge.bufferedRequestCount--,ge.writing)break}be===null&&(ge.lastBufferedRequest=null)}ge.bufferedRequest=be,ge.bufferProcessing=!1}we.prototype._write=function(Ae,ge,be){be(new B("_write()"))},we.prototype._writev=null,we.prototype.end=function(Ae,ge,be){var Te=this._writableState;return typeof Ae=="function"?(be=Ae,Ae=null,ge=null):typeof ge=="function"&&(be=ge,ge=null),Ae!=null&&this.write(Ae,ge),Te.corked&&(Te.corked=1,this.uncork()),Te.ending||_e(this,Te,be),this},Object.defineProperty(we.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function se(Ae){return Ae.ending&&Ae.length===0&&Ae.bufferedRequest===null&&!Ae.finished&&!Ae.writing}function ee(Ae,ge){Ae._final(function(be){ge.pendingcb--,be&&le(Ae,be),ge.prefinished=!0,Ae.emit("prefinish"),ue(Ae,ge)})}function Z(Ae,ge){!ge.prefinished&&!ge.finalCalled&&(typeof Ae._final=="function"&&!ge.destroyed?(ge.pendingcb++,ge.finalCalled=!0,process$1.nextTick(ee,Ae,ge)):(ge.prefinished=!0,Ae.emit("prefinish")))}function ue(Ae,ge){var be=se(ge);if(be&&(Z(Ae,ge),ge.pendingcb===0&&(ge.finished=!0,Ae.emit("finish"),ge.autoDestroy))){var Te=Ae._readableState;(!Te||Te.autoDestroy&&Te.endEmitted)&&Ae.destroy()}return be}function _e(Ae,ge,be){ge.ending=!0,ue(Ae,ge),be&&(ge.finished?process$1.nextTick(be):Ae.once("finish",be)),ge.ended=!0,Ae.writable=!1}function Re(Ae,ge,be){var Te=Ae.entry;for(Ae.entry=null;Te;){var De=Te.callback;ge.pendingcb--,De(be),Te=Te.next}ge.corkedRequestsFree.next=Ae}return Object.defineProperty(we.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(ge){this._writableState&&(this._writableState.destroyed=ge)}}),we.prototype.destroy=A.destroy,we.prototype._undestroy=A.undestroy,we.prototype._destroy=function(Ae,ge){ge(Ae)},_stream_writable$2}var _stream_duplex$2,hasRequired_stream_duplex$2;function require_stream_duplex$2(){if(hasRequired_stream_duplex$2)return _stream_duplex$2;hasRequired_stream_duplex$2=1;var y=Object.keys||function($){var R=[];for(var T in $)R.push(T);return R};_stream_duplex$2=E;var u=require_stream_readable$2(),g=require_stream_writable$2();requireInherits_browser()(E,u);for(var v=y(g.prototype),b=0;b<v.length;b++){var w=v[b];E.prototype[w]||(E.prototype[w]=g.prototype[w])}function E($){if(!(this instanceof E))return new E($);u.call(this,$),g.call(this,$),this.allowHalfOpen=!0,$&&($.readable===!1&&(this.readable=!1),$.writable===!1&&(this.writable=!1),$.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",S)))}Object.defineProperty(E.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(E.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(E.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function S(){this._writableState.ended||process$1.nextTick(A,this)}function A($){$.end()}return Object.defineProperty(E.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(R){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=R,this._writableState.destroyed=R)}}),_stream_duplex$2}var string_decoder={},hasRequiredString_decoder;function requireString_decoder(){if(hasRequiredString_decoder)return string_decoder;hasRequiredString_decoder=1;var y=requireSafeBuffer$2().Buffer,u=y.isEncoding||function(J){switch(J=""+J,J&&J.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function g(J){if(!J)return"utf8";for(var ie;;)switch(J){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return J;default:if(ie)return;J=(""+J).toLowerCase(),ie=!0}}function v(J){var ie=g(J);if(typeof ie!="string"&&(y.isEncoding===u||!u(J)))throw new Error("Unknown encoding: "+J);return ie||J}string_decoder.StringDecoder=b;function b(J){this.encoding=v(J);var ie;switch(this.encoding){case"utf16le":this.text=T,this.end=O,ie=4;break;case"utf8":this.fillLast=A,ie=4;break;case"base64":this.text=B,this.end=F,ie=3;break;default:this.write=U,this.end=q;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=y.allocUnsafe(ie)}b.prototype.write=function(J){if(J.length===0)return"";var ie,oe;if(this.lastNeed){if(ie=this.fillLast(J),ie===void 0)return"";oe=this.lastNeed,this.lastNeed=0}else oe=0;return oe<J.length?ie?ie+this.text(J,oe):this.text(J,oe):ie||""},b.prototype.end=R,b.prototype.text=$,b.prototype.fillLast=function(J){if(this.lastNeed<=J.length)return J.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);J.copy(this.lastChar,this.lastTotal-this.lastNeed,0,J.length),this.lastNeed-=J.length};function w(J){return J<=127?0:J>>5===6?2:J>>4===14?3:J>>3===30?4:J>>6===2?-1:-2}function E(J,ie,oe){var le=ie.length-1;if(le<oe)return 0;var de=w(ie[le]);return de>=0?(de>0&&(J.lastNeed=de-1),de):--le<oe||de===-2?0:(de=w(ie[le]),de>=0?(de>0&&(J.lastNeed=de-2),de):--le<oe||de===-2?0:(de=w(ie[le]),de>=0?(de>0&&(de===2?de=0:J.lastNeed=de-3),de):0))}function S(J,ie,oe){if((ie[0]&192)!==128)return J.lastNeed=0,"";if(J.lastNeed>1&&ie.length>1){if((ie[1]&192)!==128)return J.lastNeed=1,"";if(J.lastNeed>2&&ie.length>2&&(ie[2]&192)!==128)return J.lastNeed=2,""}}function A(J){var ie=this.lastTotal-this.lastNeed,oe=S(this,J);if(oe!==void 0)return oe;if(this.lastNeed<=J.length)return J.copy(this.lastChar,ie,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);J.copy(this.lastChar,ie,0,J.length),this.lastNeed-=J.length}function $(J,ie){var oe=E(this,J,ie);if(!this.lastNeed)return J.toString("utf8",ie);this.lastTotal=oe;var le=J.length-(oe-this.lastNeed);return J.copy(this.lastChar,0,le),J.toString("utf8",ie,le)}function R(J){var ie=J&&J.length?this.write(J):"";return this.lastNeed?ie+"":ie}function T(J,ie){if((J.length-ie)%2===0){var oe=J.toString("utf16le",ie);if(oe){var le=oe.charCodeAt(oe.length-1);if(le>=55296&&le<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=J[J.length-2],this.lastChar[1]=J[J.length-1],oe.slice(0,-1)}return oe}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=J[J.length-1],J.toString("utf16le",ie,J.length-1)}function O(J){var ie=J&&J.length?this.write(J):"";if(this.lastNeed){var oe=this.lastTotal-this.lastNeed;return ie+this.lastChar.toString("utf16le",0,oe)}return ie}function B(J,ie){var oe=(J.length-ie)%3;return oe===0?J.toString("base64",ie):(this.lastNeed=3-oe,this.lastTotal=3,oe===1?this.lastChar[0]=J[J.length-1]:(this.lastChar[0]=J[J.length-2],this.lastChar[1]=J[J.length-1]),J.toString("base64",ie,J.length-oe))}function F(J){var ie=J&&J.length?this.write(J):"";return this.lastNeed?ie+this.lastChar.toString("base64",0,3-this.lastNeed):ie}function U(J){return J.toString(this.encoding)}function q(J){return J&&J.length?this.write(J):""}return string_decoder}var endOfStream,hasRequiredEndOfStream;function requireEndOfStream(){if(hasRequiredEndOfStream)return endOfStream;hasRequiredEndOfStream=1;var y=requireErrorsBrowser().codes.ERR_STREAM_PREMATURE_CLOSE;function u(w){var E=!1;return function(){if(!E){E=!0;for(var S=arguments.length,A=new Array(S),$=0;$<S;$++)A[$]=arguments[$];w.apply(this,A)}}}function g(){}function v(w){return w.setHeader&&typeof w.abort=="function"}function b(w,E,S){if(typeof E=="function")return b(w,null,E);E||(E={}),S=u(S||g);var A=E.readable||E.readable!==!1&&w.readable,$=E.writable||E.writable!==!1&&w.writable,R=function(){w.writable||O()},T=w._writableState&&w._writableState.finished,O=function(){$=!1,T=!0,A||S.call(w)},B=w._readableState&&w._readableState.endEmitted,F=function(){A=!1,B=!0,$||S.call(w)},U=function(oe){S.call(w,oe)},q=function(){var oe;if(A&&!B)return(!w._readableState||!w._readableState.ended)&&(oe=new y),S.call(w,oe);if($&&!T)return(!w._writableState||!w._writableState.ended)&&(oe=new y),S.call(w,oe)},J=function(){w.req.on("finish",O)};return v(w)?(w.on("complete",O),w.on("abort",q),w.req?J():w.on("request",J)):$&&!w._writableState&&(w.on("end",R),w.on("close",R)),w.on("end",F),w.on("finish",O),E.error!==!1&&w.on("error",U),w.on("close",q),function(){w.removeListener("complete",O),w.removeListener("abort",q),w.removeListener("request",J),w.req&&w.req.removeListener("finish",O),w.removeListener("end",R),w.removeListener("close",R),w.removeListener("finish",O),w.removeListener("end",F),w.removeListener("error",U),w.removeListener("close",q)}}return endOfStream=b,endOfStream}var async_iterator,hasRequiredAsync_iterator;function requireAsync_iterator(){if(hasRequiredAsync_iterator)return async_iterator;hasRequiredAsync_iterator=1;var y;function u(oe,le,de){return le=g(le),le in oe?Object.defineProperty(oe,le,{value:de,enumerable:!0,configurable:!0,writable:!0}):oe[le]=de,oe}function g(oe){var le=v(oe,"string");return typeof le=="symbol"?le:String(le)}function v(oe,le){if(typeof oe!="object"||oe===null)return oe;var de=oe[Symbol.toPrimitive];if(de!==void 0){var fe=de.call(oe,le);if(typeof fe!="object")return fe;throw new TypeError("@@toPrimitive must return a primitive value.")}return(le==="string"?String:Number)(oe)}var b=requireEndOfStream(),w=Symbol("lastResolve"),E=Symbol("lastReject"),S=Symbol("error"),A=Symbol("ended"),$=Symbol("lastPromise"),R=Symbol("handlePromise"),T=Symbol("stream");function O(oe,le){return{value:oe,done:le}}function B(oe){var le=oe[w];if(le!==null){var de=oe[T].read();de!==null&&(oe[$]=null,oe[w]=null,oe[E]=null,le(O(de,!1)))}}function F(oe){process$1.nextTick(B,oe)}function U(oe,le){return function(de,fe){oe.then(function(){if(le[A]){de(O(void 0,!0));return}le[R](de,fe)},fe)}}var q=Object.getPrototypeOf(function(){}),J=Object.setPrototypeOf((y={get stream(){return this[T]},next:function(){var le=this,de=this[S];if(de!==null)return Promise.reject(de);if(this[A])return Promise.resolve(O(void 0,!0));if(this[T].destroyed)return new Promise(function(pe,ve){process$1.nextTick(function(){le[S]?ve(le[S]):pe(O(void 0,!0))})});var fe=this[$],ye;if(fe)ye=new Promise(U(fe,this));else{var we=this[T].read();if(we!==null)return Promise.resolve(O(we,!1));ye=new Promise(this[R])}return this[$]=ye,ye}},u(y,Symbol.asyncIterator,function(){return this}),u(y,"return",function(){var le=this;return new Promise(function(de,fe){le[T].destroy(null,function(ye){if(ye){fe(ye);return}de(O(void 0,!0))})})}),y),q),ie=function(le){var de,fe=Object.create(J,(de={},u(de,T,{value:le,writable:!0}),u(de,w,{value:null,writable:!0}),u(de,E,{value:null,writable:!0}),u(de,S,{value:null,writable:!0}),u(de,A,{value:le._readableState.endEmitted,writable:!0}),u(de,R,{value:function(we,pe){var ve=fe[T].read();ve?(fe[$]=null,fe[w]=null,fe[E]=null,we(O(ve,!1))):(fe[w]=we,fe[E]=pe)},writable:!0}),de));return fe[$]=null,b(le,function(ye){if(ye&&ye.code!=="ERR_STREAM_PREMATURE_CLOSE"){var we=fe[E];we!==null&&(fe[$]=null,fe[w]=null,fe[E]=null,we(ye)),fe[S]=ye;return}var pe=fe[w];pe!==null&&(fe[$]=null,fe[w]=null,fe[E]=null,pe(O(void 0,!0))),fe[A]=!0}),le.on("readable",F.bind(null,fe)),fe};return async_iterator=ie,async_iterator}var fromBrowser,hasRequiredFromBrowser;function requireFromBrowser(){return hasRequiredFromBrowser||(hasRequiredFromBrowser=1,fromBrowser=function(){throw new Error("Readable.from is not available in the browser")}),fromBrowser}var _stream_readable$2,hasRequired_stream_readable$2;function require_stream_readable$2(){if(hasRequired_stream_readable$2)return _stream_readable$2;hasRequired_stream_readable$2=1,_stream_readable$2=pe;var y;pe.ReadableState=we,requireEvents().EventEmitter;var u=function(Se,Be){return Se.listeners(Be).length},g=requireStreamBrowser$2(),v=requireDist().Buffer,b=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function w(Ie){return v.from(Ie)}function E(Ie){return v.isBuffer(Ie)||Ie instanceof b}var S=requireUtil$1(),A;S&&S.debuglog?A=S.debuglog("stream"):A=function(){};var $=requireBuffer_list(),R=requireDestroy$2(),T=requireState(),O=T.getHighWaterMark,B=requireErrorsBrowser().codes,F=B.ERR_INVALID_ARG_TYPE,U=B.ERR_STREAM_PUSH_AFTER_EOF,q=B.ERR_METHOD_NOT_IMPLEMENTED,J=B.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,ie,oe,le;requireInherits_browser()(pe,g);var de=R.errorOrDestroy,fe=["error","close","destroy","pause","resume"];function ye(Ie,Se,Be){if(typeof Ie.prependListener=="function")return Ie.prependListener(Se,Be);!Ie._events||!Ie._events[Se]?Ie.on(Se,Be):Array.isArray(Ie._events[Se])?Ie._events[Se].unshift(Be):Ie._events[Se]=[Be,Ie._events[Se]]}function we(Ie,Se,Be){y=y||require_stream_duplex$2(),Ie=Ie||{},typeof Be!="boolean"&&(Be=Se instanceof y),this.objectMode=!!Ie.objectMode,Be&&(this.objectMode=this.objectMode||!!Ie.readableObjectMode),this.highWaterMark=O(this,Ie,"readableHighWaterMark",Be),this.buffer=new $,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=Ie.emitClose!==!1,this.autoDestroy=!!Ie.autoDestroy,this.destroyed=!1,this.defaultEncoding=Ie.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Ie.encoding&&(ie||(ie=requireString_decoder().StringDecoder),this.decoder=new ie(Ie.encoding),this.encoding=Ie.encoding)}function pe(Ie){if(y=y||require_stream_duplex$2(),!(this instanceof pe))return new pe(Ie);var Se=this instanceof y;this._readableState=new we(Ie,this,Se),this.readable=!0,Ie&&(typeof Ie.read=="function"&&(this._read=Ie.read),typeof Ie.destroy=="function"&&(this._destroy=Ie.destroy)),g.call(this)}Object.defineProperty(pe.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(Se){this._readableState&&(this._readableState.destroyed=Se)}}),pe.prototype.destroy=R.destroy,pe.prototype._undestroy=R.undestroy,pe.prototype._destroy=function(Ie,Se){Se(Ie)},pe.prototype.push=function(Ie,Se){var Be=this._readableState,Le;return Be.objectMode?Le=!0:typeof Ie=="string"&&(Se=Se||Be.defaultEncoding,Se!==Be.encoding&&(Ie=v.from(Ie,Se),Se=""),Le=!0),ve(this,Ie,Se,!1,Le)},pe.prototype.unshift=function(Ie){return ve(this,Ie,null,!0,!1)};function ve(Ie,Se,Be,Le,qe){A("readableAddChunk",Se);var Ke=Ie._readableState;if(Se===null)Ke.reading=!1,re(Ie,Ke);else{var Ge;if(qe||(Ge=ae(Ke,Se)),Ge)de(Ie,Ge);else if(Ke.objectMode||Se&&Se.length>0)if(typeof Se!="string"&&!Ke.objectMode&&Object.getPrototypeOf(Se)!==v.prototype&&(Se=w(Se)),Le)Ke.endEmitted?de(Ie,new J):he(Ie,Ke,Se,!0);else if(Ke.ended)de(Ie,new U);else{if(Ke.destroyed)return!1;Ke.reading=!1,Ke.decoder&&!Be?(Se=Ke.decoder.write(Se),Ke.objectMode||Se.length!==0?he(Ie,Ke,Se,!1):ne(Ie,Ke)):he(Ie,Ke,Se,!1)}else Le||(Ke.reading=!1,ne(Ie,Ke))}return!Ke.ended&&(Ke.length<Ke.highWaterMark||Ke.length===0)}function he(Ie,Se,Be,Le){Se.flowing&&Se.length===0&&!Se.sync?(Se.awaitDrain=0,Ie.emit("data",Be)):(Se.length+=Se.objectMode?1:Be.length,Le?Se.buffer.unshift(Be):Se.buffer.push(Be),Se.needReadable&&Y(Ie)),ne(Ie,Se)}function ae(Ie,Se){var Be;return!E(Se)&&typeof Se!="string"&&Se!==void 0&&!Ie.objectMode&&(Be=new F("chunk",["string","Buffer","Uint8Array"],Se)),Be}pe.prototype.isPaused=function(){return this._readableState.flowing===!1},pe.prototype.setEncoding=function(Ie){ie||(ie=requireString_decoder().StringDecoder);var Se=new ie(Ie);this._readableState.decoder=Se,this._readableState.encoding=this._readableState.decoder.encoding;for(var Be=this._readableState.buffer.head,Le="";Be!==null;)Le+=Se.write(Be.data),Be=Be.next;return this._readableState.buffer.clear(),Le!==""&&this._readableState.buffer.push(Le),this._readableState.length=Le.length,this};var Q=1073741824;function j(Ie){return Ie>=Q?Ie=Q:(Ie--,Ie|=Ie>>>1,Ie|=Ie>>>2,Ie|=Ie>>>4,Ie|=Ie>>>8,Ie|=Ie>>>16,Ie++),Ie}function z(Ie,Se){return Ie<=0||Se.length===0&&Se.ended?0:Se.objectMode?1:Ie!==Ie?Se.flowing&&Se.length?Se.buffer.head.data.length:Se.length:(Ie>Se.highWaterMark&&(Se.highWaterMark=j(Ie)),Ie<=Se.length?Ie:Se.ended?Se.length:(Se.needReadable=!0,0))}pe.prototype.read=function(Ie){A("read",Ie),Ie=parseInt(Ie,10);var Se=this._readableState,Be=Ie;if(Ie!==0&&(Se.emittedReadable=!1),Ie===0&&Se.needReadable&&((Se.highWaterMark!==0?Se.length>=Se.highWaterMark:Se.length>0)||Se.ended))return A("read: emitReadable",Se.length,Se.ended),Se.length===0&&Se.ended?be(this):Y(this),null;if(Ie=z(Ie,Se),Ie===0&&Se.ended)return Se.length===0&&be(this),null;var Le=Se.needReadable;A("need readable",Le),(Se.length===0||Se.length-Ie<Se.highWaterMark)&&(Le=!0,A("length less than watermark",Le)),Se.ended||Se.reading?(Le=!1,A("reading or ended",Le)):Le&&(A("do read"),Se.reading=!0,Se.sync=!0,Se.length===0&&(Se.needReadable=!0),this._read(Se.highWaterMark),Se.sync=!1,Se.reading||(Ie=z(Be,Se)));var qe;return Ie>0?qe=ge(Ie,Se):qe=null,qe===null?(Se.needReadable=Se.length<=Se.highWaterMark,Ie=0):(Se.length-=Ie,Se.awaitDrain=0),Se.length===0&&(Se.ended||(Se.needReadable=!0),Be!==Ie&&Se.ended&&be(this)),qe!==null&&this.emit("data",qe),qe};function re(Ie,Se){if(A("onEofChunk"),!Se.ended){if(Se.decoder){var Be=Se.decoder.end();Be&&Be.length&&(Se.buffer.push(Be),Se.length+=Se.objectMode?1:Be.length)}Se.ended=!0,Se.sync?Y(Ie):(Se.needReadable=!1,Se.emittedReadable||(Se.emittedReadable=!0,te(Ie)))}}function Y(Ie){var Se=Ie._readableState;A("emitReadable",Se.needReadable,Se.emittedReadable),Se.needReadable=!1,Se.emittedReadable||(A("emitReadable",Se.flowing),Se.emittedReadable=!0,process$1.nextTick(te,Ie))}function te(Ie){var Se=Ie._readableState;A("emitReadable_",Se.destroyed,Se.length,Se.ended),!Se.destroyed&&(Se.length||Se.ended)&&(Ie.emit("readable"),Se.emittedReadable=!1),Se.needReadable=!Se.flowing&&!Se.ended&&Se.length<=Se.highWaterMark,Ae(Ie)}function ne(Ie,Se){Se.readingMore||(Se.readingMore=!0,process$1.nextTick(se,Ie,Se))}function se(Ie,Se){for(;!Se.reading&&!Se.ended&&(Se.length<Se.highWaterMark||Se.flowing&&Se.length===0);){var Be=Se.length;if(A("maybeReadMore read 0"),Ie.read(0),Be===Se.length)break}Se.readingMore=!1}pe.prototype._read=function(Ie){de(this,new q("_read()"))},pe.prototype.pipe=function(Ie,Se){var Be=this,Le=this._readableState;switch(Le.pipesCount){case 0:Le.pipes=Ie;break;case 1:Le.pipes=[Le.pipes,Ie];break;default:Le.pipes.push(Ie);break}Le.pipesCount+=1,A("pipe count=%d opts=%j",Le.pipesCount,Se);var qe=(!Se||Se.end!==!1)&&Ie!==process$1.stdout&&Ie!==process$1.stderr,Ke=qe?Xe:bt;Le.endEmitted?process$1.nextTick(Ke):Be.once("end",Ke),Ie.on("unpipe",Ge);function Ge(lt,kt){A("onunpipe"),lt===Be&&kt&&kt.hasUnpiped===!1&&(kt.hasUnpiped=!0,Ze())}function Xe(){A("onend"),Ie.end()}var ze=ee(Be);Ie.on("drain",ze);var et=!1;function Ze(){A("cleanup"),Ie.removeListener("close",ot),Ie.removeListener("finish",vt),Ie.removeListener("drain",ze),Ie.removeListener("error",ut),Ie.removeListener("unpipe",Ge),Be.removeListener("end",Xe),Be.removeListener("end",bt),Be.removeListener("data",nt),et=!0,Le.awaitDrain&&(!Ie._writableState||Ie._writableState.needDrain)&&ze()}Be.on("data",nt);function nt(lt){A("ondata");var kt=Ie.write(lt);A("dest.write",kt),kt===!1&&((Le.pipesCount===1&&Le.pipes===Ie||Le.pipesCount>1&&De(Le.pipes,Ie)!==-1)&&!et&&(A("false write response, pause",Le.awaitDrain),Le.awaitDrain++),Be.pause())}function ut(lt){A("onerror",lt),bt(),Ie.removeListener("error",ut),u(Ie,"error")===0&&de(Ie,lt)}ye(Ie,"error",ut);function ot(){Ie.removeListener("finish",vt),bt()}Ie.once("close",ot);function vt(){A("onfinish"),Ie.removeListener("close",ot),bt()}Ie.once("finish",vt);function bt(){A("unpipe"),Be.unpipe(Ie)}return Ie.emit("pipe",Be),Le.flowing||(A("pipe resume"),Be.resume()),Ie};function ee(Ie){return function(){var Be=Ie._readableState;A("pipeOnDrain",Be.awaitDrain),Be.awaitDrain&&Be.awaitDrain--,Be.awaitDrain===0&&u(Ie,"data")&&(Be.flowing=!0,Ae(Ie))}}pe.prototype.unpipe=function(Ie){var Se=this._readableState,Be={hasUnpiped:!1};if(Se.pipesCount===0)return this;if(Se.pipesCount===1)return Ie&&Ie!==Se.pipes?this:(Ie||(Ie=Se.pipes),Se.pipes=null,Se.pipesCount=0,Se.flowing=!1,Ie&&Ie.emit("unpipe",this,Be),this);if(!Ie){var Le=Se.pipes,qe=Se.pipesCount;Se.pipes=null,Se.pipesCount=0,Se.flowing=!1;for(var Ke=0;Ke<qe;Ke++)Le[Ke].emit("unpipe",this,{hasUnpiped:!1});return this}var Ge=De(Se.pipes,Ie);return Ge===-1?this:(Se.pipes.splice(Ge,1),Se.pipesCount-=1,Se.pipesCount===1&&(Se.pipes=Se.pipes[0]),Ie.emit("unpipe",this,Be),this)},pe.prototype.on=function(Ie,Se){var Be=g.prototype.on.call(this,Ie,Se),Le=this._readableState;return Ie==="data"?(Le.readableListening=this.listenerCount("readable")>0,Le.flowing!==!1&&this.resume()):Ie==="readable"&&!Le.endEmitted&&!Le.readableListening&&(Le.readableListening=Le.needReadable=!0,Le.flowing=!1,Le.emittedReadable=!1,A("on readable",Le.length,Le.reading),Le.length?Y(this):Le.reading||process$1.nextTick(ue,this)),Be},pe.prototype.addListener=pe.prototype.on,pe.prototype.removeListener=function(Ie,Se){var Be=g.prototype.removeListener.call(this,Ie,Se);return Ie==="readable"&&process$1.nextTick(Z,this),Be},pe.prototype.removeAllListeners=function(Ie){var Se=g.prototype.removeAllListeners.apply(this,arguments);return(Ie==="readable"||Ie===void 0)&&process$1.nextTick(Z,this),Se};function Z(Ie){var Se=Ie._readableState;Se.readableListening=Ie.listenerCount("readable")>0,Se.resumeScheduled&&!Se.paused?Se.flowing=!0:Ie.listenerCount("data")>0&&Ie.resume()}function ue(Ie){A("readable nexttick read 0"),Ie.read(0)}pe.prototype.resume=function(){var Ie=this._readableState;return Ie.flowing||(A("resume"),Ie.flowing=!Ie.readableListening,_e(this,Ie)),Ie.paused=!1,this};function _e(Ie,Se){Se.resumeScheduled||(Se.resumeScheduled=!0,process$1.nextTick(Re,Ie,Se))}function Re(Ie,Se){A("resume",Se.reading),Se.reading||Ie.read(0),Se.resumeScheduled=!1,Ie.emit("resume"),Ae(Ie),Se.flowing&&!Se.reading&&Ie.read(0)}pe.prototype.pause=function(){return A("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(A("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Ae(Ie){var Se=Ie._readableState;for(A("flow",Se.flowing);Se.flowing&&Ie.read()!==null;);}pe.prototype.wrap=function(Ie){var Se=this,Be=this._readableState,Le=!1;Ie.on("end",function(){if(A("wrapped end"),Be.decoder&&!Be.ended){var Ge=Be.decoder.end();Ge&&Ge.length&&Se.push(Ge)}Se.push(null)}),Ie.on("data",function(Ge){if(A("wrapped data"),Be.decoder&&(Ge=Be.decoder.write(Ge)),!(Be.objectMode&&Ge==null)&&!(!Be.objectMode&&(!Ge||!Ge.length))){var Xe=Se.push(Ge);Xe||(Le=!0,Ie.pause())}});for(var qe in Ie)this[qe]===void 0&&typeof Ie[qe]=="function"&&(this[qe]=(function(Xe){return function(){return Ie[Xe].apply(Ie,arguments)}})(qe));for(var Ke=0;Ke<fe.length;Ke++)Ie.on(fe[Ke],this.emit.bind(this,fe[Ke]));return this._read=function(Ge){A("wrapped _read",Ge),Le&&(Le=!1,Ie.resume())},this},typeof Symbol=="function"&&(pe.prototype[Symbol.asyncIterator]=function(){return oe===void 0&&(oe=requireAsync_iterator()),oe(this)}),Object.defineProperty(pe.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(pe.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(pe.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(Se){this._readableState&&(this._readableState.flowing=Se)}}),pe._fromList=ge,Object.defineProperty(pe.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function ge(Ie,Se){if(Se.length===0)return null;var Be;return Se.objectMode?Be=Se.buffer.shift():!Ie||Ie>=Se.length?(Se.decoder?Be=Se.buffer.join(""):Se.buffer.length===1?Be=Se.buffer.first():Be=Se.buffer.concat(Se.length),Se.buffer.clear()):Be=Se.buffer.consume(Ie,Se.decoder),Be}function be(Ie){var Se=Ie._readableState;A("endReadable",Se.endEmitted),Se.endEmitted||(Se.ended=!0,process$1.nextTick(Te,Se,Ie))}function Te(Ie,Se){if(A("endReadableNT",Ie.endEmitted,Ie.length),!Ie.endEmitted&&Ie.length===0&&(Ie.endEmitted=!0,Se.readable=!1,Se.emit("end"),Ie.autoDestroy)){var Be=Se._writableState;(!Be||Be.autoDestroy&&Be.finished)&&Se.destroy()}}typeof Symbol=="function"&&(pe.from=function(Ie,Se){return le===void 0&&(le=requireFromBrowser()),le(pe,Ie,Se)});function De(Ie,Se){for(var Be=0,Le=Ie.length;Be<Le;Be++)if(Ie[Be]===Se)return Be;return-1}return _stream_readable$2}var _stream_transform$2,hasRequired_stream_transform$2;function require_stream_transform$2(){if(hasRequired_stream_transform$2)return _stream_transform$2;hasRequired_stream_transform$2=1,_stream_transform$2=S;var y=requireErrorsBrowser().codes,u=y.ERR_METHOD_NOT_IMPLEMENTED,g=y.ERR_MULTIPLE_CALLBACK,v=y.ERR_TRANSFORM_ALREADY_TRANSFORMING,b=y.ERR_TRANSFORM_WITH_LENGTH_0,w=require_stream_duplex$2();requireInherits_browser()(S,w);function E(R,T){var O=this._transformState;O.transforming=!1;var B=O.writecb;if(B===null)return this.emit("error",new g);O.writechunk=null,O.writecb=null,T!=null&&this.push(T),B(R);var F=this._readableState;F.reading=!1,(F.needReadable||F.length<F.highWaterMark)&&this._read(F.highWaterMark)}function S(R){if(!(this instanceof S))return new S(R);w.call(this,R),this._transformState={afterTransform:E.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,R&&(typeof R.transform=="function"&&(this._transform=R.transform),typeof R.flush=="function"&&(this._flush=R.flush)),this.on("prefinish",A)}function A(){var R=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(T,O){$(R,T,O)}):$(this,null,null)}S.prototype.push=function(R,T){return this._transformState.needTransform=!1,w.prototype.push.call(this,R,T)},S.prototype._transform=function(R,T,O){O(new u("_transform()"))},S.prototype._write=function(R,T,O){var B=this._transformState;if(B.writecb=O,B.writechunk=R,B.writeencoding=T,!B.transforming){var F=this._readableState;(B.needTransform||F.needReadable||F.length<F.highWaterMark)&&this._read(F.highWaterMark)}},S.prototype._read=function(R){var T=this._transformState;T.writechunk!==null&&!T.transforming?(T.transforming=!0,this._transform(T.writechunk,T.writeencoding,T.afterTransform)):T.needTransform=!0},S.prototype._destroy=function(R,T){w.prototype._destroy.call(this,R,function(O){T(O)})};function $(R,T,O){if(T)return R.emit("error",T);if(O!=null&&R.push(O),R._writableState.length)throw new b;if(R._transformState.transforming)throw new v;return R.push(null)}return _stream_transform$2}var _stream_passthrough$2,hasRequired_stream_passthrough$2;function require_stream_passthrough$2(){if(hasRequired_stream_passthrough$2)return _stream_passthrough$2;hasRequired_stream_passthrough$2=1,_stream_passthrough$2=u;var y=require_stream_transform$2();requireInherits_browser()(u,y);function u(g){if(!(this instanceof u))return new u(g);y.call(this,g)}return u.prototype._transform=function(g,v,b){b(null,g)},_stream_passthrough$2}var pipeline_1,hasRequiredPipeline;function requirePipeline(){if(hasRequiredPipeline)return pipeline_1;hasRequiredPipeline=1;var y;function u(O){var B=!1;return function(){B||(B=!0,O.apply(void 0,arguments))}}var g=requireErrorsBrowser().codes,v=g.ERR_MISSING_ARGS,b=g.ERR_STREAM_DESTROYED;function w(O){if(O)throw O}function E(O){return O.setHeader&&typeof O.abort=="function"}function S(O,B,F,U){U=u(U);var q=!1;O.on("close",function(){q=!0}),y===void 0&&(y=requireEndOfStream()),y(O,{readable:B,writable:F},function(ie){if(ie)return U(ie);q=!0,U()});var J=!1;return function(ie){if(!q&&!J){if(J=!0,E(O))return O.abort();if(typeof O.destroy=="function")return O.destroy();U(ie||new b("pipe"))}}}function A(O){O()}function $(O,B){return O.pipe(B)}function R(O){return!O.length||typeof O[O.length-1]!="function"?w:O.pop()}function T(){for(var O=arguments.length,B=new Array(O),F=0;F<O;F++)B[F]=arguments[F];var U=R(B);if(Array.isArray(B[0])&&(B=B[0]),B.length<2)throw new v("streams");var q,J=B.map(function(ie,oe){var le=oe<B.length-1,de=oe>0;return S(ie,le,de,function(fe){q||(q=fe),fe&&J.forEach(A),!le&&(J.forEach(A),U(q))})});return B.reduce($)}return pipeline_1=T,pipeline_1}var streamBrowserify,hasRequiredStreamBrowserify;function requireStreamBrowserify(){if(hasRequiredStreamBrowserify)return streamBrowserify;hasRequiredStreamBrowserify=1,streamBrowserify=g;var y=requireEvents().EventEmitter,u=requireInherits_browser();u(g,y),g.Readable=require_stream_readable$2(),g.Writable=require_stream_writable$2(),g.Duplex=require_stream_duplex$2(),g.Transform=require_stream_transform$2(),g.PassThrough=require_stream_passthrough$2(),g.finished=requireEndOfStream(),g.pipeline=requirePipeline(),g.Stream=g;function g(){y.call(this)}return g.prototype.pipe=function(v,b){var w=this;function E(B){v.writable&&v.write(B)===!1&&w.pause&&w.pause()}w.on("data",E);function S(){w.readable&&w.resume&&w.resume()}v.on("drain",S),!v._isStdio&&(!b||b.end!==!1)&&(w.on("end",$),w.on("close",R));var A=!1;function $(){A||(A=!0,v.end())}function R(){A||(A=!0,typeof v.destroy=="function"&&v.destroy())}function T(B){if(O(),y.listenerCount(this,"error")===0)throw B}w.on("error",T),v.on("error",T);function O(){w.removeListener("data",E),v.removeListener("drain",S),w.removeListener("end",$),w.removeListener("close",R),w.removeListener("error",T),v.removeListener("error",T),w.removeListener("end",O),w.removeListener("close",O),v.removeListener("close",O)}return w.on("end",O),w.on("close",O),v.on("close",O),v.emit("pipe",w),v},streamBrowserify}var hashBase$1,hasRequiredHashBase$1;function requireHashBase$1(){if(hasRequiredHashBase$1)return hashBase$1;hasRequiredHashBase$1=1;var y=requireSafeBuffer$2().Buffer,u=requireStreamBrowserify().Transform,g=requireInherits_browser();function v(S){u.call(this),this._block=y.allocUnsafe(S),this._blockSize=S,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}g(v,u),v.prototype._transform=function(S,A,$){var R=null;try{this.update(S,A)}catch(T){R=T}$(R)},v.prototype._flush=function(S){var A=null;try{this.push(this.digest())}catch($){A=$}S(A)};var b=typeof Uint8Array<"u",w=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&ArrayBuffer.isView&&(y.prototype instanceof Uint8Array||y.TYPED_ARRAY_SUPPORT);function E(S,A){if(S instanceof y)return S;if(typeof S=="string")return y.from(S,A);if(w&&ArrayBuffer.isView(S)){if(S.byteLength===0)return y.alloc(0);var $=y.from(S.buffer,S.byteOffset,S.byteLength);if($.byteLength===S.byteLength)return $}if(b&&S instanceof Uint8Array||y.isBuffer(S)&&S.constructor&&typeof S.constructor.isBuffer=="function"&&S.constructor.isBuffer(S))return y.from(S);throw new TypeError('The "data" argument must be of type string or an instance of Buffer, TypedArray, or DataView.')}return v.prototype.update=function(S,A){if(this._finalized)throw new Error("Digest already called");S=E(S,A);for(var $=this._block,R=0;this._blockOffset+S.length-R>=this._blockSize;){for(var T=this._blockOffset;T<this._blockSize;)$[T++]=S[R++];this._update(),this._blockOffset=0}for(;R<S.length;)$[this._blockOffset++]=S[R++];for(var O=0,B=S.length*8;B>0;++O)this._length[O]+=B,B=this._length[O]/4294967296|0,B>0&&(this._length[O]-=4294967296*B);return this},v.prototype._update=function(){throw new Error("_update is not implemented")},v.prototype.digest=function(S){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var A=this._digest();S!==void 0&&(A=A.toString(S)),this._block.fill(0),this._blockOffset=0;for(var $=0;$<4;++$)this._length[$]=0;return A},v.prototype._digest=function(){throw new Error("_digest is not implemented")},hashBase$1=v,hashBase$1}var md5_js,hasRequiredMd5_js;function requireMd5_js(){if(hasRequiredMd5_js)return md5_js;hasRequiredMd5_js=1;var y=requireInherits_browser(),u=requireHashBase$1(),g=requireSafeBuffer$2().Buffer,v=new Array(16);function b(){u.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}y(b,u),b.prototype._update=function(){for(var R=v,T=0;T<16;++T)R[T]=this._block.readInt32LE(T*4);var O=this._a,B=this._b,F=this._c,U=this._d;O=E(O,B,F,U,R[0],3614090360,7),U=E(U,O,B,F,R[1],3905402710,12),F=E(F,U,O,B,R[2],606105819,17),B=E(B,F,U,O,R[3],3250441966,22),O=E(O,B,F,U,R[4],4118548399,7),U=E(U,O,B,F,R[5],1200080426,12),F=E(F,U,O,B,R[6],2821735955,17),B=E(B,F,U,O,R[7],4249261313,22),O=E(O,B,F,U,R[8],1770035416,7),U=E(U,O,B,F,R[9],2336552879,12),F=E(F,U,O,B,R[10],4294925233,17),B=E(B,F,U,O,R[11],2304563134,22),O=E(O,B,F,U,R[12],1804603682,7),U=E(U,O,B,F,R[13],4254626195,12),F=E(F,U,O,B,R[14],2792965006,17),B=E(B,F,U,O,R[15],1236535329,22),O=S(O,B,F,U,R[1],4129170786,5),U=S(U,O,B,F,R[6],3225465664,9),F=S(F,U,O,B,R[11],643717713,14),B=S(B,F,U,O,R[0],3921069994,20),O=S(O,B,F,U,R[5],3593408605,5),U=S(U,O,B,F,R[10],38016083,9),F=S(F,U,O,B,R[15],3634488961,14),B=S(B,F,U,O,R[4],3889429448,20),O=S(O,B,F,U,R[9],568446438,5),U=S(U,O,B,F,R[14],3275163606,9),F=S(F,U,O,B,R[3],4107603335,14),B=S(B,F,U,O,R[8],1163531501,20),O=S(O,B,F,U,R[13],2850285829,5),U=S(U,O,B,F,R[2],4243563512,9),F=S(F,U,O,B,R[7],1735328473,14),B=S(B,F,U,O,R[12],2368359562,20),O=A(O,B,F,U,R[5],4294588738,4),U=A(U,O,B,F,R[8],2272392833,11),F=A(F,U,O,B,R[11],1839030562,16),B=A(B,F,U,O,R[14],4259657740,23),O=A(O,B,F,U,R[1],2763975236,4),U=A(U,O,B,F,R[4],1272893353,11),F=A(F,U,O,B,R[7],4139469664,16),B=A(B,F,U,O,R[10],3200236656,23),O=A(O,B,F,U,R[13],681279174,4),U=A(U,O,B,F,R[0],3936430074,11),F=A(F,U,O,B,R[3],3572445317,16),B=A(B,F,U,O,R[6],76029189,23),O=A(O,B,F,U,R[9],3654602809,4),U=A(U,O,B,F,R[12],3873151461,11),F=A(F,U,O,B,R[15],530742520,16),B=A(B,F,U,O,R[2],3299628645,23),O=$(O,B,F,U,R[0],4096336452,6),U=$(U,O,B,F,R[7],1126891415,10),F=$(F,U,O,B,R[14],2878612391,15),B=$(B,F,U,O,R[5],4237533241,21),O=$(O,B,F,U,R[12],1700485571,6),U=$(U,O,B,F,R[3],2399980690,10),F=$(F,U,O,B,R[10],4293915773,15),B=$(B,F,U,O,R[1],2240044497,21),O=$(O,B,F,U,R[8],1873313359,6),U=$(U,O,B,F,R[15],4264355552,10),F=$(F,U,O,B,R[6],2734768916,15),B=$(B,F,U,O,R[13],1309151649,21),O=$(O,B,F,U,R[4],4149444226,6),U=$(U,O,B,F,R[11],3174756917,10),F=$(F,U,O,B,R[2],718787259,15),B=$(B,F,U,O,R[9],3951481745,21),this._a=this._a+O|0,this._b=this._b+B|0,this._c=this._c+F|0,this._d=this._d+U|0},b.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var R=g.allocUnsafe(16);return R.writeInt32LE(this._a,0),R.writeInt32LE(this._b,4),R.writeInt32LE(this._c,8),R.writeInt32LE(this._d,12),R};function w(R,T){return R<<T|R>>>32-T}function E(R,T,O,B,F,U,q){return w(R+(T&O|~T&B)+F+U|0,q)+T|0}function S(R,T,O,B,F,U,q){return w(R+(T&B|O&~B)+F+U|0,q)+T|0}function A(R,T,O,B,F,U,q){return w(R+(T^O^B)+F+U|0,q)+T|0}function $(R,T,O,B,F,U,q){return w(R+(O^(T|~B))+F+U|0,q)+T|0}return md5_js=b,md5_js}var isarray$2,hasRequiredIsarray$2;function requireIsarray$2(){if(hasRequiredIsarray$2)return isarray$2;hasRequiredIsarray$2=1;var y={}.toString;return isarray$2=Array.isArray||function(u){return y.call(u)=="[object Array]"},isarray$2}var typedArrayBuffer,hasRequiredTypedArrayBuffer;function requireTypedArrayBuffer(){if(hasRequiredTypedArrayBuffer)return typedArrayBuffer;hasRequiredTypedArrayBuffer=1;var y=requireType(),u=requireCallBound(),g=u("TypedArray.prototype.buffer",!0),v=requireIsTypedArray();return typedArrayBuffer=g||function(w){if(!v(w))throw new y("Not a Typed Array");return w.buffer},typedArrayBuffer}var toBuffer$1,hasRequiredToBuffer$2;function requireToBuffer$2(){if(hasRequiredToBuffer$2)return toBuffer$1;hasRequiredToBuffer$2=1;var y=requireSafeBuffer$2().Buffer,u=requireIsarray$2(),g=requireTypedArrayBuffer(),v=ArrayBuffer.isView||function(A){try{return g(A),!0}catch{return!1}},b=typeof Uint8Array<"u",w=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",E=w&&(y.prototype instanceof Uint8Array||y.TYPED_ARRAY_SUPPORT);return toBuffer$1=function(A,$){if(y.isBuffer(A))return A.constructor&&!("isBuffer"in A)?y.from(A):A;if(typeof A=="string")return y.from(A,$);if(w&&v(A)){if(A.byteLength===0)return y.alloc(0);if(E){var R=y.from(A.buffer,A.byteOffset,A.byteLength);if(R.byteLength===A.byteLength)return R}var T=A instanceof Uint8Array?A:new Uint8Array(A.buffer,A.byteOffset,A.byteLength),O=y.from(T);if(O.length===A.byteLength)return O}if(b&&A instanceof Uint8Array)return y.from(A);var B=u(A);if(B)for(var F=0;F<A.length;F+=1){var U=A[F];if(typeof U!="number"||U<0||U>255||~~U!==U)throw new RangeError("Array items must be numbers in the range 0-255.")}if(B||y.isBuffer(A)&&A.constructor&&typeof A.constructor.isBuffer=="function"&&A.constructor.isBuffer(A))return y.from(A);throw new TypeError('The "data" argument must be a string, an Array, a Buffer, a Uint8Array, or a DataView.')},toBuffer$1}var toBuffer_1$1,hasRequiredToBuffer$1;function requireToBuffer$1(){if(hasRequiredToBuffer$1)return toBuffer_1$1;hasRequiredToBuffer$1=1;var y=requireSafeBuffer$2().Buffer,u=requireToBuffer$2(),g=typeof Uint8Array<"u",v=g&&typeof ArrayBuffer<"u",b=v&&ArrayBuffer.isView;return toBuffer_1$1=function(w,E){if(typeof w=="string"||y.isBuffer(w)||g&&w instanceof Uint8Array||b&&b(w))return u(w,E);throw new TypeError('The "data" argument must be a string, a Buffer, a Uint8Array, or a DataView')},toBuffer_1$1}var readableBrowser$1={exports:{}},processNextickArgs={exports:{}},hasRequiredProcessNextickArgs;function requireProcessNextickArgs(){if(hasRequiredProcessNextickArgs)return processNextickArgs.exports;hasRequiredProcessNextickArgs=1,typeof process$1>"u"||!process$1.version||process$1.version.indexOf("v0.")===0||process$1.version.indexOf("v1.")===0&&process$1.version.indexOf("v1.8.")!==0?processNextickArgs.exports={nextTick:y}:processNextickArgs.exports=process$1;function y(u,g,v,b){if(typeof u!="function")throw new TypeError('"callback" argument must be a function');var w=arguments.length,E,S;switch(w){case 0:case 1:return process$1.nextTick(u);case 2:return process$1.nextTick(function(){u.call(null,g)});case 3:return process$1.nextTick(function(){u.call(null,g,v)});case 4:return process$1.nextTick(function(){u.call(null,g,v,b)});default:for(E=new Array(w-1),S=0;S<E.length;)E[S++]=arguments[S];return process$1.nextTick(function(){u.apply(null,E)})}}return processNextickArgs.exports}var isarray$1,hasRequiredIsarray$1;function requireIsarray$1(){if(hasRequiredIsarray$1)return isarray$1;hasRequiredIsarray$1=1;var y={}.toString;return isarray$1=Array.isArray||function(u){return y.call(u)=="[object Array]"},isarray$1}var streamBrowser$1,hasRequiredStreamBrowser$1;function requireStreamBrowser$1(){return hasRequiredStreamBrowser$1||(hasRequiredStreamBrowser$1=1,streamBrowser$1=requireEvents().EventEmitter),streamBrowser$1}var safeBuffer$1={exports:{}},hasRequiredSafeBuffer$1;function requireSafeBuffer$1(){return hasRequiredSafeBuffer$1||(hasRequiredSafeBuffer$1=1,(function(y,u){var g=requireDist(),v=g.Buffer;function b(E,S){for(var A in E)S[A]=E[A]}v.from&&v.alloc&&v.allocUnsafe&&v.allocUnsafeSlow?y.exports=g:(b(g,u),u.Buffer=w);function w(E,S,A){return v(E,S,A)}b(v,w),w.from=function(E,S,A){if(typeof E=="number")throw new TypeError("Argument must not be a number");return v(E,S,A)},w.alloc=function(E,S,A){if(typeof E!="number")throw new TypeError("Argument must be a number");var $=v(E);return S!==void 0?typeof A=="string"?$.fill(S,A):$.fill(S):$.fill(0),$},w.allocUnsafe=function(E){if(typeof E!="number")throw new TypeError("Argument must be a number");return v(E)},w.allocUnsafeSlow=function(E){if(typeof E!="number")throw new TypeError("Argument must be a number");return g.SlowBuffer(E)}})(safeBuffer$1,safeBuffer$1.exports)),safeBuffer$1.exports}var util={},hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return util;hasRequiredUtil=1;function y(U){return Array.isArray?Array.isArray(U):F(U)==="[object Array]"}util.isArray=y;function u(U){return typeof U=="boolean"}util.isBoolean=u;function g(U){return U===null}util.isNull=g;function v(U){return U==null}util.isNullOrUndefined=v;function b(U){return typeof U=="number"}util.isNumber=b;function w(U){return typeof U=="string"}util.isString=w;function E(U){return typeof U=="symbol"}util.isSymbol=E;function S(U){return U===void 0}util.isUndefined=S;function A(U){return F(U)==="[object RegExp]"}util.isRegExp=A;function $(U){return typeof U=="object"&&U!==null}util.isObject=$;function R(U){return F(U)==="[object Date]"}util.isDate=R;function T(U){return F(U)==="[object Error]"||U instanceof Error}util.isError=T;function O(U){return typeof U=="function"}util.isFunction=O;function B(U){return U===null||typeof U=="boolean"||typeof U=="number"||typeof U=="string"||typeof U=="symbol"||typeof U>"u"}util.isPrimitive=B,util.isBuffer=requireDist().Buffer.isBuffer;function F(U){return Object.prototype.toString.call(U)}return util}var BufferList$1={exports:{}},hasRequiredBufferList$1;function requireBufferList$1(){return hasRequiredBufferList$1||(hasRequiredBufferList$1=1,(function(y){function u(w,E){if(!(w instanceof E))throw new TypeError("Cannot call a class as a function")}var g=requireSafeBuffer$1().Buffer,v=requireUtil$1();function b(w,E,S){w.copy(E,S)}y.exports=(function(){function w(){u(this,w),this.head=null,this.tail=null,this.length=0}return w.prototype.push=function(S){var A={data:S,next:null};this.length>0?this.tail.next=A:this.head=A,this.tail=A,++this.length},w.prototype.unshift=function(S){var A={data:S,next:this.head};this.length===0&&(this.tail=A),this.head=A,++this.length},w.prototype.shift=function(){if(this.length!==0){var S=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,S}},w.prototype.clear=function(){this.head=this.tail=null,this.length=0},w.prototype.join=function(S){if(this.length===0)return"";for(var A=this.head,$=""+A.data;A=A.next;)$+=S+A.data;return $},w.prototype.concat=function(S){if(this.length===0)return g.alloc(0);for(var A=g.allocUnsafe(S>>>0),$=this.head,R=0;$;)b($.data,A,R),R+=$.data.length,$=$.next;return A},w})(),v&&v.inspect&&v.inspect.custom&&(y.exports.prototype[v.inspect.custom]=function(){var w=v.inspect({length:this.length});return this.constructor.name+" "+w})})(BufferList$1)),BufferList$1.exports}var destroy_1$1,hasRequiredDestroy$1;function requireDestroy$1(){if(hasRequiredDestroy$1)return destroy_1$1;hasRequiredDestroy$1=1;var y=requireProcessNextickArgs();function u(b,w){var E=this,S=this._readableState&&this._readableState.destroyed,A=this._writableState&&this._writableState.destroyed;return S||A?(w?w(b):b&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,y.nextTick(v,this,b)):y.nextTick(v,this,b)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(b||null,function($){!w&&$?E._writableState?E._writableState.errorEmitted||(E._writableState.errorEmitted=!0,y.nextTick(v,E,$)):y.nextTick(v,E,$):w&&w($)}),this)}function g(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function v(b,w){b.emit("error",w)}return destroy_1$1={destroy:u,undestroy:g},destroy_1$1}var _stream_writable$1,hasRequired_stream_writable$1;function require_stream_writable$1(){if(hasRequired_stream_writable$1)return _stream_writable$1;hasRequired_stream_writable$1=1;var y=requireProcessNextickArgs();_stream_writable$1=U;function u(Y){var te=this;this.next=null,this.entry=null,this.finish=function(){re(te,Y)}}var g=!process$1.browser&&["v0.10","v0.9."].indexOf(process$1.version.slice(0,5))>-1?setImmediate:y.nextTick,v;U.WritableState=B;var b=Object.create(requireUtil());b.inherits=requireInherits_browser();var w={deprecate:requireBrowser$c()},E=requireStreamBrowser$1(),S=requireSafeBuffer$1().Buffer,A=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function $(Y){return S.from(Y)}function R(Y){return S.isBuffer(Y)||Y instanceof A}var T=requireDestroy$1();b.inherits(U,E);function O(){}function B(Y,te){v=v||require_stream_duplex$1(),Y=Y||{};var ne=te instanceof v;this.objectMode=!!Y.objectMode,ne&&(this.objectMode=this.objectMode||!!Y.writableObjectMode);var se=Y.highWaterMark,ee=Y.writableHighWaterMark,Z=this.objectMode?16:16*1024;se||se===0?this.highWaterMark=se:ne&&(ee||ee===0)?this.highWaterMark=ee:this.highWaterMark=Z,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var ue=Y.decodeStrings===!1;this.decodeStrings=!ue,this.defaultEncoding=Y.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(_e){ye(te,_e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new u(this)}B.prototype.getBuffer=function(){for(var te=this.bufferedRequest,ne=[];te;)ne.push(te),te=te.next;return ne},(function(){try{Object.defineProperty(B.prototype,"buffer",{get:w.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var F;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(F=Function.prototype[Symbol.hasInstance],Object.defineProperty(U,Symbol.hasInstance,{value:function(Y){return F.call(this,Y)?!0:this!==U?!1:Y&&Y._writableState instanceof B}})):F=function(Y){return Y instanceof this};function U(Y){if(v=v||require_stream_duplex$1(),!F.call(U,this)&&!(this instanceof v))return new U(Y);this._writableState=new B(Y,this),this.writable=!0,Y&&(typeof Y.write=="function"&&(this._write=Y.write),typeof Y.writev=="function"&&(this._writev=Y.writev),typeof Y.destroy=="function"&&(this._destroy=Y.destroy),typeof Y.final=="function"&&(this._final=Y.final)),E.call(this)}U.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function q(Y,te){var ne=new Error("write after end");Y.emit("error",ne),y.nextTick(te,ne)}function J(Y,te,ne,se){var ee=!0,Z=!1;return ne===null?Z=new TypeError("May not write null values to stream"):typeof ne!="string"&&ne!==void 0&&!te.objectMode&&(Z=new TypeError("Invalid non-string/buffer chunk")),Z&&(Y.emit("error",Z),y.nextTick(se,Z),ee=!1),ee}U.prototype.write=function(Y,te,ne){var se=this._writableState,ee=!1,Z=!se.objectMode&&R(Y);return Z&&!S.isBuffer(Y)&&(Y=$(Y)),typeof te=="function"&&(ne=te,te=null),Z?te="buffer":te||(te=se.defaultEncoding),typeof ne!="function"&&(ne=O),se.ended?q(this,ne):(Z||J(this,se,Y,ne))&&(se.pendingcb++,ee=oe(this,se,Z,Y,te,ne)),ee},U.prototype.cork=function(){var Y=this._writableState;Y.corked++},U.prototype.uncork=function(){var Y=this._writableState;Y.corked&&(Y.corked--,!Y.writing&&!Y.corked&&!Y.bufferProcessing&&Y.bufferedRequest&&ve(this,Y))},U.prototype.setDefaultEncoding=function(te){if(typeof te=="string"&&(te=te.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((te+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+te);return this._writableState.defaultEncoding=te,this};function ie(Y,te,ne){return!Y.objectMode&&Y.decodeStrings!==!1&&typeof te=="string"&&(te=S.from(te,ne)),te}Object.defineProperty(U.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function oe(Y,te,ne,se,ee,Z){if(!ne){var ue=ie(te,se,ee);se!==ue&&(ne=!0,ee="buffer",se=ue)}var _e=te.objectMode?1:se.length;te.length+=_e;var Re=te.length<te.highWaterMark;if(Re||(te.needDrain=!0),te.writing||te.corked){var Ae=te.lastBufferedRequest;te.lastBufferedRequest={chunk:se,encoding:ee,isBuf:ne,callback:Z,next:null},Ae?Ae.next=te.lastBufferedRequest:te.bufferedRequest=te.lastBufferedRequest,te.bufferedRequestCount+=1}else le(Y,te,!1,_e,se,ee,Z);return Re}function le(Y,te,ne,se,ee,Z,ue){te.writelen=se,te.writecb=ue,te.writing=!0,te.sync=!0,ne?Y._writev(ee,te.onwrite):Y._write(ee,Z,te.onwrite),te.sync=!1}function de(Y,te,ne,se,ee){--te.pendingcb,ne?(y.nextTick(ee,se),y.nextTick(j,Y,te),Y._writableState.errorEmitted=!0,Y.emit("error",se)):(ee(se),Y._writableState.errorEmitted=!0,Y.emit("error",se),j(Y,te))}function fe(Y){Y.writing=!1,Y.writecb=null,Y.length-=Y.writelen,Y.writelen=0}function ye(Y,te){var ne=Y._writableState,se=ne.sync,ee=ne.writecb;if(fe(ne),te)de(Y,ne,se,te,ee);else{var Z=he(ne);!Z&&!ne.corked&&!ne.bufferProcessing&&ne.bufferedRequest&&ve(Y,ne),se?g(we,Y,ne,Z,ee):we(Y,ne,Z,ee)}}function we(Y,te,ne,se){ne||pe(Y,te),te.pendingcb--,se(),j(Y,te)}function pe(Y,te){te.length===0&&te.needDrain&&(te.needDrain=!1,Y.emit("drain"))}function ve(Y,te){te.bufferProcessing=!0;var ne=te.bufferedRequest;if(Y._writev&&ne&&ne.next){var se=te.bufferedRequestCount,ee=new Array(se),Z=te.corkedRequestsFree;Z.entry=ne;for(var ue=0,_e=!0;ne;)ee[ue]=ne,ne.isBuf||(_e=!1),ne=ne.next,ue+=1;ee.allBuffers=_e,le(Y,te,!0,te.length,ee,"",Z.finish),te.pendingcb++,te.lastBufferedRequest=null,Z.next?(te.corkedRequestsFree=Z.next,Z.next=null):te.corkedRequestsFree=new u(te),te.bufferedRequestCount=0}else{for(;ne;){var Re=ne.chunk,Ae=ne.encoding,ge=ne.callback,be=te.objectMode?1:Re.length;if(le(Y,te,!1,be,Re,Ae,ge),ne=ne.next,te.bufferedRequestCount--,te.writing)break}ne===null&&(te.lastBufferedRequest=null)}te.bufferedRequest=ne,te.bufferProcessing=!1}U.prototype._write=function(Y,te,ne){ne(new Error("_write() is not implemented"))},U.prototype._writev=null,U.prototype.end=function(Y,te,ne){var se=this._writableState;typeof Y=="function"?(ne=Y,Y=null,te=null):typeof te=="function"&&(ne=te,te=null),Y!=null&&this.write(Y,te),se.corked&&(se.corked=1,this.uncork()),se.ending||z(this,se,ne)};function he(Y){return Y.ending&&Y.length===0&&Y.bufferedRequest===null&&!Y.finished&&!Y.writing}function ae(Y,te){Y._final(function(ne){te.pendingcb--,ne&&Y.emit("error",ne),te.prefinished=!0,Y.emit("prefinish"),j(Y,te)})}function Q(Y,te){!te.prefinished&&!te.finalCalled&&(typeof Y._final=="function"?(te.pendingcb++,te.finalCalled=!0,y.nextTick(ae,Y,te)):(te.prefinished=!0,Y.emit("prefinish")))}function j(Y,te){var ne=he(te);return ne&&(Q(Y,te),te.pendingcb===0&&(te.finished=!0,Y.emit("finish"))),ne}function z(Y,te,ne){te.ending=!0,j(Y,te),ne&&(te.finished?y.nextTick(ne):Y.once("finish",ne)),te.ended=!0,Y.writable=!1}function re(Y,te,ne){var se=Y.entry;for(Y.entry=null;se;){var ee=se.callback;te.pendingcb--,ee(ne),se=se.next}te.corkedRequestsFree.next=Y}return Object.defineProperty(U.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Y){this._writableState&&(this._writableState.destroyed=Y)}}),U.prototype.destroy=T.destroy,U.prototype._undestroy=T.undestroy,U.prototype._destroy=function(Y,te){this.end(),te(Y)},_stream_writable$1}var _stream_duplex$1,hasRequired_stream_duplex$1;function require_stream_duplex$1(){if(hasRequired_stream_duplex$1)return _stream_duplex$1;hasRequired_stream_duplex$1=1;var y=requireProcessNextickArgs(),u=Object.keys||function(T){var O=[];for(var B in T)O.push(B);return O};_stream_duplex$1=A;var g=Object.create(requireUtil());g.inherits=requireInherits_browser();var v=require_stream_readable$1(),b=require_stream_writable$1();g.inherits(A,v);for(var w=u(b.prototype),E=0;E<w.length;E++){var S=w[E];A.prototype[S]||(A.prototype[S]=b.prototype[S])}function A(T){if(!(this instanceof A))return new A(T);v.call(this,T),b.call(this,T),T&&T.readable===!1&&(this.readable=!1),T&&T.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,T&&T.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",$)}Object.defineProperty(A.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function $(){this.allowHalfOpen||this._writableState.ended||y.nextTick(R,this)}function R(T){T.end()}return Object.defineProperty(A.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(T){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=T,this._writableState.destroyed=T)}}),A.prototype._destroy=function(T,O){this.push(null),this.end(),y.nextTick(O,T)},_stream_duplex$1}var _stream_readable$1,hasRequired_stream_readable$1;function require_stream_readable$1(){if(hasRequired_stream_readable$1)return _stream_readable$1;hasRequired_stream_readable$1=1;var y=requireProcessNextickArgs();_stream_readable$1=ie;var u=requireIsarray$1(),g;ie.ReadableState=J,requireEvents().EventEmitter;var v=function(ge,be){return ge.listeners(be).length},b=requireStreamBrowser$1(),w=requireSafeBuffer$1().Buffer,E=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function S(ge){return w.from(ge)}function A(ge){return w.isBuffer(ge)||ge instanceof E}var $=Object.create(requireUtil());$.inherits=requireInherits_browser();var R=requireUtil$1(),T=void 0;R&&R.debuglog?T=R.debuglog("stream"):T=function(){};var O=requireBufferList$1(),B=requireDestroy$1(),F;$.inherits(ie,b);var U=["error","close","destroy","pause","resume"];function q(ge,be,Te){if(typeof ge.prependListener=="function")return ge.prependListener(be,Te);!ge._events||!ge._events[be]?ge.on(be,Te):u(ge._events[be])?ge._events[be].unshift(Te):ge._events[be]=[Te,ge._events[be]]}function J(ge,be){g=g||require_stream_duplex$1(),ge=ge||{};var Te=be instanceof g;this.objectMode=!!ge.objectMode,Te&&(this.objectMode=this.objectMode||!!ge.readableObjectMode);var De=ge.highWaterMark,Ie=ge.readableHighWaterMark,Se=this.objectMode?16:16*1024;De||De===0?this.highWaterMark=De:Te&&(Ie||Ie===0)?this.highWaterMark=Ie:this.highWaterMark=Se,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new O,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=ge.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,ge.encoding&&(F||(F=requireString_decoder().StringDecoder),this.decoder=new F(ge.encoding),this.encoding=ge.encoding)}function ie(ge){if(g=g||require_stream_duplex$1(),!(this instanceof ie))return new ie(ge);this._readableState=new J(ge,this),this.readable=!0,ge&&(typeof ge.read=="function"&&(this._read=ge.read),typeof ge.destroy=="function"&&(this._destroy=ge.destroy)),b.call(this)}Object.defineProperty(ie.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(ge){this._readableState&&(this._readableState.destroyed=ge)}}),ie.prototype.destroy=B.destroy,ie.prototype._undestroy=B.undestroy,ie.prototype._destroy=function(ge,be){this.push(null),be(ge)},ie.prototype.push=function(ge,be){var Te=this._readableState,De;return Te.objectMode?De=!0:typeof ge=="string"&&(be=be||Te.defaultEncoding,be!==Te.encoding&&(ge=w.from(ge,be),be=""),De=!0),oe(this,ge,be,!1,De)},ie.prototype.unshift=function(ge){return oe(this,ge,null,!0,!1)};function oe(ge,be,Te,De,Ie){var Se=ge._readableState;if(be===null)Se.reading=!1,ve(ge,Se);else{var Be;Ie||(Be=de(Se,be)),Be?ge.emit("error",Be):Se.objectMode||be&&be.length>0?(typeof be!="string"&&!Se.objectMode&&Object.getPrototypeOf(be)!==w.prototype&&(be=S(be)),De?Se.endEmitted?ge.emit("error",new Error("stream.unshift() after end event")):le(ge,Se,be,!0):Se.ended?ge.emit("error",new Error("stream.push() after EOF")):(Se.reading=!1,Se.decoder&&!Te?(be=Se.decoder.write(be),Se.objectMode||be.length!==0?le(ge,Se,be,!1):Q(ge,Se)):le(ge,Se,be,!1))):De||(Se.reading=!1)}return fe(Se)}function le(ge,be,Te,De){be.flowing&&be.length===0&&!be.sync?(ge.emit("data",Te),ge.read(0)):(be.length+=be.objectMode?1:Te.length,De?be.buffer.unshift(Te):be.buffer.push(Te),be.needReadable&&he(ge)),Q(ge,be)}function de(ge,be){var Te;return!A(be)&&typeof be!="string"&&be!==void 0&&!ge.objectMode&&(Te=new TypeError("Invalid non-string/buffer chunk")),Te}function fe(ge){return!ge.ended&&(ge.needReadable||ge.length<ge.highWaterMark||ge.length===0)}ie.prototype.isPaused=function(){return this._readableState.flowing===!1},ie.prototype.setEncoding=function(ge){return F||(F=requireString_decoder().StringDecoder),this._readableState.decoder=new F(ge),this._readableState.encoding=ge,this};var ye=8388608;function we(ge){return ge>=ye?ge=ye:(ge--,ge|=ge>>>1,ge|=ge>>>2,ge|=ge>>>4,ge|=ge>>>8,ge|=ge>>>16,ge++),ge}function pe(ge,be){return ge<=0||be.length===0&&be.ended?0:be.objectMode?1:ge!==ge?be.flowing&&be.length?be.buffer.head.data.length:be.length:(ge>be.highWaterMark&&(be.highWaterMark=we(ge)),ge<=be.length?ge:be.ended?be.length:(be.needReadable=!0,0))}ie.prototype.read=function(ge){T("read",ge),ge=parseInt(ge,10);var be=this._readableState,Te=ge;if(ge!==0&&(be.emittedReadable=!1),ge===0&&be.needReadable&&(be.length>=be.highWaterMark||be.ended))return T("read: emitReadable",be.length,be.ended),be.length===0&&be.ended?_e(this):he(this),null;if(ge=pe(ge,be),ge===0&&be.ended)return be.length===0&&_e(this),null;var De=be.needReadable;T("need readable",De),(be.length===0||be.length-ge<be.highWaterMark)&&(De=!0,T("length less than watermark",De)),be.ended||be.reading?(De=!1,T("reading or ended",De)):De&&(T("do read"),be.reading=!0,be.sync=!0,be.length===0&&(be.needReadable=!0),this._read(be.highWaterMark),be.sync=!1,be.reading||(ge=pe(Te,be)));var Ie;return ge>0?Ie=se(ge,be):Ie=null,Ie===null?(be.needReadable=!0,ge=0):be.length-=ge,be.length===0&&(be.ended||(be.needReadable=!0),Te!==ge&&be.ended&&_e(this)),Ie!==null&&this.emit("data",Ie),Ie};function ve(ge,be){if(!be.ended){if(be.decoder){var Te=be.decoder.end();Te&&Te.length&&(be.buffer.push(Te),be.length+=be.objectMode?1:Te.length)}be.ended=!0,he(ge)}}function he(ge){var be=ge._readableState;be.needReadable=!1,be.emittedReadable||(T("emitReadable",be.flowing),be.emittedReadable=!0,be.sync?y.nextTick(ae,ge):ae(ge))}function ae(ge){T("emit readable"),ge.emit("readable"),ne(ge)}function Q(ge,be){be.readingMore||(be.readingMore=!0,y.nextTick(j,ge,be))}function j(ge,be){for(var Te=be.length;!be.reading&&!be.flowing&&!be.ended&&be.length<be.highWaterMark&&(T("maybeReadMore read 0"),ge.read(0),Te!==be.length);)Te=be.length;be.readingMore=!1}ie.prototype._read=function(ge){this.emit("error",new Error("_read() is not implemented"))},ie.prototype.pipe=function(ge,be){var Te=this,De=this._readableState;switch(De.pipesCount){case 0:De.pipes=ge;break;case 1:De.pipes=[De.pipes,ge];break;default:De.pipes.push(ge);break}De.pipesCount+=1,T("pipe count=%d opts=%j",De.pipesCount,be);var Ie=(!be||be.end!==!1)&&ge!==process$1.stdout&&ge!==process$1.stderr,Se=Ie?Le:ut;De.endEmitted?y.nextTick(Se):Te.once("end",Se),ge.on("unpipe",Be);function Be(ot,vt){T("onunpipe"),ot===Te&&vt&&vt.hasUnpiped===!1&&(vt.hasUnpiped=!0,Ge())}function Le(){T("onend"),ge.end()}var qe=z(Te);ge.on("drain",qe);var Ke=!1;function Ge(){T("cleanup"),ge.removeListener("close",Ze),ge.removeListener("finish",nt),ge.removeListener("drain",qe),ge.removeListener("error",et),ge.removeListener("unpipe",Be),Te.removeListener("end",Le),Te.removeListener("end",ut),Te.removeListener("data",ze),Ke=!0,De.awaitDrain&&(!ge._writableState||ge._writableState.needDrain)&&qe()}var Xe=!1;Te.on("data",ze);function ze(ot){T("ondata"),Xe=!1;var vt=ge.write(ot);vt===!1&&!Xe&&((De.pipesCount===1&&De.pipes===ge||De.pipesCount>1&&Ae(De.pipes,ge)!==-1)&&!Ke&&(T("false write response, pause",De.awaitDrain),De.awaitDrain++,Xe=!0),Te.pause())}function et(ot){T("onerror",ot),ut(),ge.removeListener("error",et),v(ge,"error")===0&&ge.emit("error",ot)}q(ge,"error",et);function Ze(){ge.removeListener("finish",nt),ut()}ge.once("close",Ze);function nt(){T("onfinish"),ge.removeListener("close",Ze),ut()}ge.once("finish",nt);function ut(){T("unpipe"),Te.unpipe(ge)}return ge.emit("pipe",Te),De.flowing||(T("pipe resume"),Te.resume()),ge};function z(ge){return function(){var be=ge._readableState;T("pipeOnDrain",be.awaitDrain),be.awaitDrain&&be.awaitDrain--,be.awaitDrain===0&&v(ge,"data")&&(be.flowing=!0,ne(ge))}}ie.prototype.unpipe=function(ge){var be=this._readableState,Te={hasUnpiped:!1};if(be.pipesCount===0)return this;if(be.pipesCount===1)return ge&&ge!==be.pipes?this:(ge||(ge=be.pipes),be.pipes=null,be.pipesCount=0,be.flowing=!1,ge&&ge.emit("unpipe",this,Te),this);if(!ge){var De=be.pipes,Ie=be.pipesCount;be.pipes=null,be.pipesCount=0,be.flowing=!1;for(var Se=0;Se<Ie;Se++)De[Se].emit("unpipe",this,{hasUnpiped:!1});return this}var Be=Ae(be.pipes,ge);return Be===-1?this:(be.pipes.splice(Be,1),be.pipesCount-=1,be.pipesCount===1&&(be.pipes=be.pipes[0]),ge.emit("unpipe",this,Te),this)},ie.prototype.on=function(ge,be){var Te=b.prototype.on.call(this,ge,be);if(ge==="data")this._readableState.flowing!==!1&&this.resume();else if(ge==="readable"){var De=this._readableState;!De.endEmitted&&!De.readableListening&&(De.readableListening=De.needReadable=!0,De.emittedReadable=!1,De.reading?De.length&&he(this):y.nextTick(re,this))}return Te},ie.prototype.addListener=ie.prototype.on;function re(ge){T("readable nexttick read 0"),ge.read(0)}ie.prototype.resume=function(){var ge=this._readableState;return ge.flowing||(T("resume"),ge.flowing=!0,Y(this,ge)),this};function Y(ge,be){be.resumeScheduled||(be.resumeScheduled=!0,y.nextTick(te,ge,be))}function te(ge,be){be.reading||(T("resume read 0"),ge.read(0)),be.resumeScheduled=!1,be.awaitDrain=0,ge.emit("resume"),ne(ge),be.flowing&&!be.reading&&ge.read(0)}ie.prototype.pause=function(){return T("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(T("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function ne(ge){var be=ge._readableState;for(T("flow",be.flowing);be.flowing&&ge.read()!==null;);}ie.prototype.wrap=function(ge){var be=this,Te=this._readableState,De=!1;ge.on("end",function(){if(T("wrapped end"),Te.decoder&&!Te.ended){var Be=Te.decoder.end();Be&&Be.length&&be.push(Be)}be.push(null)}),ge.on("data",function(Be){if(T("wrapped data"),Te.decoder&&(Be=Te.decoder.write(Be)),!(Te.objectMode&&Be==null)&&!(!Te.objectMode&&(!Be||!Be.length))){var Le=be.push(Be);Le||(De=!0,ge.pause())}});for(var Ie in ge)this[Ie]===void 0&&typeof ge[Ie]=="function"&&(this[Ie]=(function(Be){return function(){return ge[Be].apply(ge,arguments)}})(Ie));for(var Se=0;Se<U.length;Se++)ge.on(U[Se],this.emit.bind(this,U[Se]));return this._read=function(Be){T("wrapped _read",Be),De&&(De=!1,ge.resume())},this},Object.defineProperty(ie.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),ie._fromList=se;function se(ge,be){if(be.length===0)return null;var Te;return be.objectMode?Te=be.buffer.shift():!ge||ge>=be.length?(be.decoder?Te=be.buffer.join(""):be.buffer.length===1?Te=be.buffer.head.data:Te=be.buffer.concat(be.length),be.buffer.clear()):Te=ee(ge,be.buffer,be.decoder),Te}function ee(ge,be,Te){var De;return ge<be.head.data.length?(De=be.head.data.slice(0,ge),be.head.data=be.head.data.slice(ge)):ge===be.head.data.length?De=be.shift():De=Te?Z(ge,be):ue(ge,be),De}function Z(ge,be){var Te=be.head,De=1,Ie=Te.data;for(ge-=Ie.length;Te=Te.next;){var Se=Te.data,Be=ge>Se.length?Se.length:ge;if(Be===Se.length?Ie+=Se:Ie+=Se.slice(0,ge),ge-=Be,ge===0){Be===Se.length?(++De,Te.next?be.head=Te.next:be.head=be.tail=null):(be.head=Te,Te.data=Se.slice(Be));break}++De}return be.length-=De,Ie}function ue(ge,be){var Te=w.allocUnsafe(ge),De=be.head,Ie=1;for(De.data.copy(Te),ge-=De.data.length;De=De.next;){var Se=De.data,Be=ge>Se.length?Se.length:ge;if(Se.copy(Te,Te.length-ge,0,Be),ge-=Be,ge===0){Be===Se.length?(++Ie,De.next?be.head=De.next:be.head=be.tail=null):(be.head=De,De.data=Se.slice(Be));break}++Ie}return be.length-=Ie,Te}function _e(ge){var be=ge._readableState;if(be.length>0)throw new Error('"endReadable()" called on non-empty stream');be.endEmitted||(be.ended=!0,y.nextTick(Re,be,ge))}function Re(ge,be){!ge.endEmitted&&ge.length===0&&(ge.endEmitted=!0,be.readable=!1,be.emit("end"))}function Ae(ge,be){for(var Te=0,De=ge.length;Te<De;Te++)if(ge[Te]===be)return Te;return-1}return _stream_readable$1}var _stream_transform$1,hasRequired_stream_transform$1;function require_stream_transform$1(){if(hasRequired_stream_transform$1)return _stream_transform$1;hasRequired_stream_transform$1=1,_stream_transform$1=v;var y=require_stream_duplex$1(),u=Object.create(requireUtil());u.inherits=requireInherits_browser(),u.inherits(v,y);function g(E,S){var A=this._transformState;A.transforming=!1;var $=A.writecb;if(!$)return this.emit("error",new Error("write callback called multiple times"));A.writechunk=null,A.writecb=null,S!=null&&this.push(S),$(E);var R=this._readableState;R.reading=!1,(R.needReadable||R.length<R.highWaterMark)&&this._read(R.highWaterMark)}function v(E){if(!(this instanceof v))return new v(E);y.call(this,E),this._transformState={afterTransform:g.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,E&&(typeof E.transform=="function"&&(this._transform=E.transform),typeof E.flush=="function"&&(this._flush=E.flush)),this.on("prefinish",b)}function b(){var E=this;typeof this._flush=="function"?this._flush(function(S,A){w(E,S,A)}):w(this,null,null)}v.prototype.push=function(E,S){return this._transformState.needTransform=!1,y.prototype.push.call(this,E,S)},v.prototype._transform=function(E,S,A){throw new Error("_transform() is not implemented")},v.prototype._write=function(E,S,A){var $=this._transformState;if($.writecb=A,$.writechunk=E,$.writeencoding=S,!$.transforming){var R=this._readableState;($.needTransform||R.needReadable||R.length<R.highWaterMark)&&this._read(R.highWaterMark)}},v.prototype._read=function(E){var S=this._transformState;S.writechunk!==null&&S.writecb&&!S.transforming?(S.transforming=!0,this._transform(S.writechunk,S.writeencoding,S.afterTransform)):S.needTransform=!0},v.prototype._destroy=function(E,S){var A=this;y.prototype._destroy.call(this,E,function($){S($),A.emit("close")})};function w(E,S,A){if(S)return E.emit("error",S);if(A!=null&&E.push(A),E._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(E._transformState.transforming)throw new Error("Calling transform done when still transforming");return E.push(null)}return _stream_transform$1}var _stream_passthrough$1,hasRequired_stream_passthrough$1;function require_stream_passthrough$1(){if(hasRequired_stream_passthrough$1)return _stream_passthrough$1;hasRequired_stream_passthrough$1=1,_stream_passthrough$1=g;var y=require_stream_transform$1(),u=Object.create(requireUtil());u.inherits=requireInherits_browser(),u.inherits(g,y);function g(v){if(!(this instanceof g))return new g(v);y.call(this,v)}return g.prototype._transform=function(v,b,w){w(null,v)},_stream_passthrough$1}var hasRequiredReadableBrowser$1;function requireReadableBrowser$1(){return hasRequiredReadableBrowser$1||(hasRequiredReadableBrowser$1=1,(function(y,u){u=y.exports=require_stream_readable$1(),u.Stream=u,u.Readable=u,u.Writable=require_stream_writable$1(),u.Duplex=require_stream_duplex$1(),u.Transform=require_stream_transform$1(),u.PassThrough=require_stream_passthrough$1()})(readableBrowser$1,readableBrowser$1.exports)),readableBrowser$1.exports}var hashBase,hasRequiredHashBase;function requireHashBase(){if(hasRequiredHashBase)return hashBase;hasRequiredHashBase=1;var y=requireSafeBuffer$2().Buffer,u=requireToBuffer$1(),g=requireReadableBrowser$1().Transform,v=requireInherits_browser();function b(w){g.call(this),this._block=y.allocUnsafe(w),this._blockSize=w,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}return v(b,g),b.prototype._transform=function(w,E,S){var A=null;try{this.update(w,E)}catch($){A=$}S(A)},b.prototype._flush=function(w){var E=null;try{this.push(this.digest())}catch(S){E=S}w(E)},b.prototype.update=function(w,E){if(this._finalized)throw new Error("Digest already called");for(var S=u(w,E),A=this._block,$=0;this._blockOffset+S.length-$>=this._blockSize;){for(var R=this._blockOffset;R<this._blockSize;)A[R]=S[$],R+=1,$+=1;this._update(),this._blockOffset=0}for(;$<S.length;)A[this._blockOffset]=S[$],this._blockOffset+=1,$+=1;for(var T=0,O=S.length*8;O>0;++T)this._length[T]+=O,O=this._length[T]/4294967296|0,O>0&&(this._length[T]-=4294967296*O);return this},b.prototype._update=function(){throw new Error("_update is not implemented")},b.prototype.digest=function(w){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var E=this._digest();w!==void 0&&(E=E.toString(w)),this._block.fill(0),this._blockOffset=0;for(var S=0;S<4;++S)this._length[S]=0;return E},b.prototype._digest=function(){throw new Error("_digest is not implemented")},hashBase=b,hashBase}var ripemd160$2,hasRequiredRipemd160$1;function requireRipemd160$1(){if(hasRequiredRipemd160$1)return ripemd160$2;hasRequiredRipemd160$1=1;var y=requireDist().Buffer,u=requireInherits_browser(),g=requireHashBase(),v=new Array(16),b=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],w=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],E=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],S=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],A=[0,1518500249,1859775393,2400959708,2840853838],$=[1352829926,1548603684,1836072691,2053994217,0];function R(J,ie){return J<<ie|J>>>32-ie}function T(J,ie,oe,le,de,fe,ye,we){return R(J+(ie^oe^le)+fe+ye|0,we)+de|0}function O(J,ie,oe,le,de,fe,ye,we){return R(J+(ie&oe|~ie&le)+fe+ye|0,we)+de|0}function B(J,ie,oe,le,de,fe,ye,we){return R(J+((ie|~oe)^le)+fe+ye|0,we)+de|0}function F(J,ie,oe,le,de,fe,ye,we){return R(J+(ie&le|oe&~le)+fe+ye|0,we)+de|0}function U(J,ie,oe,le,de,fe,ye,we){return R(J+(ie^(oe|~le))+fe+ye|0,we)+de|0}function q(){g.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}return u(q,g),q.prototype._update=function(){for(var J=v,ie=0;ie<16;++ie)J[ie]=this._block.readInt32LE(ie*4);for(var oe=this._a|0,le=this._b|0,de=this._c|0,fe=this._d|0,ye=this._e|0,we=this._a|0,pe=this._b|0,ve=this._c|0,he=this._d|0,ae=this._e|0,Q=0;Q<80;Q+=1){var j,z;Q<16?(j=T(oe,le,de,fe,ye,J[b[Q]],A[0],E[Q]),z=U(we,pe,ve,he,ae,J[w[Q]],$[0],S[Q])):Q<32?(j=O(oe,le,de,fe,ye,J[b[Q]],A[1],E[Q]),z=F(we,pe,ve,he,ae,J[w[Q]],$[1],S[Q])):Q<48?(j=B(oe,le,de,fe,ye,J[b[Q]],A[2],E[Q]),z=B(we,pe,ve,he,ae,J[w[Q]],$[2],S[Q])):Q<64?(j=F(oe,le,de,fe,ye,J[b[Q]],A[3],E[Q]),z=O(we,pe,ve,he,ae,J[w[Q]],$[3],S[Q])):(j=U(oe,le,de,fe,ye,J[b[Q]],A[4],E[Q]),z=T(we,pe,ve,he,ae,J[w[Q]],$[4],S[Q])),oe=ye,ye=fe,fe=R(de,10),de=le,le=j,we=ae,ae=he,he=R(ve,10),ve=pe,pe=z}var re=this._b+de+he|0;this._b=this._c+fe+ae|0,this._c=this._d+ye+we|0,this._d=this._e+oe+pe|0,this._e=this._a+le+ve|0,this._a=re},q.prototype._digest=function(){this._block[this._blockOffset]=128,this._blockOffset+=1,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var J=y.alloc?y.alloc(20):new y(20);return J.writeInt32LE(this._a,0),J.writeInt32LE(this._b,4),J.writeInt32LE(this._c,8),J.writeInt32LE(this._d,12),J.writeInt32LE(this._e,16),J},ripemd160$2=q,ripemd160$2}var sha_js={exports:{}},hash$1,hasRequiredHash$1;function requireHash$1(){if(hasRequiredHash$1)return hash$1;hasRequiredHash$1=1;var y=requireSafeBuffer$2().Buffer,u=requireToBuffer$2();function g(v,b){this._block=y.alloc(v),this._finalSize=b,this._blockSize=v,this._len=0}return g.prototype.update=function(v,b){v=u(v,b||"utf8");for(var w=this._block,E=this._blockSize,S=v.length,A=this._len,$=0;$<S;){for(var R=A%E,T=Math.min(S-$,E-R),O=0;O<T;O++)w[R+O]=v[$+O];A+=T,$+=T,A%E===0&&this._update(w)}return this._len+=S,this},g.prototype.digest=function(v){var b=this._len%this._blockSize;this._block[b]=128,this._block.fill(0,b+1),b>=this._finalSize&&(this._update(this._block),this._block.fill(0));var w=this._len*8;if(w<=4294967295)this._block.writeUInt32BE(w,this._blockSize-4);else{var E=(w&4294967295)>>>0,S=(w-E)/4294967296;this._block.writeUInt32BE(S,this._blockSize-8),this._block.writeUInt32BE(E,this._blockSize-4)}this._update(this._block);var A=this._hash();return v?A.toString(v):A},g.prototype._update=function(){throw new Error("_update must be implemented by subclass")},hash$1=g,hash$1}var sha$3,hasRequiredSha$1;function requireSha$1(){if(hasRequiredSha$1)return sha$3;hasRequiredSha$1=1;var y=requireInherits_browser(),u=requireHash$1(),g=requireSafeBuffer$2().Buffer,v=[1518500249,1859775393,-1894007588,-899497514],b=new Array(80);function w(){this.init(),this._w=b,u.call(this,64,56)}y(w,u),w.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function E($){return $<<5|$>>>27}function S($){return $<<30|$>>>2}function A($,R,T,O){return $===0?R&T|~R&O:$===2?R&T|R&O|T&O:R^T^O}return w.prototype._update=function($){for(var R=this._w,T=this._a|0,O=this._b|0,B=this._c|0,F=this._d|0,U=this._e|0,q=0;q<16;++q)R[q]=$.readInt32BE(q*4);for(;q<80;++q)R[q]=R[q-3]^R[q-8]^R[q-14]^R[q-16];for(var J=0;J<80;++J){var ie=~~(J/20),oe=E(T)+A(ie,O,B,F)+U+R[J]+v[ie]|0;U=F,F=B,B=S(O),O=T,T=oe}this._a=T+this._a|0,this._b=O+this._b|0,this._c=B+this._c|0,this._d=F+this._d|0,this._e=U+this._e|0},w.prototype._hash=function(){var $=g.allocUnsafe(20);return $.writeInt32BE(this._a|0,0),$.writeInt32BE(this._b|0,4),$.writeInt32BE(this._c|0,8),$.writeInt32BE(this._d|0,12),$.writeInt32BE(this._e|0,16),$},sha$3=w,sha$3}var sha1$5,hasRequiredSha1$1;function requireSha1$1(){if(hasRequiredSha1$1)return sha1$5;hasRequiredSha1$1=1;var y=requireInherits_browser(),u=requireHash$1(),g=requireSafeBuffer$2().Buffer,v=[1518500249,1859775393,-1894007588,-899497514],b=new Array(80);function w(){this.init(),this._w=b,u.call(this,64,56)}y(w,u),w.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function E(R){return R<<1|R>>>31}function S(R){return R<<5|R>>>27}function A(R){return R<<30|R>>>2}function $(R,T,O,B){return R===0?T&O|~T&B:R===2?T&O|T&B|O&B:T^O^B}return w.prototype._update=function(R){for(var T=this._w,O=this._a|0,B=this._b|0,F=this._c|0,U=this._d|0,q=this._e|0,J=0;J<16;++J)T[J]=R.readInt32BE(J*4);for(;J<80;++J)T[J]=E(T[J-3]^T[J-8]^T[J-14]^T[J-16]);for(var ie=0;ie<80;++ie){var oe=~~(ie/20),le=S(O)+$(oe,B,F,U)+q+T[ie]+v[oe]|0;q=U,U=F,F=A(B),B=O,O=le}this._a=O+this._a|0,this._b=B+this._b|0,this._c=F+this._c|0,this._d=U+this._d|0,this._e=q+this._e|0},w.prototype._hash=function(){var R=g.allocUnsafe(20);return R.writeInt32BE(this._a|0,0),R.writeInt32BE(this._b|0,4),R.writeInt32BE(this._c|0,8),R.writeInt32BE(this._d|0,12),R.writeInt32BE(this._e|0,16),R},sha1$5=w,sha1$5}var sha256$a,hasRequiredSha256$1;function requireSha256$1(){if(hasRequiredSha256$1)return sha256$a;hasRequiredSha256$1=1;var y=requireInherits_browser(),u=requireHash$1(),g=requireSafeBuffer$2().Buffer,v=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],b=new Array(64);function w(){this.init(),this._w=b,u.call(this,64,56)}y(w,u),w.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function E(O,B,F){return F^O&(B^F)}function S(O,B,F){return O&B|F&(O|B)}function A(O){return(O>>>2|O<<30)^(O>>>13|O<<19)^(O>>>22|O<<10)}function $(O){return(O>>>6|O<<26)^(O>>>11|O<<21)^(O>>>25|O<<7)}function R(O){return(O>>>7|O<<25)^(O>>>18|O<<14)^O>>>3}function T(O){return(O>>>17|O<<15)^(O>>>19|O<<13)^O>>>10}return w.prototype._update=function(O){for(var B=this._w,F=this._a|0,U=this._b|0,q=this._c|0,J=this._d|0,ie=this._e|0,oe=this._f|0,le=this._g|0,de=this._h|0,fe=0;fe<16;++fe)B[fe]=O.readInt32BE(fe*4);for(;fe<64;++fe)B[fe]=T(B[fe-2])+B[fe-7]+R(B[fe-15])+B[fe-16]|0;for(var ye=0;ye<64;++ye){var we=de+$(ie)+E(ie,oe,le)+v[ye]+B[ye]|0,pe=A(F)+S(F,U,q)|0;de=le,le=oe,oe=ie,ie=J+we|0,J=q,q=U,U=F,F=we+pe|0}this._a=F+this._a|0,this._b=U+this._b|0,this._c=q+this._c|0,this._d=J+this._d|0,this._e=ie+this._e|0,this._f=oe+this._f|0,this._g=le+this._g|0,this._h=de+this._h|0},w.prototype._hash=function(){var O=g.allocUnsafe(32);return O.writeInt32BE(this._a,0),O.writeInt32BE(this._b,4),O.writeInt32BE(this._c,8),O.writeInt32BE(this._d,12),O.writeInt32BE(this._e,16),O.writeInt32BE(this._f,20),O.writeInt32BE(this._g,24),O.writeInt32BE(this._h,28),O},sha256$a=w,sha256$a}var sha224$3,hasRequiredSha224$1;function requireSha224$1(){if(hasRequiredSha224$1)return sha224$3;hasRequiredSha224$1=1;var y=requireInherits_browser(),u=requireSha256$1(),g=requireHash$1(),v=requireSafeBuffer$2().Buffer,b=new Array(64);function w(){this.init(),this._w=b,g.call(this,64,56)}return y(w,u),w.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},w.prototype._hash=function(){var E=v.allocUnsafe(28);return E.writeInt32BE(this._a,0),E.writeInt32BE(this._b,4),E.writeInt32BE(this._c,8),E.writeInt32BE(this._d,12),E.writeInt32BE(this._e,16),E.writeInt32BE(this._f,20),E.writeInt32BE(this._g,24),E},sha224$3=w,sha224$3}var sha512$8,hasRequiredSha512$1;function requireSha512$1(){if(hasRequiredSha512$1)return sha512$8;hasRequiredSha512$1=1;var y=requireInherits_browser(),u=requireHash$1(),g=requireSafeBuffer$2().Buffer,v=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],b=new Array(160);function w(){this.init(),this._w=b,u.call(this,128,112)}y(w,u),w.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function E(U,q,J){return J^U&(q^J)}function S(U,q,J){return U&q|J&(U|q)}function A(U,q){return(U>>>28|q<<4)^(q>>>2|U<<30)^(q>>>7|U<<25)}function $(U,q){return(U>>>14|q<<18)^(U>>>18|q<<14)^(q>>>9|U<<23)}function R(U,q){return(U>>>1|q<<31)^(U>>>8|q<<24)^U>>>7}function T(U,q){return(U>>>1|q<<31)^(U>>>8|q<<24)^(U>>>7|q<<25)}function O(U,q){return(U>>>19|q<<13)^(q>>>29|U<<3)^U>>>6}function B(U,q){return(U>>>19|q<<13)^(q>>>29|U<<3)^(U>>>6|q<<26)}function F(U,q){return U>>>0<q>>>0?1:0}return w.prototype._update=function(U){for(var q=this._w,J=this._ah|0,ie=this._bh|0,oe=this._ch|0,le=this._dh|0,de=this._eh|0,fe=this._fh|0,ye=this._gh|0,we=this._hh|0,pe=this._al|0,ve=this._bl|0,he=this._cl|0,ae=this._dl|0,Q=this._el|0,j=this._fl|0,z=this._gl|0,re=this._hl|0,Y=0;Y<32;Y+=2)q[Y]=U.readInt32BE(Y*4),q[Y+1]=U.readInt32BE(Y*4+4);for(;Y<160;Y+=2){var te=q[Y-30],ne=q[Y-30+1],se=R(te,ne),ee=T(ne,te);te=q[Y-4],ne=q[Y-4+1];var Z=O(te,ne),ue=B(ne,te),_e=q[Y-14],Re=q[Y-14+1],Ae=q[Y-32],ge=q[Y-32+1],be=ee+Re|0,Te=se+_e+F(be,ee)|0;be=be+ue|0,Te=Te+Z+F(be,ue)|0,be=be+ge|0,Te=Te+Ae+F(be,ge)|0,q[Y]=Te,q[Y+1]=be}for(var De=0;De<160;De+=2){Te=q[De],be=q[De+1];var Ie=S(J,ie,oe),Se=S(pe,ve,he),Be=A(J,pe),Le=A(pe,J),qe=$(de,Q),Ke=$(Q,de),Ge=v[De],Xe=v[De+1],ze=E(de,fe,ye),et=E(Q,j,z),Ze=re+Ke|0,nt=we+qe+F(Ze,re)|0;Ze=Ze+et|0,nt=nt+ze+F(Ze,et)|0,Ze=Ze+Xe|0,nt=nt+Ge+F(Ze,Xe)|0,Ze=Ze+be|0,nt=nt+Te+F(Ze,be)|0;var ut=Le+Se|0,ot=Be+Ie+F(ut,Le)|0;we=ye,re=z,ye=fe,z=j,fe=de,j=Q,Q=ae+Ze|0,de=le+nt+F(Q,ae)|0,le=oe,ae=he,oe=ie,he=ve,ie=J,ve=pe,pe=Ze+ut|0,J=nt+ot+F(pe,Ze)|0}this._al=this._al+pe|0,this._bl=this._bl+ve|0,this._cl=this._cl+he|0,this._dl=this._dl+ae|0,this._el=this._el+Q|0,this._fl=this._fl+j|0,this._gl=this._gl+z|0,this._hl=this._hl+re|0,this._ah=this._ah+J+F(this._al,pe)|0,this._bh=this._bh+ie+F(this._bl,ve)|0,this._ch=this._ch+oe+F(this._cl,he)|0,this._dh=this._dh+le+F(this._dl,ae)|0,this._eh=this._eh+de+F(this._el,Q)|0,this._fh=this._fh+fe+F(this._fl,j)|0,this._gh=this._gh+ye+F(this._gl,z)|0,this._hh=this._hh+we+F(this._hl,re)|0},w.prototype._hash=function(){var U=g.allocUnsafe(64);function q(J,ie,oe){U.writeInt32BE(J,oe),U.writeInt32BE(ie,oe+4)}return q(this._ah,this._al,0),q(this._bh,this._bl,8),q(this._ch,this._cl,16),q(this._dh,this._dl,24),q(this._eh,this._el,32),q(this._fh,this._fl,40),q(this._gh,this._gl,48),q(this._hh,this._hl,56),U},sha512$8=w,sha512$8}var sha384$3,hasRequiredSha384$1;function requireSha384$1(){if(hasRequiredSha384$1)return sha384$3;hasRequiredSha384$1=1;var y=requireInherits_browser(),u=requireSha512$1(),g=requireHash$1(),v=requireSafeBuffer$2().Buffer,b=new Array(160);function w(){this.init(),this._w=b,g.call(this,128,112)}return y(w,u),w.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},w.prototype._hash=function(){var E=v.allocUnsafe(48);function S(A,$,R){E.writeInt32BE(A,R),E.writeInt32BE($,R+4)}return S(this._ah,this._al,0),S(this._bh,this._bl,8),S(this._ch,this._cl,16),S(this._dh,this._dl,24),S(this._eh,this._el,32),S(this._fh,this._fl,40),E},sha384$3=w,sha384$3}var hasRequiredSha_js;function requireSha_js(){return hasRequiredSha_js||(hasRequiredSha_js=1,(function(y){y.exports=function(g){var v=g.toLowerCase(),b=y.exports[v];if(!b)throw new Error(v+" is not supported (we accept pull requests)");return new b},y.exports.sha=requireSha$1(),y.exports.sha1=requireSha1$1(),y.exports.sha224=requireSha224$1(),y.exports.sha256=requireSha256$1(),y.exports.sha384=requireSha384$1(),y.exports.sha512=requireSha512$1()})(sha_js)),sha_js.exports}var cipherBase,hasRequiredCipherBase;function requireCipherBase(){if(hasRequiredCipherBase)return cipherBase;hasRequiredCipherBase=1;var y=requireSafeBuffer$2().Buffer,u=requireStreamBrowserify().Transform,g=requireString_decoder().StringDecoder,v=requireInherits_browser(),b=requireToBuffer$2();function w(E){u.call(this),this.hashMode=typeof E=="string",this.hashMode?this[E]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}return v(w,u),w.prototype.update=function(E,S,A){var $=b(E,S),R=this._update($);return this.hashMode?this:(A&&(R=this._toString(R,A)),R)},w.prototype.setAutoPadding=function(){},w.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},w.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},w.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},w.prototype._transform=function(E,S,A){var $;try{this.hashMode?this._update(E):this.push(this._update(E))}catch(R){$=R}finally{A($)}},w.prototype._flush=function(E){var S;try{this.push(this.__final())}catch(A){S=A}E(S)},w.prototype._finalOrDigest=function(E){var S=this.__final()||y.alloc(0);return E&&(S=this._toString(S,E,!0)),S},w.prototype._toString=function(E,S,A){if(this._decoder||(this._decoder=new g(S),this._encoding=S),this._encoding!==S)throw new Error("cant switch encodings");var $=this._decoder.write(E);return A&&($+=this._decoder.end()),$},cipherBase=w,cipherBase}var browser$c,hasRequiredBrowser$b;function requireBrowser$b(){if(hasRequiredBrowser$b)return browser$c;hasRequiredBrowser$b=1;var y=requireInherits_browser(),u=requireMd5_js(),g=requireRipemd160$1(),v=requireSha_js(),b=requireCipherBase();function w(E){b.call(this,"digest"),this._hash=E}return y(w,b),w.prototype._update=function(E){this._hash.update(E)},w.prototype._final=function(){return this._hash.digest()},browser$c=function(S){return S=S.toLowerCase(),S==="md5"?new u:S==="rmd160"||S==="ripemd160"?new g:new w(v(S))},browser$c}var legacy,hasRequiredLegacy;function requireLegacy(){if(hasRequiredLegacy)return legacy;hasRequiredLegacy=1;var y=requireInherits_browser(),u=requireSafeBuffer$2().Buffer,g=requireCipherBase(),v=u.alloc(128),b=64;function w(E,S){g.call(this,"digest"),typeof S=="string"&&(S=u.from(S)),this._alg=E,this._key=S,S.length>b?S=E(S):S.length<b&&(S=u.concat([S,v],b));for(var A=this._ipad=u.allocUnsafe(b),$=this._opad=u.allocUnsafe(b),R=0;R<b;R++)A[R]=S[R]^54,$[R]=S[R]^92;this._hash=[A]}return y(w,g),w.prototype._update=function(E){this._hash.push(E)},w.prototype._final=function(){var E=this._alg(u.concat(this._hash));return this._alg(u.concat([this._opad,E]))},legacy=w,legacy}var md5$2,hasRequiredMd5$1;function requireMd5$1(){if(hasRequiredMd5$1)return md5$2;hasRequiredMd5$1=1;var y=requireMd5_js();return md5$2=function(u){return new y().update(u).digest()},md5$2}var browser$b,hasRequiredBrowser$a;function requireBrowser$a(){if(hasRequiredBrowser$a)return browser$b;hasRequiredBrowser$a=1;var y=requireInherits_browser(),u=requireLegacy(),g=requireCipherBase(),v=requireSafeBuffer$2().Buffer,b=requireMd5$1(),w=requireRipemd160$1(),E=requireSha_js(),S=v.alloc(128);function A($,R){g.call(this,"digest"),typeof R=="string"&&(R=v.from(R));var T=$==="sha512"||$==="sha384"?128:64;if(this._alg=$,this._key=R,R.length>T){var O=$==="rmd160"?new w:E($);R=O.update(R).digest()}else R.length<T&&(R=v.concat([R,S],T));for(var B=this._ipad=v.allocUnsafe(T),F=this._opad=v.allocUnsafe(T),U=0;U<T;U++)B[U]=R[U]^54,F[U]=R[U]^92;this._hash=$==="rmd160"?new w:E($),this._hash.update(B)}return y(A,g),A.prototype._update=function($){this._hash.update($)},A.prototype._final=function(){var $=this._hash.digest(),R=this._alg==="rmd160"?new w:E(this._alg);return R.update(this._opad).update($).digest()},browser$b=function(R,T){return R=R.toLowerCase(),R==="rmd160"||R==="ripemd160"?new A("rmd160",T):R==="md5"?new u(b,T):new A(R,T)},browser$b}const sha224WithRSAEncryption={sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption={sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption={sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption={sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},sha256$9={sign:"ecdsa",hash:"sha256",id:""},sha224$2={sign:"ecdsa",hash:"sha224",id:""},sha384$2={sign:"ecdsa",hash:"sha384",id:""},sha512$7={sign:"ecdsa",hash:"sha512",id:""},DSA={sign:"dsa",hash:"sha1",id:""},ripemd160WithRSA={sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption={sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},require$$6={sha224WithRSAEncryption,"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption,"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption,"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption,"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:sha256$9,sha224:sha224$2,sha384:sha384$2,sha512:sha512$7,"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA,"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA,"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption,"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}};var algos,hasRequiredAlgos;function requireAlgos(){return hasRequiredAlgos||(hasRequiredAlgos=1,algos=require$$6),algos}var browser$a={},precondition,hasRequiredPrecondition;function requirePrecondition(){if(hasRequiredPrecondition)return precondition;hasRequiredPrecondition=1;var y=isFinite,u=Math.pow(2,30)-1;return precondition=function(g,v){if(typeof g!="number")throw new TypeError("Iterations not a number");if(g<0||!y(g))throw new TypeError("Bad iterations");if(typeof v!="number")throw new TypeError("Key length not a number");if(v<0||v>u||v!==v)throw new TypeError("Bad key length")},precondition}var defaultEncoding_1,hasRequiredDefaultEncoding;function requireDefaultEncoding(){if(hasRequiredDefaultEncoding)return defaultEncoding_1;hasRequiredDefaultEncoding=1;var y;if(commonjsGlobal.process&&commonjsGlobal.process.browser)y="utf-8";else if(commonjsGlobal.process&&commonjsGlobal.process.version){var u=parseInt(process$1.version.split(".")[0].slice(1),10);y=u>=6?"utf-8":"binary"}else y="utf-8";return defaultEncoding_1=y,defaultEncoding_1}var toBuffer_1,hasRequiredToBuffer;function requireToBuffer(){if(hasRequiredToBuffer)return toBuffer_1;hasRequiredToBuffer=1;var y=requireSafeBuffer$2().Buffer,u=requireToBuffer$2(),g=typeof Uint8Array<"u",v=g&&typeof ArrayBuffer<"u",b=v&&ArrayBuffer.isView;return toBuffer_1=function(w,E,S){if(typeof w=="string"||y.isBuffer(w)||g&&w instanceof Uint8Array||b&&b(w))return u(w,E);throw new TypeError(S+" must be a string, a Buffer, a Uint8Array, or a DataView")},toBuffer_1}var syncBrowser,hasRequiredSyncBrowser;function requireSyncBrowser(){if(hasRequiredSyncBrowser)return syncBrowser;hasRequiredSyncBrowser=1;var y=requireMd5$1(),u=requireRipemd160$1(),g=requireSha_js(),v=requireSafeBuffer$2().Buffer,b=requirePrecondition(),w=requireDefaultEncoding(),E=requireToBuffer(),S=v.alloc(128),A={__proto__:null,md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,"sha512-256":32,ripemd160:20,rmd160:20},$={__proto__:null,"sha-1":"sha1","sha-224":"sha224","sha-256":"sha256","sha-384":"sha384","sha-512":"sha512","ripemd-160":"ripemd160"};function R(F){return new u().update(F).digest()}function T(F){function U(q){return g(F).update(q).digest()}return F==="rmd160"||F==="ripemd160"?R:F==="md5"?y:U}function O(F,U,q){var J=T(F),ie=F==="sha512"||F==="sha384"?128:64;U.length>ie?U=J(U):U.length<ie&&(U=v.concat([U,S],ie));for(var oe=v.allocUnsafe(ie+A[F]),le=v.allocUnsafe(ie+A[F]),de=0;de<ie;de++)oe[de]=U[de]^54,le[de]=U[de]^92;var fe=v.allocUnsafe(ie+q+4);oe.copy(fe,0,0,ie),this.ipad1=fe,this.ipad2=oe,this.opad=le,this.alg=F,this.blocksize=ie,this.hash=J,this.size=A[F]}O.prototype.run=function(F,U){F.copy(U,this.blocksize);var q=this.hash(U);return q.copy(this.opad,this.blocksize),this.hash(this.opad)};function B(F,U,q,J,ie){b(q,J),F=E(F,w,"Password"),U=E(U,w,"Salt");var oe=(ie||"sha1").toLowerCase(),le=$[oe]||oe,de=A[le];if(typeof de!="number"||!de)throw new TypeError("Digest algorithm not supported: "+ie);var fe=new O(le,F,U.length),ye=v.allocUnsafe(J),we=v.allocUnsafe(U.length+4);U.copy(we,0,0,U.length);for(var pe=0,ve=de,he=Math.ceil(J/ve),ae=1;ae<=he;ae++){we.writeUInt32BE(ae,U.length);for(var Q=fe.run(we,fe.ipad1),j=Q,z=1;z<q;z++){j=fe.run(j,fe.ipad2);for(var re=0;re<ve;re++)Q[re]^=j[re]}Q.copy(ye,pe),pe+=ve}return ye}return syncBrowser=B,syncBrowser}var async,hasRequiredAsync;function requireAsync(){if(hasRequiredAsync)return async;hasRequiredAsync=1;var y=requireSafeBuffer$2().Buffer,u=requirePrecondition(),g=requireDefaultEncoding(),v=requireSyncBrowser(),b=requireToBuffer(),w,E=commonjsGlobal.crypto&&commonjsGlobal.crypto.subtle,S={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},A=[],$;function R(){return $||(commonjsGlobal.process&&commonjsGlobal.process.nextTick?$=commonjsGlobal.process.nextTick:commonjsGlobal.queueMicrotask?$=commonjsGlobal.queueMicrotask:commonjsGlobal.setImmediate?$=commonjsGlobal.setImmediate:$=commonjsGlobal.setTimeout,$)}function T(F,U,q,J,ie){return E.importKey("raw",F,{name:"PBKDF2"},!1,["deriveBits"]).then(function(oe){return E.deriveBits({name:"PBKDF2",salt:U,iterations:q,hash:{name:ie}},oe,J<<3)}).then(function(oe){return y.from(oe)})}function O(F){if(commonjsGlobal.process&&!commonjsGlobal.process.browser||!E||!E.importKey||!E.deriveBits)return Promise.resolve(!1);if(A[F]!==void 0)return A[F];w=w||y.alloc(8);var U=T(w,w,10,128,F).then(function(){return!0},function(){return!1});return A[F]=U,U}function B(F,U){F.then(function(q){R()(function(){U(null,q)})},function(q){R()(function(){U(q)})})}return async=function(F,U,q,J,ie,oe){if(typeof ie=="function"&&(oe=ie,ie=void 0),u(q,J),F=b(F,g,"Password"),U=b(U,g,"Salt"),typeof oe!="function")throw new Error("No callback provided to pbkdf2");ie=ie||"sha1";var le=S[ie.toLowerCase()];if(!le||typeof commonjsGlobal.Promise!="function"){R()(function(){var de;try{de=v(F,U,q,J,ie)}catch(fe){oe(fe);return}oe(null,de)});return}B(O(le).then(function(de){return de?T(F,U,q,J,le):v(F,U,q,J,ie)}),oe)},async}var hasRequiredBrowser$9;function requireBrowser$9(){return hasRequiredBrowser$9||(hasRequiredBrowser$9=1,browser$a.pbkdf2=requireAsync(),browser$a.pbkdf2Sync=requireSyncBrowser()),browser$a}var browser$9={},des$1={},utils$4={},hasRequiredUtils$3;function requireUtils$3(){if(hasRequiredUtils$3)return utils$4;hasRequiredUtils$3=1,utils$4.readUInt32BE=function(b,w){var E=b[0+w]<<24|b[1+w]<<16|b[2+w]<<8|b[3+w];return E>>>0},utils$4.writeUInt32BE=function(b,w,E){b[0+E]=w>>>24,b[1+E]=w>>>16&255,b[2+E]=w>>>8&255,b[3+E]=w&255},utils$4.ip=function(b,w,E,S){for(var A=0,$=0,R=6;R>=0;R-=2){for(var T=0;T<=24;T+=8)A<<=1,A|=w>>>T+R&1;for(var T=0;T<=24;T+=8)A<<=1,A|=b>>>T+R&1}for(var R=6;R>=0;R-=2){for(var T=1;T<=25;T+=8)$<<=1,$|=w>>>T+R&1;for(var T=1;T<=25;T+=8)$<<=1,$|=b>>>T+R&1}E[S+0]=A>>>0,E[S+1]=$>>>0},utils$4.rip=function(b,w,E,S){for(var A=0,$=0,R=0;R<4;R++)for(var T=24;T>=0;T-=8)A<<=1,A|=w>>>T+R&1,A<<=1,A|=b>>>T+R&1;for(var R=4;R<8;R++)for(var T=24;T>=0;T-=8)$<<=1,$|=w>>>T+R&1,$<<=1,$|=b>>>T+R&1;E[S+0]=A>>>0,E[S+1]=$>>>0},utils$4.pc1=function(b,w,E,S){for(var A=0,$=0,R=7;R>=5;R--){for(var T=0;T<=24;T+=8)A<<=1,A|=w>>T+R&1;for(var T=0;T<=24;T+=8)A<<=1,A|=b>>T+R&1}for(var T=0;T<=24;T+=8)A<<=1,A|=w>>T+R&1;for(var R=1;R<=3;R++){for(var T=0;T<=24;T+=8)$<<=1,$|=w>>T+R&1;for(var T=0;T<=24;T+=8)$<<=1,$|=b>>T+R&1}for(var T=0;T<=24;T+=8)$<<=1,$|=b>>T+R&1;E[S+0]=A>>>0,E[S+1]=$>>>0},utils$4.r28shl=function(b,w){return b<<w&268435455|b>>>28-w};var y=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];utils$4.pc2=function(b,w,E,S){for(var A=0,$=0,R=y.length>>>1,T=0;T<R;T++)A<<=1,A|=b>>>y[T]&1;for(var T=R;T<y.length;T++)$<<=1,$|=w>>>y[T]&1;E[S+0]=A>>>0,E[S+1]=$>>>0},utils$4.expand=function(b,w,E){var S=0,A=0;S=(b&1)<<5|b>>>27;for(var $=23;$>=15;$-=4)S<<=6,S|=b>>>$&63;for(var $=11;$>=3;$-=4)A|=b>>>$&63,A<<=6;A|=(b&31)<<1|b>>>31,w[E+0]=S>>>0,w[E+1]=A>>>0};var u=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];utils$4.substitute=function(b,w){for(var E=0,S=0;S<4;S++){var A=b>>>18-S*6&63,$=u[S*64+A];E<<=4,E|=$}for(var S=0;S<4;S++){var A=w>>>18-S*6&63,$=u[256+S*64+A];E<<=4,E|=$}return E>>>0};var g=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];return utils$4.permute=function(b){for(var w=0,E=0;E<g.length;E++)w<<=1,w|=b>>>g[E]&1;return w>>>0},utils$4.padSplit=function(b,w,E){for(var S=b.toString(2);S.length<w;)S="0"+S;for(var A=[],$=0;$<w;$+=E)A.push(S.slice($,$+E));return A.join(" ")},utils$4}var minimalisticAssert,hasRequiredMinimalisticAssert;function requireMinimalisticAssert(){if(hasRequiredMinimalisticAssert)return minimalisticAssert;hasRequiredMinimalisticAssert=1,minimalisticAssert=y;function y(u,g){if(!u)throw new Error(g||"Assertion failed")}return y.equal=function(g,v,b){if(g!=v)throw new Error(b||"Assertion failed: "+g+" != "+v)},minimalisticAssert}var cipher,hasRequiredCipher;function requireCipher(){if(hasRequiredCipher)return cipher;hasRequiredCipher=1;var y=requireMinimalisticAssert();function u(g){this.options=g,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0,this.padding=g.padding!==!1}return cipher=u,u.prototype._init=function(){},u.prototype.update=function(v){return v.length===0?[]:this.type==="decrypt"?this._updateDecrypt(v):this._updateEncrypt(v)},u.prototype._buffer=function(v,b){for(var w=Math.min(this.buffer.length-this.bufferOff,v.length-b),E=0;E<w;E++)this.buffer[this.bufferOff+E]=v[b+E];return this.bufferOff+=w,w},u.prototype._flushBuffer=function(v,b){return this._update(this.buffer,0,v,b),this.bufferOff=0,this.blockSize},u.prototype._updateEncrypt=function(v){var b=0,w=0,E=(this.bufferOff+v.length)/this.blockSize|0,S=new Array(E*this.blockSize);this.bufferOff!==0&&(b+=this._buffer(v,b),this.bufferOff===this.buffer.length&&(w+=this._flushBuffer(S,w)));for(var A=v.length-(v.length-b)%this.blockSize;b<A;b+=this.blockSize)this._update(v,b,S,w),w+=this.blockSize;for(;b<v.length;b++,this.bufferOff++)this.buffer[this.bufferOff]=v[b];return S},u.prototype._updateDecrypt=function(v){for(var b=0,w=0,E=Math.ceil((this.bufferOff+v.length)/this.blockSize)-1,S=new Array(E*this.blockSize);E>0;E--)b+=this._buffer(v,b),w+=this._flushBuffer(S,w);return b+=this._buffer(v,b),S},u.prototype.final=function(v){var b;v&&(b=this.update(v));var w;return this.type==="encrypt"?w=this._finalEncrypt():w=this._finalDecrypt(),b?b.concat(w):w},u.prototype._pad=function(v,b){if(b===0)return!1;for(;b<v.length;)v[b++]=0;return!0},u.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var v=new Array(this.blockSize);return this._update(this.buffer,0,v,0),v},u.prototype._unpad=function(v){return v},u.prototype._finalDecrypt=function(){y.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var v=new Array(this.blockSize);return this._flushBuffer(v,0),this._unpad(v)},cipher}var des,hasRequiredDes$1;function requireDes$1(){if(hasRequiredDes$1)return des;hasRequiredDes$1=1;var y=requireMinimalisticAssert(),u=requireInherits_browser(),g=requireUtils$3(),v=requireCipher();function b(){this.tmp=new Array(2),this.keys=null}function w(S){v.call(this,S);var A=new b;this._desState=A,this.deriveKeys(A,S.key)}u(w,v),des=w,w.create=function(A){return new w(A)};var E=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];return w.prototype.deriveKeys=function(A,$){A.keys=new Array(32),y.equal($.length,this.blockSize,"Invalid key length");var R=g.readUInt32BE($,0),T=g.readUInt32BE($,4);g.pc1(R,T,A.tmp,0),R=A.tmp[0],T=A.tmp[1];for(var O=0;O<A.keys.length;O+=2){var B=E[O>>>1];R=g.r28shl(R,B),T=g.r28shl(T,B),g.pc2(R,T,A.keys,O)}},w.prototype._update=function(A,$,R,T){var O=this._desState,B=g.readUInt32BE(A,$),F=g.readUInt32BE(A,$+4);g.ip(B,F,O.tmp,0),B=O.tmp[0],F=O.tmp[1],this.type==="encrypt"?this._encrypt(O,B,F,O.tmp,0):this._decrypt(O,B,F,O.tmp,0),B=O.tmp[0],F=O.tmp[1],g.writeUInt32BE(R,B,T),g.writeUInt32BE(R,F,T+4)},w.prototype._pad=function(A,$){if(this.padding===!1)return!1;for(var R=A.length-$,T=$;T<A.length;T++)A[T]=R;return!0},w.prototype._unpad=function(A){if(this.padding===!1)return A;for(var $=A[A.length-1],R=A.length-$;R<A.length;R++)y.equal(A[R],$);return A.slice(0,A.length-$)},w.prototype._encrypt=function(A,$,R,T,O){for(var B=$,F=R,U=0;U<A.keys.length;U+=2){var q=A.keys[U],J=A.keys[U+1];g.expand(F,A.tmp,0),q^=A.tmp[0],J^=A.tmp[1];var ie=g.substitute(q,J),oe=g.permute(ie),le=F;F=(B^oe)>>>0,B=le}g.rip(F,B,T,O)},w.prototype._decrypt=function(A,$,R,T,O){for(var B=R,F=$,U=A.keys.length-2;U>=0;U-=2){var q=A.keys[U],J=A.keys[U+1];g.expand(B,A.tmp,0),q^=A.tmp[0],J^=A.tmp[1];var ie=g.substitute(q,J),oe=g.permute(ie),le=B;B=(F^oe)>>>0,F=le}g.rip(B,F,T,O)},des}var cbc$1={},hasRequiredCbc$1;function requireCbc$1(){if(hasRequiredCbc$1)return cbc$1;hasRequiredCbc$1=1;var y=requireMinimalisticAssert(),u=requireInherits_browser(),g={};function v(w){y.equal(w.length,8,"Invalid IV length"),this.iv=new Array(8);for(var E=0;E<this.iv.length;E++)this.iv[E]=w[E]}function b(w){function E(R){w.call(this,R),this._cbcInit()}u(E,w);for(var S=Object.keys(g),A=0;A<S.length;A++){var $=S[A];E.prototype[$]=g[$]}return E.create=function(T){return new E(T)},E}return cbc$1.instantiate=b,g._cbcInit=function(){var E=new v(this.options.iv);this._cbcState=E},g._update=function(E,S,A,$){var R=this._cbcState,T=this.constructor.super_.prototype,O=R.iv;if(this.type==="encrypt"){for(var B=0;B<this.blockSize;B++)O[B]^=E[S+B];T._update.call(this,O,0,A,$);for(var B=0;B<this.blockSize;B++)O[B]=A[$+B]}else{T._update.call(this,E,S,A,$);for(var B=0;B<this.blockSize;B++)A[$+B]^=O[B];for(var B=0;B<this.blockSize;B++)O[B]=E[S+B]}},cbc$1}var ede,hasRequiredEde;function requireEde(){if(hasRequiredEde)return ede;hasRequiredEde=1;var y=requireMinimalisticAssert(),u=requireInherits_browser(),g=requireCipher(),v=requireDes$1();function b(E,S){y.equal(S.length,24,"Invalid key length");var A=S.slice(0,8),$=S.slice(8,16),R=S.slice(16,24);E==="encrypt"?this.ciphers=[v.create({type:"encrypt",key:A}),v.create({type:"decrypt",key:$}),v.create({type:"encrypt",key:R})]:this.ciphers=[v.create({type:"decrypt",key:R}),v.create({type:"encrypt",key:$}),v.create({type:"decrypt",key:A})]}function w(E){g.call(this,E);var S=new b(this.type,this.options.key);this._edeState=S}return u(w,g),ede=w,w.create=function(S){return new w(S)},w.prototype._update=function(S,A,$,R){var T=this._edeState;T.ciphers[0]._update(S,A,$,R),T.ciphers[1]._update($,R,$,R),T.ciphers[2]._update($,R,$,R)},w.prototype._pad=v.prototype._pad,w.prototype._unpad=v.prototype._unpad,ede}var hasRequiredDes;function requireDes(){return hasRequiredDes||(hasRequiredDes=1,des$1.utils=requireUtils$3(),des$1.Cipher=requireCipher(),des$1.DES=requireDes$1(),des$1.CBC=requireCbc$1(),des$1.EDE=requireEde()),des$1}var browserifyDes,hasRequiredBrowserifyDes;function requireBrowserifyDes(){if(hasRequiredBrowserifyDes)return browserifyDes;hasRequiredBrowserifyDes=1;var y=requireCipherBase(),u=requireDes(),g=requireInherits_browser(),v=requireSafeBuffer$2().Buffer,b={"des-ede3-cbc":u.CBC.instantiate(u.EDE),"des-ede3":u.EDE,"des-ede-cbc":u.CBC.instantiate(u.EDE),"des-ede":u.EDE,"des-cbc":u.CBC.instantiate(u.DES),"des-ecb":u.DES};b.des=b["des-cbc"],b.des3=b["des-ede3-cbc"],browserifyDes=w,g(w,y);function w(E){y.call(this);var S=E.mode.toLowerCase(),A=b[S],$;E.decrypt?$="decrypt":$="encrypt";var R=E.key;v.isBuffer(R)||(R=v.from(R)),(S==="des-ede"||S==="des-ede-cbc")&&(R=v.concat([R,R.slice(0,8)]));var T=E.iv;v.isBuffer(T)||(T=v.from(T)),this._des=A.create({key:R,iv:T,type:$})}return w.prototype._update=function(E){return v.from(this._des.update(E))},w.prototype._final=function(){return v.from(this._des.final())},browserifyDes}var browser$8={},encrypter={},ecb={},hasRequiredEcb;function requireEcb(){return hasRequiredEcb||(hasRequiredEcb=1,ecb.encrypt=function(y,u){return y._cipher.encryptBlock(u)},ecb.decrypt=function(y,u){return y._cipher.decryptBlock(u)}),ecb}var cbc={},bufferXor,hasRequiredBufferXor;function requireBufferXor(){return hasRequiredBufferXor||(hasRequiredBufferXor=1,bufferXor=function(u,g){for(var v=Math.min(u.length,g.length),b=new Buffer(v),w=0;w<v;++w)b[w]=u[w]^g[w];return b}),bufferXor}var hasRequiredCbc;function requireCbc(){if(hasRequiredCbc)return cbc;hasRequiredCbc=1;var y=requireBufferXor();return cbc.encrypt=function(u,g){var v=y(g,u._prev);return u._prev=u._cipher.encryptBlock(v),u._prev},cbc.decrypt=function(u,g){var v=u._prev;u._prev=g;var b=u._cipher.decryptBlock(g);return y(b,v)},cbc}var cfb={},hasRequiredCfb;function requireCfb(){if(hasRequiredCfb)return cfb;hasRequiredCfb=1;var y=requireSafeBuffer$2().Buffer,u=requireBufferXor();function g(v,b,w){var E=b.length,S=u(b,v._cache);return v._cache=v._cache.slice(E),v._prev=y.concat([v._prev,w?b:S]),S}return cfb.encrypt=function(v,b,w){for(var E=y.allocUnsafe(0),S;b.length;)if(v._cache.length===0&&(v._cache=v._cipher.encryptBlock(v._prev),v._prev=y.allocUnsafe(0)),v._cache.length<=b.length)S=v._cache.length,E=y.concat([E,g(v,b.slice(0,S),w)]),b=b.slice(S);else{E=y.concat([E,g(v,b,w)]);break}return E},cfb}var cfb8={},hasRequiredCfb8;function requireCfb8(){if(hasRequiredCfb8)return cfb8;hasRequiredCfb8=1;var y=requireSafeBuffer$2().Buffer;function u(g,v,b){var w=g._cipher.encryptBlock(g._prev),E=w[0]^v;return g._prev=y.concat([g._prev.slice(1),y.from([b?v:E])]),E}return cfb8.encrypt=function(g,v,b){for(var w=v.length,E=y.allocUnsafe(w),S=-1;++S<w;)E[S]=u(g,v[S],b);return E},cfb8}var cfb1={},hasRequiredCfb1;function requireCfb1(){if(hasRequiredCfb1)return cfb1;hasRequiredCfb1=1;var y=requireSafeBuffer$2().Buffer;function u(v,b,w){for(var E,S=-1,A=8,$=0,R,T;++S<A;)E=v._cipher.encryptBlock(v._prev),R=b&1<<7-S?128:0,T=E[0]^R,$+=(T&128)>>S%8,v._prev=g(v._prev,w?R:T);return $}function g(v,b){var w=v.length,E=-1,S=y.allocUnsafe(v.length);for(v=y.concat([v,y.from([b])]);++E<w;)S[E]=v[E]<<1|v[E+1]>>7;return S}return cfb1.encrypt=function(v,b,w){for(var E=b.length,S=y.allocUnsafe(E),A=-1;++A<E;)S[A]=u(v,b[A],w);return S},cfb1}var ofb={},hasRequiredOfb;function requireOfb(){if(hasRequiredOfb)return ofb;hasRequiredOfb=1;var y=requireBufferXor();function u(g){return g._prev=g._cipher.encryptBlock(g._prev),g._prev}return ofb.encrypt=function(g,v){for(;g._cache.length<v.length;)g._cache=Buffer.concat([g._cache,u(g)]);var b=g._cache.slice(0,v.length);return g._cache=g._cache.slice(v.length),y(v,b)},ofb}var ctr={},incr32_1,hasRequiredIncr32;function requireIncr32(){if(hasRequiredIncr32)return incr32_1;hasRequiredIncr32=1;function y(u){for(var g=u.length,v;g--;)if(v=u.readUInt8(g),v===255)u.writeUInt8(0,g);else{v++,u.writeUInt8(v,g);break}}return incr32_1=y,incr32_1}var hasRequiredCtr;function requireCtr(){if(hasRequiredCtr)return ctr;hasRequiredCtr=1;var y=requireBufferXor(),u=requireSafeBuffer$2().Buffer,g=requireIncr32();function v(w){var E=w._cipher.encryptBlockRaw(w._prev);return g(w._prev),E}var b=16;return ctr.encrypt=function(w,E){var S=Math.ceil(E.length/b),A=w._cache.length;w._cache=u.concat([w._cache,u.allocUnsafe(S*b)]);for(var $=0;$<S;$++){var R=v(w),T=A+$*b;w._cache.writeUInt32BE(R[0],T+0),w._cache.writeUInt32BE(R[1],T+4),w._cache.writeUInt32BE(R[2],T+8),w._cache.writeUInt32BE(R[3],T+12)}var O=w._cache.slice(0,E.length);return w._cache=w._cache.slice(E.length),y(E,O)},ctr}const aes128={cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192={cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256={cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},require$$2$2={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128,aes192,aes256,"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}};var modes_1,hasRequiredModes$1;function requireModes$1(){if(hasRequiredModes$1)return modes_1;hasRequiredModes$1=1;var y={ECB:requireEcb(),CBC:requireCbc(),CFB:requireCfb(),CFB8:requireCfb8(),CFB1:requireCfb1(),OFB:requireOfb(),CTR:requireCtr(),GCM:requireCtr()},u=require$$2$2;for(var g in u)u[g].module=y[u[g].mode];return modes_1=u,modes_1}var aes$2={},hasRequiredAes$1;function requireAes$1(){if(hasRequiredAes$1)return aes$2;hasRequiredAes$1=1;var y=requireSafeBuffer$2().Buffer;function u(S){y.isBuffer(S)||(S=y.from(S));for(var A=S.length/4|0,$=new Array(A),R=0;R<A;R++)$[R]=S.readUInt32BE(R*4);return $}function g(S){for(var A=0;A<S.length;S++)S[A]=0}function v(S,A,$,R,T){for(var O=$[0],B=$[1],F=$[2],U=$[3],q=S[0]^A[0],J=S[1]^A[1],ie=S[2]^A[2],oe=S[3]^A[3],le,de,fe,ye,we=4,pe=1;pe<T;pe++)le=O[q>>>24]^B[J>>>16&255]^F[ie>>>8&255]^U[oe&255]^A[we++],de=O[J>>>24]^B[ie>>>16&255]^F[oe>>>8&255]^U[q&255]^A[we++],fe=O[ie>>>24]^B[oe>>>16&255]^F[q>>>8&255]^U[J&255]^A[we++],ye=O[oe>>>24]^B[q>>>16&255]^F[J>>>8&255]^U[ie&255]^A[we++],q=le,J=de,ie=fe,oe=ye;return le=(R[q>>>24]<<24|R[J>>>16&255]<<16|R[ie>>>8&255]<<8|R[oe&255])^A[we++],de=(R[J>>>24]<<24|R[ie>>>16&255]<<16|R[oe>>>8&255]<<8|R[q&255])^A[we++],fe=(R[ie>>>24]<<24|R[oe>>>16&255]<<16|R[q>>>8&255]<<8|R[J&255])^A[we++],ye=(R[oe>>>24]<<24|R[q>>>16&255]<<16|R[J>>>8&255]<<8|R[ie&255])^A[we++],le=le>>>0,de=de>>>0,fe=fe>>>0,ye=ye>>>0,[le,de,fe,ye]}var b=[0,1,2,4,8,16,32,64,128,27,54],w=(function(){for(var S=new Array(256),A=0;A<256;A++)A<128?S[A]=A<<1:S[A]=A<<1^283;for(var $=[],R=[],T=[[],[],[],[]],O=[[],[],[],[]],B=0,F=0,U=0;U<256;++U){var q=F^F<<1^F<<2^F<<3^F<<4;q=q>>>8^q&255^99,$[B]=q,R[q]=B;var J=S[B],ie=S[J],oe=S[ie],le=S[q]*257^q*16843008;T[0][B]=le<<24|le>>>8,T[1][B]=le<<16|le>>>16,T[2][B]=le<<8|le>>>24,T[3][B]=le,le=oe*16843009^ie*65537^J*257^B*16843008,O[0][q]=le<<24|le>>>8,O[1][q]=le<<16|le>>>16,O[2][q]=le<<8|le>>>24,O[3][q]=le,B===0?B=F=1:(B=J^S[S[S[oe^J]]],F^=S[S[F]])}return{SBOX:$,INV_SBOX:R,SUB_MIX:T,INV_SUB_MIX:O}})();function E(S){this._key=u(S),this._reset()}return E.blockSize=16,E.keySize=256/8,E.prototype.blockSize=E.blockSize,E.prototype.keySize=E.keySize,E.prototype._reset=function(){for(var S=this._key,A=S.length,$=A+6,R=($+1)*4,T=[],O=0;O<A;O++)T[O]=S[O];for(O=A;O<R;O++){var B=T[O-1];O%A===0?(B=B<<8|B>>>24,B=w.SBOX[B>>>24]<<24|w.SBOX[B>>>16&255]<<16|w.SBOX[B>>>8&255]<<8|w.SBOX[B&255],B^=b[O/A|0]<<24):A>6&&O%A===4&&(B=w.SBOX[B>>>24]<<24|w.SBOX[B>>>16&255]<<16|w.SBOX[B>>>8&255]<<8|w.SBOX[B&255]),T[O]=T[O-A]^B}for(var F=[],U=0;U<R;U++){var q=R-U,J=T[q-(U%4?0:4)];U<4||q<=4?F[U]=J:F[U]=w.INV_SUB_MIX[0][w.SBOX[J>>>24]]^w.INV_SUB_MIX[1][w.SBOX[J>>>16&255]]^w.INV_SUB_MIX[2][w.SBOX[J>>>8&255]]^w.INV_SUB_MIX[3][w.SBOX[J&255]]}this._nRounds=$,this._keySchedule=T,this._invKeySchedule=F},E.prototype.encryptBlockRaw=function(S){return S=u(S),v(S,this._keySchedule,w.SUB_MIX,w.SBOX,this._nRounds)},E.prototype.encryptBlock=function(S){var A=this.encryptBlockRaw(S),$=y.allocUnsafe(16);return $.writeUInt32BE(A[0],0),$.writeUInt32BE(A[1],4),$.writeUInt32BE(A[2],8),$.writeUInt32BE(A[3],12),$},E.prototype.decryptBlock=function(S){S=u(S);var A=S[1];S[1]=S[3],S[3]=A;var $=v(S,this._invKeySchedule,w.INV_SUB_MIX,w.INV_SBOX,this._nRounds),R=y.allocUnsafe(16);return R.writeUInt32BE($[0],0),R.writeUInt32BE($[3],4),R.writeUInt32BE($[2],8),R.writeUInt32BE($[1],12),R},E.prototype.scrub=function(){g(this._keySchedule),g(this._invKeySchedule),g(this._key)},aes$2.AES=E,aes$2}var ghash,hasRequiredGhash;function requireGhash(){if(hasRequiredGhash)return ghash;hasRequiredGhash=1;var y=requireSafeBuffer$2().Buffer,u=y.alloc(16,0);function g(w){return[w.readUInt32BE(0),w.readUInt32BE(4),w.readUInt32BE(8),w.readUInt32BE(12)]}function v(w){var E=y.allocUnsafe(16);return E.writeUInt32BE(w[0]>>>0,0),E.writeUInt32BE(w[1]>>>0,4),E.writeUInt32BE(w[2]>>>0,8),E.writeUInt32BE(w[3]>>>0,12),E}function b(w){this.h=w,this.state=y.alloc(16,0),this.cache=y.allocUnsafe(0)}return b.prototype.ghash=function(w){for(var E=-1;++E<w.length;)this.state[E]^=w[E];this._multiply()},b.prototype._multiply=function(){for(var w=g(this.h),E=[0,0,0,0],S,A,$,R=-1;++R<128;){for(A=(this.state[~~(R/8)]&1<<7-R%8)!==0,A&&(E[0]^=w[0],E[1]^=w[1],E[2]^=w[2],E[3]^=w[3]),$=(w[3]&1)!==0,S=3;S>0;S--)w[S]=w[S]>>>1|(w[S-1]&1)<<31;w[0]=w[0]>>>1,$&&(w[0]=w[0]^225<<24)}this.state=v(E)},b.prototype.update=function(w){this.cache=y.concat([this.cache,w]);for(var E;this.cache.length>=16;)E=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(E)},b.prototype.final=function(w,E){return this.cache.length&&this.ghash(y.concat([this.cache,u],16)),this.ghash(v([0,w,0,E])),this.state},ghash=b,ghash}var authCipher,hasRequiredAuthCipher;function requireAuthCipher(){if(hasRequiredAuthCipher)return authCipher;hasRequiredAuthCipher=1;var y=requireAes$1(),u=requireSafeBuffer$2().Buffer,g=requireCipherBase(),v=requireInherits_browser(),b=requireGhash(),w=requireBufferXor(),E=requireIncr32();function S(R,T){var O=0;R.length!==T.length&&O++;for(var B=Math.min(R.length,T.length),F=0;F<B;++F)O+=R[F]^T[F];return O}function A(R,T,O){if(T.length===12)return R._finID=u.concat([T,u.from([0,0,0,1])]),u.concat([T,u.from([0,0,0,2])]);var B=new b(O),F=T.length,U=F%16;B.update(T),U&&(U=16-U,B.update(u.alloc(U,0))),B.update(u.alloc(8,0));var q=F*8,J=u.alloc(8);J.writeUIntBE(q,0,8),B.update(J),R._finID=B.state;var ie=u.from(R._finID);return E(ie),ie}function $(R,T,O,B){g.call(this);var F=u.alloc(4,0);this._cipher=new y.AES(T);var U=this._cipher.encryptBlock(F);this._ghash=new b(U),O=A(this,O,U),this._prev=u.from(O),this._cache=u.allocUnsafe(0),this._secCache=u.allocUnsafe(0),this._decrypt=B,this._alen=0,this._len=0,this._mode=R,this._authTag=null,this._called=!1}return v($,g),$.prototype._update=function(R){if(!this._called&&this._alen){var T=16-this._alen%16;T<16&&(T=u.alloc(T,0),this._ghash.update(T))}this._called=!0;var O=this._mode.encrypt(this,R);return this._decrypt?this._ghash.update(R):this._ghash.update(O),this._len+=R.length,O},$.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var R=w(this._ghash.final(this._alen*8,this._len*8),this._cipher.encryptBlock(this._finID));if(this._decrypt&&S(R,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=R,this._cipher.scrub()},$.prototype.getAuthTag=function(){if(this._decrypt||!u.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},$.prototype.setAuthTag=function(T){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=T},$.prototype.setAAD=function(T){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(T),this._alen+=T.length},authCipher=$,authCipher}var streamCipher,hasRequiredStreamCipher;function requireStreamCipher(){if(hasRequiredStreamCipher)return streamCipher;hasRequiredStreamCipher=1;var y=requireAes$1(),u=requireSafeBuffer$2().Buffer,g=requireCipherBase(),v=requireInherits_browser();function b(w,E,S,A){g.call(this),this._cipher=new y.AES(E),this._prev=u.from(S),this._cache=u.allocUnsafe(0),this._secCache=u.allocUnsafe(0),this._decrypt=A,this._mode=w}return v(b,g),b.prototype._update=function(w){return this._mode.encrypt(this,w,this._decrypt)},b.prototype._final=function(){this._cipher.scrub()},streamCipher=b,streamCipher}var evp_bytestokey,hasRequiredEvp_bytestokey;function requireEvp_bytestokey(){if(hasRequiredEvp_bytestokey)return evp_bytestokey;hasRequiredEvp_bytestokey=1;var y=requireSafeBuffer$2().Buffer,u=requireMd5_js();function g(v,b,w,E){if(y.isBuffer(v)||(v=y.from(v,"binary")),b&&(y.isBuffer(b)||(b=y.from(b,"binary")),b.length!==8))throw new RangeError("salt should be Buffer with 8 byte length");for(var S=w/8,A=y.alloc(S),$=y.alloc(E||0),R=y.alloc(0);S>0||E>0;){var T=new u;T.update(R),T.update(v),b&&T.update(b),R=T.digest();var O=0;if(S>0){var B=A.length-S;O=Math.min(S,R.length),R.copy(A,B,0,O),S-=O}if(O<R.length&&E>0){var F=$.length-E,U=Math.min(E,R.length-O);R.copy($,F,O,O+U),E-=U}}return R.fill(0),{key:A,iv:$}}return evp_bytestokey=g,evp_bytestokey}var hasRequiredEncrypter;function requireEncrypter(){if(hasRequiredEncrypter)return encrypter;hasRequiredEncrypter=1;var y=requireModes$1(),u=requireAuthCipher(),g=requireSafeBuffer$2().Buffer,v=requireStreamCipher(),b=requireCipherBase(),w=requireAes$1(),E=requireEvp_bytestokey(),S=requireInherits_browser();function A(B,F,U){b.call(this),this._cache=new R,this._cipher=new w.AES(F),this._prev=g.from(U),this._mode=B,this._autopadding=!0}S(A,b),A.prototype._update=function(B){this._cache.add(B);for(var F,U,q=[];F=this._cache.get();)U=this._mode.encrypt(this,F),q.push(U);return g.concat(q)};var $=g.alloc(16,16);A.prototype._final=function(){var B=this._cache.flush();if(this._autopadding)return B=this._mode.encrypt(this,B),this._cipher.scrub(),B;if(!B.equals($))throw this._cipher.scrub(),new Error("data not multiple of block length")},A.prototype.setAutoPadding=function(B){return this._autopadding=!!B,this};function R(){this.cache=g.allocUnsafe(0)}R.prototype.add=function(B){this.cache=g.concat([this.cache,B])},R.prototype.get=function(){if(this.cache.length>15){var B=this.cache.slice(0,16);return this.cache=this.cache.slice(16),B}return null},R.prototype.flush=function(){for(var B=16-this.cache.length,F=g.allocUnsafe(B),U=-1;++U<B;)F.writeUInt8(B,U);return g.concat([this.cache,F])};function T(B,F,U){var q=y[B.toLowerCase()];if(!q)throw new TypeError("invalid suite type");if(typeof F=="string"&&(F=g.from(F)),F.length!==q.key/8)throw new TypeError("invalid key length "+F.length);if(typeof U=="string"&&(U=g.from(U)),q.mode!=="GCM"&&U.length!==q.iv)throw new TypeError("invalid iv length "+U.length);return q.type==="stream"?new v(q.module,F,U):q.type==="auth"?new u(q.module,F,U):new A(q.module,F,U)}function O(B,F){var U=y[B.toLowerCase()];if(!U)throw new TypeError("invalid suite type");var q=E(F,!1,U.key,U.iv);return T(B,q.key,q.iv)}return encrypter.createCipheriv=T,encrypter.createCipher=O,encrypter}var decrypter={},hasRequiredDecrypter;function requireDecrypter(){if(hasRequiredDecrypter)return decrypter;hasRequiredDecrypter=1;var y=requireAuthCipher(),u=requireSafeBuffer$2().Buffer,g=requireModes$1(),v=requireStreamCipher(),b=requireCipherBase(),w=requireAes$1(),E=requireEvp_bytestokey(),S=requireInherits_browser();function A(B,F,U){b.call(this),this._cache=new $,this._last=void 0,this._cipher=new w.AES(F),this._prev=u.from(U),this._mode=B,this._autopadding=!0}S(A,b),A.prototype._update=function(B){this._cache.add(B);for(var F,U,q=[];F=this._cache.get(this._autopadding);)U=this._mode.decrypt(this,F),q.push(U);return u.concat(q)},A.prototype._final=function(){var B=this._cache.flush();if(this._autopadding)return R(this._mode.decrypt(this,B));if(B)throw new Error("data not multiple of block length")},A.prototype.setAutoPadding=function(B){return this._autopadding=!!B,this};function $(){this.cache=u.allocUnsafe(0)}$.prototype.add=function(B){this.cache=u.concat([this.cache,B])},$.prototype.get=function(B){var F;if(B){if(this.cache.length>16)return F=this.cache.slice(0,16),this.cache=this.cache.slice(16),F}else if(this.cache.length>=16)return F=this.cache.slice(0,16),this.cache=this.cache.slice(16),F;return null},$.prototype.flush=function(){if(this.cache.length)return this.cache};function R(B){var F=B[15];if(F<1||F>16)throw new Error("unable to decrypt data");for(var U=-1;++U<F;)if(B[U+(16-F)]!==F)throw new Error("unable to decrypt data");if(F!==16)return B.slice(0,16-F)}function T(B,F,U){var q=g[B.toLowerCase()];if(!q)throw new TypeError("invalid suite type");if(typeof U=="string"&&(U=u.from(U)),q.mode!=="GCM"&&U.length!==q.iv)throw new TypeError("invalid iv length "+U.length);if(typeof F=="string"&&(F=u.from(F)),F.length!==q.key/8)throw new TypeError("invalid key length "+F.length);return q.type==="stream"?new v(q.module,F,U,!0):q.type==="auth"?new y(q.module,F,U,!0):new A(q.module,F,U)}function O(B,F){var U=g[B.toLowerCase()];if(!U)throw new TypeError("invalid suite type");var q=E(F,!1,U.key,U.iv);return T(B,q.key,q.iv)}return decrypter.createDecipher=O,decrypter.createDecipheriv=T,decrypter}var hasRequiredBrowser$8;function requireBrowser$8(){if(hasRequiredBrowser$8)return browser$8;hasRequiredBrowser$8=1;var y=requireEncrypter(),u=requireDecrypter(),g=require$$2$2;function v(){return Object.keys(g)}return browser$8.createCipher=browser$8.Cipher=y.createCipher,browser$8.createCipheriv=browser$8.Cipheriv=y.createCipheriv,browser$8.createDecipher=browser$8.Decipher=u.createDecipher,browser$8.createDecipheriv=browser$8.Decipheriv=u.createDecipheriv,browser$8.listCiphers=browser$8.getCiphers=v,browser$8}var modes={},hasRequiredModes;function requireModes(){return hasRequiredModes||(hasRequiredModes=1,(function(y){y["des-ecb"]={key:8,iv:0},y["des-cbc"]=y.des={key:8,iv:8},y["des-ede3-cbc"]=y.des3={key:24,iv:8},y["des-ede3"]={key:24,iv:0},y["des-ede-cbc"]={key:16,iv:8},y["des-ede"]={key:16,iv:0}})(modes)),modes}var hasRequiredBrowser$7;function requireBrowser$7(){if(hasRequiredBrowser$7)return browser$9;hasRequiredBrowser$7=1;var y=requireBrowserifyDes(),u=requireBrowser$8(),g=requireModes$1(),v=requireModes(),b=requireEvp_bytestokey();function w(R,T){R=R.toLowerCase();var O,B;if(g[R])O=g[R].key,B=g[R].iv;else if(v[R])O=v[R].key*8,B=v[R].iv;else throw new TypeError("invalid suite type");var F=b(T,!1,O,B);return S(R,F.key,F.iv)}function E(R,T){R=R.toLowerCase();var O,B;if(g[R])O=g[R].key,B=g[R].iv;else if(v[R])O=v[R].key*8,B=v[R].iv;else throw new TypeError("invalid suite type");var F=b(T,!1,O,B);return A(R,F.key,F.iv)}function S(R,T,O){if(R=R.toLowerCase(),g[R])return u.createCipheriv(R,T,O);if(v[R])return new y({key:T,iv:O,mode:R});throw new TypeError("invalid suite type")}function A(R,T,O){if(R=R.toLowerCase(),g[R])return u.createDecipheriv(R,T,O);if(v[R])return new y({key:T,iv:O,mode:R,decrypt:!0});throw new TypeError("invalid suite type")}function $(){return Object.keys(v).concat(u.getCiphers())}return browser$9.createCipher=browser$9.Cipher=w,browser$9.createCipheriv=browser$9.Cipheriv=S,browser$9.createDecipher=browser$9.Decipher=E,browser$9.createDecipheriv=browser$9.Decipheriv=A,browser$9.listCiphers=browser$9.getCiphers=$,browser$9}var browser$7={},bn$5={exports:{}},bn$4=bn$5.exports,hasRequiredBn$2;function requireBn$2(){return hasRequiredBn$2||(hasRequiredBn$2=1,(function(y){(function(u,g){function v(he,ae){if(!he)throw new Error(ae||"Assertion failed")}function b(he,ae){he.super_=ae;var Q=function(){};Q.prototype=ae.prototype,he.prototype=new Q,he.prototype.constructor=he}function w(he,ae,Q){if(w.isBN(he))return he;this.negative=0,this.words=null,this.length=0,this.red=null,he!==null&&((ae==="le"||ae==="be")&&(Q=ae,ae=10),this._init(he||0,ae||10,Q||"be"))}typeof u=="object"?u.exports=w:g.BN=w,w.BN=w,w.wordSize=26;var E;try{typeof window<"u"&&typeof window.Buffer<"u"?E=window.Buffer:E=requireDist().Buffer}catch{}w.isBN=function(ae){return ae instanceof w?!0:ae!==null&&typeof ae=="object"&&ae.constructor.wordSize===w.wordSize&&Array.isArray(ae.words)},w.max=function(ae,Q){return ae.cmp(Q)>0?ae:Q},w.min=function(ae,Q){return ae.cmp(Q)<0?ae:Q},w.prototype._init=function(ae,Q,j){if(typeof ae=="number")return this._initNumber(ae,Q,j);if(typeof ae=="object")return this._initArray(ae,Q,j);Q==="hex"&&(Q=16),v(Q===(Q|0)&&Q>=2&&Q<=36),ae=ae.toString().replace(/\s+/g,"");var z=0;ae[0]==="-"&&(z++,this.negative=1),z<ae.length&&(Q===16?this._parseHex(ae,z,j):(this._parseBase(ae,Q,z),j==="le"&&this._initArray(this.toArray(),Q,j)))},w.prototype._initNumber=function(ae,Q,j){ae<0&&(this.negative=1,ae=-ae),ae<67108864?(this.words=[ae&67108863],this.length=1):ae<4503599627370496?(this.words=[ae&67108863,ae/67108864&67108863],this.length=2):(v(ae<9007199254740992),this.words=[ae&67108863,ae/67108864&67108863,1],this.length=3),j==="le"&&this._initArray(this.toArray(),Q,j)},w.prototype._initArray=function(ae,Q,j){if(v(typeof ae.length=="number"),ae.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(ae.length/3),this.words=new Array(this.length);for(var z=0;z<this.length;z++)this.words[z]=0;var re,Y,te=0;if(j==="be")for(z=ae.length-1,re=0;z>=0;z-=3)Y=ae[z]|ae[z-1]<<8|ae[z-2]<<16,this.words[re]|=Y<<te&67108863,this.words[re+1]=Y>>>26-te&67108863,te+=24,te>=26&&(te-=26,re++);else if(j==="le")for(z=0,re=0;z<ae.length;z+=3)Y=ae[z]|ae[z+1]<<8|ae[z+2]<<16,this.words[re]|=Y<<te&67108863,this.words[re+1]=Y>>>26-te&67108863,te+=24,te>=26&&(te-=26,re++);return this.strip()};function S(he,ae){var Q=he.charCodeAt(ae);return Q>=65&&Q<=70?Q-55:Q>=97&&Q<=102?Q-87:Q-48&15}function A(he,ae,Q){var j=S(he,Q);return Q-1>=ae&&(j|=S(he,Q-1)<<4),j}w.prototype._parseHex=function(ae,Q,j){this.length=Math.ceil((ae.length-Q)/6),this.words=new Array(this.length);for(var z=0;z<this.length;z++)this.words[z]=0;var re=0,Y=0,te;if(j==="be")for(z=ae.length-1;z>=Q;z-=2)te=A(ae,Q,z)<<re,this.words[Y]|=te&67108863,re>=18?(re-=18,Y+=1,this.words[Y]|=te>>>26):re+=8;else{var ne=ae.length-Q;for(z=ne%2===0?Q+1:Q;z<ae.length;z+=2)te=A(ae,Q,z)<<re,this.words[Y]|=te&67108863,re>=18?(re-=18,Y+=1,this.words[Y]|=te>>>26):re+=8}this.strip()};function $(he,ae,Q,j){for(var z=0,re=Math.min(he.length,Q),Y=ae;Y<re;Y++){var te=he.charCodeAt(Y)-48;z*=j,te>=49?z+=te-49+10:te>=17?z+=te-17+10:z+=te}return z}w.prototype._parseBase=function(ae,Q,j){this.words=[0],this.length=1;for(var z=0,re=1;re<=67108863;re*=Q)z++;z--,re=re/Q|0;for(var Y=ae.length-j,te=Y%z,ne=Math.min(Y,Y-te)+j,se=0,ee=j;ee<ne;ee+=z)se=$(ae,ee,ee+z,Q),this.imuln(re),this.words[0]+se<67108864?this.words[0]+=se:this._iaddn(se);if(te!==0){var Z=1;for(se=$(ae,ee,ae.length,Q),ee=0;ee<te;ee++)Z*=Q;this.imuln(Z),this.words[0]+se<67108864?this.words[0]+=se:this._iaddn(se)}this.strip()},w.prototype.copy=function(ae){ae.words=new Array(this.length);for(var Q=0;Q<this.length;Q++)ae.words[Q]=this.words[Q];ae.length=this.length,ae.negative=this.negative,ae.red=this.red},w.prototype.clone=function(){var ae=new w(null);return this.copy(ae),ae},w.prototype._expand=function(ae){for(;this.length<ae;)this.words[this.length++]=0;return this},w.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},w.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},w.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var R=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],T=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],O=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];w.prototype.toString=function(ae,Q){ae=ae||10,Q=Q|0||1;var j;if(ae===16||ae==="hex"){j="";for(var z=0,re=0,Y=0;Y<this.length;Y++){var te=this.words[Y],ne=((te<<z|re)&16777215).toString(16);re=te>>>24-z&16777215,z+=2,z>=26&&(z-=26,Y--),re!==0||Y!==this.length-1?j=R[6-ne.length]+ne+j:j=ne+j}for(re!==0&&(j=re.toString(16)+j);j.length%Q!==0;)j="0"+j;return this.negative!==0&&(j="-"+j),j}if(ae===(ae|0)&&ae>=2&&ae<=36){var se=T[ae],ee=O[ae];j="";var Z=this.clone();for(Z.negative=0;!Z.isZero();){var ue=Z.modn(ee).toString(ae);Z=Z.idivn(ee),Z.isZero()?j=ue+j:j=R[se-ue.length]+ue+j}for(this.isZero()&&(j="0"+j);j.length%Q!==0;)j="0"+j;return this.negative!==0&&(j="-"+j),j}v(!1,"Base should be between 2 and 36")},w.prototype.toNumber=function(){var ae=this.words[0];return this.length===2?ae+=this.words[1]*67108864:this.length===3&&this.words[2]===1?ae+=4503599627370496+this.words[1]*67108864:this.length>2&&v(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-ae:ae},w.prototype.toJSON=function(){return this.toString(16)},w.prototype.toBuffer=function(ae,Q){return v(typeof E<"u"),this.toArrayLike(E,ae,Q)},w.prototype.toArray=function(ae,Q){return this.toArrayLike(Array,ae,Q)},w.prototype.toArrayLike=function(ae,Q,j){var z=this.byteLength(),re=j||Math.max(1,z);v(z<=re,"byte array longer than desired length"),v(re>0,"Requested array length <= 0"),this.strip();var Y=Q==="le",te=new ae(re),ne,se,ee=this.clone();if(Y){for(se=0;!ee.isZero();se++)ne=ee.andln(255),ee.iushrn(8),te[se]=ne;for(;se<re;se++)te[se]=0}else{for(se=0;se<re-z;se++)te[se]=0;for(se=0;!ee.isZero();se++)ne=ee.andln(255),ee.iushrn(8),te[re-se-1]=ne}return te},Math.clz32?w.prototype._countBits=function(ae){return 32-Math.clz32(ae)}:w.prototype._countBits=function(ae){var Q=ae,j=0;return Q>=4096&&(j+=13,Q>>>=13),Q>=64&&(j+=7,Q>>>=7),Q>=8&&(j+=4,Q>>>=4),Q>=2&&(j+=2,Q>>>=2),j+Q},w.prototype._zeroBits=function(ae){if(ae===0)return 26;var Q=ae,j=0;return(Q&8191)===0&&(j+=13,Q>>>=13),(Q&127)===0&&(j+=7,Q>>>=7),(Q&15)===0&&(j+=4,Q>>>=4),(Q&3)===0&&(j+=2,Q>>>=2),(Q&1)===0&&j++,j},w.prototype.bitLength=function(){var ae=this.words[this.length-1],Q=this._countBits(ae);return(this.length-1)*26+Q};function B(he){for(var ae=new Array(he.bitLength()),Q=0;Q<ae.length;Q++){var j=Q/26|0,z=Q%26;ae[Q]=(he.words[j]&1<<z)>>>z}return ae}w.prototype.zeroBits=function(){if(this.isZero())return 0;for(var ae=0,Q=0;Q<this.length;Q++){var j=this._zeroBits(this.words[Q]);if(ae+=j,j!==26)break}return ae},w.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},w.prototype.toTwos=function(ae){return this.negative!==0?this.abs().inotn(ae).iaddn(1):this.clone()},w.prototype.fromTwos=function(ae){return this.testn(ae-1)?this.notn(ae).iaddn(1).ineg():this.clone()},w.prototype.isNeg=function(){return this.negative!==0},w.prototype.neg=function(){return this.clone().ineg()},w.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},w.prototype.iuor=function(ae){for(;this.length<ae.length;)this.words[this.length++]=0;for(var Q=0;Q<ae.length;Q++)this.words[Q]=this.words[Q]|ae.words[Q];return this.strip()},w.prototype.ior=function(ae){return v((this.negative|ae.negative)===0),this.iuor(ae)},w.prototype.or=function(ae){return this.length>ae.length?this.clone().ior(ae):ae.clone().ior(this)},w.prototype.uor=function(ae){return this.length>ae.length?this.clone().iuor(ae):ae.clone().iuor(this)},w.prototype.iuand=function(ae){var Q;this.length>ae.length?Q=ae:Q=this;for(var j=0;j<Q.length;j++)this.words[j]=this.words[j]&ae.words[j];return this.length=Q.length,this.strip()},w.prototype.iand=function(ae){return v((this.negative|ae.negative)===0),this.iuand(ae)},w.prototype.and=function(ae){return this.length>ae.length?this.clone().iand(ae):ae.clone().iand(this)},w.prototype.uand=function(ae){return this.length>ae.length?this.clone().iuand(ae):ae.clone().iuand(this)},w.prototype.iuxor=function(ae){var Q,j;this.length>ae.length?(Q=this,j=ae):(Q=ae,j=this);for(var z=0;z<j.length;z++)this.words[z]=Q.words[z]^j.words[z];if(this!==Q)for(;z<Q.length;z++)this.words[z]=Q.words[z];return this.length=Q.length,this.strip()},w.prototype.ixor=function(ae){return v((this.negative|ae.negative)===0),this.iuxor(ae)},w.prototype.xor=function(ae){return this.length>ae.length?this.clone().ixor(ae):ae.clone().ixor(this)},w.prototype.uxor=function(ae){return this.length>ae.length?this.clone().iuxor(ae):ae.clone().iuxor(this)},w.prototype.inotn=function(ae){v(typeof ae=="number"&&ae>=0);var Q=Math.ceil(ae/26)|0,j=ae%26;this._expand(Q),j>0&&Q--;for(var z=0;z<Q;z++)this.words[z]=~this.words[z]&67108863;return j>0&&(this.words[z]=~this.words[z]&67108863>>26-j),this.strip()},w.prototype.notn=function(ae){return this.clone().inotn(ae)},w.prototype.setn=function(ae,Q){v(typeof ae=="number"&&ae>=0);var j=ae/26|0,z=ae%26;return this._expand(j+1),Q?this.words[j]=this.words[j]|1<<z:this.words[j]=this.words[j]&~(1<<z),this.strip()},w.prototype.iadd=function(ae){var Q;if(this.negative!==0&&ae.negative===0)return this.negative=0,Q=this.isub(ae),this.negative^=1,this._normSign();if(this.negative===0&&ae.negative!==0)return ae.negative=0,Q=this.isub(ae),ae.negative=1,Q._normSign();var j,z;this.length>ae.length?(j=this,z=ae):(j=ae,z=this);for(var re=0,Y=0;Y<z.length;Y++)Q=(j.words[Y]|0)+(z.words[Y]|0)+re,this.words[Y]=Q&67108863,re=Q>>>26;for(;re!==0&&Y<j.length;Y++)Q=(j.words[Y]|0)+re,this.words[Y]=Q&67108863,re=Q>>>26;if(this.length=j.length,re!==0)this.words[this.length]=re,this.length++;else if(j!==this)for(;Y<j.length;Y++)this.words[Y]=j.words[Y];return this},w.prototype.add=function(ae){var Q;return ae.negative!==0&&this.negative===0?(ae.negative=0,Q=this.sub(ae),ae.negative^=1,Q):ae.negative===0&&this.negative!==0?(this.negative=0,Q=ae.sub(this),this.negative=1,Q):this.length>ae.length?this.clone().iadd(ae):ae.clone().iadd(this)},w.prototype.isub=function(ae){if(ae.negative!==0){ae.negative=0;var Q=this.iadd(ae);return ae.negative=1,Q._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(ae),this.negative=1,this._normSign();var j=this.cmp(ae);if(j===0)return this.negative=0,this.length=1,this.words[0]=0,this;var z,re;j>0?(z=this,re=ae):(z=ae,re=this);for(var Y=0,te=0;te<re.length;te++)Q=(z.words[te]|0)-(re.words[te]|0)+Y,Y=Q>>26,this.words[te]=Q&67108863;for(;Y!==0&&te<z.length;te++)Q=(z.words[te]|0)+Y,Y=Q>>26,this.words[te]=Q&67108863;if(Y===0&&te<z.length&&z!==this)for(;te<z.length;te++)this.words[te]=z.words[te];return this.length=Math.max(this.length,te),z!==this&&(this.negative=1),this.strip()},w.prototype.sub=function(ae){return this.clone().isub(ae)};function F(he,ae,Q){Q.negative=ae.negative^he.negative;var j=he.length+ae.length|0;Q.length=j,j=j-1|0;var z=he.words[0]|0,re=ae.words[0]|0,Y=z*re,te=Y&67108863,ne=Y/67108864|0;Q.words[0]=te;for(var se=1;se<j;se++){for(var ee=ne>>>26,Z=ne&67108863,ue=Math.min(se,ae.length-1),_e=Math.max(0,se-he.length+1);_e<=ue;_e++){var Re=se-_e|0;z=he.words[Re]|0,re=ae.words[_e]|0,Y=z*re+Z,ee+=Y/67108864|0,Z=Y&67108863}Q.words[se]=Z|0,ne=ee|0}return ne!==0?Q.words[se]=ne|0:Q.length--,Q.strip()}var U=function(ae,Q,j){var z=ae.words,re=Q.words,Y=j.words,te=0,ne,se,ee,Z=z[0]|0,ue=Z&8191,_e=Z>>>13,Re=z[1]|0,Ae=Re&8191,ge=Re>>>13,be=z[2]|0,Te=be&8191,De=be>>>13,Ie=z[3]|0,Se=Ie&8191,Be=Ie>>>13,Le=z[4]|0,qe=Le&8191,Ke=Le>>>13,Ge=z[5]|0,Xe=Ge&8191,ze=Ge>>>13,et=z[6]|0,Ze=et&8191,nt=et>>>13,ut=z[7]|0,ot=ut&8191,vt=ut>>>13,bt=z[8]|0,lt=bt&8191,kt=bt>>>13,Ct=z[9]|0,Me=Ct&8191,Ce=Ct>>>13,Ee=re[0]|0,Pe=Ee&8191,je=Ee>>>13,He=re[1]|0,Ve=He&8191,dt=He>>>13,xt=re[2]|0,mt=xt&8191,gt=xt>>>13,at=re[3]|0,ht=at&8191,_t=at>>>13,$t=re[4]|0,St=$t&8191,ft=$t>>>13,At=re[5]|0,Oe=At&8191,$e=At>>>13,ke=re[6]|0,Ue=ke&8191,We=ke>>>13,Qe=re[7]|0,tt=Qe&8191,Pt=Qe>>>13,Nt=re[8]|0,Rt=Nt&8191,Dt=Nt>>>13,Tt=re[9]|0,It=Tt&8191,Wt=Tt>>>13;j.negative=ae.negative^Q.negative,j.length=19,ne=Math.imul(ue,Pe),se=Math.imul(ue,je),se=se+Math.imul(_e,Pe)|0,ee=Math.imul(_e,je);var jt=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(jt>>>26)|0,jt&=67108863,ne=Math.imul(Ae,Pe),se=Math.imul(Ae,je),se=se+Math.imul(ge,Pe)|0,ee=Math.imul(ge,je),ne=ne+Math.imul(ue,Ve)|0,se=se+Math.imul(ue,dt)|0,se=se+Math.imul(_e,Ve)|0,ee=ee+Math.imul(_e,dt)|0;var Ft=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Ft>>>26)|0,Ft&=67108863,ne=Math.imul(Te,Pe),se=Math.imul(Te,je),se=se+Math.imul(De,Pe)|0,ee=Math.imul(De,je),ne=ne+Math.imul(Ae,Ve)|0,se=se+Math.imul(Ae,dt)|0,se=se+Math.imul(ge,Ve)|0,ee=ee+Math.imul(ge,dt)|0,ne=ne+Math.imul(ue,mt)|0,se=se+Math.imul(ue,gt)|0,se=se+Math.imul(_e,mt)|0,ee=ee+Math.imul(_e,gt)|0;var Kr=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Kr>>>26)|0,Kr&=67108863,ne=Math.imul(Se,Pe),se=Math.imul(Se,je),se=se+Math.imul(Be,Pe)|0,ee=Math.imul(Be,je),ne=ne+Math.imul(Te,Ve)|0,se=se+Math.imul(Te,dt)|0,se=se+Math.imul(De,Ve)|0,ee=ee+Math.imul(De,dt)|0,ne=ne+Math.imul(Ae,mt)|0,se=se+Math.imul(Ae,gt)|0,se=se+Math.imul(ge,mt)|0,ee=ee+Math.imul(ge,gt)|0,ne=ne+Math.imul(ue,ht)|0,se=se+Math.imul(ue,_t)|0,se=se+Math.imul(_e,ht)|0,ee=ee+Math.imul(_e,_t)|0;var Mr=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Mr>>>26)|0,Mr&=67108863,ne=Math.imul(qe,Pe),se=Math.imul(qe,je),se=se+Math.imul(Ke,Pe)|0,ee=Math.imul(Ke,je),ne=ne+Math.imul(Se,Ve)|0,se=se+Math.imul(Se,dt)|0,se=se+Math.imul(Be,Ve)|0,ee=ee+Math.imul(Be,dt)|0,ne=ne+Math.imul(Te,mt)|0,se=se+Math.imul(Te,gt)|0,se=se+Math.imul(De,mt)|0,ee=ee+Math.imul(De,gt)|0,ne=ne+Math.imul(Ae,ht)|0,se=se+Math.imul(Ae,_t)|0,se=se+Math.imul(ge,ht)|0,ee=ee+Math.imul(ge,_t)|0,ne=ne+Math.imul(ue,St)|0,se=se+Math.imul(ue,ft)|0,se=se+Math.imul(_e,St)|0,ee=ee+Math.imul(_e,ft)|0;var Cr=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Cr>>>26)|0,Cr&=67108863,ne=Math.imul(Xe,Pe),se=Math.imul(Xe,je),se=se+Math.imul(ze,Pe)|0,ee=Math.imul(ze,je),ne=ne+Math.imul(qe,Ve)|0,se=se+Math.imul(qe,dt)|0,se=se+Math.imul(Ke,Ve)|0,ee=ee+Math.imul(Ke,dt)|0,ne=ne+Math.imul(Se,mt)|0,se=se+Math.imul(Se,gt)|0,se=se+Math.imul(Be,mt)|0,ee=ee+Math.imul(Be,gt)|0,ne=ne+Math.imul(Te,ht)|0,se=se+Math.imul(Te,_t)|0,se=se+Math.imul(De,ht)|0,ee=ee+Math.imul(De,_t)|0,ne=ne+Math.imul(Ae,St)|0,se=se+Math.imul(Ae,ft)|0,se=se+Math.imul(ge,St)|0,ee=ee+Math.imul(ge,ft)|0,ne=ne+Math.imul(ue,Oe)|0,se=se+Math.imul(ue,$e)|0,se=se+Math.imul(_e,Oe)|0,ee=ee+Math.imul(_e,$e)|0;var Pr=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Pr>>>26)|0,Pr&=67108863,ne=Math.imul(Ze,Pe),se=Math.imul(Ze,je),se=se+Math.imul(nt,Pe)|0,ee=Math.imul(nt,je),ne=ne+Math.imul(Xe,Ve)|0,se=se+Math.imul(Xe,dt)|0,se=se+Math.imul(ze,Ve)|0,ee=ee+Math.imul(ze,dt)|0,ne=ne+Math.imul(qe,mt)|0,se=se+Math.imul(qe,gt)|0,se=se+Math.imul(Ke,mt)|0,ee=ee+Math.imul(Ke,gt)|0,ne=ne+Math.imul(Se,ht)|0,se=se+Math.imul(Se,_t)|0,se=se+Math.imul(Be,ht)|0,ee=ee+Math.imul(Be,_t)|0,ne=ne+Math.imul(Te,St)|0,se=se+Math.imul(Te,ft)|0,se=se+Math.imul(De,St)|0,ee=ee+Math.imul(De,ft)|0,ne=ne+Math.imul(Ae,Oe)|0,se=se+Math.imul(Ae,$e)|0,se=se+Math.imul(ge,Oe)|0,ee=ee+Math.imul(ge,$e)|0,ne=ne+Math.imul(ue,Ue)|0,se=se+Math.imul(ue,We)|0,se=se+Math.imul(_e,Ue)|0,ee=ee+Math.imul(_e,We)|0;var wr=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(wr>>>26)|0,wr&=67108863,ne=Math.imul(ot,Pe),se=Math.imul(ot,je),se=se+Math.imul(vt,Pe)|0,ee=Math.imul(vt,je),ne=ne+Math.imul(Ze,Ve)|0,se=se+Math.imul(Ze,dt)|0,se=se+Math.imul(nt,Ve)|0,ee=ee+Math.imul(nt,dt)|0,ne=ne+Math.imul(Xe,mt)|0,se=se+Math.imul(Xe,gt)|0,se=se+Math.imul(ze,mt)|0,ee=ee+Math.imul(ze,gt)|0,ne=ne+Math.imul(qe,ht)|0,se=se+Math.imul(qe,_t)|0,se=se+Math.imul(Ke,ht)|0,ee=ee+Math.imul(Ke,_t)|0,ne=ne+Math.imul(Se,St)|0,se=se+Math.imul(Se,ft)|0,se=se+Math.imul(Be,St)|0,ee=ee+Math.imul(Be,ft)|0,ne=ne+Math.imul(Te,Oe)|0,se=se+Math.imul(Te,$e)|0,se=se+Math.imul(De,Oe)|0,ee=ee+Math.imul(De,$e)|0,ne=ne+Math.imul(Ae,Ue)|0,se=se+Math.imul(Ae,We)|0,se=se+Math.imul(ge,Ue)|0,ee=ee+Math.imul(ge,We)|0,ne=ne+Math.imul(ue,tt)|0,se=se+Math.imul(ue,Pt)|0,se=se+Math.imul(_e,tt)|0,ee=ee+Math.imul(_e,Pt)|0;var Er=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Er>>>26)|0,Er&=67108863,ne=Math.imul(lt,Pe),se=Math.imul(lt,je),se=se+Math.imul(kt,Pe)|0,ee=Math.imul(kt,je),ne=ne+Math.imul(ot,Ve)|0,se=se+Math.imul(ot,dt)|0,se=se+Math.imul(vt,Ve)|0,ee=ee+Math.imul(vt,dt)|0,ne=ne+Math.imul(Ze,mt)|0,se=se+Math.imul(Ze,gt)|0,se=se+Math.imul(nt,mt)|0,ee=ee+Math.imul(nt,gt)|0,ne=ne+Math.imul(Xe,ht)|0,se=se+Math.imul(Xe,_t)|0,se=se+Math.imul(ze,ht)|0,ee=ee+Math.imul(ze,_t)|0,ne=ne+Math.imul(qe,St)|0,se=se+Math.imul(qe,ft)|0,se=se+Math.imul(Ke,St)|0,ee=ee+Math.imul(Ke,ft)|0,ne=ne+Math.imul(Se,Oe)|0,se=se+Math.imul(Se,$e)|0,se=se+Math.imul(Be,Oe)|0,ee=ee+Math.imul(Be,$e)|0,ne=ne+Math.imul(Te,Ue)|0,se=se+Math.imul(Te,We)|0,se=se+Math.imul(De,Ue)|0,ee=ee+Math.imul(De,We)|0,ne=ne+Math.imul(Ae,tt)|0,se=se+Math.imul(Ae,Pt)|0,se=se+Math.imul(ge,tt)|0,ee=ee+Math.imul(ge,Pt)|0,ne=ne+Math.imul(ue,Rt)|0,se=se+Math.imul(ue,Dt)|0,se=se+Math.imul(_e,Rt)|0,ee=ee+Math.imul(_e,Dt)|0;var $r=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+($r>>>26)|0,$r&=67108863,ne=Math.imul(Me,Pe),se=Math.imul(Me,je),se=se+Math.imul(Ce,Pe)|0,ee=Math.imul(Ce,je),ne=ne+Math.imul(lt,Ve)|0,se=se+Math.imul(lt,dt)|0,se=se+Math.imul(kt,Ve)|0,ee=ee+Math.imul(kt,dt)|0,ne=ne+Math.imul(ot,mt)|0,se=se+Math.imul(ot,gt)|0,se=se+Math.imul(vt,mt)|0,ee=ee+Math.imul(vt,gt)|0,ne=ne+Math.imul(Ze,ht)|0,se=se+Math.imul(Ze,_t)|0,se=se+Math.imul(nt,ht)|0,ee=ee+Math.imul(nt,_t)|0,ne=ne+Math.imul(Xe,St)|0,se=se+Math.imul(Xe,ft)|0,se=se+Math.imul(ze,St)|0,ee=ee+Math.imul(ze,ft)|0,ne=ne+Math.imul(qe,Oe)|0,se=se+Math.imul(qe,$e)|0,se=se+Math.imul(Ke,Oe)|0,ee=ee+Math.imul(Ke,$e)|0,ne=ne+Math.imul(Se,Ue)|0,se=se+Math.imul(Se,We)|0,se=se+Math.imul(Be,Ue)|0,ee=ee+Math.imul(Be,We)|0,ne=ne+Math.imul(Te,tt)|0,se=se+Math.imul(Te,Pt)|0,se=se+Math.imul(De,tt)|0,ee=ee+Math.imul(De,Pt)|0,ne=ne+Math.imul(Ae,Rt)|0,se=se+Math.imul(Ae,Dt)|0,se=se+Math.imul(ge,Rt)|0,ee=ee+Math.imul(ge,Dt)|0,ne=ne+Math.imul(ue,It)|0,se=se+Math.imul(ue,Wt)|0,se=se+Math.imul(_e,It)|0,ee=ee+Math.imul(_e,Wt)|0;var _r=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(_r>>>26)|0,_r&=67108863,ne=Math.imul(Me,Ve),se=Math.imul(Me,dt),se=se+Math.imul(Ce,Ve)|0,ee=Math.imul(Ce,dt),ne=ne+Math.imul(lt,mt)|0,se=se+Math.imul(lt,gt)|0,se=se+Math.imul(kt,mt)|0,ee=ee+Math.imul(kt,gt)|0,ne=ne+Math.imul(ot,ht)|0,se=se+Math.imul(ot,_t)|0,se=se+Math.imul(vt,ht)|0,ee=ee+Math.imul(vt,_t)|0,ne=ne+Math.imul(Ze,St)|0,se=se+Math.imul(Ze,ft)|0,se=se+Math.imul(nt,St)|0,ee=ee+Math.imul(nt,ft)|0,ne=ne+Math.imul(Xe,Oe)|0,se=se+Math.imul(Xe,$e)|0,se=se+Math.imul(ze,Oe)|0,ee=ee+Math.imul(ze,$e)|0,ne=ne+Math.imul(qe,Ue)|0,se=se+Math.imul(qe,We)|0,se=se+Math.imul(Ke,Ue)|0,ee=ee+Math.imul(Ke,We)|0,ne=ne+Math.imul(Se,tt)|0,se=se+Math.imul(Se,Pt)|0,se=se+Math.imul(Be,tt)|0,ee=ee+Math.imul(Be,Pt)|0,ne=ne+Math.imul(Te,Rt)|0,se=se+Math.imul(Te,Dt)|0,se=se+Math.imul(De,Rt)|0,ee=ee+Math.imul(De,Dt)|0,ne=ne+Math.imul(Ae,It)|0,se=se+Math.imul(Ae,Wt)|0,se=se+Math.imul(ge,It)|0,ee=ee+Math.imul(ge,Wt)|0;var Jt=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Jt>>>26)|0,Jt&=67108863,ne=Math.imul(Me,mt),se=Math.imul(Me,gt),se=se+Math.imul(Ce,mt)|0,ee=Math.imul(Ce,gt),ne=ne+Math.imul(lt,ht)|0,se=se+Math.imul(lt,_t)|0,se=se+Math.imul(kt,ht)|0,ee=ee+Math.imul(kt,_t)|0,ne=ne+Math.imul(ot,St)|0,se=se+Math.imul(ot,ft)|0,se=se+Math.imul(vt,St)|0,ee=ee+Math.imul(vt,ft)|0,ne=ne+Math.imul(Ze,Oe)|0,se=se+Math.imul(Ze,$e)|0,se=se+Math.imul(nt,Oe)|0,ee=ee+Math.imul(nt,$e)|0,ne=ne+Math.imul(Xe,Ue)|0,se=se+Math.imul(Xe,We)|0,se=se+Math.imul(ze,Ue)|0,ee=ee+Math.imul(ze,We)|0,ne=ne+Math.imul(qe,tt)|0,se=se+Math.imul(qe,Pt)|0,se=se+Math.imul(Ke,tt)|0,ee=ee+Math.imul(Ke,Pt)|0,ne=ne+Math.imul(Se,Rt)|0,se=se+Math.imul(Se,Dt)|0,se=se+Math.imul(Be,Rt)|0,ee=ee+Math.imul(Be,Dt)|0,ne=ne+Math.imul(Te,It)|0,se=se+Math.imul(Te,Wt)|0,se=se+Math.imul(De,It)|0,ee=ee+Math.imul(De,Wt)|0;var Or=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Or>>>26)|0,Or&=67108863,ne=Math.imul(Me,ht),se=Math.imul(Me,_t),se=se+Math.imul(Ce,ht)|0,ee=Math.imul(Ce,_t),ne=ne+Math.imul(lt,St)|0,se=se+Math.imul(lt,ft)|0,se=se+Math.imul(kt,St)|0,ee=ee+Math.imul(kt,ft)|0,ne=ne+Math.imul(ot,Oe)|0,se=se+Math.imul(ot,$e)|0,se=se+Math.imul(vt,Oe)|0,ee=ee+Math.imul(vt,$e)|0,ne=ne+Math.imul(Ze,Ue)|0,se=se+Math.imul(Ze,We)|0,se=se+Math.imul(nt,Ue)|0,ee=ee+Math.imul(nt,We)|0,ne=ne+Math.imul(Xe,tt)|0,se=se+Math.imul(Xe,Pt)|0,se=se+Math.imul(ze,tt)|0,ee=ee+Math.imul(ze,Pt)|0,ne=ne+Math.imul(qe,Rt)|0,se=se+Math.imul(qe,Dt)|0,se=se+Math.imul(Ke,Rt)|0,ee=ee+Math.imul(Ke,Dt)|0,ne=ne+Math.imul(Se,It)|0,se=se+Math.imul(Se,Wt)|0,se=se+Math.imul(Be,It)|0,ee=ee+Math.imul(Be,Wt)|0;var Dr=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Dr>>>26)|0,Dr&=67108863,ne=Math.imul(Me,St),se=Math.imul(Me,ft),se=se+Math.imul(Ce,St)|0,ee=Math.imul(Ce,ft),ne=ne+Math.imul(lt,Oe)|0,se=se+Math.imul(lt,$e)|0,se=se+Math.imul(kt,Oe)|0,ee=ee+Math.imul(kt,$e)|0,ne=ne+Math.imul(ot,Ue)|0,se=se+Math.imul(ot,We)|0,se=se+Math.imul(vt,Ue)|0,ee=ee+Math.imul(vt,We)|0,ne=ne+Math.imul(Ze,tt)|0,se=se+Math.imul(Ze,Pt)|0,se=se+Math.imul(nt,tt)|0,ee=ee+Math.imul(nt,Pt)|0,ne=ne+Math.imul(Xe,Rt)|0,se=se+Math.imul(Xe,Dt)|0,se=se+Math.imul(ze,Rt)|0,ee=ee+Math.imul(ze,Dt)|0,ne=ne+Math.imul(qe,It)|0,se=se+Math.imul(qe,Wt)|0,se=se+Math.imul(Ke,It)|0,ee=ee+Math.imul(Ke,Wt)|0;var br=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(br>>>26)|0,br&=67108863,ne=Math.imul(Me,Oe),se=Math.imul(Me,$e),se=se+Math.imul(Ce,Oe)|0,ee=Math.imul(Ce,$e),ne=ne+Math.imul(lt,Ue)|0,se=se+Math.imul(lt,We)|0,se=se+Math.imul(kt,Ue)|0,ee=ee+Math.imul(kt,We)|0,ne=ne+Math.imul(ot,tt)|0,se=se+Math.imul(ot,Pt)|0,se=se+Math.imul(vt,tt)|0,ee=ee+Math.imul(vt,Pt)|0,ne=ne+Math.imul(Ze,Rt)|0,se=se+Math.imul(Ze,Dt)|0,se=se+Math.imul(nt,Rt)|0,ee=ee+Math.imul(nt,Dt)|0,ne=ne+Math.imul(Xe,It)|0,se=se+Math.imul(Xe,Wt)|0,se=se+Math.imul(ze,It)|0,ee=ee+Math.imul(ze,Wt)|0;var Sr=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Sr>>>26)|0,Sr&=67108863,ne=Math.imul(Me,Ue),se=Math.imul(Me,We),se=se+Math.imul(Ce,Ue)|0,ee=Math.imul(Ce,We),ne=ne+Math.imul(lt,tt)|0,se=se+Math.imul(lt,Pt)|0,se=se+Math.imul(kt,tt)|0,ee=ee+Math.imul(kt,Pt)|0,ne=ne+Math.imul(ot,Rt)|0,se=se+Math.imul(ot,Dt)|0,se=se+Math.imul(vt,Rt)|0,ee=ee+Math.imul(vt,Dt)|0,ne=ne+Math.imul(Ze,It)|0,se=se+Math.imul(Ze,Wt)|0,se=se+Math.imul(nt,It)|0,ee=ee+Math.imul(nt,Wt)|0;var Vr=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Vr>>>26)|0,Vr&=67108863,ne=Math.imul(Me,tt),se=Math.imul(Me,Pt),se=se+Math.imul(Ce,tt)|0,ee=Math.imul(Ce,Pt),ne=ne+Math.imul(lt,Rt)|0,se=se+Math.imul(lt,Dt)|0,se=se+Math.imul(kt,Rt)|0,ee=ee+Math.imul(kt,Dt)|0,ne=ne+Math.imul(ot,It)|0,se=se+Math.imul(ot,Wt)|0,se=se+Math.imul(vt,It)|0,ee=ee+Math.imul(vt,Wt)|0;var Br=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Br>>>26)|0,Br&=67108863,ne=Math.imul(Me,Rt),se=Math.imul(Me,Dt),se=se+Math.imul(Ce,Rt)|0,ee=Math.imul(Ce,Dt),ne=ne+Math.imul(lt,It)|0,se=se+Math.imul(lt,Wt)|0,se=se+Math.imul(kt,It)|0,ee=ee+Math.imul(kt,Wt)|0;var Lr=(te+ne|0)+((se&8191)<<13)|0;te=(ee+(se>>>13)|0)+(Lr>>>26)|0,Lr&=67108863,ne=Math.imul(Me,It),se=Math.imul(Me,Wt),se=se+Math.imul(Ce,It)|0,ee=Math.imul(Ce,Wt);var Gr=(te+ne|0)+((se&8191)<<13)|0;return te=(ee+(se>>>13)|0)+(Gr>>>26)|0,Gr&=67108863,Y[0]=jt,Y[1]=Ft,Y[2]=Kr,Y[3]=Mr,Y[4]=Cr,Y[5]=Pr,Y[6]=wr,Y[7]=Er,Y[8]=$r,Y[9]=_r,Y[10]=Jt,Y[11]=Or,Y[12]=Dr,Y[13]=br,Y[14]=Sr,Y[15]=Vr,Y[16]=Br,Y[17]=Lr,Y[18]=Gr,te!==0&&(Y[19]=te,j.length++),j};Math.imul||(U=F);function q(he,ae,Q){Q.negative=ae.negative^he.negative,Q.length=he.length+ae.length;for(var j=0,z=0,re=0;re<Q.length-1;re++){var Y=z;z=0;for(var te=j&67108863,ne=Math.min(re,ae.length-1),se=Math.max(0,re-he.length+1);se<=ne;se++){var ee=re-se,Z=he.words[ee]|0,ue=ae.words[se]|0,_e=Z*ue,Re=_e&67108863;Y=Y+(_e/67108864|0)|0,Re=Re+te|0,te=Re&67108863,Y=Y+(Re>>>26)|0,z+=Y>>>26,Y&=67108863}Q.words[re]=te,j=Y,Y=z}return j!==0?Q.words[re]=j:Q.length--,Q.strip()}function J(he,ae,Q){var j=new ie;return j.mulp(he,ae,Q)}w.prototype.mulTo=function(ae,Q){var j,z=this.length+ae.length;return this.length===10&&ae.length===10?j=U(this,ae,Q):z<63?j=F(this,ae,Q):z<1024?j=q(this,ae,Q):j=J(this,ae,Q),j};function ie(he,ae){this.x=he,this.y=ae}ie.prototype.makeRBT=function(ae){for(var Q=new Array(ae),j=w.prototype._countBits(ae)-1,z=0;z<ae;z++)Q[z]=this.revBin(z,j,ae);return Q},ie.prototype.revBin=function(ae,Q,j){if(ae===0||ae===j-1)return ae;for(var z=0,re=0;re<Q;re++)z|=(ae&1)<<Q-re-1,ae>>=1;return z},ie.prototype.permute=function(ae,Q,j,z,re,Y){for(var te=0;te<Y;te++)z[te]=Q[ae[te]],re[te]=j[ae[te]]},ie.prototype.transform=function(ae,Q,j,z,re,Y){this.permute(Y,ae,Q,j,z,re);for(var te=1;te<re;te<<=1)for(var ne=te<<1,se=Math.cos(2*Math.PI/ne),ee=Math.sin(2*Math.PI/ne),Z=0;Z<re;Z+=ne)for(var ue=se,_e=ee,Re=0;Re<te;Re++){var Ae=j[Z+Re],ge=z[Z+Re],be=j[Z+Re+te],Te=z[Z+Re+te],De=ue*be-_e*Te;Te=ue*Te+_e*be,be=De,j[Z+Re]=Ae+be,z[Z+Re]=ge+Te,j[Z+Re+te]=Ae-be,z[Z+Re+te]=ge-Te,Re!==ne&&(De=se*ue-ee*_e,_e=se*_e+ee*ue,ue=De)}},ie.prototype.guessLen13b=function(ae,Q){var j=Math.max(Q,ae)|1,z=j&1,re=0;for(j=j/2|0;j;j=j>>>1)re++;return 1<<re+1+z},ie.prototype.conjugate=function(ae,Q,j){if(!(j<=1))for(var z=0;z<j/2;z++){var re=ae[z];ae[z]=ae[j-z-1],ae[j-z-1]=re,re=Q[z],Q[z]=-Q[j-z-1],Q[j-z-1]=-re}},ie.prototype.normalize13b=function(ae,Q){for(var j=0,z=0;z<Q/2;z++){var re=Math.round(ae[2*z+1]/Q)*8192+Math.round(ae[2*z]/Q)+j;ae[z]=re&67108863,re<67108864?j=0:j=re/67108864|0}return ae},ie.prototype.convert13b=function(ae,Q,j,z){for(var re=0,Y=0;Y<Q;Y++)re=re+(ae[Y]|0),j[2*Y]=re&8191,re=re>>>13,j[2*Y+1]=re&8191,re=re>>>13;for(Y=2*Q;Y<z;++Y)j[Y]=0;v(re===0),v((re&-8192)===0)},ie.prototype.stub=function(ae){for(var Q=new Array(ae),j=0;j<ae;j++)Q[j]=0;return Q},ie.prototype.mulp=function(ae,Q,j){var z=2*this.guessLen13b(ae.length,Q.length),re=this.makeRBT(z),Y=this.stub(z),te=new Array(z),ne=new Array(z),se=new Array(z),ee=new Array(z),Z=new Array(z),ue=new Array(z),_e=j.words;_e.length=z,this.convert13b(ae.words,ae.length,te,z),this.convert13b(Q.words,Q.length,ee,z),this.transform(te,Y,ne,se,z,re),this.transform(ee,Y,Z,ue,z,re);for(var Re=0;Re<z;Re++){var Ae=ne[Re]*Z[Re]-se[Re]*ue[Re];se[Re]=ne[Re]*ue[Re]+se[Re]*Z[Re],ne[Re]=Ae}return this.conjugate(ne,se,z),this.transform(ne,se,_e,Y,z,re),this.conjugate(_e,Y,z),this.normalize13b(_e,z),j.negative=ae.negative^Q.negative,j.length=ae.length+Q.length,j.strip()},w.prototype.mul=function(ae){var Q=new w(null);return Q.words=new Array(this.length+ae.length),this.mulTo(ae,Q)},w.prototype.mulf=function(ae){var Q=new w(null);return Q.words=new Array(this.length+ae.length),J(this,ae,Q)},w.prototype.imul=function(ae){return this.clone().mulTo(ae,this)},w.prototype.imuln=function(ae){v(typeof ae=="number"),v(ae<67108864);for(var Q=0,j=0;j<this.length;j++){var z=(this.words[j]|0)*ae,re=(z&67108863)+(Q&67108863);Q>>=26,Q+=z/67108864|0,Q+=re>>>26,this.words[j]=re&67108863}return Q!==0&&(this.words[j]=Q,this.length++),this.length=ae===0?1:this.length,this},w.prototype.muln=function(ae){return this.clone().imuln(ae)},w.prototype.sqr=function(){return this.mul(this)},w.prototype.isqr=function(){return this.imul(this.clone())},w.prototype.pow=function(ae){var Q=B(ae);if(Q.length===0)return new w(1);for(var j=this,z=0;z<Q.length&&Q[z]===0;z++,j=j.sqr());if(++z<Q.length)for(var re=j.sqr();z<Q.length;z++,re=re.sqr())Q[z]!==0&&(j=j.mul(re));return j},w.prototype.iushln=function(ae){v(typeof ae=="number"&&ae>=0);var Q=ae%26,j=(ae-Q)/26,z=67108863>>>26-Q<<26-Q,re;if(Q!==0){var Y=0;for(re=0;re<this.length;re++){var te=this.words[re]&z,ne=(this.words[re]|0)-te<<Q;this.words[re]=ne|Y,Y=te>>>26-Q}Y&&(this.words[re]=Y,this.length++)}if(j!==0){for(re=this.length-1;re>=0;re--)this.words[re+j]=this.words[re];for(re=0;re<j;re++)this.words[re]=0;this.length+=j}return this.strip()},w.prototype.ishln=function(ae){return v(this.negative===0),this.iushln(ae)},w.prototype.iushrn=function(ae,Q,j){v(typeof ae=="number"&&ae>=0);var z;Q?z=(Q-Q%26)/26:z=0;var re=ae%26,Y=Math.min((ae-re)/26,this.length),te=67108863^67108863>>>re<<re,ne=j;if(z-=Y,z=Math.max(0,z),ne){for(var se=0;se<Y;se++)ne.words[se]=this.words[se];ne.length=Y}if(Y!==0)if(this.length>Y)for(this.length-=Y,se=0;se<this.length;se++)this.words[se]=this.words[se+Y];else this.words[0]=0,this.length=1;var ee=0;for(se=this.length-1;se>=0&&(ee!==0||se>=z);se--){var Z=this.words[se]|0;this.words[se]=ee<<26-re|Z>>>re,ee=Z&te}return ne&&ee!==0&&(ne.words[ne.length++]=ee),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},w.prototype.ishrn=function(ae,Q,j){return v(this.negative===0),this.iushrn(ae,Q,j)},w.prototype.shln=function(ae){return this.clone().ishln(ae)},w.prototype.ushln=function(ae){return this.clone().iushln(ae)},w.prototype.shrn=function(ae){return this.clone().ishrn(ae)},w.prototype.ushrn=function(ae){return this.clone().iushrn(ae)},w.prototype.testn=function(ae){v(typeof ae=="number"&&ae>=0);var Q=ae%26,j=(ae-Q)/26,z=1<<Q;if(this.length<=j)return!1;var re=this.words[j];return!!(re&z)},w.prototype.imaskn=function(ae){v(typeof ae=="number"&&ae>=0);var Q=ae%26,j=(ae-Q)/26;if(v(this.negative===0,"imaskn works only with positive numbers"),this.length<=j)return this;if(Q!==0&&j++,this.length=Math.min(j,this.length),Q!==0){var z=67108863^67108863>>>Q<<Q;this.words[this.length-1]&=z}return this.strip()},w.prototype.maskn=function(ae){return this.clone().imaskn(ae)},w.prototype.iaddn=function(ae){return v(typeof ae=="number"),v(ae<67108864),ae<0?this.isubn(-ae):this.negative!==0?this.length===1&&(this.words[0]|0)<ae?(this.words[0]=ae-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(ae),this.negative=1,this):this._iaddn(ae)},w.prototype._iaddn=function(ae){this.words[0]+=ae;for(var Q=0;Q<this.length&&this.words[Q]>=67108864;Q++)this.words[Q]-=67108864,Q===this.length-1?this.words[Q+1]=1:this.words[Q+1]++;return this.length=Math.max(this.length,Q+1),this},w.prototype.isubn=function(ae){if(v(typeof ae=="number"),v(ae<67108864),ae<0)return this.iaddn(-ae);if(this.negative!==0)return this.negative=0,this.iaddn(ae),this.negative=1,this;if(this.words[0]-=ae,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var Q=0;Q<this.length&&this.words[Q]<0;Q++)this.words[Q]+=67108864,this.words[Q+1]-=1;return this.strip()},w.prototype.addn=function(ae){return this.clone().iaddn(ae)},w.prototype.subn=function(ae){return this.clone().isubn(ae)},w.prototype.iabs=function(){return this.negative=0,this},w.prototype.abs=function(){return this.clone().iabs()},w.prototype._ishlnsubmul=function(ae,Q,j){var z=ae.length+j,re;this._expand(z);var Y,te=0;for(re=0;re<ae.length;re++){Y=(this.words[re+j]|0)+te;var ne=(ae.words[re]|0)*Q;Y-=ne&67108863,te=(Y>>26)-(ne/67108864|0),this.words[re+j]=Y&67108863}for(;re<this.length-j;re++)Y=(this.words[re+j]|0)+te,te=Y>>26,this.words[re+j]=Y&67108863;if(te===0)return this.strip();for(v(te===-1),te=0,re=0;re<this.length;re++)Y=-(this.words[re]|0)+te,te=Y>>26,this.words[re]=Y&67108863;return this.negative=1,this.strip()},w.prototype._wordDiv=function(ae,Q){var j=this.length-ae.length,z=this.clone(),re=ae,Y=re.words[re.length-1]|0,te=this._countBits(Y);j=26-te,j!==0&&(re=re.ushln(j),z.iushln(j),Y=re.words[re.length-1]|0);var ne=z.length-re.length,se;if(Q!=="mod"){se=new w(null),se.length=ne+1,se.words=new Array(se.length);for(var ee=0;ee<se.length;ee++)se.words[ee]=0}var Z=z.clone()._ishlnsubmul(re,1,ne);Z.negative===0&&(z=Z,se&&(se.words[ne]=1));for(var ue=ne-1;ue>=0;ue--){var _e=(z.words[re.length+ue]|0)*67108864+(z.words[re.length+ue-1]|0);for(_e=Math.min(_e/Y|0,67108863),z._ishlnsubmul(re,_e,ue);z.negative!==0;)_e--,z.negative=0,z._ishlnsubmul(re,1,ue),z.isZero()||(z.negative^=1);se&&(se.words[ue]=_e)}return se&&se.strip(),z.strip(),Q!=="div"&&j!==0&&z.iushrn(j),{div:se||null,mod:z}},w.prototype.divmod=function(ae,Q,j){if(v(!ae.isZero()),this.isZero())return{div:new w(0),mod:new w(0)};var z,re,Y;return this.negative!==0&&ae.negative===0?(Y=this.neg().divmod(ae,Q),Q!=="mod"&&(z=Y.div.neg()),Q!=="div"&&(re=Y.mod.neg(),j&&re.negative!==0&&re.iadd(ae)),{div:z,mod:re}):this.negative===0&&ae.negative!==0?(Y=this.divmod(ae.neg(),Q),Q!=="mod"&&(z=Y.div.neg()),{div:z,mod:Y.mod}):(this.negative&ae.negative)!==0?(Y=this.neg().divmod(ae.neg(),Q),Q!=="div"&&(re=Y.mod.neg(),j&&re.negative!==0&&re.isub(ae)),{div:Y.div,mod:re}):ae.length>this.length||this.cmp(ae)<0?{div:new w(0),mod:this}:ae.length===1?Q==="div"?{div:this.divn(ae.words[0]),mod:null}:Q==="mod"?{div:null,mod:new w(this.modn(ae.words[0]))}:{div:this.divn(ae.words[0]),mod:new w(this.modn(ae.words[0]))}:this._wordDiv(ae,Q)},w.prototype.div=function(ae){return this.divmod(ae,"div",!1).div},w.prototype.mod=function(ae){return this.divmod(ae,"mod",!1).mod},w.prototype.umod=function(ae){return this.divmod(ae,"mod",!0).mod},w.prototype.divRound=function(ae){var Q=this.divmod(ae);if(Q.mod.isZero())return Q.div;var j=Q.div.negative!==0?Q.mod.isub(ae):Q.mod,z=ae.ushrn(1),re=ae.andln(1),Y=j.cmp(z);return Y<0||re===1&&Y===0?Q.div:Q.div.negative!==0?Q.div.isubn(1):Q.div.iaddn(1)},w.prototype.modn=function(ae){v(ae<=67108863);for(var Q=(1<<26)%ae,j=0,z=this.length-1;z>=0;z--)j=(Q*j+(this.words[z]|0))%ae;return j},w.prototype.idivn=function(ae){v(ae<=67108863);for(var Q=0,j=this.length-1;j>=0;j--){var z=(this.words[j]|0)+Q*67108864;this.words[j]=z/ae|0,Q=z%ae}return this.strip()},w.prototype.divn=function(ae){return this.clone().idivn(ae)},w.prototype.egcd=function(ae){v(ae.negative===0),v(!ae.isZero());var Q=this,j=ae.clone();Q.negative!==0?Q=Q.umod(ae):Q=Q.clone();for(var z=new w(1),re=new w(0),Y=new w(0),te=new w(1),ne=0;Q.isEven()&&j.isEven();)Q.iushrn(1),j.iushrn(1),++ne;for(var se=j.clone(),ee=Q.clone();!Q.isZero();){for(var Z=0,ue=1;(Q.words[0]&ue)===0&&Z<26;++Z,ue<<=1);if(Z>0)for(Q.iushrn(Z);Z-- >0;)(z.isOdd()||re.isOdd())&&(z.iadd(se),re.isub(ee)),z.iushrn(1),re.iushrn(1);for(var _e=0,Re=1;(j.words[0]&Re)===0&&_e<26;++_e,Re<<=1);if(_e>0)for(j.iushrn(_e);_e-- >0;)(Y.isOdd()||te.isOdd())&&(Y.iadd(se),te.isub(ee)),Y.iushrn(1),te.iushrn(1);Q.cmp(j)>=0?(Q.isub(j),z.isub(Y),re.isub(te)):(j.isub(Q),Y.isub(z),te.isub(re))}return{a:Y,b:te,gcd:j.iushln(ne)}},w.prototype._invmp=function(ae){v(ae.negative===0),v(!ae.isZero());var Q=this,j=ae.clone();Q.negative!==0?Q=Q.umod(ae):Q=Q.clone();for(var z=new w(1),re=new w(0),Y=j.clone();Q.cmpn(1)>0&&j.cmpn(1)>0;){for(var te=0,ne=1;(Q.words[0]&ne)===0&&te<26;++te,ne<<=1);if(te>0)for(Q.iushrn(te);te-- >0;)z.isOdd()&&z.iadd(Y),z.iushrn(1);for(var se=0,ee=1;(j.words[0]&ee)===0&&se<26;++se,ee<<=1);if(se>0)for(j.iushrn(se);se-- >0;)re.isOdd()&&re.iadd(Y),re.iushrn(1);Q.cmp(j)>=0?(Q.isub(j),z.isub(re)):(j.isub(Q),re.isub(z))}var Z;return Q.cmpn(1)===0?Z=z:Z=re,Z.cmpn(0)<0&&Z.iadd(ae),Z},w.prototype.gcd=function(ae){if(this.isZero())return ae.abs();if(ae.isZero())return this.abs();var Q=this.clone(),j=ae.clone();Q.negative=0,j.negative=0;for(var z=0;Q.isEven()&&j.isEven();z++)Q.iushrn(1),j.iushrn(1);do{for(;Q.isEven();)Q.iushrn(1);for(;j.isEven();)j.iushrn(1);var re=Q.cmp(j);if(re<0){var Y=Q;Q=j,j=Y}else if(re===0||j.cmpn(1)===0)break;Q.isub(j)}while(!0);return j.iushln(z)},w.prototype.invm=function(ae){return this.egcd(ae).a.umod(ae)},w.prototype.isEven=function(){return(this.words[0]&1)===0},w.prototype.isOdd=function(){return(this.words[0]&1)===1},w.prototype.andln=function(ae){return this.words[0]&ae},w.prototype.bincn=function(ae){v(typeof ae=="number");var Q=ae%26,j=(ae-Q)/26,z=1<<Q;if(this.length<=j)return this._expand(j+1),this.words[j]|=z,this;for(var re=z,Y=j;re!==0&&Y<this.length;Y++){var te=this.words[Y]|0;te+=re,re=te>>>26,te&=67108863,this.words[Y]=te}return re!==0&&(this.words[Y]=re,this.length++),this},w.prototype.isZero=function(){return this.length===1&&this.words[0]===0},w.prototype.cmpn=function(ae){var Q=ae<0;if(this.negative!==0&&!Q)return-1;if(this.negative===0&&Q)return 1;this.strip();var j;if(this.length>1)j=1;else{Q&&(ae=-ae),v(ae<=67108863,"Number is too big");var z=this.words[0]|0;j=z===ae?0:z<ae?-1:1}return this.negative!==0?-j|0:j},w.prototype.cmp=function(ae){if(this.negative!==0&&ae.negative===0)return-1;if(this.negative===0&&ae.negative!==0)return 1;var Q=this.ucmp(ae);return this.negative!==0?-Q|0:Q},w.prototype.ucmp=function(ae){if(this.length>ae.length)return 1;if(this.length<ae.length)return-1;for(var Q=0,j=this.length-1;j>=0;j--){var z=this.words[j]|0,re=ae.words[j]|0;if(z!==re){z<re?Q=-1:z>re&&(Q=1);break}}return Q},w.prototype.gtn=function(ae){return this.cmpn(ae)===1},w.prototype.gt=function(ae){return this.cmp(ae)===1},w.prototype.gten=function(ae){return this.cmpn(ae)>=0},w.prototype.gte=function(ae){return this.cmp(ae)>=0},w.prototype.ltn=function(ae){return this.cmpn(ae)===-1},w.prototype.lt=function(ae){return this.cmp(ae)===-1},w.prototype.lten=function(ae){return this.cmpn(ae)<=0},w.prototype.lte=function(ae){return this.cmp(ae)<=0},w.prototype.eqn=function(ae){return this.cmpn(ae)===0},w.prototype.eq=function(ae){return this.cmp(ae)===0},w.red=function(ae){return new pe(ae)},w.prototype.toRed=function(ae){return v(!this.red,"Already a number in reduction context"),v(this.negative===0,"red works only with positives"),ae.convertTo(this)._forceRed(ae)},w.prototype.fromRed=function(){return v(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},w.prototype._forceRed=function(ae){return this.red=ae,this},w.prototype.forceRed=function(ae){return v(!this.red,"Already a number in reduction context"),this._forceRed(ae)},w.prototype.redAdd=function(ae){return v(this.red,"redAdd works only with red numbers"),this.red.add(this,ae)},w.prototype.redIAdd=function(ae){return v(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,ae)},w.prototype.redSub=function(ae){return v(this.red,"redSub works only with red numbers"),this.red.sub(this,ae)},w.prototype.redISub=function(ae){return v(this.red,"redISub works only with red numbers"),this.red.isub(this,ae)},w.prototype.redShl=function(ae){return v(this.red,"redShl works only with red numbers"),this.red.shl(this,ae)},w.prototype.redMul=function(ae){return v(this.red,"redMul works only with red numbers"),this.red._verify2(this,ae),this.red.mul(this,ae)},w.prototype.redIMul=function(ae){return v(this.red,"redMul works only with red numbers"),this.red._verify2(this,ae),this.red.imul(this,ae)},w.prototype.redSqr=function(){return v(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},w.prototype.redISqr=function(){return v(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},w.prototype.redSqrt=function(){return v(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},w.prototype.redInvm=function(){return v(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},w.prototype.redNeg=function(){return v(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},w.prototype.redPow=function(ae){return v(this.red&&!ae.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,ae)};var oe={k256:null,p224:null,p192:null,p25519:null};function le(he,ae){this.name=he,this.p=new w(ae,16),this.n=this.p.bitLength(),this.k=new w(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}le.prototype._tmp=function(){var ae=new w(null);return ae.words=new Array(Math.ceil(this.n/13)),ae},le.prototype.ireduce=function(ae){var Q=ae,j;do this.split(Q,this.tmp),Q=this.imulK(Q),Q=Q.iadd(this.tmp),j=Q.bitLength();while(j>this.n);var z=j<this.n?-1:Q.ucmp(this.p);return z===0?(Q.words[0]=0,Q.length=1):z>0?Q.isub(this.p):Q.strip!==void 0?Q.strip():Q._strip(),Q},le.prototype.split=function(ae,Q){ae.iushrn(this.n,0,Q)},le.prototype.imulK=function(ae){return ae.imul(this.k)};function de(){le.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}b(de,le),de.prototype.split=function(ae,Q){for(var j=4194303,z=Math.min(ae.length,9),re=0;re<z;re++)Q.words[re]=ae.words[re];if(Q.length=z,ae.length<=9){ae.words[0]=0,ae.length=1;return}var Y=ae.words[9];for(Q.words[Q.length++]=Y&j,re=10;re<ae.length;re++){var te=ae.words[re]|0;ae.words[re-10]=(te&j)<<4|Y>>>22,Y=te}Y>>>=22,ae.words[re-10]=Y,Y===0&&ae.length>10?ae.length-=10:ae.length-=9},de.prototype.imulK=function(ae){ae.words[ae.length]=0,ae.words[ae.length+1]=0,ae.length+=2;for(var Q=0,j=0;j<ae.length;j++){var z=ae.words[j]|0;Q+=z*977,ae.words[j]=Q&67108863,Q=z*64+(Q/67108864|0)}return ae.words[ae.length-1]===0&&(ae.length--,ae.words[ae.length-1]===0&&ae.length--),ae};function fe(){le.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}b(fe,le);function ye(){le.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}b(ye,le);function we(){le.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}b(we,le),we.prototype.imulK=function(ae){for(var Q=0,j=0;j<ae.length;j++){var z=(ae.words[j]|0)*19+Q,re=z&67108863;z>>>=26,ae.words[j]=re,Q=z}return Q!==0&&(ae.words[ae.length++]=Q),ae},w._prime=function(ae){if(oe[ae])return oe[ae];var Q;if(ae==="k256")Q=new de;else if(ae==="p224")Q=new fe;else if(ae==="p192")Q=new ye;else if(ae==="p25519")Q=new we;else throw new Error("Unknown prime "+ae);return oe[ae]=Q,Q};function pe(he){if(typeof he=="string"){var ae=w._prime(he);this.m=ae.p,this.prime=ae}else v(he.gtn(1),"modulus must be greater than 1"),this.m=he,this.prime=null}pe.prototype._verify1=function(ae){v(ae.negative===0,"red works only with positives"),v(ae.red,"red works only with red numbers")},pe.prototype._verify2=function(ae,Q){v((ae.negative|Q.negative)===0,"red works only with positives"),v(ae.red&&ae.red===Q.red,"red works only with red numbers")},pe.prototype.imod=function(ae){return this.prime?this.prime.ireduce(ae)._forceRed(this):ae.umod(this.m)._forceRed(this)},pe.prototype.neg=function(ae){return ae.isZero()?ae.clone():this.m.sub(ae)._forceRed(this)},pe.prototype.add=function(ae,Q){this._verify2(ae,Q);var j=ae.add(Q);return j.cmp(this.m)>=0&&j.isub(this.m),j._forceRed(this)},pe.prototype.iadd=function(ae,Q){this._verify2(ae,Q);var j=ae.iadd(Q);return j.cmp(this.m)>=0&&j.isub(this.m),j},pe.prototype.sub=function(ae,Q){this._verify2(ae,Q);var j=ae.sub(Q);return j.cmpn(0)<0&&j.iadd(this.m),j._forceRed(this)},pe.prototype.isub=function(ae,Q){this._verify2(ae,Q);var j=ae.isub(Q);return j.cmpn(0)<0&&j.iadd(this.m),j},pe.prototype.shl=function(ae,Q){return this._verify1(ae),this.imod(ae.ushln(Q))},pe.prototype.imul=function(ae,Q){return this._verify2(ae,Q),this.imod(ae.imul(Q))},pe.prototype.mul=function(ae,Q){return this._verify2(ae,Q),this.imod(ae.mul(Q))},pe.prototype.isqr=function(ae){return this.imul(ae,ae.clone())},pe.prototype.sqr=function(ae){return this.mul(ae,ae)},pe.prototype.sqrt=function(ae){if(ae.isZero())return ae.clone();var Q=this.m.andln(3);if(v(Q%2===1),Q===3){var j=this.m.add(new w(1)).iushrn(2);return this.pow(ae,j)}for(var z=this.m.subn(1),re=0;!z.isZero()&&z.andln(1)===0;)re++,z.iushrn(1);v(!z.isZero());var Y=new w(1).toRed(this),te=Y.redNeg(),ne=this.m.subn(1).iushrn(1),se=this.m.bitLength();for(se=new w(2*se*se).toRed(this);this.pow(se,ne).cmp(te)!==0;)se.redIAdd(te);for(var ee=this.pow(se,z),Z=this.pow(ae,z.addn(1).iushrn(1)),ue=this.pow(ae,z),_e=re;ue.cmp(Y)!==0;){for(var Re=ue,Ae=0;Re.cmp(Y)!==0;Ae++)Re=Re.redSqr();v(Ae<_e);var ge=this.pow(ee,new w(1).iushln(_e-Ae-1));Z=Z.redMul(ge),ee=ge.redSqr(),ue=ue.redMul(ee),_e=Ae}return Z},pe.prototype.invm=function(ae){var Q=ae._invmp(this.m);return Q.negative!==0?(Q.negative=0,this.imod(Q).redNeg()):this.imod(Q)},pe.prototype.pow=function(ae,Q){if(Q.isZero())return new w(1).toRed(this);if(Q.cmpn(1)===0)return ae.clone();var j=4,z=new Array(1<<j);z[0]=new w(1).toRed(this),z[1]=ae;for(var re=2;re<z.length;re++)z[re]=this.mul(z[re-1],ae);var Y=z[0],te=0,ne=0,se=Q.bitLength()%26;for(se===0&&(se=26),re=Q.length-1;re>=0;re--){for(var ee=Q.words[re],Z=se-1;Z>=0;Z--){var ue=ee>>Z&1;if(Y!==z[0]&&(Y=this.sqr(Y)),ue===0&&te===0){ne=0;continue}te<<=1,te|=ue,ne++,!(ne!==j&&(re!==0||Z!==0))&&(Y=this.mul(Y,z[te]),ne=0,te=0)}se=26}return Y},pe.prototype.convertTo=function(ae){var Q=ae.umod(this.m);return Q===ae?Q.clone():Q},pe.prototype.convertFrom=function(ae){var Q=ae.clone();return Q.red=null,Q},w.mont=function(ae){return new ve(ae)};function ve(he){pe.call(this,he),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new w(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b(ve,pe),ve.prototype.convertTo=function(ae){return this.imod(ae.ushln(this.shift))},ve.prototype.convertFrom=function(ae){var Q=this.imod(ae.mul(this.rinv));return Q.red=null,Q},ve.prototype.imul=function(ae,Q){if(ae.isZero()||Q.isZero())return ae.words[0]=0,ae.length=1,ae;var j=ae.imul(Q),z=j.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),re=j.isub(z).iushrn(this.shift),Y=re;return re.cmp(this.m)>=0?Y=re.isub(this.m):re.cmpn(0)<0&&(Y=re.iadd(this.m)),Y._forceRed(this)},ve.prototype.mul=function(ae,Q){if(ae.isZero()||Q.isZero())return new w(0)._forceRed(this);var j=ae.mul(Q),z=j.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),re=j.isub(z).iushrn(this.shift),Y=re;return re.cmp(this.m)>=0?Y=re.isub(this.m):re.cmpn(0)<0&&(Y=re.iadd(this.m)),Y._forceRed(this)},ve.prototype.invm=function(ae){var Q=this.imod(ae._invmp(this.m).mul(this.r2));return Q._forceRed(this)}})(y,bn$4)})(bn$5)),bn$5.exports}var brorand={exports:{}},hasRequiredBrorand;function requireBrorand(){if(hasRequiredBrorand)return brorand.exports;hasRequiredBrorand=1;var y;brorand.exports=function(b){return y||(y=new u(null)),y.generate(b)};function u(v){this.rand=v}if(brorand.exports.Rand=u,u.prototype.generate=function(b){return this._rand(b)},u.prototype._rand=function(b){if(this.rand.getBytes)return this.rand.getBytes(b);for(var w=new Uint8Array(b),E=0;E<w.length;E++)w[E]=this.rand.getByte();return w},typeof self=="object")self.crypto&&self.crypto.getRandomValues?u.prototype._rand=function(b){var w=new Uint8Array(b);return self.crypto.getRandomValues(w),w}:self.msCrypto&&self.msCrypto.getRandomValues?u.prototype._rand=function(b){var w=new Uint8Array(b);return self.msCrypto.getRandomValues(w),w}:typeof window=="object"&&(u.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var g=requireCryptoBrowserify();if(typeof g.randomBytes!="function")throw new Error("Not supported");u.prototype._rand=function(b){return g.randomBytes(b)}}catch{}return brorand.exports}var mr,hasRequiredMr;function requireMr(){if(hasRequiredMr)return mr;hasRequiredMr=1;var y=requireBn$2(),u=requireBrorand();function g(v){this.rand=v||new u.Rand}return mr=g,g.create=function(b){return new g(b)},g.prototype._randbelow=function(b){var w=b.bitLength(),E=Math.ceil(w/8);do var S=new y(this.rand.generate(E));while(S.cmp(b)>=0);return S},g.prototype._randrange=function(b,w){var E=w.sub(b);return b.add(this._randbelow(E))},g.prototype.test=function(b,w,E){var S=b.bitLength(),A=y.mont(b),$=new y(1).toRed(A);w||(w=Math.max(1,S/48|0));for(var R=b.subn(1),T=0;!R.testn(T);T++);for(var O=b.shrn(T),B=R.toRed(A),F=!0;w>0;w--){var U=this._randrange(new y(2),R);E&&E(U);var q=U.toRed(A).redPow(O);if(!(q.cmp($)===0||q.cmp(B)===0)){for(var J=1;J<T;J++){if(q=q.redSqr(),q.cmp($)===0)return!1;if(q.cmp(B)===0)break}if(J===T)return!1}}return F},g.prototype.getDivisor=function(b,w){var E=b.bitLength(),S=y.mont(b),A=new y(1).toRed(S);w||(w=Math.max(1,E/48|0));for(var $=b.subn(1),R=0;!$.testn(R);R++);for(var T=b.shrn(R),O=$.toRed(S);w>0;w--){var B=this._randrange(new y(2),$),F=b.gcd(B);if(F.cmpn(1)!==0)return F;var U=B.toRed(S).redPow(T);if(!(U.cmp(A)===0||U.cmp(O)===0)){for(var q=1;q<R;q++){if(U=U.redSqr(),U.cmp(A)===0)return U.fromRed().subn(1).gcd(b);if(U.cmp(O)===0)break}if(q===R)return U=U.redSqr(),U.fromRed().subn(1).gcd(b)}}return!1},mr}var generatePrime,hasRequiredGeneratePrime;function requireGeneratePrime(){if(hasRequiredGeneratePrime)return generatePrime;hasRequiredGeneratePrime=1;var y=requireBrowser$d();generatePrime=q,q.simpleSieve=F,q.fermatTest=U;var u=requireBn$2(),g=new u(24),v=requireMr(),b=new v,w=new u(1),E=new u(2),S=new u(5);new u(16),new u(8);var A=new u(10),$=new u(3);new u(7);var R=new u(11),T=new u(4);new u(12);var O=null;function B(){if(O!==null)return O;var J=1048576,ie=[];ie[0]=2;for(var oe=1,le=3;le<J;le+=2){for(var de=Math.ceil(Math.sqrt(le)),fe=0;fe<oe&&ie[fe]<=de&&le%ie[fe]!==0;fe++);oe!==fe&&ie[fe]<=de||(ie[oe++]=le)}return O=ie,ie}function F(J){for(var ie=B(),oe=0;oe<ie.length;oe++)if(J.modn(ie[oe])===0)return J.cmpn(ie[oe])===0;return!0}function U(J){var ie=u.mont(J);return E.toRed(ie).redPow(J.subn(1)).fromRed().cmpn(1)===0}function q(J,ie){if(J<16)return ie===2||ie===5?new u([140,123]):new u([140,39]);ie=new u(ie);for(var oe,le;;){for(oe=new u(y(Math.ceil(J/8)));oe.bitLength()>J;)oe.ishrn(1);if(oe.isEven()&&oe.iadd(w),oe.testn(1)||oe.iadd(E),ie.cmp(E)){if(!ie.cmp(S))for(;oe.mod(A).cmp($);)oe.iadd(T)}else for(;oe.mod(g).cmp(R);)oe.iadd(T);if(le=oe.shrn(1),F(le)&&F(oe)&&U(le)&&U(oe)&&b.test(le)&&b.test(oe))return oe}}return generatePrime}const modp1={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"},require$$1$1={modp1,modp2,modp5,modp14,modp15,modp16,modp17,modp18};var dh,hasRequiredDh;function requireDh(){if(hasRequiredDh)return dh;hasRequiredDh=1;var y=requireBn$2(),u=requireMr(),g=new u,v=new y(24),b=new y(11),w=new y(10),E=new y(3),S=new y(7),A=requireGeneratePrime(),$=requireBrowser$d();dh=F;function R(q,J){return J=J||"utf8",Buffer.isBuffer(q)||(q=new Buffer(q,J)),this._pub=new y(q),this}function T(q,J){return J=J||"utf8",Buffer.isBuffer(q)||(q=new Buffer(q,J)),this._priv=new y(q),this}var O={};function B(q,J){var ie=J.toString("hex"),oe=[ie,q.toString(16)].join("_");if(oe in O)return O[oe];var le=0;if(q.isEven()||!A.simpleSieve||!A.fermatTest(q)||!g.test(q))return le+=1,ie==="02"||ie==="05"?le+=8:le+=4,O[oe]=le,le;g.test(q.shrn(1))||(le+=2);var de;switch(ie){case"02":q.mod(v).cmp(b)&&(le+=8);break;case"05":de=q.mod(w),de.cmp(E)&&de.cmp(S)&&(le+=8);break;default:le+=4}return O[oe]=le,le}function F(q,J,ie){this.setGenerator(J),this.__prime=new y(q),this._prime=y.mont(this.__prime),this._primeLen=q.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,ie?(this.setPublicKey=R,this.setPrivateKey=T):this._primeCode=8}Object.defineProperty(F.prototype,"verifyError",{enumerable:!0,get:function(){return typeof this._primeCode!="number"&&(this._primeCode=B(this.__prime,this.__gen)),this._primeCode}}),F.prototype.generateKeys=function(){return this._priv||(this._priv=new y($(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},F.prototype.computeSecret=function(q){q=new y(q),q=q.toRed(this._prime);var J=q.redPow(this._priv).fromRed(),ie=new Buffer(J.toArray()),oe=this.getPrime();if(ie.length<oe.length){var le=new Buffer(oe.length-ie.length);le.fill(0),ie=Buffer.concat([le,ie])}return ie},F.prototype.getPublicKey=function(J){return U(this._pub,J)},F.prototype.getPrivateKey=function(J){return U(this._priv,J)},F.prototype.getPrime=function(q){return U(this.__prime,q)},F.prototype.getGenerator=function(q){return U(this._gen,q)},F.prototype.setGenerator=function(q,J){return J=J||"utf8",Buffer.isBuffer(q)||(q=new Buffer(q,J)),this.__gen=q,this._gen=new y(q),this};function U(q,J){var ie=new Buffer(q.toArray());return J?ie.toString(J):ie}return dh}var hasRequiredBrowser$6;function requireBrowser$6(){if(hasRequiredBrowser$6)return browser$7;hasRequiredBrowser$6=1;var y=requireGeneratePrime(),u=require$$1$1,g=requireDh();function v(E){var S=new Buffer(u[E].prime,"hex"),A=new Buffer(u[E].gen,"hex");return new g(S,A)}var b={binary:!0,hex:!0,base64:!0};function w(E,S,A,$){return Buffer.isBuffer(S)||b[S]===void 0?w(E,"binary",S,A):(S=S||"binary",$=$||"binary",A=A||new Buffer([2]),Buffer.isBuffer(A)||(A=new Buffer(A,$)),typeof E=="number"?new g(y(E,A),A,!0):(Buffer.isBuffer(E)||(E=new Buffer(E,S)),new g(E,A,!0)))}return browser$7.DiffieHellmanGroup=browser$7.createDiffieHellmanGroup=browser$7.getDiffieHellman=v,browser$7.createDiffieHellman=browser$7.DiffieHellman=w,browser$7}var readableBrowser={exports:{}},isarray,hasRequiredIsarray;function requireIsarray(){if(hasRequiredIsarray)return isarray;hasRequiredIsarray=1;var y={}.toString;return isarray=Array.isArray||function(u){return y.call(u)=="[object Array]"},isarray}var streamBrowser,hasRequiredStreamBrowser;function requireStreamBrowser(){return hasRequiredStreamBrowser||(hasRequiredStreamBrowser=1,streamBrowser=requireEvents().EventEmitter),streamBrowser}var safeBuffer={exports:{}},hasRequiredSafeBuffer;function requireSafeBuffer(){return hasRequiredSafeBuffer||(hasRequiredSafeBuffer=1,(function(y,u){var g=requireDist(),v=g.Buffer;function b(E,S){for(var A in E)S[A]=E[A]}v.from&&v.alloc&&v.allocUnsafe&&v.allocUnsafeSlow?y.exports=g:(b(g,u),u.Buffer=w);function w(E,S,A){return v(E,S,A)}b(v,w),w.from=function(E,S,A){if(typeof E=="number")throw new TypeError("Argument must not be a number");return v(E,S,A)},w.alloc=function(E,S,A){if(typeof E!="number")throw new TypeError("Argument must be a number");var $=v(E);return S!==void 0?typeof A=="string"?$.fill(S,A):$.fill(S):$.fill(0),$},w.allocUnsafe=function(E){if(typeof E!="number")throw new TypeError("Argument must be a number");return v(E)},w.allocUnsafeSlow=function(E){if(typeof E!="number")throw new TypeError("Argument must be a number");return g.SlowBuffer(E)}})(safeBuffer,safeBuffer.exports)),safeBuffer.exports}var BufferList={exports:{}},hasRequiredBufferList;function requireBufferList(){return hasRequiredBufferList||(hasRequiredBufferList=1,(function(y){function u(w,E){if(!(w instanceof E))throw new TypeError("Cannot call a class as a function")}var g=requireSafeBuffer().Buffer,v=requireUtil$1();function b(w,E,S){w.copy(E,S)}y.exports=(function(){function w(){u(this,w),this.head=null,this.tail=null,this.length=0}return w.prototype.push=function(S){var A={data:S,next:null};this.length>0?this.tail.next=A:this.head=A,this.tail=A,++this.length},w.prototype.unshift=function(S){var A={data:S,next:this.head};this.length===0&&(this.tail=A),this.head=A,++this.length},w.prototype.shift=function(){if(this.length!==0){var S=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,S}},w.prototype.clear=function(){this.head=this.tail=null,this.length=0},w.prototype.join=function(S){if(this.length===0)return"";for(var A=this.head,$=""+A.data;A=A.next;)$+=S+A.data;return $},w.prototype.concat=function(S){if(this.length===0)return g.alloc(0);for(var A=g.allocUnsafe(S>>>0),$=this.head,R=0;$;)b($.data,A,R),R+=$.data.length,$=$.next;return A},w})(),v&&v.inspect&&v.inspect.custom&&(y.exports.prototype[v.inspect.custom]=function(){var w=v.inspect({length:this.length});return this.constructor.name+" "+w})})(BufferList)),BufferList.exports}var destroy_1,hasRequiredDestroy;function requireDestroy(){if(hasRequiredDestroy)return destroy_1;hasRequiredDestroy=1;var y=requireProcessNextickArgs();function u(b,w){var E=this,S=this._readableState&&this._readableState.destroyed,A=this._writableState&&this._writableState.destroyed;return S||A?(w?w(b):b&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,y.nextTick(v,this,b)):y.nextTick(v,this,b)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(b||null,function($){!w&&$?E._writableState?E._writableState.errorEmitted||(E._writableState.errorEmitted=!0,y.nextTick(v,E,$)):y.nextTick(v,E,$):w&&w($)}),this)}function g(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function v(b,w){b.emit("error",w)}return destroy_1={destroy:u,undestroy:g},destroy_1}var _stream_writable,hasRequired_stream_writable;function require_stream_writable(){if(hasRequired_stream_writable)return _stream_writable;hasRequired_stream_writable=1;var y=requireProcessNextickArgs();_stream_writable=U;function u(Y){var te=this;this.next=null,this.entry=null,this.finish=function(){re(te,Y)}}var g=!process$1.browser&&["v0.10","v0.9."].indexOf(process$1.version.slice(0,5))>-1?setImmediate:y.nextTick,v;U.WritableState=B;var b=Object.create(requireUtil());b.inherits=requireInherits_browser();var w={deprecate:requireBrowser$c()},E=requireStreamBrowser(),S=requireSafeBuffer().Buffer,A=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function $(Y){return S.from(Y)}function R(Y){return S.isBuffer(Y)||Y instanceof A}var T=requireDestroy();b.inherits(U,E);function O(){}function B(Y,te){v=v||require_stream_duplex(),Y=Y||{};var ne=te instanceof v;this.objectMode=!!Y.objectMode,ne&&(this.objectMode=this.objectMode||!!Y.writableObjectMode);var se=Y.highWaterMark,ee=Y.writableHighWaterMark,Z=this.objectMode?16:16*1024;se||se===0?this.highWaterMark=se:ne&&(ee||ee===0)?this.highWaterMark=ee:this.highWaterMark=Z,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var ue=Y.decodeStrings===!1;this.decodeStrings=!ue,this.defaultEncoding=Y.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(_e){ye(te,_e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new u(this)}B.prototype.getBuffer=function(){for(var te=this.bufferedRequest,ne=[];te;)ne.push(te),te=te.next;return ne},(function(){try{Object.defineProperty(B.prototype,"buffer",{get:w.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var F;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(F=Function.prototype[Symbol.hasInstance],Object.defineProperty(U,Symbol.hasInstance,{value:function(Y){return F.call(this,Y)?!0:this!==U?!1:Y&&Y._writableState instanceof B}})):F=function(Y){return Y instanceof this};function U(Y){if(v=v||require_stream_duplex(),!F.call(U,this)&&!(this instanceof v))return new U(Y);this._writableState=new B(Y,this),this.writable=!0,Y&&(typeof Y.write=="function"&&(this._write=Y.write),typeof Y.writev=="function"&&(this._writev=Y.writev),typeof Y.destroy=="function"&&(this._destroy=Y.destroy),typeof Y.final=="function"&&(this._final=Y.final)),E.call(this)}U.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function q(Y,te){var ne=new Error("write after end");Y.emit("error",ne),y.nextTick(te,ne)}function J(Y,te,ne,se){var ee=!0,Z=!1;return ne===null?Z=new TypeError("May not write null values to stream"):typeof ne!="string"&&ne!==void 0&&!te.objectMode&&(Z=new TypeError("Invalid non-string/buffer chunk")),Z&&(Y.emit("error",Z),y.nextTick(se,Z),ee=!1),ee}U.prototype.write=function(Y,te,ne){var se=this._writableState,ee=!1,Z=!se.objectMode&&R(Y);return Z&&!S.isBuffer(Y)&&(Y=$(Y)),typeof te=="function"&&(ne=te,te=null),Z?te="buffer":te||(te=se.defaultEncoding),typeof ne!="function"&&(ne=O),se.ended?q(this,ne):(Z||J(this,se,Y,ne))&&(se.pendingcb++,ee=oe(this,se,Z,Y,te,ne)),ee},U.prototype.cork=function(){var Y=this._writableState;Y.corked++},U.prototype.uncork=function(){var Y=this._writableState;Y.corked&&(Y.corked--,!Y.writing&&!Y.corked&&!Y.bufferProcessing&&Y.bufferedRequest&&ve(this,Y))},U.prototype.setDefaultEncoding=function(te){if(typeof te=="string"&&(te=te.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((te+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+te);return this._writableState.defaultEncoding=te,this};function ie(Y,te,ne){return!Y.objectMode&&Y.decodeStrings!==!1&&typeof te=="string"&&(te=S.from(te,ne)),te}Object.defineProperty(U.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function oe(Y,te,ne,se,ee,Z){if(!ne){var ue=ie(te,se,ee);se!==ue&&(ne=!0,ee="buffer",se=ue)}var _e=te.objectMode?1:se.length;te.length+=_e;var Re=te.length<te.highWaterMark;if(Re||(te.needDrain=!0),te.writing||te.corked){var Ae=te.lastBufferedRequest;te.lastBufferedRequest={chunk:se,encoding:ee,isBuf:ne,callback:Z,next:null},Ae?Ae.next=te.lastBufferedRequest:te.bufferedRequest=te.lastBufferedRequest,te.bufferedRequestCount+=1}else le(Y,te,!1,_e,se,ee,Z);return Re}function le(Y,te,ne,se,ee,Z,ue){te.writelen=se,te.writecb=ue,te.writing=!0,te.sync=!0,ne?Y._writev(ee,te.onwrite):Y._write(ee,Z,te.onwrite),te.sync=!1}function de(Y,te,ne,se,ee){--te.pendingcb,ne?(y.nextTick(ee,se),y.nextTick(j,Y,te),Y._writableState.errorEmitted=!0,Y.emit("error",se)):(ee(se),Y._writableState.errorEmitted=!0,Y.emit("error",se),j(Y,te))}function fe(Y){Y.writing=!1,Y.writecb=null,Y.length-=Y.writelen,Y.writelen=0}function ye(Y,te){var ne=Y._writableState,se=ne.sync,ee=ne.writecb;if(fe(ne),te)de(Y,ne,se,te,ee);else{var Z=he(ne);!Z&&!ne.corked&&!ne.bufferProcessing&&ne.bufferedRequest&&ve(Y,ne),se?g(we,Y,ne,Z,ee):we(Y,ne,Z,ee)}}function we(Y,te,ne,se){ne||pe(Y,te),te.pendingcb--,se(),j(Y,te)}function pe(Y,te){te.length===0&&te.needDrain&&(te.needDrain=!1,Y.emit("drain"))}function ve(Y,te){te.bufferProcessing=!0;var ne=te.bufferedRequest;if(Y._writev&&ne&&ne.next){var se=te.bufferedRequestCount,ee=new Array(se),Z=te.corkedRequestsFree;Z.entry=ne;for(var ue=0,_e=!0;ne;)ee[ue]=ne,ne.isBuf||(_e=!1),ne=ne.next,ue+=1;ee.allBuffers=_e,le(Y,te,!0,te.length,ee,"",Z.finish),te.pendingcb++,te.lastBufferedRequest=null,Z.next?(te.corkedRequestsFree=Z.next,Z.next=null):te.corkedRequestsFree=new u(te),te.bufferedRequestCount=0}else{for(;ne;){var Re=ne.chunk,Ae=ne.encoding,ge=ne.callback,be=te.objectMode?1:Re.length;if(le(Y,te,!1,be,Re,Ae,ge),ne=ne.next,te.bufferedRequestCount--,te.writing)break}ne===null&&(te.lastBufferedRequest=null)}te.bufferedRequest=ne,te.bufferProcessing=!1}U.prototype._write=function(Y,te,ne){ne(new Error("_write() is not implemented"))},U.prototype._writev=null,U.prototype.end=function(Y,te,ne){var se=this._writableState;typeof Y=="function"?(ne=Y,Y=null,te=null):typeof te=="function"&&(ne=te,te=null),Y!=null&&this.write(Y,te),se.corked&&(se.corked=1,this.uncork()),se.ending||z(this,se,ne)};function he(Y){return Y.ending&&Y.length===0&&Y.bufferedRequest===null&&!Y.finished&&!Y.writing}function ae(Y,te){Y._final(function(ne){te.pendingcb--,ne&&Y.emit("error",ne),te.prefinished=!0,Y.emit("prefinish"),j(Y,te)})}function Q(Y,te){!te.prefinished&&!te.finalCalled&&(typeof Y._final=="function"?(te.pendingcb++,te.finalCalled=!0,y.nextTick(ae,Y,te)):(te.prefinished=!0,Y.emit("prefinish")))}function j(Y,te){var ne=he(te);return ne&&(Q(Y,te),te.pendingcb===0&&(te.finished=!0,Y.emit("finish"))),ne}function z(Y,te,ne){te.ending=!0,j(Y,te),ne&&(te.finished?y.nextTick(ne):Y.once("finish",ne)),te.ended=!0,Y.writable=!1}function re(Y,te,ne){var se=Y.entry;for(Y.entry=null;se;){var ee=se.callback;te.pendingcb--,ee(ne),se=se.next}te.corkedRequestsFree.next=Y}return Object.defineProperty(U.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Y){this._writableState&&(this._writableState.destroyed=Y)}}),U.prototype.destroy=T.destroy,U.prototype._undestroy=T.undestroy,U.prototype._destroy=function(Y,te){this.end(),te(Y)},_stream_writable}var _stream_duplex,hasRequired_stream_duplex;function require_stream_duplex(){if(hasRequired_stream_duplex)return _stream_duplex;hasRequired_stream_duplex=1;var y=requireProcessNextickArgs(),u=Object.keys||function(T){var O=[];for(var B in T)O.push(B);return O};_stream_duplex=A;var g=Object.create(requireUtil());g.inherits=requireInherits_browser();var v=require_stream_readable(),b=require_stream_writable();g.inherits(A,v);for(var w=u(b.prototype),E=0;E<w.length;E++){var S=w[E];A.prototype[S]||(A.prototype[S]=b.prototype[S])}function A(T){if(!(this instanceof A))return new A(T);v.call(this,T),b.call(this,T),T&&T.readable===!1&&(this.readable=!1),T&&T.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,T&&T.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",$)}Object.defineProperty(A.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function $(){this.allowHalfOpen||this._writableState.ended||y.nextTick(R,this)}function R(T){T.end()}return Object.defineProperty(A.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(T){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=T,this._writableState.destroyed=T)}}),A.prototype._destroy=function(T,O){this.push(null),this.end(),y.nextTick(O,T)},_stream_duplex}var _stream_readable,hasRequired_stream_readable;function require_stream_readable(){if(hasRequired_stream_readable)return _stream_readable;hasRequired_stream_readable=1;var y=requireProcessNextickArgs();_stream_readable=ie;var u=requireIsarray(),g;ie.ReadableState=J,requireEvents().EventEmitter;var v=function(ge,be){return ge.listeners(be).length},b=requireStreamBrowser(),w=requireSafeBuffer().Buffer,E=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function S(ge){return w.from(ge)}function A(ge){return w.isBuffer(ge)||ge instanceof E}var $=Object.create(requireUtil());$.inherits=requireInherits_browser();var R=requireUtil$1(),T=void 0;R&&R.debuglog?T=R.debuglog("stream"):T=function(){};var O=requireBufferList(),B=requireDestroy(),F;$.inherits(ie,b);var U=["error","close","destroy","pause","resume"];function q(ge,be,Te){if(typeof ge.prependListener=="function")return ge.prependListener(be,Te);!ge._events||!ge._events[be]?ge.on(be,Te):u(ge._events[be])?ge._events[be].unshift(Te):ge._events[be]=[Te,ge._events[be]]}function J(ge,be){g=g||require_stream_duplex(),ge=ge||{};var Te=be instanceof g;this.objectMode=!!ge.objectMode,Te&&(this.objectMode=this.objectMode||!!ge.readableObjectMode);var De=ge.highWaterMark,Ie=ge.readableHighWaterMark,Se=this.objectMode?16:16*1024;De||De===0?this.highWaterMark=De:Te&&(Ie||Ie===0)?this.highWaterMark=Ie:this.highWaterMark=Se,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new O,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=ge.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,ge.encoding&&(F||(F=requireString_decoder().StringDecoder),this.decoder=new F(ge.encoding),this.encoding=ge.encoding)}function ie(ge){if(g=g||require_stream_duplex(),!(this instanceof ie))return new ie(ge);this._readableState=new J(ge,this),this.readable=!0,ge&&(typeof ge.read=="function"&&(this._read=ge.read),typeof ge.destroy=="function"&&(this._destroy=ge.destroy)),b.call(this)}Object.defineProperty(ie.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(ge){this._readableState&&(this._readableState.destroyed=ge)}}),ie.prototype.destroy=B.destroy,ie.prototype._undestroy=B.undestroy,ie.prototype._destroy=function(ge,be){this.push(null),be(ge)},ie.prototype.push=function(ge,be){var Te=this._readableState,De;return Te.objectMode?De=!0:typeof ge=="string"&&(be=be||Te.defaultEncoding,be!==Te.encoding&&(ge=w.from(ge,be),be=""),De=!0),oe(this,ge,be,!1,De)},ie.prototype.unshift=function(ge){return oe(this,ge,null,!0,!1)};function oe(ge,be,Te,De,Ie){var Se=ge._readableState;if(be===null)Se.reading=!1,ve(ge,Se);else{var Be;Ie||(Be=de(Se,be)),Be?ge.emit("error",Be):Se.objectMode||be&&be.length>0?(typeof be!="string"&&!Se.objectMode&&Object.getPrototypeOf(be)!==w.prototype&&(be=S(be)),De?Se.endEmitted?ge.emit("error",new Error("stream.unshift() after end event")):le(ge,Se,be,!0):Se.ended?ge.emit("error",new Error("stream.push() after EOF")):(Se.reading=!1,Se.decoder&&!Te?(be=Se.decoder.write(be),Se.objectMode||be.length!==0?le(ge,Se,be,!1):Q(ge,Se)):le(ge,Se,be,!1))):De||(Se.reading=!1)}return fe(Se)}function le(ge,be,Te,De){be.flowing&&be.length===0&&!be.sync?(ge.emit("data",Te),ge.read(0)):(be.length+=be.objectMode?1:Te.length,De?be.buffer.unshift(Te):be.buffer.push(Te),be.needReadable&&he(ge)),Q(ge,be)}function de(ge,be){var Te;return!A(be)&&typeof be!="string"&&be!==void 0&&!ge.objectMode&&(Te=new TypeError("Invalid non-string/buffer chunk")),Te}function fe(ge){return!ge.ended&&(ge.needReadable||ge.length<ge.highWaterMark||ge.length===0)}ie.prototype.isPaused=function(){return this._readableState.flowing===!1},ie.prototype.setEncoding=function(ge){return F||(F=requireString_decoder().StringDecoder),this._readableState.decoder=new F(ge),this._readableState.encoding=ge,this};var ye=8388608;function we(ge){return ge>=ye?ge=ye:(ge--,ge|=ge>>>1,ge|=ge>>>2,ge|=ge>>>4,ge|=ge>>>8,ge|=ge>>>16,ge++),ge}function pe(ge,be){return ge<=0||be.length===0&&be.ended?0:be.objectMode?1:ge!==ge?be.flowing&&be.length?be.buffer.head.data.length:be.length:(ge>be.highWaterMark&&(be.highWaterMark=we(ge)),ge<=be.length?ge:be.ended?be.length:(be.needReadable=!0,0))}ie.prototype.read=function(ge){T("read",ge),ge=parseInt(ge,10);var be=this._readableState,Te=ge;if(ge!==0&&(be.emittedReadable=!1),ge===0&&be.needReadable&&(be.length>=be.highWaterMark||be.ended))return T("read: emitReadable",be.length,be.ended),be.length===0&&be.ended?_e(this):he(this),null;if(ge=pe(ge,be),ge===0&&be.ended)return be.length===0&&_e(this),null;var De=be.needReadable;T("need readable",De),(be.length===0||be.length-ge<be.highWaterMark)&&(De=!0,T("length less than watermark",De)),be.ended||be.reading?(De=!1,T("reading or ended",De)):De&&(T("do read"),be.reading=!0,be.sync=!0,be.length===0&&(be.needReadable=!0),this._read(be.highWaterMark),be.sync=!1,be.reading||(ge=pe(Te,be)));var Ie;return ge>0?Ie=se(ge,be):Ie=null,Ie===null?(be.needReadable=!0,ge=0):be.length-=ge,be.length===0&&(be.ended||(be.needReadable=!0),Te!==ge&&be.ended&&_e(this)),Ie!==null&&this.emit("data",Ie),Ie};function ve(ge,be){if(!be.ended){if(be.decoder){var Te=be.decoder.end();Te&&Te.length&&(be.buffer.push(Te),be.length+=be.objectMode?1:Te.length)}be.ended=!0,he(ge)}}function he(ge){var be=ge._readableState;be.needReadable=!1,be.emittedReadable||(T("emitReadable",be.flowing),be.emittedReadable=!0,be.sync?y.nextTick(ae,ge):ae(ge))}function ae(ge){T("emit readable"),ge.emit("readable"),ne(ge)}function Q(ge,be){be.readingMore||(be.readingMore=!0,y.nextTick(j,ge,be))}function j(ge,be){for(var Te=be.length;!be.reading&&!be.flowing&&!be.ended&&be.length<be.highWaterMark&&(T("maybeReadMore read 0"),ge.read(0),Te!==be.length);)Te=be.length;be.readingMore=!1}ie.prototype._read=function(ge){this.emit("error",new Error("_read() is not implemented"))},ie.prototype.pipe=function(ge,be){var Te=this,De=this._readableState;switch(De.pipesCount){case 0:De.pipes=ge;break;case 1:De.pipes=[De.pipes,ge];break;default:De.pipes.push(ge);break}De.pipesCount+=1,T("pipe count=%d opts=%j",De.pipesCount,be);var Ie=(!be||be.end!==!1)&&ge!==process$1.stdout&&ge!==process$1.stderr,Se=Ie?Le:ut;De.endEmitted?y.nextTick(Se):Te.once("end",Se),ge.on("unpipe",Be);function Be(ot,vt){T("onunpipe"),ot===Te&&vt&&vt.hasUnpiped===!1&&(vt.hasUnpiped=!0,Ge())}function Le(){T("onend"),ge.end()}var qe=z(Te);ge.on("drain",qe);var Ke=!1;function Ge(){T("cleanup"),ge.removeListener("close",Ze),ge.removeListener("finish",nt),ge.removeListener("drain",qe),ge.removeListener("error",et),ge.removeListener("unpipe",Be),Te.removeListener("end",Le),Te.removeListener("end",ut),Te.removeListener("data",ze),Ke=!0,De.awaitDrain&&(!ge._writableState||ge._writableState.needDrain)&&qe()}var Xe=!1;Te.on("data",ze);function ze(ot){T("ondata"),Xe=!1;var vt=ge.write(ot);vt===!1&&!Xe&&((De.pipesCount===1&&De.pipes===ge||De.pipesCount>1&&Ae(De.pipes,ge)!==-1)&&!Ke&&(T("false write response, pause",De.awaitDrain),De.awaitDrain++,Xe=!0),Te.pause())}function et(ot){T("onerror",ot),ut(),ge.removeListener("error",et),v(ge,"error")===0&&ge.emit("error",ot)}q(ge,"error",et);function Ze(){ge.removeListener("finish",nt),ut()}ge.once("close",Ze);function nt(){T("onfinish"),ge.removeListener("close",Ze),ut()}ge.once("finish",nt);function ut(){T("unpipe"),Te.unpipe(ge)}return ge.emit("pipe",Te),De.flowing||(T("pipe resume"),Te.resume()),ge};function z(ge){return function(){var be=ge._readableState;T("pipeOnDrain",be.awaitDrain),be.awaitDrain&&be.awaitDrain--,be.awaitDrain===0&&v(ge,"data")&&(be.flowing=!0,ne(ge))}}ie.prototype.unpipe=function(ge){var be=this._readableState,Te={hasUnpiped:!1};if(be.pipesCount===0)return this;if(be.pipesCount===1)return ge&&ge!==be.pipes?this:(ge||(ge=be.pipes),be.pipes=null,be.pipesCount=0,be.flowing=!1,ge&&ge.emit("unpipe",this,Te),this);if(!ge){var De=be.pipes,Ie=be.pipesCount;be.pipes=null,be.pipesCount=0,be.flowing=!1;for(var Se=0;Se<Ie;Se++)De[Se].emit("unpipe",this,{hasUnpiped:!1});return this}var Be=Ae(be.pipes,ge);return Be===-1?this:(be.pipes.splice(Be,1),be.pipesCount-=1,be.pipesCount===1&&(be.pipes=be.pipes[0]),ge.emit("unpipe",this,Te),this)},ie.prototype.on=function(ge,be){var Te=b.prototype.on.call(this,ge,be);if(ge==="data")this._readableState.flowing!==!1&&this.resume();else if(ge==="readable"){var De=this._readableState;!De.endEmitted&&!De.readableListening&&(De.readableListening=De.needReadable=!0,De.emittedReadable=!1,De.reading?De.length&&he(this):y.nextTick(re,this))}return Te},ie.prototype.addListener=ie.prototype.on;function re(ge){T("readable nexttick read 0"),ge.read(0)}ie.prototype.resume=function(){var ge=this._readableState;return ge.flowing||(T("resume"),ge.flowing=!0,Y(this,ge)),this};function Y(ge,be){be.resumeScheduled||(be.resumeScheduled=!0,y.nextTick(te,ge,be))}function te(ge,be){be.reading||(T("resume read 0"),ge.read(0)),be.resumeScheduled=!1,be.awaitDrain=0,ge.emit("resume"),ne(ge),be.flowing&&!be.reading&&ge.read(0)}ie.prototype.pause=function(){return T("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(T("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function ne(ge){var be=ge._readableState;for(T("flow",be.flowing);be.flowing&&ge.read()!==null;);}ie.prototype.wrap=function(ge){var be=this,Te=this._readableState,De=!1;ge.on("end",function(){if(T("wrapped end"),Te.decoder&&!Te.ended){var Be=Te.decoder.end();Be&&Be.length&&be.push(Be)}be.push(null)}),ge.on("data",function(Be){if(T("wrapped data"),Te.decoder&&(Be=Te.decoder.write(Be)),!(Te.objectMode&&Be==null)&&!(!Te.objectMode&&(!Be||!Be.length))){var Le=be.push(Be);Le||(De=!0,ge.pause())}});for(var Ie in ge)this[Ie]===void 0&&typeof ge[Ie]=="function"&&(this[Ie]=(function(Be){return function(){return ge[Be].apply(ge,arguments)}})(Ie));for(var Se=0;Se<U.length;Se++)ge.on(U[Se],this.emit.bind(this,U[Se]));return this._read=function(Be){T("wrapped _read",Be),De&&(De=!1,ge.resume())},this},Object.defineProperty(ie.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),ie._fromList=se;function se(ge,be){if(be.length===0)return null;var Te;return be.objectMode?Te=be.buffer.shift():!ge||ge>=be.length?(be.decoder?Te=be.buffer.join(""):be.buffer.length===1?Te=be.buffer.head.data:Te=be.buffer.concat(be.length),be.buffer.clear()):Te=ee(ge,be.buffer,be.decoder),Te}function ee(ge,be,Te){var De;return ge<be.head.data.length?(De=be.head.data.slice(0,ge),be.head.data=be.head.data.slice(ge)):ge===be.head.data.length?De=be.shift():De=Te?Z(ge,be):ue(ge,be),De}function Z(ge,be){var Te=be.head,De=1,Ie=Te.data;for(ge-=Ie.length;Te=Te.next;){var Se=Te.data,Be=ge>Se.length?Se.length:ge;if(Be===Se.length?Ie+=Se:Ie+=Se.slice(0,ge),ge-=Be,ge===0){Be===Se.length?(++De,Te.next?be.head=Te.next:be.head=be.tail=null):(be.head=Te,Te.data=Se.slice(Be));break}++De}return be.length-=De,Ie}function ue(ge,be){var Te=w.allocUnsafe(ge),De=be.head,Ie=1;for(De.data.copy(Te),ge-=De.data.length;De=De.next;){var Se=De.data,Be=ge>Se.length?Se.length:ge;if(Se.copy(Te,Te.length-ge,0,Be),ge-=Be,ge===0){Be===Se.length?(++Ie,De.next?be.head=De.next:be.head=be.tail=null):(be.head=De,De.data=Se.slice(Be));break}++Ie}return be.length-=Ie,Te}function _e(ge){var be=ge._readableState;if(be.length>0)throw new Error('"endReadable()" called on non-empty stream');be.endEmitted||(be.ended=!0,y.nextTick(Re,be,ge))}function Re(ge,be){!ge.endEmitted&&ge.length===0&&(ge.endEmitted=!0,be.readable=!1,be.emit("end"))}function Ae(ge,be){for(var Te=0,De=ge.length;Te<De;Te++)if(ge[Te]===be)return Te;return-1}return _stream_readable}var _stream_transform,hasRequired_stream_transform;function require_stream_transform(){if(hasRequired_stream_transform)return _stream_transform;hasRequired_stream_transform=1,_stream_transform=v;var y=require_stream_duplex(),u=Object.create(requireUtil());u.inherits=requireInherits_browser(),u.inherits(v,y);function g(E,S){var A=this._transformState;A.transforming=!1;var $=A.writecb;if(!$)return this.emit("error",new Error("write callback called multiple times"));A.writechunk=null,A.writecb=null,S!=null&&this.push(S),$(E);var R=this._readableState;R.reading=!1,(R.needReadable||R.length<R.highWaterMark)&&this._read(R.highWaterMark)}function v(E){if(!(this instanceof v))return new v(E);y.call(this,E),this._transformState={afterTransform:g.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,E&&(typeof E.transform=="function"&&(this._transform=E.transform),typeof E.flush=="function"&&(this._flush=E.flush)),this.on("prefinish",b)}function b(){var E=this;typeof this._flush=="function"?this._flush(function(S,A){w(E,S,A)}):w(this,null,null)}v.prototype.push=function(E,S){return this._transformState.needTransform=!1,y.prototype.push.call(this,E,S)},v.prototype._transform=function(E,S,A){throw new Error("_transform() is not implemented")},v.prototype._write=function(E,S,A){var $=this._transformState;if($.writecb=A,$.writechunk=E,$.writeencoding=S,!$.transforming){var R=this._readableState;($.needTransform||R.needReadable||R.length<R.highWaterMark)&&this._read(R.highWaterMark)}},v.prototype._read=function(E){var S=this._transformState;S.writechunk!==null&&S.writecb&&!S.transforming?(S.transforming=!0,this._transform(S.writechunk,S.writeencoding,S.afterTransform)):S.needTransform=!0},v.prototype._destroy=function(E,S){var A=this;y.prototype._destroy.call(this,E,function($){S($),A.emit("close")})};function w(E,S,A){if(S)return E.emit("error",S);if(A!=null&&E.push(A),E._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(E._transformState.transforming)throw new Error("Calling transform done when still transforming");return E.push(null)}return _stream_transform}var _stream_passthrough,hasRequired_stream_passthrough;function require_stream_passthrough(){if(hasRequired_stream_passthrough)return _stream_passthrough;hasRequired_stream_passthrough=1,_stream_passthrough=g;var y=require_stream_transform(),u=Object.create(requireUtil());u.inherits=requireInherits_browser(),u.inherits(g,y);function g(v){if(!(this instanceof g))return new g(v);y.call(this,v)}return g.prototype._transform=function(v,b,w){w(null,v)},_stream_passthrough}var hasRequiredReadableBrowser;function requireReadableBrowser(){return hasRequiredReadableBrowser||(hasRequiredReadableBrowser=1,(function(y,u){u=y.exports=require_stream_readable(),u.Stream=u,u.Readable=u,u.Writable=require_stream_writable(),u.Duplex=require_stream_duplex(),u.Transform=require_stream_transform(),u.PassThrough=require_stream_passthrough()})(readableBrowser,readableBrowser.exports)),readableBrowser.exports}var sign$1={exports:{}},bn$3={exports:{}},bn$2=bn$3.exports,hasRequiredBn$1;function requireBn$1(){return hasRequiredBn$1||(hasRequiredBn$1=1,(function(y){(function(u,g){function v(Q,j){if(!Q)throw new Error(j||"Assertion failed")}function b(Q,j){Q.super_=j;var z=function(){};z.prototype=j.prototype,Q.prototype=new z,Q.prototype.constructor=Q}function w(Q,j,z){if(w.isBN(Q))return Q;this.negative=0,this.words=null,this.length=0,this.red=null,Q!==null&&((j==="le"||j==="be")&&(z=j,j=10),this._init(Q||0,j||10,z||"be"))}typeof u=="object"?u.exports=w:g.BN=w,w.BN=w,w.wordSize=26;var E;try{typeof window<"u"&&typeof window.Buffer<"u"?E=window.Buffer:E=requireDist().Buffer}catch{}w.isBN=function(j){return j instanceof w?!0:j!==null&&typeof j=="object"&&j.constructor.wordSize===w.wordSize&&Array.isArray(j.words)},w.max=function(j,z){return j.cmp(z)>0?j:z},w.min=function(j,z){return j.cmp(z)<0?j:z},w.prototype._init=function(j,z,re){if(typeof j=="number")return this._initNumber(j,z,re);if(typeof j=="object")return this._initArray(j,z,re);z==="hex"&&(z=16),v(z===(z|0)&&z>=2&&z<=36),j=j.toString().replace(/\s+/g,"");var Y=0;j[0]==="-"&&(Y++,this.negative=1),Y<j.length&&(z===16?this._parseHex(j,Y,re):(this._parseBase(j,z,Y),re==="le"&&this._initArray(this.toArray(),z,re)))},w.prototype._initNumber=function(j,z,re){j<0&&(this.negative=1,j=-j),j<67108864?(this.words=[j&67108863],this.length=1):j<4503599627370496?(this.words=[j&67108863,j/67108864&67108863],this.length=2):(v(j<9007199254740992),this.words=[j&67108863,j/67108864&67108863,1],this.length=3),re==="le"&&this._initArray(this.toArray(),z,re)},w.prototype._initArray=function(j,z,re){if(v(typeof j.length=="number"),j.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(j.length/3),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var te,ne,se=0;if(re==="be")for(Y=j.length-1,te=0;Y>=0;Y-=3)ne=j[Y]|j[Y-1]<<8|j[Y-2]<<16,this.words[te]|=ne<<se&67108863,this.words[te+1]=ne>>>26-se&67108863,se+=24,se>=26&&(se-=26,te++);else if(re==="le")for(Y=0,te=0;Y<j.length;Y+=3)ne=j[Y]|j[Y+1]<<8|j[Y+2]<<16,this.words[te]|=ne<<se&67108863,this.words[te+1]=ne>>>26-se&67108863,se+=24,se>=26&&(se-=26,te++);return this._strip()};function S(Q,j){var z=Q.charCodeAt(j);if(z>=48&&z<=57)return z-48;if(z>=65&&z<=70)return z-55;if(z>=97&&z<=102)return z-87;v(!1,"Invalid character in "+Q)}function A(Q,j,z){var re=S(Q,z);return z-1>=j&&(re|=S(Q,z-1)<<4),re}w.prototype._parseHex=function(j,z,re){this.length=Math.ceil((j.length-z)/6),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var te=0,ne=0,se;if(re==="be")for(Y=j.length-1;Y>=z;Y-=2)se=A(j,z,Y)<<te,this.words[ne]|=se&67108863,te>=18?(te-=18,ne+=1,this.words[ne]|=se>>>26):te+=8;else{var ee=j.length-z;for(Y=ee%2===0?z+1:z;Y<j.length;Y+=2)se=A(j,z,Y)<<te,this.words[ne]|=se&67108863,te>=18?(te-=18,ne+=1,this.words[ne]|=se>>>26):te+=8}this._strip()};function $(Q,j,z,re){for(var Y=0,te=0,ne=Math.min(Q.length,z),se=j;se<ne;se++){var ee=Q.charCodeAt(se)-48;Y*=re,ee>=49?te=ee-49+10:ee>=17?te=ee-17+10:te=ee,v(ee>=0&&te<re,"Invalid character"),Y+=te}return Y}w.prototype._parseBase=function(j,z,re){this.words=[0],this.length=1;for(var Y=0,te=1;te<=67108863;te*=z)Y++;Y--,te=te/z|0;for(var ne=j.length-re,se=ne%Y,ee=Math.min(ne,ne-se)+re,Z=0,ue=re;ue<ee;ue+=Y)Z=$(j,ue,ue+Y,z),this.imuln(te),this.words[0]+Z<67108864?this.words[0]+=Z:this._iaddn(Z);if(se!==0){var _e=1;for(Z=$(j,ue,j.length,z),ue=0;ue<se;ue++)_e*=z;this.imuln(_e),this.words[0]+Z<67108864?this.words[0]+=Z:this._iaddn(Z)}this._strip()},w.prototype.copy=function(j){j.words=new Array(this.length);for(var z=0;z<this.length;z++)j.words[z]=this.words[z];j.length=this.length,j.negative=this.negative,j.red=this.red};function R(Q,j){Q.words=j.words,Q.length=j.length,Q.negative=j.negative,Q.red=j.red}if(w.prototype._move=function(j){R(j,this)},w.prototype.clone=function(){var j=new w(null);return this.copy(j),j},w.prototype._expand=function(j){for(;this.length<j;)this.words[this.length++]=0;return this},w.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},w.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{w.prototype[Symbol.for("nodejs.util.inspect.custom")]=T}catch{w.prototype.inspect=T}else w.prototype.inspect=T;function T(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var O=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],B=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],F=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];w.prototype.toString=function(j,z){j=j||10,z=z|0||1;var re;if(j===16||j==="hex"){re="";for(var Y=0,te=0,ne=0;ne<this.length;ne++){var se=this.words[ne],ee=((se<<Y|te)&16777215).toString(16);te=se>>>24-Y&16777215,Y+=2,Y>=26&&(Y-=26,ne--),te!==0||ne!==this.length-1?re=O[6-ee.length]+ee+re:re=ee+re}for(te!==0&&(re=te.toString(16)+re);re.length%z!==0;)re="0"+re;return this.negative!==0&&(re="-"+re),re}if(j===(j|0)&&j>=2&&j<=36){var Z=B[j],ue=F[j];re="";var _e=this.clone();for(_e.negative=0;!_e.isZero();){var Re=_e.modrn(ue).toString(j);_e=_e.idivn(ue),_e.isZero()?re=Re+re:re=O[Z-Re.length]+Re+re}for(this.isZero()&&(re="0"+re);re.length%z!==0;)re="0"+re;return this.negative!==0&&(re="-"+re),re}v(!1,"Base should be between 2 and 36")},w.prototype.toNumber=function(){var j=this.words[0];return this.length===2?j+=this.words[1]*67108864:this.length===3&&this.words[2]===1?j+=4503599627370496+this.words[1]*67108864:this.length>2&&v(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-j:j},w.prototype.toJSON=function(){return this.toString(16,2)},E&&(w.prototype.toBuffer=function(j,z){return this.toArrayLike(E,j,z)}),w.prototype.toArray=function(j,z){return this.toArrayLike(Array,j,z)};var U=function(j,z){return j.allocUnsafe?j.allocUnsafe(z):new j(z)};w.prototype.toArrayLike=function(j,z,re){this._strip();var Y=this.byteLength(),te=re||Math.max(1,Y);v(Y<=te,"byte array longer than desired length"),v(te>0,"Requested array length <= 0");var ne=U(j,te),se=z==="le"?"LE":"BE";return this["_toArrayLike"+se](ne,Y),ne},w.prototype._toArrayLikeLE=function(j,z){for(var re=0,Y=0,te=0,ne=0;te<this.length;te++){var se=this.words[te]<<ne|Y;j[re++]=se&255,re<j.length&&(j[re++]=se>>8&255),re<j.length&&(j[re++]=se>>16&255),ne===6?(re<j.length&&(j[re++]=se>>24&255),Y=0,ne=0):(Y=se>>>24,ne+=2)}if(re<j.length)for(j[re++]=Y;re<j.length;)j[re++]=0},w.prototype._toArrayLikeBE=function(j,z){for(var re=j.length-1,Y=0,te=0,ne=0;te<this.length;te++){var se=this.words[te]<<ne|Y;j[re--]=se&255,re>=0&&(j[re--]=se>>8&255),re>=0&&(j[re--]=se>>16&255),ne===6?(re>=0&&(j[re--]=se>>24&255),Y=0,ne=0):(Y=se>>>24,ne+=2)}if(re>=0)for(j[re--]=Y;re>=0;)j[re--]=0},Math.clz32?w.prototype._countBits=function(j){return 32-Math.clz32(j)}:w.prototype._countBits=function(j){var z=j,re=0;return z>=4096&&(re+=13,z>>>=13),z>=64&&(re+=7,z>>>=7),z>=8&&(re+=4,z>>>=4),z>=2&&(re+=2,z>>>=2),re+z},w.prototype._zeroBits=function(j){if(j===0)return 26;var z=j,re=0;return(z&8191)===0&&(re+=13,z>>>=13),(z&127)===0&&(re+=7,z>>>=7),(z&15)===0&&(re+=4,z>>>=4),(z&3)===0&&(re+=2,z>>>=2),(z&1)===0&&re++,re},w.prototype.bitLength=function(){var j=this.words[this.length-1],z=this._countBits(j);return(this.length-1)*26+z};function q(Q){for(var j=new Array(Q.bitLength()),z=0;z<j.length;z++){var re=z/26|0,Y=z%26;j[z]=Q.words[re]>>>Y&1}return j}w.prototype.zeroBits=function(){if(this.isZero())return 0;for(var j=0,z=0;z<this.length;z++){var re=this._zeroBits(this.words[z]);if(j+=re,re!==26)break}return j},w.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},w.prototype.toTwos=function(j){return this.negative!==0?this.abs().inotn(j).iaddn(1):this.clone()},w.prototype.fromTwos=function(j){return this.testn(j-1)?this.notn(j).iaddn(1).ineg():this.clone()},w.prototype.isNeg=function(){return this.negative!==0},w.prototype.neg=function(){return this.clone().ineg()},w.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},w.prototype.iuor=function(j){for(;this.length<j.length;)this.words[this.length++]=0;for(var z=0;z<j.length;z++)this.words[z]=this.words[z]|j.words[z];return this._strip()},w.prototype.ior=function(j){return v((this.negative|j.negative)===0),this.iuor(j)},w.prototype.or=function(j){return this.length>j.length?this.clone().ior(j):j.clone().ior(this)},w.prototype.uor=function(j){return this.length>j.length?this.clone().iuor(j):j.clone().iuor(this)},w.prototype.iuand=function(j){var z;this.length>j.length?z=j:z=this;for(var re=0;re<z.length;re++)this.words[re]=this.words[re]&j.words[re];return this.length=z.length,this._strip()},w.prototype.iand=function(j){return v((this.negative|j.negative)===0),this.iuand(j)},w.prototype.and=function(j){return this.length>j.length?this.clone().iand(j):j.clone().iand(this)},w.prototype.uand=function(j){return this.length>j.length?this.clone().iuand(j):j.clone().iuand(this)},w.prototype.iuxor=function(j){var z,re;this.length>j.length?(z=this,re=j):(z=j,re=this);for(var Y=0;Y<re.length;Y++)this.words[Y]=z.words[Y]^re.words[Y];if(this!==z)for(;Y<z.length;Y++)this.words[Y]=z.words[Y];return this.length=z.length,this._strip()},w.prototype.ixor=function(j){return v((this.negative|j.negative)===0),this.iuxor(j)},w.prototype.xor=function(j){return this.length>j.length?this.clone().ixor(j):j.clone().ixor(this)},w.prototype.uxor=function(j){return this.length>j.length?this.clone().iuxor(j):j.clone().iuxor(this)},w.prototype.inotn=function(j){v(typeof j=="number"&&j>=0);var z=Math.ceil(j/26)|0,re=j%26;this._expand(z),re>0&&z--;for(var Y=0;Y<z;Y++)this.words[Y]=~this.words[Y]&67108863;return re>0&&(this.words[Y]=~this.words[Y]&67108863>>26-re),this._strip()},w.prototype.notn=function(j){return this.clone().inotn(j)},w.prototype.setn=function(j,z){v(typeof j=="number"&&j>=0);var re=j/26|0,Y=j%26;return this._expand(re+1),z?this.words[re]=this.words[re]|1<<Y:this.words[re]=this.words[re]&~(1<<Y),this._strip()},w.prototype.iadd=function(j){var z;if(this.negative!==0&&j.negative===0)return this.negative=0,z=this.isub(j),this.negative^=1,this._normSign();if(this.negative===0&&j.negative!==0)return j.negative=0,z=this.isub(j),j.negative=1,z._normSign();var re,Y;this.length>j.length?(re=this,Y=j):(re=j,Y=this);for(var te=0,ne=0;ne<Y.length;ne++)z=(re.words[ne]|0)+(Y.words[ne]|0)+te,this.words[ne]=z&67108863,te=z>>>26;for(;te!==0&&ne<re.length;ne++)z=(re.words[ne]|0)+te,this.words[ne]=z&67108863,te=z>>>26;if(this.length=re.length,te!==0)this.words[this.length]=te,this.length++;else if(re!==this)for(;ne<re.length;ne++)this.words[ne]=re.words[ne];return this},w.prototype.add=function(j){var z;return j.negative!==0&&this.negative===0?(j.negative=0,z=this.sub(j),j.negative^=1,z):j.negative===0&&this.negative!==0?(this.negative=0,z=j.sub(this),this.negative=1,z):this.length>j.length?this.clone().iadd(j):j.clone().iadd(this)},w.prototype.isub=function(j){if(j.negative!==0){j.negative=0;var z=this.iadd(j);return j.negative=1,z._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(j),this.negative=1,this._normSign();var re=this.cmp(j);if(re===0)return this.negative=0,this.length=1,this.words[0]=0,this;var Y,te;re>0?(Y=this,te=j):(Y=j,te=this);for(var ne=0,se=0;se<te.length;se++)z=(Y.words[se]|0)-(te.words[se]|0)+ne,ne=z>>26,this.words[se]=z&67108863;for(;ne!==0&&se<Y.length;se++)z=(Y.words[se]|0)+ne,ne=z>>26,this.words[se]=z&67108863;if(ne===0&&se<Y.length&&Y!==this)for(;se<Y.length;se++)this.words[se]=Y.words[se];return this.length=Math.max(this.length,se),Y!==this&&(this.negative=1),this._strip()},w.prototype.sub=function(j){return this.clone().isub(j)};function J(Q,j,z){z.negative=j.negative^Q.negative;var re=Q.length+j.length|0;z.length=re,re=re-1|0;var Y=Q.words[0]|0,te=j.words[0]|0,ne=Y*te,se=ne&67108863,ee=ne/67108864|0;z.words[0]=se;for(var Z=1;Z<re;Z++){for(var ue=ee>>>26,_e=ee&67108863,Re=Math.min(Z,j.length-1),Ae=Math.max(0,Z-Q.length+1);Ae<=Re;Ae++){var ge=Z-Ae|0;Y=Q.words[ge]|0,te=j.words[Ae]|0,ne=Y*te+_e,ue+=ne/67108864|0,_e=ne&67108863}z.words[Z]=_e|0,ee=ue|0}return ee!==0?z.words[Z]=ee|0:z.length--,z._strip()}var ie=function(j,z,re){var Y=j.words,te=z.words,ne=re.words,se=0,ee,Z,ue,_e=Y[0]|0,Re=_e&8191,Ae=_e>>>13,ge=Y[1]|0,be=ge&8191,Te=ge>>>13,De=Y[2]|0,Ie=De&8191,Se=De>>>13,Be=Y[3]|0,Le=Be&8191,qe=Be>>>13,Ke=Y[4]|0,Ge=Ke&8191,Xe=Ke>>>13,ze=Y[5]|0,et=ze&8191,Ze=ze>>>13,nt=Y[6]|0,ut=nt&8191,ot=nt>>>13,vt=Y[7]|0,bt=vt&8191,lt=vt>>>13,kt=Y[8]|0,Ct=kt&8191,Me=kt>>>13,Ce=Y[9]|0,Ee=Ce&8191,Pe=Ce>>>13,je=te[0]|0,He=je&8191,Ve=je>>>13,dt=te[1]|0,xt=dt&8191,mt=dt>>>13,gt=te[2]|0,at=gt&8191,ht=gt>>>13,_t=te[3]|0,$t=_t&8191,St=_t>>>13,ft=te[4]|0,At=ft&8191,Oe=ft>>>13,$e=te[5]|0,ke=$e&8191,Ue=$e>>>13,We=te[6]|0,Qe=We&8191,tt=We>>>13,Pt=te[7]|0,Nt=Pt&8191,Rt=Pt>>>13,Dt=te[8]|0,Tt=Dt&8191,It=Dt>>>13,Wt=te[9]|0,jt=Wt&8191,Ft=Wt>>>13;re.negative=j.negative^z.negative,re.length=19,ee=Math.imul(Re,He),Z=Math.imul(Re,Ve),Z=Z+Math.imul(Ae,He)|0,ue=Math.imul(Ae,Ve);var Kr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Kr>>>26)|0,Kr&=67108863,ee=Math.imul(be,He),Z=Math.imul(be,Ve),Z=Z+Math.imul(Te,He)|0,ue=Math.imul(Te,Ve),ee=ee+Math.imul(Re,xt)|0,Z=Z+Math.imul(Re,mt)|0,Z=Z+Math.imul(Ae,xt)|0,ue=ue+Math.imul(Ae,mt)|0;var Mr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Mr>>>26)|0,Mr&=67108863,ee=Math.imul(Ie,He),Z=Math.imul(Ie,Ve),Z=Z+Math.imul(Se,He)|0,ue=Math.imul(Se,Ve),ee=ee+Math.imul(be,xt)|0,Z=Z+Math.imul(be,mt)|0,Z=Z+Math.imul(Te,xt)|0,ue=ue+Math.imul(Te,mt)|0,ee=ee+Math.imul(Re,at)|0,Z=Z+Math.imul(Re,ht)|0,Z=Z+Math.imul(Ae,at)|0,ue=ue+Math.imul(Ae,ht)|0;var Cr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Cr>>>26)|0,Cr&=67108863,ee=Math.imul(Le,He),Z=Math.imul(Le,Ve),Z=Z+Math.imul(qe,He)|0,ue=Math.imul(qe,Ve),ee=ee+Math.imul(Ie,xt)|0,Z=Z+Math.imul(Ie,mt)|0,Z=Z+Math.imul(Se,xt)|0,ue=ue+Math.imul(Se,mt)|0,ee=ee+Math.imul(be,at)|0,Z=Z+Math.imul(be,ht)|0,Z=Z+Math.imul(Te,at)|0,ue=ue+Math.imul(Te,ht)|0,ee=ee+Math.imul(Re,$t)|0,Z=Z+Math.imul(Re,St)|0,Z=Z+Math.imul(Ae,$t)|0,ue=ue+Math.imul(Ae,St)|0;var Pr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Pr>>>26)|0,Pr&=67108863,ee=Math.imul(Ge,He),Z=Math.imul(Ge,Ve),Z=Z+Math.imul(Xe,He)|0,ue=Math.imul(Xe,Ve),ee=ee+Math.imul(Le,xt)|0,Z=Z+Math.imul(Le,mt)|0,Z=Z+Math.imul(qe,xt)|0,ue=ue+Math.imul(qe,mt)|0,ee=ee+Math.imul(Ie,at)|0,Z=Z+Math.imul(Ie,ht)|0,Z=Z+Math.imul(Se,at)|0,ue=ue+Math.imul(Se,ht)|0,ee=ee+Math.imul(be,$t)|0,Z=Z+Math.imul(be,St)|0,Z=Z+Math.imul(Te,$t)|0,ue=ue+Math.imul(Te,St)|0,ee=ee+Math.imul(Re,At)|0,Z=Z+Math.imul(Re,Oe)|0,Z=Z+Math.imul(Ae,At)|0,ue=ue+Math.imul(Ae,Oe)|0;var wr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(wr>>>26)|0,wr&=67108863,ee=Math.imul(et,He),Z=Math.imul(et,Ve),Z=Z+Math.imul(Ze,He)|0,ue=Math.imul(Ze,Ve),ee=ee+Math.imul(Ge,xt)|0,Z=Z+Math.imul(Ge,mt)|0,Z=Z+Math.imul(Xe,xt)|0,ue=ue+Math.imul(Xe,mt)|0,ee=ee+Math.imul(Le,at)|0,Z=Z+Math.imul(Le,ht)|0,Z=Z+Math.imul(qe,at)|0,ue=ue+Math.imul(qe,ht)|0,ee=ee+Math.imul(Ie,$t)|0,Z=Z+Math.imul(Ie,St)|0,Z=Z+Math.imul(Se,$t)|0,ue=ue+Math.imul(Se,St)|0,ee=ee+Math.imul(be,At)|0,Z=Z+Math.imul(be,Oe)|0,Z=Z+Math.imul(Te,At)|0,ue=ue+Math.imul(Te,Oe)|0,ee=ee+Math.imul(Re,ke)|0,Z=Z+Math.imul(Re,Ue)|0,Z=Z+Math.imul(Ae,ke)|0,ue=ue+Math.imul(Ae,Ue)|0;var Er=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Er>>>26)|0,Er&=67108863,ee=Math.imul(ut,He),Z=Math.imul(ut,Ve),Z=Z+Math.imul(ot,He)|0,ue=Math.imul(ot,Ve),ee=ee+Math.imul(et,xt)|0,Z=Z+Math.imul(et,mt)|0,Z=Z+Math.imul(Ze,xt)|0,ue=ue+Math.imul(Ze,mt)|0,ee=ee+Math.imul(Ge,at)|0,Z=Z+Math.imul(Ge,ht)|0,Z=Z+Math.imul(Xe,at)|0,ue=ue+Math.imul(Xe,ht)|0,ee=ee+Math.imul(Le,$t)|0,Z=Z+Math.imul(Le,St)|0,Z=Z+Math.imul(qe,$t)|0,ue=ue+Math.imul(qe,St)|0,ee=ee+Math.imul(Ie,At)|0,Z=Z+Math.imul(Ie,Oe)|0,Z=Z+Math.imul(Se,At)|0,ue=ue+Math.imul(Se,Oe)|0,ee=ee+Math.imul(be,ke)|0,Z=Z+Math.imul(be,Ue)|0,Z=Z+Math.imul(Te,ke)|0,ue=ue+Math.imul(Te,Ue)|0,ee=ee+Math.imul(Re,Qe)|0,Z=Z+Math.imul(Re,tt)|0,Z=Z+Math.imul(Ae,Qe)|0,ue=ue+Math.imul(Ae,tt)|0;var $r=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+($r>>>26)|0,$r&=67108863,ee=Math.imul(bt,He),Z=Math.imul(bt,Ve),Z=Z+Math.imul(lt,He)|0,ue=Math.imul(lt,Ve),ee=ee+Math.imul(ut,xt)|0,Z=Z+Math.imul(ut,mt)|0,Z=Z+Math.imul(ot,xt)|0,ue=ue+Math.imul(ot,mt)|0,ee=ee+Math.imul(et,at)|0,Z=Z+Math.imul(et,ht)|0,Z=Z+Math.imul(Ze,at)|0,ue=ue+Math.imul(Ze,ht)|0,ee=ee+Math.imul(Ge,$t)|0,Z=Z+Math.imul(Ge,St)|0,Z=Z+Math.imul(Xe,$t)|0,ue=ue+Math.imul(Xe,St)|0,ee=ee+Math.imul(Le,At)|0,Z=Z+Math.imul(Le,Oe)|0,Z=Z+Math.imul(qe,At)|0,ue=ue+Math.imul(qe,Oe)|0,ee=ee+Math.imul(Ie,ke)|0,Z=Z+Math.imul(Ie,Ue)|0,Z=Z+Math.imul(Se,ke)|0,ue=ue+Math.imul(Se,Ue)|0,ee=ee+Math.imul(be,Qe)|0,Z=Z+Math.imul(be,tt)|0,Z=Z+Math.imul(Te,Qe)|0,ue=ue+Math.imul(Te,tt)|0,ee=ee+Math.imul(Re,Nt)|0,Z=Z+Math.imul(Re,Rt)|0,Z=Z+Math.imul(Ae,Nt)|0,ue=ue+Math.imul(Ae,Rt)|0;var _r=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(_r>>>26)|0,_r&=67108863,ee=Math.imul(Ct,He),Z=Math.imul(Ct,Ve),Z=Z+Math.imul(Me,He)|0,ue=Math.imul(Me,Ve),ee=ee+Math.imul(bt,xt)|0,Z=Z+Math.imul(bt,mt)|0,Z=Z+Math.imul(lt,xt)|0,ue=ue+Math.imul(lt,mt)|0,ee=ee+Math.imul(ut,at)|0,Z=Z+Math.imul(ut,ht)|0,Z=Z+Math.imul(ot,at)|0,ue=ue+Math.imul(ot,ht)|0,ee=ee+Math.imul(et,$t)|0,Z=Z+Math.imul(et,St)|0,Z=Z+Math.imul(Ze,$t)|0,ue=ue+Math.imul(Ze,St)|0,ee=ee+Math.imul(Ge,At)|0,Z=Z+Math.imul(Ge,Oe)|0,Z=Z+Math.imul(Xe,At)|0,ue=ue+Math.imul(Xe,Oe)|0,ee=ee+Math.imul(Le,ke)|0,Z=Z+Math.imul(Le,Ue)|0,Z=Z+Math.imul(qe,ke)|0,ue=ue+Math.imul(qe,Ue)|0,ee=ee+Math.imul(Ie,Qe)|0,Z=Z+Math.imul(Ie,tt)|0,Z=Z+Math.imul(Se,Qe)|0,ue=ue+Math.imul(Se,tt)|0,ee=ee+Math.imul(be,Nt)|0,Z=Z+Math.imul(be,Rt)|0,Z=Z+Math.imul(Te,Nt)|0,ue=ue+Math.imul(Te,Rt)|0,ee=ee+Math.imul(Re,Tt)|0,Z=Z+Math.imul(Re,It)|0,Z=Z+Math.imul(Ae,Tt)|0,ue=ue+Math.imul(Ae,It)|0;var Jt=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Jt>>>26)|0,Jt&=67108863,ee=Math.imul(Ee,He),Z=Math.imul(Ee,Ve),Z=Z+Math.imul(Pe,He)|0,ue=Math.imul(Pe,Ve),ee=ee+Math.imul(Ct,xt)|0,Z=Z+Math.imul(Ct,mt)|0,Z=Z+Math.imul(Me,xt)|0,ue=ue+Math.imul(Me,mt)|0,ee=ee+Math.imul(bt,at)|0,Z=Z+Math.imul(bt,ht)|0,Z=Z+Math.imul(lt,at)|0,ue=ue+Math.imul(lt,ht)|0,ee=ee+Math.imul(ut,$t)|0,Z=Z+Math.imul(ut,St)|0,Z=Z+Math.imul(ot,$t)|0,ue=ue+Math.imul(ot,St)|0,ee=ee+Math.imul(et,At)|0,Z=Z+Math.imul(et,Oe)|0,Z=Z+Math.imul(Ze,At)|0,ue=ue+Math.imul(Ze,Oe)|0,ee=ee+Math.imul(Ge,ke)|0,Z=Z+Math.imul(Ge,Ue)|0,Z=Z+Math.imul(Xe,ke)|0,ue=ue+Math.imul(Xe,Ue)|0,ee=ee+Math.imul(Le,Qe)|0,Z=Z+Math.imul(Le,tt)|0,Z=Z+Math.imul(qe,Qe)|0,ue=ue+Math.imul(qe,tt)|0,ee=ee+Math.imul(Ie,Nt)|0,Z=Z+Math.imul(Ie,Rt)|0,Z=Z+Math.imul(Se,Nt)|0,ue=ue+Math.imul(Se,Rt)|0,ee=ee+Math.imul(be,Tt)|0,Z=Z+Math.imul(be,It)|0,Z=Z+Math.imul(Te,Tt)|0,ue=ue+Math.imul(Te,It)|0,ee=ee+Math.imul(Re,jt)|0,Z=Z+Math.imul(Re,Ft)|0,Z=Z+Math.imul(Ae,jt)|0,ue=ue+Math.imul(Ae,Ft)|0;var Or=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Or>>>26)|0,Or&=67108863,ee=Math.imul(Ee,xt),Z=Math.imul(Ee,mt),Z=Z+Math.imul(Pe,xt)|0,ue=Math.imul(Pe,mt),ee=ee+Math.imul(Ct,at)|0,Z=Z+Math.imul(Ct,ht)|0,Z=Z+Math.imul(Me,at)|0,ue=ue+Math.imul(Me,ht)|0,ee=ee+Math.imul(bt,$t)|0,Z=Z+Math.imul(bt,St)|0,Z=Z+Math.imul(lt,$t)|0,ue=ue+Math.imul(lt,St)|0,ee=ee+Math.imul(ut,At)|0,Z=Z+Math.imul(ut,Oe)|0,Z=Z+Math.imul(ot,At)|0,ue=ue+Math.imul(ot,Oe)|0,ee=ee+Math.imul(et,ke)|0,Z=Z+Math.imul(et,Ue)|0,Z=Z+Math.imul(Ze,ke)|0,ue=ue+Math.imul(Ze,Ue)|0,ee=ee+Math.imul(Ge,Qe)|0,Z=Z+Math.imul(Ge,tt)|0,Z=Z+Math.imul(Xe,Qe)|0,ue=ue+Math.imul(Xe,tt)|0,ee=ee+Math.imul(Le,Nt)|0,Z=Z+Math.imul(Le,Rt)|0,Z=Z+Math.imul(qe,Nt)|0,ue=ue+Math.imul(qe,Rt)|0,ee=ee+Math.imul(Ie,Tt)|0,Z=Z+Math.imul(Ie,It)|0,Z=Z+Math.imul(Se,Tt)|0,ue=ue+Math.imul(Se,It)|0,ee=ee+Math.imul(be,jt)|0,Z=Z+Math.imul(be,Ft)|0,Z=Z+Math.imul(Te,jt)|0,ue=ue+Math.imul(Te,Ft)|0;var Dr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Dr>>>26)|0,Dr&=67108863,ee=Math.imul(Ee,at),Z=Math.imul(Ee,ht),Z=Z+Math.imul(Pe,at)|0,ue=Math.imul(Pe,ht),ee=ee+Math.imul(Ct,$t)|0,Z=Z+Math.imul(Ct,St)|0,Z=Z+Math.imul(Me,$t)|0,ue=ue+Math.imul(Me,St)|0,ee=ee+Math.imul(bt,At)|0,Z=Z+Math.imul(bt,Oe)|0,Z=Z+Math.imul(lt,At)|0,ue=ue+Math.imul(lt,Oe)|0,ee=ee+Math.imul(ut,ke)|0,Z=Z+Math.imul(ut,Ue)|0,Z=Z+Math.imul(ot,ke)|0,ue=ue+Math.imul(ot,Ue)|0,ee=ee+Math.imul(et,Qe)|0,Z=Z+Math.imul(et,tt)|0,Z=Z+Math.imul(Ze,Qe)|0,ue=ue+Math.imul(Ze,tt)|0,ee=ee+Math.imul(Ge,Nt)|0,Z=Z+Math.imul(Ge,Rt)|0,Z=Z+Math.imul(Xe,Nt)|0,ue=ue+Math.imul(Xe,Rt)|0,ee=ee+Math.imul(Le,Tt)|0,Z=Z+Math.imul(Le,It)|0,Z=Z+Math.imul(qe,Tt)|0,ue=ue+Math.imul(qe,It)|0,ee=ee+Math.imul(Ie,jt)|0,Z=Z+Math.imul(Ie,Ft)|0,Z=Z+Math.imul(Se,jt)|0,ue=ue+Math.imul(Se,Ft)|0;var br=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(br>>>26)|0,br&=67108863,ee=Math.imul(Ee,$t),Z=Math.imul(Ee,St),Z=Z+Math.imul(Pe,$t)|0,ue=Math.imul(Pe,St),ee=ee+Math.imul(Ct,At)|0,Z=Z+Math.imul(Ct,Oe)|0,Z=Z+Math.imul(Me,At)|0,ue=ue+Math.imul(Me,Oe)|0,ee=ee+Math.imul(bt,ke)|0,Z=Z+Math.imul(bt,Ue)|0,Z=Z+Math.imul(lt,ke)|0,ue=ue+Math.imul(lt,Ue)|0,ee=ee+Math.imul(ut,Qe)|0,Z=Z+Math.imul(ut,tt)|0,Z=Z+Math.imul(ot,Qe)|0,ue=ue+Math.imul(ot,tt)|0,ee=ee+Math.imul(et,Nt)|0,Z=Z+Math.imul(et,Rt)|0,Z=Z+Math.imul(Ze,Nt)|0,ue=ue+Math.imul(Ze,Rt)|0,ee=ee+Math.imul(Ge,Tt)|0,Z=Z+Math.imul(Ge,It)|0,Z=Z+Math.imul(Xe,Tt)|0,ue=ue+Math.imul(Xe,It)|0,ee=ee+Math.imul(Le,jt)|0,Z=Z+Math.imul(Le,Ft)|0,Z=Z+Math.imul(qe,jt)|0,ue=ue+Math.imul(qe,Ft)|0;var Sr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Sr>>>26)|0,Sr&=67108863,ee=Math.imul(Ee,At),Z=Math.imul(Ee,Oe),Z=Z+Math.imul(Pe,At)|0,ue=Math.imul(Pe,Oe),ee=ee+Math.imul(Ct,ke)|0,Z=Z+Math.imul(Ct,Ue)|0,Z=Z+Math.imul(Me,ke)|0,ue=ue+Math.imul(Me,Ue)|0,ee=ee+Math.imul(bt,Qe)|0,Z=Z+Math.imul(bt,tt)|0,Z=Z+Math.imul(lt,Qe)|0,ue=ue+Math.imul(lt,tt)|0,ee=ee+Math.imul(ut,Nt)|0,Z=Z+Math.imul(ut,Rt)|0,Z=Z+Math.imul(ot,Nt)|0,ue=ue+Math.imul(ot,Rt)|0,ee=ee+Math.imul(et,Tt)|0,Z=Z+Math.imul(et,It)|0,Z=Z+Math.imul(Ze,Tt)|0,ue=ue+Math.imul(Ze,It)|0,ee=ee+Math.imul(Ge,jt)|0,Z=Z+Math.imul(Ge,Ft)|0,Z=Z+Math.imul(Xe,jt)|0,ue=ue+Math.imul(Xe,Ft)|0;var Vr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Vr>>>26)|0,Vr&=67108863,ee=Math.imul(Ee,ke),Z=Math.imul(Ee,Ue),Z=Z+Math.imul(Pe,ke)|0,ue=Math.imul(Pe,Ue),ee=ee+Math.imul(Ct,Qe)|0,Z=Z+Math.imul(Ct,tt)|0,Z=Z+Math.imul(Me,Qe)|0,ue=ue+Math.imul(Me,tt)|0,ee=ee+Math.imul(bt,Nt)|0,Z=Z+Math.imul(bt,Rt)|0,Z=Z+Math.imul(lt,Nt)|0,ue=ue+Math.imul(lt,Rt)|0,ee=ee+Math.imul(ut,Tt)|0,Z=Z+Math.imul(ut,It)|0,Z=Z+Math.imul(ot,Tt)|0,ue=ue+Math.imul(ot,It)|0,ee=ee+Math.imul(et,jt)|0,Z=Z+Math.imul(et,Ft)|0,Z=Z+Math.imul(Ze,jt)|0,ue=ue+Math.imul(Ze,Ft)|0;var Br=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Br>>>26)|0,Br&=67108863,ee=Math.imul(Ee,Qe),Z=Math.imul(Ee,tt),Z=Z+Math.imul(Pe,Qe)|0,ue=Math.imul(Pe,tt),ee=ee+Math.imul(Ct,Nt)|0,Z=Z+Math.imul(Ct,Rt)|0,Z=Z+Math.imul(Me,Nt)|0,ue=ue+Math.imul(Me,Rt)|0,ee=ee+Math.imul(bt,Tt)|0,Z=Z+Math.imul(bt,It)|0,Z=Z+Math.imul(lt,Tt)|0,ue=ue+Math.imul(lt,It)|0,ee=ee+Math.imul(ut,jt)|0,Z=Z+Math.imul(ut,Ft)|0,Z=Z+Math.imul(ot,jt)|0,ue=ue+Math.imul(ot,Ft)|0;var Lr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Lr>>>26)|0,Lr&=67108863,ee=Math.imul(Ee,Nt),Z=Math.imul(Ee,Rt),Z=Z+Math.imul(Pe,Nt)|0,ue=Math.imul(Pe,Rt),ee=ee+Math.imul(Ct,Tt)|0,Z=Z+Math.imul(Ct,It)|0,Z=Z+Math.imul(Me,Tt)|0,ue=ue+Math.imul(Me,It)|0,ee=ee+Math.imul(bt,jt)|0,Z=Z+Math.imul(bt,Ft)|0,Z=Z+Math.imul(lt,jt)|0,ue=ue+Math.imul(lt,Ft)|0;var Gr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Gr>>>26)|0,Gr&=67108863,ee=Math.imul(Ee,Tt),Z=Math.imul(Ee,It),Z=Z+Math.imul(Pe,Tt)|0,ue=Math.imul(Pe,It),ee=ee+Math.imul(Ct,jt)|0,Z=Z+Math.imul(Ct,Ft)|0,Z=Z+Math.imul(Me,jt)|0,ue=ue+Math.imul(Me,Ft)|0;var tn=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(tn>>>26)|0,tn&=67108863,ee=Math.imul(Ee,jt),Z=Math.imul(Ee,Ft),Z=Z+Math.imul(Pe,jt)|0,ue=Math.imul(Pe,Ft);var rn=(se+ee|0)+((Z&8191)<<13)|0;return se=(ue+(Z>>>13)|0)+(rn>>>26)|0,rn&=67108863,ne[0]=Kr,ne[1]=Mr,ne[2]=Cr,ne[3]=Pr,ne[4]=wr,ne[5]=Er,ne[6]=$r,ne[7]=_r,ne[8]=Jt,ne[9]=Or,ne[10]=Dr,ne[11]=br,ne[12]=Sr,ne[13]=Vr,ne[14]=Br,ne[15]=Lr,ne[16]=Gr,ne[17]=tn,ne[18]=rn,se!==0&&(ne[19]=se,re.length++),re};Math.imul||(ie=J);function oe(Q,j,z){z.negative=j.negative^Q.negative,z.length=Q.length+j.length;for(var re=0,Y=0,te=0;te<z.length-1;te++){var ne=Y;Y=0;for(var se=re&67108863,ee=Math.min(te,j.length-1),Z=Math.max(0,te-Q.length+1);Z<=ee;Z++){var ue=te-Z,_e=Q.words[ue]|0,Re=j.words[Z]|0,Ae=_e*Re,ge=Ae&67108863;ne=ne+(Ae/67108864|0)|0,ge=ge+se|0,se=ge&67108863,ne=ne+(ge>>>26)|0,Y+=ne>>>26,ne&=67108863}z.words[te]=se,re=ne,ne=Y}return re!==0?z.words[te]=re:z.length--,z._strip()}function le(Q,j,z){return oe(Q,j,z)}w.prototype.mulTo=function(j,z){var re,Y=this.length+j.length;return this.length===10&&j.length===10?re=ie(this,j,z):Y<63?re=J(this,j,z):Y<1024?re=oe(this,j,z):re=le(this,j,z),re},w.prototype.mul=function(j){var z=new w(null);return z.words=new Array(this.length+j.length),this.mulTo(j,z)},w.prototype.mulf=function(j){var z=new w(null);return z.words=new Array(this.length+j.length),le(this,j,z)},w.prototype.imul=function(j){return this.clone().mulTo(j,this)},w.prototype.imuln=function(j){var z=j<0;z&&(j=-j),v(typeof j=="number"),v(j<67108864);for(var re=0,Y=0;Y<this.length;Y++){var te=(this.words[Y]|0)*j,ne=(te&67108863)+(re&67108863);re>>=26,re+=te/67108864|0,re+=ne>>>26,this.words[Y]=ne&67108863}return re!==0&&(this.words[Y]=re,this.length++),this.length=j===0?1:this.length,z?this.ineg():this},w.prototype.muln=function(j){return this.clone().imuln(j)},w.prototype.sqr=function(){return this.mul(this)},w.prototype.isqr=function(){return this.imul(this.clone())},w.prototype.pow=function(j){var z=q(j);if(z.length===0)return new w(1);for(var re=this,Y=0;Y<z.length&&z[Y]===0;Y++,re=re.sqr());if(++Y<z.length)for(var te=re.sqr();Y<z.length;Y++,te=te.sqr())z[Y]!==0&&(re=re.mul(te));return re},w.prototype.iushln=function(j){v(typeof j=="number"&&j>=0);var z=j%26,re=(j-z)/26,Y=67108863>>>26-z<<26-z,te;if(z!==0){var ne=0;for(te=0;te<this.length;te++){var se=this.words[te]&Y,ee=(this.words[te]|0)-se<<z;this.words[te]=ee|ne,ne=se>>>26-z}ne&&(this.words[te]=ne,this.length++)}if(re!==0){for(te=this.length-1;te>=0;te--)this.words[te+re]=this.words[te];for(te=0;te<re;te++)this.words[te]=0;this.length+=re}return this._strip()},w.prototype.ishln=function(j){return v(this.negative===0),this.iushln(j)},w.prototype.iushrn=function(j,z,re){v(typeof j=="number"&&j>=0);var Y;z?Y=(z-z%26)/26:Y=0;var te=j%26,ne=Math.min((j-te)/26,this.length),se=67108863^67108863>>>te<<te,ee=re;if(Y-=ne,Y=Math.max(0,Y),ee){for(var Z=0;Z<ne;Z++)ee.words[Z]=this.words[Z];ee.length=ne}if(ne!==0)if(this.length>ne)for(this.length-=ne,Z=0;Z<this.length;Z++)this.words[Z]=this.words[Z+ne];else this.words[0]=0,this.length=1;var ue=0;for(Z=this.length-1;Z>=0&&(ue!==0||Z>=Y);Z--){var _e=this.words[Z]|0;this.words[Z]=ue<<26-te|_e>>>te,ue=_e&se}return ee&&ue!==0&&(ee.words[ee.length++]=ue),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},w.prototype.ishrn=function(j,z,re){return v(this.negative===0),this.iushrn(j,z,re)},w.prototype.shln=function(j){return this.clone().ishln(j)},w.prototype.ushln=function(j){return this.clone().iushln(j)},w.prototype.shrn=function(j){return this.clone().ishrn(j)},w.prototype.ushrn=function(j){return this.clone().iushrn(j)},w.prototype.testn=function(j){v(typeof j=="number"&&j>=0);var z=j%26,re=(j-z)/26,Y=1<<z;if(this.length<=re)return!1;var te=this.words[re];return!!(te&Y)},w.prototype.imaskn=function(j){v(typeof j=="number"&&j>=0);var z=j%26,re=(j-z)/26;if(v(this.negative===0,"imaskn works only with positive numbers"),this.length<=re)return this;if(z!==0&&re++,this.length=Math.min(re,this.length),z!==0){var Y=67108863^67108863>>>z<<z;this.words[this.length-1]&=Y}return this._strip()},w.prototype.maskn=function(j){return this.clone().imaskn(j)},w.prototype.iaddn=function(j){return v(typeof j=="number"),v(j<67108864),j<0?this.isubn(-j):this.negative!==0?this.length===1&&(this.words[0]|0)<=j?(this.words[0]=j-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(j),this.negative=1,this):this._iaddn(j)},w.prototype._iaddn=function(j){this.words[0]+=j;for(var z=0;z<this.length&&this.words[z]>=67108864;z++)this.words[z]-=67108864,z===this.length-1?this.words[z+1]=1:this.words[z+1]++;return this.length=Math.max(this.length,z+1),this},w.prototype.isubn=function(j){if(v(typeof j=="number"),v(j<67108864),j<0)return this.iaddn(-j);if(this.negative!==0)return this.negative=0,this.iaddn(j),this.negative=1,this;if(this.words[0]-=j,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var z=0;z<this.length&&this.words[z]<0;z++)this.words[z]+=67108864,this.words[z+1]-=1;return this._strip()},w.prototype.addn=function(j){return this.clone().iaddn(j)},w.prototype.subn=function(j){return this.clone().isubn(j)},w.prototype.iabs=function(){return this.negative=0,this},w.prototype.abs=function(){return this.clone().iabs()},w.prototype._ishlnsubmul=function(j,z,re){var Y=j.length+re,te;this._expand(Y);var ne,se=0;for(te=0;te<j.length;te++){ne=(this.words[te+re]|0)+se;var ee=(j.words[te]|0)*z;ne-=ee&67108863,se=(ne>>26)-(ee/67108864|0),this.words[te+re]=ne&67108863}for(;te<this.length-re;te++)ne=(this.words[te+re]|0)+se,se=ne>>26,this.words[te+re]=ne&67108863;if(se===0)return this._strip();for(v(se===-1),se=0,te=0;te<this.length;te++)ne=-(this.words[te]|0)+se,se=ne>>26,this.words[te]=ne&67108863;return this.negative=1,this._strip()},w.prototype._wordDiv=function(j,z){var re=this.length-j.length,Y=this.clone(),te=j,ne=te.words[te.length-1]|0,se=this._countBits(ne);re=26-se,re!==0&&(te=te.ushln(re),Y.iushln(re),ne=te.words[te.length-1]|0);var ee=Y.length-te.length,Z;if(z!=="mod"){Z=new w(null),Z.length=ee+1,Z.words=new Array(Z.length);for(var ue=0;ue<Z.length;ue++)Z.words[ue]=0}var _e=Y.clone()._ishlnsubmul(te,1,ee);_e.negative===0&&(Y=_e,Z&&(Z.words[ee]=1));for(var Re=ee-1;Re>=0;Re--){var Ae=(Y.words[te.length+Re]|0)*67108864+(Y.words[te.length+Re-1]|0);for(Ae=Math.min(Ae/ne|0,67108863),Y._ishlnsubmul(te,Ae,Re);Y.negative!==0;)Ae--,Y.negative=0,Y._ishlnsubmul(te,1,Re),Y.isZero()||(Y.negative^=1);Z&&(Z.words[Re]=Ae)}return Z&&Z._strip(),Y._strip(),z!=="div"&&re!==0&&Y.iushrn(re),{div:Z||null,mod:Y}},w.prototype.divmod=function(j,z,re){if(v(!j.isZero()),this.isZero())return{div:new w(0),mod:new w(0)};var Y,te,ne;return this.negative!==0&&j.negative===0?(ne=this.neg().divmod(j,z),z!=="mod"&&(Y=ne.div.neg()),z!=="div"&&(te=ne.mod.neg(),re&&te.negative!==0&&te.iadd(j)),{div:Y,mod:te}):this.negative===0&&j.negative!==0?(ne=this.divmod(j.neg(),z),z!=="mod"&&(Y=ne.div.neg()),{div:Y,mod:ne.mod}):(this.negative&j.negative)!==0?(ne=this.neg().divmod(j.neg(),z),z!=="div"&&(te=ne.mod.neg(),re&&te.negative!==0&&te.isub(j)),{div:ne.div,mod:te}):j.length>this.length||this.cmp(j)<0?{div:new w(0),mod:this}:j.length===1?z==="div"?{div:this.divn(j.words[0]),mod:null}:z==="mod"?{div:null,mod:new w(this.modrn(j.words[0]))}:{div:this.divn(j.words[0]),mod:new w(this.modrn(j.words[0]))}:this._wordDiv(j,z)},w.prototype.div=function(j){return this.divmod(j,"div",!1).div},w.prototype.mod=function(j){return this.divmod(j,"mod",!1).mod},w.prototype.umod=function(j){return this.divmod(j,"mod",!0).mod},w.prototype.divRound=function(j){var z=this.divmod(j);if(z.mod.isZero())return z.div;var re=z.div.negative!==0?z.mod.isub(j):z.mod,Y=j.ushrn(1),te=j.andln(1),ne=re.cmp(Y);return ne<0||te===1&&ne===0?z.div:z.div.negative!==0?z.div.isubn(1):z.div.iaddn(1)},w.prototype.modrn=function(j){var z=j<0;z&&(j=-j),v(j<=67108863);for(var re=(1<<26)%j,Y=0,te=this.length-1;te>=0;te--)Y=(re*Y+(this.words[te]|0))%j;return z?-Y:Y},w.prototype.modn=function(j){return this.modrn(j)},w.prototype.idivn=function(j){var z=j<0;z&&(j=-j),v(j<=67108863);for(var re=0,Y=this.length-1;Y>=0;Y--){var te=(this.words[Y]|0)+re*67108864;this.words[Y]=te/j|0,re=te%j}return this._strip(),z?this.ineg():this},w.prototype.divn=function(j){return this.clone().idivn(j)},w.prototype.egcd=function(j){v(j.negative===0),v(!j.isZero());var z=this,re=j.clone();z.negative!==0?z=z.umod(j):z=z.clone();for(var Y=new w(1),te=new w(0),ne=new w(0),se=new w(1),ee=0;z.isEven()&&re.isEven();)z.iushrn(1),re.iushrn(1),++ee;for(var Z=re.clone(),ue=z.clone();!z.isZero();){for(var _e=0,Re=1;(z.words[0]&Re)===0&&_e<26;++_e,Re<<=1);if(_e>0)for(z.iushrn(_e);_e-- >0;)(Y.isOdd()||te.isOdd())&&(Y.iadd(Z),te.isub(ue)),Y.iushrn(1),te.iushrn(1);for(var Ae=0,ge=1;(re.words[0]&ge)===0&&Ae<26;++Ae,ge<<=1);if(Ae>0)for(re.iushrn(Ae);Ae-- >0;)(ne.isOdd()||se.isOdd())&&(ne.iadd(Z),se.isub(ue)),ne.iushrn(1),se.iushrn(1);z.cmp(re)>=0?(z.isub(re),Y.isub(ne),te.isub(se)):(re.isub(z),ne.isub(Y),se.isub(te))}return{a:ne,b:se,gcd:re.iushln(ee)}},w.prototype._invmp=function(j){v(j.negative===0),v(!j.isZero());var z=this,re=j.clone();z.negative!==0?z=z.umod(j):z=z.clone();for(var Y=new w(1),te=new w(0),ne=re.clone();z.cmpn(1)>0&&re.cmpn(1)>0;){for(var se=0,ee=1;(z.words[0]&ee)===0&&se<26;++se,ee<<=1);if(se>0)for(z.iushrn(se);se-- >0;)Y.isOdd()&&Y.iadd(ne),Y.iushrn(1);for(var Z=0,ue=1;(re.words[0]&ue)===0&&Z<26;++Z,ue<<=1);if(Z>0)for(re.iushrn(Z);Z-- >0;)te.isOdd()&&te.iadd(ne),te.iushrn(1);z.cmp(re)>=0?(z.isub(re),Y.isub(te)):(re.isub(z),te.isub(Y))}var _e;return z.cmpn(1)===0?_e=Y:_e=te,_e.cmpn(0)<0&&_e.iadd(j),_e},w.prototype.gcd=function(j){if(this.isZero())return j.abs();if(j.isZero())return this.abs();var z=this.clone(),re=j.clone();z.negative=0,re.negative=0;for(var Y=0;z.isEven()&&re.isEven();Y++)z.iushrn(1),re.iushrn(1);do{for(;z.isEven();)z.iushrn(1);for(;re.isEven();)re.iushrn(1);var te=z.cmp(re);if(te<0){var ne=z;z=re,re=ne}else if(te===0||re.cmpn(1)===0)break;z.isub(re)}while(!0);return re.iushln(Y)},w.prototype.invm=function(j){return this.egcd(j).a.umod(j)},w.prototype.isEven=function(){return(this.words[0]&1)===0},w.prototype.isOdd=function(){return(this.words[0]&1)===1},w.prototype.andln=function(j){return this.words[0]&j},w.prototype.bincn=function(j){v(typeof j=="number");var z=j%26,re=(j-z)/26,Y=1<<z;if(this.length<=re)return this._expand(re+1),this.words[re]|=Y,this;for(var te=Y,ne=re;te!==0&&ne<this.length;ne++){var se=this.words[ne]|0;se+=te,te=se>>>26,se&=67108863,this.words[ne]=se}return te!==0&&(this.words[ne]=te,this.length++),this},w.prototype.isZero=function(){return this.length===1&&this.words[0]===0},w.prototype.cmpn=function(j){var z=j<0;if(this.negative!==0&&!z)return-1;if(this.negative===0&&z)return 1;this._strip();var re;if(this.length>1)re=1;else{z&&(j=-j),v(j<=67108863,"Number is too big");var Y=this.words[0]|0;re=Y===j?0:Y<j?-1:1}return this.negative!==0?-re|0:re},w.prototype.cmp=function(j){if(this.negative!==0&&j.negative===0)return-1;if(this.negative===0&&j.negative!==0)return 1;var z=this.ucmp(j);return this.negative!==0?-z|0:z},w.prototype.ucmp=function(j){if(this.length>j.length)return 1;if(this.length<j.length)return-1;for(var z=0,re=this.length-1;re>=0;re--){var Y=this.words[re]|0,te=j.words[re]|0;if(Y!==te){Y<te?z=-1:Y>te&&(z=1);break}}return z},w.prototype.gtn=function(j){return this.cmpn(j)===1},w.prototype.gt=function(j){return this.cmp(j)===1},w.prototype.gten=function(j){return this.cmpn(j)>=0},w.prototype.gte=function(j){return this.cmp(j)>=0},w.prototype.ltn=function(j){return this.cmpn(j)===-1},w.prototype.lt=function(j){return this.cmp(j)===-1},w.prototype.lten=function(j){return this.cmpn(j)<=0},w.prototype.lte=function(j){return this.cmp(j)<=0},w.prototype.eqn=function(j){return this.cmpn(j)===0},w.prototype.eq=function(j){return this.cmp(j)===0},w.red=function(j){return new he(j)},w.prototype.toRed=function(j){return v(!this.red,"Already a number in reduction context"),v(this.negative===0,"red works only with positives"),j.convertTo(this)._forceRed(j)},w.prototype.fromRed=function(){return v(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},w.prototype._forceRed=function(j){return this.red=j,this},w.prototype.forceRed=function(j){return v(!this.red,"Already a number in reduction context"),this._forceRed(j)},w.prototype.redAdd=function(j){return v(this.red,"redAdd works only with red numbers"),this.red.add(this,j)},w.prototype.redIAdd=function(j){return v(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,j)},w.prototype.redSub=function(j){return v(this.red,"redSub works only with red numbers"),this.red.sub(this,j)},w.prototype.redISub=function(j){return v(this.red,"redISub works only with red numbers"),this.red.isub(this,j)},w.prototype.redShl=function(j){return v(this.red,"redShl works only with red numbers"),this.red.shl(this,j)},w.prototype.redMul=function(j){return v(this.red,"redMul works only with red numbers"),this.red._verify2(this,j),this.red.mul(this,j)},w.prototype.redIMul=function(j){return v(this.red,"redMul works only with red numbers"),this.red._verify2(this,j),this.red.imul(this,j)},w.prototype.redSqr=function(){return v(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},w.prototype.redISqr=function(){return v(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},w.prototype.redSqrt=function(){return v(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},w.prototype.redInvm=function(){return v(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},w.prototype.redNeg=function(){return v(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},w.prototype.redPow=function(j){return v(this.red&&!j.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,j)};var de={k256:null,p224:null,p192:null,p25519:null};function fe(Q,j){this.name=Q,this.p=new w(j,16),this.n=this.p.bitLength(),this.k=new w(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}fe.prototype._tmp=function(){var j=new w(null);return j.words=new Array(Math.ceil(this.n/13)),j},fe.prototype.ireduce=function(j){var z=j,re;do this.split(z,this.tmp),z=this.imulK(z),z=z.iadd(this.tmp),re=z.bitLength();while(re>this.n);var Y=re<this.n?-1:z.ucmp(this.p);return Y===0?(z.words[0]=0,z.length=1):Y>0?z.isub(this.p):z.strip!==void 0?z.strip():z._strip(),z},fe.prototype.split=function(j,z){j.iushrn(this.n,0,z)},fe.prototype.imulK=function(j){return j.imul(this.k)};function ye(){fe.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}b(ye,fe),ye.prototype.split=function(j,z){for(var re=4194303,Y=Math.min(j.length,9),te=0;te<Y;te++)z.words[te]=j.words[te];if(z.length=Y,j.length<=9){j.words[0]=0,j.length=1;return}var ne=j.words[9];for(z.words[z.length++]=ne&re,te=10;te<j.length;te++){var se=j.words[te]|0;j.words[te-10]=(se&re)<<4|ne>>>22,ne=se}ne>>>=22,j.words[te-10]=ne,ne===0&&j.length>10?j.length-=10:j.length-=9},ye.prototype.imulK=function(j){j.words[j.length]=0,j.words[j.length+1]=0,j.length+=2;for(var z=0,re=0;re<j.length;re++){var Y=j.words[re]|0;z+=Y*977,j.words[re]=z&67108863,z=Y*64+(z/67108864|0)}return j.words[j.length-1]===0&&(j.length--,j.words[j.length-1]===0&&j.length--),j};function we(){fe.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}b(we,fe);function pe(){fe.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}b(pe,fe);function ve(){fe.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}b(ve,fe),ve.prototype.imulK=function(j){for(var z=0,re=0;re<j.length;re++){var Y=(j.words[re]|0)*19+z,te=Y&67108863;Y>>>=26,j.words[re]=te,z=Y}return z!==0&&(j.words[j.length++]=z),j},w._prime=function(j){if(de[j])return de[j];var z;if(j==="k256")z=new ye;else if(j==="p224")z=new we;else if(j==="p192")z=new pe;else if(j==="p25519")z=new ve;else throw new Error("Unknown prime "+j);return de[j]=z,z};function he(Q){if(typeof Q=="string"){var j=w._prime(Q);this.m=j.p,this.prime=j}else v(Q.gtn(1),"modulus must be greater than 1"),this.m=Q,this.prime=null}he.prototype._verify1=function(j){v(j.negative===0,"red works only with positives"),v(j.red,"red works only with red numbers")},he.prototype._verify2=function(j,z){v((j.negative|z.negative)===0,"red works only with positives"),v(j.red&&j.red===z.red,"red works only with red numbers")},he.prototype.imod=function(j){return this.prime?this.prime.ireduce(j)._forceRed(this):(R(j,j.umod(this.m)._forceRed(this)),j)},he.prototype.neg=function(j){return j.isZero()?j.clone():this.m.sub(j)._forceRed(this)},he.prototype.add=function(j,z){this._verify2(j,z);var re=j.add(z);return re.cmp(this.m)>=0&&re.isub(this.m),re._forceRed(this)},he.prototype.iadd=function(j,z){this._verify2(j,z);var re=j.iadd(z);return re.cmp(this.m)>=0&&re.isub(this.m),re},he.prototype.sub=function(j,z){this._verify2(j,z);var re=j.sub(z);return re.cmpn(0)<0&&re.iadd(this.m),re._forceRed(this)},he.prototype.isub=function(j,z){this._verify2(j,z);var re=j.isub(z);return re.cmpn(0)<0&&re.iadd(this.m),re},he.prototype.shl=function(j,z){return this._verify1(j),this.imod(j.ushln(z))},he.prototype.imul=function(j,z){return this._verify2(j,z),this.imod(j.imul(z))},he.prototype.mul=function(j,z){return this._verify2(j,z),this.imod(j.mul(z))},he.prototype.isqr=function(j){return this.imul(j,j.clone())},he.prototype.sqr=function(j){return this.mul(j,j)},he.prototype.sqrt=function(j){if(j.isZero())return j.clone();var z=this.m.andln(3);if(v(z%2===1),z===3){var re=this.m.add(new w(1)).iushrn(2);return this.pow(j,re)}for(var Y=this.m.subn(1),te=0;!Y.isZero()&&Y.andln(1)===0;)te++,Y.iushrn(1);v(!Y.isZero());var ne=new w(1).toRed(this),se=ne.redNeg(),ee=this.m.subn(1).iushrn(1),Z=this.m.bitLength();for(Z=new w(2*Z*Z).toRed(this);this.pow(Z,ee).cmp(se)!==0;)Z.redIAdd(se);for(var ue=this.pow(Z,Y),_e=this.pow(j,Y.addn(1).iushrn(1)),Re=this.pow(j,Y),Ae=te;Re.cmp(ne)!==0;){for(var ge=Re,be=0;ge.cmp(ne)!==0;be++)ge=ge.redSqr();v(be<Ae);var Te=this.pow(ue,new w(1).iushln(Ae-be-1));_e=_e.redMul(Te),ue=Te.redSqr(),Re=Re.redMul(ue),Ae=be}return _e},he.prototype.invm=function(j){var z=j._invmp(this.m);return z.negative!==0?(z.negative=0,this.imod(z).redNeg()):this.imod(z)},he.prototype.pow=function(j,z){if(z.isZero())return new w(1).toRed(this);if(z.cmpn(1)===0)return j.clone();var re=4,Y=new Array(1<<re);Y[0]=new w(1).toRed(this),Y[1]=j;for(var te=2;te<Y.length;te++)Y[te]=this.mul(Y[te-1],j);var ne=Y[0],se=0,ee=0,Z=z.bitLength()%26;for(Z===0&&(Z=26),te=z.length-1;te>=0;te--){for(var ue=z.words[te],_e=Z-1;_e>=0;_e--){var Re=ue>>_e&1;if(ne!==Y[0]&&(ne=this.sqr(ne)),Re===0&&se===0){ee=0;continue}se<<=1,se|=Re,ee++,!(ee!==re&&(te!==0||_e!==0))&&(ne=this.mul(ne,Y[se]),ee=0,se=0)}Z=26}return ne},he.prototype.convertTo=function(j){var z=j.umod(this.m);return z===j?z.clone():z},he.prototype.convertFrom=function(j){var z=j.clone();return z.red=null,z},w.mont=function(j){return new ae(j)};function ae(Q){he.call(this,Q),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new w(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b(ae,he),ae.prototype.convertTo=function(j){return this.imod(j.ushln(this.shift))},ae.prototype.convertFrom=function(j){var z=this.imod(j.mul(this.rinv));return z.red=null,z},ae.prototype.imul=function(j,z){if(j.isZero()||z.isZero())return j.words[0]=0,j.length=1,j;var re=j.imul(z),Y=re.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),te=re.isub(Y).iushrn(this.shift),ne=te;return te.cmp(this.m)>=0?ne=te.isub(this.m):te.cmpn(0)<0&&(ne=te.iadd(this.m)),ne._forceRed(this)},ae.prototype.mul=function(j,z){if(j.isZero()||z.isZero())return new w(0)._forceRed(this);var re=j.mul(z),Y=re.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),te=re.isub(Y).iushrn(this.shift),ne=te;return te.cmp(this.m)>=0?ne=te.isub(this.m):te.cmpn(0)<0&&(ne=te.iadd(this.m)),ne._forceRed(this)},ae.prototype.invm=function(j){var z=this.imod(j._invmp(this.m).mul(this.r2));return z._forceRed(this)}})(y,bn$2)})(bn$3)),bn$3.exports}var browserifyRsa,hasRequiredBrowserifyRsa;function requireBrowserifyRsa(){if(hasRequiredBrowserifyRsa)return browserifyRsa;hasRequiredBrowserifyRsa=1;var y=requireBn$1(),u=requireBrowser$d(),g=requireSafeBuffer$2().Buffer;function v(E){var S=E.modulus.byteLength(),A;do A=new y(u(S));while(A.cmp(E.modulus)>=0||!A.umod(E.prime1)||!A.umod(E.prime2));return A}function b(E){var S=v(E),A=S.toRed(y.mont(E.modulus)).redPow(new y(E.publicExponent)).fromRed();return{blinder:A,unblinder:S.invm(E.modulus)}}function w(E,S){var A=b(S),$=S.modulus.byteLength(),R=new y(E).mul(A.blinder).umod(S.modulus),T=R.toRed(y.mont(S.prime1)),O=R.toRed(y.mont(S.prime2)),B=S.coefficient,F=S.prime1,U=S.prime2,q=T.redPow(S.exponent1).fromRed(),J=O.redPow(S.exponent2).fromRed(),ie=q.isub(J).imul(B).umod(F).imul(U);return J.iadd(ie).imul(A.unblinder).umod(S.modulus).toArrayLike(g,"be",$)}return w.getr=v,browserifyRsa=w,browserifyRsa}var elliptic$1={};const version$3="6.6.1",require$$0={version:version$3};var utils$3={},utils$2={},hasRequiredUtils$2;function requireUtils$2(){return hasRequiredUtils$2||(hasRequiredUtils$2=1,(function(y){var u=y;function g(w,E){if(Array.isArray(w))return w.slice();if(!w)return[];var S=[];if(typeof w!="string"){for(var A=0;A<w.length;A++)S[A]=w[A]|0;return S}if(E==="hex"){w=w.replace(/[^a-z0-9]+/ig,""),w.length%2!==0&&(w="0"+w);for(var A=0;A<w.length;A+=2)S.push(parseInt(w[A]+w[A+1],16))}else for(var A=0;A<w.length;A++){var $=w.charCodeAt(A),R=$>>8,T=$&255;R?S.push(R,T):S.push(T)}return S}u.toArray=g;function v(w){return w.length===1?"0"+w:w}u.zero2=v;function b(w){for(var E="",S=0;S<w.length;S++)E+=v(w[S].toString(16));return E}u.toHex=b,u.encode=function(E,S){return S==="hex"?b(E):E}})(utils$2)),utils$2}var hasRequiredUtils$1;function requireUtils$1(){return hasRequiredUtils$1||(hasRequiredUtils$1=1,(function(y){var u=y,g=requireBn$2(),v=requireMinimalisticAssert(),b=requireUtils$2();u.assert=v,u.toArray=b.toArray,u.zero2=b.zero2,u.toHex=b.toHex,u.encode=b.encode;function w(R,T,O){var B=new Array(Math.max(R.bitLength(),O)+1),F;for(F=0;F<B.length;F+=1)B[F]=0;var U=1<<T+1,q=R.clone();for(F=0;F<B.length;F++){var J,ie=q.andln(U-1);q.isOdd()?(ie>(U>>1)-1?J=(U>>1)-ie:J=ie,q.isubn(J)):J=0,B[F]=J,q.iushrn(1)}return B}u.getNAF=w;function E(R,T){var O=[[],[]];R=R.clone(),T=T.clone();for(var B=0,F=0,U;R.cmpn(-B)>0||T.cmpn(-F)>0;){var q=R.andln(3)+B&3,J=T.andln(3)+F&3;q===3&&(q=-1),J===3&&(J=-1);var ie;(q&1)===0?ie=0:(U=R.andln(7)+B&7,(U===3||U===5)&&J===2?ie=-q:ie=q),O[0].push(ie);var oe;(J&1)===0?oe=0:(U=T.andln(7)+F&7,(U===3||U===5)&&q===2?oe=-J:oe=J),O[1].push(oe),2*B===ie+1&&(B=1-B),2*F===oe+1&&(F=1-F),R.iushrn(1),T.iushrn(1)}return O}u.getJSF=E;function S(R,T,O){var B="_"+T;R.prototype[T]=function(){return this[B]!==void 0?this[B]:this[B]=O.call(this)}}u.cachedProperty=S;function A(R){return typeof R=="string"?u.toArray(R,"hex"):R}u.parseBytes=A;function $(R){return new g(R,"hex","le")}u.intFromLE=$})(utils$3)),utils$3}var curve={},base$2,hasRequiredBase$1;function requireBase$1(){if(hasRequiredBase$1)return base$2;hasRequiredBase$1=1;var y=requireBn$2(),u=requireUtils$1(),g=u.getNAF,v=u.getJSF,b=u.assert;function w(S,A){this.type=S,this.p=new y(A.p,16),this.red=A.prime?y.red(A.prime):y.mont(this.p),this.zero=new y(0).toRed(this.red),this.one=new y(1).toRed(this.red),this.two=new y(2).toRed(this.red),this.n=A.n&&new y(A.n,16),this.g=A.g&&this.pointFromJSON(A.g,A.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var $=this.n&&this.p.div(this.n);!$||$.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}base$2=w,w.prototype.point=function(){throw new Error("Not implemented")},w.prototype.validate=function(){throw new Error("Not implemented")},w.prototype._fixedNafMul=function(A,$){b(A.precomputed);var R=A._getDoubles(),T=g($,1,this._bitLength),O=(1<<R.step+1)-(R.step%2===0?2:1);O/=3;var B=[],F,U;for(F=0;F<T.length;F+=R.step){U=0;for(var q=F+R.step-1;q>=F;q--)U=(U<<1)+T[q];B.push(U)}for(var J=this.jpoint(null,null,null),ie=this.jpoint(null,null,null),oe=O;oe>0;oe--){for(F=0;F<B.length;F++)U=B[F],U===oe?ie=ie.mixedAdd(R.points[F]):U===-oe&&(ie=ie.mixedAdd(R.points[F].neg()));J=J.add(ie)}return J.toP()},w.prototype._wnafMul=function(A,$){var R=4,T=A._getNAFPoints(R);R=T.wnd;for(var O=T.points,B=g($,R,this._bitLength),F=this.jpoint(null,null,null),U=B.length-1;U>=0;U--){for(var q=0;U>=0&&B[U]===0;U--)q++;if(U>=0&&q++,F=F.dblp(q),U<0)break;var J=B[U];b(J!==0),A.type==="affine"?J>0?F=F.mixedAdd(O[J-1>>1]):F=F.mixedAdd(O[-J-1>>1].neg()):J>0?F=F.add(O[J-1>>1]):F=F.add(O[-J-1>>1].neg())}return A.type==="affine"?F.toP():F},w.prototype._wnafMulAdd=function(A,$,R,T,O){var B=this._wnafT1,F=this._wnafT2,U=this._wnafT3,q=0,J,ie,oe;for(J=0;J<T;J++){oe=$[J];var le=oe._getNAFPoints(A);B[J]=le.wnd,F[J]=le.points}for(J=T-1;J>=1;J-=2){var de=J-1,fe=J;if(B[de]!==1||B[fe]!==1){U[de]=g(R[de],B[de],this._bitLength),U[fe]=g(R[fe],B[fe],this._bitLength),q=Math.max(U[de].length,q),q=Math.max(U[fe].length,q);continue}var ye=[$[de],null,null,$[fe]];$[de].y.cmp($[fe].y)===0?(ye[1]=$[de].add($[fe]),ye[2]=$[de].toJ().mixedAdd($[fe].neg())):$[de].y.cmp($[fe].y.redNeg())===0?(ye[1]=$[de].toJ().mixedAdd($[fe]),ye[2]=$[de].add($[fe].neg())):(ye[1]=$[de].toJ().mixedAdd($[fe]),ye[2]=$[de].toJ().mixedAdd($[fe].neg()));var we=[-3,-1,-5,-7,0,7,5,1,3],pe=v(R[de],R[fe]);for(q=Math.max(pe[0].length,q),U[de]=new Array(q),U[fe]=new Array(q),ie=0;ie<q;ie++){var ve=pe[0][ie]|0,he=pe[1][ie]|0;U[de][ie]=we[(ve+1)*3+(he+1)],U[fe][ie]=0,F[de]=ye}}var ae=this.jpoint(null,null,null),Q=this._wnafT4;for(J=q;J>=0;J--){for(var j=0;J>=0;){var z=!0;for(ie=0;ie<T;ie++)Q[ie]=U[ie][J]|0,Q[ie]!==0&&(z=!1);if(!z)break;j++,J--}if(J>=0&&j++,ae=ae.dblp(j),J<0)break;for(ie=0;ie<T;ie++){var re=Q[ie];re!==0&&(re>0?oe=F[ie][re-1>>1]:re<0&&(oe=F[ie][-re-1>>1].neg()),oe.type==="affine"?ae=ae.mixedAdd(oe):ae=ae.add(oe))}}for(J=0;J<T;J++)F[J]=null;return O?ae:ae.toP()};function E(S,A){this.curve=S,this.type=A,this.precomputed=null}return w.BasePoint=E,E.prototype.eq=function(){throw new Error("Not implemented")},E.prototype.validate=function(){return this.curve.validate(this)},w.prototype.decodePoint=function(A,$){A=u.toArray(A,$);var R=this.p.byteLength();if((A[0]===4||A[0]===6||A[0]===7)&&A.length-1===2*R){A[0]===6?b(A[A.length-1]%2===0):A[0]===7&&b(A[A.length-1]%2===1);var T=this.point(A.slice(1,1+R),A.slice(1+R,1+2*R));return T}else if((A[0]===2||A[0]===3)&&A.length-1===R)return this.pointFromX(A.slice(1,1+R),A[0]===3);throw new Error("Unknown point format")},E.prototype.encodeCompressed=function(A){return this.encode(A,!0)},E.prototype._encode=function(A){var $=this.curve.p.byteLength(),R=this.getX().toArray("be",$);return A?[this.getY().isEven()?2:3].concat(R):[4].concat(R,this.getY().toArray("be",$))},E.prototype.encode=function(A,$){return u.encode(this._encode($),A)},E.prototype.precompute=function(A){if(this.precomputed)return this;var $={doubles:null,naf:null,beta:null};return $.naf=this._getNAFPoints(8),$.doubles=this._getDoubles(4,A),$.beta=this._getBeta(),this.precomputed=$,this},E.prototype._hasDoubles=function(A){if(!this.precomputed)return!1;var $=this.precomputed.doubles;return $?$.points.length>=Math.ceil((A.bitLength()+1)/$.step):!1},E.prototype._getDoubles=function(A,$){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var R=[this],T=this,O=0;O<$;O+=A){for(var B=0;B<A;B++)T=T.dbl();R.push(T)}return{step:A,points:R}},E.prototype._getNAFPoints=function(A){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var $=[this],R=(1<<A)-1,T=R===1?null:this.dbl(),O=1;O<R;O++)$[O]=$[O-1].add(T);return{wnd:A,points:$}},E.prototype._getBeta=function(){return null},E.prototype.dblp=function(A){for(var $=this,R=0;R<A;R++)$=$.dbl();return $},base$2}var short,hasRequiredShort;function requireShort(){if(hasRequiredShort)return short;hasRequiredShort=1;var y=requireUtils$1(),u=requireBn$2(),g=requireInherits_browser(),v=requireBase$1(),b=y.assert;function w(A){v.call(this,"short",A),this.a=new u(A.a,16).toRed(this.red),this.b=new u(A.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(A),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}g(w,v),short=w,w.prototype._getEndomorphism=function($){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var R,T;if($.beta)R=new u($.beta,16).toRed(this.red);else{var O=this._getEndoRoots(this.p);R=O[0].cmp(O[1])<0?O[0]:O[1],R=R.toRed(this.red)}if($.lambda)T=new u($.lambda,16);else{var B=this._getEndoRoots(this.n);this.g.mul(B[0]).x.cmp(this.g.x.redMul(R))===0?T=B[0]:(T=B[1],b(this.g.mul(T).x.cmp(this.g.x.redMul(R))===0))}var F;return $.basis?F=$.basis.map(function(U){return{a:new u(U.a,16),b:new u(U.b,16)}}):F=this._getEndoBasis(T),{beta:R,lambda:T,basis:F}}},w.prototype._getEndoRoots=function($){var R=$===this.p?this.red:u.mont($),T=new u(2).toRed(R).redInvm(),O=T.redNeg(),B=new u(3).toRed(R).redNeg().redSqrt().redMul(T),F=O.redAdd(B).fromRed(),U=O.redSub(B).fromRed();return[F,U]},w.prototype._getEndoBasis=function($){for(var R=this.n.ushrn(Math.floor(this.n.bitLength()/2)),T=$,O=this.n.clone(),B=new u(1),F=new u(0),U=new u(0),q=new u(1),J,ie,oe,le,de,fe,ye,we=0,pe,ve;T.cmpn(0)!==0;){var he=O.div(T);pe=O.sub(he.mul(T)),ve=U.sub(he.mul(B));var ae=q.sub(he.mul(F));if(!oe&&pe.cmp(R)<0)J=ye.neg(),ie=B,oe=pe.neg(),le=ve;else if(oe&&++we===2)break;ye=pe,O=T,T=pe,U=B,B=ve,q=F,F=ae}de=pe.neg(),fe=ve;var Q=oe.sqr().add(le.sqr()),j=de.sqr().add(fe.sqr());return j.cmp(Q)>=0&&(de=J,fe=ie),oe.negative&&(oe=oe.neg(),le=le.neg()),de.negative&&(de=de.neg(),fe=fe.neg()),[{a:oe,b:le},{a:de,b:fe}]},w.prototype._endoSplit=function($){var R=this.endo.basis,T=R[0],O=R[1],B=O.b.mul($).divRound(this.n),F=T.b.neg().mul($).divRound(this.n),U=B.mul(T.a),q=F.mul(O.a),J=B.mul(T.b),ie=F.mul(O.b),oe=$.sub(U).sub(q),le=J.add(ie).neg();return{k1:oe,k2:le}},w.prototype.pointFromX=function($,R){$=new u($,16),$.red||($=$.toRed(this.red));var T=$.redSqr().redMul($).redIAdd($.redMul(this.a)).redIAdd(this.b),O=T.redSqrt();if(O.redSqr().redSub(T).cmp(this.zero)!==0)throw new Error("invalid point");var B=O.fromRed().isOdd();return(R&&!B||!R&&B)&&(O=O.redNeg()),this.point($,O)},w.prototype.validate=function($){if($.inf)return!0;var R=$.x,T=$.y,O=this.a.redMul(R),B=R.redSqr().redMul(R).redIAdd(O).redIAdd(this.b);return T.redSqr().redISub(B).cmpn(0)===0},w.prototype._endoWnafMulAdd=function($,R,T){for(var O=this._endoWnafT1,B=this._endoWnafT2,F=0;F<$.length;F++){var U=this._endoSplit(R[F]),q=$[F],J=q._getBeta();U.k1.negative&&(U.k1.ineg(),q=q.neg(!0)),U.k2.negative&&(U.k2.ineg(),J=J.neg(!0)),O[F*2]=q,O[F*2+1]=J,B[F*2]=U.k1,B[F*2+1]=U.k2}for(var ie=this._wnafMulAdd(1,O,B,F*2,T),oe=0;oe<F*2;oe++)O[oe]=null,B[oe]=null;return ie};function E(A,$,R,T){v.BasePoint.call(this,A,"affine"),$===null&&R===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new u($,16),this.y=new u(R,16),T&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}g(E,v.BasePoint),w.prototype.point=function($,R,T){return new E(this,$,R,T)},w.prototype.pointFromJSON=function($,R){return E.fromJSON(this,$,R)},E.prototype._getBeta=function(){if(this.curve.endo){var $=this.precomputed;if($&&$.beta)return $.beta;var R=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if($){var T=this.curve,O=function(B){return T.point(B.x.redMul(T.endo.beta),B.y)};$.beta=R,R.precomputed={beta:null,naf:$.naf&&{wnd:$.naf.wnd,points:$.naf.points.map(O)},doubles:$.doubles&&{step:$.doubles.step,points:$.doubles.points.map(O)}}}return R}},E.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},E.fromJSON=function($,R,T){typeof R=="string"&&(R=JSON.parse(R));var O=$.point(R[0],R[1],T);if(!R[2])return O;function B(U){return $.point(U[0],U[1],T)}var F=R[2];return O.precomputed={beta:null,doubles:F.doubles&&{step:F.doubles.step,points:[O].concat(F.doubles.points.map(B))},naf:F.naf&&{wnd:F.naf.wnd,points:[O].concat(F.naf.points.map(B))}},O},E.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},E.prototype.isInfinity=function(){return this.inf},E.prototype.add=function($){if(this.inf)return $;if($.inf)return this;if(this.eq($))return this.dbl();if(this.neg().eq($))return this.curve.point(null,null);if(this.x.cmp($.x)===0)return this.curve.point(null,null);var R=this.y.redSub($.y);R.cmpn(0)!==0&&(R=R.redMul(this.x.redSub($.x).redInvm()));var T=R.redSqr().redISub(this.x).redISub($.x),O=R.redMul(this.x.redSub(T)).redISub(this.y);return this.curve.point(T,O)},E.prototype.dbl=function(){if(this.inf)return this;var $=this.y.redAdd(this.y);if($.cmpn(0)===0)return this.curve.point(null,null);var R=this.curve.a,T=this.x.redSqr(),O=$.redInvm(),B=T.redAdd(T).redIAdd(T).redIAdd(R).redMul(O),F=B.redSqr().redISub(this.x.redAdd(this.x)),U=B.redMul(this.x.redSub(F)).redISub(this.y);return this.curve.point(F,U)},E.prototype.getX=function(){return this.x.fromRed()},E.prototype.getY=function(){return this.y.fromRed()},E.prototype.mul=function($){return $=new u($,16),this.isInfinity()?this:this._hasDoubles($)?this.curve._fixedNafMul(this,$):this.curve.endo?this.curve._endoWnafMulAdd([this],[$]):this.curve._wnafMul(this,$)},E.prototype.mulAdd=function($,R,T){var O=[this,R],B=[$,T];return this.curve.endo?this.curve._endoWnafMulAdd(O,B):this.curve._wnafMulAdd(1,O,B,2)},E.prototype.jmulAdd=function($,R,T){var O=[this,R],B=[$,T];return this.curve.endo?this.curve._endoWnafMulAdd(O,B,!0):this.curve._wnafMulAdd(1,O,B,2,!0)},E.prototype.eq=function($){return this===$||this.inf===$.inf&&(this.inf||this.x.cmp($.x)===0&&this.y.cmp($.y)===0)},E.prototype.neg=function($){if(this.inf)return this;var R=this.curve.point(this.x,this.y.redNeg());if($&&this.precomputed){var T=this.precomputed,O=function(B){return B.neg()};R.precomputed={naf:T.naf&&{wnd:T.naf.wnd,points:T.naf.points.map(O)},doubles:T.doubles&&{step:T.doubles.step,points:T.doubles.points.map(O)}}}return R},E.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var $=this.curve.jpoint(this.x,this.y,this.curve.one);return $};function S(A,$,R,T){v.BasePoint.call(this,A,"jacobian"),$===null&&R===null&&T===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new u(0)):(this.x=new u($,16),this.y=new u(R,16),this.z=new u(T,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}return g(S,v.BasePoint),w.prototype.jpoint=function($,R,T){return new S(this,$,R,T)},S.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var $=this.z.redInvm(),R=$.redSqr(),T=this.x.redMul(R),O=this.y.redMul(R).redMul($);return this.curve.point(T,O)},S.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},S.prototype.add=function($){if(this.isInfinity())return $;if($.isInfinity())return this;var R=$.z.redSqr(),T=this.z.redSqr(),O=this.x.redMul(R),B=$.x.redMul(T),F=this.y.redMul(R.redMul($.z)),U=$.y.redMul(T.redMul(this.z)),q=O.redSub(B),J=F.redSub(U);if(q.cmpn(0)===0)return J.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var ie=q.redSqr(),oe=ie.redMul(q),le=O.redMul(ie),de=J.redSqr().redIAdd(oe).redISub(le).redISub(le),fe=J.redMul(le.redISub(de)).redISub(F.redMul(oe)),ye=this.z.redMul($.z).redMul(q);return this.curve.jpoint(de,fe,ye)},S.prototype.mixedAdd=function($){if(this.isInfinity())return $.toJ();if($.isInfinity())return this;var R=this.z.redSqr(),T=this.x,O=$.x.redMul(R),B=this.y,F=$.y.redMul(R).redMul(this.z),U=T.redSub(O),q=B.redSub(F);if(U.cmpn(0)===0)return q.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var J=U.redSqr(),ie=J.redMul(U),oe=T.redMul(J),le=q.redSqr().redIAdd(ie).redISub(oe).redISub(oe),de=q.redMul(oe.redISub(le)).redISub(B.redMul(ie)),fe=this.z.redMul(U);return this.curve.jpoint(le,de,fe)},S.prototype.dblp=function($){if($===0)return this;if(this.isInfinity())return this;if(!$)return this.dbl();var R;if(this.curve.zeroA||this.curve.threeA){var T=this;for(R=0;R<$;R++)T=T.dbl();return T}var O=this.curve.a,B=this.curve.tinv,F=this.x,U=this.y,q=this.z,J=q.redSqr().redSqr(),ie=U.redAdd(U);for(R=0;R<$;R++){var oe=F.redSqr(),le=ie.redSqr(),de=le.redSqr(),fe=oe.redAdd(oe).redIAdd(oe).redIAdd(O.redMul(J)),ye=F.redMul(le),we=fe.redSqr().redISub(ye.redAdd(ye)),pe=ye.redISub(we),ve=fe.redMul(pe);ve=ve.redIAdd(ve).redISub(de);var he=ie.redMul(q);R+1<$&&(J=J.redMul(de)),F=we,q=he,ie=ve}return this.curve.jpoint(F,ie.redMul(B),q)},S.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},S.prototype._zeroDbl=function(){var $,R,T;if(this.zOne){var O=this.x.redSqr(),B=this.y.redSqr(),F=B.redSqr(),U=this.x.redAdd(B).redSqr().redISub(O).redISub(F);U=U.redIAdd(U);var q=O.redAdd(O).redIAdd(O),J=q.redSqr().redISub(U).redISub(U),ie=F.redIAdd(F);ie=ie.redIAdd(ie),ie=ie.redIAdd(ie),$=J,R=q.redMul(U.redISub(J)).redISub(ie),T=this.y.redAdd(this.y)}else{var oe=this.x.redSqr(),le=this.y.redSqr(),de=le.redSqr(),fe=this.x.redAdd(le).redSqr().redISub(oe).redISub(de);fe=fe.redIAdd(fe);var ye=oe.redAdd(oe).redIAdd(oe),we=ye.redSqr(),pe=de.redIAdd(de);pe=pe.redIAdd(pe),pe=pe.redIAdd(pe),$=we.redISub(fe).redISub(fe),R=ye.redMul(fe.redISub($)).redISub(pe),T=this.y.redMul(this.z),T=T.redIAdd(T)}return this.curve.jpoint($,R,T)},S.prototype._threeDbl=function(){var $,R,T;if(this.zOne){var O=this.x.redSqr(),B=this.y.redSqr(),F=B.redSqr(),U=this.x.redAdd(B).redSqr().redISub(O).redISub(F);U=U.redIAdd(U);var q=O.redAdd(O).redIAdd(O).redIAdd(this.curve.a),J=q.redSqr().redISub(U).redISub(U);$=J;var ie=F.redIAdd(F);ie=ie.redIAdd(ie),ie=ie.redIAdd(ie),R=q.redMul(U.redISub(J)).redISub(ie),T=this.y.redAdd(this.y)}else{var oe=this.z.redSqr(),le=this.y.redSqr(),de=this.x.redMul(le),fe=this.x.redSub(oe).redMul(this.x.redAdd(oe));fe=fe.redAdd(fe).redIAdd(fe);var ye=de.redIAdd(de);ye=ye.redIAdd(ye);var we=ye.redAdd(ye);$=fe.redSqr().redISub(we),T=this.y.redAdd(this.z).redSqr().redISub(le).redISub(oe);var pe=le.redSqr();pe=pe.redIAdd(pe),pe=pe.redIAdd(pe),pe=pe.redIAdd(pe),R=fe.redMul(ye.redISub($)).redISub(pe)}return this.curve.jpoint($,R,T)},S.prototype._dbl=function(){var $=this.curve.a,R=this.x,T=this.y,O=this.z,B=O.redSqr().redSqr(),F=R.redSqr(),U=T.redSqr(),q=F.redAdd(F).redIAdd(F).redIAdd($.redMul(B)),J=R.redAdd(R);J=J.redIAdd(J);var ie=J.redMul(U),oe=q.redSqr().redISub(ie.redAdd(ie)),le=ie.redISub(oe),de=U.redSqr();de=de.redIAdd(de),de=de.redIAdd(de),de=de.redIAdd(de);var fe=q.redMul(le).redISub(de),ye=T.redAdd(T).redMul(O);return this.curve.jpoint(oe,fe,ye)},S.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var $=this.x.redSqr(),R=this.y.redSqr(),T=this.z.redSqr(),O=R.redSqr(),B=$.redAdd($).redIAdd($),F=B.redSqr(),U=this.x.redAdd(R).redSqr().redISub($).redISub(O);U=U.redIAdd(U),U=U.redAdd(U).redIAdd(U),U=U.redISub(F);var q=U.redSqr(),J=O.redIAdd(O);J=J.redIAdd(J),J=J.redIAdd(J),J=J.redIAdd(J);var ie=B.redIAdd(U).redSqr().redISub(F).redISub(q).redISub(J),oe=R.redMul(ie);oe=oe.redIAdd(oe),oe=oe.redIAdd(oe);var le=this.x.redMul(q).redISub(oe);le=le.redIAdd(le),le=le.redIAdd(le);var de=this.y.redMul(ie.redMul(J.redISub(ie)).redISub(U.redMul(q)));de=de.redIAdd(de),de=de.redIAdd(de),de=de.redIAdd(de);var fe=this.z.redAdd(U).redSqr().redISub(T).redISub(q);return this.curve.jpoint(le,de,fe)},S.prototype.mul=function($,R){return $=new u($,R),this.curve._wnafMul(this,$)},S.prototype.eq=function($){if($.type==="affine")return this.eq($.toJ());if(this===$)return!0;var R=this.z.redSqr(),T=$.z.redSqr();if(this.x.redMul(T).redISub($.x.redMul(R)).cmpn(0)!==0)return!1;var O=R.redMul(this.z),B=T.redMul($.z);return this.y.redMul(B).redISub($.y.redMul(O)).cmpn(0)===0},S.prototype.eqXToP=function($){var R=this.z.redSqr(),T=$.toRed(this.curve.red).redMul(R);if(this.x.cmp(T)===0)return!0;for(var O=$.clone(),B=this.curve.redN.redMul(R);;){if(O.iadd(this.curve.n),O.cmp(this.curve.p)>=0)return!1;if(T.redIAdd(B),this.x.cmp(T)===0)return!0}},S.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},S.prototype.isInfinity=function(){return this.z.cmpn(0)===0},short}var mont,hasRequiredMont;function requireMont(){if(hasRequiredMont)return mont;hasRequiredMont=1;var y=requireBn$2(),u=requireInherits_browser(),g=requireBase$1(),v=requireUtils$1();function b(E){g.call(this,"mont",E),this.a=new y(E.a,16).toRed(this.red),this.b=new y(E.b,16).toRed(this.red),this.i4=new y(4).toRed(this.red).redInvm(),this.two=new y(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}u(b,g),mont=b,b.prototype.validate=function(S){var A=S.normalize().x,$=A.redSqr(),R=$.redMul(A).redAdd($.redMul(this.a)).redAdd(A),T=R.redSqrt();return T.redSqr().cmp(R)===0};function w(E,S,A){g.BasePoint.call(this,E,"projective"),S===null&&A===null?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new y(S,16),this.z=new y(A,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}return u(w,g.BasePoint),b.prototype.decodePoint=function(S,A){return this.point(v.toArray(S,A),1)},b.prototype.point=function(S,A){return new w(this,S,A)},b.prototype.pointFromJSON=function(S){return w.fromJSON(this,S)},w.prototype.precompute=function(){},w.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},w.fromJSON=function(S,A){return new w(S,A[0],A[1]||S.one)},w.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},w.prototype.isInfinity=function(){return this.z.cmpn(0)===0},w.prototype.dbl=function(){var S=this.x.redAdd(this.z),A=S.redSqr(),$=this.x.redSub(this.z),R=$.redSqr(),T=A.redSub(R),O=A.redMul(R),B=T.redMul(R.redAdd(this.curve.a24.redMul(T)));return this.curve.point(O,B)},w.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},w.prototype.diffAdd=function(S,A){var $=this.x.redAdd(this.z),R=this.x.redSub(this.z),T=S.x.redAdd(S.z),O=S.x.redSub(S.z),B=O.redMul($),F=T.redMul(R),U=A.z.redMul(B.redAdd(F).redSqr()),q=A.x.redMul(B.redISub(F).redSqr());return this.curve.point(U,q)},w.prototype.mul=function(S){for(var A=S.clone(),$=this,R=this.curve.point(null,null),T=this,O=[];A.cmpn(0)!==0;A.iushrn(1))O.push(A.andln(1));for(var B=O.length-1;B>=0;B--)O[B]===0?($=$.diffAdd(R,T),R=R.dbl()):(R=$.diffAdd(R,T),$=$.dbl());return R},w.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},w.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},w.prototype.eq=function(S){return this.getX().cmp(S.getX())===0},w.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},w.prototype.getX=function(){return this.normalize(),this.x.fromRed()},mont}var edwards$1,hasRequiredEdwards;function requireEdwards(){if(hasRequiredEdwards)return edwards$1;hasRequiredEdwards=1;var y=requireUtils$1(),u=requireBn$2(),g=requireInherits_browser(),v=requireBase$1(),b=y.assert;function w(S){this.twisted=(S.a|0)!==1,this.mOneA=this.twisted&&(S.a|0)===-1,this.extended=this.mOneA,v.call(this,"edwards",S),this.a=new u(S.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new u(S.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new u(S.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),b(!this.twisted||this.c.fromRed().cmpn(1)===0),this.oneC=(S.c|0)===1}g(w,v),edwards$1=w,w.prototype._mulA=function(A){return this.mOneA?A.redNeg():this.a.redMul(A)},w.prototype._mulC=function(A){return this.oneC?A:this.c.redMul(A)},w.prototype.jpoint=function(A,$,R,T){return this.point(A,$,R,T)},w.prototype.pointFromX=function(A,$){A=new u(A,16),A.red||(A=A.toRed(this.red));var R=A.redSqr(),T=this.c2.redSub(this.a.redMul(R)),O=this.one.redSub(this.c2.redMul(this.d).redMul(R)),B=T.redMul(O.redInvm()),F=B.redSqrt();if(F.redSqr().redSub(B).cmp(this.zero)!==0)throw new Error("invalid point");var U=F.fromRed().isOdd();return($&&!U||!$&&U)&&(F=F.redNeg()),this.point(A,F)},w.prototype.pointFromY=function(A,$){A=new u(A,16),A.red||(A=A.toRed(this.red));var R=A.redSqr(),T=R.redSub(this.c2),O=R.redMul(this.d).redMul(this.c2).redSub(this.a),B=T.redMul(O.redInvm());if(B.cmp(this.zero)===0){if($)throw new Error("invalid point");return this.point(this.zero,A)}var F=B.redSqrt();if(F.redSqr().redSub(B).cmp(this.zero)!==0)throw new Error("invalid point");return F.fromRed().isOdd()!==$&&(F=F.redNeg()),this.point(F,A)},w.prototype.validate=function(A){if(A.isInfinity())return!0;A.normalize();var $=A.x.redSqr(),R=A.y.redSqr(),T=$.redMul(this.a).redAdd(R),O=this.c2.redMul(this.one.redAdd(this.d.redMul($).redMul(R)));return T.cmp(O)===0};function E(S,A,$,R,T){v.BasePoint.call(this,S,"projective"),A===null&&$===null&&R===null?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new u(A,16),this.y=new u($,16),this.z=R?new u(R,16):this.curve.one,this.t=T&&new u(T,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}return g(E,v.BasePoint),w.prototype.pointFromJSON=function(A){return E.fromJSON(this,A)},w.prototype.point=function(A,$,R,T){return new E(this,A,$,R,T)},E.fromJSON=function(A,$){return new E(A,$[0],$[1],$[2])},E.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},E.prototype.isInfinity=function(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0)},E.prototype._extDbl=function(){var A=this.x.redSqr(),$=this.y.redSqr(),R=this.z.redSqr();R=R.redIAdd(R);var T=this.curve._mulA(A),O=this.x.redAdd(this.y).redSqr().redISub(A).redISub($),B=T.redAdd($),F=B.redSub(R),U=T.redSub($),q=O.redMul(F),J=B.redMul(U),ie=O.redMul(U),oe=F.redMul(B);return this.curve.point(q,J,oe,ie)},E.prototype._projDbl=function(){var A=this.x.redAdd(this.y).redSqr(),$=this.x.redSqr(),R=this.y.redSqr(),T,O,B,F,U,q;if(this.curve.twisted){F=this.curve._mulA($);var J=F.redAdd(R);this.zOne?(T=A.redSub($).redSub(R).redMul(J.redSub(this.curve.two)),O=J.redMul(F.redSub(R)),B=J.redSqr().redSub(J).redSub(J)):(U=this.z.redSqr(),q=J.redSub(U).redISub(U),T=A.redSub($).redISub(R).redMul(q),O=J.redMul(F.redSub(R)),B=J.redMul(q))}else F=$.redAdd(R),U=this.curve._mulC(this.z).redSqr(),q=F.redSub(U).redSub(U),T=this.curve._mulC(A.redISub(F)).redMul(q),O=this.curve._mulC(F).redMul($.redISub(R)),B=F.redMul(q);return this.curve.point(T,O,B)},E.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},E.prototype._extAdd=function(A){var $=this.y.redSub(this.x).redMul(A.y.redSub(A.x)),R=this.y.redAdd(this.x).redMul(A.y.redAdd(A.x)),T=this.t.redMul(this.curve.dd).redMul(A.t),O=this.z.redMul(A.z.redAdd(A.z)),B=R.redSub($),F=O.redSub(T),U=O.redAdd(T),q=R.redAdd($),J=B.redMul(F),ie=U.redMul(q),oe=B.redMul(q),le=F.redMul(U);return this.curve.point(J,ie,le,oe)},E.prototype._projAdd=function(A){var $=this.z.redMul(A.z),R=$.redSqr(),T=this.x.redMul(A.x),O=this.y.redMul(A.y),B=this.curve.d.redMul(T).redMul(O),F=R.redSub(B),U=R.redAdd(B),q=this.x.redAdd(this.y).redMul(A.x.redAdd(A.y)).redISub(T).redISub(O),J=$.redMul(F).redMul(q),ie,oe;return this.curve.twisted?(ie=$.redMul(U).redMul(O.redSub(this.curve._mulA(T))),oe=F.redMul(U)):(ie=$.redMul(U).redMul(O.redSub(T)),oe=this.curve._mulC(F).redMul(U)),this.curve.point(J,ie,oe)},E.prototype.add=function(A){return this.isInfinity()?A:A.isInfinity()?this:this.curve.extended?this._extAdd(A):this._projAdd(A)},E.prototype.mul=function(A){return this._hasDoubles(A)?this.curve._fixedNafMul(this,A):this.curve._wnafMul(this,A)},E.prototype.mulAdd=function(A,$,R){return this.curve._wnafMulAdd(1,[this,$],[A,R],2,!1)},E.prototype.jmulAdd=function(A,$,R){return this.curve._wnafMulAdd(1,[this,$],[A,R],2,!0)},E.prototype.normalize=function(){if(this.zOne)return this;var A=this.z.redInvm();return this.x=this.x.redMul(A),this.y=this.y.redMul(A),this.t&&(this.t=this.t.redMul(A)),this.z=this.curve.one,this.zOne=!0,this},E.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},E.prototype.getX=function(){return this.normalize(),this.x.fromRed()},E.prototype.getY=function(){return this.normalize(),this.y.fromRed()},E.prototype.eq=function(A){return this===A||this.getX().cmp(A.getX())===0&&this.getY().cmp(A.getY())===0},E.prototype.eqXToP=function(A){var $=A.toRed(this.curve.red).redMul(this.z);if(this.x.cmp($)===0)return!0;for(var R=A.clone(),T=this.curve.redN.redMul(this.z);;){if(R.iadd(this.curve.n),R.cmp(this.curve.p)>=0)return!1;if($.redIAdd(T),this.x.cmp($)===0)return!0}},E.prototype.toP=E.prototype.normalize,E.prototype.mixedAdd=E.prototype.add,edwards$1}var hasRequiredCurve;function requireCurve(){return hasRequiredCurve||(hasRequiredCurve=1,(function(y){var u=y;u.base=requireBase$1(),u.short=requireShort(),u.mont=requireMont(),u.edwards=requireEdwards()})(curve)),curve}var curves={},hash={},utils$1={},hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils$1;hasRequiredUtils=1;var y=requireMinimalisticAssert(),u=requireInherits_browser();utils$1.inherits=u;function g(ae,Q){return(ae.charCodeAt(Q)&64512)!==55296||Q<0||Q+1>=ae.length?!1:(ae.charCodeAt(Q+1)&64512)===56320}function v(ae,Q){if(Array.isArray(ae))return ae.slice();if(!ae)return[];var j=[];if(typeof ae=="string")if(Q){if(Q==="hex")for(ae=ae.replace(/[^a-z0-9]+/ig,""),ae.length%2!==0&&(ae="0"+ae),re=0;re<ae.length;re+=2)j.push(parseInt(ae[re]+ae[re+1],16))}else for(var z=0,re=0;re<ae.length;re++){var Y=ae.charCodeAt(re);Y<128?j[z++]=Y:Y<2048?(j[z++]=Y>>6|192,j[z++]=Y&63|128):g(ae,re)?(Y=65536+((Y&1023)<<10)+(ae.charCodeAt(++re)&1023),j[z++]=Y>>18|240,j[z++]=Y>>12&63|128,j[z++]=Y>>6&63|128,j[z++]=Y&63|128):(j[z++]=Y>>12|224,j[z++]=Y>>6&63|128,j[z++]=Y&63|128)}else for(re=0;re<ae.length;re++)j[re]=ae[re]|0;return j}utils$1.toArray=v;function b(ae){for(var Q="",j=0;j<ae.length;j++)Q+=S(ae[j].toString(16));return Q}utils$1.toHex=b;function w(ae){var Q=ae>>>24|ae>>>8&65280|ae<<8&16711680|(ae&255)<<24;return Q>>>0}utils$1.htonl=w;function E(ae,Q){for(var j="",z=0;z<ae.length;z++){var re=ae[z];Q==="little"&&(re=w(re)),j+=A(re.toString(16))}return j}utils$1.toHex32=E;function S(ae){return ae.length===1?"0"+ae:ae}utils$1.zero2=S;function A(ae){return ae.length===7?"0"+ae:ae.length===6?"00"+ae:ae.length===5?"000"+ae:ae.length===4?"0000"+ae:ae.length===3?"00000"+ae:ae.length===2?"000000"+ae:ae.length===1?"0000000"+ae:ae}utils$1.zero8=A;function $(ae,Q,j,z){var re=j-Q;y(re%4===0);for(var Y=new Array(re/4),te=0,ne=Q;te<Y.length;te++,ne+=4){var se;z==="big"?se=ae[ne]<<24|ae[ne+1]<<16|ae[ne+2]<<8|ae[ne+3]:se=ae[ne+3]<<24|ae[ne+2]<<16|ae[ne+1]<<8|ae[ne],Y[te]=se>>>0}return Y}utils$1.join32=$;function R(ae,Q){for(var j=new Array(ae.length*4),z=0,re=0;z<ae.length;z++,re+=4){var Y=ae[z];Q==="big"?(j[re]=Y>>>24,j[re+1]=Y>>>16&255,j[re+2]=Y>>>8&255,j[re+3]=Y&255):(j[re+3]=Y>>>24,j[re+2]=Y>>>16&255,j[re+1]=Y>>>8&255,j[re]=Y&255)}return j}utils$1.split32=R;function T(ae,Q){return ae>>>Q|ae<<32-Q}utils$1.rotr32=T;function O(ae,Q){return ae<<Q|ae>>>32-Q}utils$1.rotl32=O;function B(ae,Q){return ae+Q>>>0}utils$1.sum32=B;function F(ae,Q,j){return ae+Q+j>>>0}utils$1.sum32_3=F;function U(ae,Q,j,z){return ae+Q+j+z>>>0}utils$1.sum32_4=U;function q(ae,Q,j,z,re){return ae+Q+j+z+re>>>0}utils$1.sum32_5=q;function J(ae,Q,j,z){var re=ae[Q],Y=ae[Q+1],te=z+Y>>>0,ne=(te<z?1:0)+j+re;ae[Q]=ne>>>0,ae[Q+1]=te}utils$1.sum64=J;function ie(ae,Q,j,z){var re=Q+z>>>0,Y=(re<Q?1:0)+ae+j;return Y>>>0}utils$1.sum64_hi=ie;function oe(ae,Q,j,z){var re=Q+z;return re>>>0}utils$1.sum64_lo=oe;function le(ae,Q,j,z,re,Y,te,ne){var se=0,ee=Q;ee=ee+z>>>0,se+=ee<Q?1:0,ee=ee+Y>>>0,se+=ee<Y?1:0,ee=ee+ne>>>0,se+=ee<ne?1:0;var Z=ae+j+re+te+se;return Z>>>0}utils$1.sum64_4_hi=le;function de(ae,Q,j,z,re,Y,te,ne){var se=Q+z+Y+ne;return se>>>0}utils$1.sum64_4_lo=de;function fe(ae,Q,j,z,re,Y,te,ne,se,ee){var Z=0,ue=Q;ue=ue+z>>>0,Z+=ue<Q?1:0,ue=ue+Y>>>0,Z+=ue<Y?1:0,ue=ue+ne>>>0,Z+=ue<ne?1:0,ue=ue+ee>>>0,Z+=ue<ee?1:0;var _e=ae+j+re+te+se+Z;return _e>>>0}utils$1.sum64_5_hi=fe;function ye(ae,Q,j,z,re,Y,te,ne,se,ee){var Z=Q+z+Y+ne+ee;return Z>>>0}utils$1.sum64_5_lo=ye;function we(ae,Q,j){var z=Q<<32-j|ae>>>j;return z>>>0}utils$1.rotr64_hi=we;function pe(ae,Q,j){var z=ae<<32-j|Q>>>j;return z>>>0}utils$1.rotr64_lo=pe;function ve(ae,Q,j){return ae>>>j}utils$1.shr64_hi=ve;function he(ae,Q,j){var z=ae<<32-j|Q>>>j;return z>>>0}return utils$1.shr64_lo=he,utils$1}var common$1={},hasRequiredCommon$1;function requireCommon$1(){if(hasRequiredCommon$1)return common$1;hasRequiredCommon$1=1;var y=requireUtils(),u=requireMinimalisticAssert();function g(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}return common$1.BlockHash=g,g.prototype.update=function(b,w){if(b=y.toArray(b,w),this.pending?this.pending=this.pending.concat(b):this.pending=b,this.pendingTotal+=b.length,this.pending.length>=this._delta8){b=this.pending;var E=b.length%this._delta8;this.pending=b.slice(b.length-E,b.length),this.pending.length===0&&(this.pending=null),b=y.join32(b,0,b.length-E,this.endian);for(var S=0;S<b.length;S+=this._delta32)this._update(b,S,S+this._delta32)}return this},g.prototype.digest=function(b){return this.update(this._pad()),u(this.pending===null),this._digest(b)},g.prototype._pad=function(){var b=this.pendingTotal,w=this._delta8,E=w-(b+this.padLength)%w,S=new Array(E+this.padLength);S[0]=128;for(var A=1;A<E;A++)S[A]=0;if(b<<=3,this.endian==="big"){for(var $=8;$<this.padLength;$++)S[A++]=0;S[A++]=0,S[A++]=0,S[A++]=0,S[A++]=0,S[A++]=b>>>24&255,S[A++]=b>>>16&255,S[A++]=b>>>8&255,S[A++]=b&255}else for(S[A++]=b&255,S[A++]=b>>>8&255,S[A++]=b>>>16&255,S[A++]=b>>>24&255,S[A++]=0,S[A++]=0,S[A++]=0,S[A++]=0,$=8;$<this.padLength;$++)S[A++]=0;return S},common$1}var sha$2={},common={},hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common;hasRequiredCommon=1;var y=requireUtils(),u=y.rotr32;function g(R,T,O,B){if(R===0)return v(T,O,B);if(R===1||R===3)return w(T,O,B);if(R===2)return b(T,O,B)}common.ft_1=g;function v(R,T,O){return R&T^~R&O}common.ch32=v;function b(R,T,O){return R&T^R&O^T&O}common.maj32=b;function w(R,T,O){return R^T^O}common.p32=w;function E(R){return u(R,2)^u(R,13)^u(R,22)}common.s0_256=E;function S(R){return u(R,6)^u(R,11)^u(R,25)}common.s1_256=S;function A(R){return u(R,7)^u(R,18)^R>>>3}common.g0_256=A;function $(R){return u(R,17)^u(R,19)^R>>>10}return common.g1_256=$,common}var _1,hasRequired_1;function require_1(){if(hasRequired_1)return _1;hasRequired_1=1;var y=requireUtils(),u=requireCommon$1(),g=requireCommon(),v=y.rotl32,b=y.sum32,w=y.sum32_5,E=g.ft_1,S=u.BlockHash,A=[1518500249,1859775393,2400959708,3395469782];function $(){if(!(this instanceof $))return new $;S.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}return y.inherits($,S),_1=$,$.blockSize=512,$.outSize=160,$.hmacStrength=80,$.padLength=64,$.prototype._update=function(T,O){for(var B=this.W,F=0;F<16;F++)B[F]=T[O+F];for(;F<B.length;F++)B[F]=v(B[F-3]^B[F-8]^B[F-14]^B[F-16],1);var U=this.h[0],q=this.h[1],J=this.h[2],ie=this.h[3],oe=this.h[4];for(F=0;F<B.length;F++){var le=~~(F/20),de=w(v(U,5),E(le,q,J,ie),oe,B[F],A[le]);oe=ie,ie=J,J=v(q,30),q=U,U=de}this.h[0]=b(this.h[0],U),this.h[1]=b(this.h[1],q),this.h[2]=b(this.h[2],J),this.h[3]=b(this.h[3],ie),this.h[4]=b(this.h[4],oe)},$.prototype._digest=function(T){return T==="hex"?y.toHex32(this.h,"big"):y.split32(this.h,"big")},_1}var _256,hasRequired_256;function require_256(){if(hasRequired_256)return _256;hasRequired_256=1;var y=requireUtils(),u=requireCommon$1(),g=requireCommon(),v=requireMinimalisticAssert(),b=y.sum32,w=y.sum32_4,E=y.sum32_5,S=g.ch32,A=g.maj32,$=g.s0_256,R=g.s1_256,T=g.g0_256,O=g.g1_256,B=u.BlockHash,F=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function U(){if(!(this instanceof U))return new U;B.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=F,this.W=new Array(64)}return y.inherits(U,B),_256=U,U.blockSize=512,U.outSize=256,U.hmacStrength=192,U.padLength=64,U.prototype._update=function(J,ie){for(var oe=this.W,le=0;le<16;le++)oe[le]=J[ie+le];for(;le<oe.length;le++)oe[le]=w(O(oe[le-2]),oe[le-7],T(oe[le-15]),oe[le-16]);var de=this.h[0],fe=this.h[1],ye=this.h[2],we=this.h[3],pe=this.h[4],ve=this.h[5],he=this.h[6],ae=this.h[7];for(v(this.k.length===oe.length),le=0;le<oe.length;le++){var Q=E(ae,R(pe),S(pe,ve,he),this.k[le],oe[le]),j=b($(de),A(de,fe,ye));ae=he,he=ve,ve=pe,pe=b(we,Q),we=ye,ye=fe,fe=de,de=b(Q,j)}this.h[0]=b(this.h[0],de),this.h[1]=b(this.h[1],fe),this.h[2]=b(this.h[2],ye),this.h[3]=b(this.h[3],we),this.h[4]=b(this.h[4],pe),this.h[5]=b(this.h[5],ve),this.h[6]=b(this.h[6],he),this.h[7]=b(this.h[7],ae)},U.prototype._digest=function(J){return J==="hex"?y.toHex32(this.h,"big"):y.split32(this.h,"big")},_256}var _224,hasRequired_224;function require_224(){if(hasRequired_224)return _224;hasRequired_224=1;var y=requireUtils(),u=require_256();function g(){if(!(this instanceof g))return new g;u.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}return y.inherits(g,u),_224=g,g.blockSize=512,g.outSize=224,g.hmacStrength=192,g.padLength=64,g.prototype._digest=function(b){return b==="hex"?y.toHex32(this.h.slice(0,7),"big"):y.split32(this.h.slice(0,7),"big")},_224}var _512,hasRequired_512;function require_512(){if(hasRequired_512)return _512;hasRequired_512=1;var y=requireUtils(),u=requireCommon$1(),g=requireMinimalisticAssert(),v=y.rotr64_hi,b=y.rotr64_lo,w=y.shr64_hi,E=y.shr64_lo,S=y.sum64,A=y.sum64_hi,$=y.sum64_lo,R=y.sum64_4_hi,T=y.sum64_4_lo,O=y.sum64_5_hi,B=y.sum64_5_lo,F=u.BlockHash,U=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function q(){if(!(this instanceof q))return new q;F.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=U,this.W=new Array(160)}y.inherits(q,F),_512=q,q.blockSize=1024,q.outSize=512,q.hmacStrength=192,q.padLength=128,q.prototype._prepareBlock=function(j,z){for(var re=this.W,Y=0;Y<32;Y++)re[Y]=j[z+Y];for(;Y<re.length;Y+=2){var te=he(re[Y-4],re[Y-3]),ne=ae(re[Y-4],re[Y-3]),se=re[Y-14],ee=re[Y-13],Z=pe(re[Y-30],re[Y-29]),ue=ve(re[Y-30],re[Y-29]),_e=re[Y-32],Re=re[Y-31];re[Y]=R(te,ne,se,ee,Z,ue,_e,Re),re[Y+1]=T(te,ne,se,ee,Z,ue,_e,Re)}},q.prototype._update=function(j,z){this._prepareBlock(j,z);var re=this.W,Y=this.h[0],te=this.h[1],ne=this.h[2],se=this.h[3],ee=this.h[4],Z=this.h[5],ue=this.h[6],_e=this.h[7],Re=this.h[8],Ae=this.h[9],ge=this.h[10],be=this.h[11],Te=this.h[12],De=this.h[13],Ie=this.h[14],Se=this.h[15];g(this.k.length===re.length);for(var Be=0;Be<re.length;Be+=2){var Le=Ie,qe=Se,Ke=ye(Re,Ae),Ge=we(Re,Ae),Xe=J(Re,Ae,ge,be,Te),ze=ie(Re,Ae,ge,be,Te,De),et=this.k[Be],Ze=this.k[Be+1],nt=re[Be],ut=re[Be+1],ot=O(Le,qe,Ke,Ge,Xe,ze,et,Ze,nt,ut),vt=B(Le,qe,Ke,Ge,Xe,ze,et,Ze,nt,ut);Le=de(Y,te),qe=fe(Y,te),Ke=oe(Y,te,ne,se,ee),Ge=le(Y,te,ne,se,ee,Z);var bt=A(Le,qe,Ke,Ge),lt=$(Le,qe,Ke,Ge);Ie=Te,Se=De,Te=ge,De=be,ge=Re,be=Ae,Re=A(ue,_e,ot,vt),Ae=$(_e,_e,ot,vt),ue=ee,_e=Z,ee=ne,Z=se,ne=Y,se=te,Y=A(ot,vt,bt,lt),te=$(ot,vt,bt,lt)}S(this.h,0,Y,te),S(this.h,2,ne,se),S(this.h,4,ee,Z),S(this.h,6,ue,_e),S(this.h,8,Re,Ae),S(this.h,10,ge,be),S(this.h,12,Te,De),S(this.h,14,Ie,Se)},q.prototype._digest=function(j){return j==="hex"?y.toHex32(this.h,"big"):y.split32(this.h,"big")};function J(Q,j,z,re,Y){var te=Q&z^~Q&Y;return te<0&&(te+=4294967296),te}function ie(Q,j,z,re,Y,te){var ne=j&re^~j&te;return ne<0&&(ne+=4294967296),ne}function oe(Q,j,z,re,Y){var te=Q&z^Q&Y^z&Y;return te<0&&(te+=4294967296),te}function le(Q,j,z,re,Y,te){var ne=j&re^j&te^re&te;return ne<0&&(ne+=4294967296),ne}function de(Q,j){var z=v(Q,j,28),re=v(j,Q,2),Y=v(j,Q,7),te=z^re^Y;return te<0&&(te+=4294967296),te}function fe(Q,j){var z=b(Q,j,28),re=b(j,Q,2),Y=b(j,Q,7),te=z^re^Y;return te<0&&(te+=4294967296),te}function ye(Q,j){var z=v(Q,j,14),re=v(Q,j,18),Y=v(j,Q,9),te=z^re^Y;return te<0&&(te+=4294967296),te}function we(Q,j){var z=b(Q,j,14),re=b(Q,j,18),Y=b(j,Q,9),te=z^re^Y;return te<0&&(te+=4294967296),te}function pe(Q,j){var z=v(Q,j,1),re=v(Q,j,8),Y=w(Q,j,7),te=z^re^Y;return te<0&&(te+=4294967296),te}function ve(Q,j){var z=b(Q,j,1),re=b(Q,j,8),Y=E(Q,j,7),te=z^re^Y;return te<0&&(te+=4294967296),te}function he(Q,j){var z=v(Q,j,19),re=v(j,Q,29),Y=w(Q,j,6),te=z^re^Y;return te<0&&(te+=4294967296),te}function ae(Q,j){var z=b(Q,j,19),re=b(j,Q,29),Y=E(Q,j,6),te=z^re^Y;return te<0&&(te+=4294967296),te}return _512}var _384,hasRequired_384;function require_384(){if(hasRequired_384)return _384;hasRequired_384=1;var y=requireUtils(),u=require_512();function g(){if(!(this instanceof g))return new g;u.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}return y.inherits(g,u),_384=g,g.blockSize=1024,g.outSize=384,g.hmacStrength=192,g.padLength=128,g.prototype._digest=function(b){return b==="hex"?y.toHex32(this.h.slice(0,12),"big"):y.split32(this.h.slice(0,12),"big")},_384}var hasRequiredSha;function requireSha(){return hasRequiredSha||(hasRequiredSha=1,sha$2.sha1=require_1(),sha$2.sha224=require_224(),sha$2.sha256=require_256(),sha$2.sha384=require_384(),sha$2.sha512=require_512()),sha$2}var ripemd={},hasRequiredRipemd;function requireRipemd(){if(hasRequiredRipemd)return ripemd;hasRequiredRipemd=1;var y=requireUtils(),u=requireCommon$1(),g=y.rotl32,v=y.sum32,b=y.sum32_3,w=y.sum32_4,E=u.BlockHash;function S(){if(!(this instanceof S))return new S;E.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}y.inherits(S,E),ripemd.ripemd160=S,S.blockSize=512,S.outSize=160,S.hmacStrength=192,S.padLength=64,S.prototype._update=function(q,J){for(var ie=this.h[0],oe=this.h[1],le=this.h[2],de=this.h[3],fe=this.h[4],ye=ie,we=oe,pe=le,ve=de,he=fe,ae=0;ae<80;ae++){var Q=v(g(w(ie,A(ae,oe,le,de),q[T[ae]+J],$(ae)),B[ae]),fe);ie=fe,fe=de,de=g(le,10),le=oe,oe=Q,Q=v(g(w(ye,A(79-ae,we,pe,ve),q[O[ae]+J],R(ae)),F[ae]),he),ye=he,he=ve,ve=g(pe,10),pe=we,we=Q}Q=b(this.h[1],le,ve),this.h[1]=b(this.h[2],de,he),this.h[2]=b(this.h[3],fe,ye),this.h[3]=b(this.h[4],ie,we),this.h[4]=b(this.h[0],oe,pe),this.h[0]=Q},S.prototype._digest=function(q){return q==="hex"?y.toHex32(this.h,"little"):y.split32(this.h,"little")};function A(U,q,J,ie){return U<=15?q^J^ie:U<=31?q&J|~q&ie:U<=47?(q|~J)^ie:U<=63?q&ie|J&~ie:q^(J|~ie)}function $(U){return U<=15?0:U<=31?1518500249:U<=47?1859775393:U<=63?2400959708:2840853838}function R(U){return U<=15?1352829926:U<=31?1548603684:U<=47?1836072691:U<=63?2053994217:0}var T=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],O=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],B=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],F=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];return ripemd}var hmac$7,hasRequiredHmac$1;function requireHmac$1(){if(hasRequiredHmac$1)return hmac$7;hasRequiredHmac$1=1;var y=requireUtils(),u=requireMinimalisticAssert();function g(v,b,w){if(!(this instanceof g))return new g(v,b,w);this.Hash=v,this.blockSize=v.blockSize/8,this.outSize=v.outSize/8,this.inner=null,this.outer=null,this._init(y.toArray(b,w))}return hmac$7=g,g.prototype._init=function(b){b.length>this.blockSize&&(b=new this.Hash().update(b).digest()),u(b.length<=this.blockSize);for(var w=b.length;w<this.blockSize;w++)b.push(0);for(w=0;w<b.length;w++)b[w]^=54;for(this.inner=new this.Hash().update(b),w=0;w<b.length;w++)b[w]^=106;this.outer=new this.Hash().update(b)},g.prototype.update=function(b,w){return this.inner.update(b,w),this},g.prototype.digest=function(b){return this.outer.update(this.inner.digest()),this.outer.digest(b)},hmac$7}var hasRequiredHash;function requireHash(){return hasRequiredHash||(hasRequiredHash=1,(function(y){var u=y;u.utils=requireUtils(),u.common=requireCommon$1(),u.sha=requireSha(),u.ripemd=requireRipemd(),u.hmac=requireHmac$1(),u.sha1=u.sha.sha1,u.sha256=u.sha.sha256,u.sha224=u.sha.sha224,u.sha384=u.sha.sha384,u.sha512=u.sha.sha512,u.ripemd160=u.ripemd.ripemd160})(hash)),hash}var secp256k1$2,hasRequiredSecp256k1;function requireSecp256k1(){return hasRequiredSecp256k1||(hasRequiredSecp256k1=1,secp256k1$2={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}),secp256k1$2}var hasRequiredCurves;function requireCurves(){return hasRequiredCurves||(hasRequiredCurves=1,(function(y){var u=y,g=requireHash(),v=requireCurve(),b=requireUtils$1(),w=b.assert;function E($){$.type==="short"?this.curve=new v.short($):$.type==="edwards"?this.curve=new v.edwards($):this.curve=new v.mont($),this.g=this.curve.g,this.n=this.curve.n,this.hash=$.hash,w(this.g.validate(),"Invalid curve"),w(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}u.PresetCurve=E;function S($,R){Object.defineProperty(u,$,{configurable:!0,enumerable:!0,get:function(){var T=new E(R);return Object.defineProperty(u,$,{configurable:!0,enumerable:!0,value:T}),T}})}S("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:g.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),S("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:g.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),S("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:g.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),S("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:g.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),S("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:g.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),S("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:g.sha256,gRed:!1,g:["9"]}),S("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:g.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var A;try{A=requireSecp256k1()}catch{A=void 0}S("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:g.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",A]})})(curves)),curves}var hmacDrbg,hasRequiredHmacDrbg;function requireHmacDrbg(){if(hasRequiredHmacDrbg)return hmacDrbg;hasRequiredHmacDrbg=1;var y=requireHash(),u=requireUtils$2(),g=requireMinimalisticAssert();function v(b){if(!(this instanceof v))return new v(b);this.hash=b.hash,this.predResist=!!b.predResist,this.outLen=this.hash.outSize,this.minEntropy=b.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var w=u.toArray(b.entropy,b.entropyEnc||"hex"),E=u.toArray(b.nonce,b.nonceEnc||"hex"),S=u.toArray(b.pers,b.persEnc||"hex");g(w.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(w,E,S)}return hmacDrbg=v,v.prototype._init=function(w,E,S){var A=w.concat(E).concat(S);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var $=0;$<this.V.length;$++)this.K[$]=0,this.V[$]=1;this._update(A),this._reseed=1,this.reseedInterval=281474976710656},v.prototype._hmac=function(){return new y.hmac(this.hash,this.K)},v.prototype._update=function(w){var E=this._hmac().update(this.V).update([0]);w&&(E=E.update(w)),this.K=E.digest(),this.V=this._hmac().update(this.V).digest(),w&&(this.K=this._hmac().update(this.V).update([1]).update(w).digest(),this.V=this._hmac().update(this.V).digest())},v.prototype.reseed=function(w,E,S,A){typeof E!="string"&&(A=S,S=E,E=null),w=u.toArray(w,E),S=u.toArray(S,A),g(w.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(w.concat(S||[])),this._reseed=1},v.prototype.generate=function(w,E,S,A){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof E!="string"&&(A=S,S=E,E=null),S&&(S=u.toArray(S,A||"hex"),this._update(S));for(var $=[];$.length<w;)this.V=this._hmac().update(this.V).digest(),$=$.concat(this.V);var R=$.slice(0,w);return this._update(S),this._reseed++,u.encode(R,E)},hmacDrbg}var key$1,hasRequiredKey$1;function requireKey$1(){if(hasRequiredKey$1)return key$1;hasRequiredKey$1=1;var y=requireBn$2(),u=requireUtils$1(),g=u.assert;function v(b,w){this.ec=b,this.priv=null,this.pub=null,w.priv&&this._importPrivate(w.priv,w.privEnc),w.pub&&this._importPublic(w.pub,w.pubEnc)}return key$1=v,v.fromPublic=function(w,E,S){return E instanceof v?E:new v(w,{pub:E,pubEnc:S})},v.fromPrivate=function(w,E,S){return E instanceof v?E:new v(w,{priv:E,privEnc:S})},v.prototype.validate=function(){var w=this.getPublic();return w.isInfinity()?{result:!1,reason:"Invalid public key"}:w.validate()?w.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},v.prototype.getPublic=function(w,E){return typeof w=="string"&&(E=w,w=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),E?this.pub.encode(E,w):this.pub},v.prototype.getPrivate=function(w){return w==="hex"?this.priv.toString(16,2):this.priv},v.prototype._importPrivate=function(w,E){this.priv=new y(w,E||16),this.priv=this.priv.umod(this.ec.curve.n)},v.prototype._importPublic=function(w,E){if(w.x||w.y){this.ec.curve.type==="mont"?g(w.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&g(w.x&&w.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(w.x,w.y);return}this.pub=this.ec.curve.decodePoint(w,E)},v.prototype.derive=function(w){return w.validate()||g(w.validate(),"public point not validated"),w.mul(this.priv).getX()},v.prototype.sign=function(w,E,S){return this.ec.sign(w,this,E,S)},v.prototype.verify=function(w,E,S){return this.ec.verify(w,E,this,void 0,S)},v.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"},key$1}var signature$1,hasRequiredSignature$1;function requireSignature$1(){if(hasRequiredSignature$1)return signature$1;hasRequiredSignature$1=1;var y=requireBn$2(),u=requireUtils$1(),g=u.assert;function v(A,$){if(A instanceof v)return A;this._importDER(A,$)||(g(A.r&&A.s,"Signature without r or s"),this.r=new y(A.r,16),this.s=new y(A.s,16),A.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=A.recoveryParam)}signature$1=v;function b(){this.place=0}function w(A,$){var R=A[$.place++];if(!(R&128))return R;var T=R&15;if(T===0||T>4||A[$.place]===0)return!1;for(var O=0,B=0,F=$.place;B<T;B++,F++)O<<=8,O|=A[F],O>>>=0;return O<=127?!1:($.place=F,O)}function E(A){for(var $=0,R=A.length-1;!A[$]&&!(A[$+1]&128)&&$<R;)$++;return $===0?A:A.slice($)}v.prototype._importDER=function($,R){$=u.toArray($,R);var T=new b;if($[T.place++]!==48)return!1;var O=w($,T);if(O===!1||O+T.place!==$.length||$[T.place++]!==2)return!1;var B=w($,T);if(B===!1||($[T.place]&128)!==0)return!1;var F=$.slice(T.place,B+T.place);if(T.place+=B,$[T.place++]!==2)return!1;var U=w($,T);if(U===!1||$.length!==U+T.place||($[T.place]&128)!==0)return!1;var q=$.slice(T.place,U+T.place);if(F[0]===0)if(F[1]&128)F=F.slice(1);else return!1;if(q[0]===0)if(q[1]&128)q=q.slice(1);else return!1;return this.r=new y(F),this.s=new y(q),this.recoveryParam=null,!0};function S(A,$){if($<128){A.push($);return}var R=1+(Math.log($)/Math.LN2>>>3);for(A.push(R|128);--R;)A.push($>>>(R<<3)&255);A.push($)}return v.prototype.toDER=function($){var R=this.r.toArray(),T=this.s.toArray();for(R[0]&128&&(R=[0].concat(R)),T[0]&128&&(T=[0].concat(T)),R=E(R),T=E(T);!T[0]&&!(T[1]&128);)T=T.slice(1);var O=[2];S(O,R.length),O=O.concat(R),O.push(2),S(O,T.length);var B=O.concat(T),F=[48];return S(F,B.length),F=F.concat(B),u.encode(F,$)},signature$1}var ec$4,hasRequiredEc;function requireEc(){if(hasRequiredEc)return ec$4;hasRequiredEc=1;var y=requireBn$2(),u=requireHmacDrbg(),g=requireUtils$1(),v=requireCurves(),b=requireBrorand(),w=g.assert,E=requireKey$1(),S=requireSignature$1();function A($){if(!(this instanceof A))return new A($);typeof $=="string"&&(w(Object.prototype.hasOwnProperty.call(v,$),"Unknown curve "+$),$=v[$]),$ instanceof v.PresetCurve&&($={curve:$}),this.curve=$.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=$.curve.g,this.g.precompute($.curve.n.bitLength()+1),this.hash=$.hash||$.curve.hash}return ec$4=A,A.prototype.keyPair=function(R){return new E(this,R)},A.prototype.keyFromPrivate=function(R,T){return E.fromPrivate(this,R,T)},A.prototype.keyFromPublic=function(R,T){return E.fromPublic(this,R,T)},A.prototype.genKeyPair=function(R){R||(R={});for(var T=new u({hash:this.hash,pers:R.pers,persEnc:R.persEnc||"utf8",entropy:R.entropy||b(this.hash.hmacStrength),entropyEnc:R.entropy&&R.entropyEnc||"utf8",nonce:this.n.toArray()}),O=this.n.byteLength(),B=this.n.sub(new y(2));;){var F=new y(T.generate(O));if(!(F.cmp(B)>0))return F.iaddn(1),this.keyFromPrivate(F)}},A.prototype._truncateToN=function(R,T,O){var B;if(y.isBN(R)||typeof R=="number")R=new y(R,16),B=R.byteLength();else if(typeof R=="object")B=R.length,R=new y(R,16);else{var F=R.toString();B=F.length+1>>>1,R=new y(F,16)}typeof O!="number"&&(O=B*8);var U=O-this.n.bitLength();return U>0&&(R=R.ushrn(U)),!T&&R.cmp(this.n)>=0?R.sub(this.n):R},A.prototype.sign=function(R,T,O,B){if(typeof O=="object"&&(B=O,O=null),B||(B={}),typeof R!="string"&&typeof R!="number"&&!y.isBN(R)){w(typeof R=="object"&&R&&typeof R.length=="number","Expected message to be an array-like, a hex string, or a BN instance"),w(R.length>>>0===R.length);for(var F=0;F<R.length;F++)w((R[F]&255)===R[F])}T=this.keyFromPrivate(T,O),R=this._truncateToN(R,!1,B.msgBitLength),w(!R.isNeg(),"Can not sign a negative message");var U=this.n.byteLength(),q=T.getPrivate().toArray("be",U),J=R.toArray("be",U);w(new y(J).eq(R),"Can not sign message");for(var ie=new u({hash:this.hash,entropy:q,nonce:J,pers:B.pers,persEnc:B.persEnc||"utf8"}),oe=this.n.sub(new y(1)),le=0;;le++){var de=B.k?B.k(le):new y(ie.generate(this.n.byteLength()));if(de=this._truncateToN(de,!0),!(de.cmpn(1)<=0||de.cmp(oe)>=0)){var fe=this.g.mul(de);if(!fe.isInfinity()){var ye=fe.getX(),we=ye.umod(this.n);if(we.cmpn(0)!==0){var pe=de.invm(this.n).mul(we.mul(T.getPrivate()).iadd(R));if(pe=pe.umod(this.n),pe.cmpn(0)!==0){var ve=(fe.getY().isOdd()?1:0)|(ye.cmp(we)!==0?2:0);return B.canonical&&pe.cmp(this.nh)>0&&(pe=this.n.sub(pe),ve^=1),new S({r:we,s:pe,recoveryParam:ve})}}}}}},A.prototype.verify=function(R,T,O,B,F){F||(F={}),R=this._truncateToN(R,!1,F.msgBitLength),O=this.keyFromPublic(O,B),T=new S(T,"hex");var U=T.r,q=T.s;if(U.cmpn(1)<0||U.cmp(this.n)>=0||q.cmpn(1)<0||q.cmp(this.n)>=0)return!1;var J=q.invm(this.n),ie=J.mul(R).umod(this.n),oe=J.mul(U).umod(this.n),le;return this.curve._maxwellTrick?(le=this.g.jmulAdd(ie,O.getPublic(),oe),le.isInfinity()?!1:le.eqXToP(U)):(le=this.g.mulAdd(ie,O.getPublic(),oe),le.isInfinity()?!1:le.getX().umod(this.n).cmp(U)===0)},A.prototype.recoverPubKey=function($,R,T,O){w((3&T)===T,"The recovery param is more than two bits"),R=new S(R,O);var B=this.n,F=new y($),U=R.r,q=R.s,J=T&1,ie=T>>1;if(U.cmp(this.curve.p.umod(this.curve.n))>=0&&ie)throw new Error("Unable to find sencond key candinate");ie?U=this.curve.pointFromX(U.add(this.curve.n),J):U=this.curve.pointFromX(U,J);var oe=R.r.invm(B),le=B.sub(F).mul(oe).umod(B),de=q.mul(oe).umod(B);return this.g.mulAdd(le,U,de)},A.prototype.getKeyRecoveryParam=function($,R,T,O){if(R=new S(R,O),R.recoveryParam!==null)return R.recoveryParam;for(var B=0;B<4;B++){var F;try{F=this.recoverPubKey($,R,B)}catch{continue}if(F.eq(T))return B}throw new Error("Unable to find valid recovery factor")},ec$4}var key,hasRequiredKey;function requireKey(){if(hasRequiredKey)return key;hasRequiredKey=1;var y=requireUtils$1(),u=y.assert,g=y.parseBytes,v=y.cachedProperty;function b(w,E){this.eddsa=w,this._secret=g(E.secret),w.isPoint(E.pub)?this._pub=E.pub:this._pubBytes=g(E.pub)}return b.fromPublic=function(E,S){return S instanceof b?S:new b(E,{pub:S})},b.fromSecret=function(E,S){return S instanceof b?S:new b(E,{secret:S})},b.prototype.secret=function(){return this._secret},v(b,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),v(b,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),v(b,"privBytes",function(){var E=this.eddsa,S=this.hash(),A=E.encodingLength-1,$=S.slice(0,E.encodingLength);return $[0]&=248,$[A]&=127,$[A]|=64,$}),v(b,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),v(b,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),v(b,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),b.prototype.sign=function(E){return u(this._secret,"KeyPair can only verify"),this.eddsa.sign(E,this)},b.prototype.verify=function(E,S){return this.eddsa.verify(E,S,this)},b.prototype.getSecret=function(E){return u(this._secret,"KeyPair is public only"),y.encode(this.secret(),E)},b.prototype.getPublic=function(E){return y.encode(this.pubBytes(),E)},key=b,key}var signature,hasRequiredSignature;function requireSignature(){if(hasRequiredSignature)return signature;hasRequiredSignature=1;var y=requireBn$2(),u=requireUtils$1(),g=u.assert,v=u.cachedProperty,b=u.parseBytes;function w(E,S){this.eddsa=E,typeof S!="object"&&(S=b(S)),Array.isArray(S)&&(g(S.length===E.encodingLength*2,"Signature has invalid size"),S={R:S.slice(0,E.encodingLength),S:S.slice(E.encodingLength)}),g(S.R&&S.S,"Signature without R or S"),E.isPoint(S.R)&&(this._R=S.R),S.S instanceof y&&(this._S=S.S),this._Rencoded=Array.isArray(S.R)?S.R:S.Rencoded,this._Sencoded=Array.isArray(S.S)?S.S:S.Sencoded}return v(w,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),v(w,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),v(w,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),v(w,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),w.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},w.prototype.toHex=function(){return u.encode(this.toBytes(),"hex").toUpperCase()},signature=w,signature}var eddsa$1,hasRequiredEddsa;function requireEddsa(){if(hasRequiredEddsa)return eddsa$1;hasRequiredEddsa=1;var y=requireHash(),u=requireCurves(),g=requireUtils$1(),v=g.assert,b=g.parseBytes,w=requireKey(),E=requireSignature();function S(A){if(v(A==="ed25519","only tested with ed25519 so far"),!(this instanceof S))return new S(A);A=u[A].curve,this.curve=A,this.g=A.g,this.g.precompute(A.n.bitLength()+1),this.pointClass=A.point().constructor,this.encodingLength=Math.ceil(A.n.bitLength()/8),this.hash=y.sha512}return eddsa$1=S,S.prototype.sign=function($,R){$=b($);var T=this.keyFromSecret(R),O=this.hashInt(T.messagePrefix(),$),B=this.g.mul(O),F=this.encodePoint(B),U=this.hashInt(F,T.pubBytes(),$).mul(T.priv()),q=O.add(U).umod(this.curve.n);return this.makeSignature({R:B,S:q,Rencoded:F})},S.prototype.verify=function($,R,T){if($=b($),R=this.makeSignature(R),R.S().gte(R.eddsa.curve.n)||R.S().isNeg())return!1;var O=this.keyFromPublic(T),B=this.hashInt(R.Rencoded(),O.pubBytes(),$),F=this.g.mul(R.S()),U=R.R().add(O.pub().mul(B));return U.eq(F)},S.prototype.hashInt=function(){for(var $=this.hash(),R=0;R<arguments.length;R++)$.update(arguments[R]);return g.intFromLE($.digest()).umod(this.curve.n)},S.prototype.keyFromPublic=function($){return w.fromPublic(this,$)},S.prototype.keyFromSecret=function($){return w.fromSecret(this,$)},S.prototype.makeSignature=function($){return $ instanceof E?$:new E(this,$)},S.prototype.encodePoint=function($){var R=$.getY().toArray("le",this.encodingLength);return R[this.encodingLength-1]|=$.getX().isOdd()?128:0,R},S.prototype.decodePoint=function($){$=g.parseBytes($);var R=$.length-1,T=$.slice(0,R).concat($[R]&-129),O=($[R]&128)!==0,B=g.intFromLE(T);return this.curve.pointFromY(B,O)},S.prototype.encodeInt=function($){return $.toArray("le",this.encodingLength)},S.prototype.decodeInt=function($){return g.intFromLE($)},S.prototype.isPoint=function($){return $ instanceof this.pointClass},eddsa$1}var hasRequiredElliptic;function requireElliptic(){return hasRequiredElliptic||(hasRequiredElliptic=1,(function(y){var u=y;u.version=require$$0.version,u.utils=requireUtils$1(),u.rand=requireBrorand(),u.curve=requireCurve(),u.curves=requireCurves(),u.ec=requireEc(),u.eddsa=requireEddsa()})(elliptic$1)),elliptic$1}var bn$1={exports:{}},bn=bn$1.exports,hasRequiredBn;function requireBn(){return hasRequiredBn||(hasRequiredBn=1,(function(y){(function(u,g){function v(Q,j){if(!Q)throw new Error(j||"Assertion failed")}function b(Q,j){Q.super_=j;var z=function(){};z.prototype=j.prototype,Q.prototype=new z,Q.prototype.constructor=Q}function w(Q,j,z){if(w.isBN(Q))return Q;this.negative=0,this.words=null,this.length=0,this.red=null,Q!==null&&((j==="le"||j==="be")&&(z=j,j=10),this._init(Q||0,j||10,z||"be"))}typeof u=="object"?u.exports=w:g.BN=w,w.BN=w,w.wordSize=26;var E;try{typeof window<"u"&&typeof window.Buffer<"u"?E=window.Buffer:E=requireDist().Buffer}catch{}w.isBN=function(j){return j instanceof w?!0:j!==null&&typeof j=="object"&&j.constructor.wordSize===w.wordSize&&Array.isArray(j.words)},w.max=function(j,z){return j.cmp(z)>0?j:z},w.min=function(j,z){return j.cmp(z)<0?j:z},w.prototype._init=function(j,z,re){if(typeof j=="number")return this._initNumber(j,z,re);if(typeof j=="object")return this._initArray(j,z,re);z==="hex"&&(z=16),v(z===(z|0)&&z>=2&&z<=36),j=j.toString().replace(/\s+/g,"");var Y=0;j[0]==="-"&&(Y++,this.negative=1),Y<j.length&&(z===16?this._parseHex(j,Y,re):(this._parseBase(j,z,Y),re==="le"&&this._initArray(this.toArray(),z,re)))},w.prototype._initNumber=function(j,z,re){j<0&&(this.negative=1,j=-j),j<67108864?(this.words=[j&67108863],this.length=1):j<4503599627370496?(this.words=[j&67108863,j/67108864&67108863],this.length=2):(v(j<9007199254740992),this.words=[j&67108863,j/67108864&67108863,1],this.length=3),re==="le"&&this._initArray(this.toArray(),z,re)},w.prototype._initArray=function(j,z,re){if(v(typeof j.length=="number"),j.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(j.length/3),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var te,ne,se=0;if(re==="be")for(Y=j.length-1,te=0;Y>=0;Y-=3)ne=j[Y]|j[Y-1]<<8|j[Y-2]<<16,this.words[te]|=ne<<se&67108863,this.words[te+1]=ne>>>26-se&67108863,se+=24,se>=26&&(se-=26,te++);else if(re==="le")for(Y=0,te=0;Y<j.length;Y+=3)ne=j[Y]|j[Y+1]<<8|j[Y+2]<<16,this.words[te]|=ne<<se&67108863,this.words[te+1]=ne>>>26-se&67108863,se+=24,se>=26&&(se-=26,te++);return this._strip()};function S(Q,j){var z=Q.charCodeAt(j);if(z>=48&&z<=57)return z-48;if(z>=65&&z<=70)return z-55;if(z>=97&&z<=102)return z-87;v(!1,"Invalid character in "+Q)}function A(Q,j,z){var re=S(Q,z);return z-1>=j&&(re|=S(Q,z-1)<<4),re}w.prototype._parseHex=function(j,z,re){this.length=Math.ceil((j.length-z)/6),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var te=0,ne=0,se;if(re==="be")for(Y=j.length-1;Y>=z;Y-=2)se=A(j,z,Y)<<te,this.words[ne]|=se&67108863,te>=18?(te-=18,ne+=1,this.words[ne]|=se>>>26):te+=8;else{var ee=j.length-z;for(Y=ee%2===0?z+1:z;Y<j.length;Y+=2)se=A(j,z,Y)<<te,this.words[ne]|=se&67108863,te>=18?(te-=18,ne+=1,this.words[ne]|=se>>>26):te+=8}this._strip()};function $(Q,j,z,re){for(var Y=0,te=0,ne=Math.min(Q.length,z),se=j;se<ne;se++){var ee=Q.charCodeAt(se)-48;Y*=re,ee>=49?te=ee-49+10:ee>=17?te=ee-17+10:te=ee,v(ee>=0&&te<re,"Invalid character"),Y+=te}return Y}w.prototype._parseBase=function(j,z,re){this.words=[0],this.length=1;for(var Y=0,te=1;te<=67108863;te*=z)Y++;Y--,te=te/z|0;for(var ne=j.length-re,se=ne%Y,ee=Math.min(ne,ne-se)+re,Z=0,ue=re;ue<ee;ue+=Y)Z=$(j,ue,ue+Y,z),this.imuln(te),this.words[0]+Z<67108864?this.words[0]+=Z:this._iaddn(Z);if(se!==0){var _e=1;for(Z=$(j,ue,j.length,z),ue=0;ue<se;ue++)_e*=z;this.imuln(_e),this.words[0]+Z<67108864?this.words[0]+=Z:this._iaddn(Z)}this._strip()},w.prototype.copy=function(j){j.words=new Array(this.length);for(var z=0;z<this.length;z++)j.words[z]=this.words[z];j.length=this.length,j.negative=this.negative,j.red=this.red};function R(Q,j){Q.words=j.words,Q.length=j.length,Q.negative=j.negative,Q.red=j.red}if(w.prototype._move=function(j){R(j,this)},w.prototype.clone=function(){var j=new w(null);return this.copy(j),j},w.prototype._expand=function(j){for(;this.length<j;)this.words[this.length++]=0;return this},w.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},w.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{w.prototype[Symbol.for("nodejs.util.inspect.custom")]=T}catch{w.prototype.inspect=T}else w.prototype.inspect=T;function T(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var O=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],B=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],F=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];w.prototype.toString=function(j,z){j=j||10,z=z|0||1;var re;if(j===16||j==="hex"){re="";for(var Y=0,te=0,ne=0;ne<this.length;ne++){var se=this.words[ne],ee=((se<<Y|te)&16777215).toString(16);te=se>>>24-Y&16777215,Y+=2,Y>=26&&(Y-=26,ne--),te!==0||ne!==this.length-1?re=O[6-ee.length]+ee+re:re=ee+re}for(te!==0&&(re=te.toString(16)+re);re.length%z!==0;)re="0"+re;return this.negative!==0&&(re="-"+re),re}if(j===(j|0)&&j>=2&&j<=36){var Z=B[j],ue=F[j];re="";var _e=this.clone();for(_e.negative=0;!_e.isZero();){var Re=_e.modrn(ue).toString(j);_e=_e.idivn(ue),_e.isZero()?re=Re+re:re=O[Z-Re.length]+Re+re}for(this.isZero()&&(re="0"+re);re.length%z!==0;)re="0"+re;return this.negative!==0&&(re="-"+re),re}v(!1,"Base should be between 2 and 36")},w.prototype.toNumber=function(){var j=this.words[0];return this.length===2?j+=this.words[1]*67108864:this.length===3&&this.words[2]===1?j+=4503599627370496+this.words[1]*67108864:this.length>2&&v(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-j:j},w.prototype.toJSON=function(){return this.toString(16,2)},E&&(w.prototype.toBuffer=function(j,z){return this.toArrayLike(E,j,z)}),w.prototype.toArray=function(j,z){return this.toArrayLike(Array,j,z)};var U=function(j,z){return j.allocUnsafe?j.allocUnsafe(z):new j(z)};w.prototype.toArrayLike=function(j,z,re){this._strip();var Y=this.byteLength(),te=re||Math.max(1,Y);v(Y<=te,"byte array longer than desired length"),v(te>0,"Requested array length <= 0");var ne=U(j,te),se=z==="le"?"LE":"BE";return this["_toArrayLike"+se](ne,Y),ne},w.prototype._toArrayLikeLE=function(j,z){for(var re=0,Y=0,te=0,ne=0;te<this.length;te++){var se=this.words[te]<<ne|Y;j[re++]=se&255,re<j.length&&(j[re++]=se>>8&255),re<j.length&&(j[re++]=se>>16&255),ne===6?(re<j.length&&(j[re++]=se>>24&255),Y=0,ne=0):(Y=se>>>24,ne+=2)}if(re<j.length)for(j[re++]=Y;re<j.length;)j[re++]=0},w.prototype._toArrayLikeBE=function(j,z){for(var re=j.length-1,Y=0,te=0,ne=0;te<this.length;te++){var se=this.words[te]<<ne|Y;j[re--]=se&255,re>=0&&(j[re--]=se>>8&255),re>=0&&(j[re--]=se>>16&255),ne===6?(re>=0&&(j[re--]=se>>24&255),Y=0,ne=0):(Y=se>>>24,ne+=2)}if(re>=0)for(j[re--]=Y;re>=0;)j[re--]=0},Math.clz32?w.prototype._countBits=function(j){return 32-Math.clz32(j)}:w.prototype._countBits=function(j){var z=j,re=0;return z>=4096&&(re+=13,z>>>=13),z>=64&&(re+=7,z>>>=7),z>=8&&(re+=4,z>>>=4),z>=2&&(re+=2,z>>>=2),re+z},w.prototype._zeroBits=function(j){if(j===0)return 26;var z=j,re=0;return(z&8191)===0&&(re+=13,z>>>=13),(z&127)===0&&(re+=7,z>>>=7),(z&15)===0&&(re+=4,z>>>=4),(z&3)===0&&(re+=2,z>>>=2),(z&1)===0&&re++,re},w.prototype.bitLength=function(){var j=this.words[this.length-1],z=this._countBits(j);return(this.length-1)*26+z};function q(Q){for(var j=new Array(Q.bitLength()),z=0;z<j.length;z++){var re=z/26|0,Y=z%26;j[z]=Q.words[re]>>>Y&1}return j}w.prototype.zeroBits=function(){if(this.isZero())return 0;for(var j=0,z=0;z<this.length;z++){var re=this._zeroBits(this.words[z]);if(j+=re,re!==26)break}return j},w.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},w.prototype.toTwos=function(j){return this.negative!==0?this.abs().inotn(j).iaddn(1):this.clone()},w.prototype.fromTwos=function(j){return this.testn(j-1)?this.notn(j).iaddn(1).ineg():this.clone()},w.prototype.isNeg=function(){return this.negative!==0},w.prototype.neg=function(){return this.clone().ineg()},w.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},w.prototype.iuor=function(j){for(;this.length<j.length;)this.words[this.length++]=0;for(var z=0;z<j.length;z++)this.words[z]=this.words[z]|j.words[z];return this._strip()},w.prototype.ior=function(j){return v((this.negative|j.negative)===0),this.iuor(j)},w.prototype.or=function(j){return this.length>j.length?this.clone().ior(j):j.clone().ior(this)},w.prototype.uor=function(j){return this.length>j.length?this.clone().iuor(j):j.clone().iuor(this)},w.prototype.iuand=function(j){var z;this.length>j.length?z=j:z=this;for(var re=0;re<z.length;re++)this.words[re]=this.words[re]&j.words[re];return this.length=z.length,this._strip()},w.prototype.iand=function(j){return v((this.negative|j.negative)===0),this.iuand(j)},w.prototype.and=function(j){return this.length>j.length?this.clone().iand(j):j.clone().iand(this)},w.prototype.uand=function(j){return this.length>j.length?this.clone().iuand(j):j.clone().iuand(this)},w.prototype.iuxor=function(j){var z,re;this.length>j.length?(z=this,re=j):(z=j,re=this);for(var Y=0;Y<re.length;Y++)this.words[Y]=z.words[Y]^re.words[Y];if(this!==z)for(;Y<z.length;Y++)this.words[Y]=z.words[Y];return this.length=z.length,this._strip()},w.prototype.ixor=function(j){return v((this.negative|j.negative)===0),this.iuxor(j)},w.prototype.xor=function(j){return this.length>j.length?this.clone().ixor(j):j.clone().ixor(this)},w.prototype.uxor=function(j){return this.length>j.length?this.clone().iuxor(j):j.clone().iuxor(this)},w.prototype.inotn=function(j){v(typeof j=="number"&&j>=0);var z=Math.ceil(j/26)|0,re=j%26;this._expand(z),re>0&&z--;for(var Y=0;Y<z;Y++)this.words[Y]=~this.words[Y]&67108863;return re>0&&(this.words[Y]=~this.words[Y]&67108863>>26-re),this._strip()},w.prototype.notn=function(j){return this.clone().inotn(j)},w.prototype.setn=function(j,z){v(typeof j=="number"&&j>=0);var re=j/26|0,Y=j%26;return this._expand(re+1),z?this.words[re]=this.words[re]|1<<Y:this.words[re]=this.words[re]&~(1<<Y),this._strip()},w.prototype.iadd=function(j){var z;if(this.negative!==0&&j.negative===0)return this.negative=0,z=this.isub(j),this.negative^=1,this._normSign();if(this.negative===0&&j.negative!==0)return j.negative=0,z=this.isub(j),j.negative=1,z._normSign();var re,Y;this.length>j.length?(re=this,Y=j):(re=j,Y=this);for(var te=0,ne=0;ne<Y.length;ne++)z=(re.words[ne]|0)+(Y.words[ne]|0)+te,this.words[ne]=z&67108863,te=z>>>26;for(;te!==0&&ne<re.length;ne++)z=(re.words[ne]|0)+te,this.words[ne]=z&67108863,te=z>>>26;if(this.length=re.length,te!==0)this.words[this.length]=te,this.length++;else if(re!==this)for(;ne<re.length;ne++)this.words[ne]=re.words[ne];return this},w.prototype.add=function(j){var z;return j.negative!==0&&this.negative===0?(j.negative=0,z=this.sub(j),j.negative^=1,z):j.negative===0&&this.negative!==0?(this.negative=0,z=j.sub(this),this.negative=1,z):this.length>j.length?this.clone().iadd(j):j.clone().iadd(this)},w.prototype.isub=function(j){if(j.negative!==0){j.negative=0;var z=this.iadd(j);return j.negative=1,z._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(j),this.negative=1,this._normSign();var re=this.cmp(j);if(re===0)return this.negative=0,this.length=1,this.words[0]=0,this;var Y,te;re>0?(Y=this,te=j):(Y=j,te=this);for(var ne=0,se=0;se<te.length;se++)z=(Y.words[se]|0)-(te.words[se]|0)+ne,ne=z>>26,this.words[se]=z&67108863;for(;ne!==0&&se<Y.length;se++)z=(Y.words[se]|0)+ne,ne=z>>26,this.words[se]=z&67108863;if(ne===0&&se<Y.length&&Y!==this)for(;se<Y.length;se++)this.words[se]=Y.words[se];return this.length=Math.max(this.length,se),Y!==this&&(this.negative=1),this._strip()},w.prototype.sub=function(j){return this.clone().isub(j)};function J(Q,j,z){z.negative=j.negative^Q.negative;var re=Q.length+j.length|0;z.length=re,re=re-1|0;var Y=Q.words[0]|0,te=j.words[0]|0,ne=Y*te,se=ne&67108863,ee=ne/67108864|0;z.words[0]=se;for(var Z=1;Z<re;Z++){for(var ue=ee>>>26,_e=ee&67108863,Re=Math.min(Z,j.length-1),Ae=Math.max(0,Z-Q.length+1);Ae<=Re;Ae++){var ge=Z-Ae|0;Y=Q.words[ge]|0,te=j.words[Ae]|0,ne=Y*te+_e,ue+=ne/67108864|0,_e=ne&67108863}z.words[Z]=_e|0,ee=ue|0}return ee!==0?z.words[Z]=ee|0:z.length--,z._strip()}var ie=function(j,z,re){var Y=j.words,te=z.words,ne=re.words,se=0,ee,Z,ue,_e=Y[0]|0,Re=_e&8191,Ae=_e>>>13,ge=Y[1]|0,be=ge&8191,Te=ge>>>13,De=Y[2]|0,Ie=De&8191,Se=De>>>13,Be=Y[3]|0,Le=Be&8191,qe=Be>>>13,Ke=Y[4]|0,Ge=Ke&8191,Xe=Ke>>>13,ze=Y[5]|0,et=ze&8191,Ze=ze>>>13,nt=Y[6]|0,ut=nt&8191,ot=nt>>>13,vt=Y[7]|0,bt=vt&8191,lt=vt>>>13,kt=Y[8]|0,Ct=kt&8191,Me=kt>>>13,Ce=Y[9]|0,Ee=Ce&8191,Pe=Ce>>>13,je=te[0]|0,He=je&8191,Ve=je>>>13,dt=te[1]|0,xt=dt&8191,mt=dt>>>13,gt=te[2]|0,at=gt&8191,ht=gt>>>13,_t=te[3]|0,$t=_t&8191,St=_t>>>13,ft=te[4]|0,At=ft&8191,Oe=ft>>>13,$e=te[5]|0,ke=$e&8191,Ue=$e>>>13,We=te[6]|0,Qe=We&8191,tt=We>>>13,Pt=te[7]|0,Nt=Pt&8191,Rt=Pt>>>13,Dt=te[8]|0,Tt=Dt&8191,It=Dt>>>13,Wt=te[9]|0,jt=Wt&8191,Ft=Wt>>>13;re.negative=j.negative^z.negative,re.length=19,ee=Math.imul(Re,He),Z=Math.imul(Re,Ve),Z=Z+Math.imul(Ae,He)|0,ue=Math.imul(Ae,Ve);var Kr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Kr>>>26)|0,Kr&=67108863,ee=Math.imul(be,He),Z=Math.imul(be,Ve),Z=Z+Math.imul(Te,He)|0,ue=Math.imul(Te,Ve),ee=ee+Math.imul(Re,xt)|0,Z=Z+Math.imul(Re,mt)|0,Z=Z+Math.imul(Ae,xt)|0,ue=ue+Math.imul(Ae,mt)|0;var Mr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Mr>>>26)|0,Mr&=67108863,ee=Math.imul(Ie,He),Z=Math.imul(Ie,Ve),Z=Z+Math.imul(Se,He)|0,ue=Math.imul(Se,Ve),ee=ee+Math.imul(be,xt)|0,Z=Z+Math.imul(be,mt)|0,Z=Z+Math.imul(Te,xt)|0,ue=ue+Math.imul(Te,mt)|0,ee=ee+Math.imul(Re,at)|0,Z=Z+Math.imul(Re,ht)|0,Z=Z+Math.imul(Ae,at)|0,ue=ue+Math.imul(Ae,ht)|0;var Cr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Cr>>>26)|0,Cr&=67108863,ee=Math.imul(Le,He),Z=Math.imul(Le,Ve),Z=Z+Math.imul(qe,He)|0,ue=Math.imul(qe,Ve),ee=ee+Math.imul(Ie,xt)|0,Z=Z+Math.imul(Ie,mt)|0,Z=Z+Math.imul(Se,xt)|0,ue=ue+Math.imul(Se,mt)|0,ee=ee+Math.imul(be,at)|0,Z=Z+Math.imul(be,ht)|0,Z=Z+Math.imul(Te,at)|0,ue=ue+Math.imul(Te,ht)|0,ee=ee+Math.imul(Re,$t)|0,Z=Z+Math.imul(Re,St)|0,Z=Z+Math.imul(Ae,$t)|0,ue=ue+Math.imul(Ae,St)|0;var Pr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Pr>>>26)|0,Pr&=67108863,ee=Math.imul(Ge,He),Z=Math.imul(Ge,Ve),Z=Z+Math.imul(Xe,He)|0,ue=Math.imul(Xe,Ve),ee=ee+Math.imul(Le,xt)|0,Z=Z+Math.imul(Le,mt)|0,Z=Z+Math.imul(qe,xt)|0,ue=ue+Math.imul(qe,mt)|0,ee=ee+Math.imul(Ie,at)|0,Z=Z+Math.imul(Ie,ht)|0,Z=Z+Math.imul(Se,at)|0,ue=ue+Math.imul(Se,ht)|0,ee=ee+Math.imul(be,$t)|0,Z=Z+Math.imul(be,St)|0,Z=Z+Math.imul(Te,$t)|0,ue=ue+Math.imul(Te,St)|0,ee=ee+Math.imul(Re,At)|0,Z=Z+Math.imul(Re,Oe)|0,Z=Z+Math.imul(Ae,At)|0,ue=ue+Math.imul(Ae,Oe)|0;var wr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(wr>>>26)|0,wr&=67108863,ee=Math.imul(et,He),Z=Math.imul(et,Ve),Z=Z+Math.imul(Ze,He)|0,ue=Math.imul(Ze,Ve),ee=ee+Math.imul(Ge,xt)|0,Z=Z+Math.imul(Ge,mt)|0,Z=Z+Math.imul(Xe,xt)|0,ue=ue+Math.imul(Xe,mt)|0,ee=ee+Math.imul(Le,at)|0,Z=Z+Math.imul(Le,ht)|0,Z=Z+Math.imul(qe,at)|0,ue=ue+Math.imul(qe,ht)|0,ee=ee+Math.imul(Ie,$t)|0,Z=Z+Math.imul(Ie,St)|0,Z=Z+Math.imul(Se,$t)|0,ue=ue+Math.imul(Se,St)|0,ee=ee+Math.imul(be,At)|0,Z=Z+Math.imul(be,Oe)|0,Z=Z+Math.imul(Te,At)|0,ue=ue+Math.imul(Te,Oe)|0,ee=ee+Math.imul(Re,ke)|0,Z=Z+Math.imul(Re,Ue)|0,Z=Z+Math.imul(Ae,ke)|0,ue=ue+Math.imul(Ae,Ue)|0;var Er=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Er>>>26)|0,Er&=67108863,ee=Math.imul(ut,He),Z=Math.imul(ut,Ve),Z=Z+Math.imul(ot,He)|0,ue=Math.imul(ot,Ve),ee=ee+Math.imul(et,xt)|0,Z=Z+Math.imul(et,mt)|0,Z=Z+Math.imul(Ze,xt)|0,ue=ue+Math.imul(Ze,mt)|0,ee=ee+Math.imul(Ge,at)|0,Z=Z+Math.imul(Ge,ht)|0,Z=Z+Math.imul(Xe,at)|0,ue=ue+Math.imul(Xe,ht)|0,ee=ee+Math.imul(Le,$t)|0,Z=Z+Math.imul(Le,St)|0,Z=Z+Math.imul(qe,$t)|0,ue=ue+Math.imul(qe,St)|0,ee=ee+Math.imul(Ie,At)|0,Z=Z+Math.imul(Ie,Oe)|0,Z=Z+Math.imul(Se,At)|0,ue=ue+Math.imul(Se,Oe)|0,ee=ee+Math.imul(be,ke)|0,Z=Z+Math.imul(be,Ue)|0,Z=Z+Math.imul(Te,ke)|0,ue=ue+Math.imul(Te,Ue)|0,ee=ee+Math.imul(Re,Qe)|0,Z=Z+Math.imul(Re,tt)|0,Z=Z+Math.imul(Ae,Qe)|0,ue=ue+Math.imul(Ae,tt)|0;var $r=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+($r>>>26)|0,$r&=67108863,ee=Math.imul(bt,He),Z=Math.imul(bt,Ve),Z=Z+Math.imul(lt,He)|0,ue=Math.imul(lt,Ve),ee=ee+Math.imul(ut,xt)|0,Z=Z+Math.imul(ut,mt)|0,Z=Z+Math.imul(ot,xt)|0,ue=ue+Math.imul(ot,mt)|0,ee=ee+Math.imul(et,at)|0,Z=Z+Math.imul(et,ht)|0,Z=Z+Math.imul(Ze,at)|0,ue=ue+Math.imul(Ze,ht)|0,ee=ee+Math.imul(Ge,$t)|0,Z=Z+Math.imul(Ge,St)|0,Z=Z+Math.imul(Xe,$t)|0,ue=ue+Math.imul(Xe,St)|0,ee=ee+Math.imul(Le,At)|0,Z=Z+Math.imul(Le,Oe)|0,Z=Z+Math.imul(qe,At)|0,ue=ue+Math.imul(qe,Oe)|0,ee=ee+Math.imul(Ie,ke)|0,Z=Z+Math.imul(Ie,Ue)|0,Z=Z+Math.imul(Se,ke)|0,ue=ue+Math.imul(Se,Ue)|0,ee=ee+Math.imul(be,Qe)|0,Z=Z+Math.imul(be,tt)|0,Z=Z+Math.imul(Te,Qe)|0,ue=ue+Math.imul(Te,tt)|0,ee=ee+Math.imul(Re,Nt)|0,Z=Z+Math.imul(Re,Rt)|0,Z=Z+Math.imul(Ae,Nt)|0,ue=ue+Math.imul(Ae,Rt)|0;var _r=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(_r>>>26)|0,_r&=67108863,ee=Math.imul(Ct,He),Z=Math.imul(Ct,Ve),Z=Z+Math.imul(Me,He)|0,ue=Math.imul(Me,Ve),ee=ee+Math.imul(bt,xt)|0,Z=Z+Math.imul(bt,mt)|0,Z=Z+Math.imul(lt,xt)|0,ue=ue+Math.imul(lt,mt)|0,ee=ee+Math.imul(ut,at)|0,Z=Z+Math.imul(ut,ht)|0,Z=Z+Math.imul(ot,at)|0,ue=ue+Math.imul(ot,ht)|0,ee=ee+Math.imul(et,$t)|0,Z=Z+Math.imul(et,St)|0,Z=Z+Math.imul(Ze,$t)|0,ue=ue+Math.imul(Ze,St)|0,ee=ee+Math.imul(Ge,At)|0,Z=Z+Math.imul(Ge,Oe)|0,Z=Z+Math.imul(Xe,At)|0,ue=ue+Math.imul(Xe,Oe)|0,ee=ee+Math.imul(Le,ke)|0,Z=Z+Math.imul(Le,Ue)|0,Z=Z+Math.imul(qe,ke)|0,ue=ue+Math.imul(qe,Ue)|0,ee=ee+Math.imul(Ie,Qe)|0,Z=Z+Math.imul(Ie,tt)|0,Z=Z+Math.imul(Se,Qe)|0,ue=ue+Math.imul(Se,tt)|0,ee=ee+Math.imul(be,Nt)|0,Z=Z+Math.imul(be,Rt)|0,Z=Z+Math.imul(Te,Nt)|0,ue=ue+Math.imul(Te,Rt)|0,ee=ee+Math.imul(Re,Tt)|0,Z=Z+Math.imul(Re,It)|0,Z=Z+Math.imul(Ae,Tt)|0,ue=ue+Math.imul(Ae,It)|0;var Jt=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Jt>>>26)|0,Jt&=67108863,ee=Math.imul(Ee,He),Z=Math.imul(Ee,Ve),Z=Z+Math.imul(Pe,He)|0,ue=Math.imul(Pe,Ve),ee=ee+Math.imul(Ct,xt)|0,Z=Z+Math.imul(Ct,mt)|0,Z=Z+Math.imul(Me,xt)|0,ue=ue+Math.imul(Me,mt)|0,ee=ee+Math.imul(bt,at)|0,Z=Z+Math.imul(bt,ht)|0,Z=Z+Math.imul(lt,at)|0,ue=ue+Math.imul(lt,ht)|0,ee=ee+Math.imul(ut,$t)|0,Z=Z+Math.imul(ut,St)|0,Z=Z+Math.imul(ot,$t)|0,ue=ue+Math.imul(ot,St)|0,ee=ee+Math.imul(et,At)|0,Z=Z+Math.imul(et,Oe)|0,Z=Z+Math.imul(Ze,At)|0,ue=ue+Math.imul(Ze,Oe)|0,ee=ee+Math.imul(Ge,ke)|0,Z=Z+Math.imul(Ge,Ue)|0,Z=Z+Math.imul(Xe,ke)|0,ue=ue+Math.imul(Xe,Ue)|0,ee=ee+Math.imul(Le,Qe)|0,Z=Z+Math.imul(Le,tt)|0,Z=Z+Math.imul(qe,Qe)|0,ue=ue+Math.imul(qe,tt)|0,ee=ee+Math.imul(Ie,Nt)|0,Z=Z+Math.imul(Ie,Rt)|0,Z=Z+Math.imul(Se,Nt)|0,ue=ue+Math.imul(Se,Rt)|0,ee=ee+Math.imul(be,Tt)|0,Z=Z+Math.imul(be,It)|0,Z=Z+Math.imul(Te,Tt)|0,ue=ue+Math.imul(Te,It)|0,ee=ee+Math.imul(Re,jt)|0,Z=Z+Math.imul(Re,Ft)|0,Z=Z+Math.imul(Ae,jt)|0,ue=ue+Math.imul(Ae,Ft)|0;var Or=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Or>>>26)|0,Or&=67108863,ee=Math.imul(Ee,xt),Z=Math.imul(Ee,mt),Z=Z+Math.imul(Pe,xt)|0,ue=Math.imul(Pe,mt),ee=ee+Math.imul(Ct,at)|0,Z=Z+Math.imul(Ct,ht)|0,Z=Z+Math.imul(Me,at)|0,ue=ue+Math.imul(Me,ht)|0,ee=ee+Math.imul(bt,$t)|0,Z=Z+Math.imul(bt,St)|0,Z=Z+Math.imul(lt,$t)|0,ue=ue+Math.imul(lt,St)|0,ee=ee+Math.imul(ut,At)|0,Z=Z+Math.imul(ut,Oe)|0,Z=Z+Math.imul(ot,At)|0,ue=ue+Math.imul(ot,Oe)|0,ee=ee+Math.imul(et,ke)|0,Z=Z+Math.imul(et,Ue)|0,Z=Z+Math.imul(Ze,ke)|0,ue=ue+Math.imul(Ze,Ue)|0,ee=ee+Math.imul(Ge,Qe)|0,Z=Z+Math.imul(Ge,tt)|0,Z=Z+Math.imul(Xe,Qe)|0,ue=ue+Math.imul(Xe,tt)|0,ee=ee+Math.imul(Le,Nt)|0,Z=Z+Math.imul(Le,Rt)|0,Z=Z+Math.imul(qe,Nt)|0,ue=ue+Math.imul(qe,Rt)|0,ee=ee+Math.imul(Ie,Tt)|0,Z=Z+Math.imul(Ie,It)|0,Z=Z+Math.imul(Se,Tt)|0,ue=ue+Math.imul(Se,It)|0,ee=ee+Math.imul(be,jt)|0,Z=Z+Math.imul(be,Ft)|0,Z=Z+Math.imul(Te,jt)|0,ue=ue+Math.imul(Te,Ft)|0;var Dr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Dr>>>26)|0,Dr&=67108863,ee=Math.imul(Ee,at),Z=Math.imul(Ee,ht),Z=Z+Math.imul(Pe,at)|0,ue=Math.imul(Pe,ht),ee=ee+Math.imul(Ct,$t)|0,Z=Z+Math.imul(Ct,St)|0,Z=Z+Math.imul(Me,$t)|0,ue=ue+Math.imul(Me,St)|0,ee=ee+Math.imul(bt,At)|0,Z=Z+Math.imul(bt,Oe)|0,Z=Z+Math.imul(lt,At)|0,ue=ue+Math.imul(lt,Oe)|0,ee=ee+Math.imul(ut,ke)|0,Z=Z+Math.imul(ut,Ue)|0,Z=Z+Math.imul(ot,ke)|0,ue=ue+Math.imul(ot,Ue)|0,ee=ee+Math.imul(et,Qe)|0,Z=Z+Math.imul(et,tt)|0,Z=Z+Math.imul(Ze,Qe)|0,ue=ue+Math.imul(Ze,tt)|0,ee=ee+Math.imul(Ge,Nt)|0,Z=Z+Math.imul(Ge,Rt)|0,Z=Z+Math.imul(Xe,Nt)|0,ue=ue+Math.imul(Xe,Rt)|0,ee=ee+Math.imul(Le,Tt)|0,Z=Z+Math.imul(Le,It)|0,Z=Z+Math.imul(qe,Tt)|0,ue=ue+Math.imul(qe,It)|0,ee=ee+Math.imul(Ie,jt)|0,Z=Z+Math.imul(Ie,Ft)|0,Z=Z+Math.imul(Se,jt)|0,ue=ue+Math.imul(Se,Ft)|0;var br=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(br>>>26)|0,br&=67108863,ee=Math.imul(Ee,$t),Z=Math.imul(Ee,St),Z=Z+Math.imul(Pe,$t)|0,ue=Math.imul(Pe,St),ee=ee+Math.imul(Ct,At)|0,Z=Z+Math.imul(Ct,Oe)|0,Z=Z+Math.imul(Me,At)|0,ue=ue+Math.imul(Me,Oe)|0,ee=ee+Math.imul(bt,ke)|0,Z=Z+Math.imul(bt,Ue)|0,Z=Z+Math.imul(lt,ke)|0,ue=ue+Math.imul(lt,Ue)|0,ee=ee+Math.imul(ut,Qe)|0,Z=Z+Math.imul(ut,tt)|0,Z=Z+Math.imul(ot,Qe)|0,ue=ue+Math.imul(ot,tt)|0,ee=ee+Math.imul(et,Nt)|0,Z=Z+Math.imul(et,Rt)|0,Z=Z+Math.imul(Ze,Nt)|0,ue=ue+Math.imul(Ze,Rt)|0,ee=ee+Math.imul(Ge,Tt)|0,Z=Z+Math.imul(Ge,It)|0,Z=Z+Math.imul(Xe,Tt)|0,ue=ue+Math.imul(Xe,It)|0,ee=ee+Math.imul(Le,jt)|0,Z=Z+Math.imul(Le,Ft)|0,Z=Z+Math.imul(qe,jt)|0,ue=ue+Math.imul(qe,Ft)|0;var Sr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Sr>>>26)|0,Sr&=67108863,ee=Math.imul(Ee,At),Z=Math.imul(Ee,Oe),Z=Z+Math.imul(Pe,At)|0,ue=Math.imul(Pe,Oe),ee=ee+Math.imul(Ct,ke)|0,Z=Z+Math.imul(Ct,Ue)|0,Z=Z+Math.imul(Me,ke)|0,ue=ue+Math.imul(Me,Ue)|0,ee=ee+Math.imul(bt,Qe)|0,Z=Z+Math.imul(bt,tt)|0,Z=Z+Math.imul(lt,Qe)|0,ue=ue+Math.imul(lt,tt)|0,ee=ee+Math.imul(ut,Nt)|0,Z=Z+Math.imul(ut,Rt)|0,Z=Z+Math.imul(ot,Nt)|0,ue=ue+Math.imul(ot,Rt)|0,ee=ee+Math.imul(et,Tt)|0,Z=Z+Math.imul(et,It)|0,Z=Z+Math.imul(Ze,Tt)|0,ue=ue+Math.imul(Ze,It)|0,ee=ee+Math.imul(Ge,jt)|0,Z=Z+Math.imul(Ge,Ft)|0,Z=Z+Math.imul(Xe,jt)|0,ue=ue+Math.imul(Xe,Ft)|0;var Vr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Vr>>>26)|0,Vr&=67108863,ee=Math.imul(Ee,ke),Z=Math.imul(Ee,Ue),Z=Z+Math.imul(Pe,ke)|0,ue=Math.imul(Pe,Ue),ee=ee+Math.imul(Ct,Qe)|0,Z=Z+Math.imul(Ct,tt)|0,Z=Z+Math.imul(Me,Qe)|0,ue=ue+Math.imul(Me,tt)|0,ee=ee+Math.imul(bt,Nt)|0,Z=Z+Math.imul(bt,Rt)|0,Z=Z+Math.imul(lt,Nt)|0,ue=ue+Math.imul(lt,Rt)|0,ee=ee+Math.imul(ut,Tt)|0,Z=Z+Math.imul(ut,It)|0,Z=Z+Math.imul(ot,Tt)|0,ue=ue+Math.imul(ot,It)|0,ee=ee+Math.imul(et,jt)|0,Z=Z+Math.imul(et,Ft)|0,Z=Z+Math.imul(Ze,jt)|0,ue=ue+Math.imul(Ze,Ft)|0;var Br=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Br>>>26)|0,Br&=67108863,ee=Math.imul(Ee,Qe),Z=Math.imul(Ee,tt),Z=Z+Math.imul(Pe,Qe)|0,ue=Math.imul(Pe,tt),ee=ee+Math.imul(Ct,Nt)|0,Z=Z+Math.imul(Ct,Rt)|0,Z=Z+Math.imul(Me,Nt)|0,ue=ue+Math.imul(Me,Rt)|0,ee=ee+Math.imul(bt,Tt)|0,Z=Z+Math.imul(bt,It)|0,Z=Z+Math.imul(lt,Tt)|0,ue=ue+Math.imul(lt,It)|0,ee=ee+Math.imul(ut,jt)|0,Z=Z+Math.imul(ut,Ft)|0,Z=Z+Math.imul(ot,jt)|0,ue=ue+Math.imul(ot,Ft)|0;var Lr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Lr>>>26)|0,Lr&=67108863,ee=Math.imul(Ee,Nt),Z=Math.imul(Ee,Rt),Z=Z+Math.imul(Pe,Nt)|0,ue=Math.imul(Pe,Rt),ee=ee+Math.imul(Ct,Tt)|0,Z=Z+Math.imul(Ct,It)|0,Z=Z+Math.imul(Me,Tt)|0,ue=ue+Math.imul(Me,It)|0,ee=ee+Math.imul(bt,jt)|0,Z=Z+Math.imul(bt,Ft)|0,Z=Z+Math.imul(lt,jt)|0,ue=ue+Math.imul(lt,Ft)|0;var Gr=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(Gr>>>26)|0,Gr&=67108863,ee=Math.imul(Ee,Tt),Z=Math.imul(Ee,It),Z=Z+Math.imul(Pe,Tt)|0,ue=Math.imul(Pe,It),ee=ee+Math.imul(Ct,jt)|0,Z=Z+Math.imul(Ct,Ft)|0,Z=Z+Math.imul(Me,jt)|0,ue=ue+Math.imul(Me,Ft)|0;var tn=(se+ee|0)+((Z&8191)<<13)|0;se=(ue+(Z>>>13)|0)+(tn>>>26)|0,tn&=67108863,ee=Math.imul(Ee,jt),Z=Math.imul(Ee,Ft),Z=Z+Math.imul(Pe,jt)|0,ue=Math.imul(Pe,Ft);var rn=(se+ee|0)+((Z&8191)<<13)|0;return se=(ue+(Z>>>13)|0)+(rn>>>26)|0,rn&=67108863,ne[0]=Kr,ne[1]=Mr,ne[2]=Cr,ne[3]=Pr,ne[4]=wr,ne[5]=Er,ne[6]=$r,ne[7]=_r,ne[8]=Jt,ne[9]=Or,ne[10]=Dr,ne[11]=br,ne[12]=Sr,ne[13]=Vr,ne[14]=Br,ne[15]=Lr,ne[16]=Gr,ne[17]=tn,ne[18]=rn,se!==0&&(ne[19]=se,re.length++),re};Math.imul||(ie=J);function oe(Q,j,z){z.negative=j.negative^Q.negative,z.length=Q.length+j.length;for(var re=0,Y=0,te=0;te<z.length-1;te++){var ne=Y;Y=0;for(var se=re&67108863,ee=Math.min(te,j.length-1),Z=Math.max(0,te-Q.length+1);Z<=ee;Z++){var ue=te-Z,_e=Q.words[ue]|0,Re=j.words[Z]|0,Ae=_e*Re,ge=Ae&67108863;ne=ne+(Ae/67108864|0)|0,ge=ge+se|0,se=ge&67108863,ne=ne+(ge>>>26)|0,Y+=ne>>>26,ne&=67108863}z.words[te]=se,re=ne,ne=Y}return re!==0?z.words[te]=re:z.length--,z._strip()}function le(Q,j,z){return oe(Q,j,z)}w.prototype.mulTo=function(j,z){var re,Y=this.length+j.length;return this.length===10&&j.length===10?re=ie(this,j,z):Y<63?re=J(this,j,z):Y<1024?re=oe(this,j,z):re=le(this,j,z),re},w.prototype.mul=function(j){var z=new w(null);return z.words=new Array(this.length+j.length),this.mulTo(j,z)},w.prototype.mulf=function(j){var z=new w(null);return z.words=new Array(this.length+j.length),le(this,j,z)},w.prototype.imul=function(j){return this.clone().mulTo(j,this)},w.prototype.imuln=function(j){var z=j<0;z&&(j=-j),v(typeof j=="number"),v(j<67108864);for(var re=0,Y=0;Y<this.length;Y++){var te=(this.words[Y]|0)*j,ne=(te&67108863)+(re&67108863);re>>=26,re+=te/67108864|0,re+=ne>>>26,this.words[Y]=ne&67108863}return re!==0&&(this.words[Y]=re,this.length++),this.length=j===0?1:this.length,z?this.ineg():this},w.prototype.muln=function(j){return this.clone().imuln(j)},w.prototype.sqr=function(){return this.mul(this)},w.prototype.isqr=function(){return this.imul(this.clone())},w.prototype.pow=function(j){var z=q(j);if(z.length===0)return new w(1);for(var re=this,Y=0;Y<z.length&&z[Y]===0;Y++,re=re.sqr());if(++Y<z.length)for(var te=re.sqr();Y<z.length;Y++,te=te.sqr())z[Y]!==0&&(re=re.mul(te));return re},w.prototype.iushln=function(j){v(typeof j=="number"&&j>=0);var z=j%26,re=(j-z)/26,Y=67108863>>>26-z<<26-z,te;if(z!==0){var ne=0;for(te=0;te<this.length;te++){var se=this.words[te]&Y,ee=(this.words[te]|0)-se<<z;this.words[te]=ee|ne,ne=se>>>26-z}ne&&(this.words[te]=ne,this.length++)}if(re!==0){for(te=this.length-1;te>=0;te--)this.words[te+re]=this.words[te];for(te=0;te<re;te++)this.words[te]=0;this.length+=re}return this._strip()},w.prototype.ishln=function(j){return v(this.negative===0),this.iushln(j)},w.prototype.iushrn=function(j,z,re){v(typeof j=="number"&&j>=0);var Y;z?Y=(z-z%26)/26:Y=0;var te=j%26,ne=Math.min((j-te)/26,this.length),se=67108863^67108863>>>te<<te,ee=re;if(Y-=ne,Y=Math.max(0,Y),ee){for(var Z=0;Z<ne;Z++)ee.words[Z]=this.words[Z];ee.length=ne}if(ne!==0)if(this.length>ne)for(this.length-=ne,Z=0;Z<this.length;Z++)this.words[Z]=this.words[Z+ne];else this.words[0]=0,this.length=1;var ue=0;for(Z=this.length-1;Z>=0&&(ue!==0||Z>=Y);Z--){var _e=this.words[Z]|0;this.words[Z]=ue<<26-te|_e>>>te,ue=_e&se}return ee&&ue!==0&&(ee.words[ee.length++]=ue),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},w.prototype.ishrn=function(j,z,re){return v(this.negative===0),this.iushrn(j,z,re)},w.prototype.shln=function(j){return this.clone().ishln(j)},w.prototype.ushln=function(j){return this.clone().iushln(j)},w.prototype.shrn=function(j){return this.clone().ishrn(j)},w.prototype.ushrn=function(j){return this.clone().iushrn(j)},w.prototype.testn=function(j){v(typeof j=="number"&&j>=0);var z=j%26,re=(j-z)/26,Y=1<<z;if(this.length<=re)return!1;var te=this.words[re];return!!(te&Y)},w.prototype.imaskn=function(j){v(typeof j=="number"&&j>=0);var z=j%26,re=(j-z)/26;if(v(this.negative===0,"imaskn works only with positive numbers"),this.length<=re)return this;if(z!==0&&re++,this.length=Math.min(re,this.length),z!==0){var Y=67108863^67108863>>>z<<z;this.words[this.length-1]&=Y}return this._strip()},w.prototype.maskn=function(j){return this.clone().imaskn(j)},w.prototype.iaddn=function(j){return v(typeof j=="number"),v(j<67108864),j<0?this.isubn(-j):this.negative!==0?this.length===1&&(this.words[0]|0)<=j?(this.words[0]=j-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(j),this.negative=1,this):this._iaddn(j)},w.prototype._iaddn=function(j){this.words[0]+=j;for(var z=0;z<this.length&&this.words[z]>=67108864;z++)this.words[z]-=67108864,z===this.length-1?this.words[z+1]=1:this.words[z+1]++;return this.length=Math.max(this.length,z+1),this},w.prototype.isubn=function(j){if(v(typeof j=="number"),v(j<67108864),j<0)return this.iaddn(-j);if(this.negative!==0)return this.negative=0,this.iaddn(j),this.negative=1,this;if(this.words[0]-=j,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var z=0;z<this.length&&this.words[z]<0;z++)this.words[z]+=67108864,this.words[z+1]-=1;return this._strip()},w.prototype.addn=function(j){return this.clone().iaddn(j)},w.prototype.subn=function(j){return this.clone().isubn(j)},w.prototype.iabs=function(){return this.negative=0,this},w.prototype.abs=function(){return this.clone().iabs()},w.prototype._ishlnsubmul=function(j,z,re){var Y=j.length+re,te;this._expand(Y);var ne,se=0;for(te=0;te<j.length;te++){ne=(this.words[te+re]|0)+se;var ee=(j.words[te]|0)*z;ne-=ee&67108863,se=(ne>>26)-(ee/67108864|0),this.words[te+re]=ne&67108863}for(;te<this.length-re;te++)ne=(this.words[te+re]|0)+se,se=ne>>26,this.words[te+re]=ne&67108863;if(se===0)return this._strip();for(v(se===-1),se=0,te=0;te<this.length;te++)ne=-(this.words[te]|0)+se,se=ne>>26,this.words[te]=ne&67108863;return this.negative=1,this._strip()},w.prototype._wordDiv=function(j,z){var re=this.length-j.length,Y=this.clone(),te=j,ne=te.words[te.length-1]|0,se=this._countBits(ne);re=26-se,re!==0&&(te=te.ushln(re),Y.iushln(re),ne=te.words[te.length-1]|0);var ee=Y.length-te.length,Z;if(z!=="mod"){Z=new w(null),Z.length=ee+1,Z.words=new Array(Z.length);for(var ue=0;ue<Z.length;ue++)Z.words[ue]=0}var _e=Y.clone()._ishlnsubmul(te,1,ee);_e.negative===0&&(Y=_e,Z&&(Z.words[ee]=1));for(var Re=ee-1;Re>=0;Re--){var Ae=(Y.words[te.length+Re]|0)*67108864+(Y.words[te.length+Re-1]|0);for(Ae=Math.min(Ae/ne|0,67108863),Y._ishlnsubmul(te,Ae,Re);Y.negative!==0;)Ae--,Y.negative=0,Y._ishlnsubmul(te,1,Re),Y.isZero()||(Y.negative^=1);Z&&(Z.words[Re]=Ae)}return Z&&Z._strip(),Y._strip(),z!=="div"&&re!==0&&Y.iushrn(re),{div:Z||null,mod:Y}},w.prototype.divmod=function(j,z,re){if(v(!j.isZero()),this.isZero())return{div:new w(0),mod:new w(0)};var Y,te,ne;return this.negative!==0&&j.negative===0?(ne=this.neg().divmod(j,z),z!=="mod"&&(Y=ne.div.neg()),z!=="div"&&(te=ne.mod.neg(),re&&te.negative!==0&&te.iadd(j)),{div:Y,mod:te}):this.negative===0&&j.negative!==0?(ne=this.divmod(j.neg(),z),z!=="mod"&&(Y=ne.div.neg()),{div:Y,mod:ne.mod}):(this.negative&j.negative)!==0?(ne=this.neg().divmod(j.neg(),z),z!=="div"&&(te=ne.mod.neg(),re&&te.negative!==0&&te.isub(j)),{div:ne.div,mod:te}):j.length>this.length||this.cmp(j)<0?{div:new w(0),mod:this}:j.length===1?z==="div"?{div:this.divn(j.words[0]),mod:null}:z==="mod"?{div:null,mod:new w(this.modrn(j.words[0]))}:{div:this.divn(j.words[0]),mod:new w(this.modrn(j.words[0]))}:this._wordDiv(j,z)},w.prototype.div=function(j){return this.divmod(j,"div",!1).div},w.prototype.mod=function(j){return this.divmod(j,"mod",!1).mod},w.prototype.umod=function(j){return this.divmod(j,"mod",!0).mod},w.prototype.divRound=function(j){var z=this.divmod(j);if(z.mod.isZero())return z.div;var re=z.div.negative!==0?z.mod.isub(j):z.mod,Y=j.ushrn(1),te=j.andln(1),ne=re.cmp(Y);return ne<0||te===1&&ne===0?z.div:z.div.negative!==0?z.div.isubn(1):z.div.iaddn(1)},w.prototype.modrn=function(j){var z=j<0;z&&(j=-j),v(j<=67108863);for(var re=(1<<26)%j,Y=0,te=this.length-1;te>=0;te--)Y=(re*Y+(this.words[te]|0))%j;return z?-Y:Y},w.prototype.modn=function(j){return this.modrn(j)},w.prototype.idivn=function(j){var z=j<0;z&&(j=-j),v(j<=67108863);for(var re=0,Y=this.length-1;Y>=0;Y--){var te=(this.words[Y]|0)+re*67108864;this.words[Y]=te/j|0,re=te%j}return this._strip(),z?this.ineg():this},w.prototype.divn=function(j){return this.clone().idivn(j)},w.prototype.egcd=function(j){v(j.negative===0),v(!j.isZero());var z=this,re=j.clone();z.negative!==0?z=z.umod(j):z=z.clone();for(var Y=new w(1),te=new w(0),ne=new w(0),se=new w(1),ee=0;z.isEven()&&re.isEven();)z.iushrn(1),re.iushrn(1),++ee;for(var Z=re.clone(),ue=z.clone();!z.isZero();){for(var _e=0,Re=1;(z.words[0]&Re)===0&&_e<26;++_e,Re<<=1);if(_e>0)for(z.iushrn(_e);_e-- >0;)(Y.isOdd()||te.isOdd())&&(Y.iadd(Z),te.isub(ue)),Y.iushrn(1),te.iushrn(1);for(var Ae=0,ge=1;(re.words[0]&ge)===0&&Ae<26;++Ae,ge<<=1);if(Ae>0)for(re.iushrn(Ae);Ae-- >0;)(ne.isOdd()||se.isOdd())&&(ne.iadd(Z),se.isub(ue)),ne.iushrn(1),se.iushrn(1);z.cmp(re)>=0?(z.isub(re),Y.isub(ne),te.isub(se)):(re.isub(z),ne.isub(Y),se.isub(te))}return{a:ne,b:se,gcd:re.iushln(ee)}},w.prototype._invmp=function(j){v(j.negative===0),v(!j.isZero());var z=this,re=j.clone();z.negative!==0?z=z.umod(j):z=z.clone();for(var Y=new w(1),te=new w(0),ne=re.clone();z.cmpn(1)>0&&re.cmpn(1)>0;){for(var se=0,ee=1;(z.words[0]&ee)===0&&se<26;++se,ee<<=1);if(se>0)for(z.iushrn(se);se-- >0;)Y.isOdd()&&Y.iadd(ne),Y.iushrn(1);for(var Z=0,ue=1;(re.words[0]&ue)===0&&Z<26;++Z,ue<<=1);if(Z>0)for(re.iushrn(Z);Z-- >0;)te.isOdd()&&te.iadd(ne),te.iushrn(1);z.cmp(re)>=0?(z.isub(re),Y.isub(te)):(re.isub(z),te.isub(Y))}var _e;return z.cmpn(1)===0?_e=Y:_e=te,_e.cmpn(0)<0&&_e.iadd(j),_e},w.prototype.gcd=function(j){if(this.isZero())return j.abs();if(j.isZero())return this.abs();var z=this.clone(),re=j.clone();z.negative=0,re.negative=0;for(var Y=0;z.isEven()&&re.isEven();Y++)z.iushrn(1),re.iushrn(1);do{for(;z.isEven();)z.iushrn(1);for(;re.isEven();)re.iushrn(1);var te=z.cmp(re);if(te<0){var ne=z;z=re,re=ne}else if(te===0||re.cmpn(1)===0)break;z.isub(re)}while(!0);return re.iushln(Y)},w.prototype.invm=function(j){return this.egcd(j).a.umod(j)},w.prototype.isEven=function(){return(this.words[0]&1)===0},w.prototype.isOdd=function(){return(this.words[0]&1)===1},w.prototype.andln=function(j){return this.words[0]&j},w.prototype.bincn=function(j){v(typeof j=="number");var z=j%26,re=(j-z)/26,Y=1<<z;if(this.length<=re)return this._expand(re+1),this.words[re]|=Y,this;for(var te=Y,ne=re;te!==0&&ne<this.length;ne++){var se=this.words[ne]|0;se+=te,te=se>>>26,se&=67108863,this.words[ne]=se}return te!==0&&(this.words[ne]=te,this.length++),this},w.prototype.isZero=function(){return this.length===1&&this.words[0]===0},w.prototype.cmpn=function(j){var z=j<0;if(this.negative!==0&&!z)return-1;if(this.negative===0&&z)return 1;this._strip();var re;if(this.length>1)re=1;else{z&&(j=-j),v(j<=67108863,"Number is too big");var Y=this.words[0]|0;re=Y===j?0:Y<j?-1:1}return this.negative!==0?-re|0:re},w.prototype.cmp=function(j){if(this.negative!==0&&j.negative===0)return-1;if(this.negative===0&&j.negative!==0)return 1;var z=this.ucmp(j);return this.negative!==0?-z|0:z},w.prototype.ucmp=function(j){if(this.length>j.length)return 1;if(this.length<j.length)return-1;for(var z=0,re=this.length-1;re>=0;re--){var Y=this.words[re]|0,te=j.words[re]|0;if(Y!==te){Y<te?z=-1:Y>te&&(z=1);break}}return z},w.prototype.gtn=function(j){return this.cmpn(j)===1},w.prototype.gt=function(j){return this.cmp(j)===1},w.prototype.gten=function(j){return this.cmpn(j)>=0},w.prototype.gte=function(j){return this.cmp(j)>=0},w.prototype.ltn=function(j){return this.cmpn(j)===-1},w.prototype.lt=function(j){return this.cmp(j)===-1},w.prototype.lten=function(j){return this.cmpn(j)<=0},w.prototype.lte=function(j){return this.cmp(j)<=0},w.prototype.eqn=function(j){return this.cmpn(j)===0},w.prototype.eq=function(j){return this.cmp(j)===0},w.red=function(j){return new he(j)},w.prototype.toRed=function(j){return v(!this.red,"Already a number in reduction context"),v(this.negative===0,"red works only with positives"),j.convertTo(this)._forceRed(j)},w.prototype.fromRed=function(){return v(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},w.prototype._forceRed=function(j){return this.red=j,this},w.prototype.forceRed=function(j){return v(!this.red,"Already a number in reduction context"),this._forceRed(j)},w.prototype.redAdd=function(j){return v(this.red,"redAdd works only with red numbers"),this.red.add(this,j)},w.prototype.redIAdd=function(j){return v(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,j)},w.prototype.redSub=function(j){return v(this.red,"redSub works only with red numbers"),this.red.sub(this,j)},w.prototype.redISub=function(j){return v(this.red,"redISub works only with red numbers"),this.red.isub(this,j)},w.prototype.redShl=function(j){return v(this.red,"redShl works only with red numbers"),this.red.shl(this,j)},w.prototype.redMul=function(j){return v(this.red,"redMul works only with red numbers"),this.red._verify2(this,j),this.red.mul(this,j)},w.prototype.redIMul=function(j){return v(this.red,"redMul works only with red numbers"),this.red._verify2(this,j),this.red.imul(this,j)},w.prototype.redSqr=function(){return v(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},w.prototype.redISqr=function(){return v(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},w.prototype.redSqrt=function(){return v(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},w.prototype.redInvm=function(){return v(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},w.prototype.redNeg=function(){return v(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},w.prototype.redPow=function(j){return v(this.red&&!j.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,j)};var de={k256:null,p224:null,p192:null,p25519:null};function fe(Q,j){this.name=Q,this.p=new w(j,16),this.n=this.p.bitLength(),this.k=new w(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}fe.prototype._tmp=function(){var j=new w(null);return j.words=new Array(Math.ceil(this.n/13)),j},fe.prototype.ireduce=function(j){var z=j,re;do this.split(z,this.tmp),z=this.imulK(z),z=z.iadd(this.tmp),re=z.bitLength();while(re>this.n);var Y=re<this.n?-1:z.ucmp(this.p);return Y===0?(z.words[0]=0,z.length=1):Y>0?z.isub(this.p):z.strip!==void 0?z.strip():z._strip(),z},fe.prototype.split=function(j,z){j.iushrn(this.n,0,z)},fe.prototype.imulK=function(j){return j.imul(this.k)};function ye(){fe.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}b(ye,fe),ye.prototype.split=function(j,z){for(var re=4194303,Y=Math.min(j.length,9),te=0;te<Y;te++)z.words[te]=j.words[te];if(z.length=Y,j.length<=9){j.words[0]=0,j.length=1;return}var ne=j.words[9];for(z.words[z.length++]=ne&re,te=10;te<j.length;te++){var se=j.words[te]|0;j.words[te-10]=(se&re)<<4|ne>>>22,ne=se}ne>>>=22,j.words[te-10]=ne,ne===0&&j.length>10?j.length-=10:j.length-=9},ye.prototype.imulK=function(j){j.words[j.length]=0,j.words[j.length+1]=0,j.length+=2;for(var z=0,re=0;re<j.length;re++){var Y=j.words[re]|0;z+=Y*977,j.words[re]=z&67108863,z=Y*64+(z/67108864|0)}return j.words[j.length-1]===0&&(j.length--,j.words[j.length-1]===0&&j.length--),j};function we(){fe.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}b(we,fe);function pe(){fe.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}b(pe,fe);function ve(){fe.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}b(ve,fe),ve.prototype.imulK=function(j){for(var z=0,re=0;re<j.length;re++){var Y=(j.words[re]|0)*19+z,te=Y&67108863;Y>>>=26,j.words[re]=te,z=Y}return z!==0&&(j.words[j.length++]=z),j},w._prime=function(j){if(de[j])return de[j];var z;if(j==="k256")z=new ye;else if(j==="p224")z=new we;else if(j==="p192")z=new pe;else if(j==="p25519")z=new ve;else throw new Error("Unknown prime "+j);return de[j]=z,z};function he(Q){if(typeof Q=="string"){var j=w._prime(Q);this.m=j.p,this.prime=j}else v(Q.gtn(1),"modulus must be greater than 1"),this.m=Q,this.prime=null}he.prototype._verify1=function(j){v(j.negative===0,"red works only with positives"),v(j.red,"red works only with red numbers")},he.prototype._verify2=function(j,z){v((j.negative|z.negative)===0,"red works only with positives"),v(j.red&&j.red===z.red,"red works only with red numbers")},he.prototype.imod=function(j){return this.prime?this.prime.ireduce(j)._forceRed(this):(R(j,j.umod(this.m)._forceRed(this)),j)},he.prototype.neg=function(j){return j.isZero()?j.clone():this.m.sub(j)._forceRed(this)},he.prototype.add=function(j,z){this._verify2(j,z);var re=j.add(z);return re.cmp(this.m)>=0&&re.isub(this.m),re._forceRed(this)},he.prototype.iadd=function(j,z){this._verify2(j,z);var re=j.iadd(z);return re.cmp(this.m)>=0&&re.isub(this.m),re},he.prototype.sub=function(j,z){this._verify2(j,z);var re=j.sub(z);return re.cmpn(0)<0&&re.iadd(this.m),re._forceRed(this)},he.prototype.isub=function(j,z){this._verify2(j,z);var re=j.isub(z);return re.cmpn(0)<0&&re.iadd(this.m),re},he.prototype.shl=function(j,z){return this._verify1(j),this.imod(j.ushln(z))},he.prototype.imul=function(j,z){return this._verify2(j,z),this.imod(j.imul(z))},he.prototype.mul=function(j,z){return this._verify2(j,z),this.imod(j.mul(z))},he.prototype.isqr=function(j){return this.imul(j,j.clone())},he.prototype.sqr=function(j){return this.mul(j,j)},he.prototype.sqrt=function(j){if(j.isZero())return j.clone();var z=this.m.andln(3);if(v(z%2===1),z===3){var re=this.m.add(new w(1)).iushrn(2);return this.pow(j,re)}for(var Y=this.m.subn(1),te=0;!Y.isZero()&&Y.andln(1)===0;)te++,Y.iushrn(1);v(!Y.isZero());var ne=new w(1).toRed(this),se=ne.redNeg(),ee=this.m.subn(1).iushrn(1),Z=this.m.bitLength();for(Z=new w(2*Z*Z).toRed(this);this.pow(Z,ee).cmp(se)!==0;)Z.redIAdd(se);for(var ue=this.pow(Z,Y),_e=this.pow(j,Y.addn(1).iushrn(1)),Re=this.pow(j,Y),Ae=te;Re.cmp(ne)!==0;){for(var ge=Re,be=0;ge.cmp(ne)!==0;be++)ge=ge.redSqr();v(be<Ae);var Te=this.pow(ue,new w(1).iushln(Ae-be-1));_e=_e.redMul(Te),ue=Te.redSqr(),Re=Re.redMul(ue),Ae=be}return _e},he.prototype.invm=function(j){var z=j._invmp(this.m);return z.negative!==0?(z.negative=0,this.imod(z).redNeg()):this.imod(z)},he.prototype.pow=function(j,z){if(z.isZero())return new w(1).toRed(this);if(z.cmpn(1)===0)return j.clone();var re=4,Y=new Array(1<<re);Y[0]=new w(1).toRed(this),Y[1]=j;for(var te=2;te<Y.length;te++)Y[te]=this.mul(Y[te-1],j);var ne=Y[0],se=0,ee=0,Z=z.bitLength()%26;for(Z===0&&(Z=26),te=z.length-1;te>=0;te--){for(var ue=z.words[te],_e=Z-1;_e>=0;_e--){var Re=ue>>_e&1;if(ne!==Y[0]&&(ne=this.sqr(ne)),Re===0&&se===0){ee=0;continue}se<<=1,se|=Re,ee++,!(ee!==re&&(te!==0||_e!==0))&&(ne=this.mul(ne,Y[se]),ee=0,se=0)}Z=26}return ne},he.prototype.convertTo=function(j){var z=j.umod(this.m);return z===j?z.clone():z},he.prototype.convertFrom=function(j){var z=j.clone();return z.red=null,z},w.mont=function(j){return new ae(j)};function ae(Q){he.call(this,Q),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new w(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b(ae,he),ae.prototype.convertTo=function(j){return this.imod(j.ushln(this.shift))},ae.prototype.convertFrom=function(j){var z=this.imod(j.mul(this.rinv));return z.red=null,z},ae.prototype.imul=function(j,z){if(j.isZero()||z.isZero())return j.words[0]=0,j.length=1,j;var re=j.imul(z),Y=re.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),te=re.isub(Y).iushrn(this.shift),ne=te;return te.cmp(this.m)>=0?ne=te.isub(this.m):te.cmpn(0)<0&&(ne=te.iadd(this.m)),ne._forceRed(this)},ae.prototype.mul=function(j,z){if(j.isZero()||z.isZero())return new w(0)._forceRed(this);var re=j.mul(z),Y=re.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),te=re.isub(Y).iushrn(this.shift),ne=te;return te.cmp(this.m)>=0?ne=te.isub(this.m):te.cmpn(0)<0&&(ne=te.iadd(this.m)),ne._forceRed(this)},ae.prototype.invm=function(j){var z=this.imod(j._invmp(this.m).mul(this.r2));return z._forceRed(this)}})(y,bn)})(bn$1)),bn$1.exports}var asn1$1={},asn1={},api={},vmBrowserify={},hasRequiredVmBrowserify;function requireVmBrowserify(){return hasRequiredVmBrowserify||(hasRequiredVmBrowserify=1,(function(exports$1){var indexOf=function(y,u){if(y.indexOf)return y.indexOf(u);for(var g=0;g<y.length;g++)if(y[g]===u)return g;return-1},Object_keys=function(y){if(Object.keys)return Object.keys(y);var u=[];for(var g in y)u.push(g);return u},forEach=function(y,u){if(y.forEach)return y.forEach(u);for(var g=0;g<y.length;g++)u(y[g],g,y)},defineProp=(function(){try{return Object.defineProperty({},"_",{}),function(y,u,g){Object.defineProperty(y,u,{writable:!0,enumerable:!1,configurable:!0,value:g})}}catch{return function(u,g,v){u[g]=v}}})(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports$1.Script=function(u){if(!(this instanceof Script))return new Script(u);this.code=u};Script.prototype.runInContext=function(y){if(!(y instanceof Context))throw new TypeError("needs a 'context' argument.");var u=document.createElement("iframe");u.style||(u.style={}),u.style.display="none",document.body.appendChild(u);var g=u.contentWindow,v=g.eval,b=g.execScript;!v&&b&&(b.call(g,"null"),v=g.eval),forEach(Object_keys(y),function(S){g[S]=y[S]}),forEach(globals,function(S){y[S]&&(g[S]=y[S])});var w=Object_keys(g),E=v.call(g,this.code);return forEach(Object_keys(g),function(S){(S in y||indexOf(w,S)===-1)&&(y[S]=g[S])}),forEach(globals,function(S){S in y||defineProp(y,S,g[S])}),document.body.removeChild(u),E},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(y){var u=Script.createContext(y),g=this.runInContext(u);return y&&forEach(Object_keys(u),function(v){y[v]=u[v]}),g},forEach(Object_keys(Script.prototype),function(y){exports$1[y]=Script[y]=function(u){var g=Script(u);return g[y].apply(g,[].slice.call(arguments,1))}}),exports$1.isContext=function(y){return y instanceof Context},exports$1.createScript=function(y){return exports$1.Script(y)},exports$1.createContext=Script.createContext=function(y){var u=new Context;return typeof y=="object"&&forEach(Object_keys(y),function(g){u[g]=y[g]}),u}})(vmBrowserify)),vmBrowserify}var hasRequiredApi;function requireApi(){return hasRequiredApi||(hasRequiredApi=1,(function(y){var u=requireAsn1$1(),g=requireInherits_browser(),v=y;v.define=function(E,S){return new b(E,S)};function b(w,E){this.name=w,this.body=E,this.decoders={},this.encoders={}}b.prototype._createNamed=function(E){var S;try{S=requireVmBrowserify().runInThisContext("(function "+this.name+`(entity) {
  this._initNamed(entity);
})`)}catch{S=function($){this._initNamed($)}}return g(S,E),S.prototype._initNamed=function($){E.call(this,$)},new S(this)},b.prototype._getDecoder=function(E){return E=E||"der",this.decoders.hasOwnProperty(E)||(this.decoders[E]=this._createNamed(u.decoders[E])),this.decoders[E]},b.prototype.decode=function(E,S,A){return this._getDecoder(S).decode(E,A)},b.prototype._getEncoder=function(E){return E=E||"der",this.encoders.hasOwnProperty(E)||(this.encoders[E]=this._createNamed(u.encoders[E])),this.encoders[E]},b.prototype.encode=function(E,S,A){return this._getEncoder(S).encode(E,A)}})(api)),api}var base$1={},reporter={},hasRequiredReporter;function requireReporter(){if(hasRequiredReporter)return reporter;hasRequiredReporter=1;var y=requireInherits_browser();function u(v){this._reporterState={obj:null,path:[],options:v||{},errors:[]}}reporter.Reporter=u,u.prototype.isError=function(b){return b instanceof g},u.prototype.save=function(){var b=this._reporterState;return{obj:b.obj,pathLen:b.path.length}},u.prototype.restore=function(b){var w=this._reporterState;w.obj=b.obj,w.path=w.path.slice(0,b.pathLen)},u.prototype.enterKey=function(b){return this._reporterState.path.push(b)},u.prototype.exitKey=function(b){var w=this._reporterState;w.path=w.path.slice(0,b-1)},u.prototype.leaveKey=function(b,w,E){var S=this._reporterState;this.exitKey(b),S.obj!==null&&(S.obj[w]=E)},u.prototype.path=function(){return this._reporterState.path.join("/")},u.prototype.enterObject=function(){var b=this._reporterState,w=b.obj;return b.obj={},w},u.prototype.leaveObject=function(b){var w=this._reporterState,E=w.obj;return w.obj=b,E},u.prototype.error=function(b){var w,E=this._reporterState,S=b instanceof g;if(S?w=b:w=new g(E.path.map(function(A){return"["+JSON.stringify(A)+"]"}).join(""),b.message||b,b.stack),!E.options.partial)throw w;return S||E.errors.push(w),w},u.prototype.wrapResult=function(b){var w=this._reporterState;return w.options.partial?{result:this.isError(b)?null:b,errors:w.errors}:b};function g(v,b){this.path=v,this.rethrow(b)}return y(g,Error),g.prototype.rethrow=function(b){if(this.message=b+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,g),!this.stack)try{throw new Error(this.message)}catch(w){this.stack=w.stack}return this},reporter}var buffer$1={},hasRequiredBuffer;function requireBuffer(){if(hasRequiredBuffer)return buffer$1;hasRequiredBuffer=1;var y=requireInherits_browser(),u=requireBase().Reporter,g=requireDist().Buffer;function v(w,E){if(u.call(this,E),!g.isBuffer(w)){this.error("Input not Buffer");return}this.base=w,this.offset=0,this.length=w.length}y(v,u),buffer$1.DecoderBuffer=v,v.prototype.save=function(){return{offset:this.offset,reporter:u.prototype.save.call(this)}},v.prototype.restore=function(E){var S=new v(this.base);return S.offset=E.offset,S.length=this.offset,this.offset=E.offset,u.prototype.restore.call(this,E.reporter),S},v.prototype.isEmpty=function(){return this.offset===this.length},v.prototype.readUInt8=function(E){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(E||"DecoderBuffer overrun")},v.prototype.skip=function(E,S){if(!(this.offset+E<=this.length))return this.error(S||"DecoderBuffer overrun");var A=new v(this.base);return A._reporterState=this._reporterState,A.offset=this.offset,A.length=this.offset+E,this.offset+=E,A},v.prototype.raw=function(E){return this.base.slice(E?E.offset:this.offset,this.length)};function b(w,E){if(Array.isArray(w))this.length=0,this.value=w.map(function(S){return S instanceof b||(S=new b(S,E)),this.length+=S.length,S},this);else if(typeof w=="number"){if(!(0<=w&&w<=255))return E.error("non-byte EncoderBuffer value");this.value=w,this.length=1}else if(typeof w=="string")this.value=w,this.length=g.byteLength(w);else if(g.isBuffer(w))this.value=w,this.length=w.length;else return E.error("Unsupported type: "+typeof w)}return buffer$1.EncoderBuffer=b,b.prototype.join=function(E,S){return E||(E=new g(this.length)),S||(S=0),this.length===0||(Array.isArray(this.value)?this.value.forEach(function(A){A.join(E,S),S+=A.length}):(typeof this.value=="number"?E[S]=this.value:typeof this.value=="string"?E.write(this.value,S):g.isBuffer(this.value)&&this.value.copy(E,S),S+=this.length)),E},buffer$1}var node$2,hasRequiredNode;function requireNode(){if(hasRequiredNode)return node$2;hasRequiredNode=1;var y=requireBase().Reporter,u=requireBase().EncoderBuffer,g=requireBase().DecoderBuffer,v=requireMinimalisticAssert(),b=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],w=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(b),E=["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"];function S($,R){var T={};this._baseState=T,T.enc=$,T.parent=R||null,T.children=null,T.tag=null,T.args=null,T.reverseArgs=null,T.choice=null,T.optional=!1,T.any=!1,T.obj=!1,T.use=null,T.useDecoder=null,T.key=null,T.default=null,T.explicit=null,T.implicit=null,T.contains=null,T.parent||(T.children=[],this._wrap())}node$2=S;var A=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];return S.prototype.clone=function(){var R=this._baseState,T={};A.forEach(function(B){T[B]=R[B]});var O=new this.constructor(T.parent);return O._baseState=T,O},S.prototype._wrap=function(){var R=this._baseState;w.forEach(function(T){this[T]=function(){var B=new this.constructor(this);return R.children.push(B),B[T].apply(B,arguments)}},this)},S.prototype._init=function(R){var T=this._baseState;v(T.parent===null),R.call(this),T.children=T.children.filter(function(O){return O._baseState.parent===this},this),v.equal(T.children.length,1,"Root node can have only one child")},S.prototype._useArgs=function(R){var T=this._baseState,O=R.filter(function(B){return B instanceof this.constructor},this);R=R.filter(function(B){return!(B instanceof this.constructor)},this),O.length!==0&&(v(T.children===null),T.children=O,O.forEach(function(B){B._baseState.parent=this},this)),R.length!==0&&(v(T.args===null),T.args=R,T.reverseArgs=R.map(function(B){if(typeof B!="object"||B.constructor!==Object)return B;var F={};return Object.keys(B).forEach(function(U){U==(U|0)&&(U|=0);var q=B[U];F[q]=U}),F}))},E.forEach(function($){S.prototype[$]=function(){var T=this._baseState;throw new Error($+" not implemented for encoding: "+T.enc)}}),b.forEach(function($){S.prototype[$]=function(){var T=this._baseState,O=Array.prototype.slice.call(arguments);return v(T.tag===null),T.tag=$,this._useArgs(O),this}}),S.prototype.use=function(R){v(R);var T=this._baseState;return v(T.use===null),T.use=R,this},S.prototype.optional=function(){var R=this._baseState;return R.optional=!0,this},S.prototype.def=function(R){var T=this._baseState;return v(T.default===null),T.default=R,T.optional=!0,this},S.prototype.explicit=function(R){var T=this._baseState;return v(T.explicit===null&&T.implicit===null),T.explicit=R,this},S.prototype.implicit=function(R){var T=this._baseState;return v(T.explicit===null&&T.implicit===null),T.implicit=R,this},S.prototype.obj=function(){var R=this._baseState,T=Array.prototype.slice.call(arguments);return R.obj=!0,T.length!==0&&this._useArgs(T),this},S.prototype.key=function(R){var T=this._baseState;return v(T.key===null),T.key=R,this},S.prototype.any=function(){var R=this._baseState;return R.any=!0,this},S.prototype.choice=function(R){var T=this._baseState;return v(T.choice===null),T.choice=R,this._useArgs(Object.keys(R).map(function(O){return R[O]})),this},S.prototype.contains=function(R){var T=this._baseState;return v(T.use===null),T.contains=R,this},S.prototype._decode=function(R,T){var O=this._baseState;if(O.parent===null)return R.wrapResult(O.children[0]._decode(R,T));var B=O.default,F=!0,U=null;if(O.key!==null&&(U=R.enterKey(O.key)),O.optional){var q=null;if(O.explicit!==null?q=O.explicit:O.implicit!==null?q=O.implicit:O.tag!==null&&(q=O.tag),q===null&&!O.any){var J=R.save();try{O.choice===null?this._decodeGeneric(O.tag,R,T):this._decodeChoice(R,T),F=!0}catch{F=!1}R.restore(J)}else if(F=this._peekTag(R,q,O.any),R.isError(F))return F}var ie;if(O.obj&&F&&(ie=R.enterObject()),F){if(O.explicit!==null){var oe=this._decodeTag(R,O.explicit);if(R.isError(oe))return oe;R=oe}var le=R.offset;if(O.use===null&&O.choice===null){if(O.any)var J=R.save();var de=this._decodeTag(R,O.implicit!==null?O.implicit:O.tag,O.any);if(R.isError(de))return de;O.any?B=R.raw(J):R=de}if(T&&T.track&&O.tag!==null&&T.track(R.path(),le,R.length,"tagged"),T&&T.track&&O.tag!==null&&T.track(R.path(),R.offset,R.length,"content"),O.any?B=B:O.choice===null?B=this._decodeGeneric(O.tag,R,T):B=this._decodeChoice(R,T),R.isError(B))return B;if(!O.any&&O.choice===null&&O.children!==null&&O.children.forEach(function(we){we._decode(R,T)}),O.contains&&(O.tag==="octstr"||O.tag==="bitstr")){var fe=new g(B);B=this._getUse(O.contains,R._reporterState.obj)._decode(fe,T)}}return O.obj&&F&&(B=R.leaveObject(ie)),O.key!==null&&(B!==null||F===!0)?R.leaveKey(U,O.key,B):U!==null&&R.exitKey(U),B},S.prototype._decodeGeneric=function(R,T,O){var B=this._baseState;return R==="seq"||R==="set"?null:R==="seqof"||R==="setof"?this._decodeList(T,R,B.args[0],O):/str$/.test(R)?this._decodeStr(T,R,O):R==="objid"&&B.args?this._decodeObjid(T,B.args[0],B.args[1],O):R==="objid"?this._decodeObjid(T,null,null,O):R==="gentime"||R==="utctime"?this._decodeTime(T,R,O):R==="null_"?this._decodeNull(T,O):R==="bool"?this._decodeBool(T,O):R==="objDesc"?this._decodeStr(T,R,O):R==="int"||R==="enum"?this._decodeInt(T,B.args&&B.args[0],O):B.use!==null?this._getUse(B.use,T._reporterState.obj)._decode(T,O):T.error("unknown tag: "+R)},S.prototype._getUse=function(R,T){var O=this._baseState;return O.useDecoder=this._use(R,T),v(O.useDecoder._baseState.parent===null),O.useDecoder=O.useDecoder._baseState.children[0],O.implicit!==O.useDecoder._baseState.implicit&&(O.useDecoder=O.useDecoder.clone(),O.useDecoder._baseState.implicit=O.implicit),O.useDecoder},S.prototype._decodeChoice=function(R,T){var O=this._baseState,B=null,F=!1;return Object.keys(O.choice).some(function(U){var q=R.save(),J=O.choice[U];try{var ie=J._decode(R,T);if(R.isError(ie))return!1;B={type:U,value:ie},F=!0}catch{return R.restore(q),!1}return!0},this),F?B:R.error("Choice not matched")},S.prototype._createEncoderBuffer=function(R){return new u(R,this.reporter)},S.prototype._encode=function(R,T,O){var B=this._baseState;if(!(B.default!==null&&B.default===R)){var F=this._encodeValue(R,T,O);if(F!==void 0&&!this._skipDefault(F,T,O))return F}},S.prototype._encodeValue=function(R,T,O){var B=this._baseState;if(B.parent===null)return B.children[0]._encode(R,T||new y);var J=null;if(this.reporter=T,B.optional&&R===void 0)if(B.default!==null)R=B.default;else return;var F=null,U=!1;if(B.any)J=this._createEncoderBuffer(R);else if(B.choice)J=this._encodeChoice(R,T);else if(B.contains)F=this._getUse(B.contains,O)._encode(R,T),U=!0;else if(B.children)F=B.children.map(function(le){if(le._baseState.tag==="null_")return le._encode(null,T,R);if(le._baseState.key===null)return T.error("Child should have a key");var de=T.enterKey(le._baseState.key);if(typeof R!="object")return T.error("Child expected, but input is not object");var fe=le._encode(R[le._baseState.key],T,R);return T.leaveKey(de),fe},this).filter(function(le){return le}),F=this._createEncoderBuffer(F);else if(B.tag==="seqof"||B.tag==="setof"){if(!(B.args&&B.args.length===1))return T.error("Too many args for : "+B.tag);if(!Array.isArray(R))return T.error("seqof/setof, but data is not Array");var q=this.clone();q._baseState.implicit=null,F=this._createEncoderBuffer(R.map(function(le){var de=this._baseState;return this._getUse(de.args[0],R)._encode(le,T)},q))}else B.use!==null?J=this._getUse(B.use,O)._encode(R,T):(F=this._encodePrimitive(B.tag,R),U=!0);var J;if(!B.any&&B.choice===null){var ie=B.implicit!==null?B.implicit:B.tag,oe=B.implicit===null?"universal":"context";ie===null?B.use===null&&T.error("Tag could be omitted only for .use()"):B.use===null&&(J=this._encodeComposite(ie,U,oe,F))}return B.explicit!==null&&(J=this._encodeComposite(B.explicit,!1,"context",J)),J},S.prototype._encodeChoice=function(R,T){var O=this._baseState,B=O.choice[R.type];return B||v(!1,R.type+" not found in "+JSON.stringify(Object.keys(O.choice))),B._encode(R.value,T)},S.prototype._encodePrimitive=function(R,T){var O=this._baseState;if(/str$/.test(R))return this._encodeStr(T,R);if(R==="objid"&&O.args)return this._encodeObjid(T,O.reverseArgs[0],O.args[1]);if(R==="objid")return this._encodeObjid(T,null,null);if(R==="gentime"||R==="utctime")return this._encodeTime(T,R);if(R==="null_")return this._encodeNull();if(R==="int"||R==="enum")return this._encodeInt(T,O.args&&O.reverseArgs[0]);if(R==="bool")return this._encodeBool(T);if(R==="objDesc")return this._encodeStr(T,R);throw new Error("Unsupported tag: "+R)},S.prototype._isNumstr=function(R){return/^[0-9 ]*$/.test(R)},S.prototype._isPrintstr=function(R){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(R)},node$2}var hasRequiredBase;function requireBase(){return hasRequiredBase||(hasRequiredBase=1,(function(y){var u=y;u.Reporter=requireReporter().Reporter,u.DecoderBuffer=requireBuffer().DecoderBuffer,u.EncoderBuffer=requireBuffer().EncoderBuffer,u.Node=requireNode()})(base$1)),base$1}var constants={},der={},hasRequiredDer$2;function requireDer$2(){return hasRequiredDer$2||(hasRequiredDer$2=1,(function(y){var u=requireConstants();y.tagClass={0:"universal",1:"application",2:"context",3:"private"},y.tagClassByName=u._reverse(y.tagClass),y.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},y.tagByName=u._reverse(y.tag)})(der)),der}var hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,(function(y){var u=y;u._reverse=function(v){var b={};return Object.keys(v).forEach(function(w){(w|0)==w&&(w=w|0);var E=v[w];b[E]=w}),b},u.der=requireDer$2()})(constants)),constants}var decoders$2={},der_1$1,hasRequiredDer$1;function requireDer$1(){if(hasRequiredDer$1)return der_1$1;hasRequiredDer$1=1;var y=requireInherits_browser(),u=requireAsn1$1(),g=u.base,v=u.bignum,b=u.constants.der;function w($){this.enc="der",this.name=$.name,this.entity=$,this.tree=new E,this.tree._init($.body)}der_1$1=w,w.prototype.decode=function(R,T){return R instanceof g.DecoderBuffer||(R=new g.DecoderBuffer(R,T)),this.tree._decode(R,T)};function E($){g.Node.call(this,"der",$)}y(E,g.Node),E.prototype._peekTag=function(R,T,O){if(R.isEmpty())return!1;var B=R.save(),F=S(R,'Failed to peek tag: "'+T+'"');return R.isError(F)?F:(R.restore(B),F.tag===T||F.tagStr===T||F.tagStr+"of"===T||O)},E.prototype._decodeTag=function(R,T,O){var B=S(R,'Failed to decode tag of "'+T+'"');if(R.isError(B))return B;var F=A(R,B.primitive,'Failed to get length of "'+T+'"');if(R.isError(F))return F;if(!O&&B.tag!==T&&B.tagStr!==T&&B.tagStr+"of"!==T)return R.error('Failed to match tag: "'+T+'"');if(B.primitive||F!==null)return R.skip(F,'Failed to match body of: "'+T+'"');var U=R.save(),q=this._skipUntilEnd(R,'Failed to skip indefinite length body: "'+this.tag+'"');return R.isError(q)?q:(F=R.offset-U.offset,R.restore(U),R.skip(F,'Failed to match body of: "'+T+'"'))},E.prototype._skipUntilEnd=function(R,T){for(;;){var O=S(R,T);if(R.isError(O))return O;var B=A(R,O.primitive,T);if(R.isError(B))return B;var F;if(O.primitive||B!==null?F=R.skip(B):F=this._skipUntilEnd(R,T),R.isError(F))return F;if(O.tagStr==="end")break}},E.prototype._decodeList=function(R,T,O,B){for(var F=[];!R.isEmpty();){var U=this._peekTag(R,"end");if(R.isError(U))return U;var q=O.decode(R,"der",B);if(R.isError(q)&&U)break;F.push(q)}return F},E.prototype._decodeStr=function(R,T){if(T==="bitstr"){var O=R.readUInt8();return R.isError(O)?O:{unused:O,data:R.raw()}}else if(T==="bmpstr"){var B=R.raw();if(B.length%2===1)return R.error("Decoding of string type: bmpstr length mismatch");for(var F="",U=0;U<B.length/2;U++)F+=String.fromCharCode(B.readUInt16BE(U*2));return F}else if(T==="numstr"){var q=R.raw().toString("ascii");return this._isNumstr(q)?q:R.error("Decoding of string type: numstr unsupported characters")}else{if(T==="octstr")return R.raw();if(T==="objDesc")return R.raw();if(T==="printstr"){var J=R.raw().toString("ascii");return this._isPrintstr(J)?J:R.error("Decoding of string type: printstr unsupported characters")}else return/str$/.test(T)?R.raw().toString():R.error("Decoding of string type: "+T+" unsupported")}},E.prototype._decodeObjid=function(R,T,O){for(var B,F=[],U=0;!R.isEmpty();){var q=R.readUInt8();U<<=7,U|=q&127,(q&128)===0&&(F.push(U),U=0)}q&128&&F.push(U);var J=F[0]/40|0,ie=F[0]%40;if(O?B=F:B=[J,ie].concat(F.slice(1)),T){var oe=T[B.join(" ")];oe===void 0&&(oe=T[B.join(".")]),oe!==void 0&&(B=oe)}return B},E.prototype._decodeTime=function(R,T){var O=R.raw().toString();if(T==="gentime")var B=O.slice(0,4)|0,F=O.slice(4,6)|0,U=O.slice(6,8)|0,q=O.slice(8,10)|0,J=O.slice(10,12)|0,ie=O.slice(12,14)|0;else if(T==="utctime"){var B=O.slice(0,2)|0,F=O.slice(2,4)|0,U=O.slice(4,6)|0,q=O.slice(6,8)|0,J=O.slice(8,10)|0,ie=O.slice(10,12)|0;B<70?B=2e3+B:B=1900+B}else return R.error("Decoding "+T+" time is not supported yet");return Date.UTC(B,F-1,U,q,J,ie,0)},E.prototype._decodeNull=function(R){return null},E.prototype._decodeBool=function(R){var T=R.readUInt8();return R.isError(T)?T:T!==0},E.prototype._decodeInt=function(R,T){var O=R.raw(),B=new v(O);return T&&(B=T[B.toString(10)]||B),B},E.prototype._use=function(R,T){return typeof R=="function"&&(R=R(T)),R._getDecoder("der").tree};function S($,R){var T=$.readUInt8(R);if($.isError(T))return T;var O=b.tagClass[T>>6],B=(T&32)===0;if((T&31)===31){var F=T;for(T=0;(F&128)===128;){if(F=$.readUInt8(R),$.isError(F))return F;T<<=7,T|=F&127}}else T&=31;var U=b.tag[T];return{cls:O,primitive:B,tag:T,tagStr:U}}function A($,R,T){var O=$.readUInt8(T);if($.isError(O))return O;if(!R&&O===128)return null;if((O&128)===0)return O;var B=O&127;if(B>4)return $.error("length octect is too long");O=0;for(var F=0;F<B;F++){O<<=8;var U=$.readUInt8(T);if($.isError(U))return U;O|=U}return O}return der_1$1}var pem$1,hasRequiredPem$1;function requirePem$1(){if(hasRequiredPem$1)return pem$1;hasRequiredPem$1=1;var y=requireInherits_browser(),u=requireDist().Buffer,g=requireDer$1();function v(b){g.call(this,b),this.enc="pem"}return y(v,g),pem$1=v,v.prototype.decode=function(w,E){for(var S=w.toString().split(/[\r\n]+/g),A=E.label.toUpperCase(),$=/^-----(BEGIN|END) ([^-]+)-----$/,R=-1,T=-1,O=0;O<S.length;O++){var B=S[O].match($);if(B!==null&&B[2]===A)if(R===-1){if(B[1]!=="BEGIN")break;R=O}else{if(B[1]!=="END")break;T=O;break}}if(R===-1||T===-1)throw new Error("PEM section not found for: "+A);var F=S.slice(R+1,T).join("");F.replace(/[^a-z0-9\+\/=]+/gi,"");var U=new u(F,"base64");return g.prototype.decode.call(this,U,E)},pem$1}var hasRequiredDecoders;function requireDecoders(){return hasRequiredDecoders||(hasRequiredDecoders=1,(function(y){var u=y;u.der=requireDer$1(),u.pem=requirePem$1()})(decoders$2)),decoders$2}var encoders={},der_1,hasRequiredDer;function requireDer(){if(hasRequiredDer)return der_1;hasRequiredDer=1;var y=requireInherits_browser(),u=requireDist().Buffer,g=requireAsn1$1(),v=g.base,b=g.constants.der;function w($){this.enc="der",this.name=$.name,this.entity=$,this.tree=new E,this.tree._init($.body)}der_1=w,w.prototype.encode=function(R,T){return this.tree._encode(R,T).join()};function E($){v.Node.call(this,"der",$)}y(E,v.Node),E.prototype._encodeComposite=function(R,T,O,B){var F=A(R,T,O,this.reporter);if(B.length<128){var J=new u(2);return J[0]=F,J[1]=B.length,this._createEncoderBuffer([J,B])}for(var U=1,q=B.length;q>=256;q>>=8)U++;var J=new u(2+U);J[0]=F,J[1]=128|U;for(var q=1+U,ie=B.length;ie>0;q--,ie>>=8)J[q]=ie&255;return this._createEncoderBuffer([J,B])},E.prototype._encodeStr=function(R,T){if(T==="bitstr")return this._createEncoderBuffer([R.unused|0,R.data]);if(T==="bmpstr"){for(var O=new u(R.length*2),B=0;B<R.length;B++)O.writeUInt16BE(R.charCodeAt(B),B*2);return this._createEncoderBuffer(O)}else return T==="numstr"?this._isNumstr(R)?this._createEncoderBuffer(R):this.reporter.error("Encoding of string type: numstr supports only digits and space"):T==="printstr"?this._isPrintstr(R)?this._createEncoderBuffer(R):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(T)?this._createEncoderBuffer(R):T==="objDesc"?this._createEncoderBuffer(R):this.reporter.error("Encoding of string type: "+T+" unsupported")},E.prototype._encodeObjid=function(R,T,O){if(typeof R=="string"){if(!T)return this.reporter.error("string objid given, but no values map found");if(!T.hasOwnProperty(R))return this.reporter.error("objid not found in values map");R=T[R].split(/[\s\.]+/g);for(var B=0;B<R.length;B++)R[B]|=0}else if(Array.isArray(R)){R=R.slice();for(var B=0;B<R.length;B++)R[B]|=0}if(!Array.isArray(R))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(R));if(!O){if(R[1]>=40)return this.reporter.error("Second objid identifier OOB");R.splice(0,2,R[0]*40+R[1])}for(var F=0,B=0;B<R.length;B++){var U=R[B];for(F++;U>=128;U>>=7)F++}for(var q=new u(F),J=q.length-1,B=R.length-1;B>=0;B--){var U=R[B];for(q[J--]=U&127;(U>>=7)>0;)q[J--]=128|U&127}return this._createEncoderBuffer(q)};function S($){return $<10?"0"+$:$}E.prototype._encodeTime=function(R,T){var O,B=new Date(R);return T==="gentime"?O=[S(B.getFullYear()),S(B.getUTCMonth()+1),S(B.getUTCDate()),S(B.getUTCHours()),S(B.getUTCMinutes()),S(B.getUTCSeconds()),"Z"].join(""):T==="utctime"?O=[S(B.getFullYear()%100),S(B.getUTCMonth()+1),S(B.getUTCDate()),S(B.getUTCHours()),S(B.getUTCMinutes()),S(B.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+T+" time is not supported yet"),this._encodeStr(O,"octstr")},E.prototype._encodeNull=function(){return this._createEncoderBuffer("")},E.prototype._encodeInt=function(R,T){if(typeof R=="string"){if(!T)return this.reporter.error("String int or enum given, but no values map");if(!T.hasOwnProperty(R))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(R));R=T[R]}if(typeof R!="number"&&!u.isBuffer(R)){var O=R.toArray();!R.sign&&O[0]&128&&O.unshift(0),R=new u(O)}if(u.isBuffer(R)){var B=R.length;R.length===0&&B++;var U=new u(B);return R.copy(U),R.length===0&&(U[0]=0),this._createEncoderBuffer(U)}if(R<128)return this._createEncoderBuffer(R);if(R<256)return this._createEncoderBuffer([0,R]);for(var B=1,F=R;F>=256;F>>=8)B++;for(var U=new Array(B),F=U.length-1;F>=0;F--)U[F]=R&255,R>>=8;return U[0]&128&&U.unshift(0),this._createEncoderBuffer(new u(U))},E.prototype._encodeBool=function(R){return this._createEncoderBuffer(R?255:0)},E.prototype._use=function(R,T){return typeof R=="function"&&(R=R(T)),R._getEncoder("der").tree},E.prototype._skipDefault=function(R,T,O){var B=this._baseState,F;if(B.default===null)return!1;var U=R.join();if(B.defaultBuffer===void 0&&(B.defaultBuffer=this._encodeValue(B.default,T,O).join()),U.length!==B.defaultBuffer.length)return!1;for(F=0;F<U.length;F++)if(U[F]!==B.defaultBuffer[F])return!1;return!0};function A($,R,T,O){var B;if($==="seqof"?$="seq":$==="setof"&&($="set"),b.tagByName.hasOwnProperty($))B=b.tagByName[$];else if(typeof $=="number"&&($|0)===$)B=$;else return O.error("Unknown tag: "+$);return B>=31?O.error("Multi-octet tag encoding unsupported"):(R||(B|=32),B|=b.tagClassByName[T||"universal"]<<6,B)}return der_1}var pem,hasRequiredPem;function requirePem(){if(hasRequiredPem)return pem;hasRequiredPem=1;var y=requireInherits_browser(),u=requireDer();function g(v){u.call(this,v),this.enc="pem"}return y(g,u),pem=g,g.prototype.encode=function(b,w){for(var E=u.prototype.encode.call(this,b),S=E.toString("base64"),A=["-----BEGIN "+w.label+"-----"],$=0;$<S.length;$+=64)A.push(S.slice($,$+64));return A.push("-----END "+w.label+"-----"),A.join(`
`)},pem}var hasRequiredEncoders;function requireEncoders(){return hasRequiredEncoders||(hasRequiredEncoders=1,(function(y){var u=y;u.der=requireDer(),u.pem=requirePem()})(encoders)),encoders}var hasRequiredAsn1$1;function requireAsn1$1(){return hasRequiredAsn1$1||(hasRequiredAsn1$1=1,(function(y){var u=y;u.bignum=requireBn$2(),u.define=requireApi().define,u.base=requireBase(),u.constants=requireConstants(),u.decoders=requireDecoders(),u.encoders=requireEncoders()})(asn1)),asn1}var certificate,hasRequiredCertificate;function requireCertificate(){if(hasRequiredCertificate)return certificate;hasRequiredCertificate=1;var y=requireAsn1$1(),u=y.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),g=y.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),v=y.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())}),b=y.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(v),this.key("subjectPublicKey").bitstr())}),w=y.define("RelativeDistinguishedName",function(){this.setof(g)}),E=y.define("RDNSequence",function(){this.seqof(w)}),S=y.define("Name",function(){this.choice({rdnSequence:this.use(E)})}),A=y.define("Validity",function(){this.seq().obj(this.key("notBefore").use(u),this.key("notAfter").use(u))}),$=y.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),R=y.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(v),this.key("issuer").use(S),this.key("validity").use(A),this.key("subject").use(S),this.key("subjectPublicKeyInfo").use(b),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof($).optional())}),T=y.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(R),this.key("signatureAlgorithm").use(v),this.key("signatureValue").bitstr())});return certificate=T,certificate}var hasRequiredAsn1;function requireAsn1(){if(hasRequiredAsn1)return asn1$1;hasRequiredAsn1=1;var y=requireAsn1$1();asn1$1.certificate=requireCertificate();var u=y.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});asn1$1.RSAPrivateKey=u;var g=y.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});asn1$1.RSAPublicKey=g;var v=y.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),b=y.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(v),this.key("subjectPublicKey").bitstr())});asn1$1.PublicKey=b;var w=y.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(v),this.key("subjectPrivateKey").octstr())});asn1$1.PrivateKey=w;var E=y.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});asn1$1.EncryptedPrivateKey=E;var S=y.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});asn1$1.DSAPrivateKey=S,asn1$1.DSAparam=y.define("DSAparam",function(){this.int()});var A=y.define("ECParameters",function(){this.choice({namedCurve:this.objid()})}),$=y.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(A),this.key("publicKey").optional().explicit(1).bitstr())});return asn1$1.ECPrivateKey=$,asn1$1.signature=y.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())}),asn1$1}const require$$1={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"};var fixProc,hasRequiredFixProc;function requireFixProc(){if(hasRequiredFixProc)return fixProc;hasRequiredFixProc=1;var y=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,u=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,g=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,v=requireEvp_bytestokey(),b=requireBrowser$8(),w=requireSafeBuffer$2().Buffer;return fixProc=function(E,S){var A=E.toString(),$=A.match(y),R;if($){var O="aes"+$[1],B=w.from($[2],"hex"),F=w.from($[3].replace(/[\r\n]/g,""),"base64"),U=v(S,B.slice(0,8),parseInt($[1],10)).key,q=[],J=b.createDecipheriv(O,U,B);q.push(J.update(F)),q.push(J.final()),R=w.concat(q)}else{var T=A.match(g);R=w.from(T[2].replace(/[\r\n]/g,""),"base64")}var ie=A.match(u)[1];return{tag:ie,data:R}},fixProc}var parseAsn1,hasRequiredParseAsn1;function requireParseAsn1(){if(hasRequiredParseAsn1)return parseAsn1;hasRequiredParseAsn1=1;var y=requireAsn1(),u=require$$1,g=requireFixProc(),v=requireBrowser$8(),b=requireBrowser$9().pbkdf2Sync,w=requireSafeBuffer$2().Buffer;function E(A,$){var R=A.algorithm.decrypt.kde.kdeparams.salt,T=parseInt(A.algorithm.decrypt.kde.kdeparams.iters.toString(),10),O=u[A.algorithm.decrypt.cipher.algo.join(".")],B=A.algorithm.decrypt.cipher.iv,F=A.subjectPrivateKey,U=parseInt(O.split("-")[1],10)/8,q=b($,R,T,U,"sha1"),J=v.createDecipheriv(O,q,B),ie=[];return ie.push(J.update(F)),ie.push(J.final()),w.concat(ie)}function S(A){var $;typeof A=="object"&&!w.isBuffer(A)&&($=A.passphrase,A=A.key),typeof A=="string"&&(A=w.from(A));var R=g(A,$),T=R.tag,O=R.data,B,F;switch(T){case"CERTIFICATE":F=y.certificate.decode(O,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(F||(F=y.PublicKey.decode(O,"der")),B=F.algorithm.algorithm.join("."),B){case"1.2.840.113549.1.1.1":return y.RSAPublicKey.decode(F.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return F.subjectPrivateKey=F.subjectPublicKey,{type:"ec",data:F};case"1.2.840.10040.4.1":return F.algorithm.params.pub_key=y.DSAparam.decode(F.subjectPublicKey.data,"der"),{type:"dsa",data:F.algorithm.params};default:throw new Error("unknown key id "+B)}case"ENCRYPTED PRIVATE KEY":O=y.EncryptedPrivateKey.decode(O,"der"),O=E(O,$);case"PRIVATE KEY":switch(F=y.PrivateKey.decode(O,"der"),B=F.algorithm.algorithm.join("."),B){case"1.2.840.113549.1.1.1":return y.RSAPrivateKey.decode(F.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:F.algorithm.curve,privateKey:y.ECPrivateKey.decode(F.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return F.algorithm.params.priv_key=y.DSAparam.decode(F.subjectPrivateKey,"der"),{type:"dsa",params:F.algorithm.params};default:throw new Error("unknown key id "+B)}case"RSA PUBLIC KEY":return y.RSAPublicKey.decode(O,"der");case"RSA PRIVATE KEY":return y.RSAPrivateKey.decode(O,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:y.DSAPrivateKey.decode(O,"der")};case"EC PRIVATE KEY":return O=y.ECPrivateKey.decode(O,"der"),{curve:O.parameters.value,privateKey:O.privateKey};default:throw new Error("unknown key type "+T)}}return S.signature=y.signature,parseAsn1=S,parseAsn1}const require$$4={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"};var hasRequiredSign;function requireSign(){if(hasRequiredSign)return sign$1.exports;hasRequiredSign=1;var y=requireSafeBuffer$2().Buffer,u=requireBrowser$a(),g=requireBrowserifyRsa(),v=requireElliptic().ec,b=requireBn(),w=requireParseAsn1(),E=require$$4,S=1;function A(J,ie,oe,le,de){var fe=w(ie);if(fe.curve){if(le!=="ecdsa"&&le!=="ecdsa/rsa")throw new Error("wrong private key type");return $(J,fe)}else if(fe.type==="dsa"){if(le!=="dsa")throw new Error("wrong private key type");return R(J,fe,oe)}if(le!=="rsa"&&le!=="ecdsa/rsa")throw new Error("wrong private key type");if(ie.padding!==void 0&&ie.padding!==S)throw new Error("illegal or unsupported padding mode");J=y.concat([de,J]);for(var ye=fe.modulus.byteLength(),we=[0,1];J.length+we.length+1<ye;)we.push(255);we.push(0);for(var pe=-1;++pe<J.length;)we.push(J[pe]);var ve=g(we,fe);return ve}function $(J,ie){var oe=E[ie.curve.join(".")];if(!oe)throw new Error("unknown curve "+ie.curve.join("."));var le=new v(oe),de=le.keyFromPrivate(ie.privateKey),fe=de.sign(J);return y.from(fe.toDER())}function R(J,ie,oe){for(var le=ie.params.priv_key,de=ie.params.p,fe=ie.params.q,ye=ie.params.g,we=new b(0),pe,ve=B(J,fe).mod(fe),he=!1,ae=O(le,fe,J,oe);he===!1;)pe=U(fe,ae,oe),we=q(ye,pe,de,fe),he=pe.invm(fe).imul(ve.add(le.mul(we))).mod(fe),he.cmpn(0)===0&&(he=!1,we=new b(0));return T(we,he)}function T(J,ie){J=J.toArray(),ie=ie.toArray(),J[0]&128&&(J=[0].concat(J)),ie[0]&128&&(ie=[0].concat(ie));var oe=J.length+ie.length+4,le=[48,oe,2,J.length];return le=le.concat(J,[2,ie.length],ie),y.from(le)}function O(J,ie,oe,le){if(J=y.from(J.toArray()),J.length<ie.byteLength()){var de=y.alloc(ie.byteLength()-J.length);J=y.concat([de,J])}var fe=oe.length,ye=F(oe,ie),we=y.alloc(fe);we.fill(1);var pe=y.alloc(fe);return pe=u(le,pe).update(we).update(y.from([0])).update(J).update(ye).digest(),we=u(le,pe).update(we).digest(),pe=u(le,pe).update(we).update(y.from([1])).update(J).update(ye).digest(),we=u(le,pe).update(we).digest(),{k:pe,v:we}}function B(J,ie){var oe=new b(J),le=(J.length<<3)-ie.bitLength();return le>0&&oe.ishrn(le),oe}function F(J,ie){J=B(J,ie),J=J.mod(ie);var oe=y.from(J.toArray());if(oe.length<ie.byteLength()){var le=y.alloc(ie.byteLength()-oe.length);oe=y.concat([le,oe])}return oe}function U(J,ie,oe){var le,de;do{for(le=y.alloc(0);le.length*8<J.bitLength();)ie.v=u(oe,ie.k).update(ie.v).digest(),le=y.concat([le,ie.v]);de=B(le,J),ie.k=u(oe,ie.k).update(ie.v).update(y.from([0])).digest(),ie.v=u(oe,ie.k).update(ie.v).digest()}while(de.cmp(J)!==-1);return de}function q(J,ie,oe,le){return J.toRed(b.mont(oe)).redPow(ie).fromRed().mod(le)}return sign$1.exports=A,sign$1.exports.getKey=O,sign$1.exports.makeKey=U,sign$1.exports}var verify_1,hasRequiredVerify;function requireVerify(){if(hasRequiredVerify)return verify_1;hasRequiredVerify=1;var y=requireSafeBuffer$2().Buffer,u=requireBn(),g=requireElliptic().ec,v=requireParseAsn1(),b=require$$4;function w($,R,T,O,B){var F=v(T);if(F.type==="ec"){if(O!=="ecdsa"&&O!=="ecdsa/rsa")throw new Error("wrong public key type");return E($,R,F)}else if(F.type==="dsa"){if(O!=="dsa")throw new Error("wrong public key type");return S($,R,F)}if(O!=="rsa"&&O!=="ecdsa/rsa")throw new Error("wrong public key type");R=y.concat([B,R]);for(var U=F.modulus.byteLength(),q=[1],J=0;R.length+q.length+2<U;)q.push(255),J+=1;q.push(0);for(var ie=-1;++ie<R.length;)q.push(R[ie]);q=y.from(q);var oe=u.mont(F.modulus);$=new u($).toRed(oe),$=$.redPow(new u(F.publicExponent)),$=y.from($.fromRed().toArray());var le=J<8?1:0;for(U=Math.min($.length,q.length),$.length!==q.length&&(le=1),ie=-1;++ie<U;)le|=$[ie]^q[ie];return le===0}function E($,R,T){var O=b[T.data.algorithm.curve.join(".")];if(!O)throw new Error("unknown curve "+T.data.algorithm.curve.join("."));var B=new g(O),F=T.data.subjectPrivateKey.data;return B.verify(R,$,F)}function S($,R,T){var O=T.data.p,B=T.data.q,F=T.data.g,U=T.data.pub_key,q=v.signature.decode($,"der"),J=q.s,ie=q.r;A(J,B),A(ie,B);var oe=u.mont(O),le=J.invm(B),de=F.toRed(oe).redPow(new u(R).mul(le).mod(B)).fromRed().mul(U.toRed(oe).redPow(ie.mul(le).mod(B)).fromRed()).mod(O).mod(B);return de.cmp(ie)===0}function A($,R){if($.cmpn(0)<=0)throw new Error("invalid sig");if($.cmp(R)>=0)throw new Error("invalid sig")}return verify_1=w,verify_1}var browser$6,hasRequiredBrowser$5;function requireBrowser$5(){if(hasRequiredBrowser$5)return browser$6;hasRequiredBrowser$5=1;var y=requireSafeBuffer$2().Buffer,u=requireBrowser$b(),g=requireReadableBrowser(),v=requireInherits_browser(),b=requireSign(),w=requireVerify(),E=require$$6;Object.keys(E).forEach(function(T){E[T].id=y.from(E[T].id,"hex"),E[T.toLowerCase()]=E[T]});function S(T){g.Writable.call(this);var O=E[T];if(!O)throw new Error("Unknown message digest");this._hashType=O.hash,this._hash=u(O.hash),this._tag=O.id,this._signType=O.sign}v(S,g.Writable),S.prototype._write=function(O,B,F){this._hash.update(O),F()},S.prototype.update=function(O,B){return this._hash.update(typeof O=="string"?y.from(O,B):O),this},S.prototype.sign=function(O,B){this.end();var F=this._hash.digest(),U=b(F,O,this._hashType,this._signType,this._tag);return B?U.toString(B):U};function A(T){g.Writable.call(this);var O=E[T];if(!O)throw new Error("Unknown message digest");this._hash=u(O.hash),this._tag=O.id,this._signType=O.sign}v(A,g.Writable),A.prototype._write=function(O,B,F){this._hash.update(O),F()},A.prototype.update=function(O,B){return this._hash.update(typeof O=="string"?y.from(O,B):O),this},A.prototype.verify=function(O,B,F){var U=typeof B=="string"?y.from(B,F):B;this.end();var q=this._hash.digest();return w(U,q,O,this._signType,this._tag)};function $(T){return new S(T)}function R(T){return new A(T)}return browser$6={Sign:$,Verify:R,createSign:$,createVerify:R},browser$6}var browser$5,hasRequiredBrowser$4;function requireBrowser$4(){if(hasRequiredBrowser$4)return browser$5;hasRequiredBrowser$4=1;var y=requireElliptic(),u=requireBn$2();browser$5=function(E){return new v(E)};var g={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};g.p224=g.secp224r1,g.p256=g.secp256r1=g.prime256v1,g.p192=g.secp192r1=g.prime192v1,g.p384=g.secp384r1,g.p521=g.secp521r1;function v(w){this.curveType=g[w],this.curveType||(this.curveType={name:w}),this.curve=new y.ec(this.curveType.name),this.keys=void 0}v.prototype.generateKeys=function(w,E){return this.keys=this.curve.genKeyPair(),this.getPublicKey(w,E)},v.prototype.computeSecret=function(w,E,S){E=E||"utf8",Buffer.isBuffer(w)||(w=new Buffer(w,E));var A=this.curve.keyFromPublic(w).getPublic(),$=A.mul(this.keys.getPrivate()).getX();return b($,S,this.curveType.byteLength)},v.prototype.getPublicKey=function(w,E){var S=this.keys.getPublic(E==="compressed",!0);return E==="hybrid"&&(S[S.length-1]%2?S[0]=7:S[0]=6),b(S,w)},v.prototype.getPrivateKey=function(w){return b(this.keys.getPrivate(),w)},v.prototype.setPublicKey=function(w,E){return E=E||"utf8",Buffer.isBuffer(w)||(w=new Buffer(w,E)),this.keys._importPublic(w),this},v.prototype.setPrivateKey=function(w,E){E=E||"utf8",Buffer.isBuffer(w)||(w=new Buffer(w,E));var S=new u(w);return S=S.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(S),this};function b(w,E,S){Array.isArray(w)||(w=w.toArray());var A=new Buffer(w);if(S&&A.length<S){var $=new Buffer(S-A.length);$.fill(0),A=Buffer.concat([$,A])}return E?A.toString(E):A}return browser$5}var browser$4={},mgf,hasRequiredMgf;function requireMgf(){if(hasRequiredMgf)return mgf;hasRequiredMgf=1;var y=requireBrowser$b(),u=requireSafeBuffer$2().Buffer;mgf=function(v,b){for(var w=u.alloc(0),E=0,S;w.length<b;)S=g(E++),w=u.concat([w,y("sha1").update(v).update(S).digest()]);return w.slice(0,b)};function g(v){var b=u.allocUnsafe(4);return b.writeUInt32BE(v,0),b}return mgf}var xor$1,hasRequiredXor;function requireXor(){return hasRequiredXor||(hasRequiredXor=1,xor$1=function(u,g){for(var v=u.length,b=-1;++b<v;)u[b]^=g[b];return u}),xor$1}var withPublic_1,hasRequiredWithPublic;function requireWithPublic(){if(hasRequiredWithPublic)return withPublic_1;hasRequiredWithPublic=1;var y=requireBn$2(),u=requireSafeBuffer$2().Buffer;function g(v,b){return u.from(v.toRed(y.mont(b.modulus)).redPow(new y(b.publicExponent)).fromRed().toArray())}return withPublic_1=g,withPublic_1}var publicEncrypt,hasRequiredPublicEncrypt;function requirePublicEncrypt(){if(hasRequiredPublicEncrypt)return publicEncrypt;hasRequiredPublicEncrypt=1;var y=requireParseAsn1(),u=requireBrowser$d(),g=requireBrowser$b(),v=requireMgf(),b=requireXor(),w=requireBn$2(),E=requireWithPublic(),S=requireBrowserifyRsa(),A=requireSafeBuffer$2().Buffer;publicEncrypt=function(B,F,U){var q;B.padding?q=B.padding:U?q=1:q=4;var J=y(B),ie;if(q===4)ie=$(J,F);else if(q===1)ie=R(J,F,U);else if(q===3){if(ie=new w(F),ie.cmp(J.modulus)>=0)throw new Error("data too long for modulus")}else throw new Error("unknown padding");return U?S(ie,J):E(ie,J)};function $(O,B){var F=O.modulus.byteLength(),U=B.length,q=g("sha1").update(A.alloc(0)).digest(),J=q.length,ie=2*J;if(U>F-ie-2)throw new Error("message too long");var oe=A.alloc(F-U-ie-2),le=F-J-1,de=u(J),fe=b(A.concat([q,oe,A.alloc(1,1),B],le),v(de,le)),ye=b(de,v(fe,J));return new w(A.concat([A.alloc(1),ye,fe],F))}function R(O,B,F){var U=B.length,q=O.modulus.byteLength();if(U>q-11)throw new Error("message too long");var J;return F?J=A.alloc(q-U-3,255):J=T(q-U-3),new w(A.concat([A.from([0,F?1:2]),J,A.alloc(1),B],q))}function T(O){for(var B=A.allocUnsafe(O),F=0,U=u(O*2),q=0,J;F<O;)q===U.length&&(U=u(O*2),q=0),J=U[q++],J&&(B[F++]=J);return B}return publicEncrypt}var privateDecrypt,hasRequiredPrivateDecrypt;function requirePrivateDecrypt(){if(hasRequiredPrivateDecrypt)return privateDecrypt;hasRequiredPrivateDecrypt=1;var y=requireParseAsn1(),u=requireMgf(),g=requireXor(),v=requireBn$2(),b=requireBrowserifyRsa(),w=requireBrowser$b(),E=requireWithPublic(),S=requireSafeBuffer$2().Buffer;privateDecrypt=function(O,B,F){var U;O.padding?U=O.padding:F?U=1:U=4;var q=y(O),J=q.modulus.byteLength();if(B.length>J||new v(B).cmp(q.modulus)>=0)throw new Error("decryption error");var ie;F?ie=E(new v(B),q):ie=b(B,q);var oe=S.alloc(J-ie.length);if(ie=S.concat([oe,ie],J),U===4)return A(q,ie);if(U===1)return $(q,ie,F);if(U===3)return ie;throw new Error("unknown padding")};function A(T,O){var B=T.modulus.byteLength(),F=w("sha1").update(S.alloc(0)).digest(),U=F.length;if(O[0]!==0)throw new Error("decryption error");var q=O.slice(1,U+1),J=O.slice(U+1),ie=g(q,u(J,U)),oe=g(J,u(ie,B-U-1));if(R(F,oe.slice(0,U)))throw new Error("decryption error");for(var le=U;oe[le]===0;)le++;if(oe[le++]!==1)throw new Error("decryption error");return oe.slice(le)}function $(T,O,B){for(var F=O.slice(0,2),U=2,q=0;O[U++]!==0;)if(U>=O.length){q++;break}var J=O.slice(2,U-1);if((F.toString("hex")!=="0002"&&!B||F.toString("hex")!=="0001"&&B)&&q++,J.length<8&&q++,q)throw new Error("decryption error");return O.slice(U)}function R(T,O){T=S.from(T),O=S.from(O);var B=0,F=T.length;T.length!==O.length&&(B++,F=Math.min(T.length,O.length));for(var U=-1;++U<F;)B+=T[U]^O[U];return B}return privateDecrypt}var hasRequiredBrowser$3;function requireBrowser$3(){return hasRequiredBrowser$3||(hasRequiredBrowser$3=1,(function(y){y.publicEncrypt=requirePublicEncrypt(),y.privateDecrypt=requirePrivateDecrypt(),y.privateEncrypt=function(g,v){return y.publicEncrypt(g,v,!0)},y.publicDecrypt=function(g,v){return y.privateDecrypt(g,v,!0)}})(browser$4)),browser$4}var browser$3={},hasRequiredBrowser$2;function requireBrowser$2(){if(hasRequiredBrowser$2)return browser$3;hasRequiredBrowser$2=1;function y(){throw new Error(`secure random number generation not supported by this browser
use chrome, FireFox or Internet Explorer 11`)}var u=requireSafeBuffer$2(),g=requireBrowser$d(),v=u.Buffer,b=u.kMaxLength,w=commonjsGlobal.crypto||commonjsGlobal.msCrypto,E=Math.pow(2,32)-1;function S(O,B){if(typeof O!="number"||O!==O)throw new TypeError("offset must be a number");if(O>E||O<0)throw new TypeError("offset must be a uint32");if(O>b||O>B)throw new RangeError("offset out of range")}function A(O,B,F){if(typeof O!="number"||O!==O)throw new TypeError("size must be a number");if(O>E||O<0)throw new TypeError("size must be a uint32");if(O+B>F||O>b)throw new RangeError("buffer too small")}w&&w.getRandomValues||!process$1.browser?(browser$3.randomFill=$,browser$3.randomFillSync=T):(browser$3.randomFill=y,browser$3.randomFillSync=y);function $(O,B,F,U){if(!v.isBuffer(O)&&!(O instanceof commonjsGlobal.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if(typeof B=="function")U=B,B=0,F=O.length;else if(typeof F=="function")U=F,F=O.length-B;else if(typeof U!="function")throw new TypeError('"cb" argument must be a function');return S(B,O.length),A(F,B,O.length),R(O,B,F,U)}function R(O,B,F,U){if(process$1.browser){var q=O.buffer,J=new Uint8Array(q,B,F);if(w.getRandomValues(J),U){process$1.nextTick(function(){U(null,O)});return}return O}if(U){g(F,function(oe,le){if(oe)return U(oe);le.copy(O,B),U(null,O)});return}var ie=g(F);return ie.copy(O,B),O}function T(O,B,F){if(typeof B>"u"&&(B=0),!v.isBuffer(O)&&!(O instanceof commonjsGlobal.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return S(B,O.length),F===void 0&&(F=O.length-B),A(F,B,O.length),R(O,B,F)}return browser$3}var hasRequiredCryptoBrowserify;function requireCryptoBrowserify(){if(hasRequiredCryptoBrowserify)return cryptoBrowserify;hasRequiredCryptoBrowserify=1,cryptoBrowserify.randomBytes=cryptoBrowserify.rng=cryptoBrowserify.pseudoRandomBytes=cryptoBrowserify.prng=requireBrowser$d(),cryptoBrowserify.createHash=cryptoBrowserify.Hash=requireBrowser$b(),cryptoBrowserify.createHmac=cryptoBrowserify.Hmac=requireBrowser$a();var y=requireAlgos(),u=Object.keys(y),g=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(u);cryptoBrowserify.getHashes=function(){return g};var v=requireBrowser$9();cryptoBrowserify.pbkdf2=v.pbkdf2,cryptoBrowserify.pbkdf2Sync=v.pbkdf2Sync;var b=requireBrowser$7();cryptoBrowserify.Cipher=b.Cipher,cryptoBrowserify.createCipher=b.createCipher,cryptoBrowserify.Cipheriv=b.Cipheriv,cryptoBrowserify.createCipheriv=b.createCipheriv,cryptoBrowserify.Decipher=b.Decipher,cryptoBrowserify.createDecipher=b.createDecipher,cryptoBrowserify.Decipheriv=b.Decipheriv,cryptoBrowserify.createDecipheriv=b.createDecipheriv,cryptoBrowserify.getCiphers=b.getCiphers,cryptoBrowserify.listCiphers=b.listCiphers;var w=requireBrowser$6();cryptoBrowserify.DiffieHellmanGroup=w.DiffieHellmanGroup,cryptoBrowserify.createDiffieHellmanGroup=w.createDiffieHellmanGroup,cryptoBrowserify.getDiffieHellman=w.getDiffieHellman,cryptoBrowserify.createDiffieHellman=w.createDiffieHellman,cryptoBrowserify.DiffieHellman=w.DiffieHellman;var E=requireBrowser$5();cryptoBrowserify.createSign=E.createSign,cryptoBrowserify.Sign=E.Sign,cryptoBrowserify.createVerify=E.createVerify,cryptoBrowserify.Verify=E.Verify,cryptoBrowserify.createECDH=requireBrowser$4();var S=requireBrowser$3();cryptoBrowserify.publicEncrypt=S.publicEncrypt,cryptoBrowserify.privateEncrypt=S.privateEncrypt,cryptoBrowserify.publicDecrypt=S.publicDecrypt,cryptoBrowserify.privateDecrypt=S.privateDecrypt;var A=requireBrowser$2();return cryptoBrowserify.randomFill=A.randomFill,cryptoBrowserify.randomFillSync=A.randomFillSync,cryptoBrowserify.createCredentials=function(){throw new Error(`sorry, createCredentials is not implemented yet
we accept pull requests
https://github.com/browserify/crypto-browserify`)},cryptoBrowserify.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6},cryptoBrowserify}var core=core$1.exports,hasRequiredCore;function requireCore(){return hasRequiredCore||(hasRequiredCore=1,(function(y,u){(function(g,v){y.exports=v()})(core,function(){var g=g||(function(v,b){var w;if(typeof window<"u"&&window.crypto&&(w=window.crypto),typeof self<"u"&&self.crypto&&(w=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(w=globalThis.crypto),!w&&typeof window<"u"&&window.msCrypto&&(w=window.msCrypto),!w&&typeof commonjsGlobal<"u"&&commonjsGlobal.crypto&&(w=commonjsGlobal.crypto),!w&&typeof commonjsRequire=="function")try{w=requireCryptoBrowserify()}catch{}var E=function(){if(w){if(typeof w.getRandomValues=="function")try{return w.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof w.randomBytes=="function")try{return w.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},S=Object.create||(function(){function ie(){}return function(oe){var le;return ie.prototype=oe,le=new ie,ie.prototype=null,le}})(),A={},$=A.lib={},R=$.Base=(function(){return{extend:function(ie){var oe=S(this);return ie&&oe.mixIn(ie),(!oe.hasOwnProperty("init")||this.init===oe.init)&&(oe.init=function(){oe.$super.init.apply(this,arguments)}),oe.init.prototype=oe,oe.$super=this,oe},create:function(){var ie=this.extend();return ie.init.apply(ie,arguments),ie},init:function(){},mixIn:function(ie){for(var oe in ie)ie.hasOwnProperty(oe)&&(this[oe]=ie[oe]);ie.hasOwnProperty("toString")&&(this.toString=ie.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),T=$.WordArray=R.extend({init:function(ie,oe){ie=this.words=ie||[],oe!=b?this.sigBytes=oe:this.sigBytes=ie.length*4},toString:function(ie){return(ie||B).stringify(this)},concat:function(ie){var oe=this.words,le=ie.words,de=this.sigBytes,fe=ie.sigBytes;if(this.clamp(),de%4)for(var ye=0;ye<fe;ye++){var we=le[ye>>>2]>>>24-ye%4*8&255;oe[de+ye>>>2]|=we<<24-(de+ye)%4*8}else for(var pe=0;pe<fe;pe+=4)oe[de+pe>>>2]=le[pe>>>2];return this.sigBytes+=fe,this},clamp:function(){var ie=this.words,oe=this.sigBytes;ie[oe>>>2]&=4294967295<<32-oe%4*8,ie.length=v.ceil(oe/4)},clone:function(){var ie=R.clone.call(this);return ie.words=this.words.slice(0),ie},random:function(ie){for(var oe=[],le=0;le<ie;le+=4)oe.push(E());return new T.init(oe,ie)}}),O=A.enc={},B=O.Hex={stringify:function(ie){for(var oe=ie.words,le=ie.sigBytes,de=[],fe=0;fe<le;fe++){var ye=oe[fe>>>2]>>>24-fe%4*8&255;de.push((ye>>>4).toString(16)),de.push((ye&15).toString(16))}return de.join("")},parse:function(ie){for(var oe=ie.length,le=[],de=0;de<oe;de+=2)le[de>>>3]|=parseInt(ie.substr(de,2),16)<<24-de%8*4;return new T.init(le,oe/2)}},F=O.Latin1={stringify:function(ie){for(var oe=ie.words,le=ie.sigBytes,de=[],fe=0;fe<le;fe++){var ye=oe[fe>>>2]>>>24-fe%4*8&255;de.push(String.fromCharCode(ye))}return de.join("")},parse:function(ie){for(var oe=ie.length,le=[],de=0;de<oe;de++)le[de>>>2]|=(ie.charCodeAt(de)&255)<<24-de%4*8;return new T.init(le,oe)}},U=O.Utf8={stringify:function(ie){try{return decodeURIComponent(escape(F.stringify(ie)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(ie){return F.parse(unescape(encodeURIComponent(ie)))}},q=$.BufferedBlockAlgorithm=R.extend({reset:function(){this._data=new T.init,this._nDataBytes=0},_append:function(ie){typeof ie=="string"&&(ie=U.parse(ie)),this._data.concat(ie),this._nDataBytes+=ie.sigBytes},_process:function(ie){var oe,le=this._data,de=le.words,fe=le.sigBytes,ye=this.blockSize,we=ye*4,pe=fe/we;ie?pe=v.ceil(pe):pe=v.max((pe|0)-this._minBufferSize,0);var ve=pe*ye,he=v.min(ve*4,fe);if(ve){for(var ae=0;ae<ve;ae+=ye)this._doProcessBlock(de,ae);oe=de.splice(0,ve),le.sigBytes-=he}return new T.init(oe,he)},clone:function(){var ie=R.clone.call(this);return ie._data=this._data.clone(),ie},_minBufferSize:0});$.Hasher=q.extend({cfg:R.extend(),init:function(ie){this.cfg=this.cfg.extend(ie),this.reset()},reset:function(){q.reset.call(this),this._doReset()},update:function(ie){return this._append(ie),this._process(),this},finalize:function(ie){ie&&this._append(ie);var oe=this._doFinalize();return oe},blockSize:16,_createHelper:function(ie){return function(oe,le){return new ie.init(le).finalize(oe)}},_createHmacHelper:function(ie){return function(oe,le){return new J.HMAC.init(ie,le).finalize(oe)}}});var J=A.algo={};return A})(Math);return g})})(core$1)),core$1.exports}var x64Core$1={exports:{}},x64Core=x64Core$1.exports,hasRequiredX64Core;function requireX64Core(){return hasRequiredX64Core||(hasRequiredX64Core=1,(function(y,u){(function(g,v){y.exports=v(requireCore())})(x64Core,function(g){return(function(v){var b=g,w=b.lib,E=w.Base,S=w.WordArray,A=b.x64={};A.Word=E.extend({init:function($,R){this.high=$,this.low=R}}),A.WordArray=E.extend({init:function($,R){$=this.words=$||[],R!=v?this.sigBytes=R:this.sigBytes=$.length*8},toX32:function(){for(var $=this.words,R=$.length,T=[],O=0;O<R;O++){var B=$[O];T.push(B.high),T.push(B.low)}return S.create(T,this.sigBytes)},clone:function(){for(var $=E.clone.call(this),R=$.words=this.words.slice(0),T=R.length,O=0;O<T;O++)R[O]=R[O].clone();return $}})})(),g})})(x64Core$1)),x64Core$1.exports}var libTypedarrays$1={exports:{}},libTypedarrays=libTypedarrays$1.exports,hasRequiredLibTypedarrays;function requireLibTypedarrays(){return hasRequiredLibTypedarrays||(hasRequiredLibTypedarrays=1,(function(y,u){(function(g,v){y.exports=v(requireCore())})(libTypedarrays,function(g){return(function(){if(typeof ArrayBuffer=="function"){var v=g,b=v.lib,w=b.WordArray,E=w.init,S=w.init=function(A){if(A instanceof ArrayBuffer&&(A=new Uint8Array(A)),(A instanceof Int8Array||typeof Uint8ClampedArray<"u"&&A instanceof Uint8ClampedArray||A instanceof Int16Array||A instanceof Uint16Array||A instanceof Int32Array||A instanceof Uint32Array||A instanceof Float32Array||A instanceof Float64Array)&&(A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength)),A instanceof Uint8Array){for(var $=A.byteLength,R=[],T=0;T<$;T++)R[T>>>2]|=A[T]<<24-T%4*8;E.call(this,R,$)}else E.apply(this,arguments)};S.prototype=w}})(),g.lib.WordArray})})(libTypedarrays$1)),libTypedarrays$1.exports}var encUtf16$1={exports:{}},encUtf16=encUtf16$1.exports,hasRequiredEncUtf16;function requireEncUtf16(){return hasRequiredEncUtf16||(hasRequiredEncUtf16=1,(function(y,u){(function(g,v){y.exports=v(requireCore())})(encUtf16,function(g){return(function(){var v=g,b=v.lib,w=b.WordArray,E=v.enc;E.Utf16=E.Utf16BE={stringify:function(A){for(var $=A.words,R=A.sigBytes,T=[],O=0;O<R;O+=2){var B=$[O>>>2]>>>16-O%4*8&65535;T.push(String.fromCharCode(B))}return T.join("")},parse:function(A){for(var $=A.length,R=[],T=0;T<$;T++)R[T>>>1]|=A.charCodeAt(T)<<16-T%2*16;return w.create(R,$*2)}},E.Utf16LE={stringify:function(A){for(var $=A.words,R=A.sigBytes,T=[],O=0;O<R;O+=2){var B=S($[O>>>2]>>>16-O%4*8&65535);T.push(String.fromCharCode(B))}return T.join("")},parse:function(A){for(var $=A.length,R=[],T=0;T<$;T++)R[T>>>1]|=S(A.charCodeAt(T)<<16-T%2*16);return w.create(R,$*2)}};function S(A){return A<<8&4278255360|A>>>8&16711935}})(),g.enc.Utf16})})(encUtf16$1)),encUtf16$1.exports}var encBase64$1={exports:{}},encBase64=encBase64$1.exports,hasRequiredEncBase64;function requireEncBase64(){return hasRequiredEncBase64||(hasRequiredEncBase64=1,(function(y,u){(function(g,v){y.exports=v(requireCore())})(encBase64,function(g){return(function(){var v=g,b=v.lib,w=b.WordArray,E=v.enc;E.Base64={stringify:function(A){var $=A.words,R=A.sigBytes,T=this._map;A.clamp();for(var O=[],B=0;B<R;B+=3)for(var F=$[B>>>2]>>>24-B%4*8&255,U=$[B+1>>>2]>>>24-(B+1)%4*8&255,q=$[B+2>>>2]>>>24-(B+2)%4*8&255,J=F<<16|U<<8|q,ie=0;ie<4&&B+ie*.75<R;ie++)O.push(T.charAt(J>>>6*(3-ie)&63));var oe=T.charAt(64);if(oe)for(;O.length%4;)O.push(oe);return O.join("")},parse:function(A){var $=A.length,R=this._map,T=this._reverseMap;if(!T){T=this._reverseMap=[];for(var O=0;O<R.length;O++)T[R.charCodeAt(O)]=O}var B=R.charAt(64);if(B){var F=A.indexOf(B);F!==-1&&($=F)}return S(A,$,T)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function S(A,$,R){for(var T=[],O=0,B=0;B<$;B++)if(B%4){var F=R[A.charCodeAt(B-1)]<<B%4*2,U=R[A.charCodeAt(B)]>>>6-B%4*2,q=F|U;T[O>>>2]|=q<<24-O%4*8,O++}return w.create(T,O)}})(),g.enc.Base64})})(encBase64$1)),encBase64$1.exports}var encBase64url$1={exports:{}},encBase64url=encBase64url$1.exports,hasRequiredEncBase64url;function requireEncBase64url(){return hasRequiredEncBase64url||(hasRequiredEncBase64url=1,(function(y,u){(function(g,v){y.exports=v(requireCore())})(encBase64url,function(g){return(function(){var v=g,b=v.lib,w=b.WordArray,E=v.enc;E.Base64url={stringify:function(A,$){$===void 0&&($=!0);var R=A.words,T=A.sigBytes,O=$?this._safe_map:this._map;A.clamp();for(var B=[],F=0;F<T;F+=3)for(var U=R[F>>>2]>>>24-F%4*8&255,q=R[F+1>>>2]>>>24-(F+1)%4*8&255,J=R[F+2>>>2]>>>24-(F+2)%4*8&255,ie=U<<16|q<<8|J,oe=0;oe<4&&F+oe*.75<T;oe++)B.push(O.charAt(ie>>>6*(3-oe)&63));var le=O.charAt(64);if(le)for(;B.length%4;)B.push(le);return B.join("")},parse:function(A,$){$===void 0&&($=!0);var R=A.length,T=$?this._safe_map:this._map,O=this._reverseMap;if(!O){O=this._reverseMap=[];for(var B=0;B<T.length;B++)O[T.charCodeAt(B)]=B}var F=T.charAt(64);if(F){var U=A.indexOf(F);U!==-1&&(R=U)}return S(A,R,O)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function S(A,$,R){for(var T=[],O=0,B=0;B<$;B++)if(B%4){var F=R[A.charCodeAt(B-1)]<<B%4*2,U=R[A.charCodeAt(B)]>>>6-B%4*2,q=F|U;T[O>>>2]|=q<<24-O%4*8,O++}return w.create(T,O)}})(),g.enc.Base64url})})(encBase64url$1)),encBase64url$1.exports}var md5$1={exports:{}},md5=md5$1.exports,hasRequiredMd5;function requireMd5(){return hasRequiredMd5||(hasRequiredMd5=1,(function(y,u){(function(g,v){y.exports=v(requireCore())})(md5,function(g){return(function(v){var b=g,w=b.lib,E=w.WordArray,S=w.Hasher,A=b.algo,$=[];(function(){for(var U=0;U<64;U++)$[U]=v.abs(v.sin(U+1))*4294967296|0})();var R=A.MD5=S.extend({_doReset:function(){this._hash=new E.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(U,q){for(var J=0;J<16;J++){var ie=q+J,oe=U[ie];U[ie]=(oe<<8|oe>>>24)&16711935|(oe<<24|oe>>>8)&4278255360}var le=this._hash.words,de=U[q+0],fe=U[q+1],ye=U[q+2],we=U[q+3],pe=U[q+4],ve=U[q+5],he=U[q+6],ae=U[q+7],Q=U[q+8],j=U[q+9],z=U[q+10],re=U[q+11],Y=U[q+12],te=U[q+13],ne=U[q+14],se=U[q+15],ee=le[0],Z=le[1],ue=le[2],_e=le[3];ee=T(ee,Z,ue,_e,de,7,$[0]),_e=T(_e,ee,Z,ue,fe,12,$[1]),ue=T(ue,_e,ee,Z,ye,17,$[2]),Z=T(Z,ue,_e,ee,we,22,$[3]),ee=T(ee,Z,ue,_e,pe,7,$[4]),_e=T(_e,ee,Z,ue,ve,12,$[5]),ue=T(ue,_e,ee,Z,he,17,$[6]),Z=T(Z,ue,_e,ee,ae,22,$[7]),ee=T(ee,Z,ue,_e,Q,7,$[8]),_e=T(_e,ee,Z,ue,j,12,$[9]),ue=T(ue,_e,ee,Z,z,17,$[10]),Z=T(Z,ue,_e,ee,re,22,$[11]),ee=T(ee,Z,ue,_e,Y,7,$[12]),_e=T(_e,ee,Z,ue,te,12,$[13]),ue=T(ue,_e,ee,Z,ne,17,$[14]),Z=T(Z,ue,_e,ee,se,22,$[15]),ee=O(ee,Z,ue,_e,fe,5,$[16]),_e=O(_e,ee,Z,ue,he,9,$[17]),ue=O(ue,_e,ee,Z,re,14,$[18]),Z=O(Z,ue,_e,ee,de,20,$[19]),ee=O(ee,Z,ue,_e,ve,5,$[20]),_e=O(_e,ee,Z,ue,z,9,$[21]),ue=O(ue,_e,ee,Z,se,14,$[22]),Z=O(Z,ue,_e,ee,pe,20,$[23]),ee=O(ee,Z,ue,_e,j,5,$[24]),_e=O(_e,ee,Z,ue,ne,9,$[25]),ue=O(ue,_e,ee,Z,we,14,$[26]),Z=O(Z,ue,_e,ee,Q,20,$[27]),ee=O(ee,Z,ue,_e,te,5,$[28]),_e=O(_e,ee,Z,ue,ye,9,$[29]),ue=O(ue,_e,ee,Z,ae,14,$[30]),Z=O(Z,ue,_e,ee,Y,20,$[31]),ee=B(ee,Z,ue,_e,ve,4,$[32]),_e=B(_e,ee,Z,ue,Q,11,$[33]),ue=B(ue,_e,ee,Z,re,16,$[34]),Z=B(Z,ue,_e,ee,ne,23,$[35]),ee=B(ee,Z,ue,_e,fe,4,$[36]),_e=B(_e,ee,Z,ue,pe,11,$[37]),ue=B(ue,_e,ee,Z,ae,16,$[38]),Z=B(Z,ue,_e,ee,z,23,$[39]),ee=B(ee,Z,ue,_e,te,4,$[40]),_e=B(_e,ee,Z,ue,de,11,$[41]),ue=B(ue,_e,ee,Z,we,16,$[42]),Z=B(Z,ue,_e,ee,he,23,$[43]),ee=B(ee,Z,ue,_e,j,4,$[44]),_e=B(_e,ee,Z,ue,Y,11,$[45]),ue=B(ue,_e,ee,Z,se,16,$[46]),Z=B(Z,ue,_e,ee,ye,23,$[47]),ee=F(ee,Z,ue,_e,de,6,$[48]),_e=F(_e,ee,Z,ue,ae,10,$[49]),ue=F(ue,_e,ee,Z,ne,15,$[50]),Z=F(Z,ue,_e,ee,ve,21,$[51]),ee=F(ee,Z,ue,_e,Y,6,$[52]),_e=F(_e,ee,Z,ue,we,10,$[53]),ue=F(ue,_e,ee,Z,z,15,$[54]),Z=F(Z,ue,_e,ee,fe,21,$[55]),ee=F(ee,Z,ue,_e,Q,6,$[56]),_e=F(_e,ee,Z,ue,se,10,$[57]),ue=F(ue,_e,ee,Z,he,15,$[58]),Z=F(Z,ue,_e,ee,te,21,$[59]),ee=F(ee,Z,ue,_e,pe,6,$[60]),_e=F(_e,ee,Z,ue,re,10,$[61]),ue=F(ue,_e,ee,Z,ye,15,$[62]),Z=F(Z,ue,_e,ee,j,21,$[63]),le[0]=le[0]+ee|0,le[1]=le[1]+Z|0,le[2]=le[2]+ue|0,le[3]=le[3]+_e|0},_doFinalize:function(){var U=this._data,q=U.words,J=this._nDataBytes*8,ie=U.sigBytes*8;q[ie>>>5]|=128<<24-ie%32;var oe=v.floor(J/4294967296),le=J;q[(ie+64>>>9<<4)+15]=(oe<<8|oe>>>24)&16711935|(oe<<24|oe>>>8)&4278255360,q[(ie+64>>>9<<4)+14]=(le<<8|le>>>24)&16711935|(le<<24|le>>>8)&4278255360,U.sigBytes=(q.length+1)*4,this._process();for(var de=this._hash,fe=de.words,ye=0;ye<4;ye++){var we=fe[ye];fe[ye]=(we<<8|we>>>24)&16711935|(we<<24|we>>>8)&4278255360}return de},clone:function(){var U=S.clone.call(this);return U._hash=this._hash.clone(),U}});function T(U,q,J,ie,oe,le,de){var fe=U+(q&J|~q&ie)+oe+de;return(fe<<le|fe>>>32-le)+q}function O(U,q,J,ie,oe,le,de){var fe=U+(q&ie|J&~ie)+oe+de;return(fe<<le|fe>>>32-le)+q}function B(U,q,J,ie,oe,le,de){var fe=U+(q^J^ie)+oe+de;return(fe<<le|fe>>>32-le)+q}function F(U,q,J,ie,oe,le,de){var fe=U+(J^(q|~ie))+oe+de;return(fe<<le|fe>>>32-le)+q}b.MD5=S._createHelper(R),b.HmacMD5=S._createHmacHelper(R)})(Math),g.MD5})})(md5$1)),md5$1.exports}var sha1$4={exports:{}},sha1$3=sha1$4.exports,hasRequiredSha1;function requireSha1(){return hasRequiredSha1||(hasRequiredSha1=1,(function(y,u){(function(g,v){y.exports=v(requireCore())})(sha1$3,function(g){return(function(){var v=g,b=v.lib,w=b.WordArray,E=b.Hasher,S=v.algo,A=[],$=S.SHA1=E.extend({_doReset:function(){this._hash=new w.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(R,T){for(var O=this._hash.words,B=O[0],F=O[1],U=O[2],q=O[3],J=O[4],ie=0;ie<80;ie++){if(ie<16)A[ie]=R[T+ie]|0;else{var oe=A[ie-3]^A[ie-8]^A[ie-14]^A[ie-16];A[ie]=oe<<1|oe>>>31}var le=(B<<5|B>>>27)+J+A[ie];ie<20?le+=(F&U|~F&q)+1518500249:ie<40?le+=(F^U^q)+1859775393:ie<60?le+=(F&U|F&q|U&q)-1894007588:le+=(F^U^q)-899497514,J=q,q=U,U=F<<30|F>>>2,F=B,B=le}O[0]=O[0]+B|0,O[1]=O[1]+F|0,O[2]=O[2]+U|0,O[3]=O[3]+q|0,O[4]=O[4]+J|0},_doFinalize:function(){var R=this._data,T=R.words,O=this._nDataBytes*8,B=R.sigBytes*8;return T[B>>>5]|=128<<24-B%32,T[(B+64>>>9<<4)+14]=Math.floor(O/4294967296),T[(B+64>>>9<<4)+15]=O,R.sigBytes=T.length*4,this._process(),this._hash},clone:function(){var R=E.clone.call(this);return R._hash=this._hash.clone(),R}});v.SHA1=E._createHelper($),v.HmacSHA1=E._createHmacHelper($)})(),g.SHA1})})(sha1$4)),sha1$4.exports}var sha256$8={exports:{}},sha256$7=sha256$8.exports,hasRequiredSha256;function requireSha256(){return hasRequiredSha256||(hasRequiredSha256=1,(function(y,u){(function(g,v){y.exports=v(requireCore())})(sha256$7,function(g){return(function(v){var b=g,w=b.lib,E=w.WordArray,S=w.Hasher,A=b.algo,$=[],R=[];(function(){function B(J){for(var ie=v.sqrt(J),oe=2;oe<=ie;oe++)if(!(J%oe))return!1;return!0}function F(J){return(J-(J|0))*4294967296|0}for(var U=2,q=0;q<64;)B(U)&&(q<8&&($[q]=F(v.pow(U,1/2))),R[q]=F(v.pow(U,1/3)),q++),U++})();var T=[],O=A.SHA256=S.extend({_doReset:function(){this._hash=new E.init($.slice(0))},_doProcessBlock:function(B,F){for(var U=this._hash.words,q=U[0],J=U[1],ie=U[2],oe=U[3],le=U[4],de=U[5],fe=U[6],ye=U[7],we=0;we<64;we++){if(we<16)T[we]=B[F+we]|0;else{var pe=T[we-15],ve=(pe<<25|pe>>>7)^(pe<<14|pe>>>18)^pe>>>3,he=T[we-2],ae=(he<<15|he>>>17)^(he<<13|he>>>19)^he>>>10;T[we]=ve+T[we-7]+ae+T[we-16]}var Q=le&de^~le&fe,j=q&J^q&ie^J&ie,z=(q<<30|q>>>2)^(q<<19|q>>>13)^(q<<10|q>>>22),re=(le<<26|le>>>6)^(le<<21|le>>>11)^(le<<7|le>>>25),Y=ye+re+Q+R[we]+T[we],te=z+j;ye=fe,fe=de,de=le,le=oe+Y|0,oe=ie,ie=J,J=q,q=Y+te|0}U[0]=U[0]+q|0,U[1]=U[1]+J|0,U[2]=U[2]+ie|0,U[3]=U[3]+oe|0,U[4]=U[4]+le|0,U[5]=U[5]+de|0,U[6]=U[6]+fe|0,U[7]=U[7]+ye|0},_doFinalize:function(){var B=this._data,F=B.words,U=this._nDataBytes*8,q=B.sigBytes*8;return F[q>>>5]|=128<<24-q%32,F[(q+64>>>9<<4)+14]=v.floor(U/4294967296),F[(q+64>>>9<<4)+15]=U,B.sigBytes=F.length*4,this._process(),this._hash},clone:function(){var B=S.clone.call(this);return B._hash=this._hash.clone(),B}});b.SHA256=S._createHelper(O),b.HmacSHA256=S._createHmacHelper(O)})(Math),g.SHA256})})(sha256$8)),sha256$8.exports}var sha224$1={exports:{}},sha224=sha224$1.exports,hasRequiredSha224;function requireSha224(){return hasRequiredSha224||(hasRequiredSha224=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireSha256())})(sha224,function(g){return(function(){var v=g,b=v.lib,w=b.WordArray,E=v.algo,S=E.SHA256,A=E.SHA224=S.extend({_doReset:function(){this._hash=new w.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var $=S._doFinalize.call(this);return $.sigBytes-=4,$}});v.SHA224=S._createHelper(A),v.HmacSHA224=S._createHmacHelper(A)})(),g.SHA224})})(sha224$1)),sha224$1.exports}var sha512$6={exports:{}},sha512$5=sha512$6.exports,hasRequiredSha512;function requireSha512(){return hasRequiredSha512||(hasRequiredSha512=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireX64Core())})(sha512$5,function(g){return(function(){var v=g,b=v.lib,w=b.Hasher,E=v.x64,S=E.Word,A=E.WordArray,$=v.algo;function R(){return S.create.apply(S,arguments)}var T=[R(1116352408,3609767458),R(1899447441,602891725),R(3049323471,3964484399),R(3921009573,2173295548),R(961987163,4081628472),R(1508970993,3053834265),R(2453635748,2937671579),R(2870763221,3664609560),R(3624381080,2734883394),R(310598401,1164996542),R(607225278,1323610764),R(1426881987,3590304994),R(1925078388,4068182383),R(2162078206,991336113),R(2614888103,633803317),R(3248222580,3479774868),R(3835390401,2666613458),R(4022224774,944711139),R(264347078,2341262773),R(604807628,2007800933),R(770255983,1495990901),R(1249150122,1856431235),R(1555081692,3175218132),R(1996064986,2198950837),R(2554220882,3999719339),R(2821834349,766784016),R(2952996808,2566594879),R(3210313671,3203337956),R(3336571891,1034457026),R(3584528711,2466948901),R(113926993,3758326383),R(338241895,168717936),R(666307205,1188179964),R(773529912,1546045734),R(1294757372,1522805485),R(1396182291,2643833823),R(1695183700,2343527390),R(1986661051,1014477480),R(2177026350,1206759142),R(2456956037,344077627),R(2730485921,1290863460),R(2820302411,3158454273),R(3259730800,3505952657),R(3345764771,106217008),R(3516065817,3606008344),R(3600352804,1432725776),R(4094571909,1467031594),R(275423344,851169720),R(430227734,3100823752),R(506948616,1363258195),R(659060556,3750685593),R(883997877,3785050280),R(958139571,3318307427),R(1322822218,3812723403),R(1537002063,2003034995),R(1747873779,3602036899),R(1955562222,1575990012),R(2024104815,1125592928),R(2227730452,2716904306),R(2361852424,442776044),R(2428436474,593698344),R(2756734187,3733110249),R(3204031479,2999351573),R(3329325298,3815920427),R(3391569614,3928383900),R(3515267271,566280711),R(3940187606,3454069534),R(4118630271,4000239992),R(116418474,1914138554),R(174292421,2731055270),R(289380356,3203993006),R(460393269,320620315),R(685471733,587496836),R(852142971,1086792851),R(1017036298,365543100),R(1126000580,2618297676),R(1288033470,3409855158),R(1501505948,4234509866),R(1607167915,987167468),R(1816402316,1246189591)],O=[];(function(){for(var F=0;F<80;F++)O[F]=R()})();var B=$.SHA512=w.extend({_doReset:function(){this._hash=new A.init([new S.init(1779033703,4089235720),new S.init(3144134277,2227873595),new S.init(1013904242,4271175723),new S.init(2773480762,1595750129),new S.init(1359893119,2917565137),new S.init(2600822924,725511199),new S.init(528734635,4215389547),new S.init(1541459225,327033209)])},_doProcessBlock:function(F,U){for(var q=this._hash.words,J=q[0],ie=q[1],oe=q[2],le=q[3],de=q[4],fe=q[5],ye=q[6],we=q[7],pe=J.high,ve=J.low,he=ie.high,ae=ie.low,Q=oe.high,j=oe.low,z=le.high,re=le.low,Y=de.high,te=de.low,ne=fe.high,se=fe.low,ee=ye.high,Z=ye.low,ue=we.high,_e=we.low,Re=pe,Ae=ve,ge=he,be=ae,Te=Q,De=j,Ie=z,Se=re,Be=Y,Le=te,qe=ne,Ke=se,Ge=ee,Xe=Z,ze=ue,et=_e,Ze=0;Ze<80;Ze++){var nt,ut,ot=O[Ze];if(Ze<16)ut=ot.high=F[U+Ze*2]|0,nt=ot.low=F[U+Ze*2+1]|0;else{var vt=O[Ze-15],bt=vt.high,lt=vt.low,kt=(bt>>>1|lt<<31)^(bt>>>8|lt<<24)^bt>>>7,Ct=(lt>>>1|bt<<31)^(lt>>>8|bt<<24)^(lt>>>7|bt<<25),Me=O[Ze-2],Ce=Me.high,Ee=Me.low,Pe=(Ce>>>19|Ee<<13)^(Ce<<3|Ee>>>29)^Ce>>>6,je=(Ee>>>19|Ce<<13)^(Ee<<3|Ce>>>29)^(Ee>>>6|Ce<<26),He=O[Ze-7],Ve=He.high,dt=He.low,xt=O[Ze-16],mt=xt.high,gt=xt.low;nt=Ct+dt,ut=kt+Ve+(nt>>>0<Ct>>>0?1:0),nt=nt+je,ut=ut+Pe+(nt>>>0<je>>>0?1:0),nt=nt+gt,ut=ut+mt+(nt>>>0<gt>>>0?1:0),ot.high=ut,ot.low=nt}var at=Be&qe^~Be&Ge,ht=Le&Ke^~Le&Xe,_t=Re&ge^Re&Te^ge&Te,$t=Ae&be^Ae&De^be&De,St=(Re>>>28|Ae<<4)^(Re<<30|Ae>>>2)^(Re<<25|Ae>>>7),ft=(Ae>>>28|Re<<4)^(Ae<<30|Re>>>2)^(Ae<<25|Re>>>7),At=(Be>>>14|Le<<18)^(Be>>>18|Le<<14)^(Be<<23|Le>>>9),Oe=(Le>>>14|Be<<18)^(Le>>>18|Be<<14)^(Le<<23|Be>>>9),$e=T[Ze],ke=$e.high,Ue=$e.low,We=et+Oe,Qe=ze+At+(We>>>0<et>>>0?1:0),We=We+ht,Qe=Qe+at+(We>>>0<ht>>>0?1:0),We=We+Ue,Qe=Qe+ke+(We>>>0<Ue>>>0?1:0),We=We+nt,Qe=Qe+ut+(We>>>0<nt>>>0?1:0),tt=ft+$t,Pt=St+_t+(tt>>>0<ft>>>0?1:0);ze=Ge,et=Xe,Ge=qe,Xe=Ke,qe=Be,Ke=Le,Le=Se+We|0,Be=Ie+Qe+(Le>>>0<Se>>>0?1:0)|0,Ie=Te,Se=De,Te=ge,De=be,ge=Re,be=Ae,Ae=We+tt|0,Re=Qe+Pt+(Ae>>>0<We>>>0?1:0)|0}ve=J.low=ve+Ae,J.high=pe+Re+(ve>>>0<Ae>>>0?1:0),ae=ie.low=ae+be,ie.high=he+ge+(ae>>>0<be>>>0?1:0),j=oe.low=j+De,oe.high=Q+Te+(j>>>0<De>>>0?1:0),re=le.low=re+Se,le.high=z+Ie+(re>>>0<Se>>>0?1:0),te=de.low=te+Le,de.high=Y+Be+(te>>>0<Le>>>0?1:0),se=fe.low=se+Ke,fe.high=ne+qe+(se>>>0<Ke>>>0?1:0),Z=ye.low=Z+Xe,ye.high=ee+Ge+(Z>>>0<Xe>>>0?1:0),_e=we.low=_e+et,we.high=ue+ze+(_e>>>0<et>>>0?1:0)},_doFinalize:function(){var F=this._data,U=F.words,q=this._nDataBytes*8,J=F.sigBytes*8;U[J>>>5]|=128<<24-J%32,U[(J+128>>>10<<5)+30]=Math.floor(q/4294967296),U[(J+128>>>10<<5)+31]=q,F.sigBytes=U.length*4,this._process();var ie=this._hash.toX32();return ie},clone:function(){var F=w.clone.call(this);return F._hash=this._hash.clone(),F},blockSize:1024/32});v.SHA512=w._createHelper(B),v.HmacSHA512=w._createHmacHelper(B)})(),g.SHA512})})(sha512$6)),sha512$6.exports}var sha384$1={exports:{}},sha384=sha384$1.exports,hasRequiredSha384;function requireSha384(){return hasRequiredSha384||(hasRequiredSha384=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireX64Core(),requireSha512())})(sha384,function(g){return(function(){var v=g,b=v.x64,w=b.Word,E=b.WordArray,S=v.algo,A=S.SHA512,$=S.SHA384=A.extend({_doReset:function(){this._hash=new E.init([new w.init(3418070365,3238371032),new w.init(1654270250,914150663),new w.init(2438529370,812702999),new w.init(355462360,4144912697),new w.init(1731405415,4290775857),new w.init(2394180231,1750603025),new w.init(3675008525,1694076839),new w.init(1203062813,3204075428)])},_doFinalize:function(){var R=A._doFinalize.call(this);return R.sigBytes-=16,R}});v.SHA384=A._createHelper($),v.HmacSHA384=A._createHmacHelper($)})(),g.SHA384})})(sha384$1)),sha384$1.exports}var sha3$1={exports:{}},sha3=sha3$1.exports,hasRequiredSha3;function requireSha3(){return hasRequiredSha3||(hasRequiredSha3=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireX64Core())})(sha3,function(g){return(function(v){var b=g,w=b.lib,E=w.WordArray,S=w.Hasher,A=b.x64,$=A.Word,R=b.algo,T=[],O=[],B=[];(function(){for(var q=1,J=0,ie=0;ie<24;ie++){T[q+5*J]=(ie+1)*(ie+2)/2%64;var oe=J%5,le=(2*q+3*J)%5;q=oe,J=le}for(var q=0;q<5;q++)for(var J=0;J<5;J++)O[q+5*J]=J+(2*q+3*J)%5*5;for(var de=1,fe=0;fe<24;fe++){for(var ye=0,we=0,pe=0;pe<7;pe++){if(de&1){var ve=(1<<pe)-1;ve<32?we^=1<<ve:ye^=1<<ve-32}de&128?de=de<<1^113:de<<=1}B[fe]=$.create(ye,we)}})();var F=[];(function(){for(var q=0;q<25;q++)F[q]=$.create()})();var U=R.SHA3=S.extend({cfg:S.cfg.extend({outputLength:512}),_doReset:function(){for(var q=this._state=[],J=0;J<25;J++)q[J]=new $.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(q,J){for(var ie=this._state,oe=this.blockSize/2,le=0;le<oe;le++){var de=q[J+2*le],fe=q[J+2*le+1];de=(de<<8|de>>>24)&16711935|(de<<24|de>>>8)&4278255360,fe=(fe<<8|fe>>>24)&16711935|(fe<<24|fe>>>8)&4278255360;var ye=ie[le];ye.high^=fe,ye.low^=de}for(var we=0;we<24;we++){for(var pe=0;pe<5;pe++){for(var ve=0,he=0,ae=0;ae<5;ae++){var ye=ie[pe+5*ae];ve^=ye.high,he^=ye.low}var Q=F[pe];Q.high=ve,Q.low=he}for(var pe=0;pe<5;pe++)for(var j=F[(pe+4)%5],z=F[(pe+1)%5],re=z.high,Y=z.low,ve=j.high^(re<<1|Y>>>31),he=j.low^(Y<<1|re>>>31),ae=0;ae<5;ae++){var ye=ie[pe+5*ae];ye.high^=ve,ye.low^=he}for(var te=1;te<25;te++){var ve,he,ye=ie[te],ne=ye.high,se=ye.low,ee=T[te];ee<32?(ve=ne<<ee|se>>>32-ee,he=se<<ee|ne>>>32-ee):(ve=se<<ee-32|ne>>>64-ee,he=ne<<ee-32|se>>>64-ee);var Z=F[O[te]];Z.high=ve,Z.low=he}var ue=F[0],_e=ie[0];ue.high=_e.high,ue.low=_e.low;for(var pe=0;pe<5;pe++)for(var ae=0;ae<5;ae++){var te=pe+5*ae,ye=ie[te],Re=F[te],Ae=F[(pe+1)%5+5*ae],ge=F[(pe+2)%5+5*ae];ye.high=Re.high^~Ae.high&ge.high,ye.low=Re.low^~Ae.low&ge.low}var ye=ie[0],be=B[we];ye.high^=be.high,ye.low^=be.low}},_doFinalize:function(){var q=this._data,J=q.words;this._nDataBytes*8;var ie=q.sigBytes*8,oe=this.blockSize*32;J[ie>>>5]|=1<<24-ie%32,J[(v.ceil((ie+1)/oe)*oe>>>5)-1]|=128,q.sigBytes=J.length*4,this._process();for(var le=this._state,de=this.cfg.outputLength/8,fe=de/8,ye=[],we=0;we<fe;we++){var pe=le[we],ve=pe.high,he=pe.low;ve=(ve<<8|ve>>>24)&16711935|(ve<<24|ve>>>8)&4278255360,he=(he<<8|he>>>24)&16711935|(he<<24|he>>>8)&4278255360,ye.push(he),ye.push(ve)}return new E.init(ye,de)},clone:function(){for(var q=S.clone.call(this),J=q._state=this._state.slice(0),ie=0;ie<25;ie++)J[ie]=J[ie].clone();return q}});b.SHA3=S._createHelper(U),b.HmacSHA3=S._createHmacHelper(U)})(Math),g.SHA3})})(sha3$1)),sha3$1.exports}var ripemd160$1={exports:{}},ripemd160=ripemd160$1.exports,hasRequiredRipemd160;function requireRipemd160(){return hasRequiredRipemd160||(hasRequiredRipemd160=1,(function(y,u){(function(g,v){y.exports=v(requireCore())})(ripemd160,function(g){return(function(v){var b=g,w=b.lib,E=w.WordArray,S=w.Hasher,A=b.algo,$=E.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),R=E.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),T=E.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),O=E.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),B=E.create([0,1518500249,1859775393,2400959708,2840853838]),F=E.create([1352829926,1548603684,1836072691,2053994217,0]),U=A.RIPEMD160=S.extend({_doReset:function(){this._hash=E.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(fe,ye){for(var we=0;we<16;we++){var pe=ye+we,ve=fe[pe];fe[pe]=(ve<<8|ve>>>24)&16711935|(ve<<24|ve>>>8)&4278255360}var he=this._hash.words,ae=B.words,Q=F.words,j=$.words,z=R.words,re=T.words,Y=O.words,te,ne,se,ee,Z,ue,_e,Re,Ae,ge;ue=te=he[0],_e=ne=he[1],Re=se=he[2],Ae=ee=he[3],ge=Z=he[4];for(var be,we=0;we<80;we+=1)be=te+fe[ye+j[we]]|0,we<16?be+=q(ne,se,ee)+ae[0]:we<32?be+=J(ne,se,ee)+ae[1]:we<48?be+=ie(ne,se,ee)+ae[2]:we<64?be+=oe(ne,se,ee)+ae[3]:be+=le(ne,se,ee)+ae[4],be=be|0,be=de(be,re[we]),be=be+Z|0,te=Z,Z=ee,ee=de(se,10),se=ne,ne=be,be=ue+fe[ye+z[we]]|0,we<16?be+=le(_e,Re,Ae)+Q[0]:we<32?be+=oe(_e,Re,Ae)+Q[1]:we<48?be+=ie(_e,Re,Ae)+Q[2]:we<64?be+=J(_e,Re,Ae)+Q[3]:be+=q(_e,Re,Ae)+Q[4],be=be|0,be=de(be,Y[we]),be=be+ge|0,ue=ge,ge=Ae,Ae=de(Re,10),Re=_e,_e=be;be=he[1]+se+Ae|0,he[1]=he[2]+ee+ge|0,he[2]=he[3]+Z+ue|0,he[3]=he[4]+te+_e|0,he[4]=he[0]+ne+Re|0,he[0]=be},_doFinalize:function(){var fe=this._data,ye=fe.words,we=this._nDataBytes*8,pe=fe.sigBytes*8;ye[pe>>>5]|=128<<24-pe%32,ye[(pe+64>>>9<<4)+14]=(we<<8|we>>>24)&16711935|(we<<24|we>>>8)&4278255360,fe.sigBytes=(ye.length+1)*4,this._process();for(var ve=this._hash,he=ve.words,ae=0;ae<5;ae++){var Q=he[ae];he[ae]=(Q<<8|Q>>>24)&16711935|(Q<<24|Q>>>8)&4278255360}return ve},clone:function(){var fe=S.clone.call(this);return fe._hash=this._hash.clone(),fe}});function q(fe,ye,we){return fe^ye^we}function J(fe,ye,we){return fe&ye|~fe&we}function ie(fe,ye,we){return(fe|~ye)^we}function oe(fe,ye,we){return fe&we|ye&~we}function le(fe,ye,we){return fe^(ye|~we)}function de(fe,ye){return fe<<ye|fe>>>32-ye}b.RIPEMD160=S._createHelper(U),b.HmacRIPEMD160=S._createHmacHelper(U)})(),g.RIPEMD160})})(ripemd160$1)),ripemd160$1.exports}var hmac$6={exports:{}},hmac$5=hmac$6.exports,hasRequiredHmac;function requireHmac(){return hasRequiredHmac||(hasRequiredHmac=1,(function(y,u){(function(g,v){y.exports=v(requireCore())})(hmac$5,function(g){(function(){var v=g,b=v.lib,w=b.Base,E=v.enc,S=E.Utf8,A=v.algo;A.HMAC=w.extend({init:function($,R){$=this._hasher=new $.init,typeof R=="string"&&(R=S.parse(R));var T=$.blockSize,O=T*4;R.sigBytes>O&&(R=$.finalize(R)),R.clamp();for(var B=this._oKey=R.clone(),F=this._iKey=R.clone(),U=B.words,q=F.words,J=0;J<T;J++)U[J]^=1549556828,q[J]^=909522486;B.sigBytes=F.sigBytes=O,this.reset()},reset:function(){var $=this._hasher;$.reset(),$.update(this._iKey)},update:function($){return this._hasher.update($),this},finalize:function($){var R=this._hasher,T=R.finalize($);R.reset();var O=R.finalize(this._oKey.clone().concat(T));return O}})})()})})(hmac$6)),hmac$6.exports}var pbkdf2$3={exports:{}},pbkdf2$2=pbkdf2$3.exports,hasRequiredPbkdf2;function requirePbkdf2(){return hasRequiredPbkdf2||(hasRequiredPbkdf2=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireSha256(),requireHmac())})(pbkdf2$2,function(g){return(function(){var v=g,b=v.lib,w=b.Base,E=b.WordArray,S=v.algo,A=S.SHA256,$=S.HMAC,R=S.PBKDF2=w.extend({cfg:w.extend({keySize:128/32,hasher:A,iterations:25e4}),init:function(T){this.cfg=this.cfg.extend(T)},compute:function(T,O){for(var B=this.cfg,F=$.create(B.hasher,T),U=E.create(),q=E.create([1]),J=U.words,ie=q.words,oe=B.keySize,le=B.iterations;J.length<oe;){var de=F.update(O).finalize(q);F.reset();for(var fe=de.words,ye=fe.length,we=de,pe=1;pe<le;pe++){we=F.finalize(we),F.reset();for(var ve=we.words,he=0;he<ye;he++)fe[he]^=ve[he]}U.concat(de),ie[0]++}return U.sigBytes=oe*4,U}});v.PBKDF2=function(T,O,B){return R.create(B).compute(T,O)}})(),g.PBKDF2})})(pbkdf2$3)),pbkdf2$3.exports}var evpkdf$1={exports:{}},evpkdf=evpkdf$1.exports,hasRequiredEvpkdf;function requireEvpkdf(){return hasRequiredEvpkdf||(hasRequiredEvpkdf=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireSha1(),requireHmac())})(evpkdf,function(g){return(function(){var v=g,b=v.lib,w=b.Base,E=b.WordArray,S=v.algo,A=S.MD5,$=S.EvpKDF=w.extend({cfg:w.extend({keySize:128/32,hasher:A,iterations:1}),init:function(R){this.cfg=this.cfg.extend(R)},compute:function(R,T){for(var O,B=this.cfg,F=B.hasher.create(),U=E.create(),q=U.words,J=B.keySize,ie=B.iterations;q.length<J;){O&&F.update(O),O=F.update(R).finalize(T),F.reset();for(var oe=1;oe<ie;oe++)O=F.finalize(O),F.reset();U.concat(O)}return U.sigBytes=J*4,U}});v.EvpKDF=function(R,T,O){return $.create(O).compute(R,T)}})(),g.EvpKDF})})(evpkdf$1)),evpkdf$1.exports}var cipherCore$1={exports:{}},cipherCore=cipherCore$1.exports,hasRequiredCipherCore;function requireCipherCore(){return hasRequiredCipherCore||(hasRequiredCipherCore=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireEvpkdf())})(cipherCore,function(g){g.lib.Cipher||(function(v){var b=g,w=b.lib,E=w.Base,S=w.WordArray,A=w.BufferedBlockAlgorithm,$=b.enc;$.Utf8;var R=$.Base64,T=b.algo,O=T.EvpKDF,B=w.Cipher=A.extend({cfg:E.extend(),createEncryptor:function(ve,he){return this.create(this._ENC_XFORM_MODE,ve,he)},createDecryptor:function(ve,he){return this.create(this._DEC_XFORM_MODE,ve,he)},init:function(ve,he,ae){this.cfg=this.cfg.extend(ae),this._xformMode=ve,this._key=he,this.reset()},reset:function(){A.reset.call(this),this._doReset()},process:function(ve){return this._append(ve),this._process()},finalize:function(ve){ve&&this._append(ve);var he=this._doFinalize();return he},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function ve(he){return typeof he=="string"?pe:fe}return function(he){return{encrypt:function(ae,Q,j){return ve(Q).encrypt(he,ae,Q,j)},decrypt:function(ae,Q,j){return ve(Q).decrypt(he,ae,Q,j)}}}})()});w.StreamCipher=B.extend({_doFinalize:function(){var ve=this._process(!0);return ve},blockSize:1});var F=b.mode={},U=w.BlockCipherMode=E.extend({createEncryptor:function(ve,he){return this.Encryptor.create(ve,he)},createDecryptor:function(ve,he){return this.Decryptor.create(ve,he)},init:function(ve,he){this._cipher=ve,this._iv=he}}),q=F.CBC=(function(){var ve=U.extend();ve.Encryptor=ve.extend({processBlock:function(ae,Q){var j=this._cipher,z=j.blockSize;he.call(this,ae,Q,z),j.encryptBlock(ae,Q),this._prevBlock=ae.slice(Q,Q+z)}}),ve.Decryptor=ve.extend({processBlock:function(ae,Q){var j=this._cipher,z=j.blockSize,re=ae.slice(Q,Q+z);j.decryptBlock(ae,Q),he.call(this,ae,Q,z),this._prevBlock=re}});function he(ae,Q,j){var z,re=this._iv;re?(z=re,this._iv=v):z=this._prevBlock;for(var Y=0;Y<j;Y++)ae[Q+Y]^=z[Y]}return ve})(),J=b.pad={},ie=J.Pkcs7={pad:function(ve,he){for(var ae=he*4,Q=ae-ve.sigBytes%ae,j=Q<<24|Q<<16|Q<<8|Q,z=[],re=0;re<Q;re+=4)z.push(j);var Y=S.create(z,Q);ve.concat(Y)},unpad:function(ve){var he=ve.words[ve.sigBytes-1>>>2]&255;ve.sigBytes-=he}};w.BlockCipher=B.extend({cfg:B.cfg.extend({mode:q,padding:ie}),reset:function(){var ve;B.reset.call(this);var he=this.cfg,ae=he.iv,Q=he.mode;this._xformMode==this._ENC_XFORM_MODE?ve=Q.createEncryptor:(ve=Q.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==ve?this._mode.init(this,ae&&ae.words):(this._mode=ve.call(Q,this,ae&&ae.words),this._mode.__creator=ve)},_doProcessBlock:function(ve,he){this._mode.processBlock(ve,he)},_doFinalize:function(){var ve,he=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(he.pad(this._data,this.blockSize),ve=this._process(!0)):(ve=this._process(!0),he.unpad(ve)),ve},blockSize:128/32});var oe=w.CipherParams=E.extend({init:function(ve){this.mixIn(ve)},toString:function(ve){return(ve||this.formatter).stringify(this)}}),le=b.format={},de=le.OpenSSL={stringify:function(ve){var he,ae=ve.ciphertext,Q=ve.salt;return Q?he=S.create([1398893684,1701076831]).concat(Q).concat(ae):he=ae,he.toString(R)},parse:function(ve){var he,ae=R.parse(ve),Q=ae.words;return Q[0]==1398893684&&Q[1]==1701076831&&(he=S.create(Q.slice(2,4)),Q.splice(0,4),ae.sigBytes-=16),oe.create({ciphertext:ae,salt:he})}},fe=w.SerializableCipher=E.extend({cfg:E.extend({format:de}),encrypt:function(ve,he,ae,Q){Q=this.cfg.extend(Q);var j=ve.createEncryptor(ae,Q),z=j.finalize(he),re=j.cfg;return oe.create({ciphertext:z,key:ae,iv:re.iv,algorithm:ve,mode:re.mode,padding:re.padding,blockSize:ve.blockSize,formatter:Q.format})},decrypt:function(ve,he,ae,Q){Q=this.cfg.extend(Q),he=this._parse(he,Q.format);var j=ve.createDecryptor(ae,Q).finalize(he.ciphertext);return j},_parse:function(ve,he){return typeof ve=="string"?he.parse(ve,this):ve}}),ye=b.kdf={},we=ye.OpenSSL={execute:function(ve,he,ae,Q,j){if(Q||(Q=S.random(64/8)),j)var z=O.create({keySize:he+ae,hasher:j}).compute(ve,Q);else var z=O.create({keySize:he+ae}).compute(ve,Q);var re=S.create(z.words.slice(he),ae*4);return z.sigBytes=he*4,oe.create({key:z,iv:re,salt:Q})}},pe=w.PasswordBasedCipher=fe.extend({cfg:fe.cfg.extend({kdf:we}),encrypt:function(ve,he,ae,Q){Q=this.cfg.extend(Q);var j=Q.kdf.execute(ae,ve.keySize,ve.ivSize,Q.salt,Q.hasher);Q.iv=j.iv;var z=fe.encrypt.call(this,ve,he,j.key,Q);return z.mixIn(j),z},decrypt:function(ve,he,ae,Q){Q=this.cfg.extend(Q),he=this._parse(he,Q.format);var j=Q.kdf.execute(ae,ve.keySize,ve.ivSize,he.salt,Q.hasher);Q.iv=j.iv;var z=fe.decrypt.call(this,ve,he,j.key,Q);return z}})})()})})(cipherCore$1)),cipherCore$1.exports}var modeCfb$1={exports:{}},modeCfb=modeCfb$1.exports,hasRequiredModeCfb;function requireModeCfb(){return hasRequiredModeCfb||(hasRequiredModeCfb=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireCipherCore())})(modeCfb,function(g){return g.mode.CFB=(function(){var v=g.lib.BlockCipherMode.extend();v.Encryptor=v.extend({processBlock:function(w,E){var S=this._cipher,A=S.blockSize;b.call(this,w,E,A,S),this._prevBlock=w.slice(E,E+A)}}),v.Decryptor=v.extend({processBlock:function(w,E){var S=this._cipher,A=S.blockSize,$=w.slice(E,E+A);b.call(this,w,E,A,S),this._prevBlock=$}});function b(w,E,S,A){var $,R=this._iv;R?($=R.slice(0),this._iv=void 0):$=this._prevBlock,A.encryptBlock($,0);for(var T=0;T<S;T++)w[E+T]^=$[T]}return v})(),g.mode.CFB})})(modeCfb$1)),modeCfb$1.exports}var modeCtr$1={exports:{}},modeCtr=modeCtr$1.exports,hasRequiredModeCtr;function requireModeCtr(){return hasRequiredModeCtr||(hasRequiredModeCtr=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireCipherCore())})(modeCtr,function(g){return g.mode.CTR=(function(){var v=g.lib.BlockCipherMode.extend(),b=v.Encryptor=v.extend({processBlock:function(w,E){var S=this._cipher,A=S.blockSize,$=this._iv,R=this._counter;$&&(R=this._counter=$.slice(0),this._iv=void 0);var T=R.slice(0);S.encryptBlock(T,0),R[A-1]=R[A-1]+1|0;for(var O=0;O<A;O++)w[E+O]^=T[O]}});return v.Decryptor=b,v})(),g.mode.CTR})})(modeCtr$1)),modeCtr$1.exports}var modeCtrGladman$1={exports:{}},modeCtrGladman=modeCtrGladman$1.exports,hasRequiredModeCtrGladman;function requireModeCtrGladman(){return hasRequiredModeCtrGladman||(hasRequiredModeCtrGladman=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireCipherCore())})(modeCtrGladman,function(g){return g.mode.CTRGladman=(function(){var v=g.lib.BlockCipherMode.extend();function b(S){if((S>>24&255)===255){var A=S>>16&255,$=S>>8&255,R=S&255;A===255?(A=0,$===255?($=0,R===255?R=0:++R):++$):++A,S=0,S+=A<<16,S+=$<<8,S+=R}else S+=1<<24;return S}function w(S){return(S[0]=b(S[0]))===0&&(S[1]=b(S[1])),S}var E=v.Encryptor=v.extend({processBlock:function(S,A){var $=this._cipher,R=$.blockSize,T=this._iv,O=this._counter;T&&(O=this._counter=T.slice(0),this._iv=void 0),w(O);var B=O.slice(0);$.encryptBlock(B,0);for(var F=0;F<R;F++)S[A+F]^=B[F]}});return v.Decryptor=E,v})(),g.mode.CTRGladman})})(modeCtrGladman$1)),modeCtrGladman$1.exports}var modeOfb$1={exports:{}},modeOfb=modeOfb$1.exports,hasRequiredModeOfb;function requireModeOfb(){return hasRequiredModeOfb||(hasRequiredModeOfb=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireCipherCore())})(modeOfb,function(g){return g.mode.OFB=(function(){var v=g.lib.BlockCipherMode.extend(),b=v.Encryptor=v.extend({processBlock:function(w,E){var S=this._cipher,A=S.blockSize,$=this._iv,R=this._keystream;$&&(R=this._keystream=$.slice(0),this._iv=void 0),S.encryptBlock(R,0);for(var T=0;T<A;T++)w[E+T]^=R[T]}});return v.Decryptor=b,v})(),g.mode.OFB})})(modeOfb$1)),modeOfb$1.exports}var modeEcb$1={exports:{}},modeEcb=modeEcb$1.exports,hasRequiredModeEcb;function requireModeEcb(){return hasRequiredModeEcb||(hasRequiredModeEcb=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireCipherCore())})(modeEcb,function(g){return g.mode.ECB=(function(){var v=g.lib.BlockCipherMode.extend();return v.Encryptor=v.extend({processBlock:function(b,w){this._cipher.encryptBlock(b,w)}}),v.Decryptor=v.extend({processBlock:function(b,w){this._cipher.decryptBlock(b,w)}}),v})(),g.mode.ECB})})(modeEcb$1)),modeEcb$1.exports}var padAnsix923$1={exports:{}},padAnsix923=padAnsix923$1.exports,hasRequiredPadAnsix923;function requirePadAnsix923(){return hasRequiredPadAnsix923||(hasRequiredPadAnsix923=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireCipherCore())})(padAnsix923,function(g){return g.pad.AnsiX923={pad:function(v,b){var w=v.sigBytes,E=b*4,S=E-w%E,A=w+S-1;v.clamp(),v.words[A>>>2]|=S<<24-A%4*8,v.sigBytes+=S},unpad:function(v){var b=v.words[v.sigBytes-1>>>2]&255;v.sigBytes-=b}},g.pad.Ansix923})})(padAnsix923$1)),padAnsix923$1.exports}var padIso10126$1={exports:{}},padIso10126=padIso10126$1.exports,hasRequiredPadIso10126;function requirePadIso10126(){return hasRequiredPadIso10126||(hasRequiredPadIso10126=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireCipherCore())})(padIso10126,function(g){return g.pad.Iso10126={pad:function(v,b){var w=b*4,E=w-v.sigBytes%w;v.concat(g.lib.WordArray.random(E-1)).concat(g.lib.WordArray.create([E<<24],1))},unpad:function(v){var b=v.words[v.sigBytes-1>>>2]&255;v.sigBytes-=b}},g.pad.Iso10126})})(padIso10126$1)),padIso10126$1.exports}var padIso97971$1={exports:{}},padIso97971=padIso97971$1.exports,hasRequiredPadIso97971;function requirePadIso97971(){return hasRequiredPadIso97971||(hasRequiredPadIso97971=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireCipherCore())})(padIso97971,function(g){return g.pad.Iso97971={pad:function(v,b){v.concat(g.lib.WordArray.create([2147483648],1)),g.pad.ZeroPadding.pad(v,b)},unpad:function(v){g.pad.ZeroPadding.unpad(v),v.sigBytes--}},g.pad.Iso97971})})(padIso97971$1)),padIso97971$1.exports}var padZeropadding$1={exports:{}},padZeropadding=padZeropadding$1.exports,hasRequiredPadZeropadding;function requirePadZeropadding(){return hasRequiredPadZeropadding||(hasRequiredPadZeropadding=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireCipherCore())})(padZeropadding,function(g){return g.pad.ZeroPadding={pad:function(v,b){var w=b*4;v.clamp(),v.sigBytes+=w-(v.sigBytes%w||w)},unpad:function(v){for(var b=v.words,w=v.sigBytes-1,w=v.sigBytes-1;w>=0;w--)if(b[w>>>2]>>>24-w%4*8&255){v.sigBytes=w+1;break}}},g.pad.ZeroPadding})})(padZeropadding$1)),padZeropadding$1.exports}var padNopadding$1={exports:{}},padNopadding=padNopadding$1.exports,hasRequiredPadNopadding;function requirePadNopadding(){return hasRequiredPadNopadding||(hasRequiredPadNopadding=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireCipherCore())})(padNopadding,function(g){return g.pad.NoPadding={pad:function(){},unpad:function(){}},g.pad.NoPadding})})(padNopadding$1)),padNopadding$1.exports}var formatHex$1={exports:{}},formatHex=formatHex$1.exports,hasRequiredFormatHex;function requireFormatHex(){return hasRequiredFormatHex||(hasRequiredFormatHex=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireCipherCore())})(formatHex,function(g){return(function(v){var b=g,w=b.lib,E=w.CipherParams,S=b.enc,A=S.Hex,$=b.format;$.Hex={stringify:function(R){return R.ciphertext.toString(A)},parse:function(R){var T=A.parse(R);return E.create({ciphertext:T})}}})(),g.format.Hex})})(formatHex$1)),formatHex$1.exports}var aes$1={exports:{}},aes=aes$1.exports,hasRequiredAes;function requireAes(){return hasRequiredAes||(hasRequiredAes=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore())})(aes,function(g){return(function(){var v=g,b=v.lib,w=b.BlockCipher,E=v.algo,S=[],A=[],$=[],R=[],T=[],O=[],B=[],F=[],U=[],q=[];(function(){for(var oe=[],le=0;le<256;le++)le<128?oe[le]=le<<1:oe[le]=le<<1^283;for(var de=0,fe=0,le=0;le<256;le++){var ye=fe^fe<<1^fe<<2^fe<<3^fe<<4;ye=ye>>>8^ye&255^99,S[de]=ye,A[ye]=de;var we=oe[de],pe=oe[we],ve=oe[pe],he=oe[ye]*257^ye*16843008;$[de]=he<<24|he>>>8,R[de]=he<<16|he>>>16,T[de]=he<<8|he>>>24,O[de]=he;var he=ve*16843009^pe*65537^we*257^de*16843008;B[ye]=he<<24|he>>>8,F[ye]=he<<16|he>>>16,U[ye]=he<<8|he>>>24,q[ye]=he,de?(de=we^oe[oe[oe[ve^we]]],fe^=oe[oe[fe]]):de=fe=1}})();var J=[0,1,2,4,8,16,32,64,128,27,54],ie=E.AES=w.extend({_doReset:function(){var oe;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var le=this._keyPriorReset=this._key,de=le.words,fe=le.sigBytes/4,ye=this._nRounds=fe+6,we=(ye+1)*4,pe=this._keySchedule=[],ve=0;ve<we;ve++)ve<fe?pe[ve]=de[ve]:(oe=pe[ve-1],ve%fe?fe>6&&ve%fe==4&&(oe=S[oe>>>24]<<24|S[oe>>>16&255]<<16|S[oe>>>8&255]<<8|S[oe&255]):(oe=oe<<8|oe>>>24,oe=S[oe>>>24]<<24|S[oe>>>16&255]<<16|S[oe>>>8&255]<<8|S[oe&255],oe^=J[ve/fe|0]<<24),pe[ve]=pe[ve-fe]^oe);for(var he=this._invKeySchedule=[],ae=0;ae<we;ae++){var ve=we-ae;if(ae%4)var oe=pe[ve];else var oe=pe[ve-4];ae<4||ve<=4?he[ae]=oe:he[ae]=B[S[oe>>>24]]^F[S[oe>>>16&255]]^U[S[oe>>>8&255]]^q[S[oe&255]]}}},encryptBlock:function(oe,le){this._doCryptBlock(oe,le,this._keySchedule,$,R,T,O,S)},decryptBlock:function(oe,le){var de=oe[le+1];oe[le+1]=oe[le+3],oe[le+3]=de,this._doCryptBlock(oe,le,this._invKeySchedule,B,F,U,q,A);var de=oe[le+1];oe[le+1]=oe[le+3],oe[le+3]=de},_doCryptBlock:function(oe,le,de,fe,ye,we,pe,ve){for(var he=this._nRounds,ae=oe[le]^de[0],Q=oe[le+1]^de[1],j=oe[le+2]^de[2],z=oe[le+3]^de[3],re=4,Y=1;Y<he;Y++){var te=fe[ae>>>24]^ye[Q>>>16&255]^we[j>>>8&255]^pe[z&255]^de[re++],ne=fe[Q>>>24]^ye[j>>>16&255]^we[z>>>8&255]^pe[ae&255]^de[re++],se=fe[j>>>24]^ye[z>>>16&255]^we[ae>>>8&255]^pe[Q&255]^de[re++],ee=fe[z>>>24]^ye[ae>>>16&255]^we[Q>>>8&255]^pe[j&255]^de[re++];ae=te,Q=ne,j=se,z=ee}var te=(ve[ae>>>24]<<24|ve[Q>>>16&255]<<16|ve[j>>>8&255]<<8|ve[z&255])^de[re++],ne=(ve[Q>>>24]<<24|ve[j>>>16&255]<<16|ve[z>>>8&255]<<8|ve[ae&255])^de[re++],se=(ve[j>>>24]<<24|ve[z>>>16&255]<<16|ve[ae>>>8&255]<<8|ve[Q&255])^de[re++],ee=(ve[z>>>24]<<24|ve[ae>>>16&255]<<16|ve[Q>>>8&255]<<8|ve[j&255])^de[re++];oe[le]=te,oe[le+1]=ne,oe[le+2]=se,oe[le+3]=ee},keySize:256/32});v.AES=w._createHelper(ie)})(),g.AES})})(aes$1)),aes$1.exports}var tripledes$1={exports:{}},tripledes=tripledes$1.exports,hasRequiredTripledes;function requireTripledes(){return hasRequiredTripledes||(hasRequiredTripledes=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore())})(tripledes,function(g){return(function(){var v=g,b=v.lib,w=b.WordArray,E=b.BlockCipher,S=v.algo,A=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],$=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],R=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],T=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],O=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],B=S.DES=E.extend({_doReset:function(){for(var J=this._key,ie=J.words,oe=[],le=0;le<56;le++){var de=A[le]-1;oe[le]=ie[de>>>5]>>>31-de%32&1}for(var fe=this._subKeys=[],ye=0;ye<16;ye++){for(var we=fe[ye]=[],pe=R[ye],le=0;le<24;le++)we[le/6|0]|=oe[($[le]-1+pe)%28]<<31-le%6,we[4+(le/6|0)]|=oe[28+($[le+24]-1+pe)%28]<<31-le%6;we[0]=we[0]<<1|we[0]>>>31;for(var le=1;le<7;le++)we[le]=we[le]>>>(le-1)*4+3;we[7]=we[7]<<5|we[7]>>>27}for(var ve=this._invSubKeys=[],le=0;le<16;le++)ve[le]=fe[15-le]},encryptBlock:function(J,ie){this._doCryptBlock(J,ie,this._subKeys)},decryptBlock:function(J,ie){this._doCryptBlock(J,ie,this._invSubKeys)},_doCryptBlock:function(J,ie,oe){this._lBlock=J[ie],this._rBlock=J[ie+1],F.call(this,4,252645135),F.call(this,16,65535),U.call(this,2,858993459),U.call(this,8,16711935),F.call(this,1,1431655765);for(var le=0;le<16;le++){for(var de=oe[le],fe=this._lBlock,ye=this._rBlock,we=0,pe=0;pe<8;pe++)we|=T[pe][((ye^de[pe])&O[pe])>>>0];this._lBlock=ye,this._rBlock=fe^we}var ve=this._lBlock;this._lBlock=this._rBlock,this._rBlock=ve,F.call(this,1,1431655765),U.call(this,8,16711935),U.call(this,2,858993459),F.call(this,16,65535),F.call(this,4,252645135),J[ie]=this._lBlock,J[ie+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function F(J,ie){var oe=(this._lBlock>>>J^this._rBlock)&ie;this._rBlock^=oe,this._lBlock^=oe<<J}function U(J,ie){var oe=(this._rBlock>>>J^this._lBlock)&ie;this._lBlock^=oe,this._rBlock^=oe<<J}v.DES=E._createHelper(B);var q=S.TripleDES=E.extend({_doReset:function(){var J=this._key,ie=J.words;if(ie.length!==2&&ie.length!==4&&ie.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var oe=ie.slice(0,2),le=ie.length<4?ie.slice(0,2):ie.slice(2,4),de=ie.length<6?ie.slice(0,2):ie.slice(4,6);this._des1=B.createEncryptor(w.create(oe)),this._des2=B.createEncryptor(w.create(le)),this._des3=B.createEncryptor(w.create(de))},encryptBlock:function(J,ie){this._des1.encryptBlock(J,ie),this._des2.decryptBlock(J,ie),this._des3.encryptBlock(J,ie)},decryptBlock:function(J,ie){this._des3.decryptBlock(J,ie),this._des2.encryptBlock(J,ie),this._des1.decryptBlock(J,ie)},keySize:192/32,ivSize:64/32,blockSize:64/32});v.TripleDES=E._createHelper(q)})(),g.TripleDES})})(tripledes$1)),tripledes$1.exports}var rc4$1={exports:{}},rc4=rc4$1.exports,hasRequiredRc4;function requireRc4(){return hasRequiredRc4||(hasRequiredRc4=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore())})(rc4,function(g){return(function(){var v=g,b=v.lib,w=b.StreamCipher,E=v.algo,S=E.RC4=w.extend({_doReset:function(){for(var R=this._key,T=R.words,O=R.sigBytes,B=this._S=[],F=0;F<256;F++)B[F]=F;for(var F=0,U=0;F<256;F++){var q=F%O,J=T[q>>>2]>>>24-q%4*8&255;U=(U+B[F]+J)%256;var ie=B[F];B[F]=B[U],B[U]=ie}this._i=this._j=0},_doProcessBlock:function(R,T){R[T]^=A.call(this)},keySize:256/32,ivSize:0});function A(){for(var R=this._S,T=this._i,O=this._j,B=0,F=0;F<4;F++){T=(T+1)%256,O=(O+R[T])%256;var U=R[T];R[T]=R[O],R[O]=U,B|=R[(R[T]+R[O])%256]<<24-F*8}return this._i=T,this._j=O,B}v.RC4=w._createHelper(S);var $=E.RC4Drop=S.extend({cfg:S.cfg.extend({drop:192}),_doReset:function(){S._doReset.call(this);for(var R=this.cfg.drop;R>0;R--)A.call(this)}});v.RC4Drop=w._createHelper($)})(),g.RC4})})(rc4$1)),rc4$1.exports}var rabbit$1={exports:{}},rabbit=rabbit$1.exports,hasRequiredRabbit;function requireRabbit(){return hasRequiredRabbit||(hasRequiredRabbit=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore())})(rabbit,function(g){return(function(){var v=g,b=v.lib,w=b.StreamCipher,E=v.algo,S=[],A=[],$=[],R=E.Rabbit=w.extend({_doReset:function(){for(var O=this._key.words,B=this.cfg.iv,F=0;F<4;F++)O[F]=(O[F]<<8|O[F]>>>24)&16711935|(O[F]<<24|O[F]>>>8)&4278255360;var U=this._X=[O[0],O[3]<<16|O[2]>>>16,O[1],O[0]<<16|O[3]>>>16,O[2],O[1]<<16|O[0]>>>16,O[3],O[2]<<16|O[1]>>>16],q=this._C=[O[2]<<16|O[2]>>>16,O[0]&4294901760|O[1]&65535,O[3]<<16|O[3]>>>16,O[1]&4294901760|O[2]&65535,O[0]<<16|O[0]>>>16,O[2]&4294901760|O[3]&65535,O[1]<<16|O[1]>>>16,O[3]&4294901760|O[0]&65535];this._b=0;for(var F=0;F<4;F++)T.call(this);for(var F=0;F<8;F++)q[F]^=U[F+4&7];if(B){var J=B.words,ie=J[0],oe=J[1],le=(ie<<8|ie>>>24)&16711935|(ie<<24|ie>>>8)&4278255360,de=(oe<<8|oe>>>24)&16711935|(oe<<24|oe>>>8)&4278255360,fe=le>>>16|de&4294901760,ye=de<<16|le&65535;q[0]^=le,q[1]^=fe,q[2]^=de,q[3]^=ye,q[4]^=le,q[5]^=fe,q[6]^=de,q[7]^=ye;for(var F=0;F<4;F++)T.call(this)}},_doProcessBlock:function(O,B){var F=this._X;T.call(this),S[0]=F[0]^F[5]>>>16^F[3]<<16,S[1]=F[2]^F[7]>>>16^F[5]<<16,S[2]=F[4]^F[1]>>>16^F[7]<<16,S[3]=F[6]^F[3]>>>16^F[1]<<16;for(var U=0;U<4;U++)S[U]=(S[U]<<8|S[U]>>>24)&16711935|(S[U]<<24|S[U]>>>8)&4278255360,O[B+U]^=S[U]},blockSize:128/32,ivSize:64/32});function T(){for(var O=this._X,B=this._C,F=0;F<8;F++)A[F]=B[F];B[0]=B[0]+1295307597+this._b|0,B[1]=B[1]+3545052371+(B[0]>>>0<A[0]>>>0?1:0)|0,B[2]=B[2]+886263092+(B[1]>>>0<A[1]>>>0?1:0)|0,B[3]=B[3]+1295307597+(B[2]>>>0<A[2]>>>0?1:0)|0,B[4]=B[4]+3545052371+(B[3]>>>0<A[3]>>>0?1:0)|0,B[5]=B[5]+886263092+(B[4]>>>0<A[4]>>>0?1:0)|0,B[6]=B[6]+1295307597+(B[5]>>>0<A[5]>>>0?1:0)|0,B[7]=B[7]+3545052371+(B[6]>>>0<A[6]>>>0?1:0)|0,this._b=B[7]>>>0<A[7]>>>0?1:0;for(var F=0;F<8;F++){var U=O[F]+B[F],q=U&65535,J=U>>>16,ie=((q*q>>>17)+q*J>>>15)+J*J,oe=((U&4294901760)*U|0)+((U&65535)*U|0);$[F]=ie^oe}O[0]=$[0]+($[7]<<16|$[7]>>>16)+($[6]<<16|$[6]>>>16)|0,O[1]=$[1]+($[0]<<8|$[0]>>>24)+$[7]|0,O[2]=$[2]+($[1]<<16|$[1]>>>16)+($[0]<<16|$[0]>>>16)|0,O[3]=$[3]+($[2]<<8|$[2]>>>24)+$[1]|0,O[4]=$[4]+($[3]<<16|$[3]>>>16)+($[2]<<16|$[2]>>>16)|0,O[5]=$[5]+($[4]<<8|$[4]>>>24)+$[3]|0,O[6]=$[6]+($[5]<<16|$[5]>>>16)+($[4]<<16|$[4]>>>16)|0,O[7]=$[7]+($[6]<<8|$[6]>>>24)+$[5]|0}v.Rabbit=w._createHelper(R)})(),g.Rabbit})})(rabbit$1)),rabbit$1.exports}var rabbitLegacy$1={exports:{}},rabbitLegacy=rabbitLegacy$1.exports,hasRequiredRabbitLegacy;function requireRabbitLegacy(){return hasRequiredRabbitLegacy||(hasRequiredRabbitLegacy=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore())})(rabbitLegacy,function(g){return(function(){var v=g,b=v.lib,w=b.StreamCipher,E=v.algo,S=[],A=[],$=[],R=E.RabbitLegacy=w.extend({_doReset:function(){var O=this._key.words,B=this.cfg.iv,F=this._X=[O[0],O[3]<<16|O[2]>>>16,O[1],O[0]<<16|O[3]>>>16,O[2],O[1]<<16|O[0]>>>16,O[3],O[2]<<16|O[1]>>>16],U=this._C=[O[2]<<16|O[2]>>>16,O[0]&4294901760|O[1]&65535,O[3]<<16|O[3]>>>16,O[1]&4294901760|O[2]&65535,O[0]<<16|O[0]>>>16,O[2]&4294901760|O[3]&65535,O[1]<<16|O[1]>>>16,O[3]&4294901760|O[0]&65535];this._b=0;for(var q=0;q<4;q++)T.call(this);for(var q=0;q<8;q++)U[q]^=F[q+4&7];if(B){var J=B.words,ie=J[0],oe=J[1],le=(ie<<8|ie>>>24)&16711935|(ie<<24|ie>>>8)&4278255360,de=(oe<<8|oe>>>24)&16711935|(oe<<24|oe>>>8)&4278255360,fe=le>>>16|de&4294901760,ye=de<<16|le&65535;U[0]^=le,U[1]^=fe,U[2]^=de,U[3]^=ye,U[4]^=le,U[5]^=fe,U[6]^=de,U[7]^=ye;for(var q=0;q<4;q++)T.call(this)}},_doProcessBlock:function(O,B){var F=this._X;T.call(this),S[0]=F[0]^F[5]>>>16^F[3]<<16,S[1]=F[2]^F[7]>>>16^F[5]<<16,S[2]=F[4]^F[1]>>>16^F[7]<<16,S[3]=F[6]^F[3]>>>16^F[1]<<16;for(var U=0;U<4;U++)S[U]=(S[U]<<8|S[U]>>>24)&16711935|(S[U]<<24|S[U]>>>8)&4278255360,O[B+U]^=S[U]},blockSize:128/32,ivSize:64/32});function T(){for(var O=this._X,B=this._C,F=0;F<8;F++)A[F]=B[F];B[0]=B[0]+1295307597+this._b|0,B[1]=B[1]+3545052371+(B[0]>>>0<A[0]>>>0?1:0)|0,B[2]=B[2]+886263092+(B[1]>>>0<A[1]>>>0?1:0)|0,B[3]=B[3]+1295307597+(B[2]>>>0<A[2]>>>0?1:0)|0,B[4]=B[4]+3545052371+(B[3]>>>0<A[3]>>>0?1:0)|0,B[5]=B[5]+886263092+(B[4]>>>0<A[4]>>>0?1:0)|0,B[6]=B[6]+1295307597+(B[5]>>>0<A[5]>>>0?1:0)|0,B[7]=B[7]+3545052371+(B[6]>>>0<A[6]>>>0?1:0)|0,this._b=B[7]>>>0<A[7]>>>0?1:0;for(var F=0;F<8;F++){var U=O[F]+B[F],q=U&65535,J=U>>>16,ie=((q*q>>>17)+q*J>>>15)+J*J,oe=((U&4294901760)*U|0)+((U&65535)*U|0);$[F]=ie^oe}O[0]=$[0]+($[7]<<16|$[7]>>>16)+($[6]<<16|$[6]>>>16)|0,O[1]=$[1]+($[0]<<8|$[0]>>>24)+$[7]|0,O[2]=$[2]+($[1]<<16|$[1]>>>16)+($[0]<<16|$[0]>>>16)|0,O[3]=$[3]+($[2]<<8|$[2]>>>24)+$[1]|0,O[4]=$[4]+($[3]<<16|$[3]>>>16)+($[2]<<16|$[2]>>>16)|0,O[5]=$[5]+($[4]<<8|$[4]>>>24)+$[3]|0,O[6]=$[6]+($[5]<<16|$[5]>>>16)+($[4]<<16|$[4]>>>16)|0,O[7]=$[7]+($[6]<<8|$[6]>>>24)+$[5]|0}v.RabbitLegacy=w._createHelper(R)})(),g.RabbitLegacy})})(rabbitLegacy$1)),rabbitLegacy$1.exports}var blowfish$1={exports:{}},blowfish=blowfish$1.exports,hasRequiredBlowfish;function requireBlowfish(){return hasRequiredBlowfish||(hasRequiredBlowfish=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore())})(blowfish,function(g){return(function(){var v=g,b=v.lib,w=b.BlockCipher,E=v.algo;const S=16,A=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],$=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var R={pbox:[],sbox:[]};function T(q,J){let ie=J>>24&255,oe=J>>16&255,le=J>>8&255,de=J&255,fe=q.sbox[0][ie]+q.sbox[1][oe];return fe=fe^q.sbox[2][le],fe=fe+q.sbox[3][de],fe}function O(q,J,ie){let oe=J,le=ie,de;for(let fe=0;fe<S;++fe)oe=oe^q.pbox[fe],le=T(q,oe)^le,de=oe,oe=le,le=de;return de=oe,oe=le,le=de,le=le^q.pbox[S],oe=oe^q.pbox[S+1],{left:oe,right:le}}function B(q,J,ie){let oe=J,le=ie,de;for(let fe=S+1;fe>1;--fe)oe=oe^q.pbox[fe],le=T(q,oe)^le,de=oe,oe=le,le=de;return de=oe,oe=le,le=de,le=le^q.pbox[1],oe=oe^q.pbox[0],{left:oe,right:le}}function F(q,J,ie){for(let ye=0;ye<4;ye++){q.sbox[ye]=[];for(let we=0;we<256;we++)q.sbox[ye][we]=$[ye][we]}let oe=0;for(let ye=0;ye<S+2;ye++)q.pbox[ye]=A[ye]^J[oe],oe++,oe>=ie&&(oe=0);let le=0,de=0,fe=0;for(let ye=0;ye<S+2;ye+=2)fe=O(q,le,de),le=fe.left,de=fe.right,q.pbox[ye]=le,q.pbox[ye+1]=de;for(let ye=0;ye<4;ye++)for(let we=0;we<256;we+=2)fe=O(q,le,de),le=fe.left,de=fe.right,q.sbox[ye][we]=le,q.sbox[ye][we+1]=de;return!0}var U=E.Blowfish=w.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var q=this._keyPriorReset=this._key,J=q.words,ie=q.sigBytes/4;F(R,J,ie)}},encryptBlock:function(q,J){var ie=O(R,q[J],q[J+1]);q[J]=ie.left,q[J+1]=ie.right},decryptBlock:function(q,J){var ie=B(R,q[J],q[J+1]);q[J]=ie.left,q[J+1]=ie.right},blockSize:64/32,keySize:128/32,ivSize:64/32});v.Blowfish=w._createHelper(U)})(),g.Blowfish})})(blowfish$1)),blowfish$1.exports}var cryptoJs=cryptoJs$1.exports,hasRequiredCryptoJs;function requireCryptoJs(){return hasRequiredCryptoJs||(hasRequiredCryptoJs=1,(function(y,u){(function(g,v,b){y.exports=v(requireCore(),requireX64Core(),requireLibTypedarrays(),requireEncUtf16(),requireEncBase64(),requireEncBase64url(),requireMd5(),requireSha1(),requireSha256(),requireSha224(),requireSha512(),requireSha384(),requireSha3(),requireRipemd160(),requireHmac(),requirePbkdf2(),requireEvpkdf(),requireCipherCore(),requireModeCfb(),requireModeCtr(),requireModeCtrGladman(),requireModeOfb(),requireModeEcb(),requirePadAnsix923(),requirePadIso10126(),requirePadIso97971(),requirePadZeropadding(),requirePadNopadding(),requireFormatHex(),requireAes(),requireTripledes(),requireRc4(),requireRabbit(),requireRabbitLegacy(),requireBlowfish())})(cryptoJs,function(g){return g})})(cryptoJs$1)),cryptoJs$1.exports}var cryptoJsExports=requireCryptoJs();const CryptoJS=getDefaultExportFromCjs$3(cryptoJsExports);var ellipticExports=requireElliptic();const elliptic=getDefaultExportFromCjs$3(ellipticExports),CHARSET$1="qpzry9x8gf2tvdw0s3jn54khce6mua7l";function convertBits$1(y,u,g,v){let b=0,w=0;const E=[],S=(1<<g)-1;for(let A=0;A<y.length;A++){const $=y[A];if($<0||$>>u!==0)return null;for(b=b<<u|$,w+=u;w>=g;)w-=g,E.push(b>>w&S)}if(v)w>0&&E.push(b<<g-w&S);else if(w>=u||b<<g-w&S)return null;return E}function hrpExpand$1(y){const u=[];for(let g=0;g<y.length;g++)u.push(y.charCodeAt(g)>>5);u.push(0);for(let g=0;g<y.length;g++)u.push(y.charCodeAt(g)&31);return u}function bech32Polymod(y){const u=[996825010,642813549,513874426,1027748829,705979059];let g=1;for(let v=0;v<y.length;v++){const b=g>>25;g=(g&33554431)<<5^y[v];for(let w=0;w<5;w++)b>>w&1&&(g^=u[w])}return g}function bech32Checksum(y,u){const g=hrpExpand$1(y).concat(u).concat([0,0,0,0,0,0]),v=bech32Polymod(g)^1,b=[];for(let w=0;w<6;w++)b.push(v>>5*(5-w)&31);return b}function createBech32(y,u,g){if(u<0||u>16)throw new Error("Invalid witness version");const v=[u].concat(convertBits$1(Array.from(g),8,5,!0)),b=bech32Checksum(y,v),w=v.concat(b);let E=y+"1";for(let S=0;S<w.length;S++)E+=CHARSET$1[w[S]];return E}function decodeBech32(y){y=y.toLowerCase();const u=y.lastIndexOf("1");if(u<1)return null;const g=y.substring(0,u),v=y.substring(u+1),b=[];for(let A=0;A<v.length;A++){const $=CHARSET$1.indexOf(v[A]);if($===-1)return null;b.push($)}const w=bech32Checksum(g,b.slice(0,-6));for(let A=0;A<6;A++)if(w[A]!==b[b.length-6+A])return console.error("Invalid bech32 checksum"),null;const E=b[0],S=convertBits$1(b.slice(1,-6),5,8,!1);return S?{hrp:g,witnessVersion:E,data:Uint8Array.from(S)}:null}const ec$3=new elliptic.ec("secp256k1");function computeHash160(y){const u=CryptoJS.SHA256(CryptoJS.enc.Hex.parse(y)).toString();return CryptoJS.RIPEMD160(CryptoJS.enc.Hex.parse(u)).toString()}function hash160ToBytes(y){return Uint8Array.from(y.match(/../g).map(u=>parseInt(u,16)))}function publicKeyToAddress(y,u="alpha",g=0){const v=computeHash160(y),b=hash160ToBytes(v);return createBech32(u,g,b)}function privateKeyToAddressInfo(y){const g=ec$3.keyFromPrivate(y).getPublic(!0,"hex");return{address:publicKeyToAddress(g),publicKey:g}}function generateAddressInfo(y,u,g){const{address:v,publicKey:b}=privateKeyToAddressInfo(y);return{address:v,privateKey:y,publicKey:b,index:u,path:g}}const CURVE_ORDER=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141");function deriveChildKeyBIP32(y,u,g){const v=g>=2147483648;let b;if(v){const O=g.toString(16).padStart(8,"0");b="00"+y+O}else{const B=ec$3.keyFromPrivate(y,"hex").getPublic(!0,"hex"),F=g.toString(16).padStart(8,"0");b=B+F}const w=CryptoJS.HmacSHA512(CryptoJS.enc.Hex.parse(b),CryptoJS.enc.Hex.parse(u)).toString(),E=w.substring(0,64),S=w.substring(64),A=BigInt("0x"+E),$=BigInt("0x"+y);if(A>=CURVE_ORDER)throw new Error("Invalid key: IL >= curve order");const R=(A+$)%CURVE_ORDER;if(R===0n)throw new Error("Invalid key: child key is zero");return{privateKey:R.toString(16).padStart(64,"0"),chainCode:S}}function deriveKeyAtPath(y,u,g){const v=g.replace("m/","").split("/");let b=y,w=u;for(const E of v){const S=E.endsWith("'")||E.endsWith("h"),A=E.replace(/['h]$/,"");let $=parseInt(A,10);S&&($+=2147483648);const R=deriveChildKeyBIP32(b,w,$);b=R.privateKey,w=R.chainCode}return{privateKey:b,chainCode:w}}function generateMasterKeyFromSeed(y){const u=CryptoJS.HmacSHA512(CryptoJS.enc.Hex.parse(y),CryptoJS.enc.Utf8.parse("Bitcoin seed")).toString(),g=u.substring(0,64),v=u.substring(64),b=BigInt("0x"+g);if(b===0n||b>=CURVE_ORDER)throw new Error("Invalid master key generated");return{masterPrivateKey:g,masterChainCode:v}}function generateHDAddressBIP32(y,u,g,v="m/44'/0'/0'",b=!1){const E=`${v}/${b?1:0}/${g}`,S=deriveKeyAtPath(y,u,E);return generateAddressInfo(S.privateKey,g,E)}function generateAddressFromMasterKey(y,u){const g=`m/44'/0'/${u}'`,v=CryptoJS.enc.Hex.parse(y),b=CryptoJS.enc.Utf8.parse(g),E=CryptoJS.HmacSHA512(v,b).toString().substring(0,64);return generateAddressInfo(E,u,g)}function deriveChildKey(y,u,g){const v=y+g.toString(16).padStart(8,"0"),b=CryptoJS.HmacSHA512(CryptoJS.enc.Hex.parse(v),CryptoJS.enc.Hex.parse(u)).toString();return{privateKey:b.substring(0,64),nextChainCode:b.substring(64)}}function generateHDAddress(y,u,g){const v=deriveChildKey(y,u,g),b=`m/44'/0'/0'/${g}`;return generateAddressInfo(v.privateKey,g,b)}function hexToWIF(y){const g="80"+y,v=CryptoJS.SHA256(CryptoJS.enc.Hex.parse(g)).toString(),w=CryptoJS.SHA256(CryptoJS.enc.Hex.parse(v)).toString().substring(0,8),E=g+w;return base58Encode(E)}function base58Encode(y){const u="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";let g=BigInt("0x"+y),v="";for(;g>0n;){const b=Number(g%58n);g=g/58n,v=u[b]+v}for(let b=0;b<y.length&&y.substring(b,b+2)==="00";b+=2)v="1"+v;return v}function bytesToHex$5(y){return Array.from(y).map(u=>u.toString(16).padStart(2,"0")).join("")}function readBinaryFile(y){return new Promise((u,g)=>{const v=new FileReader;v.onload=b=>u(new Uint8Array(b.target?.result)),v.onerror=g,v.readAsArrayBuffer(y)})}function findPattern(y,u,g=0){for(let v=g;v<=y.length-u.length;v++){let b=!0;for(let w=0;w<u.length;w++)if(y[v+w]!==u[w]){b=!1;break}if(b)return v}return-1}function isValidPrivateKey(y){try{const u=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141"),g=BigInt("0x"+y);return g>0n&&g<u}catch{return!1}}function yieldToMain(){return new Promise(y=>setTimeout(y,0))}function uint8ArrayToWordArray(y){const u=bytesToHex$5(y);return CryptoJS.enc.Hex.parse(u)}async function decryptMasterKey(y,u,g,v){const b=bytesToHex$5(new TextEncoder().encode(v)),w=bytesToHex$5(u),E=b+w;let S=CryptoJS.SHA512(CryptoJS.enc.Hex.parse(E));const A=1e3;for(let F=0;F<g-1;F++)S=CryptoJS.SHA512(S),F%A===0&&await yieldToMain();const $=CryptoJS.lib.WordArray.create(S.words.slice(0,8)),R=CryptoJS.lib.WordArray.create(S.words.slice(8,12)),T=uint8ArrayToWordArray(y),O=CryptoJS.AES.decrypt({ciphertext:T},$,{iv:R,padding:CryptoJS.pad.Pkcs7,mode:CryptoJS.mode.CBC}),B=CryptoJS.enc.Hex.stringify(O);if(!B||B.length!==64)throw new Error("Master key decryption failed - incorrect password");return B}function findAllCMasterKeys(y){const u=[];for(let g=0;g<y.length-70;g++)if(y[g]===48){const v=g+1+48;if(v<y.length&&y[v]===8){const b=v+1+8+4;if(b+4<=y.length){const w=y[b]|y[b+1]<<8|y[b+2]<<16|y[b+3]<<24;if(w>=1e3&&w<=1e7){const E=y.slice(g+1,g+1+48),S=y.slice(v+1,v+1+8),A=y[v+1+8]|y[v+1+8+1]<<8|y[v+1+8+2]<<16|y[v+1+8+3]<<24;console.log(`Found CMasterKey at position ${g}, iterations: ${w}`),u.push({encryptedKey:E,salt:S,derivationMethod:A,iterations:w,position:g})}}}}return console.log(`Total CMasterKey structures found: ${u.length}`),u}async function decryptEncryptedWalletDat(y,u){try{const g=findAllCMasterKeys(y);if(g.length===0)throw new Error("Could not find CMasterKey structure in wallet");let v=null;for(const B of g)try{if(console.log(`Trying CMasterKey at position ${B.position}...`),v=await decryptMasterKey(B.encryptedKey,B.salt,B.iterations,u),v&&v.length===64){console.log(` Successfully decrypted with CMasterKey at position ${B.position}`);break}}catch(F){console.log(` Failed with CMasterKey at position ${B.position}: ${F instanceof Error?F.message:F}`)}if(!v||v.length!==64)throw new Error("Master key decryption failed - incorrect password");const b=new TextEncoder().encode("walletdescriptor");let w=0,E=null,S=null;for(;(w=findPattern(y,b,w))!==-1;){let B=w+b.length+32;const F=y[B];B++;const U=y.slice(B,B+Math.min(F,200));let q="";for(let J=0;J<U.length&&U[J]>=32&&U[J]<=126;J++)q+=String.fromCharCode(U[J]);if(q.startsWith("wpkh(xpub")&&q.includes("/0/*)")){const J=q.match(/xpub[1-9A-HJ-NP-Za-km-z]{100,}/);if(J){S=J[0];const ie=w+b.length;E=y.slice(ie,ie+32);break}}w++}if(!E||!S)throw new Error("Could not find native SegWit receive descriptor");const A=base58Decode(S),$=bytesToHex$5(A.slice(13,45)),R=new TextEncoder().encode("walletdescriptorckey");let T=findPattern(y,R,0),O=null;for(;T!==-1&&!O;){const B=y.slice(T+R.length,T+R.length+32);if(Array.from(B).every((F,U)=>F===E[U])){let F=T+R.length+32;const U=y[F];F++;const q=y.slice(F,F+U);for(let J=F+U;J<Math.min(F+U+100,y.length-50);J++){const ie=y[J];if(ie>=32&&ie<=64){const oe=y.slice(J+1,J+1+ie),le=uint8ArrayToWordArray(q),de=CryptoJS.SHA256(CryptoJS.SHA256(le)),fe=CryptoJS.lib.WordArray.create(de.words.slice(0,4)),ye=CryptoJS.enc.Hex.parse(v),we=uint8ArrayToWordArray(oe),pe=CryptoJS.AES.decrypt({ciphertext:we},ye,{iv:fe,padding:CryptoJS.pad.Pkcs7,mode:CryptoJS.mode.CBC});if(O=CryptoJS.enc.Hex.stringify(pe),O.length===64){console.log(` BIP32 master key decrypted: ${O.substring(0,16)}...`);break}}}break}T=findPattern(y,R,T+1)}if(!O||O.length!==64)throw new Error("Could not decrypt BIP32 master private key");return{masterKey:O,chainCode:$,descriptorPath:"84'/1'/0'"}}catch(g){return console.error("Error decrypting encrypted wallet.dat:",g),null}}function base58Decode(y){const u="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",g={};for(let E=0;E<u.length;E++)g[u[E]]=E;let v=0;for(let E=0;E<y.length&&y[E]==="1";E++)v++;let b=BigInt(0);for(let E=0;E<y.length;E++){const S=y[E];if(!(S in g))throw new Error("Invalid base58 character: "+S);b=b*BigInt(58)+BigInt(g[S])}const w=[];for(;b>0;)w.unshift(Number(b%BigInt(256))),b=b/BigInt(256);for(let E=0;E<v;E++)w.unshift(0);return new Uint8Array(w)}async function restoreFromWalletDat(y,u){try{const g=await readBinaryFile(y);if(!new TextDecoder().decode(g.slice(0,16)).startsWith("SQLite format 3"))return{success:!1,wallet:{},error:"Invalid wallet.dat file - not an SQLite database"};const b={descriptorKeys:[],hdChain:null,legacyKeys:[],isDescriptorWallet:!1},w=new TextEncoder().encode("walletdescriptorkey");let E=0;for(;(E=findPattern(g,w,E))!==-1;){b.isDescriptorWallet=!0;for(let fe=E+w.length;fe<Math.min(E+w.length+200,g.length-40);fe++)if(g[fe]===211&&g[fe+1]===2&&g[fe+2]===1&&g[fe+3]===1&&g[fe+4]===4&&g[fe+5]===32){const ye=g.slice(fe+6,fe+38),we=bytesToHex$5(ye);if(isValidPrivateKey(we)){b.descriptorKeys.push(we);break}}E++}const S=new TextEncoder().encode("hdchain");E=findPattern(g,S),E!==-1&&(b.hdChain=!0);const A=new TextEncoder().encode("mkey"),$=findPattern(g,A,0)!==-1;$&&b.descriptorKeys.length===0&&console.warn("Wallet appears to be encrypted - legacy key extraction may fail");const R=new TextEncoder().encode("key");for(E=0;(E=findPattern(g,R,E))!==-1;){const fe=new Uint8Array([4,32]);for(let ye=E;ye<Math.min(E+200,g.length-34);ye++)if(g[ye]===fe[0]&&g[ye+1]===fe[1]){const we=g.slice(ye+2,ye+34),pe=bytesToHex$5(we);if(isValidPrivateKey(pe)){b.legacyKeys.push(pe);break}}E++}let T=null;const O=new TextEncoder().encode("wpkh(["),B=findPattern(g,O,0);if(B!==-1){const fe=g.slice(B,Math.min(B+200,g.length));let ye="";for(let pe=0;pe<fe.length;pe++){const ve=fe[pe];if(ve>=32&&ve<=126&&(ye+=String.fromCharCode(ve),ye.includes("*))")))break}console.log("Found descriptor:",ye);const we=ye.match(/\[[\da-f]+\/(\d+'\/\d+'\/\d+')\]/);we&&(T=we[1],console.log("Extracted descriptor path:",T))}let F=null;const U=new TextEncoder().encode("xpub"),q="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";let J=0,ie=!1;for(;!ie&&J<g.length;){const fe=findPattern(g,U,J);if(fe===-1)break;let ye="xpub",we=fe+4;for(;we<g.length&&ye.length<120;){const pe=String.fromCharCode(g[we]);if(q.includes(pe))ye+=pe,we++;else break}if(ye.length>100)try{const pe=base58Decode(ye);if(pe[4]===0){const he=pe.slice(13,45);F=bytesToHex$5(he),console.log("Extracted master chain code from depth 0 xpub:",F),ie=!0}}catch(pe){console.error("Failed to decode xpub:",pe)}J=fe+4}F||console.warn("Could not extract chain code from wallet.dat - BIP32 derivation will not work correctly");let oe=null,le="";if(b.isDescriptorWallet&&b.descriptorKeys.length>0)oe=b.descriptorKeys[0],le="descriptor wallet",console.log(`Found ${b.descriptorKeys.length} key(s) in descriptor wallet`);else if(b.legacyKeys.length>0)oe=b.legacyKeys[0],le=b.hdChain?"HD wallet":"legacy wallet",console.log(`Found ${b.legacyKeys.length} key(s) in ${le}`);else if($){if(!u)return{success:!1,wallet:{},error:"This wallet.dat file is encrypted. Please provide a password to decrypt it.",isEncryptedDat:!0};const fe=await decryptEncryptedWalletDat(g,u);return fe?{success:!0,wallet:{masterPrivateKey:fe.masterKey,addresses:[],isEncrypted:!1,encryptedMasterKey:"",childPrivateKey:null,isImportedAlphaWallet:!0,masterChainCode:fe.chainCode,chainCode:fe.chainCode,descriptorPath:fe.descriptorPath},message:"Encrypted wallet.dat decrypted and imported successfully!"}:{success:!1,wallet:{},error:"Failed to decrypt wallet.dat. The password may be incorrect.",isEncryptedDat:!0}}else return{success:!1,wallet:{},error:"No valid private keys found in wallet.dat file. The wallet might use an unsupported format."};return{success:!0,wallet:{masterPrivateKey:oe,addresses:[],isEncrypted:!1,encryptedMasterKey:"",childPrivateKey:null,isImportedAlphaWallet:!0,masterChainCode:F,chainCode:F||void 0,descriptorPath:T||"84'/1'/0'"},message:`Wallet imported successfully from Alpha ${le}! Note: The first address generated may differ from your original wallet's addresses due to derivation path differences.`}}catch(g){return console.error("Error importing wallet.dat:",g),{success:!1,wallet:{},error:"Error importing wallet.dat: "+(g instanceof Error?g.message:String(g))}}}async function importWallet(y,u){try{if(y.name.endsWith(".dat"))return restoreFromWalletDat(y,u);const g=await y.text();let v="",b=!1,w="";if(g.includes("ENCRYPTED MASTER KEY")){b=!0,console.log("Loading encrypted wallet...");const F=g.match(/ENCRYPTED MASTER KEY \(password protected\):\s*([^\n]+)/);if(F&&F[1]){if(w=F[1].trim(),console.log("Found encrypted master key"),!u)return{success:!1,wallet:{},error:"This is an encrypted wallet. Please enter the decryption password."};try{console.log("Attempting to decrypt with provided password...");const q=CryptoJS.PBKDF2(u,"alpha_wallet_salt",{keySize:256/32,iterations:1e5,hasher:CryptoJS.algo.SHA1}).toString();if(v=CryptoJS.AES.decrypt(w,q).toString(CryptoJS.enc.Utf8),!v)return{success:!1,wallet:{},error:"Failed to decrypt the wallet. The password may be incorrect."};console.log("Successfully decrypted master key:",v.substring(0,8)+"...")}catch(U){return{success:!1,wallet:{},error:"Error decrypting wallet: "+(U instanceof Error?U.message:String(U))}}}else return{success:!1,wallet:{},error:"Could not find the encrypted master key in the backup file."}}else{const F=g.match(/MASTER PRIVATE KEY \(keep secret!\):\s*([^\n]+)/);if(F&&F[1])v=F[1].trim();else return{success:!1,wallet:{},error:"Could not find the master private key in the backup file."}}let E=null,S=!1;const A=g.match(/MASTER CHAIN CODE \(for (?:BIP32 HD|Alpha) wallet compatibility\):\s*([^\n]+)/);A&&A[1]&&(E=A[1].trim(),S=!0),(g.includes("WALLET TYPE: BIP32 hierarchical deterministic wallet")||g.includes("WALLET TYPE: Alpha descriptor wallet"))&&(S=!0);let $=null;const R=g.match(/DESCRIPTOR PATH:\s*([^\n]+)/);R&&R[1]&&($=R[1].trim());const T=[],O=g.match(/YOUR ADDRESSES:\s*\n([\s\S]*?)(?:\n\nGenerated on:|$)/);if(O&&O[1]){const F=O[1].trim().split(`
`);for(const U of F){const q=U.match(/Address\s+(\d+):\s+(\w+)\s*(?:\(Path:\s*([^)]*)\))?/);if(q){const J=parseInt(q[1])-1,ie=q[2],oe=q[3]==="undefined"?null:q[3]||null;T.push({index:J,address:ie,path:oe,createdAt:new Date().toISOString()})}}}const B={masterPrivateKey:v,addresses:T,isEncrypted:b,encryptedMasterKey:w,childPrivateKey:null,isImportedAlphaWallet:S,masterChainCode:E,chainCode:E||void 0,descriptorPath:$||(S?"84'/1'/0'":null)};if(!S&&T.length>0){const F=CryptoJS.enc.Hex.parse(B.masterPrivateKey),U=0;for(let q=0;q<B.addresses.length;q++){const J=B.addresses[q];let ie=!1;for(let oe=0;oe<100;oe++){const le=`m/44'/0'/${oe}'`,fe=CryptoJS.HmacSHA512(F,CryptoJS.enc.Utf8.parse(le)).toString().substring(0,64),we=ec$3.keyFromPrivate(fe).getPublic(!0,"hex");if(publicKeyToAddress(we,"alpha",U)===J.address){console.log(` Found correct derivation for address ${q+1} at index ${oe}!`),J.privateKey=fe,J.publicKey=we,J.path=le,J.index=oe,ie=!0,q===0&&(B.childPrivateKey=fe);break}}if(!ie)return console.error("WALLET INTEGRITY CHECK FAILED"),console.error("Address from file:",J.address),console.error("Recovery scan (0-99) failed to find matching key"),{success:!1,wallet:{},error:`Wallet integrity check failed: Address ${J.address} does not match any key derived from the master private key. This wallet file may be corrupted or from a different wallet.`}}}if(S&&E&&T.length>0)for(let U=0;U<B.addresses.length;U++){const q=B.addresses[U];if(q.path&&q.path.startsWith("m/"))try{const J=deriveKeyAtPath(v,E,q.path),oe=ec$3.keyFromPrivate(J.privateKey).getPublic(!0,"hex"),le=publicKeyToAddress(oe,"alpha",0);if(le===q.address){console.log(` BIP32: Recovered key for address ${U+1} at path ${q.path}`),q.privateKey=J.privateKey,q.publicKey=oe;const de=q.path.split("/");if(de.length>=5){const fe=parseInt(de[de.length-2],10);q.isChange=fe===1}}else return console.error(`BIP32: Address mismatch at path ${q.path}`),console.error(`  Expected: ${q.address}`),console.error(`  Derived:  ${le}`),{success:!1,wallet:{},error:`Wallet integrity check failed: Address ${q.address} does not match derived address at path ${q.path}`}}catch(J){return console.error(`Error deriving key at path ${q.path}:`,J),{success:!1,wallet:{},error:`Failed to derive key at path ${q.path}: ${J instanceof Error?J.message:String(J)}`}}else{console.warn(`BIP32: Address ${U+1} has no path info, scanning...`);const J=$||"84'/1'/0'";let ie=!1;for(const oe of[0,1]){if(ie)break;for(let le=0;le<100;le++){const de=`m/${J}/${oe}/${le}`;try{const fe=deriveKeyAtPath(v,E,de),we=ec$3.keyFromPrivate(fe.privateKey).getPublic(!0,"hex");if(publicKeyToAddress(we,"alpha",0)===q.address){console.log(` BIP32: Found address ${U+1} at ${de}`),q.privateKey=fe.privateKey,q.publicKey=we,q.path=de,q.index=le,q.isChange=oe===1,ie=!0;break}}catch{}}}if(!ie)return console.error(`BIP32: Could not find derivation for address ${q.address}`),{success:!1,wallet:{},error:`Could not find BIP32 derivation path for address ${q.address}`}}}return{success:!0,wallet:B,message:"Wallet restored successfully!"}}catch(g){return console.error("Error restoring wallet:",g),{success:!1,wallet:{},error:g instanceof Error?g.message:String(g)}}}function exportWallet(y,u={}){const{password:g}=u;if(!y||!y.masterPrivateKey)throw new Error("Invalid wallet - missing master private key");let v;if(g){const w=CryptoJS.PBKDF2(g,"alpha_wallet_salt",{keySize:8,iterations:1e5,hasher:CryptoJS.algo.SHA1}).toString(),E=CryptoJS.AES.encrypt(y.masterPrivateKey,w).toString();let S;y.isImportedAlphaWallet?S=y.addresses.map(($,R)=>{const T=$.path||`m/84'/1'/0'/${$.isChange?1:0}/${$.index}`;return`Address ${R+1}: ${$.address} (Path: ${T})`}).join(`
`):S=y.addresses.map($=>`Address ${$.index+1}: ${$.address} (Path: ${$.path})`).join(`
`);let A=`ENCRYPTED MASTER KEY (password protected):
${E}`;y.isImportedAlphaWallet&&y.masterChainCode?A+=`

MASTER CHAIN CODE (for BIP32 HD wallet compatibility):
${y.masterChainCode}

WALLET TYPE: BIP32 hierarchical deterministic wallet`:A+=`

WALLET TYPE: Standard wallet (HMAC-based)`,v=`UNICITY WALLET DETAILS
===========================

${A}

ENCRYPTION STATUS: Encrypted with password
To use this key, you will need the password you set in the wallet.

YOUR ADDRESSES:
${S}

Generated on: ${new Date().toLocaleString()}

WARNING: Keep your master private key safe and secure.
Anyone with your master private key can access all your funds.`}else{const b=hexToWIF(y.masterPrivateKey);let w,E;y.isImportedAlphaWallet&&y.masterChainCode?(w=`MASTER PRIVATE KEY (keep secret!):
${y.masterPrivateKey}

MASTER PRIVATE KEY IN WIF FORMAT (for importprivkey command):
${b}

MASTER CHAIN CODE (for BIP32 HD wallet compatibility):
${y.masterChainCode}

DESCRIPTOR PATH: ${y.descriptorPath||"84'/1'/0'"}

WALLET TYPE: BIP32 hierarchical deterministic wallet

ENCRYPTION STATUS: Not encrypted
This key is in plaintext and not protected. Anyone with this file can access your wallet.`,E=y.addresses.map((S,A)=>{const $=S.path||`m/84'/1'/0'/${S.isChange?1:0}/${S.index}`;return`Address ${A+1}: ${S.address} (Path: ${$})`}).join(`
`)):(E=y.addresses.map(S=>`Address ${S.index+1}: ${S.address} (Path: ${S.path})`).join(`
`),w=`MASTER PRIVATE KEY (keep secret!):
${y.masterPrivateKey}

MASTER PRIVATE KEY IN WIF FORMAT (for importprivkey command):
${b}

WALLET TYPE: Standard wallet (HMAC-based)

ENCRYPTION STATUS: Not encrypted
This key is in plaintext and not protected. Anyone with this file can access your wallet.`),v=`UNICITY WALLET DETAILS
===========================

${w}

YOUR ADDRESSES:
${E}

Generated on: ${new Date().toLocaleString()}

WARNING: Keep your master private key safe and secure.
Anyone with your master private key can access all your funds.`}return v}function downloadWalletFile(y,u="alpha_wallet_backup.txt"){const g=new Blob([y],{type:"text/plain"}),v=URL.createObjectURL(g),b=document.createElement("a");b.href=v;const w=u.endsWith(".txt")?u:u+".txt";b.download=w,document.body.appendChild(b),b.click(),setTimeout(()=>{document.body.removeChild(b),URL.revokeObjectURL(v)},100)}const JSON_WALLET_VERSION="1.0",JSON_WALLET_WARNING="Keep this file secure! Anyone with this data can access your funds.",PBKDF2_ITERATIONS=1e5,PBKDF2_SALT_PREFIX="unicity_wallet_json_";function generateSalt(){const y=new Uint8Array(16);return crypto.getRandomValues(y),PBKDF2_SALT_PREFIX+bytesToHex$5(y)}function deriveEncryptionKey(y,u){return CryptoJS.PBKDF2(y,u,{keySize:256/32,iterations:PBKDF2_ITERATIONS,hasher:CryptoJS.algo.SHA256}).toString()}function encryptWithPassword(y,u,g){const v=deriveEncryptionKey(u,g);return CryptoJS.AES.encrypt(y,v).toString()}function decryptWithPassword(y,u,g){try{const v=deriveEncryptionKey(u,g);return CryptoJS.AES.decrypt(y,v).toString(CryptoJS.enc.Utf8)||null}catch{return null}}function determineDerivationMode(y){return y.chainCode||y.masterChainCode?"bip32":"wif_hmac"}function determineSource(y,u,g){return u?"mnemonic":g==="dat"?y.descriptorPath?"dat_descriptor":y.isBIP32||y.chainCode||y.masterChainCode?"dat_hd":"dat_legacy":y.chainCode||y.masterChainCode?"file_bip32":"file_standard"}function generateAddressForExport(y,u,g,v,b){if(g==="bip32"&&u){const S=`m/${b||"44'/0'/0'"}/0/${v}`,A=deriveKeyAtPath(y,u,S),R=ec$3.keyFromPrivate(A.privateKey).getPublic(!0,"hex");return{address:publicKeyToAddress(R,"alpha",0),publicKey:R,path:S,index:v}}else{const E=`m/44'/0'/${v}'`,S=CryptoJS.enc.Hex.parse(y),$=CryptoJS.HmacSHA512(S,CryptoJS.enc.Utf8.parse(E)).toString().substring(0,64),T=ec$3.keyFromPrivate($).getPublic(!0,"hex");return{address:publicKeyToAddress(T,"alpha",0),publicKey:T,path:E,index:v}}}function exportWalletToJSON(y){const{wallet:u,mnemonic:g,importSource:v,options:b={}}=y,{password:w,includeAllAddresses:E=!1,addressCount:S=1}=b;if(!u||!u.masterPrivateKey)throw new Error("Invalid wallet - missing master private key");const A=u.chainCode||u.masterChainCode||void 0,$=determineDerivationMode(u),R=determineSource(u,g,v),T=generateAddressForExport(u.masterPrivateKey,A,$,0,u.descriptorPath),O={version:JSON_WALLET_VERSION,generated:new Date().toISOString(),warning:JSON_WALLET_WARNING,masterPrivateKey:u.masterPrivateKey,derivationMode:$,source:R,firstAddress:T};if(A&&(O.chainCode=A),g&&!w&&(O.mnemonic=g),u.descriptorPath&&(O.descriptorPath=u.descriptorPath),w){const B=generateSalt();O.encrypted={masterPrivateKey:encryptWithPassword(u.masterPrivateKey,w,B),salt:B,iterations:PBKDF2_ITERATIONS},g&&(O.encrypted.mnemonic=encryptWithPassword(g,w,B)),delete O.masterPrivateKey,delete O.mnemonic}if(E&&u.addresses.length>0)O.addresses=u.addresses.map((B,F)=>({address:B.address,publicKey:B.publicKey||"",path:B.path||`m/44'/0'/${F}'`,index:B.index,isChange:B.isChange}));else if(S>1){const B=[];for(let F=1;F<S;F++)B.push(generateAddressForExport(u.masterPrivateKey,A,$,F,u.descriptorPath));B.length>0&&(O.addresses=B)}return O}async function importWalletFromJSON(y,u){try{const g=JSON.parse(y);if(g.version!=="1.0")return{success:!1,error:`Unsupported wallet JSON version: ${g.version}. Expected 1.0`};let v,b;if(g.encrypted){if(!u)return{success:!1,error:"This wallet is encrypted. Please provide a password."};const $=decryptWithPassword(g.encrypted.masterPrivateKey,u,g.encrypted.salt);if(!$)return{success:!1,error:"Failed to decrypt wallet. The password may be incorrect."};if(v=$,g.encrypted.mnemonic){const R=decryptWithPassword(g.encrypted.mnemonic,u,g.encrypted.salt);R&&(b=R)}}else{if(!g.masterPrivateKey)return{success:!1,error:"Invalid wallet JSON - missing master private key"};v=g.masterPrivateKey,b=g.mnemonic}if(!isValidPrivateKey(v))return{success:!1,error:"Invalid master private key in wallet JSON"};const w=generateAddressForExport(v,g.chainCode,g.derivationMode,0,g.descriptorPath);if(w.address!==g.firstAddress.address)return{success:!1,error:`Wallet verification failed: derived address (${w.address}) does not match expected (${g.firstAddress.address})`};const E=g.derivationMode==="bip32",S=g.source.startsWith("dat_")||g.source==="file_bip32",A={masterPrivateKey:v,addresses:[],isEncrypted:!1,childPrivateKey:null,isBIP32:E,isImportedAlphaWallet:S};if(g.chainCode&&(A.chainCode=g.chainCode,A.masterChainCode=g.chainCode),g.descriptorPath&&(A.descriptorPath=g.descriptorPath),A.addresses.push({address:g.firstAddress.address,publicKey:g.firstAddress.publicKey,path:g.firstAddress.path,index:g.firstAddress.index??0,isChange:g.firstAddress.isChange,createdAt:new Date().toISOString()}),g.addresses)for(const $ of g.addresses)A.addresses.push({address:$.address,publicKey:$.publicKey,path:$.path,index:$.index??A.addresses.length,isChange:$.isChange,createdAt:new Date().toISOString()});return{success:!0,wallet:A,source:g.source,derivationMode:g.derivationMode,hasMnemonic:!!b,mnemonic:b,message:`Wallet imported successfully from JSON (source: ${g.source}, mode: ${g.derivationMode})`}}catch(g){return g instanceof SyntaxError?{success:!1,error:"Invalid JSON format. Please provide a valid wallet JSON file."}:{success:!1,error:`Error importing wallet: ${g instanceof Error?g.message:String(g)}`}}}function downloadWalletJSON(y,u="alpha_wallet_backup.json"){const g=JSON.stringify(y,null,2),v=new Blob([g],{type:"application/json"}),b=URL.createObjectURL(v),w=document.createElement("a");w.href=b;const E=u.endsWith(".json")?u:u+".json";w.download=E,document.body.appendChild(w),w.click(),setTimeout(()=>{document.body.removeChild(w),URL.revokeObjectURL(b)},100)}function isJSONWalletFormat(y){try{const u=JSON.parse(y);return u.version==="1.0"&&(u.masterPrivateKey||u.encrypted)}catch{return!1}}const ec$2=new elliptic.ec("secp256k1"),DEFAULT_BASE_PATH="m/44'/0'/0'";class UnifiedKeyManager{static instance=null;mnemonic=null;masterKey=null;chainCode=null;derivationMode="bip32";basePath=DEFAULT_BASE_PATH;source="unknown";sessionKey;isInitializing=!1;hasInitialized=!1;initializePromise=null;constructor(u){this.sessionKey=u}static getInstance(u){return UnifiedKeyManager.instance?UnifiedKeyManager.instance.sessionKey!==u&&(console.error("WARNING: UnifiedKeyManager session key mismatch detected!","This can cause data loss. Updating session key to maintain consistency."),UnifiedKeyManager.instance.sessionKey=u):UnifiedKeyManager.instance=new UnifiedKeyManager(u),UnifiedKeyManager.instance}async initialize(){if(this.hasInitialized)return this.masterKey!==null;if(this.isInitializing&&this.initializePromise)return this.initializePromise;this.isInitializing=!0,this.initializePromise=this.doInitialize();try{const u=await this.initializePromise;return this.hasInitialized=!0,u}finally{this.isInitializing=!1}}async doInitialize(){try{const u=localStorage.getItem(STORAGE_KEYS.UNIFIED_WALLET_MNEMONIC),g=localStorage.getItem(STORAGE_KEYS.UNIFIED_WALLET_MASTER),v=localStorage.getItem(STORAGE_KEYS.UNIFIED_WALLET_CHAINCODE),b=localStorage.getItem(STORAGE_KEYS.UNIFIED_WALLET_SOURCE),w=localStorage.getItem(STORAGE_KEYS.UNIFIED_WALLET_DERIVATION_MODE),E=localStorage.getItem(STORAGE_KEYS.UNIFIED_WALLET_BASE_PATH);if(console.log(" UnifiedKeyManager initializing...",{hasMnemonic:!!u,hasMaster:!!g,hasChainCode:!!v,source:b,derivationMode:w}),u){const S=this.decrypt(u);if(S)return await this.createFromMnemonic(S,!1),console.log(" Wallet initialized from mnemonic"),!0;console.error(" Failed to decrypt mnemonic - session key mismatch?")}else if(g){const S=this.decrypt(g);if(S)return this.masterKey=S,this.chainCode=v||null,this.source=b||"file",this.derivationMode=w||(v?"bip32":"wif_hmac"),this.basePath=E||DEFAULT_BASE_PATH,console.log(` Wallet initialized from file import (basePath: ${this.basePath})`),!0;console.error(" Failed to decrypt master key - session key mismatch?")}return console.log(" No wallet data found in storage"),!1}catch(u){return console.error("Failed to initialize UnifiedKeyManager:",u),!1}}async createFromMnemonic(u,g=!0){if(!srcExports.validateMnemonic(u))throw new Error("Invalid mnemonic phrase");const v=await srcExports.mnemonicToSeed(u),b=Buffer.from(v).toString("hex"),{masterPrivateKey:w,masterChainCode:E}=generateMasterKeyFromSeed(b);this.mnemonic=u,this.masterKey=w,this.chainCode=E,this.source="mnemonic",g&&this.saveToStorage(),console.log(" Unified wallet created from mnemonic")}async generateNew(u=12){const g=u===24?256:128,v=srcExports.generateMnemonic(g);return await this.createFromMnemonic(v),v}async importFromFileContent(u){const g=u.split(`
`).map(S=>S.trim());let v=null,b=null,w=!1,E=!1;for(const S of g){if(/MASTER\s*PRIVATE\s*KEY/i.test(S)&&!/[a-fA-F0-9]{64}/.test(S)){w=!0;continue}if(/MASTER\s*CHAIN\s*CODE/i.test(S)&&!/[a-fA-F0-9]{64}/.test(S)){E=!0;continue}if(w&&/^[a-fA-F0-9]{64}$/.test(S)){v=S.toLowerCase(),w=!1;continue}if(E&&/^[a-fA-F0-9]{64}$/.test(S)){b=S.toLowerCase(),E=!1;continue}const A=S.match(/(?:Master\s*(?:Private\s*)?Key|masterPriv)[:\s]+([a-fA-F0-9]{64})/i),$=S.match(/(?:Chain\s*Code|chainCode)[:\s]+([a-fA-F0-9]{64})/i);A&&(v=A[1].toLowerCase()),$&&(b=$[1].toLowerCase()),/^[a-fA-F0-9]{64}$/.test(S)||(w=!1,E=!1)}if(!v)throw new Error("Could not find master private key in file");try{ec$2.keyFromPrivate(v,"hex")}catch{throw new Error("Invalid master private key format")}localStorage.removeItem(STORAGE_KEYS.UNIFIED_WALLET_MNEMONIC),this.mnemonic=null,this.masterKey=v,this.chainCode=b,this.source="file",b?(this.derivationMode="bip32",console.log(" Unified wallet imported with BIP32 mode (chain code present)")):(this.derivationMode="wif_hmac",console.log(" Unified wallet imported with WIF HMAC mode (no chain code)")),this.hasInitialized=!0,this.saveToStorage()}async importFromFile(u){const g=await u.text();return this.importFromFileContent(g)}async importWithMode(u,g,v,b){try{ec$2.keyFromPrivate(u,"hex")}catch{throw new Error("Invalid master private key format")}this.mnemonic=null,this.masterKey=u,this.chainCode=g,this.derivationMode=v,this.basePath=b||DEFAULT_BASE_PATH,this.source="file",this.hasInitialized=!0,this.saveToStorage(),console.log(` Unified wallet imported with ${v} mode (basePath: ${this.basePath})`)}setDerivationMode(u){if((u==="bip32"||u==="legacy_hmac")&&!this.chainCode)throw new Error(`${u} mode requires chain code`);this.derivationMode=u,this.saveToStorage(),console.log(` Derivation mode changed to ${u}`)}deriveAddressFromPath(u){if(!this.masterKey)throw new Error("Wallet not initialized");let g,v;const b=u.match(/m\/(\d+)'\/(\d+)'\/(\d+)'\/(\d+)\/(\d+)/);if(b){const w=parseInt(b[4],10);g=parseInt(b[5],10),v=w===1}else{const w=u.match(/m\/(\d+)'\/(\d+)'\/(\d+)'/);if(w)g=parseInt(w[3],10),v=!1;else throw new Error(`Invalid BIP32 path: ${u}`)}if(this.derivationMode==="bip32"&&this.chainCode){const w=generateHDAddressBIP32(this.masterKey,this.chainCode,g,this.basePath,v);return{privateKey:w.privateKey,publicKey:w.publicKey,l1Address:w.address,index:w.index,path:w.path,isChange:v}}else if(this.derivationMode==="legacy_hmac"&&this.chainCode){const w=generateHDAddress(this.masterKey,this.chainCode,g);return{privateKey:w.privateKey,publicKey:w.publicKey,l1Address:w.address,index:w.index,path:w.path,isChange:v}}else{const w=generateAddressFromMasterKey(this.masterKey,g);return{privateKey:w.privateKey,publicKey:w.publicKey,l1Address:w.address,index:w.index,path:w.path,isChange:v}}}getDefaultAddressPath(){return`${this.basePath}/0/0`}deriveKeyAtPath(u){if(!this.masterKey||!this.chainCode)throw new Error("Wallet not initialized");return deriveKeyAtPath(this.masterKey,this.chainCode,u)}getMnemonic(){return this.mnemonic}getMasterKeyHex(){return this.masterKey}getChainCodeHex(){return this.chainCode}getBasePath(){return this.basePath}getWalletInfo(){let u=null;try{this.masterKey&&(u=this.deriveAddressFromPath(this.getDefaultAddressPath()).l1Address)}catch{}return{source:this.source,hasMnemonic:this.mnemonic!==null,hasChainCode:this.chainCode!==null,derivationMode:this.derivationMode,address0:u}}isInitialized(){return this.derivationMode==="bip32"||this.derivationMode==="legacy_hmac"?this.masterKey!==null&&this.chainCode!==null:this.masterKey!==null}getDerivationMode(){return this.derivationMode}exportToTxt(){if(!this.masterKey||!this.chainCode)throw new Error("Wallet not initialized");const u=this.deriveAddressFromPath(this.getDefaultAddressPath());let g=`# Alpha Wallet Export
`;return g+=`# Generated: ${new Date().toISOString()}
`,g+=`#
`,g+=`# WARNING: Keep this file secure! Anyone with this data can access your funds.
`,g+=`#

`,g+=`Master Private Key: ${this.masterKey}
`,g+=`Chain Code: ${this.chainCode}
`,g+=`
`,g+=`# First address (${this.getDefaultAddressPath()}):
`,g+=`Address: ${u.l1Address}
`,g+=`Public Key: ${u.publicKey}
`,this.mnemonic&&(g+=`
# Recovery Phrase (12 words):
`,g+=`Mnemonic: ${this.mnemonic}
`),g}exportToJSON(u={}){if(!this.masterKey)throw new Error("Wallet not initialized");const g=this.deriveAddressFromPath(this.getDefaultAddressPath()),v=[{address:g.l1Address,publicKey:g.publicKey,path:g.path,index:g.index}],b=u.addressCount||1;for(let E=1;E<b;E++){const S=`${this.basePath}/0/${E}`,A=this.deriveAddressFromPath(S);v.push({address:A.l1Address,publicKey:A.publicKey,path:A.path,index:A.index})}const w={masterPrivateKey:this.masterKey,chainCode:this.chainCode||void 0,masterChainCode:this.chainCode||void 0,addresses:v,isBIP32:this.derivationMode==="bip32",isImportedAlphaWallet:this.source==="file",descriptorPath:this.derivationMode==="bip32"?this.basePath.replace(/^m\//,""):null};return exportWalletToJSON({wallet:w,mnemonic:this.mnemonic||void 0,importSource:this.source==="file"?"file":void 0,options:u})}downloadJSON(u,g={}){const v=this.exportToJSON(g),b=this.mnemonic?"alpha_wallet_mnemonic_backup.json":"alpha_wallet_backup.json";downloadWalletJSON(v,u||b)}async importFromJSON(u,g){const v=await importWalletFromJSON(u,g);if(!v.success||!v.wallet)return{success:!1,error:v.error};if(v.mnemonic)try{return await this.createFromMnemonic(v.mnemonic),console.log(" Wallet restored from JSON with mnemonic"),{success:!0,mnemonic:v.mnemonic}}catch(S){return{success:!1,error:`Failed to restore from mnemonic: ${S instanceof Error?S.message:String(S)}`}}const b=v.wallet.chainCode||v.wallet.masterChainCode||null,w=v.derivationMode||(b?"bip32":"wif_hmac"),E=v.wallet.descriptorPath?`m/${v.wallet.descriptorPath}`:void 0;return await this.importWithMode(v.wallet.masterPrivateKey,b,w,E),console.log(` Wallet restored from JSON (source: ${v.source}, mode: ${w}, basePath: ${E||DEFAULT_BASE_PATH})`),{success:!0}}clear(){this.mnemonic=null,this.masterKey=null,this.chainCode=null,this.derivationMode="bip32",this.basePath=DEFAULT_BASE_PATH,this.source="unknown",this.hasInitialized=!1,this.isInitializing=!1,this.initializePromise=null,localStorage.removeItem(STORAGE_KEYS.UNIFIED_WALLET_MNEMONIC),localStorage.removeItem(STORAGE_KEYS.UNIFIED_WALLET_MASTER),localStorage.removeItem(STORAGE_KEYS.UNIFIED_WALLET_CHAINCODE),localStorage.removeItem(STORAGE_KEYS.UNIFIED_WALLET_SOURCE),localStorage.removeItem(STORAGE_KEYS.UNIFIED_WALLET_DERIVATION_MODE),localStorage.removeItem(STORAGE_KEYS.UNIFIED_WALLET_BASE_PATH),console.log(" Unified wallet cleared")}static resetInstance(){UnifiedKeyManager.instance=null,console.log(" UnifiedKeyManager instance reset")}static clearAll(){console.log(" Clearing all wallet data..."),clearAllSphereData(),UnifiedKeyManager.instance&&(UnifiedKeyManager.instance.mnemonic=null,UnifiedKeyManager.instance.masterKey=null,UnifiedKeyManager.instance.chainCode=null,UnifiedKeyManager.instance.derivationMode="bip32",UnifiedKeyManager.instance.basePath=DEFAULT_BASE_PATH,UnifiedKeyManager.instance.source="unknown",UnifiedKeyManager.instance.hasInitialized=!1,UnifiedKeyManager.instance.isInitializing=!1,UnifiedKeyManager.instance.initializePromise=null),UnifiedKeyManager.instance=null,console.log(" All wallet data cleared")}saveToStorage(){if(this.mnemonic){const u=this.encrypt(this.mnemonic);localStorage.setItem(STORAGE_KEYS.UNIFIED_WALLET_MNEMONIC,u)}else if(this.masterKey){const u=this.encrypt(this.masterKey);localStorage.setItem(STORAGE_KEYS.UNIFIED_WALLET_MASTER,u)}this.chainCode?localStorage.setItem(STORAGE_KEYS.UNIFIED_WALLET_CHAINCODE,this.chainCode):localStorage.removeItem(STORAGE_KEYS.UNIFIED_WALLET_CHAINCODE),localStorage.setItem(STORAGE_KEYS.UNIFIED_WALLET_SOURCE,this.source),localStorage.setItem(STORAGE_KEYS.UNIFIED_WALLET_DERIVATION_MODE,this.derivationMode),localStorage.setItem(STORAGE_KEYS.UNIFIED_WALLET_BASE_PATH,this.basePath)}encrypt(u){return CryptoJS.AES.encrypt(u,this.sessionKey).toString()}decrypt(u){try{const v=CryptoJS.AES.decrypt(u,this.sessionKey).toString(CryptoJS.enc.Utf8);return v||(console.error("Decryption failed: empty result. Possible session key mismatch."),null)}catch(g){return console.error("Decryption error:",g),null}}}const UNICITY_TOKEN_TYPE_HEX$1="f8aa13834268d29355ff12183066f0cb902003629bbc5eb9ef0efbe397867509",DEFAULT_SESSION_KEY="user-pin-1234";class IdentityManager{static instance;sessionKey;constructor(u){this.sessionKey=u}static getInstance(u=DEFAULT_SESSION_KEY){return IdentityManager.instance||(IdentityManager.instance=new IdentityManager(u)),IdentityManager.instance}getUnifiedKeyManager(){return UnifiedKeyManager.getInstance(this.sessionKey)}getSelectedAddressPath(){return localStorage.getItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH)}setSelectedAddressPath(u){localStorage.setItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH,u),localStorage.removeItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_INDEX_LEGACY)}clearSelectedAddressPath(){localStorage.removeItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH),localStorage.removeItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_INDEX_LEGACY)}async generateNewIdentity(){const u=this.getUnifiedKeyManager(),g=await u.generateNew(12),b=`${u.getBasePath()}/0/0`,w=await this.deriveIdentityFromPath(b);return g&&this.saveSeed(g),{...w,mnemonic:g}}async deriveIdentityFromPath(u){const g=this.getUnifiedKeyManager();if(!g.isInitialized())throw new Error("Unified wallet not initialized");const v=g.deriveAddressFromPath(u),b=Buffer.from(v.privateKey,"hex"),w=await this.deriveL3Address(b),E=await SigningService.createFromSecret(b),S=Buffer.from(E.publicKey).toString("hex"),A=u.match(/\/(\d+)$/),$=A?parseInt(A[1],10):0;return{privateKey:v.privateKey,publicKey:S,address:w,mnemonic:g.getMnemonic()||void 0,l1Address:v.l1Address,addressIndex:$}}async deriveIdentityFromPrivateKey(u){const g=Buffer.from(u,"hex"),v=await this.deriveL3Address(g),b=await SigningService.createFromSecret(g),w=Buffer.from(b.publicKey).toString("hex");return{privateKey:u,publicKey:w,address:v}}async deriveIdentityFromMnemonic(u){if(!srcExports.validateMnemonic(u))throw new Error("Invalid recovery phrase. Please check your words and try again.");const v=this.getUnifiedKeyManager();await v.createFromMnemonic(u);const w=`${v.getBasePath()}/0/0`,E=await this.deriveIdentityFromPath(w);return this.saveSeed(u),{...E,mnemonic:u}}async deriveL3Address(u){try{const g=await SigningService.createFromSecret(u),v=Buffer.from(UNICITY_TOKEN_TYPE_HEX$1,"hex"),b=new TokenType(v);return(await(await UnmaskedPredicateReference.create(b,g.algorithm,g.publicKey,HashAlgorithm.SHA256)).toAddress()).toString()}catch(g){throw console.error("Error deriving address",g),g}}saveSeed(u){const g=CryptoJS.AES.encrypt(u,this.sessionKey).toString();localStorage.setItem(STORAGE_KEYS.ENCRYPTED_SEED,g)}async getCurrentIdentity(){const u=this.getUnifiedKeyManager();if(await u.initialize()){const v=this.getSelectedAddressPath();if(v)return this.deriveIdentityFromPath(v);const w=`${u.getBasePath()}/0/0`;return this.deriveIdentityFromPath(w)}return null}async getL1Address(){return(await this.getCurrentIdentity())?.l1Address||null}async getWalletAddress(){const u=await this.getCurrentIdentity();if(!u)return null;try{const g=Buffer.from(u.privateKey,"hex"),v=await SigningService.createFromSecret(g),b=v.publicKey,w=new TokenType(Buffer.from(UNICITY_TOKEN_TYPE_HEX$1,"hex"));return(await UnmaskedPredicateReference.create(w,v.algorithm,b,HashAlgorithm.SHA256)).toAddress()}catch(g){return console.error("Failed to derive wallet address",g),null}}}const IdentityManager$1=Object.freeze(Object.defineProperty({__proto__:null,IdentityManager},Symbol.toStringTag,{value:"Module"})),crypto$1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function isBytes$1$1(y){return y instanceof Uint8Array||ArrayBuffer.isView(y)&&y.constructor.name==="Uint8Array"}function anumber$1$1(y){if(!Number.isSafeInteger(y)||y<0)throw new Error("positive integer expected, got "+y)}function abytes$1$1(y,...u){if(!isBytes$1$1(y))throw new Error("Uint8Array expected");if(u.length>0&&!u.includes(y.length))throw new Error("Uint8Array expected of length "+u+", got length="+y.length)}function ahash$4(y){if(typeof y!="function"||typeof y.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");anumber$1$1(y.outputLen),anumber$1$1(y.blockLen)}function aexists$1$1(y,u=!0){if(y.destroyed)throw new Error("Hash instance has been destroyed");if(u&&y.finished)throw new Error("Hash#digest() has already been called")}function aoutput$1$1(y,u){abytes$1$1(y);const g=u.outputLen;if(y.length<g)throw new Error("digestInto() expects output buffer of length at least "+g)}function clean$1$1(...y){for(let u=0;u<y.length;u++)y[u].fill(0)}function createView$1$1(y){return new DataView(y.buffer,y.byteOffset,y.byteLength)}function rotr$3(y,u){return y<<32-u|y>>>u}const hasHexBuiltin$2=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes$2=Array.from({length:256},(y,u)=>u.toString(16).padStart(2,"0"));function bytesToHex$4(y){if(abytes$1$1(y),hasHexBuiltin$2)return y.toHex();let u="";for(let g=0;g<y.length;g++)u+=hexes$2[y[g]];return u}const asciis$2={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$2(y){if(y>=asciis$2._0&&y<=asciis$2._9)return y-asciis$2._0;if(y>=asciis$2.A&&y<=asciis$2.F)return y-(asciis$2.A-10);if(y>=asciis$2.a&&y<=asciis$2.f)return y-(asciis$2.a-10)}function hexToBytes$4(y){if(typeof y!="string")throw new Error("hex string expected, got "+typeof y);if(hasHexBuiltin$2)return Uint8Array.fromHex(y);const u=y.length,g=u/2;if(u%2)throw new Error("hex string expected, got unpadded hex of length "+u);const v=new Uint8Array(g);for(let b=0,w=0;b<g;b++,w+=2){const E=asciiToBase16$2(y.charCodeAt(w)),S=asciiToBase16$2(y.charCodeAt(w+1));if(E===void 0||S===void 0){const A=y[w]+y[w+1];throw new Error('hex string expected, got non-hex character "'+A+'" at index '+w)}v[b]=E*16+S}return v}function utf8ToBytes$1$1(y){if(typeof y!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(y))}function toBytes$1$1(y){return typeof y=="string"&&(y=utf8ToBytes$1$1(y)),abytes$1$1(y),y}function concatBytes$2(...y){let u=0;for(let v=0;v<y.length;v++){const b=y[v];abytes$1$1(b),u+=b.length}const g=new Uint8Array(u);for(let v=0,b=0;v<y.length;v++){const w=y[v];g.set(w,b),b+=w.length}return g}let Hash$1=class{};function createHasher$4(y){const u=v=>y().update(toBytes$1$1(v)).digest(),g=y();return u.outputLen=g.outputLen,u.blockLen=g.blockLen,u.create=()=>y(),u}function randomBytes$3(y=32){if(crypto$1&&typeof crypto$1.getRandomValues=="function")return crypto$1.getRandomValues(new Uint8Array(y));if(crypto$1&&typeof crypto$1.randomBytes=="function")return Uint8Array.from(crypto$1.randomBytes(y));throw new Error("crypto.getRandomValues must be defined")}var utils=Object.freeze({__proto__:null,Hash:Hash$1,abytes:abytes$1$1,aexists:aexists$1$1,ahash:ahash$4,anumber:anumber$1$1,aoutput:aoutput$1$1,bytesToHex:bytesToHex$4,clean:clean$1$1,concatBytes:concatBytes$2,createHasher:createHasher$4,createView:createView$1$1,hexToBytes:hexToBytes$4,isBytes:isBytes$1$1,randomBytes:randomBytes$3,rotr:rotr$3,toBytes:toBytes$1$1,utf8ToBytes:utf8ToBytes$1$1});const CHARSET="qpzry9x8gf2tvdw0s3jn54khce6mua7l",GENERATOR=[996825010,642813549,513874426,1027748829,705979059];function polymod(y){let u=1;for(const g of y){const v=u>>25;u=(u&33554431)<<5^g;for(let b=0;b<5;b++)v>>b&1&&(u^=GENERATOR[b])}return u}function hrpExpand(y){const u=[];for(let g=0;g<y.length;g++)u.push(y.charCodeAt(g)>>5);u.push(0);for(let g=0;g<y.length;g++)u.push(y.charCodeAt(g)&31);return u}function verifyChecksum(y,u){return polymod(hrpExpand(y).concat(u))===1}function createChecksum(y,u){const g=hrpExpand(y).concat(u).concat([0,0,0,0,0,0]),v=polymod(g)^1,b=[];for(let w=0;w<6;w++)b.push(v>>5*(5-w)&31);return b}function convertBits(y,u,g,v){let b=0,w=0;const E=[],S=(1<<g)-1;for(const A of y){if(A<0||A>>u!==0)return null;for(b=b<<u|A,w+=u;w>=g;)w-=g,E.push(b>>w&S)}if(v)w>0&&E.push(b<<g-w&S);else if(w>=u||(b<<g-w&S)!==0)return null;return E}function encode$g(y,u){const g=convertBits(Array.from(u),8,5,!0);if(g===null)throw new Error("Failed to convert bits for Bech32 encoding");const v=createChecksum(y,g),b=g.concat(v);let w=y+"1";for(const E of b)w+=CHARSET.charAt(E);return w}function decode$f(y){const u=y.toLowerCase(),g=u.lastIndexOf("1");if(g<1||g+7>u.length||u.length>90)throw new Error("Invalid Bech32 string");const v=u.slice(0,g),b=u.slice(g+1),w=[];for(const A of b){const $=CHARSET.indexOf(A);if($===-1)throw new Error(`Invalid character '${A}' in Bech32 string`);w.push($)}if(!verifyChecksum(v,w))throw new Error("Invalid Bech32 checksum");const E=w.slice(0,-6),S=convertBits(E,5,8,!1);if(S===null)throw new Error("Failed to convert bits in Bech32 decoding");return{hrp:v,data:new Uint8Array(S)}}function encodeNpub(y){if(y.length!==32)throw new Error("Public key must be 32 bytes");return encode$g("npub",y)}function encodeNsec(y){if(y.length!==32)throw new Error("Private key must be 32 bytes");return encode$g("nsec",y)}function decodeNsec(y){const u=decode$f(y);if(u.hrp!=="nsec")throw new Error(`Expected 'nsec' prefix, got '${u.hrp}'`);if(u.data.length!==32)throw new Error(`Expected 32 bytes, got ${u.data.length}`);return u.data}function setBigUint64$1(y,u,g,v){if(typeof y.setBigUint64=="function")return y.setBigUint64(u,g,v);const b=BigInt(32),w=BigInt(4294967295),E=Number(g>>b&w),S=Number(g&w),A=v?4:0,$=v?0:4;y.setUint32(u+A,E,v),y.setUint32(u+$,S,v)}function Chi$3(y,u,g){return y&u^~y&g}function Maj$3(y,u,g){return y&u^y&g^u&g}let HashMD$4=class extends Hash$1{constructor(u,g,v,b){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=u,this.outputLen=g,this.padOffset=v,this.isLE=b,this.buffer=new Uint8Array(u),this.view=createView$1$1(this.buffer)}update(u){aexists$1$1(this),u=toBytes$1$1(u),abytes$1$1(u);const{view:g,buffer:v,blockLen:b}=this,w=u.length;for(let E=0;E<w;){const S=Math.min(b-this.pos,w-E);if(S===b){const A=createView$1$1(u);for(;b<=w-E;E+=b)this.process(A,E);continue}v.set(u.subarray(E,E+S),this.pos),this.pos+=S,E+=S,this.pos===b&&(this.process(g,0),this.pos=0)}return this.length+=u.length,this.roundClean(),this}digestInto(u){aexists$1$1(this),aoutput$1$1(u,this),this.finished=!0;const{buffer:g,view:v,blockLen:b,isLE:w}=this;let{pos:E}=this;g[E++]=128,clean$1$1(this.buffer.subarray(E)),this.padOffset>b-E&&(this.process(v,0),E=0);for(let T=E;T<b;T++)g[T]=0;setBigUint64$1(v,b-8,BigInt(this.length*8),w),this.process(v,0);const S=createView$1$1(u),A=this.outputLen;if(A%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const $=A/4,R=this.get();if($>R.length)throw new Error("_sha2: outputLen bigger than state");for(let T=0;T<$;T++)S.setUint32(4*T,R[T],w)}digest(){const{buffer:u,outputLen:g}=this;this.digestInto(u);const v=u.slice(0,g);return this.destroy(),v}_cloneInto(u){u||(u=new this.constructor),u.set(...this.get());const{blockLen:g,buffer:v,length:b,finished:w,destroyed:E,pos:S}=this;return u.destroyed=E,u.finished=w,u.length=b,u.pos=S,b%g&&u.buffer.set(v),u}clone(){return this._cloneInto()}};const SHA256_IV$3=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_K$3=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W$3=new Uint32Array(64);let SHA256$1=class extends HashMD$4{constructor(u=32){super(64,u,8,!1),this.A=SHA256_IV$3[0]|0,this.B=SHA256_IV$3[1]|0,this.C=SHA256_IV$3[2]|0,this.D=SHA256_IV$3[3]|0,this.E=SHA256_IV$3[4]|0,this.F=SHA256_IV$3[5]|0,this.G=SHA256_IV$3[6]|0,this.H=SHA256_IV$3[7]|0}get(){const{A:u,B:g,C:v,D:b,E:w,F:E,G:S,H:A}=this;return[u,g,v,b,w,E,S,A]}set(u,g,v,b,w,E,S,A){this.A=u|0,this.B=g|0,this.C=v|0,this.D=b|0,this.E=w|0,this.F=E|0,this.G=S|0,this.H=A|0}process(u,g){for(let T=0;T<16;T++,g+=4)SHA256_W$3[T]=u.getUint32(g,!1);for(let T=16;T<64;T++){const O=SHA256_W$3[T-15],B=SHA256_W$3[T-2],F=rotr$3(O,7)^rotr$3(O,18)^O>>>3,U=rotr$3(B,17)^rotr$3(B,19)^B>>>10;SHA256_W$3[T]=U+SHA256_W$3[T-7]+F+SHA256_W$3[T-16]|0}let{A:v,B:b,C:w,D:E,E:S,F:A,G:$,H:R}=this;for(let T=0;T<64;T++){const O=rotr$3(S,6)^rotr$3(S,11)^rotr$3(S,25),B=R+O+Chi$3(S,A,$)+SHA256_K$3[T]+SHA256_W$3[T]|0,U=(rotr$3(v,2)^rotr$3(v,13)^rotr$3(v,22))+Maj$3(v,b,w)|0;R=$,$=A,A=S,S=E+B|0,E=w,w=b,b=v,v=B+U|0}v=v+this.A|0,b=b+this.B|0,w=w+this.C|0,E=E+this.D|0,S=S+this.E|0,A=A+this.F|0,$=$+this.G|0,R=R+this.H|0,this.set(v,b,w,E,S,A,$,R)}roundClean(){clean$1$1(SHA256_W$3)}destroy(){this.set(0,0,0,0,0,0,0,0),clean$1$1(this.buffer)}};const sha256$1$1=createHasher$4(()=>new SHA256$1);let HMAC$1=class extends Hash$1{constructor(u,g){super(),this.finished=!1,this.destroyed=!1,ahash$4(u);const v=toBytes$1$1(g);if(this.iHash=u.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const b=this.blockLen,w=new Uint8Array(b);w.set(v.length>b?u.create().update(v).digest():v);for(let E=0;E<w.length;E++)w[E]^=54;this.iHash.update(w),this.oHash=u.create();for(let E=0;E<w.length;E++)w[E]^=106;this.oHash.update(w),clean$1$1(w)}update(u){return aexists$1$1(this),this.iHash.update(u),this}digestInto(u){aexists$1$1(this),abytes$1$1(u,this.outputLen),this.finished=!0,this.iHash.digestInto(u),this.oHash.update(u),this.oHash.digestInto(u),this.destroy()}digest(){const u=new Uint8Array(this.oHash.outputLen);return this.digestInto(u),u}_cloneInto(u){u||(u=Object.create(Object.getPrototypeOf(this),{}));const{oHash:g,iHash:v,finished:b,destroyed:w,blockLen:E,outputLen:S}=this;return u=u,u.finished=b,u.destroyed=w,u.blockLen=E,u.outputLen=S,u.oHash=g._cloneInto(u.oHash),u.iHash=v._cloneInto(u.iHash),u}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$4=(y,u,g)=>new HMAC$1(y,u).update(g).digest();hmac$4.create=(y,u)=>new HMAC$1(y,u);const _0n$4$1=BigInt(0),_1n$4$1=BigInt(1);function _abool2(y,u=""){if(typeof y!="boolean"){const g=u&&`"${u}"`;throw new Error(g+"expected boolean, got type="+typeof y)}return y}function _abytes2(y,u,g=""){const v=isBytes$1$1(y),b=y?.length,w=u!==void 0;if(!v||w&&b!==u){const E=g&&`"${g}" `,S=w?` of length ${u}`:"",A=v?`length=${b}`:`type=${typeof y}`;throw new Error(E+"expected Uint8Array"+S+", got "+A)}return y}function numberToHexUnpadded$1(y){const u=y.toString(16);return u.length&1?"0"+u:u}function hexToNumber$2(y){if(typeof y!="string")throw new Error("hex string expected, got "+typeof y);return y===""?_0n$4$1:BigInt("0x"+y)}function bytesToNumberBE$1(y){return hexToNumber$2(bytesToHex$4(y))}function bytesToNumberLE$2(y){return abytes$1$1(y),hexToNumber$2(bytesToHex$4(Uint8Array.from(y).reverse()))}function numberToBytesBE$2(y,u){return hexToBytes$4(y.toString(16).padStart(u*2,"0"))}function numberToBytesLE$2(y,u){return numberToBytesBE$2(y,u).reverse()}function ensureBytes(y,u,g){let v;if(typeof u=="string")try{v=hexToBytes$4(u)}catch(w){throw new Error(y+" must be hex string or Uint8Array, cause: "+w)}else if(isBytes$1$1(u))v=Uint8Array.from(u);else throw new Error(y+" must be hex string or Uint8Array");const b=v.length;if(typeof g=="number"&&b!==g)throw new Error(y+" of length "+g+" expected, got "+b);return v}const isPosBig$2=y=>typeof y=="bigint"&&_0n$4$1<=y;function inRange$2(y,u,g){return isPosBig$2(y)&&isPosBig$2(u)&&isPosBig$2(g)&&u<=y&&y<g}function aInRange$2(y,u,g,v){if(!inRange$2(u,g,v))throw new Error("expected valid "+y+": "+g+" <= n < "+v+", got "+u)}function bitLen$1(y){let u;for(u=0;y>_0n$4$1;y>>=_1n$4$1,u+=1);return u}const bitMask$1=y=>(_1n$4$1<<BigInt(y))-_1n$4$1;function createHmacDrbg$1(y,u,g){if(typeof y!="number"||y<2)throw new Error("hashLen must be a number");if(typeof u!="number"||u<2)throw new Error("qByteLen must be a number");if(typeof g!="function")throw new Error("hmacFn must be a function");const v=B=>new Uint8Array(B),b=B=>Uint8Array.of(B);let w=v(y),E=v(y),S=0;const A=()=>{w.fill(1),E.fill(0),S=0},$=(...B)=>g(E,w,...B),R=(B=v(0))=>{E=$(b(0),B),w=$(),B.length!==0&&(E=$(b(1),B),w=$())},T=()=>{if(S++>=1e3)throw new Error("drbg: tried 1000 values");let B=0;const F=[];for(;B<u;){w=$();const U=w.slice();F.push(U),B+=w.length}return concatBytes$2(...F)};return(B,F)=>{A(),R(B);let U;for(;!(U=F(T()));)R();return A(),U}}function _validateObject(y,u,g={}){if(!y||typeof y!="object")throw new Error("expected valid options object");function v(b,w,E){const S=y[b];if(E&&S===void 0)return;const A=typeof S;if(A!==w||S===null)throw new Error(`param "${b}" is invalid: expected ${w}, got ${A}`)}Object.entries(u).forEach(([b,w])=>v(b,w,!1)),Object.entries(g).forEach(([b,w])=>v(b,w,!0))}function memoized$1(y){const u=new WeakMap;return(g,...v)=>{const b=u.get(g);if(b!==void 0)return b;const w=y(g,...v);return u.set(g,w),w}}const _0n$3$1=BigInt(0),_1n$3$1=BigInt(1),_2n$2$1=BigInt(2),_3n$1$1=BigInt(3),_4n$1$1=BigInt(4),_5n$3=BigInt(5),_7n$1=BigInt(7),_8n$3=BigInt(8),_9n$1=BigInt(9),_16n$1=BigInt(16);function mod$2(y,u){const g=y%u;return g>=_0n$3$1?g:u+g}function pow2$3(y,u,g){let v=y;for(;u-- >_0n$3$1;)v*=v,v%=g;return v}function invert$2(y,u){if(y===_0n$3$1)throw new Error("invert: expected non-zero number");if(u<=_0n$3$1)throw new Error("invert: expected positive modulus, got "+u);let g=mod$2(y,u),v=u,b=_0n$3$1,w=_1n$3$1;for(;g!==_0n$3$1;){const S=v/g,A=v%g,$=b-w*S;v=g,g=A,b=w,w=$}if(v!==_1n$3$1)throw new Error("invert: does not exist");return mod$2(b,u)}function assertIsSquare$1(y,u,g){if(!y.eql(y.sqr(u),g))throw new Error("Cannot find square root")}function sqrt3mod4$1(y,u){const g=(y.ORDER+_1n$3$1)/_4n$1$1,v=y.pow(u,g);return assertIsSquare$1(y,v,u),v}function sqrt5mod8$1(y,u){const g=(y.ORDER-_5n$3)/_8n$3,v=y.mul(u,_2n$2$1),b=y.pow(v,g),w=y.mul(u,b),E=y.mul(y.mul(w,_2n$2$1),b),S=y.mul(w,y.sub(E,y.ONE));return assertIsSquare$1(y,S,u),S}function sqrt9mod16$1(y){const u=Field$1(y),g=tonelliShanks$1(y),v=g(u,u.neg(u.ONE)),b=g(u,v),w=g(u,u.neg(v)),E=(y+_7n$1)/_16n$1;return(S,A)=>{let $=S.pow(A,E),R=S.mul($,v);const T=S.mul($,b),O=S.mul($,w),B=S.eql(S.sqr(R),A),F=S.eql(S.sqr(T),A);$=S.cmov($,R,B),R=S.cmov(O,T,F);const U=S.eql(S.sqr(R),A),q=S.cmov($,R,U);return assertIsSquare$1(S,q,A),q}}function tonelliShanks$1(y){if(y<_3n$1$1)throw new Error("sqrt is not defined for small field");let u=y-_1n$3$1,g=0;for(;u%_2n$2$1===_0n$3$1;)u/=_2n$2$1,g++;let v=_2n$2$1;const b=Field$1(y);for(;FpLegendre$1(b,v)===1;)if(v++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(g===1)return sqrt3mod4$1;let w=b.pow(v,u);const E=(u+_1n$3$1)/_2n$2$1;return function(A,$){if(A.is0($))return $;if(FpLegendre$1(A,$)!==1)throw new Error("Cannot find square root");let R=g,T=A.mul(A.ONE,w),O=A.pow($,u),B=A.pow($,E);for(;!A.eql(O,A.ONE);){if(A.is0(O))return A.ZERO;let F=1,U=A.sqr(O);for(;!A.eql(U,A.ONE);)if(F++,U=A.sqr(U),F===R)throw new Error("Cannot find square root");const q=_1n$3$1<<BigInt(R-F-1),J=A.pow(T,q);R=F,T=A.sqr(J),O=A.mul(O,T),B=A.mul(B,J)}return B}}function FpSqrt$1(y){return y%_4n$1$1===_3n$1$1?sqrt3mod4$1:y%_8n$3===_5n$3?sqrt5mod8$1:y%_16n$1===_9n$1?sqrt9mod16$1(y):tonelliShanks$1(y)}const FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1(y){const u={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},g=FIELD_FIELDS$1.reduce((v,b)=>(v[b]="function",v),u);return _validateObject(y,g),y}function FpPow$1(y,u,g){if(g<_0n$3$1)throw new Error("invalid exponent, negatives unsupported");if(g===_0n$3$1)return y.ONE;if(g===_1n$3$1)return u;let v=y.ONE,b=u;for(;g>_0n$3$1;)g&_1n$3$1&&(v=y.mul(v,b)),b=y.sqr(b),g>>=_1n$3$1;return v}function FpInvertBatch$1(y,u,g=!1){const v=new Array(u.length).fill(g?y.ZERO:void 0),b=u.reduce((E,S,A)=>y.is0(S)?E:(v[A]=E,y.mul(E,S)),y.ONE),w=y.inv(b);return u.reduceRight((E,S,A)=>y.is0(S)?E:(v[A]=y.mul(E,v[A]),y.mul(E,S)),w),v}function FpLegendre$1(y,u){const g=(y.ORDER-_1n$3$1)/_2n$2$1,v=y.pow(u,g),b=y.eql(v,y.ONE),w=y.eql(v,y.ZERO),E=y.eql(v,y.neg(y.ONE));if(!b&&!w&&!E)throw new Error("invalid Legendre symbol result");return b?1:w?0:-1}function nLength$1(y,u){u!==void 0&&anumber$1$1(u);const g=u!==void 0?u:y.toString(2).length,v=Math.ceil(g/8);return{nBitLength:g,nByteLength:v}}function Field$1(y,u,g=!1,v={}){if(y<=_0n$3$1)throw new Error("invalid field: expected ORDER > 0, got "+y);let b,w,E=!1,S;if(typeof u=="object"&&u!=null){if(v.sqrt||g)throw new Error("cannot specify opts in two arguments");const O=u;O.BITS&&(b=O.BITS),O.sqrt&&(w=O.sqrt),typeof O.isLE=="boolean"&&(g=O.isLE),typeof O.modFromBytes=="boolean"&&(E=O.modFromBytes),S=O.allowedLengths}else typeof u=="number"&&(b=u),v.sqrt&&(w=v.sqrt);const{nBitLength:A,nByteLength:$}=nLength$1(y,b);if($>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let R;const T=Object.freeze({ORDER:y,isLE:g,BITS:A,BYTES:$,MASK:bitMask$1(A),ZERO:_0n$3$1,ONE:_1n$3$1,allowedLengths:S,create:O=>mod$2(O,y),isValid:O=>{if(typeof O!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof O);return _0n$3$1<=O&&O<y},is0:O=>O===_0n$3$1,isValidNot0:O=>!T.is0(O)&&T.isValid(O),isOdd:O=>(O&_1n$3$1)===_1n$3$1,neg:O=>mod$2(-O,y),eql:(O,B)=>O===B,sqr:O=>mod$2(O*O,y),add:(O,B)=>mod$2(O+B,y),sub:(O,B)=>mod$2(O-B,y),mul:(O,B)=>mod$2(O*B,y),pow:(O,B)=>FpPow$1(T,O,B),div:(O,B)=>mod$2(O*invert$2(B,y),y),sqrN:O=>O*O,addN:(O,B)=>O+B,subN:(O,B)=>O-B,mulN:(O,B)=>O*B,inv:O=>invert$2(O,y),sqrt:w||(O=>(R||(R=FpSqrt$1(y)),R(T,O))),toBytes:O=>g?numberToBytesLE$2(O,$):numberToBytesBE$2(O,$),fromBytes:(O,B=!0)=>{if(S){if(!S.includes(O.length)||O.length>$)throw new Error("Field.fromBytes: expected "+S+" bytes, got "+O.length);const U=new Uint8Array($);U.set(O,g?0:U.length-O.length),O=U}if(O.length!==$)throw new Error("Field.fromBytes: expected "+$+" bytes, got "+O.length);let F=g?bytesToNumberLE$2(O):bytesToNumberBE$1(O);if(E&&(F=mod$2(F,y)),!B&&!T.isValid(F))throw new Error("invalid field element: outside of range 0..ORDER");return F},invertBatch:O=>FpInvertBatch$1(T,O),cmov:(O,B,F)=>F?B:O});return Object.freeze(T)}function getFieldBytesLength$1(y){if(typeof y!="bigint")throw new Error("field order must be bigint");const u=y.toString(2).length;return Math.ceil(u/8)}function getMinHashLength$1(y){const u=getFieldBytesLength$1(y);return u+Math.ceil(u/2)}function mapHashToField$1(y,u,g=!1){const v=y.length,b=getFieldBytesLength$1(u),w=getMinHashLength$1(u);if(v<16||v<w||v>1024)throw new Error("expected "+w+"-1024 bytes of input, got "+v);const E=g?bytesToNumberLE$2(y):bytesToNumberBE$1(y),S=mod$2(E,u-_1n$3$1)+_1n$3$1;return g?numberToBytesLE$2(S,b):numberToBytesBE$2(S,b)}const _0n$2$1=BigInt(0),_1n$2$1=BigInt(1);function negateCt$1(y,u){const g=u.negate();return y?g:u}function normalizeZ$1(y,u){const g=FpInvertBatch$1(y.Fp,u.map(v=>v.Z));return u.map((v,b)=>y.fromAffine(v.toAffine(g[b])))}function validateW$1(y,u){if(!Number.isSafeInteger(y)||y<=0||y>u)throw new Error("invalid window size, expected [1.."+u+"], got W="+y)}function calcWOpts$1(y,u){validateW$1(y,u);const g=Math.ceil(u/y)+1,v=2**(y-1),b=2**y,w=bitMask$1(y),E=BigInt(y);return{windows:g,windowSize:v,mask:w,maxNumber:b,shiftBy:E}}function calcOffsets$1(y,u,g){const{windowSize:v,mask:b,maxNumber:w,shiftBy:E}=g;let S=Number(y&b),A=y>>E;S>v&&(S-=w,A+=_1n$2$1);const $=u*v,R=$+Math.abs(S)-1,T=S===0,O=S<0,B=u%2!==0;return{nextN:A,offset:R,isZero:T,isNeg:O,isNegF:B,offsetF:$}}function validateMSMPoints(y,u){if(!Array.isArray(y))throw new Error("array expected");y.forEach((g,v)=>{if(!(g instanceof u))throw new Error("invalid point at index "+v)})}function validateMSMScalars(y,u){if(!Array.isArray(y))throw new Error("array of scalars expected");y.forEach((g,v)=>{if(!u.isValid(g))throw new Error("invalid scalar at index "+v)})}const pointPrecomputes$1=new WeakMap,pointWindowSizes$1=new WeakMap;function getW$1(y){return pointWindowSizes$1.get(y)||1}function assert0$1(y){if(y!==_0n$2$1)throw new Error("invalid wNAF")}let wNAF$2=class{constructor(u,g){this.BASE=u.BASE,this.ZERO=u.ZERO,this.Fn=u.Fn,this.bits=g}_unsafeLadder(u,g,v=this.ZERO){let b=u;for(;g>_0n$2$1;)g&_1n$2$1&&(v=v.add(b)),b=b.double(),g>>=_1n$2$1;return v}precomputeWindow(u,g){const{windows:v,windowSize:b}=calcWOpts$1(g,this.bits),w=[];let E=u,S=E;for(let A=0;A<v;A++){S=E,w.push(S);for(let $=1;$<b;$++)S=S.add(E),w.push(S);E=S.double()}return w}wNAF(u,g,v){if(!this.Fn.isValid(v))throw new Error("invalid scalar");let b=this.ZERO,w=this.BASE;const E=calcWOpts$1(u,this.bits);for(let S=0;S<E.windows;S++){const{nextN:A,offset:$,isZero:R,isNeg:T,isNegF:O,offsetF:B}=calcOffsets$1(v,S,E);v=A,R?w=w.add(negateCt$1(O,g[B])):b=b.add(negateCt$1(T,g[$]))}return assert0$1(v),{p:b,f:w}}wNAFUnsafe(u,g,v,b=this.ZERO){const w=calcWOpts$1(u,this.bits);for(let E=0;E<w.windows&&v!==_0n$2$1;E++){const{nextN:S,offset:A,isZero:$,isNeg:R}=calcOffsets$1(v,E,w);if(v=S,!$){const T=g[A];b=b.add(R?T.negate():T)}}return assert0$1(v),b}getPrecomputes(u,g,v){let b=pointPrecomputes$1.get(g);return b||(b=this.precomputeWindow(g,u),u!==1&&(typeof v=="function"&&(b=v(b)),pointPrecomputes$1.set(g,b))),b}cached(u,g,v){const b=getW$1(u);return this.wNAF(b,this.getPrecomputes(b,u,v),g)}unsafe(u,g,v,b){const w=getW$1(u);return w===1?this._unsafeLadder(u,g,b):this.wNAFUnsafe(w,this.getPrecomputes(w,u,v),g,b)}createCache(u,g){validateW$1(g,this.bits),pointWindowSizes$1.set(u,g),pointPrecomputes$1.delete(u)}hasCache(u){return getW$1(u)!==1}};function mulEndoUnsafe$1(y,u,g,v){let b=u,w=y.ZERO,E=y.ZERO;for(;g>_0n$2$1||v>_0n$2$1;)g&_1n$2$1&&(w=w.add(b)),v&_1n$2$1&&(E=E.add(b)),b=b.double(),g>>=_1n$2$1,v>>=_1n$2$1;return{p1:w,p2:E}}function pippenger(y,u,g,v){validateMSMPoints(g,y),validateMSMScalars(v,u);const b=g.length,w=v.length;if(b!==w)throw new Error("arrays of points and scalars must have equal length");const E=y.ZERO,S=bitLen$1(BigInt(b));let A=1;S>12?A=S-3:S>4?A=S-2:S>0&&(A=2);const $=bitMask$1(A),R=new Array(Number($)+1).fill(E),T=Math.floor((u.BITS-1)/A)*A;let O=E;for(let B=T;B>=0;B-=A){R.fill(E);for(let U=0;U<w;U++){const q=v[U],J=Number(q>>BigInt(B)&$);R[J]=R[J].add(g[U])}let F=E;for(let U=R.length-1,q=E;U>0;U--)q=q.add(R[U]),F=F.add(q);if(O=O.add(F),B!==0)for(let U=0;U<A;U++)O=O.double()}return O}function createField$1(y,u,g){if(u){if(u.ORDER!==y)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return validateField$1(u),u}else return Field$1(y,{isLE:g})}function _createCurveFields(y,u,g={},v){if(v===void 0&&(v=y==="edwards"),!u||typeof u!="object")throw new Error(`expected valid ${y} CURVE object`);for(const A of["p","n","h"]){const $=u[A];if(!(typeof $=="bigint"&&$>_0n$2$1))throw new Error(`CURVE.${A} must be positive bigint`)}const b=createField$1(u.p,g.Fp,v),w=createField$1(u.n,g.Fn,v),S=["Gx","Gy","a","b"];for(const A of S)if(!b.isValid(u[A]))throw new Error(`CURVE.${A} must be valid field element of CURVE.Fp`);return u=Object.freeze(Object.assign({},u)),{CURVE:u,Fp:b,Fn:w}}const divNearest$1=(y,u)=>(y+(y>=0?u:-u)/_2n$1$1)/u;function _splitEndoScalar$1(y,u,g){const[[v,b],[w,E]]=u,S=divNearest$1(E*y,g),A=divNearest$1(-b*y,g);let $=y-S*v-A*w,R=-S*b-A*E;const T=$<_0n$1$1,O=R<_0n$1$1;T&&($=-$),O&&(R=-R);const B=bitMask$1(Math.ceil(bitLen$1(g)/2))+_1n$1$1;if($<_0n$1$1||$>=B||R<_0n$1$1||R>=B)throw new Error("splitScalar (endomorphism): failed, k="+y);return{k1neg:T,k1:$,k2neg:O,k2:R}}function validateSigFormat$1(y){if(!["compact","recovered","der"].includes(y))throw new Error('Signature format must be "compact", "recovered", or "der"');return y}function validateSigOpts$1(y,u){const g={};for(let v of Object.keys(u))g[v]=y[v]===void 0?u[v]:y[v];return _abool2(g.lowS,"lowS"),_abool2(g.prehash,"prehash"),g.format!==void 0&&validateSigFormat$1(g.format),g}let DERErr$1=class extends Error{constructor(u=""){super(u)}};const DER$1={Err:DERErr$1,_tlv:{encode:(y,u)=>{const{Err:g}=DER$1;if(y<0||y>256)throw new g("tlv.encode: wrong tag");if(u.length&1)throw new g("tlv.encode: unpadded data");const v=u.length/2,b=numberToHexUnpadded$1(v);if(b.length/2&128)throw new g("tlv.encode: long form length too big");const w=v>127?numberToHexUnpadded$1(b.length/2|128):"";return numberToHexUnpadded$1(y)+w+b+u},decode(y,u){const{Err:g}=DER$1;let v=0;if(y<0||y>256)throw new g("tlv.encode: wrong tag");if(u.length<2||u[v++]!==y)throw new g("tlv.decode: wrong tlv");const b=u[v++],w=!!(b&128);let E=0;if(!w)E=b;else{const A=b&127;if(!A)throw new g("tlv.decode(long): indefinite length not supported");if(A>4)throw new g("tlv.decode(long): byte length is too big");const $=u.subarray(v,v+A);if($.length!==A)throw new g("tlv.decode: length bytes not complete");if($[0]===0)throw new g("tlv.decode(long): zero leftmost byte");for(const R of $)E=E<<8|R;if(v+=A,E<128)throw new g("tlv.decode(long): not minimal encoding")}const S=u.subarray(v,v+E);if(S.length!==E)throw new g("tlv.decode: wrong value length");return{v:S,l:u.subarray(v+E)}}},_int:{encode(y){const{Err:u}=DER$1;if(y<_0n$1$1)throw new u("integer: negative integers are not allowed");let g=numberToHexUnpadded$1(y);if(Number.parseInt(g[0],16)&8&&(g="00"+g),g.length&1)throw new u("unexpected DER parsing assertion: unpadded hex");return g},decode(y){const{Err:u}=DER$1;if(y[0]&128)throw new u("invalid signature integer: negative");if(y[0]===0&&!(y[1]&128))throw new u("invalid signature integer: unnecessary leading zero");return bytesToNumberBE$1(y)}},toSig(y){const{Err:u,_int:g,_tlv:v}=DER$1,b=ensureBytes("signature",y),{v:w,l:E}=v.decode(48,b);if(E.length)throw new u("invalid signature: left bytes after parsing");const{v:S,l:A}=v.decode(2,w),{v:$,l:R}=v.decode(2,A);if(R.length)throw new u("invalid signature: left bytes after parsing");return{r:g.decode(S),s:g.decode($)}},hexFromSig(y){const{_tlv:u,_int:g}=DER$1,v=u.encode(2,g.encode(y.r)),b=u.encode(2,g.encode(y.s)),w=v+b;return u.encode(48,w)}},_0n$1$1=BigInt(0),_1n$1$1=BigInt(1),_2n$1$1=BigInt(2),_3n$3=BigInt(3),_4n$2=BigInt(4);function _normFnElement(y,u){const{BYTES:g}=y;let v;if(typeof u=="bigint")v=u;else{let b=ensureBytes("private key",u);try{v=y.fromBytes(b)}catch{throw new Error(`invalid private key: expected ui8a of size ${g}, got ${typeof u}`)}}if(!y.isValidNot0(v))throw new Error("invalid private key: out of range [1..N-1]");return v}function weierstrassN(y,u={}){const g=_createCurveFields("weierstrass",y,u),{Fp:v,Fn:b}=g;let w=g.CURVE;const{h:E,n:S}=w;_validateObject(u,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:A}=u;if(A&&(!v.is0(w.a)||typeof A.beta!="bigint"||!Array.isArray(A.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const $=getWLengths$1(v,b);function R(){if(!v.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function T(ae,Q,j){const{x:z,y:re}=Q.toAffine(),Y=v.toBytes(z);if(_abool2(j,"isCompressed"),j){R();const te=!v.isOdd(re);return concatBytes$2(pprefix$1(te),Y)}else return concatBytes$2(Uint8Array.of(4),Y,v.toBytes(re))}function O(ae){_abytes2(ae,void 0,"Point");const{publicKey:Q,publicKeyUncompressed:j}=$,z=ae.length,re=ae[0],Y=ae.subarray(1);if(z===Q&&(re===2||re===3)){const te=v.fromBytes(Y);if(!v.isValid(te))throw new Error("bad point: is not on curve, wrong x");const ne=U(te);let se;try{se=v.sqrt(ne)}catch(ue){const _e=ue instanceof Error?": "+ue.message:"";throw new Error("bad point: is not on curve, sqrt error"+_e)}R();const ee=v.isOdd(se);return(re&1)===1!==ee&&(se=v.neg(se)),{x:te,y:se}}else if(z===j&&re===4){const te=v.BYTES,ne=v.fromBytes(Y.subarray(0,te)),se=v.fromBytes(Y.subarray(te,te*2));if(!q(ne,se))throw new Error("bad point: is not on curve");return{x:ne,y:se}}else throw new Error(`bad point: got length ${z}, expected compressed=${Q} or uncompressed=${j}`)}const B=u.toBytes||T,F=u.fromBytes||O;function U(ae){const Q=v.sqr(ae),j=v.mul(Q,ae);return v.add(v.add(j,v.mul(ae,w.a)),w.b)}function q(ae,Q){const j=v.sqr(Q),z=U(ae);return v.eql(j,z)}if(!q(w.Gx,w.Gy))throw new Error("bad curve params: generator point");const J=v.mul(v.pow(w.a,_3n$3),_4n$2),ie=v.mul(v.sqr(w.b),BigInt(27));if(v.is0(v.add(J,ie)))throw new Error("bad curve params: a or b");function oe(ae,Q,j=!1){if(!v.isValid(Q)||j&&v.is0(Q))throw new Error(`bad point coordinate ${ae}`);return Q}function le(ae){if(!(ae instanceof pe))throw new Error("ProjectivePoint expected")}function de(ae){if(!A||!A.basises)throw new Error("no endo");return _splitEndoScalar$1(ae,A.basises,b.ORDER)}const fe=memoized$1((ae,Q)=>{const{X:j,Y:z,Z:re}=ae;if(v.eql(re,v.ONE))return{x:j,y:z};const Y=ae.is0();Q==null&&(Q=Y?v.ONE:v.inv(re));const te=v.mul(j,Q),ne=v.mul(z,Q),se=v.mul(re,Q);if(Y)return{x:v.ZERO,y:v.ZERO};if(!v.eql(se,v.ONE))throw new Error("invZ was invalid");return{x:te,y:ne}}),ye=memoized$1(ae=>{if(ae.is0()){if(u.allowInfinityPoint&&!v.is0(ae.Y))return;throw new Error("bad point: ZERO")}const{x:Q,y:j}=ae.toAffine();if(!v.isValid(Q)||!v.isValid(j))throw new Error("bad point: x or y not field elements");if(!q(Q,j))throw new Error("bad point: equation left != right");if(!ae.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function we(ae,Q,j,z,re){return j=new pe(v.mul(j.X,ae),j.Y,j.Z),Q=negateCt$1(z,Q),j=negateCt$1(re,j),Q.add(j)}class pe{constructor(Q,j,z){this.X=oe("x",Q),this.Y=oe("y",j,!0),this.Z=oe("z",z),Object.freeze(this)}static CURVE(){return w}static fromAffine(Q){const{x:j,y:z}=Q||{};if(!Q||!v.isValid(j)||!v.isValid(z))throw new Error("invalid affine point");if(Q instanceof pe)throw new Error("projective point not allowed");return v.is0(j)&&v.is0(z)?pe.ZERO:new pe(j,z,v.ONE)}static fromBytes(Q){const j=pe.fromAffine(F(_abytes2(Q,void 0,"point")));return j.assertValidity(),j}static fromHex(Q){return pe.fromBytes(ensureBytes("pointHex",Q))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(Q=8,j=!0){return he.createCache(this,Q),j||this.multiply(_3n$3),this}assertValidity(){ye(this)}hasEvenY(){const{y:Q}=this.toAffine();if(!v.isOdd)throw new Error("Field doesn't support isOdd");return!v.isOdd(Q)}equals(Q){le(Q);const{X:j,Y:z,Z:re}=this,{X:Y,Y:te,Z:ne}=Q,se=v.eql(v.mul(j,ne),v.mul(Y,re)),ee=v.eql(v.mul(z,ne),v.mul(te,re));return se&&ee}negate(){return new pe(this.X,v.neg(this.Y),this.Z)}double(){const{a:Q,b:j}=w,z=v.mul(j,_3n$3),{X:re,Y,Z:te}=this;let ne=v.ZERO,se=v.ZERO,ee=v.ZERO,Z=v.mul(re,re),ue=v.mul(Y,Y),_e=v.mul(te,te),Re=v.mul(re,Y);return Re=v.add(Re,Re),ee=v.mul(re,te),ee=v.add(ee,ee),ne=v.mul(Q,ee),se=v.mul(z,_e),se=v.add(ne,se),ne=v.sub(ue,se),se=v.add(ue,se),se=v.mul(ne,se),ne=v.mul(Re,ne),ee=v.mul(z,ee),_e=v.mul(Q,_e),Re=v.sub(Z,_e),Re=v.mul(Q,Re),Re=v.add(Re,ee),ee=v.add(Z,Z),Z=v.add(ee,Z),Z=v.add(Z,_e),Z=v.mul(Z,Re),se=v.add(se,Z),_e=v.mul(Y,te),_e=v.add(_e,_e),Z=v.mul(_e,Re),ne=v.sub(ne,Z),ee=v.mul(_e,ue),ee=v.add(ee,ee),ee=v.add(ee,ee),new pe(ne,se,ee)}add(Q){le(Q);const{X:j,Y:z,Z:re}=this,{X:Y,Y:te,Z:ne}=Q;let se=v.ZERO,ee=v.ZERO,Z=v.ZERO;const ue=w.a,_e=v.mul(w.b,_3n$3);let Re=v.mul(j,Y),Ae=v.mul(z,te),ge=v.mul(re,ne),be=v.add(j,z),Te=v.add(Y,te);be=v.mul(be,Te),Te=v.add(Re,Ae),be=v.sub(be,Te),Te=v.add(j,re);let De=v.add(Y,ne);return Te=v.mul(Te,De),De=v.add(Re,ge),Te=v.sub(Te,De),De=v.add(z,re),se=v.add(te,ne),De=v.mul(De,se),se=v.add(Ae,ge),De=v.sub(De,se),Z=v.mul(ue,Te),se=v.mul(_e,ge),Z=v.add(se,Z),se=v.sub(Ae,Z),Z=v.add(Ae,Z),ee=v.mul(se,Z),Ae=v.add(Re,Re),Ae=v.add(Ae,Re),ge=v.mul(ue,ge),Te=v.mul(_e,Te),Ae=v.add(Ae,ge),ge=v.sub(Re,ge),ge=v.mul(ue,ge),Te=v.add(Te,ge),Re=v.mul(Ae,Te),ee=v.add(ee,Re),Re=v.mul(De,Te),se=v.mul(be,se),se=v.sub(se,Re),Re=v.mul(be,Ae),Z=v.mul(De,Z),Z=v.add(Z,Re),new pe(se,ee,Z)}subtract(Q){return this.add(Q.negate())}is0(){return this.equals(pe.ZERO)}multiply(Q){const{endo:j}=u;if(!b.isValidNot0(Q))throw new Error("invalid scalar: out of range");let z,re;const Y=te=>he.cached(this,te,ne=>normalizeZ$1(pe,ne));if(j){const{k1neg:te,k1:ne,k2neg:se,k2:ee}=de(Q),{p:Z,f:ue}=Y(ne),{p:_e,f:Re}=Y(ee);re=ue.add(Re),z=we(j.beta,Z,_e,te,se)}else{const{p:te,f:ne}=Y(Q);z=te,re=ne}return normalizeZ$1(pe,[z,re])[0]}multiplyUnsafe(Q){const{endo:j}=u,z=this;if(!b.isValid(Q))throw new Error("invalid scalar: out of range");if(Q===_0n$1$1||z.is0())return pe.ZERO;if(Q===_1n$1$1)return z;if(he.hasCache(this))return this.multiply(Q);if(j){const{k1neg:re,k1:Y,k2neg:te,k2:ne}=de(Q),{p1:se,p2:ee}=mulEndoUnsafe$1(pe,z,Y,ne);return we(j.beta,se,ee,re,te)}else return he.unsafe(z,Q)}multiplyAndAddUnsafe(Q,j,z){const re=this.multiplyUnsafe(j).add(Q.multiplyUnsafe(z));return re.is0()?void 0:re}toAffine(Q){return fe(this,Q)}isTorsionFree(){const{isTorsionFree:Q}=u;return E===_1n$1$1?!0:Q?Q(pe,this):he.unsafe(this,S).is0()}clearCofactor(){const{clearCofactor:Q}=u;return E===_1n$1$1?this:Q?Q(pe,this):this.multiplyUnsafe(E)}isSmallOrder(){return this.multiplyUnsafe(E).is0()}toBytes(Q=!0){return _abool2(Q,"isCompressed"),this.assertValidity(),B(pe,this,Q)}toHex(Q=!0){return bytesToHex$4(this.toBytes(Q))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(Q=!0){return this.toBytes(Q)}_setWindowSize(Q){this.precompute(Q)}static normalizeZ(Q){return normalizeZ$1(pe,Q)}static msm(Q,j){return pippenger(pe,b,Q,j)}static fromPrivateKey(Q){return pe.BASE.multiply(_normFnElement(b,Q))}}pe.BASE=new pe(w.Gx,w.Gy,v.ONE),pe.ZERO=new pe(v.ZERO,v.ONE,v.ZERO),pe.Fp=v,pe.Fn=b;const ve=b.BITS,he=new wNAF$2(pe,u.endo?Math.ceil(ve/2):ve);return pe.BASE.precompute(8),pe}function pprefix$1(y){return Uint8Array.of(y?2:3)}function getWLengths$1(y,u){return{secretKey:u.BYTES,publicKey:1+y.BYTES,publicKeyUncompressed:1+2*y.BYTES,publicKeyHasPrefix:!0,signature:2*u.BYTES}}function ecdh$1(y,u={}){const{Fn:g}=y,v=u.randomBytes||randomBytes$3,b=Object.assign(getWLengths$1(y.Fp,g),{seed:getMinHashLength$1(g.ORDER)});function w(B){try{return!!_normFnElement(g,B)}catch{return!1}}function E(B,F){const{publicKey:U,publicKeyUncompressed:q}=b;try{const J=B.length;return F===!0&&J!==U||F===!1&&J!==q?!1:!!y.fromBytes(B)}catch{return!1}}function S(B=v(b.seed)){return mapHashToField$1(_abytes2(B,b.seed,"seed"),g.ORDER)}function A(B,F=!0){return y.BASE.multiply(_normFnElement(g,B)).toBytes(F)}function $(B){const F=S(B);return{secretKey:F,publicKey:A(F)}}function R(B){if(typeof B=="bigint")return!1;if(B instanceof y)return!0;const{secretKey:F,publicKey:U,publicKeyUncompressed:q}=b;if(g.allowedLengths||F===U)return;const J=ensureBytes("key",B).length;return J===U||J===q}function T(B,F,U=!0){if(R(B)===!0)throw new Error("first arg must be private key");if(R(F)===!1)throw new Error("second arg must be public key");const q=_normFnElement(g,B);return y.fromHex(F).multiply(q).toBytes(U)}return Object.freeze({getPublicKey:A,getSharedSecret:T,keygen:$,Point:y,utils:{isValidSecretKey:w,isValidPublicKey:E,randomSecretKey:S,isValidPrivateKey:w,randomPrivateKey:S,normPrivateKeyToScalar:B=>_normFnElement(g,B),precompute(B=8,F=y.BASE){return F.precompute(B,!1)}},lengths:b})}function ecdsa$1(y,u,g={}){ahash$4(u),_validateObject(g,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const v=g.randomBytes||randomBytes$3,b=g.hmac||((j,...z)=>hmac$4(u,j,concatBytes$2(...z))),{Fp:w,Fn:E}=y,{ORDER:S,BITS:A}=E,{keygen:$,getPublicKey:R,getSharedSecret:T,utils:O,lengths:B}=ecdh$1(y,g),F={prehash:!1,lowS:typeof g.lowS=="boolean"?g.lowS:!1,format:void 0,extraEntropy:!1},U="compact";function q(j){const z=S>>_1n$1$1;return j>z}function J(j,z){if(!E.isValidNot0(z))throw new Error(`invalid signature ${j}: out of range 1..Point.Fn.ORDER`);return z}function ie(j,z){validateSigFormat$1(z);const re=B.signature,Y=z==="compact"?re:z==="recovered"?re+1:void 0;return _abytes2(j,Y,`${z} signature`)}class oe{constructor(z,re,Y){this.r=J("r",z),this.s=J("s",re),Y!=null&&(this.recovery=Y),Object.freeze(this)}static fromBytes(z,re=U){ie(z,re);let Y;if(re==="der"){const{r:ee,s:Z}=DER$1.toSig(_abytes2(z));return new oe(ee,Z)}re==="recovered"&&(Y=z[0],re="compact",z=z.subarray(1));const te=E.BYTES,ne=z.subarray(0,te),se=z.subarray(te,te*2);return new oe(E.fromBytes(ne),E.fromBytes(se),Y)}static fromHex(z,re){return this.fromBytes(hexToBytes$4(z),re)}addRecoveryBit(z){return new oe(this.r,this.s,z)}recoverPublicKey(z){const re=w.ORDER,{r:Y,s:te,recovery:ne}=this;if(ne==null||![0,1,2,3].includes(ne))throw new Error("recovery id invalid");if(S*_2n$1$1<re&&ne>1)throw new Error("recovery id is ambiguous for h>1 curve");const ee=ne===2||ne===3?Y+S:Y;if(!w.isValid(ee))throw new Error("recovery id 2 or 3 invalid");const Z=w.toBytes(ee),ue=y.fromBytes(concatBytes$2(pprefix$1((ne&1)===0),Z)),_e=E.inv(ee),Re=de(ensureBytes("msgHash",z)),Ae=E.create(-Re*_e),ge=E.create(te*_e),be=y.BASE.multiplyUnsafe(Ae).add(ue.multiplyUnsafe(ge));if(be.is0())throw new Error("point at infinify");return be.assertValidity(),be}hasHighS(){return q(this.s)}toBytes(z=U){if(validateSigFormat$1(z),z==="der")return hexToBytes$4(DER$1.hexFromSig(this));const re=E.toBytes(this.r),Y=E.toBytes(this.s);if(z==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return concatBytes$2(Uint8Array.of(this.recovery),re,Y)}return concatBytes$2(re,Y)}toHex(z){return bytesToHex$4(this.toBytes(z))}assertValidity(){}static fromCompact(z){return oe.fromBytes(ensureBytes("sig",z),"compact")}static fromDER(z){return oe.fromBytes(ensureBytes("sig",z),"der")}normalizeS(){return this.hasHighS()?new oe(this.r,E.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return bytesToHex$4(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return bytesToHex$4(this.toBytes("compact"))}}const le=g.bits2int||function(z){if(z.length>8192)throw new Error("input is too large");const re=bytesToNumberBE$1(z),Y=z.length*8-A;return Y>0?re>>BigInt(Y):re},de=g.bits2int_modN||function(z){return E.create(le(z))},fe=bitMask$1(A);function ye(j){return aInRange$2("num < 2^"+A,j,_0n$1$1,fe),E.toBytes(j)}function we(j,z){return _abytes2(j,void 0,"message"),z?_abytes2(u(j),void 0,"prehashed message"):j}function pe(j,z,re){if(["recovered","canonical"].some(Ae=>Ae in re))throw new Error("sign() legacy options not supported");const{lowS:Y,prehash:te,extraEntropy:ne}=validateSigOpts$1(re,F);j=we(j,te);const se=de(j),ee=_normFnElement(E,z),Z=[ye(ee),ye(se)];if(ne!=null&&ne!==!1){const Ae=ne===!0?v(B.secretKey):ne;Z.push(ensureBytes("extraEntropy",Ae))}const ue=concatBytes$2(...Z),_e=se;function Re(Ae){const ge=le(Ae);if(!E.isValidNot0(ge))return;const be=E.inv(ge),Te=y.BASE.multiply(ge).toAffine(),De=E.create(Te.x);if(De===_0n$1$1)return;const Ie=E.create(be*E.create(_e+De*ee));if(Ie===_0n$1$1)return;let Se=(Te.x===De?0:2)|Number(Te.y&_1n$1$1),Be=Ie;return Y&&q(Ie)&&(Be=E.neg(Ie),Se^=1),new oe(De,Be,Se)}return{seed:ue,k2sig:Re}}function ve(j,z,re={}){j=ensureBytes("message",j);const{seed:Y,k2sig:te}=pe(j,z,re);return createHmacDrbg$1(u.outputLen,E.BYTES,b)(Y,te)}function he(j){let z;const re=typeof j=="string"||isBytes$1$1(j),Y=!re&&j!==null&&typeof j=="object"&&typeof j.r=="bigint"&&typeof j.s=="bigint";if(!re&&!Y)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(Y)z=new oe(j.r,j.s);else if(re){try{z=oe.fromBytes(ensureBytes("sig",j),"der")}catch(te){if(!(te instanceof DER$1.Err))throw te}if(!z)try{z=oe.fromBytes(ensureBytes("sig",j),"compact")}catch{return!1}}return z||!1}function ae(j,z,re,Y={}){const{lowS:te,prehash:ne,format:se}=validateSigOpts$1(Y,F);if(re=ensureBytes("publicKey",re),z=we(ensureBytes("message",z),ne),"strict"in Y)throw new Error("options.strict was renamed to lowS");const ee=se===void 0?he(j):oe.fromBytes(ensureBytes("sig",j),se);if(ee===!1)return!1;try{const Z=y.fromBytes(re);if(te&&ee.hasHighS())return!1;const{r:ue,s:_e}=ee,Re=de(z),Ae=E.inv(_e),ge=E.create(Re*Ae),be=E.create(ue*Ae),Te=y.BASE.multiplyUnsafe(ge).add(Z.multiplyUnsafe(be));return Te.is0()?!1:E.create(Te.x)===ue}catch{return!1}}function Q(j,z,re={}){const{prehash:Y}=validateSigOpts$1(re,F);return z=we(z,Y),oe.fromBytes(j,"recovered").recoverPublicKey(z).toBytes()}return Object.freeze({keygen:$,getPublicKey:R,getSharedSecret:T,utils:O,lengths:B,Point:y,sign:ve,verify:ae,recoverPublicKey:Q,Signature:oe,hash:u})}function _weierstrass_legacy_opts_to_new(y){const u={a:y.a,b:y.b,p:y.Fp.ORDER,n:y.n,h:y.h,Gx:y.Gx,Gy:y.Gy},g=y.Fp;let v=y.allowedPrivateKeyLengths?Array.from(new Set(y.allowedPrivateKeyLengths.map(E=>Math.ceil(E/2)))):void 0;const b=Field$1(u.n,{BITS:y.nBitLength,allowedLengths:v,modFromBytes:y.wrapPrivateKey}),w={Fp:g,Fn:b,allowInfinityPoint:y.allowInfinityPoint,endo:y.endo,isTorsionFree:y.isTorsionFree,clearCofactor:y.clearCofactor,fromBytes:y.fromBytes,toBytes:y.toBytes};return{CURVE:u,curveOpts:w}}function _ecdsa_legacy_opts_to_new(y){const{CURVE:u,curveOpts:g}=_weierstrass_legacy_opts_to_new(y),v={hmac:y.hmac,randomBytes:y.randomBytes,lowS:y.lowS,bits2int:y.bits2int,bits2int_modN:y.bits2int_modN};return{CURVE:u,curveOpts:g,hash:y.hash,ecdsaOpts:v}}function _ecdsa_new_output_to_legacy(y,u){const g=u.Point;return Object.assign({},u,{ProjectivePoint:g,CURVE:Object.assign({},y,nLength$1(g.Fn.ORDER,g.Fn.BITS))})}function weierstrass$1(y){const{CURVE:u,curveOpts:g,hash:v,ecdsaOpts:b}=_ecdsa_legacy_opts_to_new(y),w=weierstrassN(u,g),E=ecdsa$1(w,v,b);return _ecdsa_new_output_to_legacy(y,E)}function createCurve(y,u){const g=v=>weierstrass$1({...y,hash:v});return{...g(u),create:g}}const secp256k1_CURVE$1={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},secp256k1_ENDO$1={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_0n$8=BigInt(0),_1n$8=BigInt(1),_2n$7=BigInt(2);function sqrtMod$1(y){const u=secp256k1_CURVE$1.p,g=BigInt(3),v=BigInt(6),b=BigInt(11),w=BigInt(22),E=BigInt(23),S=BigInt(44),A=BigInt(88),$=y*y*y%u,R=$*$*y%u,T=pow2$3(R,g,u)*R%u,O=pow2$3(T,g,u)*R%u,B=pow2$3(O,_2n$7,u)*$%u,F=pow2$3(B,b,u)*B%u,U=pow2$3(F,w,u)*F%u,q=pow2$3(U,S,u)*U%u,J=pow2$3(q,A,u)*q%u,ie=pow2$3(J,S,u)*U%u,oe=pow2$3(ie,g,u)*R%u,le=pow2$3(oe,E,u)*F%u,de=pow2$3(le,v,u)*$%u,fe=pow2$3(de,_2n$7,u);if(!Fpk1$1.eql(Fpk1$1.sqr(fe),y))throw new Error("Cannot find square root");return fe}const Fpk1$1=Field$1(secp256k1_CURVE$1.p,{sqrt:sqrtMod$1}),secp256k1$1=createCurve({...secp256k1_CURVE$1,Fp:Fpk1$1,lowS:!0,endo:secp256k1_ENDO$1},sha256$1$1),TAGGED_HASH_PREFIXES={};function taggedHash(y,...u){let g=TAGGED_HASH_PREFIXES[y];if(g===void 0){const v=sha256$1$1(utf8ToBytes$1$1(y));g=concatBytes$2(v,v),TAGGED_HASH_PREFIXES[y]=g}return sha256$1$1(concatBytes$2(g,...u))}const pointToBytes=y=>y.toBytes(!0).slice(1),Pointk1$1=secp256k1$1.Point,hasEven=y=>y%_2n$7===_0n$8;function schnorrGetExtPubKey(y){const{Fn:u,BASE:g}=Pointk1$1,v=_normFnElement(u,y),b=g.multiply(v);return{scalar:hasEven(b.y)?v:u.neg(v),bytes:pointToBytes(b)}}function lift_x(y){const u=Fpk1$1;if(!u.isValidNot0(y))throw new Error("invalid x: Fail if x  p");const g=u.create(y*y),v=u.create(g*y+BigInt(7));let b=u.sqrt(v);hasEven(b)||(b=u.neg(b));const w=Pointk1$1.fromAffine({x:y,y:b});return w.assertValidity(),w}const num=bytesToNumberBE$1;function challenge(...y){return Pointk1$1.Fn.create(num(taggedHash("BIP0340/challenge",...y)))}function schnorrGetPublicKey(y){return schnorrGetExtPubKey(y).bytes}function schnorrSign(y,u,g=randomBytes$3(32)){const{Fn:v}=Pointk1$1,b=ensureBytes("message",y),{bytes:w,scalar:E}=schnorrGetExtPubKey(u),S=ensureBytes("auxRand",g,32),A=v.toBytes(E^num(taggedHash("BIP0340/aux",S))),$=taggedHash("BIP0340/nonce",A,w,b),{bytes:R,scalar:T}=schnorrGetExtPubKey($),O=challenge(R,w,b),B=new Uint8Array(64);if(B.set(R,0),B.set(v.toBytes(v.create(T+O*E)),32),!schnorrVerify(B,b,w))throw new Error("sign: Invalid signature produced");return B}function schnorrVerify(y,u,g){const{Fn:v,BASE:b}=Pointk1$1,w=ensureBytes("signature",y,64),E=ensureBytes("message",u),S=ensureBytes("publicKey",g,32);try{const A=lift_x(num(S)),$=num(w.subarray(0,32));if(!inRange$2($,_1n$8,secp256k1_CURVE$1.p))return!1;const R=num(w.subarray(32,64));if(!inRange$2(R,_1n$8,secp256k1_CURVE$1.n))return!1;const T=challenge(v.toBytes($),pointToBytes(A),E),O=b.multiplyUnsafe(R).add(A.multiplyUnsafe(v.neg(T))),{x:B,y:F}=O.toAffine();return!(O.is0()||!hasEven(F)||B!==$)}catch{return!1}}const schnorr$1=(()=>{const g=(b=randomBytes$3(48))=>mapHashToField$1(b,secp256k1_CURVE$1.n);secp256k1$1.utils.randomSecretKey;function v(b){const w=g(b);return{secretKey:w,publicKey:schnorrGetPublicKey(w)}}return{keygen:v,getPublicKey:schnorrGetPublicKey,sign:schnorrSign,verify:schnorrVerify,Point:Pointk1$1,utils:{randomSecretKey:g,randomPrivateKey:g,taggedHash,lift_x,pointToBytes,numberToBytesBE:numberToBytesBE$2,bytesToNumberBE:bytesToNumberBE$1,mod:mod$2},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})();function getPublicKey$1(y){if(y.length!==32)throw new Error("Private key must be 32 bytes");return schnorr$1.getPublicKey(y)}function sign(y,u){if(y.length!==32)throw new Error("Message must be 32 bytes");if(u.length!==32)throw new Error("Private key must be 32 bytes");return schnorr$1.sign(y,u)}function signHex(y,u){return bytesToHex$4(sign(y,u))}function verify(y,u,g){if(y.length!==64||u.length!==32||g.length!==32)return!1;try{return schnorr$1.verify(y,u,g)}catch{return!1}}function verifyHex(y,u,g){try{const v=hexToBytes$4(y),b=hexToBytes$4(g);return verify(v,u,b)}catch{return!1}}const sha256$6=sha256$1$1;async function getWebCrypto(){return typeof globalThis.crypto?.subtle<"u"?globalThis.crypto:(await __vitePreload(()=>import("./index-ByvaXPY0.js").then(u=>u.i),[])).webcrypto}const COMPRESSION_THRESHOLD=1024,COMPRESSION_PREFIX="gz:";function toBase64$1(y){if(typeof Buffer<"u")return Buffer.from(y).toString("base64");let u="";for(let g=0;g<y.length;g++)u+=String.fromCharCode(y[g]);return btoa(u)}function fromBase64$1$1(y){if(typeof Buffer<"u")return new Uint8Array(Buffer.from(y,"base64"));const u=atob(y),g=new Uint8Array(u.length);for(let v=0;v<u.length;v++)g[v]=u.charCodeAt(v);return g}function toBufferSource(y){const u=new ArrayBuffer(y.length);return new Uint8Array(u).set(y),u}async function compress(y){if(typeof process$1<"u"&&process$1.versions?.node){const{gzipSync:u}=await __vitePreload(async()=>{const{gzipSync:g}=await import("./index-DYSaMiH6.js").then(v=>v.i);return{gzipSync:g}},[]);return new Uint8Array(u(Buffer.from(y)))}else if(typeof CompressionStream<"u"){const u=new CompressionStream("gzip"),g=u.writable.getWriter();g.write(toBufferSource(y)),g.close();const v=[],b=u.readable.getReader();for(;;){const{done:A,value:$}=await b.read();if(A)break;v.push($)}const w=v.reduce((A,$)=>A+$.length,0),E=new Uint8Array(w);let S=0;for(const A of v)E.set(A,S),S+=A.length;return E}throw new Error("GZIP compression not supported in this environment")}async function decompress(y){if(typeof process$1<"u"&&process$1.versions?.node){const{gunzipSync:u}=await __vitePreload(async()=>{const{gunzipSync:g}=await import("./index-DYSaMiH6.js").then(v=>v.i);return{gunzipSync:g}},[]);return new Uint8Array(u(Buffer.from(y)))}else if(typeof DecompressionStream<"u"){const u=new DecompressionStream("gzip"),g=u.writable.getWriter();g.write(toBufferSource(y)),g.close();const v=[],b=u.readable.getReader();for(;;){const{done:A,value:$}=await b.read();if(A)break;v.push($)}const w=v.reduce((A,$)=>A+$.length,0),E=new Uint8Array(w);let S=0;for(const A of v)E.set(A,S),S+=A.length;return E}throw new Error("GZIP decompression not supported in this environment")}async function importKey(y){return(await getWebCrypto()).subtle.importKey("raw",toBufferSource(y),{name:"AES-CBC"},!1,["encrypt","decrypt"])}async function aesEncrypt(y,u,g){const v=await getWebCrypto(),b=await importKey(u),w=await v.subtle.encrypt({name:"AES-CBC",iv:toBufferSource(g)},b,toBufferSource(y));return new Uint8Array(w)}async function aesDecrypt(y,u,g){const v=await getWebCrypto(),b=await importKey(u),w=await v.subtle.decrypt({name:"AES-CBC",iv:toBufferSource(g)},b,toBufferSource(y));return new Uint8Array(w)}function deriveSharedSecret(y,u){if(y.length!==32)throw new Error("Private key must be 32 bytes");if(u.length!==32)throw new Error("Public key must be 32 bytes");const g=new Uint8Array(33);g[0]=2,g.set(u,1);const b=secp256k1$1.getSharedSecret(y,g).slice(1,33);return sha256$6(b)}async function encrypt$1(y,u,g){let b=new TextEncoder().encode(y),w=!1,E=b;if(b.length>COMPRESSION_THRESHOLD){const O=await compress(b);O.length<b.length&&(E=new Uint8Array(O),w=!0)}const S=deriveSharedSecret(u,g),A=randomBytes$3(16),$=await aesEncrypt(E,S,A),R=toBase64$1($),T=toBase64$1(A);return w?`${COMPRESSION_PREFIX}${R}?iv=${T}`:`${R}?iv=${T}`}async function decrypt$1(y,u,g){let v=y,b=!1;v.startsWith(COMPRESSION_PREFIX)&&(v=v.slice(COMPRESSION_PREFIX.length),b=!0);const w=v.split("?iv=");if(w.length!==2)throw new Error("Invalid encrypted content format");const E=w[0],S=w[1],A=fromBase64$1$1(E),$=fromBase64$1$1(S);if($.length!==16)throw new Error("Invalid IV length");const R=deriveSharedSecret(u,g);let T=await aesDecrypt(A,R,$);return b&&(T=await decompress(T)),new TextDecoder().decode(T)}function isBytes$7(y){return y instanceof Uint8Array||ArrayBuffer.isView(y)&&y.constructor.name==="Uint8Array"}function abool$2(y){if(typeof y!="boolean")throw new Error(`boolean expected, not ${y}`)}function anumber$5(y){if(!Number.isSafeInteger(y)||y<0)throw new Error("positive integer expected, got "+y)}function abytes$6(y,...u){if(!isBytes$7(y))throw new Error("Uint8Array expected");if(u.length>0&&!u.includes(y.length))throw new Error("Uint8Array expected of length "+u+", got length="+y.length)}function aexists$5(y,u=!0){if(y.destroyed)throw new Error("Hash instance has been destroyed");if(u&&y.finished)throw new Error("Hash#digest() has already been called")}function aoutput$5(y,u){abytes$6(y);const g=u.outputLen;if(y.length<g)throw new Error("digestInto() expects output buffer of length at least "+g)}function u32$1(y){return new Uint32Array(y.buffer,y.byteOffset,Math.floor(y.byteLength/4))}function clean$5(...y){for(let u=0;u<y.length;u++)y[u].fill(0)}function createView$5(y){return new DataView(y.buffer,y.byteOffset,y.byteLength)}const isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function utf8ToBytes$4(y){if(typeof y!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(y))}function toBytes$2(y){if(typeof y=="string")y=utf8ToBytes$4(y);else if(isBytes$7(y))y=copyBytes$3(y);else throw new Error("Uint8Array expected, got "+typeof y);return y}function checkOpts$3(y,u){if(u==null||typeof u!="object")throw new Error("options must be defined");return Object.assign(y,u)}function equalBytes$1(y,u){if(y.length!==u.length)return!1;let g=0;for(let v=0;v<y.length;v++)g|=y[v]^u[v];return g===0}const wrapCipher$1=(y,u)=>{function g(v,...b){if(abytes$6(v),!isLE$1)throw new Error("Non little-endian hardware is not yet supported");if(y.nonceLength!==void 0){const R=b[0];if(!R)throw new Error("nonce / iv required");y.varSizeNonce?abytes$6(R):abytes$6(R,y.nonceLength)}const w=y.tagLength;w&&b[1]!==void 0&&abytes$6(b[1]);const E=u(v,...b),S=(R,T)=>{if(T!==void 0){if(R!==2)throw new Error("cipher output not supported");abytes$6(T)}};let A=!1;return{encrypt(R,T){if(A)throw new Error("cannot encrypt() twice with same key + nonce");return A=!0,abytes$6(R),S(E.encrypt.length,T),E.encrypt(R,T)},decrypt(R,T){if(abytes$6(R),w&&R.length<w)throw new Error("invalid ciphertext length: smaller than tagLength="+w);return S(E.decrypt.length,T),E.decrypt(R,T)}}}return Object.assign(g,y),g};function getOutput$1(y,u,g=!0){if(u===void 0)return new Uint8Array(y);if(u.length!==y)throw new Error("invalid output length, expected "+y+", got: "+u.length);if(g&&!isAligned32$1$1(u))throw new Error("invalid output, must be aligned");return u}function setBigUint64$2(y,u,g,v){if(typeof y.setBigUint64=="function")return y.setBigUint64(u,g,v);const b=BigInt(32),w=BigInt(4294967295),E=Number(g>>b&w),S=Number(g&w),A=4,$=0;y.setUint32(u+A,E,v),y.setUint32(u+$,S,v)}function u64Lengths$1(y,u,g){abool$2(g);const v=new Uint8Array(16),b=createView$5(v);return setBigUint64$2(b,0,BigInt(u),g),setBigUint64$2(b,8,BigInt(y),g),v}function isAligned32$1$1(y){return y.byteOffset%4===0}function copyBytes$3(y){return Uint8Array.from(y)}const _utf8ToBytes=y=>Uint8Array.from(y.split("").map(u=>u.charCodeAt(0))),sigma16$1=_utf8ToBytes("expand 16-byte k"),sigma32$1=_utf8ToBytes("expand 32-byte k"),sigma16_32$1=u32$1(sigma16$1),sigma32_32$1=u32$1(sigma32$1);function rotl$2(y,u){return y<<u|y>>>32-u}function isAligned32$2(y){return y.byteOffset%4===0}const BLOCK_LEN$1=64,BLOCK_LEN32$1=16,MAX_COUNTER$1=2**32-1,U32_EMPTY$1=new Uint32Array;function runCipher$1(y,u,g,v,b,w,E,S){const A=b.length,$=new Uint8Array(BLOCK_LEN$1),R=u32$1($),T=isAligned32$2(b)&&isAligned32$2(w),O=T?u32$1(b):U32_EMPTY$1,B=T?u32$1(w):U32_EMPTY$1;for(let F=0;F<A;E++){if(y(u,g,v,R,E,S),E>=MAX_COUNTER$1)throw new Error("arx: counter overflow");const U=Math.min(BLOCK_LEN$1,A-F);if(T&&U===BLOCK_LEN$1){const q=F/4;if(F%4!==0)throw new Error("arx: invalid block position");for(let J=0,ie;J<BLOCK_LEN32$1;J++)ie=q+J,B[ie]=O[ie]^R[J];F+=BLOCK_LEN$1;continue}for(let q=0,J;q<U;q++)J=F+q,w[J]=b[J]^$[q];F+=U}}function createCipher$1(y,u){const{allowShortKeys:g,extendNonceFn:v,counterLength:b,counterRight:w,rounds:E}=checkOpts$3({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},u);if(typeof y!="function")throw new Error("core must be a function");return anumber$5(b),anumber$5(E),abool$2(w),abool$2(g),(S,A,$,R,T=0)=>{abytes$6(S),abytes$6(A),abytes$6($);const O=$.length;if(R===void 0&&(R=new Uint8Array(O)),abytes$6(R),anumber$5(T),T<0||T>=MAX_COUNTER$1)throw new Error("arx: counter overflow");if(R.length<O)throw new Error(`arx: output (${R.length}) is shorter than data (${O})`);const B=[];let F=S.length,U,q;if(F===32)B.push(U=copyBytes$3(S)),q=sigma32_32$1;else if(F===16&&g)U=new Uint8Array(32),U.set(S),U.set(S,16),q=sigma16_32$1,B.push(U);else throw new Error(`arx: invalid 32-byte key, got length=${F}`);isAligned32$2(A)||B.push(A=copyBytes$3(A));const J=u32$1(U);if(v){if(A.length!==24)throw new Error("arx: extended nonce must be 24 bytes");v(q,J,u32$1(A.subarray(0,16)),J),A=A.subarray(16)}const ie=16-b;if(ie!==A.length)throw new Error(`arx: nonce must be ${ie} or 16 bytes`);if(ie!==12){const le=new Uint8Array(12);le.set(A,w?0:12-A.length),A=le,B.push(A)}const oe=u32$1(A);return runCipher$1(y,q,J,oe,$,R,T,E),clean$5(...B),R}}const u8to16$1=(y,u)=>y[u++]&255|(y[u++]&255)<<8;let Poly1305$1=class{constructor(u){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,u=toBytes$2(u),abytes$6(u,32);const g=u8to16$1(u,0),v=u8to16$1(u,2),b=u8to16$1(u,4),w=u8to16$1(u,6),E=u8to16$1(u,8),S=u8to16$1(u,10),A=u8to16$1(u,12),$=u8to16$1(u,14);this.r[0]=g&8191,this.r[1]=(g>>>13|v<<3)&8191,this.r[2]=(v>>>10|b<<6)&7939,this.r[3]=(b>>>7|w<<9)&8191,this.r[4]=(w>>>4|E<<12)&255,this.r[5]=E>>>1&8190,this.r[6]=(E>>>14|S<<2)&8191,this.r[7]=(S>>>11|A<<5)&8065,this.r[8]=(A>>>8|$<<8)&8191,this.r[9]=$>>>5&127;for(let R=0;R<8;R++)this.pad[R]=u8to16$1(u,16+2*R)}process(u,g,v=!1){const b=v?0:2048,{h:w,r:E}=this,S=E[0],A=E[1],$=E[2],R=E[3],T=E[4],O=E[5],B=E[6],F=E[7],U=E[8],q=E[9],J=u8to16$1(u,g+0),ie=u8to16$1(u,g+2),oe=u8to16$1(u,g+4),le=u8to16$1(u,g+6),de=u8to16$1(u,g+8),fe=u8to16$1(u,g+10),ye=u8to16$1(u,g+12),we=u8to16$1(u,g+14);let pe=w[0]+(J&8191),ve=w[1]+((J>>>13|ie<<3)&8191),he=w[2]+((ie>>>10|oe<<6)&8191),ae=w[3]+((oe>>>7|le<<9)&8191),Q=w[4]+((le>>>4|de<<12)&8191),j=w[5]+(de>>>1&8191),z=w[6]+((de>>>14|fe<<2)&8191),re=w[7]+((fe>>>11|ye<<5)&8191),Y=w[8]+((ye>>>8|we<<8)&8191),te=w[9]+(we>>>5|b),ne=0,se=ne+pe*S+ve*(5*q)+he*(5*U)+ae*(5*F)+Q*(5*B);ne=se>>>13,se&=8191,se+=j*(5*O)+z*(5*T)+re*(5*R)+Y*(5*$)+te*(5*A),ne+=se>>>13,se&=8191;let ee=ne+pe*A+ve*S+he*(5*q)+ae*(5*U)+Q*(5*F);ne=ee>>>13,ee&=8191,ee+=j*(5*B)+z*(5*O)+re*(5*T)+Y*(5*R)+te*(5*$),ne+=ee>>>13,ee&=8191;let Z=ne+pe*$+ve*A+he*S+ae*(5*q)+Q*(5*U);ne=Z>>>13,Z&=8191,Z+=j*(5*F)+z*(5*B)+re*(5*O)+Y*(5*T)+te*(5*R),ne+=Z>>>13,Z&=8191;let ue=ne+pe*R+ve*$+he*A+ae*S+Q*(5*q);ne=ue>>>13,ue&=8191,ue+=j*(5*U)+z*(5*F)+re*(5*B)+Y*(5*O)+te*(5*T),ne+=ue>>>13,ue&=8191;let _e=ne+pe*T+ve*R+he*$+ae*A+Q*S;ne=_e>>>13,_e&=8191,_e+=j*(5*q)+z*(5*U)+re*(5*F)+Y*(5*B)+te*(5*O),ne+=_e>>>13,_e&=8191;let Re=ne+pe*O+ve*T+he*R+ae*$+Q*A;ne=Re>>>13,Re&=8191,Re+=j*S+z*(5*q)+re*(5*U)+Y*(5*F)+te*(5*B),ne+=Re>>>13,Re&=8191;let Ae=ne+pe*B+ve*O+he*T+ae*R+Q*$;ne=Ae>>>13,Ae&=8191,Ae+=j*A+z*S+re*(5*q)+Y*(5*U)+te*(5*F),ne+=Ae>>>13,Ae&=8191;let ge=ne+pe*F+ve*B+he*O+ae*T+Q*R;ne=ge>>>13,ge&=8191,ge+=j*$+z*A+re*S+Y*(5*q)+te*(5*U),ne+=ge>>>13,ge&=8191;let be=ne+pe*U+ve*F+he*B+ae*O+Q*T;ne=be>>>13,be&=8191,be+=j*R+z*$+re*A+Y*S+te*(5*q),ne+=be>>>13,be&=8191;let Te=ne+pe*q+ve*U+he*F+ae*B+Q*O;ne=Te>>>13,Te&=8191,Te+=j*T+z*R+re*$+Y*A+te*S,ne+=Te>>>13,Te&=8191,ne=(ne<<2)+ne|0,ne=ne+se|0,se=ne&8191,ne=ne>>>13,ee+=ne,w[0]=se,w[1]=ee,w[2]=Z,w[3]=ue,w[4]=_e,w[5]=Re,w[6]=Ae,w[7]=ge,w[8]=be,w[9]=Te}finalize(){const{h:u,pad:g}=this,v=new Uint16Array(10);let b=u[1]>>>13;u[1]&=8191;for(let S=2;S<10;S++)u[S]+=b,b=u[S]>>>13,u[S]&=8191;u[0]+=b*5,b=u[0]>>>13,u[0]&=8191,u[1]+=b,b=u[1]>>>13,u[1]&=8191,u[2]+=b,v[0]=u[0]+5,b=v[0]>>>13,v[0]&=8191;for(let S=1;S<10;S++)v[S]=u[S]+b,b=v[S]>>>13,v[S]&=8191;v[9]-=8192;let w=(b^1)-1;for(let S=0;S<10;S++)v[S]&=w;w=~w;for(let S=0;S<10;S++)u[S]=u[S]&w|v[S];u[0]=(u[0]|u[1]<<13)&65535,u[1]=(u[1]>>>3|u[2]<<10)&65535,u[2]=(u[2]>>>6|u[3]<<7)&65535,u[3]=(u[3]>>>9|u[4]<<4)&65535,u[4]=(u[4]>>>12|u[5]<<1|u[6]<<14)&65535,u[5]=(u[6]>>>2|u[7]<<11)&65535,u[6]=(u[7]>>>5|u[8]<<8)&65535,u[7]=(u[8]>>>8|u[9]<<5)&65535;let E=u[0]+g[0];u[0]=E&65535;for(let S=1;S<8;S++)E=(u[S]+g[S]|0)+(E>>>16)|0,u[S]=E&65535;clean$5(v)}update(u){aexists$5(this),u=toBytes$2(u),abytes$6(u);const{buffer:g,blockLen:v}=this,b=u.length;for(let w=0;w<b;){const E=Math.min(v-this.pos,b-w);if(E===v){for(;v<=b-w;w+=v)this.process(u,w);continue}g.set(u.subarray(w,w+E),this.pos),this.pos+=E,w+=E,this.pos===v&&(this.process(g,0,!1),this.pos=0)}return this}destroy(){clean$5(this.h,this.r,this.buffer,this.pad)}digestInto(u){aexists$5(this),aoutput$5(u,this),this.finished=!0;const{buffer:g,h:v}=this;let{pos:b}=this;if(b){for(g[b++]=1;b<16;b++)g[b]=0;this.process(g,0,!0)}this.finalize();let w=0;for(let E=0;E<8;E++)u[w++]=v[E]>>>0,u[w++]=v[E]>>>8;return u}digest(){const{buffer:u,outputLen:g}=this;this.digestInto(u);const v=u.slice(0,g);return this.destroy(),v}};function wrapConstructorWithKey$1(y){const u=(v,b)=>y(b).update(toBytes$2(v)).digest(),g=y(new Uint8Array(32));return u.outputLen=g.outputLen,u.blockLen=g.blockLen,u.create=v=>y(v),u}const poly1305$1=wrapConstructorWithKey$1(y=>new Poly1305$1(y));function chachaCore$1(y,u,g,v,b,w=20){let E=y[0],S=y[1],A=y[2],$=y[3],R=u[0],T=u[1],O=u[2],B=u[3],F=u[4],U=u[5],q=u[6],J=u[7],ie=b,oe=g[0],le=g[1],de=g[2],fe=E,ye=S,we=A,pe=$,ve=R,he=T,ae=O,Q=B,j=F,z=U,re=q,Y=J,te=ie,ne=oe,se=le,ee=de;for(let ue=0;ue<w;ue+=2)fe=fe+ve|0,te=rotl$2(te^fe,16),j=j+te|0,ve=rotl$2(ve^j,12),fe=fe+ve|0,te=rotl$2(te^fe,8),j=j+te|0,ve=rotl$2(ve^j,7),ye=ye+he|0,ne=rotl$2(ne^ye,16),z=z+ne|0,he=rotl$2(he^z,12),ye=ye+he|0,ne=rotl$2(ne^ye,8),z=z+ne|0,he=rotl$2(he^z,7),we=we+ae|0,se=rotl$2(se^we,16),re=re+se|0,ae=rotl$2(ae^re,12),we=we+ae|0,se=rotl$2(se^we,8),re=re+se|0,ae=rotl$2(ae^re,7),pe=pe+Q|0,ee=rotl$2(ee^pe,16),Y=Y+ee|0,Q=rotl$2(Q^Y,12),pe=pe+Q|0,ee=rotl$2(ee^pe,8),Y=Y+ee|0,Q=rotl$2(Q^Y,7),fe=fe+he|0,ee=rotl$2(ee^fe,16),re=re+ee|0,he=rotl$2(he^re,12),fe=fe+he|0,ee=rotl$2(ee^fe,8),re=re+ee|0,he=rotl$2(he^re,7),ye=ye+ae|0,te=rotl$2(te^ye,16),Y=Y+te|0,ae=rotl$2(ae^Y,12),ye=ye+ae|0,te=rotl$2(te^ye,8),Y=Y+te|0,ae=rotl$2(ae^Y,7),we=we+Q|0,ne=rotl$2(ne^we,16),j=j+ne|0,Q=rotl$2(Q^j,12),we=we+Q|0,ne=rotl$2(ne^we,8),j=j+ne|0,Q=rotl$2(Q^j,7),pe=pe+ve|0,se=rotl$2(se^pe,16),z=z+se|0,ve=rotl$2(ve^z,12),pe=pe+ve|0,se=rotl$2(se^pe,8),z=z+se|0,ve=rotl$2(ve^z,7);let Z=0;v[Z++]=E+fe|0,v[Z++]=S+ye|0,v[Z++]=A+we|0,v[Z++]=$+pe|0,v[Z++]=R+ve|0,v[Z++]=T+he|0,v[Z++]=O+ae|0,v[Z++]=B+Q|0,v[Z++]=F+j|0,v[Z++]=U+z|0,v[Z++]=q+re|0,v[Z++]=J+Y|0,v[Z++]=ie+te|0,v[Z++]=oe+ne|0,v[Z++]=le+se|0,v[Z++]=de+ee|0}const chacha20$1=createCipher$1(chachaCore$1,{counterRight:!1,counterLength:4,allowShortKeys:!1}),ZEROS16$1=new Uint8Array(16),updatePadded$1=(y,u)=>{y.update(u);const g=u.length%16;g&&y.update(ZEROS16$1.subarray(g))},ZEROS32$1=new Uint8Array(32);function computeTag$1(y,u,g,v,b){const w=y(u,g,ZEROS32$1),E=poly1305$1.create(w);b&&updatePadded$1(E,b),updatePadded$1(E,v);const S=u64Lengths$1(v.length,b?b.length:0,!0);E.update(S);const A=E.digest();return clean$5(w,S),A}const _poly1305_aead$1=y=>(u,g,v)=>({encrypt(w,E){const S=w.length;E=getOutput$1(S+16,E,!1),E.set(w);const A=E.subarray(0,-16);y(u,g,A,A,1);const $=computeTag$1(y,u,g,A,v);return E.set($,S),clean$5($),E},decrypt(w,E){E=getOutput$1(w.length-16,E,!1);const S=w.subarray(0,-16),A=w.subarray(-16),$=computeTag$1(y,u,g,S,v);if(!equalBytes$1(A,$))throw new Error("invalid tag");return E.set(w.subarray(0,-16)),y(u,g,E,E,1),clean$5($),E}}),chacha20poly1305$1=wrapCipher$1({blockSize:64,nonceLength:12,tagLength:16},_poly1305_aead$1(chacha20$1));function extract$2(y,u,g){return ahash$4(y),g===void 0&&(g=new Uint8Array(y.outputLen)),hmac$4(y,toBytes$1$1(g),toBytes$1$1(u))}const HKDF_COUNTER$2=Uint8Array.from([0]),EMPTY_BUFFER$3=Uint8Array.of();function expand$2(y,u,g,v=32){ahash$4(y),anumber$1$1(v);const b=y.outputLen;if(v>255*b)throw new Error("Length should be <= 255*HashLen");const w=Math.ceil(v/b);g===void 0&&(g=EMPTY_BUFFER$3);const E=new Uint8Array(w*b),S=hmac$4.create(y,u),A=S._cloneInto(),$=new Uint8Array(S.outputLen);for(let R=0;R<w;R++)HKDF_COUNTER$2[0]=R+1,A.update(R===0?EMPTY_BUFFER$3:$).update(g).update(HKDF_COUNTER$2).digestInto($),E.set($,b*R),S._cloneInto(A);return S.destroy(),A.destroy(),clean$1$1($,HKDF_COUNTER$2),E.slice(0,v)}const hkdf$1=(y,u,g,v,b)=>expand$2(y,extract$2(y,u,g),v,b),VERSION=2,NONCE_SIZE=24,MAC_SIZE=16,MIN_PADDED_LEN=32,MAX_MESSAGE_LEN=65535,HKDF_SALT=new TextEncoder().encode("nip44-v2");function deriveConversationKey(y,u){if(y.length!==32)throw new Error("Private key must be 32 bytes");if(u.length!==32)throw new Error("Public key must be 32 bytes");const g=computeSharedX(y,u),v=secp256k1$1.getPublicKey(y,!0).slice(1),b=createSortedKeysSalt(v,u);return hkdf$1(sha256$6,g,b,HKDF_SALT,32)}function computeSharedX(y,u){const g=new Uint8Array(33);return g[0]=2,g.set(u,1),secp256k1$1.getSharedSecret(y,g).slice(1,33)}function createSortedKeysSalt(y,u){return compareBytes$1(y,u)<=0?concatBytes$2(y,u):concatBytes$2(u,y)}function compareBytes$1(y,u){const g=Math.min(y.length,u.length);for(let v=0;v<g;v++){const b=y[v]-u[v];if(b!==0)return b}return y.length-u.length}function calcPaddedLen(y){if(y<=0)throw new Error("Message too short");if(y>MAX_MESSAGE_LEN)throw new Error("Message too long");if(y<=32)return 32;const u=1<<Math.ceil(Math.log2(y)),g=Math.max(32,u>>3);return Math.ceil(y/g)*g}function pad(y){const u=y.length;if(u<1)throw new Error("Message too short");if(u>MAX_MESSAGE_LEN)throw new Error("Message too long");const g=calcPaddedLen(u),v=new Uint8Array(2+g);return v[0]=u>>8&255,v[1]=u&255,v.set(y,2),v}function unpad(y){if(y.length<2+MIN_PADDED_LEN)throw new Error("Padded message too short");const u=y[0]<<8|y[1];if(u<1||u>MAX_MESSAGE_LEN)throw new Error(`Invalid message length: ${u}`);const g=calcPaddedLen(u);if(y.length!==2+g)throw new Error("Invalid padding");return y.slice(2,2+u)}function encrypt(y,u,g){const v=deriveConversationKey(u,g);return encryptWithKey(y,v)}function encryptWithKey(y,u){const v=new TextEncoder().encode(y);if(v.length>MAX_MESSAGE_LEN)throw new Error(`Message too long (max ${MAX_MESSAGE_LEN} bytes)`);const b=pad(v),w=randomBytes$3(NONCE_SIZE),E=hkdf$1(sha256$6,u,w,new Uint8Array(0),76),S=E.slice(0,32),A=E.slice(32,44),R=chacha20poly1305$1(S,A).encrypt(b),T=new Uint8Array(1+NONCE_SIZE+R.length);return T[0]=VERSION,T.set(w,1),T.set(R,1+NONCE_SIZE),toBase64(T)}function decrypt(y,u,g){const v=deriveConversationKey(u,g);return decryptWithKey(y,v)}function decryptWithKey(y,u){const g=fromBase64$2(y);if(g.length<1+NONCE_SIZE+MIN_PADDED_LEN+MAC_SIZE)throw new Error("Payload too short");if(g[0]!==VERSION)throw new Error(`Unsupported NIP-44 version: ${g[0]}`);const v=g.slice(1,1+NONCE_SIZE),b=g.slice(1+NONCE_SIZE),w=hkdf$1(sha256$6,u,v,new Uint8Array(0),76),E=w.slice(0,32),S=w.slice(32,44),$=chacha20poly1305$1(E,S).decrypt(b),R=unpad($);return new TextDecoder().decode(R)}function toBase64(y){if(typeof Buffer<"u")return Buffer.from(y).toString("base64");let u="";for(let g=0;g<y.length;g++)u+=String.fromCharCode(y[g]);return btoa(u)}function fromBase64$2(y){if(typeof Buffer<"u")return new Uint8Array(Buffer.from(y,"base64"));const u=atob(y),g=new Uint8Array(u.length);for(let v=0;v<u.length;v++)g[v]=u.charCodeAt(v);return g}class NostrKeyManager{privateKey;publicKey;cleared=!1;constructor(u){if(u.length!==32)throw new Error("Private key must be 32 bytes");this.privateKey=new Uint8Array(u),this.publicKey=getPublicKey$1(this.privateKey)}static fromPrivateKey(u){return new NostrKeyManager(u)}static fromPrivateKeyHex(u){const g=hexToBytes$4(u);return new NostrKeyManager(g)}static fromNsec(u){const g=decodeNsec(u);return new NostrKeyManager(g)}static generate(){const u=randomBytes$3(32);return new NostrKeyManager(u)}ensureNotCleared(){if(this.cleared)throw new Error("KeyManager has been cleared")}getPrivateKey(){return this.ensureNotCleared(),new Uint8Array(this.privateKey)}getPrivateKeyHex(){return this.ensureNotCleared(),bytesToHex$4(this.privateKey)}getNsec(){return this.ensureNotCleared(),encodeNsec(this.privateKey)}getPublicKey(){return this.ensureNotCleared(),new Uint8Array(this.publicKey)}getPublicKeyHex(){return this.ensureNotCleared(),bytesToHex$4(this.publicKey)}getNpub(){return this.ensureNotCleared(),encodeNpub(this.publicKey)}sign(u){return this.ensureNotCleared(),sign(u,this.privateKey)}signHex(u){return this.ensureNotCleared(),signHex(u,this.privateKey)}static verify(u,g,v){return verify(u,g,v)}static verifyHex(u,g,v){return verifyHex(u,g,v)}async encrypt(u,g){return this.ensureNotCleared(),encrypt$1(u,this.privateKey,g)}async encryptHex(u,g){this.ensureNotCleared();const v=hexToBytes$4(g);return encrypt$1(u,this.privateKey,v)}async decrypt(u,g){return this.ensureNotCleared(),decrypt$1(u,this.privateKey,g)}async decryptHex(u,g){this.ensureNotCleared();const v=hexToBytes$4(g);return decrypt$1(u,this.privateKey,v)}deriveSharedSecret(u){return this.ensureNotCleared(),deriveSharedSecret(this.privateKey,u)}encryptNip44(u,g){return this.ensureNotCleared(),encrypt(u,this.privateKey,g)}encryptNip44Hex(u,g){this.ensureNotCleared();const v=hexToBytes$4(g);return encrypt(u,this.privateKey,v)}decryptNip44(u,g){return this.ensureNotCleared(),decrypt(u,this.privateKey,g)}decryptNip44Hex(u,g){this.ensureNotCleared();const v=hexToBytes$4(g);return decrypt(u,this.privateKey,v)}deriveConversationKey(u){return this.ensureNotCleared(),deriveConversationKey(this.privateKey,u)}isMyPublicKey(u){return this.ensureNotCleared(),this.getPublicKeyHex()===u.toLowerCase()}clear(){this.privateKey.fill(0),this.cleared=!0}}let Event$1=class as{id;pubkey;created_at;kind;tags;content;sig;constructor(u){this.id=u.id,this.pubkey=u.pubkey,this.created_at=u.created_at,this.kind=u.kind,this.tags=u.tags,this.content=u.content,this.sig=u.sig}static create(u,g){const v=u.getPublicKeyHex(),b=g.created_at??Math.floor(Date.now()/1e3),w=as.calculateId(v,b,g.kind,g.tags,g.content),E=hexToBytes$4(w),S=u.signHex(E);return new as({id:w,pubkey:v,created_at:b,kind:g.kind,tags:g.tags,content:g.content,sig:S})}static calculateId(u,g,v,b,w){const E=JSON.stringify([0,u,g,v,b,w]),S=sha256$6(new TextEncoder().encode(E));return bytesToHex$4(S)}verify(){try{if(as.calculateId(this.pubkey,this.created_at,this.kind,this.tags,this.content)!==this.id)return!1;const g=hexToBytes$4(this.id),v=hexToBytes$4(this.sig),b=hexToBytes$4(this.pubkey);return verify(v,g,b)}catch{return!1}}static fromJSON(u){const g=typeof u=="string"?JSON.parse(u):u;if(!as.isValidEventData(g))throw new Error("Invalid event data");return new as(g)}static isValidEventData(u){if(typeof u!="object"||u===null)return!1;const g=u;return typeof g.id=="string"&&typeof g.pubkey=="string"&&typeof g.created_at=="number"&&typeof g.kind=="number"&&Array.isArray(g.tags)&&typeof g.content=="string"&&typeof g.sig=="string"}toJSON(){return{id:this.id,pubkey:this.pubkey,created_at:this.created_at,kind:this.kind,tags:this.tags,content:this.content,sig:this.sig}}getTagValue(u){return this.tags.find(v=>v[0]===u)?.[1]}getTagValues(u){return this.tags.filter(g=>g[0]===u).map(g=>g[1]??"")}hasTag(u){return this.tags.some(g=>g[0]===u)}getTagEntryValues(u){const g=this.tags.find(v=>v[0]===u);return g?g.slice(1):[]}};class Filter{ids;authors;kinds;"#e";"#p";"#t";"#d";"#h";since;until;limit;constructor(u){u&&(u.ids&&(this.ids=[...u.ids]),u.authors&&(this.authors=[...u.authors]),u.kinds&&(this.kinds=[...u.kinds]),u["#e"]&&(this["#e"]=[...u["#e"]]),u["#p"]&&(this["#p"]=[...u["#p"]]),u["#t"]&&(this["#t"]=[...u["#t"]]),u["#d"]&&(this["#d"]=[...u["#d"]]),u["#h"]&&(this["#h"]=[...u["#h"]]),u.since!==void 0&&(this.since=u.since),u.until!==void 0&&(this.until=u.until),u.limit!==void 0&&(this.limit=u.limit))}static builder(){return new FilterBuilder}toJSON(){const u={};return this.ids&&this.ids.length>0&&(u.ids=this.ids),this.authors&&this.authors.length>0&&(u.authors=this.authors),this.kinds&&this.kinds.length>0&&(u.kinds=this.kinds),this["#e"]&&this["#e"].length>0&&(u["#e"]=this["#e"]),this["#p"]&&this["#p"].length>0&&(u["#p"]=this["#p"]),this["#t"]&&this["#t"].length>0&&(u["#t"]=this["#t"]),this["#d"]&&this["#d"].length>0&&(u["#d"]=this["#d"]),this["#h"]&&this["#h"].length>0&&(u["#h"]=this["#h"]),this.since!==void 0&&(u.since=this.since),this.until!==void 0&&(u.until=this.until),this.limit!==void 0&&(u.limit=this.limit),u}static fromJSON(u){const g=typeof u=="string"?JSON.parse(u):u;return new Filter(g)}}class FilterBuilder{data={};ids(u,...g){return Array.isArray(u)?this.data.ids=[...u]:this.data.ids=[u,...g],this}authors(u,...g){return Array.isArray(u)?this.data.authors=[...u]:this.data.authors=[u,...g],this}kinds(u,...g){return Array.isArray(u)?this.data.kinds=[...u]:this.data.kinds=[u,...g],this}eTags(u,...g){return Array.isArray(u)?this.data["#e"]=[...u]:this.data["#e"]=[u,...g],this}pTags(u,...g){return Array.isArray(u)?this.data["#p"]=[...u]:this.data["#p"]=[u,...g],this}tTags(u,...g){return Array.isArray(u)?this.data["#t"]=[...u]:this.data["#t"]=[u,...g],this}dTags(u,...g){return Array.isArray(u)?this.data["#d"]=[...u]:this.data["#d"]=[u,...g],this}hTags(u,...g){return Array.isArray(u)?this.data["#h"]=[...u]:this.data["#h"]=[u,...g],this}since(u){return this.data.since=u,this}until(u){return this.data.until=u,this}limit(u){return this.data.limit=u,this}build(){return new Filter(this.data)}}const PROFILE=0,TEXT_NOTE=1,RECOMMEND_RELAY=2,CONTACTS=3,ENCRYPTED_DM=4,DELETION=5,SEAL=13,CHAT_MESSAGE=14,READ_RECEIPT=15,REACTION=7,GIFT_WRAP=1059,RELAY_LIST=10002,AUTH=22242,APP_DATA=30078,AGENT_PROFILE=31111,AGENT_LOCATION=31112,TOKEN_TRANSFER=31113,FILE_METADATA=31114,PAYMENT_REQUEST=31115,PAYMENT_REQUEST_RESPONSE=31116;function isReplaceable(y){return y===0||y===3||y>=1e4&&y<2e4}function isEphemeral(y){return y>=2e4&&y<3e4}function isParameterizedReplaceable(y){return y>=3e4&&y<4e4}function getName(y){switch(y){case PROFILE:return"Profile";case TEXT_NOTE:return"Text Note";case RECOMMEND_RELAY:return"Recommend Relay";case CONTACTS:return"Contacts";case ENCRYPTED_DM:return"Encrypted DM";case DELETION:return"Deletion";case SEAL:return"Seal";case CHAT_MESSAGE:return"Chat Message";case READ_RECEIPT:return"Read Receipt";case REACTION:return"Reaction";case GIFT_WRAP:return"Gift Wrap";case RELAY_LIST:return"Relay List";case APP_DATA:return"App Data";case AGENT_PROFILE:return"Agent Profile";case AGENT_LOCATION:return"Agent Location";case TOKEN_TRANSFER:return"Token Transfer";case FILE_METADATA:return"File Metadata";case PAYMENT_REQUEST:return"Payment Request";case PAYMENT_REQUEST_RESPONSE:return"Payment Request Response";default:return isReplaceable(y)?`Replaceable (${y})`:isEphemeral(y)?`Ephemeral (${y})`:isParameterizedReplaceable(y)?`Parameterized Replaceable (${y})`:`Unknown (${y})`}}var EventKinds=Object.freeze({__proto__:null,AGENT_LOCATION,AGENT_PROFILE,APP_DATA,AUTH,CHAT_MESSAGE,CONTACTS,DELETION,ENCRYPTED_DM,FILE_METADATA,GIFT_WRAP,PAYMENT_REQUEST,PAYMENT_REQUEST_RESPONSE,PROFILE,REACTION,READ_RECEIPT,RECOMMEND_RELAY,RELAY_LIST,SEAL,TEXT_NOTE,TOKEN_TRANSFER,getName,isEphemeral,isParameterizedReplaceable,isReplaceable});const OPEN=1,CLOSED=3;async function createWebSocket(y){if(typeof WebSocket>"u")throw new Error("WebSocket not available in this environment");return new WebSocket(y)}function extractMessageData(y){if(typeof y.data=="string")return y.data;if(y.data instanceof ArrayBuffer)return new TextDecoder().decode(y.data);if(typeof Blob<"u"&&y.data instanceof Blob)throw new Error("Blob messages are not supported");return String(y.data)}const TIMESTAMP_RANDOMIZATION=2880*60;function createGiftWrap(y,u,g,v){const b=createRumor(y.getPublicKeyHex(),u,g,CHAT_MESSAGE,v?.replyToEventId),w=createSeal(y,u,b);return wrapSeal(w,u)}function createReadReceipt(y,u,g){const v=[["p",u],["e",g]],b=Math.floor(Date.now()/1e3),w={id:"",pubkey:y.getPublicKeyHex(),created_at:b,kind:READ_RECEIPT,tags:v,content:""};w.id=computeRumorId(w);const E=createSeal(y,u,w);return wrapSeal(E,u)}function unwrap(y,u){if(y.kind!==GIFT_WRAP)throw new Error(`Event is not a gift wrap (kind ${y.kind})`);const g=y.pubkey,v=hexToBytes$4(g),b=decrypt(y.content,u.getPrivateKey(),v),w=JSON.parse(b);if(w.kind!==SEAL)throw new Error(`Inner event is not a seal (kind ${w.kind})`);const E=w.pubkey,S=hexToBytes$4(w.id),A=hexToBytes$4(w.sig),$=hexToBytes$4(E);if(!verify(A,S,$))throw new Error("Seal signature verification failed");const R=decrypt(w.content,u.getPrivateKey(),$),T=JSON.parse(R),O=getTagValue(T.tags,"e");return{eventId:y.id,senderPubkey:E,recipientPubkey:u.getPublicKeyHex(),content:T.content,timestamp:T.created_at,kind:T.kind,replyToEventId:O}}function createRumor(y,u,g,v,b){const w=[["p",u]];b&&w.push(["e",b,"","reply"]);const E=Math.floor(Date.now()/1e3),S={id:"",pubkey:y,created_at:E,kind:v,tags:w,content:g};return S.id=computeRumorId(S),S}function computeRumorId(y){const u=JSON.stringify([0,y.pubkey,y.created_at,y.kind,y.tags,y.content]),g=sha256$6(new TextEncoder().encode(u));return bytesToHex$4(g)}function createSeal(y,u,g){const v=JSON.stringify(g),b=hexToBytes$4(u),w=encrypt(v,y.getPrivateKey(),b),E=y.getPublicKeyHex(),S=randomizeTimestamp(),A=SEAL,$=[],R=w,T=Event$1.calculateId(E,S,A,$,R),O=hexToBytes$4(T),B=y.signHex(O);return new Event$1({id:T,pubkey:E,created_at:S,kind:A,tags:$,content:R,sig:B})}function wrapSeal(y,u){const g=NostrKeyManager.generate(),v=JSON.stringify(y.toJSON()),b=hexToBytes$4(u),w=encrypt(v,g.getPrivateKey(),b),E=g.getPublicKeyHex(),S=randomizeTimestamp(),A=GIFT_WRAP,$=[["p",u]],R=w,T=Event$1.calculateId(E,S,A,$,R),O=hexToBytes$4(T),B=g.signHex(O);return g.clear(),new Event$1({id:T,pubkey:E,created_at:S,kind:A,tags:$,content:R,sig:B})}function randomizeTimestamp(){const y=Math.floor(Date.now()/1e3),u=Math.floor(Math.random()*2*TIMESTAMP_RANDOMIZATION)-TIMESTAMP_RANDOMIZATION;return y+u}function getTagValue(y,u){return y.find(v=>v[0]===u)?.[1]}const CONNECTION_TIMEOUT_MS=3e4,DEFAULT_QUERY_TIMEOUT_MS=5e3,DEFAULT_RECONNECT_INTERVAL_MS=1e3,DEFAULT_MAX_RECONNECT_INTERVAL_MS=3e4,DEFAULT_PING_INTERVAL_MS$1=3e4,AUTH_RESUBSCRIBE_DELAY_MS=100;class NostrClient{keyManager;relays=new Map;subscriptions=new Map;eventQueue=[];pendingOks=new Map;subscriptionCounter=0;closed=!1;queryTimeoutMs;autoReconnect;reconnectIntervalMs;maxReconnectIntervalMs;pingIntervalMs;connectionListeners=[];constructor(u,g){this.keyManager=u,this.queryTimeoutMs=g?.queryTimeoutMs??DEFAULT_QUERY_TIMEOUT_MS,this.autoReconnect=g?.autoReconnect??!0,this.reconnectIntervalMs=g?.reconnectIntervalMs??DEFAULT_RECONNECT_INTERVAL_MS,this.maxReconnectIntervalMs=g?.maxReconnectIntervalMs??DEFAULT_MAX_RECONNECT_INTERVAL_MS,this.pingIntervalMs=g?.pingIntervalMs??DEFAULT_PING_INTERVAL_MS$1}addConnectionListener(u){this.connectionListeners.push(u)}removeConnectionListener(u){const g=this.connectionListeners.indexOf(u);g!==-1&&this.connectionListeners.splice(g,1)}emitConnectionEvent(u,g,v){for(const b of this.connectionListeners)try{switch(u){case"connect":b.onConnect?.(g);break;case"disconnect":b.onDisconnect?.(g,v);break;case"reconnecting":b.onReconnecting?.(g,v);break;case"reconnected":b.onReconnected?.(g);break}}catch{}}getKeyManager(){return this.keyManager}getQueryTimeout(){return this.queryTimeoutMs}setQueryTimeout(u){this.queryTimeoutMs=u}async connect(...u){if(this.closed)throw new Error("Client has been disconnected");const g=u.map(v=>this.connectToRelay(v));await Promise.all(g)}async connectToRelay(u,g=!1){const v=this.relays.get(u);if(!v?.connected)return new Promise((b,w)=>{const E=setTimeout(()=>{w(new Error(`Connection to ${u} timed out`))},CONNECTION_TIMEOUT_MS);createWebSocket(u).then(S=>{const A={url:u,socket:S,connected:!1,reconnecting:!1,reconnectAttempts:0,reconnectTimer:null,pingTimer:null,lastPongTime:Date.now(),wasConnected:v?.wasConnected??!1};S.onopen=()=>{clearTimeout(E),A.connected=!0,A.reconnectAttempts=0,A.lastPongTime=Date.now(),this.relays.set(u,A),g&&A.wasConnected?this.emitConnectionEvent("reconnected",u):this.emitConnectionEvent("connect",u),A.wasConnected=!0,this.startPingTimer(u),this.resubscribeAll(u),this.flushEventQueue(),b()},S.onmessage=$=>{try{const R=extractMessageData($),T=this.relays.get(u);T&&(T.lastPongTime=Date.now()),this.handleRelayMessage(u,R)}catch(R){console.error(`Error handling message from ${u}:`,R)}},S.onclose=$=>{const R=A.connected;if(A.connected=!1,this.stopPingTimer(u),R){const T=$?.reason||"Connection closed";this.emitConnectionEvent("disconnect",u,T)}!this.closed&&this.autoReconnect&&!A.reconnecting&&this.scheduleReconnect(u)},S.onerror=$=>{A.connected||(clearTimeout(E),w(new Error(`Failed to connect to ${u}: ${$.message||"Unknown error"}`)))},this.relays.set(u,A)}).catch(S=>{clearTimeout(E),w(S)})})}scheduleReconnect(u){const g=this.relays.get(u);if(!g||this.closed||!this.autoReconnect)return;g.reconnectTimer&&clearTimeout(g.reconnectTimer),g.reconnecting=!0,g.reconnectAttempts++;const b=this.reconnectIntervalMs*Math.pow(2,g.reconnectAttempts-1),w=Math.min(b,this.maxReconnectIntervalMs);this.emitConnectionEvent("reconnecting",u,g.reconnectAttempts),g.reconnectTimer=setTimeout(async()=>{if(!this.closed){g.reconnectTimer=null;try{g.reconnecting=!1,await this.connectToRelay(u,!0)}catch{!this.closed&&this.autoReconnect&&this.scheduleReconnect(u)}}},w)}startPingTimer(u){if(this.pingIntervalMs<=0)return;const g=this.relays.get(u);g&&(this.stopPingTimer(u),g.pingTimer=setInterval(()=>{if(!g.connected||!g.socket){this.stopPingTimer(u);return}const v=Date.now()-g.lastPongTime;if(v>this.pingIntervalMs*2){console.warn(`Relay ${u} appears stale (no response for ${v}ms), reconnecting...`),this.stopPingTimer(u);try{g.socket.close()}catch{}return}try{const b="ping",w=JSON.stringify(["CLOSE",b]);g.socket.send(w);const E=JSON.stringify(["REQ",b,{limit:1}]);g.socket.send(E)}catch{console.warn(`Ping to ${u} failed, reconnecting...`),this.stopPingTimer(u);try{g.socket.close()}catch{}}},this.pingIntervalMs))}stopPingTimer(u){const g=this.relays.get(u);g?.pingTimer&&(clearInterval(g.pingTimer),g.pingTimer=null)}resubscribeAll(u){const g=this.relays.get(u);if(!(!g?.socket||!g.connected))for(const[v,b]of this.subscriptions){const w=JSON.stringify(["REQ",v,b.filter.toJSON()]);g.socket.send(w)}}flushEventQueue(){const u=[...this.eventQueue];this.eventQueue=[];for(const g of u)this.broadcastEvent(g.event).then(()=>g.resolve(g.event.id)).catch(g.reject)}handleRelayMessage(u,g){try{const v=JSON.parse(g);if(!Array.isArray(v)||v.length<2)return;switch(v[0]){case"EVENT":this.handleEventMessage(v);break;case"OK":this.handleOkMessage(v);break;case"EOSE":this.handleEOSEMessage(v);break;case"NOTICE":this.handleNoticeMessage(v);break;case"CLOSED":this.handleClosedMessage(v);break;case"AUTH":this.handleAuthMessage(u,v);break}}catch{}}handleEventMessage(u){if(u.length<3)return;const g=u[1],v=u[2],b=this.subscriptions.get(g);if(b)try{const w=Event$1.fromJSON(v);b.listener.onEvent(w)}catch{}}handleOkMessage(u){if(u.length<4)return;const g=u[1],v=u[2],b=u[3],w=this.pendingOks.get(g);w&&(clearTimeout(w.timer),this.pendingOks.delete(g),v?w.resolve(g):w.reject(new Error(`Event rejected: ${b}`)))}handleEOSEMessage(u){if(u.length<2)return;const g=u[1],v=this.subscriptions.get(g);v?.listener.onEndOfStoredEvents&&v.listener.onEndOfStoredEvents(g)}handleNoticeMessage(u){if(u.length<2)return;const g=u[1];console.warn("Relay notice:",g)}handleClosedMessage(u){if(u.length<3)return;const g=u[1],v=u[2],b=this.subscriptions.get(g);b?.listener.onError&&b.listener.onError(g,`Subscription closed: ${v}`)}handleAuthMessage(u,g){if(g.length<2)return;const v=g[1],b=this.relays.get(u);if(!b?.socket||!b.connected)return;const w=Event$1.create(this.keyManager,{kind:AUTH,tags:[["relay",u],["challenge",v]],content:""}),E=JSON.stringify(["AUTH",w.toJSON()]);b.socket.send(E),setTimeout(()=>{this.resubscribeAll(u)},AUTH_RESUBSCRIBE_DELAY_MS)}disconnect(){this.closed=!0;for(const[,u]of this.pendingOks)clearTimeout(u.timer),u.reject(new Error("Client disconnected"));this.pendingOks.clear();for(const u of this.eventQueue)u.reject(new Error("Client disconnected"));this.eventQueue=[];for(const[u,g]of this.relays)g.pingTimer&&(clearInterval(g.pingTimer),g.pingTimer=null),g.reconnectTimer&&(clearTimeout(g.reconnectTimer),g.reconnectTimer=null),g.socket&&g.socket.readyState!==CLOSED&&g.socket.close(1e3,"Client disconnected"),this.emitConnectionEvent("disconnect",u,"Client disconnected");this.relays.clear(),this.subscriptions.clear()}isConnected(){for(const[,u]of this.relays)if(u.connected)return!0;return!1}getConnectedRelays(){const u=new Set;for(const[g,v]of this.relays)v.connected&&u.add(g);return u}async publishEvent(u){if(this.closed)throw new Error("Client has been disconnected");return this.isConnected()?this.broadcastEvent(u):new Promise((g,v)=>{this.eventQueue.push({event:u,timestamp:Date.now(),resolve:g,reject:v})})}async broadcastEvent(u){const g=JSON.stringify(["EVENT",u.toJSON()]);let v=!1;for(const[,b]of this.relays)b.connected&&b.socket?.readyState===OPEN&&(b.socket.send(g),v=!0);if(!v)throw new Error("No connected relays");return new Promise((b,w)=>{const E=setTimeout(()=>{this.pendingOks.delete(u.id),b(u.id)},5e3);this.pendingOks.set(u.id,{resolve:b,reject:w,timer:E})})}async publishEncryptedMessage(u,g){const v=await this.keyManager.encryptHex(g,u),b=Event$1.create(this.keyManager,{kind:ENCRYPTED_DM,tags:[["p",u]],content:v});return this.publishEvent(b)}async sendTokenTransfer(u,g,v){const w=await(await Promise.resolve().then(function(){return TokenTransferProtocol})).createTokenTransferEvent(this.keyManager,u,g,v);return this.publishEvent(w)}async sendPaymentRequest(u,g){const b=await(await Promise.resolve().then(function(){return PaymentRequestProtocol})).createPaymentRequestEvent(this.keyManager,u,g);return this.publishEvent(b)}async sendPaymentRequestResponse(u,g){const v=await Promise.resolve().then(function(){return PaymentRequestProtocol}),b=await v.createPaymentRequestResponseEvent(this.keyManager,u,{requestId:g.requestId,originalEventId:g.originalEventId,status:g.status==="DECLINED"?v.ResponseStatus.DECLINED:v.ResponseStatus.EXPIRED,reason:g.reason});return this.publishEvent(b)}async sendPaymentRequestDecline(u,g,v,b){return this.sendPaymentRequestResponse(u,{requestId:v,originalEventId:g,status:"DECLINED",reason:b})}async publishNametagBinding(u,g){const b=await(await Promise.resolve().then(function(){return NametagBinding})).createBindingEvent(this.keyManager,u,g);try{return await this.publishEvent(b),!0}catch{return!1}}subscribe(u,g,v){let b,w,E;typeof u=="string"?(b=u,w=g,E=v):(b=`sub_${++this.subscriptionCounter}`,w=u,E=g),this.subscriptions.set(b,{filter:w,listener:E});const S=JSON.stringify(["REQ",b,w.toJSON()]);for(const[,A]of this.relays)A.connected&&A.socket?.readyState===OPEN&&A.socket.send(S);return b}unsubscribe(u){if(!this.subscriptions.has(u))return;this.subscriptions.delete(u);const g=JSON.stringify(["CLOSE",u]);for(const[,v]of this.relays)v.connected&&v.socket?.readyState===OPEN&&v.socket.send(g)}async queryPubkeyByNametag(u){const v=(await Promise.resolve().then(function(){return NametagBinding})).createNametagToPubkeyFilter(u);return new Promise(b=>{const w=setTimeout(()=>{this.unsubscribe(A),b(null)},this.queryTimeoutMs);let E=null,S=0;const A=this.subscribe(v,{onEvent:$=>{$.created_at>S&&(S=$.created_at,E=$.pubkey)},onEndOfStoredEvents:()=>{clearTimeout(w),this.unsubscribe(A),b(E)}})})}async createAndPublishEvent(u){const g=Event$1.create(this.keyManager,u);return this.publishEvent(g)}async sendPrivateMessage(u,g,v){const b=createGiftWrap(this.keyManager,u,g,v);return this.publishEvent(b)}async sendPrivateMessageToNametag(u,g,v){const b=await this.queryPubkeyByNametag(u);if(!b)throw new Error(`Nametag not found: ${u}`);return this.sendPrivateMessage(b,g,v)}async sendReadReceipt(u,g){const v=createReadReceipt(this.keyManager,u,g);return this.publishEvent(v)}unwrapPrivateMessage(u){return unwrap(u,this.keyManager)}}var metadata={version:4,country_calling_codes:{1:["US","AG","AI","AS","BB","BM","BS","CA","DM","DO","GD","GU","JM","KN","KY","LC","MP","MS","PR","SX","TC","TT","VC","VG","VI"],7:["RU","KZ"],20:["EG"],27:["ZA"],30:["GR"],31:["NL"],32:["BE"],33:["FR"],34:["ES"],36:["HU"],39:["IT","VA"],40:["RO"],41:["CH"],43:["AT"],44:["GB","GG","IM","JE"],45:["DK"],46:["SE"],47:["NO","SJ"],48:["PL"],49:["DE"],51:["PE"],52:["MX"],53:["CU"],54:["AR"],55:["BR"],56:["CL"],57:["CO"],58:["VE"],60:["MY"],61:["AU","CC","CX"],62:["ID"],63:["PH"],64:["NZ"],65:["SG"],66:["TH"],81:["JP"],82:["KR"],84:["VN"],86:["CN"],90:["TR"],91:["IN"],92:["PK"],93:["AF"],94:["LK"],95:["MM"],98:["IR"],211:["SS"],212:["MA","EH"],213:["DZ"],216:["TN"],218:["LY"],220:["GM"],221:["SN"],222:["MR"],223:["ML"],224:["GN"],225:["CI"],226:["BF"],227:["NE"],228:["TG"],229:["BJ"],230:["MU"],231:["LR"],232:["SL"],233:["GH"],234:["NG"],235:["TD"],236:["CF"],237:["CM"],238:["CV"],239:["ST"],240:["GQ"],241:["GA"],242:["CG"],243:["CD"],244:["AO"],245:["GW"],246:["IO"],247:["AC"],248:["SC"],249:["SD"],250:["RW"],251:["ET"],252:["SO"],253:["DJ"],254:["KE"],255:["TZ"],256:["UG"],257:["BI"],258:["MZ"],260:["ZM"],261:["MG"],262:["RE","YT"],263:["ZW"],264:["NA"],265:["MW"],266:["LS"],267:["BW"],268:["SZ"],269:["KM"],290:["SH","TA"],291:["ER"],297:["AW"],298:["FO"],299:["GL"],350:["GI"],351:["PT"],352:["LU"],353:["IE"],354:["IS"],355:["AL"],356:["MT"],357:["CY"],358:["FI","AX"],359:["BG"],370:["LT"],371:["LV"],372:["EE"],373:["MD"],374:["AM"],375:["BY"],376:["AD"],377:["MC"],378:["SM"],380:["UA"],381:["RS"],382:["ME"],383:["XK"],385:["HR"],386:["SI"],387:["BA"],389:["MK"],420:["CZ"],421:["SK"],423:["LI"],500:["FK"],501:["BZ"],502:["GT"],503:["SV"],504:["HN"],505:["NI"],506:["CR"],507:["PA"],508:["PM"],509:["HT"],590:["GP","BL","MF"],591:["BO"],592:["GY"],593:["EC"],594:["GF"],595:["PY"],596:["MQ"],597:["SR"],598:["UY"],599:["CW","BQ"],670:["TL"],672:["NF"],673:["BN"],674:["NR"],675:["PG"],676:["TO"],677:["SB"],678:["VU"],679:["FJ"],680:["PW"],681:["WF"],682:["CK"],683:["NU"],685:["WS"],686:["KI"],687:["NC"],688:["TV"],689:["PF"],690:["TK"],691:["FM"],692:["MH"],850:["KP"],852:["HK"],853:["MO"],855:["KH"],856:["LA"],880:["BD"],886:["TW"],960:["MV"],961:["LB"],962:["JO"],963:["SY"],964:["IQ"],965:["KW"],966:["SA"],967:["YE"],968:["OM"],970:["PS"],971:["AE"],972:["IL"],973:["BH"],974:["QA"],975:["BT"],976:["MN"],977:["NP"],992:["TJ"],993:["TM"],994:["AZ"],995:["GE"],996:["KG"],998:["UZ"]},countries:{AC:["247","00","(?:[01589]\\d|[46])\\d{4}",[5,6]],AD:["376","00","(?:1|6\\d)\\d{7}|[135-9]\\d{5}",[6,8,9],[["(\\d{3})(\\d{3})","$1 $2",["[135-9]"]],["(\\d{4})(\\d{4})","$1 $2",["1"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["6"]]]],AE:["971","00","(?:[4-7]\\d|9[0-689])\\d{7}|800\\d{2,9}|[2-4679]\\d{7}",[5,6,7,8,9,10,11,12],[["(\\d{3})(\\d{2,9})","$1 $2",["60|8"]],["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["[236]|[479][2-8]"],"0$1"],["(\\d{3})(\\d)(\\d{5})","$1 $2 $3",["[479]"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["5"],"0$1"]],"0"],AF:["93","00","[2-7]\\d{8}",[9],[["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[2-7]"],"0$1"]],"0"],AG:["1","011","(?:268|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([457]\\d{6})$|1","268$1",0,"268"],AI:["1","011","(?:264|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2457]\\d{6})$|1","264$1",0,"264"],AL:["355","00","(?:700\\d\\d|900)\\d{3}|8\\d{5,7}|(?:[2-5]|6\\d)\\d{7}",[6,7,8,9],[["(\\d{3})(\\d{3,4})","$1 $2",["80|9"],"0$1"],["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["4[2-6]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[2358][2-5]|4"],"0$1"],["(\\d{3})(\\d{5})","$1 $2",["[23578]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["6"],"0$1"]],"0"],AM:["374","00","(?:[1-489]\\d|55|60|77)\\d{6}",[8],[["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["[89]0"],"0 $1"],["(\\d{3})(\\d{5})","$1 $2",["2|3[12]"],"(0$1)"],["(\\d{2})(\\d{6})","$1 $2",["1|47"],"(0$1)"],["(\\d{2})(\\d{6})","$1 $2",["[3-9]"],"0$1"]],"0"],AO:["244","00","[29]\\d{8}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[29]"]]]],AR:["54","00","(?:11|[89]\\d\\d)\\d{8}|[2368]\\d{9}",[10,11],[["(\\d{4})(\\d{2})(\\d{4})","$1 $2-$3",["2(?:2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(?:3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9])","2(?:[23]02|6(?:[25]|4[6-8])|9(?:[02356]|4[02568]|72|8[23]))|3(?:3[28]|4(?:[04679]|3[5-8]|5[4-68]|8[2379])|5(?:[2467]|3[237]|8[2-5])|7[1-578]|8(?:[2469]|3[2578]|5[4-8]|7[36-8]|8[5-8]))|2(?:2[24-9]|3[1-59]|47)","2(?:[23]02|6(?:[25]|4(?:64|[78]))|9(?:[02356]|4(?:[0268]|5[2-6])|72|8[23]))|3(?:3[28]|4(?:[04679]|3[78]|5(?:4[46]|8)|8[2379])|5(?:[2467]|3[237]|8[23])|7[1-578]|8(?:[2469]|3[278]|5[56][46]|86[3-6]))|2(?:2[24-9]|3[1-59]|47)|38(?:[58][78]|7[378])|3(?:4[35][56]|58[45]|8(?:[38]5|54|76))[4-6]","2(?:[23]02|6(?:[25]|4(?:64|[78]))|9(?:[02356]|4(?:[0268]|5[2-6])|72|8[23]))|3(?:3[28]|4(?:[04679]|3(?:5(?:4[0-25689]|[56])|[78])|58|8[2379])|5(?:[2467]|3[237]|8(?:[23]|4(?:[45]|60)|5(?:4[0-39]|5|64)))|7[1-578]|8(?:[2469]|3[278]|54(?:4|5[13-7]|6[89])|86[3-6]))|2(?:2[24-9]|3[1-59]|47)|38(?:[58][78]|7[378])|3(?:454|85[56])[46]|3(?:4(?:36|5[56])|8(?:[38]5|76))[4-6]"],"0$1",1],["(\\d{2})(\\d{4})(\\d{4})","$1 $2-$3",["1"],"0$1",1],["(\\d{3})(\\d{3})(\\d{4})","$1-$2-$3",["[68]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2-$3",["[23]"],"0$1",1],["(\\d)(\\d{4})(\\d{2})(\\d{4})","$2 15-$3-$4",["9(?:2[2-469]|3[3-578])","9(?:2(?:2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(?:3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9]))","9(?:2(?:[23]02|6(?:[25]|4[6-8])|9(?:[02356]|4[02568]|72|8[23]))|3(?:3[28]|4(?:[04679]|3[5-8]|5[4-68]|8[2379])|5(?:[2467]|3[237]|8[2-5])|7[1-578]|8(?:[2469]|3[2578]|5[4-8]|7[36-8]|8[5-8])))|92(?:2[24-9]|3[1-59]|47)","9(?:2(?:[23]02|6(?:[25]|4(?:64|[78]))|9(?:[02356]|4(?:[0268]|5[2-6])|72|8[23]))|3(?:3[28]|4(?:[04679]|3[78]|5(?:4[46]|8)|8[2379])|5(?:[2467]|3[237]|8[23])|7[1-578]|8(?:[2469]|3[278]|5(?:[56][46]|[78])|7[378]|8(?:6[3-6]|[78]))))|92(?:2[24-9]|3[1-59]|47)|93(?:4[35][56]|58[45]|8(?:[38]5|54|76))[4-6]","9(?:2(?:[23]02|6(?:[25]|4(?:64|[78]))|9(?:[02356]|4(?:[0268]|5[2-6])|72|8[23]))|3(?:3[28]|4(?:[04679]|3(?:5(?:4[0-25689]|[56])|[78])|5(?:4[46]|8)|8[2379])|5(?:[2467]|3[237]|8(?:[23]|4(?:[45]|60)|5(?:4[0-39]|5|64)))|7[1-578]|8(?:[2469]|3[278]|5(?:4(?:4|5[13-7]|6[89])|[56][46]|[78])|7[378]|8(?:6[3-6]|[78]))))|92(?:2[24-9]|3[1-59]|47)|93(?:4(?:36|5[56])|8(?:[38]5|76))[4-6]"],"0$1",0,"$1 $2 $3-$4"],["(\\d)(\\d{2})(\\d{4})(\\d{4})","$2 15-$3-$4",["91"],"0$1",0,"$1 $2 $3-$4"],["(\\d{3})(\\d{3})(\\d{5})","$1-$2-$3",["8"],"0$1"],["(\\d)(\\d{3})(\\d{3})(\\d{4})","$2 15-$3-$4",["9"],"0$1",0,"$1 $2 $3-$4"]],"0",0,"0?(?:(11|2(?:2(?:02?|[13]|2[13-79]|4[1-6]|5[2457]|6[124-8]|7[1-4]|8[13-6]|9[1267])|3(?:02?|1[467]|2[03-6]|3[13-8]|[49][2-6]|5[2-8]|[67])|4(?:7[3-578]|9)|6(?:[0136]|2[24-6]|4[6-8]?|5[15-8])|80|9(?:0[1-3]|[19]|2\\d|3[1-6]|4[02568]?|5[2-4]|6[2-46]|72?|8[23]?))|3(?:3(?:2[79]|6|8[2578])|4(?:0[0-24-9]|[12]|3[5-8]?|4[24-7]|5[4-68]?|6[02-9]|7[126]|8[2379]?|9[1-36-8])|5(?:1|2[1245]|3[237]?|4[1-46-9]|6[2-4]|7[1-6]|8[2-5]?)|6[24]|7(?:[069]|1[1568]|2[15]|3[145]|4[13]|5[14-8]|7[2-57]|8[126])|8(?:[01]|2[15-7]|3[2578]?|4[13-6]|5[4-8]?|6[1-357-9]|7[36-8]?|8[5-8]?|9[124])))15)?","9$1"],AS:["1","011","(?:[58]\\d\\d|684|900)\\d{7}",[10],0,"1",0,"([267]\\d{6})$|1","684$1",0,"684"],AT:["43","00","1\\d{3,12}|2\\d{6,12}|43(?:(?:0\\d|5[02-9])\\d{3,9}|2\\d{4,5}|[3467]\\d{4}|8\\d{4,6}|9\\d{4,7})|5\\d{4,12}|8\\d{7,12}|9\\d{8,12}|(?:[367]\\d|4[0-24-9])\\d{4,11}",[4,5,6,7,8,9,10,11,12,13],[["(\\d)(\\d{3,12})","$1 $2",["1(?:11|[2-9])"],"0$1"],["(\\d{3})(\\d{2})","$1 $2",["517"],"0$1"],["(\\d{2})(\\d{3,5})","$1 $2",["5[079]"],"0$1"],["(\\d{3})(\\d{3,10})","$1 $2",["(?:31|4)6|51|6(?:48|5[0-3579]|[6-9])|7(?:20|32|8)|[89]","(?:31|4)6|51|6(?:485|5[0-3579]|[6-9])|7(?:20|32|8)|[89]"],"0$1"],["(\\d{4})(\\d{3,9})","$1 $2",["[2-467]|5[2-6]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["5"],"0$1"],["(\\d{2})(\\d{4})(\\d{4,7})","$1 $2 $3",["5"],"0$1"]],"0"],AU:["61","001[14-689]|14(?:1[14]|34|4[17]|[56]6|7[47]|88)0011","1(?:[0-79]\\d{7}(?:\\d(?:\\d{2})?)?|8[0-24-9]\\d{7})|[2-478]\\d{8}|1\\d{4,7}",[5,6,7,8,9,10,12],[["(\\d{2})(\\d{3,4})","$1 $2",["16"],"0$1"],["(\\d{2})(\\d{3})(\\d{2,4})","$1 $2 $3",["16"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["14|4"],"0$1"],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["[2378]"],"(0$1)"],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1(?:30|[89])"]]],"0",0,"(183[12])|0",0,0,0,[["(?:(?:241|349)0\\d\\d|8(?:51(?:0(?:0[03-9]|[12479]\\d|3[2-9]|5[0-8]|6[1-9]|8[0-7])|1(?:[0235689]\\d|1[0-69]|4[0-589]|7[0-47-9])|2(?:0[0-79]|[18][13579]|2[14-9]|3[0-46-9]|[4-6]\\d|7[89]|9[0-4])|[34]\\d\\d)|91(?:(?:[0-58]\\d|6[0135-9])\\d|7(?:0[0-24-9]|[1-9]\\d)|9(?:[0-46-9]\\d|5[0-79]))))\\d{3}|(?:2(?:[0-26-9]\\d|3[0-8]|4[02-9]|5[0135-9])|3(?:[0-3589]\\d|4[0-578]|6[1-9]|7[0-35-9])|7(?:[013-57-9]\\d|2[0-8])|8(?:55|6[0-8]|[78]\\d|9[02-9]))\\d{6}",[9]],["4(?:79[01]|83[0-36-9]|95[0-3])\\d{5}|4(?:[0-36]\\d|4[047-9]|[58][0-24-9]|7[02-8]|9[0-47-9])\\d{6}",[9]],["180(?:0\\d{3}|2)\\d{3}",[7,10]],["190[0-26]\\d{6}",[10]],0,0,0,["163\\d{2,6}",[5,6,7,8,9]],["14(?:5(?:1[0458]|[23][458])|71\\d)\\d{4}",[9]],["13(?:00\\d{6}(?:\\d{2})?|45[0-4]\\d{3})|13\\d{4}",[6,8,10,12]]],"0011"],AW:["297","00","(?:[25-79]\\d\\d|800)\\d{4}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[25-9]"]]]],AX:["358","00|99(?:[01469]|5(?:[14]1|3[23]|5[59]|77|88|9[09]))","2\\d{4,9}|35\\d{4,5}|(?:60\\d\\d|800)\\d{4,6}|7\\d{5,11}|(?:[14]\\d|3[0-46-9]|50)\\d{4,8}",[5,6,7,8,9,10,11,12],0,"0",0,0,0,0,"18",0,"00"],AZ:["994","00","365\\d{6}|(?:[124579]\\d|60|88)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["90"],"0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["1[28]|2|365|46","1[28]|2|365[45]|46","1[28]|2|365(?:4|5[02])|46"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[13-9]"],"0$1"]],"0"],BA:["387","00","6\\d{8}|(?:[35689]\\d|49|70)\\d{6}",[8,9],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["6[1-3]|[7-9]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2-$3",["[3-5]|6[56]"],"0$1"],["(\\d{2})(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3 $4",["6"],"0$1"]],"0"],BB:["1","011","(?:246|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","246$1",0,"246"],BD:["880","00","[1-469]\\d{9}|8[0-79]\\d{7,8}|[2-79]\\d{8}|[2-9]\\d{7}|[3-9]\\d{6}|[57-9]\\d{5}",[6,7,8,9,10],[["(\\d{2})(\\d{4,6})","$1-$2",["31[5-8]|[459]1"],"0$1"],["(\\d{3})(\\d{3,7})","$1-$2",["3(?:[67]|8[013-9])|4(?:6[168]|7|[89][18])|5(?:6[128]|9)|6(?:[15]|28|4[14])|7[2-589]|8(?:0[014-9]|[12])|9[358]|(?:3[2-5]|4[235]|5[2-578]|6[0389]|76|8[3-7]|9[24])1|(?:44|66)[01346-9]"],"0$1"],["(\\d{4})(\\d{3,6})","$1-$2",["[13-9]|2[23]"],"0$1"],["(\\d)(\\d{7,8})","$1-$2",["2"],"0$1"]],"0"],BE:["32","00","4\\d{8}|[1-9]\\d{7}",[8,9],[["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["(?:80|9)0"],"0$1"],["(\\d)(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[239]|4[23]"],"0$1"],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[15-8]"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["4"],"0$1"]],"0"],BF:["226","00","(?:[025-7]\\d|44)\\d{6}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[024-7]"]]]],BG:["359","00","00800\\d{7}|[2-7]\\d{6,7}|[89]\\d{6,8}|2\\d{5}",[6,7,8,9,12],[["(\\d)(\\d)(\\d{2})(\\d{2})","$1 $2 $3 $4",["2"],"0$1"],["(\\d{3})(\\d{4})","$1 $2",["43[1-6]|70[1-9]"],"0$1"],["(\\d)(\\d{3})(\\d{3,4})","$1 $2 $3",["2"],"0$1"],["(\\d{2})(\\d{3})(\\d{2,3})","$1 $2 $3",["[356]|4[124-7]|7[1-9]|8[1-6]|9[1-7]"],"0$1"],["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["(?:70|8)0"],"0$1"],["(\\d{3})(\\d{3})(\\d{2})","$1 $2 $3",["43[1-7]|7"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[48]|9[08]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["9"],"0$1"]],"0"],BH:["973","00","[136-9]\\d{7}",[8],[["(\\d{4})(\\d{4})","$1 $2",["[13679]|8[02-4679]"]]]],BI:["257","00","(?:[267]\\d|31)\\d{6}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2367]"]]]],BJ:["229","00","(?:01\\d|8)\\d{7}",[8,10],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4 $5",["0"]]]],BL:["590","00","(?:590\\d|7090)\\d{5}|(?:69|80|9\\d)\\d{7}",[9],0,"0",0,0,0,0,0,[["590(?:2[7-9]|3[3-7]|5[12]|87)\\d{4}"],["(?:69(?:0\\d\\d|1(?:2[2-9]|3[0-5])|4(?:0[89]|1[2-6]|9\\d)|6(?:1[016-9]|5[0-4]|[67]\\d))|7090[0-4])\\d{4}"],["80[0-5]\\d{6}"],0,0,0,0,0,["9(?:(?:39[5-7]|76[018])\\d|475[0-6])\\d{4}"]]],BM:["1","011","(?:441|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","441$1",0,"441"],BN:["673","00","[2-578]\\d{6}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[2-578]"]]]],BO:["591","00(?:1\\d)?","8001\\d{5}|(?:[2-467]\\d|50)\\d{6}",[8,9],[["(\\d)(\\d{7})","$1 $2",["[235]|4[46]"]],["(\\d{8})","$1",["[67]"]],["(\\d{3})(\\d{2})(\\d{4})","$1 $2 $3",["8"]]],"0",0,"0(1\\d)?"],BQ:["599","00","(?:[34]1|7\\d)\\d{5}",[7],0,0,0,0,0,0,"[347]"],BR:["55","00(?:1[245]|2[1-35]|31|4[13]|[56]5|99)","[1-467]\\d{9,10}|55[0-46-9]\\d{8}|[34]\\d{7}|55\\d{7,8}|(?:5[0-46-9]|[89]\\d)\\d{7,9}",[8,9,10,11],[["(\\d{4})(\\d{4})","$1-$2",["300|4(?:0[02]|37|86)","300|4(?:0(?:0|20)|370|864)"]],["(\\d{3})(\\d{2,3})(\\d{4})","$1 $2 $3",["(?:[358]|90)0"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1 $2-$3",["(?:[14689][1-9]|2[12478]|3[1-578]|5[13-5]|7[13-579])[2-57]"],"($1)"],["(\\d{2})(\\d{5})(\\d{4})","$1 $2-$3",["[16][1-9]|[2-57-9]"],"($1)"]],"0",0,"(?:0|90)(?:(1[245]|2[1-35]|31|4[13]|[56]5|99)(\\d{10,11}))?","$2"],BS:["1","011","(?:242|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([3-8]\\d{6})$|1","242$1",0,"242"],BT:["975","00","[178]\\d{7}|[2-8]\\d{6}",[7,8],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["[2-6]|7[246]|8[2-4]"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["1[67]|[78]"]]]],BW:["267","00","(?:0800|(?:[37]|800)\\d)\\d{6}|(?:[2-6]\\d|90)\\d{5}",[7,8,10],[["(\\d{2})(\\d{5})","$1 $2",["90"]],["(\\d{3})(\\d{4})","$1 $2",["[24-6]|3[15-9]"]],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[37]"]],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["0"]],["(\\d{3})(\\d{4})(\\d{3})","$1 $2 $3",["8"]]]],BY:["375","810","(?:[12]\\d|33|44|902)\\d{7}|8(?:0[0-79]\\d{5,7}|[1-7]\\d{9})|8(?:1[0-489]|[5-79]\\d)\\d{7}|8[1-79]\\d{6,7}|8[0-79]\\d{5}|8\\d{5}",[6,7,8,9,10,11],[["(\\d{3})(\\d{3})","$1 $2",["800"],"8 $1"],["(\\d{3})(\\d{2})(\\d{2,4})","$1 $2 $3",["800"],"8 $1"],["(\\d{4})(\\d{2})(\\d{3})","$1 $2-$3",["1(?:5[169]|6[3-5]|7[179])|2(?:1[35]|2[34]|3[3-5])","1(?:5[169]|6(?:3[1-3]|4|5[125])|7(?:1[3-9]|7[0-24-6]|9[2-7]))|2(?:1[35]|2[34]|3[3-5])"],"8 0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2-$3-$4",["1(?:[56]|7[467])|2[1-3]"],"8 0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2-$3-$4",["[1-4]"],"8 0$1"],["(\\d{3})(\\d{3,4})(\\d{4})","$1 $2 $3",["[89]"],"8 $1"]],"8",0,"0|80?",0,0,0,0,"8~10"],BZ:["501","00","(?:0800\\d|[2-8])\\d{6}",[7,11],[["(\\d{3})(\\d{4})","$1-$2",["[2-8]"]],["(\\d)(\\d{3})(\\d{4})(\\d{3})","$1-$2-$3-$4",["0"]]]],CA:["1","011","[2-9]\\d{9}|3\\d{6}",[7,10],0,"1",0,0,0,0,0,[["(?:2(?:04|[23]6|[48]9|5[07]|63)|3(?:06|43|54|6[578]|82)|4(?:03|1[68]|[26]8|3[178]|50|74)|5(?:06|1[49]|48|79|8[147])|6(?:04|[18]3|39|47|72)|7(?:0[59]|42|53|78|8[02])|8(?:[06]7|19|25|7[39])|9(?:0[25]|42))[2-9]\\d{6}",[10]],["",[10]],["8(?:00|33|44|55|66|77|88)[2-9]\\d{6}",[10]],["900[2-9]\\d{6}",[10]],["52(?:3(?:[2-46-9][02-9]\\d|5(?:[02-46-9]\\d|5[0-46-9]))|4(?:[2-478][02-9]\\d|5(?:[034]\\d|2[024-9]|5[0-46-9])|6(?:0[1-9]|[2-9]\\d)|9(?:[05-9]\\d|2[0-5]|49)))\\d{4}|52[34][2-9]1[02-9]\\d{4}|(?:5(?:2[125-9]|33|44|66|77|88)|6(?:22|33))[2-9]\\d{6}",[10]],0,["310\\d{4}",[7]],0,["600[2-9]\\d{6}",[10]]]],CC:["61","001[14-689]|14(?:1[14]|34|4[17]|[56]6|7[47]|88)0011","1(?:[0-79]\\d{8}(?:\\d{2})?|8[0-24-9]\\d{7})|[148]\\d{8}|1\\d{5,7}",[6,7,8,9,10,12],0,"0",0,"([59]\\d{7})$|0","8$1",0,0,[["8(?:51(?:0(?:02|31|60|89)|1(?:18|76)|223)|91(?:0(?:1[0-2]|29)|1(?:[28]2|50|79)|2(?:10|64)|3(?:[06]8|22)|4[29]8|62\\d|70[23]|959))\\d{3}",[9]],["4(?:79[01]|83[0-36-9]|95[0-3])\\d{5}|4(?:[0-36]\\d|4[047-9]|[58][0-24-9]|7[02-8]|9[0-47-9])\\d{6}",[9]],["180(?:0\\d{3}|2)\\d{3}",[7,10]],["190[0-26]\\d{6}",[10]],0,0,0,0,["14(?:5(?:1[0458]|[23][458])|71\\d)\\d{4}",[9]],["13(?:00\\d{6}(?:\\d{2})?|45[0-4]\\d{3})|13\\d{4}",[6,8,10,12]]],"0011"],CD:["243","00","(?:(?:[189]|5\\d)\\d|2)\\d{7}|[1-68]\\d{6}",[7,8,9,10],[["(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3",["88"],"0$1"],["(\\d{2})(\\d{5})","$1 $2",["[1-6]"],"0$1"],["(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3",["2"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["1"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[89]"],"0$1"],["(\\d{2})(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3 $4",["5"],"0$1"]],"0"],CF:["236","00","(?:[27]\\d{3}|8776)\\d{4}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[278]"]]]],CG:["242","00","222\\d{6}|(?:0\\d|80)\\d{7}",[9],[["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["8"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[02]"]]]],CH:["41","00","8\\d{11}|[2-9]\\d{8}",[9,12],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["8[047]|90"],"0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2-79]|81"],"0$1"],["(\\d{3})(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4 $5",["8"],"0$1"]],"0"],CI:["225","00","[02]\\d{9}",[10],[["(\\d{2})(\\d{2})(\\d)(\\d{5})","$1 $2 $3 $4",["2"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3 $4",["0"]]]],CK:["682","00","[2-578]\\d{4}",[5],[["(\\d{2})(\\d{3})","$1 $2",["[2-578]"]]]],CL:["56","(?:0|1(?:1[0-69]|2[02-5]|5[13-58]|69|7[0167]|8[018]))0","12300\\d{6}|6\\d{9,10}|[2-9]\\d{8}",[9,10,11],[["(\\d{5})(\\d{4})","$1 $2",["219","2196"],"($1)"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["60|809"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["44"]],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["2[1-36]"],"($1)"],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["9(?:10|[2-9])"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["3[2-5]|[47]|5[1-3578]|6[13-57]|8(?:0[1-8]|[1-9])"],"($1)"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["60|8"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["1"]],["(\\d{3})(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3 $4",["60"]]]],CM:["237","00","[26]\\d{8}|88\\d{6,7}",[8,9],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["88"]],["(\\d)(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4 $5",["[26]|88"]]]],CN:["86","00|1(?:[12]\\d|79)\\d\\d00","(?:(?:1[03-689]|2\\d)\\d\\d|6)\\d{8}|1\\d{10}|[126]\\d{6}(?:\\d(?:\\d{2})?)?|86\\d{5,6}|(?:[3-579]\\d|8[0-57-9])\\d{5,9}",[7,8,9,10,11,12],[["(\\d{2})(\\d{5,6})","$1 $2",["(?:10|2[0-57-9])[19]|3(?:[157]|35|49|9[1-68])|4(?:1[124-9]|2[179]|6[47-9]|7|8[23])|5(?:[1357]|2[37]|4[36]|6[1-46]|80)|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:07|1[236-8]|2[5-7]|[37]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|3|4[13]|5[1-5]|7[0-79]|9[0-35-9])|(?:4[35]|59|85)[1-9]","(?:10|2[0-57-9])(?:1[02]|9[56])|8078|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:1[124-9]|2[179]|[35][1-9]|6[47-9]|7\\d|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[1-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|3\\d|4[13]|5[1-5]|7[0-79]|9[0-35-9]))1","10(?:1(?:0|23)|9[56])|2[0-57-9](?:1(?:00|23)|9[56])|80781|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:1[124-9]|2[179]|[35][1-9]|6[47-9]|7\\d|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[1-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|3\\d|4[13]|5[1-5]|7[0-79]|9[0-35-9]))12","10(?:1(?:0|23)|9[56])|2[0-57-9](?:1(?:00|23)|9[56])|807812|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:1[124-9]|2[179]|[35][1-9]|6[47-9]|7\\d|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[1-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|3\\d|4[13]|5[1-5]|7[0-79]|9[0-35-9]))123","10(?:1(?:0|23)|9[56])|2[0-57-9](?:1(?:00|23)|9[56])|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:1[124-9]|2[179]|[35][1-9]|6[47-9]|7\\d|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:078|1[236-8]|2[5-7]|[37]\\d|5[1-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|3\\d|4[13]|5[1-5]|7[0-79]|9[0-35-9]))123"],"0$1"],["(\\d{3})(\\d{5,6})","$1 $2",["3(?:[157]|35|49|9[1-68])|4(?:[17]|2[179]|6[47-9]|8[23])|5(?:[1357]|2[37]|4[36]|6[1-46]|80)|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|[379]|4[13]|5[1-5])|(?:4[35]|59|85)[1-9]","(?:3(?:[157]\\d|35|49|9[1-68])|4(?:[17]\\d|2[179]|[35][1-9]|6[47-9]|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[1-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|[379]\\d|4[13]|5[1-5]))[19]","85[23](?:10|95)|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:[17]\\d|2[179]|[35][1-9]|6[47-9]|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[14-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|[379]\\d|4[13]|5[1-5]))(?:10|9[56])","85[23](?:100|95)|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:[17]\\d|2[179]|[35][1-9]|6[47-9]|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[14-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|[379]\\d|4[13]|5[1-5]))(?:100|9[56])"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["(?:4|80)0"]],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["10|2(?:[02-57-9]|1[1-9])","10|2(?:[02-57-9]|1[1-9])","10[0-79]|2(?:[02-57-9]|1[1-79])|(?:10|21)8(?:0[1-9]|[1-9])"],"0$1",1],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["3(?:[3-59]|7[02-68])|4(?:[26-8]|3[3-9]|5[2-9])|5(?:3[03-9]|[468]|7[028]|9[2-46-9])|6|7(?:[0-247]|3[04-9]|5[0-4689]|6[2368])|8(?:[1-358]|9[1-7])|9(?:[013479]|5[1-5])|(?:[34]1|55|79|87)[02-9]"],"0$1",1],["(\\d{3})(\\d{7,8})","$1 $2",["9"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["80"],"0$1",1],["(\\d{3})(\\d{4})(\\d{4})","$1 $2 $3",["[3-578]"],"0$1",1],["(\\d{3})(\\d{4})(\\d{4})","$1 $2 $3",["1[3-9]"]],["(\\d{2})(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3 $4",["[12]"],"0$1",1]],"0",0,"(1(?:[12]\\d|79)\\d\\d)|0",0,0,0,0,"00"],CO:["57","00(?:4(?:[14]4|56)|[579])","(?:46|60\\d\\d)\\d{6}|(?:1\\d|[39])\\d{9}",[8,10,11],[["(\\d{4})(\\d{4})","$1 $2",["46"]],["(\\d{3})(\\d{7})","$1 $2",["6|90"],"($1)"],["(\\d{3})(\\d{7})","$1 $2",["3[0-357]|9[14]"]],["(\\d)(\\d{3})(\\d{7})","$1-$2-$3",["1"],"0$1",0,"$1 $2 $3"]],"0",0,"0([3579]|4(?:[14]4|56))?"],CR:["506","00","(?:8\\d|90)\\d{8}|(?:[24-8]\\d{3}|3005)\\d{4}",[8,10],[["(\\d{4})(\\d{4})","$1 $2",["[2-7]|8[3-9]"]],["(\\d{3})(\\d{3})(\\d{4})","$1-$2-$3",["[89]"]]],0,0,"(19(?:0[0-2468]|1[09]|20|66|77|99))"],CU:["53","119","(?:[2-7]|8\\d\\d)\\d{7}|[2-47]\\d{6}|[34]\\d{5}",[6,7,8,10],[["(\\d{2})(\\d{4,6})","$1 $2",["2[1-4]|[34]"],"(0$1)"],["(\\d)(\\d{6,7})","$1 $2",["7"],"(0$1)"],["(\\d)(\\d{7})","$1 $2",["[56]"],"0$1"],["(\\d{3})(\\d{7})","$1 $2",["8"],"0$1"]],"0"],CV:["238","0","(?:[2-59]\\d\\d|800)\\d{4}",[7],[["(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3",["[2-589]"]]]],CW:["599","00","(?:[34]1|60|(?:7|9\\d)\\d)\\d{5}",[7,8],[["(\\d{3})(\\d{4})","$1 $2",["[3467]"]],["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["9[4-8]"]]],0,0,0,0,0,"[69]"],CX:["61","001[14-689]|14(?:1[14]|34|4[17]|[56]6|7[47]|88)0011","1(?:[0-79]\\d{8}(?:\\d{2})?|8[0-24-9]\\d{7})|[148]\\d{8}|1\\d{5,7}",[6,7,8,9,10,12],0,"0",0,"([59]\\d{7})$|0","8$1",0,0,[["8(?:51(?:0(?:01|30|59|88)|1(?:17|46|75)|2(?:22|35))|91(?:00[6-9]|1(?:[28]1|49|78)|2(?:09|63)|3(?:12|26|75)|4(?:56|97)|64\\d|7(?:0[01]|1[0-2])|958))\\d{3}",[9]],["4(?:79[01]|83[0-36-9]|95[0-3])\\d{5}|4(?:[0-36]\\d|4[047-9]|[58][0-24-9]|7[02-8]|9[0-47-9])\\d{6}",[9]],["180(?:0\\d{3}|2)\\d{3}",[7,10]],["190[0-26]\\d{6}",[10]],0,0,0,0,["14(?:5(?:1[0458]|[23][458])|71\\d)\\d{4}",[9]],["13(?:00\\d{6}(?:\\d{2})?|45[0-4]\\d{3})|13\\d{4}",[6,8,10,12]]],"0011"],CY:["357","00","(?:[279]\\d|[58]0)\\d{6}",[8],[["(\\d{2})(\\d{6})","$1 $2",["[257-9]"]]]],CZ:["420","00","(?:[2-578]\\d|60)\\d{7}|9\\d{8,11}",[9,10,11,12],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[2-8]|9[015-7]"]],["(\\d{2})(\\d{3})(\\d{3})(\\d{2})","$1 $2 $3 $4",["96"]],["(\\d{2})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["9"]],["(\\d{3})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["9"]]]],DE:["49","00","[2579]\\d{5,14}|49(?:[34]0|69|8\\d)\\d\\d?|49(?:37|49|60|7[089]|9\\d)\\d{1,3}|49(?:2[024-9]|3[2-689]|7[1-7])\\d{1,8}|(?:1|[368]\\d|4[0-8])\\d{3,13}|49(?:[015]\\d|2[13]|31|[46][1-8])\\d{1,9}",[4,5,6,7,8,9,10,11,12,13,14,15],[["(\\d{2})(\\d{3,13})","$1 $2",["3[02]|40|[68]9"],"0$1"],["(\\d{3})(\\d{3,12})","$1 $2",["2(?:0[1-389]|1[124]|2[18]|3[14])|3(?:[35-9][15]|4[015])|906|(?:2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1","2(?:0[1-389]|12[0-8])|3(?:[35-9][15]|4[015])|906|2(?:[13][14]|2[18])|(?:2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1"],"0$1"],["(\\d{4})(\\d{2,11})","$1 $2",["[24-6]|3(?:[3569][02-46-9]|4[2-4679]|7[2-467]|8[2-46-8])|70[2-8]|8(?:0[2-9]|[1-8])|90[7-9]|[79][1-9]","[24-6]|3(?:3(?:0[1-467]|2[127-9]|3[124578]|7[1257-9]|8[1256]|9[145])|4(?:2[135]|4[13578]|9[1346])|5(?:0[14]|2[1-3589]|6[1-4]|7[13468]|8[13568])|6(?:2[1-489]|3[124-6]|6[13]|7[12579]|8[1-356]|9[135])|7(?:2[1-7]|4[145]|6[1-5]|7[1-4])|8(?:21|3[1468]|6|7[1467]|8[136])|9(?:0[12479]|2[1358]|4[134679]|6[1-9]|7[136]|8[147]|9[1468]))|70[2-8]|8(?:0[2-9]|[1-8])|90[7-9]|[79][1-9]|3[68]4[1347]|3(?:47|60)[1356]|3(?:3[46]|46|5[49])[1246]|3[4579]3[1357]"],"0$1"],["(\\d{3})(\\d{4})","$1 $2",["138"],"0$1"],["(\\d{5})(\\d{2,10})","$1 $2",["3"],"0$1"],["(\\d{3})(\\d{5,11})","$1 $2",["181"],"0$1"],["(\\d{3})(\\d)(\\d{4,10})","$1 $2 $3",["1(?:3|80)|9"],"0$1"],["(\\d{3})(\\d{7,8})","$1 $2",["1[67]"],"0$1"],["(\\d{3})(\\d{7,12})","$1 $2",["8"],"0$1"],["(\\d{5})(\\d{6})","$1 $2",["185","1850","18500"],"0$1"],["(\\d{3})(\\d{4})(\\d{4})","$1 $2 $3",["7"],"0$1"],["(\\d{4})(\\d{7})","$1 $2",["18[68]"],"0$1"],["(\\d{4})(\\d{7})","$1 $2",["15[1279]"],"0$1"],["(\\d{5})(\\d{6})","$1 $2",["15[03568]","15(?:[0568]|3[13])"],"0$1"],["(\\d{3})(\\d{8})","$1 $2",["18"],"0$1"],["(\\d{3})(\\d{2})(\\d{7,8})","$1 $2 $3",["1(?:6[023]|7)"],"0$1"],["(\\d{4})(\\d{2})(\\d{7})","$1 $2 $3",["15[279]"],"0$1"],["(\\d{3})(\\d{2})(\\d{8})","$1 $2 $3",["15"],"0$1"]],"0"],DJ:["253","00","(?:2\\d|77)\\d{6}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[27]"]]]],DK:["45","00","[2-9]\\d{7}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2-9]"]]]],DM:["1","011","(?:[58]\\d\\d|767|900)\\d{7}",[10],0,"1",0,"([2-7]\\d{6})$|1","767$1",0,"767"],DO:["1","011","(?:[58]\\d\\d|900)\\d{7}",[10],0,"1",0,0,0,0,"8001|8[024]9"],DZ:["213","00","(?:[1-4]|[5-79]\\d|80)\\d{7}",[8,9],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[1-4]"],"0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["9"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-8]"],"0$1"]],"0"],EC:["593","00","1\\d{9,10}|(?:[2-7]|9\\d)\\d{7}",[8,9,10,11],[["(\\d)(\\d{3})(\\d{4})","$1 $2-$3",["[2-7]"],"(0$1)",0,"$1-$2-$3"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["9"],"0$1"],["(\\d{4})(\\d{3})(\\d{3,4})","$1 $2 $3",["1"]]],"0"],EE:["372","00","8\\d{9}|[4578]\\d{7}|(?:[3-8]\\d|90)\\d{5}",[7,8,10],[["(\\d{3})(\\d{4})","$1 $2",["[369]|4[3-8]|5(?:[0-2]|5[0-478]|6[45])|7[1-9]|88","[369]|4[3-8]|5(?:[02]|1(?:[0-8]|95)|5[0-478]|6(?:4[0-4]|5[1-589]))|7[1-9]|88"]],["(\\d{4})(\\d{3,4})","$1 $2",["[45]|8(?:00|[1-49])","[45]|8(?:00[1-9]|[1-49])"]],["(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3",["7"]],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["8"]]]],EG:["20","00","[189]\\d{8,9}|[24-6]\\d{8}|[135]\\d{7}",[8,9,10],[["(\\d)(\\d{7,8})","$1 $2",["[23]"],"0$1"],["(\\d{2})(\\d{6,7})","$1 $2",["1[35]|[4-6]|8[2468]|9[235-7]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[89]"],"0$1"],["(\\d{2})(\\d{8})","$1 $2",["1"],"0$1"]],"0"],EH:["212","00","[5-8]\\d{8}",[9],0,"0",0,0,0,0,"528[89]"],ER:["291","00","[178]\\d{6}",[7],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["[178]"],"0$1"]],"0"],ES:["34","00","[5-9]\\d{8}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[89]00"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-9]"]]]],ET:["251","00","(?:11|[2-579]\\d)\\d{7}",[9],[["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[1-579]"],"0$1"]],"0"],FI:["358","00|99(?:[01469]|5(?:[14]1|3[23]|5[59]|77|88|9[09]))","[1-35689]\\d{4}|7\\d{10,11}|(?:[124-7]\\d|3[0-46-9])\\d{8}|[1-9]\\d{5,8}",[5,6,7,8,9,10,11,12],[["(\\d{5})","$1",["20[2-59]"],"0$1"],["(\\d{3})(\\d{3,7})","$1 $2",["(?:[1-3]0|[68])0|70[07-9]"],"0$1"],["(\\d{2})(\\d{4,8})","$1 $2",["[14]|2[09]|50|7[135]"],"0$1"],["(\\d{2})(\\d{6,10})","$1 $2",["7"],"0$1"],["(\\d)(\\d{4,9})","$1 $2",["(?:19|[2568])[1-8]|3(?:0[1-9]|[1-9])|9"],"0$1"]],"0",0,0,0,0,"1[03-79]|[2-9]",0,"00"],FJ:["679","0(?:0|52)","45\\d{5}|(?:0800\\d|[235-9])\\d{6}",[7,11],[["(\\d{3})(\\d{4})","$1 $2",["[235-9]|45"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["0"]]],0,0,0,0,0,0,0,"00"],FK:["500","00","[2-7]\\d{4}",[5]],FM:["691","00","(?:[39]\\d\\d|820)\\d{4}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[389]"]]]],FO:["298","00","[2-9]\\d{5}",[6],[["(\\d{6})","$1",["[2-9]"]]],0,0,"(10(?:01|[12]0|88))"],FR:["33","00","[1-9]\\d{8}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"],"0 $1"],["(\\d)(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4 $5",["[1-79]"],"0$1"]],"0"],GA:["241","00","(?:[067]\\d|11)\\d{6}|[2-7]\\d{6}",[7,8],[["(\\d)(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2-7]"],"0$1"],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["0"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["11|[67]"],"0$1"]],0,0,"0(11\\d{6}|60\\d{6}|61\\d{6}|6[256]\\d{6}|7[467]\\d{6})","$1"],GB:["44","00","[1-357-9]\\d{9}|[18]\\d{8}|8\\d{6}",[7,9,10],[["(\\d{3})(\\d{4})","$1 $2",["800","8001","80011","800111","8001111"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3",["845","8454","84546","845464"],"0$1"],["(\\d{3})(\\d{6})","$1 $2",["800"],"0$1"],["(\\d{5})(\\d{4,5})","$1 $2",["1(?:38|5[23]|69|76|94)","1(?:(?:38|69)7|5(?:24|39)|768|946)","1(?:3873|5(?:242|39[4-6])|(?:697|768)[347]|9467)"],"0$1"],["(\\d{4})(\\d{5,6})","$1 $2",["1(?:[2-69][02-9]|[78])"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["[25]|7(?:0|6[02-9])","[25]|7(?:0|6(?:[03-9]|2[356]))"],"0$1"],["(\\d{4})(\\d{6})","$1 $2",["7"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[1389]"],"0$1"]],"0",0,"0|180020",0,0,0,[["(?:1(?:1(?:3(?:[0-58]\\d\\d|73[0-5])|4(?:(?:[0-5]\\d|70)\\d|69[7-9])|(?:(?:5[0-26-9]|[78][0-49])\\d|6(?:[0-4]\\d|5[01]))\\d)|(?:2(?:(?:0[024-9]|2[3-9]|3[3-79]|4[1-689]|[58][02-9]|6[0-47-9]|7[013-9]|9\\d)\\d|1(?:[0-7]\\d|8[0-3]))|(?:3(?:0\\d|1[0-8]|[25][02-9]|3[02-579]|[468][0-46-9]|7[1-35-79]|9[2-578])|4(?:0[03-9]|[137]\\d|[28][02-57-9]|4[02-69]|5[0-8]|[69][0-79])|5(?:0[1-35-9]|[16]\\d|2[024-9]|3[015689]|4[02-9]|5[03-9]|7[0-35-9]|8[0-468]|9[0-57-9])|6(?:0[034689]|1\\d|2[0-35689]|[38][013-9]|4[1-467]|5[0-69]|6[13-9]|7[0-8]|9[0-24578])|7(?:0[0246-9]|2\\d|3[0236-8]|4[03-9]|5[0-46-9]|6[013-9]|7[0-35-9]|8[024-9]|9[02-9])|8(?:0[35-9]|2[1-57-9]|3[02-578]|4[0-578]|5[124-9]|6[2-69]|7\\d|8[02-9]|9[02569])|9(?:0[02-589]|[18]\\d|2[02-689]|3[1-57-9]|4[2-9]|5[0-579]|6[2-47-9]|7[0-24578]|9[2-57]))\\d)\\d)|2(?:0[013478]|3[0189]|4[017]|8[0-46-9]|9[0-2])\\d{3})\\d{4}|1(?:2(?:0(?:46[1-4]|87[2-9])|545[1-79]|76(?:2\\d|3[1-8]|6[1-6])|9(?:7(?:2[0-4]|3[2-5])|8(?:2[2-8]|7[0-47-9]|8[3-5])))|3(?:6(?:38[2-5]|47[23])|8(?:47[04-9]|64[0157-9]))|4(?:044[1-7]|20(?:2[23]|8\\d)|6(?:0(?:30|5[2-57]|6[1-8]|7[2-8])|140)|8(?:052|87[1-3]))|5(?:2(?:4(?:3[2-79]|6\\d)|76\\d)|6(?:26[06-9]|686))|6(?:06(?:4\\d|7[4-79])|295[5-7]|35[34]\\d|47(?:24|61)|59(?:5[08]|6[67]|74)|9(?:55[0-4]|77[23]))|7(?:26(?:6[13-9]|7[0-7])|(?:442|688)\\d|50(?:2[0-3]|[3-68]2|76))|8(?:27[56]\\d|37(?:5[2-5]|8[239])|843[2-58])|9(?:0(?:0(?:6[1-8]|85)|52\\d)|3583|4(?:66[1-8]|9(?:2[01]|81))|63(?:23|3[1-4])|9561))\\d{3}",[9,10]],["7(?:457[0-57-9]|700[01]|911[028])\\d{5}|7(?:[1-3]\\d\\d|4(?:[0-46-9]\\d|5[0-689])|5(?:0[0-8]|[13-9]\\d|2[0-35-9])|7(?:0[1-9]|[1-7]\\d|8[02-9]|9[0-689])|8(?:[014-9]\\d|[23][0-8])|9(?:[024-9]\\d|1[02-9]|3[0-689]))\\d{6}",[10]],["80[08]\\d{7}|800\\d{6}|8001111"],["(?:8(?:4[2-5]|7[0-3])|9(?:[01]\\d|8[2-49]))\\d{7}|845464\\d",[7,10]],["70\\d{8}",[10]],0,["(?:3[0347]|55)\\d{8}",[10]],["76(?:464|652)\\d{5}|76(?:0[0-28]|2[356]|34|4[01347]|5[49]|6[0-369]|77|8[14]|9[139])\\d{6}",[10]],["56\\d{8}",[10]]],0," x"],GD:["1","011","(?:473|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","473$1",0,"473"],GE:["995","00","(?:[3-57]\\d\\d|800)\\d{6}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["70"],"0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["32"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[57]"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[348]"],"0$1"]],"0"],GF:["594","00","(?:[56]94\\d|7093)\\d{5}|(?:80|9\\d)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-7]|9[47]"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[89]"],"0$1"]],"0"],GG:["44","00","(?:1481|[357-9]\\d{3})\\d{6}|8\\d{6}(?:\\d{2})?",[7,9,10],0,"0",0,"([25-9]\\d{5})$|0|180020","1481$1",0,0,[["1481[25-9]\\d{5}",[10]],["7(?:(?:781|839)\\d|911[17])\\d{5}",[10]],["80[08]\\d{7}|800\\d{6}|8001111"],["(?:8(?:4[2-5]|7[0-3])|9(?:[01]\\d|8[0-3]))\\d{7}|845464\\d",[7,10]],["70\\d{8}",[10]],0,["(?:3[0347]|55)\\d{8}",[10]],["76(?:464|652)\\d{5}|76(?:0[0-28]|2[356]|34|4[01347]|5[49]|6[0-369]|77|8[14]|9[139])\\d{6}",[10]],["56\\d{8}",[10]]]],GH:["233","00","(?:[235]\\d{3}|800)\\d{5}",[8,9],[["(\\d{3})(\\d{5})","$1 $2",["8"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[235]"],"0$1"]],"0"],GI:["350","00","(?:[25]\\d|60)\\d{6}",[8],[["(\\d{3})(\\d{5})","$1 $2",["2"]]]],GL:["299","00","(?:19|[2-689]\\d|70)\\d{4}",[6],[["(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3",["19|[2-9]"]]]],GM:["220","00","[2-9]\\d{6}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[2-9]"]]]],GN:["224","00","722\\d{6}|(?:3|6\\d)\\d{7}",[8,9],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["3"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[67]"]]]],GP:["590","00","(?:590\\d|7090)\\d{5}|(?:69|80|9\\d)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-79]"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"],"0$1"]],"0",0,0,0,0,0,[["590(?:0[1-68]|[14][0-24-9]|2[0-68]|3[1-9]|5[3-579]|[68][0-689]|7[08]|9\\d)\\d{4}"],["(?:69(?:0\\d\\d|1(?:2[2-9]|3[0-5])|4(?:0[89]|1[2-6]|9\\d)|6(?:1[016-9]|5[0-4]|[67]\\d))|7090[0-4])\\d{4}"],["80[0-5]\\d{6}"],0,0,0,0,0,["9(?:(?:39[5-7]|76[018])\\d|475[0-6])\\d{4}"]]],GQ:["240","00","222\\d{6}|(?:3\\d|55|[89]0)\\d{7}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[235]"]],["(\\d{3})(\\d{6})","$1 $2",["[89]"]]]],GR:["30","00","5005000\\d{3}|8\\d{9,11}|(?:[269]\\d|70)\\d{8}",[10,11,12],[["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["21|7"]],["(\\d{4})(\\d{6})","$1 $2",["2(?:2|3[2-57-9]|4[2-469]|5[2-59]|6[2-9]|7[2-69]|8[2-49])|5"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[2689]"]],["(\\d{3})(\\d{3,4})(\\d{5})","$1 $2 $3",["8"]]]],GT:["502","00","80\\d{6}|(?:1\\d{3}|[2-7])\\d{7}",[8,11],[["(\\d{4})(\\d{4})","$1 $2",["[2-8]"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["1"]]]],GU:["1","011","(?:[58]\\d\\d|671|900)\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","671$1",0,"671"],GW:["245","00","[49]\\d{8}|4\\d{6}",[7,9],[["(\\d{3})(\\d{4})","$1 $2",["40"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[49]"]]]],GY:["592","001","(?:[2-8]\\d{3}|9008)\\d{3}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[2-9]"]]]],HK:["852","00(?:30|5[09]|[126-9]?)","8[0-46-9]\\d{6,7}|9\\d{4,7}|(?:[2-7]|9\\d{3})\\d{7}",[5,6,7,8,9,11],[["(\\d{3})(\\d{2,5})","$1 $2",["900","9003"]],["(\\d{4})(\\d{4})","$1 $2",["[2-7]|8[1-4]|9(?:0[1-9]|[1-8])"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["8"]],["(\\d{3})(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3 $4",["9"]]],0,0,0,0,0,0,0,"00"],HN:["504","00","8\\d{10}|[237-9]\\d{7}",[8,11],[["(\\d{4})(\\d{4})","$1-$2",["[237-9]"]]]],HR:["385","00","[2-69]\\d{8}|80\\d{5,7}|[1-79]\\d{7}|6\\d{6}",[7,8,9],[["(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3",["6[01]"],"0$1"],["(\\d{3})(\\d{2})(\\d{2,3})","$1 $2 $3",["8"],"0$1"],["(\\d)(\\d{4})(\\d{3})","$1 $2 $3",["1"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["6|7[245]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["9"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[2-57]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["8"],"0$1"]],"0"],HT:["509","00","[2-589]\\d{7}",[8],[["(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3",["[2-589]"]]]],HU:["36","00","[235-7]\\d{8}|[1-9]\\d{7}",[8,9],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["1"],"(06 $1)"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[27][2-9]|3[2-7]|4[24-9]|5[2-79]|6|8[2-57-9]|9[2-69]"],"(06 $1)"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[2-9]"],"06 $1"]],"06"],ID:["62","00[89]","00[1-9]\\d{9,14}|(?:[1-36]|8\\d{5})\\d{6}|00\\d{9}|[1-9]\\d{8,10}|[2-9]\\d{7}",[7,8,9,10,11,12,13,14,15,16,17],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["15"]],["(\\d{2})(\\d{5,9})","$1 $2",["2[124]|[36]1"],"(0$1)"],["(\\d{3})(\\d{5,7})","$1 $2",["800"],"0$1"],["(\\d{3})(\\d{5,8})","$1 $2",["[2-79]"],"(0$1)"],["(\\d{3})(\\d{3,4})(\\d{3})","$1-$2-$3",["8[1-35-9]"],"0$1"],["(\\d{3})(\\d{6,8})","$1 $2",["1"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["804"],"0$1"],["(\\d{3})(\\d)(\\d{3})(\\d{3})","$1 $2 $3 $4",["80"],"0$1"],["(\\d{3})(\\d{4})(\\d{4,5})","$1-$2-$3",["8"],"0$1"]],"0"],IE:["353","00","(?:1\\d|[2569])\\d{6,8}|4\\d{6,9}|7\\d{8}|8\\d{8,9}",[7,8,9,10],[["(\\d{2})(\\d{5})","$1 $2",["2[24-9]|47|58|6[237-9]|9[35-9]"],"(0$1)"],["(\\d{3})(\\d{5})","$1 $2",["[45]0"],"(0$1)"],["(\\d)(\\d{3,4})(\\d{4})","$1 $2 $3",["1"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[2569]|4[1-69]|7[14]"],"(0$1)"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["70"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["81"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[78]"],"0$1"],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1"]],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["4"],"(0$1)"],["(\\d{2})(\\d)(\\d{3})(\\d{4})","$1 $2 $3 $4",["8"],"0$1"]],"0"],IL:["972","0(?:0|1[2-9])","1\\d{6}(?:\\d{3,5})?|[57]\\d{8}|[1-489]\\d{7}",[7,8,9,10,11,12],[["(\\d{4})(\\d{3})","$1-$2",["125"]],["(\\d{4})(\\d{2})(\\d{2})","$1-$2-$3",["121"]],["(\\d)(\\d{3})(\\d{4})","$1-$2-$3",["[2-489]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1-$2-$3",["[57]"],"0$1"],["(\\d{4})(\\d{3})(\\d{3})","$1-$2-$3",["12"]],["(\\d{4})(\\d{6})","$1-$2",["159"]],["(\\d)(\\d{3})(\\d{3})(\\d{3})","$1-$2-$3-$4",["1[7-9]"]],["(\\d{3})(\\d{1,2})(\\d{3})(\\d{4})","$1-$2 $3-$4",["15"]]],"0"],IM:["44","00","1624\\d{6}|(?:[3578]\\d|90)\\d{8}",[10],0,"0",0,"([25-8]\\d{5})$|0|180020","1624$1",0,"74576|(?:16|7[56])24"],IN:["91","00","(?:000800|[2-9]\\d\\d)\\d{7}|1\\d{7,12}",[8,9,10,11,12,13],[["(\\d{8})","$1",["5(?:0|2[23]|3[03]|[67]1|88)","5(?:0|2(?:21|3)|3(?:0|3[23])|616|717|888)","5(?:0|2(?:21|3)|3(?:0|3[23])|616|717|8888)"],0,1],["(\\d{4})(\\d{4,5})","$1 $2",["180","1800"],0,1],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["140"],0,1],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["11|2[02]|33|4[04]|79[1-7]|80[2-46]","11|2[02]|33|4[04]|79(?:[1-6]|7[19])|80(?:[2-4]|6[0-589])","11|2[02]|33|4[04]|79(?:[124-6]|3(?:[02-9]|1[0-24-9])|7(?:1|9[1-6]))|80(?:[2-4]|6[0-589])"],"0$1",1],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["1(?:2[0-249]|3[0-25]|4[145]|[68]|7[1257])|2(?:1[257]|3[013]|4[01]|5[0137]|6[0158]|78|8[1568])|3(?:26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(?:1[36]|2[1-47]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(?:1[025]|22|[36][25]|4[28]|5[12]|[78]1)|6(?:12|[2-4]1|5[17]|6[13]|80)|7(?:12|3[134]|4[47]|61|88)|8(?:16|2[014]|3[126]|6[136]|7[078]|8[34]|91)|(?:43|59|75)[15]|(?:1[59]|29|67|72)[14]","1(?:2[0-24]|3[0-25]|4[145]|[59][14]|6[1-9]|7[1257]|8[1-57-9])|2(?:1[257]|3[013]|4[01]|5[0137]|6[058]|78|8[1568]|9[14])|3(?:26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(?:1[36]|2[1-47]|3[15]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(?:1[025]|22|[36][25]|4[28]|[578]1|9[15])|674|7(?:(?:2[14]|3[34]|5[15])[2-6]|61[346]|88[0-8])|8(?:70[2-6]|84[235-7]|91[3-7])|(?:1(?:29|60|8[06])|261|552|6(?:12|[2-47]1|5[17]|6[13]|80)|7(?:12|31|4[47])|8(?:16|2[014]|3[126]|6[136]|7[78]|83))[2-7]","1(?:2[0-24]|3[0-25]|4[145]|[59][14]|6[1-9]|7[1257]|8[1-57-9])|2(?:1[257]|3[013]|4[01]|5[0137]|6[058]|78|8[1568]|9[14])|3(?:26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(?:1[36]|2[1-47]|3[15]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(?:1[025]|22|[36][25]|4[28]|[578]1|9[15])|6(?:12(?:[2-6]|7[0-8])|74[2-7])|7(?:(?:2[14]|5[15])[2-6]|3171|61[346]|88(?:[2-7]|82))|8(?:70[2-6]|84(?:[2356]|7[19])|91(?:[3-6]|7[19]))|73[134][2-6]|(?:74[47]|8(?:16|2[014]|3[126]|6[136]|7[78]|83))(?:[2-6]|7[19])|(?:1(?:29|60|8[06])|261|552|6(?:[2-4]1|5[17]|6[13]|7(?:1|4[0189])|80)|7(?:12|88[01]))[2-7]"],"0$1",1],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1(?:[2-479]|5[0235-9])|[2-5]|6(?:1[1358]|2[2457-9]|3[2-5]|4[235-7]|5[2-689]|6[24578]|7[235689]|8[1-6])|7(?:1[013-9]|28|3[129]|4[1-35689]|5[29]|6[02-5]|70)|807","1(?:[2-479]|5[0235-9])|[2-5]|6(?:1[1358]|2(?:[2457]|84|95)|3(?:[2-4]|55)|4[235-7]|5[2-689]|6[24578]|7[235689]|8[1-6])|7(?:1(?:[013-8]|9[6-9])|28[6-8]|3(?:17|2[0-49]|9[2-57])|4(?:1[2-4]|[29][0-7]|3[0-8]|[56]|8[0-24-7])|5(?:2[1-3]|9[0-6])|6(?:0[5689]|2[5-9]|3[02-8]|4|5[0-367])|70[13-7])|807[19]","1(?:[2-479]|5(?:[0236-9]|5[013-9]))|[2-5]|6(?:2(?:84|95)|355|8(?:28[235-7]|3))|73179|807(?:1|9[1-3])|(?:1552|6(?:(?:1[1358]|2[2457]|3[2-4]|4[235-7]|5[2-689]|6[24578]|7[235689])\\d|8(?:[14-6]\\d|2[0-79]))|7(?:1(?:[013-8]\\d|9[6-9])|28[6-8]|3(?:2[0-49]|9[2-57])|4(?:1[2-4]|[29][0-7]|3[0-8]|[56]\\d|8[0-24-7])|5(?:2[1-3]|9[0-6])|6(?:0[5689]|2[5-9]|3[02-8]|4\\d|5[0-367])|70[13-7]))[2-7]"],"0$1",1],["(\\d{5})(\\d{5})","$1 $2",["[6-9]"],"0$1",1],["(\\d{4})(\\d{2,4})(\\d{4})","$1 $2 $3",["1(?:6|8[06])","1(?:6|8[06]0)"],0,1],["(\\d{4})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["18"],0,1]],"0"],IO:["246","00","3\\d{6}",[7],[["(\\d{3})(\\d{4})","$1 $2",["3"]]]],IQ:["964","00","(?:1|7\\d\\d)\\d{7}|[2-6]\\d{7,8}",[8,9,10],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["1"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[2-6]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["7"],"0$1"]],"0"],IR:["98","00","[1-9]\\d{9}|(?:[1-8]\\d\\d|9)\\d{3,4}",[4,5,6,7,10],[["(\\d{4,5})","$1",["96"],"0$1"],["(\\d{2})(\\d{4,5})","$1 $2",["(?:1[137]|2[13-68]|3[1458]|4[145]|5[1468]|6[16]|7[1467]|8[13467])[12689]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["9"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["[1-8]"],"0$1"]],"0"],IS:["354","00|1(?:0(?:01|[12]0)|100)","(?:38\\d|[4-9])\\d{6}",[7,9],[["(\\d{3})(\\d{4})","$1 $2",["[4-9]"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["3"]]],0,0,0,0,0,0,0,"00"],IT:["39","00","0\\d{5,11}|1\\d{8,10}|3(?:[0-8]\\d{7,10}|9\\d{7,8})|(?:43|55|70)\\d{8}|8\\d{5}(?:\\d{2,4})?",[6,7,8,9,10,11,12],[["(\\d{2})(\\d{4,6})","$1 $2",["0[26]"]],["(\\d{3})(\\d{3,6})","$1 $2",["0[13-57-9][0159]|8(?:03|4[17]|9[2-5])","0[13-57-9][0159]|8(?:03|4[17]|9(?:2|3[04]|[45][0-4]))"]],["(\\d{4})(\\d{2,6})","$1 $2",["0(?:[13-579][2-46-8]|8[236-8])"]],["(\\d{4})(\\d{4})","$1 $2",["894"]],["(\\d{2})(\\d{3,4})(\\d{4})","$1 $2 $3",["0[26]|5"]],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["1(?:44|[679])|[378]|43"]],["(\\d{3})(\\d{3,4})(\\d{4})","$1 $2 $3",["0[13-57-9][0159]|14"]],["(\\d{2})(\\d{4})(\\d{5})","$1 $2 $3",["0[26]"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["0"]],["(\\d{3})(\\d{4})(\\d{4,5})","$1 $2 $3",["[03]"]]],0,0,0,0,0,0,[["0(?:669[0-79]\\d{1,6}|831\\d{2,8})|0(?:1(?:[0159]\\d|[27][1-5]|31|4[1-4]|6[1356]|8[2-57])|2\\d\\d|3(?:[0159]\\d|2[1-4]|3[12]|[48][1-6]|6[2-59]|7[1-7])|4(?:[0159]\\d|[23][1-9]|4[245]|6[1-5]|7[1-4]|81)|5(?:[0159]\\d|2[1-5]|3[2-6]|4[1-79]|6[4-6]|7[1-578]|8[3-8])|6(?:[0-57-9]\\d|6[0-8])|7(?:[0159]\\d|2[12]|3[1-7]|4[2-46]|6[13569]|7[13-6]|8[1-59])|8(?:[0159]\\d|2[3-578]|3[2356]|[6-8][1-5])|9(?:[0159]\\d|[238][1-5]|4[12]|6[1-8]|7[1-6]))\\d{2,7}"],["3[2-9]\\d{7,8}|(?:31|43)\\d{8}",[9,10]],["80(?:0\\d{3}|3)\\d{3}",[6,9]],["(?:0878\\d{3}|89(?:2\\d|3[04]|4(?:[0-4]|[5-9]\\d\\d)|5[0-4]))\\d\\d|(?:1(?:44|6[346])|89(?:38|5[5-9]|9))\\d{6}",[6,8,9,10]],["1(?:78\\d|99)\\d{6}",[9,10]],["3[2-8]\\d{9,10}",[11,12]],0,0,["55\\d{8}",[10]],["84(?:[08]\\d{3}|[17])\\d{3}",[6,9]]]],JE:["44","00","1534\\d{6}|(?:[3578]\\d|90)\\d{8}",[10],0,"0",0,"([0-24-8]\\d{5})$|0|180020","1534$1",0,0,[["1534[0-24-8]\\d{5}"],["7(?:(?:(?:50|82)9|937)\\d|7(?:00[378]|97\\d))\\d{5}"],["80(?:07(?:35|81)|8901)\\d{4}"],["(?:8(?:4(?:4(?:4(?:05|42|69)|703)|5(?:041|800))|7(?:0002|1206))|90(?:066[59]|1810|71(?:07|55)))\\d{4}"],["701511\\d{4}"],0,["(?:3(?:0(?:07(?:35|81)|8901)|3\\d{4}|4(?:4(?:4(?:05|42|69)|703)|5(?:041|800))|7(?:0002|1206))|55\\d{4})\\d{4}"],["76(?:464|652)\\d{5}|76(?:0[0-28]|2[356]|34|4[01347]|5[49]|6[0-369]|77|8[14]|9[139])\\d{6}"],["56\\d{8}"]]],JM:["1","011","(?:[58]\\d\\d|658|900)\\d{7}",[10],0,"1",0,0,0,0,"658|876"],JO:["962","00","(?:(?:[2689]|7\\d)\\d|32|427|53)\\d{6}",[8,9],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["[2356]|87"],"(0$1)"],["(\\d{3})(\\d{5,6})","$1 $2",["[89]"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["70"],"0$1"],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["[47]"],"0$1"]],"0"],JP:["81","010","00[1-9]\\d{6,14}|[25-9]\\d{9}|(?:00|[1-9]\\d\\d)\\d{6}",[8,9,10,11,12,13,14,15,16,17],[["(\\d{3})(\\d{3})(\\d{3})","$1-$2-$3",["(?:12|57|99)0"],"0$1"],["(\\d{4})(\\d)(\\d{4})","$1-$2-$3",["1(?:26|3[79]|4[56]|5[4-68]|6[3-5])|499|5(?:76|97)|746|8(?:3[89]|47|51)|9(?:80|9[16])","1(?:267|3(?:7[247]|9[278])|466|5(?:47|58|64)|6(?:3[245]|48|5[4-68]))|499[2468]|5(?:76|97)9|7468|8(?:3(?:8[7-9]|96)|477|51[2-9])|9(?:802|9(?:1[23]|69))|1(?:45|58)[67]","1(?:267|3(?:7[247]|9[278])|466|5(?:47|58|64)|6(?:3[245]|48|5[4-68]))|499[2468]|5(?:769|979[2-69])|7468|8(?:3(?:8[7-9]|96[2457-9])|477|51[2-9])|9(?:802|9(?:1[23]|69))|1(?:45|58)[67]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1-$2-$3",["60"],"0$1"],["(\\d)(\\d{4})(\\d{4})","$1-$2-$3",["3|4(?:2[09]|7[01])|6[1-9]","3|4(?:2(?:0|9[02-69])|7(?:0[019]|1))|6[1-9]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1-$2-$3",["1(?:1|5[45]|77|88|9[69])|2(?:2[1-37]|3[0-269]|4[59]|5|6[24]|7[1-358]|8[1369]|9[0-38])|4(?:[28][1-9]|3[0-57]|[45]|6[248]|7[2-579]|9[29])|5(?:2|3[0459]|4[0-369]|5[29]|8[02389]|9[0-389])|7(?:2[02-46-9]|34|[58]|6[0249]|7[57]|9[2-6])|8(?:2[124589]|3[26-9]|49|51|6|7[0-468]|8[68]|9[019])|9(?:[23][1-9]|4[15]|5[138]|6[1-3]|7[156]|8[189]|9[1-489])","1(?:1|5(?:4[018]|5[017])|77|88|9[69])|2(?:2(?:[127]|3[014-9])|3[0-269]|4[59]|5(?:[1-3]|5[0-69]|9[19])|62|7(?:[1-35]|8[0189])|8(?:[16]|3[0134]|9[0-5])|9(?:[028]|17))|4(?:2(?:[13-79]|8[014-6])|3[0-57]|[45]|6[248]|7[2-47]|8[1-9]|9[29])|5(?:2|3(?:[045]|9[0-8])|4[0-369]|5[29]|8[02389]|9[0-3])|7(?:2[02-46-9]|34|[58]|6[0249]|7[57]|9(?:[23]|4[0-59]|5[01569]|6[0167]))|8(?:2(?:[1258]|4[0-39]|9[0-2469])|3(?:[29]|60)|49|51|6(?:[0-24]|36|5[0-3589]|7[23]|9[01459])|7[0-468]|8[68])|9(?:[23][1-9]|4[15]|5[138]|6[1-3]|7[156]|8[189]|9(?:[1289]|3[34]|4[0178]))|(?:264|837)[016-9]|2(?:57|93)[015-9]|(?:25[0468]|422|838)[01]|(?:47[59]|59[89]|8(?:6[68]|9))[019]","1(?:1|5(?:4[018]|5[017])|77|88|9[69])|2(?:2[127]|3[0-269]|4[59]|5(?:[1-3]|5[0-69]|9(?:17|99))|6(?:2|4[016-9])|7(?:[1-35]|8[0189])|8(?:[16]|3[0134]|9[0-5])|9(?:[028]|17))|4(?:2(?:[13-79]|8[014-6])|3[0-57]|[45]|6[248]|7[2-47]|9[29])|5(?:2|3(?:[045]|9(?:[0-58]|6[4-9]|7[0-35689]))|4[0-369]|5[29]|8[02389]|9[0-3])|7(?:2[02-46-9]|34|[58]|6[0249]|7[57]|9(?:[23]|4[0-59]|5[01569]|6[0167]))|8(?:2(?:[1258]|4[0-39]|9[0169])|3(?:[29]|60|7(?:[017-9]|6[6-8]))|49|51|6(?:[0-24]|36[2-57-9]|5(?:[0-389]|5[23])|6(?:[01]|9[178])|7(?:2[2-468]|3[78])|9[0145])|7[0-468]|8[68])|9(?:4[15]|5[138]|7[156]|8[189]|9(?:[1289]|3(?:31|4[357])|4[0178]))|(?:8294|96)[1-3]|2(?:57|93)[015-9]|(?:223|8699)[014-9]|(?:25[0468]|422|838)[01]|(?:48|8292|9[23])[1-9]|(?:47[59]|59[89]|8(?:68|9))[019]"],"0$1"],["(\\d{3})(\\d{2})(\\d{4})","$1-$2-$3",["[14]|[289][2-9]|5[3-9]|7[2-4679]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1-$2-$3",["800"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1-$2-$3",["[25-9]"],"0$1"]],"0",0,"(000[2569]\\d{4,6})$|(?:(?:003768)0?)|0","$1"],KE:["254","000","(?:[17]\\d\\d|900)\\d{6}|(?:2|80)0\\d{6,7}|[4-6]\\d{6,8}",[7,8,9,10],[["(\\d{2})(\\d{5,7})","$1 $2",["[24-6]"],"0$1"],["(\\d{3})(\\d{6})","$1 $2",["[17]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["[89]"],"0$1"]],"0"],KG:["996","00","8\\d{9}|[235-9]\\d{8}",[9,10],[["(\\d{4})(\\d{5})","$1 $2",["3(?:1[346]|[24-79])"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[235-79]|88"],"0$1"],["(\\d{3})(\\d{3})(\\d)(\\d{2,3})","$1 $2 $3 $4",["8"],"0$1"]],"0"],KH:["855","00[14-9]","1\\d{9}|[1-9]\\d{7,8}",[8,9,10],[["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[1-9]"],"0$1"],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1"]]],"0"],KI:["686","00","(?:[37]\\d|6[0-79])\\d{6}|(?:[2-48]\\d|50)\\d{3}",[5,8],0,"0"],KM:["269","00","[3478]\\d{6}",[7],[["(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3",["[3478]"]]]],KN:["1","011","(?:[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-7]\\d{6})$|1","869$1",0,"869"],KP:["850","00|99","85\\d{6}|(?:19\\d|[2-7])\\d{7}",[8,10],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["8"],"0$1"],["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["[2-7]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["1"],"0$1"]],"0"],KR:["82","00(?:[125689]|3(?:[46]5|91)|7(?:00|27|3|55|6[126]))","00[1-9]\\d{8,11}|(?:[12]|5\\d{3})\\d{7}|[13-6]\\d{9}|(?:[1-6]\\d|80)\\d{7}|[3-6]\\d{4,5}|(?:00|7)0\\d{8}",[5,6,8,9,10,11,12,13,14],[["(\\d{2})(\\d{3,4})","$1-$2",["(?:3[1-3]|[46][1-4]|5[1-5])1"],"0$1"],["(\\d{4})(\\d{4})","$1-$2",["1"]],["(\\d)(\\d{3,4})(\\d{4})","$1-$2-$3",["2"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1-$2-$3",["[36]0|8"],"0$1"],["(\\d{2})(\\d{3,4})(\\d{4})","$1-$2-$3",["[1346]|5[1-5]"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1-$2-$3",["[57]"],"0$1"],["(\\d{2})(\\d{5})(\\d{4})","$1-$2-$3",["5"],"0$1"]],"0",0,"0(8(?:[1-46-8]|5\\d\\d))?"],KW:["965","00","18\\d{5}|(?:[2569]\\d|41)\\d{6}",[7,8],[["(\\d{4})(\\d{3,4})","$1 $2",["[169]|2(?:[235]|4[1-35-9])|52"]],["(\\d{3})(\\d{5})","$1 $2",["[245]"]]]],KY:["1","011","(?:345|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","345$1",0,"345"],KZ:["7","810","(?:33622|8\\d{8})\\d{5}|[78]\\d{9}",[10,14],0,"8",0,0,0,0,"33622|7",0,"8~10"],LA:["856","00","[23]\\d{9}|3\\d{8}|(?:[235-8]\\d|41)\\d{6}",[8,9,10],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["2[13]|3[14]|[4-8]"],"0$1"],["(\\d{2})(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3 $4",["3"],"0$1"],["(\\d{2})(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3 $4",["[23]"],"0$1"]],"0"],LB:["961","00","[27-9]\\d{7}|[13-9]\\d{6}",[7,8],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["[13-69]|7(?:[2-57]|62|8[0-6]|9[04-9])|8[02-9]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[27-9]"]]],"0"],LC:["1","011","(?:[58]\\d\\d|758|900)\\d{7}",[10],0,"1",0,"([2-8]\\d{6})$|1","758$1",0,"758"],LI:["423","00","[68]\\d{8}|(?:[2378]\\d|90)\\d{5}",[7,9],[["(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3",["[2379]|8(?:0[09]|7)","[2379]|8(?:0(?:02|9)|7)"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["8"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["69"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["6"]]],"0",0,"(1001)|0"],LK:["94","00","[1-9]\\d{8}",[9],[["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["7"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[1-689]"],"0$1"]],"0"],LR:["231","00","(?:[2457]\\d|33|88)\\d{7}|(?:2\\d|[4-6])\\d{6}",[7,8,9],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["4[67]|[56]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["2"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[2-578]"],"0$1"]],"0"],LS:["266","00","(?:[256]\\d\\d|800)\\d{5}",[8],[["(\\d{4})(\\d{4})","$1 $2",["[2568]"]]]],LT:["370","00","(?:[3469]\\d|52|[78]0)\\d{6}",[8],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["52[0-7]"],"(0-$1)",1],["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["[7-9]"],"0 $1",1],["(\\d{2})(\\d{6})","$1 $2",["37|4(?:[15]|6[1-8])"],"(0-$1)",1],["(\\d{3})(\\d{5})","$1 $2",["[3-6]"],"(0-$1)",1]],"0",0,"[08]"],LU:["352","00","35[013-9]\\d{4,8}|6\\d{8}|35\\d{2,4}|(?:[2457-9]\\d|3[0-46-9])\\d{2,9}",[4,5,6,7,8,9,10,11],[["(\\d{2})(\\d{3})","$1 $2",["2(?:0[2-689]|[2-9])|[3-57]|8(?:0[2-9]|[13-9])|9(?:0[89]|[2-579])"]],["(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3",["2(?:0[2-689]|[2-9])|[3-57]|8(?:0[2-9]|[13-9])|9(?:0[89]|[2-579])"]],["(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3",["20[2-689]"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{1,2})","$1 $2 $3 $4",["2(?:[0367]|4[3-8])"]],["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["80[01]|90[015]"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3 $4",["20"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["6"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})(\\d{1,2})","$1 $2 $3 $4 $5",["2(?:[0367]|4[3-8])"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{1,5})","$1 $2 $3 $4",["[3-57]|8[13-9]|9(?:0[89]|[2-579])|(?:2|80)[2-9]"]]],0,0,"(15(?:0[06]|1[12]|[35]5|4[04]|6[26]|77|88|99)\\d)"],LV:["371","00","(?:[268]\\d|78|90)\\d{6}",[8],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[2679]|8[01]"]]]],LY:["218","00","[2-9]\\d{8}",[9],[["(\\d{2})(\\d{7})","$1-$2",["[2-9]"],"0$1"]],"0"],MA:["212","00","[5-8]\\d{8}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["5[45]"],"0$1"],["(\\d{4})(\\d{5})","$1-$2",["5(?:[19]|2[2-46-9]|3[3-9])|8(?:0[89]|92)"],"0$1"],["(\\d{2})(\\d{7})","$1-$2",["8"],"0$1"],["(\\d{3})(\\d{6})","$1-$2",["[5-7]"],"0$1"]],"0",0,0,0,0,0,[["5(?:(?:18|4[0679]|5[03])\\d|2(?:[0-25-79]\\d|3[1-578]|4[02-46-8]|8[0235-7])|3(?:[0-47]\\d|5[02-9]|6[02-8]|8[014-9]|9[3-9]))\\d{5}"],["(?:6(?:[0-79]\\d|8[0-247-9])|7(?:[016-8]\\d|2[0-8]|5[0-5]))\\d{6}"],["80[0-7]\\d{6}"],["89\\d{7}"],0,0,0,0,["(?:592(?:4[0-2]|93)|80[89]\\d\\d)\\d{4}"]]],MC:["377","00","(?:[3489]|[67]\\d)\\d{7}",[8,9],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["4"],"0$1"],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[389]"]],["(\\d)(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4 $5",["[67]"],"0$1"]],"0"],MD:["373","00","(?:[235-7]\\d|[89]0)\\d{6}",[8],[["(\\d{3})(\\d{5})","$1 $2",["[89]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["22|3"],"0$1"],["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["[25-7]"],"0$1"]],"0"],ME:["382","00","(?:20|[3-79]\\d)\\d{6}|80\\d{6,7}",[8,9],[["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[2-9]"],"0$1"]],"0"],MF:["590","00","(?:590\\d|7090)\\d{5}|(?:69|80|9\\d)\\d{7}",[9],0,"0",0,0,0,0,0,[["590(?:0[079]|[14]3|[27][79]|3[03-7]|5[0-268]|87)\\d{4}"],["(?:69(?:0\\d\\d|1(?:2[2-9]|3[0-5])|4(?:0[89]|1[2-6]|9\\d)|6(?:1[016-9]|5[0-4]|[67]\\d))|7090[0-4])\\d{4}"],["80[0-5]\\d{6}"],0,0,0,0,0,["9(?:(?:39[5-7]|76[018])\\d|475[0-6])\\d{4}"]]],MG:["261","00","[23]\\d{8}",[9],[["(\\d{2})(\\d{2})(\\d{3})(\\d{2})","$1 $2 $3 $4",["[23]"],"0$1"]],"0",0,"([24-9]\\d{6})$|0","20$1"],MH:["692","011","329\\d{4}|(?:[256]\\d|45)\\d{5}",[7],[["(\\d{3})(\\d{4})","$1-$2",["[2-6]"]]],"1"],MK:["389","00","[2-578]\\d{7}",[8],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["2|34[47]|4(?:[37]7|5[47]|64)"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[347]"],"0$1"],["(\\d{3})(\\d)(\\d{2})(\\d{2})","$1 $2 $3 $4",["[58]"],"0$1"]],"0"],ML:["223","00","[24-9]\\d{7}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[24-9]"]]]],MM:["95","00","1\\d{5,7}|95\\d{6}|(?:[4-7]|9[0-46-9])\\d{6,8}|(?:2|8\\d)\\d{5,8}",[6,7,8,9,10],[["(\\d)(\\d{2})(\\d{3})","$1 $2 $3",["16|2"],"0$1"],["(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3",["4(?:[2-46]|5[3-5])|5|6(?:[1-689]|7[235-7])|7(?:[0-4]|5[2-7])|8[1-5]|(?:60|86)[23]"],"0$1"],["(\\d)(\\d{3})(\\d{3,4})","$1 $2 $3",["[12]|452|678|86","[12]|452|6788|86"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[4-7]|8[1-35]"],"0$1"],["(\\d)(\\d{3})(\\d{4,6})","$1 $2 $3",["9(?:2[0-4]|[35-9]|4[137-9])"],"0$1"],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["2"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["8"],"0$1"],["(\\d)(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["92"],"0$1"],["(\\d)(\\d{5})(\\d{4})","$1 $2 $3",["9"],"0$1"]],"0"],MN:["976","001","[12]\\d{7,9}|[5-9]\\d{7}",[8,9,10],[["(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3",["[12]1"],"0$1"],["(\\d{4})(\\d{4})","$1 $2",["[5-9]"]],["(\\d{3})(\\d{5,6})","$1 $2",["[12]2[1-3]"],"0$1"],["(\\d{4})(\\d{5,6})","$1 $2",["[12](?:27|3[2-8]|4[2-68]|5[1-4689])","[12](?:27|3[2-8]|4[2-68]|5[1-4689])[0-3]"],"0$1"],["(\\d{5})(\\d{4,5})","$1 $2",["[12]"],"0$1"]],"0"],MO:["853","00","0800\\d{3}|(?:28|[68]\\d)\\d{6}",[7,8],[["(\\d{4})(\\d{3})","$1 $2",["0"]],["(\\d{4})(\\d{4})","$1 $2",["[268]"]]]],MP:["1","011","[58]\\d{9}|(?:67|90)0\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","670$1",0,"670"],MQ:["596","00","(?:596\\d|7091)\\d{5}|(?:69|[89]\\d)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-79]|8(?:0[6-9]|[36])"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"],"0$1"]],"0"],MR:["222","00","(?:[2-4]\\d\\d|800)\\d{5}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2-48]"]]]],MS:["1","011","(?:[58]\\d\\d|664|900)\\d{7}",[10],0,"1",0,"([34]\\d{6})$|1","664$1",0,"664"],MT:["356","00","3550\\d{4}|(?:[2579]\\d\\d|800)\\d{5}",[8],[["(\\d{4})(\\d{4})","$1 $2",["[2357-9]"]]]],MU:["230","0(?:0|[24-7]0|3[03])","(?:[57]|8\\d\\d)\\d{7}|[2-468]\\d{6}",[7,8,10],[["(\\d{3})(\\d{4})","$1 $2",["[2-46]|8[013]"]],["(\\d{4})(\\d{4})","$1 $2",["[57]"]],["(\\d{5})(\\d{5})","$1 $2",["8"]]],0,0,0,0,0,0,0,"020"],MV:["960","0(?:0|19)","(?:800|9[0-57-9]\\d)\\d{7}|[34679]\\d{6}",[7,10],[["(\\d{3})(\\d{4})","$1-$2",["[34679]"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[89]"]]],0,0,0,0,0,0,0,"00"],MW:["265","00","(?:[1289]\\d|31|77)\\d{7}|1\\d{6}",[7,9],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["1[2-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["2"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[137-9]"],"0$1"]],"0"],MX:["52","0[09]","[2-9]\\d{9}",[10],[["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["33|5[56]|81"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[2-9]"]]],0,0,0,0,0,0,0,"00"],MY:["60","00","1\\d{8,9}|(?:3\\d|[4-9])\\d{7}",[8,9,10],[["(\\d)(\\d{3})(\\d{4})","$1-$2 $3",["[4-79]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1-$2 $3",["1(?:[02469]|[378][1-9]|53)|8","1(?:[02469]|[37][1-9]|53|8(?:[1-46-9]|5[7-9]))|8"],"0$1"],["(\\d)(\\d{4})(\\d{4})","$1-$2 $3",["3"],"0$1"],["(\\d)(\\d{3})(\\d{2})(\\d{4})","$1-$2-$3-$4",["1(?:[367]|80)"]],["(\\d{3})(\\d{3})(\\d{4})","$1-$2 $3",["15"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1-$2 $3",["1"],"0$1"]],"0"],MZ:["258","00","(?:2|8\\d)\\d{7}",[8,9],[["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["2|8[2-79]"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["8"]]]],NA:["264","00","[68]\\d{7,8}",[8,9],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["88"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["6"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["87"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["8"],"0$1"]],"0"],NC:["687","00","(?:050|[2-57-9]\\d\\d)\\d{3}",[6],[["(\\d{2})(\\d{2})(\\d{2})","$1.$2.$3",["[02-57-9]"]]]],NE:["227","00","[027-9]\\d{7}",[8],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["08"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[089]|2[013]|7[0467]"]]]],NF:["672","00","[13]\\d{5}",[6],[["(\\d{2})(\\d{4})","$1 $2",["1[0-3]"]],["(\\d)(\\d{5})","$1 $2",["[13]"]]],0,0,"([0-258]\\d{4})$","3$1"],NG:["234","009","(?:20|9\\d)\\d{8}|[78]\\d{9,13}",[10,11,12,13,14],[["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["[7-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["20[129]"],"0$1"],["(\\d{4})(\\d{2})(\\d{4})","$1 $2 $3",["2"],"0$1"],["(\\d{3})(\\d{4})(\\d{4,5})","$1 $2 $3",["[78]"],"0$1"],["(\\d{3})(\\d{5})(\\d{5,6})","$1 $2 $3",["[78]"],"0$1"]],"0"],NI:["505","00","(?:1800|[25-8]\\d{3})\\d{4}",[8],[["(\\d{4})(\\d{4})","$1 $2",["[125-8]"]]]],NL:["31","00","(?:[124-7]\\d\\d|3(?:[02-9]\\d|1[0-8]))\\d{6}|8\\d{6,9}|9\\d{6,10}|1\\d{4,5}",[5,6,7,8,9,10,11],[["(\\d{3})(\\d{4,7})","$1 $2",["[89]0"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["66"],"0$1"],["(\\d)(\\d{8})","$1 $2",["6"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["1[16-8]|2[259]|3[124]|4[17-9]|5[124679]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[1-578]|91"],"0$1"],["(\\d{3})(\\d{3})(\\d{5})","$1 $2 $3",["9"],"0$1"]],"0"],NO:["47","00","(?:0|[2-9]\\d{3})\\d{4}",[5,8],[["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["8"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2-79]"]]],0,0,0,0,0,"[02-689]|7[0-8]"],NP:["977","00","(?:1\\d|9)\\d{9}|[1-9]\\d{7}",[8,10,11],[["(\\d)(\\d{7})","$1-$2",["1[2-6]"],"0$1"],["(\\d{2})(\\d{6})","$1-$2",["1[01]|[2-8]|9(?:[1-59]|[67][2-6])"],"0$1"],["(\\d{3})(\\d{7})","$1-$2",["9"]]],"0"],NR:["674","00","(?:222|444|(?:55|8\\d)\\d|666|777|999)\\d{4}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[24-9]"]]]],NU:["683","00","(?:[4-7]|888\\d)\\d{3}",[4,7],[["(\\d{3})(\\d{4})","$1 $2",["8"]]]],NZ:["64","0(?:0|161)","[1289]\\d{9}|50\\d{5}(?:\\d{2,3})?|[27-9]\\d{7,8}|(?:[34]\\d|6[0-35-9])\\d{6}|8\\d{4,6}",[5,6,7,8,9,10],[["(\\d{2})(\\d{3,8})","$1 $2",["8[1-79]"],"0$1"],["(\\d{3})(\\d{2})(\\d{2,3})","$1 $2 $3",["50[036-8]|8|90","50(?:[0367]|88)|8|90"],"0$1"],["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["24|[346]|7[2-57-9]|9[2-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["2(?:10|74)|[589]"],"0$1"],["(\\d{2})(\\d{3,4})(\\d{4})","$1 $2 $3",["1|2[028]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,5})","$1 $2 $3",["2(?:[169]|7[0-35-9])|7"],"0$1"]],"0",0,0,0,0,0,0,"00"],OM:["968","00","(?:1505|[279]\\d{3}|500)\\d{4}|800\\d{5,6}",[7,8,9],[["(\\d{3})(\\d{4,6})","$1 $2",["[58]"]],["(\\d{2})(\\d{6})","$1 $2",["2"]],["(\\d{4})(\\d{4})","$1 $2",["[179]"]]]],PA:["507","00","(?:00800|8\\d{3})\\d{6}|[68]\\d{7}|[1-57-9]\\d{6}",[7,8,10,11],[["(\\d{3})(\\d{4})","$1-$2",["[1-57-9]"]],["(\\d{4})(\\d{4})","$1-$2",["[68]"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["8"]]]],PE:["51","00|19(?:1[124]|77|90)00","(?:[14-8]|9\\d)\\d{7}",[8,9],[["(\\d{3})(\\d{5})","$1 $2",["80"],"(0$1)"],["(\\d)(\\d{7})","$1 $2",["1"],"(0$1)"],["(\\d{2})(\\d{6})","$1 $2",["[4-8]"],"(0$1)"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["9"]]],"0",0,0,0,0,0,0,"00"," Anexo "],PF:["689","00","4\\d{5}(?:\\d{2})?|8\\d{7,8}",[6,8,9],[["(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3",["44"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["4|8[7-9]"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"]]]],PG:["675","00|140[1-3]","(?:180|[78]\\d{3})\\d{4}|(?:[2-589]\\d|64)\\d{5}",[7,8],[["(\\d{3})(\\d{4})","$1 $2",["18|[2-69]|85"]],["(\\d{4})(\\d{4})","$1 $2",["[78]"]]],0,0,0,0,0,0,0,"00"],PH:["63","00","(?:[2-7]|9\\d)\\d{8}|2\\d{5}|(?:1800|8)\\d{7,9}",[6,8,9,10,11,12,13],[["(\\d)(\\d{5})","$1 $2",["2"],"(0$1)"],["(\\d{4})(\\d{4,6})","$1 $2",["3(?:23|39|46)|4(?:2[3-6]|[35]9|4[26]|76)|544|88[245]|(?:52|64|86)2","3(?:230|397|461)|4(?:2(?:35|[46]4|51)|396|4(?:22|63)|59[347]|76[15])|5(?:221|446)|642[23]|8(?:622|8(?:[24]2|5[13]))"],"(0$1)"],["(\\d{5})(\\d{4})","$1 $2",["346|4(?:27|9[35])|883","3469|4(?:279|9(?:30|56))|8834"],"(0$1)"],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["2"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[3-7]|8[2-8]"],"(0$1)"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[89]"],"0$1"],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["1"]],["(\\d{4})(\\d{1,2})(\\d{3})(\\d{4})","$1 $2 $3 $4",["1"]]],"0"],PK:["92","00","122\\d{6}|[24-8]\\d{10,11}|9(?:[013-9]\\d{8,10}|2(?:[01]\\d\\d|2(?:[06-8]\\d|1[01]))\\d{7})|(?:[2-8]\\d{3}|92(?:[0-7]\\d|8[1-9]))\\d{6}|[24-9]\\d{8}|[89]\\d{7}",[8,9,10,11,12],[["(\\d{3})(\\d{3})(\\d{2,7})","$1 $2 $3",["[89]0"],"0$1"],["(\\d{4})(\\d{5})","$1 $2",["1"]],["(\\d{3})(\\d{6,7})","$1 $2",["2(?:3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(?:2[2-689]|3[23578]|4[3478]|5[2356])|9(?:2[2-8]|3[27-9]|4[2-6]|6[3569]|9[25-8])","9(?:2[3-8]|98)|(?:2(?:3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(?:2[2-689]|3[23578]|4[3478]|5[2356])|9(?:22|3[27-9]|4[2-6]|6[3569]|9[25-7]))[2-9]"],"(0$1)"],["(\\d{2})(\\d{7,8})","$1 $2",["(?:2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)[2-9]"],"(0$1)"],["(\\d{5})(\\d{5})","$1 $2",["58"],"(0$1)"],["(\\d{3})(\\d{7})","$1 $2",["3"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91"],"(0$1)"],["(\\d{3})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["[24-9]"],"(0$1)"]],"0"],PL:["48","00","(?:6|8\\d\\d)\\d{7}|[1-9]\\d{6}(?:\\d{2})?|[26]\\d{5}",[6,7,8,9,10],[["(\\d{5})","$1",["19"]],["(\\d{3})(\\d{3})","$1 $2",["11|20|64"]],["(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3",["(?:1[2-8]|2[2-69]|3[2-4]|4[1-468]|5[24-689]|6[1-3578]|7[14-7]|8[1-79]|9[145])1","(?:1[2-8]|2[2-69]|3[2-4]|4[1-468]|5[24-689]|6[1-3578]|7[14-7]|8[1-79]|9[145])19"]],["(\\d{3})(\\d{2})(\\d{2,3})","$1 $2 $3",["64"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["21|39|45|5[0137]|6[0469]|7[02389]|8(?:0[14]|8)"]],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["1[2-8]|[2-7]|8[1-79]|9[145]"]],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["8"]]]],PM:["508","00","[45]\\d{5}|(?:708|8\\d\\d)\\d{6}",[6,9],[["(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3",["[45]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["7"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"],"0$1"]],"0"],PR:["1","011","(?:[589]\\d\\d|787)\\d{7}",[10],0,"1",0,0,0,0,"787|939"],PS:["970","00","[2489]2\\d{6}|(?:1\\d|5)\\d{8}",[8,9,10],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["[2489]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["5"],"0$1"],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1"]]],"0"],PT:["351","00","1693\\d{5}|(?:[26-9]\\d|30)\\d{7}",[9],[["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["2[12]"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["16|[236-9]"]]]],PW:["680","01[12]","(?:[24-8]\\d\\d|345|900)\\d{4}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[2-9]"]]]],PY:["595","00","59\\d{4,6}|9\\d{5,10}|(?:[2-46-8]\\d|5[0-8])\\d{4,7}",[6,7,8,9,10,11],[["(\\d{3})(\\d{3,6})","$1 $2",["[2-9]0"],"0$1"],["(\\d{2})(\\d{5})","$1 $2",["[26]1|3[289]|4[1246-8]|7[1-3]|8[1-36]"],"(0$1)"],["(\\d{3})(\\d{4,5})","$1 $2",["2[279]|3[13-5]|4[359]|5|6(?:[34]|7[1-46-8])|7[46-8]|85"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["2[14-68]|3[26-9]|4[1246-8]|6(?:1|75)|7[1-35]|8[1-36]"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["87"]],["(\\d{3})(\\d{6})","$1 $2",["9(?:[5-79]|8[1-7])"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[2-8]"],"0$1"],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["9"]]],"0"],QA:["974","00","800\\d{4}|(?:2|800)\\d{6}|(?:0080|[3-7])\\d{7}",[7,8,9,11],[["(\\d{3})(\\d{4})","$1 $2",["2[136]|8"]],["(\\d{4})(\\d{4})","$1 $2",["[3-7]"]]]],RE:["262","00","709\\d{6}|(?:26|[689]\\d)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[26-9]"],"0$1"]],"0",0,0,0,0,0,[["26(?:2\\d\\d|3(?:0\\d|1[0-6]))\\d{4}"],["(?:69(?:2\\d\\d|3(?:[06][0-6]|1[0-3]|2[0-2]|3[0-39]|4\\d|5[0-5]|7[0-37]|8[0-8]|9[0-479]))|7092[0-3])\\d{4}"],["80\\d{7}"],["89[1-37-9]\\d{6}"],0,0,0,0,["9(?:399[0-3]|479[0-6]|76(?:2[278]|3[0-37]))\\d{4}"],["8(?:1[019]|2[0156]|84|90)\\d{6}"]]],RO:["40","00","(?:[236-8]\\d|90)\\d{7}|[23]\\d{5}",[6,9],[["(\\d{3})(\\d{3})","$1 $2",["2[3-6]","2[3-6]\\d9"],"0$1"],["(\\d{2})(\\d{4})","$1 $2",["219|31"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[23]1"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[236-9]"],"0$1"]],"0",0,0,0,0,0,0,0," int "],RS:["381","00","38[02-9]\\d{6,9}|6\\d{7,9}|90\\d{4,8}|38\\d{5,6}|(?:7\\d\\d|800)\\d{3,9}|(?:[12]\\d|3[0-79])\\d{5,10}",[6,7,8,9,10,11,12],[["(\\d{3})(\\d{3,9})","$1 $2",["(?:2[389]|39)0|[7-9]"],"0$1"],["(\\d{2})(\\d{5,10})","$1 $2",["[1-36]"],"0$1"]],"0"],RU:["7","810","8\\d{13}|[347-9]\\d{9}",[10,14],[["(\\d{4})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["7(?:1[0-8]|2[1-9])","7(?:1(?:[0-356]2|4[29]|7|8[27])|2(?:1[23]|[2-9]2))","7(?:1(?:[0-356]2|4[29]|7|8[27])|2(?:13[03-69]|62[013-9]))|72[1-57-9]2"],"8 ($1)",1],["(\\d{5})(\\d)(\\d{2})(\\d{2})","$1 $2 $3 $4",["7(?:1[0-68]|2[1-9])","7(?:1(?:[06][3-6]|[18]|2[35]|[3-5][3-5])|2(?:[13][3-5]|[24-689]|7[457]))","7(?:1(?:0(?:[356]|4[023])|[18]|2(?:3[013-9]|5)|3[45]|43[013-79]|5(?:3[1-8]|4[1-7]|5)|6(?:3[0-35-9]|[4-6]))|2(?:1(?:3[178]|[45])|[24-689]|3[35]|7[457]))|7(?:14|23)4[0-8]|71(?:33|45)[1-79]"],"8 ($1)",1],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["7"],"8 ($1)",1],["(\\d{3})(\\d{3})(\\d{2})(\\d{2})","$1 $2-$3-$4",["[349]|8(?:[02-7]|1[1-8])"],"8 ($1)",1],["(\\d{4})(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3 $4",["8"],"8 ($1)"]],"8",0,0,0,0,0,[["336(?:[013-9]\\d|2[013-9])\\d{5}|(?:3(?:0[12]|4[1-35-79]|5[1-3]|65|8[1-58]|9[0145])|4(?:01|1[1356]|2[13467]|7[1-5]|8[1-7]|9[1-689])|8(?:1[1-8]|2[01]|3[13-6]|4[0-8]|5[15-7]|6[0-35-79]|7[1-37-9]))\\d{7}",[10]],["9\\d{9}",[10]],["8(?:0[04]|108\\d{3})\\d{7}"],["80[39]\\d{7}",[10]],["808\\d{7}",[10]]],"8~10"],RW:["250","00","(?:06|[27]\\d\\d|[89]00)\\d{6}",[8,9],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["0"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["2"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[7-9]"],"0$1"]],"0"],SA:["966","00","(?:[15]\\d|800|92)\\d{7}",[9,10],[["(\\d{4})(\\d{5})","$1 $2",["9"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["1"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["5"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["8"]]],"0"],SB:["677","0[01]","[6-9]\\d{6}|[1-6]\\d{4}",[5,7],[["(\\d{2})(\\d{5})","$1 $2",["6[89]|7|8[4-9]|9(?:[1-8]|9[0-8])"]]]],SC:["248","010|0[0-2]","(?:[2489]\\d|64)\\d{5}",[7],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["[246]|9[57]"]]],0,0,0,0,0,0,0,"00"],SD:["249","00","[19]\\d{8}",[9],[["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[19]"],"0$1"]],"0"],SE:["46","00","(?:[26]\\d\\d|9)\\d{9}|[1-9]\\d{8}|[1-689]\\d{7}|[1-4689]\\d{6}|2\\d{5}",[6,7,8,9,10,12],[["(\\d{2})(\\d{2,3})(\\d{2})","$1-$2 $3",["20"],"0$1",0,"$1 $2 $3"],["(\\d{3})(\\d{4})","$1-$2",["9(?:00|39|44|9)"],"0$1",0,"$1 $2"],["(\\d{2})(\\d{3})(\\d{2})","$1-$2 $3",["[12][136]|3[356]|4[0246]|6[03]|90[1-9]"],"0$1",0,"$1 $2 $3"],["(\\d)(\\d{2,3})(\\d{2})(\\d{2})","$1-$2 $3 $4",["8"],"0$1",0,"$1 $2 $3 $4"],["(\\d{3})(\\d{2,3})(\\d{2})","$1-$2 $3",["1[2457]|2(?:[247-9]|5[0138])|3[0247-9]|4[1357-9]|5[0-35-9]|6(?:[125689]|4[02-57]|7[0-2])|9(?:[125-8]|3[02-5]|4[0-3])"],"0$1",0,"$1 $2 $3"],["(\\d{3})(\\d{2,3})(\\d{3})","$1-$2 $3",["9(?:00|39|44)"],"0$1",0,"$1 $2 $3"],["(\\d{2})(\\d{2,3})(\\d{2})(\\d{2})","$1-$2 $3 $4",["1[13689]|2[0136]|3[1356]|4[0246]|54|6[03]|90[1-9]"],"0$1",0,"$1 $2 $3 $4"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1-$2 $3 $4",["10|7"],"0$1",0,"$1 $2 $3 $4"],["(\\d)(\\d{3})(\\d{3})(\\d{2})","$1-$2 $3 $4",["8"],"0$1",0,"$1 $2 $3 $4"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1-$2 $3 $4",["[13-5]|2(?:[247-9]|5[0138])|6(?:[124-689]|7[0-2])|9(?:[125-8]|3[02-5]|4[0-3])"],"0$1",0,"$1 $2 $3 $4"],["(\\d{3})(\\d{2})(\\d{2})(\\d{3})","$1-$2 $3 $4",["9"],"0$1",0,"$1 $2 $3 $4"],["(\\d{3})(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1-$2 $3 $4 $5",["[26]"],"0$1",0,"$1 $2 $3 $4 $5"]],"0"],SG:["65","0[0-3]\\d","(?:(?:1\\d|8)\\d\\d|7000)\\d{7}|[3689]\\d{7}",[8,10,11],[["(\\d{4})(\\d{4})","$1 $2",["[369]|8(?:0[1-9]|[1-9])"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["8"]],["(\\d{4})(\\d{4})(\\d{3})","$1 $2 $3",["7"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["1"]]]],SH:["290","00","(?:[256]\\d|8)\\d{3}",[4,5],0,0,0,0,0,0,"[256]"],SI:["386","00|10(?:22|66|88|99)","[1-7]\\d{7}|8\\d{4,7}|90\\d{4,6}",[5,6,7,8],[["(\\d{2})(\\d{3,6})","$1 $2",["8[09]|9"],"0$1"],["(\\d{3})(\\d{5})","$1 $2",["59|8"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[37][01]|4[0139]|51|6"],"0$1"],["(\\d)(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[1-57]"],"(0$1)"]],"0",0,0,0,0,0,0,"00"],SJ:["47","00","0\\d{4}|(?:[489]\\d|79)\\d{6}",[5,8],0,0,0,0,0,0,"79"],SK:["421","00","[2-689]\\d{8}|[2-59]\\d{6}|[2-5]\\d{5}",[6,7,9],[["(\\d)(\\d{2})(\\d{3,4})","$1 $2 $3",["21"],"0$1"],["(\\d{2})(\\d{2})(\\d{2,3})","$1 $2 $3",["[3-5][1-8]1","[3-5][1-8]1[67]"],"0$1"],["(\\d)(\\d{3})(\\d{3})(\\d{2})","$1/$2 $3 $4",["2"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[689]"],"0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1/$2 $3 $4",["[3-5]"],"0$1"]],"0"],SL:["232","00","(?:[237-9]\\d|66)\\d{6}",[8],[["(\\d{2})(\\d{6})","$1 $2",["[236-9]"],"(0$1)"]],"0"],SM:["378","00","(?:0549|[5-7]\\d)\\d{6}",[8,10],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-7]"]],["(\\d{4})(\\d{6})","$1 $2",["0"]]],0,0,"([89]\\d{5})$","0549$1"],SN:["221","00","(?:[378]\\d|93)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"]],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[379]"]]]],SO:["252","00","[346-9]\\d{8}|[12679]\\d{7}|[1-5]\\d{6}|[1348]\\d{5}",[6,7,8,9],[["(\\d{2})(\\d{4})","$1 $2",["8[125]"]],["(\\d{6})","$1",["[134]"]],["(\\d)(\\d{6})","$1 $2",["[15]|2[0-79]|3[0-46-8]|4[0-7]"]],["(\\d)(\\d{7})","$1 $2",["(?:2|90)4|[67]"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[348]|64|79|90"]],["(\\d{2})(\\d{5,7})","$1 $2",["1|28|6[0-35-9]|7[67]|9[2-9]"]]],"0"],SR:["597","00","(?:[2-5]|[6-8]\\d|90)\\d{5}",[6,7],[["(\\d{2})(\\d{2})(\\d{2})","$1-$2-$3",["56"]],["(\\d{3})(\\d{3})","$1-$2",["[2-5]"]],["(\\d{3})(\\d{4})","$1-$2",["[6-9]"]]]],SS:["211","00","[19]\\d{8}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[19]"],"0$1"]],"0"],ST:["239","00","(?:22|9\\d)\\d{5}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[29]"]]]],SV:["503","00","[25-7]\\d{7}|(?:80\\d|900)\\d{4}(?:\\d{4})?",[7,8,11],[["(\\d{3})(\\d{4})","$1 $2",["[89]"]],["(\\d{4})(\\d{4})","$1 $2",["[25-7]"]],["(\\d{3})(\\d{4})(\\d{4})","$1 $2 $3",["[89]"]]]],SX:["1","011","7215\\d{6}|(?:[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"(5\\d{6})$|1","721$1",0,"721"],SY:["963","00","[1-359]\\d{8}|[1-5]\\d{7}",[8,9],[["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[1-4]|5[1-3]"],"0$1",1],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[59]"],"0$1",1]],"0"],SZ:["268","00","0800\\d{4}|(?:[237]\\d|900)\\d{6}",[8,9],[["(\\d{4})(\\d{4})","$1 $2",["[0237]"]],["(\\d{5})(\\d{4})","$1 $2",["9"]]]],TA:["290","00","8\\d{3}",[4],0,0,0,0,0,0,"8"],TC:["1","011","(?:[58]\\d\\d|649|900)\\d{7}",[10],0,"1",0,"([2-479]\\d{6})$|1","649$1",0,"649"],TD:["235","00|16","(?:22|30|[689]\\d|77)\\d{6}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[236-9]"]]],0,0,0,0,0,0,0,"00"],TG:["228","00","[279]\\d{7}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[279]"]]]],TH:["66","00[1-9]","(?:001800|[2-57]|[689]\\d)\\d{7}|1\\d{7,9}",[8,9,10,13],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["2"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[13-9]"],"0$1"],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1"]]],"0"],TJ:["992","810","(?:[0-57-9]\\d|66)\\d{7}",[9],[["(\\d{6})(\\d)(\\d{2})","$1 $2 $3",["331","3317"]],["(\\d{3})(\\d{2})(\\d{4})","$1 $2 $3",["44[02-479]|[34]7"]],["(\\d{4})(\\d)(\\d{4})","$1 $2 $3",["3(?:[1245]|3[12])"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["\\d"]]],0,0,0,0,0,0,0,"8~10"],TK:["690","00","[2-47]\\d{3,6}",[4,5,6,7]],TL:["670","00","7\\d{7}|(?:[2-47]\\d|[89]0)\\d{5}",[7,8],[["(\\d{3})(\\d{4})","$1 $2",["[2-489]|70"]],["(\\d{4})(\\d{4})","$1 $2",["7"]]]],TM:["993","810","(?:[1-6]\\d|71)\\d{6}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2-$3-$4",["12"],"(8 $1)"],["(\\d{3})(\\d)(\\d{2})(\\d{2})","$1 $2-$3-$4",["[1-5]"],"(8 $1)"],["(\\d{2})(\\d{6})","$1 $2",["[67]"],"8 $1"]],"8",0,0,0,0,0,0,"8~10"],TN:["216","00","[2-57-9]\\d{7}",[8],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[2-57-9]"]]]],TO:["676","00","(?:0800|(?:[5-8]\\d\\d|999)\\d)\\d{3}|[2-8]\\d{4}",[5,7],[["(\\d{2})(\\d{3})","$1-$2",["[2-4]|50|6[09]|7[0-24-69]|8[05]"]],["(\\d{4})(\\d{3})","$1 $2",["0"]],["(\\d{3})(\\d{4})","$1 $2",["[5-9]"]]]],TR:["90","00","4\\d{6}|8\\d{11,12}|(?:[2-58]\\d\\d|900)\\d{7}",[7,10,12,13],[["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["512|8[01589]|90"],"0$1",1],["(\\d{3})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["5(?:[0-59]|61)","5(?:[0-59]|61[06])","5(?:[0-59]|61[06]1)"],"0$1",1],["(\\d{3})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[24][1-8]|3[1-9]"],"(0$1)",1],["(\\d{3})(\\d{3})(\\d{6,7})","$1 $2 $3",["80"],"0$1",1]],"0"],TT:["1","011","(?:[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-46-8]\\d{6})$|1","868$1",0,"868"],TV:["688","00","(?:2|7\\d\\d|90)\\d{4}",[5,6,7],[["(\\d{2})(\\d{3})","$1 $2",["2"]],["(\\d{2})(\\d{4})","$1 $2",["90"]],["(\\d{2})(\\d{5})","$1 $2",["7"]]]],TW:["886","0(?:0[25-79]|19)","[2-689]\\d{8}|7\\d{9,10}|[2-8]\\d{7}|2\\d{6}",[7,8,9,10,11],[["(\\d{2})(\\d)(\\d{4})","$1 $2 $3",["202"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[258]0"],"0$1"],["(\\d)(\\d{3,4})(\\d{4})","$1 $2 $3",["[23568]|4(?:0[02-48]|[1-47-9])|7[1-9]","[23568]|4(?:0[2-48]|[1-47-9])|(?:400|7)[1-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[49]"],"0$1"],["(\\d{2})(\\d{4})(\\d{4,5})","$1 $2 $3",["7"],"0$1"]],"0",0,0,0,0,0,0,0,"#"],TZ:["255","00[056]","(?:[25-8]\\d|41|90)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{4})","$1 $2 $3",["[89]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[24]"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["5"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[67]"],"0$1"]],"0"],UA:["380","00","[89]\\d{9}|[3-9]\\d{8}",[9,10],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["6[12][29]|(?:3[1-8]|4[136-8]|5[12457]|6[49])2|(?:56|65)[24]","6[12][29]|(?:35|4[1378]|5[12457]|6[49])2|(?:56|65)[24]|(?:3[1-46-8]|46)2[013-9]"],"0$1"],["(\\d{4})(\\d{5})","$1 $2",["3[1-8]|4(?:[1367]|[45][6-9]|8[4-6])|5(?:[1-5]|6[0135689]|7[4-6])|6(?:[12][3-7]|[459])","3[1-8]|4(?:[1367]|[45][6-9]|8[4-6])|5(?:[1-5]|6(?:[015689]|3[02389])|7[4-6])|6(?:[12][3-7]|[459])"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[3-7]|89|9[1-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["[89]"],"0$1"]],"0",0,0,0,0,0,0,"0~0"],UG:["256","00[057]","800\\d{6}|(?:[29]0|[347]\\d)\\d{7}",[9],[["(\\d{4})(\\d{5})","$1 $2",["202","2024"],"0$1"],["(\\d{3})(\\d{6})","$1 $2",["[27-9]|4(?:6[45]|[7-9])"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["[34]"],"0$1"]],"0"],US:["1","011","[2-9]\\d{9}|3\\d{6}",[10],[["(\\d{3})(\\d{4})","$1-$2",["310"],0,1],["(\\d{3})(\\d{3})(\\d{4})","($1) $2-$3",["[2-9]"],0,1,"$1-$2-$3"]],"1",0,0,0,0,0,[["3052(?:0[0-8]|[1-9]\\d)\\d{4}|(?:2742|305[3-9])\\d{6}|(?:472|983)[2-47-9]\\d{6}|(?:2(?:0[1-35-9]|1[02-9]|2[03-57-9]|3[1459]|4[08]|5[1-46]|6[0279]|7[0269]|8[13])|3(?:0[1-47-9]|1[02-9]|2[013-79]|3[0-24679]|4[167]|5[0-2]|6[01349]|8[056])|4(?:0[124-9]|1[02-579]|2[3-5]|3[0245]|4[023578]|58|6[349]|7[0589]|8[04])|5(?:0[1-57-9]|1[0235-8]|20|3[0149]|4[01]|5[179]|6[1-47]|7[0-5]|8[0256])|6(?:0[1-35-9]|1[024-9]|2[03689]|3[016]|4[0156]|5[01679]|6[0-279]|78|8[0-269])|7(?:0[1-46-8]|1[2-9]|2[04-8]|3[0-247]|4[0378]|5[47]|6[02359]|7[0-59]|8[156])|8(?:0[1-68]|1[02-8]|2[0168]|3[0-2589]|4[03578]|5[046-9]|6[02-5]|7[028])|9(?:0[1346-9]|1[02-9]|2[0589]|3[0146-8]|4[01357-9]|5[12469]|7[0-3589]|8[04-69]))[2-9]\\d{6}"],[""],["8(?:00|33|44|55|66|77|88)[2-9]\\d{6}"],["900[2-9]\\d{6}"],["52(?:3(?:[2-46-9][02-9]\\d|5(?:[02-46-9]\\d|5[0-46-9]))|4(?:[2-478][02-9]\\d|5(?:[034]\\d|2[024-9]|5[0-46-9])|6(?:0[1-9]|[2-9]\\d)|9(?:[05-9]\\d|2[0-5]|49)))\\d{4}|52[34][2-9]1[02-9]\\d{4}|5(?:00|2[125-9]|33|44|66|77|88)[2-9]\\d{6}"],0,0,0,["305209\\d{4}"]]],UY:["598","0(?:0|1[3-9]\\d)","0004\\d{2,9}|[1249]\\d{7}|2\\d{3,4}|(?:[49]\\d|80)\\d{5}",[4,5,6,7,8,9,10,11,12,13],[["(\\d{4,5})","$1",["21"]],["(\\d{3})(\\d{3,4})","$1 $2",["0"]],["(\\d{3})(\\d{4})","$1 $2",["[49]0|8"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["9"],"0$1"],["(\\d{4})(\\d{4})","$1 $2",["[124]"]],["(\\d{3})(\\d{3})(\\d{2,4})","$1 $2 $3",["0"]],["(\\d{3})(\\d{3})(\\d{3})(\\d{2,4})","$1 $2 $3 $4",["0"]]],"0",0,0,0,0,0,0,"00"," int. "],UZ:["998","00","(?:20|33|[5-9]\\d)\\d{7}",[9],[["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[235-9]"]]]],VA:["39","00","0\\d{5,10}|3[0-8]\\d{7,10}|55\\d{8}|8\\d{5}(?:\\d{2,4})?|(?:1\\d|39)\\d{7,8}",[6,7,8,9,10,11,12],0,0,0,0,0,0,"06698"],VC:["1","011","(?:[58]\\d\\d|784|900)\\d{7}",[10],0,"1",0,"([2-7]\\d{6})$|1","784$1",0,"784"],VE:["58","00","[68]00\\d{7}|(?:[24]\\d|[59]0)\\d{8}",[10],[["(\\d{3})(\\d{7})","$1-$2",["[24-689]"],"0$1"]],"0"],VG:["1","011","(?:284|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-578]\\d{6})$|1","284$1",0,"284"],VI:["1","011","[58]\\d{9}|(?:34|90)0\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","340$1",0,"340"],VN:["84","00","[12]\\d{9}|[135-9]\\d{8}|[16]\\d{7}|[16-8]\\d{6}",[7,8,9,10],[["(\\d{2})(\\d{5})","$1 $2",["80"],"0$1",1],["(\\d{4})(\\d{4,6})","$1 $2",["1"],0,1],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["6"],"0$1",1],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[357-9]"],"0$1",1],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["2[48]"],"0$1",1],["(\\d{3})(\\d{4})(\\d{3})","$1 $2 $3",["2"],"0$1",1]],"0"],VU:["678","00","[57-9]\\d{6}|(?:[238]\\d|48)\\d{3}",[5,7],[["(\\d{3})(\\d{4})","$1 $2",["[57-9]"]]]],WF:["681","00","(?:40|72|8\\d{4})\\d{4}|[89]\\d{5}",[6,9],[["(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3",["[47-9]"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"]]]],WS:["685","0","(?:[2-6]|8\\d{5})\\d{4}|[78]\\d{6}|[68]\\d{5}",[5,6,7,10],[["(\\d{5})","$1",["[2-5]|6[1-9]"]],["(\\d{3})(\\d{3,7})","$1 $2",["[68]"]],["(\\d{2})(\\d{5})","$1 $2",["7"]]]],XK:["383","00","2\\d{7,8}|3\\d{7,11}|(?:4\\d\\d|[89]00)\\d{5}",[8,9,10,11,12],[["(\\d{3})(\\d{5})","$1 $2",["[89]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[2-4]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["2|39"],"0$1"],["(\\d{2})(\\d{7,10})","$1 $2",["3"],"0$1"]],"0"],YE:["967","00","(?:1|7\\d)\\d{7}|[1-7]\\d{6}",[7,8,9],[["(\\d)(\\d{3})(\\d{3,4})","$1 $2 $3",["[1-6]|7(?:[24-6]|8[0-7])"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["7"],"0$1"]],"0"],YT:["262","00","7093\\d{5}|(?:80|9\\d)\\d{7}|(?:26|63)9\\d{6}",[9],0,"0",0,0,0,0,0,[["269(?:0[0-467]|15|5[0-4]|6\\d|[78]0)\\d{4}"],["(?:639(?:0[0-79]|1[019]|[267]\\d|3[09]|40|5[05-9]|9[04-79])|7093[5-7])\\d{4}"],["80\\d{7}"],0,0,0,0,0,["9(?:(?:39|47)8[01]|769\\d)\\d{4}"]]],ZA:["27","00","[1-79]\\d{8}|8\\d{4,9}",[5,6,7,8,9,10],[["(\\d{2})(\\d{3,4})","$1 $2",["8[1-4]"],"0$1"],["(\\d{2})(\\d{3})(\\d{2,3})","$1 $2 $3",["8[1-4]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["860"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[1-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["8"],"0$1"]],"0"],ZM:["260","00","800\\d{6}|(?:21|[579]\\d|63)\\d{7}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[28]"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["[579]"],"0$1"]],"0"],ZW:["263","00","2(?:[0-57-9]\\d{6,8}|6[0-24-9]\\d{6,7})|[38]\\d{9}|[35-8]\\d{8}|[3-6]\\d{7}|[1-689]\\d{6}|[1-3569]\\d{5}|[1356]\\d{4}",[5,6,7,8,9,10],[["(\\d{3})(\\d{3,5})","$1 $2",["2(?:0[45]|2[278]|[49]8)|3(?:[09]8|17)|6(?:[29]8|37|75)|[23][78]|(?:33|5[15]|6[68])[78]"],"0$1"],["(\\d)(\\d{3})(\\d{2,4})","$1 $2 $3",["[49]"],"0$1"],["(\\d{3})(\\d{4})","$1 $2",["80"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["24|8[13-59]|(?:2[05-79]|39|5[45]|6[15-8])2","2(?:02[014]|4|[56]20|[79]2)|392|5(?:42|525)|6(?:[16-8]21|52[013])|8[13-59]"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["7"],"0$1"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["2(?:1[39]|2[0157]|[378]|[56][14])|3(?:12|29)","2(?:1[39]|2[0157]|[378]|[56][14])|3(?:123|29)"],"0$1"],["(\\d{4})(\\d{6})","$1 $2",["8"],"0$1"],["(\\d{2})(\\d{3,5})","$1 $2",["1|2(?:0[0-36-9]|12|29|[56])|3(?:1[0-689]|[24-6])|5(?:[0236-9]|1[2-4])|6(?:[013-59]|7[0-46-9])|(?:33|55|6[68])[0-69]|(?:29|3[09]|62)[0-79]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["29[013-9]|39|54"],"0$1"],["(\\d{4})(\\d{3,5})","$1 $2",["(?:25|54)8","258|5483"],"0$1"]],"0"]},nonGeographic:{800:["800",0,"(?:00|[1-9]\\d)\\d{6}",[8],[["(\\d{4})(\\d{4})","$1 $2",["\\d"]]],0,0,0,0,0,0,[0,0,["(?:00|[1-9]\\d)\\d{6}"]]],808:["808",0,"[1-9]\\d{7}",[8],[["(\\d{4})(\\d{4})","$1 $2",["[1-9]"]]],0,0,0,0,0,0,[0,0,0,0,0,0,0,0,0,["[1-9]\\d{7}"]]],870:["870",0,"7\\d{11}|[235-7]\\d{8}",[9,12],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[235-7]"]]],0,0,0,0,0,0,[0,["(?:[356]|774[45])\\d{8}|7[6-8]\\d{7}"],0,0,0,0,0,0,["2\\d{8}",[9]]]],878:["878",0,"10\\d{10}",[12],[["(\\d{2})(\\d{5})(\\d{5})","$1 $2 $3",["1"]]],0,0,0,0,0,0,[0,0,0,0,0,0,0,0,["10\\d{10}"]]],881:["881",0,"6\\d{9}|[0-36-9]\\d{8}",[9,10],[["(\\d)(\\d{3})(\\d{5})","$1 $2 $3",["[0-37-9]"]],["(\\d)(\\d{3})(\\d{5,6})","$1 $2 $3",["6"]]],0,0,0,0,0,0,[0,["6\\d{9}|[0-36-9]\\d{8}"]]],882:["882",0,"[13]\\d{6}(?:\\d{2,5})?|[19]\\d{7}|(?:[25]\\d\\d|4)\\d{7}(?:\\d{2})?",[7,8,9,10,11,12],[["(\\d{2})(\\d{5})","$1 $2",["16|342"]],["(\\d{2})(\\d{6})","$1 $2",["49"]],["(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3",["1[36]|9"]],["(\\d{2})(\\d{4})(\\d{3})","$1 $2 $3",["3[23]"]],["(\\d{2})(\\d{3,4})(\\d{4})","$1 $2 $3",["16"]],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["10|23|3(?:[15]|4[57])|4|51"]],["(\\d{3})(\\d{4})(\\d{4})","$1 $2 $3",["34"]],["(\\d{2})(\\d{4,5})(\\d{5})","$1 $2 $3",["[1-35]"]]],0,0,0,0,0,0,[0,["342\\d{4}|(?:337|49)\\d{6}|(?:3(?:2|47|7\\d{3})|50\\d{3})\\d{7}",[7,8,9,10,12]],0,0,0,["348[57]\\d{7}",[11]],0,0,["1(?:3(?:0[0347]|[13][0139]|2[035]|4[013568]|6[0459]|7[06]|8[15-8]|9[0689])\\d{4}|6\\d{5,10})|(?:345\\d|9[89])\\d{6}|(?:10|2(?:3|85\\d)|3(?:[15]|[69]\\d\\d)|4[15-8]|51)\\d{8}"]]],883:["883",0,"(?:[1-4]\\d|51)\\d{6,10}",[8,9,10,11,12],[["(\\d{3})(\\d{3})(\\d{2,8})","$1 $2 $3",["[14]|2[24-689]|3[02-689]|51[24-9]"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["510"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["21"]],["(\\d{4})(\\d{4})(\\d{4})","$1 $2 $3",["51[13]"]],["(\\d{3})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["[235]"]]],0,0,0,0,0,0,[0,0,0,0,0,0,0,0,["(?:2(?:00\\d\\d|10)|(?:370[1-9]|51\\d0)\\d)\\d{7}|51(?:00\\d{5}|[24-9]0\\d{4,7})|(?:1[0-79]|2[24-689]|3[02-689]|4[0-4])0\\d{5,9}"]]],888:["888",0,"\\d{11}",[11],[["(\\d{3})(\\d{3})(\\d{5})","$1 $2 $3"]],0,0,0,0,0,0,[0,0,0,0,0,0,["\\d{11}"]]],979:["979",0,"[1359]\\d{8}",[9],[["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["[1359]"]]],0,0,0,0,0,0,[0,0,0,["[1359]\\d{8}"]]]}};function withMetadataArgument(y,u){var g=Array.prototype.slice.call(u);return g.push(metadata),y.apply(this,g)}function compare$1(y,u){y=y.split("-"),u=u.split("-");for(var g=y[0].split("."),v=u[0].split("."),b=0;b<3;b++){var w=Number(g[b]),E=Number(v[b]);if(w>E)return 1;if(E>w)return-1;if(!isNaN(w)&&isNaN(E))return 1;if(isNaN(w)&&!isNaN(E))return-1}return y[1]&&u[1]?y[1]>u[1]?1:y[1]<u[1]?-1:0:!y[1]&&u[1]?1:y[1]&&!u[1]?-1:0}var objectConstructor={}.constructor;function isObject$2(y){return y!=null&&y.constructor===objectConstructor}function _typeof$6(y){"@babel/helpers - typeof";return _typeof$6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},_typeof$6(y)}function _classCallCheck$2(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(y,u){for(var g=0;g<u.length;g++){var v=u[g];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(y,_toPropertyKey$5(v.key),v)}}function _createClass$2(y,u,g){return u&&_defineProperties$1(y.prototype,u),Object.defineProperty(y,"prototype",{writable:!1}),y}function _toPropertyKey$5(y){var u=_toPrimitive$5(y,"string");return _typeof$6(u)=="symbol"?u:u+""}function _toPrimitive$5(y,u){if(_typeof$6(y)!="object"||!y)return y;var g=y[Symbol.toPrimitive];if(g!==void 0){var v=g.call(y,u);if(_typeof$6(v)!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(y)}var V3="1.2.0",V4="1.7.35",DEFAULT_EXT_PREFIX=" ext. ",CALLING_CODE_REG_EXP=/^\d+$/,Metadata=(function(){function y(u){_classCallCheck$2(this,y),validateMetadata$1(u),this.metadata=u,setVersion.call(this,u)}return _createClass$2(y,[{key:"getCountries",value:function(){return Object.keys(this.metadata.countries).filter(function(g){return g!=="001"})}},{key:"getCountryMetadata",value:function(g){return this.metadata.countries[g]}},{key:"nonGeographic",value:function(){if(!(this.v1||this.v2||this.v3))return this.metadata.nonGeographic||this.metadata.nonGeographical}},{key:"hasCountry",value:function(g){return this.getCountryMetadata(g)!==void 0}},{key:"hasCallingCode",value:function(g){if(this.getCountryCodesForCallingCode(g))return!0;if(this.nonGeographic()){if(this.nonGeographic()[g])return!0}else{var v=this.countryCallingCodes()[g];if(v&&v.length===1&&v[0]==="001")return!0}}},{key:"isNonGeographicCallingCode",value:function(g){return this.nonGeographic()?!!this.nonGeographic()[g]:!this.getCountryCodesForCallingCode(g)}},{key:"country",value:function(g){return this.selectNumberingPlan(g)}},{key:"selectNumberingPlan",value:function(g,v){if(g&&CALLING_CODE_REG_EXP.test(g)&&(v=g,g=null),g&&g!=="001"){if(!this.hasCountry(g))throw new Error("Unknown country: ".concat(g));this.numberingPlan=new NumberingPlan(this.getCountryMetadata(g),this)}else if(v){if(!this.hasCallingCode(v))throw new Error("Unknown calling code: ".concat(v));this.numberingPlan=new NumberingPlan(this.getNumberingPlanMetadata(v),this)}else this.numberingPlan=void 0;return this}},{key:"getCountryCodesForCallingCode",value:function(g){var v=this.countryCallingCodes()[g];if(v)return v.length===1&&v[0].length===3?void 0:v}},{key:"getCountryCodeForCallingCode",value:function(g){var v=this.getCountryCodesForCallingCode(g);if(v)return v[0]}},{key:"getNumberingPlanMetadata",value:function(g){var v=this.getCountryCodeForCallingCode(g);if(v)return this.getCountryMetadata(v);if(this.nonGeographic()){var b=this.nonGeographic()[g];if(b)return b}else{var w=this.countryCallingCodes()[g];if(w&&w.length===1&&w[0]==="001")return this.metadata.countries["001"]}}},{key:"countryCallingCode",value:function(){return this.numberingPlan.callingCode()}},{key:"IDDPrefix",value:function(){return this.numberingPlan.IDDPrefix()}},{key:"defaultIDDPrefix",value:function(){return this.numberingPlan.defaultIDDPrefix()}},{key:"nationalNumberPattern",value:function(){return this.numberingPlan.nationalNumberPattern()}},{key:"possibleLengths",value:function(){return this.numberingPlan.possibleLengths()}},{key:"formats",value:function(){return this.numberingPlan.formats()}},{key:"nationalPrefixForParsing",value:function(){return this.numberingPlan.nationalPrefixForParsing()}},{key:"nationalPrefixTransformRule",value:function(){return this.numberingPlan.nationalPrefixTransformRule()}},{key:"leadingDigits",value:function(){return this.numberingPlan.leadingDigits()}},{key:"hasTypes",value:function(){return this.numberingPlan.hasTypes()}},{key:"type",value:function(g){return this.numberingPlan.type(g)}},{key:"ext",value:function(){return this.numberingPlan.ext()}},{key:"countryCallingCodes",value:function(){return this.v1?this.metadata.country_phone_code_to_countries:this.metadata.country_calling_codes}},{key:"chooseCountryByCountryCallingCode",value:function(g){return this.selectNumberingPlan(g)}},{key:"hasSelectedNumberingPlan",value:function(){return this.numberingPlan!==void 0}}])})(),NumberingPlan=(function(){function y(u,g){_classCallCheck$2(this,y),this.globalMetadataObject=g,this.metadata=u,setVersion.call(this,g.metadata)}return _createClass$2(y,[{key:"callingCode",value:function(){return this.metadata[0]}},{key:"getDefaultCountryMetadataForRegion",value:function(){return this.globalMetadataObject.getNumberingPlanMetadata(this.callingCode())}},{key:"IDDPrefix",value:function(){if(!(this.v1||this.v2))return this.metadata[1]}},{key:"defaultIDDPrefix",value:function(){if(!(this.v1||this.v2))return this.metadata[12]}},{key:"nationalNumberPattern",value:function(){return this.v1||this.v2?this.metadata[1]:this.metadata[2]}},{key:"possibleLengths",value:function(){if(!this.v1)return this.metadata[this.v2?2:3]}},{key:"_getFormats",value:function(g){return g[this.v1?2:this.v2?3:4]}},{key:"formats",value:function(){var g=this,v=this._getFormats(this.metadata)||this._getFormats(this.getDefaultCountryMetadataForRegion())||[];return v.map(function(b){return new Format(b,g)})}},{key:"nationalPrefix",value:function(){return this.metadata[this.v1?3:this.v2?4:5]}},{key:"_getNationalPrefixFormattingRule",value:function(g){return g[this.v1?4:this.v2?5:6]}},{key:"nationalPrefixFormattingRule",value:function(){return this._getNationalPrefixFormattingRule(this.metadata)||this._getNationalPrefixFormattingRule(this.getDefaultCountryMetadataForRegion())}},{key:"_nationalPrefixForParsing",value:function(){return this.metadata[this.v1?5:this.v2?6:7]}},{key:"nationalPrefixForParsing",value:function(){return this._nationalPrefixForParsing()||this.nationalPrefix()}},{key:"nationalPrefixTransformRule",value:function(){return this.metadata[this.v1?6:this.v2?7:8]}},{key:"_getNationalPrefixIsOptionalWhenFormatting",value:function(){return!!this.metadata[this.v1?7:this.v2?8:9]}},{key:"nationalPrefixIsOptionalWhenFormattingInNationalFormat",value:function(){return this._getNationalPrefixIsOptionalWhenFormatting(this.metadata)||this._getNationalPrefixIsOptionalWhenFormatting(this.getDefaultCountryMetadataForRegion())}},{key:"leadingDigits",value:function(){return this.metadata[this.v1?8:this.v2?9:10]}},{key:"types",value:function(){return this.metadata[this.v1?9:this.v2?10:11]}},{key:"hasTypes",value:function(){return this.types()&&this.types().length===0?!1:!!this.types()}},{key:"type",value:function(g){if(this.hasTypes()&&getType(this.types(),g))return new Type$1(getType(this.types(),g),this)}},{key:"ext",value:function(){return this.v1||this.v2?DEFAULT_EXT_PREFIX:this.metadata[13]||DEFAULT_EXT_PREFIX}}])})(),Format=(function(){function y(u,g){_classCallCheck$2(this,y),this._format=u,this.metadata=g}return _createClass$2(y,[{key:"pattern",value:function(){return this._format[0]}},{key:"format",value:function(){return this._format[1]}},{key:"leadingDigitsPatterns",value:function(){return this._format[2]||[]}},{key:"nationalPrefixFormattingRule",value:function(){return this._format[3]||this.metadata.nationalPrefixFormattingRule()}},{key:"nationalPrefixIsOptionalWhenFormattingInNationalFormat",value:function(){return!!this._format[4]||this.metadata.nationalPrefixIsOptionalWhenFormattingInNationalFormat()}},{key:"nationalPrefixIsMandatoryWhenFormattingInNationalFormat",value:function(){return this.usesNationalPrefix()&&!this.nationalPrefixIsOptionalWhenFormattingInNationalFormat()}},{key:"usesNationalPrefix",value:function(){return!!(this.nationalPrefixFormattingRule()&&!FIRST_GROUP_ONLY_PREFIX_PATTERN.test(this.nationalPrefixFormattingRule()))}},{key:"internationalFormat",value:function(){return this._format[5]||this.format()}}])})(),FIRST_GROUP_ONLY_PREFIX_PATTERN=/^\(?\$1\)?$/,Type$1=(function(){function y(u,g){_classCallCheck$2(this,y),this.type=u,this.metadata=g}return _createClass$2(y,[{key:"pattern",value:function(){return this.metadata.v1?this.type:this.type[0]}},{key:"possibleLengths",value:function(){if(!this.metadata.v1)return this.type[1]||this.metadata.possibleLengths()}}])})();function getType(y,u){switch(u){case"FIXED_LINE":return y[0];case"MOBILE":return y[1];case"TOLL_FREE":return y[2];case"PREMIUM_RATE":return y[3];case"PERSONAL_NUMBER":return y[4];case"VOICEMAIL":return y[5];case"UAN":return y[6];case"PAGER":return y[7];case"VOIP":return y[8];case"SHARED_COST":return y[9]}}function validateMetadata$1(y){if(!y)throw new Error("[libphonenumber-js] `metadata` argument not passed. Check your arguments.");if(!isObject$2(y)||!isObject$2(y.countries))throw new Error("[libphonenumber-js] `metadata` argument was passed but it's not a valid metadata. Must be an object having `.countries` child object property. Got ".concat(isObject$2(y)?"an object of shape: { "+Object.keys(y).join(", ")+" }":"a "+typeOf(y)+": "+y,"."))}var typeOf=function y(u){return _typeof$6(u)};function getCountryCallingCode(y,u){if(u=new Metadata(u),u.hasCountry(y))return u.selectNumberingPlan(y).countryCallingCode();throw new Error("Unknown country: ".concat(y))}function isSupportedCountry(y,u){return u.countries.hasOwnProperty(y)}function setVersion(y){var u=y.version;typeof u=="number"?(this.v1=u===1,this.v2=u===2,this.v3=u===3,this.v4=u===4):u?compare$1(u,V3)===-1?this.v2=!0:compare$1(u,V4)===-1?this.v3=!0:this.v4=!0:this.v1=!0}function checkNumberLength(y,u,g){return checkNumberLengthForType(y,u,void 0,g)}function checkNumberLengthForType(y,u,g,v){u&&(v=new Metadata(v.metadata),v.selectNumberingPlan(u));var b=v.type(g),w=b&&b.possibleLengths()||v.possibleLengths();if(!w)return"IS_POSSIBLE";var E=y.length,S=w[0];return S===E?"IS_POSSIBLE":S>E?"TOO_SHORT":w[w.length-1]<E?"TOO_LONG":w.indexOf(E,1)>=0?"IS_POSSIBLE":"INVALID_LENGTH"}function isPossiblePhoneNumber(y,u,g){if(u===void 0&&(u={}),g=new Metadata(g),u.v2){if(!y.countryCallingCode)throw new Error("Invalid phone number object passed");g.selectNumberingPlan(y.countryCallingCode)}else{if(!y.phone)return!1;if(y.country){if(!g.hasCountry(y.country))throw new Error("Unknown country: ".concat(y.country));g.selectNumberingPlan(y.country)}else{if(!y.countryCallingCode)throw new Error("Invalid phone number object passed");g.selectNumberingPlan(y.countryCallingCode)}}if(g.possibleLengths())return isPossibleNumber(y.phone||y.nationalNumber,y.country,g);if(y.countryCallingCode&&g.isNonGeographicCallingCode(y.countryCallingCode))return!0;throw new Error('Missing "possibleLengths" in metadata. Perhaps the metadata has been generated before v1.0.18.')}function isPossibleNumber(y,u,g){switch(checkNumberLength(y,u,g)){case"IS_POSSIBLE":return!0;default:return!1}}function matchesEntirely(y,u){return y=y||"",new RegExp("^(?:"+u+")$").test(y)}function _createForOfIteratorHelperLoose$2(y,u){var g=typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(g)return(g=g.call(y)).next.bind(g);if(Array.isArray(y)||(g=_unsupportedIterableToArray$3(y))||u){g&&(y=g);var v=0;return function(){return v>=y.length?{done:!0}:{done:!1,value:y[v++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$3(y,u){if(y){if(typeof y=="string")return _arrayLikeToArray$3(y,u);var g={}.toString.call(y).slice(8,-1);return g==="Object"&&y.constructor&&(g=y.constructor.name),g==="Map"||g==="Set"?Array.from(y):g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g)?_arrayLikeToArray$3(y,u):void 0}}function _arrayLikeToArray$3(y,u){(u==null||u>y.length)&&(u=y.length);for(var g=0,v=Array(u);g<u;g++)v[g]=y[g];return v}var NON_FIXED_LINE_PHONE_TYPES=["MOBILE","PREMIUM_RATE","TOLL_FREE","SHARED_COST","VOIP","PERSONAL_NUMBER","PAGER","UAN","VOICEMAIL"];function getNumberType(y,u,g){if(u=u||{},!(!y.country&&!y.countryCallingCode)){g=new Metadata(g),g.selectNumberingPlan(y.country,y.countryCallingCode);var v=u.v2?y.nationalNumber:y.phone;if(matchesEntirely(v,g.nationalNumberPattern())){if(isNumberTypeEqualTo(v,"FIXED_LINE",g))return g.type("MOBILE")&&g.type("MOBILE").pattern()===""||!g.type("MOBILE")||isNumberTypeEqualTo(v,"MOBILE",g)?"FIXED_LINE_OR_MOBILE":"FIXED_LINE";for(var b=_createForOfIteratorHelperLoose$2(NON_FIXED_LINE_PHONE_TYPES),w;!(w=b()).done;){var E=w.value;if(isNumberTypeEqualTo(v,E,g))return E}}}}function isNumberTypeEqualTo(y,u,g){return u=g.type(u),!u||!u.pattern()||u.possibleLengths()&&u.possibleLengths().indexOf(y.length)<0?!1:matchesEntirely(y,u.pattern())}function isValidNumber(y,u,g){if(u=u||{},g=new Metadata(g),g.selectNumberingPlan(y.country,y.countryCallingCode),g.hasTypes())return getNumberType(y,u,g.metadata)!==void 0;var v=u.v2?y.nationalNumber:y.phone;return matchesEntirely(v,g.nationalNumberPattern())}function getPossibleCountriesForNumber(y,u,g){var v=new Metadata(g),b=v.getCountryCodesForCallingCode(y);return b?b.filter(function(w){return couldNationalNumberBelongToCountry(u,w,g)}):[]}function couldNationalNumberBelongToCountry(y,u,g){var v=new Metadata(g);return v.selectNumberingPlan(u),v.numberingPlan.possibleLengths().indexOf(y.length)>=0}var MIN_LENGTH_FOR_NSN=2,MAX_LENGTH_FOR_NSN=17,MAX_LENGTH_COUNTRY_CODE=3,VALID_DIGITS="0-9---",DASHES="--",SLASHES="/",DOTS=".",WHITESPACE=" ",BRACKETS="()\\[\\]",TILDES="~",VALID_PUNCTUATION="".concat(DASHES).concat(SLASHES).concat(DOTS).concat(WHITESPACE).concat(BRACKETS).concat(TILDES),PLUS_CHARS="+",CAPTURING_DIGIT_PATTERN=new RegExp("(["+VALID_DIGITS+"])");function stripIddPrefix(y,u,g,v){if(u){var b=new Metadata(v);b.selectNumberingPlan(u,g);var w=new RegExp(b.IDDPrefix());if(y.search(w)===0){y=y.slice(y.match(w)[0].length);var E=y.match(CAPTURING_DIGIT_PATTERN);if(!(E&&E[1]!=null&&E[1].length>0&&E[1]==="0"))return y}}}function extractNationalNumberFromPossiblyIncompleteNumber(y,u){if(y&&u.numberingPlan.nationalPrefixForParsing()){var g=new RegExp("^(?:"+u.numberingPlan.nationalPrefixForParsing()+")"),v=g.exec(y);if(v){var b,w,E=v.length-1,S=E>0&&v[E];if(u.nationalPrefixTransformRule()&&S)b=y.replace(g,u.nationalPrefixTransformRule()),E>1&&(w=v[1]);else{var A=v[0];b=y.slice(A.length),S&&(w=v[1])}var $;if(S){var R=y.indexOf(v[1]),T=y.slice(0,R);T===u.numberingPlan.nationalPrefix()&&($=u.numberingPlan.nationalPrefix())}else $=v[0];return{nationalNumber:b,nationalPrefix:$,carrierCode:w}}}return{nationalNumber:y}}function _createForOfIteratorHelperLoose$1(y,u){var g=typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(g)return(g=g.call(y)).next.bind(g);if(Array.isArray(y)||(g=_unsupportedIterableToArray$2(y))||u){g&&(y=g);var v=0;return function(){return v>=y.length?{done:!0}:{done:!1,value:y[v++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$2(y,u){if(y){if(typeof y=="string")return _arrayLikeToArray$2(y,u);var g={}.toString.call(y).slice(8,-1);return g==="Object"&&y.constructor&&(g=y.constructor.name),g==="Map"||g==="Set"?Array.from(y):g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g)?_arrayLikeToArray$2(y,u):void 0}}function _arrayLikeToArray$2(y,u){(u==null||u>y.length)&&(u=y.length);for(var g=0,v=Array(u);g<u;g++)v[g]=y[g];return v}function getCountryByNationalNumber(y,u){var g=u.countries,v=u.metadata;v=new Metadata(v);for(var b=_createForOfIteratorHelperLoose$1(g),w;!(w=b()).done;){var E=w.value;if(v.selectNumberingPlan(E),v.leadingDigits()){if(y&&y.search(v.leadingDigits())===0)return E}else if(getNumberType({phone:y,country:E},void 0,v.metadata))return E}}function getCountryByCallingCode(y,u){var g=u.nationalNumber,v=u.metadata,b=v.getCountryCodesForCallingCode(y);if(b)return b.length===1?b[0]:getCountryByNationalNumber(g,{countries:b,metadata:v.metadata})}function extractNationalNumber(y,u,g){var v=extractNationalNumberFromPossiblyIncompleteNumber(y,g),b=v.carrierCode,w=v.nationalNumber;if(w!==y){if(!shouldHaveExtractedNationalPrefix(y,w,g))return{nationalNumber:y};if(g.numberingPlan.possibleLengths()&&(u||(u=getCountryByCallingCode(g.numberingPlan.callingCode(),{nationalNumber:w,metadata:g})),!isPossibleIncompleteNationalNumber(w,u,g)))return{nationalNumber:y}}return{nationalNumber:w,carrierCode:b}}function shouldHaveExtractedNationalPrefix(y,u,g){return!(matchesEntirely(y,g.nationalNumberPattern())&&!matchesEntirely(u,g.nationalNumberPattern()))}function isPossibleIncompleteNationalNumber(y,u,g){switch(checkNumberLength(y,u,g)){case"TOO_SHORT":case"INVALID_LENGTH":return!1;default:return!0}}function extractCountryCallingCodeFromInternationalNumberWithoutPlusSign(y,u,g,v,b){var w=g?getCountryCallingCode(g,b):v;if(y.indexOf(w)===0){b=new Metadata(b),b.selectNumberingPlan(g,w);var E=y.slice(w.length),S=extractNationalNumber(E,u,b),A=S.nationalNumber,$=extractNationalNumber(y,u,b),R=$.nationalNumber;if(!matchesEntirely(R,b.nationalNumberPattern())&&matchesEntirely(A,b.nationalNumberPattern())||checkNumberLength(R,u,b)==="TOO_LONG")return{countryCallingCode:w,number:E}}return{number:y}}function extractCountryCallingCode(y,u,g,v,b){if(!y)return{};var w;if(y[0]!=="+"){var E=stripIddPrefix(y,g,v,b);if(E&&E!==y)w=!0,y="+"+E;else{if(g||v){var S=extractCountryCallingCodeFromInternationalNumberWithoutPlusSign(y,u,g,v,b),A=S.countryCallingCode,$=S.number;if(A)return{countryCallingCodeSource:"FROM_NUMBER_WITHOUT_PLUS_SIGN",countryCallingCode:A,number:$}}return{number:y}}}if(y[1]==="0")return{};b=new Metadata(b);for(var R=2;R-1<=MAX_LENGTH_COUNTRY_CODE&&R<=y.length;){var T=y.slice(1,R);if(b.hasCallingCode(T))return b.selectNumberingPlan(T),{countryCallingCodeSource:w?"FROM_NUMBER_WITH_IDD":"FROM_NUMBER_WITH_PLUS_SIGN",countryCallingCode:T,number:y.slice(R)};R++}return{}}function applyInternationalSeparatorStyle(y){return y.replace(new RegExp("[".concat(VALID_PUNCTUATION,"]+"),"g")," ").trim()}var FIRST_GROUP_PATTERN=/(\$\d)/;function formatNationalNumberUsingFormat(y,u,g){var v=g.useInternationalFormat,b=g.withNationalPrefix,w=y.replace(new RegExp(u.pattern()),v?u.internationalFormat():b&&u.nationalPrefixFormattingRule()?u.format().replace(FIRST_GROUP_PATTERN,u.nationalPrefixFormattingRule()):u.format());return v?applyInternationalSeparatorStyle(w):w}var SINGLE_IDD_PREFIX_REG_EXP=/^[\d]+(?:[~\u2053\u223C\uFF5E][\d]+)?$/;function getIddPrefix(y,u,g){var v=new Metadata(g);if(v.selectNumberingPlan(y,u),v.defaultIDDPrefix())return v.defaultIDDPrefix();if(SINGLE_IDD_PREFIX_REG_EXP.test(v.IDDPrefix()))return v.IDDPrefix()}var RFC3966_EXTN_PREFIX=";ext=",getExtensionDigitsPattern=function y(u){return"([".concat(VALID_DIGITS,"]{1,").concat(u,"})")};function createExtensionPattern(y){var u="20",g="15",v="9",b="6",w="[ \\t,]*",E="[:\\.]?[ \\t,-]*",S="#?",A="(?:e?xt(?:ensi(?:o?|))?n?|??||anexo)",$="(?:[x#~]|int|)",R="[- ]+",T="[ \\t]*",O="(?:,{2}|;)",B=RFC3966_EXTN_PREFIX+getExtensionDigitsPattern(u),F=w+A+E+getExtensionDigitsPattern(u)+S,U=w+$+E+getExtensionDigitsPattern(v)+S,q=R+getExtensionDigitsPattern(b)+"#",J=T+O+E+getExtensionDigitsPattern(g)+S,ie=T+"(?:,)+"+E+getExtensionDigitsPattern(v)+S;return B+"|"+F+"|"+U+"|"+q+"|"+J+"|"+ie}var MIN_LENGTH_PHONE_NUMBER_PATTERN="["+VALID_DIGITS+"]{"+MIN_LENGTH_FOR_NSN+"}",VALID_PHONE_NUMBER="["+PLUS_CHARS+"]{0,1}(?:["+VALID_PUNCTUATION+"]*["+VALID_DIGITS+"]){3,}["+VALID_PUNCTUATION+VALID_DIGITS+"]*",VALID_PHONE_NUMBER_START_REG_EXP=new RegExp("^["+PLUS_CHARS+"]{0,1}(?:["+VALID_PUNCTUATION+"]*["+VALID_DIGITS+"]){1,2}$","i"),VALID_PHONE_NUMBER_WITH_EXTENSION=VALID_PHONE_NUMBER+"(?:"+createExtensionPattern()+")?",VALID_PHONE_NUMBER_PATTERN=new RegExp("^"+MIN_LENGTH_PHONE_NUMBER_PATTERN+"$|^"+VALID_PHONE_NUMBER_WITH_EXTENSION+"$","i");function isViablePhoneNumber(y){return y.length>=MIN_LENGTH_FOR_NSN&&VALID_PHONE_NUMBER_PATTERN.test(y)}function isViablePhoneNumberStart(y){return VALID_PHONE_NUMBER_START_REG_EXP.test(y)}function formatRFC3966(y){var u=y.number,g=y.ext;if(!u)return"";if(u[0]!=="+")throw new Error('"formatRFC3966()" expects "number" to be in E.164 format.');return"tel:".concat(u).concat(g?";ext="+g:"")}var DEFAULT_OPTIONS={formatExtension:function y(u,g,v){return"".concat(u).concat(v.ext()).concat(g)}};function formatNumber(y,u,g,v){if(g?g=merge$2({},DEFAULT_OPTIONS,g):g=DEFAULT_OPTIONS,v=new Metadata(v),y.country&&y.country!=="001"){if(!v.hasCountry(y.country))throw new Error("Unknown country: ".concat(y.country));v.selectNumberingPlan(y.country)}else if(y.countryCallingCode)v.selectNumberingPlan(y.countryCallingCode);else return y.phone||"";var b=v.countryCallingCode(),w=g.v2?y.nationalNumber:y.phone,E;switch(u){case"NATIONAL":return w?(E=formatNationalNumber(w,y.carrierCode,"NATIONAL",v,g),addExtension(E,y.ext,v,g.formatExtension)):"";case"INTERNATIONAL":return w?(E=formatNationalNumber(w,null,"INTERNATIONAL",v,g),E="+".concat(b," ").concat(E),addExtension(E,y.ext,v,g.formatExtension)):"+".concat(b);case"E.164":return"+".concat(b).concat(w);case"RFC3966":return formatRFC3966({number:"+".concat(b).concat(w),ext:y.ext});case"IDD":if(!g.fromCountry)return;var S=formatIDD(w,y.carrierCode,b,g.fromCountry,v);return addExtension(S,y.ext,v,g.formatExtension);default:throw new Error('Unknown "format" argument passed to "formatNumber()": "'.concat(u,'"'))}}function formatNationalNumber(y,u,g,v,b){var w=chooseFormatForNumber(v.formats(),y);return w?formatNationalNumberUsingFormat(y,w,{useInternationalFormat:g==="INTERNATIONAL",withNationalPrefix:!(w.nationalPrefixIsOptionalWhenFormattingInNationalFormat()&&b&&b.nationalPrefix===!1)}):y}function chooseFormatForNumber(y,u){return pickFirstMatchingElement(y,function(g){if(g.leadingDigitsPatterns().length>0){var v=g.leadingDigitsPatterns()[g.leadingDigitsPatterns().length-1];if(u.search(v)!==0)return!1}return matchesEntirely(u,g.pattern())})}function addExtension(y,u,g,v){return u?v(y,u,g):y}function formatIDD(y,u,g,v,b){var w=getCountryCallingCode(v,b.metadata);if(w===g){var E=formatNationalNumber(y,u,"NATIONAL",b);return g==="1"?g+" "+E:E}var S=getIddPrefix(v,void 0,b.metadata);if(S)return"".concat(S," ").concat(g," ").concat(formatNationalNumber(y,null,"INTERNATIONAL",b))}function merge$2(){for(var y=1,u=arguments.length,g=new Array(u),v=0;v<u;v++)g[v]=arguments[v];for(;y<g.length;){if(g[y])for(var b in g[y])g[0][b]=g[y][b];y++}return g[0]}function pickFirstMatchingElement(y,u){for(var g=0;g<y.length;){if(u(y[g]))return y[g];g++}}function _typeof$5(y){"@babel/helpers - typeof";return _typeof$5=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},_typeof$5(y)}function ownKeys$4(y,u){var g=Object.keys(y);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(y);u&&(v=v.filter(function(b){return Object.getOwnPropertyDescriptor(y,b).enumerable})),g.push.apply(g,v)}return g}function _objectSpread$4(y){for(var u=1;u<arguments.length;u++){var g=arguments[u]!=null?arguments[u]:{};u%2?ownKeys$4(Object(g),!0).forEach(function(v){_defineProperty$4(y,v,g[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(g)):ownKeys$4(Object(g)).forEach(function(v){Object.defineProperty(y,v,Object.getOwnPropertyDescriptor(g,v))})}return y}function _defineProperty$4(y,u,g){return(u=_toPropertyKey$4(u))in y?Object.defineProperty(y,u,{value:g,enumerable:!0,configurable:!0,writable:!0}):y[u]=g,y}function _classCallCheck$1(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function _defineProperties$2(y,u){for(var g=0;g<u.length;g++){var v=u[g];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(y,_toPropertyKey$4(v.key),v)}}function _createClass$1(y,u,g){return u&&_defineProperties$2(y.prototype,u),Object.defineProperty(y,"prototype",{writable:!1}),y}function _toPropertyKey$4(y){var u=_toPrimitive$4(y,"string");return _typeof$5(u)=="symbol"?u:u+""}function _toPrimitive$4(y,u){if(_typeof$5(y)!="object"||!y)return y;var g=y[Symbol.toPrimitive];if(g!==void 0){var v=g.call(y,u);if(_typeof$5(v)!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(y)}var PhoneNumber=(function(){function y(u,g,v){if(_classCallCheck$1(this,y),!u)throw new TypeError("First argument is required");if(typeof u!="string")throw new TypeError("First argument must be a string");if(u[0]==="+"&&!g)throw new TypeError("`metadata` argument not passed");if(isObject$2(g)&&isObject$2(g.countries)){v=g;var b=u;if(!E164_NUMBER_REGEXP.test(b))throw new Error('Invalid `number` argument passed: must consist of a "+" followed by digits');var w=extractCountryCallingCode(b,void 0,void 0,void 0,v),E=w.countryCallingCode,S=w.number;if(g=S,u=E,!g)throw new Error("Invalid `number` argument passed: too short")}if(!g)throw new TypeError("`nationalNumber` argument is required");if(typeof g!="string")throw new TypeError("`nationalNumber` argument must be a string");validateMetadata$1(v);var A=getCountryAndCountryCallingCode(u,v),$=A.country,R=A.countryCallingCode;this.country=$,this.countryCallingCode=R,this.nationalNumber=g,this.number="+"+this.countryCallingCode+this.nationalNumber,this.getMetadata=function(){return v}}return _createClass$1(y,[{key:"setExt",value:function(g){this.ext=g}},{key:"getPossibleCountries",value:function(){return this.country?[this.country]:getPossibleCountriesForNumber(this.countryCallingCode,this.nationalNumber,this.getMetadata())}},{key:"isPossible",value:function(){return isPossiblePhoneNumber(this,{v2:!0},this.getMetadata())}},{key:"isValid",value:function(){return isValidNumber(this,{v2:!0},this.getMetadata())}},{key:"isNonGeographic",value:function(){var g=new Metadata(this.getMetadata());return g.isNonGeographicCallingCode(this.countryCallingCode)}},{key:"isEqual",value:function(g){return this.number===g.number&&this.ext===g.ext}},{key:"getType",value:function(){return getNumberType(this,{v2:!0},this.getMetadata())}},{key:"format",value:function(g,v){return formatNumber(this,g,v?_objectSpread$4(_objectSpread$4({},v),{},{v2:!0}):{v2:!0},this.getMetadata())}},{key:"formatNational",value:function(g){return this.format("NATIONAL",g)}},{key:"formatInternational",value:function(g){return this.format("INTERNATIONAL",g)}},{key:"getURI",value:function(g){return this.format("RFC3966",g)}}])})(),isCountryCode=function y(u){return/^[A-Z]{2}$/.test(u)};function getCountryAndCountryCallingCode(y,u){var g,v,b=new Metadata(u);return isCountryCode(y)?(g=y,b.selectNumberingPlan(g),v=b.countryCallingCode()):v=y,{country:g,countryCallingCode:v}}var E164_NUMBER_REGEXP=/^\+\d+$/;function _typeof$4(y){"@babel/helpers - typeof";return _typeof$4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},_typeof$4(y)}function _createClass(y,u,g){return Object.defineProperty(y,"prototype",{writable:!1}),y}function _classCallCheck(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function _callSuper(y,u,g){return u=_getPrototypeOf(u),_possibleConstructorReturn(y,_isNativeReflectConstruct()?Reflect.construct(u,g||[],_getPrototypeOf(y).constructor):u.apply(y,g))}function _possibleConstructorReturn(y,u){if(u&&(_typeof$4(u)=="object"||typeof u=="function"))return u;if(u!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(y)}function _assertThisInitialized(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}function _inherits$1(y,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");y.prototype=Object.create(u&&u.prototype,{constructor:{value:y,writable:!0,configurable:!0}}),Object.defineProperty(y,"prototype",{writable:!1}),u&&_setPrototypeOf(y,u)}function _wrapNativeSuper(y){var u=typeof Map=="function"?new Map:void 0;return _wrapNativeSuper=function(v){if(v===null||!_isNativeFunction(v))return v;if(typeof v!="function")throw new TypeError("Super expression must either be null or a function");if(u!==void 0){if(u.has(v))return u.get(v);u.set(v,b)}function b(){return _construct$1(v,arguments,_getPrototypeOf(this).constructor)}return b.prototype=Object.create(v.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(b,v)},_wrapNativeSuper(y)}function _construct$1(y,u,g){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var v=[null];v.push.apply(v,u);var b=new(y.bind.apply(y,v));return g&&_setPrototypeOf(b,g.prototype),b}function _isNativeReflectConstruct(){try{var y=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_isNativeReflectConstruct=function(){return!!y})()}function _isNativeFunction(y){try{return Function.toString.call(y).indexOf("[native code]")!==-1}catch{return typeof y=="function"}}function _setPrototypeOf(y,u){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,v){return g.__proto__=v,g},_setPrototypeOf(y,u)}function _getPrototypeOf(y){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},_getPrototypeOf(y)}var ParseError=(function(y){function u(g){var v;return _classCallCheck(this,u),v=_callSuper(this,u,[g]),Object.setPrototypeOf(v,u.prototype),v.name=v.constructor.name,v}return _inherits$1(u,y),_createClass(u)})(_wrapNativeSuper(Error)),EXTN_PATTERN=new RegExp("(?:"+createExtensionPattern()+")$","i");function extractExtension(y){var u=y.search(EXTN_PATTERN);if(u<0)return{};for(var g=y.slice(0,u),v=y.match(EXTN_PATTERN),b=1;b<v.length;){if(v[b])return{number:g,ext:v[b]};b++}}var DIGITS={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9"};function parseDigit(y){return DIGITS[y]}function _createForOfIteratorHelperLoose(y,u){var g=typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(g)return(g=g.call(y)).next.bind(g);if(Array.isArray(y)||(g=_unsupportedIterableToArray$1(y))||u){g&&(y=g);var v=0;return function(){return v>=y.length?{done:!0}:{done:!1,value:y[v++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$1(y,u){if(y){if(typeof y=="string")return _arrayLikeToArray$1(y,u);var g={}.toString.call(y).slice(8,-1);return g==="Object"&&y.constructor&&(g=y.constructor.name),g==="Map"||g==="Set"?Array.from(y):g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g)?_arrayLikeToArray$1(y,u):void 0}}function _arrayLikeToArray$1(y,u){(u==null||u>y.length)&&(u=y.length);for(var g=0,v=Array(u);g<u;g++)v[g]=y[g];return v}function parseIncompletePhoneNumber(y){for(var u="",g=_createForOfIteratorHelperLoose(y.split("")),v;!(v=g()).done;){var b=v.value;u+=parsePhoneNumberCharacter(b,u)||""}return u}function parsePhoneNumberCharacter(y,u,g){return y==="+"?u?void 0:"+":parseDigit(y)}var PLUS_SIGN="+",RFC3966_VISUAL_SEPARATOR_="[\\-\\.\\(\\)]?",RFC3966_PHONE_DIGIT_="(["+VALID_DIGITS+"]|"+RFC3966_VISUAL_SEPARATOR_+")",RFC3966_GLOBAL_NUMBER_DIGITS_="^\\"+PLUS_SIGN+RFC3966_PHONE_DIGIT_+"*["+VALID_DIGITS+"]"+RFC3966_PHONE_DIGIT_+"*$",RFC3966_GLOBAL_NUMBER_DIGITS_PATTERN_=new RegExp(RFC3966_GLOBAL_NUMBER_DIGITS_,"g"),ALPHANUM_=VALID_DIGITS,RFC3966_DOMAINLABEL_="["+ALPHANUM_+"]+((\\-)*["+ALPHANUM_+"])*",VALID_ALPHA_="a-zA-Z",RFC3966_TOPLABEL_="["+VALID_ALPHA_+"]+((\\-)*["+ALPHANUM_+"])*",RFC3966_DOMAINNAME_="^("+RFC3966_DOMAINLABEL_+"\\.)*"+RFC3966_TOPLABEL_+"\\.?$",RFC3966_DOMAINNAME_PATTERN_=new RegExp(RFC3966_DOMAINNAME_,"g"),RFC3966_PREFIX_="tel:",RFC3966_PHONE_CONTEXT_=";phone-context=",RFC3966_ISDN_SUBADDRESS_=";isub=";function extractPhoneContext(y){var u=y.indexOf(RFC3966_PHONE_CONTEXT_);if(u<0)return null;var g=u+RFC3966_PHONE_CONTEXT_.length;if(g>=y.length)return"";var v=y.indexOf(";",g);return v>=0?y.substring(g,v):y.substring(g)}function isPhoneContextValid(y){return y===null?!0:y.length===0?!1:RFC3966_GLOBAL_NUMBER_DIGITS_PATTERN_.test(y)||RFC3966_DOMAINNAME_PATTERN_.test(y)}function extractFormattedPhoneNumberFromPossibleRfc3966NumberUri(y,u){var g=u.extractFormattedPhoneNumber,v=extractPhoneContext(y);if(!isPhoneContextValid(v))throw new ParseError("NOT_A_NUMBER");var b;if(v===null)b=g(y)||"";else{b="",v.charAt(0)===PLUS_SIGN&&(b+=v);var w=y.indexOf(RFC3966_PREFIX_),E;w>=0?E=w+RFC3966_PREFIX_.length:E=0;var S=y.indexOf(RFC3966_PHONE_CONTEXT_);b+=y.substring(E,S)}var A=b.indexOf(RFC3966_ISDN_SUBADDRESS_);if(A>0&&(b=b.substring(0,A)),b!=="")return b}var MAX_INPUT_STRING_LENGTH=250,PHONE_NUMBER_START_PATTERN=new RegExp("["+PLUS_CHARS+VALID_DIGITS+"]"),AFTER_PHONE_NUMBER_END_PATTERN=new RegExp("[^"+VALID_DIGITS+"#]+$");function parse$9(y,u,g){if(u=u||{},g=new Metadata(g),u.defaultCountry&&!g.hasCountry(u.defaultCountry))throw u.v2?new ParseError("INVALID_COUNTRY"):new Error("Unknown country: ".concat(u.defaultCountry));var v=parseInput(y,u.v2,u.extract),b=v.number,w=v.ext,E=v.error;if(!b){if(u.v2)throw E==="TOO_SHORT"?new ParseError("TOO_SHORT"):new ParseError("NOT_A_NUMBER");return{}}var S=parsePhoneNumber$1(b,u.defaultCountry,u.defaultCallingCode,g),A=S.country,$=S.nationalNumber,R=S.countryCallingCode,T=S.countryCallingCodeSource,O=S.carrierCode;if(!g.hasSelectedNumberingPlan()){if(u.v2)throw new ParseError("INVALID_COUNTRY");return{}}if(!$||$.length<MIN_LENGTH_FOR_NSN){if(u.v2)throw new ParseError("TOO_SHORT");return{}}if($.length>MAX_LENGTH_FOR_NSN){if(u.v2)throw new ParseError("TOO_LONG");return{}}if(u.v2){var B=new PhoneNumber(R,$,g.metadata);return A&&(B.country=A),O&&(B.carrierCode=O),w&&(B.ext=w),B.__countryCallingCodeSource=T,B}var F=(u.extended?g.hasSelectedNumberingPlan():A)?matchesEntirely($,g.nationalNumberPattern()):!1;return u.extended?{country:A,countryCallingCode:R,carrierCode:O,valid:F,possible:F?!0:!!(u.extended===!0&&g.possibleLengths()&&isPossibleNumber($,A,g)),phone:$,ext:w}:F?result$2(A,$,w):{}}function _extractFormattedPhoneNumber(y,u,g){if(y){if(y.length>MAX_INPUT_STRING_LENGTH){if(g)throw new ParseError("TOO_LONG");return}if(u===!1)return y;var v=y.search(PHONE_NUMBER_START_PATTERN);if(!(v<0))return y.slice(v).replace(AFTER_PHONE_NUMBER_END_PATTERN,"")}}function parseInput(y,u,g){var v=extractFormattedPhoneNumberFromPossibleRfc3966NumberUri(y,{extractFormattedPhoneNumber:function(E){return _extractFormattedPhoneNumber(E,g,u)}});if(!v)return{};if(!isViablePhoneNumber(v))return isViablePhoneNumberStart(v)?{error:"TOO_SHORT"}:{};var b=extractExtension(v);return b.ext?b:{number:v}}function result$2(y,u,g){var v={country:y,phone:u};return g&&(v.ext=g),v}function parsePhoneNumber$1(y,u,g,v){var b=extractCountryCallingCode(parseIncompletePhoneNumber(y),void 0,u,g,v.metadata),w=b.countryCallingCodeSource,E=b.countryCallingCode,S=b.number,A;if(E)v.selectNumberingPlan(E);else if(S&&(u||g))v.selectNumberingPlan(u,g),u&&(A=u),E=g||getCountryCallingCode(u,v.metadata);else return{};if(!S)return{countryCallingCodeSource:w,countryCallingCode:E};var $=extractNationalNumber(parseIncompletePhoneNumber(S),A,v),R=$.nationalNumber,T=$.carrierCode,O=getCountryByCallingCode(E,{nationalNumber:R,metadata:v});return O&&(A=O,O==="001"||v.selectNumberingPlan(A)),{country:A,countryCallingCode:E,countryCallingCodeSource:w,nationalNumber:R,carrierCode:T}}function _typeof$3(y){"@babel/helpers - typeof";return _typeof$3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},_typeof$3(y)}function ownKeys$3(y,u){var g=Object.keys(y);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(y);u&&(v=v.filter(function(b){return Object.getOwnPropertyDescriptor(y,b).enumerable})),g.push.apply(g,v)}return g}function _objectSpread$3(y){for(var u=1;u<arguments.length;u++){var g=arguments[u]!=null?arguments[u]:{};u%2?ownKeys$3(Object(g),!0).forEach(function(v){_defineProperty$3(y,v,g[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(g)):ownKeys$3(Object(g)).forEach(function(v){Object.defineProperty(y,v,Object.getOwnPropertyDescriptor(g,v))})}return y}function _defineProperty$3(y,u,g){return(u=_toPropertyKey$3(u))in y?Object.defineProperty(y,u,{value:g,enumerable:!0,configurable:!0,writable:!0}):y[u]=g,y}function _toPropertyKey$3(y){var u=_toPrimitive$3(y,"string");return _typeof$3(u)=="symbol"?u:u+""}function _toPrimitive$3(y,u){if(_typeof$3(y)!="object"||!y)return y;var g=y[Symbol.toPrimitive];if(g!==void 0){var v=g.call(y,u);if(_typeof$3(v)!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(y)}function parsePhoneNumberWithError$2(y,u,g){return parse$9(y,_objectSpread$3(_objectSpread$3({},u),{},{v2:!0}),g)}function _typeof$2(y){"@babel/helpers - typeof";return _typeof$2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},_typeof$2(y)}function ownKeys$2(y,u){var g=Object.keys(y);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(y);u&&(v=v.filter(function(b){return Object.getOwnPropertyDescriptor(y,b).enumerable})),g.push.apply(g,v)}return g}function _objectSpread$2(y){for(var u=1;u<arguments.length;u++){var g=arguments[u]!=null?arguments[u]:{};u%2?ownKeys$2(Object(g),!0).forEach(function(v){_defineProperty$2(y,v,g[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(g)):ownKeys$2(Object(g)).forEach(function(v){Object.defineProperty(y,v,Object.getOwnPropertyDescriptor(g,v))})}return y}function _defineProperty$2(y,u,g){return(u=_toPropertyKey$2(u))in y?Object.defineProperty(y,u,{value:g,enumerable:!0,configurable:!0,writable:!0}):y[u]=g,y}function _toPropertyKey$2(y){var u=_toPrimitive$2(y,"string");return _typeof$2(u)=="symbol"?u:u+""}function _toPrimitive$2(y,u){if(_typeof$2(y)!="object"||!y)return y;var g=y[Symbol.toPrimitive];if(g!==void 0){var v=g.call(y,u);if(_typeof$2(v)!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(y)}function _slicedToArray(y,u){return _arrayWithHoles(y)||_iterableToArrayLimit(y,u)||_unsupportedIterableToArray(y,u)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray(y,u){if(y){if(typeof y=="string")return _arrayLikeToArray(y,u);var g={}.toString.call(y).slice(8,-1);return g==="Object"&&y.constructor&&(g=y.constructor.name),g==="Map"||g==="Set"?Array.from(y):g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g)?_arrayLikeToArray(y,u):void 0}}function _arrayLikeToArray(y,u){(u==null||u>y.length)&&(u=y.length);for(var g=0,v=Array(u);g<u;g++)v[g]=y[g];return v}function _iterableToArrayLimit(y,u){var g=y==null?null:typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(g!=null){var v,b,w,E,S=[],A=!0,$=!1;try{if(w=(g=g.call(y)).next,u!==0)for(;!(A=(v=w.call(g)).done)&&(S.push(v.value),S.length!==u);A=!0);}catch(R){$=!0,b=R}finally{try{if(!A&&g.return!=null&&(E=g.return(),Object(E)!==E))return}finally{if($)throw b}}return S}}function _arrayWithHoles(y){if(Array.isArray(y))return y}function normalizeArguments(y){var u=Array.prototype.slice.call(y),g=_slicedToArray(u,4),v=g[0],b=g[1],w=g[2],E=g[3],S,A,$;if(typeof v=="string")S=v;else throw new TypeError("A text for parsing must be a string.");if(!b||typeof b=="string")E?(A=w,$=E):(A=void 0,$=w),b&&(A=_objectSpread$2({defaultCountry:b},A));else if(isObject$2(b))w?(A=b,$=w):$=b;else throw new Error("Invalid second argument: ".concat(b));return{text:S,options:A,metadata:$}}function parsePhoneNumberWithError$1(){var y=normalizeArguments(arguments),u=y.text,g=y.options,v=y.metadata;return parsePhoneNumberWithError$2(u,g,v)}function _typeof$1(y){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},_typeof$1(y)}function ownKeys$1(y,u){var g=Object.keys(y);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(y);u&&(v=v.filter(function(b){return Object.getOwnPropertyDescriptor(y,b).enumerable})),g.push.apply(g,v)}return g}function _objectSpread$1(y){for(var u=1;u<arguments.length;u++){var g=arguments[u]!=null?arguments[u]:{};u%2?ownKeys$1(Object(g),!0).forEach(function(v){_defineProperty$1(y,v,g[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(g)):ownKeys$1(Object(g)).forEach(function(v){Object.defineProperty(y,v,Object.getOwnPropertyDescriptor(g,v))})}return y}function _defineProperty$1(y,u,g){return(u=_toPropertyKey$1(u))in y?Object.defineProperty(y,u,{value:g,enumerable:!0,configurable:!0,writable:!0}):y[u]=g,y}function _toPropertyKey$1(y){var u=_toPrimitive$1(y,"string");return _typeof$1(u)=="symbol"?u:u+""}function _toPrimitive$1(y,u){if(_typeof$1(y)!="object"||!y)return y;var g=y[Symbol.toPrimitive];if(g!==void 0){var v=g.call(y,u);if(_typeof$1(v)!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(y)}function parsePhoneNumber(y,u,g){u&&u.defaultCountry&&!isSupportedCountry(u.defaultCountry,g)&&(u=_objectSpread$1(_objectSpread$1({},u),{},{defaultCountry:void 0}));try{return parsePhoneNumberWithError$2(y,u,g)}catch(v){if(!(v instanceof ParseError))throw v}}function _typeof(y){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},_typeof(y)}function ownKeys(y,u){var g=Object.keys(y);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(y);u&&(v=v.filter(function(b){return Object.getOwnPropertyDescriptor(y,b).enumerable})),g.push.apply(g,v)}return g}function _objectSpread(y){for(var u=1;u<arguments.length;u++){var g=arguments[u]!=null?arguments[u]:{};u%2?ownKeys(Object(g),!0).forEach(function(v){_defineProperty(y,v,g[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(g)):ownKeys(Object(g)).forEach(function(v){Object.defineProperty(y,v,Object.getOwnPropertyDescriptor(g,v))})}return y}function _defineProperty(y,u,g){return(u=_toPropertyKey(u))in y?Object.defineProperty(y,u,{value:g,enumerable:!0,configurable:!0,writable:!0}):y[u]=g,y}function _toPropertyKey(y){var u=_toPrimitive(y,"string");return _typeof(u)=="symbol"?u:u+""}function _toPrimitive(y,u){if(_typeof(y)!="object"||!y)return y;var g=y[Symbol.toPrimitive];if(g!==void 0){var v=g.call(y,u);if(_typeof(v)!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(y)}function isValidPhoneNumber$1(){var y=normalizeArguments(arguments),u=y.text,g=y.options,v=y.metadata;g=_objectSpread(_objectSpread({},g),{},{extract:!1});var b=parsePhoneNumber(u,g,v);return b&&b.isValid()||!1}function parsePhoneNumberWithError(){return withMetadataArgument(parsePhoneNumberWithError$1,arguments)}function isValidPhoneNumber(){return withMetadataArgument(isValidPhoneNumber$1,arguments)}const NAMETAG_SALT="unicity:nametag:",DEFAULT_COUNTRY$1="US";function sha256Hex(y){const u=new TextEncoder().encode(y);return bytesToHex$4(sha256$6(u))}function isLikelyPhoneNumber(y){if(y.startsWith("+"))return!0;const g=y.replace(/\D/g,"").length;if(g<7)return!1;const v=y.replace(/[\s\-().]/g,"").length;return g/v>.5}function normalizePhoneNumber(y,u){try{return isValidPhoneNumber(y,u)?parsePhoneNumberWithError(y,u).format("E.164"):isValidPhoneNumber(y)?parsePhoneNumberWithError(y).format("E.164"):null}catch{return null}}function normalizeNametag(y,u=DEFAULT_COUNTRY$1){const g=y.trim();if(isLikelyPhoneNumber(g)){const b=normalizePhoneNumber(g,u);if(b)return b}let v=g.toLowerCase();return v.endsWith("@unicity")&&(v=v.slice(0,-8)),v}function hashNametag(y,u=DEFAULT_COUNTRY$1){const g=normalizeNametag(y,u);return sha256Hex(NAMETAG_SALT+g)}const DEFAULT_COUNTRY="US";async function createBindingEvent(y,u,g,v=DEFAULT_COUNTRY){const b=hashNametag(u,v),w={nametag_hash:b,address:g,verified:Date.now()};return Event$1.create(y,{kind:APP_DATA,tags:[["d",b],["nametag",b],["t",b],["address",g]],content:JSON.stringify(w)})}function createNametagToPubkeyFilter(y,u=DEFAULT_COUNTRY){const g=hashNametag(y,u);return Filter.builder().kinds(APP_DATA).tTags(g).build()}function createPubkeyToNametagFilter(y){return Filter.builder().kinds(APP_DATA).authors(y).limit(10).build()}function parseNametagHashFromEvent(y){const u=y.getTagValue("nametag");if(u)return u;const g=y.getTagValue("d");if(g)return g;try{return JSON.parse(y.content).nametag_hash}catch{return}}function parseAddressFromEvent(y){const u=y.getTagValue("address");if(u)return u;try{return JSON.parse(y.content).address}catch{return}}function isValidBindingEvent(y){if(y.kind!==APP_DATA||!y.hasTag("d"))return!1;try{const u=JSON.parse(y.content);if(!u.nametag_hash||!u.address)return!1}catch{return!1}return y.verify()}var NametagBinding=Object.freeze({__proto__:null,createBindingEvent,createNametagToPubkeyFilter,createPubkeyToNametagFilter,isValidBindingEvent,parseAddressFromEvent,parseNametagHashFromEvent});const MESSAGE_PREFIX$1="token_transfer:";async function createTokenTransferEvent(y,u,g,v,b){let w,E,S;v!==void 0&&typeof v=="object"?(w=v.amount,E=v.symbol,S=v.replyToEventId):(w=v,E=b);const A=MESSAGE_PREFIX$1+g,$=await y.encryptHex(A,u),R=[["p",u],["type","token_transfer"]];return w!==void 0&&R.push(["amount",String(w)]),E!==void 0&&R.push(["symbol",E]),S!==void 0&&S.length>0&&R.push(["e",S,"","reply"]),Event$1.create(y,{kind:TOKEN_TRANSFER,tags:R,content:$})}async function parseTokenTransfer(y,u){if(y.kind!==TOKEN_TRANSFER)throw new Error("Event is not a token transfer");if(y.getTagValue("type")!=="token_transfer")throw new Error("Event type is not token_transfer");let v;if(u.isMyPublicKey(y.pubkey)){const w=y.getTagValue("p");if(!w)throw new Error("No recipient found in event");v=w}else v=y.pubkey;let b;try{b=await u.decryptHex(y.content,v)}catch(w){try{const{hexToBytes:E}=await Promise.resolve().then(function(){return utils});b=new TextDecoder().decode(E(y.content))}catch{throw w}}if(!b.startsWith(MESSAGE_PREFIX$1))throw new Error("Invalid token transfer format");return b.slice(MESSAGE_PREFIX$1.length)}function getAmount$1(y){const u=y.getTagValue("amount");if(u!==void 0)try{return BigInt(u)}catch{return}}function getSymbol(y){return y.getTagValue("symbol")}function getReplyToEventId(y){return y.getTagValue("e")}function isTokenTransfer(y){return y.kind===TOKEN_TRANSFER&&y.getTagValue("type")==="token_transfer"}function getRecipient(y){return y.getTagValue("p")}function getSender$1(y){return y.pubkey}var TokenTransferProtocol=Object.freeze({__proto__:null,createTokenTransferEvent,getAmount:getAmount$1,getRecipient,getReplyToEventId,getSender:getSender$1,getSymbol,isTokenTransfer,parseTokenTransfer});const MESSAGE_PREFIX$2="payment_request:",RESPONSE_PREFIX="payment_request_response:",DEFAULT_DEADLINE_MS=300*1e3;var ResponseStatus;(function(y){y.DECLINED="DECLINED",y.EXPIRED="EXPIRED"})(ResponseStatus||(ResponseStatus={}));function generateRequestId(){const y=new Uint8Array(4);if(typeof crypto<"u"&&crypto.getRandomValues)crypto.getRandomValues(y);else for(let u=0;u<y.length;u++)y[u]=Math.floor(Math.random()*256);return Array.from(y).map(u=>u.toString(16).padStart(2,"0")).join("")}async function createPaymentRequestEvent(y,u,g){const v=g.requestId||generateRequestId(),b=g.deadline===null?null:g.deadline!==void 0?g.deadline:Date.now()+DEFAULT_DEADLINE_MS,w=JSON.stringify({amount:String(g.amount),coinId:g.coinId,message:g.message,recipientNametag:g.recipientNametag,requestId:v,deadline:b}),E=MESSAGE_PREFIX$2+w,S=await y.encryptHex(E,u),A=[["p",u],["type","payment_request"],["amount",String(g.amount)]];return g.recipientNametag&&A.push(["recipient",g.recipientNametag]),Event$1.create(y,{kind:PAYMENT_REQUEST,tags:A,content:S})}async function parsePaymentRequest(y,u){if(y.kind!==PAYMENT_REQUEST)throw new Error("Event is not a payment request");if(y.getTagValue("type")!=="payment_request")throw new Error("Event type is not payment_request");let v;if(u.isMyPublicKey(y.pubkey)){const S=y.getTagValue("p");if(!S)throw new Error("No target found in event");v=S}else v=y.pubkey;const b=await u.decryptHex(y.content,v);if(!b.startsWith(MESSAGE_PREFIX$2))throw new Error("Invalid payment request format: missing prefix");const w=b.slice(MESSAGE_PREFIX$2.length),E=JSON.parse(w);return{amount:BigInt(E.amount),coinId:E.coinId,message:E.message,recipientNametag:E.recipientNametag,requestId:E.requestId,senderPubkey:y.pubkey,timestamp:y.created_at*1e3,eventId:y.id,deadline:E.deadline!==void 0?E.deadline:null}}function isPaymentRequest(y){return y.kind===PAYMENT_REQUEST&&y.getTagValue("type")==="payment_request"}function getAmount(y){const u=y.getTagValue("amount");if(u!==void 0)try{return BigInt(u)}catch{return}}function getRecipientNametag(y){return y.getTagValue("recipient")}function getTarget(y){return y.getTagValue("p")}function getSender(y){return y.pubkey}function formatAmount(y,u=8){const g=typeof y=="bigint"?y:BigInt(y),v=BigInt(10)**BigInt(u),b=g/v,w=g%v;if(w===BigInt(0))return b.toString();const S=w.toString().padStart(u,"0").replace(/0+$/,"");return`${b}.${S}`}function parseAmount(y,u=8){const g=BigInt(10)**BigInt(u),v=y.split("."),b=BigInt(v[0]||"0");if(v.length===1)return b*g;let w=v[1]||"0";w.length<u?w=w.padEnd(u,"0"):w.length>u&&(w=w.slice(0,u));const E=BigInt(w);return b*g+E}function isExpired(y){return y.deadline!==null&&Date.now()>y.deadline}function getRemainingTimeMs(y){if(y.deadline===null)return null;const u=y.deadline-Date.now();return u>0?u:0}async function createPaymentRequestResponseEvent(y,u,g){const v=JSON.stringify({requestId:g.requestId,originalEventId:g.originalEventId,status:g.status,reason:g.reason}),b=RESPONSE_PREFIX+v,w=await y.encryptHex(b,u),E=[["p",u],["type","payment_request_response"],["status",g.status]];return g.originalEventId&&E.push(["e",g.originalEventId,"","reply"]),Event$1.create(y,{kind:PAYMENT_REQUEST_RESPONSE,tags:E,content:w})}async function parsePaymentRequestResponse(y,u){if(y.kind!==PAYMENT_REQUEST_RESPONSE)throw new Error("Event is not a payment request response");let g;if(u.isMyPublicKey(y.pubkey)){const E=y.getTagValue("p");if(!E)throw new Error("No target found in event");g=E}else g=y.pubkey;const v=await u.decryptHex(y.content,g);if(!v.startsWith(RESPONSE_PREFIX))throw new Error("Invalid payment request response format: missing prefix");const b=v.slice(RESPONSE_PREFIX.length),w=JSON.parse(b);return{requestId:w.requestId,originalEventId:w.originalEventId,status:w.status,reason:w.reason,senderPubkey:y.pubkey,eventId:y.id,timestamp:y.created_at*1e3}}function isPaymentRequestResponse(y){return y.kind===PAYMENT_REQUEST_RESPONSE&&y.getTagValue("type")==="payment_request_response"}function getResponseStatus(y){return y.getTagValue("status")}function getOriginalEventId(y){return y.getTagValue("e")}var PaymentRequestProtocol=Object.freeze({__proto__:null,DEFAULT_DEADLINE_MS,get ResponseStatus(){return ResponseStatus},createPaymentRequestEvent,createPaymentRequestResponseEvent,formatAmount,getAmount,getOriginalEventId,getRecipientNametag,getRemainingTimeMs,getResponseStatus,getSender,getTarget,isExpired,isPaymentRequest,isPaymentRequestResponse,parseAmount,parsePaymentRequest,parsePaymentRequestResponse});const MessageStatus={PENDING:"PENDING",SENT:"SENT",DELIVERED:"DELIVERED",READ:"READ",FAILED:"FAILED"},MessageType$1={TEXT:"TEXT",PAYMENT_REQUEST:"PAYMENT_REQUEST",TOKEN_TRANSFER:"TOKEN_TRANSFER"};class ChatMessage{id;conversationId;content;timestamp;isFromMe;status;type;senderPubkey;senderNametag;signature;metadata;constructor(u){this.id=u.id||v4$1(),this.conversationId=u.conversationId,this.content=u.content,this.timestamp=u.timestamp||Date.now(),this.isFromMe=u.isFromMe,this.status=u.status||MessageStatus.PENDING,this.type=u.type||MessageType$1.TEXT,this.senderPubkey=u.senderPubkey,this.senderNametag=u.senderNametag,this.signature=u.signature,this.metadata=u.metadata}getFormattedTime(){return new Date(this.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}getFormattedDate(){const u=new Date(this.timestamp),g=new Date,v=new Date(g);return v.setDate(v.getDate()-1),u.toDateString()===g.toDateString()?"Today":u.toDateString()===v.toDateString()?"Yesterday":u.toLocaleDateString()}toJSON(){return{id:this.id,conversationId:this.conversationId,content:this.content,timestamp:this.timestamp,isFromMe:this.isFromMe,status:this.status,type:this.type,senderPubkey:this.senderPubkey,senderNametag:this.senderNametag,signature:this.signature,metadata:this.metadata}}static fromJSON(u){return new ChatMessage(u)}}class ChatConversation{id;participantPubkey;participantNametag;participantName;lastMessageTime;lastMessageText;unreadCount;isApproved;createdAt;constructor(u){this.id=u.id||u.participantPubkey,this.participantPubkey=u.participantPubkey,this.participantNametag=u.participantNametag,this.participantName=u.participantName,this.lastMessageTime=u.lastMessageTime||Date.now(),this.lastMessageText=u.lastMessageText||"",this.unreadCount=u.unreadCount||0,this.isApproved=u.isApproved??!0,this.createdAt=u.createdAt||Date.now()}getDisplayName(){return this.participantNametag?`@${this.participantNametag.replace("@","")}`:this.participantName?this.participantName:this.participantPubkey.slice(0,8)+"..."}getAvatar(){return(this.participantNametag||this.participantName||this.participantPubkey).slice(0,2).toUpperCase()}getFormattedLastMessageTime(){const u=new Date(this.lastMessageTime),v=new Date().getTime()-u.getTime();return v<6e4?"now":v<36e5?`${Math.floor(v/6e4)}m`:v<864e5?`${Math.floor(v/36e5)}h`:v<6048e5?`${Math.floor(v/864e5)}d`:u.toLocaleDateString()}toJSON(){return{id:this.id,participantPubkey:this.participantPubkey,participantNametag:this.participantNametag,participantName:this.participantName,lastMessageTime:this.lastMessageTime,lastMessageText:this.lastMessageText,unreadCount:this.unreadCount,isApproved:this.isApproved,createdAt:this.createdAt}}static fromJSON(u){return new ChatConversation(u)}}class ChatRepository{static instance;constructor(){}static getInstance(){return ChatRepository.instance||(ChatRepository.instance=new ChatRepository),ChatRepository.instance}getConversations(){try{const u=localStorage.getItem(STORAGE_KEYS.CHAT_CONVERSATIONS);return u?JSON.parse(u).map(v=>ChatConversation.fromJSON(v)).sort((v,b)=>b.lastMessageTime-v.lastMessageTime):[]}catch(u){return console.error("Failed to parse conversations",u),[]}}getConversation(u){return this.getConversations().find(v=>v.id===u)||null}getConversationByPubkey(u){return this.getConversations().find(v=>v.participantPubkey===u)||null}saveConversation(u){const g=this.getConversations(),v=g.findIndex(b=>b.id===u.id);v>=0?g[v]=u:g.push(u),this.saveConversations(g),this.notifyUpdate()}saveConversations(u){localStorage.setItem(STORAGE_KEYS.CHAT_CONVERSATIONS,JSON.stringify(u.map(g=>g.toJSON())))}deleteConversation(u){const g=this.getConversations().filter(b=>b.id!==u);this.saveConversations(g);const v=this.getAllMessages().filter(b=>b.conversationId!==u);this.saveMessages(v),this.notifyUpdate()}updateConversationLastMessage(u,g,v){const b=this.getConversation(u);b&&(b.lastMessageText=g,b.lastMessageTime=v,this.saveConversation(b))}incrementUnreadCount(u){const g=this.getConversation(u);g&&(g.unreadCount+=1,this.saveConversation(g))}markConversationAsRead(u){const g=this.getConversation(u);g&&g.unreadCount>0&&(g.unreadCount=0,this.saveConversation(g))}updateConversationNametag(u,g){const v=this.getConversation(u);v&&(v.participantNametag=g,this.saveConversation(v))}getTotalUnreadCount(){return this.getConversations().reduce((u,g)=>u+g.unreadCount,0)}getAllMessages(){try{const u=localStorage.getItem(STORAGE_KEYS.CHAT_MESSAGES);return u?JSON.parse(u).map(v=>ChatMessage.fromJSON(v)):[]}catch(u){return console.error("Failed to parse messages",u),[]}}saveMessages(u){localStorage.setItem(STORAGE_KEYS.CHAT_MESSAGES,JSON.stringify(u.map(g=>g.toJSON())))}getMessagesForConversation(u){return this.getAllMessages().filter(g=>g.conversationId===u).sort((g,v)=>g.timestamp-v.timestamp)}getMessage(u){return this.getAllMessages().find(g=>g.id===u)||null}saveMessage(u){const g=this.getAllMessages(),v=g.findIndex(b=>b.id===u.id);v>=0?g[v]=u:g.push(u),this.saveMessages(g),this.updateConversationLastMessage(u.conversationId,u.content.slice(0,100),u.timestamp),this.notifyUpdate()}updateMessageStatus(u,g){const v=this.getMessage(u);if(v){v.status=g;const b=this.getAllMessages(),w=b.findIndex(E=>E.id===u);w>=0&&(b[w]=v,this.saveMessages(b),this.notifyUpdate())}}deleteMessage(u){const g=this.getAllMessages().filter(v=>v.id!==u);this.saveMessages(g),this.notifyUpdate()}notifyUpdate(){window.dispatchEvent(new CustomEvent("chat-updated"))}getOrCreateConversation(u,g,v){let b=this.getConversationByPubkey(u);return b?g&&!b.participantNametag&&(b.participantNametag=g,this.saveConversation(b)):(b=new ChatConversation({participantPubkey:u,participantNametag:g,participantName:v}),this.saveConversation(b)),b}clearAllData(){localStorage.removeItem(STORAGE_KEYS.CHAT_CONVERSATIONS),localStorage.removeItem(STORAGE_KEYS.CHAT_MESSAGES),this.notifyUpdate()}}const bundledRegistry=[{network:"unicity:testnet",assetKind:"non-fungible",name:"unicity",description:"Unicity testnet token type",id:"f8aa13834268d29355ff12183066f0cb902003629bbc5eb9ef0efbe397867509"},{network:"unicity:testnet",assetKind:"fungible",name:"solana",symbol:"SOL",decimals:9,description:"Solana testnet coin on Unicity",icons:[{url:"https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/svg/icon/sol.svg"},{url:"https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/icon/sol.png"}],id:"dee5f8ce778562eec90e9c38a91296a023210ccc76ff4c29d527ac3eb64ade93"},{network:"unicity:testnet",assetKind:"fungible",name:"bitcoin",symbol:"BTC",decimals:8,description:"Bitcoin testnet coin on Unicity",icons:[{url:"https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/svg/icon/btc.svg"},{url:"https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/icon/btc.png"}],id:"86bc190fcf7b2d07c6078de93db803578760148b16d4431aa2f42a3241ff0daa"},{network:"unicity:testnet",assetKind:"fungible",name:"ethereum",symbol:"ETH",decimals:18,description:"Ethereum testnet coin on Unicity",icons:[{url:"https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/svg/icon/eth.svg"},{url:"https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/icon/eth.png"}],id:"3c2450f2fd867e7bb60c6a69d7ad0e53ce967078c201a3ecaa6074ed4c0deafb"},{network:"unicity:testnet",assetKind:"fungible",name:"tether",symbol:"USDT",decimals:6,description:"Tether (Ethereum) testnet coin on Unicity",icons:[{url:"https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/svg/icon/usdt.svg"},{url:"https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/icon/usdt.png"}],id:"40d25444648418fe7efd433e147187a3a6adf049ac62bc46038bda5b960bf690"},{network:"unicity:testnet",assetKind:"fungible",name:"usd-coin",symbol:"USDC",decimals:6,description:"USDC (Ethereum) testnet coin on Unicity",icons:[{url:"https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/svg/icon/usdc.svg"},{url:"https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/icon/usdc.png"}],id:"2265121770fa6f41131dd9a6cc571e28679263d09a53eb2642e145b5b9a5b0a2"}],REGISTRY_URL="https://raw.githubusercontent.com/unicitynetwork/unicity-ids/refs/heads/main/unicity-ids.testnet.json",CACHE_VALIDITY_MS=1440*60*1e3;class RegistryService{static instance;definitionsById=new Map;isInitialized=!1;initPromise=null;constructor(){this.loadFromBundled(),this.initPromise=this.init()}static getInstance(){return RegistryService.instance||(RegistryService.instance=new RegistryService),RegistryService.instance}async init(){if(this.isInitialized)return;const u=localStorage.getItem(STORAGE_KEYS.UNICITY_IDS_CACHE),g=localStorage.getItem(STORAGE_KEYS.UNICITY_IDS_TIMESTAMP),v=g?parseInt(g,10):0,b=Date.now()-v>CACHE_VALIDITY_MS;if(u&&!b){console.log("Registry: Loading from local cache");try{const w=JSON.parse(u);this.updateMap(w),this.isInitialized=!0;return}catch(w){console.warn("Registry: Cache corrupted, falling back",w)}}(!u||b)&&(console.log("Registry: Cache stale or missing, fetching from GitHub..."),await this.fetchAndCacheRegistry()),this.isInitialized=!0}async ensureInitialized(){this.initPromise&&await this.initPromise}loadFromBundled(){const u=bundledRegistry;this.updateMap(u)}updateMap(u){this.definitionsById.clear(),u.forEach(g=>{this.definitionsById.set(g.id.toLowerCase(),g)})}async fetchAndCacheRegistry(){try{const u=await axios.get(REGISTRY_URL,{timeout:1e4});Array.isArray(u.data)&&(console.log(`Registry: Updated from GitHub (${u.data.length} items)`),this.updateMap(u.data),localStorage.setItem(STORAGE_KEYS.UNICITY_IDS_CACHE,JSON.stringify(u.data)),localStorage.setItem(STORAGE_KEYS.UNICITY_IDS_TIMESTAMP,Date.now().toString()))}catch(u){console.error("Registry: Failed to fetch from GitHub",u)}}getCoinDefinition(u){if(!u)return;const g=u.toLowerCase(),v=this.definitionsById.get(g);return v||(console.log(`Registry: Coin ${g} not found, trying force refresh...`),this.fetchAndCacheRegistry()),v}getIconUrl(u){if(u.icons&&u.icons.length>0){const g=u.icons.find(v=>v.url.toLowerCase().includes(".png"));return g?g.url:u.icons[0].url}return u.icon||null}getAllDefinitions(){return Array.from(this.definitionsById.values())}}function parseRelayUrls$1(y,u){return u}const DEFAULT_NOSTR_RELAYS=["wss://nostr-relay.testnet.unicity.network"],NOSTR_CONFIG={RELAYS:parseRelayUrls$1(void 0,DEFAULT_NOSTR_RELAYS),MAX_PROCESSED_EVENTS:100};class NostrService{static instance;client=null;identityManager;isConnected=!1;isConnecting=!1;connectPromise=null;paymentRequests=[];chatRepository;dmListeners=[];processedEventIds=new Set;constructor(u){this.identityManager=u,this.chatRepository=ChatRepository.getInstance(),this.loadProcessedEvents()}static getInstance(u){if(!NostrService.instance){const g=u||IdentityManager.getInstance();NostrService.instance=new NostrService(g)}return NostrService.instance}async start(){if(!this.isConnected){if(this.isConnecting&&this.connectPromise)return this.connectPromise;this.isConnecting=!0,this.connectPromise=this.doConnect();try{await this.connectPromise}finally{this.isConnecting=!1,this.connectPromise=null}}}async reset(){if(console.log(" Resetting NostrService connection..."),this.client){try{await this.client.disconnect()}catch(u){console.warn("Error disconnecting Nostr client:",u)}this.client=null}this.isConnected=!1,this.isConnecting=!1,this.connectPromise=null,console.log(" NostrService reset complete, ready for reconnection")}async doConnect(){const u=await this.identityManager.getCurrentIdentity();if(!u)throw new Error("No identity found for Nostr");const g=Buffer$1.from(u.privateKey,"hex"),v=NostrKeyManager.fromPrivateKey(g);this.client=new NostrClient(v),console.log(" Connecting to Nostr relays...");try{await this.client.connect(...NOSTR_CONFIG.RELAYS),this.isConnected=!0,console.log(" Connected to Nostr relays"),this.subscribeToPrivateEvents(v.getPublicKeyHex())}catch(b){console.error(" Failed to connect to Nostr",b)}}subscribeToPrivateEvents(u){if(!this.client)return;const g=this.getOrInitLastSync(),v=new Filter;v.kinds=[EventKinds.TOKEN_TRANSFER,EventKinds.PAYMENT_REQUEST],v["#p"]=[u],v.since=g,this.client.subscribe(v,{onEvent:w=>this.handleSubscriptionEvent(w,!0),onEndOfStoredEvents:()=>{console.log("End of stored wallet events")}});const b=new Filter;b.kinds=[EventKinds.GIFT_WRAP],b["#p"]=[u],this.client.subscribe(b,{onEvent:w=>this.handleSubscriptionEvent(w,!1),onEndOfStoredEvents:()=>{console.log("End of stored chat events")}})}async handleSubscriptionEvent(u,g){if(this.isEventProcessed(u.id)){console.log(` Event ${u.id.slice(0,8)} already processed (persistent check), skipping`);return}if(g){const b=this.getOrInitLastSync();if(u.created_at<b){console.log(` Skipping old event (Time: ${u.created_at} <= Sync: ${b})`);return}}console.log(` Processing ${g?"wallet":"chat"} event kind=${u.kind}`);const v=await this.handleIncomingEvent(u);if(v){try{const{IpfsStorageService:b}=await __vitePreload(async()=>{const{IpfsStorageService:S}=await Promise.resolve().then(()=>IpfsStorageService$1);return{IpfsStorageService:S}},void 0),w=b.getInstance(this.identityManager);let E=await w.syncNow();if(!E.success&&E.error==="Sync already in progress"&&(console.log(` Sync in progress for event ${u.id.slice(0,8)}, waiting for completion...`),await this.waitForSyncCompletion(),E=await w.syncNow()),!E.success){console.warn(` IPFS sync failed for event ${u.id.slice(0,8)}: ${E.error}`),console.warn("Token saved locally but NOT marked as processed - will retry on next connect");return}console.log(` Token synced to IPFS: CID=${E.cid?.slice(0,12)}...`)}catch(b){console.error(`IPFS sync error for event ${u.id.slice(0,8)}:`,b),console.warn("Token saved locally but NOT marked as processed - will retry on next connect");return}this.markEventAsProcessed(u.id),console.log(` Event ${u.id.slice(0,8)} fully processed (localStorage + IPFS)`)}else console.warn(` Event ${u.id.slice(0,8)} processing failed, will retry on next connect`);g&&v&&this.updateLastSync(u.created_at)}getOrInitLastSync(){const u=localStorage.getItem(STORAGE_KEYS.NOSTR_LAST_SYNC);if(u)return parseInt(u);{const g=Math.floor(Date.now()/1e3)-300;return localStorage.setItem(STORAGE_KEYS.NOSTR_LAST_SYNC,g.toString()),g}}updateLastSync(u){const g=this.getOrInitLastSync();u>g&&localStorage.setItem(STORAGE_KEYS.NOSTR_LAST_SYNC,u.toString())}waitForSyncCompletion(){return new Promise(u=>{const g=setTimeout(()=>{console.warn(" Sync wait timed out after 60s"),window.removeEventListener("ipfs-storage-event",v),u()},6e4),v=b=>{const w=b.detail;(w?.type==="storage:completed"||w?.type==="sync:state-changed")&&(w.type==="storage:completed"||w.data?.isSyncing===!1)&&(clearTimeout(g),window.removeEventListener("ipfs-storage-event",v),u())};window.addEventListener("ipfs-storage-event",v)})}loadProcessedEvents(){try{const u=localStorage.getItem(STORAGE_KEYS.NOSTR_PROCESSED_EVENTS);if(u){const g=JSON.parse(u);this.processedEventIds=new Set(g),console.log(` Loaded ${g.length} processed event IDs from persistent storage`)}}catch(u){console.error("Failed to load processed events",u),this.processedEventIds=new Set}}saveProcessedEvents(){try{let u=Array.from(this.processedEventIds);u.length>NOSTR_CONFIG.MAX_PROCESSED_EVENTS&&(u=u.slice(-NOSTR_CONFIG.MAX_PROCESSED_EVENTS),this.processedEventIds=new Set(u)),localStorage.setItem(STORAGE_KEYS.NOSTR_PROCESSED_EVENTS,JSON.stringify(u))}catch(u){console.error("Failed to save processed events",u)}}markEventAsProcessed(u){if(this.processedEventIds.add(u),this.processedEventIds.size>NOSTR_CONFIG.MAX_PROCESSED_EVENTS){const g=this.processedEventIds.values().next().value;g&&this.processedEventIds.delete(g)}this.saveProcessedEvents()}isEventProcessed(u){return this.processedEventIds.has(u)}async handleIncomingEvent(u){return console.log(`Received event kind=${u.kind} from=${u.pubkey.slice(0,16)}`),u.kind===EventKinds.TOKEN_TRANSFER?await this.handleTokenTransfer(u):u.kind===EventKinds.GIFT_WRAP?(console.log("Received NIP-17 gift-wrapped message"),this.handleGiftWrappedMessage(u),!0):u.kind===EventKinds.PAYMENT_REQUEST?(this.handlePaymentRequest(u),!0):(console.log(`Unhandled event kind - ${u.kind}`),!0)}async handlePaymentRequest(u){try{const g=await this.getKeyManager();if(!g)return;const v=await PaymentRequestProtocol.parsePaymentRequest(u,g),E=RegistryService.getInstance().getCoinDefinition(v.coinId)?.symbol||"UNKNOWN",S={id:u.id,senderPubkey:u.pubkey,amount:v.amount,coinId:v.coinId,symbol:E,message:v.message,recipientNametag:v.recipientNametag,requestId:v.requestId,timestamp:u.created_at*1e3,status:PaymentRequestStatus.PENDING};this.paymentRequests.find(A=>A.id===S.id)||(this.paymentRequests.unshift(S),this.notifyRequestsUpdated(),console.log(" Payment Request received:",v))}catch(g){console.error("Failed to handle payment request",g)}}notifyRequestsUpdated(){window.dispatchEvent(new CustomEvent("payment-requests-updated"))}acceptPaymentRequest(u){this.updateRequestStatus(u.id,PaymentRequestStatus.ACCEPTED)}rejectPaymentRequest(u){this.updateRequestStatus(u.id,PaymentRequestStatus.REJECTED)}paidPaymentRequest(u){this.updateRequestStatus(u.id,PaymentRequestStatus.PAID)}clearPaymentRequest(u){const g=this.paymentRequests.filter(v=>v.id!==u);this.paymentRequests=g}clearProcessedPaymentRequests(){const u=this.paymentRequests.filter(g=>g.status===PaymentRequestStatus.PENDING);this.paymentRequests=u}updateRequestStatus(u,g){const v=this.paymentRequests.find(b=>b.id===u);v&&(v.status=g,this.notifyRequestsUpdated())}getPaymentRequests(){return this.paymentRequests}async handleTokenTransfer(u){try{const g=await this.getKeyManager();if(!g)return console.error("KeyManager is undefined"),!1;const v=await TokenTransferProtocol.parseTokenTransfer(u,g);if(console.log("Token transfer decrypted successfully!"),v.startsWith("{")&&v.includes("sourceToken")&&v.includes("transferTx")){console.log("Processing proper token transfer with finalization ...");let b;try{b=JSON.parse(v)}catch(w){return console.warn("Failed to parse JSON:",w),!1}return await this.handleProperTokenTransfer(b,u.pubkey)}return!1}catch(g){return console.error("Failed to handle token transfer",g),!1}}async handleProperTokenTransfer(u,g){try{let v=u.sourceToken,b=u.transferTx;if(typeof v=="string")try{v=JSON.parse(v)}catch(S){console.error("Failed to parse sourceToken string",S)}if(typeof b=="string")try{b=JSON.parse(b)}catch(S){console.error("Failed to parse transferTx string",S)}if(!v||!b)return console.error("Missing sourceToken or transferTx in payload"),!1;const w=await Token$1.fromJSON(v),E=await TransferTransaction.fromJSON(b);return await this.finalizeTransfer(w,E,g)}catch(v){return console.error("Error handling proper token transfer",v),!1}}async finalizeTransfer(u,g,v){try{const b=g.data.recipient;console.log(`Recipient address: ${b}`);const w=b.scheme;if(console.log(`Address scheme: ${w}`),w===AddressScheme.PROXY){console.log("Transfer is to PROXY address - finalization required");const S=await NametagService.getInstance(this.identityManager).getAllNametagTokens();if(S.length===0)return console.error("No nametags configured for this wallet"),!1;let A=null;for(const ie of S)(await ProxyAddress.fromTokenId(ie.id)).address===b.address&&(A=ie);if(A===null)return console.error("Transfer is not for any of my nametags!"),console.error(`Got: ${b.address}`),console.error(`My nametags: ${S.toString()}`),!1;console.log("Transfer is for my nametag!");const $=await this.identityManager.getCurrentIdentity();if($===null)return console.error("No wallet identity found, can't finalize the transfer!"),!1;const R=Buffer$1.from($.privateKey,"hex"),T=await SigningService.createFromSecret(R),O=g.data.salt,B=await UnmaskedPredicate.create(u.id,u.type,T,HashAlgorithm.SHA256,O),F=new TokenState(B,null),U=ServiceProvider.stateTransitionClient,q=ServiceProvider.getRootTrustBase(),J=await U.finalizeTransaction(q,u,F,g,[A]);return console.log("Token finalized successfully!"),this.saveReceivedToken(J,v)}else return console.log("Transfer is to DIRECT address - saving without finalization"),this.saveReceivedToken(u,v)}catch(b){return console.error("Error occured while finalizing transfer:",b),!1}}saveReceivedToken(u,g){let v,b,w,E;const A=u.coins;if(A){const T=A.coins;console.log(" Raw Coins:",T);let O=null,B=null;if(Array.isArray(T)){const F=T[0];Array.isArray(F)&&F.length===2?(O=F[0],B=F[1]):console.warn("Unknown array format",F)}else if(typeof T=="object"){const F=Object.keys(T);F.length>0&&(O=F[0],B=T[O])}if(B&&(v=B.toString()),O){console.log(" Processing Key:",O);const F=O.data||O;b=Buffer$1.from(F).toString("hex")}}if(console.log(` FINAL PARSE: CoinID=${b}, Amount=${v}`),!b||v==="0"||b==="0"||b==="undefined")return console.error(" Invalid token data. Skipping."),!1;if(b){const T=RegistryService.getInstance(),O=T.getCoinDefinition(b);O&&(w=O.symbol||"UNK",E=T.getIconUrl(O)||void 0)}const $=WalletRepository.getInstance(),R=new Token$3({id:v4$1(),name:w||"Unicity Token",type:u.type.toString(),symbol:w,jsonData:JSON.stringify(u.toJSON()),status:TokenStatus.CONFIRMED,amount:v,coinId:b,iconUrl:E,timestamp:Date.now(),senderPubkey:g});return $.addToken(R),console.log(` Token saved to wallet: ${R.id}`),!0}async queryPubkeyByNametag(u){this.client||await this.start();try{const g=u.replace("@unicity","").replace("@","");return console.log(`Querying pubkey for: ${g}`),await this.client?.queryPubkeyByNametag(g)||null}catch(g){return console.error("Failed to query nametag",g),null}}async sendTokenTransfer(u,g,v,b,w){this.client||await this.start();try{return console.log(`Sending token transfer to ${u}...`),await this.client?.sendTokenTransfer(u,g,{amount:v,symbol:b,replyToEventId:w}),!0}catch(E){return console.error("Failed to send token transfer",E),!1}}async publishNametagBinding(u,g){this.client||await this.start();try{return await this.client?.publishNametagBinding(u,g),!0}catch(v){return console.error("Failed to publish nametag",v),!1}}async getKeyManager(){const u=await this.identityManager.getCurrentIdentity();if(!u||!this.client)return;const g=Buffer$1.from(u.privateKey,"hex");return NostrKeyManager.fromPrivateKey(g)}wrapMessageContent(u,g){return g?JSON.stringify({senderNametag:g,text:u}):u}unwrapMessageContent(u){try{const g=JSON.parse(u);if(typeof g=="object"&&g.text!==void 0)return{text:g.text,senderNametag:g.senderNametag||null}}catch{}return{text:u,senderNametag:null}}async handleGiftWrappedMessage(u){try{if(!this.client){console.error("No client for unwrapping message");return}const g=this.client.unwrapPrivateMessage(u);g.kind===14?this.handleIncomingChatMessage(g):g.kind===15?this.handleIncomingReadReceipt(g):console.log(`Unknown NIP-17 message kind: ${g.kind}`)}catch(g){console.error("Failed to handle gift-wrapped message",g)}}handleIncomingChatMessage(u){const g=u.senderPubkey,v=u.content,{text:b,senderNametag:w}=this.unwrapMessageContent(v);if(this.chatRepository.getMessage(u.eventId)){console.log(` Skipping already saved message ${u.eventId.slice(0,8)}`);return}console.log(` NIP-17 DM from ${w||g.slice(0,8)}: ${b.slice(0,50)}...`);const S=this.chatRepository.getOrCreateConversation(g,w||void 0);w&&!S.participantNametag&&(S.participantNametag=w,this.chatRepository.updateConversationNametag(S.id,w));const A=new ChatMessage({id:u.eventId,conversationId:S.id,content:b,timestamp:u.timestamp*1e3,isFromMe:!1,status:MessageStatus.DELIVERED,type:MessageType$1.TEXT,senderPubkey:g,senderNametag:w||void 0});this.chatRepository.saveMessage(A),this.chatRepository.incrementUnreadCount(S.id),this.notifyDMListeners(A),this.sendReadReceipt(g,u.eventId).catch(console.error)}handleIncomingReadReceipt(u){const g=u.replyToEventId;g&&(console.log(` Read receipt for message: ${g.slice(0,8)}`),this.chatRepository.updateMessageStatus(g,MessageStatus.READ))}async sendReadReceipt(u,g){this.client||await this.start();try{await this.client?.sendReadReceipt(u,g),console.log(` Read receipt sent for ${g.slice(0,8)}`)}catch(v){console.error("Failed to send read receipt",v)}}async sendDirectMessage(u,g,v){this.client||await this.start();try{const b=await this.identityManager.getCurrentIdentity();if(!b)throw new Error("No identity for sending DM");const w=await this.getMyNametag(),E=this.chatRepository.getOrCreateConversation(u,v),S=new ChatMessage({conversationId:E.id,content:g,timestamp:Date.now(),isFromMe:!0,status:MessageStatus.PENDING,type:MessageType$1.TEXT,senderPubkey:b.publicKey});this.chatRepository.saveMessage(S);const A=this.wrapMessageContent(g,w),$=await this.client?.sendPrivateMessage(u,A);if($){const R=S.id;return S.id=$,S.status=MessageStatus.SENT,this.chatRepository.deleteMessage(R),this.chatRepository.saveMessage(S),console.log(` NIP-17 DM sent to ${u.slice(0,8)} from @${w||"unknown"}`),S}else return this.chatRepository.updateMessageStatus(S.id,MessageStatus.FAILED),null}catch(b){return console.error("Failed to send DM",b),null}}async sendDirectMessageByNametag(u,g){this.client||await this.start();try{const v=await this.identityManager.getCurrentIdentity();if(!v)throw new Error("No identity for sending DM");const b=await this.getMyNametag(),w=await this.queryPubkeyByNametag(u);if(!w)return console.error(`Could not resolve nametag: ${u}`),null;const E=this.chatRepository.getOrCreateConversation(w,u),S=new ChatMessage({conversationId:E.id,content:g,timestamp:Date.now(),isFromMe:!0,status:MessageStatus.PENDING,type:MessageType$1.TEXT,senderPubkey:v.publicKey});this.chatRepository.saveMessage(S);const A=this.wrapMessageContent(g,b),$=await this.client?.sendPrivateMessageToNametag(u.replace("@",""),A);if($){const R=S.id;return S.id=$,S.status=MessageStatus.SENT,this.chatRepository.deleteMessage(R),this.chatRepository.saveMessage(S),console.log(` NIP-17 DM sent to @${u} from @${b||"unknown"}`),S}else return this.chatRepository.updateMessageStatus(S.id,MessageStatus.FAILED),null}catch(v){return console.error("Failed to send DM by nametag",v),null}}addDMListener(u){this.dmListeners.push(u)}removeDMListener(u){this.dmListeners=this.dmListeners.filter(g=>g!==u)}notifyDMListeners(u){this.dmListeners.forEach(g=>g(u)),window.dispatchEvent(new CustomEvent("dm-received",{detail:u}))}getMyPublicKey(){return this.client?.getKeyManager()?.getPublicKeyHex()||null}async getMyNametag(){return NametagService.getInstance(this.identityManager).getActiveNametag()}async publishAppDataEvent(u,g,v){this.client||await this.start();try{if(!await this.getKeyManager()||!this.client)return console.error("Cannot publish app data event: no key manager or client"),null;const w=await this.client.createAndPublishEvent({kind:u,tags:g,content:v});return w&&console.log(` Published app data event (kind ${u}): ${w.slice(0,8)}...`),w||null}catch(b){return console.error("Failed to publish app data event:",b),null}}}class MintCommitment extends Commitment{constructor(u,g,v){super(u,g,v)}static async create(u){const g=await MintSigningService.create(u.tokenId),v=await u.calculateHash(),b=await RequestId.create(g.publicKey,u.sourceState),w=await Authenticator.create(g,v,u.sourceState);return new MintCommitment(b,u,w)}toTransaction(u){return new MintTransaction(this.transactionData,u)}}const UNICITY_TOKEN_TYPE_HEX="f8aa13834268d29355ff12183066f0cb902003629bbc5eb9ef0efbe397867509";class NametagService{static instance;identityManager;constructor(u){this.identityManager=u}static getInstance(u){return NametagService.instance||(NametagService.instance=new NametagService(u)),NametagService.instance}async isNametagAvailable(u){const g=await TokenId.fromNameTag(u);return!await ServiceProvider.stateTransitionClient.isMinted(ServiceProvider.getRootTrustBase(),g)}async mintNametagAndPublish(u){try{const g=u.replace("@unicity","").replace("@","").trim();console.log(`Starting mint process for: ${g}`);const b=WalletRepository.getInstance().getNametag();if(b)return{status:"error",message:`Identity already has a nametag: ${b.name}`};const w=await this.identityManager.getCurrentIdentity();if(!w)return{status:"error",message:"Wallet identity not found"};const E=Buffer.from(w.privateKey,"hex"),S=await this.identityManager.getWalletAddress();if(!S)return{status:"error",message:"Failed to derive owner address"};const A=await this.mintNametagOnBlockchain(g,S,E);if(!A)return{status:"error",message:"Failed to mint nametag on blockchain"};await this.saveNametagToStorage(g,A);try{const $=NostrService.getInstance(this.identityManager);await $.start();const R=await ProxyAddress.fromNameTag(g);return console.log(`Publishing binding: ${g} -> ${R}`),await $.publishNametagBinding(g,R.address)?{status:"success",token:A}:{status:"warning",token:A,message:"Minted locally, but Nostr publish failed"}}catch($){return console.error("Nostr error",$),{status:"warning",token:A,message:`Nostr error: ${$.message}`}}}catch(g){return console.error("Critical error in mintNametagAndPublish",g),{status:"error",message:"Unknown error"}}}async mintNametagOnBlockchain(u,g,v){try{const b=ServiceProvider.stateTransitionClient,w=ServiceProvider.getRootTrustBase(),E=await TokenId.fromNameTag(u),S=new TokenType(Buffer.from(UNICITY_TOKEN_TYPE_HEX,"hex")),A=await SigningService.createFromSecret(v),$=3;let R=null;for(let J=1;J<=$;J++)try{const ie=Buffer.alloc(32);window.crypto.getRandomValues(ie);const oe=await MintTransactionData.createFromNametag(u,S,g,ie,g);R=await MintCommitment.create(oe),console.log(`Submitting commitment (attempt ${J})...`);const le=await b.submitMintCommitment(R);if(le.status==="SUCCESS"){console.log("Commitment success!");break}else{if(console.warn(`Commitment failed: ${le.status}`),J===$)throw new Error(`Failed after ${$} attempts`);await new Promise(de=>setTimeout(de,1e3*J))}}catch(ie){if(console.error(`Attempt ${J} error`,ie),J===$)throw ie}if(!R)throw new Error("Failed to create commitment");console.log("Waiting for inclusion proof...");const T=await waitInclusionProof(w,b,R),O=R.toTransaction(T),F=R.transactionData.salt,U=await UnmaskedPredicate.create(E,S,A,HashAlgorithm.SHA256,F),q=Token$1.mint(w,new TokenState(U,null),O);return console.log(` Nametag minted: ${u}`),q}catch(b){return console.error("Minting on blockchain failed",b),null}}async saveNametagToStorage(u,g){const v={name:u,token:g.toJSON(),timestamp:Date.now(),format:"txf",version:"2.0"},b=await this.identityManager.getCurrentIdentity();if(!b){console.error("Cannot save nametag: no identity available");return}const w=WalletRepository.getInstance();let E=w.getWallet();(!E||E.address!==b.address)&&(E=w.loadWalletForAddress(b.address),E||(E=w.createWallet(b.address,"My Wallet"))),w.setNametag(v)}getActiveNametag(){return WalletRepository.getInstance().getNametag()?.name||null}async getNametagToken(){const u=WalletRepository.getInstance().getNametag();if(!u)return null;try{return await Token$1.fromJSON(u.token)}catch(g){return console.error("Failed to parse nametag token",g),null}}async getAllNametagTokens(){const u=await this.getNametagToken();return u?[u]:[]}}class DataHasherFactory{algorithm;_hasherConstructor;constructor(u,g){this.algorithm=u,this._hasherConstructor=g}create(){return new this._hasherConstructor(this.algorithm)}}let FinalizedLeafBranch$1=class{path;_data;hash;constructor(u,g,v){this.path=u,this._data=g,this.hash=v,this._data=new Uint8Array(g)}get data(){return new Uint8Array(this._data)}finalize(){return Promise.resolve(this)}toString(){return dedent`
      Leaf[${this.path.toString(2)}]
        Data: ${HexConverter.encode(this._data)}
        Hash: ${this.hash.toString()}`}};class LeafInBranchError extends Error{constructor(){super("Cannot add leaf inside branch."),this.name="LeafInBranchError"}}class LeafOutOfBoundsError extends Error{constructor(){super("Cannot extend tree through leaf."),this.name="LeafOutOfBoundsError"}}let PendingLeafBranch$1=class{path;_data;constructor(u,g){this.path=u,this._data=g,this._data=new Uint8Array(g)}get data(){return new Uint8Array(this._data)}async finalize(u){const g=await u.create().update(CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(this.path)),CborSerializer.encodeByteString(this._data))).digest();return new FinalizedLeafBranch$1(this.path,this._data,g)}},FinalizedNodeBranch$1=class{path;left;right;hash;constructor(u,g,v,b){this.path=u,this.left=g,this.right=v,this.hash=b}finalize(){return Promise.resolve(this)}toString(){return dedent`
      Node[${this.path.toString(2)}]
        Hash: ${this.hash.toString()}
        Left: ${this.left.toString()}
        Right: ${this.right.toString()}`}},PendingNodeBranch$1=class{path;left;right;constructor(u,g,v){this.path=u,this.left=g,this.right=v}async finalize(u){const[g,v]=await Promise.all([this.left.finalize(u),this.right.finalize(u)]),b=await u.create().update(CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(this.path)),CborSerializer.encodeByteString(g.hash.data),CborSerializer.encodeByteString(v.hash.data))).digest();return new FinalizedNodeBranch$1(this.path,g,v,b)}};function calculateCommonPath(y,u){let g=1n,v=1n,b=0n;for(;(y&v)===(u&v)&&g<y&&g<u;)v<<=1n,b+=1n,g=v|v-1n&y;return{length:b,path:g}}class SparseMerkleTreeRootNode{left;right;hash;path=1n;constructor(u,g,v){this.left=u,this.right=g,this.hash=v}static async create(u,g,v){const b=await v.create().update(CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(1n)),CborSerializer.encodeOptional(u?.hash.data,CborSerializer.encodeByteString),CborSerializer.encodeOptional(g?.hash.data,CborSerializer.encodeByteString))).digest();return new SparseMerkleTreeRootNode(u??null,g??null,b)}static generatePath(u,g){if(g instanceof FinalizedLeafBranch$1)return[new SparseMerkleTreePathStep(g.path,g.data)];const v=calculateCommonPath(u,g.path);if(u=u>>v.length,v.path!==g.path||u===1n)return[new SparseMerkleTreePathStep(0n,g.left?.hash.data??null),new SparseMerkleTreePathStep(g.path,g.right?.hash.data??null)];const b=u&1n,w=b?g.right:g.left,E=b?g.left:g.right,S=new SparseMerkleTreePathStep(g.path,E?.hash.data??null);return w===null?[new SparseMerkleTreePathStep(b,null),S]:[...this.generatePath(u,w),S]}getPath(u){return new SparseMerkleTreePath(this.hash,SparseMerkleTreeRootNode.generatePath(u,this))}toString(){return dedent`
      Root: 
        Hash: ${this.hash.toString()}
      Left: 
        ${this.left?this.left.toString():"null"}
      Right: 
        ${this.right?this.right.toString():"null"}`}}class SparseMerkleTree{factory;left=Promise.resolve(null);right=Promise.resolve(null);constructor(u){this.factory=u}async addLeaf(u,g){if(u<1n)throw new Error("Path must be greater than 0.");const v=u&1n;g=new Uint8Array(g);const b=v?this.right:this.left,w=b.then(E=>E?this.buildTree(E,u,g):new PendingLeafBranch$1(u,g));v?this.right=w.catch(()=>b):this.left=w.catch(()=>b),await w}async calculateRoot(){this.left=this.left.then(v=>v?v.finalize(this.factory):Promise.resolve(null)),this.right=this.right?.then(v=>v?v.finalize(this.factory):Promise.resolve(null));const[u,g]=await Promise.all([this.left,this.right]);return SparseMerkleTreeRootNode.create(u,g,this.factory)}buildTree(u,g,v){const b=calculateCommonPath(g,u.path),w=g>>b.length&1n;if(b.path===g)throw new LeafInBranchError;if(u instanceof PendingLeafBranch$1||u instanceof FinalizedLeafBranch$1){if(b.path===u.path)throw new LeafOutOfBoundsError;const E=new PendingLeafBranch$1(u.path>>b.length,u.data),S=new PendingLeafBranch$1(g>>b.length,v);return new PendingNodeBranch$1(b.path,w?E:S,w?S:E)}if(b.path<u.path){const E=new PendingLeafBranch$1(g>>b.length,v),S=new PendingNodeBranch$1(u.path>>b.length,u.left,u.right);return new PendingNodeBranch$1(b.path,w?S:E,w?E:S)}return w?new PendingNodeBranch$1(u.path,u.left,this.buildTree(u.right,g>>b.length,v)):new PendingNodeBranch$1(u.path,this.buildTree(u.left,g>>b.length,v),u.right)}}class FinalizedLeafBranch{path;_data;value;hash;constructor(u,g,v,b){this.path=u,this._data=g,this.value=v,this.hash=b,this._data=new Uint8Array(g)}get data(){return new Uint8Array(this._data)}finalize(){return Promise.resolve(this)}toString(){return dedent`
      Leaf[${this.path.toString(2)}]
        Hash: ${this.hash.toString()}
        Data: ${HexConverter.encode(this._data)}
        Sum: ${this.value}`}}class PendingLeafBranch{path;_data;value;constructor(u,g,v){this.path=u,this._data=g,this.value=v,this._data=new Uint8Array(g)}get data(){return new Uint8Array(this._data)}async finalize(u){const g=await u.create().update(CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(this.path)),CborSerializer.encodeByteString(this._data),CborSerializer.encodeByteString(BigintConverter.encode(this.value)))).digest();return new FinalizedLeafBranch(this.path,this._data,this.value,g)}}class FinalizedNodeBranch{path;left;right;value;hash;constructor(u,g,v,b,w){this.path=u,this.left=g,this.right=v,this.value=b,this.hash=w}finalize(){return Promise.resolve(this)}toString(){return dedent`
      Node[${this.path.toString(2)}]
        Hash: ${this.hash.toString()}
        Value: ${this.value}
        Left: ${this.left.toString()}
        Right: ${this.right.toString()}`}}class PendingNodeBranch{path;left;right;constructor(u,g,v){this.path=u,this.left=g,this.right=v}async finalize(u){const[g,v]=await Promise.all([this.left.finalize(u),this.right.finalize(u)]),b=await u.create().update(CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(this.path)),CborSerializer.encodeByteString(g.hash.data),CborSerializer.encodeByteString(BigintConverter.encode(g.value)),CborSerializer.encodeByteString(v.hash.data),CborSerializer.encodeByteString(BigintConverter.encode(v.value)))).digest();return new FinalizedNodeBranch(this.path,g,v,g.value+v.value,b)}}class SparseMerkleSumTreeRootNode{left;right;value;hash;path=1n;constructor(u,g,v,b){this.left=u,this.right=g,this.value=v,this.hash=b}static async create(u,g,v){const b=await v.create().update(CborSerializer.encodeArray(CborSerializer.encodeByteString(BigintConverter.encode(1n)),CborSerializer.encodeOptional(u?.hash.data,CborSerializer.encodeByteString),CborSerializer.encodeByteString(BigintConverter.encode(u?.value??0n)),CborSerializer.encodeOptional(g?.hash.data,CborSerializer.encodeByteString),CborSerializer.encodeByteString(BigintConverter.encode(g?.value??0n)))).digest();return new SparseMerkleSumTreeRootNode(u??null,g??null,(u?.value??0n)+(g?.value??0n),b)}static generatePath(u,g){if(g instanceof FinalizedLeafBranch)return[new SparseMerkleSumTreePathStep(g.path,g.data,g.value)];const v=calculateCommonPath(u,g.path);if(u=u>>v.length,v.path!==g.path||u===1n)return[new SparseMerkleSumTreePathStep(0n,g.left?.hash.data??null,g.left?.value??0n),new SparseMerkleSumTreePathStep(g.path,g.right?.hash.data??null,g.right?.value??0n)];const b=u&1n,w=b?g.right:g.left,E=b?g.left:g.right,S=new SparseMerkleSumTreePathStep(g.path,E?.hash.data??null,E?.value??0n);return w===null?[new SparseMerkleSumTreePathStep(b,null,0n),S]:[...this.generatePath(u,w),S]}getPath(u){return new SparseMerkleSumTreePath(this.hash,SparseMerkleSumTreeRootNode.generatePath(u,this))}toString(){return dedent`
      Left: 
        ${this.left?this.left.toString():"null"}
      Right: 
        ${this.right?this.right.toString():"null"}`}}class SparseMerkleSumTree{factory;left=Promise.resolve(null);right=Promise.resolve(null);constructor(u){this.factory=u}async addLeaf(u,g,v){if(v<0n)throw new Error("Value must be an unsigned bigint.");if(u<1n)throw new Error("Path must be greater than 0.");const b=u&1n;g=new Uint8Array(g);const w=b?this.right:this.left,E=w.then(S=>S?this.buildTree(S,u,g,v):new PendingLeafBranch(u,g,v));b?this.right=E.catch(()=>w):this.left=E.catch(()=>w),await E}async calculateRoot(){this.left=this.left.then(v=>v?v.finalize(this.factory):Promise.resolve(null)),this.right=this.right?.then(v=>v?v.finalize(this.factory):Promise.resolve(null));const[u,g]=await Promise.all([this.left,this.right]);return SparseMerkleSumTreeRootNode.create(u,g,this.factory)}buildTree(u,g,v,b){const w=calculateCommonPath(g,u.path),E=g>>w.length&1n;if(w.path===g)throw new LeafInBranchError;if(u instanceof PendingLeafBranch||u instanceof FinalizedLeafBranch){if(w.path===u.path)throw new LeafOutOfBoundsError;const S=new PendingLeafBranch(u.path>>w.length,u.data,u.value),A=new PendingLeafBranch(g>>w.length,v,b);return new PendingNodeBranch(w.path,E?S:A,E?A:S)}if(w.path<u.path){const S=new PendingLeafBranch(g>>w.length,v,b),A=new PendingNodeBranch(u.path>>w.length,u.left,u.right);return new PendingNodeBranch(w.path,E?A:S,E?S:A)}return E?new PendingNodeBranch(u.path,u.left,this.buildTree(u.right,g>>w.length,v,b)):new PendingNodeBranch(u.path,this.buildTree(u.left,g>>w.length,v,b),u.right)}}class TokenRequest{id;type;data;coinData;recipient;salt;recipientDataHash;constructor(u,g,v,b,w,E,S){if(this.id=u,this.type=g,this.data=v,this.coinData=b,this.recipient=w,this.salt=E,this.recipientDataHash=S,b?.length==0)throw new Error("Token must have at least one coin")}}class TokenSplit{token;aggregationRoot;coinRoots;tokens;constructor(u,g,v,b){this.token=u,this.aggregationRoot=g,this.coinRoots=v,this.tokens=b}async createBurnCommitment(u,g){const v=await BurnPredicateReference.create(this.token.type,this.aggregationRoot.hash);return TransferCommitment.create(this.token,await v.toAddress(),u,null,null,g)}async createSplitMintCommitments(u,g){const v=await this.token.update(u,new TokenState(new BurnPredicate(this.token.id,this.token.type,this.aggregationRoot.hash),null),g);return Promise.all(this.tokens.map(b=>MintTransactionData.create(b.id,b.type,b.data,b.coinData,b.recipient,b.salt,b.recipientDataHash,new SplitMintReason(v,b.coinData.coins.map(([w])=>new SplitMintReasonProof(w,this.aggregationRoot.getPath(w.toBitString().toBigInt()),this.coinRoots.get(w.toJSON()).getPath(b.id.toBitString().toBigInt()))))).then(w=>MintCommitment.create(w))))}}class TokenSplitBuilder{tokens=new Map;createToken(u,g,v,b,w,E,S){return this.tokens.set(u.toJSON(),new TokenRequest(u,g,v,b,w,E,S)),this}async build(u){const g=new Map;for(const w of this.tokens.values())for(const[E,S]of w.coinData.coins){let A=g.get(E.toJSON())?.[1];A||(A=new SparseMerkleSumTree(new DataHasherFactory(HashAlgorithm.SHA256,DataHasher)),g.set(E.toJSON(),[E,A])),await A.addLeaf(w.id.toBitString().toBigInt(),E.bytes,S)}if(g.size!==u.coins?.length)throw new Error("Token has different number of coins than expected");const v=new SparseMerkleTree(new DataHasherFactory(HashAlgorithm.SHA256,DataHasher)),b=new Map;for(const[w,E]of g.values()){const S=u.coins.get(w),A=await E.calculateRoot();if(A.value!==S)throw new Error(`Token contained ${S} ${w} coins, but tree has ${A.value}`);b.set(w.toJSON(),A),await v.addLeaf(w.toBitString().toBigInt(),A.hash.imprint)}return new TokenSplit(u,await v.calculateRoot(),b,Array.from(this.tokens.values()))}}function isTerminalStatus(y){return y==="COMPLETED"||y==="FAILED"}function isPendingStatus(y){return!isTerminalStatus(y)}function createOutboxEntry(y,u,g,v,b,w,E,S,A,$,R,T){const O=Date.now();return{id:crypto.randomUUID(),createdAt:O,updatedAt:O,status:"PENDING_IPFS_SYNC",type:y,sourceTokenId:u,recipientNametag:g,recipientPubkey:v,recipientAddressJson:b,amount:w,coinId:E,salt:S,sourceTokenJson:A,commitmentJson:$,retryCount:0,splitGroupId:R,splitGroupIndex:T}}function validateOutboxEntry(y){if(!y.id||!y.sourceTokenId||!y.salt||!y.commitmentJson)return{valid:!1,error:"Missing required fields (id, sourceTokenId, salt, or commitmentJson)"};switch(y.status){case"PROOF_RECEIVED":case"NOSTR_SENT":case"COMPLETED":if(!y.inclusionProofJson)return{valid:!1,error:"Missing inclusionProofJson for status "+y.status};break}return{valid:!0}}const OutboxTypes=Object.freeze(Object.defineProperty({__proto__:null,createOutboxEntry,isPendingStatus,isTerminalStatus,validateOutboxEntry},Symbol.toStringTag,{value:"Module"}));class OutboxRepository{static instance;_entries=new Map;_splitGroups=new Map;_currentAddress=null;constructor(){this.loadFromStorage()}static getInstance(){return OutboxRepository.instance||(OutboxRepository.instance=new OutboxRepository),OutboxRepository.instance}setCurrentAddress(u){this._currentAddress!==u&&(this._currentAddress=u,this.loadFromStorage())}getCurrentAddress(){return this._currentAddress}addEntry(u){const g=validateOutboxEntry(u);if(!g.valid)throw new Error(`Invalid outbox entry: ${g.error}`);if(this._entries.has(u.id))throw new Error(`Outbox entry ${u.id} already exists`);this._entries.set(u.id,{...u}),this.saveToStorage(),console.log(` Outbox: Added entry ${u.id.slice(0,8)}... (${u.type}, status=${u.status})`)}updateEntry(u,g){const v=this._entries.get(u);if(!v)throw new Error(`Outbox entry ${u} not found`);const b={...v,...g,updatedAt:Date.now()},w=validateOutboxEntry(b);if(!w.valid)throw new Error(`Invalid outbox entry after update: ${w.error}`);return this._entries.set(u,b),this.saveToStorage(),console.log(` Outbox: Updated entry ${u.slice(0,8)}... (status=${b.status})`),b}updateStatus(u,g,v){const b={status:g};return v&&(b.lastError=v),this.updateEntry(u,b)}removeEntry(u){this._entries.delete(u)&&(this.saveToStorage(),console.log(` Outbox: Removed entry ${u.slice(0,8)}...`))}getEntry(u){const g=this._entries.get(u);return g?{...g}:null}hasEntry(u){return this._entries.has(u)}getAllEntries(){return Array.from(this._entries.values()).map(u=>({...u}))}getPendingEntries(){return Array.from(this._entries.values()).filter(u=>isPendingStatus(u.status)).map(u=>({...u}))}getEntriesByStatus(u){return Array.from(this._entries.values()).filter(g=>g.status===u).map(g=>({...g}))}getEntriesForToken(u){return Array.from(this._entries.values()).filter(g=>g.sourceTokenId===u).map(g=>({...g}))}isTokenInOutbox(u){for(const g of this._entries.values())if(g.sourceTokenId===u&&isPendingStatus(g.status))return!0;return!1}getPendingCount(){let u=0;for(const g of this._entries.values())isPendingStatus(g.status)&&u++;return u}createSplitGroup(u){if(this._splitGroups.has(u.groupId))throw new Error(`Split group ${u.groupId} already exists`);this._splitGroups.set(u.groupId,{...u}),this.saveSplitGroupsToStorage(),console.log(` Outbox: Created split group ${u.groupId.slice(0,8)}...`)}getSplitGroup(u){const g=this._splitGroups.get(u);return g?{...g}:null}addEntryToSplitGroup(u,g){const v=this._splitGroups.get(u);if(!v)throw new Error(`Split group ${u} not found`);v.entryIds.includes(g)||(v.entryIds.push(g),this.saveSplitGroupsToStorage())}removeSplitGroup(u){this._splitGroups.delete(u)&&(this.saveSplitGroupsToStorage(),console.log(` Outbox: Removed split group ${u.slice(0,8)}...`))}getAllSplitGroups(){return Array.from(this._splitGroups.values()).map(u=>({...u}))}getAllForSync(){return Array.from(this._entries.values()).filter(u=>u.status!=="COMPLETED").map(u=>({...u}))}importFromRemote(u){let g=0;for(const v of u){const b=this._entries.get(v.id);b?v.updatedAt>b.updatedAt&&(this._entries.set(v.id,{...v}),g++):(this._entries.set(v.id,{...v}),g++)}g>0&&(this.saveToStorage(),console.log(` Outbox: Imported ${g} entries from remote`))}cleanupCompleted(u=1440*60*1e3){const g=Date.now()-u;let v=0;for(const[b,w]of this._entries)isTerminalStatus(w.status)&&w.updatedAt<g&&(this._entries.delete(b),v++);return v>0&&(this.saveToStorage(),console.log(` Outbox: Cleaned up ${v} old entries`)),v}clearAll(){this._entries.clear(),this._splitGroups.clear(),this.saveToStorage(),this.saveSplitGroupsToStorage(),console.log(" Outbox: Cleared all entries")}getStorageKey(){return this._currentAddress?`${STORAGE_KEYS.OUTBOX}_${this._currentAddress}`:STORAGE_KEYS.OUTBOX}getSplitGroupsStorageKey(){return this._currentAddress?`${STORAGE_KEYS.OUTBOX_SPLIT_GROUPS}_${this._currentAddress}`:STORAGE_KEYS.OUTBOX_SPLIT_GROUPS}loadFromStorage(){try{const u=localStorage.getItem(this.getStorageKey());if(u){const v=JSON.parse(u);this._entries.clear();for(const b of v)this._entries.set(b.id,b);console.log(` Outbox: Loaded ${this._entries.size} entries from storage`)}else this._entries.clear();const g=localStorage.getItem(this.getSplitGroupsStorageKey());if(g){const v=JSON.parse(g);this._splitGroups.clear();for(const b of v)this._splitGroups.set(b.groupId,b)}else this._splitGroups.clear()}catch(u){console.error(" Outbox: Failed to load from storage:",u),this._entries.clear(),this._splitGroups.clear()}}saveToStorage(){try{const u=Array.from(this._entries.values());localStorage.setItem(this.getStorageKey(),JSON.stringify(u))}catch(u){console.error(" Outbox: Failed to save to storage:",u)}}saveSplitGroupsToStorage(){try{const u=Array.from(this._splitGroups.values());localStorage.setItem(this.getSplitGroupsStorageKey(),JSON.stringify(u))}catch(u){console.error(" Outbox: Failed to save split groups to storage:",u)}}getStats(){const u={PENDING_IPFS_SYNC:0,READY_TO_SUBMIT:0,SUBMITTED:0,PROOF_RECEIVED:0,NOSTR_SENT:0,COMPLETED:0,FAILED:0};for(const g of this._entries.values())u[g.status]++;return{total:this._entries.size,pending:this.getPendingCount(),completed:u.COMPLETED,failed:u.FAILED,byStatus:u}}}const OutboxRepository$1=Object.freeze(Object.defineProperty({__proto__:null,OutboxRepository},Symbol.toStringTag,{value:"Module"}));async function sha256$5(y){const u=typeof y=="string"?new TextEncoder().encode(y):y,g=await window.crypto.subtle.digest("SHA-256",u);return new Uint8Array(g)}class TokenSplitExecutor{get client(){return ServiceProvider.stateTransitionClient}get trustBase(){return ServiceProvider.getRootTrustBase()}async executeSplitPlan(u,g,v,b,w){console.log(" Executing split plan using TokenSplitBuilder...");const E={tokensForRecipient:[],tokensKeptBySender:[],burnedTokens:[],recipientTransferTxs:[],outboxEntryIds:[],splitGroupId:void 0};if(u.requiresSplit&&u.tokenToSplit&&u.splitAmount&&u.remainderAmount){const S=Buffer$1.from(u.coinId,"hex"),A=new CoinId(S),$=await this.executeSingleTokenSplit(u.tokenToSplit.sdkToken,u.splitAmount,u.remainderAmount,A,g,v,b,u.tokenToSplit.uiToken.id,w);E.tokensForRecipient.push($.tokenForRecipient),E.tokensKeptBySender.push($.tokenForSender),E.burnedTokens.push(u.tokenToSplit.uiToken),E.recipientTransferTxs.push($.recipientTransferTx),$.outboxEntryId&&E.outboxEntryIds.push($.outboxEntryId),$.splitGroupId&&(E.splitGroupId=$.splitGroupId)}return E}async executeSingleTokenSplit(u,g,v,b,w,E,S,A,$){const R=Buffer$1.from(u.id.bytes).toString("hex");console.log(` Splitting token ${R.slice(0,8)}...`);const T=new TokenSplitBuilder,O=`${R}_${g.toString()}_${v.toString()}`;let B=null,F,U;if($){B=OutboxRepository.getInstance(),B.setCurrentAddress($.walletAddress),F=crypto.randomUUID();const Re={groupId:F,createdAt:Date.now(),originalTokenId:A,seedString:O,entryIds:[]};B.createSplitGroup(Re),console.log(` Outbox: Created split group ${F.slice(0,8)}...`)}const q=new TokenId(await sha256$5(O)),J=new TokenId(await sha256$5(O+"_sender")),ie=await sha256$5(O+"_recipient_salt"),oe=await sha256$5(O+"_sender_salt"),de=await(await UnmaskedPredicateReference.create(u.type,E.algorithm,E.publicKey,HashAlgorithm.SHA256)).toAddress(),fe=TokenCoinData.create([[b,g]]);T.createToken(q,u.type,new Uint8Array(0),fe,de,ie,null);const ye=TokenCoinData.create([[b,v]]);T.createToken(J,u.type,new Uint8Array(0),ye,de,oe,null);const we=await T.build(u),pe=await sha256$5(O+"_burn_salt"),ve=await we.createBurnCommitment(pe,E);console.log(" Submitting burn commitment...");const he=await this.client.submitTransferCommitment(ve);if(he.status==="REQUEST_ID_EXISTS")console.warn("Token already burned, attempting recovery...");else if(he.status!=="SUCCESS")throw new Error(`Burn failed: ${he.status}`);S(A);const ae=await waitInclusionProof(this.trustBase,this.client,ve),Q=ve.toTransaction(ae);console.log(" Creating split mint commitments...");const j=await we.createSplitMintCommitments(this.trustBase,Q),z=[];for(const Re of j){const Ae=await this.client.submitMintCommitment(Re);if(Ae.status!=="SUCCESS"&&Ae.status!=="REQUEST_ID_EXISTS")throw new Error(`Mint split token failed: ${Ae.status}`);const ge=await waitInclusionProof(this.trustBase,this.client,Re),be=Buffer$1.from(Re.transactionData.tokenId.bytes).toString("hex"),Te=Buffer$1.from(q.bytes).toString("hex"),De=be===Te;z.push({commitment:Re,inclusionProof:ge,isForRecipient:De,tokenId:Re.transactionData.tokenId,salt:Re.transactionData.salt})}console.log("All split tokens minted on blockchain.");const re=z.find(Re=>Re.isForRecipient),Y=z.find(Re=>!Re.isForRecipient);if(!re||!Y)throw new Error("Failed to identify split tokens");const te=await this.createAndVerifyToken(re,E,u.type,"Recipient (Pre-transfer)"),ne=await this.createAndVerifyToken(Y,E,u.type,"Sender (Change)");console.log(` Transferring split token to ${w.address}...`);const se=await sha256$5(O+"_transfer_salt"),ee=await TransferCommitment.create(te,w,se,null,null,E);if(B&&$&&F){const Re=Buffer$1.from(b.bytes).toString("hex"),Ae=createOutboxEntry("SPLIT_TRANSFER",A,$.recipientNametag,$.recipientPubkey,JSON.stringify(w.toJSON?w.toJSON():w),g.toString(),Re,Buffer$1.from(se).toString("hex"),JSON.stringify(te.toJSON()),JSON.stringify(ee.toJSON()),F,3);Ae.status="READY_TO_SUBMIT",B.addEntry(Ae),B.addEntryToSplitGroup(F,Ae.id),U=Ae.id,console.log(` Outbox: Added split transfer entry ${Ae.id.slice(0,8)}...`)}const Z=await this.client.submitTransferCommitment(ee);if(Z.status!=="SUCCESS"&&Z.status!=="REQUEST_ID_EXISTS")throw B&&U&&B.updateStatus(U,"FAILED",`Transfer failed: ${Z.status}`),new Error(`Transfer failed: ${Z.status}`);B&&U&&B.updateStatus(U,"SUBMITTED");const ue=await waitInclusionProof(this.trustBase,this.client,ee),_e=ee.toTransaction(ue);return B&&U&&B.updateEntry(U,{status:"PROOF_RECEIVED",inclusionProofJson:JSON.stringify(ue.toJSON()),transferTxJson:JSON.stringify(_e.toJSON())}),console.log(" Split transfer complete!"),{tokenForRecipient:te,tokenForSender:ne,recipientTransferTx:_e,outboxEntryId:U,splitGroupId:F}}async createAndVerifyToken(u,g,v,b){const w=await UnmaskedPredicate.create(u.tokenId,v,g,HashAlgorithm.SHA256,u.salt),E=new TokenState(w,null),S=await Token$1.mint(this.trustBase,E,u.commitment.toTransaction(u.inclusionProof)),A=await S.verify(this.trustBase);if(!A.isSuccessful)throw console.error(`Verification failed for ${b}`,A),new Error(`Token verification failed: ${A}`);return S}}class TokenSplitCalculator{async calculateOptimalSplit(u,g,v){console.log(` Calculating split for ${g} of ${v}`);const b=[];for(const R of u)if(R.coinId===v&&R.status==="CONFIRMED"&&R.jsonData)try{const T=JSON.parse(R.jsonData),O=await Token$1.fromJSON(T),B=this.getRealAmountFromSdk(O);if(B<=0n){console.warn(`Token ${R.id} has 0 balance in SDK structure.`);continue}console.log(B),b.push({sdkToken:O,amount:B,uiToken:R})}catch(T){console.warn("Failed to parse candidate token",R.id,T)}b.sort((R,T)=>R.amount<T.amount?-1:1);const w=b.reduce((R,T)=>R+T.amount,0n);if(w<g)return console.error(`Insufficient funds. Available: ${w}, Required: ${g}`),null;const E=b.find(R=>R.amount===g);if(E)return console.log(" Found exact match token"),this.createDirectPlan([E],g,v);const S=Math.min(5,b.length);for(let R=2;R<=S;R++){const T=this.findCombinationOfSize(b,g,R);if(T)return console.log(` Found exact combination of ${R} tokens`),this.createDirectPlan(T,g,v)}const A=[];let $=0n;for(const R of b){const T=$+R.amount;if(T===g)return A.push(R),this.createDirectPlan(A,g,v);if(T<g)A.push(R),$=T;else{const O=g-$,B=R.amount-O;return console.log(` Splitting required. Remainder: ${B}`),{tokensToTransferDirectly:A,tokenToSplit:R,splitAmount:O,remainderAmount:B,totalTransferAmount:g,coinId:v,requiresSplit:!0}}}return null}getRealAmountFromSdk(u){try{const v=u.coins;if(v&&v.coins){const b=v.coins;let w=null;const E=b[0];if(Array.isArray(E)&&E.length===2&&(w=E[1]),Array.isArray(w))return BigInt(w[1]?.toString()||"0");if(w)return BigInt(w.toString())}}catch(g){console.error("Error extracting amount from SDK token",g)}return 0n}createDirectPlan(u,g,v){return{tokensToTransferDirectly:u,tokenToSplit:null,splitAmount:null,remainderAmount:null,totalTransferAmount:g,coinId:v,requiresSplit:!1}}findCombinationOfSize(u,g,v){const b=this.generateCombinations(u,v);for(const w of b)if(w.reduce((S,A)=>S+A.amount,0n)===g)return w;return null}*generateCombinations(u,g,v=0,b=[]){if(g===0){yield b;return}for(let w=v;w<u.length;w++)yield*this.generateCombinations(u,g-1,w+1,[...b,u[w]])}}const connectionSymbol=Symbol.for("@libp2p/connection"),contentRoutingSymbol=Symbol.for("@libp2p/content-routing");let AbortError$6=class extends Error{static name="AbortError";constructor(u="The operation was aborted"){super(u),this.name="AbortError"}};class UnexpectedPeerError extends Error{static name="UnexpectedPeerError";constructor(u="Unexpected Peer"){super(u),this.name="UnexpectedPeerError"}}let InvalidCryptoExchangeError$1=class extends Error{static name="InvalidCryptoExchangeError";constructor(u="Invalid crypto exchange"){super(u),this.name="InvalidCryptoExchangeError"}},InvalidParametersError$1=class extends Error{static name="InvalidParametersError";constructor(u="Invalid parameters"){super(u),this.name="InvalidParametersError"}};class InvalidPublicKeyError extends Error{static name="InvalidPublicKeyError";constructor(u="Invalid public key"){super(u),this.name="InvalidPublicKeyError"}}class InvalidPrivateKeyError extends Error{static name="InvalidPrivateKeyError";constructor(u="Invalid private key"){super(u),this.name="InvalidPrivateKeyError"}}class UnsupportedOperationError extends Error{static name="UnsupportedOperationError";constructor(u="Unsupported operation"){super(u),this.name="UnsupportedOperationError"}}class ConnectionClosedError extends Error{static name="ConnectionClosedError";constructor(u="The connection is closed"){super(u),this.name="ConnectionClosedError"}}class ConnectionFailedError extends Error{static name="ConnectionFailedError";constructor(u="Connection failed"){super(u),this.name="ConnectionFailedError"}}class MuxerClosedError extends Error{static name="MuxerClosedError";constructor(u="The muxer is closed"){super(u),this.name="MuxerClosedError"}}class StreamResetError extends Error{static name="StreamResetError";constructor(u="The stream has been reset"){super(u),this.name="StreamResetError"}}class StreamStateError extends Error{static name="StreamStateError";constructor(u="The stream is in an invalid state"){super(u),this.name="StreamStateError"}}class StreamBufferError extends Error{static name="StreamBufferError";constructor(u="The stream buffer was full"){super(u),this.name="StreamBufferError"}}let NotFoundError$1=class extends Error{static name="NotFoundError";constructor(u="Not found"){super(u),this.name="NotFoundError"}};class InvalidPeerIdError extends Error{static name="InvalidPeerIdError";constructor(u="Invalid PeerID"){super(u),this.name="InvalidPeerIdError"}}let InvalidMultiaddrError$1=class extends Error{static name="InvalidMultiaddrError";constructor(u="Invalid multiaddr"){super(u),this.name="InvalidMultiaddrError"}};class InvalidCIDError extends Error{static name="InvalidCIDError";constructor(u="Invalid CID"){super(u),this.name="InvalidCIDError"}}class InvalidMultihashError extends Error{static name="InvalidMultihashError";constructor(u="Invalid Multihash"){super(u),this.name="InvalidMultihashError"}}class UnsupportedProtocolError extends Error{static name="UnsupportedProtocolError";constructor(u="Unsupported protocol error"){super(u),this.name="UnsupportedProtocolError"}}class InvalidMessageError extends Error{static name="InvalidMessageError";constructor(u="Invalid message"){super(u),this.name="InvalidMessageError"}}let ProtocolError$1=class extends Error{static name="ProtocolError";constructor(u="Protocol error"){super(u),this.name="ProtocolError"}},TimeoutError$2=class extends Error{static name="TimeoutError";constructor(u="Timed out"){super(u),this.name="TimeoutError"}};class NotStartedError extends Error{static name="NotStartedError";constructor(u="Not started"){super(u),this.name="NotStartedError"}}class DialError extends Error{static name="DialError";constructor(u="Dial error"){super(u),this.name="DialError"}}class ListenError extends Error{static name="ListenError";constructor(u="Listen error"){super(u),this.name="ListenError"}}class LimitedConnectionError extends Error{static name="LimitedConnectionError";constructor(u="Limited connection"){super(u),this.name="LimitedConnectionError"}}class TooManyInboundProtocolStreamsError extends Error{static name="TooManyInboundProtocolStreamsError";constructor(u="Too many inbound protocol streams"){super(u),this.name="TooManyInboundProtocolStreamsError"}}class TooManyOutboundProtocolStreamsError extends Error{static name="TooManyOutboundProtocolStreamsError";constructor(u="Too many outbound protocol streams"){super(u),this.name="TooManyOutboundProtocolStreamsError"}}class UnsupportedKeyTypeError extends Error{static name="UnsupportedKeyTypeError";constructor(u="Unsupported key type"){super(u),this.name="UnsupportedKeyTypeError"}}class StreamMessageEvent extends Event{data;constructor(u,g){super("message",g),this.data=u}}class StreamCloseEvent extends Event{error;local;constructor(u,g,v){super("close",v),this.error=g,this.local=u}}class StreamAbortEvent extends StreamCloseEvent{constructor(u,g){super(!0,u,g)}}class StreamResetEvent extends StreamCloseEvent{constructor(u,g){super(!1,u,g)}}const peerDiscoverySymbol=Symbol.for("@libp2p/peer-discovery"),peerIdSymbol=Symbol.for("@libp2p/peer-id");function isPeerId(y){return!!y?.[peerIdSymbol]}const peerRoutingSymbol=Symbol.for("@libp2p/peer-routing"),KEEP_ALIVE="keep-alive";function isStartable(y){return y!=null&&typeof y.start=="function"&&typeof y.stop=="function"}async function start(...y){const u=[];for(const g of y)isStartable(g)&&u.push(g);await Promise.all(u.map(async g=>{g.beforeStart!=null&&await g.beforeStart()})),await Promise.all(u.map(async g=>{await g.start()})),await Promise.all(u.map(async g=>{g.afterStart!=null&&await g.afterStart()}))}async function stop(...y){const u=[];for(const g of y)isStartable(g)&&u.push(g);await Promise.all(u.map(async g=>{g.beforeStop!=null&&await g.beforeStop()})),await Promise.all(u.map(async g=>{await g.stop()})),await Promise.all(u.map(async g=>{g.afterStop!=null&&await g.afterStop()}))}const transportSymbol=Symbol.for("@libp2p/transport");var FaultTolerance;(function(y){y[y.FATAL_ALL=0]="FATAL_ALL",y[y.NO_FATAL=1]="NO_FATAL"})(FaultTolerance||(FaultTolerance={}));function setMaxListeners(){}class TypedEventEmitter extends EventTarget{#e=new Map;constructor(){super()}listenerCount(u){const g=this.#e.get(u);return g==null?0:g.length}addEventListener(u,g,v){super.addEventListener(u,g,v);let b=this.#e.get(u);b==null&&(b=[],this.#e.set(u,b)),b.push({callback:g,once:(v!==!0&&v!==!1&&v?.once)??!1})}removeEventListener(u,g,v){super.removeEventListener(u.toString(),g??null,v);let b=this.#e.get(u);b!=null&&(b=b.filter(({callback:w})=>w!==g),this.#e.set(u,b))}dispatchEvent(u){const g=super.dispatchEvent(u);let v=this.#e.get(u.type);return v==null||(v=v.filter(({once:b})=>!b),this.#e.set(u.type,v)),g}safeDispatchEvent(u,g={}){return this.dispatchEvent(new CustomEvent(u,g))}}const serviceCapabilities=Symbol.for("@libp2p/service-capabilities"),serviceDependencies=Symbol.for("@libp2p/service-dependencies");function equals$2(y,u){if(y===u)return!0;if(y.byteLength!==u.byteLength)return!1;for(let g=0;g<y.byteLength;g++)if(y[g]!==u[g])return!1;return!0}function coerce(y){if(y instanceof Uint8Array&&y.constructor.name==="Uint8Array")return y;if(y instanceof ArrayBuffer)return new Uint8Array(y);if(ArrayBuffer.isView(y))return new Uint8Array(y.buffer,y.byteOffset,y.byteLength);throw new Error("Unknown type, must be binary type")}function fromString$2(y){return new TextEncoder().encode(y)}function toString$4(y){return new TextDecoder().decode(y)}function base(y,u){if(y.length>=255)throw new TypeError("Alphabet too long");for(var g=new Uint8Array(256),v=0;v<g.length;v++)g[v]=255;for(var b=0;b<y.length;b++){var w=y.charAt(b),E=w.charCodeAt(0);if(g[E]!==255)throw new TypeError(w+" is ambiguous");g[E]=b}var S=y.length,A=y.charAt(0),$=Math.log(S)/Math.log(256),R=Math.log(256)/Math.log(S);function T(F){if(F instanceof Uint8Array||(ArrayBuffer.isView(F)?F=new Uint8Array(F.buffer,F.byteOffset,F.byteLength):Array.isArray(F)&&(F=Uint8Array.from(F))),!(F instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(F.length===0)return"";for(var U=0,q=0,J=0,ie=F.length;J!==ie&&F[J]===0;)J++,U++;for(var oe=(ie-J)*R+1>>>0,le=new Uint8Array(oe);J!==ie;){for(var de=F[J],fe=0,ye=oe-1;(de!==0||fe<q)&&ye!==-1;ye--,fe++)de+=256*le[ye]>>>0,le[ye]=de%S>>>0,de=de/S>>>0;if(de!==0)throw new Error("Non-zero carry");q=fe,J++}for(var we=oe-q;we!==oe&&le[we]===0;)we++;for(var pe=A.repeat(U);we<oe;++we)pe+=y.charAt(le[we]);return pe}function O(F){if(typeof F!="string")throw new TypeError("Expected String");if(F.length===0)return new Uint8Array;var U=0;if(F[U]!==" "){for(var q=0,J=0;F[U]===A;)q++,U++;for(var ie=(F.length-U)*$+1>>>0,oe=new Uint8Array(ie);F[U];){var le=g[F.charCodeAt(U)];if(le===255)return;for(var de=0,fe=ie-1;(le!==0||de<J)&&fe!==-1;fe--,de++)le+=S*oe[fe]>>>0,oe[fe]=le%256>>>0,le=le/256>>>0;if(le!==0)throw new Error("Non-zero carry");J=de,U++}if(F[U]!==" "){for(var ye=ie-J;ye!==ie&&oe[ye]===0;)ye++;for(var we=new Uint8Array(q+(ie-ye)),pe=q;ye!==ie;)we[pe++]=oe[ye++];return we}}}function B(F){var U=O(F);if(U)return U;throw new Error(`Non-${u} character`)}return{encode:T,decodeUnsafe:O,decode:B}}var src=base,_brrp__multiformats_scope_baseX=src;let Encoder$1=class{name;prefix;baseEncode;constructor(u,g,v){this.name=u,this.prefix=g,this.baseEncode=v}encode(u){if(u instanceof Uint8Array)return`${this.prefix}${this.baseEncode(u)}`;throw Error("Unknown type, must be binary type")}},Decoder$2=class{name;prefix;baseDecode;prefixCodePoint;constructor(u,g,v){this.name=u,this.prefix=g;const b=g.codePointAt(0);if(b===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=b,this.baseDecode=v}decode(u){if(typeof u=="string"){if(u.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(u)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(u.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(u){return or$1(this,u)}};class ComposedDecoder{decoders;constructor(u){this.decoders=u}or(u){return or$1(this,u)}decode(u){const g=u[0],v=this.decoders[g];if(v!=null)return v.decode(u);throw RangeError(`Unable to decode multibase string ${JSON.stringify(u)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function or$1(y,u){return new ComposedDecoder({...y.decoders??{[y.prefix]:y},...u.decoders??{[u.prefix]:u}})}class Codec{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(u,g,v,b){this.name=u,this.prefix=g,this.baseEncode=v,this.baseDecode=b,this.encoder=new Encoder$1(u,g,v),this.decoder=new Decoder$2(u,g,b)}encode(u){return this.encoder.encode(u)}decode(u){return this.decoder.decode(u)}}function from$1({name:y,prefix:u,encode:g,decode:v}){return new Codec(y,u,g,v)}function baseX({name:y,prefix:u,alphabet:g}){const{encode:v,decode:b}=_brrp__multiformats_scope_baseX(g,y);return from$1({prefix:u,name:y,encode:v,decode:w=>coerce(b(w))})}function decode$e(y,u,g,v){let b=y.length;for(;y[b-1]==="=";)--b;const w=new Uint8Array(b*g/8|0);let E=0,S=0,A=0;for(let $=0;$<b;++$){const R=u[y[$]];if(R===void 0)throw new SyntaxError(`Non-${v} character`);S=S<<g|R,E+=g,E>=8&&(E-=8,w[A++]=255&S>>E)}if(E>=g||(255&S<<8-E)!==0)throw new SyntaxError("Unexpected end of data");return w}function encode$f(y,u,g){const v=u[u.length-1]==="=",b=(1<<g)-1;let w="",E=0,S=0;for(let A=0;A<y.length;++A)for(S=S<<8|y[A],E+=8;E>g;)E-=g,w+=u[b&S>>E];if(E!==0&&(w+=u[b&S<<g-E]),v)for(;(w.length*g&7)!==0;)w+="=";return w}function createAlphabetIdx(y){const u={};for(let g=0;g<y.length;++g)u[y[g]]=g;return u}function rfc4648({name:y,prefix:u,bitsPerChar:g,alphabet:v}){const b=createAlphabetIdx(v);return from$1({prefix:u,name:y,encode(w){return encode$f(w,v,g)},decode(w){return decode$e(w,b,g,y)}})}const base32=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$1=Object.freeze(Object.defineProperty({__proto__:null,base32,base32hex,base32hexpad,base32hexpadupper,base32hexupper,base32pad,base32padupper,base32upper,base32z},Symbol.toStringTag,{value:"Module"})),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58=Object.freeze(Object.defineProperty({__proto__:null,base58btc,base58flickr},Symbol.toStringTag,{value:"Module"})),base64$1=rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$1=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$2=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$1,base64pad,base64url:base64url$1,base64urlpad},Symbol.toStringTag,{value:"Module"})),e=1e3,t=e*60,n$1=t*60,r=n$1*24,i=r*7,a=r*365.25,o=a/12;function s(y,u){if(typeof y=="string")return l(y);if(typeof y=="number")return p(y,u);throw Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(y)}`)}var c=s;function l(y){if(typeof y!="string"||y.length===0||y.length>100)throw Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(y)}`);let u=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(y);if(!u?.groups)return NaN;let{value:g,unit:v="ms"}=u.groups,b=parseFloat(g),w=v.toLowerCase();switch(w){case"years":case"year":case"yrs":case"yr":case"y":return b*a;case"months":case"month":case"mo":return b*o;case"weeks":case"week":case"w":return b*i;case"days":case"day":case"d":return b*r;case"hours":case"hour":case"hrs":case"hr":case"h":return b*n$1;case"minutes":case"minute":case"mins":case"min":case"m":return b*t;case"seconds":case"second":case"secs":case"sec":case"s":return b*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return b;default:throw Error(`Unknown unit "${w}" provided to ms.parse(). value=${JSON.stringify(y)}`)}}function d(y){let u=Math.abs(y);return u>=a?`${Math.round(y/a)}y`:u>=o?`${Math.round(y/o)}mo`:u>=i?`${Math.round(y/i)}w`:u>=r?`${Math.round(y/r)}d`:u>=n$1?`${Math.round(y/n$1)}h`:u>=t?`${Math.round(y/t)}m`:u>=e?`${Math.round(y/e)}s`:`${y}ms`}function f(y){let u=Math.abs(y);return u>=a?m(y,u,a,"year"):u>=o?m(y,u,o,"month"):u>=i?m(y,u,i,"week"):u>=r?m(y,u,r,"day"):u>=n$1?m(y,u,n$1,"hour"):u>=t?m(y,u,t,"minute"):u>=e?m(y,u,e,"second"):`${y} ms`}function p(y,u){if(typeof y!="number"||!Number.isFinite(y))throw Error("Value provided to ms.format() must be of type number.");return u?.long?f(y):d(y)}function m(y,u,g,v){let b=u>=g*1.5;return`${Math.round(y/g)} ${v}${b?"s":""}`}function setup(y){g.debug=g,g.default=g,g.coerce=A,g.disable=w,g.enable=b,g.enabled=E,g.humanize=c,g.destroy=$,Object.keys(y).forEach(R=>{g[R]=y[R]}),g.names=[],g.skips=[],g.formatters={};function u(R){let T=0;for(let O=0;O<R.length;O++)T=(T<<5)-T+R.charCodeAt(O),T|=0;return g.colors[Math.abs(T)%g.colors.length]}g.selectColor=u;function g(R,T){let O,B=null,F,U;function q(...J){if(!q.enabled)return;const ie=q,oe=Number(new Date),le=oe-(O||oe);ie.diff=le,ie.prev=O,ie.curr=oe,O=oe,J[0]=g.coerce(J[0]),typeof J[0]!="string"&&J.unshift("%O");let de=0;J[0]=J[0].replace(/%([a-zA-Z%])/g,(ye,we)=>{if(ye==="%%")return"%";de++;const pe=g.formatters[we];if(typeof pe=="function"){const ve=J[de];ye=pe.call(ie,ve),J.splice(de,1),de--}return ye}),g.formatArgs.call(ie,J),T?.onLog!=null&&T.onLog(...J),(ie.log||g.log).apply(ie,J)}return q.namespace=R,q.useColors=g.useColors(),q.color=g.selectColor(R),q.extend=v,q.destroy=g.destroy,Object.defineProperty(q,"enabled",{enumerable:!0,configurable:!1,get:()=>B!==null?B:(F!==g.namespaces&&(F=g.namespaces,U=g.enabled(R)),U),set:J=>{B=J}}),typeof g.init=="function"&&g.init(q),q}function v(R,T){const O=g(this.namespace+(typeof T>"u"?":":T)+R);return O.log=this.log,O}function b(R){g.save(R),g.namespaces=R,g.names=[],g.skips=[];let T;const O=(typeof R=="string"?R:"").split(/[\s,]+/),B=O.length;for(T=0;T<B;T++)O[T]&&(R=O[T].replace(/\*/g,".*?"),R[0]==="-"?g.skips.push(new RegExp("^"+R.substr(1)+"$")):g.names.push(new RegExp("^"+R+"$")))}function w(){const R=[...g.names.map(S),...g.skips.map(S).map(T=>"-"+T)].join(",");return g.enable(""),R}function E(R){if(R[R.length-1]==="*")return!0;let T,O;for(T=0,O=g.skips.length;T<O;T++)if(g.skips[T].test(R))return!1;for(T=0,O=g.names.length;T<O;T++)if(g.names[T].test(R))return!0;return!1}function S(R){return R.toString().substring(2,R.toString().length-2).replace(/\.\*\?$/,"*")}function A(R){return R instanceof Error?R.stack??R.message:R}function $(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return g.setupFormatters(g.formatters),g.enable(g.load()),g}var define_globalThis_process_env_default$2={};const storage=localstorage(),colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function useColors(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)!=null?!1:typeof document<"u"&&document.documentElement?.style?.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/)}function formatArgs(y){if(y[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+y[0]+(this.useColors?"%c ":" ")+"+"+c(this.diff),!this.useColors)return;const u="color: "+this.color;y.splice(1,0,u,"color: inherit");let g=0,v=0;y[0].replace(/%[a-zA-Z%]/g,b=>{b!=="%%"&&(g++,b==="%c"&&(v=g))}),y.splice(v,0,u)}const log$3=console.debug??console.log??(()=>{});function save(y){try{y?storage?.setItem("debug",y):storage?.removeItem("debug")}catch{}}function load(){let y;try{y=storage?.getItem("debug")}catch{}return!y&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(y=define_globalThis_process_env_default$2.DEBUG),y}function localstorage(){try{return localStorage}catch{}}function setupFormatters(y){y.j=function(u){try{return JSON.stringify(u)}catch(g){return"[UnexpectedJSONParseError]: "+g.message}}}const weald=setup({formatArgs,save,load,useColors,setupFormatters,colors,storage,log:log$3});weald.formatters.b=y=>y==null?"undefined":base58btc.baseEncode(y);weald.formatters.t=y=>y==null?"undefined":base32.baseEncode(y);weald.formatters.m=y=>y==null?"undefined":base64$1.baseEncode(y);weald.formatters.p=y=>y==null?"undefined":y.toString();weald.formatters.c=y=>y==null?"undefined":y.toString();weald.formatters.k=y=>y==null?"undefined":y.toString();weald.formatters.a=y=>y==null?"undefined":y.toString();function formatError$1(y,u=""){const g=notEmpty(y.message),v=notEmpty(y.stack);return g!=null&&v!=null?v.includes(g)?`${v.split(`
`).join(`
${u}`)}`:`${g}
${u}${v.split(`
`).join(`
${u}`)}`:v!=null?`${v.split(`
`).join(`
${u}`)}`:g!=null?`${g}`:`${y.toString()}`}function isAggregateError(y){return y instanceof AggregateError||y?.name==="AggregateError"&&Array.isArray(y.errors)}function printError(y,u=""){if(isAggregateError(y)){let g=formatError$1(y,u);return y.errors.length>0?(u=`${u}    `,g+=`
${u}${y.errors.map(v=>`${printError(v,`${u}`)}`).join(`
${u}`)}`):g+=`
${u}[Error list was empty]`,g.trim()}return formatError$1(y,u)}weald.formatters.e=y=>y==null?"undefined":printError(y);function createDisabledLogger(y){const u=()=>{};return u.enabled=!1,u.color="",u.diff=0,u.log=()=>{},u.namespace=y,u.destroy=()=>!0,u.extend=()=>u,u}function defaultLogger(y){return{forComponent(u){return logger$7(u,y)}}}function logger$7(y,u){let g=createDisabledLogger(`${y}:trace`);return weald.enabled(`${y}:trace`)&&weald.names.map(v=>v.toString()).find(v=>v.includes(":trace"))!=null&&(g=weald(`${y}:trace`,u)),Object.assign(weald(y,u),{error:weald(`${y}:error`,u),trace:g,newScope:v=>logger$7(`${y}:${v}`,u)})}function notEmpty(y){if(y!=null&&(y=y.trim(),y.length!==0))return y}class CustomProgressEvent extends Event{type;detail;constructor(u,g){super(u),this.type=u,this.detail=g}}var eventemitter3={exports:{}},hasRequiredEventemitter3;function requireEventemitter3(){return hasRequiredEventemitter3||(hasRequiredEventemitter3=1,(function(y){var u=Object.prototype.hasOwnProperty,g="~";function v(){}Object.create&&(v.prototype=Object.create(null),new v().__proto__||(g=!1));function b(A,$,R){this.fn=A,this.context=$,this.once=R||!1}function w(A,$,R,T,O){if(typeof R!="function")throw new TypeError("The listener must be a function");var B=new b(R,T||A,O),F=g?g+$:$;return A._events[F]?A._events[F].fn?A._events[F]=[A._events[F],B]:A._events[F].push(B):(A._events[F]=B,A._eventsCount++),A}function E(A,$){--A._eventsCount===0?A._events=new v:delete A._events[$]}function S(){this._events=new v,this._eventsCount=0}S.prototype.eventNames=function(){var $=[],R,T;if(this._eventsCount===0)return $;for(T in R=this._events)u.call(R,T)&&$.push(g?T.slice(1):T);return Object.getOwnPropertySymbols?$.concat(Object.getOwnPropertySymbols(R)):$},S.prototype.listeners=function($){var R=g?g+$:$,T=this._events[R];if(!T)return[];if(T.fn)return[T.fn];for(var O=0,B=T.length,F=new Array(B);O<B;O++)F[O]=T[O].fn;return F},S.prototype.listenerCount=function($){var R=g?g+$:$,T=this._events[R];return T?T.fn?1:T.length:0},S.prototype.emit=function($,R,T,O,B,F){var U=g?g+$:$;if(!this._events[U])return!1;var q=this._events[U],J=arguments.length,ie,oe;if(q.fn){switch(q.once&&this.removeListener($,q.fn,void 0,!0),J){case 1:return q.fn.call(q.context),!0;case 2:return q.fn.call(q.context,R),!0;case 3:return q.fn.call(q.context,R,T),!0;case 4:return q.fn.call(q.context,R,T,O),!0;case 5:return q.fn.call(q.context,R,T,O,B),!0;case 6:return q.fn.call(q.context,R,T,O,B,F),!0}for(oe=1,ie=new Array(J-1);oe<J;oe++)ie[oe-1]=arguments[oe];q.fn.apply(q.context,ie)}else{var le=q.length,de;for(oe=0;oe<le;oe++)switch(q[oe].once&&this.removeListener($,q[oe].fn,void 0,!0),J){case 1:q[oe].fn.call(q[oe].context);break;case 2:q[oe].fn.call(q[oe].context,R);break;case 3:q[oe].fn.call(q[oe].context,R,T);break;case 4:q[oe].fn.call(q[oe].context,R,T,O);break;default:if(!ie)for(de=1,ie=new Array(J-1);de<J;de++)ie[de-1]=arguments[de];q[oe].fn.apply(q[oe].context,ie)}}return!0},S.prototype.on=function($,R,T){return w(this,$,R,T,!1)},S.prototype.once=function($,R,T){return w(this,$,R,T,!0)},S.prototype.removeListener=function($,R,T,O){var B=g?g+$:$;if(!this._events[B])return this;if(!R)return E(this,B),this;var F=this._events[B];if(F.fn)F.fn===R&&(!O||F.once)&&(!T||F.context===T)&&E(this,B);else{for(var U=0,q=[],J=F.length;U<J;U++)(F[U].fn!==R||O&&!F[U].once||T&&F[U].context!==T)&&q.push(F[U]);q.length?this._events[B]=q.length===1?q[0]:q:E(this,B)}return this},S.prototype.removeAllListeners=function($){var R;return $?(R=g?g+$:$,this._events[R]&&E(this,R)):(this._events=new v,this._eventsCount=0),this},S.prototype.off=S.prototype.removeListener,S.prototype.addListener=S.prototype.on,S.prefixed=g,S.EventEmitter=S,y.exports=S})(eventemitter3)),eventemitter3.exports}var eventemitter3Exports=requireEventemitter3();const EventEmitter=getDefaultExportFromCjs$3(eventemitter3Exports);let TimeoutError$1=class lh extends Error{name="TimeoutError";constructor(u,g){super(u,g),Error.captureStackTrace?.(this,lh)}};const getAbortedReason$1=y=>y.reason??new DOMException("This operation was aborted.","AbortError");function pTimeout$1(y,u){const{milliseconds:g,fallback:v,message:b,customTimers:w={setTimeout,clearTimeout},signal:E}=u;let S,A;const R=new Promise((T,O)=>{if(typeof g!="number"||Math.sign(g)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${g}\``);if(E?.aborted){O(getAbortedReason$1(E));return}if(E&&(A=()=>{O(getAbortedReason$1(E))},E.addEventListener("abort",A,{once:!0})),y.then(T,O),g===Number.POSITIVE_INFINITY)return;const B=new TimeoutError$1;S=w.setTimeout.call(void 0,()=>{if(v){try{T(v())}catch(F){O(F)}return}typeof y.cancel=="function"&&y.cancel(),b===!1?T():b instanceof Error?O(b):(B.message=b??`Promise timed out after ${g} milliseconds`,O(B))},g)}).finally(()=>{R.clear(),A&&E&&E.removeEventListener("abort",A)});return R.clear=()=>{w.clearTimeout.call(void 0,S),S=void 0},R}function lowerBound(y,u,g){let v=0,b=y.length;for(;b>0;){const w=Math.trunc(b/2);let E=v+w;g(y[E],u)<=0?(v=++E,b-=w+1):b=w}return v}let PriorityQueue$1=class{#e=[];enqueue(u,g){const{priority:v=0,id:b}=g??{},w={priority:v,id:b,run:u};if(this.size===0||this.#e[this.size-1].priority>=v){this.#e.push(w);return}const E=lowerBound(this.#e,w,(S,A)=>A.priority-S.priority);this.#e.splice(E,0,w)}setPriority(u,g){const v=this.#e.findIndex(w=>w.id===u);if(v===-1)throw new ReferenceError(`No promise function with the id "${u}" exists in the queue.`);const[b]=this.#e.splice(v,1);this.enqueue(b.run,{priority:g,id:u})}dequeue(){return this.#e.shift()?.run}filter(u){return this.#e.filter(g=>g.priority===u.priority).map(g=>g.run)}get size(){return this.#e.length}};class PQueue extends EventEmitter{#e;#t;#r=0;#i;#n=!1;#o=!1;#a;#c=0;#g=0;#u;#f;#s;#p;#l=0;#h;#d;#v=1n;#m=new Map;timeout;constructor(u){if(super(),u={carryoverIntervalCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:PriorityQueue$1,...u},!(typeof u.intervalCap=="number"&&u.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${u.intervalCap?.toString()??""}\` (${typeof u.intervalCap})`);if(u.interval===void 0||!(Number.isFinite(u.interval)&&u.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${u.interval?.toString()??""}\` (${typeof u.interval})`);if(this.#e=u.carryoverIntervalCount??u.carryoverConcurrencyCount??!1,this.#t=u.intervalCap===Number.POSITIVE_INFINITY||u.interval===0,this.#i=u.intervalCap,this.#a=u.interval,this.#s=new u.queueClass,this.#p=u.queueClass,this.concurrency=u.concurrency,u.timeout!==void 0&&!(Number.isFinite(u.timeout)&&u.timeout>0))throw new TypeError(`Expected \`timeout\` to be a positive finite number, got \`${u.timeout}\` (${typeof u.timeout})`);this.timeout=u.timeout,this.#d=u.autoStart===!1,this.#N()}get#b(){return this.#t||this.#r<this.#i}get#x(){return this.#l<this.#h}#w(){this.#l--,this.#l===0&&this.emit("pendingZero"),this.#C(),this.emit("next")}#E(){this.#k(),this.#T(),this.#f=void 0}get#_(){const u=Date.now();if(this.#u===void 0){const g=this.#c-u;if(g<0){if(this.#g>0){const v=u-this.#g;if(v<this.#a)return this.#S(this.#a-v),!0}this.#r=this.#e?this.#l:0}else return this.#S(g),!0}return!1}#S(u){this.#f===void 0&&(this.#f=setTimeout(()=>{this.#E()},u))}#R(){this.#u&&(clearInterval(this.#u),this.#u=void 0)}#P(){this.#f&&(clearTimeout(this.#f),this.#f=void 0)}#C(){if(this.#s.size===0)return this.#R(),this.emit("empty"),this.#l===0&&(this.#P(),this.emit("idle")),!1;let u=!1;if(!this.#d){const g=!this.#_;if(this.#b&&this.#x){const v=this.#s.dequeue();this.#t||(this.#r++,this.#A()),this.emit("active"),this.#g=Date.now(),v(),g&&this.#T(),u=!0}}return u}#T(){this.#t||this.#u!==void 0||(this.#u=setInterval(()=>{this.#k()},this.#a),this.#c=Date.now()+this.#a)}#k(){this.#r===0&&this.#l===0&&this.#u&&this.#R(),this.#r=this.#e?this.#l:0,this.#$(),this.#A()}#$(){for(;this.#C(););}get concurrency(){return this.#h}set concurrency(u){if(!(typeof u=="number"&&u>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${u}\` (${typeof u})`);this.#h=u,this.#$()}setPriority(u,g){if(typeof g!="number"||!Number.isFinite(g))throw new TypeError(`Expected \`priority\` to be a finite number, got \`${g}\` (${typeof g})`);this.#s.setPriority(u,g)}async add(u,g={}){return g.id??=(this.#v++).toString(),g={timeout:this.timeout,...g},new Promise((v,b)=>{const w=Symbol(`task-${g.id}`);this.#s.enqueue(async()=>{this.#l++,this.#m.set(w,{id:g.id,priority:g.priority??0,startTime:Date.now(),timeout:g.timeout});let E;try{try{g.signal?.throwIfAborted()}catch($){throw this.#t||this.#r--,this.#m.delete(w),$}let S=u({signal:g.signal});if(g.timeout&&(S=pTimeout$1(Promise.resolve(S),{milliseconds:g.timeout,message:`Task timed out after ${g.timeout}ms (queue has ${this.#l} running, ${this.#s.size} waiting)`})),g.signal){const{signal:$}=g;S=Promise.race([S,new Promise((R,T)=>{E=()=>{T($.reason)},$.addEventListener("abort",E,{once:!0})})])}const A=await S;v(A),this.emit("completed",A)}catch(S){b(S),this.emit("error",S)}finally{E&&g.signal?.removeEventListener("abort",E),this.#m.delete(w),queueMicrotask(()=>{this.#w()})}},g),this.emit("add"),this.#C()})}async addAll(u,g){return Promise.all(u.map(async v=>this.add(v,g)))}start(){return this.#d?(this.#d=!1,this.#$(),this):this}pause(){this.#d=!0}clear(){this.#s=new this.#p,this.#I()}async onEmpty(){this.#s.size!==0&&await this.#y("empty")}async onSizeLessThan(u){this.#s.size<u||await this.#y("next",()=>this.#s.size<u)}async onIdle(){this.#l===0&&this.#s.size===0||await this.#y("idle")}async onPendingZero(){this.#l!==0&&await this.#y("pendingZero")}async onRateLimit(){this.isRateLimited||await this.#y("rateLimit")}async onRateLimitCleared(){this.isRateLimited&&await this.#y("rateLimitCleared")}async onError(){return new Promise((u,g)=>{const v=b=>{this.off("error",v),g(b)};this.on("error",v)})}async#y(u,g){return new Promise(v=>{const b=()=>{g&&!g()||(this.off(u,b),v())};this.on(u,b)})}get size(){return this.#s.size}sizeBy(u){return this.#s.filter(u).length}get pending(){return this.#l}get isPaused(){return this.#d}#N(){this.#t||(this.on("add",()=>{this.#s.size>0&&this.#A()}),this.on("next",()=>{this.#A()}))}#A(){this.#t||this.#o||(this.#o=!0,queueMicrotask(()=>{this.#o=!1,this.#I()}))}#I(){const u=this.#n,g=!this.#t&&this.#r>=this.#i&&this.#s.size>0;g!==u&&(this.#n=g,this.emit(g?"rateLimit":"rateLimitCleared"))}get isRateLimited(){return this.#n}get isSaturated(){return this.#l===this.#h&&this.#s.size>0||this.isRateLimited&&this.#s.size>0}get runningTasks(){return[...this.#m.values()].map(u=>({...u}))}}function getTypes(y){const u=[RecordType.A];return y==null?u:Array.isArray(y)?y.length===0?u:y:[y]}const base10=baseX({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$1=Object.freeze(Object.defineProperty({__proto__:null,base10},Symbol.toStringTag,{value:"Module"})),base16=rfc4648({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$1=Object.freeze(Object.defineProperty({__proto__:null,base16,base16upper},Symbol.toStringTag,{value:"Module"})),base2=rfc4648({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$1=Object.freeze(Object.defineProperty({__proto__:null,base2},Symbol.toStringTag,{value:"Module"})),alphabet=Array.from(""),alphabetBytesToChars=alphabet.reduce((y,u,g)=>(y[g]=u,y),[]),alphabetCharsToBytes=alphabet.reduce((y,u,g)=>{const v=u.codePointAt(0);if(v==null)throw new Error(`Invalid character: ${u}`);return y[v]=g,y},[]);function encode$e(y){return y.reduce((u,g)=>(u+=alphabetBytesToChars[g],u),"")}function decode$d(y){const u=[];for(const g of y){const v=g.codePointAt(0);if(v==null)throw new Error(`Invalid character: ${g}`);const b=alphabetCharsToBytes[v];if(b==null)throw new Error(`Non-base256emoji character: ${g}`);u.push(b)}return new Uint8Array(u)}const base256emoji=from$1({prefix:"",name:"base256emoji",encode:encode$e,decode:decode$d}),base256emoji$1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji},Symbol.toStringTag,{value:"Module"})),base36=baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$1=Object.freeze(Object.defineProperty({__proto__:null,base36,base36upper},Symbol.toStringTag,{value:"Module"})),base8=rfc4648({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$1=Object.freeze(Object.defineProperty({__proto__:null,base8},Symbol.toStringTag,{value:"Module"})),identity$1=from$1({prefix:"\0",name:"identity",encode:y=>toString$4(y),decode:y=>fromString$2(y)}),identityBase=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$1},Symbol.toStringTag,{value:"Module"})),textEncoder$3=new TextEncoder,textDecoder$2=new TextDecoder,name$7="json",code$6=512;function encode$d(y){return textEncoder$3.encode(JSON.stringify(y))}function decode$c(y){return JSON.parse(textDecoder$2.decode(y))}const json$1=Object.freeze(Object.defineProperty({__proto__:null,code:code$6,decode:decode$c,encode:encode$d,name:name$7},Symbol.toStringTag,{value:"Module"})),name$6="raw",code$5=85;function encode$c(y){return coerce(y)}function decode$b(y){return coerce(y)}const raw=Object.freeze(Object.defineProperty({__proto__:null,code:code$5,decode:decode$b,encode:encode$c,name:name$6},Symbol.toStringTag,{value:"Module"}));var encode_1=encode$b,MSB$2=128,MSBALL=-128,INT=Math.pow(2,31);function encode$b(y,u,g){u=u||[],g=g||0;for(var v=g;y>=INT;)u[g++]=y&255|MSB$2,y/=128;for(;y&MSBALL;)u[g++]=y&255|MSB$2,y>>>=7;return u[g]=y|0,encode$b.bytes=g-v+1,u}var decode$a=read$1,MSB$1$1=128,REST$1$1=127;function read$1(y,v){var g=0,v=v||0,b=0,w=v,E,S=y.length;do{if(w>=S)throw read$1.bytes=0,new RangeError("Could not decode varint");E=y[w++],g+=b<28?(E&REST$1$1)<<b:(E&REST$1$1)*Math.pow(2,b),b+=7}while(E>=MSB$1$1);return read$1.bytes=w-v,g}var N1$1=Math.pow(2,7),N2$1=Math.pow(2,14),N3$1=Math.pow(2,21),N4$1=Math.pow(2,28),N5$1=Math.pow(2,35),N6$1=Math.pow(2,42),N7$1=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length$2=function(y){return y<N1$1?1:y<N2$1?2:y<N3$1?3:y<N4$1?4:y<N5$1?5:y<N6$1?6:y<N7$1?7:y<N8?8:y<N9?9:10},varint={encode:encode_1,decode:decode$a,encodingLength:length$2},_brrp_varint=varint;function decode$9(y,u=0){return[_brrp_varint.decode(y,u),_brrp_varint.decode.bytes]}function encodeTo(y,u,g=0){return _brrp_varint.encode(y,u,g),u}function encodingLength$1(y){return _brrp_varint.encodingLength(y)}function create$5(y,u){const g=u.byteLength,v=encodingLength$1(y),b=v+encodingLength$1(g),w=new Uint8Array(b+g);return encodeTo(y,w,0),encodeTo(g,w,v),w.set(u,b),new Digest(y,g,u,w)}function decode$8(y){const u=coerce(y),[g,v]=decode$9(u),[b,w]=decode$9(u.subarray(v)),E=u.subarray(v+w);if(E.byteLength!==b)throw new Error("Incorrect length");return new Digest(g,b,E,u)}function equals$1(y,u){if(y===u)return!0;{const g=u;return y.code===g.code&&y.size===g.size&&g.bytes instanceof Uint8Array&&equals$2(y.bytes,g.bytes)}}class Digest{code;size;digest;bytes;constructor(u,g,v,b){this.code=u,this.size=g,this.digest=v,this.bytes=b}}const code$4=0,name$5="identity",encode$a=coerce;function digest(y,u){if(u?.truncate!=null&&u.truncate!==y.byteLength){if(u.truncate<0||u.truncate>y.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${y.byteLength}`);y=y.subarray(0,u.truncate)}return create$5(code$4,encode$a(y))}const identity={code:code$4,name:name$5,encode:encode$a,digest},DEFAULT_MIN_DIGEST_LENGTH=20;function from({name:y,code:u,encode:g,minDigestLength:v,maxDigestLength:b}){return new Hasher(y,u,g,v,b)}class Hasher{name;code;encode;minDigestLength;maxDigestLength;constructor(u,g,v,b,w){this.name=u,this.code=g,this.encode=v,this.minDigestLength=b??DEFAULT_MIN_DIGEST_LENGTH,this.maxDigestLength=w}digest(u,g){if(g?.truncate!=null){if(g.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&g.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(u instanceof Uint8Array){const v=this.encode(u);return v instanceof Uint8Array?createDigest(v,this.code,g?.truncate):v.then(b=>createDigest(b,this.code,g?.truncate))}else throw Error("Unknown type, must be binary type")}}function createDigest(y,u,g){if(g!=null&&g!==y.byteLength){if(g>y.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${y.byteLength}`);y=y.subarray(0,g)}return create$5(u,y)}function sha$1(y){return async u=>new Uint8Array(await crypto.subtle.digest(y,u))}const sha256$4=from({name:"sha2-256",code:18,encode:sha$1("SHA-256")}),sha512$4=from({name:"sha2-512",code:19,encode:sha$1("SHA-512")});function format$1(y,u){const{bytes:g,version:v}=y;switch(v){case 0:return toStringV0(g,baseCache(y),u??base58btc.encoder);default:return toStringV1(g,baseCache(y),u??base32.encoder)}}const cache$1=new WeakMap;function baseCache(y){const u=cache$1.get(y);if(u==null){const g=new Map;return cache$1.set(y,g),g}return u}class CID{code;version;multihash;bytes;"/";constructor(u,g,v,b){this.code=g,this.version=u,this.multihash=v,this.bytes=b,this["/"]=b}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:u,multihash:g}=this;if(u!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(g.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return CID.createV0(g)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:u,digest:g}=this.multihash,v=create$5(u,g);return CID.createV1(this.code,v)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(u){return CID.equals(this,u)}static equals(u,g){const v=g;return v!=null&&u.code===v.code&&u.version===v.version&&equals$1(u.multihash,v.multihash)}toString(u){return format$1(this,u)}toJSON(){return{"/":format$1(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(u){if(u==null)return null;const g=u;if(g instanceof CID)return g;if(g["/"]!=null&&g["/"]===g.bytes||g.asCID===g){const{version:v,code:b,multihash:w,bytes:E}=g;return new CID(v,b,w,E??encodeCID(v,b,w.bytes))}else if(g[cidSymbol]===!0){const{version:v,multihash:b,code:w}=g,E=decode$8(b);return CID.create(v,w,E)}else return null}static create(u,g,v){if(typeof g!="number")throw new Error("String codecs are no longer supported");if(!(v.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(u){case 0:{if(g!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new CID(u,g,v,v.bytes)}case 1:{const b=encodeCID(u,g,v.bytes);return new CID(u,g,v,b)}default:throw new Error("Invalid version")}}static createV0(u){return CID.create(0,DAG_PB_CODE,u)}static createV1(u,g){return CID.create(1,u,g)}static decode(u){const[g,v]=CID.decodeFirst(u);if(v.length!==0)throw new Error("Incorrect length");return g}static decodeFirst(u){const g=CID.inspectBytes(u),v=g.size-g.multihashSize,b=coerce(u.subarray(v,v+g.multihashSize));if(b.byteLength!==g.multihashSize)throw new Error("Incorrect length");const w=b.subarray(g.multihashSize-g.digestSize),E=new Digest(g.multihashCode,g.digestSize,w,b);return[g.version===0?CID.createV0(E):CID.createV1(g.codec,E),u.subarray(g.size)]}static inspectBytes(u){let g=0;const v=()=>{const[T,O]=decode$9(u.subarray(g));return g+=O,T};let b=v(),w=DAG_PB_CODE;if(b===18?(b=0,g=0):w=v(),b!==0&&b!==1)throw new RangeError(`Invalid CID version ${b}`);const E=g,S=v(),A=v(),$=g+A,R=$-E;return{version:b,codec:w,multihashCode:S,digestSize:A,multihashSize:R,size:$}}static parse(u,g){const[v,b]=parseCIDtoBytes(u,g),w=CID.decode(b);if(w.version===0&&u[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache(w).set(v,u),w}}function parseCIDtoBytes(y,u){switch(y[0]){case"Q":{const g=u??base58btc;return[base58btc.prefix,g.decode(`${base58btc.prefix}${y}`)]}case base58btc.prefix:{const g=u??base58btc;return[base58btc.prefix,g.decode(y)]}case base32.prefix:{const g=u??base32;return[base32.prefix,g.decode(y)]}case base36.prefix:{const g=u??base36;return[base36.prefix,g.decode(y)]}default:{if(u==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[y[0],u.decode(y)]}}}function toStringV0(y,u,g){const{prefix:v}=g;if(v!==base58btc.prefix)throw Error(`Cannot string encode V0 in ${g.name} encoding`);const b=u.get(v);if(b==null){const w=g.encode(y).slice(1);return u.set(v,w),w}else return b}function toStringV1(y,u,g){const{prefix:v}=g,b=u.get(v);if(b==null){const w=g.encode(y);return u.set(v,w),w}else return b}const DAG_PB_CODE=112,SHA_256_CODE=18;function encodeCID(y,u,g){const v=encodingLength$1(y),b=v+encodingLength$1(u),w=new Uint8Array(b+g.byteLength);return encodeTo(y,w,0),encodeTo(u,w,v),w.set(g,b),w}const cidSymbol=Symbol.for("@ipld/js-cid/CID"),cid=Object.freeze(Object.defineProperty({__proto__:null,CID,format:format$1},Symbol.toStringTag,{value:"Module"})),bases={...identityBase,...base2$1,...base8$1,...base10$1,...base16$1,...base32$1,...base36$1,...base58,...base64$2,...base256emoji$1};function alloc$2(y=0){return new Uint8Array(y)}function allocUnsafe(y=0){return new Uint8Array(y)}function createCodec$1(y,u,g,v){return{name:y,prefix:u,encoder:{name:y,prefix:u,encode:g},decoder:{decode:v}}}const string$2=createCodec$1("utf8","u",y=>"u"+new TextDecoder("utf8").decode(y),y=>new TextEncoder().encode(y.substring(1))),ascii=createCodec$1("ascii","a",y=>{let u="a";for(let g=0;g<y.length;g++)u+=String.fromCharCode(y[g]);return u},y=>{y=y.substring(1);const u=allocUnsafe(y.length);for(let g=0;g<y.length;g++)u[g]=y.charCodeAt(g);return u}),BASES={utf8:string$2,"utf-8":string$2,hex:bases.base16,latin1:ascii,ascii,binary:ascii,...bases};function toString$3(y,u="utf8"){const g=BASES[u];if(g==null)throw new Error(`Unsupported encoding "${u}"`);return g.encoder.encode(y).substring(1)}const DEFAULT_TTL=60;function toDNSResponse(y){return{Status:y.Status??0,TC:y.TC??y.flag_tc??!1,RD:y.RD??y.flag_rd??!1,RA:y.RA??y.flag_ra??!1,AD:y.AD??y.flag_ad??!1,CD:y.CD??y.flag_cd??!1,Question:(y.Question??y.questions??[]).map(u=>({name:u.name,type:RecordType[u.type]})),Answer:(y.Answer??y.answers??[]).map(u=>({name:u.name,type:RecordType[u.type],TTL:u.TTL??u.ttl??DEFAULT_TTL,data:u.data instanceof Uint8Array?toString$3(u.data):u.data}))}}const DEFAULT_QUERY_CONCURRENCY=4;function dnsJsonOverHttps(y,u={}){const g=new PQueue({concurrency:u.queryConcurrency??DEFAULT_QUERY_CONCURRENCY});return async(v,b={})=>{const w=new URLSearchParams;w.set("name",v),getTypes(b.types).forEach(S=>{w.append("type",RecordType[S])}),b.onProgress?.(new CustomProgressEvent("dns:query",v));const E=await g.add(async()=>{const S=await fetch(`${y}?${w}`,{headers:{accept:"application/dns-json"},signal:b?.signal});if(S.status!==200)throw new Error(`Unexpected HTTP status: ${S.status} - ${S.statusText}`);const A=toDNSResponse(await S.json());return b.onProgress?.(new CustomProgressEvent("dns:response",A)),A},{signal:b.signal});if(E==null)throw new Error("No DNS response received");return E}}function defaultResolver(){return[dnsJsonOverHttps("https://cloudflare-dns.com/dns-query"),dnsJsonOverHttps("https://dns.google/resolve")]}var hashlru$1,hasRequiredHashlru;function requireHashlru(){return hasRequiredHashlru||(hasRequiredHashlru=1,hashlru$1=function(y){if(!y)throw Error("hashlru must have a max value, of type number, greater than 0");var u=0,g=Object.create(null),v=Object.create(null);function b(w,E){g[w]=E,u++,u>=y&&(u=0,v=g,g=Object.create(null))}return{has:function(w){return g[w]!==void 0||v[w]!==void 0},remove:function(w){g[w]!==void 0&&(g[w]=void 0),v[w]!==void 0&&(v[w]=void 0)},get:function(w){var E=g[w];if(E!==void 0)return E;if((E=v[w])!==void 0)return b(w,E),E},set:function(w,E){g[w]!==void 0?g[w]=E:b(w,E)},clear:function(){g=Object.create(null),v=Object.create(null)}}}),hashlru$1}var hashlruExports=requireHashlru();const hashlru=getDefaultExportFromCjs$3(hashlruExports);class CachedAnswers{lru;constructor(u){this.lru=hashlru(u)}get(u,g){let v=!0;const b=[];for(const w of g){const E=this.getAnswers(u,w);if(E.length===0){v=!1;break}b.push(...E)}if(v)return toDNSResponse({answers:b})}getAnswers(u,g){const v=`${u.toLowerCase()}-${g}`,b=this.lru.get(v);if(b!=null){const w=b.filter(E=>E.expires>Date.now()).map(({expires:E,value:S})=>({...S,TTL:Math.round((E-Date.now())/1e3),type:RecordType[S.type]}));return w.length===0&&this.lru.remove(v),w}return[]}add(u,g){const v=`${u.toLowerCase()}-${g.type}`,b=this.lru.get(v)??[];b.push({expires:Date.now()+(g.TTL??DEFAULT_TTL)*1e3,value:g}),this.lru.set(v,b)}remove(u,g){const v=`${u.toLowerCase()}-${g}`;this.lru.remove(v)}clear(){this.lru.clear()}}function cache(y){return new CachedAnswers(y)}const DEFAULT_ANSWER_CACHE_SIZE=1e3;let DNS$2=class{resolvers;cache;constructor(u){this.resolvers={},this.cache=cache(u.cacheSize??DEFAULT_ANSWER_CACHE_SIZE),Object.entries(u.resolvers??{}).forEach(([g,v])=>{Array.isArray(v)||(v=[v]),g.endsWith(".")||(g=`${g}.`),this.resolvers[g]=v}),this.resolvers["."]==null&&(this.resolvers["."]=defaultResolver())}async query(u,g={}){const v=getTypes(g.types),b=g.cached!==!1?this.cache.get(u,v):void 0;if(b!=null)return g.onProgress?.(new CustomProgressEvent("dns:cache",b)),b;const w=`${u.split(".").pop()}.`,E=(this.resolvers[w]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),S=[];for(const A of E){if(g.signal?.aborted===!0)break;try{const $=await A(u,{...g,types:v});for(const R of $.Answer)this.cache.add(u,R);return $}catch($){S.push($),g.onProgress?.(new CustomProgressEvent("dns:error",$))}}throw S.length===1?S[0]:new AggregateError(S,`DNS lookup of ${u} ${v} failed`)}};var RecordType;(function(y){y[y.A=1]="A",y[y.CNAME=5]="CNAME",y[y.TXT=16]="TXT",y[y.AAAA=28]="AAAA"})(RecordType||(RecordType={}));function dns(y={}){return new DNS$2(y)}function isAsyncIterable$c(y){return y[Symbol.asyncIterator]!=null}function drain(y){if(isAsyncIterable$c(y))return(async()=>{for await(const u of y);})();for(const u of y);}class SigningError extends Error{constructor(u="An error occurred while signing a message"){super(u),this.name="SigningError"}}class VerificationError extends Error{constructor(u="An error occurred while verifying a message"){super(u),this.name="VerificationError"}}class WebCryptoMissingError extends Error{constructor(u="Missing Web Crypto API"){super(u),this.name="WebCryptoMissingError"}}const webcrypto={get(y=globalThis){const u=y.crypto;if(u?.subtle==null)throw new WebCryptoMissingError("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return u}};function equals(y,u){if(y===u)return!0;if(y.byteLength!==u.byteLength)return!1;for(let g=0;g<y.byteLength;g++)if(y[g]!==u[g])return!1;return!0}function asUint8Array(y){return y}function concat$2(y,u){u==null&&(u=y.reduce((b,w)=>b+w.length,0));const g=allocUnsafe(u);let v=0;for(const b of y)g.set(b,v),v+=b.length;return g}const symbol$1=Symbol.for("@achingbrain/uint8arraylist");function findBufAndOffset(y,u){if(u==null||u<0)throw new RangeError("index is out of bounds");let g=0;for(const v of y){const b=g+v.byteLength;if(u<b)return{buf:v,index:u-g};g=b}throw new RangeError("index is out of bounds")}function isUint8ArrayList(y){return!!y?.[symbol$1]}class Uint8ArrayList{bufs;length;[symbol$1]=!0;constructor(...u){this.bufs=[],this.length=0,u.length>0&&this.appendAll(u)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...u){this.appendAll(u)}appendAll(u){let g=0;for(const v of u)if(v instanceof Uint8Array)g+=v.byteLength,this.bufs.push(v);else if(isUint8ArrayList(v))g+=v.byteLength,this.bufs.push(...v.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=g}prepend(...u){this.prependAll(u)}prependAll(u){let g=0;for(const v of u.reverse())if(v instanceof Uint8Array)g+=v.byteLength,this.bufs.unshift(v);else if(isUint8ArrayList(v))g+=v.byteLength,this.bufs.unshift(...v.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=g}get(u){const g=findBufAndOffset(this.bufs,u);return g.buf[g.index]}set(u,g){const v=findBufAndOffset(this.bufs,u);v.buf[v.index]=g}write(u,g=0){if(u instanceof Uint8Array)for(let v=0;v<u.length;v++)this.set(g+v,u[v]);else if(isUint8ArrayList(u))for(let v=0;v<u.length;v++)this.set(g+v,u.get(v));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(u){if(u=Math.trunc(u),!(Number.isNaN(u)||u<=0)){if(u===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(u>=this.bufs[0].byteLength)u-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(u),this.length-=u;break}}}slice(u,g){const{bufs:v,length:b}=this._subList(u,g);return concat$2(v,b)}subarray(u,g){const{bufs:v,length:b}=this._subList(u,g);return v.length===1?v[0]:concat$2(v,b)}sublist(u,g){const{bufs:v,length:b}=this._subList(u,g),w=new Uint8ArrayList;return w.length=b,w.bufs=[...v],w}_subList(u,g){if(u=u??0,g=g??this.length,u<0&&(u=this.length+u),g<0&&(g=this.length+g),u<0||g>this.length)throw new RangeError("index is out of bounds");if(u===g)return{bufs:[],length:0};if(u===0&&g===this.length)return{bufs:this.bufs,length:this.length};const v=[];let b=0;for(let w=0;w<this.bufs.length;w++){const E=this.bufs[w],S=b,A=S+E.byteLength;if(b=A,u>=A)continue;const $=u>=S&&u<A,R=g>S&&g<=A;if($&&R){if(u===S&&g===A){v.push(E);break}const T=u-S;v.push(E.subarray(T,T+(g-u)));break}if($){if(u===0){v.push(E);continue}v.push(E.subarray(u-S));continue}if(R){if(g===A){v.push(E);break}v.push(E.subarray(0,g-S));break}v.push(E)}return{bufs:v,length:g-u}}indexOf(u,g=0){if(!isUint8ArrayList(u)&&!(u instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const v=u instanceof Uint8Array?u:u.subarray();if(g=Number(g??0),isNaN(g)&&(g=0),g<0&&(g=this.length+g),g<0&&(g=0),u.length===0)return g>this.length?this.length:g;const b=v.byteLength;if(b===0)throw new TypeError("search must be at least 1 byte long");const w=256,E=new Int32Array(w);for(let T=0;T<w;T++)E[T]=-1;for(let T=0;T<b;T++)E[v[T]]=T;const S=E,A=this.byteLength-v.byteLength,$=v.byteLength-1;let R;for(let T=g;T<=A;T+=R){R=0;for(let O=$;O>=0;O--){const B=this.get(T+O);if(v[O]!==B){R=Math.max(1,O-S[B]);break}}if(R===0)return T}return-1}getInt8(u){const g=this.subarray(u,u+1);return new DataView(g.buffer,g.byteOffset,g.byteLength).getInt8(0)}setInt8(u,g){const v=allocUnsafe(1);new DataView(v.buffer,v.byteOffset,v.byteLength).setInt8(0,g),this.write(v,u)}getInt16(u,g){const v=this.subarray(u,u+2);return new DataView(v.buffer,v.byteOffset,v.byteLength).getInt16(0,g)}setInt16(u,g,v){const b=alloc$2(2);new DataView(b.buffer,b.byteOffset,b.byteLength).setInt16(0,g,v),this.write(b,u)}getInt32(u,g){const v=this.subarray(u,u+4);return new DataView(v.buffer,v.byteOffset,v.byteLength).getInt32(0,g)}setInt32(u,g,v){const b=alloc$2(4);new DataView(b.buffer,b.byteOffset,b.byteLength).setInt32(0,g,v),this.write(b,u)}getBigInt64(u,g){const v=this.subarray(u,u+8);return new DataView(v.buffer,v.byteOffset,v.byteLength).getBigInt64(0,g)}setBigInt64(u,g,v){const b=alloc$2(8);new DataView(b.buffer,b.byteOffset,b.byteLength).setBigInt64(0,g,v),this.write(b,u)}getUint8(u){const g=this.subarray(u,u+1);return new DataView(g.buffer,g.byteOffset,g.byteLength).getUint8(0)}setUint8(u,g){const v=allocUnsafe(1);new DataView(v.buffer,v.byteOffset,v.byteLength).setUint8(0,g),this.write(v,u)}getUint16(u,g){const v=this.subarray(u,u+2);return new DataView(v.buffer,v.byteOffset,v.byteLength).getUint16(0,g)}setUint16(u,g,v){const b=alloc$2(2);new DataView(b.buffer,b.byteOffset,b.byteLength).setUint16(0,g,v),this.write(b,u)}getUint32(u,g){const v=this.subarray(u,u+4);return new DataView(v.buffer,v.byteOffset,v.byteLength).getUint32(0,g)}setUint32(u,g,v){const b=alloc$2(4);new DataView(b.buffer,b.byteOffset,b.byteLength).setUint32(0,g,v),this.write(b,u)}getBigUint64(u,g){const v=this.subarray(u,u+8);return new DataView(v.buffer,v.byteOffset,v.byteLength).getBigUint64(0,g)}setBigUint64(u,g,v){const b=alloc$2(8);new DataView(b.buffer,b.byteOffset,b.byteLength).setBigUint64(0,g,v),this.write(b,u)}getFloat32(u,g){const v=this.subarray(u,u+4);return new DataView(v.buffer,v.byteOffset,v.byteLength).getFloat32(0,g)}setFloat32(u,g,v){const b=alloc$2(4);new DataView(b.buffer,b.byteOffset,b.byteLength).setFloat32(0,g,v),this.write(b,u)}getFloat64(u,g){const v=this.subarray(u,u+8);return new DataView(v.buffer,v.byteOffset,v.byteLength).getFloat64(0,g)}setFloat64(u,g,v){const b=alloc$2(8);new DataView(b.buffer,b.byteOffset,b.byteLength).setFloat64(0,g,v),this.write(b,u)}equals(u){if(u==null||!(u instanceof Uint8ArrayList)||u.bufs.length!==this.bufs.length)return!1;for(let g=0;g<this.bufs.length;g++)if(!equals(this.bufs[g],u.bufs[g]))return!1;return!0}static fromUint8Arrays(u,g){const v=new Uint8ArrayList;return v.bufs=u,g==null&&(g=u.reduce((b,w)=>b+w.byteLength,0)),v.length=g,v}}function fromString$1(y,u="utf8"){const g=BASES[u];if(g==null)throw new Error(`Unsupported encoding "${u}"`);return g.decoder.decode(`${g.prefix}${y}`)}const TAG_MASK=parseInt("11111",2),LONG_LENGTH_MASK=parseInt("10000000",2),LONG_LENGTH_BYTES_MASK=parseInt("01111111",2),decoders$1={0:readSequence,1:readSequence,2:readInteger,3:readBitString,4:readOctetString,5:readNull,6:readObjectIdentifier,16:readSequence,22:readSequence,48:readSequence};function decodeDer(y,u={offset:0}){const g=y[u.offset]&TAG_MASK;if(u.offset++,decoders$1[g]!=null)return decoders$1[g](y,u);throw new Error("No decoder for tag "+g)}function readLength(y,u){let g=0;if((y[u.offset]&LONG_LENGTH_MASK)===LONG_LENGTH_MASK){const v=y[u.offset]&LONG_LENGTH_BYTES_MASK;let b="0x";u.offset++;for(let w=0;w<v;w++,u.offset++)b+=y[u.offset].toString(16).padStart(2,"0");g=parseInt(b,16)}else g=y[u.offset],u.offset++;return g}function readSequence(y,u){readLength(y,u);const g=[];for(;!(u.offset>=y.byteLength);){const v=decodeDer(y,u);if(v===null)break;g.push(v)}return g}function readInteger(y,u){const g=readLength(y,u),v=u.offset,b=u.offset+g,w=[];for(let E=v;E<b;E++)E===v&&y[E]===0||w.push(y[E]);return u.offset+=g,Uint8Array.from(w)}function readObjectIdentifier(y,u){const g=readLength(y,u),v=u.offset+g,b=y[u.offset];u.offset++;let w=0,E=0;b<40?(w=0,E=b):b<80?(w=1,E=b-40):(w=2,E=b-80);let S=`${w}.${E}`,A=[];for(;u.offset<v;){const $=y[u.offset];if(u.offset++,A.push($&127),$<128){A.reverse();let R=0;for(let T=0;T<A.length;T++)R+=A[T]<<T*7;S+=`.${R}`,A=[]}}return S}function readNull(y,u){return u.offset++,null}function readBitString(y,u){const g=readLength(y,u),v=y[u.offset];u.offset++;const b=y.subarray(u.offset,u.offset+g-1);if(u.offset+=g,v!==0)throw new Error("Unused bits in bit string is unimplemented");return b}function readOctetString(y,u){const g=readLength(y,u),v=y.subarray(u.offset,u.offset+g);return u.offset+=g,v}function encodeNumber(y){let u=y.toString(16);u.length%2===1&&(u="0"+u);const g=new Uint8ArrayList;for(let v=0;v<u.length;v+=2)g.append(Uint8Array.from([parseInt(`${u[v]}${u[v+1]}`,16)]));return g}function encodeLength(y){if(y.byteLength<128)return Uint8Array.from([y.byteLength]);const u=encodeNumber(y.byteLength);return new Uint8ArrayList(Uint8Array.from([u.byteLength|LONG_LENGTH_MASK]),u)}function encodeInteger(y){const u=new Uint8ArrayList,g=128;return(y.subarray()[0]&g)===g&&u.append(Uint8Array.from([0])),u.append(y),new Uint8ArrayList(Uint8Array.from([2]),encodeLength(u),u)}function encodeBitString(y){const u=Uint8Array.from([0]),g=new Uint8ArrayList(u,y);return new Uint8ArrayList(Uint8Array.from([3]),encodeLength(g),g)}function encodeOctetString(y){return new Uint8ArrayList(Uint8Array.from([4]),encodeLength(y),y)}function encodeSequence(y,u=48){const g=new Uint8ArrayList;for(const v of y)g.append(v);return new Uint8ArrayList(Uint8Array.from([u]),encodeLength(g),g)}const ECDSA_P_256_OID="1.2.840.10045.3.1.7",ECDSA_P_384_OID="1.3.132.0.34",ECDSA_P_521_OID="1.3.132.0.35";async function generateECDSAKey(y="P-256"){const u=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:y},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",u.publicKey),privateKey:await crypto.subtle.exportKey("jwk",u.privateKey)}}async function hashAndSign$3(y,u,g){const v=await crypto.subtle.importKey("jwk",y,{name:"ECDSA",namedCurve:y.crv??"P-256"},!1,["sign"]);g?.signal?.throwIfAborted();const b=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},v,u.subarray());return g?.signal?.throwIfAborted(),new Uint8Array(b,0,b.byteLength)}async function hashAndVerify$3(y,u,g,v){const b=await crypto.subtle.importKey("jwk",y,{name:"ECDSA",namedCurve:y.crv??"P-256"},!1,["verify"]);v?.signal?.throwIfAborted();const w=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},b,u,g.subarray());return v?.signal?.throwIfAborted(),w}const OID_256=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),OID_384=Uint8Array.from([6,5,43,129,4,0,34]),OID_521=Uint8Array.from([6,5,43,129,4,0,35]),P_256_KEY_JWK={ext:!0,kty:"EC",crv:"P-256"},P_384_KEY_JWK={ext:!0,kty:"EC",crv:"P-384"},P_521_KEY_JWK={ext:!0,kty:"EC",crv:"P-521"},P_256_KEY_LENGTH=32,P_384_KEY_LENGTH=48,P_521_KEY_LENGTH=66;function unmarshalECDSAPrivateKey(y){const u=decodeDer(y);return pkiMessageToECDSAPrivateKey(u)}function pkiMessageToECDSAPrivateKey(y){const u=y[1],g=toString$3(u,"base64url"),v=y[2][1][0],b=1;let w,E;if(u.byteLength===P_256_KEY_LENGTH)return w=toString$3(v.subarray(b,b+P_256_KEY_LENGTH),"base64url"),E=toString$3(v.subarray(b+P_256_KEY_LENGTH),"base64url"),new ECDSAPrivateKey({...P_256_KEY_JWK,key_ops:["sign"],d:g,x:w,y:E});if(u.byteLength===P_384_KEY_LENGTH)return w=toString$3(v.subarray(b,b+P_384_KEY_LENGTH),"base64url"),E=toString$3(v.subarray(b+P_384_KEY_LENGTH),"base64url"),new ECDSAPrivateKey({...P_384_KEY_JWK,key_ops:["sign"],d:g,x:w,y:E});if(u.byteLength===P_521_KEY_LENGTH)return w=toString$3(v.subarray(b,b+P_521_KEY_LENGTH),"base64url"),E=toString$3(v.subarray(b+P_521_KEY_LENGTH),"base64url"),new ECDSAPrivateKey({...P_521_KEY_JWK,key_ops:["sign"],d:g,x:w,y:E});throw new InvalidParametersError$1(`Private key length was wrong length, got ${u.byteLength}, expected 32, 48 or 66`)}function unmarshalECDSAPublicKey(y){const u=decodeDer(y);return pkiMessageToECDSAPublicKey(u)}function pkiMessageToECDSAPublicKey(y){const u=y[1][1][0],g=1;let v,b;if(u.byteLength===P_256_KEY_LENGTH*2+1)return v=toString$3(u.subarray(g,g+P_256_KEY_LENGTH),"base64url"),b=toString$3(u.subarray(g+P_256_KEY_LENGTH),"base64url"),new ECDSAPublicKey({...P_256_KEY_JWK,key_ops:["verify"],x:v,y:b});if(u.byteLength===P_384_KEY_LENGTH*2+1)return v=toString$3(u.subarray(g,g+P_384_KEY_LENGTH),"base64url"),b=toString$3(u.subarray(g+P_384_KEY_LENGTH),"base64url"),new ECDSAPublicKey({...P_384_KEY_JWK,key_ops:["verify"],x:v,y:b});if(u.byteLength===P_521_KEY_LENGTH*2+1)return v=toString$3(u.subarray(g,g+P_521_KEY_LENGTH),"base64url"),b=toString$3(u.subarray(g+P_521_KEY_LENGTH),"base64url"),new ECDSAPublicKey({...P_521_KEY_JWK,key_ops:["verify"],x:v,y:b});throw new InvalidParametersError$1(`coordinates were wrong length, got ${u.byteLength}, expected 65, 97 or 133`)}function privateKeyToPKIMessage(y){return encodeSequence([encodeInteger(Uint8Array.from([1])),encodeOctetString(fromString$1(y.d??"","base64url")),encodeSequence([getOID(y.crv)],160),encodeSequence([encodeBitString(new Uint8ArrayList(Uint8Array.from([4]),fromString$1(y.x??"","base64url"),fromString$1(y.y??"","base64url")))],161)]).subarray()}function publicKeyToPKIMessage(y){return encodeSequence([encodeInteger(Uint8Array.from([1])),encodeSequence([getOID(y.crv)],160),encodeSequence([encodeBitString(new Uint8ArrayList(Uint8Array.from([4]),fromString$1(y.x??"","base64url"),fromString$1(y.y??"","base64url")))],161)]).subarray()}function getOID(y){if(y==="P-256")return OID_256;if(y==="P-384")return OID_384;if(y==="P-521")return OID_521;throw new InvalidParametersError$1(`Invalid curve ${y}`)}async function generateECDSAKeyPair(y="P-256"){const u=await generateECDSAKey(y);return new ECDSAPrivateKey(u.privateKey)}class ECDSAPublicKey{type="ECDSA";jwk;_raw;constructor(u){this.jwk=u}get raw(){return this._raw==null&&(this._raw=publicKeyToPKIMessage(this.jwk)),this._raw}toMultihash(){return identity.digest(publicKeyToProtobuf(this))}toCID(){return CID.createV1(114,this.toMultihash())}toString(){return base58btc.encode(this.toMultihash().bytes).substring(1)}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}async verify(u,g,v){return hashAndVerify$3(this.jwk,g,u,v)}}class ECDSAPrivateKey{type="ECDSA";jwk;publicKey;_raw;constructor(u){this.jwk=u,this.publicKey=new ECDSAPublicKey({crv:u.crv,ext:u.ext,key_ops:["verify"],kty:"EC",x:u.x,y:u.y})}get raw(){return this._raw==null&&(this._raw=privateKeyToPKIMessage(this.jwk)),this._raw}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}async sign(u,g){return hashAndSign$3(this.jwk,u,g)}}function isBytes$6(y){return y instanceof Uint8Array||ArrayBuffer.isView(y)&&y.constructor.name==="Uint8Array"}function anumber$4(y,u=""){if(!Number.isSafeInteger(y)||y<0){const g=u&&`"${u}" `;throw new Error(`${g}expected integer >= 0, got ${y}`)}}function abytes$5(y,u,g=""){const v=isBytes$6(y),b=y?.length,w=u!==void 0;if(!v||w&&b!==u){const E=g&&`"${g}" `,S=w?` of length ${u}`:"",A=v?`length=${b}`:`type=${typeof y}`;throw new Error(E+"expected Uint8Array"+S+", got "+A)}return y}function ahash$3(y){if(typeof y!="function"||typeof y.create!="function")throw new Error("Hash must wrapped by utils.createHasher");anumber$4(y.outputLen),anumber$4(y.blockLen)}function aexists$4(y,u=!0){if(y.destroyed)throw new Error("Hash instance has been destroyed");if(u&&y.finished)throw new Error("Hash#digest() has already been called")}function aoutput$4(y,u){abytes$5(y,void 0,"digestInto() output");const g=u.outputLen;if(y.length<g)throw new Error('"digestInto() output" expected to be of length >='+g)}function clean$4(...y){for(let u=0;u<y.length;u++)y[u].fill(0)}function createView$4(y){return new DataView(y.buffer,y.byteOffset,y.byteLength)}function rotr$2(y,u){return y<<32-u|y>>>u}function rotl$1(y,u){return y<<u|y>>>32-u>>>0}const hasHexBuiltin$1=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes$1=Array.from({length:256},(y,u)=>u.toString(16).padStart(2,"0"));function bytesToHex$3(y){if(abytes$5(y),hasHexBuiltin$1)return y.toHex();let u="";for(let g=0;g<y.length;g++)u+=hexes$1[y[g]];return u}const asciis$1={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$1(y){if(y>=asciis$1._0&&y<=asciis$1._9)return y-asciis$1._0;if(y>=asciis$1.A&&y<=asciis$1.F)return y-(asciis$1.A-10);if(y>=asciis$1.a&&y<=asciis$1.f)return y-(asciis$1.a-10)}function hexToBytes$3(y){if(typeof y!="string")throw new Error("hex string expected, got "+typeof y);if(hasHexBuiltin$1)return Uint8Array.fromHex(y);const u=y.length,g=u/2;if(u%2)throw new Error("hex string expected, got unpadded hex of length "+u);const v=new Uint8Array(g);for(let b=0,w=0;b<g;b++,w+=2){const E=asciiToBase16$1(y.charCodeAt(w)),S=asciiToBase16$1(y.charCodeAt(w+1));if(E===void 0||S===void 0){const A=y[w]+y[w+1];throw new Error('hex string expected, got non-hex character "'+A+'" at index '+w)}v[b]=E*16+S}return v}function utf8ToBytes$3(y){if(typeof y!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(y))}function kdfInputToBytes$1(y,u=""){return typeof y=="string"?utf8ToBytes$3(y):abytes$5(y,void 0,u)}function concatBytes$1(...y){let u=0;for(let v=0;v<y.length;v++){const b=y[v];abytes$5(b),u+=b.length}const g=new Uint8Array(u);for(let v=0,b=0;v<y.length;v++){const w=y[v];g.set(w,b),b+=w.length}return g}function checkOpts$2(y,u){if(u!==void 0&&{}.toString.call(u)!=="[object Object]")throw new Error("options must be object or undefined");return Object.assign(y,u)}function createHasher$3(y,u={}){const g=(b,w)=>y(w).update(b).digest(),v=y(void 0);return g.outputLen=v.outputLen,g.blockLen=v.blockLen,g.create=b=>y(b),Object.assign(g,u),Object.freeze(g)}function randomBytes$2(y=32){const u=typeof globalThis=="object"?globalThis.crypto:null;if(typeof u?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return u.getRandomValues(new Uint8Array(y))}const oidNist$2=y=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,y])});function Chi$2(y,u,g){return y&u^~y&g}function Maj$2(y,u,g){return y&u^y&g^u&g}let HashMD$3=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(u,g,v,b){this.blockLen=u,this.outputLen=g,this.padOffset=v,this.isLE=b,this.buffer=new Uint8Array(u),this.view=createView$4(this.buffer)}update(u){aexists$4(this),abytes$5(u);const{view:g,buffer:v,blockLen:b}=this,w=u.length;for(let E=0;E<w;){const S=Math.min(b-this.pos,w-E);if(S===b){const A=createView$4(u);for(;b<=w-E;E+=b)this.process(A,E);continue}v.set(u.subarray(E,E+S),this.pos),this.pos+=S,E+=S,this.pos===b&&(this.process(g,0),this.pos=0)}return this.length+=u.length,this.roundClean(),this}digestInto(u){aexists$4(this),aoutput$4(u,this),this.finished=!0;const{buffer:g,view:v,blockLen:b,isLE:w}=this;let{pos:E}=this;g[E++]=128,clean$4(this.buffer.subarray(E)),this.padOffset>b-E&&(this.process(v,0),E=0);for(let T=E;T<b;T++)g[T]=0;v.setBigUint64(b-8,BigInt(this.length*8),w),this.process(v,0);const S=createView$4(u),A=this.outputLen;if(A%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const $=A/4,R=this.get();if($>R.length)throw new Error("_sha2: outputLen bigger than state");for(let T=0;T<$;T++)S.setUint32(4*T,R[T],w)}digest(){const{buffer:u,outputLen:g}=this;this.digestInto(u);const v=u.slice(0,g);return this.destroy(),v}_cloneInto(u){u||=new this.constructor,u.set(...this.get());const{blockLen:g,buffer:v,length:b,finished:w,destroyed:E,pos:S}=this;return u.destroyed=E,u.finished=w,u.length=b,u.pos=S,b%g&&u.buffer.set(v),u}clone(){return this._cloneInto()}};const SHA256_IV$2=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA512_IV$2=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),U32_MASK64$2=BigInt(2**32-1),_32n$2=BigInt(32);function fromBig$2(y,u=!1){return u?{h:Number(y&U32_MASK64$2),l:Number(y>>_32n$2&U32_MASK64$2)}:{h:Number(y>>_32n$2&U32_MASK64$2)|0,l:Number(y&U32_MASK64$2)|0}}function split$2(y,u=!1){const g=y.length;let v=new Uint32Array(g),b=new Uint32Array(g);for(let w=0;w<g;w++){const{h:E,l:S}=fromBig$2(y[w],u);[v[w],b[w]]=[E,S]}return[v,b]}const shrSH$2=(y,u,g)=>y>>>g,shrSL$2=(y,u,g)=>y<<32-g|u>>>g,rotrSH$2=(y,u,g)=>y>>>g|u<<32-g,rotrSL$2=(y,u,g)=>y<<32-g|u>>>g,rotrBH$2=(y,u,g)=>y<<64-g|u>>>g-32,rotrBL$2=(y,u,g)=>y>>>g-32|u<<64-g;function add$2(y,u,g,v){const b=(u>>>0)+(v>>>0);return{h:y+g+(b/2**32|0)|0,l:b|0}}const add3L$2=(y,u,g)=>(y>>>0)+(u>>>0)+(g>>>0),add3H$2=(y,u,g,v)=>u+g+v+(y/2**32|0)|0,add4L$2=(y,u,g,v)=>(y>>>0)+(u>>>0)+(g>>>0)+(v>>>0),add4H$2=(y,u,g,v,b)=>u+g+v+b+(y/2**32|0)|0,add5L$2=(y,u,g,v,b)=>(y>>>0)+(u>>>0)+(g>>>0)+(v>>>0)+(b>>>0),add5H$2=(y,u,g,v,b,w)=>u+g+v+b+w+(y/2**32|0)|0,SHA256_K$2=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W$2=new Uint32Array(64);let SHA2_32B$1=class extends HashMD$3{constructor(u){super(64,u,8,!1)}get(){const{A:u,B:g,C:v,D:b,E:w,F:E,G:S,H:A}=this;return[u,g,v,b,w,E,S,A]}set(u,g,v,b,w,E,S,A){this.A=u|0,this.B=g|0,this.C=v|0,this.D=b|0,this.E=w|0,this.F=E|0,this.G=S|0,this.H=A|0}process(u,g){for(let T=0;T<16;T++,g+=4)SHA256_W$2[T]=u.getUint32(g,!1);for(let T=16;T<64;T++){const O=SHA256_W$2[T-15],B=SHA256_W$2[T-2],F=rotr$2(O,7)^rotr$2(O,18)^O>>>3,U=rotr$2(B,17)^rotr$2(B,19)^B>>>10;SHA256_W$2[T]=U+SHA256_W$2[T-7]+F+SHA256_W$2[T-16]|0}let{A:v,B:b,C:w,D:E,E:S,F:A,G:$,H:R}=this;for(let T=0;T<64;T++){const O=rotr$2(S,6)^rotr$2(S,11)^rotr$2(S,25),B=R+O+Chi$2(S,A,$)+SHA256_K$2[T]+SHA256_W$2[T]|0,U=(rotr$2(v,2)^rotr$2(v,13)^rotr$2(v,22))+Maj$2(v,b,w)|0;R=$,$=A,A=S,S=E+B|0,E=w,w=b,b=v,v=B+U|0}v=v+this.A|0,b=b+this.B|0,w=w+this.C|0,E=E+this.D|0,S=S+this.E|0,A=A+this.F|0,$=$+this.G|0,R=R+this.H|0,this.set(v,b,w,E,S,A,$,R)}roundClean(){clean$4(SHA256_W$2)}destroy(){this.set(0,0,0,0,0,0,0,0),clean$4(this.buffer)}},_SHA256$1=class extends SHA2_32B$1{A=SHA256_IV$2[0]|0;B=SHA256_IV$2[1]|0;C=SHA256_IV$2[2]|0;D=SHA256_IV$2[3]|0;E=SHA256_IV$2[4]|0;F=SHA256_IV$2[5]|0;G=SHA256_IV$2[6]|0;H=SHA256_IV$2[7]|0;constructor(){super(32)}};const K512$2=split$2(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(y=>BigInt(y))),SHA512_Kh$2=K512$2[0],SHA512_Kl$2=K512$2[1],SHA512_W_H$2=new Uint32Array(80),SHA512_W_L$2=new Uint32Array(80);let SHA2_64B$1=class extends HashMD$3{constructor(u){super(128,u,16,!1)}get(){const{Ah:u,Al:g,Bh:v,Bl:b,Ch:w,Cl:E,Dh:S,Dl:A,Eh:$,El:R,Fh:T,Fl:O,Gh:B,Gl:F,Hh:U,Hl:q}=this;return[u,g,v,b,w,E,S,A,$,R,T,O,B,F,U,q]}set(u,g,v,b,w,E,S,A,$,R,T,O,B,F,U,q){this.Ah=u|0,this.Al=g|0,this.Bh=v|0,this.Bl=b|0,this.Ch=w|0,this.Cl=E|0,this.Dh=S|0,this.Dl=A|0,this.Eh=$|0,this.El=R|0,this.Fh=T|0,this.Fl=O|0,this.Gh=B|0,this.Gl=F|0,this.Hh=U|0,this.Hl=q|0}process(u,g){for(let oe=0;oe<16;oe++,g+=4)SHA512_W_H$2[oe]=u.getUint32(g),SHA512_W_L$2[oe]=u.getUint32(g+=4);for(let oe=16;oe<80;oe++){const le=SHA512_W_H$2[oe-15]|0,de=SHA512_W_L$2[oe-15]|0,fe=rotrSH$2(le,de,1)^rotrSH$2(le,de,8)^shrSH$2(le,de,7),ye=rotrSL$2(le,de,1)^rotrSL$2(le,de,8)^shrSL$2(le,de,7),we=SHA512_W_H$2[oe-2]|0,pe=SHA512_W_L$2[oe-2]|0,ve=rotrSH$2(we,pe,19)^rotrBH$2(we,pe,61)^shrSH$2(we,pe,6),he=rotrSL$2(we,pe,19)^rotrBL$2(we,pe,61)^shrSL$2(we,pe,6),ae=add4L$2(ye,he,SHA512_W_L$2[oe-7],SHA512_W_L$2[oe-16]),Q=add4H$2(ae,fe,ve,SHA512_W_H$2[oe-7],SHA512_W_H$2[oe-16]);SHA512_W_H$2[oe]=Q|0,SHA512_W_L$2[oe]=ae|0}let{Ah:v,Al:b,Bh:w,Bl:E,Ch:S,Cl:A,Dh:$,Dl:R,Eh:T,El:O,Fh:B,Fl:F,Gh:U,Gl:q,Hh:J,Hl:ie}=this;for(let oe=0;oe<80;oe++){const le=rotrSH$2(T,O,14)^rotrSH$2(T,O,18)^rotrBH$2(T,O,41),de=rotrSL$2(T,O,14)^rotrSL$2(T,O,18)^rotrBL$2(T,O,41),fe=T&B^~T&U,ye=O&F^~O&q,we=add5L$2(ie,de,ye,SHA512_Kl$2[oe],SHA512_W_L$2[oe]),pe=add5H$2(we,J,le,fe,SHA512_Kh$2[oe],SHA512_W_H$2[oe]),ve=we|0,he=rotrSH$2(v,b,28)^rotrBH$2(v,b,34)^rotrBH$2(v,b,39),ae=rotrSL$2(v,b,28)^rotrBL$2(v,b,34)^rotrBL$2(v,b,39),Q=v&w^v&S^w&S,j=b&E^b&A^E&A;J=U|0,ie=q|0,U=B|0,q=F|0,B=T|0,F=O|0,{h:T,l:O}=add$2($|0,R|0,pe|0,ve|0),$=S|0,R=A|0,S=w|0,A=E|0,w=v|0,E=b|0;const z=add3L$2(ve,ae,j);v=add3H$2(z,pe,he,Q),b=z|0}({h:v,l:b}=add$2(this.Ah|0,this.Al|0,v|0,b|0)),{h:w,l:E}=add$2(this.Bh|0,this.Bl|0,w|0,E|0),{h:S,l:A}=add$2(this.Ch|0,this.Cl|0,S|0,A|0),{h:$,l:R}=add$2(this.Dh|0,this.Dl|0,$|0,R|0),{h:T,l:O}=add$2(this.Eh|0,this.El|0,T|0,O|0),{h:B,l:F}=add$2(this.Fh|0,this.Fl|0,B|0,F|0),{h:U,l:q}=add$2(this.Gh|0,this.Gl|0,U|0,q|0),{h:J,l:ie}=add$2(this.Hh|0,this.Hl|0,J|0,ie|0),this.set(v,b,w,E,S,A,$,R,T,O,B,F,U,q,J,ie)}roundClean(){clean$4(SHA512_W_H$2,SHA512_W_L$2)}destroy(){clean$4(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},_SHA512$1=class extends SHA2_64B$1{Ah=SHA512_IV$2[0]|0;Al=SHA512_IV$2[1]|0;Bh=SHA512_IV$2[2]|0;Bl=SHA512_IV$2[3]|0;Ch=SHA512_IV$2[4]|0;Cl=SHA512_IV$2[5]|0;Dh=SHA512_IV$2[6]|0;Dl=SHA512_IV$2[7]|0;Eh=SHA512_IV$2[8]|0;El=SHA512_IV$2[9]|0;Fh=SHA512_IV$2[10]|0;Fl=SHA512_IV$2[11]|0;Gh=SHA512_IV$2[12]|0;Gl=SHA512_IV$2[13]|0;Hh=SHA512_IV$2[14]|0;Hl=SHA512_IV$2[15]|0;constructor(){super(64)}};const sha256$3=createHasher$3(()=>new _SHA256$1,oidNist$2(1)),sha512$3=createHasher$3(()=>new _SHA512$1,oidNist$2(3));const _0n$7=BigInt(0),_1n$7=BigInt(1);function abool$1(y,u=""){if(typeof y!="boolean"){const g=u&&`"${u}" `;throw new Error(g+"expected boolean, got type="+typeof y)}return y}function abignumber$1(y){if(typeof y=="bigint"){if(!isPosBig$1(y))throw new Error("positive bigint expected, got "+y)}else anumber$4(y);return y}function numberToHexUnpadded(y){const u=abignumber$1(y).toString(16);return u.length&1?"0"+u:u}function hexToNumber$1(y){if(typeof y!="string")throw new Error("hex string expected, got "+typeof y);return y===""?_0n$7:BigInt("0x"+y)}function bytesToNumberBE(y){return hexToNumber$1(bytesToHex$3(y))}function bytesToNumberLE$1(y){return hexToNumber$1(bytesToHex$3(copyBytes$2(abytes$5(y)).reverse()))}function numberToBytesBE$1(y,u){anumber$4(u),y=abignumber$1(y);const g=hexToBytes$3(y.toString(16).padStart(u*2,"0"));if(g.length!==u)throw new Error("number too large");return g}function numberToBytesLE$1(y,u){return numberToBytesBE$1(y,u).reverse()}function copyBytes$2(y){return Uint8Array.from(y)}const isPosBig$1=y=>typeof y=="bigint"&&_0n$7<=y;function inRange$1(y,u,g){return isPosBig$1(y)&&isPosBig$1(u)&&isPosBig$1(g)&&u<=y&&y<g}function aInRange$1(y,u,g,v){if(!inRange$1(u,g,v))throw new Error("expected valid "+y+": "+g+" <= n < "+v+", got "+u)}function bitLen(y){let u;for(u=0;y>_0n$7;y>>=_1n$7,u+=1);return u}const bitMask=y=>(_1n$7<<BigInt(y))-_1n$7;function createHmacDrbg(y,u,g){if(anumber$4(y,"hashLen"),anumber$4(u,"qByteLen"),typeof g!="function")throw new Error("hmacFn must be a function");const v=q=>new Uint8Array(q),b=Uint8Array.of(),w=Uint8Array.of(0),E=Uint8Array.of(1),S=1e3;let A=v(y),$=v(y),R=0;const T=()=>{A.fill(1),$.fill(0),R=0},O=(...q)=>g($,concatBytes$1(A,...q)),B=(q=b)=>{$=O(w,q),A=O(),q.length!==0&&($=O(E,q),A=O())},F=()=>{if(R++>=S)throw new Error("drbg: tried max amount of iterations");let q=0;const J=[];for(;q<u;){A=O();const ie=A.slice();J.push(ie),q+=A.length}return concatBytes$1(...J)};return(q,J)=>{T(),B(q);let ie;for(;!(ie=J(F()));)B();return T(),ie}}function validateObject$1(y,u={},g={}){if(!y||typeof y!="object")throw new Error("expected valid options object");function v(w,E,S){const A=y[w];if(S&&A===void 0)return;const $=typeof A;if($!==E||A===null)throw new Error(`param "${w}" is invalid: expected ${E}, got ${$}`)}const b=(w,E)=>Object.entries(w).forEach(([S,A])=>v(S,A,E));b(u,!1),b(g,!0)}function memoized(y){const u=new WeakMap;return(g,...v)=>{const b=u.get(g);if(b!==void 0)return b;const w=y(g,...v);return u.set(g,w),w}}const _0n$6=BigInt(0),_1n$6=BigInt(1),_2n$6=BigInt(2),_3n$2=BigInt(3),_4n$1=BigInt(4),_5n$2=BigInt(5),_7n=BigInt(7),_8n$2=BigInt(8),_9n=BigInt(9),_16n=BigInt(16);function mod$1(y,u){const g=y%u;return g>=_0n$6?g:u+g}function pow2$2(y,u,g){let v=y;for(;u-- >_0n$6;)v*=v,v%=g;return v}function invert$1(y,u){if(y===_0n$6)throw new Error("invert: expected non-zero number");if(u<=_0n$6)throw new Error("invert: expected positive modulus, got "+u);let g=mod$1(y,u),v=u,b=_0n$6,w=_1n$6;for(;g!==_0n$6;){const S=v/g,A=v%g,$=b-w*S;v=g,g=A,b=w,w=$}if(v!==_1n$6)throw new Error("invert: does not exist");return mod$1(b,u)}function assertIsSquare(y,u,g){if(!y.eql(y.sqr(u),g))throw new Error("Cannot find square root")}function sqrt3mod4(y,u){const g=(y.ORDER+_1n$6)/_4n$1,v=y.pow(u,g);return assertIsSquare(y,v,u),v}function sqrt5mod8(y,u){const g=(y.ORDER-_5n$2)/_8n$2,v=y.mul(u,_2n$6),b=y.pow(v,g),w=y.mul(u,b),E=y.mul(y.mul(w,_2n$6),b),S=y.mul(w,y.sub(E,y.ONE));return assertIsSquare(y,S,u),S}function sqrt9mod16(y){const u=Field(y),g=tonelliShanks(y),v=g(u,u.neg(u.ONE)),b=g(u,v),w=g(u,u.neg(v)),E=(y+_7n)/_16n;return(S,A)=>{let $=S.pow(A,E),R=S.mul($,v);const T=S.mul($,b),O=S.mul($,w),B=S.eql(S.sqr(R),A),F=S.eql(S.sqr(T),A);$=S.cmov($,R,B),R=S.cmov(O,T,F);const U=S.eql(S.sqr(R),A),q=S.cmov($,R,U);return assertIsSquare(S,q,A),q}}function tonelliShanks(y){if(y<_3n$2)throw new Error("sqrt is not defined for small field");let u=y-_1n$6,g=0;for(;u%_2n$6===_0n$6;)u/=_2n$6,g++;let v=_2n$6;const b=Field(y);for(;FpLegendre(b,v)===1;)if(v++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(g===1)return sqrt3mod4;let w=b.pow(v,u);const E=(u+_1n$6)/_2n$6;return function(A,$){if(A.is0($))return $;if(FpLegendre(A,$)!==1)throw new Error("Cannot find square root");let R=g,T=A.mul(A.ONE,w),O=A.pow($,u),B=A.pow($,E);for(;!A.eql(O,A.ONE);){if(A.is0(O))return A.ZERO;let F=1,U=A.sqr(O);for(;!A.eql(U,A.ONE);)if(F++,U=A.sqr(U),F===R)throw new Error("Cannot find square root");const q=_1n$6<<BigInt(R-F-1),J=A.pow(T,q);R=F,T=A.sqr(J),O=A.mul(O,T),B=A.mul(B,J)}return B}}function FpSqrt(y){return y%_4n$1===_3n$2?sqrt3mod4:y%_8n$2===_5n$2?sqrt5mod8:y%_16n===_9n?sqrt9mod16(y):tonelliShanks(y)}const isNegativeLE=(y,u)=>(mod$1(y,u)&_1n$6)===_1n$6,FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(y){const u={ORDER:"bigint",BYTES:"number",BITS:"number"},g=FIELD_FIELDS.reduce((v,b)=>(v[b]="function",v),u);return validateObject$1(y,g),y}function FpPow(y,u,g){if(g<_0n$6)throw new Error("invalid exponent, negatives unsupported");if(g===_0n$6)return y.ONE;if(g===_1n$6)return u;let v=y.ONE,b=u;for(;g>_0n$6;)g&_1n$6&&(v=y.mul(v,b)),b=y.sqr(b),g>>=_1n$6;return v}function FpInvertBatch(y,u,g=!1){const v=new Array(u.length).fill(g?y.ZERO:void 0),b=u.reduce((E,S,A)=>y.is0(S)?E:(v[A]=E,y.mul(E,S)),y.ONE),w=y.inv(b);return u.reduceRight((E,S,A)=>y.is0(S)?E:(v[A]=y.mul(E,v[A]),y.mul(E,S)),w),v}function FpLegendre(y,u){const g=(y.ORDER-_1n$6)/_2n$6,v=y.pow(u,g),b=y.eql(v,y.ONE),w=y.eql(v,y.ZERO),E=y.eql(v,y.neg(y.ONE));if(!b&&!w&&!E)throw new Error("invalid Legendre symbol result");return b?1:w?0:-1}function nLength(y,u){u!==void 0&&anumber$4(u);const g=u!==void 0?u:y.toString(2).length,v=Math.ceil(g/8);return{nBitLength:g,nByteLength:v}}class _Field{ORDER;BITS;BYTES;isLE;ZERO=_0n$6;ONE=_1n$6;_lengths;_sqrt;_mod;constructor(u,g={}){if(u<=_0n$6)throw new Error("invalid field: expected ORDER > 0, got "+u);let v;this.isLE=!1,g!=null&&typeof g=="object"&&(typeof g.BITS=="number"&&(v=g.BITS),typeof g.sqrt=="function"&&(this.sqrt=g.sqrt),typeof g.isLE=="boolean"&&(this.isLE=g.isLE),g.allowedLengths&&(this._lengths=g.allowedLengths?.slice()),typeof g.modFromBytes=="boolean"&&(this._mod=g.modFromBytes));const{nBitLength:b,nByteLength:w}=nLength(u,v);if(w>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=u,this.BITS=b,this.BYTES=w,this._sqrt=void 0,Object.preventExtensions(this)}create(u){return mod$1(u,this.ORDER)}isValid(u){if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return _0n$6<=u&&u<this.ORDER}is0(u){return u===_0n$6}isValidNot0(u){return!this.is0(u)&&this.isValid(u)}isOdd(u){return(u&_1n$6)===_1n$6}neg(u){return mod$1(-u,this.ORDER)}eql(u,g){return u===g}sqr(u){return mod$1(u*u,this.ORDER)}add(u,g){return mod$1(u+g,this.ORDER)}sub(u,g){return mod$1(u-g,this.ORDER)}mul(u,g){return mod$1(u*g,this.ORDER)}pow(u,g){return FpPow(this,u,g)}div(u,g){return mod$1(u*invert$1(g,this.ORDER),this.ORDER)}sqrN(u){return u*u}addN(u,g){return u+g}subN(u,g){return u-g}mulN(u,g){return u*g}inv(u){return invert$1(u,this.ORDER)}sqrt(u){return this._sqrt||(this._sqrt=FpSqrt(this.ORDER)),this._sqrt(this,u)}toBytes(u){return this.isLE?numberToBytesLE$1(u,this.BYTES):numberToBytesBE$1(u,this.BYTES)}fromBytes(u,g=!1){abytes$5(u);const{_lengths:v,BYTES:b,isLE:w,ORDER:E,_mod:S}=this;if(v){if(!v.includes(u.length)||u.length>b)throw new Error("Field.fromBytes: expected "+v+" bytes, got "+u.length);const $=new Uint8Array(b);$.set(u,w?0:$.length-u.length),u=$}if(u.length!==b)throw new Error("Field.fromBytes: expected "+b+" bytes, got "+u.length);let A=w?bytesToNumberLE$1(u):bytesToNumberBE(u);if(S&&(A=mod$1(A,E)),!g&&!this.isValid(A))throw new Error("invalid field element: outside of range 0..ORDER");return A}invertBatch(u){return FpInvertBatch(this,u)}cmov(u,g,v){return v?g:u}}function Field(y,u={}){return new _Field(y,u)}function getFieldBytesLength(y){if(typeof y!="bigint")throw new Error("field order must be bigint");const u=y.toString(2).length;return Math.ceil(u/8)}function getMinHashLength(y){const u=getFieldBytesLength(y);return u+Math.ceil(u/2)}function mapHashToField(y,u,g=!1){abytes$5(y);const v=y.length,b=getFieldBytesLength(u),w=getMinHashLength(u);if(v<16||v<w||v>1024)throw new Error("expected "+w+"-1024 bytes of input, got "+v);const E=g?bytesToNumberLE$1(y):bytesToNumberBE(y),S=mod$1(E,u-_1n$6)+_1n$6;return g?numberToBytesLE$1(S,b):numberToBytesBE$1(S,b)}const _0n$5=BigInt(0),_1n$5=BigInt(1);function negateCt(y,u){const g=u.negate();return y?g:u}function normalizeZ(y,u){const g=FpInvertBatch(y.Fp,u.map(v=>v.Z));return u.map((v,b)=>y.fromAffine(v.toAffine(g[b])))}function validateW(y,u){if(!Number.isSafeInteger(y)||y<=0||y>u)throw new Error("invalid window size, expected [1.."+u+"], got W="+y)}function calcWOpts(y,u){validateW(y,u);const g=Math.ceil(u/y)+1,v=2**(y-1),b=2**y,w=bitMask(y),E=BigInt(y);return{windows:g,windowSize:v,mask:w,maxNumber:b,shiftBy:E}}function calcOffsets(y,u,g){const{windowSize:v,mask:b,maxNumber:w,shiftBy:E}=g;let S=Number(y&b),A=y>>E;S>v&&(S-=w,A+=_1n$5);const $=u*v,R=$+Math.abs(S)-1,T=S===0,O=S<0,B=u%2!==0;return{nextN:A,offset:R,isZero:T,isNeg:O,isNegF:B,offsetF:$}}const pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function getW(y){return pointWindowSizes.get(y)||1}function assert0(y){if(y!==_0n$5)throw new Error("invalid wNAF")}let wNAF$1=class{BASE;ZERO;Fn;bits;constructor(u,g){this.BASE=u.BASE,this.ZERO=u.ZERO,this.Fn=u.Fn,this.bits=g}_unsafeLadder(u,g,v=this.ZERO){let b=u;for(;g>_0n$5;)g&_1n$5&&(v=v.add(b)),b=b.double(),g>>=_1n$5;return v}precomputeWindow(u,g){const{windows:v,windowSize:b}=calcWOpts(g,this.bits),w=[];let E=u,S=E;for(let A=0;A<v;A++){S=E,w.push(S);for(let $=1;$<b;$++)S=S.add(E),w.push(S);E=S.double()}return w}wNAF(u,g,v){if(!this.Fn.isValid(v))throw new Error("invalid scalar");let b=this.ZERO,w=this.BASE;const E=calcWOpts(u,this.bits);for(let S=0;S<E.windows;S++){const{nextN:A,offset:$,isZero:R,isNeg:T,isNegF:O,offsetF:B}=calcOffsets(v,S,E);v=A,R?w=w.add(negateCt(O,g[B])):b=b.add(negateCt(T,g[$]))}return assert0(v),{p:b,f:w}}wNAFUnsafe(u,g,v,b=this.ZERO){const w=calcWOpts(u,this.bits);for(let E=0;E<w.windows&&v!==_0n$5;E++){const{nextN:S,offset:A,isZero:$,isNeg:R}=calcOffsets(v,E,w);if(v=S,!$){const T=g[A];b=b.add(R?T.negate():T)}}return assert0(v),b}getPrecomputes(u,g,v){let b=pointPrecomputes.get(g);return b||(b=this.precomputeWindow(g,u),u!==1&&(typeof v=="function"&&(b=v(b)),pointPrecomputes.set(g,b))),b}cached(u,g,v){const b=getW(u);return this.wNAF(b,this.getPrecomputes(b,u,v),g)}unsafe(u,g,v,b){const w=getW(u);return w===1?this._unsafeLadder(u,g,b):this.wNAFUnsafe(w,this.getPrecomputes(w,u,v),g,b)}createCache(u,g){validateW(g,this.bits),pointWindowSizes.set(u,g),pointPrecomputes.delete(u)}hasCache(u){return getW(u)!==1}};function mulEndoUnsafe(y,u,g,v){let b=u,w=y.ZERO,E=y.ZERO;for(;g>_0n$5||v>_0n$5;)g&_1n$5&&(w=w.add(b)),v&_1n$5&&(E=E.add(b)),b=b.double(),g>>=_1n$5,v>>=_1n$5;return{p1:w,p2:E}}function createField(y,u,g){if(u){if(u.ORDER!==y)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return validateField(u),u}else return Field(y,{isLE:g})}function createCurveFields(y,u,g={},v){if(v===void 0&&(v=y==="edwards"),!u||typeof u!="object")throw new Error(`expected valid ${y} CURVE object`);for(const A of["p","n","h"]){const $=u[A];if(!(typeof $=="bigint"&&$>_0n$5))throw new Error(`CURVE.${A} must be positive bigint`)}const b=createField(u.p,g.Fp,v),w=createField(u.n,g.Fn,v),S=["Gx","Gy","a",y==="weierstrass"?"b":"d"];for(const A of S)if(!b.isValid(u[A]))throw new Error(`CURVE.${A} must be valid field element of CURVE.Fp`);return u=Object.freeze(Object.assign({},u)),{CURVE:u,Fp:b,Fn:w}}function createKeygen$1(y,u){return function(v){const b=y(v);return{secretKey:b,publicKey:u(b)}}}const _0n$4=BigInt(0),_1n$4=BigInt(1),_2n$5=BigInt(2),_8n$1=BigInt(8);function isEdValidXY(y,u,g,v){const b=y.sqr(g),w=y.sqr(v),E=y.add(y.mul(u.a,b),w),S=y.add(y.ONE,y.mul(u.d,y.mul(b,w)));return y.eql(E,S)}function edwards(y,u={}){const g=createCurveFields("edwards",y,u,u.FpFnLE),{Fp:v,Fn:b}=g;let w=g.CURVE;const{h:E}=w;validateObject$1(u,{},{uvRatio:"function"});const S=_2n$5<<BigInt(b.BYTES*8)-_1n$4,A=q=>v.create(q),$=u.uvRatio||((q,J)=>{try{return{isValid:!0,value:v.sqrt(v.div(q,J))}}catch{return{isValid:!1,value:_0n$4}}});if(!isEdValidXY(v,w,w.Gx,w.Gy))throw new Error("bad curve params: generator point");function R(q,J,ie=!1){const oe=ie?_1n$4:_0n$4;return aInRange$1("coordinate "+q,J,oe,S),J}function T(q){if(!(q instanceof F))throw new Error("EdwardsPoint expected")}const O=memoized((q,J)=>{const{X:ie,Y:oe,Z:le}=q,de=q.is0();J==null&&(J=de?_8n$1:v.inv(le));const fe=A(ie*J),ye=A(oe*J),we=v.mul(le,J);if(de)return{x:_0n$4,y:_1n$4};if(we!==_1n$4)throw new Error("invZ was invalid");return{x:fe,y:ye}}),B=memoized(q=>{const{a:J,d:ie}=w;if(q.is0())throw new Error("bad point: ZERO");const{X:oe,Y:le,Z:de,T:fe}=q,ye=A(oe*oe),we=A(le*le),pe=A(de*de),ve=A(pe*pe),he=A(ye*J),ae=A(pe*A(he+we)),Q=A(ve+A(ie*A(ye*we)));if(ae!==Q)throw new Error("bad point: equation left != right (1)");const j=A(oe*le),z=A(de*fe);if(j!==z)throw new Error("bad point: equation left != right (2)");return!0});class F{static BASE=new F(w.Gx,w.Gy,_1n$4,A(w.Gx*w.Gy));static ZERO=new F(_0n$4,_1n$4,_1n$4,_0n$4);static Fp=v;static Fn=b;X;Y;Z;T;constructor(J,ie,oe,le){this.X=R("x",J),this.Y=R("y",ie),this.Z=R("z",oe,!0),this.T=R("t",le),Object.freeze(this)}static CURVE(){return w}static fromAffine(J){if(J instanceof F)throw new Error("extended point not allowed");const{x:ie,y:oe}=J||{};return R("x",ie),R("y",oe),new F(ie,oe,_1n$4,A(ie*oe))}static fromBytes(J,ie=!1){const oe=v.BYTES,{a:le,d:de}=w;J=copyBytes$2(abytes$5(J,oe,"point")),abool$1(ie,"zip215");const fe=copyBytes$2(J),ye=J[oe-1];fe[oe-1]=ye&-129;const we=bytesToNumberLE$1(fe),pe=ie?S:v.ORDER;aInRange$1("point.y",we,_0n$4,pe);const ve=A(we*we),he=A(ve-_1n$4),ae=A(de*ve-le);let{isValid:Q,value:j}=$(he,ae);if(!Q)throw new Error("bad point: invalid y coordinate");const z=(j&_1n$4)===_1n$4,re=(ye&128)!==0;if(!ie&&j===_0n$4&&re)throw new Error("bad point: x=0 and x_0=1");return re!==z&&(j=A(-j)),F.fromAffine({x:j,y:we})}static fromHex(J,ie=!1){return F.fromBytes(hexToBytes$3(J),ie)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(J=8,ie=!0){return U.createCache(this,J),ie||this.multiply(_2n$5),this}assertValidity(){B(this)}equals(J){T(J);const{X:ie,Y:oe,Z:le}=this,{X:de,Y:fe,Z:ye}=J,we=A(ie*ye),pe=A(de*le),ve=A(oe*ye),he=A(fe*le);return we===pe&&ve===he}is0(){return this.equals(F.ZERO)}negate(){return new F(A(-this.X),this.Y,this.Z,A(-this.T))}double(){const{a:J}=w,{X:ie,Y:oe,Z:le}=this,de=A(ie*ie),fe=A(oe*oe),ye=A(_2n$5*A(le*le)),we=A(J*de),pe=ie+oe,ve=A(A(pe*pe)-de-fe),he=we+fe,ae=he-ye,Q=we-fe,j=A(ve*ae),z=A(he*Q),re=A(ve*Q),Y=A(ae*he);return new F(j,z,Y,re)}add(J){T(J);const{a:ie,d:oe}=w,{X:le,Y:de,Z:fe,T:ye}=this,{X:we,Y:pe,Z:ve,T:he}=J,ae=A(le*we),Q=A(de*pe),j=A(ye*oe*he),z=A(fe*ve),re=A((le+de)*(we+pe)-ae-Q),Y=z-j,te=z+j,ne=A(Q-ie*ae),se=A(re*Y),ee=A(te*ne),Z=A(re*ne),ue=A(Y*te);return new F(se,ee,ue,Z)}subtract(J){return this.add(J.negate())}multiply(J){if(!b.isValidNot0(J))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:ie,f:oe}=U.cached(this,J,le=>normalizeZ(F,le));return normalizeZ(F,[ie,oe])[0]}multiplyUnsafe(J,ie=F.ZERO){if(!b.isValid(J))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return J===_0n$4?F.ZERO:this.is0()||J===_1n$4?this:U.unsafe(this,J,oe=>normalizeZ(F,oe),ie)}isSmallOrder(){return this.multiplyUnsafe(E).is0()}isTorsionFree(){return U.unsafe(this,w.n).is0()}toAffine(J){return O(this,J)}clearCofactor(){return E===_1n$4?this:this.multiplyUnsafe(E)}toBytes(){const{x:J,y:ie}=this.toAffine(),oe=v.toBytes(ie);return oe[oe.length-1]|=J&_1n$4?128:0,oe}toHex(){return bytesToHex$3(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}const U=new wNAF$1(F,b.BITS);return F.BASE.precompute(8),F}function eddsa(y,u,g={}){if(typeof u!="function")throw new Error('"hash" function param is required');validateObject$1(g,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:v}=g,{BASE:b,Fp:w,Fn:E}=y,S=g.randomBytes||randomBytes$2,A=g.adjustScalarBytes||(we=>we),$=g.domain||((we,pe,ve)=>{if(abool$1(ve,"phflag"),pe.length||ve)throw new Error("Contexts/pre-hash are not supported");return we});function R(we){return E.create(bytesToNumberLE$1(we))}function T(we){const pe=oe.secretKey;abytes$5(we,oe.secretKey,"secretKey");const ve=abytes$5(u(we),2*pe,"hashedSecretKey"),he=A(ve.slice(0,pe)),ae=ve.slice(pe,2*pe),Q=R(he);return{head:he,prefix:ae,scalar:Q}}function O(we){const{head:pe,prefix:ve,scalar:he}=T(we),ae=b.multiply(he),Q=ae.toBytes();return{head:pe,prefix:ve,scalar:he,point:ae,pointBytes:Q}}function B(we){return O(we).pointBytes}function F(we=Uint8Array.of(),...pe){const ve=concatBytes$1(...pe);return R(u($(ve,abytes$5(we,void 0,"context"),!!v)))}function U(we,pe,ve={}){we=abytes$5(we,void 0,"message"),v&&(we=v(we));const{prefix:he,scalar:ae,pointBytes:Q}=O(pe),j=F(ve.context,he,we),z=b.multiply(j).toBytes(),re=F(ve.context,z,Q,we),Y=E.create(j+re*ae);if(!E.isValid(Y))throw new Error("sign failed: invalid s");const te=concatBytes$1(z,E.toBytes(Y));return abytes$5(te,oe.signature,"result")}const q={zip215:!0};function J(we,pe,ve,he=q){const{context:ae,zip215:Q}=he,j=oe.signature;we=abytes$5(we,j,"signature"),pe=abytes$5(pe,void 0,"message"),ve=abytes$5(ve,oe.publicKey,"publicKey"),Q!==void 0&&abool$1(Q,"zip215"),v&&(pe=v(pe));const z=j/2,re=we.subarray(0,z),Y=bytesToNumberLE$1(we.subarray(z,j));let te,ne,se;try{te=y.fromBytes(ve,Q),ne=y.fromBytes(re,Q),se=b.multiplyUnsafe(Y)}catch{return!1}if(!Q&&te.isSmallOrder())return!1;const ee=F(ae,ne.toBytes(),te.toBytes(),pe);return ne.add(te.multiplyUnsafe(ee)).subtract(se).clearCofactor().is0()}const ie=w.BYTES,oe={secretKey:ie,publicKey:ie,signature:2*ie,seed:ie};function le(we=S(oe.seed)){return abytes$5(we,oe.seed,"seed")}function de(we){return isBytes$6(we)&&we.length===E.BYTES}function fe(we,pe){try{return!!y.fromBytes(we,pe)}catch{return!1}}const ye={getExtendedPublicKey:O,randomSecretKey:le,isValidSecretKey:de,isValidPublicKey:fe,toMontgomery(we){const{y:pe}=y.fromBytes(we),ve=oe.publicKey,he=ve===32;if(!he&&ve!==57)throw new Error("only defined for 25519 and 448");const ae=he?w.div(_1n$4+pe,_1n$4-pe):w.div(pe-_1n$4,pe+_1n$4);return w.toBytes(ae)},toMontgomerySecret(we){const pe=oe.secretKey;abytes$5(we,pe);const ve=u(we.subarray(0,pe));return A(ve).subarray(0,pe)}};return Object.freeze({keygen:createKeygen$1(le,B),getPublicKey:B,sign:U,verify:J,utils:ye,Point:y,lengths:oe})}const _1n$3=BigInt(1),_2n$4=BigInt(2),_5n$1=BigInt(5),_8n=BigInt(8),ed25519_CURVE_p$1=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),ed25519_CURVE$1={p:ed25519_CURVE_p$1,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:_8n,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function ed25519_pow_2_252_3$1(y){const u=BigInt(10),g=BigInt(20),v=BigInt(40),b=BigInt(80),w=ed25519_CURVE_p$1,S=y*y%w*y%w,A=pow2$2(S,_2n$4,w)*S%w,$=pow2$2(A,_1n$3,w)*y%w,R=pow2$2($,_5n$1,w)*$%w,T=pow2$2(R,u,w)*R%w,O=pow2$2(T,g,w)*T%w,B=pow2$2(O,v,w)*O%w,F=pow2$2(B,b,w)*B%w,U=pow2$2(F,b,w)*B%w,q=pow2$2(U,u,w)*R%w;return{pow_p_5_8:pow2$2(q,_2n$4,w)*y%w,b2:S}}function adjustScalarBytes$1(y){return y[0]&=248,y[31]&=127,y[31]|=64,y}const ED25519_SQRT_M1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function uvRatio$1(y,u){const g=ed25519_CURVE_p$1,v=mod$1(u*u*u,g),b=mod$1(v*v*u,g),w=ed25519_pow_2_252_3$1(y*b).pow_p_5_8;let E=mod$1(y*v*w,g);const S=mod$1(u*E*E,g),A=E,$=mod$1(E*ED25519_SQRT_M1,g),R=S===y,T=S===mod$1(-y,g),O=S===mod$1(-y*ED25519_SQRT_M1,g);return R&&(E=A),(T||O)&&(E=$),isNegativeLE(E,g)&&(E=mod$1(-E,g)),{isValid:R||T,value:E}}const ed25519_Point=edwards(ed25519_CURVE$1,{uvRatio:uvRatio$1});function ed(y){return eddsa(ed25519_Point,sha512$3,Object.assign({adjustScalarBytes:adjustScalarBytes$1},y))}const ed25519=ed({}),PUBLIC_KEY_BYTE_LENGTH=32,PRIVATE_KEY_BYTE_LENGTH$1=64,KEYS_BYTE_LENGTH=32;let ed25519Supported;const webCryptoEd25519SupportedPromise=(async()=>{try{return await webcrypto.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();function generateKey(){const y=ed25519.utils.randomSecretKey(),u=ed25519.getPublicKey(y);return{privateKey:concatKeys(y,u),publicKey:u}}function generateKeyFromSeed(y){if(y.length!==KEYS_BYTE_LENGTH)throw new TypeError('"seed" must be 32 bytes in length.');if(!(y instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const u=y,g=ed25519.getPublicKey(u);return{privateKey:concatKeys(u,g),publicKey:g}}async function hashAndSignWebCrypto(y,u){let g;y.length===PRIVATE_KEY_BYTE_LENGTH$1?g=y.subarray(0,32):g=y;const v={crv:"Ed25519",kty:"OKP",x:toString$3(y.subarray(32),"base64url"),d:toString$3(g,"base64url"),ext:!0,key_ops:["sign"]},b=await webcrypto.get().subtle.importKey("jwk",v,{name:"Ed25519"},!0,["sign"]),w=await webcrypto.get().subtle.sign({name:"Ed25519"},b,u instanceof Uint8Array?u:u.subarray());return new Uint8Array(w,0,w.byteLength)}function hashAndSignNoble(y,u){const g=y.subarray(0,KEYS_BYTE_LENGTH);return ed25519.sign(u instanceof Uint8Array?u:u.subarray(),g)}async function hashAndSign$2(y,u){return ed25519Supported==null&&(ed25519Supported=await webCryptoEd25519SupportedPromise),ed25519Supported?hashAndSignWebCrypto(y,u):hashAndSignNoble(y,u)}async function hashAndVerifyWebCrypto(y,u,g){if(y.buffer instanceof ArrayBuffer){const v=await webcrypto.get().subtle.importKey("raw",y.buffer,{name:"Ed25519"},!1,["verify"]);return await webcrypto.get().subtle.verify({name:"Ed25519"},v,u,g instanceof Uint8Array?g:g.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function hashAndVerifyNoble(y,u,g){return ed25519.verify(u,g instanceof Uint8Array?g:g.subarray(),y)}async function hashAndVerify$2(y,u,g){return ed25519Supported==null&&(ed25519Supported=await webCryptoEd25519SupportedPromise),ed25519Supported?hashAndVerifyWebCrypto(y,u,g):hashAndVerifyNoble(y,u,g)}function concatKeys(y,u){const g=new Uint8Array(PRIVATE_KEY_BYTE_LENGTH$1);for(let v=0;v<KEYS_BYTE_LENGTH;v++)g[v]=y[v],g[KEYS_BYTE_LENGTH+v]=u[v];return g}function isPromise$6(y){return y==null?!1:typeof y.then=="function"&&typeof y.catch=="function"&&typeof y.finally=="function"}class Ed25519PublicKey{type="Ed25519";raw;constructor(u){this.raw=ensureEd25519Key(u,PUBLIC_KEY_BYTE_LENGTH)}toMultihash(){return identity.digest(publicKeyToProtobuf(this))}toCID(){return CID.createV1(114,this.toMultihash())}toString(){return base58btc.encode(this.toMultihash().bytes).substring(1)}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}verify(u,g,v){v?.signal?.throwIfAborted();const b=hashAndVerify$2(this.raw,g,u);return isPromise$6(b)?b.then(w=>(v?.signal?.throwIfAborted(),w)):b}}class Ed25519PrivateKey{type="Ed25519";raw;publicKey;constructor(u,g){this.raw=ensureEd25519Key(u,PRIVATE_KEY_BYTE_LENGTH$1),this.publicKey=new Ed25519PublicKey(g)}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}sign(u,g){g?.signal?.throwIfAborted();const v=hashAndSign$2(this.raw,u);return isPromise$6(v)?v.then(b=>(g?.signal?.throwIfAborted(),b)):(g?.signal?.throwIfAborted(),v)}}function unmarshalEd25519PrivateKey(y){if(y.length>PRIVATE_KEY_BYTE_LENGTH$1){y=ensureEd25519Key(y,PRIVATE_KEY_BYTE_LENGTH$1+PUBLIC_KEY_BYTE_LENGTH);const v=y.subarray(0,PRIVATE_KEY_BYTE_LENGTH$1),b=y.subarray(PRIVATE_KEY_BYTE_LENGTH$1,y.length);return new Ed25519PrivateKey(v,b)}y=ensureEd25519Key(y,PRIVATE_KEY_BYTE_LENGTH$1);const u=y.subarray(0,PRIVATE_KEY_BYTE_LENGTH$1),g=y.subarray(PUBLIC_KEY_BYTE_LENGTH);return new Ed25519PrivateKey(u,g)}function unmarshalEd25519PublicKey(y){return y=ensureEd25519Key(y,PUBLIC_KEY_BYTE_LENGTH),new Ed25519PublicKey(y)}async function generateEd25519KeyPair(){const{privateKey:y,publicKey:u}=generateKey();return new Ed25519PrivateKey(y,u)}async function generateEd25519KeyPairFromSeed(y){const{privateKey:u,publicKey:g}=generateKeyFromSeed(y);return new Ed25519PrivateKey(u,g)}function ensureEd25519Key(y,u){if(y=Uint8Array.from(y??[]),y.length!==u)throw new InvalidParametersError$1(`Key must be a Uint8Array of length ${u}, got ${y.length}`);return y}const N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),MSB$1=128,REST$1=127;function encodingLength(y){if(y<N1)return 1;if(y<N2)return 2;if(y<N3)return 3;if(y<N4)return 4;if(y<N5)return 5;if(y<N6)return 6;if(y<N7)return 7;if(Number.MAX_SAFE_INTEGER!=null&&y>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function encodeUint8Array(y,u,g=0){switch(encodingLength(y)){case 8:u[g++]=y&255|MSB$1,y/=128;case 7:u[g++]=y&255|MSB$1,y/=128;case 6:u[g++]=y&255|MSB$1,y/=128;case 5:u[g++]=y&255|MSB$1,y/=128;case 4:u[g++]=y&255|MSB$1,y>>>=7;case 3:u[g++]=y&255|MSB$1,y>>>=7;case 2:u[g++]=y&255|MSB$1,y>>>=7;case 1:{u[g++]=y&255,y>>>=7;break}default:throw new Error("unreachable")}return u}function encodeUint8ArrayList(y,u,g=0){switch(encodingLength(y)){case 8:u.set(g++,y&255|MSB$1),y/=128;case 7:u.set(g++,y&255|MSB$1),y/=128;case 6:u.set(g++,y&255|MSB$1),y/=128;case 5:u.set(g++,y&255|MSB$1),y/=128;case 4:u.set(g++,y&255|MSB$1),y>>>=7;case 3:u.set(g++,y&255|MSB$1),y>>>=7;case 2:u.set(g++,y&255|MSB$1),y>>>=7;case 1:{u.set(g++,y&255),y>>>=7;break}default:throw new Error("unreachable")}return u}function decodeUint8Array(y,u){let g=y[u],v=0;if(v+=g&REST$1,g<MSB$1||(g=y[u+1],v+=(g&REST$1)<<7,g<MSB$1)||(g=y[u+2],v+=(g&REST$1)<<14,g<MSB$1)||(g=y[u+3],v+=(g&REST$1)<<21,g<MSB$1)||(g=y[u+4],v+=(g&REST$1)*N4,g<MSB$1)||(g=y[u+5],v+=(g&REST$1)*N5,g<MSB$1)||(g=y[u+6],v+=(g&REST$1)*N6,g<MSB$1)||(g=y[u+7],v+=(g&REST$1)*N7,g<MSB$1))return v;throw new RangeError("Could not decode varint")}function decodeUint8ArrayList(y,u){let g=y.get(u),v=0;if(v+=g&REST$1,g<MSB$1||(g=y.get(u+1),v+=(g&REST$1)<<7,g<MSB$1)||(g=y.get(u+2),v+=(g&REST$1)<<14,g<MSB$1)||(g=y.get(u+3),v+=(g&REST$1)<<21,g<MSB$1)||(g=y.get(u+4),v+=(g&REST$1)*N4,g<MSB$1)||(g=y.get(u+5),v+=(g&REST$1)*N5,g<MSB$1)||(g=y.get(u+6),v+=(g&REST$1)*N6,g<MSB$1)||(g=y.get(u+7),v+=(g&REST$1)*N7,g<MSB$1))return v;throw new RangeError("Could not decode varint")}function encode$9(y,u,g=0){return u==null&&(u=allocUnsafe(encodingLength(y))),u instanceof Uint8Array?encodeUint8Array(y,u,g):encodeUint8ArrayList(y,u,g)}function decode$7(y,u=0){return y instanceof Uint8Array?decodeUint8Array(y,u):decodeUint8ArrayList(y,u)}const f32=new Float32Array([-0]),f8b=new Uint8Array(f32.buffer);function writeFloatLE(y,u,g){f32[0]=y,u[g]=f8b[0],u[g+1]=f8b[1],u[g+2]=f8b[2],u[g+3]=f8b[3]}function readFloatLE(y,u){return f8b[0]=y[u],f8b[1]=y[u+1],f8b[2]=y[u+2],f8b[3]=y[u+3],f32[0]}const f64=new Float64Array([-0]),d8b=new Uint8Array(f64.buffer);function writeDoubleLE(y,u,g){f64[0]=y,u[g]=d8b[0],u[g+1]=d8b[1],u[g+2]=d8b[2],u[g+3]=d8b[3],u[g+4]=d8b[4],u[g+5]=d8b[5],u[g+6]=d8b[6],u[g+7]=d8b[7]}function readDoubleLE(y,u){return d8b[0]=y[u],d8b[1]=y[u+1],d8b[2]=y[u+2],d8b[3]=y[u+3],d8b[4]=y[u+4],d8b[5]=y[u+5],d8b[6]=y[u+6],d8b[7]=y[u+7],f64[0]}const MAX_SAFE_NUMBER_INTEGER=BigInt(Number.MAX_SAFE_INTEGER),MIN_SAFE_NUMBER_INTEGER=BigInt(Number.MIN_SAFE_INTEGER);class LongBits{lo;hi;constructor(u,g){this.lo=u|0,this.hi=g|0}toNumber(u=!1){if(!u&&this.hi>>>31>0){const g=~this.lo+1>>>0;let v=~this.hi>>>0;return g===0&&(v=v+1>>>0),-(g+v*4294967296)}return this.lo+this.hi*4294967296}toBigInt(u=!1){if(u)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const g=~this.lo+1>>>0;let v=~this.hi>>>0;return g===0&&(v=v+1>>>0),-(BigInt(g)+(BigInt(v)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(u=!1){return this.toBigInt(u).toString()}zzEncode(){const u=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^u)>>>0,this.lo=(this.lo<<1^u)>>>0,this}zzDecode(){const u=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^u)>>>0,this.hi=(this.hi>>>1^u)>>>0,this}length(){const u=this.lo,g=(this.lo>>>28|this.hi<<4)>>>0,v=this.hi>>>24;return v===0?g===0?u<16384?u<128?1:2:u<2097152?3:4:g<16384?g<128?5:6:g<2097152?7:8:v<128?9:10}static fromBigInt(u){if(u===0n)return zero;if(u<MAX_SAFE_NUMBER_INTEGER&&u>MIN_SAFE_NUMBER_INTEGER)return this.fromNumber(Number(u));const g=u<0n;g&&(u=-u);let v=u>>32n,b=u-(v<<32n);return g&&(v=~v|0n,b=~b|0n,++b>TWO_32&&(b=0n,++v>TWO_32&&(v=0n))),new LongBits(Number(b),Number(v))}static fromNumber(u){if(u===0)return zero;const g=u<0;g&&(u=-u);let v=u>>>0,b=(u-v)/4294967296>>>0;return g&&(b=~b>>>0,v=~v>>>0,++v>4294967295&&(v=0,++b>4294967295&&(b=0))),new LongBits(v,b)}static from(u){return typeof u=="number"?LongBits.fromNumber(u):typeof u=="bigint"?LongBits.fromBigInt(u):typeof u=="string"?LongBits.fromBigInt(BigInt(u)):u.low!=null||u.high!=null?new LongBits(u.low>>>0,u.high>>>0):zero}}const zero=new LongBits(0,0);zero.toBigInt=function(){return 0n};zero.zzEncode=zero.zzDecode=function(){return this};zero.length=function(){return 1};const TWO_32=4294967296n;function length$1(y){let u=0,g=0;for(let v=0;v<y.length;++v)g=y.charCodeAt(v),g<128?u+=1:g<2048?u+=2:(g&64512)===55296&&(y.charCodeAt(v+1)&64512)===56320?(++v,u+=4):u+=3;return u}function read(y,u,g){if(g-u<1)return"";let b;const w=[];let E=0,S;for(;u<g;)S=y[u++],S<128?w[E++]=S:S>191&&S<224?w[E++]=(S&31)<<6|y[u++]&63:S>239&&S<365?(S=((S&7)<<18|(y[u++]&63)<<12|(y[u++]&63)<<6|y[u++]&63)-65536,w[E++]=55296+(S>>10),w[E++]=56320+(S&1023)):w[E++]=(S&15)<<12|(y[u++]&63)<<6|y[u++]&63,E>8191&&((b??(b=[])).push(String.fromCharCode.apply(String,w)),E=0);return b!=null?(E>0&&b.push(String.fromCharCode.apply(String,w.slice(0,E))),b.join("")):String.fromCharCode.apply(String,w.slice(0,E))}function write(y,u,g){const v=g;let b,w;for(let E=0;E<y.length;++E)b=y.charCodeAt(E),b<128?u[g++]=b:b<2048?(u[g++]=b>>6|192,u[g++]=b&63|128):(b&64512)===55296&&((w=y.charCodeAt(E+1))&64512)===56320?(b=65536+((b&1023)<<10)+(w&1023),++E,u[g++]=b>>18|240,u[g++]=b>>12&63|128,u[g++]=b>>6&63|128,u[g++]=b&63|128):(u[g++]=b>>12|224,u[g++]=b>>6&63|128,u[g++]=b&63|128);return g-v}function indexOutOfRange(y,u){return RangeError(`index out of range: ${y.pos} + ${u??1} > ${y.len}`)}function readFixed32End(y,u){return(y[u-4]|y[u-3]<<8|y[u-2]<<16|y[u-1]<<24)>>>0}class Uint8ArrayReader{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(u){this.buf=u,this.pos=0,this.len=u.length}uint32(){let u=4294967295;if(u=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(u=(u|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(u=(u|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(u=(u|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(u=(u|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return u;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return u}int32(){return this.uint32()|0}sint32(){const u=this.uint32();return u>>>1^-(u&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);const u=readFloatLE(this.buf,this.pos);return this.pos+=4,u}double(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);const u=readDoubleLE(this.buf,this.pos);return this.pos+=8,u}bytes(){const u=this.uint32(),g=this.pos,v=this.pos+u;if(v>this.len)throw indexOutOfRange(this,u);return this.pos+=u,g===v?new Uint8Array(0):this.buf.subarray(g,v)}string(){const u=this.bytes();return read(u,0,u.length)}skip(u){if(typeof u=="number"){if(this.pos+u>this.len)throw indexOutOfRange(this,u);this.pos+=u}else do if(this.pos>=this.len)throw indexOutOfRange(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(u){switch(u){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(u=this.uint32()&7)!==4;)this.skipType(u);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${u} at offset ${this.pos}`)}return this}readLongVarint(){const u=new LongBits(0,0);let g=0;if(this.len-this.pos>4){for(;g<4;++g)if(u.lo=(u.lo|(this.buf[this.pos]&127)<<g*7)>>>0,this.buf[this.pos++]<128)return u;if(u.lo=(u.lo|(this.buf[this.pos]&127)<<28)>>>0,u.hi=(u.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return u;g=0}else{for(;g<3;++g){if(this.pos>=this.len)throw indexOutOfRange(this);if(u.lo=(u.lo|(this.buf[this.pos]&127)<<g*7)>>>0,this.buf[this.pos++]<128)return u}return u.lo=(u.lo|(this.buf[this.pos++]&127)<<g*7)>>>0,u}if(this.len-this.pos>4){for(;g<5;++g)if(u.hi=(u.hi|(this.buf[this.pos]&127)<<g*7+3)>>>0,this.buf[this.pos++]<128)return u}else for(;g<5;++g){if(this.pos>=this.len)throw indexOutOfRange(this);if(u.hi=(u.hi|(this.buf[this.pos]&127)<<g*7+3)>>>0,this.buf[this.pos++]<128)return u}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);const u=readFixed32End(this.buf,this.pos+=4),g=readFixed32End(this.buf,this.pos+=4);return new LongBits(u,g)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const u=decodeUint8Array(this.buf,this.pos);return this.pos+=encodingLength(u),u}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function createReader(y){return new Uint8ArrayReader(y instanceof Uint8Array?y:y.subarray())}function decodeMessage$1(y,u,g){const v=createReader(y);return u.decode(v,void 0,g)}function pool(y){let v,b=8192;return function(E){if(E<1||E>4096)return allocUnsafe(E);b+E>8192&&(v=allocUnsafe(8192),b=0);const S=v.subarray(b,b+=E);return(b&7)!==0&&(b=(b|7)+1),S}}class Op{fn;len;next;val;constructor(u,g,v){this.fn=u,this.len=g,this.next=void 0,this.val=v}}function noop(){}class State{head;tail;len;next;constructor(u){this.head=u.head,this.tail=u.tail,this.len=u.len,this.next=u.states}}const bufferPool=pool();function alloc$1(y){return globalThis.Buffer!=null?allocUnsafe(y):bufferPool(y)}class Uint8ArrayWriter{len;head;tail;states;constructor(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}_push(u,g,v){return this.tail=this.tail.next=new Op(u,g,v),this.len+=g,this}uint32(u){return this.len+=(this.tail=this.tail.next=new VarintOp((u=u>>>0)<128?1:u<16384?2:u<2097152?3:u<268435456?4:5,u)).len,this}int32(u){return u<0?this._push(writeVarint64,10,LongBits.fromNumber(u)):this.uint32(u)}sint32(u){return this.uint32((u<<1^u>>31)>>>0)}uint64(u){const g=LongBits.fromBigInt(u);return this._push(writeVarint64,g.length(),g)}uint64Number(u){return this._push(encodeUint8Array,encodingLength(u),u)}uint64String(u){return this.uint64(BigInt(u))}int64(u){return this.uint64(u)}int64Number(u){return this.uint64Number(u)}int64String(u){return this.uint64String(u)}sint64(u){const g=LongBits.fromBigInt(u).zzEncode();return this._push(writeVarint64,g.length(),g)}sint64Number(u){const g=LongBits.fromNumber(u).zzEncode();return this._push(writeVarint64,g.length(),g)}sint64String(u){return this.sint64(BigInt(u))}bool(u){return this._push(writeByte,1,u?1:0)}fixed32(u){return this._push(writeFixed32,4,u>>>0)}sfixed32(u){return this.fixed32(u)}fixed64(u){const g=LongBits.fromBigInt(u);return this._push(writeFixed32,4,g.lo)._push(writeFixed32,4,g.hi)}fixed64Number(u){const g=LongBits.fromNumber(u);return this._push(writeFixed32,4,g.lo)._push(writeFixed32,4,g.hi)}fixed64String(u){return this.fixed64(BigInt(u))}sfixed64(u){return this.fixed64(u)}sfixed64Number(u){return this.fixed64Number(u)}sfixed64String(u){return this.fixed64String(u)}float(u){return this._push(writeFloatLE,4,u)}double(u){return this._push(writeDoubleLE,8,u)}bytes(u){const g=u.length>>>0;return g===0?this._push(writeByte,1,0):this.uint32(g)._push(writeBytes,g,u)}string(u){const g=length$1(u);return g!==0?this.uint32(g)._push(write,g,u):this._push(writeByte,1,0)}fork(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this}ldelim(){const u=this.head,g=this.tail,v=this.len;return this.reset().uint32(v),v!==0&&(this.tail.next=u.next,this.tail=g,this.len+=v),this}finish(){let u=this.head.next;const g=alloc$1(this.len);let v=0;for(;u!=null;)u.fn(u.val,g,v),v+=u.len,u=u.next;return g}}function writeByte(y,u,g){u[g]=y&255}function writeVarint32(y,u,g){for(;y>127;)u[g++]=y&127|128,y>>>=7;u[g]=y}class VarintOp extends Op{next;constructor(u,g){super(writeVarint32,u,g),this.next=void 0}}function writeVarint64(y,u,g){for(;y.hi!==0;)u[g++]=y.lo&127|128,y.lo=(y.lo>>>7|y.hi<<25)>>>0,y.hi>>>=7;for(;y.lo>127;)u[g++]=y.lo&127|128,y.lo=y.lo>>>7;u[g++]=y.lo}function writeFixed32(y,u,g){u[g]=y&255,u[g+1]=y>>>8&255,u[g+2]=y>>>16&255,u[g+3]=y>>>24}function writeBytes(y,u,g){u.set(y,g)}globalThis.Buffer!=null&&(Uint8ArrayWriter.prototype.bytes=function(y){const u=y.length>>>0;return this.uint32(u),u>0&&this._push(writeBytesBuffer,u,y),this},Uint8ArrayWriter.prototype.string=function(y){const u=globalThis.Buffer.byteLength(y);return this.uint32(u),u>0&&this._push(writeStringBuffer,u,y),this});function writeBytesBuffer(y,u,g){u.set(y,g)}function writeStringBuffer(y,u,g){y.length<40?write(y,u,g):u.utf8Write!=null?u.utf8Write(y,g):u.set(fromString$1(y),g)}function createWriter(){return new Uint8ArrayWriter}function encodeMessage$1(y,u){const g=createWriter();return u.encode(y,g,{lengthDelimited:!1}),g.finish()}var CODEC_TYPES;(function(y){y[y.VARINT=0]="VARINT",y[y.BIT64=1]="BIT64",y[y.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",y[y.START_GROUP=3]="START_GROUP",y[y.END_GROUP=4]="END_GROUP",y[y.BIT32=5]="BIT32"})(CODEC_TYPES||(CODEC_TYPES={}));function createCodec(y,u,g,v){return{name:y,type:u,encode:g,decode:v}}function enumeration(y){function u(b){if(y[b.toString()]==null)throw new Error("Invalid enum value");return y[b]}const g=function(w,E){const S=u(w);E.int32(S)},v=function(w){const E=w.int32();return u(E)};return createCodec("enum",CODEC_TYPES.VARINT,g,v)}function message(y,u){return createCodec("message",CODEC_TYPES.LENGTH_DELIMITED,y,u)}class MaxLengthError extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"}class MaxSizeError extends Error{code="ERR_MAX_SIZE";name="MaxSizeError"}var KeyType;(function(y){y.RSA="RSA",y.Ed25519="Ed25519",y.secp256k1="secp256k1",y.ECDSA="ECDSA"})(KeyType||(KeyType={}));var __KeyTypeValues;(function(y){y[y.RSA=0]="RSA",y[y.Ed25519=1]="Ed25519",y[y.secp256k1=2]="secp256k1",y[y.ECDSA=3]="ECDSA"})(__KeyTypeValues||(__KeyTypeValues={}));(function(y){y.codec=()=>enumeration(__KeyTypeValues)})(KeyType||(KeyType={}));var PublicKey$1;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.Type!=null&&(v.uint32(8),KeyType.codec().encode(g.Type,v)),g.Data!=null&&(v.uint32(18),v.bytes(g.Data)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.Type=KeyType.codec().decode(g);break}case 2:{w.Data=g.bytes();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(PublicKey$1||(PublicKey$1={}));var PrivateKey$1;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.Type!=null&&(v.uint32(8),KeyType.codec().encode(g.Type,v)),g.Data!=null&&(v.uint32(18),v.bytes(g.Data)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.Type=KeyType.codec().decode(g);break}case 2:{w.Data=g.bytes();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(PrivateKey$1||(PrivateKey$1={}));function randomBytes$1(y){if(isNaN(y)||y<=0)throw new InvalidParametersError$1("random bytes length must be a Number bigger than 0");return randomBytes$2(y)}let RSAPublicKey$1=class{type="RSA";jwk;_raw;_multihash;constructor(u,g){this.jwk=u,this._multihash=g}get raw(){return this._raw==null&&(this._raw=jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return CID.createV1(114,this._multihash)}toString(){return base58btc.encode(this.toMultihash().bytes).substring(1)}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}verify(u,g,v){return hashAndVerify$1(this.jwk,g,u,v)}},RSAPrivateKey$1=class{type="RSA";jwk;_raw;publicKey;constructor(u,g){this.jwk=u,this.publicKey=g}get raw(){return this._raw==null&&(this._raw=jwkToPkcs1(this.jwk)),this._raw}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}sign(u,g){return hashAndSign$1(this.jwk,u,g)}};const MAX_RSA_KEY_SIZE=8192,SHA2_256_CODE=18,MAX_RSA_JWK_SIZE=1062,RSA_ALGORITHM_IDENTIFIER=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function pkcs1MessageToJwk(y){return{n:toString$3(y[1],"base64url"),e:toString$3(y[2],"base64url"),d:toString$3(y[3],"base64url"),p:toString$3(y[4],"base64url"),q:toString$3(y[5],"base64url"),dp:toString$3(y[6],"base64url"),dq:toString$3(y[7],"base64url"),qi:toString$3(y[8],"base64url"),kty:"RSA"}}function jwkToPkcs1(y){if(y.n==null||y.e==null||y.d==null||y.p==null||y.q==null||y.dp==null||y.dq==null||y.qi==null)throw new InvalidParametersError$1("JWK was missing components");return encodeSequence([encodeInteger(Uint8Array.from([0])),encodeInteger(fromString$1(y.n,"base64url")),encodeInteger(fromString$1(y.e,"base64url")),encodeInteger(fromString$1(y.d,"base64url")),encodeInteger(fromString$1(y.p,"base64url")),encodeInteger(fromString$1(y.q,"base64url")),encodeInteger(fromString$1(y.dp,"base64url")),encodeInteger(fromString$1(y.dq,"base64url")),encodeInteger(fromString$1(y.qi,"base64url"))]).subarray()}function pkixMessageToJwk(y){const u=decodeDer(y[1],{offset:0});return{kty:"RSA",n:toString$3(u[0],"base64url"),e:toString$3(u[1],"base64url")}}function jwkToPkix(y){if(y.n==null||y.e==null)throw new InvalidParametersError$1("JWK was missing components");return encodeSequence([RSA_ALGORITHM_IDENTIFIER,encodeBitString(encodeSequence([encodeInteger(fromString$1(y.n,"base64url")),encodeInteger(fromString$1(y.e,"base64url"))]))]).subarray()}function pkcs1ToRSAPrivateKey(y){const u=decodeDer(y);return pkcs1MessageToRSAPrivateKey(u)}function pkcs1MessageToRSAPrivateKey(y){const u=pkcs1MessageToJwk(y);return jwkToRSAPrivateKey(u)}function pkixToRSAPublicKey(y,u){if(y.byteLength>=MAX_RSA_JWK_SIZE)throw new InvalidPublicKeyError("Key size is too large");const g=decodeDer(y,{offset:0});return pkixMessageToRSAPublicKey(g,y,u)}function pkixMessageToRSAPublicKey(y,u,g){const v=pkixMessageToJwk(y);if(g==null){const b=sha256$3(PublicKey$1.encode({Type:KeyType.RSA,Data:u}));g=create$5(SHA2_256_CODE,b)}return new RSAPublicKey$1(v,g)}function jwkToRSAPrivateKey(y){if(rsaKeySize(y)>MAX_RSA_KEY_SIZE)throw new InvalidParametersError$1("Key size is too large");const u=jwkToJWKKeyPair(y),g=sha256$3(PublicKey$1.encode({Type:KeyType.RSA,Data:jwkToPkix(u.publicKey)})),v=create$5(SHA2_256_CODE,g);return new RSAPrivateKey$1(u.privateKey,new RSAPublicKey$1(u.publicKey,v))}async function generateRSAKeyPair(y){if(y>MAX_RSA_KEY_SIZE)throw new InvalidParametersError$1("Key size is too large");const u=await generateRSAKey(y),g=sha256$3(PublicKey$1.encode({Type:KeyType.RSA,Data:jwkToPkix(u.publicKey)})),v=create$5(SHA2_256_CODE,g);return new RSAPrivateKey$1(u.privateKey,new RSAPublicKey$1(u.publicKey,v))}function jwkToJWKKeyPair(y){if(y==null)throw new InvalidParametersError$1("Missing key parameter");return{privateKey:y,publicKey:{kty:y.kty,n:y.n,e:y.e}}}async function generateRSAKey(y,u){const g=await webcrypto.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:y,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),v=await exportKey(g);return{privateKey:v[0],publicKey:v[1]}}async function hashAndSign$1(y,u,g){const v=await webcrypto.get().subtle.importKey("jwk",y,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);g?.signal?.throwIfAborted();const b=await webcrypto.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},v,u instanceof Uint8Array?u:u.subarray());return g?.signal?.throwIfAborted(),new Uint8Array(b,0,b.byteLength)}async function hashAndVerify$1(y,u,g,v){const b=await webcrypto.get().subtle.importKey("jwk",y,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);v?.signal?.throwIfAborted();const w=await webcrypto.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},b,u,g instanceof Uint8Array?g:g.subarray());return v?.signal?.throwIfAborted(),w}async function exportKey(y,u){if(y.privateKey==null||y.publicKey==null)throw new InvalidParametersError$1("Private and public key are required");return await Promise.all([webcrypto.get().subtle.exportKey("jwk",y.privateKey),webcrypto.get().subtle.exportKey("jwk",y.publicKey)])}function rsaKeySize(y){if(y.kty!=="RSA")throw new InvalidParametersError$1("invalid key type");if(y.n==null)throw new InvalidParametersError$1("invalid key modulus");return fromString$1(y.n,"base64url").length*8}let _HMAC$2=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(u,g){if(ahash$3(u),abytes$5(g,void 0,"key"),this.iHash=u.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const v=this.blockLen,b=new Uint8Array(v);b.set(g.length>v?u.create().update(g).digest():g);for(let w=0;w<b.length;w++)b[w]^=54;this.iHash.update(b),this.oHash=u.create();for(let w=0;w<b.length;w++)b[w]^=106;this.oHash.update(b),clean$4(b)}update(u){return aexists$4(this),this.iHash.update(u),this}digestInto(u){aexists$4(this),abytes$5(u,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(u),this.oHash.update(u),this.oHash.digestInto(u),this.destroy()}digest(){const u=new Uint8Array(this.oHash.outputLen);return this.digestInto(u),u}_cloneInto(u){u||=Object.create(Object.getPrototypeOf(this),{});const{oHash:g,iHash:v,finished:b,destroyed:w,blockLen:E,outputLen:S}=this;return u=u,u.finished=b,u.destroyed=w,u.blockLen=E,u.outputLen=S,u.oHash=g._cloneInto(u.oHash),u.iHash=v._cloneInto(u.iHash),u}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$3=(y,u,g)=>new _HMAC$2(y,u).update(g).digest();hmac$3.create=(y,u)=>new _HMAC$2(y,u);const divNearest=(y,u)=>(y+(y>=0?u:-u)/_2n$3)/u;function _splitEndoScalar(y,u,g){const[[v,b],[w,E]]=u,S=divNearest(E*y,g),A=divNearest(-b*y,g);let $=y-S*v-A*w,R=-S*b-A*E;const T=$<_0n$3,O=R<_0n$3;T&&($=-$),O&&(R=-R);const B=bitMask(Math.ceil(bitLen(g)/2))+_1n$2;if($<_0n$3||$>=B||R<_0n$3||R>=B)throw new Error("splitScalar (endomorphism): failed, k="+y);return{k1neg:T,k1:$,k2neg:O,k2:R}}function validateSigFormat(y){if(!["compact","recovered","der"].includes(y))throw new Error('Signature format must be "compact", "recovered", or "der"');return y}function validateSigOpts(y,u){const g={};for(let v of Object.keys(u))g[v]=y[v]===void 0?u[v]:y[v];return abool$1(g.lowS,"lowS"),abool$1(g.prehash,"prehash"),g.format!==void 0&&validateSigFormat(g.format),g}class DERErr extends Error{constructor(u=""){super(u)}}const DER={Err:DERErr,_tlv:{encode:(y,u)=>{const{Err:g}=DER;if(y<0||y>256)throw new g("tlv.encode: wrong tag");if(u.length&1)throw new g("tlv.encode: unpadded data");const v=u.length/2,b=numberToHexUnpadded(v);if(b.length/2&128)throw new g("tlv.encode: long form length too big");const w=v>127?numberToHexUnpadded(b.length/2|128):"";return numberToHexUnpadded(y)+w+b+u},decode(y,u){const{Err:g}=DER;let v=0;if(y<0||y>256)throw new g("tlv.encode: wrong tag");if(u.length<2||u[v++]!==y)throw new g("tlv.decode: wrong tlv");const b=u[v++],w=!!(b&128);let E=0;if(!w)E=b;else{const A=b&127;if(!A)throw new g("tlv.decode(long): indefinite length not supported");if(A>4)throw new g("tlv.decode(long): byte length is too big");const $=u.subarray(v,v+A);if($.length!==A)throw new g("tlv.decode: length bytes not complete");if($[0]===0)throw new g("tlv.decode(long): zero leftmost byte");for(const R of $)E=E<<8|R;if(v+=A,E<128)throw new g("tlv.decode(long): not minimal encoding")}const S=u.subarray(v,v+E);if(S.length!==E)throw new g("tlv.decode: wrong value length");return{v:S,l:u.subarray(v+E)}}},_int:{encode(y){const{Err:u}=DER;if(y<_0n$3)throw new u("integer: negative integers are not allowed");let g=numberToHexUnpadded(y);if(Number.parseInt(g[0],16)&8&&(g="00"+g),g.length&1)throw new u("unexpected DER parsing assertion: unpadded hex");return g},decode(y){const{Err:u}=DER;if(y[0]&128)throw new u("invalid signature integer: negative");if(y[0]===0&&!(y[1]&128))throw new u("invalid signature integer: unnecessary leading zero");return bytesToNumberBE(y)}},toSig(y){const{Err:u,_int:g,_tlv:v}=DER,b=abytes$5(y,void 0,"signature"),{v:w,l:E}=v.decode(48,b);if(E.length)throw new u("invalid signature: left bytes after parsing");const{v:S,l:A}=v.decode(2,w),{v:$,l:R}=v.decode(2,A);if(R.length)throw new u("invalid signature: left bytes after parsing");return{r:g.decode(S),s:g.decode($)}},hexFromSig(y){const{_tlv:u,_int:g}=DER,v=u.encode(2,g.encode(y.r)),b=u.encode(2,g.encode(y.s)),w=v+b;return u.encode(48,w)}},_0n$3=BigInt(0),_1n$2=BigInt(1),_2n$3=BigInt(2),_3n$1=BigInt(3),_4n=BigInt(4);function weierstrass(y,u={}){const g=createCurveFields("weierstrass",y,u),{Fp:v,Fn:b}=g;let w=g.CURVE;const{h:E,n:S}=w;validateObject$1(u,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});const{endo:A}=u;if(A&&(!v.is0(w.a)||typeof A.beta!="bigint"||!Array.isArray(A.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const $=getWLengths(v,b);function R(){if(!v.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function T(ae,Q,j){const{x:z,y:re}=Q.toAffine(),Y=v.toBytes(z);if(abool$1(j,"isCompressed"),j){R();const te=!v.isOdd(re);return concatBytes$1(pprefix(te),Y)}else return concatBytes$1(Uint8Array.of(4),Y,v.toBytes(re))}function O(ae){abytes$5(ae,void 0,"Point");const{publicKey:Q,publicKeyUncompressed:j}=$,z=ae.length,re=ae[0],Y=ae.subarray(1);if(z===Q&&(re===2||re===3)){const te=v.fromBytes(Y);if(!v.isValid(te))throw new Error("bad point: is not on curve, wrong x");const ne=U(te);let se;try{se=v.sqrt(ne)}catch(ue){const _e=ue instanceof Error?": "+ue.message:"";throw new Error("bad point: is not on curve, sqrt error"+_e)}R();const ee=v.isOdd(se);return(re&1)===1!==ee&&(se=v.neg(se)),{x:te,y:se}}else if(z===j&&re===4){const te=v.BYTES,ne=v.fromBytes(Y.subarray(0,te)),se=v.fromBytes(Y.subarray(te,te*2));if(!q(ne,se))throw new Error("bad point: is not on curve");return{x:ne,y:se}}else throw new Error(`bad point: got length ${z}, expected compressed=${Q} or uncompressed=${j}`)}const B=u.toBytes||T,F=u.fromBytes||O;function U(ae){const Q=v.sqr(ae),j=v.mul(Q,ae);return v.add(v.add(j,v.mul(ae,w.a)),w.b)}function q(ae,Q){const j=v.sqr(Q),z=U(ae);return v.eql(j,z)}if(!q(w.Gx,w.Gy))throw new Error("bad curve params: generator point");const J=v.mul(v.pow(w.a,_3n$1),_4n),ie=v.mul(v.sqr(w.b),BigInt(27));if(v.is0(v.add(J,ie)))throw new Error("bad curve params: a or b");function oe(ae,Q,j=!1){if(!v.isValid(Q)||j&&v.is0(Q))throw new Error(`bad point coordinate ${ae}`);return Q}function le(ae){if(!(ae instanceof pe))throw new Error("Weierstrass Point expected")}function de(ae){if(!A||!A.basises)throw new Error("no endo");return _splitEndoScalar(ae,A.basises,b.ORDER)}const fe=memoized((ae,Q)=>{const{X:j,Y:z,Z:re}=ae;if(v.eql(re,v.ONE))return{x:j,y:z};const Y=ae.is0();Q==null&&(Q=Y?v.ONE:v.inv(re));const te=v.mul(j,Q),ne=v.mul(z,Q),se=v.mul(re,Q);if(Y)return{x:v.ZERO,y:v.ZERO};if(!v.eql(se,v.ONE))throw new Error("invZ was invalid");return{x:te,y:ne}}),ye=memoized(ae=>{if(ae.is0()){if(u.allowInfinityPoint&&!v.is0(ae.Y))return;throw new Error("bad point: ZERO")}const{x:Q,y:j}=ae.toAffine();if(!v.isValid(Q)||!v.isValid(j))throw new Error("bad point: x or y not field elements");if(!q(Q,j))throw new Error("bad point: equation left != right");if(!ae.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function we(ae,Q,j,z,re){return j=new pe(v.mul(j.X,ae),j.Y,j.Z),Q=negateCt(z,Q),j=negateCt(re,j),Q.add(j)}class pe{static BASE=new pe(w.Gx,w.Gy,v.ONE);static ZERO=new pe(v.ZERO,v.ONE,v.ZERO);static Fp=v;static Fn=b;X;Y;Z;constructor(Q,j,z){this.X=oe("x",Q),this.Y=oe("y",j,!0),this.Z=oe("z",z),Object.freeze(this)}static CURVE(){return w}static fromAffine(Q){const{x:j,y:z}=Q||{};if(!Q||!v.isValid(j)||!v.isValid(z))throw new Error("invalid affine point");if(Q instanceof pe)throw new Error("projective point not allowed");return v.is0(j)&&v.is0(z)?pe.ZERO:new pe(j,z,v.ONE)}static fromBytes(Q){const j=pe.fromAffine(F(abytes$5(Q,void 0,"point")));return j.assertValidity(),j}static fromHex(Q){return pe.fromBytes(hexToBytes$3(Q))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(Q=8,j=!0){return he.createCache(this,Q),j||this.multiply(_3n$1),this}assertValidity(){ye(this)}hasEvenY(){const{y:Q}=this.toAffine();if(!v.isOdd)throw new Error("Field doesn't support isOdd");return!v.isOdd(Q)}equals(Q){le(Q);const{X:j,Y:z,Z:re}=this,{X:Y,Y:te,Z:ne}=Q,se=v.eql(v.mul(j,ne),v.mul(Y,re)),ee=v.eql(v.mul(z,ne),v.mul(te,re));return se&&ee}negate(){return new pe(this.X,v.neg(this.Y),this.Z)}double(){const{a:Q,b:j}=w,z=v.mul(j,_3n$1),{X:re,Y,Z:te}=this;let ne=v.ZERO,se=v.ZERO,ee=v.ZERO,Z=v.mul(re,re),ue=v.mul(Y,Y),_e=v.mul(te,te),Re=v.mul(re,Y);return Re=v.add(Re,Re),ee=v.mul(re,te),ee=v.add(ee,ee),ne=v.mul(Q,ee),se=v.mul(z,_e),se=v.add(ne,se),ne=v.sub(ue,se),se=v.add(ue,se),se=v.mul(ne,se),ne=v.mul(Re,ne),ee=v.mul(z,ee),_e=v.mul(Q,_e),Re=v.sub(Z,_e),Re=v.mul(Q,Re),Re=v.add(Re,ee),ee=v.add(Z,Z),Z=v.add(ee,Z),Z=v.add(Z,_e),Z=v.mul(Z,Re),se=v.add(se,Z),_e=v.mul(Y,te),_e=v.add(_e,_e),Z=v.mul(_e,Re),ne=v.sub(ne,Z),ee=v.mul(_e,ue),ee=v.add(ee,ee),ee=v.add(ee,ee),new pe(ne,se,ee)}add(Q){le(Q);const{X:j,Y:z,Z:re}=this,{X:Y,Y:te,Z:ne}=Q;let se=v.ZERO,ee=v.ZERO,Z=v.ZERO;const ue=w.a,_e=v.mul(w.b,_3n$1);let Re=v.mul(j,Y),Ae=v.mul(z,te),ge=v.mul(re,ne),be=v.add(j,z),Te=v.add(Y,te);be=v.mul(be,Te),Te=v.add(Re,Ae),be=v.sub(be,Te),Te=v.add(j,re);let De=v.add(Y,ne);return Te=v.mul(Te,De),De=v.add(Re,ge),Te=v.sub(Te,De),De=v.add(z,re),se=v.add(te,ne),De=v.mul(De,se),se=v.add(Ae,ge),De=v.sub(De,se),Z=v.mul(ue,Te),se=v.mul(_e,ge),Z=v.add(se,Z),se=v.sub(Ae,Z),Z=v.add(Ae,Z),ee=v.mul(se,Z),Ae=v.add(Re,Re),Ae=v.add(Ae,Re),ge=v.mul(ue,ge),Te=v.mul(_e,Te),Ae=v.add(Ae,ge),ge=v.sub(Re,ge),ge=v.mul(ue,ge),Te=v.add(Te,ge),Re=v.mul(Ae,Te),ee=v.add(ee,Re),Re=v.mul(De,Te),se=v.mul(be,se),se=v.sub(se,Re),Re=v.mul(be,Ae),Z=v.mul(De,Z),Z=v.add(Z,Re),new pe(se,ee,Z)}subtract(Q){return this.add(Q.negate())}is0(){return this.equals(pe.ZERO)}multiply(Q){const{endo:j}=u;if(!b.isValidNot0(Q))throw new Error("invalid scalar: out of range");let z,re;const Y=te=>he.cached(this,te,ne=>normalizeZ(pe,ne));if(j){const{k1neg:te,k1:ne,k2neg:se,k2:ee}=de(Q),{p:Z,f:ue}=Y(ne),{p:_e,f:Re}=Y(ee);re=ue.add(Re),z=we(j.beta,Z,_e,te,se)}else{const{p:te,f:ne}=Y(Q);z=te,re=ne}return normalizeZ(pe,[z,re])[0]}multiplyUnsafe(Q){const{endo:j}=u,z=this;if(!b.isValid(Q))throw new Error("invalid scalar: out of range");if(Q===_0n$3||z.is0())return pe.ZERO;if(Q===_1n$2)return z;if(he.hasCache(this))return this.multiply(Q);if(j){const{k1neg:re,k1:Y,k2neg:te,k2:ne}=de(Q),{p1:se,p2:ee}=mulEndoUnsafe(pe,z,Y,ne);return we(j.beta,se,ee,re,te)}else return he.unsafe(z,Q)}toAffine(Q){return fe(this,Q)}isTorsionFree(){const{isTorsionFree:Q}=u;return E===_1n$2?!0:Q?Q(pe,this):he.unsafe(this,S).is0()}clearCofactor(){const{clearCofactor:Q}=u;return E===_1n$2?this:Q?Q(pe,this):this.multiplyUnsafe(E)}isSmallOrder(){return this.multiplyUnsafe(E).is0()}toBytes(Q=!0){return abool$1(Q,"isCompressed"),this.assertValidity(),B(pe,this,Q)}toHex(Q=!0){return bytesToHex$3(this.toBytes(Q))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}const ve=b.BITS,he=new wNAF$1(pe,u.endo?Math.ceil(ve/2):ve);return pe.BASE.precompute(8),pe}function pprefix(y){return Uint8Array.of(y?2:3)}function getWLengths(y,u){return{secretKey:u.BYTES,publicKey:1+y.BYTES,publicKeyUncompressed:1+2*y.BYTES,publicKeyHasPrefix:!0,signature:2*u.BYTES}}function ecdh(y,u={}){const{Fn:g}=y,v=u.randomBytes||randomBytes$2,b=Object.assign(getWLengths(y.Fp,g),{seed:getMinHashLength(g.ORDER)});function w(B){try{const F=g.fromBytes(B);return g.isValidNot0(F)}catch{return!1}}function E(B,F){const{publicKey:U,publicKeyUncompressed:q}=b;try{const J=B.length;return F===!0&&J!==U||F===!1&&J!==q?!1:!!y.fromBytes(B)}catch{return!1}}function S(B=v(b.seed)){return mapHashToField(abytes$5(B,b.seed,"seed"),g.ORDER)}function A(B,F=!0){return y.BASE.multiply(g.fromBytes(B)).toBytes(F)}function $(B){const{secretKey:F,publicKey:U,publicKeyUncompressed:q}=b;if(!isBytes$6(B)||"_lengths"in g&&g._lengths||F===U)return;const J=abytes$5(B,void 0,"key").length;return J===U||J===q}function R(B,F,U=!0){if($(B)===!0)throw new Error("first arg must be private key");if($(F)===!1)throw new Error("second arg must be public key");const q=g.fromBytes(B);return y.fromBytes(F).multiply(q).toBytes(U)}const T={isValidSecretKey:w,isValidPublicKey:E,randomSecretKey:S},O=createKeygen$1(S,A);return Object.freeze({getPublicKey:A,getSharedSecret:R,keygen:O,Point:y,utils:T,lengths:b})}function ecdsa(y,u,g={}){ahash$3(u),validateObject$1(g,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),g=Object.assign({},g);const v=g.randomBytes||randomBytes$2,b=g.hmac||((j,z)=>hmac$3(u,j,z)),{Fp:w,Fn:E}=y,{ORDER:S,BITS:A}=E,{keygen:$,getPublicKey:R,getSharedSecret:T,utils:O,lengths:B}=ecdh(y,g),F={prehash:!0,lowS:typeof g.lowS=="boolean"?g.lowS:!0,format:"compact",extraEntropy:!1},U=S*_2n$3<w.ORDER;function q(j){const z=S>>_1n$2;return j>z}function J(j,z){if(!E.isValidNot0(z))throw new Error(`invalid signature ${j}: out of range 1..Point.Fn.ORDER`);return z}function ie(){if(U)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function oe(j,z){validateSigFormat(z);const re=B.signature,Y=z==="compact"?re:z==="recovered"?re+1:void 0;return abytes$5(j,Y)}class le{r;s;recovery;constructor(z,re,Y){if(this.r=J("r",z),this.s=J("s",re),Y!=null){if(ie(),![0,1,2,3].includes(Y))throw new Error("invalid recovery id");this.recovery=Y}Object.freeze(this)}static fromBytes(z,re=F.format){oe(z,re);let Y;if(re==="der"){const{r:ee,s:Z}=DER.toSig(abytes$5(z));return new le(ee,Z)}re==="recovered"&&(Y=z[0],re="compact",z=z.subarray(1));const te=B.signature/2,ne=z.subarray(0,te),se=z.subarray(te,te*2);return new le(E.fromBytes(ne),E.fromBytes(se),Y)}static fromHex(z,re){return this.fromBytes(hexToBytes$3(z),re)}assertRecovery(){const{recovery:z}=this;if(z==null)throw new Error("invalid recovery id: must be present");return z}addRecoveryBit(z){return new le(this.r,this.s,z)}recoverPublicKey(z){const{r:re,s:Y}=this,te=this.assertRecovery(),ne=te===2||te===3?re+S:re;if(!w.isValid(ne))throw new Error("invalid recovery id: sig.r+curve.n != R.x");const se=w.toBytes(ne),ee=y.fromBytes(concatBytes$1(pprefix((te&1)===0),se)),Z=E.inv(ne),ue=fe(abytes$5(z,void 0,"msgHash")),_e=E.create(-ue*Z),Re=E.create(Y*Z),Ae=y.BASE.multiplyUnsafe(_e).add(ee.multiplyUnsafe(Re));if(Ae.is0())throw new Error("invalid recovery: point at infinify");return Ae.assertValidity(),Ae}hasHighS(){return q(this.s)}toBytes(z=F.format){if(validateSigFormat(z),z==="der")return hexToBytes$3(DER.hexFromSig(this));const{r:re,s:Y}=this,te=E.toBytes(re),ne=E.toBytes(Y);return z==="recovered"?(ie(),concatBytes$1(Uint8Array.of(this.assertRecovery()),te,ne)):concatBytes$1(te,ne)}toHex(z){return bytesToHex$3(this.toBytes(z))}}const de=g.bits2int||function(z){if(z.length>8192)throw new Error("input is too large");const re=bytesToNumberBE(z),Y=z.length*8-A;return Y>0?re>>BigInt(Y):re},fe=g.bits2int_modN||function(z){return E.create(de(z))},ye=bitMask(A);function we(j){return aInRange$1("num < 2^"+A,j,_0n$3,ye),E.toBytes(j)}function pe(j,z){return abytes$5(j,void 0,"message"),z?abytes$5(u(j),void 0,"prehashed message"):j}function ve(j,z,re){const{lowS:Y,prehash:te,extraEntropy:ne}=validateSigOpts(re,F);j=pe(j,te);const se=fe(j),ee=E.fromBytes(z);if(!E.isValidNot0(ee))throw new Error("invalid private key");const Z=[we(ee),we(se)];if(ne!=null&&ne!==!1){const Ae=ne===!0?v(B.secretKey):ne;Z.push(abytes$5(Ae,void 0,"extraEntropy"))}const ue=concatBytes$1(...Z),_e=se;function Re(Ae){const ge=de(Ae);if(!E.isValidNot0(ge))return;const be=E.inv(ge),Te=y.BASE.multiply(ge).toAffine(),De=E.create(Te.x);if(De===_0n$3)return;const Ie=E.create(be*E.create(_e+De*ee));if(Ie===_0n$3)return;let Se=(Te.x===De?0:2)|Number(Te.y&_1n$2),Be=Ie;return Y&&q(Ie)&&(Be=E.neg(Ie),Se^=1),new le(De,Be,U?void 0:Se)}return{seed:ue,k2sig:Re}}function he(j,z,re={}){const{seed:Y,k2sig:te}=ve(j,z,re);return createHmacDrbg(u.outputLen,E.BYTES,b)(Y,te).toBytes(re.format)}function ae(j,z,re,Y={}){const{lowS:te,prehash:ne,format:se}=validateSigOpts(Y,F);if(re=abytes$5(re,void 0,"publicKey"),z=pe(z,ne),!isBytes$6(j)){const ee=j instanceof le?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+ee)}oe(j,se);try{const ee=le.fromBytes(j,se),Z=y.fromBytes(re);if(te&&ee.hasHighS())return!1;const{r:ue,s:_e}=ee,Re=fe(z),Ae=E.inv(_e),ge=E.create(Re*Ae),be=E.create(ue*Ae),Te=y.BASE.multiplyUnsafe(ge).add(Z.multiplyUnsafe(be));return Te.is0()?!1:E.create(Te.x)===ue}catch{return!1}}function Q(j,z,re={}){const{prehash:Y}=validateSigOpts(re,F);return z=pe(z,Y),le.fromBytes(j,"recovered").recoverPublicKey(z).toBytes()}return Object.freeze({keygen:$,getPublicKey:R,getSharedSecret:T,utils:O,lengths:B,Point:y,sign:he,verify:ae,recoverPublicKey:Q,Signature:le,hash:u})}const secp256k1_CURVE={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},secp256k1_ENDO={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_2n$2=BigInt(2);function sqrtMod(y){const u=secp256k1_CURVE.p,g=BigInt(3),v=BigInt(6),b=BigInt(11),w=BigInt(22),E=BigInt(23),S=BigInt(44),A=BigInt(88),$=y*y*y%u,R=$*$*y%u,T=pow2$2(R,g,u)*R%u,O=pow2$2(T,g,u)*R%u,B=pow2$2(O,_2n$2,u)*$%u,F=pow2$2(B,b,u)*B%u,U=pow2$2(F,w,u)*F%u,q=pow2$2(U,S,u)*U%u,J=pow2$2(q,A,u)*q%u,ie=pow2$2(J,S,u)*U%u,oe=pow2$2(ie,g,u)*R%u,le=pow2$2(oe,E,u)*F%u,de=pow2$2(le,v,u)*$%u,fe=pow2$2(de,_2n$2,u);if(!Fpk1.eql(Fpk1.sqr(fe),y))throw new Error("Cannot find square root");return fe}const Fpk1=Field(secp256k1_CURVE.p,{sqrt:sqrtMod}),Pointk1=weierstrass(secp256k1_CURVE,{Fp:Fpk1,endo:secp256k1_ENDO}),secp256k1=ecdsa(Pointk1,sha256$3),PRIVATE_KEY_BYTE_LENGTH=32;function hashAndSign(y,u,g){const v=sha256$4.digest(u instanceof Uint8Array?u:u.subarray());if(isPromise$6(v))return v.then(({digest:b})=>(g?.signal?.throwIfAborted(),secp256k1.sign(b,y,{prehash:!1,format:"der"}))).catch(b=>{throw b.name==="AbortError"?b:new SigningError(String(b))});try{return secp256k1.sign(v.digest,y,{prehash:!1,format:"der"})}catch(b){throw new SigningError(String(b))}}function hashAndVerify(y,u,g,v){const b=sha256$4.digest(g instanceof Uint8Array?g:g.subarray());if(isPromise$6(b))return b.then(({digest:w})=>(v?.signal?.throwIfAborted(),secp256k1.verify(u,w,y,{prehash:!1,format:"der"}))).catch(w=>{throw w.name==="AbortError"?w:new VerificationError(String(w))});try{return v?.signal?.throwIfAborted(),secp256k1.verify(u,b.digest,y,{prehash:!1,format:"der"})}catch(w){throw new VerificationError(String(w))}}class Secp256k1PublicKey{type="secp256k1";raw;_key;constructor(u){this._key=validateSecp256k1PublicKey(u),this.raw=compressSecp256k1PublicKey(this._key)}toMultihash(){return identity.digest(publicKeyToProtobuf(this))}toCID(){return CID.createV1(114,this.toMultihash())}toString(){return base58btc.encode(this.toMultihash().bytes).substring(1)}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}verify(u,g,v){return hashAndVerify(this._key,g,u,v)}}class Secp256k1PrivateKey{type="secp256k1";raw;publicKey;constructor(u,g){this.raw=validateSecp256k1PrivateKey(u),this.publicKey=new Secp256k1PublicKey(g??computeSecp256k1PublicKey(u))}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}sign(u,g){return hashAndSign(this.raw,u,g)}}function unmarshalSecp256k1PrivateKey(y){return new Secp256k1PrivateKey(y)}function unmarshalSecp256k1PublicKey(y){return new Secp256k1PublicKey(y)}async function generateSecp256k1KeyPair(){const y=generateSecp256k1PrivateKey();return new Secp256k1PrivateKey(y)}function compressSecp256k1PublicKey(y){return secp256k1.Point.fromBytes(y).toBytes()}function validateSecp256k1PrivateKey(y){try{return secp256k1.getPublicKey(y,!0),y}catch(u){throw new InvalidPrivateKeyError(String(u))}}function validateSecp256k1PublicKey(y){try{return secp256k1.Point.fromBytes(y),y}catch(u){throw new InvalidPublicKeyError(String(u))}}function computeSecp256k1PublicKey(y){try{return secp256k1.getPublicKey(y,!0)}catch(u){throw new InvalidPrivateKeyError(String(u))}}function generateSecp256k1PrivateKey(){return secp256k1.utils.randomSecretKey()}async function generateKeyPair(y,u){if(y==="Ed25519")return generateEd25519KeyPair();if(y==="secp256k1")return generateSecp256k1KeyPair();if(y==="RSA")return generateRSAKeyPair(toBits(u));if(y==="ECDSA")return generateECDSAKeyPair(toCurve(u));throw new UnsupportedKeyTypeError}async function generateKeyPairFromSeed(y,u){return generateEd25519KeyPairFromSeed(u)}function publicKeyFromProtobuf(y,u){const{Type:g,Data:v}=PublicKey$1.decode(y),b=v??new Uint8Array;switch(g){case KeyType.RSA:return pkixToRSAPublicKey(b,u);case KeyType.Ed25519:return unmarshalEd25519PublicKey(b);case KeyType.secp256k1:return unmarshalSecp256k1PublicKey(b);case KeyType.ECDSA:return unmarshalECDSAPublicKey(b);default:throw new UnsupportedKeyTypeError}}function publicKeyFromMultihash(y){const{Type:u,Data:g}=PublicKey$1.decode(y.digest),v=g??new Uint8Array;switch(u){case KeyType.Ed25519:return unmarshalEd25519PublicKey(v);case KeyType.secp256k1:return unmarshalSecp256k1PublicKey(v);case KeyType.ECDSA:return unmarshalECDSAPublicKey(v);default:throw new UnsupportedKeyTypeError}}function publicKeyToProtobuf(y){return PublicKey$1.encode({Type:KeyType[y.type],Data:y.raw})}function privateKeyFromProtobuf(y){const u=PrivateKey$1.decode(y),g=u.Data??new Uint8Array;switch(u.Type){case KeyType.RSA:return pkcs1ToRSAPrivateKey(g);case KeyType.Ed25519:return unmarshalEd25519PrivateKey(g);case KeyType.secp256k1:return unmarshalSecp256k1PrivateKey(g);case KeyType.ECDSA:return unmarshalECDSAPrivateKey(g);default:throw new UnsupportedKeyTypeError}}function privateKeyFromRaw(y){if(y.byteLength===PRIVATE_KEY_BYTE_LENGTH$1)return unmarshalEd25519PrivateKey(y);if(y.byteLength===PRIVATE_KEY_BYTE_LENGTH)return unmarshalSecp256k1PrivateKey(y);const u=decodeDer(y),g=u[2]?.[0];if(g===ECDSA_P_256_OID||g===ECDSA_P_384_OID||g===ECDSA_P_521_OID)return pkiMessageToECDSAPrivateKey(u);if(u.length>8)return pkcs1MessageToRSAPrivateKey(u);throw new InvalidParametersError$1("Could not extract private key from raw bytes")}function privateKeyToProtobuf(y){return PrivateKey$1.encode({Type:KeyType[y.type],Data:y.raw})}function toBits(y){return y==null?2048:parseInt(y,10)}function toCurve(y){if(y==="P-256"||y==null)return"P-256";if(y==="P-384")return"P-384";if(y==="P-521")return"P-521";throw new InvalidParametersError$1("Unsupported curve, should be P-256, P-384 or P-521")}async function privateKeyToCryptoKeyPair(y){if(y.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",y.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",y.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(y.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",y.jwk,{name:"ECDSA",namedCurve:y.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",y.publicKey.jwk,{name:"ECDSA",namedCurve:y.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new InvalidParametersError$1("Only RSA and ECDSA keys are supported")}const SHA1_IV=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),SHA1_W=new Uint32Array(80);class _SHA1 extends HashMD$3{A=SHA1_IV[0]|0;B=SHA1_IV[1]|0;C=SHA1_IV[2]|0;D=SHA1_IV[3]|0;E=SHA1_IV[4]|0;constructor(){super(64,20,8,!1)}get(){const{A:u,B:g,C:v,D:b,E:w}=this;return[u,g,v,b,w]}set(u,g,v,b,w){this.A=u|0,this.B=g|0,this.C=v|0,this.D=b|0,this.E=w|0}process(u,g){for(let A=0;A<16;A++,g+=4)SHA1_W[A]=u.getUint32(g,!1);for(let A=16;A<80;A++)SHA1_W[A]=rotl$1(SHA1_W[A-3]^SHA1_W[A-8]^SHA1_W[A-14]^SHA1_W[A-16],1);let{A:v,B:b,C:w,D:E,E:S}=this;for(let A=0;A<80;A++){let $,R;A<20?($=Chi$2(b,w,E),R=1518500249):A<40?($=b^w^E,R=1859775393):A<60?($=Maj$2(b,w,E),R=2400959708):($=b^w^E,R=3395469782);const T=rotl$1(v,5)+$+S+R+SHA1_W[A]|0;S=E,E=w,w=rotl$1(b,30),b=v,v=T}v=v+this.A|0,b=b+this.B|0,w=w+this.C|0,E=E+this.D|0,S=S+this.E|0,this.set(v,b,w,E,S)}roundClean(){clean$4(SHA1_W)}destroy(){this.set(0,0,0,0,0),clean$4(this.buffer)}}const sha1$2=createHasher$3(()=>new _SHA1);function pbkdf2Init$1(y,u,g,v){ahash$3(y);const b=checkOpts$2({dkLen:32,asyncTick:10},v),{c:w,dkLen:E,asyncTick:S}=b;if(anumber$4(w,"c"),anumber$4(E,"dkLen"),anumber$4(S,"asyncTick"),w<1)throw new Error("iterations (c) must be >= 1");const A=kdfInputToBytes$1(u,"password"),$=kdfInputToBytes$1(g,"salt"),R=new Uint8Array(E),T=hmac$3.create(y,A),O=T._cloneInto().update($);return{c:w,dkLen:E,asyncTick:S,DK:R,PRF:T,PRFSalt:O}}function pbkdf2Output$1(y,u,g,v,b){return y.destroy(),u.destroy(),v&&v.destroy(),clean$4(b),g}function pbkdf2$1(y,u,g,v){const{c:b,dkLen:w,DK:E,PRF:S,PRFSalt:A}=pbkdf2Init$1(y,u,g,v);let $;const R=new Uint8Array(4),T=createView$4(R),O=new Uint8Array(S.outputLen);for(let B=1,F=0;F<w;B++,F+=S.outputLen){const U=E.subarray(F,F+S.outputLen);T.setInt32(0,B,!1),($=A._cloneInto($)).update(R).digestInto(O),U.set(O.subarray(0,U.length));for(let q=1;q<b;q++){S._cloneInto($).update(O).digestInto(O);for(let J=0;J<U.length;J++)U[J]^=O[J]}}return pbkdf2Output$1(S,A,E,$,O)}const hashName={sha1:sha1$2,"sha2-256":sha256$3,"sha2-512":sha512$3};function pbkdf2(y,u,g,v,b){if(b!=="sha1"&&b!=="sha2-256"&&b!=="sha2-512"){const S=Object.keys(hashName).join(" / ");throw new InvalidParametersError$1(`Hash '${b}' is unknown or not supported. Must be ${S}`)}const w=hashName[b],E=pbkdf2$1(w,y,u,{c:g,dkLen:v});return base64$1.encode(E).substring(1)}const FNV_PRIMES={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},FNV_OFFSETS={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},cachedEncoder=new globalThis.TextEncoder;function fnv1aUint8Array(y,u){const g=FNV_PRIMES[u];let v=FNV_OFFSETS[u];for(let b=0;b<y.length;b++)v^=BigInt(y[b]),v=BigInt.asUintN(u,v*g);return v}function fnv1aEncodeInto(y,u,g){if(g.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const v=FNV_PRIMES[u];let b=FNV_OFFSETS[u],w=y;for(;w.length>0;){const E=cachedEncoder.encodeInto(w,g);w=w.slice(E.read);for(let S=0;S<E.written;S++)b^=BigInt(g[S]),b=BigInt.asUintN(u,b*v)}return b}function fnv1a$1(y,{size:u=32,utf8Buffer:g}={}){if(!FNV_PRIMES[u])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof y=="string"){if(g)return fnv1aEncodeInto(y,u,g);y=cachedEncoder.encode(y)}return fnv1aUint8Array(y,u)}const fnv1a={hash:y=>Number(fnv1a$1(y,{size:32})),hashV:(y,u)=>numberToBuffer(fnv1a.hash(y,u))};function numberToBuffer(y){let u=y.toString(16);return u.length%2===1&&(u=`0${u}`),fromString$1(u,"base16")}const MAX_FINGERPRINT_SIZE=64;class Fingerprint{fp;h;seed;constructor(u,g,v,b=2){if(b>MAX_FINGERPRINT_SIZE)throw new TypeError("Invalid Fingerprint Size");const w=g.hashV(u,v),E=alloc$2(b);for(let S=0;S<E.length;S++)E[S]=w[S];E.length===0&&(E[0]=7),this.fp=E,this.h=g,this.seed=v}hash(){return this.h.hash(this.fp,this.seed)}equals(u){return u?.fp instanceof Uint8Array?equals(this.fp,u.fp):!1}}function getRandomInt(y,u){return Math.floor(Math.random()*(u-y))+y}class Bucket{contents;constructor(u){this.contents=new Array(u).fill(null)}has(u){if(!(u instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");return this.contents.some(g=>u.equals(g))}add(u){if(!(u instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");for(let g=0;g<this.contents.length;g++)if(this.contents[g]==null)return this.contents[g]=u,!0;return!0}swap(u){if(!(u instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");const g=getRandomInt(0,this.contents.length-1),v=this.contents[g];return this.contents[g]=u,v}remove(u){if(!(u instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");const g=this.contents.findIndex(v=>u.equals(v));return g>-1?(this.contents[g]=null,!0):!1}}const maxCuckooCount=500;class CuckooFilter{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(u){this.filterSize=u.filterSize,this.bucketSize=u.bucketSize??4,this.fingerprintSize=u.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=u.hash??fnv1a,this.seed=u.seed??getRandomInt(0,Math.pow(2,10))}add(u){typeof u=="string"&&(u=fromString$1(u));const g=new Fingerprint(u,this.hash,this.seed,this.fingerprintSize),v=this.hash.hash(u,this.seed)%this.filterSize,b=(v^g.hash())%this.filterSize;if(this.buckets[v]==null&&(this.buckets[v]=new Bucket(this.bucketSize)),this.buckets[b]==null&&(this.buckets[b]=new Bucket(this.bucketSize)),this.buckets[v].add(g)||this.buckets[b].add(g))return this.count++,!0;const w=[v,b];let E=w[getRandomInt(0,w.length-1)];this.buckets[E]==null&&(this.buckets[E]=new Bucket(this.bucketSize));for(let S=0;S<maxCuckooCount;S++){const A=this.buckets[E].swap(g);if(A!=null&&(E=(E^A.hash())%this.filterSize,this.buckets[E]==null&&(this.buckets[E]=new Bucket(this.bucketSize)),this.buckets[E].add(A)))return this.count++,!0}return!1}has(u){typeof u=="string"&&(u=fromString$1(u));const g=new Fingerprint(u,this.hash,this.seed,this.fingerprintSize),v=this.hash.hash(u,this.seed)%this.filterSize,b=this.buckets[v]?.has(g)??!1;if(b)return b;const w=(v^g.hash())%this.filterSize;return this.buckets[w]?.has(g)??!1}remove(u){typeof u=="string"&&(u=fromString$1(u));const g=new Fingerprint(u,this.hash,this.seed,this.fingerprintSize),v=this.hash.hash(u,this.seed)%this.filterSize,b=this.buckets[v]?.remove(g)??!1;if(b)return this.count--,b;const w=(v^g.hash())%this.filterSize,E=this.buckets[w]?.remove(g)??!1;return E&&this.count--,E}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const MAX_LOAD={1:.5,2:.84,4:.95,8:.98};function calculateBucketSize(y=.001){return y>.002?2:y>1e-5?4:8}function optimize(y,u=.001){const g=calculateBucketSize(u),v=MAX_LOAD[g],b=Math.round(y/v),w=Math.min(Math.ceil(Math.log2(1/u)+Math.log2(2*g)),MAX_FINGERPRINT_SIZE);return{filterSize:b,bucketSize:g,fingerprintSize:w}}class ScalableCuckooFilter{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(u){this.bucketSize=u.bucketSize??4,this.filterSize=u.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=u.fingerprintSize??2,this.scale=u.scale??2,this.hash=u.hash??fnv1a,this.seed=u.seed??getRandomInt(0,Math.pow(2,10)),this.filterSeries=[new CuckooFilter({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(u){if(typeof u=="string"&&(u=fromString$1(u)),this.has(u))return!0;let g=this.filterSeries.find(v=>v.reliable);if(g==null){const v=this.filterSize*Math.pow(this.scale,this.filterSeries.length);g=new CuckooFilter({filterSize:v,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(g)}return g.add(u)}has(u){typeof u=="string"&&(u=fromString$1(u));for(let g=0;g<this.filterSeries.length;g++)if(this.filterSeries[g].has(u))return!0;return!1}remove(u){typeof u=="string"&&(u=fromString$1(u));for(let g=0;g<this.filterSeries.length;g++)if(this.filterSeries[g].remove(u))return!0;return!1}get count(){return this.filterSeries.reduce((u,g)=>u+g.count,0)}}function createScalableCuckooFilter(y,u=.001,g){return new ScalableCuckooFilter({...optimize(y,u)})}function getNetConfig(y){const u=y.getComponents(),g={};let v=0;if(u[v]?.name==="ip6zone"&&(g.zone=`${u[v].value}`,v++),u[v].name==="ip4"||u[v].name==="ip6"||u[v].name==="dns"||u[v].name==="dns4"||u[v].name==="dns6"?(g.type=u[v].name,g.host=u[v].value,v++):u[v].name==="dnsaddr"&&(g.type=u[v].name,g.host=`_dnsaddr.${u[v].value}`,v++),(u[v]?.name==="tcp"||u[v]?.name==="udp")&&(g.protocol=u[v].name==="tcp"?"tcp":"udp",g.port=parseInt(`${u[v].value}`),v++),u[v]?.name==="ipcidr"&&(g.type==="ip4"?g.cidr=parseInt(`${u[v].value}`):g.type==="ip6"&&(g.cidr=`${u[v].value}`),v++),g.type==null||g.host==null)throw new InvalidParametersError$1(`Multiaddr ${y} was not an IPv4, IPv6, DNS, DNS4, DNS6 or DNSADDR address`);return u[v]?.name==="tls"&&u[v+1]?.name==="sni"&&(g.sni=u[v+1].value,v+=2),g}class Parser{index=0;input="";new(u){return this.index=0,this.input=u,this}readAtomically(u){const g=this.index,v=u();return v===void 0&&(this.index=g),v}parseWith(u){const g=u();if(this.index===this.input.length)return g}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(u){return this.readAtomically(()=>{const g=this.readChar();if(g===u)return g})}readSeparator(u,g,v){return this.readAtomically(()=>{if(!(g>0&&this.readGivenChar(u)===void 0))return v()})}readNumber(u,g,v,b){return this.readAtomically(()=>{let w=0,E=0;const S=this.peekChar();if(S===void 0)return;const A=S==="0",$=2**(8*b)-1;for(;;){const R=this.readAtomically(()=>{const T=this.readChar();if(T===void 0)return;const O=Number.parseInt(T,u);if(!Number.isNaN(O))return O});if(R===void 0)break;if(w*=u,w+=R,w>$||(E+=1,g!==void 0&&E>g))return}if(E!==0)return!v&&A&&E>1?void 0:w})}readIPv4Addr(){return this.readAtomically(()=>{const u=new Uint8Array(4);for(let g=0;g<u.length;g++){const v=this.readSeparator(".",g,()=>this.readNumber(10,3,!1,1));if(v===void 0)return;u[g]=v}return u})}readIPv6Addr(){const u=g=>{for(let v=0;v<g.length/2;v++){const b=v*2;if(v<g.length-3){const E=this.readSeparator(":",v,()=>this.readIPv4Addr());if(E!==void 0)return g[b]=E[0],g[b+1]=E[1],g[b+2]=E[2],g[b+3]=E[3],[b+4,!0]}const w=this.readSeparator(":",v,()=>this.readNumber(16,4,!0,2));if(w===void 0)return[b,!1];g[b]=w>>8,g[b+1]=w&255}return[g.length,!1]};return this.readAtomically(()=>{const g=new Uint8Array(16),[v,b]=u(g);if(v===16)return g;if(b||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const w=new Uint8Array(14),E=16-(v+2),[S]=u(w.subarray(0,E));return g.set(w.subarray(0,S),16-S),g})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const MAX_IPV6_LENGTH=45,MAX_IPV4_LENGTH=15,parser$2=new Parser;function parseIPv4(y){if(!(y.length>MAX_IPV4_LENGTH))return parser$2.new(y).parseWith(()=>parser$2.readIPv4Addr())}function parseIPv6(y){if(y.includes("%")&&(y=y.split("%")[0]),!(y.length>MAX_IPV6_LENGTH))return parser$2.new(y).parseWith(()=>parser$2.readIPv6Addr())}function parseIP(y,u=!1){if(y.includes("%")&&(y=y.split("%")[0]),y.length>MAX_IPV6_LENGTH)return;const g=parser$2.new(y).parseWith(()=>parser$2.readIPAddr());if(g)return u&&g.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,g[0],g[1],g[2],g[3]]):g}function allFF(y,u,g){let v=0;for(const b of y)if(!(v<u)){if(v>g)break;if(b!==255)return!1;v++}return!0}function deepEqual(y,u,g,v){let b=0;for(const w of y)if(!(b<g)){if(b>v)break;if(w!==u[b])return!1;b++}return!0}function ipToString(y){switch(y.length){case IPv4Len:return y.join(".");case IPv6Len:{const u=[];for(let g=0;g<y.length;g++)g%2===0&&u.push(y[g].toString(16).padStart(2,"0")+y[g+1].toString(16).padStart(2,"0"));return u.join(":")}default:throw new Error("Invalid ip length")}}function simpleMaskLength(y){let u=0;for(let[g,v]of y.entries()){if(v===255){u+=8;continue}for(;(v&128)!=0;)u++,v=v<<1;if((v&128)!=0)return-1;for(let b=g+1;b<y.length;b++)if(y[b]!=0)return-1;break}return u}function maskToHex(y){let u="0x";for(const g of y)u+=(g>>4).toString(16)+(g&15).toString(16);return u}const IPv4Len=4,IPv6Len=16,ipv4Prefix=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function maskIp(y,u){u.length===IPv6Len&&y.length===IPv4Len&&allFF(u,0,11)&&(u=u.slice(12)),u.length===IPv4Len&&y.length===IPv6Len&&deepEqual(y,ipv4Prefix,0,11)&&(y=y.slice(12));const g=y.length;if(g!=u.length)throw new Error("Failed to mask ip");const v=new Uint8Array(g);for(let b=0;b<g;b++)v[b]=y[b]&u[b];return v}function containsIp(y,u){if(typeof u=="string"&&(u=parseIP(u)),u==null)throw new Error("Invalid ip");if(u.length!==y.network.length)return!1;for(let g=0;g<u.length;g++)if((y.network[g]&y.mask[g])!==(u[g]&y.mask[g]))return!1;return!0}function parseCidr(y){const[u,g]=y.split("/");if(!u||!g)throw new Error("Failed to parse given CIDR: "+y);let v=IPv4Len,b=parseIPv4(u);if(b==null&&(v=IPv6Len,b=parseIPv6(u),b==null))throw new Error("Failed to parse given CIDR: "+y);const w=parseInt(g,10);if(Number.isNaN(w)||String(w).length!==g.length||w<0||w>v*8)throw new Error("Failed to parse given CIDR: "+y);const E=cidrMask(w,8*v);return{network:maskIp(b,E),mask:E}}function cidrMask(y,u){if(u!==8*IPv4Len&&u!==8*IPv6Len)throw new Error("Invalid CIDR mask");if(y<0||y>u)throw new Error("Invalid CIDR mask");const g=u/8,v=new Uint8Array(g);for(let b=0;b<g;b++){if(y>=8){v[b]=255,y-=8;continue}v[b]=255-(255>>y),y=0}return v}class IpNet{constructor(u,g){if(g==null)({network:this.network,mask:this.mask}=parseCidr(u));else{const v=parseIP(u);if(v==null)throw new Error("Failed to parse network");g=String(g);const b=parseInt(g,10);if(Number.isNaN(b)||String(b).length!==g.length||b<0||b>v.length*8){const w=parseIP(g);if(w==null)throw new Error("Failed to parse mask");this.mask=w}else this.mask=cidrMask(b,8*v.length);this.network=maskIp(v,this.mask)}}contains(u){return containsIp({network:this.network,mask:this.mask},u)}toString(){const u=simpleMaskLength(this.mask),g=u!==-1?String(u):maskToHex(this.mask);return ipToString(this.network)+"/"+g}}function cidrContains(y,u){return new IpNet(y).contains(u)}function isGlobalUnicast(y){try{const u=getNetConfig(y);switch(u.type){case"ip6":return cidrContains("2000::/3",u.host);default:return!1}}catch{return!1}}function isLinkLocal(y){try{const u=getNetConfig(y);switch(u.type){case"ip4":return u.host.startsWith("169.254.");case"ip6":return u.host.toLowerCase().startsWith("fe80");default:return!1}}catch{return!1}}function isLoopbackAddr(y){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(y)||/^::1$/.test(y)}function isLoopback(y){try{const u=getNetConfig(y);switch(u.type){case"ip4":case"ip6":return isLoopbackAddr(u.host);default:return!1}}catch{return!1}}function isNetworkAddress(y){try{return getNetConfig(y),!0}catch{return!1}}function isIPv4$1(y){return!!parseIPv4(y)}function isIPv6$1(y){return!!parseIPv6(y)}var netmask={},hasRequiredNetmask;function requireNetmask(){return hasRequiredNetmask||(hasRequiredNetmask=1,(function(){var y,u,g,v,b,w,E,S;S=function(A){var $,R,T,O;return $=(A&255<<24)>>>24,R=(A&255<<16)>>>16,T=(A&65280)>>>8,O=A&255,[$,R,T,O].join(".")},E=function(A){var $,R,T,O,B,F;for($=[],T=O=0;O<=3&&A.length!==0;T=++O){if(T>0){if(A[0]!==".")throw new Error("Invalid IP");A=A.substring(1)}F=u(A),B=F[0],R=F[1],A=A.substring(R),$.push(B)}if(A.length!==0)throw new Error("Invalid IP");switch($.length){case 1:if($[0]>4294967295)throw new Error("Invalid IP");return $[0]>>>0;case 2:if($[0]>255||$[1]>16777215)throw new Error("Invalid IP");return($[0]<<24|$[1])>>>0;case 3:if($[0]>255||$[1]>255||$[2]>65535)throw new Error("Invalid IP");return($[0]<<24|$[1]<<16|$[2])>>>0;case 4:if($[0]>255||$[1]>255||$[2]>255||$[3]>255)throw new Error("Invalid IP");return($[0]<<24|$[1]<<16|$[2]<<8|$[3])>>>0;default:throw new Error("Invalid IP")}},g=function(A){return A.charCodeAt(0)},v=g("0"),w=g("a"),b=g("A"),u=function(A){var $,R,T,O,B;for(O=0,$=10,R="9",T=0,A.length>1&&A[T]==="0"&&(A[T+1]==="x"||A[T+1]==="X"?(T+=2,$=16):"0"<=A[T+1]&&A[T+1]<="9"&&(T++,$=8,R="7")),B=T;T<A.length;){if("0"<=A[T]&&A[T]<=R)O=O*$+(g(A[T])-v)>>>0;else if($===16)if("a"<=A[T]&&A[T]<="f")O=O*$+(10+g(A[T])-w)>>>0;else if("A"<=A[T]&&A[T]<="F")O=O*$+(10+g(A[T])-b)>>>0;else break;else break;if(O>4294967295)throw new Error("too large");T++}if(T===B)throw new Error("empty octet");return[O,T]},y=(function(){function A($,R){var T,O,B;if(typeof $!="string")throw new Error("Missing `net' parameter");if(R||(B=$.split("/",2),$=B[0],R=B[1]),R||(R=32),typeof R=="string"&&R.indexOf(".")>-1){try{this.maskLong=E(R)}catch{throw new Error("Invalid mask: "+R)}for(T=O=32;O>=0;T=--O)if(this.maskLong===4294967295<<32-T>>>0){this.bitmask=T;break}}else if(R||R===0)this.bitmask=parseInt(R,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(E($)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+$)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+R);this.size=Math.pow(2,32-this.bitmask),this.base=S(this.netLong),this.mask=S(this.maskLong),this.hostmask=S(~this.maskLong),this.first=this.bitmask<=30?S(this.netLong+1):this.base,this.last=this.bitmask<=30?S(this.netLong+this.size-2):S(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?S(this.netLong+this.size-1):void 0}return A.prototype.contains=function($){return typeof $=="string"&&($.indexOf("/")>0||$.split(".").length!==4)&&($=new A($)),$ instanceof A?this.contains($.base)&&this.contains($.broadcast||$.last):(E($)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},A.prototype.next=function($){return $==null&&($=1),new A(S(this.netLong+this.size*$),this.mask)},A.prototype.forEach=function($){var R,T,O;for(O=E(this.first),T=E(this.last),R=0;O<=T;)$(S(O),O,R),R++,O++},A.prototype.toString=function(){return this.base+"/"+this.bitmask},A})(),netmask.ip2long=E,netmask.long2ip=S,netmask.Netmask=y}).call(netmask)),netmask}var netmaskExports=requireNetmask();const PRIVATE_IP_RANGES=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],NETMASK_RANGES=PRIVATE_IP_RANGES.map(y=>new netmaskExports.Netmask(y));function ipv4Check(y){for(const u of NETMASK_RANGES)if(u.contains(y))return!0;return!1}function isIpv4MappedIpv6(y){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(y)}function ipv4MappedIpv6Check(y){const u=y.split(":");if(u.length<2)return!1;const g=u[u.length-1].padStart(4,"0"),v=u[u.length-2].padStart(4,"0"),b=`${parseInt(v.substring(0,2),16)}.${parseInt(v.substring(2),16)}.${parseInt(g.substring(0,2),16)}.${parseInt(g.substring(2),16)}`;return ipv4Check(b)}function isIpv4EmbeddedIpv6(y){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(y)}function ipv4EmbeddedIpv6Check(y){const u=y.split(":"),g=u[u.length-1];return ipv4Check(g)}function ipv6Check(y){return/^::$/.test(y)||/^::1$/.test(y)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(y)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(y)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(y)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(y)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(y)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(y)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(y)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(y)||/^ff([0-9a-fA-F]{2,2}):/i.test(y)}function isPrivateIp(y){if(isIPv4$1(y))return ipv4Check(y);if(isIpv4MappedIpv6(y))return ipv4MappedIpv6Check(y);if(isIpv4EmbeddedIpv6(y))return ipv4EmbeddedIpv6Check(y);if(isIPv6$1(y))return ipv6Check(y)}function isPrivate(y){try{const u=getNetConfig(y);switch(u.type){case"ip4":case"ip6":return isPrivateIp(u.host)??!1;default:return u.host==="localhost"}}catch{return!1}}function pDefer(){const y={};return y.promise=new Promise((u,g)=>{y.resolve=u,y.reject=g}),y}class FixedFIFO{buffer;mask;top;btm;next;constructor(u){if(!(u>0)||(u-1&u)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(u),this.mask=u-1,this.top=0,this.btm=0,this.next=null}push(u){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=u,this.top=this.top+1&this.mask,!0)}shift(){const u=this.buffer[this.btm];if(u!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,u}isEmpty(){return this.buffer[this.btm]===void 0}}class FIFO{size;hwm;head;tail;constructor(u={}){this.hwm=u.splitLimit??16,this.head=new FixedFIFO(this.hwm),this.tail=this.head,this.size=0}calculateSize(u){return u?.byteLength!=null?u.byteLength:1}push(u){if(u?.value!=null&&(this.size+=this.calculateSize(u.value)),!this.head.push(u)){const g=this.head;this.head=g.next=new FixedFIFO(2*this.head.buffer.length),this.head.push(u)}}shift(){let u=this.tail.shift();if(u===void 0&&this.tail.next!=null){const g=this.tail.next;this.tail.next=null,this.tail=g,u=this.tail.shift()}return u?.value!=null&&(this.size-=this.calculateSize(u.value)),u}isEmpty(){return this.head.isEmpty()}}let AbortError$5=class extends Error{type;code;constructor(u,g){super(u??"The operation was aborted"),this.type="aborted",this.code=g??"ABORT_ERR"}};function pushable(y={}){return _pushable(g=>{const v=g.shift();if(v==null)return{done:!0};if(v.error!=null)throw v.error;return{done:v.done===!0,value:v.value}},y)}function _pushable(y,u){u=u??{};let g=u.onEnd,v=new FIFO,b,w,E,S=pDefer();const A=async()=>{try{return v.isEmpty()?E?{done:!0}:await new Promise((q,J)=>{w=ie=>{w=null,v.push(ie);try{q(y(v))}catch(oe){J(oe)}return b}}):y(v)}finally{v.isEmpty()&&queueMicrotask(()=>{S.resolve(),S=pDefer()})}},$=q=>w!=null?w(q):(v.push(q),b),R=q=>(v=new FIFO,w!=null?w({error:q}):(v.push({error:q}),b)),T=q=>{if(E)return b;if(u?.objectMode!==!0&&q?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return $({done:!1,value:q})},O=q=>E?b:(E=!0,q!=null?R(q):$({done:!0})),B=()=>(v=new FIFO,O(),{done:!0}),F=q=>(O(q),{done:!0});if(b={[Symbol.asyncIterator](){return this},next:A,return:B,throw:F,push:T,end:O,get readableLength(){return v.size},onEmpty:async q=>{const J=q?.signal;if(J?.throwIfAborted(),v.isEmpty())return;let ie,oe;J!=null&&(ie=new Promise((le,de)=>{oe=()=>{de(new AbortError$5)},J.addEventListener("abort",oe)}));try{await Promise.race([S.promise,ie])}finally{oe!=null&&J!=null&&J?.removeEventListener("abort",oe)}}},g==null)return b;const U=b;return b={[Symbol.asyncIterator](){return this},next(){return U.next()},throw(q){return U.throw(q),g!=null&&(g(q),g=void 0),{done:!0}},return(){return U.return(),g!=null&&(g(),g=void 0),{done:!0}},push:T,end(q){return U.end(q),g!=null&&(g(q),g=void 0),b},get readableLength(){return U.readableLength},onEmpty:q=>U.onEmpty(q)},b}class TimeoutError extends Error{constructor(u){super(u),this.name="TimeoutError"}}let AbortError$4=class extends Error{constructor(u){super(),this.name="AbortError",this.message=u}};const getDOMException=y=>globalThis.DOMException===void 0?new AbortError$4(y):new DOMException(y),getAbortedReason=y=>{const u=y.reason===void 0?getDOMException("This operation was aborted."):y.reason;return u instanceof Error?u:getDOMException(u)};function pTimeout(y,u){const{milliseconds:g,fallback:v,message:b,customTimers:w={setTimeout,clearTimeout}}=u;let E,S;const $=new Promise((R,T)=>{if(typeof g!="number"||Math.sign(g)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${g}\``);if(u.signal){const{signal:B}=u;B.aborted&&T(getAbortedReason(B)),S=()=>{T(getAbortedReason(B))},B.addEventListener("abort",S,{once:!0})}if(g===Number.POSITIVE_INFINITY){y.then(R,T);return}const O=new TimeoutError;E=w.setTimeout.call(void 0,()=>{if(v){try{R(v())}catch(B){T(B)}return}typeof y.cancel=="function"&&y.cancel(),b===!1?R():b instanceof Error?T(b):(O.message=b??`Promise timed out after ${g} milliseconds`,T(O))},g),(async()=>{try{R(await y)}catch(B){T(B)}})()}).finally(()=>{$.clear(),S&&u.signal&&u.signal.removeEventListener("abort",S)});return $.clear=()=>{w.clearTimeout.call(void 0,E),E=void 0},$}const normalizeEmitter=y=>{const u=y.addEventListener||y.on||y.addListener,g=y.removeEventListener||y.off||y.removeListener;if(!u||!g)throw new TypeError("Emitter is not compatible");return{addListener:u.bind(y),removeListener:g.bind(y)}};function pEventMultiple(y,u,g){let v;const b=new Promise((w,E)=>{if(g={rejectionEvents:["error"],multiArgs:!1,rejectionMultiArgs:!1,resolveImmediately:!1,...g},!(g.count>=0&&(g.count===Number.POSITIVE_INFINITY||Number.isInteger(g.count))))throw new TypeError("The `count` option should be at least 0 or more");g.signal?.throwIfAborted();const S=[u].flat(),A=[],{addListener:$,removeListener:R}=normalizeEmitter(y),T=async(...B)=>{const F=g.multiArgs?B:B[0];if(g.filter)try{if(!await g.filter(F))return}catch(U){v(),E(U);return}A.push(F),g.count===A.length&&(v(),w(A))},O=(...B)=>{v(),E(g.rejectionMultiArgs?B:B[0])};v=()=>{for(const B of S)R(B,T);for(const B of g.rejectionEvents)S.includes(B)||R(B,O)};for(const B of S)$(B,T);for(const B of g.rejectionEvents)S.includes(B)||$(B,O);g.signal&&g.signal.addEventListener("abort",()=>{O(g.signal.reason)},{once:!0}),g.resolveImmediately&&w(A)});if(b.cancel=v,typeof g.timeout=="number"){const w=pTimeout(b,{milliseconds:g.timeout});return w.cancel=()=>{v(),w.clear()},w}return b}function pEvent(y,u,g){typeof g=="function"&&(g={filter:g}),g={...g,count:1,resolveImmediately:!1};const v=pEventMultiple(y,u,g),b=v.then(w=>w[0]);return b.cancel=v.cancel,b}function debounce$1(y,u){let g;const v=function(){const b=function(){g=void 0,y()};clearTimeout(g),g=setTimeout(b,u)};return v.start=()=>{},v.stop=()=>{clearTimeout(g)},v}class RateLimitError extends Error{remainingPoints;msBeforeNext;consumedPoints;isFirstInDuration;constructor(u="Rate limit exceeded",g){super(u),this.name="RateLimitError",this.remainingPoints=g.remainingPoints,this.msBeforeNext=g.msBeforeNext,this.consumedPoints=g.consumedPoints,this.isFirstInDuration=g.isFirstInDuration}}let QueueFullError$1=class extends Error{static name="QueueFullError";constructor(u="The queue was full"){super(u),this.name="QueueFullError"}},UnexpectedEOFError$1=class extends Error{static name="UnexpectedEOFError";name="UnexpectedEOFError"};class MaxEarlyStreamsError extends Error{static name="MaxEarlyStreamsError";name="MaxEarlyStreamsError"}class StreamClosedError extends Error{static name="StreamClosedError";name="StreamClosedError"}function defaultTranslate(y){return y.reason}async function raceSignal$2(y,u,g){if(u==null)return y;const v=defaultTranslate;if(u.aborted)return y.catch(()=>{}),Promise.reject(v(u));let b;try{return await Promise.race([y,new Promise((w,E)=>{b=()=>{E(v(u))},u.addEventListener("abort",b)})])}finally{b!=null&&u.removeEventListener("abort",b)}}let JobRecipient$1=class{deferred;signal;constructor(u){this.signal=u,this.deferred=pDefer(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new AbortError$6)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}};function randomId$1(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}let Job$1=class{id;fn;options;recipients;status;timeline;controller;constructor(u,g){this.id=randomId$1(),this.status="queued",this.fn=u,this.options=g,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(u){this.controller.abort(u)}onAbort(){this.recipients.reduce((g,v)=>g&&v.signal?.aborted===!0,!0)&&(this.controller.abort(new AbortError$6),this.cleanup())}async join(u={}){const g=new JobRecipient$1(u.signal);return this.recipients.push(g),u.signal?.addEventListener("abort",this.onAbort),g.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const u=await raceSignal$2(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(g=>{g.deferred.resolve(u)}),this.status="complete"}catch(u){this.recipients.forEach(g=>{g.deferred.reject(u)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(u=>{u.cleanup(),u.signal?.removeEventListener("abort",this.onAbort)})}},Queue$1=class extends TypedEventEmitter{concurrency;maxSize;queue;pending;sort;paused;constructor(u={}){super(),this.concurrency=u.concurrency??Number.POSITIVE_INFINITY,this.maxSize=u.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.paused=!1,u.metricName!=null&&u.metrics?.registerMetricGroup(u.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=u.sort,this.queue=[],this.emitEmpty=debounce$1(this.emitEmpty.bind(this),1),this.emitIdle=debounce$1(this.emitIdle.bind(this),1)}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}pause(){this.paused=!0}resume(){this.paused&&(this.paused=!1,this.tryToStartAnother())}tryToStartAnother(){if(this.paused)return!1;if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let u;for(const g of this.queue)if(g.status==="queued"){u=g;break}return u==null?!1:(this.safeDispatchEvent("active"),this.pending++,u.run().finally(()=>{for(let g=0;g<this.queue.length;g++)if(this.queue[g]===u){this.queue.splice(g,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(u){this.queue.push(u),this.sort!=null&&this.queue.sort(this.sort)}async add(u,g){if(g?.signal?.throwIfAborted(),this.size===this.maxSize)throw new QueueFullError$1;const v=new Job$1(u,g);return this.enqueue(v),this.safeDispatchEvent("add"),this.tryToStartAnother(),v.join(g).then(b=>(this.safeDispatchEvent("completed",{detail:b}),this.safeDispatchEvent("success",{detail:{job:v,result:b}}),b)).catch(b=>{if(v.status==="queued"){for(let w=0;w<this.queue.length;w++)if(this.queue[w]===v){this.queue.splice(w,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:v,error:b}}),b})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(u=>{u.abort(new AbortError$6)}),this.clear()}async onEmpty(u){this.size!==0&&await pEvent(this,"empty",u)}async onSizeLessThan(u,g){this.size<u||await pEvent(this,"next",{...g,filter:()=>this.size<u})}async onIdle(u){this.pending===0&&this.size===0||await pEvent(this,"idle",u)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(u){u?.signal?.throwIfAborted();const g=pushable({objectMode:!0}),v=A=>{A!=null?this.abort():this.clear(),g.end(A)},b=A=>{A.detail!=null&&g.push(A.detail)},w=A=>{v(A.detail.error)},E=()=>{v()},S=()=>{v(new AbortError$6("Queue aborted"))};this.addEventListener("completed",b),this.addEventListener("failure",w),this.addEventListener("idle",E),u?.signal?.addEventListener("abort",S);try{yield*g}finally{this.removeEventListener("completed",b),this.removeEventListener("failure",w),this.removeEventListener("idle",E),u?.signal?.removeEventListener("abort",S),v()}}};const DEFAULT_MAX_READ_BUFFER_LENGTH=Math.pow(2,20)*4;class AbstractMessageStream extends TypedEventEmitter{status;timeline;inactivityTimeout;maxReadBufferLength;maxWriteBufferLength;log;direction;maxMessageSize;readStatus;writeStatus;remoteReadStatus;remoteWriteStatus;writableNeedsDrain;readBuffer;writeBuffer;sendingData;onDrainPromise;constructor(u){super(),this.status="open",this.log=u.log,this.direction=u.direction??"outbound",this.inactivityTimeout=u.inactivityTimeout??12e4,this.maxReadBufferLength=u.maxReadBufferLength??DEFAULT_MAX_READ_BUFFER_LENGTH,this.maxWriteBufferLength=u.maxWriteBufferLength,this.maxMessageSize=u.maxMessageSize,this.readBuffer=new Uint8ArrayList,this.writeBuffer=new Uint8ArrayList,this.readStatus="readable",this.remoteReadStatus="readable",this.writeStatus="writable",this.remoteWriteStatus="writable",this.sendingData=!1,this.writableNeedsDrain=!1,this.timeline={open:Date.now()},this.processSendQueue=this.processSendQueue.bind(this);const g=()=>{this.writableNeedsDrain&&(this.log.trace("drain event received, continue sending data"),this.writableNeedsDrain=!1,this.processSendQueue()),this.onDrainPromise?.resolve()};this.addEventListener("drain",g);const v=b=>{this.onDrainPromise?.reject(b.error??new StreamClosedError)};this.addEventListener("close",v)}get readBufferLength(){return this.readBuffer.byteLength}get writeBufferLength(){return this.writeBuffer.byteLength}async onDrain(u){return this.writableNeedsDrain!==!0?Promise.resolve():(this.onDrainPromise==null&&(this.onDrainPromise=Promise.withResolvers()),raceSignal$2(this.onDrainPromise.promise,u?.signal))}async*[Symbol.asyncIterator](){if(this.readStatus!=="readable"&&this.readStatus!=="paused")return;const u=pushable(),g=w=>{u.push(w.data)};this.addEventListener("message",g);const v=w=>{u.end(w.error)};this.addEventListener("close",v);const b=()=>{u.end()};this.addEventListener("remoteCloseWrite",b);try{yield*u}finally{this.removeEventListener("message",g),this.removeEventListener("close",v),this.removeEventListener("remoteCloseWrite",b)}}isReadable(){return this.status==="open"}send(u){if(this.writeStatus==="closed"||this.writeStatus==="closing")throw new StreamStateError(`Cannot write to a stream that is ${this.writeStatus}`);return this.log.trace("append %d bytes to write buffer",u.byteLength),this.writeBuffer.append(u),this.processSendQueue()}abort(u){if(!(this.status==="aborted"||this.status==="reset"||this.status==="closed")){this.log.error("abort with error - %e",u),this.status="aborted",this.readBuffer.byteLength>0&&this.readBuffer.consume(this.readBuffer.byteLength),this.writeBuffer.byteLength>0&&(this.writeBuffer.consume(this.writeBuffer.byteLength),this.safeDispatchEvent("idle")),this.writeStatus="closed",this.remoteWriteStatus="closed",this.readStatus="closed",this.remoteReadStatus="closed",this.timeline.close=Date.now();try{this.sendReset(u)}catch(g){this.log("failed to send reset to remote - %e",g)}this.dispatchEvent(new StreamAbortEvent(u))}}pause(){if(this.readStatus==="closed"||this.readStatus==="closing")throw new StreamStateError("Cannot pause a stream that is closing/closed");this.readStatus!=="paused"&&(this.readStatus="paused",this.sendPause())}resume(){if(this.readStatus==="closed"||this.readStatus==="closing")throw new StreamStateError("Cannot resume a stream that is closing/closed");this.readStatus!=="readable"&&(this.readStatus="readable",this.dispatchReadBuffer(),this.sendResume())}push(u){if(this.readStatus==="closed"||this.readStatus==="closing")throw new StreamStateError(`Cannot push data onto a stream that is ${this.readStatus}`);if(u.byteLength!==0){if(this.readBuffer.append(u),this.readStatus==="paused"||this.listenerCount("message")===0){this.checkReadBufferLength();return}setTimeout(()=>{this.dispatchReadBuffer()},0)}}unshift(u){if(this.readStatus==="closed"||this.readStatus==="closing")throw new StreamStateError(`Cannot push data onto a stream that is ${this.readStatus}`);if(u.byteLength!==0){if(this.readBuffer.prepend(u),this.readStatus==="paused"||this.listenerCount("message")===0){this.checkReadBufferLength();return}setTimeout(()=>{this.dispatchReadBuffer()},0)}}onData(u){if(u.byteLength!==0){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("ignoring data - read status %s",this.readStatus);return}this.readBuffer.append(u),this.dispatchReadBuffer()}}addEventListener(...u){super.addEventListener.apply(this,u),u[0]==="message"&&this.readBuffer.byteLength>0&&queueMicrotask(()=>{this.dispatchReadBuffer()})}onRemoteReset(){this.log("remote reset"),this.status="reset",this.writeStatus="closed",this.remoteWriteStatus="closed",this.remoteReadStatus="closed",this.timeline.close=Date.now(),this.readBuffer.byteLength===0&&(this.readStatus="closed");const u=new StreamResetError;this.dispatchEvent(new StreamResetEvent(u))}onTransportClosed(u){this.log("transport closed"),this.readStatus==="readable"&&this.readBuffer.byteLength===0&&(this.log("close readable end after transport closed and read buffer is empty"),this.readStatus="closed"),this.remoteReadStatus!=="closed"&&(this.remoteReadStatus="closed"),this.remoteWriteStatus!=="closed"&&(this.remoteWriteStatus="closed"),this.writeStatus!=="closed"&&(this.writeStatus="closed"),u!=null?this.abort(u):(this.status==="open"||this.status==="closing")&&(this.timeline.close=Date.now(),this.status="closed",this.writeStatus="closed",this.remoteWriteStatus="closed",this.remoteReadStatus="closed",this.dispatchEvent(new StreamCloseEvent))}onRemoteCloseWrite(){this.remoteWriteStatus!=="closed"&&(this.log.trace("on remote close write"),this.remoteWriteStatus="closed",this.safeDispatchEvent("remoteCloseWrite"),this.writeStatus==="closed"&&this.onTransportClosed())}onRemoteCloseRead(){this.log.trace("on remote close read"),this.remoteReadStatus="closed",this.writeBuffer.byteLength>0&&(this.writeBuffer.consume(this.writeBuffer.byteLength),this.safeDispatchEvent("idle"))}processSendQueue(){if(this.writableNeedsDrain)return this.log.trace("not processing send queue as drain is required"),this.checkWriteBufferLength(),!1;if(this.writeBuffer.byteLength===0)return this.log.trace("not processing send queue as no bytes to send"),!0;if(this.sendingData)return this.log.trace("not processing send queue as already sending data"),!0;this.sendingData=!0,this.log.trace("processing send queue with %d queued bytes",this.writeBuffer.byteLength);try{let u=!0;const g=this.writeBuffer.byteLength;let v=0;for(;this.writeBuffer.byteLength>0;){const b=Math.min(this.maxMessageSize??this.writeBuffer.byteLength,this.writeBuffer.byteLength);if(b===0){u=!1;break}const w=this.writeBuffer.sublist(0,b),E=new Uint8ArrayList(w);this.writeBuffer.consume(w.byteLength);const S=this.sendData(w);if(u=S.canSendMore,v+=S.sentBytes,S.sentBytes!==E.byteLength&&(E.consume(S.sentBytes),this.writeBuffer.prepend(E)),!u)break}return u||(this.log.trace("sent %d/%d bytes, pausing sending because underlying stream is full, %d bytes left in the write buffer",v,g,this.writeBuffer.byteLength),this.writableNeedsDrain=!0,this.checkWriteBufferLength()),this.writeBuffer.byteLength===0&&this.safeDispatchEvent("idle"),u}finally{this.sendingData=!1}}dispatchReadBuffer(){try{if(this.listenerCount("message")===0){this.log.trace("not dispatching pause buffer as there are no listeners for the message event");return}if(this.readBuffer.byteLength===0){this.log.trace("not dispatching pause buffer as there is no data to dispatch");return}if(this.readStatus==="paused"){this.log.trace("not dispatching pause buffer we are paused");return}if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("dropping %d bytes because the readable end is %s",this.readBuffer.byteLength,this.readStatus),this.readBuffer.consume(this.readBuffer.byteLength);return}const u=this.readBuffer.sublist();this.readBuffer.consume(u.byteLength),this.dispatchEvent(new StreamMessageEvent(u))}finally{this.readBuffer.byteLength===0&&this.remoteWriteStatus==="closed"&&(this.log("close readable end after dispatching read buffer and remote writable end is closed"),this.readStatus="closed"),this.checkReadBufferLength()}}checkReadBufferLength(){this.readBuffer.byteLength>this.maxReadBufferLength&&this.abort(new StreamBufferError(`Read buffer length of ${this.readBuffer.byteLength} exceeded limit of ${this.maxReadBufferLength}, read status is ${this.readStatus}`))}checkWriteBufferLength(){this.maxWriteBufferLength!=null&&this.writeBuffer.byteLength>this.maxWriteBufferLength&&this.abort(new StreamBufferError(`Write buffer length of ${this.writeBuffer.byteLength} exceeded limit of ${this.maxWriteBufferLength}, write status is ${this.writeStatus}`))}onMuxerNeedsDrain(){this.writableNeedsDrain=!0}onMuxerDrain(){this.safeDispatchEvent("drain")}}class AbstractMultiaddrConnection extends AbstractMessageStream{remoteAddr;metricPrefix;metrics;constructor(u){super(u),this.metricPrefix=u.metricPrefix??"",this.metrics=u.metrics,this.remoteAddr=u.remoteAddr,this.addEventListener("close",g=>{this.metrics?.increment({[`${this.metricPrefix}end`]:!0}),g.error!=null?g.local?this.metrics?.increment({[`${this.metricPrefix}abort`]:!0}):this.metrics?.increment({[`${this.metricPrefix}reset`]:!0}):g.local?this.metrics?.increment({[`${this.metricPrefix}_local_close`]:!0}):this.metrics?.increment({[`${this.metricPrefix}_remote_close`]:!0})})}async close(u){this.status==="open"&&(this.status="closing",this.writeStatus="closing",this.remoteWriteStatus="closing",this.remoteReadStatus="closing",(this.sendingData||this.writeBuffer.byteLength>0)&&(this.log("waiting for write queue to become idle before closing writable end of stream, %d unsent bytes",this.writeBuffer.byteLength),await pEvent(this,"idle",{...u,rejectionEvents:["close"]})),this.writableNeedsDrain&&(this.log("waiting for write queue to drain before closing writable end of stream, %d unsent bytes",this.writeBuffer.byteLength),await pEvent(this,"drain",{...u,rejectionEvents:["close"]})),await this.sendClose(u),this.onTransportClosed())}}function isPromise$5(y){return y==null?!1:typeof y.then=="function"&&typeof y.catch=="function"&&typeof y.finally=="function"}class AbstractStreamMuxer extends TypedEventEmitter{streams;protocol;status;log;maConn;streamOptions;earlyStreams;maxEarlyStreams;metrics;constructor(u,g){super(),this.maConn=u,this.protocol=g.protocol,this.streams=[],this.earlyStreams=[],this.status="open",this.log=u.log.newScope(g.name),this.streamOptions=g.streamOptions,this.maxEarlyStreams=g.maxEarlyStreams??10,this.metrics=g.metrics;const v=E=>{try{this.onData(E.data)}catch(S){this.abort(S),this.maConn.abort(S)}};this.maConn.addEventListener("message",v);const b=()=>{this.log("underlying stream drained, signal %d streams to continue writing",this.streams.length),this.streams.forEach(E=>{E.onMuxerDrain()})};this.maConn.addEventListener("drain",b);const w=()=>{this.log("underlying stream closed with status %s and %d streams",this.status,this.streams.length),this.onTransportClosed()};this.maConn.addEventListener("close",w)}send(u){const g=this.maConn.send(u);return g===!1&&(this.log("underlying stream saturated, signal %d streams to pause writing",this.streams.length),this.streams.forEach(v=>{v.onMuxerNeedsDrain()})),g}async close(u){this.status==="closed"||this.status==="closing"||(this.status="closing",await raceSignal$2(Promise.all([...this.streams].map(async g=>{await g.close(u)})),u?.signal),this.status="closed")}abort(u){this.status!=="closed"&&(this.status="closing",[...this.streams].forEach(g=>{g.abort(u)}),this.status="closed")}onTransportClosed(u){this.status="closing";try{[...this.streams].forEach(g=>{g.onTransportClosed(u)})}catch(g){this.abort(g)}this.status="closed"}async createStream(u){if(this.status!=="open")throw new MuxerClosedError;let g=this.onCreateStream({...this.streamOptions,...u});return isPromise$5(g)&&(g=await g),this.streams.push(g),this.cleanUpStream(g),g}onRemoteStream(u){if(this.streams.push(u),this.cleanUpStream(u),this.listenerCount("stream")===0){this.earlyStreams.push(u),this.earlyStreams.length>this.maxEarlyStreams&&this.abort(new MaxEarlyStreamsError(`Too many early streams were opened - ${this.earlyStreams.length}/${this.maxEarlyStreams}`));return}this.safeDispatchEvent("stream",{detail:u})}cleanUpStream(u){const g=v=>{const b=this.streams.findIndex(w=>w===u);b!==-1&&this.streams.splice(b,1),v.error!=null?v.local?this.metrics?.increment({[`${u.direction}_stream_reset`]:!0}):this.metrics?.increment({[`${u.direction}_stream_abort`]:!0}):this.metrics?.increment({[`${u.direction}_stream_end`]:!0})};u.addEventListener("close",g),this.metrics?.increment({[`${u.direction}_stream`]:!0})}addEventListener(...u){super.addEventListener.apply(this,u),u[0]==="stream"&&this.earlyStreams.length>0&&queueMicrotask(()=>{this.earlyStreams.forEach(g=>{this.safeDispatchEvent("stream",{detail:g})}),this.earlyStreams=[]})}}class AbstractStream extends AbstractMessageStream{id;protocol;constructor(u){super(u),this.id=u.id,this.protocol=u.protocol??""}async close(u){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.writeStatus="closing",(this.sendingData||this.writeBuffer.byteLength>0)&&(this.log("waiting for write queue to become idle before closing writable end of stream, %d unsent bytes",this.writeBuffer.byteLength),await pEvent(this,"idle",{...u,rejectionEvents:["close"]})),this.writableNeedsDrain&&(this.log("waiting for write queue to drain before closing writable end of stream, %d unsent bytes, sending %s",this.writeBuffer.byteLength,this.sendingData),await pEvent(this,"drain",{...u,rejectionEvents:["close"]}),this.log("write queue drained, closing writable end of stream, %d unsent bytes, sending %s",this.writeBuffer.byteLength,this.sendingData)),await this.sendCloseWrite(u),this.writeStatus="closed",this.log("closed writable end gracefully"),this.remoteWriteStatus==="closed"&&this.onTransportClosed())}async closeRead(u){this.readStatus==="closing"||this.readStatus==="closed"||(this.readBuffer.byteLength>0&&this.readBuffer.consume(this.readBuffer.byteLength),this.readStatus="closing",await this.sendCloseRead(u),this.readStatus="closed",this.log("closed readable end gracefully"))}}function anySignal(y){const u=new globalThis.AbortController;function g(){u.abort();for(const w of y)w?.removeEventListener!=null&&w.removeEventListener("abort",g)}for(const w of y){if(w?.aborted===!0){g();break}w?.addEventListener!=null&&w.addEventListener("abort",g)}function v(){for(const w of y)w?.removeEventListener!=null&&w.removeEventListener("abort",g)}const b=u.signal;return b.clear=v,b}class MovingAverage{movingAverage;variance;deviation;forecast;timeSpan;previousTime;constructor(u){this.timeSpan=u,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(u,g){return 1-Math.exp(-(u-g)/this.timeSpan)}push(u,g=Date.now()){if(this.previousTime!=null){const v=this.alpha(g,this.previousTime),b=u-this.movingAverage,w=v*b;this.movingAverage=v*u+(1-v)*this.movingAverage,this.variance=(1-v)*(this.variance+b*w),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+v*b}else this.movingAverage=u;this.previousTime=g}}const DEFAULT_TIMEOUT_MULTIPLIER=1.2,DEFAULT_FAILURE_MULTIPLIER=2,DEFAULT_MIN_TIMEOUT=5e3,DEFAULT_MAX_TIMEOUT=6e4,DEFAULT_INTERVAL=5e3;class AdaptiveTimeout{success;failure;next;metric;timeoutMultiplier;failureMultiplier;minTimeout;maxTimeout;constructor(u={}){const g=u.interval??DEFAULT_INTERVAL;this.success=new MovingAverage(g),this.failure=new MovingAverage(g),this.next=new MovingAverage(g),this.failureMultiplier=u.failureMultiplier??DEFAULT_FAILURE_MULTIPLIER,this.timeoutMultiplier=u.timeoutMultiplier??DEFAULT_TIMEOUT_MULTIPLIER,this.minTimeout=u.minTimeout??DEFAULT_MIN_TIMEOUT,this.maxTimeout=u.maxTimeout??DEFAULT_MAX_TIMEOUT,u.metricName!=null&&(this.metric=u.metrics?.registerMetricGroup(u.metricName))}getTimeoutSignal(u={}){let g=Math.round(this.next.movingAverage*(u.timeoutFactor??this.timeoutMultiplier));g<this.minTimeout&&(g=this.minTimeout),g>this.maxTimeout&&(g=this.maxTimeout);const v=AbortSignal.timeout(g),b=anySignal([u.signal,v]);return b.start=Date.now(),b.timeout=g,b}cleanUp(u){const g=Date.now()-u.start;u.aborted?(this.failure.push(g),this.next.push(g*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:g})):(this.success.push(g),this.next.push(g),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:g}))}}class InvalidMultiaddrError extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"}class ValidationError extends Error{static name="ValidationError";name="ValidationError"}class InvalidParametersError extends Error{static name="InvalidParametersError";name="InvalidParametersError"}class UnknownProtocolError extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"}const CODE_IP4=4,CODE_TCP=6,CODE_UDP=273,CODE_DCCP=33,CODE_IP6=41,CODE_IP6ZONE=42,CODE_IPCIDR=43,CODE_DNS=53,CODE_DNS4=54,CODE_DNS6=55,CODE_DNSADDR=56,CODE_SCTP=132,CODE_UDT=301,CODE_UTP=302,CODE_UNIX=400,CODE_P2P=421,CODE_ONION=444,CODE_ONION3=445,CODE_GARLIC64=446,CODE_GARLIC32=447,CODE_TLS=448,CODE_SNI=449,CODE_NOISE=454,CODE_QUIC=460,CODE_QUIC_V1=461,CODE_WEBTRANSPORT=465,CODE_CERTHASH=466,CODE_HTTP=480,CODE_HTTP_PATH=481,CODE_HTTPS=443,CODE_WS=477,CODE_WSS=478,CODE_P2P_WEBSOCKET_STAR=479,CODE_P2P_STARDUST=277,CODE_P2P_WEBRTC_STAR=275,CODE_P2P_WEBRTC_DIRECT=276,CODE_WEBRTC_DIRECT=280,CODE_WEBRTC=281,CODE_P2P_CIRCUIT=290,CODE_MEMORY=777;function bytesToString(y){return u=>toString$3(u,y)}function stringToBytes(y){return u=>fromString$1(u,y)}function bytes2port(y){return new DataView(y.buffer).getUint16(y.byteOffset).toString()}function port2bytes(y){const u=new ArrayBuffer(2);return new DataView(u).setUint16(0,typeof y=="string"?parseInt(y):y),new Uint8Array(u)}function onion2bytes(y){const u=y.split(":");if(u.length!==2)throw new Error(`failed to parse onion addr: ["'${u.join('", "')}'"]' does not contain a port number`);if(u[0].length!==16)throw new Error(`failed to parse onion addr: ${u[0]} not a Tor onion address.`);const g=fromString$1(u[0],"base32"),v=parseInt(u[1],10);if(v<1||v>65536)throw new Error("Port number is not in range(1, 65536)");const b=port2bytes(v);return concat$2([g,b],g.length+b.length)}function onion32bytes(y){const u=y.split(":");if(u.length!==2)throw new Error(`failed to parse onion addr: ["'${u.join('", "')}'"]' does not contain a port number`);if(u[0].length!==56)throw new Error(`failed to parse onion addr: ${u[0]} not a Tor onion3 address.`);const g=base32.decode(`b${u[0]}`),v=parseInt(u[1],10);if(v<1||v>65536)throw new Error("Port number is not in range(1, 65536)");const b=port2bytes(v);return concat$2([g,b],g.length+b.length)}function bytes2onion(y){const u=y.subarray(0,y.length-2),g=y.subarray(y.length-2),v=toString$3(u,"base32"),b=bytes2port(g);return`${v}:${b}`}const ip4ToBytes=function(y){y=y.toString().trim();const u=new Uint8Array(4);return y.split(/\./g).forEach((g,v)=>{const b=parseInt(g,10);if(isNaN(b)||b<0||b>255)throw new InvalidMultiaddrError("Invalid byte value in IP address");u[v]=b}),u},ip6ToBytes=function(y){let u=0;y=y.toString().trim();const g=y.split(":",8);let v;for(v=0;v<g.length;v++){const w=isIPv4$1(g[v]);let E;w&&(E=ip4ToBytes(g[v]),g[v]=toString$3(E.subarray(0,2),"base16")),E!=null&&++v<8&&g.splice(v,0,toString$3(E.subarray(2,4),"base16"))}if(g[0]==="")for(;g.length<8;)g.unshift("0");else if(g[g.length-1]==="")for(;g.length<8;)g.push("0");else if(g.length<8){for(v=0;v<g.length&&g[v]!=="";v++);const w=[v,1];for(v=9-g.length;v>0;v--)w.push("0");g.splice.apply(g,w)}const b=new Uint8Array(u+16);for(v=0;v<g.length;v++){g[v]===""&&(g[v]="0");const w=parseInt(g[v],16);if(isNaN(w)||w<0||w>65535)throw new InvalidMultiaddrError("Invalid byte value in IP address");b[u++]=w>>8&255,b[u++]=w&255}return b},ip4ToString=function(y){if(y.byteLength!==4)throw new InvalidMultiaddrError("IPv4 address was incorrect length");const u=[];for(let g=0;g<y.byteLength;g++)u.push(y[g]);return u.join(".")},ip6ToString=function(y){if(y.byteLength!==16)throw new InvalidMultiaddrError("IPv6 address was incorrect length");const u=[];for(let v=0;v<y.byteLength;v+=2){const b=y[v],w=y[v+1],E=`${b.toString(16).padStart(2,"0")}${w.toString(16).padStart(2,"0")}`;u.push(E)}const g=u.join(":");try{const v=new URL(`http://[${g}]`);return v.hostname.substring(1,v.hostname.length-1)}catch{throw new InvalidMultiaddrError(`Invalid IPv6 address "${g}"`)}};function ip6StringToValue(y){try{const u=new URL(`http://[${y}]`);return u.hostname.substring(1,u.hostname.length-1)}catch{throw new InvalidMultiaddrError(`Invalid IPv6 address "${y}"`)}}const decoders=Object.values(bases).map(y=>y.decoder),anybaseDecoder=(function(){let y=decoders[0].or(decoders[1]);return decoders.slice(2).forEach(u=>y=y.or(u)),y})();function mb2bytes(y){return anybaseDecoder.decode(y)}function bytes2mb(y){return u=>y.encoder.encode(u)}function integer$1(y){if(parseInt(y).toString()!==y)throw new ValidationError("Value must be an integer")}function positive(y){if(y<0)throw new ValidationError("Value must be a positive integer, or zero")}function maxValue(y){return u=>{if(u>y)throw new ValidationError(`Value must be smaller than or equal to ${y}`)}}function validate$3(...y){return u=>{for(const g of y)g(u)}}const validatePort=validate$3(integer$1,positive,maxValue(65535)),V=-1;let Registry$1=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(u){let g;if(typeof u=="string"?g=this.protocolsByName.get(u):g=this.protocolsByCode.get(u),g==null)throw new UnknownProtocolError(`Protocol ${u} was unknown`);return g}addProtocol(u){this.protocolsByCode.set(u.code,u),this.protocolsByName.set(u.name,u),u.aliases?.forEach(g=>{this.protocolsByName.set(g,u)})}removeProtocol(u){const g=this.protocolsByCode.get(u);g!=null&&(this.protocolsByCode.delete(g.code),this.protocolsByName.delete(g.name),g.aliases?.forEach(v=>{this.protocolsByName.delete(v)}))}};const registry$1=new Registry$1,codecs=[{code:CODE_IP4,name:"ip4",size:32,valueToBytes:ip4ToBytes,bytesToValue:ip4ToString,validate:y=>{if(!isIPv4$1(y))throw new ValidationError(`Invalid IPv4 address "${y}"`)}},{code:CODE_TCP,name:"tcp",size:16,valueToBytes:port2bytes,bytesToValue:bytes2port,validate:validatePort},{code:CODE_UDP,name:"udp",size:16,valueToBytes:port2bytes,bytesToValue:bytes2port,validate:validatePort},{code:CODE_DCCP,name:"dccp",size:16,valueToBytes:port2bytes,bytesToValue:bytes2port,validate:validatePort},{code:CODE_IP6,name:"ip6",size:128,valueToBytes:ip6ToBytes,bytesToValue:ip6ToString,stringToValue:ip6StringToValue,validate:y=>{if(!isIPv6$1(y))throw new ValidationError(`Invalid IPv6 address "${y}"`)}},{code:CODE_IP6ZONE,name:"ip6zone",size:V},{code:CODE_IPCIDR,name:"ipcidr",size:8,bytesToValue:bytesToString("base10"),valueToBytes:stringToBytes("base10")},{code:CODE_DNS,name:"dns",size:V},{code:CODE_DNS4,name:"dns4",size:V},{code:CODE_DNS6,name:"dns6",size:V},{code:CODE_DNSADDR,name:"dnsaddr",size:V},{code:CODE_SCTP,name:"sctp",size:16,valueToBytes:port2bytes,bytesToValue:bytes2port,validate:validatePort},{code:CODE_UDT,name:"udt"},{code:CODE_UTP,name:"utp"},{code:CODE_UNIX,name:"unix",size:V,stringToValue:y=>decodeURIComponent(y),valueToString:y=>encodeURIComponent(y)},{code:CODE_P2P,name:"p2p",aliases:["ipfs"],size:V,bytesToValue:bytesToString("base58btc"),valueToBytes:y=>y.startsWith("Q")||y.startsWith("1")?stringToBytes("base58btc")(y):CID.parse(y).multihash.bytes},{code:CODE_ONION,name:"onion",size:96,bytesToValue:bytes2onion,valueToBytes:onion2bytes},{code:CODE_ONION3,name:"onion3",size:296,bytesToValue:bytes2onion,valueToBytes:onion32bytes},{code:CODE_GARLIC64,name:"garlic64",size:V},{code:CODE_GARLIC32,name:"garlic32",size:V},{code:CODE_TLS,name:"tls"},{code:CODE_SNI,name:"sni",size:V},{code:CODE_NOISE,name:"noise"},{code:CODE_QUIC,name:"quic"},{code:CODE_QUIC_V1,name:"quic-v1"},{code:CODE_WEBTRANSPORT,name:"webtransport"},{code:CODE_CERTHASH,name:"certhash",size:V,bytesToValue:bytes2mb(base64url$1),valueToBytes:mb2bytes},{code:CODE_HTTP,name:"http"},{code:CODE_HTTP_PATH,name:"http-path",size:V,stringToValue:y=>`/${decodeURIComponent(y)}`,valueToString:y=>encodeURIComponent(y.substring(1))},{code:CODE_HTTPS,name:"https"},{code:CODE_WS,name:"ws"},{code:CODE_WSS,name:"wss"},{code:CODE_P2P_WEBSOCKET_STAR,name:"p2p-websocket-star"},{code:CODE_P2P_STARDUST,name:"p2p-stardust"},{code:CODE_P2P_WEBRTC_STAR,name:"p2p-webrtc-star"},{code:CODE_P2P_WEBRTC_DIRECT,name:"p2p-webrtc-direct"},{code:CODE_WEBRTC_DIRECT,name:"webrtc-direct"},{code:CODE_WEBRTC,name:"webrtc"},{code:CODE_P2P_CIRCUIT,name:"p2p-circuit"},{code:CODE_MEMORY,name:"memory",size:V}];codecs.forEach(y=>{registry$1.addProtocol(y)});function bytesToComponents(y){const u=[];let g=0;for(;g<y.length;){const v=decode$7(y,g),b=registry$1.getProtocol(v),w=encodingLength(v),E=sizeForAddr(b,y,g+w);let S=0;E>0&&b.size===V&&(S=encodingLength(E));const A=w+S+E,$={code:v,name:b.name,bytes:y.subarray(g,g+A)};if(E>0){const R=g+w+S,T=y.subarray(R,R+E);$.value=b.bytesToValue?.(T)??toString$3(T)}u.push($),g+=A}return u}function componentsToBytes(y){let u=0;const g=[];for(const v of y){if(v.bytes==null){const b=registry$1.getProtocol(v.code),w=encodingLength(v.code);let E,S=0,A=0;v.value!=null&&(E=b.valueToBytes?.(v.value)??fromString$1(v.value),S=E.byteLength,b.size===V&&(A=encodingLength(S)));const $=new Uint8Array(w+A+S);let R=0;encodeUint8Array(v.code,$,R),R+=w,E!=null&&(b.size===V&&(encodeUint8Array(S,$,R),R+=A),$.set(E,R)),v.bytes=$}g.push(v.bytes),u+=v.bytes.byteLength}return concat$2(g,u)}function stringToComponents(y){if(y.charAt(0)!=="/")throw new InvalidMultiaddrError('String multiaddr must start with "/"');const u=[];let g="protocol",v="",b="";for(let w=1;w<y.length;w++){const E=y.charAt(w);E!=="/"&&(g==="protocol"?b+=y.charAt(w):v+=y.charAt(w));const S=w===y.length-1;if(E==="/"||S){const A=registry$1.getProtocol(b);if(g==="protocol"){if(A.size==null||A.size===0){u.push({code:A.code,name:A.name}),v="",b="",g="protocol";continue}else if(S)throw new InvalidMultiaddrError(`Component ${b} was missing value`);g="value"}else if(g==="value"){const $={code:A.code,name:A.name};if(A.size!=null&&A.size!==0){if(v==="")throw new InvalidMultiaddrError(`Component ${b} was missing value`);$.value=A.stringToValue?.(v)??v}u.push($),v="",b="",g="protocol"}}}if(b!==""&&v!=="")throw new InvalidMultiaddrError("Incomplete multiaddr");return u}function componentsToString(y){return`/${y.flatMap(u=>{if(u.value==null)return u.name;const g=registry$1.getProtocol(u.code);if(g==null)throw new InvalidMultiaddrError(`Unknown protocol code ${u.code}`);return[u.name,g.valueToString?.(u.value)??u.value]}).join("/")}`}function sizeForAddr(y,u,g){return y.size==null||y.size===0?0:y.size>0?y.size/8:decode$7(u,g)}const inspect$1=Symbol.for("nodejs.util.inspect.custom"),symbol=Symbol.for("@multiformats/multiaddr");function toComponents(y){if(y==null&&(y="/"),isMultiaddr(y))return y.getComponents();if(y instanceof Uint8Array)return bytesToComponents(y);if(typeof y=="string")return y=y.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),y===""&&(y="/"),stringToComponents(y);if(Array.isArray(y))return y;throw new InvalidMultiaddrError("Must be a string, Uint8Array, Component[], or another Multiaddr")}class Multiaddr{[symbol]=!0;#e;#t;#r;constructor(u="/",g={}){this.#e=toComponents(u),g.validate!==!1&&validate$2(this)}get bytes(){return this.#r==null&&(this.#r=componentsToBytes(this.#e)),this.#r}toString(){return this.#t==null&&(this.#t=componentsToString(this.#e)),this.#t}toJSON(){return this.toString()}getComponents(){return[...this.#e.map(u=>({...u}))]}encapsulate(u){const g=new Multiaddr(u);return new Multiaddr([...this.#e,...g.getComponents()],{validate:!1})}decapsulate(u){const g=u.toString(),v=this.toString(),b=v.lastIndexOf(g);if(b<0)throw new InvalidParametersError(`Address ${this.toString()} does not contain subaddress: ${g}`);return new Multiaddr(v.slice(0,b),{validate:!1})}decapsulateCode(u){let g;for(let v=this.#e.length-1;v>-1;v--)if(this.#e[v].code===u){g=v;break}return new Multiaddr(this.#e.slice(0,g),{validate:!1})}equals(u){return equals(this.bytes,u.bytes)}[inspect$1](){return`Multiaddr(${this.toString()})`}}function validate$2(y){y.getComponents().forEach(u=>{const g=registry$1.getProtocol(u.code);u.value!=null&&g.validate?.(u.value)})}function isMultiaddr(y){return!!y?.[symbol]}function multiaddr(y){return new Multiaddr(y)}const index$2=Object.freeze(Object.defineProperty({__proto__:null,CODE_CERTHASH,CODE_DCCP,CODE_DNS,CODE_DNS4,CODE_DNS6,CODE_DNSADDR,CODE_GARLIC32,CODE_GARLIC64,CODE_HTTP,CODE_HTTPS,CODE_HTTP_PATH,CODE_IP4,CODE_IP6,CODE_IP6ZONE,CODE_IPCIDR,CODE_MEMORY,CODE_NOISE,CODE_ONION,CODE_ONION3,CODE_P2P,CODE_P2P_CIRCUIT,CODE_P2P_STARDUST,CODE_P2P_WEBRTC_DIRECT,CODE_P2P_WEBRTC_STAR,CODE_P2P_WEBSOCKET_STAR,CODE_QUIC,CODE_QUIC_V1,CODE_SCTP,CODE_SNI,CODE_TCP,CODE_TLS,CODE_UDP,CODE_UDT,CODE_UNIX,CODE_UTP,CODE_WEBRTC,CODE_WEBRTC_DIRECT,CODE_WEBTRANSPORT,CODE_WS,CODE_WSS,V,isMultiaddr,multiaddr,registry:registry$1},Symbol.toStringTag,{value:"Module"}));let AbortError$3=class extends Error{type;code;constructor(u,g,v){super(u??"The operation was aborted"),this.type="aborted",this.name=v??"AbortError",this.code=g??"ABORT_ERR"}};async function raceSignal$1(y,u,g){if(u==null)return y;if(u.aborted)return y.catch(()=>{}),Promise.reject(new AbortError$3(g?.errorMessage,g?.errorCode,g?.errorName));let v;const b=new AbortError$3(g?.errorMessage,g?.errorCode,g?.errorName);try{return await Promise.race([y,new Promise((w,E)=>{v=()=>{E(b)},u.addEventListener("abort",v)})])}finally{v!=null&&u.removeEventListener("abort",v)}}class QueuelessPushable{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=pDefer(),this.haveNext=pDefer()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const u=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=pDefer(),u}async throw(u){return this.ended=!0,this.error=u,u!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(u)),{done:!0,value:void 0}}async return(){const u={done:!0,value:void 0};return this.ended=!0,this.nextResult=u,this.haveNext.resolve(),u}async push(u,g){await this._push(u,g)}async end(u,g){u!=null?await this.throw(u):await this._push(void 0,g)}async _push(u,g){if(u!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;u!=null?this.nextResult={done:!1,value:u}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=pDefer(),await raceSignal$1(this.readNext.promise,g?.signal,g)}}function queuelessPushable(){return new QueuelessPushable}function isAsyncIterable$b(y){return y[Symbol.asyncIterator]!=null}async function addAllToPushable(y,u,g){try{await Promise.all(y.map(async v=>{for await(const b of v)await u.push(b,{signal:g}),g.throwIfAborted()})),await u.end(void 0,{signal:g})}catch(v){await u.end(v,{signal:g}).catch(()=>{})}}async function*mergeSources(y){const u=new AbortController,g=queuelessPushable();addAllToPushable(y,g,u.signal).catch(()=>{});try{yield*g}finally{u.abort()}}function*mergeSyncSources(y){for(const u of y)yield*u}function merge$1(...y){const u=[];for(const g of y)isAsyncIterable$b(g)||u.push(g);return u.length===y.length?mergeSyncSources(u):mergeSources(y)}function pipe$1(y,...u){if(y==null)throw new Error("Empty pipeline");if(isDuplex(y)){const v=y;y=()=>v.source}else if(isIterable(y)||isAsyncIterable$a(y)){const v=y;y=()=>v}const g=[y,...u];if(g.length>1&&isDuplex(g[g.length-1])&&(g[g.length-1]=g[g.length-1].sink),g.length>2)for(let v=1;v<g.length-1;v++)isDuplex(g[v])&&(g[v]=duplexPipelineFn(g[v]));return rawPipe(...g)}const rawPipe=(...y)=>{let u;for(;y.length>0;)u=y.shift()(u);return u},isAsyncIterable$a=y=>y?.[Symbol.asyncIterator]!=null,isIterable=y=>y?.[Symbol.iterator]!=null,isDuplex=y=>y==null?!1:y.sink!=null&&y.source!=null,duplexPipelineFn=y=>u=>{const g=y.sink(u);if(g?.then!=null){const v=pushable({objectMode:!0});g.then(()=>{v.end()},E=>{v.end(E)});let b;const w=y.source;if(isAsyncIterable$a(w))b=async function*(){yield*w,v.end()};else if(isIterable(w))b=function*(){yield*w,v.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return merge$1(v,b())}return y.source},DEFAULT_MAX_BUFFER_SIZE$1=4194304;class UnwrappedError extends Error{static name="UnwrappedError";name="UnwrappedError"}let InvalidMessageLengthError$2=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},InvalidDataLengthError$1=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},InvalidDataLengthLengthError$1=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function isStream(y){return typeof y?.closeRead=="function"}function isMultiaddrConnection(y){return typeof y?.close=="function"}function isEOF(y){return isStream(y)?y.remoteWriteStatus!=="writable"&&y.readBufferLength===0:isMultiaddrConnection(y)?y.status!=="open":!1}function isValid(y){return y?.addEventListener!=null&&y?.removeEventListener!=null&&y?.send!=null&&y?.push!=null&&y?.log!=null}function byteStream(y,u){const g=u?.maxBufferSize??DEFAULT_MAX_BUFFER_SIZE$1,v=new Uint8ArrayList;let b,w=!1;if(!isValid(y))throw new InvalidParametersError$1("Argument should be a Stream or a Multiaddr");const E=R=>{if(v.append(R.data),v.byteLength>g){const T=v.byteLength;v.consume(v.byteLength),b?.reject(new Error(`Read buffer overflow - ${T} > ${g}`))}b?.resolve()};y.addEventListener("message",E);const S=R=>{R.error!=null?b?.reject(R.error):b?.resolve()};y.addEventListener("close",S);const A=()=>{b?.resolve()};y.addEventListener("remoteCloseWrite",A);const $={readBuffer:v,async read(R){if(w===!0)throw new UnwrappedError("Stream was unwrapped");if(isEOF(y)){if(R?.bytes==null)return null;if(v.byteLength<R.bytes)throw y.log.error("closed after reading %d/%d bytes",v.byteLength,R.bytes),new UnexpectedEOFError$1(`Unexpected EOF - stream closed after reading ${v.byteLength}/${R.bytes} bytes`)}const T=R?.bytes??1;for(b=Promise.withResolvers();;){if(v.byteLength>=T){b.resolve();break}if(await raceSignal$2(b.promise,R?.signal),isEOF(y)){if(v.byteLength===0&&R?.bytes==null)return null;break}b=Promise.withResolvers()}const O=R?.bytes??v.byteLength;if(v.byteLength<O){if(isEOF(y))throw y.log.error("closed while reading %d/%d bytes",v.byteLength,O),new UnexpectedEOFError$1(`Unexpected EOF - stream closed while reading ${v.byteLength}/${O} bytes`);return $.read(R)}const B=v.sublist(0,O);return v.consume(O),B},async write(R,T){if(w===!0)throw new UnwrappedError("Stream was unwrapped");y.send(R)||await pEvent(y,"drain",{signal:T?.signal,rejectionEvents:["close"]})},unwrap(){return w||(w=!0,y.removeEventListener("message",E),y.removeEventListener("close",S),y.removeEventListener("remoteCloseWrite",A),v.byteLength>0&&(y.log("stream unwrapped with %d unread bytes",v.byteLength),y.push(v))),y}};return $}function lpStream(y,u={}){const g=byteStream(y,u);u.maxDataLength!=null&&u.maxLengthLength==null&&(u.maxLengthLength=encodingLength(u.maxDataLength));const v=u?.lengthDecoder??decode$7,b=u?.lengthEncoder??encode$9;return{async read(E){let S=-1;const A=new Uint8ArrayList;for(;;){const R=await g.read({...E,bytes:1});if(R==null)break;A.append(R);try{S=v(A)}catch(T){if(T instanceof RangeError)continue;throw T}if(S<0)throw new InvalidMessageLengthError$2("Invalid message length");if(u?.maxLengthLength!=null&&A.byteLength>u.maxLengthLength)throw new InvalidDataLengthLengthError$1(`Message length length too long - ${A.byteLength} > ${u.maxLengthLength}`);if(S>-1)break}if(u?.maxDataLength!=null&&S>u.maxDataLength)throw new InvalidDataLengthError$1(`Message length too long - ${S} > ${u.maxDataLength}`);const $=await g.read({...E,bytes:S});if($==null)throw y.log.error("tried to read %d bytes but the stream closed",S),new UnexpectedEOFError$1(`Unexpected EOF - tried to read ${S} bytes but the stream closed`);if($.byteLength!==S)throw y.log.error("read %d/%d bytes before the stream closed",$.byteLength,S),new UnexpectedEOFError$1(`Unexpected EOF - read ${$.byteLength}/${S} bytes before the stream closed`);return $},async write(E,S){await g.write(new Uint8ArrayList(b(E.byteLength),E),S)},async writeV(E,S){const A=new Uint8ArrayList(...E.flatMap($=>[b($.byteLength),$]));await g.write(A,S)},unwrap(){return g.unwrap()}}}function pbStream(y,u){const g=lpStream(y,u),v={read:async(b,w)=>{const E=await g.read(w);return b.decode(E)},write:async(b,w,E)=>{await g.write(w.encode(b),E)},writeV:async(b,w,E)=>{await g.writeV(b.map(S=>w.encode(S)),E)},pb:b=>({read:async w=>v.read(b,w),write:async(w,E)=>v.write(w,b,E),writeV:async(w,E)=>v.writeV(w,b,E),unwrap:()=>v}),unwrap:()=>g.unwrap()};return v}const DEFAULT_MAX_BUFFER_SIZE=1024*1024*4,DEFAULT_MAX_DATA_LENGTH=1024*1024*4;class LengthPrefixedDecoder{buffer;maxBufferSize;lengthDecoder;maxDataLength;encodingLength;constructor(u={}){this.buffer=new Uint8ArrayList,this.maxBufferSize=u.maxBufferSize??DEFAULT_MAX_BUFFER_SIZE,this.maxDataLength=u.maxDataLength??DEFAULT_MAX_DATA_LENGTH,this.lengthDecoder=u.lengthDecoder??decode$7,this.encodingLength=u.encodingLength??encodingLength}*decode(u){if(this.buffer.append(u),this.buffer.byteLength>this.maxBufferSize)throw new InvalidParametersError$1(`Buffer length limit exceeded - ${this.buffer.byteLength}/${this.maxBufferSize}`);for(;;){let g;try{g=this.lengthDecoder(this.buffer)}catch(w){if(w instanceof RangeError)break;throw w}if(g<0||g>this.maxDataLength)throw new InvalidMessageLengthError$2("Invalid message length");const v=this.encodingLength(g),b=v+g;if(this.buffer.byteLength>=b){const w=this.buffer.sublist(v,b);this.buffer.consume(b),w.byteLength>0&&(yield w)}else break}}}const typeofs=["string","number","bigint","symbol"],objectTypeNames=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function is(y){if(y===null)return"null";if(y===void 0)return"undefined";if(y===!0||y===!1)return"boolean";const u=typeof y;if(typeofs.includes(u))return u;if(u==="function")return"Function";if(Array.isArray(y))return"Array";if(isBuffer$1(y))return"Buffer";const g=getObjectType(y);return g||"Object"}function isBuffer$1(y){return y&&y.constructor&&y.constructor.isBuffer&&y.constructor.isBuffer.call(null,y)}function getObjectType(y){const u=Object.prototype.toString.call(y).slice(8,-1);if(objectTypeNames.includes(u))return u}class Type{constructor(u,g,v){this.major=u,this.majorEncoded=u<<5,this.name=g,this.terminal=v}toString(){return`Type[${this.major}].${this.name}`}compare(u){return this.major<u.major?-1:this.major>u.major?1:0}}Type.uint=new Type(0,"uint",!0);Type.negint=new Type(1,"negint",!0);Type.bytes=new Type(2,"bytes",!0);Type.string=new Type(3,"string",!0);Type.array=new Type(4,"array",!1);Type.map=new Type(5,"map",!1);Type.tag=new Type(6,"tag",!1);Type.float=new Type(7,"float",!0);Type.false=new Type(7,"false",!0);Type.true=new Type(7,"true",!0);Type.null=new Type(7,"null",!0);Type.undefined=new Type(7,"undefined",!0);Type.break=new Type(7,"break",!0);class Token{constructor(u,g,v){this.type=u,this.value=g,this.encodedLength=v,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const useBuffer=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",textDecoder$1=new TextDecoder,textEncoder$2=new TextEncoder;function isBuffer(y){return useBuffer&&globalThis.Buffer.isBuffer(y)}function asU8A(y){return y instanceof Uint8Array?isBuffer(y)?new Uint8Array(y.buffer,y.byteOffset,y.byteLength):y:Uint8Array.from(y)}const toString$2=useBuffer?(y,u,g)=>g-u>64?globalThis.Buffer.from(y.subarray(u,g)).toString("utf8"):utf8Slice(y,u,g):(y,u,g)=>g-u>64?textDecoder$1.decode(y.subarray(u,g)):utf8Slice(y,u,g),fromString=useBuffer?y=>y.length>64?globalThis.Buffer.from(y):utf8ToBytes$2(y):y=>y.length>64?textEncoder$2.encode(y):utf8ToBytes$2(y),fromArray=y=>Uint8Array.from(y),slice$1=useBuffer?(y,u,g)=>isBuffer(y)?new Uint8Array(y.subarray(u,g)):y.slice(u,g):(y,u,g)=>y.slice(u,g),concat$1=useBuffer?(y,u)=>(y=y.map(g=>g instanceof Uint8Array?g:globalThis.Buffer.from(g)),asU8A(globalThis.Buffer.concat(y,u))):(y,u)=>{const g=new Uint8Array(u);let v=0;for(let b of y)v+b.length>g.length&&(b=b.subarray(0,g.length-v)),g.set(b,v),v+=b.length;return g},alloc=useBuffer?y=>globalThis.Buffer.allocUnsafe(y):y=>new Uint8Array(y);function compare(y,u){if(isBuffer(y)&&isBuffer(u))return y.compare(u);for(let g=0;g<y.length;g++)if(y[g]!==u[g])return y[g]<u[g]?-1:1;return 0}function utf8ToBytes$2(y){const u=[];let g=0;for(let v=0;v<y.length;v++){let b=y.charCodeAt(v);b<128?u[g++]=b:b<2048?(u[g++]=b>>6|192,u[g++]=b&63|128):(b&64512)===55296&&v+1<y.length&&(y.charCodeAt(v+1)&64512)===56320?(b=65536+((b&1023)<<10)+(y.charCodeAt(++v)&1023),u[g++]=b>>18|240,u[g++]=b>>12&63|128,u[g++]=b>>6&63|128,u[g++]=b&63|128):(u[g++]=b>>12|224,u[g++]=b>>6&63|128,u[g++]=b&63|128)}return u}function utf8Slice(y,u,g){const v=[];for(;u<g;){const b=y[u];let w=null,E=b>239?4:b>223?3:b>191?2:1;if(u+E<=g){let S,A,$,R;switch(E){case 1:b<128&&(w=b);break;case 2:S=y[u+1],(S&192)===128&&(R=(b&31)<<6|S&63,R>127&&(w=R));break;case 3:S=y[u+1],A=y[u+2],(S&192)===128&&(A&192)===128&&(R=(b&15)<<12|(S&63)<<6|A&63,R>2047&&(R<55296||R>57343)&&(w=R));break;case 4:S=y[u+1],A=y[u+2],$=y[u+3],(S&192)===128&&(A&192)===128&&($&192)===128&&(R=(b&15)<<18|(S&63)<<12|(A&63)<<6|$&63,R>65535&&R<1114112&&(w=R))}}w===null?(w=65533,E=1):w>65535&&(w-=65536,v.push(w>>>10&1023|55296),w=56320|w&1023),v.push(w),u+=E}return decodeCodePointsArray(v)}const MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(y){const u=y.length;if(u<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,y);let g="",v=0;for(;v<u;)g+=String.fromCharCode.apply(String,y.slice(v,v+=MAX_ARGUMENTS_LENGTH));return g}const defaultChunkSize=256;class Bl{constructor(u=defaultChunkSize){this.chunkSize=u,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(u){let g=this.chunks[this.chunks.length-1];if(this.cursor+u.length<=this.maxCursor+1){const b=g.length-(this.maxCursor-this.cursor)-1;g.set(u,b)}else{if(g){const b=g.length-(this.maxCursor-this.cursor)-1;b<g.length&&(this.chunks[this.chunks.length-1]=g.subarray(0,b),this.maxCursor=this.cursor-1)}u.length<64&&u.length<this.chunkSize?(g=alloc(this.chunkSize),this.chunks.push(g),this.maxCursor+=g.length,this._initReuseChunk===null&&(this._initReuseChunk=g),g.set(u,0)):(this.chunks.push(u),this.maxCursor+=u.length)}this.cursor+=u.length}toBytes(u=!1){let g;if(this.chunks.length===1){const v=this.chunks[0];u&&this.cursor>v.length/2?(g=this.cursor===v.length?v:v.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):g=slice$1(v,0,this.cursor)}else g=concat$1(this.chunks,this.cursor);return u&&this.reset(),g}}const decodeErrPrefix="CBOR decode error:",encodeErrPrefix="CBOR encode error:";function assertEnoughData(y,u,g){if(y.length-u<g)throw new Error(`${decodeErrPrefix} not enough data for type`)}const uintBoundaries=[24,256,65536,4294967296,BigInt("18446744073709551616")];function readUint8(y,u,g){assertEnoughData(y,u,1);const v=y[u];if(g.strict===!0&&v<uintBoundaries[0])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return v}function readUint16(y,u,g){assertEnoughData(y,u,2);const v=y[u]<<8|y[u+1];if(g.strict===!0&&v<uintBoundaries[1])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return v}function readUint32(y,u,g){assertEnoughData(y,u,4);const v=y[u]*16777216+(y[u+1]<<16)+(y[u+2]<<8)+y[u+3];if(g.strict===!0&&v<uintBoundaries[2])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return v}function readUint64(y,u,g){assertEnoughData(y,u,8);const v=y[u]*16777216+(y[u+1]<<16)+(y[u+2]<<8)+y[u+3],b=y[u+4]*16777216+(y[u+5]<<16)+(y[u+6]<<8)+y[u+7],w=(BigInt(v)<<BigInt(32))+BigInt(b);if(g.strict===!0&&w<uintBoundaries[3])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);if(w<=Number.MAX_SAFE_INTEGER)return Number(w);if(g.allowBigInt===!0)return w;throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`)}function decodeUint8(y,u,g,v){return new Token(Type.uint,readUint8(y,u+1,v),2)}function decodeUint16(y,u,g,v){return new Token(Type.uint,readUint16(y,u+1,v),3)}function decodeUint32(y,u,g,v){return new Token(Type.uint,readUint32(y,u+1,v),5)}function decodeUint64(y,u,g,v){return new Token(Type.uint,readUint64(y,u+1,v),9)}function encodeUint(y,u){return encodeUintValue(y,0,u.value)}function encodeUintValue(y,u,g){if(g<uintBoundaries[0]){const v=Number(g);y.push([u|v])}else if(g<uintBoundaries[1]){const v=Number(g);y.push([u|24,v])}else if(g<uintBoundaries[2]){const v=Number(g);y.push([u|25,v>>>8,v&255])}else if(g<uintBoundaries[3]){const v=Number(g);y.push([u|26,v>>>24&255,v>>>16&255,v>>>8&255,v&255])}else{const v=BigInt(g);if(v<uintBoundaries[4]){const b=[u|27,0,0,0,0,0,0,0];let w=Number(v&BigInt(4294967295)),E=Number(v>>BigInt(32)&BigInt(4294967295));b[8]=w&255,w=w>>8,b[7]=w&255,w=w>>8,b[6]=w&255,w=w>>8,b[5]=w&255,b[4]=E&255,E=E>>8,b[3]=E&255,E=E>>8,b[2]=E&255,E=E>>8,b[1]=E&255,y.push(b)}else throw new Error(`${decodeErrPrefix} encountered BigInt larger than allowable range`)}}encodeUint.encodedSize=function y(u){return encodeUintValue.encodedSize(u.value)};encodeUintValue.encodedSize=function y(u){return u<uintBoundaries[0]?1:u<uintBoundaries[1]?2:u<uintBoundaries[2]?3:u<uintBoundaries[3]?5:9};encodeUint.compareTokens=function y(u,g){return u.value<g.value?-1:u.value>g.value?1:0};function decodeNegint8(y,u,g,v){return new Token(Type.negint,-1-readUint8(y,u+1,v),2)}function decodeNegint16(y,u,g,v){return new Token(Type.negint,-1-readUint16(y,u+1,v),3)}function decodeNegint32(y,u,g,v){return new Token(Type.negint,-1-readUint32(y,u+1,v),5)}const neg1b=BigInt(-1),pos1b=BigInt(1);function decodeNegint64(y,u,g,v){const b=readUint64(y,u+1,v);if(typeof b!="bigint"){const w=-1-b;if(w>=Number.MIN_SAFE_INTEGER)return new Token(Type.negint,w,9)}if(v.allowBigInt!==!0)throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`);return new Token(Type.negint,neg1b-BigInt(b),9)}function encodeNegint(y,u){const g=u.value,v=typeof g=="bigint"?g*neg1b-pos1b:g*-1-1;encodeUintValue(y,u.type.majorEncoded,v)}encodeNegint.encodedSize=function y(u){const g=u.value,v=typeof g=="bigint"?g*neg1b-pos1b:g*-1-1;return v<uintBoundaries[0]?1:v<uintBoundaries[1]?2:v<uintBoundaries[2]?3:v<uintBoundaries[3]?5:9};encodeNegint.compareTokens=function y(u,g){return u.value<g.value?1:u.value>g.value?-1:0};function toToken$3(y,u,g,v){assertEnoughData(y,u,g+v);const b=slice$1(y,u+g,u+g+v);return new Token(Type.bytes,b,g+v)}function decodeBytesCompact(y,u,g,v){return toToken$3(y,u,1,g)}function decodeBytes8(y,u,g,v){return toToken$3(y,u,2,readUint8(y,u+1,v))}function decodeBytes16(y,u,g,v){return toToken$3(y,u,3,readUint16(y,u+1,v))}function decodeBytes32(y,u,g,v){return toToken$3(y,u,5,readUint32(y,u+1,v))}function decodeBytes64(y,u,g,v){const b=readUint64(y,u+1,v);if(typeof b=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer bytes lengths not supported`);return toToken$3(y,u,9,b)}function tokenBytes(y){return y.encodedBytes===void 0&&(y.encodedBytes=y.type===Type.string?fromString(y.value):y.value),y.encodedBytes}function encodeBytes(y,u){const g=tokenBytes(u);encodeUintValue(y,u.type.majorEncoded,g.length),y.push(g)}encodeBytes.encodedSize=function y(u){const g=tokenBytes(u);return encodeUintValue.encodedSize(g.length)+g.length};encodeBytes.compareTokens=function y(u,g){return compareBytes(tokenBytes(u),tokenBytes(g))};function compareBytes(y,u){return y.length<u.length?-1:y.length>u.length?1:compare(y,u)}function toToken$2(y,u,g,v,b){const w=g+v;assertEnoughData(y,u,w);const E=new Token(Type.string,toString$2(y,u+g,u+w),w);return b.retainStringBytes===!0&&(E.byteValue=slice$1(y,u+g,u+w)),E}function decodeStringCompact(y,u,g,v){return toToken$2(y,u,1,g,v)}function decodeString8(y,u,g,v){return toToken$2(y,u,2,readUint8(y,u+1,v),v)}function decodeString16(y,u,g,v){return toToken$2(y,u,3,readUint16(y,u+1,v),v)}function decodeString32(y,u,g,v){return toToken$2(y,u,5,readUint32(y,u+1,v),v)}function decodeString64(y,u,g,v){const b=readUint64(y,u+1,v);if(typeof b=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer string lengths not supported`);return toToken$2(y,u,9,b,v)}const encodeString=encodeBytes;function toToken$1(y,u,g,v){return new Token(Type.array,v,g)}function decodeArrayCompact(y,u,g,v){return toToken$1(y,u,1,g)}function decodeArray8(y,u,g,v){return toToken$1(y,u,2,readUint8(y,u+1,v))}function decodeArray16(y,u,g,v){return toToken$1(y,u,3,readUint16(y,u+1,v))}function decodeArray32(y,u,g,v){return toToken$1(y,u,5,readUint32(y,u+1,v))}function decodeArray64(y,u,g,v){const b=readUint64(y,u+1,v);if(typeof b=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer array lengths not supported`);return toToken$1(y,u,9,b)}function decodeArrayIndefinite(y,u,g,v){if(v.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken$1(y,u,1,1/0)}function encodeArray(y,u){encodeUintValue(y,Type.array.majorEncoded,u.value)}encodeArray.compareTokens=encodeUint.compareTokens;encodeArray.encodedSize=function y(u){return encodeUintValue.encodedSize(u.value)};function toToken(y,u,g,v){return new Token(Type.map,v,g)}function decodeMapCompact(y,u,g,v){return toToken(y,u,1,g)}function decodeMap8(y,u,g,v){return toToken(y,u,2,readUint8(y,u+1,v))}function decodeMap16(y,u,g,v){return toToken(y,u,3,readUint16(y,u+1,v))}function decodeMap32(y,u,g,v){return toToken(y,u,5,readUint32(y,u+1,v))}function decodeMap64(y,u,g,v){const b=readUint64(y,u+1,v);if(typeof b=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer map lengths not supported`);return toToken(y,u,9,b)}function decodeMapIndefinite(y,u,g,v){if(v.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken(y,u,1,1/0)}function encodeMap(y,u){encodeUintValue(y,Type.map.majorEncoded,u.value)}encodeMap.compareTokens=encodeUint.compareTokens;encodeMap.encodedSize=function y(u){return encodeUintValue.encodedSize(u.value)};function decodeTagCompact(y,u,g,v){return new Token(Type.tag,g,1)}function decodeTag8(y,u,g,v){return new Token(Type.tag,readUint8(y,u+1,v),2)}function decodeTag16(y,u,g,v){return new Token(Type.tag,readUint16(y,u+1,v),3)}function decodeTag32(y,u,g,v){return new Token(Type.tag,readUint32(y,u+1,v),5)}function decodeTag64(y,u,g,v){return new Token(Type.tag,readUint64(y,u+1,v),9)}function encodeTag(y,u){encodeUintValue(y,Type.tag.majorEncoded,u.value)}encodeTag.compareTokens=encodeUint.compareTokens;encodeTag.encodedSize=function y(u){return encodeUintValue.encodedSize(u.value)};const MINOR_FALSE=20,MINOR_TRUE=21,MINOR_NULL=22,MINOR_UNDEFINED=23;function decodeUndefined(y,u,g,v){if(v.allowUndefined===!1)throw new Error(`${decodeErrPrefix} undefined values are not supported`);return v.coerceUndefinedToNull===!0?new Token(Type.null,null,1):new Token(Type.undefined,void 0,1)}function decodeBreak(y,u,g,v){if(v.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return new Token(Type.break,void 0,1)}function createToken(y,u,g){if(g){if(g.allowNaN===!1&&Number.isNaN(y))throw new Error(`${decodeErrPrefix} NaN values are not supported`);if(g.allowInfinity===!1&&(y===1/0||y===-1/0))throw new Error(`${decodeErrPrefix} Infinity values are not supported`)}return new Token(Type.float,y,u)}function decodeFloat16(y,u,g,v){return createToken(readFloat16(y,u+1),3,v)}function decodeFloat32(y,u,g,v){return createToken(readFloat32(y,u+1),5,v)}function decodeFloat64(y,u,g,v){return createToken(readFloat64(y,u+1),9,v)}function encodeFloat(y,u,g){const v=u.value;if(v===!1)y.push([Type.float.majorEncoded|MINOR_FALSE]);else if(v===!0)y.push([Type.float.majorEncoded|MINOR_TRUE]);else if(v===null)y.push([Type.float.majorEncoded|MINOR_NULL]);else if(v===void 0)y.push([Type.float.majorEncoded|MINOR_UNDEFINED]);else{let b,w=!1;(!g||g.float64!==!0)&&(encodeFloat16(v),b=readFloat16(ui8a,1),v===b||Number.isNaN(v)?(ui8a[0]=249,y.push(ui8a.slice(0,3)),w=!0):(encodeFloat32(v),b=readFloat32(ui8a,1),v===b&&(ui8a[0]=250,y.push(ui8a.slice(0,5)),w=!0))),w||(encodeFloat64(v),b=readFloat64(ui8a,1),ui8a[0]=251,y.push(ui8a.slice(0,9)))}}encodeFloat.encodedSize=function y(u,g){const v=u.value;if(v===!1||v===!0||v===null||v===void 0)return 1;if(!g||g.float64!==!0){encodeFloat16(v);let b=readFloat16(ui8a,1);if(v===b||Number.isNaN(v))return 3;if(encodeFloat32(v),b=readFloat32(ui8a,1),v===b)return 5}return 9};const buffer=new ArrayBuffer(9),dataView=new DataView(buffer,1),ui8a=new Uint8Array(buffer,0);function encodeFloat16(y){if(y===1/0)dataView.setUint16(0,31744,!1);else if(y===-1/0)dataView.setUint16(0,64512,!1);else if(Number.isNaN(y))dataView.setUint16(0,32256,!1);else{dataView.setFloat32(0,y);const u=dataView.getUint32(0),g=(u&2139095040)>>23,v=u&8388607;if(g===255)dataView.setUint16(0,31744,!1);else if(g===0)dataView.setUint16(0,(y&2147483648)>>16|v>>13,!1);else{const b=g-127;b<-24?dataView.setUint16(0,0):b<-14?dataView.setUint16(0,(u&2147483648)>>16|1<<24+b,!1):dataView.setUint16(0,(u&2147483648)>>16|b+15<<10|v>>13,!1)}}}function readFloat16(y,u){if(y.length-u<2)throw new Error(`${decodeErrPrefix} not enough data for float16`);const g=(y[u]<<8)+y[u+1];if(g===31744)return 1/0;if(g===64512)return-1/0;if(g===32256)return NaN;const v=g>>10&31,b=g&1023;let w;return v===0?w=b*2**-24:v!==31?w=(b+1024)*2**(v-25):w=b===0?1/0:NaN,g&32768?-w:w}function encodeFloat32(y){dataView.setFloat32(0,y,!1)}function readFloat32(y,u){if(y.length-u<4)throw new Error(`${decodeErrPrefix} not enough data for float32`);const g=(y.byteOffset||0)+u;return new DataView(y.buffer,g,4).getFloat32(0,!1)}function encodeFloat64(y){dataView.setFloat64(0,y,!1)}function readFloat64(y,u){if(y.length-u<8)throw new Error(`${decodeErrPrefix} not enough data for float64`);const g=(y.byteOffset||0)+u;return new DataView(y.buffer,g,8).getFloat64(0,!1)}encodeFloat.compareTokens=encodeUint.compareTokens;function invalidMinor(y,u,g){throw new Error(`${decodeErrPrefix} encountered invalid minor (${g}) for major ${y[u]>>>5}`)}function errorer(y){return()=>{throw new Error(`${decodeErrPrefix} ${y}`)}}const jump=[];for(let y=0;y<=23;y++)jump[y]=invalidMinor;jump[24]=decodeUint8;jump[25]=decodeUint16;jump[26]=decodeUint32;jump[27]=decodeUint64;jump[28]=invalidMinor;jump[29]=invalidMinor;jump[30]=invalidMinor;jump[31]=invalidMinor;for(let y=32;y<=55;y++)jump[y]=invalidMinor;jump[56]=decodeNegint8;jump[57]=decodeNegint16;jump[58]=decodeNegint32;jump[59]=decodeNegint64;jump[60]=invalidMinor;jump[61]=invalidMinor;jump[62]=invalidMinor;jump[63]=invalidMinor;for(let y=64;y<=87;y++)jump[y]=decodeBytesCompact;jump[88]=decodeBytes8;jump[89]=decodeBytes16;jump[90]=decodeBytes32;jump[91]=decodeBytes64;jump[92]=invalidMinor;jump[93]=invalidMinor;jump[94]=invalidMinor;jump[95]=errorer("indefinite length bytes/strings are not supported");for(let y=96;y<=119;y++)jump[y]=decodeStringCompact;jump[120]=decodeString8;jump[121]=decodeString16;jump[122]=decodeString32;jump[123]=decodeString64;jump[124]=invalidMinor;jump[125]=invalidMinor;jump[126]=invalidMinor;jump[127]=errorer("indefinite length bytes/strings are not supported");for(let y=128;y<=151;y++)jump[y]=decodeArrayCompact;jump[152]=decodeArray8;jump[153]=decodeArray16;jump[154]=decodeArray32;jump[155]=decodeArray64;jump[156]=invalidMinor;jump[157]=invalidMinor;jump[158]=invalidMinor;jump[159]=decodeArrayIndefinite;for(let y=160;y<=183;y++)jump[y]=decodeMapCompact;jump[184]=decodeMap8;jump[185]=decodeMap16;jump[186]=decodeMap32;jump[187]=decodeMap64;jump[188]=invalidMinor;jump[189]=invalidMinor;jump[190]=invalidMinor;jump[191]=decodeMapIndefinite;for(let y=192;y<=215;y++)jump[y]=decodeTagCompact;jump[216]=decodeTag8;jump[217]=decodeTag16;jump[218]=decodeTag32;jump[219]=decodeTag64;jump[220]=invalidMinor;jump[221]=invalidMinor;jump[222]=invalidMinor;jump[223]=invalidMinor;for(let y=224;y<=243;y++)jump[y]=errorer("simple values are not supported");jump[244]=invalidMinor;jump[245]=invalidMinor;jump[246]=invalidMinor;jump[247]=decodeUndefined;jump[248]=errorer("simple values are not supported");jump[249]=decodeFloat16;jump[250]=decodeFloat32;jump[251]=decodeFloat64;jump[252]=invalidMinor;jump[253]=invalidMinor;jump[254]=invalidMinor;jump[255]=decodeBreak;const quick=[];for(let y=0;y<24;y++)quick[y]=new Token(Type.uint,y,1);for(let y=-1;y>=-24;y--)quick[31-y]=new Token(Type.negint,y,1);quick[64]=new Token(Type.bytes,new Uint8Array(0),1);quick[96]=new Token(Type.string,"",1);quick[128]=new Token(Type.array,0,1);quick[160]=new Token(Type.map,0,1);quick[244]=new Token(Type.false,!1,1);quick[245]=new Token(Type.true,!0,1);quick[246]=new Token(Type.null,null,1);function quickEncodeToken(y){switch(y.type){case Type.false:return fromArray([244]);case Type.true:return fromArray([245]);case Type.null:return fromArray([246]);case Type.bytes:return y.value.length?void 0:fromArray([64]);case Type.string:return y.value===""?fromArray([96]):void 0;case Type.array:return y.value===0?fromArray([128]):void 0;case Type.map:return y.value===0?fromArray([160]):void 0;case Type.uint:return y.value<24?fromArray([Number(y.value)]):void 0;case Type.negint:if(y.value>=-24)return fromArray([31-Number(y.value)])}}const defaultEncodeOptions$1={float64:!1,mapSorter:mapSorter$1,quickEncodeToken};function makeCborEncoders(){const y=[];return y[Type.uint.major]=encodeUint,y[Type.negint.major]=encodeNegint,y[Type.bytes.major]=encodeBytes,y[Type.string.major]=encodeString,y[Type.array.major]=encodeArray,y[Type.map.major]=encodeMap,y[Type.tag.major]=encodeTag,y[Type.float.major]=encodeFloat,y}const cborEncoders=makeCborEncoders(),buf=new Bl;class Ref{constructor(u,g){this.obj=u,this.parent=g}includes(u){let g=this;do if(g.obj===u)return!0;while(g=g.parent);return!1}static createCheck(u,g){if(u&&u.includes(g))throw new Error(`${encodeErrPrefix} object contains circular references`);return new Ref(g,u)}}const simpleTokens={null:new Token(Type.null,null),undefined:new Token(Type.undefined,void 0),true:new Token(Type.true,!0),false:new Token(Type.false,!1),emptyArray:new Token(Type.array,0),emptyMap:new Token(Type.map,0)},typeEncoders={number(y,u,g,v){return!Number.isInteger(y)||!Number.isSafeInteger(y)?new Token(Type.float,y):y>=0?new Token(Type.uint,y):new Token(Type.negint,y)},bigint(y,u,g,v){return y>=BigInt(0)?new Token(Type.uint,y):new Token(Type.negint,y)},Uint8Array(y,u,g,v){return new Token(Type.bytes,y)},string(y,u,g,v){return new Token(Type.string,y)},boolean(y,u,g,v){return y?simpleTokens.true:simpleTokens.false},null(y,u,g,v){return simpleTokens.null},undefined(y,u,g,v){return simpleTokens.undefined},ArrayBuffer(y,u,g,v){return new Token(Type.bytes,new Uint8Array(y))},DataView(y,u,g,v){return new Token(Type.bytes,new Uint8Array(y.buffer,y.byteOffset,y.byteLength))},Array(y,u,g,v){if(!y.length)return g.addBreakTokens===!0?[simpleTokens.emptyArray,new Token(Type.break)]:simpleTokens.emptyArray;v=Ref.createCheck(v,y);const b=[];let w=0;for(const E of y)b[w++]=objectToTokens(E,g,v);return g.addBreakTokens?[new Token(Type.array,y.length),b,new Token(Type.break)]:[new Token(Type.array,y.length),b]},Object(y,u,g,v){const b=u!=="Object",w=b?y.keys():Object.keys(y),E=b?y.size:w.length;if(!E)return g.addBreakTokens===!0?[simpleTokens.emptyMap,new Token(Type.break)]:simpleTokens.emptyMap;v=Ref.createCheck(v,y);const S=[];let A=0;for(const $ of w)S[A++]=[objectToTokens($,g,v),objectToTokens(b?y.get($):y[$],g,v)];return sortMapEntries(S,g),g.addBreakTokens?[new Token(Type.map,E),S,new Token(Type.break)]:[new Token(Type.map,E),S]}};typeEncoders.Map=typeEncoders.Object;typeEncoders.Buffer=typeEncoders.Uint8Array;for(const y of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))typeEncoders[`${y}Array`]=typeEncoders.DataView;function objectToTokens(y,u={},g){const v=is(y),b=u&&u.typeEncoders&&u.typeEncoders[v]||typeEncoders[v];if(typeof b=="function"){const E=b(y,v,u,g);if(E!=null)return E}const w=typeEncoders[v];if(!w)throw new Error(`${encodeErrPrefix} unsupported type: ${v}`);return w(y,v,u,g)}function sortMapEntries(y,u){u.mapSorter&&y.sort(u.mapSorter)}function mapSorter$1(y,u){const g=Array.isArray(y[0])?y[0][0]:y[0],v=Array.isArray(u[0])?u[0][0]:u[0];if(g.type!==v.type)return g.type.compare(v.type);const b=g.type.major,w=cborEncoders[b].compareTokens(g,v);return w===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),w}function tokensToEncoded(y,u,g,v){if(Array.isArray(u))for(const b of u)tokensToEncoded(y,b,g,v);else g[u.type.major](y,u,v)}function encodeCustom(y,u,g){const v=objectToTokens(y,g);if(!Array.isArray(v)&&g.quickEncodeToken){const b=g.quickEncodeToken(v);if(b)return b;const w=u[v.type.major];if(w.encodedSize){const E=w.encodedSize(v,g),S=new Bl(E);if(w(S,v,g),S.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${v} was wrong`);return asU8A(S.chunks[0])}}return buf.reset(),tokensToEncoded(buf,v,u,g),buf.toBytes(!0)}function encode$8(y,u){return u=Object.assign({},defaultEncodeOptions$1,u),encodeCustom(y,cborEncoders,u)}const defaultDecodeOptions={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Tokeniser{constructor(u,g={}){this._pos=0,this.data=u,this.options=g}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const u=this.data[this._pos];let g=quick[u];if(g===void 0){const v=jump[u];if(!v)throw new Error(`${decodeErrPrefix} no decoder for major type ${u>>>5} (byte 0x${u.toString(16).padStart(2,"0")})`);const b=u&31;g=v(this.data,this._pos,b,this.options)}return this._pos+=g.encodedLength,g}}const DONE=Symbol.for("DONE"),BREAK=Symbol.for("BREAK");function tokenToArray(y,u,g){const v=[];for(let b=0;b<y.value;b++){const w=tokensToObject(u,g);if(w===BREAK){if(y.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed array`)}if(w===DONE)throw new Error(`${decodeErrPrefix} found array but not enough entries (got ${b}, expected ${y.value})`);v[b]=w}return v}function tokenToMap(y,u,g){const v=g.useMaps===!0,b=v?void 0:{},w=v?new Map:void 0;for(let E=0;E<y.value;E++){const S=tokensToObject(u,g);if(S===BREAK){if(y.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed map`)}if(S===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${E} [no key], expected ${y.value})`);if(v!==!0&&typeof S!="string")throw new Error(`${decodeErrPrefix} non-string keys not supported (got ${typeof S})`);if(g.rejectDuplicateMapKeys===!0&&(v&&w.has(S)||!v&&S in b))throw new Error(`${decodeErrPrefix} found repeat map key "${S}"`);const A=tokensToObject(u,g);if(A===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${E} [no value], expected ${y.value})`);v?w.set(S,A):b[S]=A}return v?w:b}function tokensToObject(y,u){if(y.done())return DONE;const g=y.next();if(g.type===Type.break)return BREAK;if(g.type.terminal)return g.value;if(g.type===Type.array)return tokenToArray(g,y,u);if(g.type===Type.map)return tokenToMap(g,y,u);if(g.type===Type.tag){if(u.tags&&typeof u.tags[g.value]=="function"){const v=tokensToObject(y,u);return u.tags[g.value](v)}throw new Error(`${decodeErrPrefix} tag not supported (${g.value})`)}throw new Error("unsupported")}function decodeFirst(y,u){if(!(y instanceof Uint8Array))throw new Error(`${decodeErrPrefix} data to decode must be a Uint8Array`);u=Object.assign({},defaultDecodeOptions,u);const g=u.tokenizer||new Tokeniser(y,u),v=tokensToObject(g,u);if(v===DONE)throw new Error(`${decodeErrPrefix} did not find any content to decode`);if(v===BREAK)throw new Error(`${decodeErrPrefix} got unexpected break`);return[v,y.subarray(g.pos())]}function decode$6(y,u){const[g,v]=decodeFirst(y,u);if(v.length>0)throw new Error(`${decodeErrPrefix} too many terminals, data makes no sense`);return g}const MAX_LENGTH_LENGTH=8,MAX_DATA_LENGTH=1024*1024*4;let InvalidMessageLengthError$1=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"};class InvalidDataLengthError extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class InvalidDataLengthLengthError extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class UnexpectedEOFError extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function isAsyncIterable$9(y){return y[Symbol.asyncIterator]!=null}function validateMaxDataLength(y,u){if(y.byteLength>u)throw new InvalidDataLengthError("Message length too long")}const defaultEncoder=y=>{const u=encodingLength(y),g=allocUnsafe(u);return encode$9(y,g),defaultEncoder.bytes=u,g};defaultEncoder.bytes=0;function encode$7(y,u){u=u??{};const g=u.lengthEncoder??defaultEncoder,v=u?.maxDataLength??MAX_DATA_LENGTH;function*b(w){validateMaxDataLength(w,v);const E=g(w.byteLength);E instanceof Uint8Array?yield E:yield*E,w instanceof Uint8Array?yield w:yield*w}return isAsyncIterable$9(y)?(async function*(){for await(const w of y)yield*b(w)})():(function*(){for(const w of y)yield*b(w)})()}encode$7.single=(y,u)=>{u=u??{};const g=u.lengthEncoder??defaultEncoder,v=u?.maxDataLength??MAX_DATA_LENGTH;return validateMaxDataLength(y,v),new Uint8ArrayList(g(y.byteLength),y)};var ReadMode;(function(y){y[y.LENGTH=0]="LENGTH",y[y.DATA=1]="DATA"})(ReadMode||(ReadMode={}));const defaultDecoder=y=>{const u=decode$7(y);return defaultDecoder.bytes=encodingLength(u),u};defaultDecoder.bytes=0;function decode$5(y,u){const g=new Uint8ArrayList;let v=ReadMode.LENGTH,b=-1;const w=u?.lengthDecoder??defaultDecoder,E=u?.maxLengthLength??MAX_LENGTH_LENGTH,S=u?.maxDataLength??MAX_DATA_LENGTH;function*A(){for(;g.byteLength>0;){if(v===ReadMode.LENGTH)try{if(b=w(g),b<0)throw new InvalidMessageLengthError$1("Invalid message length");if(b>S)throw new InvalidDataLengthError("Message length too long");const $=w.bytes;g.consume($),u?.onLength!=null&&u.onLength(b),v=ReadMode.DATA}catch($){if($ instanceof RangeError){if(g.byteLength>E)throw new InvalidDataLengthLengthError("Message length length too long");break}throw $}if(v===ReadMode.DATA){if(g.byteLength<b)break;const $=g.sublist(0,b);g.consume(b),u?.onData!=null&&u.onData($),yield $,v=ReadMode.LENGTH}}}return isAsyncIterable$9(y)?(async function*(){for await(const $ of y)g.append($),yield*A();if(g.byteLength>0)throw new UnexpectedEOFError("Unexpected end of input")})():(function*(){for(const $ of y)g.append($),yield*A();if(g.byteLength>0)throw new UnexpectedEOFError("Unexpected end of input")})()}decode$5.fromReader=(y,u)=>{let g=1;const v=(async function*(){for(;;)try{const{done:w,value:E}=await y.next(g);if(w===!0)return;E!=null&&(yield E)}catch(w){if(w.code==="ERR_UNDER_READ")return{done:!0,value:null};throw w}finally{g=1}})();return decode$5(v,{...u??{},onLength:w=>{g=w}})};const MAX_TIMEOUT=2147483647,brandSymbol=Symbol.for("sindresorhus/unlimited-timeout#brand");function setTimeout$1(y,u,...g){if(typeof y!="function")throw new TypeError("Expected callback to be a function");u??=0,u=Number(u);let v=!1;const b={[brandSymbol]:!0,id:void 0,cleared:!1,ref(){return v=!1,b.id?.ref?.(),b},unref(){return v=!0,b.id?.unref?.(),b}};if(u===Number.POSITIVE_INFINITY||u>Number.MAX_SAFE_INTEGER)return b;(!Number.isFinite(u)||u<0)&&(u=0);const w=performance.now()+u,E=S=>{b.cleared||(S<=MAX_TIMEOUT?(b.id=globalThis.setTimeout(()=>{b.cleared||y(...g)},S),v&&b.id?.unref?.()):(b.id=globalThis.setTimeout(()=>{const A=performance.now(),$=Math.max(0,w-A);E($)},MAX_TIMEOUT),v&&b.id?.unref?.()))};return E(u),b}function clearTimeout$1(y){!y||typeof y!="object"||!y[brandSymbol]||(y.cleared=!0,y.id!==void 0&&(globalThis.clearTimeout(y.id),y.id=void 0))}const clearMethods=new WeakMap;function createDelay({clearTimeout:y,setTimeout:u}={}){return(g,{value:v,signal:b}={})=>{if(b?.aborted)return Promise.reject(b.reason);let w,E,S;const A=y??clearTimeout,$=()=>{A(w),S(b.reason)},R=()=>{b&&b.removeEventListener("abort",$)},T=new Promise((O,B)=>{E=()=>{R(),O(v)},S=B,w=(u??setTimeout)(E,g)});return b&&b.addEventListener("abort",$,{once:!0}),clearMethods.set(T,()=>{A(w),w=null,E()}),T}}const delay=createDelay({setTimeout:setTimeout$1,clearTimeout:clearTimeout$1});class PeerQueue extends Queue$1{has(u){return this.find(u)!=null}find(u){return this.queue.find(g=>u.equals(g.options.peerId))}}class PriorityQueue extends Queue$1{constructor(u={}){super({...u,sort:(g,v)=>g.options.priority>v.options.priority?-1:g.options.priority<v.options.priority?1:0})}}class RateLimiter{memoryStorage;points;duration;blockDuration;keyPrefix;constructor(u={}){this.points=u.points??4,this.duration=u.duration??1,this.blockDuration=u.blockDuration??0,this.keyPrefix=u.keyPrefix??"rlflx",this.memoryStorage=new MemoryStorage}consume(u,g=1,v={}){const b=this.getKey(u),w=this._getKeySecDuration(v);let E=this.memoryStorage.incrby(b,g,w);if(E.remainingPoints=Math.max(this.points-E.consumedPoints,0),E.consumedPoints>this.points)throw this.blockDuration>0&&E.consumedPoints<=this.points+g&&(E=this.memoryStorage.set(b,E.consumedPoints,this.blockDuration)),new RateLimitError("Rate limit exceeded",E);return E}penalty(u,g=1,v={}){const b=this.getKey(u),w=this._getKeySecDuration(v),E=this.memoryStorage.incrby(b,g,w);return E.remainingPoints=Math.max(this.points-E.consumedPoints,0),E}reward(u,g=1,v={}){const b=this.getKey(u),w=this._getKeySecDuration(v),E=this.memoryStorage.incrby(b,-g,w);return E.remainingPoints=Math.max(this.points-E.consumedPoints,0),E}block(u,g){const v=g*1e3,b=this.points+1;return this.memoryStorage.set(this.getKey(u),b,g),{remainingPoints:0,msBeforeNext:v===0?-1:v,consumedPoints:b,isFirstInDuration:!1}}set(u,g,v=0){const b=(v>=0?v:this.duration)*1e3;return this.memoryStorage.set(this.getKey(u),g,v),{remainingPoints:0,msBeforeNext:b===0?-1:b,consumedPoints:g,isFirstInDuration:!1}}get(u){const g=this.memoryStorage.get(this.getKey(u));return g!=null&&(g.remainingPoints=Math.max(this.points-g.consumedPoints,0)),g}delete(u){this.memoryStorage.delete(this.getKey(u))}_getKeySecDuration(u){return u?.customDuration!=null&&u.customDuration>=0?u.customDuration:this.duration}getKey(u){return this.keyPrefix.length>0?`${this.keyPrefix}:${u}`:u}parseKey(u){return u.substring(this.keyPrefix.length)}}class MemoryStorage{storage;constructor(){this.storage=new Map}incrby(u,g,v){const b=this.storage.get(u);if(b!=null){const w=b.expiresAt!=null?b.expiresAt.getTime()-new Date().getTime():-1;return b.expiresAt==null||w>0?(b.value+=g,{remainingPoints:0,msBeforeNext:w,consumedPoints:b.value,isFirstInDuration:!1}):this.set(u,g,v)}return this.set(u,g,v)}set(u,g,v){const b=v*1e3,w=this.storage.get(u);w!=null&&clearTimeout(w.timeoutId);const E={value:g,expiresAt:b>0?new Date(Date.now()+b):void 0};return this.storage.set(u,E),b>0&&(E.timeoutId=setTimeout(()=>{this.storage.delete(u)},b),E.timeoutId.unref!=null&&E.timeoutId.unref()),{remainingPoints:0,msBeforeNext:b===0?-1:b,consumedPoints:E.value,isFirstInDuration:!0}}get(u){const g=this.storage.get(u);if(g!=null)return{remainingPoints:0,msBeforeNext:g.expiresAt!=null?g.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:g.value,isFirstInDuration:!1}}delete(u){const g=this.storage.get(u);return g!=null?(g.timeoutId!=null&&clearTimeout(g.timeoutId),this.storage.delete(u),!0):!1}}function repeatingTask(y,u,g){let v,b,w=!1;function E(){const $={signal:b.signal};if(g?.timeout!=null){const R=anySignal([b.signal,AbortSignal.timeout(g.timeout)]);$.signal=R}w=!0,Promise.resolve().then(async()=>{await y($)}).catch(()=>{}).finally(()=>{w=!1,!b.signal.aborted&&(v=setTimeout(E,u))})}const S=debounce$1(E,g?.debounce??100);let A=!1;return{setInterval:$=>{u!==$&&(u=$,v!=null&&(clearTimeout(v),v=setTimeout(E,u)))},setTimeout:$=>{g??={},g.timeout=$},run:()=>{w||(clearTimeout(v),S())},start:()=>{A||(A=!0,b=new AbortController,b.signal,g?.runImmediately===!0?queueMicrotask(()=>{E()}):v=setTimeout(E,u))},stop:()=>{clearTimeout(v),b?.abort(),A=!1}}}class TrackedMap extends Map{metric;constructor(u){super();const{name:g,metrics:v}=u;this.metric=v.registerMetric(g),this.updateComponentMetric()}set(u,g){return super.set(u,g),this.updateComponentMetric(),this}delete(u){const g=super.delete(u);return this.updateComponentMetric(),g}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function trackedMap(y){const{name:u,metrics:g}=y;let v;return g!=null?v=new TrackedMap({name:u,metrics:g}):v=new Map,v}const pathSepS="/",pathSepB=new TextEncoder().encode(pathSepS),pathSep=pathSepB[0];class Key{_buf;constructor(u,g){if(typeof u=="string")this._buf=fromString$1(u);else if(u instanceof Uint8Array)this._buf=u;else throw new Error("Invalid key, should be String of Uint8Array");if(g==null&&(g=!0),g&&this.clean(),this._buf.byteLength===0||this._buf[0]!==pathSep)throw new Error("Invalid key")}toString(u="utf8"){return toString$3(this._buf,u)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(u){return new Key(u.join(pathSepS))}static random(){return new Key(Math.random().toString().substring(2))}static asKey(u){return u instanceof Uint8Array||typeof u=="string"?new Key(u):typeof u.uint8Array=="function"?new Key(u.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=pathSepB),this._buf[0]!==pathSep){const u=new Uint8Array(this._buf.byteLength+1);u.fill(pathSep,0,1),u.set(this._buf,1),this._buf=u}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===pathSep;)this._buf=this._buf.subarray(0,-1)}less(u){const g=this.list(),v=u.list();for(let b=0;b<g.length;b++){if(v.length<b+1)return!1;const w=g[b],E=v[b];if(w<E)return!0;if(w>E)return!1}return g.length<v.length}reverse(){return Key.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const u=this.namespaces();return u[u.length-1]}list(){return this.toString().split(pathSepS).slice(1)}type(){return namespaceType(this.baseNamespace())}name(){return namespaceValue(this.baseNamespace())}instance(u){return new Key(this.toString()+":"+u)}path(){let u=this.parent().toString();return u.endsWith(pathSepS)||(u+=pathSepS),u+=this.type(),new Key(u)}parent(){const u=this.list();return u.length===1?new Key(pathSepS):new Key(u.slice(0,-1).join(pathSepS))}child(u){return this.toString()===pathSepS?u:u.toString()===pathSepS?this:new Key(this.toString()+u.toString(),!1)}isAncestorOf(u){return u.toString()===this.toString()?!1:u.toString().startsWith(this.toString())}isDecendantOf(u){return u.toString()===this.toString()?!1:this.toString().startsWith(u.toString())}isTopLevel(){return this.list().length===1}concat(...u){return Key.withNamespaces([...this.namespaces(),...flatten(u.map(g=>g.namespaces()))])}}function namespaceType(y){const u=y.split(":");return u.length<2?"":u.slice(0,-1).join(":")}function namespaceValue(y){const u=y.split(":");return u[u.length-1]}function flatten(y){return[].concat(...y)}function isAsyncIterable$8(y){return y[Symbol.asyncIterator]!=null}function toBuffer(y){if(isAsyncIterable$8(y))return(async()=>{let v=new Uint8Array(0);for await(const b of y)v=concat$2([v,b],v.length+b.length);return v})();const u=[];let g=0;for(const v of y)u.push(v),g+=v.byteLength;return concat$2(u,g)}function readonly$1({enumerable:y=!0,configurable:u=!1}={}){return{enumerable:y,configurable:u,writable:!1}}function*linksWithin(y,u){if(u!=null&&typeof u=="object")if(Array.isArray(u))for(const[g,v]of u.entries()){const b=[...y,g],w=CID.asCID(v);w!=null?yield[b.join("/"),w]:typeof v=="object"&&(yield*links(v,b))}else{const g=CID.asCID(u);g!=null?yield[y.join("/"),g]:yield*links(u,y)}}function*links(y,u){if(y==null||y instanceof Uint8Array)return;const g=CID.asCID(y);g!=null&&(yield[u.join("/"),g]);for(const[v,b]of Object.entries(y)){const w=[...u,v];yield*linksWithin(w,b)}}function*treeWithin(y,u){if(Array.isArray(u))for(const[g,v]of u.entries()){const b=[...y,g];yield b.join("/"),typeof v=="object"&&CID.asCID(v)==null&&(yield*tree(v,b))}else yield*tree(u,y)}function*tree(y,u){if(!(y==null||typeof y!="object"))for(const[g,v]of Object.entries(y)){const b=[...u,g];yield b.join("/"),v!=null&&!(v instanceof Uint8Array)&&typeof v=="object"&&CID.asCID(v)==null&&(yield*treeWithin(b,v))}}function get(y,u){let g=y;for(const[v,b]of u.entries()){if(g=g[b],g==null)throw new Error(`Object has no property at ${u.slice(0,v+1).map(E=>`[${JSON.stringify(E)}]`).join("")}`);const w=CID.asCID(g);if(w!=null)return{value:w,remaining:u.slice(v+1).join("/")}}return{value:g}}let Block$1=class{cid;bytes;value;asBlock;constructor({cid:u,bytes:g,value:v}){if(u==null||g==null||typeof v>"u")throw new Error("Missing required argument");this.cid=u,this.bytes=g,this.value=v,this.asBlock=this,Object.defineProperties(this,{cid:readonly$1(),bytes:readonly$1(),value:readonly$1(),asBlock:readonly$1()})}links(){return links(this.value,[])}tree(){return tree(this.value,[])}get(u="/"){return get(this.value,u.split("/").filter(Boolean))}};function createUnsafe({bytes:y,cid:u,value:g,codec:v}){const b=g!==void 0?g:v?.decode(y);if(b===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new Block$1({cid:u,bytes:y,value:b})}class AlreadyPinnedError extends Error{static name="AlreadyPinnedError";name="AlreadyPinnedError"}class BlockPinnedError extends Error{static name="BlockPinnedError";name="BlockPinnedError"}class InvalidDatastoreVersionError extends Error{static name="InvalidDatastoreVersionError";name="InvalidDatastoreVersionError"}class InvalidConfigurationError extends Error{static name="InvalidConfigurationError";name="InvalidConfigurationError"}const DATASTORE_PIN_PREFIX="/pin/",DATASTORE_BLOCK_PREFIX="/pinned-block/",DATASTORE_ENCODING=base36,DAG_WALK_QUEUE_CONCURRENCY=1;function toDSKey(y){return y.version===0&&(y=y.toV1()),new Key(`${DATASTORE_PIN_PREFIX}${y.toString(DATASTORE_ENCODING)}`)}class PinsImpl{datastore;blockstore;getCodec;constructor(u,g,v){this.datastore=u,this.blockstore=g,this.getCodec=v}async*add(u,g={}){const v=toDSKey(u);if(await this.datastore.has(v))throw new AlreadyPinnedError("Already pinned");const b=Math.round(g.depth??1/0);if(b<0)throw new InvalidParametersError$1("Depth must be greater than or equal to 0");const w=new Queue$1({concurrency:DAG_WALK_QUEUE_CONCURRENCY});for await(const S of this.#e(u,w,{...g,depth:b}))await this.#t(S,A=>A.pinnedBy.find($=>equals($,u.bytes))!=null?!1:(A.pinCount++,A.pinnedBy.push(u.bytes),!0),g),yield S;const E={depth:b,metadata:g.metadata??{}};await this.datastore.put(v,encode$8(E),g)}async*#e(u,g,v){if(v.depth===-1)return;const b=await this.getCodec(u.code),w=await toBuffer(this.blockstore.get(u,v)),E=createUnsafe({bytes:w,cid:u,codec:b});yield u;for(const[,S]of E.links())yield*await g.add(async()=>this.#e(S,g,{...v,depth:v.depth-1}))}async#t(u,g,v){const b=new Key(`${DATASTORE_BLOCK_PREFIX}${DATASTORE_ENCODING.encode(u.multihash.bytes)}`);let w={pinCount:0,pinnedBy:[]};try{w=decode$6(await this.datastore.get(b,v))}catch(S){if(S.name!=="NotFoundError")throw S}if(g(w)){if(w.pinCount===0&&await this.datastore.has(b)){await this.datastore.delete(b);return}await this.datastore.put(b,encode$8(w),v),v.onProgress?.(new CustomProgressEvent("helia:pin:add",u))}}async*rm(u,g={}){const v=toDSKey(u),b=await this.datastore.get(v,g),w=decode$6(b);await this.datastore.delete(v,g);const E=new Queue$1({concurrency:DAG_WALK_QUEUE_CONCURRENCY});for await(const S of this.#e(u,E,{...g,depth:w.depth}))await this.#t(S,A=>(A.pinCount--,A.pinnedBy=A.pinnedBy.filter($=>equals($,u.bytes)),!0),{...g,depth:w.depth}),yield S}async*ls(u={}){for await(const{key:g,value:v}of this.datastore.query({prefix:DATASTORE_PIN_PREFIX+(u.cid!=null?`${u.cid.toString(base36)}`:"")},u)){const b=CID.parse(g.toString().substring(5),base36),w=decode$6(v);yield{cid:b,...w}}}async isPinned(u,g={}){const v=new Key(`${DATASTORE_BLOCK_PREFIX}${DATASTORE_ENCODING.encode(u.multihash.bytes)}`);return this.datastore.has(v,g)}async get(u,g){const v=toDSKey(u),b=await this.datastore.get(v,g);return decode$6(b)}async setMetadata(u,g,v){const b=toDSKey(u),w=await this.datastore.get(b,v),E=decode$6(w);E.metadata=g??{},await this.datastore.put(b,encode$8(E),v)}}const DEFAULT_SESSION_MIN_PROVIDERS=1,DEFAULT_SESSION_MAX_PROVIDERS=5;class InsufficientProvidersError extends Error{static name="InsufficientProvidersError";constructor(u="Insufficient providers found"){super(u),this.name="InsufficientProvidersError"}}class NoRoutersAvailableError extends Error{static name="NoRoutersAvailableError";constructor(u="No routers available"){super(u),this.name="NoRoutersAvailableError"}}class UnknownHashAlgorithmError extends Error{static name="UnknownHashAlgorithmError";constructor(u="Unknown hash algorithm"){super(u),this.name="UnknownHashAlgorithmError"}}class UnknownCodecError extends Error{static name="UnknownCodecError";constructor(u="Unknown codec"){super(u),this.name="UnknownCodecError"}}class InvalidCodecError extends Error{static name="InvalidCodecError";constructor(u="Invalid codec"){super(u),this.name="InvalidCodecError"}}const DEFAULT_PROVIDER_LOOKUP_CONCURRENCY=5;class Routing{log;routers;providerLookupConcurrency;constructor(u,g){this.log=u.logger.forComponent("helia:routing"),this.routers=g.routers??[],this.providerLookupConcurrency=g.providerLookupConcurrency??DEFAULT_PROVIDER_LOOKUP_CONCURRENCY,this.findProviders=u.metrics?.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1})??this.findProviders,this.provide=u.metrics?.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1})??this.provide,this.cancelReprovide=u.metrics?.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1})??this.cancelReprovide,this.put=u.metrics?.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2})??this.put,this.get=u.metrics?.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1})??this.get,this.findPeer=u.metrics?.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=u.metrics?.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}async start(){await start(...this.routers)}async stop(){await stop(...this.routers)}async*findProviders(u,g={}){if(this.routers.length===0)throw new NoRoutersAvailableError("No content routers available");const v=new PeerQueue({concurrency:this.providerLookupConcurrency});for await(const b of merge$1(v.toGenerator(),...supports(this.routers,"findProviders").map(w=>w.findProviders(u,g))))if(b!=null){if(b.multiaddrs.length===0){if(v.find(b.id)!=null)continue;v.add(async()=>{try{const w=await this.findPeer(b.id,g);return w.multiaddrs.length===0?null:{...w,protocols:b.protocols,routing:b.routing}}catch(w){return this.log.error("could not load multiaddrs for peer %p - %e",b.id,w),null}},{peerId:b.id,signal:g.signal}).catch(w=>{this.log.error("could not load multiaddrs for peer %p - %e",b.id,w)});continue}yield b}}async provide(u,g={}){if(this.routers.length===0)throw new NoRoutersAvailableError("No content routers available");await Promise.all(supports(this.routers,"provide").map(async v=>{await v.provide(u,g)}))}async cancelReprovide(u,g={}){await Promise.all(supports(this.routers,"cancelReprovide").map(async v=>{await v.cancelReprovide(u,g)}))}async put(u,g,v){await Promise.all(supports(this.routers,"put").map(async b=>{await b.put(u,g,v)}))}async get(u,g){return Promise.any(supports(this.routers,"get").map(async v=>v.get(u,g)))}async findPeer(u,g){if(this.routers.length===0)throw new NoRoutersAvailableError("No peer routers available");const v=this,b=merge$1(...supports(this.routers,"findPeer").map(w=>(async function*(){try{yield await w.findPeer(u,g)}catch(E){v.log.error(E)}})()));for await(const w of b)if(w!=null)return w;throw new NotFoundError$1("Could not find peer in routing")}async*getClosestPeers(u,g={}){if(this.routers.length===0)throw new NoRoutersAvailableError("No peer routers available");for await(const v of merge$1(...supports(this.routers,"getClosestPeers").map(b=>b.getClosestPeers(u,g))))v!=null&&(yield v)}}function supports(y,u){return y.filter(g=>g[u]!=null)}let AbortError$2=class extends Error{static name="AbortError";name="AbortError";constructor(u="The operation was aborted",...g){super(u,...g)}};async function raceEvent(y,u,g,v){const b=new AbortError$2(v?.errorMessage);v?.errorCode!=null&&(b.code=v.errorCode);const w=v?.errorEvent??"error";return g?.aborted===!0?Promise.reject(b):new Promise((E,S)=>{function A(){removeListener(g,"abort",T),removeListener(y,u,$),removeListener(y,w,R)}const $=O=>{try{if(v?.filter?.(O)===!1)return}catch(B){A(),S(B);return}A(),E(O)},R=O=>{if(A(),O instanceof Error){S(O);return}S(O.detail??v?.error??new Error(`The "${v?.errorEvent}" event was emitted but the event had no '.detail' field. Pass an 'error' option to race-event to change this message.`))},T=()=>{A(),S(b)};addListener(g,"abort",T),addListener(y,u,$),addListener(y,w,R)})}function addListener(y,u,g){y!=null&&(isEventTarget(y)?y.addEventListener(u,g):y.addListener(u,g))}function removeListener(y,u,g){y!=null&&(isEventTarget(y)?y.removeEventListener(u,g):y.removeListener(u,g))}function isEventTarget(y){return typeof y.addEventListener=="function"&&typeof y.removeEventListener=="function"}class QueueFullError extends Error{static name="QueueFullError";constructor(u="The queue was full"){super(u),this.name="QueueFullError"}}let AbortError$1=class extends Error{type;code;constructor(u,g,v){super(u??"The operation was aborted"),this.type="aborted",this.name=v??"AbortError",this.code=g??"ABORT_ERR"}};async function raceSignal(y,u,g){if(u==null)return y;if(u.aborted)return y.catch(()=>{}),Promise.reject(new AbortError$1(g?.errorMessage,g?.errorCode,g?.errorName));let v;const b=new AbortError$1(g?.errorMessage,g?.errorCode,g?.errorName);try{return await Promise.race([y,new Promise((w,E)=>{v=()=>{E(b)},u.addEventListener("abort",v)})])}finally{v!=null&&u.removeEventListener("abort",v)}}class JobRecipient{deferred;signal;constructor(u){this.signal=u,this.deferred=Promise.withResolvers(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new AbortError$2)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}function randomId(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class Job{id;fn;options;recipients;status;timeline;controller;constructor(u,g){this.id=randomId(),this.status="queued",this.fn=u,this.options=g,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(u){this.controller.abort(u)}onAbort(){this.recipients.reduce((g,v)=>g&&v.signal?.aborted===!0,!0)&&(this.controller.abort(new AbortError$2),this.cleanup())}async join(u={}){const g=new JobRecipient(u.signal);return this.recipients.push(g),u.signal?.addEventListener("abort",this.onAbort),g.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const u=await raceSignal(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(g=>{g.deferred.resolve(u)}),this.status="complete"}catch(u){this.recipients.forEach(g=>{g.deferred.reject(u)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(u=>{u.cleanup(),u.signal?.removeEventListener("abort",this.onAbort)})}}function debounce(y,u){let g;const v=function(){const b=function(){g=void 0,y()};clearTimeout(g),g=setTimeout(b,u)};return v.start=()=>{},v.stop=()=>{clearTimeout(g)},v}class Queue extends TypedEventEmitter{concurrency;maxSize;queue;pending;sort;autoStart;constructor(u={}){super(),this.concurrency=u.concurrency??Number.POSITIVE_INFINITY,this.maxSize=u.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.autoStart=u.autoStart??!0,this.sort=u.sort,this.queue=[],this.emitEmpty=debounce(this.emitEmpty.bind(this),1),this.emitIdle=debounce(this.emitIdle.bind(this),1)}[Symbol.asyncIterator](){return this.toGenerator()}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let u;for(const g of this.queue)if(g.status==="queued"){u=g;break}return u==null?!1:(this.safeDispatchEvent("active"),this.pending++,u.run().finally(()=>{for(let g=0;g<this.queue.length;g++)if(this.queue[g]===u){this.queue.splice(g,1);break}this.pending--,this.safeDispatchEvent("next"),this.autoStart&&this.tryToStartAnother()}),!0)}return!1}enqueue(u){this.queue.push(u),this.sort!=null&&this.queue.sort(this.sort)}start(){this.autoStart===!1&&(this.autoStart=!0,this.tryToStartAnother())}pause(){this.autoStart=!1}async add(u,g){if(g?.signal?.throwIfAborted(),this.size===this.maxSize)throw new QueueFullError;const v=new Job(u,g);return this.enqueue(v),this.safeDispatchEvent("add"),this.autoStart&&this.tryToStartAnother(),v.join(g).then(b=>(this.safeDispatchEvent("success",{detail:{job:v,result:b}}),b)).catch(b=>{if(v.status==="queued"){for(let w=0;w<this.queue.length;w++)if(this.queue[w]===v){this.queue.splice(w,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:v,error:b}}),b})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(u=>{u.abort(new AbortError$2)}),this.clear()}async onEmpty(u){this.size!==0&&await raceEvent(this,"empty",u?.signal)}async onSizeLessThan(u,g){this.size<u||await raceEvent(this,"next",g?.signal,{filter:()=>this.size<u})}async onIdle(u){this.pending===0&&this.size===0||await raceEvent(this,"idle",u?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(u){u?.signal?.throwIfAborted();const g=pushable({objectMode:!0}),v=A=>{A!=null?this.abort():this.clear(),g.end(A)},b=A=>{A.detail!=null&&g.push(A.detail.result)},w=A=>{v(A.detail.error)},E=()=>{v()},S=()=>{v(new AbortError$2("Queue aborted"))};this.addEventListener("success",b),this.addEventListener("failure",w),this.addEventListener("idle",E),u?.signal?.addEventListener("abort",S);try{yield*g}finally{this.removeEventListener("success",b),this.removeEventListener("failure",w),this.removeEventListener("idle",E),u?.signal?.removeEventListener("abort",S),v()}}}const WORKER_REQUEST_READ_LOCK="lock:worker:request-read",WORKER_ABORT_READ_LOCK_REQUEST="lock:worker:abort-read-request",WORKER_RELEASE_READ_LOCK="lock:worker:release-read",MASTER_GRANT_READ_LOCK="lock:master:grant-read",MASTER_READ_LOCK_ERROR="lock:master:error-read",WORKER_REQUEST_WRITE_LOCK="lock:worker:request-write",WORKER_ABORT_WRITE_LOCK_REQUEST="lock:worker:abort-write-request",WORKER_RELEASE_WRITE_LOCK="lock:worker:release-write",MASTER_GRANT_WRITE_LOCK="lock:master:grant-write",MASTER_WRITE_LOCK_ERROR="lock:master:error-write",WORKER_FINALIZE="lock:worker:finalize",BROADCAST_CHANNEL_NAME="mortice",defaultOptions$3={singleProcess:!1},handleChannelWorkerLockRequest=(y,u,g,v,b,w,E,S,A)=>$=>{if($.data==null)return;const R={type:$.data.type,name:$.data.name,identifier:$.data.identifier};R.type===b&&y.safeDispatchEvent(g,{detail:{name:R.name,identifier:R.identifier,handler:async()=>{u.postMessage({type:A,name:R.name,identifier:R.identifier}),await new Promise(T=>{const O=B=>{if(B?.data==null)return;const F={type:B.data.type,name:B.data.name,identifier:B.data.identifier};F.type===S&&F.identifier===R.identifier&&(u.removeEventListener("message",O),T())};u.addEventListener("message",O)})},onError:T=>{u.postMessage({type:E,name:R.name,identifier:R.identifier,error:{message:T.message,name:T.name,stack:T.stack}})}}}),R.type===w&&y.safeDispatchEvent(v,{detail:{name:R.name,identifier:R.identifier}}),R.type===WORKER_FINALIZE&&y.safeDispatchEvent("finalizeRequest",{detail:{name:R.name}})},nanoid$5=(y=10)=>Math.random().toString().substring(2,y+2);class MorticeChannelWorker{name;channel;constructor(u){this.name=u,this.channel=new BroadcastChannel(BROADCAST_CHANNEL_NAME)}readLock(u){return this.sendRequest(WORKER_REQUEST_READ_LOCK,WORKER_ABORT_READ_LOCK_REQUEST,MASTER_GRANT_READ_LOCK,MASTER_READ_LOCK_ERROR,WORKER_RELEASE_READ_LOCK,u)}writeLock(u){return this.sendRequest(WORKER_REQUEST_WRITE_LOCK,WORKER_ABORT_WRITE_LOCK_REQUEST,MASTER_GRANT_WRITE_LOCK,MASTER_WRITE_LOCK_ERROR,WORKER_RELEASE_WRITE_LOCK,u)}finalize(){this.channel.postMessage({type:WORKER_FINALIZE,name:this.name}),this.channel.close()}async sendRequest(u,g,v,b,w,E){E?.signal?.throwIfAborted();const S=nanoid$5();return this.channel.postMessage({type:u,identifier:S,name:this.name}),new Promise((A,$)=>{const R=()=>{this.channel.postMessage({type:g,identifier:S,name:this.name})};E?.signal?.addEventListener("abort",R,{once:!0});const T=O=>{if(O.data?.identifier===S&&(O.data?.type===v&&(this.channel.removeEventListener("message",T),E?.signal?.removeEventListener("abort",R),A(()=>{this.channel.postMessage({type:w,identifier:S,name:this.name})})),O.data.type===b)){this.channel.removeEventListener("message",T),E?.signal?.removeEventListener("abort",R);const B=new Error;O.data.error!=null&&(B.message=O.data.error.message,B.name=O.data.error.name,B.stack=O.data.error.stack),$(B)}};this.channel.addEventListener("message",T)})}}const impl=y=>{if(y=Object.assign({},defaultOptions$3,y),!!globalThis.document||y.singleProcess){const g=new BroadcastChannel(BROADCAST_CHANNEL_NAME),v=new TypedEventEmitter;return g.addEventListener("message",handleChannelWorkerLockRequest(v,g,"requestReadLock","abortReadLockRequest",WORKER_REQUEST_READ_LOCK,WORKER_ABORT_READ_LOCK_REQUEST,MASTER_READ_LOCK_ERROR,WORKER_RELEASE_READ_LOCK,MASTER_GRANT_READ_LOCK)),g.addEventListener("message",handleChannelWorkerLockRequest(v,g,"requestWriteLock","abortWriteLockRequest",WORKER_REQUEST_WRITE_LOCK,WORKER_ABORT_WRITE_LOCK_REQUEST,MASTER_WRITE_LOCK_ERROR,WORKER_RELEASE_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK)),v}return new MorticeChannelWorker(y.name)},mutexes=new Map;let implementation;function isMortice(y){return typeof y?.readLock=="function"&&typeof y?.writeLock=="function"}function getImplementation(y){if(implementation==null&&(implementation=impl(y),!isMortice(implementation))){const u=implementation;u.addEventListener("requestReadLock",g=>{const v=g.detail.name,b=g.detail.identifier,w=mutexes.get(v);if(w==null)return;const E=new AbortController,S=A=>{A.detail.name!==v||A.detail.identifier!==b||E.abort()};u.addEventListener("abortReadLockRequest",S),w.readLock({signal:E.signal}).then(async A=>{await g.detail.handler().finally(()=>{A()})}).catch(A=>{g.detail.onError(A)}).finally(()=>{u.removeEventListener("abortReadLockRequest",S)})}),u.addEventListener("requestWriteLock",g=>{const v=g.detail.name,b=g.detail.identifier,w=mutexes.get(v);if(w==null)return;const E=new AbortController,S=A=>{A.detail.name!==v||A.detail.identifier!==b||E.abort()};u.addEventListener("abortWriteLockRequest",S),w.writeLock({signal:E.signal}).then(async A=>{await g.detail.handler().finally(()=>{A()})}).catch(A=>{g.detail.onError(A)}).finally(()=>{u.removeEventListener("abortWriteLockRequest",S)})}),u.addEventListener("finalizeRequest",g=>{const v=g.detail.name,b=mutexes.get(v);b?.finalize()})}return implementation}async function createReleasable(y,u){let g,v;const b=new Promise((E,S)=>{g=E,v=S}),w=()=>{v(new AbortError$2)};return u?.signal?.addEventListener("abort",w,{once:!0}),y.add(async()=>{await new Promise(E=>{g(()=>{u?.signal?.removeEventListener("abort",w),E()})})},{signal:u?.signal}).catch(E=>{v(E)}),b}const createMutex=(y,u)=>{let g=mutexes.get(y);if(g!=null)return g;const v=getImplementation(u);if(isMortice(v))return g=v,mutexes.set(y,g),g;const b=new Queue({concurrency:1});let w;return g={async readLock(E){if(w!=null)return createReleasable(w,E);w=new Queue({concurrency:u.concurrency,autoStart:!1});const S=w,A=createReleasable(w,E);return b.add(async()=>{S.start(),await S.onIdle().then(()=>{w===S&&(w=null)})}),A},async writeLock(E){return w=null,createReleasable(b,E)},finalize:()=>{mutexes.delete(y)},queue:b},mutexes.set(y,g),u.autoFinalize===!0&&b.addEventListener("idle",()=>{g.finalize()},{once:!0}),g},defaultOptions$2={name:"lock",concurrency:1/0,singleProcess:!1,autoFinalize:!1};function createMortice(y){const u=Object.assign({},defaultOptions$2,y);return createMutex(u.name,u)}class BlockStorage{lock;child;pins;started;constructor(u,g,v={}){this.child=u,this.pins=g,this.lock=createMortice({singleProcess:v.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await start(this.child),this.started=!0}async stop(){await stop(this.child),this.started=!1}unwrap(){return this.child}async put(u,g,v={}){v?.signal?.throwIfAborted();const b=await this.lock.readLock();try{return await this.child.put(u,g,v)}finally{b()}}async*putMany(u,g={}){g?.signal?.throwIfAborted();const v=await this.lock.readLock();try{yield*this.child.putMany(u,g)}finally{v()}}async*get(u,g={}){g?.signal?.throwIfAborted();const v=await this.lock.readLock();try{yield*this.child.get(u,g)}finally{v()}}async*getMany(u,g={}){g?.signal?.throwIfAborted();const v=await this.lock.readLock();try{yield*this.child.getMany(u,g)}finally{v()}}async delete(u,g={}){g?.signal?.throwIfAborted();const v=await this.lock.writeLock();try{if(await this.pins.isPinned(u))throw new BlockPinnedError("Block was pinned - please unpin and try again");await this.child.delete(u,g)}finally{v()}}async*deleteMany(u,g={}){g?.signal?.throwIfAborted();const v=await this.lock.writeLock();try{const b=this;yield*this.child.deleteMany((async function*(){for await(const w of u){if(await b.pins.isPinned(w))throw new BlockPinnedError("Block was pinned - please unpin and try again");yield w}})(),g)}finally{v()}}async has(u,g={}){g?.signal?.throwIfAborted();const v=await this.lock.readLock();try{return await this.child.has(u,g)}finally{v()}}async*getAll(u={}){u?.signal?.throwIfAborted();const g=await this.lock.readLock();try{yield*this.child.getAll(u)}finally{g()}}createSession(u,g){return g?.signal?.throwIfAborted(),this.child.createSession(u,g)}}const DS_VERSION_KEY=new Key("/version"),CURRENT_VERSION=1;async function assertDatastoreVersionIsCurrent(y){if(!await y.has(DS_VERSION_KEY)){await y.put(DS_VERSION_KEY,fromString$1(`${CURRENT_VERSION}`));return}const u=await y.get(DS_VERSION_KEY),g=toString$3(u);if(parseInt(g,10)!==CURRENT_VERSION)throw new InvalidDatastoreVersionError("Invalid datastore version, a datastore migration may be required")}const CID_CBOR_TAG=42;function toByteView$2(y){return y instanceof ArrayBuffer?new Uint8Array(y,0,y.byteLength):y}function cidEncoder$1(y){if(y.asCID!==y&&y["/"]!==y.bytes)return null;const u=CID.asCID(y);if(!u)return null;const g=new Uint8Array(u.bytes.byteLength+1);return g.set(u.bytes,1),[new Token(Type.tag,CID_CBOR_TAG),new Token(Type.bytes,g)]}function undefinedEncoder$1(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function numberEncoder$1(y){if(Number.isNaN(y))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(y===1/0||y===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}function mapEncoder(y){for(const u of y.keys())if(typeof u!="string"||u.length===0)throw new Error("Non-string Map keys are not supported by the IPLD Data Model and cannot be encoded");return null}const _encodeOptions={float64:!0,typeEncoders:{Map:mapEncoder,Object:cidEncoder$1,undefined:undefinedEncoder$1,number:numberEncoder$1}},encodeOptions$1={..._encodeOptions,typeEncoders:{..._encodeOptions.typeEncoders}};function cidDecoder(y){if(y[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return CID.decode(y.subarray(1))}const _decodeOptions={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};_decodeOptions.tags[CID_CBOR_TAG]=cidDecoder;const decodeOptions$1={..._decodeOptions,tags:_decodeOptions.tags.slice()},name$4="dag-cbor",code$3=113,encode$6=y=>encode$8(y,_encodeOptions),decode$4=y=>decode$6(toByteView$2(y),_decodeOptions),dagCbor=Object.freeze(Object.defineProperty({__proto__:null,code:code$3,decode:decode$4,decodeOptions:decodeOptions$1,encode:encode$6,encodeOptions:encodeOptions$1,name:name$4,toByteView:toByteView$2},Symbol.toStringTag,{value:"Module"}));class JSONEncoder extends Array{constructor(){super(),this.inRecursive=[]}prefix(u){const g=this.inRecursive[this.inRecursive.length-1];g&&(g.type===Type.array&&(g.elements++,g.elements!==1&&u.push([44])),g.type===Type.map&&(g.elements++,g.elements!==1&&(g.elements%2===1?u.push([44]):u.push([58]))))}[Type.uint.major](u,g){this.prefix(u);const v=String(g.value),b=[];for(let w=0;w<v.length;w++)b[w]=v.charCodeAt(w);u.push(b)}[Type.negint.major](u,g){this[Type.uint.major](u,g)}[Type.bytes.major](u,g){throw new Error(`${encodeErrPrefix} unsupported type: Uint8Array`)}[Type.string.major](u,g){this.prefix(u);const v=fromString(JSON.stringify(g.value));u.push(v.length>32?asU8A(v):v)}[Type.array.major](u,g){this.prefix(u),this.inRecursive.push({type:Type.array,elements:0}),u.push([91])}[Type.map.major](u,g){this.prefix(u),this.inRecursive.push({type:Type.map,elements:0}),u.push([123])}[Type.tag.major](u,g){}[Type.float.major](u,g){if(g.type.name==="break"){const E=this.inRecursive.pop();if(E){if(E.type===Type.array)u.push([93]);else if(E.type===Type.map)u.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(g.value===void 0)throw new Error(`${encodeErrPrefix} unsupported type: undefined`);if(this.prefix(u),g.type.name==="true"){u.push([116,114,117,101]);return}else if(g.type.name==="false"){u.push([102,97,108,115,101]);return}else if(g.type.name==="null"){u.push([110,117,108,108]);return}const v=String(g.value),b=[];let w=!1;for(let E=0;E<v.length;E++)b[E]=v.charCodeAt(E),!w&&(b[E]===46||b[E]===101||b[E]===69)&&(w=!0);w||(b.push(46),b.push(48)),u.push(b)}}function mapSorter(y,u){if(Array.isArray(y[0])||Array.isArray(u[0]))throw new Error(`${encodeErrPrefix} complex map keys are not supported`);const g=y[0],v=u[0];if(g.type!==Type.string||v.type!==Type.string)throw new Error(`${encodeErrPrefix} non-string map keys are not supported`);if(g<v)return-1;if(g>v)return 1;throw new Error(`${encodeErrPrefix} unexpected duplicate map keys, this is not supported`)}const defaultEncodeOptions={addBreakTokens:!0,mapSorter};function encode$5(y,u){return u=Object.assign({},defaultEncodeOptions,u),encodeCustom(y,new JSONEncoder,u)}class Tokenizer{constructor(u,g={}){this._pos=0,this.data=u,this.options=g,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let u=this.ch();for(;u===32||u===9||u===13||u===10;)u=this.data[++this._pos]}expect(u){if(this.data.length-this._pos<u.length)throw new Error(`${decodeErrPrefix} unexpected end of input at position ${this._pos}`);for(let g=0;g<u.length;g++)if(this.data[this._pos++]!==u[g])throw new Error(`${decodeErrPrefix} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...u)}'`)}parseNumber(){const u=this._pos;let g=!1,v=!1;const b=S=>{for(;!this.done();){const A=this.ch();if(S.includes(A))this._pos++;else break}};if(this.ch()===45&&(g=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,v=!0;else return new Token(Type.uint,0,this._pos-u);if(b([48,49,50,51,52,53,54,55,56,57]),g&&this._pos===u+1)throw new Error(`${decodeErrPrefix} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(v)throw new Error(`${decodeErrPrefix} unexpected token at position ${this._pos}`);v=!0,this._pos++,b([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(v=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,b([48,49,50,51,52,53,54,55,56,57]));const w=String.fromCharCode.apply(null,this.data.subarray(u,this._pos)),E=parseFloat(w);return v?new Token(Type.float,E,this._pos-u):this.options.allowBigInt!==!0||Number.isSafeInteger(E)?new Token(E>=0?Type.uint:Type.negint,E,this._pos-u):new Token(E>=0?Type.uint:Type.negint,BigInt(w),this._pos-u)}parseString(){if(this.ch()!==34)throw new Error(`${decodeErrPrefix} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let w=this._pos,E=0;w<this.data.length&&E<65536;w++,E++){const S=this.data[w];if(S===92||S<32||S>=128)break;if(S===34){const A=String.fromCharCode.apply(null,this.data.subarray(this._pos,w));return this._pos=w+1,new Token(Type.string,A,E)}}const u=this._pos,g=[],v=()=>{if(this._pos+4>=this.data.length)throw new Error(`${decodeErrPrefix} unexpected end of unicode escape sequence at position ${this._pos}`);let w=0;for(let E=0;E<4;E++){let S=this.ch();if(S>=48&&S<=57)S-=48;else if(S>=97&&S<=102)S=S-97+10;else if(S>=65&&S<=70)S=S-65+10;else throw new Error(`${decodeErrPrefix} unexpected unicode escape character at position ${this._pos}`);w=w*16+S,this._pos++}return w},b=()=>{const w=this.ch();let E=null,S=w>239?4:w>223?3:w>191?2:1;if(this._pos+S>this.data.length)throw new Error(`${decodeErrPrefix} unexpected unicode sequence at position ${this._pos}`);let A,$,R,T;switch(S){case 1:w<128&&(E=w);break;case 2:A=this.data[this._pos+1],(A&192)===128&&(T=(w&31)<<6|A&63,T>127&&(E=T));break;case 3:A=this.data[this._pos+1],$=this.data[this._pos+2],(A&192)===128&&($&192)===128&&(T=(w&15)<<12|(A&63)<<6|$&63,T>2047&&(T<55296||T>57343)&&(E=T));break;case 4:A=this.data[this._pos+1],$=this.data[this._pos+2],R=this.data[this._pos+3],(A&192)===128&&($&192)===128&&(R&192)===128&&(T=(w&15)<<18|(A&63)<<12|($&63)<<6|R&63,T>65535&&T<1114112&&(E=T))}E===null?(E=65533,S=1):E>65535&&(E-=65536,g.push(E>>>10&1023|55296),E=56320|E&1023),g.push(E),this._pos+=S};for(;!this.done();){const w=this.ch();let E;switch(w){case 92:if(this._pos++,this.done())throw new Error(`${decodeErrPrefix} unexpected string termination at position ${this._pos}`);switch(E=this.ch(),this._pos++,E){case 34:case 39:case 92:case 47:g.push(E);break;case 98:g.push(8);break;case 116:g.push(9);break;case 110:g.push(10);break;case 102:g.push(12);break;case 114:g.push(13);break;case 117:g.push(v());break;default:throw new Error(`${decodeErrPrefix} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new Token(Type.string,decodeCodePointsArray(g),this._pos-u);default:if(w<32)throw new Error(`${decodeErrPrefix} invalid control character at position ${this._pos}`);w<128?(g.push(w),this._pos++):b()}}throw new Error(`${decodeErrPrefix} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new Token(Type.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new Token(Type.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new Token(Type.null,null,4);case 102:return this.expect([102,97,108,115,101]),new Token(Type.false,!1,5);case 116:return this.expect([116,114,117,101]),new Token(Type.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${decodeErrPrefix} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new Token(Type.break,void 0,1);if(this.ch()!==44)throw new Error(`${decodeErrPrefix} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new Token(Type.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new Token(Type.break,void 0,1);if(this.ch()!==44)throw new Error(`${decodeErrPrefix} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new Token(Type.break,void 0,1);const u=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${decodeErrPrefix} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),u}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${decodeErrPrefix} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function decode$3(y,u){return u=Object.assign({tokenizer:new Tokenizer(y,u)},u),decode$6(y,u)}function toByteView$1(y){return y instanceof ArrayBuffer?new Uint8Array(y,0,y.byteLength):y}function cidEncoder(y){if(y.asCID!==y&&y["/"]!==y.bytes)return null;const u=CID.asCID(y);if(!u)return null;const g=u.toString();return[new Token(Type.map,1/0,1),new Token(Type.string,"/",1),new Token(Type.string,g,g.length),new Token(Type.break,void 0,1)]}function bytesEncoder(y){const u=base64$1.encode(y).slice(1);return[new Token(Type.map,1/0,1),new Token(Type.string,"/",1),new Token(Type.map,1/0,1),new Token(Type.string,"bytes",5),new Token(Type.string,u,u.length),new Token(Type.break,void 0,1),new Token(Type.break,void 0,1)]}function taBytesEncoder(y){return bytesEncoder(new Uint8Array(y.buffer,y.byteOffset,y.byteLength))}function abBytesEncoder(y){return bytesEncoder(new Uint8Array(y))}function undefinedEncoder(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function numberEncoder(y){if(Number.isNaN(y))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(y===1/0||y===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const encodeOptions={typeEncoders:{Object:cidEncoder,Buffer:bytesEncoder,Uint8Array:bytesEncoder,Int8Array:taBytesEncoder,Uint16Array:taBytesEncoder,Int16Array:taBytesEncoder,Uint32Array:taBytesEncoder,Int32Array:taBytesEncoder,Float32Array:taBytesEncoder,Float64Array:taBytesEncoder,Uint8ClampedArray:taBytesEncoder,BigInt64Array:taBytesEncoder,BigUint64Array:taBytesEncoder,DataView:taBytesEncoder,ArrayBuffer:abBytesEncoder,undefined:undefinedEncoder,number:numberEncoder}};class DagJsonTokenizer extends Tokenizer{constructor(u,g){super(u,g),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const u=this._next();if(u.type===Type.map){const g=this._next();if(g.type===Type.string&&g.value==="/"){const v=this._next();if(v.type===Type.string){if(this._next().type!==Type.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(v),new Token(Type.tag,42,0)}if(v.type===Type.map){const b=this._next();if(b.type===Type.string&&b.value==="bytes"){const w=this._next();if(w.type===Type.string){for(let S=0;S<2;S++)if(this._next().type!==Type.break)throw new Error("Invalid encoded Bytes form");const E=base64$1.decode(`m${w.value}`);return new Token(Type.bytes,E,w.value.length)}this.tokenBuffer.push(w)}this.tokenBuffer.push(b)}this.tokenBuffer.push(v)}this.tokenBuffer.push(g)}return u}}const decodeOptions={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};decodeOptions.tags[42]=CID.parse;const name$3="dag-json",code$2=297,encode$4=y=>encode$5(y,encodeOptions),decode$2=y=>{const u=toByteView$1(y),g=Object.assign(decodeOptions,{tokenizer:new DagJsonTokenizer(u,decodeOptions)});return decode$3(u,g)},format=y=>utf8Decoder.decode(encode$4(y)),utf8Decoder=new TextDecoder,parse$8=y=>decode$2(utf8Encoder.encode(y)),utf8Encoder=new TextEncoder,dagJson=Object.freeze(Object.defineProperty({__proto__:null,code:code$2,decode:decode$2,encode:encode$4,format,name:name$3,parse:parse$8,stringify:format},Symbol.toStringTag,{value:"Module"})),textDecoder=new TextDecoder;function decodeVarint(y,u){let g=0;for(let v=0;;v+=7){if(v>=64)throw new Error("protobuf: varint overflow");if(u>=y.length)throw new Error("protobuf: unexpected end of data");const b=y[u++];if(g+=v<28?(b&127)<<v:(b&127)*2**v,b<128)break}return[g,u]}function decodeBytes(y,u){let g;[g,u]=decodeVarint(y,u);const v=u+g;if(g<0||v<0)throw new Error("protobuf: invalid length");if(v>y.length)throw new Error("protobuf: unexpected end of data");return[y.subarray(u,v),v]}function decodeKey(y,u){let g;return[g,u]=decodeVarint(y,u),[g&7,g>>3,u]}function decodeLink(y){const u={},g=y.length;let v=0;for(;v<g;){let b,w;if([b,w,v]=decodeKey(y,v),w===1){if(u.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(b!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${b}) for Hash`);if(u.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(u.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[u.Hash,v]=decodeBytes(y,v)}else if(w===2){if(u.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(b!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${b}) for Name`);if(u.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let E;[E,v]=decodeBytes(y,v),u.Name=textDecoder.decode(E)}else if(w===3){if(u.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(b!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${b}) for Tsize`);[u.Tsize,v]=decodeVarint(y,v)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${w}`)}if(v>g)throw new Error("protobuf: (PBLink) unexpected end of data");return u}function decodeNode(y){const u=y.length;let g=0,v,b=!1,w;for(;g<u;){let S,A;if([S,A,g]=decodeKey(y,g),S!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${S}`);if(A===1){if(w)throw new Error("protobuf: (PBNode) duplicate Data section");[w,g]=decodeBytes(y,g),v&&(b=!0)}else if(A===2){if(b)throw new Error("protobuf: (PBNode) duplicate Links section");v||(v=[]);let $;[$,g]=decodeBytes(y,g),v.push(decodeLink($))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${A}`)}if(g>u)throw new Error("protobuf: (PBNode) unexpected end of data");const E={};return w&&(E.Data=w),E.Links=v||[],E}const textEncoder$1=new TextEncoder,maxInt32=2**32,maxUInt32=2**31;function encodeLink(y,u){let g=u.length;if(typeof y.Tsize=="number"){if(y.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(y.Tsize))throw new Error("Tsize too large for encoding");g=encodeVarint(u,g,y.Tsize)-1,u[g]=24}if(typeof y.Name=="string"){const v=textEncoder$1.encode(y.Name);g-=v.length,u.set(v,g),g=encodeVarint(u,g,v.length)-1,u[g]=18}return y.Hash&&(g-=y.Hash.length,u.set(y.Hash,g),g=encodeVarint(u,g,y.Hash.length)-1,u[g]=10),u.length-g}function encodeNode(y){const u=sizeNode(y),g=new Uint8Array(u);let v=u;if(y.Data&&(v-=y.Data.length,g.set(y.Data,v),v=encodeVarint(g,v,y.Data.length)-1,g[v]=10),y.Links)for(let b=y.Links.length-1;b>=0;b--){const w=encodeLink(y.Links[b],g.subarray(0,v));v-=w,v=encodeVarint(g,v,w)-1,g[v]=18}return g}function sizeLink(y){let u=0;if(y.Hash){const g=y.Hash.length;u+=1+g+sov(g)}if(typeof y.Name=="string"){const g=textEncoder$1.encode(y.Name).length;u+=1+g+sov(g)}return typeof y.Tsize=="number"&&(u+=1+sov(y.Tsize)),u}function sizeNode(y){let u=0;if(y.Data){const g=y.Data.length;u+=1+g+sov(g)}if(y.Links)for(const g of y.Links){const v=sizeLink(g);u+=1+v+sov(v)}return u}function encodeVarint(y,u,g){u-=sov(g);const v=u;for(;g>=maxUInt32;)y[u++]=g&127|128,g/=128;for(;g>=128;)y[u++]=g&127|128,g>>>=7;return y[u]=g,v}function sov(y){return y%2===0&&y++,Math.floor((len64(y)+6)/7)}function len64(y){let u=0;return y>=maxInt32&&(y=Math.floor(y/maxInt32),u=32),y>=65536&&(y>>>=16,u+=16),y>=256&&(y>>>=8,u+=8),u+len8tab[y]}const len8tab=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],pbNodeProperties=["Data","Links"],pbLinkProperties=["Hash","Name","Tsize"],textEncoder=new TextEncoder;function linkComparator(y,u){if(y===u)return 0;const g=y.Name?textEncoder.encode(y.Name):[],v=u.Name?textEncoder.encode(u.Name):[];let b=g.length,w=v.length;for(let E=0,S=Math.min(b,w);E<S;++E)if(g[E]!==v[E]){b=g[E],w=v[E];break}return b<w?-1:w<b?1:0}function hasOnlyProperties(y,u){return!Object.keys(y).some(g=>!u.includes(g))}function asLink(y){if(typeof y.asCID=="object"){const g=CID.asCID(y);if(!g)throw new TypeError("Invalid DAG-PB form");return{Hash:g}}if(typeof y!="object"||Array.isArray(y))throw new TypeError("Invalid DAG-PB form");const u={};if(y.Hash){let g=CID.asCID(y.Hash);try{g||(typeof y.Hash=="string"?g=CID.parse(y.Hash):y.Hash instanceof Uint8Array&&(g=CID.decode(y.Hash)))}catch(v){throw new TypeError(`Invalid DAG-PB form: ${v.message}`)}g&&(u.Hash=g)}if(!u.Hash)throw new TypeError("Invalid DAG-PB form");return typeof y.Name=="string"&&(u.Name=y.Name),typeof y.Tsize=="number"&&(u.Tsize=y.Tsize),u}function prepare(y){if((y instanceof Uint8Array||typeof y=="string")&&(y={Data:y}),typeof y!="object"||Array.isArray(y))throw new TypeError("Invalid DAG-PB form");const u={};if(y.Data!==void 0)if(typeof y.Data=="string")u.Data=textEncoder.encode(y.Data);else if(y.Data instanceof Uint8Array)u.Data=y.Data;else throw new TypeError("Invalid DAG-PB form");if(y.Links!==void 0)if(Array.isArray(y.Links))u.Links=y.Links.map(asLink),u.Links.sort(linkComparator);else throw new TypeError("Invalid DAG-PB form");else u.Links=[];return u}function validate$1(y){if(!y||typeof y!="object"||Array.isArray(y)||y instanceof Uint8Array||y["/"]&&y["/"]===y.bytes)throw new TypeError("Invalid DAG-PB form");if(!hasOnlyProperties(y,pbNodeProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(y.Data!==void 0&&!(y.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(y.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let u=0;u<y.Links.length;u++){const g=y.Links[u];if(!g||typeof g!="object"||Array.isArray(g)||g instanceof Uint8Array||g["/"]&&g["/"]===g.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!hasOnlyProperties(g,pbLinkProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(g.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(g.Hash==null||!g.Hash["/"]||g.Hash["/"]!==g.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(g.Name!==void 0&&typeof g.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(g.Tsize!==void 0){if(typeof g.Tsize!="number"||g.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(g.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(u>0&&linkComparator(g,y.Links[u-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function createNode(y,u=[]){return prepare({Data:y,Links:u})}function createLink(y,u,g){return asLink({Hash:g,Name:y,Tsize:u})}function toByteView(y){return y instanceof ArrayBuffer?new Uint8Array(y,0,y.byteLength):y}const name$2="dag-pb",code$1=112;function encode$3(y){validate$1(y);const u={};return y.Links&&(u.Links=y.Links.map(g=>{const v={};return g.Hash&&(v.Hash=g.Hash.bytes),g.Name!==void 0&&(v.Name=g.Name),g.Tsize!==void 0&&(v.Tsize=g.Tsize),v})),y.Data&&(u.Data=y.Data),encodeNode(u)}function decode$1(y){const u=toByteView(y),g=decodeNode(u),v={};return g.Data&&(v.Data=g.Data),g.Links&&(v.Links=g.Links.map(b=>{const w={};try{w.Hash=CID.decode(b.Hash)}catch{}if(!w.Hash)throw new Error("Invalid Hash field found in link, expected CID");return b.Name!==void 0&&(w.Name=b.Name),b.Tsize!==void 0&&(w.Tsize=b.Tsize),w})),v}const dagPb=Object.freeze(Object.defineProperty({__proto__:null,code:code$1,createLink,createNode,decode:decode$1,encode:encode$3,name:name$2,prepare,validate:validate$1},Symbol.toStringTag,{value:"Module"}));function isPromise$4(y){return y?.then!=null}function getCodec(y=[],u){const g={[code$1]:dagPb,[code$5]:raw,[code$3]:dagCbor,[code$2]:dagJson,[code$6]:json$1};return y.forEach(v=>{g[v.code]=v}),async v=>{let b=g[v];if(b==null&&u!=null){const w=u(v);isPromise$4(w)?b=await w:b=w,g[b.code]=b}if(b!=null)return b;throw new UnknownCodecError(`Could not load codec for ${v}`)}}function getHasher(y=[],u){const g={[sha256$4.code]:sha256$4,[sha512$4.code]:sha512$4,[identity.code]:identity};return y.forEach(v=>{g[v.code]=v}),async v=>{let b=g[v];if(b==null&&u!=null){const w=u(v);isPromise$4(w)?b=await w:b=w,g[b.code]=b}if(b!=null)return b;throw new UnknownHashAlgorithmError(`No hasher configured for multihash code 0x${v.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}class NotFoundError extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=NotFoundError.name;code=NotFoundError.code;constructor(u="Not Found"){super(u)}}class BaseBlockstore{has(u,g){return Promise.reject(new Error(".has is not implemented"))}put(u,g,v){return Promise.reject(new Error(".put is not implemented"))}async*putMany(u,g){for await(const{cid:v,bytes:b}of u)await this.put(v,b,g),yield v}get(u,g){throw new Error(".get is not implemented")}async*getMany(u,g){for await(const v of u)yield{cid:v,bytes:this.get(v,g)}}delete(u,g){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(u,g){for await(const v of u)await this.delete(v,g),yield v}async*getAll(u){throw new Error(".getAll is not implemented")}}const IDENTITY_CODEC$1=0;class IdentityHashDigestTooLongError extends Error{static name="IdentityHashDigestTooLongError";name="IdentityHashDigestTooLongError"}class IdentityBlockstore extends BaseBlockstore{child;maxDigestLength;constructor(u,g){super(),this.child=u,this.maxDigestLength=g?.maxDigestLength}put(u,g,v){if(u.multihash.code===IDENTITY_CODEC$1){if(this.maxDigestLength!=null&&u.multihash.digest.byteLength>this.maxDigestLength)throw new IdentityHashDigestTooLongError(`Identity digest too long - ${u.multihash.digest.byteLength} > this.maxDigestLength`);return v?.signal?.throwIfAborted(),u}return this.child==null?(v?.signal?.throwIfAborted(),u):this.child.put(u,g,v)}*get(u,g){if(u.multihash.code===IDENTITY_CODEC$1){if(this.maxDigestLength!=null&&u.multihash.digest.byteLength>this.maxDigestLength)throw new IdentityHashDigestTooLongError(`Identity digest too long - ${u.multihash.digest.byteLength} > this.maxDigestLength`);g?.signal?.throwIfAborted(),yield u.multihash.digest;return}if(this.child==null)throw g?.signal?.throwIfAborted(),new NotFoundError;yield*this.child.get(u,g)}has(u,g){if(u.multihash.code===IDENTITY_CODEC$1){if(this.maxDigestLength!=null&&u.multihash.digest.byteLength>this.maxDigestLength)throw new IdentityHashDigestTooLongError(`Identity digest too long - ${u.multihash.digest.byteLength} > this.maxDigestLength`);return g?.signal?.throwIfAborted(),!0}return this.child==null?(g?.signal?.throwIfAborted(),!1):this.child.has(u,g)}delete(u,g){if(u.code===IDENTITY_CODEC$1){if(this.maxDigestLength!=null&&u.multihash.digest.byteLength>this.maxDigestLength)throw new IdentityHashDigestTooLongError(`Identity digest too long - ${u.multihash.digest.byteLength} > this.maxDigestLength`);g?.signal?.throwIfAborted();return}if(this.child!=null)return this.child.delete(u,g)}*getAll(u){this.child!=null&&(yield*this.child.getAll(u)),u?.signal?.throwIfAborted()}}function peekable(y){const[u,g]=y[Symbol.asyncIterator]!=null?[y[Symbol.asyncIterator](),Symbol.asyncIterator]:[y[Symbol.iterator](),Symbol.iterator],v=[];return{peek:()=>u.next(),push:b=>{v.push(b)},next:()=>v.length>0?{done:!1,value:v.shift()}:u.next(),[g](){return this}}}function isAsyncIterable$7(y){return y[Symbol.asyncIterator]!=null}function filter(y,u){let g=0;if(isAsyncIterable$7(y))return(async function*(){for await(const A of y)await u(A,g++)&&(yield A)})();const v=peekable(y),{value:b,done:w}=v.next();if(w===!0)return(function*(){})();const E=u(b,g++);if(typeof E.then=="function")return(async function*(){await E&&(yield b);for(const A of v)await u(A,g++)&&(yield A)})();const S=u;return(function*(){E===!0&&(yield b);for(const A of v)S(A,g++)&&(yield A)})()}function isAsyncIterable$6(y){return y[Symbol.asyncIterator]!=null}function isPromise$3(y){return y?.then!=null}function forEach(y,u){let g=0;if(isAsyncIterable$6(y))return(async function*(){for await(const A of y){const $=u(A,g++);isPromise$3($)&&await $,yield A}})();const v=peekable(y),{value:b,done:w}=v.next();if(w===!0)return(function*(){})();if(typeof u(b,g++)?.then=="function")return(async function*(){yield b;for(const A of v){const $=u(A,g++);isPromise$3($)&&await $,yield A}})();const S=u;return(function*(){yield b;for(const A of v)S(A,g++),yield A})()}const DEFAULT_MAX_IDENTITY_HASH_DIGEST_LENGTH=128;class Storage{child;getHasher;log;logger;components;constructor(u,g={}){this.log=u.logger.forComponent("helia:networked-storage"),this.logger=u.logger,this.components=u,this.child=new IdentityBlockstore(u.blockstore,{maxDigestLength:g.maxIdentityHashDigestLength??DEFAULT_MAX_IDENTITY_HASH_DIGEST_LENGTH}),this.getHasher=u.getHasher}async put(u,g,v={}){return await this.child.has(u,v)?(v.onProgress?.(new CustomProgressEvent("blocks:put:duplicate",u)),u):(v.onProgress?.(new CustomProgressEvent("blocks:put:providers:notify",u)),await Promise.all(this.components.blockBrokers.map(async b=>b.announce?.(u,v))),v.onProgress?.(new CustomProgressEvent("blocks:put:blockstore:put",u)),this.child.put(u,g,v))}async*putMany(u,g={}){const v=filter(u,async({cid:w})=>{const E=await this.child.has(w,g);return E&&g.onProgress?.(new CustomProgressEvent("blocks:put-many:duplicate",w)),!E}),b=forEach(v,async({cid:w})=>{g.onProgress?.(new CustomProgressEvent("blocks:put-many:providers:notify",w)),await Promise.all(this.components.blockBrokers.map(async E=>E.announce?.(w,g)))});g.onProgress?.(new CustomProgressEvent("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(b,g)}async*get(u,g={}){if(g.offline!==!0&&!await this.child.has(u,g)){const v=await this.getHasher(u.multihash.code);g.onProgress?.(new CustomProgressEvent("blocks:get:providers:get",u));const b=await raceBlockRetrievers(u,this.components.blockBrokers,v,{...g,log:this.log});g.onProgress?.(new CustomProgressEvent("blocks:get:blockstore:put",u)),await this.child.put(u,b,g),g.onProgress?.(new CustomProgressEvent("blocks:get:providers:notify",u)),await Promise.all(this.components.blockBrokers.map(async w=>w.announce?.(u,g))),yield b;return}g.onProgress?.(new CustomProgressEvent("blocks:get:blockstore:get",u)),yield*this.child.get(u,g)}async*getMany(u,g={}){g.onProgress?.(new CustomProgressEvent("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(forEach(u,async v=>{if(g.offline!==!0&&!await this.child.has(v,g)){const b=await this.getHasher(v.multihash.code);g.onProgress?.(new CustomProgressEvent("blocks:get-many:providers:get",v));const w=await raceBlockRetrievers(v,this.components.blockBrokers,b,{...g,log:this.log});g.onProgress?.(new CustomProgressEvent("blocks:get-many:blockstore:put",v)),await this.child.put(v,w,g),g.onProgress?.(new CustomProgressEvent("blocks:get-many:providers:notify",v)),await Promise.all(this.components.blockBrokers.map(async E=>E.announce?.(v,g)))}}))}async delete(u,g={}){g.onProgress?.(new CustomProgressEvent("blocks:delete:blockstore:delete",u)),await this.child.delete(u,g)}async*deleteMany(u,g={}){g.onProgress?.(new CustomProgressEvent("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany((async function*(){for await(const v of u)yield v})(),g)}async has(u,g={}){return this.child.has(u,g)}async*getAll(u={}){u.onProgress?.(new CustomProgressEvent("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(u)}}class NetworkedStorage extends Storage{started;constructor(u,g={}){super(u,g),this.started=!1}isStarted(){return this.started}async start(){await start(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await stop(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(u,g){const v=this.components.blockBrokers.map(b=>b.createSession==null?b:b.createSession(g));return new SessionStorage({blockstore:this.child,blockBrokers:v,getHasher:this.getHasher,logger:this.logger},{root:u})}}class SessionStorage extends Storage{closeController;constructor(u,g){super(u),this.closeController=new AbortController,this.closeController.signal,this.log=u.logger.forComponent(`helia:session-storage:${g.root}`)}close(){this.closeController.abort()}async put(u,g,v={}){const b=anySignal([this.closeController.signal,v.signal]);try{return await super.put(u,g,{...v,signal:b})}finally{b.clear()}}async*putMany(u,g={}){const v=anySignal([this.closeController.signal,g.signal]);try{yield*super.putMany(u,{...g,signal:v})}finally{v.clear()}}async*get(u,g={}){const v=anySignal([this.closeController.signal,g.signal]);try{yield*super.get(u,{...g,signal:v})}finally{v.clear()}}async*getMany(u,g={}){const v=anySignal([this.closeController.signal,g.signal]);try{yield*super.getMany(u,{...g,signal:v})}finally{v.clear()}}async delete(u,g={}){const v=anySignal([this.closeController.signal,g.signal]);try{await super.delete(u,{...g,signal:v})}finally{v.clear()}}async*deleteMany(u,g={}){const v=anySignal([this.closeController.signal,g.signal]);try{yield*super.deleteMany(u,{...g,signal:v})}finally{v.clear()}}async has(u,g={}){const v=anySignal([this.closeController.signal,g.signal]);try{return await super.has(u,{...g,signal:v})}finally{v.clear()}}async*getAll(u={}){const g=anySignal([this.closeController.signal,u.signal]);try{yield*super.getAll({...u,signal:g})}finally{g.clear()}}}function isRetrievingBlockBroker(y){return typeof y.retrieve=="function"}const getCidBlockVerifierFunction=(y,u)=>{if(u==null)throw new InvalidParametersError$1(`No hasher configured for multihash code 0x${y.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async g=>{let v;const b=u.digest(g,{truncate:y.multihash.digest.byteLength});if(isPromise$4(b)?v=await b:v=b,!equals(v.digest,y.multihash.digest))throw new InvalidMultihashError("Hash of downloaded block did not match multihash from passed CID")}};async function raceBlockRetrievers(y,u,g,v){const b=getCidBlockVerifierFunction(y,g),w=new AbortController,E=anySignal([w.signal,v.signal]);w.signal;const S=[];for(const A of u)isRetrievingBlockBroker(A)&&S.push(A);if(S.length===0)throw new InvalidConfigurationError(`No block brokers capable of retrieving blocks are configured, the CID ${y} cannot be fetched from the network`);try{return await Promise.any(S.map(async A=>{try{let $=!1;const R=await A.retrieve(y,{...v,signal:E,validateFn:async T=>{await b(T),v.signal?.throwIfAborted(),$=!0}});return $||(await b(R),v.signal?.throwIfAborted()),R}catch($){throw v.log.error("could not retrieve verified block for %c - %e",y,$),$}}))}finally{w.abort(),E.clear()}}class AbstractSession extends TypedEventEmitter{initialPeerSearchComplete;requests;name;log;logger;minProviders;maxProviders;providers;evictionFilter;initialProviders;constructor(u,g){super(),this.name=g.name,this.logger=u.logger,this.log=u.logger.forComponent(this.name),this.requests=new Map,this.minProviders=g.minProviders??DEFAULT_SESSION_MIN_PROVIDERS,this.maxProviders=g.maxProviders??DEFAULT_SESSION_MAX_PROVIDERS,this.providers=[],this.evictionFilter=createScalableCuckooFilter(this.maxProviders),this.initialProviders=g.providers??[]}async retrieve(u,g={}){const v=base64$1.encode(u.multihash.bytes),b=this.requests.get(v);if(b!=null)return this.log("join existing request for %c",u),b;const w=pDefer();if(this.requests.set(v,w.promise),this.providers.length===0){let R=!1;this.initialPeerSearchComplete==null&&(R=!0,this.log=this.logger.forComponent(`${this.name}:${u}`),this.initialPeerSearchComplete=this.findProviders(u,this.minProviders,g));try{await raceSignal$2(this.initialPeerSearchComplete,g.signal),R&&this.log("found initial session peers for %c",u)}catch(T){throw R&&this.log("failed to find initial session peers for %c - %e",u,T),this.requests.delete(v),w.reject(T),T}}let E=!1;const S=new Queue$1({concurrency:this.maxProviders});S.addEventListener("failure",R=>{this.log.error("error querying provider %o, evicting from session",R.detail.job.options.provider,R.detail.error),this.evict(R.detail.job.options.provider)}),S.addEventListener("success",R=>{E=!0,w.resolve(R.detail.result)}),S.addEventListener("idle",()=>{if(E){this.log.trace("session idle, found block");return}if(g.signal?.aborted===!0){this.log.trace("session idle, signal aborted");return}Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",u);for(let R=0;R<this.minProviders&&this.providers.length!==0;R++){const T=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(T)}await this.findProviders(u,this.minProviders,g),this.log("found new providers re-retrieving %c",u),this.requests.delete(v),w.resolve(await this.retrieve(u,g))}).catch(R=>{this.log.error("could not find new providers for %c - %e",u,R),w.reject(R)})});const A=R=>{S.add(async()=>this.queryProvider(u,R.detail,g),{provider:R.detail}).catch(T=>{g.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c - %e",u,T)})};this.addEventListener("provider",A),Promise.all([...this.providers].map(async R=>S.add(async()=>this.queryProvider(u,R,g),{provider:R}))).catch(R=>{g.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c - %e",u,R)});const $=()=>{w.reject(new AbortError$6(g.signal?.reason??"Session aborted")),S.abort()};g.signal?.addEventListener("abort",$);try{return await raceSignal$2(w.promise,g.signal)}finally{this.removeEventListener("provider",A),g.signal?.removeEventListener("abort",$),S.clear(),this.requests.delete(v)}}evict(u){this.evictionFilter.add(this.toEvictionKey(u));const g=this.providers.findIndex(v=>this.equals(v,u));g!==-1&&this.providers.splice(g,1)}isEvicted(u){return this.evictionFilter.has(this.toEvictionKey(u))}hasProvider(u){return!!(this.providers.find(g=>this.equals(g,u))!=null||this.isEvicted(u))}async findProviders(u,g,v){const b=pDefer();let w=0;return Promise.resolve().then(async()=>{if(this.log("finding %d-%d new provider(s) for %c",g,this.maxProviders,u),this.initialProviders.length>0)for(;w<g&&this.initialProviders.length>0;){const E=this.initialProviders.pop();if(E==null)break;const S=await this.convertToProvider(E,v);if(v.signal?.aborted===!0)break;if(S!=null&&!this.hasProvider(S)&&(this.log("found %d/%d new providers",w,this.maxProviders),this.providers.push(S),this.safeDispatchEvent("provider",{detail:S}),w++,w===g&&(this.log("session is ready"),b.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",w);break}}if(w<this.maxProviders)for await(const E of this.findNewProviders(u,v)){if(w===this.maxProviders||v.signal?.aborted===!0)break;if(!this.hasProvider(E)&&(this.log("found %d/%d new providers",w,this.maxProviders),this.providers.push(E),this.safeDispatchEvent("provider",{detail:E}),w++,w===g&&(this.log("session is ready"),b.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",w);break}}if(this.log("found %d/%d new session peers",w,this.maxProviders),w<g)throw new InsufficientProvidersError(`Found ${w} of ${g} ${this.name} providers for ${u}`)}).catch(E=>{this.log.error("error searching routing for potential session peers for %c - %e",u,E),b.reject(E)}),b.promise}}class Helia{libp2p;blockstore;datastore;events;pins;logger;routing;getCodec;getHasher;dns;metrics;log;constructor(u){this.logger=u.logger??defaultLogger(),this.log=this.logger.forComponent("helia"),this.getHasher=getHasher(u.hashers,u.loadHasher),this.getCodec=getCodec(u.codecs,u.loadCodec),this.dns=u.dns??dns(),this.metrics=u.metrics,this.libp2p=u.libp2p,this.events=new TypedEventEmitter;const g={blockstore:u.blockstore,datastore:u.datastore,logger:this.logger,libp2p:this.libp2p,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...u.components??{}};this.routing=g.routing=new Routing(g,{routers:(u.routers??[]).flatMap(b=>{typeof b=="function"&&(b=b(g));const w=[b],E=asContentRouting(b);E!=null&&w.push(E);const S=asPeerRouting(b);return S!=null&&w.push(S),w}),providerLookupConcurrency:u.providerLookupConcurrency});const v=new NetworkedStorage(g,u);this.pins=new PinsImpl(u.datastore,v,this.getCodec),this.blockstore=new BlockStorage(v,this.pins,{holdGcLock:u.holdGcLock??!0}),this.datastore=u.datastore,g.blockBrokers=u.blockBrokers.map(b=>b(g))}async start(){await assertDatastoreVersionIsCurrent(this.datastore),await start(this.blockstore,this.datastore,this.routing,this.libp2p),this.events.dispatchEvent(new CustomEvent("start",{detail:this}))}async stop(){await stop(this.blockstore,this.datastore,this.routing,this.libp2p),this.events.dispatchEvent(new CustomEvent("stop",{detail:this}))}async gc(u={}){const g=await this.blockstore.lock.writeLock();try{const v=this,b=this.blockstore.unwrap();this.log("gc start"),await drain(b.deleteMany((async function*(){for await(const{cid:w}of b.getAll())try{if(await v.pins.isPinned(w,u))continue;yield w,u.onProgress?.(new CustomProgressEvent("helia:gc:deleted",w))}catch(E){v.log.error("error during gc - %e",E),u.onProgress?.(new CustomProgressEvent("helia:gc:error",E))}})()))}finally{g()}this.log("gc finished")}}function asContentRouting(y){return y?.[contentRoutingSymbol]}function asPeerRouting(y){return y?.[peerRoutingSymbol]}function isAsyncIterable$5(y){return y[Symbol.asyncIterator]!=null}function map(y,u){let g=0;if(isAsyncIterable$5(y))return(async function*(){for await(const A of y)yield u(A,g++)})();const v=peekable(y),{value:b,done:w}=v.next();if(w===!0)return(function*(){})();const E=u(b,g++);if(typeof E.then=="function")return(async function*(){yield await E;for(const A of v)yield u(A,g++)})();const S=u;return(function*(){yield E;for(const A of v)yield S(A,g++)})()}function isAsyncIterable$4(y){return y[Symbol.asyncIterator]!=null}function take(y,u){return isAsyncIterable$4(y)?(async function*(){let g=0;if(!(u<1)){for await(const v of y)if(yield v,g++,g===u)return}})():(function*(){let g=0;if(!(u<1)){for(const v of y)if(yield v,g++,g===u)return}})()}const BITSWAP_120="/ipfs/bitswap/1.2.0",DEFAULT_MAX_SIZE_REPLACE_HAS_WITH_BLOCK=1024,DEFAULT_MAX_INBOUND_STREAMS$2=1024,DEFAULT_MAX_OUTBOUND_STREAMS$2=1024,DEFAULT_MESSAGE_RECEIVE_TIMEOUT=5e3,DEFAULT_MESSAGE_SEND_DELAY=10,DEFAULT_MESSAGE_SEND_CONCURRENCY=50,DEFAULT_RUN_ON_TRANSIENT_CONNECTIONS=!1,DEFAULT_MAX_PROVIDERS_PER_REQUEST=3,DEFAULT_MAX_OUTGOING_MESSAGE_SIZE=1024*1024*4,DEFAULT_MAX_INCOMING_MESSAGE_SIZE=DEFAULT_MAX_OUTGOING_MESSAGE_SIZE;var WantType;(function(y){y.WantBlock="WantBlock",y.WantHave="WantHave"})(WantType||(WantType={}));var __WantTypeValues;(function(y){y[y.WantBlock=0]="WantBlock",y[y.WantHave=1]="WantHave"})(__WantTypeValues||(__WantTypeValues={}));(function(y){y.codec=()=>enumeration(__WantTypeValues)})(WantType||(WantType={}));var WantlistEntry;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.cid!=null&&g.cid.byteLength>0&&(v.uint32(10),v.bytes(g.cid)),g.priority!=null&&g.priority!==0&&(v.uint32(16),v.int32(g.priority)),g.cancel!=null&&(v.uint32(24),v.bool(g.cancel)),g.wantType!=null&&(v.uint32(32),WantType.codec().encode(g.wantType,v)),g.sendDontHave!=null&&(v.uint32(40),v.bool(g.sendDontHave)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={cid:alloc$2(0),priority:0},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.cid=g.bytes();break}case 2:{w.priority=g.int32();break}case 3:{w.cancel=g.bool();break}case 4:{w.wantType=WantType.codec().decode(g);break}case 5:{w.sendDontHave=g.bool();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(WantlistEntry||(WantlistEntry={}));var Wantlist;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{if(b.lengthDelimited!==!1&&v.fork(),g.entries!=null)for(const w of g.entries)v.uint32(10),WantlistEntry.codec().encode(w,v);g.full!=null&&(v.uint32(16),v.bool(g.full)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={entries:[]},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{if(b.limits?.entries!=null&&w.entries.length===b.limits.entries)throw new MaxLengthError('Decode error - map field "entries" had too many elements');w.entries.push(WantlistEntry.codec().decode(g,g.uint32(),{limits:b.limits?.entries$}));break}case 2:{w.full=g.bool();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Wantlist||(Wantlist={}));var Block;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.prefix!=null&&g.prefix.byteLength>0&&(v.uint32(10),v.bytes(g.prefix)),g.data!=null&&g.data.byteLength>0&&(v.uint32(18),v.bytes(g.data)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={prefix:alloc$2(0),data:alloc$2(0)},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.prefix=g.bytes();break}case 2:{w.data=g.bytes();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Block||(Block={}));var BlockPresenceType;(function(y){y.HaveBlock="HaveBlock",y.DoNotHaveBlock="DoNotHaveBlock"})(BlockPresenceType||(BlockPresenceType={}));var __BlockPresenceTypeValues;(function(y){y[y.HaveBlock=0]="HaveBlock",y[y.DoNotHaveBlock=1]="DoNotHaveBlock"})(__BlockPresenceTypeValues||(__BlockPresenceTypeValues={}));(function(y){y.codec=()=>enumeration(__BlockPresenceTypeValues)})(BlockPresenceType||(BlockPresenceType={}));var BlockPresence;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.cid!=null&&g.cid.byteLength>0&&(v.uint32(10),v.bytes(g.cid)),g.type!=null&&__BlockPresenceTypeValues[g.type]!==0&&(v.uint32(16),BlockPresenceType.codec().encode(g.type,v)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={cid:alloc$2(0),type:BlockPresenceType.HaveBlock},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.cid=g.bytes();break}case 2:{w.type=BlockPresenceType.codec().decode(g);break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(BlockPresence||(BlockPresence={}));var BitswapMessage;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{if(b.lengthDelimited!==!1&&v.fork(),g.wantlist!=null&&(v.uint32(10),Wantlist.codec().encode(g.wantlist,v)),g.blocks!=null)for(const w of g.blocks)v.uint32(26),Block.codec().encode(w,v);if(g.blockPresences!=null)for(const w of g.blockPresences)v.uint32(34),BlockPresence.codec().encode(w,v);g.pendingBytes!=null&&g.pendingBytes!==0&&(v.uint32(40),v.int32(g.pendingBytes)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={blocks:[],blockPresences:[],pendingBytes:0},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.wantlist=Wantlist.codec().decode(g,g.uint32(),{limits:b.limits?.wantlist});break}case 3:{if(b.limits?.blocks!=null&&w.blocks.length===b.limits.blocks)throw new MaxLengthError('Decode error - map field "blocks" had too many elements');w.blocks.push(Block.codec().decode(g,g.uint32(),{limits:b.limits?.blocks$}));break}case 4:{if(b.limits?.blockPresences!=null&&w.blockPresences.length===b.limits.blockPresences)throw new MaxLengthError('Decode error - map field "blockPresences" had too many elements');w.blockPresences.push(BlockPresence.codec().decode(g,g.uint32(),{limits:b.limits?.blockPresences$}));break}case 5:{w.pendingBytes=g.int32();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(BitswapMessage||(BitswapMessage={}));function mergeMessages(y,u){for(const[g,v]of u.wantlist.entries()){const b=y.wantlist.get(g);b!=null&&(b.priority>v.priority&&(v.priority=b.priority),v.cancel=v.cancel??b.cancel,v.wantType=v.wantType??b.wantType,v.sendDontHave=v.sendDontHave??b.sendDontHave),y.wantlist.set(g,v)}for(const[g,v]of u.blockPresences.entries())y.blockPresences.set(g,v);for(const[g,v]of u.blocks.entries())y.blocks.set(g,v);return u.full&&!y.full&&(y.full=!0),y}class BlockTooLargeError extends Error{static name="BlockTooLargeError";constructor(u="Block too large"){super(u),this.name="BlockTooLargeError"}}const MAX_BLOCK_SIZE=4193648,MAX_ENCODED_BLOCK_SIZE=MAX_BLOCK_SIZE+16;function*splitMessage(y,u){const g=[...y.wantlist.values()],v=[...y.blockPresences.values()],b=[...y.blocks.values()];let w=0,E=0,S=0,A=!1;for(;;){const $={wantlist:{full:y.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0};let R=BitswapMessage.encode($).byteLength,{added:T,hasMore:O,newSize:B}=addToMessage(b,$.blocks,S,u,R,calculateEncodedBlockSize);S+=T,R=B;const F=O;({added:T,hasMore:O,newSize:B}=addToMessage(v,$.blockPresences,E,u,R,calculateEncodedBlockPresenceSize)),E+=T,R=B;const U=O;if({added:T,hasMore:O,newSize:B}=addToMessage(g,$.wantlist.entries,w,u,R,calculateEncodedWantlistEntrySize),w+=T,R=B,A=!F&&!U&&!O,A||($.wantlist.full=!1),yield BitswapMessage.encode($),A)break}}function addToMessage(y,u,g,v,b,w){let E=0,S=!1;for(let A=g;A<y.length;A++){const $=y[A],R=w($);if(R>MAX_ENCODED_BLOCK_SIZE)throw new BlockTooLargeError("Cannot send block as after encoding it is over the max message size");const T=b+R;if(T>v){S=!0;break}u.push($),E++,b=T}return{hasMore:S,added:E,newSize:b}}function calculateEncodedBlockSize(y){return calculateLength(3,Block.encode(y))}function calculateEncodedBlockPresenceSize(y){return calculateLength(4,BlockPresence.encode(y))}function calculateEncodedWantlistEntrySize(y){return calculateLength(1,WantlistEntry.encode(y))}function calculateLength(y,u){const g=encodingLength(y),v=encodingLength(u.byteLength);return g+v+u.byteLength}let Network$1=class extends TypedEventEmitter{log;libp2p;routing;protocols;running;maxInboundStreams;maxOutboundStreams;messageReceiveTimeout;registrarIds;metrics;sendQueue;runOnLimitedConnections;maxOutgoingMessageSize;maxIncomingMessageSize;constructor(u,g={}){super(),this.log=u.logger.forComponent("helia:bitswap:network"),this.libp2p=u.libp2p,this.routing=u.routing,this.protocols=g.protocols??[BITSWAP_120],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=g.maxInboundStreams??DEFAULT_MAX_INBOUND_STREAMS$2,this.maxOutboundStreams=g.maxOutboundStreams??DEFAULT_MAX_OUTBOUND_STREAMS$2,this.messageReceiveTimeout=g.messageReceiveTimeout??DEFAULT_MESSAGE_RECEIVE_TIMEOUT,this.runOnLimitedConnections=g.runOnLimitedConnections??DEFAULT_RUN_ON_TRANSIENT_CONNECTIONS,this.maxIncomingMessageSize=g.maxIncomingMessageSize??DEFAULT_MAX_OUTGOING_MESSAGE_SIZE,this.maxOutgoingMessageSize=g.maxOutgoingMessageSize??g.maxIncomingMessageSize??DEFAULT_MAX_INCOMING_MESSAGE_SIZE,this.metrics={blocksSent:u.metrics?.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:u.metrics?.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new PeerQueue({concurrency:g.messageSendConcurrency??DEFAULT_MESSAGE_SEND_CONCURRENCY,metrics:u.metrics,metricName:"helia_bitswap_message_send_queue"})}async start(){if(this.running)return;this.running=!0,await this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});const u={onConnect:g=>{this.safeDispatchEvent("peer:connected",{detail:g})},onDisconnect:g=>{this.safeDispatchEvent("peer:disconnected",{detail:g})}};this.registrarIds=[];for(const g of this.protocols)this.registrarIds.push(await this.libp2p.register(g,u));this.libp2p.getConnections().forEach(g=>{this.safeDispatchEvent("peer:connected",{detail:g.remotePeer})})}async stop(){if(this.running=!1,await this.libp2p.unhandle(this.protocols),this.registrarIds!=null){for(const u of this.registrarIds)this.libp2p.unregister(u);this.registrarIds=[]}}_onStream(u,g){this.running&&Promise.resolve().then(async()=>{this.log("incoming new bitswap %s stream from %p",u.protocol,g.remotePeer);const v=()=>{u.status==="open"?u.abort(new TimeoutError$2(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",u.status)};let b=AbortSignal.timeout(this.messageReceiveTimeout);b.addEventListener("abort",v),await u.close({signal:b});const w=pushable();u.addEventListener("message",E=>{w.push(E.data)}),u.addEventListener("remoteCloseWrite",()=>{w.end()}),u.addEventListener("close",E=>{E.error!=null&&w.end(E.error)});for await(const E of decode$5(w,{maxDataLength:this.maxIncomingMessageSize}))try{const S=BitswapMessage.decode(E);this.log("incoming new bitswap %s message from %p on stream",u.protocol,g.remotePeer,u.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:g.remotePeer,message:S}}),b.removeEventListener("abort",v),b=AbortSignal.timeout(this.messageReceiveTimeout),b.addEventListener("abort",v)}catch(S){this.log.error("error reading incoming bitswap message from %p on stream - %e",g.remotePeer,u.id,S),u.abort(S);break}}).catch(v=>{this.log.error("error handling incoming stream from %p - %e",g.remotePeer,v),u.abort(v)})}async*findProviders(u,g){g?.onProgress?.(new CustomProgressEvent("bitswap:find-providers",u));for await(const v of this.routing.findProviders(u,g)){if(!await this.libp2p.isDialable(v.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})){this.log("skipping peer %p as they are not dialable - %a[]",v.id,v.multiaddrs);continue}g?.onProgress?.(new CustomProgressEvent("bitswap:found-provider",{type:"bitswap",cid:u,provider:v,routing:v.routing})),yield v}}async findAndConnect(u,g){g?.providers!=null&&await Promise.all(g.providers.map(async v=>this.connectTo(v).catch(b=>{this.log.error("could not connect to supplied provider - %e",b)}))),await drain(map(take(this.findProviders(u,g),g?.maxProviders??DEFAULT_MAX_PROVIDERS_PER_REQUEST),async v=>this.connectTo(v.id,g))).catch(v=>{this.log.error(v)})}async sendMessage(u,g,v){if(!this.running)throw new Error("network isn't running");const b=this.sendQueue.queue.find(w=>u.equals(w.options.peerId)&&w.status==="queued");if(b!=null){b.options.message=mergeMessages(b.options.message,g),await b.join({signal:v?.signal});return}await this.sendQueue.add(async w=>{const E=w?.message;if(E==null)throw new InvalidParametersError$1("No message to send");this.log("sendMessage to %p",u),w?.onProgress?.(new CustomProgressEvent("bitswap:network:send-wantlist",u));const S=await this.libp2p.dialProtocol(u,BITSWAP_120,w);await S.closeRead();try{for(const A of splitMessage(E,this.maxOutgoingMessageSize))S.send(encode$7.single(A))||await S.onDrain(w);await S.close(w)}catch(A){w?.onProgress?.(new CustomProgressEvent("bitswap:network:send-wantlist:error",{peer:u,error:A})),this.log.error("error sending message to %p - %e",u,A),S.abort(A)}this._updateSentStats(E.blocks)},{peerId:u,signal:v?.signal,message:g})}async connectTo(u,g){if(!this.running)throw new NotStartedError("Network isn't running");g?.onProgress?.(new CustomProgressEvent("bitswap:network:dial",u));const[v]=await Promise.all([this.libp2p.dial(u,g),raceEvent(this.libp2p,"peer:identify",g?.signal,{filter:b=>{if(!b.detail.peerId.equals(u))return!1;if(b.detail.protocols.includes(BITSWAP_120))return!0;throw new UnsupportedProtocolError(`${u} did not support ${BITSWAP_120}`)}})]);return v}_updateSentStats(u){let g=0;for(const v of u.values())g+=v.data.byteLength;this.metrics.dataSent?.increment(g),this.metrics.blocksSent?.increment(u.size)}};const inspect=Symbol.for("nodejs.util.inspect.custom"),LIBP2P_KEY_CODE$1=114;class PeerIdImpl{type;multihash;publicKey;string;constructor(u){this.type=u.type,this.multihash=u.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[peerIdSymbol]=!0;toString(){return this.string==null&&(this.string=base58btc.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return CID.createV1(LIBP2P_KEY_CODE$1,this.multihash)}toJSON(){return this.toString()}equals(u){if(u==null)return!1;if(u instanceof Uint8Array)return equals(this.multihash.bytes,u);if(typeof u=="string")return this.toString()===u;if(u?.toMultihash()?.bytes!=null)return equals(this.multihash.bytes,u.toMultihash().bytes);throw new Error("not valid Id")}[inspect](){return`PeerId(${this.toString()})`}}class RSAPeerId extends PeerIdImpl{type="RSA";publicKey;constructor(u){super({...u,type:"RSA"}),this.publicKey=u.publicKey}}class Ed25519PeerId extends PeerIdImpl{type="Ed25519";publicKey;constructor(u){super({...u,type:"Ed25519"}),this.publicKey=u.publicKey}}class Secp256k1PeerId extends PeerIdImpl{type="secp256k1";publicKey;constructor(u){super({...u,type:"secp256k1"}),this.publicKey=u.publicKey}}const TRANSPORT_IPFS_GATEWAY_HTTP_CODE$2=2336;class URLPeerId{type="url";multihash;publicKey;url;constructor(u){this.url=u.toString(),this.multihash=identity.digest(fromString$1(this.url))}[inspect](){return`PeerId(${this.url})`}[peerIdSymbol]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return CID.createV1(TRANSPORT_IPFS_GATEWAY_HTTP_CODE$2,this.toMultihash())}toJSON(){return this.toString()}equals(u){return u==null?!1:(u instanceof Uint8Array&&(u=toString$3(u)),u.toString()===this.toString())}}const LIBP2P_KEY_CODE=114,TRANSPORT_IPFS_GATEWAY_HTTP_CODE$1=2336;function peerIdFromString$1(y,u){let g;if(y.charAt(0)==="1"||y.charAt(0)==="Q")g=decode$8(base58btc.decode(`z${y}`));else{if(y.startsWith("k51qzi5uqu5")||y.startsWith("kzwfwjn5ji4")||y.startsWith("k2k4r8")||y.startsWith("bafz"))return peerIdFromCID(CID.parse(y));throw new InvalidParametersError$1('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return peerIdFromMultihash(g)}function peerIdFromPublicKey(y){if(y.type==="Ed25519")return new Ed25519PeerId({multihash:y.toCID().multihash,publicKey:y});if(y.type==="secp256k1")return new Secp256k1PeerId({multihash:y.toCID().multihash,publicKey:y});if(y.type==="RSA")return new RSAPeerId({multihash:y.toCID().multihash,publicKey:y});throw new UnsupportedKeyTypeError}function peerIdFromPrivateKey(y){return peerIdFromPublicKey(y.publicKey)}function peerIdFromMultihash(y){if(isSha256Multihash(y))return new RSAPeerId({multihash:y});if(isIdentityMultihash(y))try{const u=publicKeyFromMultihash(y);if(u.type==="Ed25519")return new Ed25519PeerId({multihash:y,publicKey:u});if(u.type==="secp256k1")return new Secp256k1PeerId({multihash:y,publicKey:u})}catch{const g=toString$3(y.digest);return new URLPeerId(new URL(g))}throw new InvalidMultihashError("Supplied PeerID Multihash is invalid")}function peerIdFromCID(y){if(y?.multihash==null||y.version==null||y.version===1&&y.code!==LIBP2P_KEY_CODE&&y.code!==TRANSPORT_IPFS_GATEWAY_HTTP_CODE$1)throw new InvalidCIDError("Supplied PeerID CID is invalid");if(y.code===TRANSPORT_IPFS_GATEWAY_HTTP_CODE$1){const u=toString$3(y.multihash.digest);return new URLPeerId(new URL(u))}return peerIdFromMultihash(y.multihash)}function isIdentityMultihash(y){return y.code===identity.code}function isSha256Multihash(y){return y.code===sha256$4.code}function mapIterable(y,u){const g={[Symbol.iterator]:()=>g,next:()=>{const v=y.next(),b=v.value;return v.done===!0||b==null?{done:!0,value:void 0}:{done:!1,value:u(b)}}};return g}function peerIdFromString(y){const u=decode$8(base58btc.decode(`z${y}`));return peerIdFromMultihash(u)}class PeerMap{map;constructor(u){if(this.map=new Map,u!=null)for(const[g,v]of u.entries())this.map.set(g.toString(),{key:g,value:v})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(u){return this.map.delete(u.toString())}entries(){return mapIterable(this.map.entries(),u=>[u[1].key,u[1].value])}forEach(u){this.map.forEach((g,v)=>{u(g.value,g.key,this)})}get(u){return this.map.get(u.toString())?.value}has(u){return this.map.has(u.toString())}set(u,g){this.map.set(u.toString(),{key:u,value:g})}keys(){return mapIterable(this.map.values(),u=>u.key)}values(){return mapIterable(this.map.values(),u=>u.value)}get size(){return this.map.size}}class PeerSet{set;constructor(u){if(this.set=new Set,u!=null)for(const g of u)this.set.add(g.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(u){this.set.add(u.toString())}clear(){this.set.clear()}delete(u){this.set.delete(u.toString())}entries(){return mapIterable(this.set.entries(),u=>{const g=peerIdFromString(u[0]);return[g,g]})}forEach(u){this.set.forEach(g=>{const v=peerIdFromString(g);u(v,v,this)})}has(u){return this.set.has(u.toString())}values(){return mapIterable(this.set.values(),u=>peerIdFromString(u))}intersection(u){const g=new PeerSet;for(const v of u)this.has(v)&&g.add(v);return g}difference(u){const g=new PeerSet;for(const v of this)u.has(v)||g.add(v);return g}union(u){const g=new PeerSet;for(const v of u)g.add(v);for(const v of this)g.add(v);return g}}function peerSet(){return new PeerSet}class PeerFilter{filter;constructor(u,g){this.filter=createScalableCuckooFilter(u,g)}has(u){return this.filter.has(u.toMultihash().bytes)}add(u){this.filter.add(u.toMultihash().bytes)}remove(u){this.filter.remove?.(u.toMultihash().bytes)}}function peerFilter(y,u=.001){return new PeerFilter(y,u)}class TrackedPeerMap extends PeerMap{metric;constructor(u){super();const{name:g,metrics:v}=u;this.metric=v.registerMetric(g),this.updateComponentMetric()}set(u,g){return super.set(u,g),this.updateComponentMetric(),this}delete(u){const g=super.delete(u);return this.updateComponentMetric(),g}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function trackedPeerMap(y){const{name:u,metrics:g}=y;let v;return g!=null?v=new TrackedPeerMap({name:u,metrics:g}):v=new PeerMap,v}class QueuedBitswapMessage{full;pendingBytes;wantlist;blocks;blockPresences;constructor(u=!1,g=0){this.full=u,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(u,g){const v=base64$1.encode(u.multihash.bytes);this.wantlist.set(v,g)}addBlockPresence(u,g){const v=base64$1.encode(u.multihash.bytes);this.blockPresences.set(v,g)}addBlock(u,g){const v=base64$1.encode(u.multihash.bytes);this.blocks.set(v,g)}}function varintEncoder(y){let u=new Uint8Array(y.reduce((v,b)=>v+encodingLength(b),0)),g=0;for(const v of y)u=encode$9(v,u,g),g+=encodingLength(v);return u}function cidToPrefix(y){return varintEncoder([y.version,y.code,y.multihash.code,y.multihash.digest.byteLength])}class Ledger{peerId;blockstore;network;wants;exchangeCount;bytesSent;bytesReceived;lastExchange;maxSizeReplaceHasWithBlock;log;constructor(u,g){this.peerId=u.peerId,this.blockstore=u.blockstore,this.network=u.network,this.wants=new Map,this.log=u.logger.forComponent(`helia:bitswap:ledger:${u.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=g.maxSizeReplaceHasWithBlock??DEFAULT_MAX_SIZE_REPLACE_HAS_WITH_BLOCK}sentBytes(u){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=u}receivedBytes(u){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=u}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}async sendBlocksToPeer(u){const g=new QueuedBitswapMessage,v=new Set;for(const[b,w]of this.wants.entries())try{const E=await toBuffer(this.blockstore.get(w.cid,u));w.wantType===WantType.WantHave?E.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",w.cid),v.add(b),g.addBlock(w.cid,{data:E,prefix:cidToPrefix(w.cid)})):(this.log("sending have for %c",w.cid),g.addBlockPresence(w.cid,{cid:w.cid.bytes,type:BlockPresenceType.HaveBlock})):(this.log("sending block for %c",w.cid),v.add(b),g.addBlock(w.cid,{data:E,prefix:cidToPrefix(w.cid)}))}catch(E){if(E.name!=="NotFoundError")throw E;if(this.log("do not have block for %c",w.cid),!w.sendDontHave||w.sentDoNotHave===!0)continue;w.sentDoNotHave=!0,g.addBlockPresence(w.cid,{cid:w.cid.bytes,type:BlockPresenceType.DoNotHaveBlock})}if(g.blocks.size>0||g.blockPresences.size>0){this.log("sending message"),await this.network.sendMessage(this.peerId,g,u),this.log("sent message"),this.sentBytes([...g.blocks.values()].reduce((b,w)=>b+w.data.byteLength,0));for(const b of v)this.wants.delete(b)}}}class PeerWantLists{blockstore;network;ledgerMap;maxSizeReplaceHasWithBlock;log;logger;constructor(u,g={}){this.blockstore=u.blockstore,this.network=u.network,this.maxSizeReplaceHasWithBlock=g.maxSizeReplaceHasWithBlock,this.log=u.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=u.logger,this.ledgerMap=trackedPeerMap({name:"helia_bitswap_ledger_map",metrics:u.metrics}),this.network.addEventListener("bitswap:message",v=>{this.receiveMessage(v.detail.peer,v.detail.message).catch(b=>{this.log.error("error receiving bitswap message from %p - %e",v.detail.peer,b)})}),this.network.addEventListener("peer:disconnected",v=>{this.peerDisconnected(v.detail)})}ledgerForPeer(u){const g=this.ledgerMap.get(u);if(g!=null)return{peer:g.peerId,value:g.debtRatio(),sent:g.bytesSent,received:g.bytesReceived,exchanged:g.exchangeCount}}wantListForPeer(u){const g=this.ledgerMap.get(u);if(g!=null)return[...g.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(u=>u.peerId)}async receiveMessage(u,g){let v=this.ledgerMap.get(u);if(v==null&&(v=new Ledger({peerId:u,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(u,v)),v.receivedBytes(g.blocks?.reduce((b,w)=>b+w.data.byteLength,0)??0),g.wantlist!=null){g.wantlist.full===!0&&v.wants.clear();for(const b of g.wantlist.entries){const w=CID.decode(b.cid),E=toString$3(w.multihash.bytes,"base64");b.cancel===!0?(this.log("peer %p cancelled want of block for %c",u,w),v.wants.delete(E)):(b.wantType===WantType.WantHave?this.log("peer %p wanted block presence for %c",u,w):this.log("peer %p wanted block for %c",u,w),v.wants.set(E,{cid:w,priority:b.priority,wantType:b.wantType??WantType.WantBlock,sendDontHave:b.sendDontHave??!1}))}}this.log("send blocks to peer"),await v.sendBlocksToPeer()}async receivedBlock(u,g){const v=toString$3(u.multihash.bytes,"base64"),b=[];for(const w of this.ledgerMap.values())w.wants.has(v)&&b.push(w);await Promise.all(b.map(async w=>w.sendBlocksToPeer(g)))}peerDisconnected(u){this.ledgerMap.delete(u)}}class BitswapSession extends AbstractSession{wantList;network;libp2p;constructor(u,g){super(u,{...g,name:"helia:bitswap:session"}),this.wantList=u.wantList,this.network=u.network,this.libp2p=u.libp2p}async queryProvider(u,g,v){this.log("sending WANT-BLOCK for %c to %p",u,g);const b=await this.wantList.wantSessionBlock(u,g,v);if(this.log("%p %s %c",g,b.has?"has":"does not have",u),b.has&&b.block!=null)return b.block;throw new Error("Provider did not have block")}async*findNewProviders(u,g={}){for await(const v of this.network.findProviders(u,g))yield v.id}toEvictionKey(u){return u.toMultihash().bytes}equals(u,g){return u.equals(g)}async convertToProvider(u,g){return isPeerId(u)?u:(await this.libp2p.dial(u,g)).remotePeer}}function createBitswapSession(y,u){return new BitswapSession(y,u)}class Stats{blocksReceived;duplicateBlocksReceived;dataReceived;duplicateDataReceived;constructor(u){this.blocksReceived=u.metrics?.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=u.metrics?.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=u.metrics?.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=u.metrics?.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(u=1,g){const v={global:u};g!=null&&(v[g.toString()]=u),this.blocksReceived?.increment(v)}updateDuplicateBlocksReceived(u=1,g){const v={global:u};g!=null&&(v[g.toString()]=u),this.duplicateBlocksReceived?.increment(v)}updateDataReceived(u,g){const v={global:u};g!=null&&(v[g.toString()]=u),this.dataReceived?.increment(v)}updateDuplicateDataReceived(u,g){const v={global:u};g!=null&&(v[g.toString()]=u),this.duplicateDataReceived?.increment(v)}}function varintDecoder(y){if(!(y instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const u=[];for(;y.length>0;){const g=decode$7(y);u.push(g),y=y.slice(encodingLength(g))}return u}class WantList extends TypedEventEmitter{peers;wants;network;log;sendMessagesDelay;sendMessagesTimeout;hashLoader;sendingMessages;constructor(u,g={}){super(),this.peers=trackedPeerMap({name:"helia_bitswap_peers",metrics:u.metrics}),this.wants=trackedMap({name:"helia_bitswap_wantlist",metrics:u.metrics}),this.network=u.network,this.sendMessagesDelay=g.sendMessagesDelay??DEFAULT_MESSAGE_SEND_DELAY,this.log=u.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=g.hashLoader,this.network.addEventListener("bitswap:message",v=>{this.receiveMessage(v.detail.peer,v.detail.message).catch(b=>{this.log.error("error receiving bitswap message from %p - %e",v.detail.peer,b)})}),this.network.addEventListener("peer:connected",v=>{this.peerConnected(v.detail).catch(b=>{this.log.error("error processing newly connected bitswap peer %p - %e",v.detail,b)})}),this.network.addEventListener("peer:disconnected",v=>{this.peerDisconnected(v.detail)})}async addEntry(u,g){const v=toString$3(u.multihash.bytes,"base64");let b=this.wants.get(v);b==null&&(b={cid:u,priority:g.priority??1,wantType:g.wantType??WantType.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(v,b)),b.wantType===WantType.WantHave&&g.wantType===WantType.WantBlock&&(b.wantType=WantType.WantBlock),await this.sendMessagesDebounced();try{return g.wantType===WantType.WantBlock?(await raceEvent(this,"block",g?.signal,{filter:S=>equals(u.multihash.digest,S.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail:(await raceEvent(this,"presence",g?.signal,{filter:E=>equals(u.multihash.digest,E.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{g.signal?.aborted===!0&&(this.log("want for %c was aborted, cancelling want",u),b.cancel=!0,await this.sendMessagesDebounced())}}async sendMessagesDebounced(){await this.sendingMessages?.promise,clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(u=>{this.log("error sending messages to peers - %e",u)})},this.sendMessagesDelay)}async sendMessages(){this.sendingMessages=pDefer(),await Promise.all([...this.peers.entries()].map(async([u,g])=>{const v=new Set,b=new QueuedBitswapMessage;for(const[w,E]of this.wants.entries())g.has(w)||E.cancel||(v.add(w),b.addWantlistEntry(E.cid,{cid:E.cid.bytes,priority:E.priority,wantType:E.wantType,cancel:E.cancel,sendDontHave:E.sendDontHave}));if(b.wantlist.size!==0)try{await this.network.sendMessage(u,b);for(const w of v)g.add(w)}catch(w){this.log.error("error sending full wantlist to new peer - %e",w)}})).catch(u=>{this.log.error("error sending messages - %e",u)});for(const[u,g]of this.wants)if(g.cancel){this.wants.delete(u);for(const v of this.peers.values())v.delete(u)}this.sendingMessages.resolve()}has(u){const g=toString$3(u.multihash.bytes,"base64");return this.wants.has(g)}async wantSessionPresence(u,g,v={}){const b=new QueuedBitswapMessage;return b.addWantlistEntry(u,{cid:u.bytes,sendDontHave:!0,wantType:WantType.WantHave,priority:1}),await this.network.sendMessage(g,b),(await raceEvent(this,"presence",v.signal,{filter:E=>g.equals(E.detail.sender)&&equals(u.multihash.digest,E.detail.cid.multihash.digest)})).detail}async wantBlock(u,g={}){return this.addEntry(u,{...g,wantType:WantType.WantBlock})}async wantSessionBlock(u,g,v={}){const b=new QueuedBitswapMessage;return b.addWantlistEntry(u,{cid:u.bytes,sendDontHave:!0,wantType:WantType.WantBlock,priority:1}),await this.network.sendMessage(g,b),(await raceEvent(this,"presence",v.signal,{filter:E=>g.equals(E.detail.sender)&&equals(u.multihash.digest,E.detail.cid.multihash.digest)})).detail}async receivedBlock(u,g){const v=toString$3(u.multihash.bytes,"base64"),b=this.wants.get(v);b!=null&&(b.cancel=!0,await this.sendMessagesDebounced())}async receiveMessage(u,g){this.log("received message from %p with %d blocks",u,g.blocks.length);let v=!1;for(const b of g.blocks){if(b.prefix==null||b.data==null)continue;const w=varintDecoder(b.prefix),E=w[0],S=w[1],A=w[2],$=w[3],R=A===sha256$4.code?sha256$4:await this.hashLoader?.getHasher(A);if(R==null){this.log.error("unknown hash algorithm",A);continue}let T=R.digest(b.data,{truncate:$});T.then!=null&&(T=await T);const O=CID.create(E===0?0:1,S,T);this.log("received block from %p for %c",u,O),this.safeDispatchEvent("block",{detail:{sender:u,cid:O,block:b.data}}),this.safeDispatchEvent("presence",{detail:{sender:u,cid:O,has:!0,block:b.data}});const B=toString$3(O.multihash.bytes,"base64"),F=this.wants.get(B);F!=null&&(F.cancel=!0,v=!0)}for(const{cid:b,type:w}of g.blockPresences){const E=CID.decode(b);this.log("received %s from %p for %c",w,u,E),this.safeDispatchEvent("presence",{detail:{sender:u,cid:E,has:w===BlockPresenceType.HaveBlock}})}v&&await this.sendMessagesDebounced()}async peerConnected(u){const g=new Set,v=new QueuedBitswapMessage(!0);for(const[b,w]of this.wants.entries())w.cancel||(g.add(b),v.addWantlistEntry(w.cid,{cid:w.cid.bytes,priority:1,wantType:WantType.WantBlock,cancel:!1,sendDontHave:!1}));if(v.wantlist.size===0){this.peers.set(u,g);return}try{await this.network.sendMessage(u,v),this.peers.set(u,g)}catch(b){this.log.error("error sending full wantlist to new peer %p - %e",u,b)}}peerDisconnected(u){this.peers.delete(u)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}}class Bitswap{log;logger;stats;network;blockstore;peerWantLists;wantList;libp2p;constructor(u,g={}){this.logger=u.logger,this.log=u.logger.forComponent("helia:bitswap"),this.blockstore=u.blockstore,this.libp2p=u.libp2p,this.stats=new Stats(u),this.network=new Network$1(u,g),this.peerWantLists=new PeerWantLists({...u,network:this.network},g),this.wantList=new WantList({...u,network:this.network},g)}createSession(u={}){return createBitswapSession({wantList:this.wantList,network:this.network,logger:this.logger,libp2p:this.libp2p},u)}async want(u,g={}){const v=new AbortController,b=anySignal([v.signal,g.signal]);v.signal,this.network.findAndConnect(u,{...g,signal:b}).catch(w=>{v.signal.aborted||this.log.error("error during finding and connect for cid %c - %e",u,w)});try{const w=await this.wantList.wantBlock(u,{...g,signal:b});return g.onProgress?.(new CustomProgressEvent("bitswap:block",{cid:u,sender:w.sender})),w.block}finally{v.abort(),b.clear()}}async notify(u,g={}){await Promise.all([this.peerWantLists.receivedBlock(u,g),this.wantList.receivedBlock(u,g)])}getWantlist(){return[...this.wantList.wants.values()].filter(u=>!u.cancel).map(u=>({cid:u.cid,priority:u.priority,wantType:u.wantType}))}getPeerWantlist(u){return this.peerWantLists.wantListForPeer(u)}async start(){this.wantList.start(),await this.network.start()}async stop(){this.wantList.stop(),await this.network.stop()}}const createBitswap=(y,u={})=>new Bitswap(y,u);class BitswapBlockBroker{bitswap;started;constructor(u,g={}){const{getHasher:v}=u;this.bitswap=createBitswap(u,{hashLoader:{getHasher:async b=>v(b)},...g}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}async announce(u,g){await this.bitswap.notify(u,g)}async retrieve(u,g={}){return this.bitswap.want(u,g)}createSession(u){const g=this.bitswap.createSession(u);return{announce:async(v,b)=>{await this.bitswap.notify(v,b)},retrieve:async(v,b)=>g.retrieve(v,b)}}}function bitswap(y={}){return u=>new BitswapBlockBroker(u,y)}const ASSUME_HTTP_CODES=[CODE_TCP,CODE_DNS,CODE_DNSADDR,CODE_DNS4,CODE_DNS6];function extractSNI(y){return extractTuple("sni",y)?.value}function extractPort(y){const u=extractTuple("tcp",y)?.value;return u==null?"":`:${u}`}function extractTuple(y,u){return u.find(g=>g.name===y)}function hasTLS(y){return y.some(({code:u})=>u===CODE_TLS)}function interpretNext(y,u){const g=interpreters[y.name];if(g==null)throw new Error(`Can't interpret protocol ${y.name}`);const v=g(y,u);return y.code===CODE_IP6?`[${v}]`:v}const interpreters={ip4:(y,u)=>y.value,ip6:(y,u)=>u.length===0?y.value:`[${y.value}]`,tcp:(y,u)=>{const g=u.pop();if(g==null)throw new Error("Unexpected end of multiaddr");return`tcp://${interpretNext(g,u)}:${y.value}`},udp:(y,u)=>{const g=u.pop();if(g==null)throw new Error("Unexpected end of multiaddr");return`udp://${interpretNext(g,u)}:${y.value}`},dnsaddr:(y,u)=>y.value,dns4:(y,u)=>y.value,dns6:(y,u)=>y.value,dns:(y,u)=>y.value,ipfs:(y,u)=>{const g=u.pop();if(g==null)throw new Error("Unexpected end of multiaddr");return`${interpretNext(g,u)}`},p2p:(y,u)=>{const g=u.pop();if(g==null)throw new Error("Unexpected end of multiaddr");return`${interpretNext(g,u)}`},http:(y,u)=>{const g=hasTLS(u),v=extractSNI(u),b=extractPort(u);if(g&&v!=null)return`https://${v}${b}`;const w=g?"https://":"http://",E=u.pop();if(E==null)throw new Error("Unexpected end of multiaddr");let S=interpretNext(E,u);return S=S?.replace("tcp://",""),`${w}${S}`},"http-path":(y,u)=>{const g=u.pop();if(g==null)throw new Error("Unexpected end of multiaddr");const v=interpretNext(g,u),b=decodeURIComponent(y.value??"");return`${v}${b}`},tls:(y,u)=>{const g=u.pop();if(g==null)throw new Error("Unexpected end of multiaddr");return interpretNext(g,u)},sni:(y,u)=>{const g=u.pop();if(g==null)throw new Error("Unexpected end of multiaddr");return interpretNext(g,u)},https:(y,u)=>{const g=u.pop();if(g==null)throw new Error("Unexpected end of multiaddr");let v=interpretNext(g,u);return v=v?.replace("tcp://",""),`https://${v}`},ws:(y,u)=>{const g=hasTLS(u),v=extractSNI(u),b=extractPort(u);if(g&&v!=null)return`wss://${v}${b}`;const w=g?"wss://":"ws://",E=u.pop();if(E==null)throw new Error("Unexpected end of multiaddr");let S=interpretNext(E,u);return S=S?.replace("tcp://",""),`${w}${S}`},wss:(y,u)=>{const g=u.pop();if(g==null)throw new Error("Unexpected end of multiaddr");let v=interpretNext(g,u);return v=v?.replace("tcp://",""),`wss://${v}`}};function multiaddrToUri(y,u){const v=multiaddr(y).getComponents(),b=v.pop();if(b==null)throw new Error("Unexpected end of multiaddr");const w=interpreters[b.name];if(w==null)throw new Error(`No interpreter found for ${b.name}`);let E=w(b,v)??"";return ASSUME_HTTP_CODES.includes(b.code)&&(E=E.replace(/^.*:\/\//,""),b.value==="443"?E=`https://${E}`:E=`http://${E}`),(E.startsWith("http://")||E.startsWith("https://")||E.startsWith("ws://")||E.startsWith("wss://"))&&(E=new URL(E).toString(),E.endsWith("/")&&(E=E.substring(0,E.length-1))),E}const code=y=>({match:u=>{const g=u[0];return g==null||g.code!==y||g.value!=null?!1:u.slice(1)}}),value=(y,u)=>({match:g=>{const v=g[0];return v?.code!==y||v.value==null||u!=null&&v.value!==u?!1:g.slice(1)}}),not=y=>({match:u=>y.match(u)===!1?u:!1}),optional$1=y=>({match:u=>{const g=y.match(u);return g===!1?u:g}}),or=(...y)=>({match:u=>{let g;for(const v of y){const b=v.match(u);b!==!1&&(g==null||b.length<g.length)&&(g=b)}return g??!1}}),and=(...y)=>({match:u=>{for(const g of y){const v=g.match(u);if(v===!1)return!1;u=v}return u}});function fmt(...y){function u(b){if(b==null)return!1;let w=b.getComponents();for(const E of y){const S=E.match(w);if(S===!1)return!1;w=S}return w}function g(b){return u(b)!==!1}function v(b){const w=u(b);return w===!1?!1:w.length===0}return{matchers:y,matches:g,exactMatch:v}}const _PEER_ID=value(CODE_P2P),PEER_ID=fmt(_PEER_ID),_DNS4=value(CODE_DNS4),_DNS6=value(CODE_DNS6),_DNSADDR=value(CODE_DNSADDR),_DNS=value(CODE_DNS);fmt(_DNS4,optional$1(value(CODE_P2P)));fmt(_DNS6,optional$1(value(CODE_P2P)));fmt(_DNSADDR,optional$1(value(CODE_P2P)));const DNS$1=fmt(or(_DNS,_DNSADDR,_DNS4,_DNS6),optional$1(value(CODE_P2P))),_IP4=and(value(CODE_IP4),optional$1(value(CODE_IPCIDR))),_IP6=and(optional$1(value(CODE_IP6ZONE)),value(CODE_IP6),optional$1(value(CODE_IPCIDR))),_IP=or(_IP4,_IP6),_IP_OR_DOMAIN=or(_IP,_DNS,_DNS4,_DNS6,_DNSADDR),IP_OR_DOMAIN=fmt(or(_IP,and(or(_DNS,_DNSADDR,_DNS4,_DNS6),optional$1(value(CODE_P2P))))),IP4=fmt(_IP4),IP6=fmt(_IP6),IP$1=fmt(_IP),_TCP=and(_IP_OR_DOMAIN,value(CODE_TCP)),_UDP=and(_IP_OR_DOMAIN,value(CODE_UDP)),TCP=fmt(and(_TCP,optional$1(value(CODE_P2P))));fmt(_UDP);const _QUIC=and(_UDP,code(CODE_QUIC),optional$1(value(CODE_P2P))),_QUIC_V1=and(_UDP,code(CODE_QUIC_V1),optional$1(value(CODE_P2P))),QUIC_V0_OR_V1=or(_QUIC,_QUIC_V1);fmt(_QUIC);const QUIC_V1=fmt(_QUIC_V1),_WEB=or(_IP_OR_DOMAIN,_TCP,_UDP,_QUIC,_QUIC_V1),_WebSockets=or(and(_WEB,code(CODE_WS),optional$1(value(CODE_P2P)))),WebSockets$1=fmt(_WebSockets),_WebSocketsSecure=or(and(_WEB,code(CODE_WSS),optional$1(value(CODE_P2P))),and(_WEB,code(CODE_TLS),optional$1(value(CODE_SNI)),code(CODE_WS),optional$1(value(CODE_P2P)))),WebSocketsSecure=fmt(_WebSocketsSecure),_WebRTCDirect=and(_UDP,code(CODE_WEBRTC_DIRECT),optional$1(value(CODE_CERTHASH)),optional$1(value(CODE_CERTHASH)),optional$1(value(CODE_P2P))),WebRTCDirect=fmt(_WebRTCDirect),_WebTransport=and(_QUIC_V1,code(CODE_WEBTRANSPORT),optional$1(value(CODE_CERTHASH)),optional$1(value(CODE_CERTHASH)),optional$1(value(CODE_P2P))),WebTransport=fmt(_WebTransport),_P2P=or(_WebSockets,_WebSocketsSecure,and(_TCP,optional$1(value(CODE_P2P))),and(QUIC_V0_OR_V1,optional$1(value(CODE_P2P))),and(_IP_OR_DOMAIN,optional$1(value(CODE_P2P))),_WebRTCDirect,_WebTransport,value(CODE_P2P)),P2P=fmt(_P2P),_Circuit=and(optional$1(_P2P),code(CODE_P2P_CIRCUIT),not(code(CODE_WEBRTC)),optional$1(value(CODE_P2P))),Circuit$1=fmt(_Circuit),_WebRTC=or(and(_P2P,code(CODE_P2P_CIRCUIT),code(CODE_WEBRTC),optional$1(value(CODE_P2P))),and(_P2P,code(CODE_WEBRTC),optional$1(value(CODE_P2P))),and(code(CODE_WEBRTC),optional$1(value(CODE_P2P)))),WebRTC=fmt(_WebRTC),_HTTP=or(and(_IP_OR_DOMAIN,value(CODE_TCP),code(CODE_HTTP),optional$1(value(CODE_P2P))),and(_IP_OR_DOMAIN,code(CODE_HTTP),optional$1(value(CODE_P2P)))),HTTP$1=fmt(_HTTP),_HTTPS=and(_IP_OR_DOMAIN,or(and(value(CODE_TCP,"443"),code(CODE_HTTP)),and(value(CODE_TCP),code(CODE_HTTPS)),and(value(CODE_TCP),code(CODE_TLS),code(CODE_HTTP)),and(code(CODE_TLS),code(CODE_HTTP)),code(CODE_TLS),code(CODE_HTTPS)),optional$1(value(CODE_P2P))),HTTPS=fmt(_HTTPS),_Memory=or(and(value(CODE_MEMORY),optional$1(value(CODE_P2P))));fmt(_Memory);const _Unix=or(and(value(CODE_UNIX),optional$1(value(CODE_P2P))));fmt(_Unix);function filterNonHTTPMultiaddrs(y,u,g){return y.filter(v=>{if(HTTPS.matches(v)||u&&HTTP$1.matches(v))return g||DNS$1.matches(v)?!0:isPrivate(v)===!1;if(!u&&g){const{host:b}=getNetConfig(v);if(b==="127.0.0.1"||b==="localhost"||b.endsWith(".localhost"))return!0}return!1})}async function*findHttpGatewayProviders(y,u,g,v,b,w={}){for await(const E of u.findProviders(y,w)){const S=filterNonHTTPMultiaddrs(E.multiaddrs,v,b);if(S.length===0)continue;const A=multiaddrToUri(S[0]),$={type:"trustless-gateway",cid:y,url:A.toString(),routing:E.routing};w?.onProgress?.(new CustomProgressEvent("trustless-gateway:found-provider",$)),yield new TrustlessGateway(A,{logger:g,transformRequestInit:w.transformRequestInit})}}async function limitedResponse(y,u,g){const{signal:v,log:b}=g??{},w=y.headers.get("content-length");if(w!=null){const A=parseInt(w,10);if(A>u)throw b?.error("content-length header (%d) is greater than the limit (%d)",A,u),y.body!=null&&await y.body.cancel().catch($=>{b?.error("error cancelling response body after content-length check - %e",$)}),new Error(`Content-Length header (${A}) is greater than the limit (${u}).`)}const E=y.body?.getReader();if(E==null)throw new Error("Response body is not readable");const S=new Uint8ArrayList;try{for(;;){if(v?.aborted===!0)throw new Error("Response body read was aborted.");const{done:A,value:$}=await E.read();if(A)break;if(S.append($),S.byteLength>u)throw new Error(`Response body is greater than the limit (${u}), received ${S.byteLength} bytes.`)}}finally{E.cancel().catch(A=>{b?.error("error cancelling reader - %e",A)}).finally(()=>{E.releaseLock()})}return S.subarray()}class TrustlessGateway{url;#e=0;#t=0;#r=0;#i=0;#n=new Map;log;transformRequestInit;constructor(u,{logger:g,transformRequestInit:v}){this.url=u instanceof URL?u:new URL(u),this.transformRequestInit=v,this.log=g.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}#o(u){const g=u.multihash.bytes;return base64$1.encode(g)}async getRawBlock(u,{signal:g,maxSize:v=DEFAULT_MAX_SIZE}={}){const b=new URL(this.url.toString());if(b.pathname=`/ipfs/${u.toString()}`,b.search="?format=raw",g?.aborted===!0)throw new Error(`Signal to fetch raw block for CID ${u} from gateway ${this.url} was aborted prior to fetch`);const w=this.#o(u),E=new AbortController,S=()=>{E.abort()};g?.addEventListener("abort",S);try{let A=this.#n.get(w);if(A==null){this.#e++;const $={signal:E.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},R=this.transformRequestInit!=null?await this.transformRequestInit($):$;A=fetch(b.toString(),R).then(async T=>{if(this.log("GET %s %d",b,T.status),!T.ok)throw this.#t++,new Error(`unable to fetch raw block for CID ${u} from gateway ${this.url}`);const O=await limitedResponse(T,v,{signal:E.signal,log:this.log});return this.#i++,O}),this.#n.set(w,A)}return await A}catch{throw g?.aborted===!0?new Error(`fetching raw block for CID ${u} from gateway ${this.url} was aborted`):(this.#t++,new Error(`unable to fetch raw block for CID ${u}`))}finally{g?.removeEventListener("abort",S),this.#n.delete(w)}}reliability(){return this.#e===0?1:this.#r>0?-1/0:this.#i/(this.#e+this.#t*3)}incrementInvalidBlocks(){this.#r++}getStats(){return{attempts:this.#e,errors:this.#t,invalidBlocks:this.#r,successes:this.#i,pendingResponses:this.#n.size}}}class TrustlessGatewaySession extends AbstractSession{routing;allowInsecure;allowLocal;transformRequestInit;constructor(u,g){super(u,{...g,name:"helia:trustless-gateway:session"}),this.routing=u.routing,this.allowInsecure=g.allowInsecure??DEFAULT_ALLOW_INSECURE,this.allowLocal=g.allowLocal??DEFAULT_ALLOW_LOCAL,this.transformRequestInit=g.transformRequestInit}async queryProvider(u,g,v){this.log("fetching BLOCK for %c from %s",u,g.url);const b=await g.getRawBlock(u,v);return this.log.trace("got block for %c from %s",u,g.url),await v.validateFn?.(b),b}async*findNewProviders(u,g={}){yield*findHttpGatewayProviders(u,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...g,transformRequestInit:this.transformRequestInit})}toEvictionKey(u){return u.url.toString()}equals(u,g){return u.url.toString()===g.url.toString()}async convertToProvider(u,g){if(isPeerId(u))return;const v=filterNonHTTPMultiaddrs(Array.isArray(u)?u:[u],this.allowInsecure,this.allowLocal);if(v.length===0)return;const b=multiaddrToUri(v[0]);return new TrustlessGateway(b,{logger:this.logger,transformRequestInit:this.transformRequestInit})}}function createTrustlessGatewaySession(y,u){return new TrustlessGatewaySession(y,u)}class TrustlessGatewayBlockBroker{allowInsecure;allowLocal;transformRequestInit;routing;log;logger;constructor(u,g={}){this.log=u.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=u.logger,this.routing=u.routing,this.allowInsecure=g.allowInsecure??DEFAULT_ALLOW_INSECURE,this.allowLocal=g.allowLocal??DEFAULT_ALLOW_LOCAL,this.transformRequestInit=g.transformRequestInit}async retrieve(u,g={}){const v=[];for await(const b of findHttpGatewayProviders(u,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...g,transformRequestInit:this.transformRequestInit})){this.log("getting block for %c from %s",u,b.url);try{const w=await b.getRawBlock(u,g);this.log.trace("got block for %c from %s",u,b.url);try{await g.validateFn?.(w)}catch(E){this.log.error("failed to validate block for %c from %s - %e",u,b.url,E);continue}return w}catch(w){if(this.log.error("failed to get block for %c from %s - %e",u,b.url,w),w instanceof Error?v.push(w):v.push(new Error(`Unable to fetch raw block for CID ${u} from gateway ${b.url}`)),g.signal?.aborted===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",u,b.url);break}}}throw v.length>0?new AggregateError(v,`Unable to fetch raw block for CID ${u} from any gateway`):new Error(`Unable to fetch raw block for CID ${u} from any gateway`)}createSession(u={}){return createTrustlessGatewaySession({logger:this.logger,routing:this.routing},{...u,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit})}}const DEFAULT_ALLOW_INSECURE=!1,DEFAULT_ALLOW_LOCAL=!1,DEFAULT_MAX_SIZE=2097152;function trustlessGateway(y={}){return u=>new TrustlessGatewayBlockBroker(u,y)}async function*browserReadableStreamToIt(y,u={}){const g=y.getReader();try{for(;;){const v=await g.read();if(v.done)return;yield v.value}}finally{u.preventCancel!==!0&&await g.cancel(),g.releaseLock()}}var timestamp_min={exports:{}},hasRequiredTimestamp_min;function requireTimestamp_min(){return hasRequiredTimestamp_min||(hasRequiredTimestamp_min=1,(function(y){(function(){y.exports=q;var u=86400,g=3200,v=146097*g/400,b=u*v,w=1e3*b,E=864e13,S=4294967296,A=1e6,$="000000000",R=Math.trunc||function(pe){var ve=pe-pe%1;return ve==0&&(pe<0||pe===0&&1/pe!=1/0)?-0:ve},T=q.prototype,O=(q.fromDate=function(pe){return new q(+pe)},q.fromInt64BE=de(0,1,2,3,0,4),q.fromInt64LE=de(3,2,1,0,4,0),q.fromString=function(ae){var ve,he=new q,ae=(ae+="").replace(/^\s*[+\-]?\d+/,function(j){var j=+j,z=1970+(j-1970)%400;return he.year=j-z,z}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(Q,j,z){return j<0&&(z*=-1),ve=6e4*(60*+j+ +z),""}).replace(/\.\d+$/,function(Q){return he.nano=+(Q+$).substr(1,9),""}).split(/\D+/);if(1<ae.length?ae[1]--:ae[1]=0,he.time=ve=Date.UTC.apply(Date,ae)-(ve||0),isNaN(ve))throw new TypeError("Invalid Date");return J(he)},q.fromTimeT=function(pe){return oe(pe,0)},T.year=0,T.time=0,T.nano=0,T.addNano=function(pe){return this.nano+=+pe||0,this},T.getNano=function(){var pe=J(this);return(pe.time%1e3*A+ +pe.nano+1e9)%1e9},T.getTimeT=function(){var ve=J(this),pe=Math.floor(ve.time/1e3),ve=ve.year;return ve&&(pe+=ve*v*u/g),pe},T.getYear=function(){return this.toDate().getUTCFullYear()+this.year},T.toDate=function(){return ie(J(this).time)},T.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},T.toString=function(pe){var ve=this,he=ve.toDate(),ae={H:function(){return ye(he.getUTCHours())},L:function(){return we(he.getUTCMilliseconds(),3)},M:function(){return ye(he.getUTCMinutes())},N:function(){return we(ve.getNano(),9)},S:function(){return ye(he.getUTCSeconds())},Y:function(){var Q=ve.getYear();return 999999<Q?"+"+Q:9999<Q?"+"+we(Q,6):0<=Q?we(Q,4):-999999<=Q?"-"+we(-Q,6):Q},a:function(){return F[he.getUTCDay()]},b:function(){return B[he.getUTCMonth()]},d:function(){return ye(he.getUTCDate())},e:function(){return(function(Q){return(9<Q?"":" ")+(0|Q)})(he.getUTCDate())},m:function(){return ye(he.getUTCMonth()+1)}};return(function Q(j){return j.replace(/%./g,function(z){var Y=z[1],re=U[Y],Y=ae[Y];return re?Q(re):Y?Y():z})})(pe||O)},T.writeInt64BE=le(0,1,2,3,0,4),T.writeInt64LE=le(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),B=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],F=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],U={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return q;function q(pe,ve,he){var ae=this;if(!(ae instanceof q))return new q(pe,ve,he);ae.time=+pe||0,ae.nano=+ve||0,ae.year=+he||0,J(ae)}function J(pe){var ve,he,ae,Q=pe.year,j=pe.time,z=pe.nano,re=((z<0||A<=z)&&(z-=(he=Math.floor(z/A))*A,j+=he,he=1),Q%g);return(j<-E||E<j||re)&&((ve=R(j/w))&&(Q+=ve*g,j-=ve*w),(ae=ie(j)).setUTCFullYear(re+ae.getUTCFullYear()),ae=(j=+ae)+(ve=R((Q-=re)/g))*w,ve&&-E<=ae&&ae<=E&&(Q-=ve*g,j=ae),he=1),he&&(pe.year=Q,pe.time=j,pe.nano=z),pe}function ie(pe){var ve=new Date(0);return ve.setTime(pe),ve}function oe(Q,ae){Q=+Q||0;var he=R((ae=(ae|0)*S)/b)+R(Q/b),ae=ae%b+Q%b,Q=R(ae/b);return Q&&(he+=Q,ae-=Q*b),new q(1e3*ae,0,he*g)}function le(pe,ve,he,ae,Q,j){return function(re,Y){var ne=J(this);re=re||new Array(8),fe(re,Y|=0);var se=Math.floor(ne.time/1e3),ne=ne.year*(v*u/g),te=R(ne/S)+R(se/S),ne=ne%S+se%S,se=Math.floor(ne/S);return se&&(te+=se,ne-=se*S),z(re,Y+Q,te),z(re,Y+j,ne),re};function z(re,Y,te){re[Y+pe]=te>>24&255,re[Y+ve]=te>>16&255,re[Y+he]=te>>8&255,re[Y+ae]=255&te}}function de(pe,ve,he,ae,Q,j){return function(re,Y){fe(re,Y|=0);var te=z(re,Y+Q);return oe(z(re,Y+j),te)};function z(re,Y){return 16777216*re[Y+pe]+(re[Y+ve]<<16|re[Y+he]<<8|re[Y+ae])}}function fe(pe,ve){if(pe=pe&&pe.length,pe==null)throw new TypeError("Invalid Buffer");if(pe<ve+8)throw new RangeError("Out of range")}function ye(pe){return(9<pe?"":"0")+(0|pe)}function we(pe,ve){return($+(0|pe)).substr(-ve)}})()})(timestamp_min)),timestamp_min.exports}var timestamp_minExports=requireTimestamp_min();const NanoDate=getDefaultExportFromCjs$3(timestamp_minExports);class SignatureCreationError extends Error{static name="SignatureCreationError";constructor(u="Record signature creation failed"){super(u),this.name="SignatureCreationError"}}class SignatureVerificationError extends Error{static name="SignatureVerificationError";constructor(u="Record signature verification failed"){super(u),this.name="SignatureVerificationError"}}class RecordExpiredError extends Error{static name="RecordExpiredError";constructor(u="Record has expired"){super(u),this.name="RecordExpiredError"}}class UnsupportedValidityError extends Error{static name="UnsupportedValidityError";constructor(u="The validity type is unsupported"){super(u),this.name="UnsupportedValidityError"}}class RecordTooLargeError extends Error{static name="RecordTooLargeError";constructor(u="The record is too large"){super(u),this.name="RecordTooLargeError"}}class InvalidValueError extends Error{static name="InvalidValueError";constructor(u="Value must be a valid content path starting with /"){super(u),this.name="InvalidValueError"}}class InvalidRecordDataError extends Error{static name="InvalidRecordDataError";constructor(u="Invalid record data"){super(u),this.name="InvalidRecordDataError"}}class InvalidEmbeddedPublicKeyError extends Error{static name="InvalidEmbeddedPublicKeyError";constructor(u="Invalid embedded public key"){super(u),this.name="InvalidEmbeddedPublicKeyError"}}var IpnsEntry;(function(y){(function(v){v.EOL="EOL"})(y.ValidityType||(y.ValidityType={}));let u;(function(v){v[v.EOL=0]="EOL"})(u||(u={})),(function(v){v.codec=()=>enumeration(u)})(y.ValidityType||(y.ValidityType={}));let g;y.codec=()=>(g==null&&(g=message((v,b,w={})=>{w.lengthDelimited!==!1&&b.fork(),v.value!=null&&(b.uint32(10),b.bytes(v.value)),v.signatureV1!=null&&(b.uint32(18),b.bytes(v.signatureV1)),v.validityType!=null&&(b.uint32(24),y.ValidityType.codec().encode(v.validityType,b)),v.validity!=null&&(b.uint32(34),b.bytes(v.validity)),v.sequence!=null&&(b.uint32(40),b.uint64(v.sequence)),v.ttl!=null&&(b.uint32(48),b.uint64(v.ttl)),v.pubKey!=null&&(b.uint32(58),b.bytes(v.pubKey)),v.signatureV2!=null&&(b.uint32(66),b.bytes(v.signatureV2)),v.data!=null&&(b.uint32(74),b.bytes(v.data)),w.lengthDelimited!==!1&&b.ldelim()},(v,b,w={})=>{const E={},S=b==null?v.len:v.pos+b;for(;v.pos<S;){const A=v.uint32();switch(A>>>3){case 1:{E.value=v.bytes();break}case 2:{E.signatureV1=v.bytes();break}case 3:{E.validityType=y.ValidityType.codec().decode(v);break}case 4:{E.validity=v.bytes();break}case 5:{E.sequence=v.uint64();break}case 6:{E.ttl=v.uint64();break}case 7:{E.pubKey=v.bytes();break}case 8:{E.signatureV2=v.bytes();break}case 9:{E.data=v.bytes();break}default:{v.skipType(A&7);break}}}return E})),g),y.encode=v=>encodeMessage$1(v,y.codec()),y.decode=(v,b)=>decodeMessage$1(v,y.codec(),b)})(IpnsEntry||(IpnsEntry={}));const log$2=logger$7("ipns:utils"),IPNS_PREFIX$1=fromString$1("/ipns/"),LIBP2P_CID_CODEC=114,IDENTITY_CODEC=0,SHA2_256_CODEC=18;function extractPublicKeyFromIPNSRecord(y){let u;if(y.pubKey!=null)try{u=publicKeyFromProtobuf(y.pubKey)}catch(g){throw log$2.error(g),g}if(u!=null)return u}function ipnsRecordDataForV1Sig(y,u,g){const v=fromString$1(u);return concat$2([y,g,v])}function ipnsRecordDataForV2Sig(y){const u=fromString$1("ipns-signature:");return concat$2([u,y])}function marshalIPNSRecord(y){return"signatureV1"in y?IpnsEntry.encode({value:fromString$1(y.value),signatureV1:y.signatureV1,validityType:y.validityType,validity:fromString$1(y.validity),sequence:y.sequence,ttl:y.ttl,pubKey:y.pubKey,signatureV2:y.signatureV2,data:y.data}):IpnsEntry.encode({pubKey:y.pubKey,signatureV2:y.signatureV2,data:y.data})}function unmarshalIPNSRecord(y){const u=IpnsEntry.decode(y);if(u.sequence!=null&&(u.sequence=BigInt(u.sequence)),u.ttl!=null&&(u.ttl=BigInt(u.ttl)),u.signatureV2==null||u.data==null)throw new SignatureVerificationError("Missing data or signatureV2");const g=parseCborData(u.data),v=normalizeByteValue(g.Value),b=toString$3(g.Validity);if(u.value!=null&&u.signatureV1!=null)return validateCborDataMatchesPbData(u),{value:v,validityType:IpnsEntry.ValidityType.EOL,validity:b,sequence:g.Sequence,ttl:g.TTL,pubKey:u.pubKey,signatureV1:u.signatureV1,signatureV2:u.signatureV2,data:u.data};if(u.signatureV2!=null)return{value:v,validityType:IpnsEntry.ValidityType.EOL,validity:b,sequence:g.Sequence,ttl:g.TTL,pubKey:u.pubKey,signatureV2:u.signatureV2,data:u.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function multihashToIPNSRoutingKey(y){return concat$2([IPNS_PREFIX$1,y.bytes])}function multihashFromIPNSRoutingKey(y){const u=decode$8(y.slice(IPNS_PREFIX$1.length));if(!isCodec(u,IDENTITY_CODEC)&&!isCodec(u,SHA2_256_CODEC))throw new InvalidMultihashError("Multihash in IPNS key was not identity or sha2-256");return u}function createCborData(y,u,g,v,b){let w;if(u===IpnsEntry.ValidityType.EOL)w=0;else throw new UnsupportedValidityError("The validity type is unsupported");return encode$8({Value:y,Validity:g,ValidityType:w,Sequence:v,TTL:b})}function parseCborData(y){const u=decode$6(y);if(u.ValidityType===0)u.ValidityType=IpnsEntry.ValidityType.EOL;else throw new UnsupportedValidityError("The validity type is unsupported");return Number.isInteger(u.Sequence)&&(u.Sequence=BigInt(u.Sequence)),Number.isInteger(u.TTL)&&(u.TTL=BigInt(u.TTL)),u}function normalizeByteValue(y){const u=toString$3(y).trim();if(u.startsWith("/"))return u;try{return`/ipfs/${CID.decode(y).toV1().toString()}`}catch{}try{return`/ipfs/${CID.parse(u).toV1().toString()}`}catch{}throw new InvalidValueError("Value must be a valid content path starting with /")}function normalizeValue(y){if(y!=null){const u=asCID(y);if(u!=null)return u.code===LIBP2P_CID_CODEC?`/ipns/${u.toString(base36)}`:`/ipfs/${u.toV1().toString()}`;if(hasBytes(y))return`/ipns/${base36.encode(y.bytes)}`;const g=y.toString().trim();if(g.startsWith("/")&&g.length>1)return g}throw new InvalidValueError("Value must be a valid content path starting with /")}function validateCborDataMatchesPbData(y){if(y.data==null)throw new InvalidRecordDataError("Record data is missing");const u=parseCborData(y.data);if(!equals(u.Value,y.value??new Uint8Array(0)))throw new SignatureVerificationError('Field "value" did not match between protobuf and CBOR');if(!equals(u.Validity,y.validity??new Uint8Array(0)))throw new SignatureVerificationError('Field "validity" did not match between protobuf and CBOR');if(u.ValidityType!==y.validityType)throw new SignatureVerificationError('Field "validityType" did not match between protobuf and CBOR');if(u.Sequence!==y.sequence)throw new SignatureVerificationError('Field "sequence" did not match between protobuf and CBOR');if(u.TTL!==y.ttl)throw new SignatureVerificationError('Field "ttl" did not match between protobuf and CBOR')}function hasBytes(y){return y.bytes instanceof Uint8Array}function hasToCID(y){return typeof y?.toCID=="function"}function asCID(y){if(hasToCID(y))return y.toCID();try{return CID.parse(y)}catch{}return CID.asCID(y)}function isCodec(y,u){return y.code===u}const log$1=logger$7("ipns"),DEFAULT_TTL_NS=300*1e9,defaultCreateOptions={v1Compatible:!0,ttlNs:DEFAULT_TTL_NS};async function createIPNSRecord(y,u,g,v,b=defaultCreateOptions){const w=new NanoDate(Date.now()+Number(v)),E=IpnsEntry.ValidityType.EOL,S=BigInt(b.ttlNs??DEFAULT_TTL_NS);return _create(y,u,g,E,w.toString(),S,b)}const _create=async(y,u,g,v,b,w,E=defaultCreateOptions)=>{g=BigInt(g);const S=fromString$1(b),A=normalizeValue(u),$=fromString$1(A),R=createCborData($,v,S,g,w),T=ipnsRecordDataForV2Sig(R),O=await y.sign(T);let B;if(y.type==="RSA"&&(B=publicKeyToProtobuf(y.publicKey)),E.v1Compatible===!0){const F=await signLegacyV1(y,$,v,S),U={value:A,signatureV1:F,validity:b,validityType:v,sequence:g,ttl:w,signatureV2:O,data:R};return B!=null&&(U.pubKey=B),U}else{const F={value:A,validity:b,validityType:v,sequence:g,ttl:w,signatureV2:O,data:R};return B!=null&&(F.pubKey=B),F}},signLegacyV1=async(y,u,g,v)=>{try{const b=ipnsRecordDataForV1Sig(u,g,v);return await y.sign(b)}catch(b){throw log$1.error("record signature creation failed",b),new SignatureCreationError("Record signature creation failed")}},log=logger$7("ipns:validator"),MAX_RECORD_SIZE=1024*10;async function validate(y,u){const g=unmarshalIPNSRecord(u);let v;try{const b=ipnsRecordDataForV2Sig(g.data);v=await y.verify(b,g.signatureV2)}catch{v=!1}if(!v)throw log.error("record signature verification failed"),new SignatureVerificationError("Record signature verification failed");if(g.validityType===IpnsEntry.ValidityType.EOL){if(NanoDate.fromString(g.validity).toDate().getTime()<Date.now())throw log.error("record has expired"),new RecordExpiredError("record has expired")}else if(g.validityType!=null)throw log.error("the validity type is unsupported"),new UnsupportedValidityError("The validity type is unsupported");log("ipns record for %s is valid",g.value)}async function ipnsValidator(y,u){if(u.byteLength>MAX_RECORD_SIZE)throw new RecordTooLargeError("The record is too large");const g=multihashFromIPNSRoutingKey(y);let v;isCodec(g,0)&&(v=publicKeyFromMultihash(g));const b=unmarshalIPNSRecord(u),w=extractPublicKeyFromIPNSRecord(b)??v;if(w==null)throw new InvalidEmbeddedPublicKeyError("Could not extract public key from IPNS record or routing key");const E=multihashToIPNSRoutingKey(w.toMultihash());if(!equals(E,y))throw new InvalidEmbeddedPublicKeyError("Embedded public key did not match routing key");await validate(w,u)}class InvalidMessageLengthError extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MESSAGE_LENGTH"}async function*parse$7(y,u={}){const g=/\r?\n/,v=new TextDecoder("utf8");let b="";for await(let w of y){if(typeof w=="string"&&(w=new TextEncoder().encode(w)),isUint8ArrayList(w)&&(w=w.subarray()),b+=v.decode(w,{stream:!0}),b.length>(u?.maxMessageLength??b.length))throw new InvalidMessageLengthError("Incoming message too long");const E=b.split(g);b=E.pop()??"";for(let S=0;S<E.length;S++)yield JSON.parse(E[S])}b+=v.decode(),b!==""&&(yield JSON.parse(b))}class InvalidRequestError extends Error{static name="InvalidRequestError";constructor(u="Invalid request"){super(u),this.name="InvalidRequestError"}}class BadResponseError extends Error{static name="BadResponseError";constructor(u="Bad response"){super(u),this.name="BadResponseError"}}function isAsyncIterable$3(y){return y[Symbol.asyncIterator]!=null}function first(y){if(isAsyncIterable$3(y))return(async()=>{for await(const u of y)return u})();for(const u of y)return u}const IPNS_PREFIX=fromString$1("/ipns/");function isIPNSKey(y){return equals(y.subarray(0,IPNS_PREFIX.byteLength),IPNS_PREFIX)}class DelegatedRoutingV1HttpApiClientContentRouting{client;constructor(u){this.client=u}async*findProviders(u,g={}){try{yield*map(this.client.getProviders(u,g),v=>({id:v.ID,multiaddrs:v.Addrs??[],routing:"delegated-http-routing-v1"}))}catch(v){if(v instanceof NotFoundError$1)return;throw v}}async provide(){}async cancelReprovide(){}async put(u,g,v){if(!isIPNSKey(u))return;const b=multihashFromIPNSRoutingKey(u),w=CID.createV1(114,b),E=unmarshalIPNSRecord(g);await this.client.putIPNS(w,E,v)}async get(u,g){if(!isIPNSKey(u))throw new NotFoundError$1("Not found");const v=multihashFromIPNSRoutingKey(u),b=CID.createV1(114,v);try{const w=await this.client.getIPNS(b,g);return marshalIPNSRecord(w)}catch(w){throw w.name==="BadResponseError"?new NotFoundError$1("Not found"):w}}toString(){return`DelegatedRoutingV1HttpApiClientContentRouting(${this.client.url})`}}class DelegatedRoutingV1HttpApiClientPeerRouting{client;constructor(u){this.client=u}async findPeer(u,g={}){const v=await first(this.client.getPeers(u,g));if(v!=null)return{id:v.ID,multiaddrs:v.Addrs??[]};throw new NotFoundError$1("Not found")}async*getClosestPeers(u,g={}){}toString(){return`DelegatedRoutingV1HttpApiClientPeerRouting(${this.client.url})`}}const defaultValues$5={concurrentRequests:4,timeout:3e4,cacheTTL:300*1e3,cacheName:"delegated-routing-v1-cache"};class DelegatedRoutingV1HttpApiClient{url;started;httpQueue;shutDownController;timeout;contentRouting;peerRouting;filterAddrs;filterProtocols;inFlightRequests;cacheName;cache;cacheTTL;log;constructor(u,g){this.log=u.logger.forComponent("delegated-routing-v1-http-api-client"),this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new PQueue({concurrency:g.concurrentRequests??defaultValues$5.concurrentRequests}),this.inFlightRequests=new Map,this.url=g.url instanceof URL?g.url:new URL(g.url),this.timeout=g.timeout??defaultValues$5.timeout,this.filterAddrs=g.filterAddrs,this.filterProtocols=g.filterProtocols,this.contentRouting=new DelegatedRoutingV1HttpApiClientContentRouting(this),this.peerRouting=new DelegatedRoutingV1HttpApiClientPeerRouting(this),this.cacheName=g.cacheName??defaultValues$5.cacheName,this.cacheTTL=g.cacheTTL??defaultValues$5.cacheTTL}get[contentRoutingSymbol](){return this.contentRouting}get[peerRoutingSymbol](){return this.peerRouting}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cacheTTL>0&&(this.cache=await globalThis.caches?.open(this.cacheName),this.cache!=null&&this.log("cache enabled with ttl %d",this.cacheTTL)))}async stop(){this.httpQueue.clear(),this.shutDownController.abort(),await globalThis.caches?.delete(this.cacheName),this.started=!1}async*getProviders(u,g={}){this.log("getProviders starts: %c",u);const v=AbortSignal.timeout(this.timeout),b=anySignal([this.shutDownController.signal,v,g.signal]),w=pDefer(),E=pDefer();let S=0;this.httpQueue.add(async()=>(w.resolve(),E.promise));try{await w.promise;const A=new URL(`${this.url}routing/v1/providers/${u}`);this.#t(A,g.filterAddrs,g.filterProtocols);const $={headers:{accept:"application/x-ndjson, application/json;q=0.8"},signal:b},R=await this.#r(A.toString(),$);if(!R.ok){if(R.status===404)return;throw R.status===422?new InvalidRequestError("Request does not conform to schema or semantic constraints"):new BadResponseError(`Unexpected status code: ${R.status}`)}const T=R.headers.get("Content-Type");if(T==null)throw new BadResponseError("No Content-Type header received");if(R.body==null){if(T!=="application/x-ndjson")throw new BadResponseError("Routing response had no body");return}if(T.startsWith("application/json")){const B=(await R.json()).Providers??[];for(const F of B){const U=this.#e(F);U!=null&&(S++,yield U)}}else if(T.includes("application/x-ndjson"))for await(const O of parse$7(browserReadableStreamToIt(R.body))){const B=this.#e(O);B!=null&&(S++,yield B)}else throw new BadResponseError(`Unsupported Content-Type: ${T}`)}finally{b.clear(),E.resolve(),this.log("getProviders finished found %d providers for %c",S,u)}}async*getPeers(u,g={}){this.log("getPeers starts: %c",u);const v=AbortSignal.timeout(this.timeout),b=anySignal([this.shutDownController.signal,v,g.signal]),w=pDefer(),E=pDefer();this.httpQueue.add(async()=>(w.resolve(),E.promise));try{await w.promise;const S=new URL(`${this.url}routing/v1/peers/${u.toCID().toString()}`);this.#t(S,g.filterAddrs,g.filterProtocols);const A={headers:{Accept:"application/x-ndjson"},signal:b},$=await this.#r(S.toString(),A);if($.status===404)return;if($.status===422)throw new InvalidRequestError("Request does not conform to schema or semantic constraints");if($.body==null)throw new BadResponseError("Routing response had no body");if($.headers.get("Content-Type")?.startsWith("application/json")){const O=(await $.json()).Peers??[];for(const B of O){const F=this.#e(B);F!=null&&(yield F)}}else for await(const T of parse$7(browserReadableStreamToIt($.body))){const O=this.#e(T);O!=null&&(yield O)}}catch(S){this.log.error("getPeers errored - %e",S)}finally{b.clear(),E.resolve(),this.log("getPeers finished: %c",u)}}async getIPNS(u,g={}){this.log("getIPNS starts: %s",u);const v=AbortSignal.timeout(this.timeout),b=anySignal([this.shutDownController.signal,v,g.signal]),w=pDefer(),E=pDefer();this.httpQueue.add(async()=>(w.resolve(),E.promise));const S=`${this.url}routing/v1/ipns/${u}`;try{await w.promise;const A={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:b},$=await this.#r(S,A);if(this.log("getIPNS GET %s %d",S,$.status),$.status===404)throw new NotFoundError$1("No matching records found");if($.status===422)throw new InvalidRequestError("Request does not conform to schema or semantic constraints");if(!$.ok)throw new BadResponseError(`Unexpected status code: ${$.status}`);const R=$.headers.get("Content-Type");if(R==null||!R.includes("application/vnd.ipfs.ipns-record"))throw new NotFoundError$1("No matching records found");if($.body==null)throw new BadResponseError("GET ipns response had no body");const T=await $.arrayBuffer(),O=new Uint8Array(T,0,T.byteLength);return g.validate!==!1&&await ipnsValidator(multihashToIPNSRoutingKey(u.multihash),O),unmarshalIPNSRecord(O)}catch(A){throw this.log.error("getIPNS GET %s error - %e",S,A),A}finally{b.clear(),E.resolve(),this.log("getIPNS finished: %s",u)}}async putIPNS(u,g,v={}){this.log("putIPNS starts: %c",u);const b=AbortSignal.timeout(this.timeout),w=anySignal([this.shutDownController.signal,b,v.signal]),E=pDefer(),S=pDefer();this.httpQueue.add(async()=>(E.resolve(),S.promise));const A=`${this.url}routing/v1/ipns/${u}`;try{await E.promise;const $=marshalIPNSRecord(g),R={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:$,signal:w},T=await this.#r(A,R);if(this.log("putIPNS PUT %s %d",A,T.status),T.status!==200)throw new BadResponseError("PUT ipns response had status other than 200")}catch($){throw this.log.error("putIPNS PUT %s error - %e",A,$.stack),$}finally{w.clear(),S.resolve(),this.log("putIPNS finished: %c",u)}}#e(u){try{const g=[],v=u.Addrs?.map(multiaddr)??[];return u.Protocols!=null&&g.push(...u.Protocols),u.Protocol!=null&&(g.push(u.Protocol),delete u.Protocol),{...u,Schema:"peer",ID:peerIdFromString$1(u.ID),Addrs:v,Protocols:g}}catch(g){this.log.error("could not conform record to peer schema - %e",g)}}#t(u,g,v){if(g!=null||this.filterAddrs!=null){const b=g?.join(",")??this.filterAddrs?.join(",")??"";b!==""&&u.searchParams.set("filter-addrs",b)}if(v!=null||this.filterProtocols!=null){const b=v?.join(",")??this.filterProtocols?.join(",")??"";b!==""&&u.searchParams.set("filter-protocols",b)}}async#r(u,g){const v=g.method??"GET",b=`${v}-${u}`;if(v==="GET"){const A=await this.cache?.match(u);if(A!=null){if(parseInt(A.headers.get("x-cache-expires")??"0",10)>Date.now())return this.log("returning cached response for %s",b),this.logResponse(A),A;this.log("evicting cached response for %s",b),await this.cache?.delete(u)}else this.cache!=null&&this.log("cache miss for %s",b)}const w=this.inFlightRequests.get(b);if(w!=null){const A=await w;return this.log("deduplicating outgoing request for %s",b),A.clone()}this.log("outgoing request:"),this.logRequest(u,g);const E=fetch(u,g).then(async A=>{if(this.log("incoming response:"),this.logResponse(A),this.cache!=null&&A.ok&&v==="GET"){const $=Date.now()+this.cacheTTL,R=new Headers(A.headers);R.set("x-cache-expires",$.toString());const T=new Response(A.clone().body,{status:A.status,statusText:A.statusText,headers:R});await this.cache.put(u,T)}return A}).finally(()=>{this.inFlightRequests.delete(b)});return this.inFlightRequests.set(b,E),await E}toString(){return`DefaultDelegatedRoutingV1HttpApiClient(${this.url})`}logRequest(u,g){const v=new Headers(g.headers);this.log("%s %s HTTP/1.1",g.method??"GET",u);for(const[b,w]of v.entries())this.log("%s: %s",b,w)}logResponse(u){this.log("HTTP/1.1 %d %s",u.status,u.statusText);for(const[g,v]of u.headers.entries())this.log("%s: %s",g,v)}}function createDelegatedRoutingV1HttpApiClient(y,u={}){return new DelegatedRoutingV1HttpApiClient({logger:defaultLogger()},{...u,url:new URL(y)})}function delegatedHTTPRoutingDefaults(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}const word="[a-fA-F\\d:]",boundry=y=>y&&y.includeBoundaries?`(?:(?<=\\s|^)(?=${word})|(?<=${word})(?=\\s|$))`:"",v4="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",v6segment="[a-fA-F\\d]{1,4}",v6=`
(?:
(?:${v6segment}:){7}(?:${v6segment}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${v6segment}:){6}(?:${v4}|:${v6segment}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${v6segment}:){5}(?::${v4}|(?::${v6segment}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${v6segment}:){4}(?:(?::${v6segment}){0,1}:${v4}|(?::${v6segment}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${v6segment}:){3}(?:(?::${v6segment}){0,2}:${v4}|(?::${v6segment}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${v6segment}:){2}(?:(?::${v6segment}){0,3}:${v4}|(?::${v6segment}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${v6segment}:){1}(?:(?::${v6segment}){0,4}:${v4}|(?::${v6segment}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${v6segment}){0,5}:${v4}|(?::${v6segment}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),v46Exact=new RegExp(`(?:^${v4}$)|(?:^${v6}$)`),v4exact=new RegExp(`^${v4}$`),v6exact=new RegExp(`^${v6}$`),ipRegex=y=>y&&y.exact?v46Exact:new RegExp(`(?:${boundry(y)}${v4}${boundry(y)})|(?:${boundry(y)}${v6}${boundry(y)})`,"g");ipRegex.v4=y=>y&&y.exact?v4exact:new RegExp(`${boundry(y)}${v4}${boundry(y)}`,"g");ipRegex.v6=y=>y&&y.exact?v6exact:new RegExp(`${boundry(y)}${v6}${boundry(y)}`,"g");function functionTimeout(y){const u=(...g)=>y(...g);return Object.defineProperty(u,"name",{value:`functionTimeout(${y.name||"<anonymous>"})`,configurable:!0}),u}const{toString:toString$1}=Object.prototype;function isRegexp(y){return toString$1.call(y)==="[object RegExp]"}const flagMap={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function clonedRegexp(y,u={}){if(!isRegexp(y))throw new TypeError("Expected a RegExp instance");const g=Object.keys(flagMap).map(b=>(typeof u[b]=="boolean"?u[b]:y[b])?flagMap[b]:"").join(""),v=new RegExp(u.source||y.source,g);return v.lastIndex=typeof u.lastIndex=="number"?u.lastIndex:y.lastIndex,v}function isMatch(y,u,{timeout:g}={}){try{return functionTimeout(()=>clonedRegexp(y).test(u),{timeout:g})()}catch(v){throw v}}const maxIPv4Length=15,maxIPv6Length=45,options={timeout:400};function isIPv6(y){return y.length>maxIPv6Length?!1:isMatch(ipRegex.v6({exact:!0}),y,options)}function isIPv4(y){return y.length>maxIPv4Length?!1:isMatch(ipRegex.v4({exact:!0}),y,options)}const portFor={http:"80",https:"443",ws:"80",wss:"443"},BROWSER_SCHEMES=["http","https","ws","wss"];function uriToMultiaddr(y,u){u=u??{};const g=u.defaultDnsType??"dns",{scheme:v,hostname:b,port:w,path:E}=parseUri(y),S=[tupleForHostname(b,g),tupleForPort(w,v),tupleForScheme(v)];E!=null&&S.push(tupleForPath(E));const A="/"+S.filter($=>!!$).reduce(($,R)=>$.concat(R),[]).join("/");return multiaddr(A)}function parseUri(y){const[u]=y.split(":");BROWSER_SCHEMES.includes(u)||(y="http"+y.substring(u.length));let{protocol:g,hostname:v,port:b,pathname:w,search:E}=new URL(y);if(b==null||b===""){const A=portForProtocol(u);A!=null&&(b=A),A==null&&g==="http:"&&(b="80")}let S;return w!=null&&w!==""&&w!=="/"&&(w.startsWith("/")&&(w=w.substring(1)),S=w),E!=null&&E!==""&&(S=S??"",S+=E),{scheme:u,hostname:v,port:b,path:S}}function tupleForHostname(y,u){if(!(y==null||y==="")){if(isIPv4(y))return["ip4",y];if(isIPv6(y))return["ip6",y];if(y[0]==="["){const g=y.substring(1,y.length-1);if(isIPv6(g))return["ip6",g]}return[u,y]}}function tupleForPort(y,u){if(!(y==null||y===""))return u==="udp"?["udp",y]:["tcp",y]}function tupleForScheme(y){if(y.match(/^tcp$|^udp$/)==null)return y==="https"?["/tls/http"]:y==="wss"?["/tls/ws"]:[y]}function tupleForPath(y){if(!(y==null||y===""))return["http-path",encodeURIComponent(y)]}function portForProtocol(y){if(!(y==null||y===""||portFor[y]==null))return portFor[y]}const DEFAULT_TRUSTLESS_GATEWAYS=["https://trustless-gateway.link","https://4everland.io"],TRANSPORT_IPFS_GATEWAY_HTTP_CODE=2336;function toPeerInfo(y){return y=y.toString(),{id:peerIdFromCID(CID.createV1(TRANSPORT_IPFS_GATEWAY_HTTP_CODE,identity.digest(fromString$1(y)))),multiaddrs:[uriToMultiaddr(y)]}}class HTTPGatewayRouter{gateways;shuffle;constructor(u={}){this.gateways=(u.gateways??DEFAULT_TRUSTLESS_GATEWAYS).map(g=>toPeerInfo(g)),this.shuffle=u.shuffle??!0}async*findProviders(u,g){yield*(this.shuffle?this.gateways.toSorted(()=>Math.random()>.5?1:-1):this.gateways).map(v=>({...v,protocols:["transport-ipfs-gateway-http"],routing:"http-gateway-routing"}))}}function httpGatewayRouting(y={}){return new HTTPGatewayRouter(y)}class Libp2pRouter{libp2p;constructor(u){this.libp2p=u}async provide(u,g){await this.libp2p.contentRouting.provide(u,g)}async cancelReprovide(u,g){await this.libp2p.contentRouting.cancelReprovide(u,g)}async*findProviders(u,g){yield*this.libp2p.contentRouting.findProviders(u,g)}async put(u,g,v){await this.libp2p.contentRouting.put(u,g,v)}async get(u,g){return this.libp2p.contentRouting.get(u,g)}async findPeer(u,g){return this.libp2p.peerRouting.findPeer(u,g)}async*getClosestPeers(u,g){yield*this.libp2p.peerRouting.getClosestPeers(u,g)}}function libp2pRouting(y){return new Libp2pRouter(y)}function isAsyncIterable$2(y){return y[Symbol.asyncIterator]!=null}function all(y){if(isAsyncIterable$2(y))return(async()=>{const g=[];for await(const v of y)g.push(v);return g})();const u=[];for(const g of y)u.push(g);return u}function isPromise$2(y){return typeof y?.then=="function"}class MemoryBlockstore extends BaseBlockstore{data;constructor(){super(),this.data=new Map}put(u,g,v){v?.signal?.throwIfAborted();let b;if(g instanceof Uint8Array)b=[g];else{const w=all(g);if(isPromise$2(w))return w.then(E=>this._put(u,E,v));b=w}return this._put(u,b,v)}_put(u,g,v){return v?.signal?.throwIfAborted(),this.data.set(base32.encode(u.multihash.bytes),g),u}*get(u,g){g?.signal?.throwIfAborted();const v=this.data.get(base32.encode(u.multihash.bytes));if(v==null)throw new NotFoundError;yield*v}has(u,g){return g?.signal?.throwIfAborted(),this.data.has(base32.encode(u.multihash.bytes))}async delete(u,g){g?.signal?.throwIfAborted(),this.data.delete(base32.encode(u.multihash.bytes))}*getAll(u){u?.signal?.throwIfAborted();for(const[g,v]of this.data.entries())yield{cid:CID.createV1(code$5,decode$8(base32.decode(g))),bytes:(async function*(){yield*v})()},u?.signal?.throwIfAborted()}}logger$7("blockstore:core:tiered");const SHARDING_FN="SHARDING";function isAsyncIterable$1(y){return y[Symbol.asyncIterator]!=null}function sort(y,u){return isAsyncIterable$1(y)?(async function*(){yield*(await all(y)).sort(u)})():(function*(){yield*all(y).sort(u)})()}class BaseDatastore{put(u,g,v){return Promise.reject(new Error(".put is not implemented"))}get(u,g){return Promise.reject(new Error(".get is not implemented"))}has(u,g){return Promise.reject(new Error(".has is not implemented"))}delete(u,g){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(u,g={}){for await(const{key:v,value:b}of u)await this.put(v,b,g),yield v}async*getMany(u,g={}){for await(const v of u)yield{key:v,value:await this.get(v,g)}}async*deleteMany(u,g={}){for await(const v of u)await this.delete(v,g),yield v}batch(){let u=[],g=[];return{put(v,b){u.push({key:v,value:b})},delete(v){g.push(v)},commit:async v=>{await drain(this.putMany(u,v)),u=[],await drain(this.deleteMany(g,v)),g=[]}}}async*_all(u,g){throw new Error("._all is not implemented")}async*_allKeys(u,g){throw new Error("._allKeys is not implemented")}query(u,g){let v=this._all(u,g);if(u.prefix!=null){const b=u.prefix;v=filter(v,w=>w.key.toString().startsWith(b))}if(Array.isArray(u.filters)&&(v=u.filters.reduce((b,w)=>filter(b,w),v)),Array.isArray(u.orders)&&(v=u.orders.reduce((b,w)=>sort(b,w),v)),u.offset!=null){let b=0;const w=u.offset;v=filter(v,()=>b++>=w)}return u.limit!=null&&(v=take(v,u.limit)),v}queryKeys(u,g){let v=this._allKeys(u,g);if(u.prefix!=null){const b=u.prefix;v=filter(v,w=>w.toString().startsWith(b))}if(Array.isArray(u.filters)&&(v=u.filters.reduce((b,w)=>filter(b,w),v)),Array.isArray(u.orders)&&(v=u.orders.reduce((b,w)=>sort(b,w),v)),u.offset!=null){const b=u.offset;let w=0;v=filter(v,()=>w++>=b)}return u.limit!=null&&(v=take(v,u.limit)),v}}class MemoryDatastore extends BaseDatastore{data;constructor(){super(),this.data=new Map}put(u,g,v){return v?.signal?.throwIfAborted(),this.data.set(u.toString(),g),u}get(u,g){g?.signal?.throwIfAborted();const v=this.data.get(u.toString());if(v==null)throw new NotFoundError;return v}has(u,g){return g?.signal?.throwIfAborted(),this.data.has(u.toString())}delete(u,g){g?.signal?.throwIfAborted(),this.data.delete(u.toString())}*_all(u,g){g?.signal?.throwIfAborted();for(const[v,b]of this.data.entries())yield{key:new Key(v),value:b},g?.signal?.throwIfAborted()}*_allKeys(u,g){g?.signal?.throwIfAborted();for(const v of this.data.keys())yield new Key(v),g?.signal?.throwIfAborted()}}new Key(SHARDING_FN);logger$7("datastore:core:tiered");var define_globalThis_process_env_default$1={};async function validateConfig(y){if(y.connectionProtector===null&&define_globalThis_process_env_default$1?.LIBP2P_FORCE_PNET!=null)throw new InvalidParametersError$1("Private network is enforced, but no protector was provided");return y}var Envelope$1;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.publicKey!=null&&g.publicKey.byteLength>0&&(v.uint32(10),v.bytes(g.publicKey)),g.payloadType!=null&&g.payloadType.byteLength>0&&(v.uint32(18),v.bytes(g.payloadType)),g.payload!=null&&g.payload.byteLength>0&&(v.uint32(26),v.bytes(g.payload)),g.signature!=null&&g.signature.byteLength>0&&(v.uint32(42),v.bytes(g.signature)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={publicKey:alloc$2(0),payloadType:alloc$2(0),payload:alloc$2(0),signature:alloc$2(0)},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.publicKey=g.bytes();break}case 2:{w.payloadType=g.bytes();break}case 3:{w.payload=g.bytes();break}case 5:{w.signature=g.bytes();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Envelope$1||(Envelope$1={}));class InvalidSignatureError extends Error{constructor(u="Invalid signature"){super(u),this.name="InvalidSignatureError"}}class RecordEnvelope{static createFromProtobuf=u=>{const g=Envelope$1.decode(u),v=publicKeyFromProtobuf(g.publicKey);return new RecordEnvelope({publicKey:v,payloadType:g.payloadType,payload:g.payload,signature:g.signature})};static seal=async(u,g,v)=>{if(g==null)throw new Error("Missing private key");const b=u.domain,w=u.codec,E=u.marshal(),S=formatSignaturePayload(b,w,E),A=await g.sign(S.subarray(),v);return new RecordEnvelope({publicKey:g.publicKey,payloadType:w,payload:E,signature:A})};static openAndCertify=async(u,g,v)=>{const b=RecordEnvelope.createFromProtobuf(u);if(!await b.validate(g,v))throw new InvalidSignatureError("Envelope signature is not valid for the given domain");return b};publicKey;payloadType;payload;signature;marshaled;constructor(u){const{publicKey:g,payloadType:v,payload:b,signature:w}=u;this.publicKey=g,this.payloadType=v,this.payload=b,this.signature=w}marshal(){return this.marshaled==null&&(this.marshaled=Envelope$1.encode({publicKey:publicKeyToProtobuf(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(u){return u==null?!1:equals(this.marshal(),u.marshal())}async validate(u,g){const v=formatSignaturePayload(u,this.payloadType,this.payload);return this.publicKey.verify(v.subarray(),this.signature,g)}}const formatSignaturePayload=(y,u,g)=>{const v=fromString$1(y),b=encode$9(v.byteLength),w=encode$9(u.length),E=encode$9(g.length);return new Uint8ArrayList(b,v,w,u,E,g)},ENVELOPE_DOMAIN_PEER_RECORD="libp2p-peer-record",ENVELOPE_PAYLOAD_TYPE_PEER_RECORD=Uint8Array.from([3,1]);var PeerRecord$1;(function(y){(function(g){let v;g.codec=()=>(v==null&&(v=message((b,w,E={})=>{E.lengthDelimited!==!1&&w.fork(),b.multiaddr!=null&&b.multiaddr.byteLength>0&&(w.uint32(10),w.bytes(b.multiaddr)),E.lengthDelimited!==!1&&w.ldelim()},(b,w,E={})=>{const S={multiaddr:alloc$2(0)},A=w==null?b.len:b.pos+w;for(;b.pos<A;){const $=b.uint32();switch($>>>3){case 1:{S.multiaddr=b.bytes();break}default:{b.skipType($&7);break}}}return S})),v),g.encode=b=>encodeMessage$1(b,g.codec()),g.decode=(b,w)=>decodeMessage$1(b,g.codec(),w)})(y.AddressInfo||(y.AddressInfo={}));let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{if(b.lengthDelimited!==!1&&v.fork(),g.peerId!=null&&g.peerId.byteLength>0&&(v.uint32(10),v.bytes(g.peerId)),g.seq!=null&&g.seq!==0n&&(v.uint32(16),v.uint64(g.seq)),g.addresses!=null)for(const w of g.addresses)v.uint32(26),y.AddressInfo.codec().encode(w,v);b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={peerId:alloc$2(0),seq:0n,addresses:[]},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.peerId=g.bytes();break}case 2:{w.seq=g.uint64();break}case 3:{if(b.limits?.addresses!=null&&w.addresses.length===b.limits.addresses)throw new MaxLengthError('Decode error - map field "addresses" had too many elements');w.addresses.push(y.AddressInfo.codec().decode(g,g.uint32(),{limits:b.limits?.addresses$}));break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(PeerRecord$1||(PeerRecord$1={}));function arrayEquals(y,u){const g=(v,b)=>v.toString().localeCompare(b.toString());return y.length!==u.length?!1:(u.sort(g),y.sort(g).every((v,b)=>u[b].equals(v)))}class PeerRecord{static createFromProtobuf=u=>{const g=PeerRecord$1.decode(u),v=peerIdFromMultihash(decode$8(g.peerId)),b=(g.addresses??[]).map(E=>multiaddr(E.multiaddr)),w=g.seq;return new PeerRecord({peerId:v,multiaddrs:b,seqNumber:w})};static DOMAIN=ENVELOPE_DOMAIN_PEER_RECORD;static CODEC=ENVELOPE_PAYLOAD_TYPE_PEER_RECORD;peerId;multiaddrs;seqNumber;domain=PeerRecord.DOMAIN;codec=PeerRecord.CODEC;marshaled;constructor(u){const{peerId:g,multiaddrs:v,seqNumber:b}=u;this.peerId=g,this.multiaddrs=v??[],this.seqNumber=b??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=PeerRecord$1.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(u=>({multiaddr:u.bytes}))})),this.marshaled}equals(u){return!(!(u instanceof PeerRecord)||!this.peerId.equals(u.peerId)||this.seqNumber!==u.seqNumber||!arrayEquals(this.multiaddrs,u.multiaddrs))}}const MAX_ADDRESS_AGE=36e5,MAX_PEER_AGE=216e5;var Peer$1;(function(y){(function(g){let v;g.codec=()=>(v==null&&(v=message((b,w,E={})=>{E.lengthDelimited!==!1&&w.fork(),b.key!=null&&b.key!==""&&(w.uint32(10),w.string(b.key)),b.value!=null&&b.value.byteLength>0&&(w.uint32(18),w.bytes(b.value)),E.lengthDelimited!==!1&&w.ldelim()},(b,w,E={})=>{const S={key:"",value:alloc$2(0)},A=w==null?b.len:b.pos+w;for(;b.pos<A;){const $=b.uint32();switch($>>>3){case 1:{S.key=b.string();break}case 2:{S.value=b.bytes();break}default:{b.skipType($&7);break}}}return S})),v),g.encode=b=>encodeMessage$1(b,g.codec()),g.decode=(b,w)=>decodeMessage$1(b,g.codec(),w)})(y.Peer$metadataEntry||(y.Peer$metadataEntry={})),(function(g){let v;g.codec=()=>(v==null&&(v=message((b,w,E={})=>{E.lengthDelimited!==!1&&w.fork(),b.key!=null&&b.key!==""&&(w.uint32(10),w.string(b.key)),b.value!=null&&(w.uint32(18),Tag.codec().encode(b.value,w)),E.lengthDelimited!==!1&&w.ldelim()},(b,w,E={})=>{const S={key:""},A=w==null?b.len:b.pos+w;for(;b.pos<A;){const $=b.uint32();switch($>>>3){case 1:{S.key=b.string();break}case 2:{S.value=Tag.codec().decode(b,b.uint32(),{limits:E.limits?.value});break}default:{b.skipType($&7);break}}}return S})),v),g.encode=b=>encodeMessage$1(b,g.codec()),g.decode=(b,w)=>decodeMessage$1(b,g.codec(),w)})(y.Peer$tagsEntry||(y.Peer$tagsEntry={}));let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{if(b.lengthDelimited!==!1&&v.fork(),g.addresses!=null)for(const w of g.addresses)v.uint32(10),Address.codec().encode(w,v);if(g.protocols!=null)for(const w of g.protocols)v.uint32(18),v.string(w);if(g.publicKey!=null&&(v.uint32(34),v.bytes(g.publicKey)),g.peerRecordEnvelope!=null&&(v.uint32(42),v.bytes(g.peerRecordEnvelope)),g.metadata!=null&&g.metadata.size!==0)for(const[w,E]of g.metadata.entries())v.uint32(50),y.Peer$metadataEntry.codec().encode({key:w,value:E},v);if(g.tags!=null&&g.tags.size!==0)for(const[w,E]of g.tags.entries())v.uint32(58),y.Peer$tagsEntry.codec().encode({key:w,value:E},v);g.updated!=null&&(v.uint32(64),v.uint64Number(g.updated)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={addresses:[],protocols:[],metadata:new Map,tags:new Map},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{if(b.limits?.addresses!=null&&w.addresses.length===b.limits.addresses)throw new MaxLengthError('Decode error - map field "addresses" had too many elements');w.addresses.push(Address.codec().decode(g,g.uint32(),{limits:b.limits?.addresses$}));break}case 2:{if(b.limits?.protocols!=null&&w.protocols.length===b.limits.protocols)throw new MaxLengthError('Decode error - map field "protocols" had too many elements');w.protocols.push(g.string());break}case 4:{w.publicKey=g.bytes();break}case 5:{w.peerRecordEnvelope=g.bytes();break}case 6:{if(b.limits?.metadata!=null&&w.metadata.size===b.limits.metadata)throw new MaxSizeError('Decode error - map field "metadata" had too many elements');const A=y.Peer$metadataEntry.codec().decode(g,g.uint32());w.metadata.set(A.key,A.value);break}case 7:{if(b.limits?.tags!=null&&w.tags.size===b.limits.tags)throw new MaxSizeError('Decode error - map field "tags" had too many elements');const A=y.Peer$tagsEntry.codec().decode(g,g.uint32(),{limits:{value:b.limits?.tags$value}});w.tags.set(A.key,A.value);break}case 8:{w.updated=g.uint64Number();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Peer$1||(Peer$1={}));var Address;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.multiaddr!=null&&g.multiaddr.byteLength>0&&(v.uint32(10),v.bytes(g.multiaddr)),g.isCertified!=null&&(v.uint32(16),v.bool(g.isCertified)),g.observed!=null&&(v.uint32(24),v.uint64Number(g.observed)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={multiaddr:alloc$2(0)},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.multiaddr=g.bytes();break}case 2:{w.isCertified=g.bool();break}case 3:{w.observed=g.uint64Number();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Address||(Address={}));var Tag;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.value!=null&&g.value!==0&&(v.uint32(8),v.uint32(g.value)),g.expiry!=null&&(v.uint32(16),v.uint64(g.expiry)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={value:0},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.value=g.uint32();break}case 2:{w.expiry=g.uint64();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Tag||(Tag={}));function populatePublicKey(y,u){if(y.publicKey!=null||u.publicKey==null)return y;let g;y.type==="RSA"&&(g=y.toMultihash());const v=publicKeyFromProtobuf(u.publicKey,g);return peerIdFromPublicKey(v)}function bytesToPeer(y,u,g){const v=Peer$1.decode(u);return pbToPeer(y,v,g)}function pbToPeer(y,u,g){const v=new Map,b=BigInt(Date.now());for(const[w,E]of u.tags.entries())E.expiry!=null&&E.expiry<b||v.set(w,E);return{...u,id:populatePublicKey(y,u),addresses:u.addresses.filter(({observed:w})=>w!=null&&w>Date.now()-g).map(({multiaddr:w,isCertified:E})=>({multiaddr:multiaddr(w),isCertified:E??!1})),metadata:u.metadata,peerRecordEnvelope:u.peerRecordEnvelope??void 0,tags:v}}function peerEquals(y,u){return addressesEqual(y.addresses,u.addresses)&&protocolsEqual(y.protocols,u.protocols)&&publicKeyEqual(y.publicKey,u.publicKey)&&peerRecordEnvelope(y.peerRecordEnvelope,u.peerRecordEnvelope)&&metadataEqual(y.metadata,u.metadata)&&tagsEqual(y.tags,u.tags)}function addressesEqual(y,u){return compareArrays(y,u,(g,v)=>!(g.isCertified!==v.isCertified||!equals(g.multiaddr,v.multiaddr)))}function protocolsEqual(y,u){return compareArrays(y,u,(g,v)=>g===v)}function publicKeyEqual(y,u){return compareOptionalUint8Arrays(y,u)}function peerRecordEnvelope(y,u){return compareOptionalUint8Arrays(y,u)}function metadataEqual(y,u){return compareMaps(y,u,(g,v)=>equals(g,v))}function tagsEqual(y,u){return compareMaps(y,u,(g,v)=>g.value===v.value&&g.expiry===v.expiry)}function compareOptionalUint8Arrays(y,u){return y==null&&u==null?!0:y!=null&&u!=null?equals(y,u):!1}function compareArrays(y,u,g){if(y.length!==u.length)return!1;for(let v=0;v<y.length;v++)if(!g(y[v],u[v]))return!1;return!0}function compareMaps(y,u,g){if(y.size!==u.size)return!1;for(const[v,b]of y.entries()){const w=u.get(v);if(w==null||!g(b,w))return!1}return!0}const NAMESPACE_COMMON="/peers/";function peerIdToDatastoreKey(y){if(!isPeerId(y)||y.type==null)throw new InvalidParametersError$1("Invalid PeerId");const u=y.toCID().toString();return new Key(`${NAMESPACE_COMMON}${u}`)}async function dedupeFilterAndSortAddresses(y,u,g,v,b){const w=new Map;for(const E of g){if(E==null)continue;if(E.multiaddr instanceof Uint8Array&&(E.multiaddr=multiaddr(E.multiaddr)),!isMultiaddr(E.multiaddr))throw new InvalidParametersError$1("Multiaddr was invalid");if(!await u(y,E.multiaddr,b))continue;const S=E.isCertified??!1,A=E.multiaddr.toString(),$=w.get(A);$!=null?E.isCertified=$.isCertified||S:w.set(A,{multiaddr:E.multiaddr,isCertified:S})}return[...w.values()].sort((E,S)=>E.multiaddr.toString().localeCompare(S.multiaddr.toString())).map(({isCertified:E,multiaddr:S})=>{const A=S.getComponents().find($=>$.code===CODE_P2P)?.value;return y.equals(A)&&(S=S.decapsulate(multiaddr(`/p2p/${y}`))),{isCertified:E,multiaddr:S.bytes}})}async function toPeerPB(y,u,g,v){if(u==null)throw new InvalidParametersError$1("Invalid PeerData");if(u.publicKey!=null&&y.publicKey!=null&&!u.publicKey.equals(y.publicKey))throw new InvalidParametersError$1("publicKey bytes do not match peer id publicKey bytes");const b=v.existingPeer?.peer;if(b!=null&&!y.equals(b.id))throw new InvalidParametersError$1("peer id did not match existing peer id");let w=b?.addresses??[],E=new Set(b?.protocols??[]),S=b?.metadata??new Map,A=b?.tags??new Map,$=b?.peerRecordEnvelope;if(g==="patch"){if((u.multiaddrs!=null||u.addresses!=null)&&(w=[],u.multiaddrs!=null&&w.push(...u.multiaddrs.map(O=>({isCertified:!1,multiaddr:O}))),u.addresses!=null&&w.push(...u.addresses)),u.protocols!=null&&(E=new Set(u.protocols)),u.metadata!=null){const O=u.metadata instanceof Map?[...u.metadata.entries()]:Object.entries(u.metadata);S=createSortedMap(O,{validate:validateMetadata})}if(u.tags!=null){const O=u.tags instanceof Map?[...u.tags.entries()]:Object.entries(u.tags);A=createSortedMap(O,{validate:validateTag,map:mapTag})}u.peerRecordEnvelope!=null&&($=u.peerRecordEnvelope)}if(g==="merge"){if(u.multiaddrs!=null&&w.push(...u.multiaddrs.map(O=>({isCertified:!1,multiaddr:O}))),u.addresses!=null&&w.push(...u.addresses),u.protocols!=null&&(E=new Set([...E,...u.protocols])),u.metadata!=null){const O=u.metadata instanceof Map?[...u.metadata.entries()]:Object.entries(u.metadata);for(const[B,F]of O)F==null?S.delete(B):S.set(B,F);S=createSortedMap([...S.entries()],{validate:validateMetadata})}if(u.tags!=null){const O=u.tags instanceof Map?[...u.tags.entries()]:Object.entries(u.tags),B=new Map(A);for(const[F,U]of O)U==null?B.delete(F):B.set(F,U);A=createSortedMap([...B.entries()],{validate:validateTag,map:mapTag})}u.peerRecordEnvelope!=null&&($=u.peerRecordEnvelope)}let R;b?.id.publicKey!=null?R=publicKeyToProtobuf(b.id.publicKey):u.publicKey!=null?R=publicKeyToProtobuf(u.publicKey):y.publicKey!=null&&(R=publicKeyToProtobuf(y.publicKey));const T={addresses:await dedupeFilterAndSortAddresses(y,v.addressFilter??(async()=>!0),w,v.existingPeer?.peerPB.addresses,v),protocols:[...E.values()].sort((O,B)=>O.localeCompare(B)),metadata:S,tags:A,publicKey:R,peerRecordEnvelope:$};return T.addresses.forEach(O=>{O.observed=v.existingPeer?.peerPB.addresses?.find(B=>equals(B.multiaddr,B.multiaddr))?.observed??Date.now()}),y.type!=="RSA"&&delete T.publicKey,T}function createSortedMap(y,u){const g=new Map;for(const[v,b]of y)b!=null&&u.validate(v,b);for(const[v,b]of y.sort(([w],[E])=>w.localeCompare(E)))b!=null&&g.set(v,u.map?.(v,b)??b);return g}function validateMetadata(y,u){if(typeof y!="string")throw new InvalidParametersError$1("Metadata key must be a string");if(!(u instanceof Uint8Array))throw new InvalidParametersError$1("Metadata value must be a Uint8Array")}function validateTag(y,u){if(typeof y!="string")throw new InvalidParametersError$1("Tag name must be a string");if(u.value!=null){if(parseInt(`${u.value}`,10)!==u.value)throw new InvalidParametersError$1("Tag value must be an integer");if(u.value<0||u.value>100)throw new InvalidParametersError$1("Tag value must be between 0-100")}if(u.ttl!=null){if(parseInt(`${u.ttl}`,10)!==u.ttl)throw new InvalidParametersError$1("Tag ttl must be an integer");if(u.ttl<0)throw new InvalidParametersError$1("Tag ttl must be between greater than 0")}}function mapTag(y,u){let g;u.expiry!=null&&(g=u.expiry),u.ttl!=null&&(g=BigInt(Date.now()+Number(u.ttl)));const v={value:u.value??0};return g!=null&&(v.expiry=g),v}function keyToPeerId(y){const u=y.toString().split("/")[2],g=CID.parse(u,base32);return peerIdFromCID(g)}function decodePeer(y,u,g){const v=keyToPeerId(y);return bytesToPeer(v,u,g)}function mapQuery(y,u){return{prefix:NAMESPACE_COMMON,filters:(y.filters??[]).map(g=>({key:v,value:b})=>g(decodePeer(v,b,u))),orders:(y.orders??[]).map(g=>(v,b)=>g(decodePeer(v.key,v.value,u),decodePeer(b.key,b.value,u)))}}class PersistentStore{peerId;datastore;locks;addressFilter;log;maxAddressAge;maxPeerAge;constructor(u,g={}){this.log=u.logger.forComponent("libp2p:peer-store"),this.peerId=u.peerId,this.datastore=u.datastore,this.addressFilter=g.addressFilter,this.locks=trackedPeerMap({name:"libp2p_peer_store_locks",metrics:u.metrics}),this.maxAddressAge=g.maxAddressAge??MAX_ADDRESS_AGE,this.maxPeerAge=g.maxPeerAge??MAX_PEER_AGE}getLock(u){let g=this.locks.get(u);return g==null&&(g={refs:0,lock:createMortice({name:u.toString(),singleProcess:!0})},this.locks.set(u,g)),g.refs++,g}maybeRemoveLock(u,g){g.refs--,g.refs===0&&(g.lock.finalize(),this.locks.delete(u))}async getReadLock(u,g){const v=this.getLock(u);try{const b=await v.lock.readLock(g);return()=>{b(),this.maybeRemoveLock(u,v)}}catch(b){throw this.maybeRemoveLock(u,v),b}}async getWriteLock(u,g){const v=this.getLock(u);try{const b=await v.lock.writeLock(g);return()=>{b(),this.maybeRemoveLock(u,v)}}catch(b){throw this.maybeRemoveLock(u,v),b}}async has(u,g){try{return await this.load(u,g),!0}catch(v){if(v.name!=="NotFoundError")throw v}return!1}async delete(u,g){this.peerId.equals(u)||await this.datastore.delete(peerIdToDatastoreKey(u),g)}async load(u,g){const v=peerIdToDatastoreKey(u),b=await this.datastore.get(v,g),w=Peer$1.decode(b);if(this.#r(u,w))throw await this.datastore.delete(v,g),new NotFoundError$1;return pbToPeer(u,w,this.peerId.equals(u)?1/0:this.maxAddressAge)}async save(u,g,v){const b=await this.#e(u,v),w=await toPeerPB(u,g,"patch",{...v,addressFilter:this.addressFilter});return this.#t(u,w,b)}async patch(u,g,v){const b=await this.#e(u,v),w=await toPeerPB(u,g,"patch",{...v,addressFilter:this.addressFilter,existingPeer:b});return this.#t(u,w,b)}async merge(u,g,v){const b=await this.#e(u,v),w=await toPeerPB(u,g,"merge",{addressFilter:this.addressFilter,existingPeer:b});return this.#t(u,w,b)}async*all(u){for await(const{key:g,value:v}of this.datastore.query(mapQuery(u??{},this.maxAddressAge),u)){const b=keyToPeerId(g);if(b.equals(this.peerId))continue;const w=Peer$1.decode(v);if(this.#r(b,w)){await this.datastore.delete(g,u);continue}yield pbToPeer(b,w,this.peerId.equals(b)?1/0:this.maxAddressAge)}}async#e(u,g){try{const v=peerIdToDatastoreKey(u),b=await this.datastore.get(v,g),w=Peer$1.decode(b);if(this.#r(u,w))throw await this.datastore.delete(v,g),new NotFoundError$1;return{peerPB:w,peer:pbToPeer(u,w,this.maxAddressAge)}}catch(v){v.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",v)}}async#t(u,g,v,b){g.updated=Date.now();const w=Peer$1.encode(g);return await this.datastore.put(peerIdToDatastoreKey(u),w,b),{peer:pbToPeer(u,g,this.maxAddressAge),previous:v?.peer,updated:v==null||!peerEquals(g,v.peerPB)}}#r(u,g){if(g.updated==null)return!0;if(this.peerId.equals(u))return!1;const v=g.updated<Date.now()-this.maxPeerAge,b=Date.now()-this.maxAddressAge,w=g.addresses.filter(E=>E.observed!=null&&E.observed>b);return v&&w.length===0}}class PersistentPeerStore{store;events;peerId;log;constructor(u,g={}){this.log=u.logger.forComponent("libp2p:peer-store"),this.events=u.events,this.peerId=u.peerId,this.store=new PersistentStore(u,g)}[Symbol.toStringTag]="@libp2p/peer-store";async forEach(u,g){for await(const v of this.store.all(g))u(v)}async all(u){return all(this.store.all(u))}async delete(u,g){const v=await this.store.getReadLock(u,g);try{await this.store.delete(u,g)}finally{v()}}async has(u,g){const v=await this.store.getReadLock(u,g);try{return await this.store.has(u,g)}finally{this.log.trace("has release read lock"),v?.()}}async get(u,g){const v=await this.store.getReadLock(u,g);try{return await this.store.load(u,g)}finally{v?.()}}async getInfo(u,g){const v=await this.get(u,g);return{id:v.id,multiaddrs:v.addresses.map(({multiaddr:b})=>b)}}async save(u,g,v){const b=await this.store.getWriteLock(u,v);try{const w=await this.store.save(u,g,v);return this.#e(u,w),w.peer}finally{b?.()}}async patch(u,g,v){const b=await this.store.getWriteLock(u,v);try{const w=await this.store.patch(u,g,v);return this.#e(u,w),w.peer}finally{b?.()}}async merge(u,g,v){const b=await this.store.getWriteLock(u,v);try{const w=await this.store.merge(u,g,v);return this.#e(u,w),w.peer}finally{b?.()}}async consumePeerRecord(u,g,v){const b=isPeerId(g)?g:isPeerId(g?.expectedPeer)?g.expectedPeer:void 0,w=isPeerId(g)||g===void 0?v:g,E=await RecordEnvelope.openAndCertify(u,PeerRecord.DOMAIN,w),S=peerIdFromCID(E.publicKey.toCID());if(b?.equals(S)===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",b,S),!1;const A=PeerRecord.createFromProtobuf(E.payload);let $;try{$=await this.get(S,w)}catch(R){if(R.name!=="NotFoundError")throw R}if($?.peerRecordEnvelope!=null){const R=RecordEnvelope.createFromProtobuf($.peerRecordEnvelope),T=PeerRecord.createFromProtobuf(R.payload);if(T.seqNumber>=A.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",T.seqNumber,A.seqNumber),!1}return await this.patch(A.peerId,{peerRecordEnvelope:u,addresses:A.multiaddrs.map(R=>({isCertified:!0,multiaddr:R}))},w),!0}#e(u,g){g.updated&&(this.peerId.equals(u)?this.events.safeDispatchEvent("self:peer:update",{detail:g}):this.events.safeDispatchEvent("peer:update",{detail:g}))}}function persistentPeerStore(y,u={}){return new PersistentPeerStore(y,u)}const MAX_DATE=864e13;class DNSMappings{log;mappings;constructor(u,g={}){this.log=u.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=trackedMap({name:"libp2p_address_manager_dns_mappings",metrics:u.metrics})}has(u){const g=getNetConfig(u);let v=g.host;(g.type==="ip4"||g.type==="ip6")&&g.sni!=null&&(v=g.sni);for(const b of this.mappings.values())if(b.domain===v)return!0;return!1}add(u,g){g.forEach(v=>{this.log("add DNS mapping %s to %s",v,u);const b=isPrivateIp(v)===!0;this.mappings.set(v,{domain:u,verified:b,expires:b?MAX_DATE-Date.now():0,lastVerified:b?MAX_DATE-Date.now():void 0})})}remove(u){const g=getNetConfig(u);if(g.type!=="ip4"&&g.type!=="ip6")return!1;let v=!1;for(const[b,w]of this.mappings.entries())w.domain===g.sni&&(this.log("removing %s to %s DNS mapping %e",b,w.domain),this.mappings.delete(b),v=v||w.verified);return v}getAll(u){const g=[];for(let v=0;v<u.length;v++){const b=u[v].multiaddr;if(!isNetworkAddress(b))continue;const w=getNetConfig(b);for(const[E,S]of this.mappings.entries()){if(w.host!==E)continue;const A=this.maybeAddSNIComponent(b,S.domain);A!=null&&(u.splice(v,1),v--,g.push({multiaddr:A,verified:S.verified,type:"dns-mapping",expires:S.expires,lastVerified:S.lastVerified}))}}return g}maybeAddSNIComponent(u,g){const v=u.getComponents();for(let b=0;b<v.length;b++)if(v[b].code===CODE_TLS&&v[b+1]?.code!==CODE_SNI)return v.splice(b+1,0,{name:"sni",code:CODE_SNI,value:g}),multiaddr(v)}confirm(u,g){const v=getNetConfig(u);let b=v.host;(v.type==="ip4"||v.type==="ip6")&&v.sni!=null&&(b=v.sni);let w=!1;for(const[E,S]of this.mappings.entries())S.domain===b&&(this.log("marking %s to %s DNS mapping as verified",E,S.domain),w=S.verified,S.verified=!0,S.expires=Date.now()+g,S.lastVerified=Date.now());return w}unconfirm(u,g){const v=getNetConfig(u);if(v.type!=="ip4"&&v.type!=="ip6")return!1;const b=v.sni??v.host;let w=!1;for(const[E,S]of this.mappings.entries())S.domain===b&&(this.log("removing verification of %s to %s DNS mapping",E,S.domain),w=w||S.verified,S.verified=!1,S.expires=Date.now()+g);return w}}class IPMappings{log;mappings;constructor(u,g={}){this.log=u.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=trackedMap({name:"libp2p_address_manager_ip_mappings",metrics:u.metrics})}has(u){const g=getNetConfig(u);if(g.type!=="ip4"&&g.type!=="ip6")return!1;for(const v of this.mappings.values())for(const b of v)if(b.externalIp===g.host)return!0;return!1}add(u,g,v,b=g,w="tcp"){const E=`${u}-${g}-${w}`,S=this.mappings.get(E)??[],A={internalIp:u,internalPort:g,externalIp:v,externalPort:b,externalFamily:isIPv4$1(v)?4:6,protocol:w,verified:!1,expires:0};S.push(A),this.mappings.set(E,S)}remove(u){const g=getNetConfig(u);if(g.type!=="ip4"&&g.type!=="ip6")return!1;let v=!1;for(const[b,w]of this.mappings.entries()){for(let E=0;E<w.length;E++){const S=w[E];S.externalIp===g.host&&S.externalPort===g.port&&S.protocol===g.protocol&&(this.log("removing %s:%s to %s:%s %s IP mapping",S.externalIp,S.externalPort,g.host,g.port,g.protocol),v=v||S.verified,w.splice(E,1),E--)}w.length===0&&this.mappings.delete(b)}return v}getAll(u){const g=[];for(const{multiaddr:v}of u){if(!isNetworkAddress(v))continue;const b=getNetConfig(v);if(b.type!=="ip4"&&b.type!=="ip6")continue;let w;if(b.protocol==="tcp"?w=`${b.host}-${b.port}-tcp`:b.protocol==="udp"&&(w=`${b.host}-${b.port}-udp`),w==null)continue;const E=this.mappings.get(w);if(E!=null)for(const S of E)g.push({multiaddr:this.maybeOverrideIp(v,S.externalIp,S.externalFamily,S.protocol,S.externalPort),verified:S.verified,type:"ip-mapping",expires:S.expires,lastVerified:S.lastVerified})}return g}maybeOverrideIp(u,g,v,b,w){const E=u.getComponents(),S=E.findIndex($=>$.code===CODE_IP4||$.code===CODE_IP6),A=E.findIndex($=>$.name===b);return S>-1&&A>-1?(E[S].value=g,E[S].code=v===4?CODE_IP4:CODE_IP6,E[A].value=`${w}`,multiaddr(E)):u}confirm(u,g){if(!isNetworkAddress(u))return!1;const v=getNetConfig(u);let b=!1;for(const w of this.mappings.values())for(const E of w)E.externalIp===v.host&&(this.log("marking %s to %s IP mapping as verified",E.internalIp,E.externalIp),b=E.verified,E.verified=!0,E.expires=Date.now()+g,E.lastVerified=Date.now());return b}unconfirm(u,g){if(!isNetworkAddress(u))return!1;const v=getNetConfig(u);let b=!1;for(const w of this.mappings.values())for(let E=0;E<w.length;E++){const S=w[E];S.externalIp===v.host&&S.externalPort===v.port&&S.protocol===v.protocol&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",S.externalIp,S.externalPort,v.host,v.port,v.protocol),b=b||S.verified,S.verified=!1,S.expires=Date.now()+g)}return b}}const defaultValues$4={maxObservedAddresses:10};class ObservedAddresses{log;addresses;maxObservedAddresses;constructor(u,g={}){this.log=u.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=trackedMap({name:"libp2p_address_manager_observed_addresses",metrics:u.metrics}),this.maxObservedAddresses=g.maxObservedAddresses??defaultValues$4.maxObservedAddresses}has(u){return this.addresses.has(u.toString())}removePrefixed(u){for(const g of this.addresses.keys())g.toString().startsWith(u)&&this.addresses.delete(g)}add(u){this.addresses.size!==this.maxObservedAddresses&&(isPrivate(u)||isLinkLocal(u)||(this.log("adding observed address %a",u),this.addresses.set(u.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([u,g])=>({multiaddr:multiaddr(u),verified:g.verified,type:"observed",expires:g.expires,lastVerified:g.lastVerified}))}remove(u){const g=this.addresses.get(u.toString())?.verified??!1;return this.log("removing observed address %a",u),this.addresses.delete(u.toString()),g}confirm(u,g){const v=u.toString(),b=this.addresses.get(v)??{verified:!1,expires:Date.now()+g,lastVerified:Date.now()},w=b.verified;return b.verified=!0,b.expires=Date.now()+g,b.lastVerified=Date.now(),this.log("marking observed address %a as verified",v),this.addresses.set(v,b),w}}const defaultValues$3={maxObservedAddresses:10};class TransportAddresses{log;addresses;maxObservedAddresses;constructor(u,g={}){this.log=u.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=trackedMap({name:"libp2p_address_manager_transport_addresses",metrics:u.metrics}),this.maxObservedAddresses=g.maxObservedAddresses??defaultValues$3.maxObservedAddresses}get(u,g){if(isPrivate(u))return{multiaddr:u,verified:!0,type:"transport",expires:Date.now()+g,lastVerified:Date.now()};const v=this.toKey(u);let b=this.addresses.get(v);return b==null&&(b={verified:!isNetworkAddress(u),expires:0},this.addresses.set(v,b)),{multiaddr:u,verified:b.verified,type:"transport",expires:b.expires,lastVerified:b.lastVerified}}has(u){const g=this.toKey(u);return this.addresses.has(g)}remove(u){const g=this.toKey(u),v=this.addresses.get(g)?.verified??!1;return this.log("removing observed address %a",u),this.addresses.delete(g),v}confirm(u,g){const v=this.toKey(u),b=this.addresses.get(v)??{verified:!1,expires:0,lastVerified:0},w=b.verified;return b.verified=!0,b.expires=Date.now()+g,b.lastVerified=Date.now(),this.addresses.set(v,b),w}unconfirm(u,g){const v=this.toKey(u),b=this.addresses.get(v)??{verified:!1,expires:0},w=b.verified;return b.verified=!1,b.expires=Date.now()+g,this.addresses.set(v,b),w}toKey(u){if(!isNetworkAddress(u))return u.toString();const g=getNetConfig(u);return`${g.host}-${g.port}-${g.protocol}`}}const ONE_MINUTE=6e4,defaultValues$2={addressVerificationTTL:ONE_MINUTE*10,addressVerificationRetry:ONE_MINUTE*5},defaultAddressFilter=y=>y;function stripPeerId(y,u){const g=y.getComponents().findLast(v=>v.code===CODE_P2P)?.value;return g!=null&&peerIdFromString$1(g).equals(u)&&(y=y.decapsulate(multiaddr(`/p2p/${u.toString()}`))),y}class AddressManager{log;components;listen;announce;appendAnnounce;announceFilter;observed;dnsMappings;ipMappings;transportAddresses;observedAddressFilter;addressVerificationTTL;addressVerificationRetry;constructor(u,g={}){const{listen:v=[],announce:b=[],appendAnnounce:w=[]}=g;this.components=u,this.log=u.logger.forComponent("libp2p:address-manager"),this.listen=v.map(E=>E.toString()),this.announce=new Set(b.map(E=>E.toString())),this.appendAnnounce=new Set(w.map(E=>E.toString())),this.observed=new ObservedAddresses(u,g),this.dnsMappings=new DNSMappings(u,g),this.ipMappings=new IPMappings(u,g),this.transportAddresses=new TransportAddresses(u,g),this.announceFilter=g.announceFilter??defaultAddressFilter,this.observedAddressFilter=createScalableCuckooFilter(1024),this.addressVerificationTTL=g.addressVerificationTTL??defaultValues$2.addressVerificationTTL,this.addressVerificationRetry=g.addressVerificationRetry??defaultValues$2.addressVerificationRetry,this._updatePeerStoreAddresses=debounce$1(this._updatePeerStoreAddresses.bind(this),1e3),u.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),u.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}[Symbol.toStringTag]="@libp2p/address-manager";_updatePeerStoreAddresses(){const u=this.getAddresses().map(g=>g.getComponents().findLast(v=>v.code===CODE_P2P)?.value===this.components.peerId.toString()?g.decapsulate(`/p2p/${this.components.peerId.toString()}`):g);this.components.peerStore.patch(this.components.peerId,{multiaddrs:u}).catch(g=>{this.log.error("error updating addresses - %e",g)})}getListenAddrs(){return Array.from(this.listen).map(u=>multiaddr(u))}getAnnounceAddrs(){return Array.from(this.announce).map(u=>multiaddr(u))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(u=>multiaddr(u))}getObservedAddrs(){return this.observed.getAll().map(u=>u.multiaddr)}addObservedAddr(u){const g=getNetConfig(u);let v;switch(g.type){case"ip4":{v=`${g.host}:${g.port}`;break}case"ip6":{v=`[${g.host}]:${g.port}`;break}default:return}this.observedAddressFilter.has(v)||(this.observedAddressFilter.add(v),u=stripPeerId(u,this.components.peerId),!this.ipMappings.has(u)&&(this.dnsMappings.has(u)||this.observed.add(u)))}confirmObservedAddr(u,g){u=stripPeerId(u,this.components.peerId);let v=!0;(g?.type==="transport"||this.transportAddresses.has(u))&&!this.transportAddresses.confirm(u,g?.ttl??this.addressVerificationTTL)&&v&&(v=!1),(g?.type==="dns-mapping"||this.dnsMappings.has(u))&&!this.dnsMappings.confirm(u,g?.ttl??this.addressVerificationTTL)&&v&&(v=!1),(g?.type==="ip-mapping"||this.ipMappings.has(u))&&!this.ipMappings.confirm(u,g?.ttl??this.addressVerificationTTL)&&v&&(v=!1),(g?.type==="observed"||this.observed.has(u))&&(this.maybeUpgradeToIPMapping(u)?(this.ipMappings.confirm(u,g?.ttl??this.addressVerificationTTL),v=!1):!this.observed.confirm(u,g?.ttl??this.addressVerificationTTL)&&v&&(v=!1)),v||this._updatePeerStoreAddresses()}removeObservedAddr(u,g){u=stripPeerId(u,this.components.peerId),this.observed.has(u)&&this.observed.remove(u),this.transportAddresses.has(u)&&this.transportAddresses.unconfirm(u,g?.ttl??this.addressVerificationRetry),this.dnsMappings.has(u)&&this.dnsMappings.unconfirm(u,g?.ttl??this.addressVerificationRetry),this.ipMappings.has(u)&&this.ipMappings.unconfirm(u,g?.ttl??this.addressVerificationRetry)}getAddresses(){const u=new Set,g=this.getAddressesWithMetadata().filter(v=>{if(!v.verified)return!1;const b=v.multiaddr.toString();return u.has(b)?!1:(u.add(b),!0)}).map(v=>v.multiaddr);return this.announceFilter(g.map(v=>{const b=multiaddr(v);return b.getComponents().pop()?.value===this.components.peerId.toString()?b:b.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const u=this.getAnnounceAddrs();if(u.length>0)return this.components.transportManager.getListeners().forEach(b=>{b.updateAnnounceAddrs(u)}),u.map(b=>({multiaddr:b,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let g=[];g=g.concat(this.components.transportManager.getAddrs().map(b=>this.transportAddresses.get(b,this.addressVerificationTTL)));const v=this.getAppendAnnounceAddrs();return v.length>0&&(this.components.transportManager.getListeners().forEach(b=>{b.updateAnnounceAddrs(v)}),g=g.concat(v.map(b=>({multiaddr:b,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),g=g.concat(this.observed.getAll()),g=g.concat(this.ipMappings.getAll(g)),g=g.concat(this.dnsMappings.getAll(g)),g}addDNSMapping(u,g){this.dnsMappings.add(u,g)}removeDNSMapping(u){this.dnsMappings.remove(multiaddr(`/dns/${u}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(u,g,v,b=g,w="tcp"){this.ipMappings.add(u,g,v,b,w),this.observed.removePrefixed(`/ip${isIPv4$1(v)?4:6}/${v}/${w}/${b}`)}removePublicAddressMapping(u,g,v,b=g,w="tcp"){this.ipMappings.remove(multiaddr(`/ip${isIPv4$1(v)?4:6}/${v}/${w}/${b}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(u){if(this.ipMappings.has(u)||!isNetworkAddress(u))return!1;const g=getNetConfig(u);if(g.type!=="ip4"||isPrivateIp(g.host)===!0)return!1;const v=this.components.transportManager.getListeners(),b=[w=>WebSockets$1.exactMatch(w)||WebSocketsSecure.exactMatch(w),w=>TCP.exactMatch(w),w=>QUIC_V1.exactMatch(w)];for(const w of b){if(!w(u))continue;const E=v.filter($=>$.getAddrs().filter(R=>getNetConfig(R).type==="ip4"&&w(R)).length>0);if(E.length!==1)continue;const S=E[0].getAddrs().filter($=>!isLoopback($)).pop();if(S==null)continue;const A=getNetConfig(S);return A.port==null?!1:(this.observed.remove(u),this.ipMappings.add(A.host,A.port,g.host,g.port,g.protocol),!0)}return!1}}var messages;(function(y){y.NOT_STARTED_YET="The libp2p node is not started yet",y.NOT_FOUND="Not found"})(messages||(messages={}));class MissingServiceError extends Error{constructor(u="Missing service"){super(u),this.name="MissingServiceError"}}class UnmetServiceDependenciesError extends Error{constructor(u="Unmet service dependencies"){super(u),this.name="UnmetServiceDependenciesError"}}class NoContentRoutersError extends Error{constructor(u="No content routers available"){super(u),this.name="NoContentRoutersError"}}class NoPeerRoutersError extends Error{constructor(u="No peer routers available"){super(u),this.name="NoPeerRoutersError"}}class QueriedForSelfError extends Error{constructor(u="Should not try to find self"){super(u),this.name="QueriedForSelfError"}}class UnhandledProtocolError extends Error{constructor(u="Unhandled protocol error"){super(u),this.name="UnhandledProtocolError"}}class DuplicateProtocolHandlerError extends Error{constructor(u="Duplicate protocol handler error"){super(u),this.name="DuplicateProtocolHandlerError"}}class DialDeniedError extends Error{constructor(u="Dial denied error"){super(u),this.name="DialDeniedError"}}class UnsupportedListenAddressError extends Error{constructor(u="No transport was configured to listen on this address"){super(u),this.name="UnsupportedListenAddressError"}}class UnsupportedListenAddressesError extends Error{constructor(u="Configured listen addresses could not be listened on"){super(u),this.name="UnsupportedListenAddressesError"}}class NoValidAddressesError extends Error{constructor(u="No valid addresses"){super(u),this.name="NoValidAddressesError"}}class ConnectionInterceptedError extends Error{constructor(u="Connection intercepted"){super(u),this.name="ConnectionInterceptedError"}}class ConnectionDeniedError extends Error{constructor(u="Connection denied"){super(u),this.name="ConnectionDeniedError"}}class MuxerUnavailableError extends Error{constructor(u="Stream is not multiplexed"){super(u),this.name="MuxerUnavailableError"}}class EncryptionFailedError extends Error{constructor(u="Encryption failed"){super(u),this.name="EncryptionFailedError"}}class TransportUnavailableError extends Error{constructor(u="Transport unavailable"){super(u),this.name="TransportUnavailableError"}}class RecursionLimitError extends Error{constructor(u="Max recursive depth reached"){super(u),this.name="RecursionLimitError"}}class DefaultComponents{components={};_started=!1;constructor(u={}){this.components={};for(const[g,v]of Object.entries(u))this.components[g]=v;this.components.logger==null&&(this.components.logger=defaultLogger())}isStarted(){return this._started}async _invokeStartableMethod(u){await Promise.all(Object.values(this.components).filter(g=>isStartable(g)).map(async g=>{await g[u]?.()}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const OPTIONAL_SERVICES=["metrics","connectionProtector","dns"],NON_SERVICE_PROPERTIES=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function defaultComponents(y={}){const u=new DefaultComponents(y);return new Proxy(u,{get(v,b,w){if(typeof b=="string"&&!NON_SERVICE_PROPERTIES.includes(b)){const E=u.components[b];if(E==null&&!OPTIONAL_SERVICES.includes(b))throw new MissingServiceError(`${b} not set`);return E}return Reflect.get(v,b,w)},set(v,b,w){return typeof b=="string"?u.components[b]=w:Reflect.set(v,b,w),!0}})}function checkServiceDependencies(y){const u={};for(const g of Object.values(y.components))for(const v of getServiceCapabilities(g))u[v]=!0;for(const g of Object.values(y.components))for(const v of getServiceDependencies(g))if(u[v]!==!0)throw new UnmetServiceDependenciesError(`Service "${getServiceName(g)}" required capability "${v}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function getServiceCapabilities(y){return Array.isArray(y?.[serviceCapabilities])?y[serviceCapabilities]:[]}function getServiceDependencies(y){return Array.isArray(y?.[serviceDependencies])?y[serviceDependencies]:[]}function getServiceName(y){return y?.[Symbol.toStringTag]??y?.toString()??"unknown"}function connectionGater(y={}){return y.denyDialMultiaddr==null&&(y.denyDialMultiaddr=u=>WebSockets$1.matches(u)?!0:isPrivate(u)),y}function getPeerAddress(y){if(isPeerId(y))return{peerId:y,multiaddrs:[]};let u=Array.isArray(y)?y:[y],g;if(u.length>0){const v=u[0].getComponents().findLast(b=>b.code===CODE_P2P)?.value;g=v==null?void 0:peerIdFromString$1(v),u.forEach(b=>{if(!isMultiaddr(b))throw new InvalidMultiaddrError$1("Invalid multiaddr");const w=b.getComponents().findLast(E=>E.code===CODE_P2P)?.value;if(w==null){if(g!=null)throw new InvalidParametersError$1("Multiaddrs must all have the same peer id or have no peer id")}else{const E=peerIdFromString$1(w);if(g?.equals(E)!==!0)throw new InvalidParametersError$1("Multiaddrs must all have the same peer id or have no peer id")}})}return u=u.filter(v=>!PEER_ID.exactMatch(v)),{peerId:g,multiaddrs:u}}const DEFAULT_CLOSABLE_PROTOCOLS=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function safelyCloseConnectionIfUnused(y,u){const g=y?.streams?.map(b=>b.protocol)??[],v=u?.closableProtocols??DEFAULT_CLOSABLE_PROTOCOLS;if(!(g.filter(b=>b!=null&&!v.includes(b)).length>0))try{await y?.close(u)}catch(b){y?.abort(b)}}function multiaddrToIpNet(y){const u=getNetConfig(y);let g=u.cidr;if(u.type!=="ip4"&&u.type!=="ip6")throw new InvalidParametersError$1(`Multiaddr ${y} was not an IPv4 or IPv6 address`);if(g==null)switch(u.type){case"ip4":{g=32;break}case"ip6":{g=128;break}default:throw new InvalidParametersError$1(`Multiaddr ${y} was not an IPv4 or IPv6 address`)}return new IpNet(u.host,g)}function isDirect(y){return!Circuit$1.exactMatch(y)}function findExistingConnection(y,u,g){if(y==null||u==null)return;const v=u.sort((w,E)=>w.direct?-1:E.direct?1:0).find(w=>w.limits==null);if(v==null||v.direct||g==null)return v;if(!g.some(w=>isDirect(w)))return v}class ConnectionPruner{connectionManager;peerStore;allow;events;log;constructor(u,g={}){this.allow=(g.allow??[]).map(v=>multiaddrToIpNet(v)),this.connectionManager=u.connectionManager,this.peerStore=u.peerStore,this.events=u.events,this.log=u.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(u=>{this.log.error("error while pruning connections - %e",u)})}async _maybePruneConnections(){const u=this.connectionManager.getConnections(),g=u.length,v=this.connectionManager.getMaxConnections();if(this.log("checking max connections limit %d/%d",g,v),g<=v)return;const b=new PeerMap;for(const A of u){const $=A.remotePeer;if(!b.has($)){b.set($,0);try{const R=await this.peerStore.get($);b.set($,[...R.tags.values()].reduce((T,O)=>T+O.value,0))}catch(R){R.name!=="NotFoundError"&&this.log.error("error loading peer tags - %e",R)}}}const w=this.sortConnections(u,b),E=Math.max(g-v,0),S=[];for(const A of w)if(this.log("too many connections open - closing a connection to %p",A.remotePeer),this.allow.some(R=>{if(isNetworkAddress(A.remoteAddr)){const T=getNetConfig(A.remoteAddr);return R.contains(T.host)}return!0})||S.push(A),S.length===E)break;await Promise.all(S.map(async A=>{await safelyCloseConnectionIfUnused(A,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:S})}sortConnections(u,g){return u.sort((v,b)=>{const w=v.timeline.open,E=b.timeline.open;return w<E?1:w>E?-1:0}).sort((v,b)=>v.direction==="outbound"&&b.direction==="inbound"?1:v.direction==="inbound"&&b.direction==="outbound"?-1:0).sort((v,b)=>v.streams.length>b.streams.length?1:v.streams.length<b.streams.length?-1:0).sort((v,b)=>{const w=g.get(v.remotePeer)??0,E=g.get(b.remotePeer)??0;return w>E?1:w<E?-1:0})}}const DIAL_TIMEOUT=1e4,CONNECTION_CLOSE_TIMEOUT=1e3,INBOUND_UPGRADE_TIMEOUT=1e4,PROTOCOL_NEGOTIATION_TIMEOUT=1e4,MAX_PEER_ADDRS_TO_DIAL=25,INBOUND_CONNECTION_THRESHOLD=5,MAX_INCOMING_PENDING_CONNECTIONS=10,MAX_PARALLEL_RECONNECTS=5,LAST_DIAL_FAILURE_KEY="last-dial-failure",LAST_DIAL_SUCCESS_KEY="last-dial-success",MAX_DIAL_QUEUE_LENGTH=500,MAX_RECURSIVE_DEPTH=32,MAX_CONNECTIONS$1=100,MAX_PARALLEL_DIALS=50;function reliableTransportsFirst(y,u){const g=TCP.exactMatch(y.multiaddr),v=TCP.exactMatch(u.multiaddr);if(g&&!v)return-1;if(!g&&v)return 1;const b=WebSocketsSecure.exactMatch(y.multiaddr),w=WebSocketsSecure.exactMatch(u.multiaddr);if(b&&!w)return-1;if(!b&&w)return 1;const E=WebSockets$1.exactMatch(y.multiaddr),S=WebSockets$1.exactMatch(u.multiaddr);if(E&&!S)return-1;if(!E&&S)return 1;const A=WebRTC.exactMatch(y.multiaddr),$=WebRTC.exactMatch(u.multiaddr);if(A&&!$)return-1;if(!A&&$)return 1;const R=WebRTCDirect.exactMatch(y.multiaddr),T=WebRTCDirect.exactMatch(u.multiaddr);if(R&&!T)return-1;if(!R&&T)return 1;const O=WebTransport.exactMatch(y.multiaddr),B=WebTransport.exactMatch(u.multiaddr);return O&&!B?-1:!O&&B?1:0}function loopbackAddressLast(y,u){const g=isLoopback(y.multiaddr),v=isLoopback(u.multiaddr);return g&&!v?1:!g&&v?-1:0}function publicAddressesFirst(y,u){const g=isPrivate(y.multiaddr),v=isPrivate(u.multiaddr);return g&&!v?1:!g&&v?-1:0}function certifiedAddressesFirst(y,u){return y.isCertified&&!u.isCertified?-1:!y.isCertified&&u.isCertified?1:0}function circuitRelayAddressesLast(y,u){const g=Circuit$1.exactMatch(y.multiaddr),v=Circuit$1.exactMatch(u.multiaddr);return g&&!v?1:!g&&v?-1:0}function defaultAddressSorter(y){return y.sort(reliableTransportsFirst).sort(certifiedAddressesFirst).sort(circuitRelayAddressesLast).sort(publicAddressesFirst).sort(loopbackAddressLast)}class DNSAddrResolver{dns;canResolve(u){return u.getComponents().some(({name:g})=>g==="dnsaddr")}async resolve(u,g){const v=u.getComponents().find(A=>A.name==="dnsaddr")?.value;if(v==null)return[u];const w=await this.getDNS(g).query(`_dnsaddr.${v}`,{signal:g?.signal,types:[RecordType.TXT]}),E=u.getComponents().find(A=>A.name==="p2p")?.value,S=[];for(const A of w.Answer){const $=A.data.replace(/["']/g,"").trim().split("=")[1];$!=null&&(E!=null&&!$.includes(E)||S.push(multiaddr($)))}return S}getDNS(u){return u.dns!=null?u.dns:(this.dns==null&&(this.dns=dns()),this.dns)}}const dnsaddrResolver=new DNSAddrResolver;async function resolveMultiaddr(y,u,g){const v=g.depth??0;if(v>(g.maxRecursiveDepth??MAX_RECURSIVE_DEPTH))throw new RecursionLimitError("Max recursive depth reached");let b=!1;const w=[];for(const E of Object.values(u))if(E.canResolve(y)){b=!0;const S=await E.resolve(y,g);for(const A of S)w.push(...await resolveMultiaddr(A,u,{...g,depth:v+1}))}return b===!1&&w.push(y),w}const defaultOptions$1={maxParallelDials:MAX_PARALLEL_DIALS,maxDialQueueLength:MAX_DIAL_QUEUE_LENGTH,maxPeerAddrsToDial:MAX_PEER_ADDRS_TO_DIAL,dialTimeout:DIAL_TIMEOUT,resolvers:{dnsaddr:dnsaddrResolver}};class DialQueue{queue;components;addressSorter;maxPeerAddrsToDial;maxDialQueueLength;dialTimeout;shutDownController;connections;log;resolvers;constructor(u,g={}){this.addressSorter=g.addressSorter,this.maxPeerAddrsToDial=g.maxPeerAddrsToDial??defaultOptions$1.maxPeerAddrsToDial,this.maxDialQueueLength=g.maxDialQueueLength??defaultOptions$1.maxDialQueueLength,this.dialTimeout=g.dialTimeout??defaultOptions$1.dialTimeout,this.connections=g.connections??new PeerMap,this.log=u.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=u,this.resolvers=g.resolvers??defaultOptions$1.resolvers,this.shutDownController=new AbortController,this.shutDownController.signal,this.queue=new PriorityQueue({concurrency:g.maxParallelDials??defaultOptions$1.maxParallelDials,metricName:"libp2p_dial_queue",metrics:u.metrics}),this.queue.addEventListener("failure",v=>{v.detail?.error.name!==AbortError$6.name&&this.log.error("error in dial queue - %e",v.detail.error)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(u,g={}){const{peerId:v,multiaddrs:b}=getPeerAddress(u);if(v!=null&&g.force!==!0){const E=findExistingConnection(v,this.connections.get(v),b);if(E!=null)return this.log("already connected to %a",E.remoteAddr),g.onProgress?.(new CustomProgressEvent("dial-queue:already-connected")),E}const w=this.queue.queue.find(E=>{if(v?.equals(E.options.peerId)===!0)return!0;const S=E.options.multiaddrs;if(S==null)return!1;for(const A of b)if(S.has(A.toString()))return!0;return!1});if(w!=null){this.log("joining existing dial target for %p",v);for(const E of b)w.options.multiaddrs.add(E.toString());return g.onProgress?.(new CustomProgressEvent("dial-queue:already-in-dial-queue")),w.join(g)}if(this.queue.size>=this.maxDialQueueLength)throw new DialError("Dial queue is full");return this.log("creating dial target for %p",v,b.map(E=>E.toString())),g.onProgress?.(new CustomProgressEvent("dial-queue:add-to-dial-queue")),this.queue.add(async E=>{E.onProgress?.(new CustomProgressEvent("dial-queue:start-dial"));const S=anySignal([this.shutDownController.signal,E.signal]);try{return await this.dialPeer(E,S)}finally{S.clear()}},{peerId:v,priority:g.priority??DEFAULT_DIAL_PRIORITY,multiaddrs:new Set(b.map(E=>E.toString())),signal:g.signal??AbortSignal.timeout(this.dialTimeout),onProgress:g.onProgress})}async dialPeer(u,g){const v=u.peerId,b=u.multiaddrs,w=new Set;let E=u.multiaddrs.size===0,S=0,A=0;const $=[];for(this.log("starting dial to %p",v);E||b.size>0;){A++,E=!1;const R=[],T=new Set(u.multiaddrs);b.clear(),this.log("calculating addrs to dial %p from %s",v,[...T]);const O=await this.calculateMultiaddrs(v,T,{...u,signal:g});for(const B of O){if(w.has(B.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",B.multiaddr,v);continue}R.push(B)}this.log("%s dial to %p with %s",A===1?"starting":"continuing",v,R.map(B=>B.multiaddr.toString())),u?.onProgress?.(new CustomProgressEvent("dial-queue:calculated-addresses",R));for(const B of R){if(S===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",S,u.peerId),new DialError("Peer had more than maxPeerAddrsToDial");S++;try{const F=await this.components.transportManager.dial(B.multiaddr,{...u,signal:g});this.log("dial to %a succeeded",B.multiaddr);try{await this.components.peerStore.merge(F.remotePeer,{multiaddrs:[F.remoteAddr],metadata:{[LAST_DIAL_SUCCESS_KEY]:fromString$1(Date.now().toString())}})}catch(U){this.log.error("could not update last dial failure key for %p - %e",v,U)}return F}catch(F){if(this.log.error("dial failed to %a - %e",B.multiaddr,F),w.add(B.multiaddr.toString()),v!=null)try{await this.components.peerStore.merge(v,{metadata:{[LAST_DIAL_FAILURE_KEY]:fromString$1(Date.now().toString())}})}catch(U){this.log.error("could not update last dial failure key for %p - %e",v,U)}if(g.aborted)throw new TimeoutError$2(F.message);$.push(F)}}}throw $.length===1?$[0]:new AggregateError($,"All multiaddr dials failed")}async calculateMultiaddrs(u,g=new Set,v={}){const b=[...g].map(T=>({multiaddr:multiaddr(T),isCertified:!1}));if(u!=null){if(this.components.peerId.equals(u))throw new DialError("Tried to dial self");if(await this.components.connectionGater.denyDialPeer?.(u)===!0)throw new DialDeniedError("The dial request is blocked by gater.allowDialPeer");if(b.length===0){this.log("loading multiaddrs for %p",u);try{const T=await this.components.peerStore.get(u);b.push(...T.addresses),this.log("loaded multiaddrs for %p",u,b.map(({multiaddr:O})=>O.toString()))}catch(T){if(T.name!=="NotFoundError")throw T}}if(b.length===0){this.log("looking up multiaddrs for %p in the peer routing",u);try{const T=await this.components.peerRouting.findPeer(u,v);this.log("found multiaddrs for %p in the peer routing",u,b.map(({multiaddr:O})=>O.toString())),b.push(...T.multiaddrs.map(O=>({multiaddr:O,isCertified:!1})))}catch(T){T.name==="NoPeerRoutersError"?this.log("no peer routers configured",u):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",u,T)}}}let w=(await Promise.all(b.map(async T=>{const O=await resolveMultiaddr(T.multiaddr,this.resolvers,{dns:this.components.dns,log:this.log,...v});return O.length===1&&O[0].equals(T.multiaddr)?T:O.map(B=>({multiaddr:B,isCertified:!1}))}))).flat();if(u!=null){const T=`/p2p/${u.toString()}`;w=w.map(O=>O.multiaddr.getComponents().pop()?.name!=="p2p"?{multiaddr:O.multiaddr.encapsulate(T),isCertified:O.isCertified}:O)}const E=w.filter(T=>{if(this.components.transportManager.dialTransportForMultiaddr(T.multiaddr)==null)return!1;const O=T.multiaddr.getComponents().findLast(B=>B.code===CODE_P2P)?.value;return u!=null&&O!=null?u.equals(O):!0}),S=new Map;for(const T of E){const O=T.multiaddr.toString(),B=S.get(O);if(B!=null){B.isCertified=B.isCertified||T.isCertified||!1;continue}S.set(O,T)}const A=[...S.values()];if(A.length===0)throw new NoValidAddressesError("The dial request has no valid addresses");const $=[];for(const T of A)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(T.multiaddr)||$.push(T);const R=this.addressSorter==null?defaultAddressSorter($):$.sort(this.addressSorter);if(R.length===0)throw new DialDeniedError("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",u??"unknown peer",w.map(({multiaddr:T})=>T.toString())),this.log.trace("addresses for %p after filtering",u??"unknown peer",R.map(({multiaddr:T})=>T.toString())),R}async isDialable(u,g={}){Array.isArray(u)||(u=[u]);try{const v=await this.calculateMultiaddrs(void 0,new Set(u.map(b=>b.toString())),g);return g.runOnLimitedConnection===!1?v.find(b=>!Circuit$1.matches(b.multiaddr))!=null:!0}catch{}return!1}}const objectToString=Object.prototype.toString,isError=y=>objectToString.call(y)==="[object Error]",errorMessages=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function isNetworkError(y){if(!(y&&isError(y)&&y.name==="TypeError"&&typeof y.message=="string"))return!1;const{message:g,stack:v}=y;return g==="Load failed"?v===void 0||"__sentry_captured__"in y:g.startsWith("error sending request for url")?!0:errorMessages.has(g)}function validateRetries(y){if(typeof y=="number"){if(y<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(y))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(y!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function validateNumberOption(y,u,{min:g=0,allowInfinity:v=!1}={}){if(u!==void 0){if(typeof u!="number"||Number.isNaN(u))throw new TypeError(`Expected \`${y}\` to be a number${v?" or Infinity":""}.`);if(!v&&!Number.isFinite(u))throw new TypeError(`Expected \`${y}\` to be a finite number.`);if(u<g)throw new TypeError(`Expected \`${y}\` to be  ${g}.`)}}class AbortError extends Error{constructor(u){super(),u instanceof Error?(this.originalError=u,{message:u}=u):(this.originalError=new Error(u),this.originalError.stack=this.stack),this.name="AbortError",this.message=u}}function calculateDelay(y,u){const g=Math.max(1,y+1),v=u.randomize?Math.random()+1:1;let b=Math.round(v*u.minTimeout*u.factor**(g-1));return b=Math.min(b,u.maxTimeout),b}function calculateRemainingTime(y,u){return Number.isFinite(u)?u-(performance.now()-y):u}async function onAttemptFailure({error:y,attemptNumber:u,retriesConsumed:g,startTime:v,options:b}){const w=y instanceof Error?y:new TypeError(`Non-error was thrown: "${y}". You should only throw errors.`);if(w instanceof AbortError)throw w.originalError;const E=Number.isFinite(b.retries)?Math.max(0,b.retries-g):b.retries,S=b.maxRetryTime??Number.POSITIVE_INFINITY,A=Object.freeze({error:w,attemptNumber:u,retriesLeft:E,retriesConsumed:g});if(await b.onFailedAttempt(A),calculateRemainingTime(v,S)<=0)throw w;const $=await b.shouldConsumeRetry(A),R=calculateRemainingTime(v,S);if(R<=0||E<=0)throw w;if(w instanceof TypeError&&!isNetworkError(w)){if($)throw w;return b.signal?.throwIfAborted(),!1}if(!await b.shouldRetry(A))throw w;if(!$)return b.signal?.throwIfAborted(),!1;const T=calculateDelay(g,b),O=Math.min(T,R);return O>0&&await new Promise((B,F)=>{const U=()=>{clearTimeout(q),b.signal?.removeEventListener("abort",U),F(b.signal.reason)},q=setTimeout(()=>{b.signal?.removeEventListener("abort",U),B()},O);b.unref&&q.unref?.(),b.signal?.addEventListener("abort",U,{once:!0})}),b.signal?.throwIfAborted(),!0}async function pRetry(y,u={}){if(u={...u},validateRetries(u.retries),Object.hasOwn(u,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");u.retries??=10,u.factor??=2,u.minTimeout??=1e3,u.maxTimeout??=Number.POSITIVE_INFINITY,u.maxRetryTime??=Number.POSITIVE_INFINITY,u.randomize??=!1,u.onFailedAttempt??=()=>{},u.shouldRetry??=()=>!0,u.shouldConsumeRetry??=()=>!0,validateNumberOption("factor",u.factor,{min:0,allowInfinity:!1}),validateNumberOption("minTimeout",u.minTimeout,{min:0,allowInfinity:!1}),validateNumberOption("maxTimeout",u.maxTimeout,{min:0,allowInfinity:!0}),validateNumberOption("maxRetryTime",u.maxRetryTime,{min:0,allowInfinity:!0}),u.factor>0||(u.factor=1),u.signal?.throwIfAborted();let g=0,v=0;const b=performance.now();for(;!Number.isFinite(u.retries)||v<=u.retries;){g++;try{u.signal?.throwIfAborted();const w=await y(g);return u.signal?.throwIfAborted(),w}catch(w){await onAttemptFailure({error:w,attemptNumber:g,retriesConsumed:v,startTime:b,options:u})&&v++}}throw new Error("Retry attempts exhausted without throwing an error.")}class ReconnectQueue{log;queue;started;peerStore;retries;retryInterval;backoffFactor;connectionManager;events;constructor(u,g={}){this.log=u.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=u.peerStore,this.connectionManager=u.connectionManager,this.queue=new PeerQueue({concurrency:g.maxParallelReconnects??MAX_PARALLEL_RECONNECTS,metricName:"libp2p_reconnect_queue",metrics:u.metrics}),this.started=!1,this.retries=g.retries??5,this.backoffFactor=g.backoffFactor,this.retryInterval=g.retryInterval,this.events=u.events,u.events.addEventListener("peer:disconnect",v=>{this.maybeReconnect(v.detail).catch(b=>{this.log.error("failed to maybe reconnect to %p - %e",v.detail,b)})})}async maybeReconnect(u){if(!this.started)return;const g=await this.peerStore.get(u);hasKeepAliveTag(g)&&(this.queue.has(u)||this.queue.add(async v=>{await pRetry(async b=>{if(this.started)try{await this.connectionManager.openConnection(u,{signal:v?.signal})}catch(w){throw this.log("reconnecting to %p attempt %d of %d failed - %e",u,b,this.retries,w),w}},{signal:v?.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:u}).catch(async v=>{this.log.error("failed to reconnect to %p - %e",u,v);const b={};[...g.tags.keys()].forEach(w=>{w.startsWith(KEEP_ALIVE)&&(b[w]=void 0)}),await this.peerStore.merge(u,{tags:b}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:u})}).catch(async v=>{this.log.error("failed to remove keep-alive tag from %p - %e",u,v)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const u=await this.peerStore.all({filters:[g=>hasKeepAliveTag(g)]});await Promise.all(u.map(async g=>{await this.connectionManager.openConnection(g.id).catch(v=>{this.log.error("could not open connection to keepalive peer - %e",v)})}))}).catch(u=>{this.log.error("error reconnect to peers after start - %e",u)})}stop(){this.started=!1,this.queue.abort()}}function hasKeepAliveTag(y){for(const u of y.tags.keys())if(u.startsWith(KEEP_ALIVE))return!0;return!1}const DEFAULT_DIAL_PRIORITY=50,defaultOptions={maxConnections:MAX_CONNECTIONS$1,inboundConnectionThreshold:INBOUND_CONNECTION_THRESHOLD,maxIncomingPendingConnections:MAX_INCOMING_PENDING_CONNECTIONS};class DefaultConnectionManager{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;outboundPendingConnections;maxConnections;dialQueue;reconnectQueue;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;log;peerId;constructor(u,g={}){if(this.maxConnections=g.maxConnections??defaultOptions.maxConnections,this.maxConnections<1)throw new InvalidParametersError$1("Connection Manager maxConnections must be greater than 0");this.connections=new PeerMap,this.started=!1,this.peerId=u.peerId,this.peerStore=u.peerStore,this.metrics=u.metrics,this.events=u.events,this.log=u.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(g.allow??[]).map(v=>multiaddrToIpNet(multiaddr(v))),this.deny=(g.deny??[]).map(v=>multiaddrToIpNet(multiaddr(v))),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=g.maxIncomingPendingConnections??defaultOptions.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new RateLimiter({points:g.inboundConnectionThreshold??defaultOptions.inboundConnectionThreshold,duration:1}),this.connectionPruner=new ConnectionPruner({connectionManager:this,peerStore:u.peerStore,events:u.events,logger:u.logger},{allow:g.allow?.map(v=>multiaddr(v))}),this.dialQueue=new DialQueue(u,{addressSorter:g.addressSorter,maxParallelDials:g.maxParallelDials??MAX_PARALLEL_DIALS,maxDialQueueLength:g.maxDialQueueLength??MAX_DIAL_QUEUE_LENGTH,maxPeerAddrsToDial:g.maxPeerAddrsToDial??MAX_PEER_ADDRS_TO_DIAL,dialTimeout:g.dialTimeout??DIAL_TIMEOUT,resolvers:g.resolvers??{dnsaddr:dnsaddrResolver},connections:this.connections}),this.reconnectQueue=new ReconnectQueue({events:u.events,peerStore:u.peerStore,logger:u.logger,connectionManager:this},{retries:g.reconnectRetries,retryInterval:g.reconnectRetryInterval,backoffFactor:g.reconnectBackoffFactor,maxParallelReconnects:g.maxParallelReconnects})}[Symbol.toStringTag]="@libp2p/connection-manager";async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const u={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const g of this.connections.values())for(const v of g)u[v.direction]++;return u}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const u={};for(const g of this.connections.values())for(const v of g)for(const b of v.streams){const w=`${b.direction} ${b.protocol??"unnegotiated"}`;u[w]=(u[w]??0)+1}return u}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const u={};for(const v of this.connections.values())for(const b of v){const w={};for(const E of b.streams){const S=`${E.direction} ${E.protocol??"unnegotiated"}`;w[S]=(w[S]??0)+1}for(const[E,S]of Object.entries(w))u[E]=u[E]??[],u[E].push(S)}const g={};for(let[v,b]of Object.entries(u)){b=b.sort((E,S)=>E-S);const w=Math.floor(b.length*.9);g[v]=b[w]}return g}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await start(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await stop(this.reconnectQueue,this.dialQueue,this.connectionPruner);const u=[];for(const g of this.connections.values())for(const v of g)u.push(Promise.all([pEvent(v,"close",{signal:AbortSignal.timeout(500)}),v.close({signal:AbortSignal.timeout(500)})]).catch(b=>{v.abort(b)}));this.log("closing %d connections",u.length),await Promise.all(u),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}setMaxConnections(u){if(this.maxConnections<1)throw new InvalidParametersError$1("Connection Manager maxConnections must be greater than 0");let g=!1;u<this.maxConnections&&(g=!0),this.maxConnections=u,g&&this.connectionPruner.maybePruneConnections()}onConnect(u){this._onConnect(u).catch(g=>{this.log.error("could not connect - %e",g)})}async _onConnect(u){const{detail:g}=u;if(!this.started){await g.close();return}if(g.status!=="open")return;const v=g.remotePeer,b=!this.connections.has(v),w=this.connections.get(v)??[];w.push(g),this.connections.set(v,w),v.publicKey!=null&&v.type==="RSA"&&await this.peerStore.patch(v,{publicKey:v.publicKey}),b&&this.events.safeDispatchEvent("peer:connect",{detail:g.remotePeer})}onDisconnect(u){const{detail:g}=u,v=g.remotePeer,w=(this.connections.get(v)??[]).filter(E=>E.id!==g.id);this.connections.set(v,w),w.length===0&&(this.log.trace("peer %p disconnected, removing connection map entry",v),this.connections.delete(v),this.events.safeDispatchEvent("peer:disconnect",{detail:v}))}getConnections(u){if(u!=null)return this.connections.get(u)??[];let g=[];for(const v of this.connections.values())g=g.concat(v);return g}getConnectionsMap(){return this.connections}async openConnection(u,g={}){if(!this.started)throw new NotStartedError("Not started");this.outboundPendingConnections++;try{g.signal?.throwIfAborted();const{peerId:v,multiaddrs:b}=getPeerAddress(u);if(this.peerId.equals(v))throw new InvalidPeerIdError("Can not dial self");if(v!=null&&g.force!==!0){this.log("dial %p",v);const A=findExistingConnection(v,this.getConnections(v),b);if(A!=null)return this.log("had an existing connection to %p as %a",v,A.remoteAddr),g.onProgress?.(new CustomProgressEvent("dial-queue:already-connected")),A}const w=await this.dialQueue.dial(u,{...g,priority:g.priority??DEFAULT_DIAL_PRIORITY});if(w.status!=="open")throw new ConnectionClosedError("Remote closed connection during opening");let E=this.connections.get(w.remotePeer);E==null&&(E=[],this.connections.set(w.remotePeer,E));let S=!1;for(const A of E)if(A.id===w.id&&(S=!0),g.force!==!0&&A.id!==w.id&&A.remoteAddr.equals(w.remoteAddr))return w.abort(new InvalidMultiaddrError$1("Duplicate multiaddr connection")),A;return S||E.push(w),w}finally{this.outboundPendingConnections--}}async openStream(u,g,v={}){return(await this.openConnection(u,v)).newStream(g,v)}async closeConnections(u,g={}){const v=this.connections.get(u)??[];await Promise.all(v.map(async b=>{try{await Promise.all([pEvent(b,"close",g),b.close(g)])}catch(w){b.abort(w)}}))}acceptIncomingConnection(u){if(this.deny.some(b=>{if(isNetworkAddress(u.remoteAddr)){const w=getNetConfig(u.remoteAddr);return b.contains(w.host)}return!1}))return this.log("connection from %a refused - connection remote address was in deny list",u.remoteAddr),!1;if(this.allow.some(b=>{if(isNetworkAddress(u.remoteAddr)){const w=getNetConfig(u.remoteAddr);return b.contains(w.host)}return!0}))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",u.remoteAddr),!1;if(isNetworkAddress(u.remoteAddr)){const b=getNetConfig(u.remoteAddr);try{this.inboundConnectionRateLimiter.consume(b.host,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",u.remoteAddr,b.host),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",u.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const u={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(g=>({id:g.id,status:u[g.status],peerId:g.options.peerId,multiaddrs:[...g.options.multiaddrs].map(v=>multiaddr(v))}))}async isDialable(u,g={}){return this.dialQueue.isDialable(u,g)}}const DEFAULT_PING_INTERVAL_MS=1e4,PROTOCOL_VERSION$2="1.0.0",PROTOCOL_NAME$2="ping",PROTOCOL_PREFIX$2="ipfs",PING_LENGTH$1=32,DEFAULT_ABORT_CONNECTION_ON_PING_FAILURE=!0;class ConnectionMonitor{protocol;components;log;heartbeatInterval;pingIntervalMs;abortController;timeout;abortConnectionOnPingFailure;constructor(u,g={}){this.components=u,this.protocol=`/${g.protocolPrefix??PROTOCOL_PREFIX$2}/${PROTOCOL_NAME$2}/${PROTOCOL_VERSION$2}`,this.log=u.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=g.pingInterval??DEFAULT_PING_INTERVAL_MS,this.abortConnectionOnPingFailure=g.abortConnectionOnPingFailure??DEFAULT_ABORT_CONNECTION_ON_PING_FAILURE,this.timeout=new AdaptiveTimeout({...g.pingTimeout??{},metrics:u.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}[Symbol.toStringTag]="@libp2p/connection-monitor";[serviceCapabilities]=["@libp2p/connection-monitor"];start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(u=>{Promise.resolve().then(async()=>{let g=Date.now();try{const v=this.timeout.getTimeoutSignal({signal:this.abortController?.signal}),b=await u.newStream(this.protocol,{signal:v,runOnLimitedConnection:!0}),w=byteStream(b);g=Date.now(),await Promise.all([w.write(randomBytes$1(PING_LENGTH$1),{signal:v}),w.read({bytes:PING_LENGTH$1,signal:v})]),u.rtt=Date.now()-g,await b.close({signal:v})}catch(v){if(v.name!=="UnsupportedProtocolError")throw v;u.rtt=(Date.now()-g)/2}}).catch(g=>{this.log.error("error during heartbeat - %e",g),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),u.abort(g)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){this.abortController?.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}class CompoundContentRouting{routers;started;components;constructor(u,g){this.routers=g.routers??[],this.started=!1,this.components=u,this.findProviders=u.metrics?.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([v],b)=>({...b,cid:v.toString()}),getAttributesFromYieldedValue:(v,b)=>({...b,providers:[...Array.isArray(b.providers)?b.providers:[],v.id.toString()]})})??this.findProviders,this.provide=u.metrics?.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([v],b)=>({...b,cid:v.toString()})})??this.provide,this.cancelReprovide=u.metrics?.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([v],b)=>({...b,cid:v.toString()})})??this.cancelReprovide,this.put=u.metrics?.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([v])=>({key:toString$3(v,"base36")})})??this.put,this.get=u.metrics?.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([v])=>({key:toString$3(v,"base36")})})??this.get}[Symbol.toStringTag]="@libp2p/content-routing";isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(u,g={}){if(this.routers.length===0)throw new NoContentRoutersError("No content routers available");const v=this,b=new PeerSet;for await(const w of merge$1(...v.routers.filter(E=>E.findProviders instanceof Function).map(E=>E.findProviders(u,g))))w!=null&&(w.multiaddrs.length>0&&await this.components.peerStore.merge(w.id,{multiaddrs:w.multiaddrs},g),!b.has(w.id)&&(b.add(w.id),yield w))}async provide(u,g={}){if(this.routers.length===0)throw new NoContentRoutersError("No content routers available");await Promise.all(this.routers.filter(v=>v.provide instanceof Function).map(async v=>{await v.provide(u,g)}))}async cancelReprovide(u,g={}){if(this.routers.length===0)throw new NoContentRoutersError("No content routers available");await Promise.all(this.routers.filter(v=>v.cancelReprovide instanceof Function).map(async v=>{await v.cancelReprovide(u,g)}))}async put(u,g,v){if(!this.isStarted())throw new NotStartedError;await Promise.all(this.routers.filter(b=>b.put instanceof Function).map(async b=>{await b.put(u,g,v)}))}async get(u,g){if(!this.isStarted())throw new NotStartedError;return Promise.any(this.routers.filter(v=>v.get instanceof Function).map(async v=>v.get(u,g)))}}const CustomEvent$1=globalThis.CustomEvent??Event;async function*parallel(y,u={}){let g=u.concurrency??1/0;g<1&&(g=1/0);const v=u.ordered??!1,b=new EventTarget,w=[];let E=pDefer(),S=pDefer(),A=!1,$,R=!1;b.addEventListener("task-complete",()=>{S.resolve()}),Promise.resolve().then(async()=>{try{for await(const F of y){if(w.length===g&&(E=pDefer(),await E.promise),R)break;const U={done:!1};w.push(U),F().then(q=>{U.done=!0,U.ok=!0,U.value=q,b.dispatchEvent(new CustomEvent$1("task-complete"))},q=>{U.done=!0,U.err=q,b.dispatchEvent(new CustomEvent$1("task-complete"))})}A=!0,b.dispatchEvent(new CustomEvent$1("task-complete"))}catch(F){$=F,b.dispatchEvent(new CustomEvent$1("task-complete"))}});function T(){return v?w[0]?.done:!!w.find(F=>F.done)}function*O(){for(;w.length>0&&w[0].done;){const F=w[0];if(w.shift(),F.ok)yield F.value;else throw R=!0,E.resolve(),F.err;E.resolve()}}function*B(){for(;T();)for(let F=0;F<w.length;F++)if(w[F].done){const U=w[F];if(w.splice(F,1),F--,U.ok)yield U.value;else throw R=!0,E.resolve(),U.err;E.resolve()}}for(;;){if(T()||(S=pDefer(),await S.promise),$!=null||(v?yield*O():yield*B(),$!=null))throw $;if(A&&w.length===0)break}}class DefaultPeerRouting{log;peerId;peerStore;routers;constructor(u,g={}){this.log=u.logger.forComponent("libp2p:peer-routing"),this.peerId=u.peerId,this.peerStore=u.peerStore,this.routers=g.routers??[],this.findPeer=u.metrics?.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([v],b)=>({...b,peer:v.toString()})})??this.findPeer,this.getClosestPeers=u.metrics?.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([v],b)=>({...b,key:toString$3(v,"base36")}),getAttributesFromYieldedValue:(v,b)=>({...b,peers:[...Array.isArray(b.peers)?b.peers:[],v.id.toString()]})})??this.getClosestPeers}[Symbol.toStringTag]="@libp2p/peer-routing";async findPeer(u,g){if(this.routers.length===0)throw new NoPeerRoutersError("No peer routers available");if(u.toString()===this.peerId.toString())throw new QueriedForSelfError("Should not try to find self");const v=this,b=merge$1(...this.routers.filter(w=>w.findPeer instanceof Function).map(w=>(async function*(){try{yield await w.findPeer(u,g)}catch(E){v.log.error("router failed to find peer - %e",E)}})()));for await(const w of b)if(w!=null)return w.multiaddrs.length>0&&await this.peerStore.merge(w.id,{multiaddrs:w.multiaddrs},g),w;throw new NotFoundError$1}async*getClosestPeers(u,g={}){if(this.routers.length===0)throw new NoPeerRoutersError("No peer routers available");const v=this,b=createScalableCuckooFilter(1024);for await(const w of parallel((async function*(){const E=merge$1(...v.routers.filter(S=>S.getClosestPeers instanceof Function).map(S=>S.getClosestPeers(u,g)));for await(let S of E)yield async()=>{if(S.multiaddrs.length===0)try{S=await v.findPeer(S.id,{...g,useCache:!1})}catch(A){v.log.error("could not find peer multiaddrs - %e",A);return}return S}})()))w!=null&&(w.multiaddrs.length>0&&await this.peerStore.merge(w.id,{multiaddrs:w.multiaddrs},g),!b.has(w.id.toMultihash().bytes)&&(b.add(w.id.toMultihash().bytes),yield w))}}class RandomWalk extends TypedEventEmitter{peerRouting;log;walking;walkers;shutdownController;walkController;needNext;constructor(u){super(),this.log=u.logger.forComponent("libp2p:random-walk"),this.peerRouting=u.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}[Symbol.toStringTag]="@libp2p/random-walk";start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(u){this.walking||this.startWalk(),this.walkers++;const g=anySignal([this.shutdownController.signal,u?.signal]);try{for(;;)this.needNext?.resolve(),this.needNext=pDefer(),yield(await pEvent(this,"walk:peer",{signal:g,rejectionEvents:["walk:error"]})).detail}catch(v){throw v.detail!=null?v.detail:v}finally{g.clear(),this.walkers--,this.walkers===0&&(this.walkController?.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const u=anySignal([this.walkController.signal,this.shutdownController.signal]),g=Date.now();let v=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const b=randomBytes$1(32);let w=Date.now();for await(const E of this.peerRouting.getClosestPeers(b,{signal:u}))u.aborted&&this.log("aborting walk"),u.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",E.id,Date.now()-w,this.walkers),v++,this.safeDispatchEvent("walk:peer",{detail:E}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await raceSignal$2(this.needNext.promise,u)),w=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",b,this.walkers,v)}catch(b){this.log.error("random walk errored - %e",b),this.safeDispatchEvent("walk:error",{detail:b})}this.log("no walkers left, ended walk")}).catch(b=>{this.log.error("random walk errored - %e",b)}).finally(()=>{this.log("finished walk, found %d peers after %dms",v,Date.now()-g),this.walking=!1})}}const DEFAULT_MAX_INBOUND_STREAMS$1=32,DEFAULT_MAX_OUTBOUND_STREAMS$1=64;class Registrar{log;topologies;handlers;components;middleware;constructor(u){this.components=u,this.log=u.logger.forComponent("libp2p:registrar"),this.middleware=new Map,this.topologies=new Map,u.metrics?.registerMetricGroup("libp2p_registrar_topologies",{calculate:()=>{const g={};for(const[v,b]of this.topologies)g[v]=b.size;return g}}),this.handlers=trackedMap({name:"libp2p_registrar_protocol_handlers",metrics:u.metrics}),this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}[Symbol.toStringTag]="@libp2p/registrar";getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(u){const g=this.handlers.get(u);if(g==null)throw new UnhandledProtocolError(`No handler registered for protocol ${u}`);return g}getTopologies(u){const g=this.topologies.get(u);return g==null?[]:[...g.values()]}async handle(u,g,v){if(this.handlers.has(u)&&v?.force!==!0)throw new DuplicateProtocolHandlerError(`Handler already registered for protocol ${u}`);this.handlers.set(u,{handler:g,options:{maxInboundStreams:DEFAULT_MAX_INBOUND_STREAMS$1,maxOutboundStreams:DEFAULT_MAX_OUTBOUND_STREAMS$1,...v}}),await this.components.peerStore.merge(this.components.peerId,{protocols:[u]},v)}async unhandle(u,g){(Array.isArray(u)?u:[u]).forEach(b=>{this.handlers.delete(b)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()},g)}async register(u,g){if(g==null)throw new InvalidParametersError$1("invalid topology");const v=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let b=this.topologies.get(u);return b==null&&(b=new Map,this.topologies.set(u,b)),b.set(v,g),v}unregister(u){for(const[g,v]of this.topologies.entries())v.has(u)&&(v.delete(u),v.size===0&&this.topologies.delete(g))}use(u,g){this.middleware.set(u,g)}unuse(u){this.middleware.delete(u)}getMiddleware(u){return this.middleware.get(u)??[]}async _onDisconnect(u){const g=u.detail,v={signal:AbortSignal.timeout(5e3)};try{const b=await this.components.peerStore.get(g,v);for(const w of b.protocols){const E=this.topologies.get(w);E!=null&&await Promise.all([...E.values()].map(async S=>{S.filter?.has(g)!==!1&&(S.filter?.remove(g),await S.onDisconnect?.(g))}))}}catch(b){if(b.name==="NotFoundError")return;this.log.error("could not inform topologies of disconnecting peer %p - %e",g,b)}}async _onPeerUpdate(u){const{peer:g,previous:v}=u.detail,b=(v?.protocols??[]).filter(w=>!g.protocols.includes(w));try{for(const w of b){const E=this.topologies.get(w);E!=null&&await Promise.all([...E.values()].map(async S=>{S.filter?.has(g.id)!==!1&&(S.filter?.remove(g.id),await S.onDisconnect?.(g.id))}))}}catch(w){this.log.error("could not inform topologies of updated peer %p - %e",g.id,w)}}async _onPeerIdentify(u){const g=u.detail.protocols,v=u.detail.connection,b=u.detail.peerId;try{for(const w of g){const E=this.topologies.get(w);E!=null&&await Promise.all([...E.values()].map(async S=>{v.limits!=null&&S.notifyOnLimitedConnection!==!0||S.filter?.has(b)!==!0&&(S.filter?.add(b),await S.onConnect?.(b,v))}))}}catch(w){this.log.error("could not inform topologies of updated peer after identify %p - %e",b,w)}}}class DefaultTransportManager{log;components;transports;listeners;faultTolerance;started;constructor(u,g={}){this.log=u.logger.forComponent("libp2p:transports"),this.components=u,this.started=!1,this.transports=trackedMap({name:"libp2p_transport_manager_transports",metrics:this.components.metrics}),this.listeners=trackedMap({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=g.faultTolerance??FaultTolerance.FATAL_ALL}[Symbol.toStringTag]="@libp2p/transport-manager";add(u){const g=u[Symbol.toStringTag];if(g==null)throw new InvalidParametersError$1("Transport must have a valid tag");if(this.transports.has(g))throw new InvalidParametersError$1(`There is already a transport with the tag ${g}`);this.log("adding transport %s",g),this.transports.set(g,u),this.listeners.has(g)||this.listeners.set(g,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const u=this.components.addressManager.getListenAddrs();await this.listen(u)}async stop(){const u=[];for(const[g,v]of this.listeners)for(this.log("closing listeners for %s",g);v.length>0;){const b=v.pop();b!=null&&u.push(b.close())}await Promise.all(u),this.log("all listeners closed");for(const g of this.listeners.keys())this.listeners.set(g,[]);this.started=!1}async dial(u,g){const v=this.dialTransportForMultiaddr(u);if(v==null)throw new TransportUnavailableError(`No transport available for address ${String(u)}`);return g?.onProgress?.(new CustomProgressEvent("transport-manager:selected-transport",v[Symbol.toStringTag])),v.dial(u,{...g,upgrader:this.components.upgrader})}getAddrs(){let u=[];for(const g of this.listeners.values())for(const v of g)u=[...u,...v.getAddrs()];return u}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(u){for(const g of this.transports.values())if(g.dialFilter([u]).length>0)return g}listenTransportForMultiaddr(u){for(const g of this.transports.values())if(g.listenFilter([u]).length>0)return g}async listen(u){if(!this.isStarted())throw new NotStartedError("Not started");if(u==null||u.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const g={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};u.forEach(w=>{g.errors.set(w.toString(),new UnsupportedListenAddressError)});const v=[];for(const[w,E]of this.transports.entries()){const S=E.listenFilter(u);for(const A of S){this.log("creating listener for %s on %a",w,A);const $=E.createListener({upgrader:this.components.upgrader});let R=this.listeners.get(w)??[];R==null&&(R=[],this.listeners.set(w,R)),R.push($),$.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:$})}),$.addEventListener("close",()=>{const T=R.findIndex(O=>O===$);R.splice(T,1),this.components.events.safeDispatchEvent("transport:close",{detail:$})}),IP4.matches(A)?g.ipv4.attempts++:IP6.matches(A)&&g.ipv6.attempts++,v.push($.listen(A).then(()=>{g.errors.delete(A.toString()),IP4.matches(A)&&g.ipv4.success++,IP6.matches(A)&&g.ipv6.success++},T=>{throw this.log.error("transport %s could not listen on address %a - %e",w,A,T),g.errors.set(A.toString(),T),T}))}}const b=await Promise.allSettled(v);if(!(b.length>0&&b.every(w=>w.status==="fulfilled"))){if(this.ipv6Unsupported(g)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===FaultTolerance.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new UnsupportedListenAddressesError(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...g.errors.entries()].map(([w,E])=>`
  ${w}: ${`${getErrorMessage(E)}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(u){if(u.ipv4.attempts===0||u.ipv6.attempts===0)return!1;const g=u.ipv4.attempts===u.ipv4.success,v=u.ipv6.success===0;return g&&v}async remove(u){const g=this.listeners.get(u)??[];this.log.trace("removing transport %s",u);const v=[];for(this.log.trace("closing listeners for %s",u);g.length>0;){const b=g.pop();b!=null&&v.push(b.close())}await Promise.all(v),this.transports.delete(u),this.listeners.delete(u)}async removeAll(){const u=[];for(const g of this.transports.keys())u.push(this.remove(g));await Promise.all(u)}}function getErrorMessage(y){return y.stack!=null&&y.stack.trim()!==""?y.stack:y.message!=null?y.message:y.toString()}const PROTOCOL_ID="/multistream/1.0.0",MAX_PROTOCOL_LENGTH=1024,NewLine=fromString$1(`
`);async function readString(y,u){const v=(await y.read(u)).subarray();if(v.byteLength===0||v[v.length-1]!==NewLine[0])throw new InvalidMessageError("Missing newline");return toString$3(v).trimEnd()}async function select(y,u,g={}){if(u=Array.isArray(u)?[...u]:[u],u.length===0)throw new Error("At least one protocol must be specified");const v=y.log.newScope("mss:select"),b=lpStream(y,{...g,maxDataLength:MAX_PROTOCOL_LENGTH});for(let w=0;w<u.length;w++){const E=u[w];let S;if(w===0){v.trace('write ["%s", "%s"]',PROTOCOL_ID,E);const A=fromString$1(`${PROTOCOL_ID}
`),$=fromString$1(`${E}
`);if(await b.writeV([A,$],g),v.trace("reading multistream-select header"),S=await readString(b,g),v.trace('read "%s"',S),S!==PROTOCOL_ID){v.error("did not read multistream-select header from response");break}}else v.trace('write "%s"',E),await b.write(fromString$1(`${E}
`),g);if(v.trace("reading protocol response"),S=await readString(b,g),v.trace('read "%s"',S),S===E)return v.trace('selected "%s" after negotiation',S),b.unwrap(),E}throw new UnsupportedProtocolError(`Protocol selection failed - could not negotiate ${u}`)}async function handle(y,u,g={}){u=Array.isArray(u)?u:[u];const v=y.log.newScope("mss:handle"),b=lpStream(y,{...g,maxDataLength:MAX_PROTOCOL_LENGTH,maxLengthLength:2});for(;;){v.trace("reading incoming string");const w=await readString(b,g);if(v.trace('read "%s"',w),w===PROTOCOL_ID){v.trace('respond with "%s" for "%s"',PROTOCOL_ID,w),await b.write(fromString$1(`${PROTOCOL_ID}
`),g),v.trace('responded with "%s" for "%s"',PROTOCOL_ID,w);continue}if(u.includes(w))return v.trace('respond with "%s" for "%s"',w,w),await b.write(fromString$1(`${w}
`),g),v.trace('responded with "%s" for "%s"',w,w),b.unwrap(),w;if(w==="ls"){const E=new Uint8ArrayList(...u.map(S=>encode$7.single(fromString$1(`${S}
`))),fromString$1(`
`));v.trace('respond with "%s" for %s',u,w),await b.write(E,g),v.trace('responded with "%s" for %s',u,w);continue}v.trace('respond with "na" for "%s"',w),await b.write(fromString$1(`na
`),g),v('responded with "na" for "%s"',w)}}class Connection extends TypedEventEmitter{id;remoteAddr;remotePeer;direction;timeline;direct;multiplexer;encryption;limits;log;maConn;muxer;components;outboundStreamProtocolNegotiationTimeout;inboundStreamProtocolNegotiationTimeout;closeTimeout;constructor(u,g){super(),this.components=u,this.id=g.id,this.remoteAddr=g.maConn.remoteAddr,this.remotePeer=g.remotePeer,this.direction=g.direction??"outbound",this.timeline=g.maConn.timeline,this.encryption=g.cryptoProtocol,this.limits=g.limits,this.maConn=g.maConn,this.log=g.maConn.log,this.outboundStreamProtocolNegotiationTimeout=g.outboundStreamProtocolNegotiationTimeout??PROTOCOL_NEGOTIATION_TIMEOUT,this.inboundStreamProtocolNegotiationTimeout=g.inboundStreamProtocolNegotiationTimeout??PROTOCOL_NEGOTIATION_TIMEOUT,this.closeTimeout=g.closeTimeout??CONNECTION_CLOSE_TIMEOUT,this.direct=isDirect(g.maConn.remoteAddr),this.onIncomingStream=this.onIncomingStream.bind(this),this.remoteAddr.getComponents().find(v=>v.code===CODE_P2P)==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),g.muxer!=null&&(this.multiplexer=g.muxer.protocol,this.muxer=g.muxer,this.muxer.addEventListener("stream",this.onIncomingStream)),this.maConn.addEventListener("close",v=>{this.dispatchEvent(new StreamCloseEvent(v.local,v.error))})}[Symbol.toStringTag]="Connection";[connectionSymbol]=!0;get streams(){return this.muxer?.streams??[]}get status(){return this.maConn.status}newStream=async(u,g={})=>{if(this.muxer==null)throw new MuxerUnavailableError("Connection is not multiplexed");if(this.muxer.status!=="open")throw new ConnectionClosedError(`The connection muxer is "${this.muxer.status}" and not "open"`);if(this.maConn.status!=="open")throw new ConnectionClosedError(`The connection is "${this.status}" and not "open"`);if(this.limits!=null&&g?.runOnLimitedConnection!==!0)throw new LimitedConnectionError("Cannot open protocol stream on limited connection");Array.isArray(u)||(u=[u]),this.log.trace("starting new stream for protocols %s",u);const v=await this.muxer.createStream({...g,protocol:u.length===1?u[0]:void 0});this.log.trace("started new stream %s for protocols %s",v.id,u);try{if(g.signal==null){v.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",u);const S=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);g={...g,signal:S}}v.protocol===""?(v.log.trace("selecting protocol from protocols %s",u),v.protocol=await select(v,u,g),v.log("negotiated protocol %s",v.protocol)):v.log("pre-negotiated protocol %s",v.protocol);const b=findOutgoingStreamLimit(v.protocol,this.components.registrar,g),w=countStreams(v.protocol,"outbound",this);if(w>b){const S=new TooManyOutboundProtocolStreamsError(`Too many outbound protocol streams for protocol "${v.protocol}" - ${w}/${b}`);throw v.abort(S),S}await this.components.peerStore.merge(this.remotePeer,{protocols:[v.protocol]}),this.components.metrics?.trackProtocolStream(v);const E=this.components.registrar.getMiddleware(v.protocol);return await this.runMiddlewareChain(v,this,E)}catch(b){throw v.status==="open"?v.abort(b):this.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",this.direction==="inbound"?"from":"to",this.remoteAddr,u,b),b}};async onIncomingStream(u){const g=u.detail,v=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout);g.log("start protocol negotiation, timing out after %dms",this.inboundStreamProtocolNegotiationTimeout);try{if(g.protocol===""){const $=this.components.registrar.getProtocols();g.log.trace("selecting protocol from protocols %s",$),g.protocol=await handle(g,$,{signal:v}),g.log("negotiated protocol %s",g.protocol)}else g.log("pre-negotiated protocol %s",g.protocol);const b=findIncomingStreamLimit(g.protocol,this.components.registrar);if(countStreams(g.protocol,"inbound",this)>b)throw new TooManyInboundProtocolStreamsError(`Too many inbound protocol streams for protocol "${g.protocol}" - limit ${b}`);await this.components.peerStore.merge(this.remotePeer,{protocols:[g.protocol]},{signal:v}),this.components.metrics?.trackProtocolStream(g);const{handler:E,options:S}=this.components.registrar.getHandler(g.protocol);if(this.limits!=null&&S.runOnLimitedConnection!==!0)throw new LimitedConnectionError("Cannot open protocol stream on limited connection");const A=this.components.registrar.getMiddleware(g.protocol);A.push(async($,R,T)=>{await E($,R),T($,R)}),await this.runMiddlewareChain(g,this,A)}catch(b){g.abort(b)}}async runMiddlewareChain(u,g,v){for(let b=0;b<v.length;b++){const w=v[b];u.log.trace("running middleware",b,w),await new Promise((E,S)=>{try{const A=w(u,g,($,R)=>{u=$,g=R,E()});A instanceof Promise&&A.catch(S)}catch(A){S(A)}}),u.log.trace("ran middleware",b,w)}return u}async close(u={}){if(this.log("closing connection to %a",this.remoteAddr),u.signal==null){const g=AbortSignal.timeout(this.closeTimeout);u={...u,signal:g}}await this.muxer?.close(u),await this.maConn.close(u)}abort(u){this.muxer?.abort(u),this.maConn.abort(u)}}function createConnection(y,u){return new Connection(y,u)}function findIncomingStreamLimit(y,u){try{const{options:g}=u.getHandler(y);if(g.maxInboundStreams!=null)return g.maxInboundStreams}catch(g){if(g.name!=="UnhandledProtocolError")throw g}return DEFAULT_MAX_INBOUND_STREAMS$1}function findOutgoingStreamLimit(y,u,g={}){try{const{options:v}=u.getHandler(y);if(v.maxOutboundStreams!=null)return v.maxOutboundStreams}catch(v){if(v.name!=="UnhandledProtocolError")throw v}return g.maxOutboundStreams??DEFAULT_MAX_OUTBOUND_STREAMS$1}function countStreams(y,u,g){let v=0;return g.streams.forEach(b=>{b.direction===u&&b.protocol===y&&v++}),v}class Upgrader{components;connectionEncrypters;streamMuxers;inboundUpgradeTimeout;inboundStreamProtocolNegotiationTimeout;outboundStreamProtocolNegotiationTimeout;events;metrics;connectionCloseTimeout;constructor(u,g){this.components=u,this.connectionEncrypters=trackedMap({name:"libp2p_upgrader_connection_encrypters",metrics:this.components.metrics}),g.connectionEncrypters.forEach(v=>{this.connectionEncrypters.set(v.protocol,v)}),this.streamMuxers=trackedMap({name:"libp2p_upgrader_stream_multiplexers",metrics:this.components.metrics}),g.streamMuxers.forEach(v=>{this.streamMuxers.set(v.protocol,v)}),this.inboundUpgradeTimeout=g.inboundUpgradeTimeout??INBOUND_UPGRADE_TIMEOUT,this.inboundStreamProtocolNegotiationTimeout=g.inboundStreamProtocolNegotiationTimeout??PROTOCOL_NEGOTIATION_TIMEOUT,this.outboundStreamProtocolNegotiationTimeout=g.outboundStreamProtocolNegotiationTimeout??PROTOCOL_NEGOTIATION_TIMEOUT,this.connectionCloseTimeout=g.connectionCloseTimeout??CONNECTION_CLOSE_TIMEOUT,this.events=u.events,this.metrics={dials:u.metrics?.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:u.metrics?.registerCounterGroup("libp2p_connection_manager_dial_errors_total"),inboundErrors:u.metrics?.registerCounterGroup("libp2p_connection_manager_dials_inbound_errors_total"),outboundErrors:u.metrics?.registerCounterGroup("libp2p_connection_manager_dials_outbound_errors_total")}}[Symbol.toStringTag]="@libp2p/upgrader";async shouldBlockConnection(u,...g){const v=this.components.connectionGater[u];if(v==null)return;if(await v.apply(this.components.connectionGater,g)===!0)throw new ConnectionInterceptedError(`The multiaddr connection is blocked by gater.${u}`)}createInboundAbortSignal(u){return anySignal([AbortSignal.timeout(this.inboundUpgradeTimeout),u])}async upgradeInbound(u,g){let v=!1;const b=this.createInboundAbortSignal(g.signal);try{if(this.metrics.dials?.increment({inbound:!0}),v=this.components.connectionManager.acceptIncomingConnection(u),!v)throw new ConnectionDeniedError("Connection denied");await raceSignal$2(this.shouldBlockConnection("denyInboundConnection",u),b),await this._performUpgrade(u,"inbound",{...g,signal:b})}catch(w){throw this.metrics.errors?.increment({inbound:!0}),this.metrics.inboundErrors?.increment({[w.name??"Error"]:!0}),w}finally{b.clear(),v&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(u,g){try{this.metrics.dials?.increment({outbound:!0});const v=u.remoteAddr.getComponents().findLast(E=>E.code===CODE_P2P)?.value;let b;v!=null&&(b=peerIdFromString$1(v),await raceSignal$2(this.shouldBlockConnection("denyOutboundConnection",b,u),g.signal));let w="outbound";return g.initiator===!1&&(w="inbound"),await this._performUpgrade(u,w,g)}catch(v){throw this.metrics.errors?.increment({outbound:!0}),this.metrics.outboundErrors?.increment({[v.name??"Error"]:!0}),v}}async _performUpgrade(u,g,v){let b=u,w,E,S,A;const $=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`;if(u.log=u.log.newScope(`${g}:${$}`),this.components.metrics?.trackMultiaddrConnection(u),u.log.trace("starting the %s connection upgrade",g),v?.skipProtection!==!0){const T=this.components.connectionProtector;T!=null&&(u.log("protecting the %s connection",g),b=await T.protect(b,v))}try{if(isEncryptionSkipped(v)){if(v.remotePeer==null)throw new InvalidMultiaddrError$1(`${g} connection that skipped encryption must have a peer id`);A="native",w=v.remotePeer}else{const T=u.remoteAddr.getComponents().findLast(B=>B.code===CODE_P2P)?.value;let O;T!=null&&(O=peerIdFromString$1(T)),v?.onProgress?.(new CustomProgressEvent(`upgrader:encrypt-${g}-connection`)),{connection:b,remotePeer:w,protocol:A,streamMuxer:E}=await(g==="inbound"?this._encryptInbound(b,{...v,remotePeer:O}):this._encryptOutbound(b,{...v,remotePeer:O}))}if(w.equals(this.components.peerId)){const T=new InvalidPeerIdError("Can not dial self");throw u.abort(T),T}await this.shouldBlockConnection(g==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",w,u),v?.muxerFactory!=null?E=v.muxerFactory:E==null&&this.streamMuxers.size>0&&(v?.onProgress?.(new CustomProgressEvent(`upgrader:multiplex-${g}-connection`)),E=await(g==="inbound"?this._multiplexInbound(b,this.streamMuxers,v):this._multiplexOutbound(b,this.streamMuxers,v)))}catch(T){throw u.log.error("failed to upgrade %s connection %s %a - %e",g,g==="inbound"?"from":"to",u.remoteAddr,T),T}E!=null&&(u.log("create muxer %s",E.protocol),S=E.createStreamMuxer(b)),await this.shouldBlockConnection(g==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",w,u);const R=this._createConnection({id:$,cryptoProtocol:A,direction:g,maConn:u,stream:b,muxer:S,remotePeer:w,limits:v?.limits,closeTimeout:this.connectionCloseTimeout});return R.log("successfully upgraded connection"),R}_createConnection(u){const g=createConnection(this.components,{...u,outboundStreamProtocolNegotiationTimeout:this.outboundStreamProtocolNegotiationTimeout,inboundStreamProtocolNegotiationTimeout:this.inboundStreamProtocolNegotiationTimeout});return g.addEventListener("close",()=>{this.events.safeDispatchEvent("connection:close",{detail:g})}),this.events.safeDispatchEvent("connection:open",{detail:g}),g}async _encryptInbound(u,g){const v=Array.from(this.connectionEncrypters.keys());try{const b=await handle(u,v,g),w=this.connectionEncrypters.get(b);if(w==null)throw new EncryptionFailedError(`no crypto module found for ${b}`);return u.log("encrypting inbound connection using %s",b),{...await w.secureInbound(u,g),protocol:b}}catch(b){throw new EncryptionFailedError(b.message)}}async _encryptOutbound(u,g){const v=Array.from(this.connectionEncrypters.keys());try{u.log.trace("selecting encrypter from %s",v);const b=await select(u,v,g),w=this.connectionEncrypters.get(b);if(w==null)throw new EncryptionFailedError(`no crypto module found for ${b}`);return u.log("encrypting outbound connection using %s",b),{...await w.secureOutbound(u,g),protocol:b}}catch(b){throw new EncryptionFailedError(b.message)}}async _multiplexOutbound(u,g,v){const b=Array.from(g.keys());u.log("outbound selecting muxer %s",b);try{u.log.trace("selecting stream muxer from %s",b);const w=await select(u,b,v),E=g.get(w);if(E==null)throw new MuxerUnavailableError(`No muxer configured for protocol "${w}"`);return u.log("selected %s as muxer protocol",w),E}catch(w){throw u.log.error("error multiplexing outbound connection - %e",w),new MuxerUnavailableError(String(w))}}async _multiplexInbound(u,g,v){const b=Array.from(g.keys());u.log("inbound handling muxers %s",b);try{u.log.trace("selecting stream muxer from %s",b);const w=await handle(u,b,v),E=g.get(w);if(E==null)throw new MuxerUnavailableError(`No muxer configured for protocol "${w}"`);return u.log("selected %s as muxer protocol",w),E}catch(w){throw u.log.error("error multiplexing inbound connection - %e",w),w}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}function isEncryptionSkipped(y){return y.skipEncryption===!0}const version$2="3.1.2",name$1="js-libp2p";function userAgent$1(y,u){return`${y??name$1}/${u??version$2} browser/${globalThis.navigator.userAgent}`}class Libp2p extends TypedEventEmitter{peerId;peerStore;contentRouting;peerRouting;metrics;services;logger;status;components;log;constructor(u){super(),this.status="stopped";const g=new TypedEventEmitter,v=g.dispatchEvent.bind(g);g.dispatchEvent=$=>{const R=v($),T=this.dispatchEvent(new CustomEvent($.type,{detail:$.detail}));return R||T},this.peerId=u.peerId,this.logger=u.logger??defaultLogger(),this.log=this.logger.forComponent("libp2p"),this.services={};const b=u.nodeInfo?.name??name$1,w=u.nodeInfo?.version??version$2,E=this.components=defaultComponents({peerId:u.peerId,privateKey:u.privateKey,nodeInfo:{name:b,version:w,userAgent:u.nodeInfo?.userAgent??userAgent$1(b,w)},logger:this.logger,events:g,datastore:u.datastore??new MemoryDatastore,connectionGater:connectionGater(u.connectionGater),dns:u.dns});u.metrics!=null&&(this.metrics=this.configureComponent("metrics",u.metrics(this.components))),this.peerStore=this.configureComponent("peerStore",persistentPeerStore(E,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...u.peerStore})),E.events.addEventListener("peer:update",$=>{if($.detail.previous==null){const R={id:$.detail.peer.id,multiaddrs:$.detail.peer.addresses.map(T=>T.multiaddr)};E.events.safeDispatchEvent("peer:discovery",{detail:R})}}),u.connectionProtector!=null&&this.configureComponent("connectionProtector",u.connectionProtector(E)),this.components.upgrader=new Upgrader(this.components,{connectionEncrypters:(u.connectionEncrypters??[]).map(($,R)=>this.configureComponent(`connection-encryption-${R}`,$(this.components))),streamMuxers:(u.streamMuxers??[]).map(($,R)=>this.configureComponent(`stream-muxers-${R}`,$(this.components))),inboundUpgradeTimeout:u.connectionManager?.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:u.connectionManager?.inboundStreamProtocolNegotiationTimeout,outboundStreamProtocolNegotiationTimeout:u.connectionManager?.outboundStreamProtocolNegotiationTimeout,connectionCloseTimeout:u.connectionManager?.connectionCloseTimeout}),this.configureComponent("transportManager",new DefaultTransportManager(this.components,u.transportManager)),this.configureComponent("connectionManager",new DefaultConnectionManager(this.components,u.connectionManager)),u.connectionMonitor?.enabled!==!1&&this.configureComponent("connectionMonitor",new ConnectionMonitor(this.components,u.connectionMonitor)),this.configureComponent("registrar",new Registrar(this.components)),this.configureComponent("addressManager",new AddressManager(this.components,u.addresses));const S=(u.peerRouters??[]).map(($,R)=>this.configureComponent(`peer-router-${R}`,$(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new DefaultPeerRouting(this.components,{routers:S}));const A=(u.contentRouters??[]).map(($,R)=>this.configureComponent(`content-router-${R}`,$(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new CompoundContentRouting(this.components,{routers:A})),this.configureComponent("randomWalk",new RandomWalk(this.components)),(u.peerDiscovery??[]).forEach(($,R)=>{this.configureComponent(`peer-discovery-${R}`,$(this.components)).addEventListener("peer",O=>{this.#e(O)})}),u.transports?.forEach(($,R)=>{this.components.transportManager.add(this.configureComponent(`transport-${R}`,$(this.components)))}),u.services!=null)for(const $ of Object.keys(u.services)){const R=u.services[$],T=R(this.components);if(T==null){this.log.error("service factory %s returned null or undefined instance",$);continue}this.services[$]=T,this.configureComponent($,T),T[contentRoutingSymbol]!=null&&(this.log("registering service %s for content routing",$),A.push(T[contentRoutingSymbol])),T[peerRoutingSymbol]!=null&&(this.log("registering service %s for peer routing",$),S.push(T[peerRoutingSymbol])),T[peerDiscoverySymbol]!=null&&(this.log("registering service %s for peer discovery",$),T[peerDiscoverySymbol].addEventListener?.("peer",O=>{this.#e(O)}))}checkServiceDependencies(E)}configureComponent(u,g){return g==null&&this.log.error("component %s was null or undefined",u),this.components[u]=g,g}async start(){if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await this.components.beforeStart?.(),await this.components.start(),await this.components.afterStart?.(),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started with peer id %p",this.peerId)}catch(u){throw this.log.error("an error occurred starting libp2p - %e",u),this.status="started",await this.stop(),u}}}async stop(){this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await this.components.beforeStop?.(),await this.components.stop(),await this.components.afterStop?.(),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(u){return this.components.connectionManager.getConnections(u)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const u=new PeerSet;for(const g of this.components.connectionManager.getConnections())u.add(g.remotePeer);return Array.from(u)}async dial(u,g={}){return this.components.connectionManager.openConnection(u,{priority:75,...g})}async dialProtocol(u,g,v={}){if(g==null)throw new InvalidParametersError$1("no protocols were provided to open a stream");if(g=Array.isArray(g)?g:[g],g.length===0)throw new InvalidParametersError$1("no protocols were provided to open a stream");return this.components.connectionManager.openStream(u,g,v)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(u,g={}){isMultiaddr(u)&&(u=peerIdFromString$1(u.getComponents().findLast(v=>v.code===CODE_P2P)?.value??"")),await this.components.connectionManager.closeConnections(u,g)}async getPublicKey(u,g={}){if(this.log("getPublicKey %p",u),u.publicKey!=null)return u.publicKey;try{const E=await this.peerStore.get(u,g);if(E.id.publicKey!=null)return E.id.publicKey}catch(E){if(E.name!=="NotFoundError")throw E}const v=concat$2([fromString$1("/pk/"),u.toMultihash().bytes]),b=await this.contentRouting.get(v,g),w=publicKeyFromProtobuf(b);return await this.peerStore.patch(u,{publicKey:w},g),w}async handle(u,g,v){Array.isArray(u)||(u=[u]),await Promise.all(u.map(async b=>{await this.components.registrar.handle(b,g,v)}))}async unhandle(u,g){Array.isArray(u)||(u=[u]),await Promise.all(u.map(async v=>{await this.components.registrar.unhandle(v,g)}))}async register(u,g,v){return this.components.registrar.register(u,g,v)}unregister(u){this.components.registrar.unregister(u)}use(u,g){this.components.registrar.use(u,Array.isArray(g)?g:[g])}unuse(u){this.components.registrar.unuse(u)}async isDialable(u,g={}){return this.components.connectionManager.isDialable(u,g)}#e(u){const{detail:g}=u;if(g.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(g.id,{multiaddrs:g.multiaddrs}).catch(v=>{this.log.error("could not update multiaddrs of discovered peer - %e",v)})}}async function createLibp2p$1(y={}){y.privateKey??=await generateKeyPair("Ed25519");const u=new Libp2p({...await validateConfig(y),peerId:peerIdFromPrivateKey(y.privateKey)});return y.start!==!1&&await u.start(),u}const LIBP2P_METHODS=["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"];function isLibp2p(y){return y==null?!1:y instanceof Libp2p?!0:LIBP2P_METHODS.every(u=>typeof y[u]=="function")}var truncate,hasRequiredTruncate;function requireTruncate(){if(hasRequiredTruncate)return truncate;hasRequiredTruncate=1;function y(g){return g>=55296&&g<=56319}function u(g){return g>=56320&&g<=57343}return truncate=function(v,b,w){if(typeof b!="string")throw new Error("Input must be string");for(var E=b.length,S=0,A,$,R=0;R<E;R+=1){if(A=b.charCodeAt(R),$=b[R],y(A)&&u(b.charCodeAt(R+1))&&(R+=1,$+=b[R]),S+=v($),S===w)return b.slice(0,R+1);if(S>w)return b.slice(0,R-$.length+1)}return b},truncate}var browser$2,hasRequiredBrowser$1;function requireBrowser$1(){if(hasRequiredBrowser$1)return browser$2;hasRequiredBrowser$1=1;function y(g){return g>=55296&&g<=56319}function u(g){return g>=56320&&g<=57343}return browser$2=function(v){if(typeof v!="string")throw new Error("Input must be string");for(var b=v.length,w=0,E=null,S=null,A=0;A<b;A++)E=v.charCodeAt(A),u(E)?S!=null&&y(S)?w+=1:w+=3:E<=127?w+=1:E>=128&&E<=2047?w+=2:E>=2048&&E<=65535&&(w+=3),S=E;return w},browser$2}var browser$1,hasRequiredBrowser;function requireBrowser(){if(hasRequiredBrowser)return browser$1;hasRequiredBrowser=1;var y=requireTruncate(),u=requireBrowser$1();return browser$1=y.bind(null,u),browser$1}var sanitizeFilename,hasRequiredSanitizeFilename;function requireSanitizeFilename(){if(hasRequiredSanitizeFilename)return sanitizeFilename;hasRequiredSanitizeFilename=1;var y=requireBrowser(),u=/[\/\?<>\\:\*\|"]/g,g=/[\x00-\x1f\x80-\x9f]/g,v=/^\.+$/,b=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,w=/[\. ]+$/;function E(S,A){if(typeof S!="string")throw new Error("Input must be string");var $=S.replace(u,A).replace(g,A).replace(v,A).replace(b,A).replace(w,A);return y($,255)}return sanitizeFilename=function(S,A){var $=A&&A.replacement||"",R=E(S,$);return $===""?R:E(R,"")},sanitizeFilename}var sanitizeFilenameExports=requireSanitizeFilename();const sanitize=getDefaultExportFromCjs$3(sanitizeFilenameExports),DEK_INIT={keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"},derivedEmptyPasswordKey={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function create$4(y){const u="AES-GCM";let g=16;const v=12,b="SHA-256",w=16,E=32767,S=webcrypto.get();g*=8;async function A(T,O){const B=S.getRandomValues(new Uint8Array(w)),F=S.getRandomValues(new Uint8Array(v)),U={name:u,iv:F};typeof O=="string"&&(O=fromString$1(O));let q;if(O.length===0){q=await S.subtle.importKey("jwk",derivedEmptyPasswordKey,{name:"AES-GCM"},!0,["encrypt"]);try{const ie={name:"PBKDF2",salt:B,iterations:E,hash:{name:b}},oe=await S.subtle.importKey("raw",O,{name:"PBKDF2"},!1,["deriveKey"]);q=await S.subtle.deriveKey(ie,oe,{name:u,length:g},!0,["encrypt"])}catch{q=await S.subtle.importKey("jwk",derivedEmptyPasswordKey,{name:"AES-GCM"},!0,["encrypt"])}}else{const ie={name:"PBKDF2",salt:B,iterations:E,hash:{name:b}},oe=await S.subtle.importKey("raw",O,{name:"PBKDF2"},!1,["deriveKey"]);q=await S.subtle.deriveKey(ie,oe,{name:u,length:g},!0,["encrypt"])}const J=await S.subtle.encrypt(U,q,T);return concat$2([B,U.iv,new Uint8Array(J)])}async function $(T,O){const B=T.subarray(0,w),F=T.subarray(w,w+v),U=T.subarray(w+v),q={name:u,iv:F};typeof O=="string"&&(O=fromString$1(O));let J;if(O.length===0)try{const oe={name:"PBKDF2",salt:B,iterations:E,hash:{name:b}},le=await S.subtle.importKey("raw",O,{name:"PBKDF2"},!1,["deriveKey"]);J=await S.subtle.deriveKey(oe,le,{name:u,length:g},!0,["decrypt"])}catch{J=await S.subtle.importKey("jwk",derivedEmptyPasswordKey,{name:"AES-GCM"},!0,["decrypt"])}else{const oe={name:"PBKDF2",salt:B,iterations:E,hash:{name:b}},le=await S.subtle.importKey("raw",O,{name:"PBKDF2"},!1,["deriveKey"]);J=await S.subtle.deriveKey(oe,le,{name:u,length:g},!0,["decrypt"])}const ie=await S.subtle.decrypt(q,J,U);return new Uint8Array(ie)}return{encrypt:A,decrypt:$}}function isBytes$5(y){return y instanceof Uint8Array||ArrayBuffer.isView(y)&&y.constructor.name==="Uint8Array"}function anumber$3(y,u=""){if(!Number.isSafeInteger(y)||y<0){const g=u&&`"${u}" `;throw new Error(`${g}expected integer >= 0, got ${y}`)}}function abytes$4(y,u,g=""){const v=isBytes$5(y),b=y?.length,w=u!==void 0;if(!v||w&&b!==u){const E=g&&`"${g}" `,S=w?` of length ${u}`:"",A=v?`length=${b}`:`type=${typeof y}`;throw new Error(E+"expected Uint8Array"+S+", got "+A)}return y}function ahash$2(y){if(typeof y!="function"||typeof y.create!="function")throw new Error("Hash must wrapped by utils.createHasher");anumber$3(y.outputLen),anumber$3(y.blockLen)}function aexists$3(y,u=!0){if(y.destroyed)throw new Error("Hash instance has been destroyed");if(u&&y.finished)throw new Error("Hash#digest() has already been called")}function aoutput$3(y,u){abytes$4(y,void 0,"digestInto() output");const g=u.outputLen;if(y.length<g)throw new Error('"digestInto() output" expected to be of length >='+g)}function clean$3(...y){for(let u=0;u<y.length;u++)y[u].fill(0)}function createView$3(y){return new DataView(y.buffer,y.byteOffset,y.byteLength)}const nextTick=async()=>{};async function asyncLoop(y,u,g){let v=Date.now();for(let b=0;b<y;b++){g(b);const w=Date.now()-v;w>=0&&w<u||(await nextTick(),v+=w)}}function utf8ToBytes$1(y){if(typeof y!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(y))}function kdfInputToBytes(y,u=""){return typeof y=="string"?utf8ToBytes$1(y):abytes$4(y,void 0,u)}function checkOpts$1(y,u){if(u!==void 0&&{}.toString.call(u)!=="[object Object]")throw new Error("options must be object or undefined");return Object.assign(y,u)}function createHasher$2(y,u={}){const g=(b,w)=>y(w).update(b).digest(),v=y(void 0);return g.outputLen=v.outputLen,g.blockLen=v.blockLen,g.create=b=>y(b),Object.assign(g,u),Object.freeze(g)}const oidNist$1=y=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,y])});let _HMAC$1=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(u,g){if(ahash$2(u),abytes$4(g,void 0,"key"),this.iHash=u.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const v=this.blockLen,b=new Uint8Array(v);b.set(g.length>v?u.create().update(g).digest():g);for(let w=0;w<b.length;w++)b[w]^=54;this.iHash.update(b),this.oHash=u.create();for(let w=0;w<b.length;w++)b[w]^=106;this.oHash.update(b),clean$3(b)}update(u){return aexists$3(this),this.iHash.update(u),this}digestInto(u){aexists$3(this),abytes$4(u,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(u),this.oHash.update(u),this.oHash.digestInto(u),this.destroy()}digest(){const u=new Uint8Array(this.oHash.outputLen);return this.digestInto(u),u}_cloneInto(u){u||=Object.create(Object.getPrototypeOf(this),{});const{oHash:g,iHash:v,finished:b,destroyed:w,blockLen:E,outputLen:S}=this;return u=u,u.finished=b,u.destroyed=w,u.blockLen=E,u.outputLen=S,u.oHash=g._cloneInto(u.oHash),u.iHash=v._cloneInto(u.iHash),u}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$2=(y,u,g)=>new _HMAC$1(y,u).update(g).digest();hmac$2.create=(y,u)=>new _HMAC$1(y,u);function pbkdf2Init(y,u,g,v){ahash$2(y);const b=checkOpts$1({dkLen:32,asyncTick:10},v),{c:w,dkLen:E,asyncTick:S}=b;if(anumber$3(w,"c"),anumber$3(E,"dkLen"),anumber$3(S,"asyncTick"),w<1)throw new Error("iterations (c) must be >= 1");const A=kdfInputToBytes(u,"password"),$=kdfInputToBytes(g,"salt"),R=new Uint8Array(E),T=hmac$2.create(y,A),O=T._cloneInto().update($);return{c:w,dkLen:E,asyncTick:S,DK:R,PRF:T,PRFSalt:O}}function pbkdf2Output(y,u,g,v,b){return y.destroy(),u.destroy(),v&&v.destroy(),clean$3(b),g}async function pbkdf2Async(y,u,g,v){const{c:b,dkLen:w,asyncTick:E,DK:S,PRF:A,PRFSalt:$}=pbkdf2Init(y,u,g,v);let R;const T=new Uint8Array(4),O=createView$3(T),B=new Uint8Array(A.outputLen);for(let F=1,U=0;U<w;F++,U+=A.outputLen){const q=S.subarray(U,U+A.outputLen);O.setInt32(0,F,!1),(R=$._cloneInto(R)).update(T).digestInto(B),q.set(B.subarray(0,q.length)),await asyncLoop(b-1,E,()=>{A._cloneInto(R).update(B).digestInto(B);for(let J=0;J<q.length;J++)q[J]^=B[J]})}return pbkdf2Output(A,$,S,R,B)}let HashMD$2=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(u,g,v,b){this.blockLen=u,this.outputLen=g,this.padOffset=v,this.isLE=b,this.buffer=new Uint8Array(u),this.view=createView$3(this.buffer)}update(u){aexists$3(this),abytes$4(u);const{view:g,buffer:v,blockLen:b}=this,w=u.length;for(let E=0;E<w;){const S=Math.min(b-this.pos,w-E);if(S===b){const A=createView$3(u);for(;b<=w-E;E+=b)this.process(A,E);continue}v.set(u.subarray(E,E+S),this.pos),this.pos+=S,E+=S,this.pos===b&&(this.process(g,0),this.pos=0)}return this.length+=u.length,this.roundClean(),this}digestInto(u){aexists$3(this),aoutput$3(u,this),this.finished=!0;const{buffer:g,view:v,blockLen:b,isLE:w}=this;let{pos:E}=this;g[E++]=128,clean$3(this.buffer.subarray(E)),this.padOffset>b-E&&(this.process(v,0),E=0);for(let T=E;T<b;T++)g[T]=0;v.setBigUint64(b-8,BigInt(this.length*8),w),this.process(v,0);const S=createView$3(u),A=this.outputLen;if(A%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const $=A/4,R=this.get();if($>R.length)throw new Error("_sha2: outputLen bigger than state");for(let T=0;T<$;T++)S.setUint32(4*T,R[T],w)}digest(){const{buffer:u,outputLen:g}=this;this.digestInto(u);const v=u.slice(0,g);return this.destroy(),v}_cloneInto(u){u||=new this.constructor,u.set(...this.get());const{blockLen:g,buffer:v,length:b,finished:w,destroyed:E,pos:S}=this;return u.destroyed=E,u.finished=w,u.length=b,u.pos=S,b%g&&u.buffer.set(v),u}clone(){return this._cloneInto()}};const SHA512_IV$1=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),U32_MASK64$1=BigInt(2**32-1),_32n$1=BigInt(32);function fromBig$1(y,u=!1){return u?{h:Number(y&U32_MASK64$1),l:Number(y>>_32n$1&U32_MASK64$1)}:{h:Number(y>>_32n$1&U32_MASK64$1)|0,l:Number(y&U32_MASK64$1)|0}}function split$1(y,u=!1){const g=y.length;let v=new Uint32Array(g),b=new Uint32Array(g);for(let w=0;w<g;w++){const{h:E,l:S}=fromBig$1(y[w],u);[v[w],b[w]]=[E,S]}return[v,b]}const shrSH$1=(y,u,g)=>y>>>g,shrSL$1=(y,u,g)=>y<<32-g|u>>>g,rotrSH$1=(y,u,g)=>y>>>g|u<<32-g,rotrSL$1=(y,u,g)=>y<<32-g|u>>>g,rotrBH$1=(y,u,g)=>y<<64-g|u>>>g-32,rotrBL$1=(y,u,g)=>y>>>g-32|u<<64-g;function add$1(y,u,g,v){const b=(u>>>0)+(v>>>0);return{h:y+g+(b/2**32|0)|0,l:b|0}}const add3L$1=(y,u,g)=>(y>>>0)+(u>>>0)+(g>>>0),add3H$1=(y,u,g,v)=>u+g+v+(y/2**32|0)|0,add4L$1=(y,u,g,v)=>(y>>>0)+(u>>>0)+(g>>>0)+(v>>>0),add4H$1=(y,u,g,v,b)=>u+g+v+b+(y/2**32|0)|0,add5L$1=(y,u,g,v,b)=>(y>>>0)+(u>>>0)+(g>>>0)+(v>>>0)+(b>>>0),add5H$1=(y,u,g,v,b,w)=>u+g+v+b+w+(y/2**32|0)|0,K512$1=split$1(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(y=>BigInt(y))),SHA512_Kh$1=K512$1[0],SHA512_Kl$1=K512$1[1],SHA512_W_H$1=new Uint32Array(80),SHA512_W_L$1=new Uint32Array(80);class SHA2_64B extends HashMD$2{constructor(u){super(128,u,16,!1)}get(){const{Ah:u,Al:g,Bh:v,Bl:b,Ch:w,Cl:E,Dh:S,Dl:A,Eh:$,El:R,Fh:T,Fl:O,Gh:B,Gl:F,Hh:U,Hl:q}=this;return[u,g,v,b,w,E,S,A,$,R,T,O,B,F,U,q]}set(u,g,v,b,w,E,S,A,$,R,T,O,B,F,U,q){this.Ah=u|0,this.Al=g|0,this.Bh=v|0,this.Bl=b|0,this.Ch=w|0,this.Cl=E|0,this.Dh=S|0,this.Dl=A|0,this.Eh=$|0,this.El=R|0,this.Fh=T|0,this.Fl=O|0,this.Gh=B|0,this.Gl=F|0,this.Hh=U|0,this.Hl=q|0}process(u,g){for(let oe=0;oe<16;oe++,g+=4)SHA512_W_H$1[oe]=u.getUint32(g),SHA512_W_L$1[oe]=u.getUint32(g+=4);for(let oe=16;oe<80;oe++){const le=SHA512_W_H$1[oe-15]|0,de=SHA512_W_L$1[oe-15]|0,fe=rotrSH$1(le,de,1)^rotrSH$1(le,de,8)^shrSH$1(le,de,7),ye=rotrSL$1(le,de,1)^rotrSL$1(le,de,8)^shrSL$1(le,de,7),we=SHA512_W_H$1[oe-2]|0,pe=SHA512_W_L$1[oe-2]|0,ve=rotrSH$1(we,pe,19)^rotrBH$1(we,pe,61)^shrSH$1(we,pe,6),he=rotrSL$1(we,pe,19)^rotrBL$1(we,pe,61)^shrSL$1(we,pe,6),ae=add4L$1(ye,he,SHA512_W_L$1[oe-7],SHA512_W_L$1[oe-16]),Q=add4H$1(ae,fe,ve,SHA512_W_H$1[oe-7],SHA512_W_H$1[oe-16]);SHA512_W_H$1[oe]=Q|0,SHA512_W_L$1[oe]=ae|0}let{Ah:v,Al:b,Bh:w,Bl:E,Ch:S,Cl:A,Dh:$,Dl:R,Eh:T,El:O,Fh:B,Fl:F,Gh:U,Gl:q,Hh:J,Hl:ie}=this;for(let oe=0;oe<80;oe++){const le=rotrSH$1(T,O,14)^rotrSH$1(T,O,18)^rotrBH$1(T,O,41),de=rotrSL$1(T,O,14)^rotrSL$1(T,O,18)^rotrBL$1(T,O,41),fe=T&B^~T&U,ye=O&F^~O&q,we=add5L$1(ie,de,ye,SHA512_Kl$1[oe],SHA512_W_L$1[oe]),pe=add5H$1(we,J,le,fe,SHA512_Kh$1[oe],SHA512_W_H$1[oe]),ve=we|0,he=rotrSH$1(v,b,28)^rotrBH$1(v,b,34)^rotrBH$1(v,b,39),ae=rotrSL$1(v,b,28)^rotrBL$1(v,b,34)^rotrBL$1(v,b,39),Q=v&w^v&S^w&S,j=b&E^b&A^E&A;J=U|0,ie=q|0,U=B|0,q=F|0,B=T|0,F=O|0,{h:T,l:O}=add$1($|0,R|0,pe|0,ve|0),$=S|0,R=A|0,S=w|0,A=E|0,w=v|0,E=b|0;const z=add3L$1(ve,ae,j);v=add3H$1(z,pe,he,Q),b=z|0}({h:v,l:b}=add$1(this.Ah|0,this.Al|0,v|0,b|0)),{h:w,l:E}=add$1(this.Bh|0,this.Bl|0,w|0,E|0),{h:S,l:A}=add$1(this.Ch|0,this.Cl|0,S|0,A|0),{h:$,l:R}=add$1(this.Dh|0,this.Dl|0,$|0,R|0),{h:T,l:O}=add$1(this.Eh|0,this.El|0,T|0,O|0),{h:B,l:F}=add$1(this.Fh|0,this.Fl|0,B|0,F|0),{h:U,l:q}=add$1(this.Gh|0,this.Gl|0,U|0,q|0),{h:J,l:ie}=add$1(this.Hh|0,this.Hl|0,J|0,ie|0),this.set(v,b,w,E,S,A,$,R,T,O,B,F,U,q,J,ie)}roundClean(){clean$3(SHA512_W_H$1,SHA512_W_L$1)}destroy(){clean$3(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class _SHA512 extends SHA2_64B{Ah=SHA512_IV$1[0]|0;Al=SHA512_IV$1[1]|0;Bh=SHA512_IV$1[2]|0;Bl=SHA512_IV$1[3]|0;Ch=SHA512_IV$1[4]|0;Cl=SHA512_IV$1[5]|0;Dh=SHA512_IV$1[6]|0;Dl=SHA512_IV$1[7]|0;Eh=SHA512_IV$1[8]|0;El=SHA512_IV$1[9]|0;Fh=SHA512_IV$1[10]|0;Fl=SHA512_IV$1[11]|0;Gh=SHA512_IV$1[12]|0;Gl=SHA512_IV$1[13]|0;Hh=SHA512_IV$1[14]|0;Hl=SHA512_IV$1[15]|0;constructor(){super(64)}}const sha512$2=createHasher$2(()=>new _SHA512,oidNist$1(3));const ARRAY_BUFFER_NAME="[object ArrayBuffer]";class BufferSourceConverter{static isArrayBuffer(u){return Object.prototype.toString.call(u)===ARRAY_BUFFER_NAME}static toArrayBuffer(u){return this.isArrayBuffer(u)?u:u.byteLength===u.buffer.byteLength||u.byteOffset===0&&u.byteLength===u.buffer.byteLength?u.buffer:this.toUint8Array(u.buffer).slice(u.byteOffset,u.byteOffset+u.byteLength).buffer}static toUint8Array(u){return this.toView(u,Uint8Array)}static toView(u,g){if(u.constructor===g)return u;if(this.isArrayBuffer(u))return new g(u);if(this.isArrayBufferView(u))return new g(u.buffer,u.byteOffset,u.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(u){return this.isArrayBufferView(u)||this.isArrayBuffer(u)}static isArrayBufferView(u){return ArrayBuffer.isView(u)||u&&this.isArrayBuffer(u.buffer)}static isEqual(u,g){const v=BufferSourceConverter.toUint8Array(u),b=BufferSourceConverter.toUint8Array(g);if(v.length!==b.byteLength)return!1;for(let w=0;w<v.length;w++)if(v[w]!==b[w])return!1;return!0}static concat(...u){let g;Array.isArray(u[0])&&!(u[1]instanceof Function)||Array.isArray(u[0])&&u[1]instanceof Function?g=u[0]:u[u.length-1]instanceof Function?g=u.slice(0,u.length-1):g=u;let v=0;for(const E of g)v+=E.byteLength;const b=new Uint8Array(v);let w=0;for(const E of g){const S=this.toUint8Array(E);b.set(S,w),w+=S.length}return u[u.length-1]instanceof Function?this.toView(b,u[u.length-1]):b.buffer}}const STRING_TYPE="string",HEX_REGEX=/^[0-9a-f\s]+$/i,BASE64_REGEX=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,BASE64URL_REGEX=/^[a-zA-Z0-9-_]+$/;class Utf8Converter{static fromString(u){const g=unescape(encodeURIComponent(u)),v=new Uint8Array(g.length);for(let b=0;b<g.length;b++)v[b]=g.charCodeAt(b);return v.buffer}static toString(u){const g=BufferSourceConverter.toUint8Array(u);let v="";for(let w=0;w<g.length;w++)v+=String.fromCharCode(g[w]);return decodeURIComponent(escape(v))}}class Utf16Converter{static toString(u,g=!1){const v=BufferSourceConverter.toArrayBuffer(u),b=new DataView(v);let w="";for(let E=0;E<v.byteLength;E+=2){const S=b.getUint16(E,g);w+=String.fromCharCode(S)}return w}static fromString(u,g=!1){const v=new ArrayBuffer(u.length*2),b=new DataView(v);for(let w=0;w<u.length;w++)b.setUint16(w*2,u.charCodeAt(w),g);return v}}class Convert{static isHex(u){return typeof u===STRING_TYPE&&HEX_REGEX.test(u)}static isBase64(u){return typeof u===STRING_TYPE&&BASE64_REGEX.test(u)}static isBase64Url(u){return typeof u===STRING_TYPE&&BASE64URL_REGEX.test(u)}static ToString(u,g="utf8"){const v=BufferSourceConverter.toUint8Array(u);switch(g.toLowerCase()){case"utf8":return this.ToUtf8String(v);case"binary":return this.ToBinary(v);case"hex":return this.ToHex(v);case"base64":return this.ToBase64(v);case"base64url":return this.ToBase64Url(v);case"utf16le":return Utf16Converter.toString(v,!0);case"utf16":case"utf16be":return Utf16Converter.toString(v);default:throw new Error(`Unknown type of encoding '${g}'`)}}static FromString(u,g="utf8"){if(!u)return new ArrayBuffer(0);switch(g.toLowerCase()){case"utf8":return this.FromUtf8String(u);case"binary":return this.FromBinary(u);case"hex":return this.FromHex(u);case"base64":return this.FromBase64(u);case"base64url":return this.FromBase64Url(u);case"utf16le":return Utf16Converter.fromString(u,!0);case"utf16":case"utf16be":return Utf16Converter.fromString(u);default:throw new Error(`Unknown type of encoding '${g}'`)}}static ToBase64(u){const g=BufferSourceConverter.toUint8Array(u);if(typeof btoa<"u"){const v=this.ToString(g,"binary");return btoa(v)}else return Buffer.from(g).toString("base64")}static FromBase64(u){const g=this.formatString(u);if(!g)return new ArrayBuffer(0);if(!Convert.isBase64(g))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(g)):new Uint8Array(Buffer.from(g,"base64")).buffer}static FromBase64Url(u){const g=this.formatString(u);if(!g)return new ArrayBuffer(0);if(!Convert.isBase64Url(g))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(g.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(u){return this.ToBase64(u).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(u,g=Convert.DEFAULT_UTF8_ENCODING){switch(g){case"ascii":return this.FromBinary(u);case"utf8":return Utf8Converter.fromString(u);case"utf16":case"utf16be":return Utf16Converter.fromString(u);case"utf16le":case"usc2":return Utf16Converter.fromString(u,!0);default:throw new Error(`Unknown type of encoding '${g}'`)}}static ToUtf8String(u,g=Convert.DEFAULT_UTF8_ENCODING){switch(g){case"ascii":return this.ToBinary(u);case"utf8":return Utf8Converter.toString(u);case"utf16":case"utf16be":return Utf16Converter.toString(u);case"utf16le":case"usc2":return Utf16Converter.toString(u,!0);default:throw new Error(`Unknown type of encoding '${g}'`)}}static FromBinary(u){const g=u.length,v=new Uint8Array(g);for(let b=0;b<g;b++)v[b]=u.charCodeAt(b);return v.buffer}static ToBinary(u){const g=BufferSourceConverter.toUint8Array(u);let v="";for(let b=0;b<g.length;b++)v+=String.fromCharCode(g[b]);return v}static ToHex(u){const g=BufferSourceConverter.toUint8Array(u);let v="";const b=g.length;for(let w=0;w<b;w++){const E=g[w];E<16&&(v+="0"),v+=E.toString(16)}return v}static FromHex(u){let g=this.formatString(u);if(!g)return new ArrayBuffer(0);if(!Convert.isHex(g))throw new TypeError("Argument 'hexString' is not HEX encoded");g.length%2&&(g=`0${g}`);const v=new Uint8Array(g.length/2);for(let b=0;b<g.length;b=b+2){const w=g.slice(b,b+2);v[b/2]=parseInt(w,16)}return v.buffer}static ToUtf16String(u,g=!1){return Utf16Converter.toString(u,g)}static FromUtf16String(u,g=!1){return Utf16Converter.fromString(u,g)}static Base64Padding(u){const g=4-u.length%4;if(g<4)for(let v=0;v<g;v++)u+="=";return u}static formatString(u){return u?.replace(/[\n\r\t ]/g,"")||""}}Convert.DEFAULT_UTF8_ENCODING="utf8";function combine(...y){const u=y.map(b=>b.byteLength).reduce((b,w)=>b+w),g=new Uint8Array(u);let v=0;return y.map(b=>new Uint8Array(b)).forEach(b=>{for(const w of b)g[v++]=w}),g.buffer}function isEqual(y,u){if(!(y&&u)||y.byteLength!==u.byteLength)return!1;const g=new Uint8Array(y),v=new Uint8Array(u);for(let b=0;b<y.byteLength;b++)if(g[b]!==v[b])return!1;return!0}function utilFromBase(y,u){let g=0;if(y.length===1)return y[0];for(let v=y.length-1;v>=0;v--)g+=y[y.length-1-v]*Math.pow(2,u*v);return g}function utilToBase(y,u,g=-1){const v=g;let b=y,w=0,E=Math.pow(2,u);for(let S=1;S<8;S++){if(y<E){let A;if(v<0)A=new ArrayBuffer(S),w=S;else{if(v<S)return new ArrayBuffer(0);A=new ArrayBuffer(v),w=v}const $=new Uint8Array(A);for(let R=S-1;R>=0;R--){const T=Math.pow(2,R*u);$[w-R-1]=Math.floor(b/T),b-=$[w-R-1]*T}return A}E*=Math.pow(2,u)}return new ArrayBuffer(0)}function utilConcatView(...y){let u=0,g=0;for(const w of y)u+=w.length;const v=new ArrayBuffer(u),b=new Uint8Array(v);for(const w of y)b.set(w,g),g+=w.length;return b}function utilDecodeTC(){const y=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const S=y[0]===255&&y[1]&128,A=y[0]===0&&(y[1]&128)===0;(S||A)&&this.warnings.push("Needlessly long format")}const u=new ArrayBuffer(this.valueHex.byteLength),g=new Uint8Array(u);for(let S=0;S<this.valueHex.byteLength;S++)g[S]=0;g[0]=y[0]&128;const v=utilFromBase(g,8),b=new ArrayBuffer(this.valueHex.byteLength),w=new Uint8Array(b);for(let S=0;S<this.valueHex.byteLength;S++)w[S]=y[S];return w[0]&=127,utilFromBase(w,8)-v}function utilEncodeTC(y){const u=y<0?y*-1:y;let g=128;for(let v=1;v<8;v++){if(u<=g){if(y<0){const E=g-u,S=utilToBase(E,8,v),A=new Uint8Array(S);return A[0]|=128,S}let b=utilToBase(u,8,v),w=new Uint8Array(b);if(w[0]&128){const E=b.slice(0),S=new Uint8Array(E);b=new ArrayBuffer(b.byteLength+1),w=new Uint8Array(b);for(let A=0;A<E.byteLength;A++)w[A+1]=S[A];w[0]=0}return b}g*=Math.pow(2,8)}return new ArrayBuffer(0)}function isEqualBuffer(y,u){if(y.byteLength!==u.byteLength)return!1;const g=new Uint8Array(y),v=new Uint8Array(u);for(let b=0;b<g.length;b++)if(g[b]!==v[b])return!1;return!0}function padNumber(y,u){const g=y.toString(10);if(u<g.length)return"";const v=u-g.length,b=new Array(v);for(let E=0;E<v;E++)b[E]="0";return b.join("").concat(g)}function assertBigInt(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function concat(y){let u=0,g=0;for(let b=0;b<y.length;b++){const w=y[b];u+=w.byteLength}const v=new Uint8Array(u);for(let b=0;b<y.length;b++){const w=y[b];v.set(new Uint8Array(w),g),g+=w.byteLength}return v.buffer}function checkBufferParams(y,u,g,v){return u instanceof Uint8Array?u.byteLength?g<0?(y.error="Wrong parameter: inputOffset less than zero",!1):v<0?(y.error="Wrong parameter: inputLength less than zero",!1):u.byteLength-g-v<0?(y.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(y.error="Wrong parameter: inputBuffer has zero length",!1):(y.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class ViewWriter{constructor(){this.items=[]}write(u){this.items.push(u)}final(){return concat(this.items)}}const powers2=[new Uint8Array([1])],digitsString="0123456789",NAME$1="name",VALUE_HEX_VIEW="valueHexView",IS_HEX_ONLY="isHexOnly",ID_BLOCK="idBlock",TAG_CLASS="tagClass",TAG_NUMBER="tagNumber",IS_CONSTRUCTED="isConstructed",FROM_BER="fromBER",TO_BER="toBER",LOCAL="local",EMPTY_STRING="",EMPTY_BUFFER$2=new ArrayBuffer(0),EMPTY_VIEW=new Uint8Array(0),END_OF_CONTENT_NAME="EndOfContent",OCTET_STRING_NAME="OCTET STRING",BIT_STRING_NAME="BIT STRING";function HexBlock(y){var u;return u=class extends y{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(v){this.valueHexView=new Uint8Array(v)}constructor(...v){var b;super(...v);const w=v[0]||{};this.isHexOnly=(b=w.isHexOnly)!==null&&b!==void 0?b:!1,this.valueHexView=w.valueHex?BufferSourceConverter.toUint8Array(w.valueHex):EMPTY_VIEW}fromBER(v,b,w){const E=v instanceof ArrayBuffer?new Uint8Array(v):v;if(!checkBufferParams(this,E,b,w))return-1;const S=b+w;return this.valueHexView=E.subarray(b,S),this.valueHexView.length?(this.blockLength=w,S):(this.warnings.push("Zero buffer length"),b)}toBER(v=!1){return this.isHexOnly?v?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",EMPTY_BUFFER$2)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Convert.ToHex(this.valueHexView)}}},u.NAME="hexBlock",u}class LocalBaseBlock{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(u){this.valueBeforeDecodeView=new Uint8Array(u)}constructor({blockLength:u=0,error:g=EMPTY_STRING,warnings:v=[],valueBeforeDecode:b=EMPTY_VIEW}={}){this.blockLength=u,this.error=g,this.warnings=v,this.valueBeforeDecodeView=BufferSourceConverter.toUint8Array(b)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Convert.ToHex(this.valueBeforeDecodeView)}}}LocalBaseBlock.NAME="baseBlock";class ValueBlock extends LocalBaseBlock{fromBER(u,g,v){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(u,g){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}ValueBlock.NAME="valueBlock";class LocalIdentificationBlock extends HexBlock(LocalBaseBlock){constructor({idBlock:u={}}={}){var g,v,b,w;super(),u?(this.isHexOnly=(g=u.isHexOnly)!==null&&g!==void 0?g:!1,this.valueHexView=u.valueHex?BufferSourceConverter.toUint8Array(u.valueHex):EMPTY_VIEW,this.tagClass=(v=u.tagClass)!==null&&v!==void 0?v:-1,this.tagNumber=(b=u.tagNumber)!==null&&b!==void 0?b:-1,this.isConstructed=(w=u.isConstructed)!==null&&w!==void 0?w:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(u=!1){let g=0;switch(this.tagClass){case 1:g|=0;break;case 2:g|=64;break;case 3:g|=128;break;case 4:g|=192;break;default:return this.error="Unknown tag class",EMPTY_BUFFER$2}if(this.isConstructed&&(g|=32),this.tagNumber<31&&!this.isHexOnly){const b=new Uint8Array(1);if(!u){let w=this.tagNumber;w&=31,g|=w,b[0]=g}return b.buffer}if(!this.isHexOnly){const b=utilToBase(this.tagNumber,7),w=new Uint8Array(b),E=b.byteLength,S=new Uint8Array(E+1);if(S[0]=g|31,!u){for(let A=0;A<E-1;A++)S[A+1]=w[A]|128;S[E]=w[E-1]}return S.buffer}const v=new Uint8Array(this.valueHexView.byteLength+1);if(v[0]=g|31,!u){const b=this.valueHexView;for(let w=0;w<b.length-1;w++)v[w+1]=b[w]|128;v[this.valueHexView.byteLength]=b[b.length-1]}return v.buffer}fromBER(u,g,v){const b=BufferSourceConverter.toUint8Array(u);if(!checkBufferParams(this,b,g,v))return-1;const w=b.subarray(g,g+v);if(w.length===0)return this.error="Zero buffer length",-1;switch(w[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(w[0]&32)===32,this.isHexOnly=!1;const S=w[0]&31;if(S!==31)this.tagNumber=S,this.blockLength=1;else{let A=1,$=this.valueHexView=new Uint8Array(255),R=255;for(;w[A]&128;){if($[A-1]=w[A]&127,A++,A>=w.length)return this.error="End of input reached before message was fully decoded",-1;if(A===R){R+=255;const O=new Uint8Array(R);for(let B=0;B<$.length;B++)O[B]=$[B];$=this.valueHexView=new Uint8Array(R)}}this.blockLength=A+1,$[A-1]=w[A]&127;const T=new Uint8Array(A);for(let O=0;O<A;O++)T[O]=$[O];$=this.valueHexView=new Uint8Array(A),$.set(T),this.blockLength<=9?this.tagNumber=utilFromBase($,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return g+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}LocalIdentificationBlock.NAME="identificationBlock";class LocalLengthBlock extends LocalBaseBlock{constructor({lenBlock:u={}}={}){var g,v,b;super(),this.isIndefiniteForm=(g=u.isIndefiniteForm)!==null&&g!==void 0?g:!1,this.longFormUsed=(v=u.longFormUsed)!==null&&v!==void 0?v:!1,this.length=(b=u.length)!==null&&b!==void 0?b:0}fromBER(u,g,v){const b=BufferSourceConverter.toUint8Array(u);if(!checkBufferParams(this,b,g,v))return-1;const w=b.subarray(g,g+v);if(w.length===0)return this.error="Zero buffer length",-1;if(w[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=w[0]===128,this.isIndefiniteForm)return this.blockLength=1,g+this.blockLength;if(this.longFormUsed=!!(w[0]&128),this.longFormUsed===!1)return this.length=w[0],this.blockLength=1,g+this.blockLength;const E=w[0]&127;if(E>8)return this.error="Too big integer",-1;if(E+1>w.length)return this.error="End of input reached before message was fully decoded",-1;const S=g+1,A=b.subarray(S,S+E);return A[E-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=utilFromBase(A,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=E+1,g+this.blockLength}toBER(u=!1){let g,v;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return g=new ArrayBuffer(1),u===!1&&(v=new Uint8Array(g),v[0]=128),g;if(this.longFormUsed){const b=utilToBase(this.length,8);if(b.byteLength>127)return this.error="Too big length",EMPTY_BUFFER$2;if(g=new ArrayBuffer(b.byteLength+1),u)return g;const w=new Uint8Array(b);v=new Uint8Array(g),v[0]=b.byteLength|128;for(let E=0;E<b.byteLength;E++)v[E+1]=w[E];return g}return g=new ArrayBuffer(1),u===!1&&(v=new Uint8Array(g),v[0]=this.length),g}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}LocalLengthBlock.NAME="lengthBlock";const typeStore={};class BaseBlock extends LocalBaseBlock{constructor({name:u=EMPTY_STRING,optional:g=!1,primitiveSchema:v,...b}={},w){super(b),this.name=u,this.optional=g,v&&(this.primitiveSchema=v),this.idBlock=new LocalIdentificationBlock(b),this.lenBlock=new LocalLengthBlock(b),this.valueBlock=w?new w(b):new ValueBlock(b)}fromBER(u,g,v){const b=this.valueBlock.fromBER(u,g,this.lenBlock.isIndefiniteForm?v:this.lenBlock.length);return b===-1?(this.error=this.valueBlock.error,b):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),b)}toBER(u,g){const v=g||new ViewWriter;g||prepareIndefiniteForm(this);const b=this.idBlock.toBER(u);if(v.write(b),this.lenBlock.isIndefiniteForm)v.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(u,v),v.write(new ArrayBuffer(2));else{const w=this.valueBlock.toBER(u);this.lenBlock.length=w.byteLength;const E=this.lenBlock.toBER(u);v.write(E),v.write(w)}return g?EMPTY_BUFFER$2:v.final()}toJSON(){const u={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(u.primitiveSchema=this.primitiveSchema.toJSON()),u}toString(u="ascii"){return u==="ascii"?this.onAsciiEncoding():Convert.ToHex(this.toBER())}onAsciiEncoding(){const u=this.constructor.NAME,g=Convert.ToHex(this.valueBlock.valueBeforeDecodeView);return`${u} : ${g}`}isEqual(u){if(this===u)return!0;if(!(u instanceof this.constructor))return!1;const g=this.toBER(),v=u.toBER();return isEqualBuffer(g,v)}}BaseBlock.NAME="BaseBlock";function prepareIndefiniteForm(y){var u;if(y instanceof typeStore.Constructed)for(const g of y.valueBlock.value)prepareIndefiniteForm(g)&&(y.lenBlock.isIndefiniteForm=!0);return!!(!((u=y.lenBlock)===null||u===void 0)&&u.isIndefiniteForm)}class BaseStringBlock extends BaseBlock{getValue(){return this.valueBlock.value}setValue(u){this.valueBlock.value=u}constructor({value:u=EMPTY_STRING,...g}={},v){super(g,v),u&&this.fromString(u)}fromBER(u,g,v){const b=this.valueBlock.fromBER(u,g,this.lenBlock.isIndefiniteForm?v:this.lenBlock.length);return b===-1?(this.error=this.valueBlock.error,b):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),b)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}BaseStringBlock.NAME="BaseStringBlock";class LocalPrimitiveValueBlock extends HexBlock(ValueBlock){constructor({isHexOnly:u=!0,...g}={}){super(g),this.isHexOnly=u}}LocalPrimitiveValueBlock.NAME="PrimitiveValueBlock";var _a$w;class Primitive extends BaseBlock{constructor(u={}){super(u,LocalPrimitiveValueBlock),this.idBlock.isConstructed=!1}}_a$w=Primitive;typeStore.Primitive=_a$w;Primitive.NAME="PRIMITIVE";function localChangeType(y,u){if(y instanceof u)return y;const g=new u;return g.idBlock=y.idBlock,g.lenBlock=y.lenBlock,g.warnings=y.warnings,g.valueBeforeDecodeView=y.valueBeforeDecodeView,g}function localFromBER(y,u=0,g=y.length){const v=u;let b=new BaseBlock({},ValueBlock);const w=new LocalBaseBlock;if(!checkBufferParams(w,y,u,g))return b.error=w.error,{offset:-1,result:b};if(!y.subarray(u,u+g).length)return b.error="Zero buffer length",{offset:-1,result:b};let S=b.idBlock.fromBER(y,u,g);if(b.idBlock.warnings.length&&b.warnings.concat(b.idBlock.warnings),S===-1)return b.error=b.idBlock.error,{offset:-1,result:b};if(u=S,g-=b.idBlock.blockLength,S=b.lenBlock.fromBER(y,u,g),b.lenBlock.warnings.length&&b.warnings.concat(b.lenBlock.warnings),S===-1)return b.error=b.lenBlock.error,{offset:-1,result:b};if(u=S,g-=b.lenBlock.blockLength,!b.idBlock.isConstructed&&b.lenBlock.isIndefiniteForm)return b.error="Indefinite length form used for primitive encoding form",{offset:-1,result:b};let A=BaseBlock;switch(b.idBlock.tagClass){case 1:if(b.idBlock.tagNumber>=37&&b.idBlock.isHexOnly===!1)return b.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:b};switch(b.idBlock.tagNumber){case 0:if(b.idBlock.isConstructed&&b.lenBlock.length>0)return b.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:b};A=typeStore.EndOfContent;break;case 1:A=typeStore.Boolean;break;case 2:A=typeStore.Integer;break;case 3:A=typeStore.BitString;break;case 4:A=typeStore.OctetString;break;case 5:A=typeStore.Null;break;case 6:A=typeStore.ObjectIdentifier;break;case 10:A=typeStore.Enumerated;break;case 12:A=typeStore.Utf8String;break;case 13:A=typeStore.RelativeObjectIdentifier;break;case 14:A=typeStore.TIME;break;case 15:return b.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:b};case 16:A=typeStore.Sequence;break;case 17:A=typeStore.Set;break;case 18:A=typeStore.NumericString;break;case 19:A=typeStore.PrintableString;break;case 20:A=typeStore.TeletexString;break;case 21:A=typeStore.VideotexString;break;case 22:A=typeStore.IA5String;break;case 23:A=typeStore.UTCTime;break;case 24:A=typeStore.GeneralizedTime;break;case 25:A=typeStore.GraphicString;break;case 26:A=typeStore.VisibleString;break;case 27:A=typeStore.GeneralString;break;case 28:A=typeStore.UniversalString;break;case 29:A=typeStore.CharacterString;break;case 30:A=typeStore.BmpString;break;case 31:A=typeStore.DATE;break;case 32:A=typeStore.TimeOfDay;break;case 33:A=typeStore.DateTime;break;case 34:A=typeStore.Duration;break;default:{const $=b.idBlock.isConstructed?new typeStore.Constructed:new typeStore.Primitive;$.idBlock=b.idBlock,$.lenBlock=b.lenBlock,$.warnings=b.warnings,b=$}}break;case 2:case 3:case 4:default:A=b.idBlock.isConstructed?typeStore.Constructed:typeStore.Primitive}return b=localChangeType(b,A),S=b.fromBER(y,u,b.lenBlock.isIndefiniteForm?g:b.lenBlock.length),b.valueBeforeDecodeView=y.subarray(v,v+b.blockLength),{offset:S,result:b}}function fromBER(y){if(!y.byteLength){const u=new BaseBlock({},ValueBlock);return u.error="Input buffer has zero length",{offset:-1,result:u}}return localFromBER(BufferSourceConverter.toUint8Array(y).slice(),0,y.byteLength)}function checkLen(y,u){return y?1:u}class LocalConstructedValueBlock extends ValueBlock{constructor({value:u=[],isIndefiniteForm:g=!1,...v}={}){super(v),this.value=u,this.isIndefiniteForm=g}fromBER(u,g,v){const b=BufferSourceConverter.toUint8Array(u);if(!checkBufferParams(this,b,g,v))return-1;if(this.valueBeforeDecodeView=b.subarray(g,g+v),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),g;let w=g;for(;checkLen(this.isIndefiniteForm,v)>0;){const E=localFromBER(b,w,v);if(E.offset===-1)return this.error=E.result.error,this.warnings.concat(E.result.warnings),-1;if(w=E.offset,this.blockLength+=E.result.blockLength,v-=E.result.blockLength,this.value.push(E.result),this.isIndefiniteForm&&E.result.constructor.NAME===END_OF_CONTENT_NAME)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===END_OF_CONTENT_NAME?this.value.pop():this.warnings.push("No EndOfContent block encoded")),w}toBER(u,g){const v=g||new ViewWriter;for(let b=0;b<this.value.length;b++)this.value[b].toBER(u,v);return g?EMPTY_BUFFER$2:v.final()}toJSON(){const u={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const g of this.value)u.value.push(g.toJSON());return u}}LocalConstructedValueBlock.NAME="ConstructedValueBlock";var _a$v;class Constructed extends BaseBlock{constructor(u={}){super(u,LocalConstructedValueBlock),this.idBlock.isConstructed=!0}fromBER(u,g,v){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const b=this.valueBlock.fromBER(u,g,this.lenBlock.isIndefiniteForm?v:this.lenBlock.length);return b===-1?(this.error=this.valueBlock.error,b):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),b)}onAsciiEncoding(){const u=[];for(const v of this.valueBlock.value)u.push(v.toString("ascii").split(`
`).map(b=>`  ${b}`).join(`
`));const g=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return u.length?`${g} :
${u.join(`
`)}`:`${g} :`}}_a$v=Constructed;typeStore.Constructed=_a$v;Constructed.NAME="CONSTRUCTED";class LocalEndOfContentValueBlock extends ValueBlock{fromBER(u,g,v){return g}toBER(u){return EMPTY_BUFFER$2}}LocalEndOfContentValueBlock.override="EndOfContentValueBlock";var _a$u;class EndOfContent extends BaseBlock{constructor(u={}){super(u,LocalEndOfContentValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}_a$u=EndOfContent;typeStore.EndOfContent=_a$u;EndOfContent.NAME=END_OF_CONTENT_NAME;var _a$t;class Null extends BaseBlock{constructor(u={}){super(u,ValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(u,g,v){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=v,g+v>u.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):g+v}toBER(u,g){const v=new ArrayBuffer(2);if(!u){const b=new Uint8Array(v);b[0]=5,b[1]=0}return g&&g.write(v),v}onAsciiEncoding(){return`${this.constructor.NAME}`}}_a$t=Null;typeStore.Null=_a$t;Null.NAME="NULL";class LocalBooleanValueBlock extends HexBlock(ValueBlock){get value(){for(const u of this.valueHexView)if(u>0)return!0;return!1}set value(u){this.valueHexView[0]=u?255:0}constructor({value:u,...g}={}){super(g),g.valueHex?this.valueHexView=BufferSourceConverter.toUint8Array(g.valueHex):this.valueHexView=new Uint8Array(1),u&&(this.value=u)}fromBER(u,g,v){const b=BufferSourceConverter.toUint8Array(u);return checkBufferParams(this,b,g,v)?(this.valueHexView=b.subarray(g,g+v),v>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,utilDecodeTC.call(this),this.blockLength=v,g+v):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}LocalBooleanValueBlock.NAME="BooleanValueBlock";var _a$s;let Boolean$1=class extends BaseBlock{getValue(){return this.valueBlock.value}setValue(u){this.valueBlock.value=u}constructor(u={}){super(u,LocalBooleanValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};_a$s=Boolean$1;typeStore.Boolean=_a$s;Boolean$1.NAME="BOOLEAN";class LocalOctetStringValueBlock extends HexBlock(LocalConstructedValueBlock){constructor({isConstructed:u=!1,...g}={}){super(g),this.isConstructed=u}fromBER(u,g,v){let b=0;if(this.isConstructed){if(this.isHexOnly=!1,b=LocalConstructedValueBlock.prototype.fromBER.call(this,u,g,v),b===-1)return b;for(let w=0;w<this.value.length;w++){const E=this.value[w].constructor.NAME;if(E===END_OF_CONTENT_NAME){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(E!==OCTET_STRING_NAME)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,b=super.fromBER(u,g,v),this.blockLength=v;return b}toBER(u,g){return this.isConstructed?LocalConstructedValueBlock.prototype.toBER.call(this,u,g):u?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}LocalOctetStringValueBlock.NAME="OctetStringValueBlock";var _a$r;let OctetString$1=class extends BaseBlock{constructor({idBlock:u={},lenBlock:g={},...v}={}){var b,w;(b=v.isConstructed)!==null&&b!==void 0||(v.isConstructed=!!(!((w=v.value)===null||w===void 0)&&w.length)),super({idBlock:{isConstructed:v.isConstructed,...u},lenBlock:{...g,isIndefiniteForm:!!v.isIndefiniteForm},...v},LocalOctetStringValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(u,g,v){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,v===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),g;if(!this.valueBlock.isConstructed){const w=(u instanceof ArrayBuffer?new Uint8Array(u):u).subarray(g,g+v);try{if(w.byteLength){const E=localFromBER(w,0,w.byteLength);E.offset!==-1&&E.offset===v&&(this.valueBlock.value=[E.result])}}catch{}}return super.fromBER(u,g,v)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Constructed.prototype.onAsciiEncoding.call(this);const u=this.constructor.NAME,g=Convert.ToHex(this.valueBlock.valueHexView);return`${u} : ${g}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const u=[];for(const g of this.valueBlock.value)g instanceof _a$r&&u.push(g.valueBlock.valueHexView);return BufferSourceConverter.concat(u)}};_a$r=OctetString$1;typeStore.OctetString=_a$r;OctetString$1.NAME=OCTET_STRING_NAME;class LocalBitStringValueBlock extends HexBlock(LocalConstructedValueBlock){constructor({unusedBits:u=0,isConstructed:g=!1,...v}={}){super(v),this.unusedBits=u,this.isConstructed=g,this.blockLength=this.valueHexView.byteLength}fromBER(u,g,v){if(!v)return g;let b=-1;if(this.isConstructed){if(b=LocalConstructedValueBlock.prototype.fromBER.call(this,u,g,v),b===-1)return b;for(const S of this.value){const A=S.constructor.NAME;if(A===END_OF_CONTENT_NAME){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(A!==BIT_STRING_NAME)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const $=S.valueBlock;if(this.unusedBits>0&&$.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=$.unusedBits}return b}const w=BufferSourceConverter.toUint8Array(u);if(!checkBufferParams(this,w,g,v))return-1;const E=w.subarray(g,g+v);if(this.unusedBits=E[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const S=E.subarray(1);try{if(S.byteLength){const A=localFromBER(S,0,S.byteLength);A.offset!==-1&&A.offset===v-1&&(this.value=[A.result])}}catch{}}return this.valueHexView=E.subarray(1),this.blockLength=E.length,g+v}toBER(u,g){if(this.isConstructed)return LocalConstructedValueBlock.prototype.toBER.call(this,u,g);if(u)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return EMPTY_BUFFER$2;const v=new Uint8Array(this.valueHexView.length+1);return v[0]=this.unusedBits,v.set(this.valueHexView,1),v.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}LocalBitStringValueBlock.NAME="BitStringValueBlock";var _a$q;let BitString$1=class extends BaseBlock{constructor({idBlock:u={},lenBlock:g={},...v}={}){var b,w;(b=v.isConstructed)!==null&&b!==void 0||(v.isConstructed=!!(!((w=v.value)===null||w===void 0)&&w.length)),super({idBlock:{isConstructed:v.isConstructed,...u},lenBlock:{...g,isIndefiniteForm:!!v.isIndefiniteForm},...v},LocalBitStringValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(u,g,v){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(u,g,v)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Constructed.prototype.onAsciiEncoding.call(this);{const u=[],g=this.valueBlock.valueHexView;for(const E of g)u.push(E.toString(2).padStart(8,"0"));const v=u.join(""),b=this.constructor.NAME,w=v.substring(0,v.length-this.valueBlock.unusedBits);return`${b} : ${w}`}}};_a$q=BitString$1;typeStore.BitString=_a$q;BitString$1.NAME=BIT_STRING_NAME;var _a$p;function viewAdd(y,u){const g=new Uint8Array([0]),v=new Uint8Array(y),b=new Uint8Array(u);let w=v.slice(0);const E=w.length-1,S=b.slice(0),A=S.length-1;let $=0;const R=A<E?E:A;let T=0;for(let O=R;O>=0;O--,T++){switch(!0){case T<S.length:$=w[E-T]+S[A-T]+g[0];break;default:$=w[E-T]+g[0]}switch(g[0]=$/10,!0){case T>=w.length:w=utilConcatView(new Uint8Array([$%10]),w);break;default:w[E-T]=$%10}}return g[0]>0&&(w=utilConcatView(g,w)),w}function power2(y){if(y>=powers2.length)for(let u=powers2.length;u<=y;u++){const g=new Uint8Array([0]);let v=powers2[u-1].slice(0);for(let b=v.length-1;b>=0;b--){const w=new Uint8Array([(v[b]<<1)+g[0]]);g[0]=w[0]/10,v[b]=w[0]%10}g[0]>0&&(v=utilConcatView(g,v)),powers2.push(v)}return powers2[y]}function viewSub(y,u){let g=0;const v=new Uint8Array(y),b=new Uint8Array(u),w=v.slice(0),E=w.length-1,S=b.slice(0),A=S.length-1;let $,R=0;for(let T=A;T>=0;T--,R++)switch($=w[E-R]-S[A-R]-g,!0){case $<0:g=1,w[E-R]=$+10;break;default:g=0,w[E-R]=$}if(g>0)for(let T=E-A+1;T>=0;T--,R++)if($=w[E-R]-g,$<0)g=1,w[E-R]=$+10;else{g=0,w[E-R]=$;break}return w.slice()}class LocalIntegerValueBlock extends HexBlock(ValueBlock){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=utilDecodeTC.call(this)))}constructor({value:u,...g}={}){super(g),this._valueDec=0,g.valueHex&&this.setValueHex(),u!==void 0&&(this.valueDec=u)}set valueDec(u){this._valueDec=u,this.isHexOnly=!1,this.valueHexView=new Uint8Array(utilEncodeTC(u))}get valueDec(){return this._valueDec}fromDER(u,g,v,b=0){const w=this.fromBER(u,g,v);if(w===-1)return w;const E=this.valueHexView;return E[0]===0&&(E[1]&128)!==0?this.valueHexView=E.subarray(1):b!==0&&E.length<b&&(b-E.length>1&&(b=E.length+1),this.valueHexView=E.subarray(b-E.length)),w}toDER(u=!1){const g=this.valueHexView;switch(!0){case(g[0]&128)!==0:{const v=new Uint8Array(this.valueHexView.length+1);v[0]=0,v.set(g,1),this.valueHexView=v}break;case(g[0]===0&&(g[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(u)}fromBER(u,g,v){const b=super.fromBER(u,g,v);return b===-1||this.setValueHex(),b}toBER(u){return u?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const u=this.valueHexView.length*8-1;let g=new Uint8Array(this.valueHexView.length*8/3),v=0,b;const w=this.valueHexView;let E="",S=!1;for(let A=w.byteLength-1;A>=0;A--){b=w[A];for(let $=0;$<8;$++){if((b&1)===1)switch(v){case u:g=viewSub(power2(v),g),E="-";break;default:g=viewAdd(g,power2(v))}v++,b>>=1}}for(let A=0;A<g.length;A++)g[A]&&(S=!0),S&&(E+=digitsString.charAt(g[A]));return S===!1&&(E+=digitsString.charAt(0)),E}}_a$p=LocalIntegerValueBlock;LocalIntegerValueBlock.NAME="IntegerValueBlock";Object.defineProperty(_a$p.prototype,"valueHex",{set:function(y){this.valueHexView=new Uint8Array(y),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var _a$o;class Integer extends BaseBlock{constructor(u={}){super(u,LocalIntegerValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return assertBigInt(),BigInt(this.valueBlock.toString())}static fromBigInt(u){assertBigInt();const g=BigInt(u),v=new ViewWriter,b=g.toString(16).replace(/^-/,""),w=new Uint8Array(Convert.FromHex(b));if(g<0){const S=new Uint8Array(w.length+(w[0]&128?1:0));S[0]|=128;const $=BigInt(`0x${Convert.ToHex(S)}`)+g,R=BufferSourceConverter.toUint8Array(Convert.FromHex($.toString(16)));R[0]|=128,v.write(R)}else w[0]&128&&v.write(new Uint8Array([0])),v.write(w);return new _a$o({valueHex:v.final()})}convertToDER(){const u=new _a$o({valueHex:this.valueBlock.valueHexView});return u.valueBlock.toDER(),u}convertFromDER(){return new _a$o({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}_a$o=Integer;typeStore.Integer=_a$o;Integer.NAME="INTEGER";var _a$n;class Enumerated extends Integer{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}_a$n=Enumerated;typeStore.Enumerated=_a$n;Enumerated.NAME="ENUMERATED";class LocalSidValueBlock extends HexBlock(ValueBlock){constructor({valueDec:u=-1,isFirstSid:g=!1,...v}={}){super(v),this.valueDec=u,this.isFirstSid=g}fromBER(u,g,v){if(!v)return g;const b=BufferSourceConverter.toUint8Array(u);if(!checkBufferParams(this,b,g,v))return-1;const w=b.subarray(g,g+v);this.valueHexView=new Uint8Array(v);for(let S=0;S<v&&(this.valueHexView[S]=w[S]&127,this.blockLength++,(w[S]&128)!==0);S++);const E=new Uint8Array(this.blockLength);for(let S=0;S<this.blockLength;S++)E[S]=this.valueHexView[S];return this.valueHexView=E,(w[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),g+this.blockLength)}set valueBigInt(u){assertBigInt();let g=BigInt(u).toString(2);for(;g.length%7;)g="0"+g;const v=new Uint8Array(g.length/7);for(let b=0;b<v.length;b++)v[b]=parseInt(g.slice(b*7,b*7+7),2)+(b+1<v.length?128:0);this.fromBER(v.buffer,0,v.length)}toBER(u){if(this.isHexOnly){if(u)return new ArrayBuffer(this.valueHexView.byteLength);const b=this.valueHexView,w=new Uint8Array(this.blockLength);for(let E=0;E<this.blockLength-1;E++)w[E]=b[E]|128;return w[this.blockLength-1]=b[this.blockLength-1],w.buffer}const g=utilToBase(this.valueDec,7);if(g.byteLength===0)return this.error="Error during encoding SID value",EMPTY_BUFFER$2;const v=new Uint8Array(g.byteLength);if(!u){const b=new Uint8Array(g),w=g.byteLength-1;for(let E=0;E<w;E++)v[E]=b[E]|128;v[w]=b[w]}return v}toString(){let u="";if(this.isHexOnly)u=Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let g=this.valueDec;this.valueDec<=39?u="0.":this.valueDec<=79?(u="1.",g-=40):(u="2.",g-=80),u+=g.toString()}else u=this.valueDec.toString();return u}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}LocalSidValueBlock.NAME="sidBlock";class LocalObjectIdentifierValueBlock extends ValueBlock{constructor({value:u=EMPTY_STRING,...g}={}){super(g),this.value=[],u&&this.fromString(u)}fromBER(u,g,v){let b=g;for(;v>0;){const w=new LocalSidValueBlock;if(b=w.fromBER(u,b,v),b===-1)return this.blockLength=0,this.error=w.error,b;this.value.length===0&&(w.isFirstSid=!0),this.blockLength+=w.blockLength,v-=w.blockLength,this.value.push(w)}return b}toBER(u){const g=[];for(let v=0;v<this.value.length;v++){const b=this.value[v].toBER(u);if(b.byteLength===0)return this.error=this.value[v].error,EMPTY_BUFFER$2;g.push(b)}return concat(g)}fromString(u){this.value=[];let g=0,v=0,b="",w=!1;do if(v=u.indexOf(".",g),v===-1?b=u.substring(g):b=u.substring(g,v),g=v+1,w){const E=this.value[0];let S=0;switch(E.valueDec){case 0:break;case 1:S=40;break;case 2:S=80;break;default:this.value=[];return}const A=parseInt(b,10);if(isNaN(A))return;E.valueDec=A+S,w=!1}else{const E=new LocalSidValueBlock;if(b>Number.MAX_SAFE_INTEGER){assertBigInt();const S=BigInt(b);E.valueBigInt=S}else if(E.valueDec=parseInt(b,10),isNaN(E.valueDec))return;this.value.length||(E.isFirstSid=!0,w=!0),this.value.push(E)}while(v!==-1)}toString(){let u="",g=!1;for(let v=0;v<this.value.length;v++){g=this.value[v].isHexOnly;let b=this.value[v].toString();v!==0&&(u=`${u}.`),g?(b=`{${b}}`,this.value[v].isFirstSid?u=`2.{${b} - 80}`:u+=b):u+=b}return u}toJSON(){const u={...super.toJSON(),value:this.toString(),sidArray:[]};for(let g=0;g<this.value.length;g++)u.sidArray.push(this.value[g].toJSON());return u}}LocalObjectIdentifierValueBlock.NAME="ObjectIdentifierValueBlock";var _a$m;class ObjectIdentifier extends BaseBlock{getValue(){return this.valueBlock.toString()}setValue(u){this.valueBlock.fromString(u)}constructor(u={}){super(u,LocalObjectIdentifierValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}_a$m=ObjectIdentifier;typeStore.ObjectIdentifier=_a$m;ObjectIdentifier.NAME="OBJECT IDENTIFIER";class LocalRelativeSidValueBlock extends HexBlock(LocalBaseBlock){constructor({valueDec:u=0,...g}={}){super(g),this.valueDec=u}fromBER(u,g,v){if(v===0)return g;const b=BufferSourceConverter.toUint8Array(u);if(!checkBufferParams(this,b,g,v))return-1;const w=b.subarray(g,g+v);this.valueHexView=new Uint8Array(v);for(let S=0;S<v&&(this.valueHexView[S]=w[S]&127,this.blockLength++,(w[S]&128)!==0);S++);const E=new Uint8Array(this.blockLength);for(let S=0;S<this.blockLength;S++)E[S]=this.valueHexView[S];return this.valueHexView=E,(w[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),g+this.blockLength)}toBER(u){if(this.isHexOnly){if(u)return new ArrayBuffer(this.valueHexView.byteLength);const b=this.valueHexView,w=new Uint8Array(this.blockLength);for(let E=0;E<this.blockLength-1;E++)w[E]=b[E]|128;return w[this.blockLength-1]=b[this.blockLength-1],w.buffer}const g=utilToBase(this.valueDec,7);if(g.byteLength===0)return this.error="Error during encoding SID value",EMPTY_BUFFER$2;const v=new Uint8Array(g.byteLength);if(!u){const b=new Uint8Array(g),w=g.byteLength-1;for(let E=0;E<w;E++)v[E]=b[E]|128;v[w]=b[w]}return v.buffer}toString(){let u="";return this.isHexOnly?u=Convert.ToHex(this.valueHexView):u=this.valueDec.toString(),u}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}LocalRelativeSidValueBlock.NAME="relativeSidBlock";class LocalRelativeObjectIdentifierValueBlock extends ValueBlock{constructor({value:u=EMPTY_STRING,...g}={}){super(g),this.value=[],u&&this.fromString(u)}fromBER(u,g,v){let b=g;for(;v>0;){const w=new LocalRelativeSidValueBlock;if(b=w.fromBER(u,b,v),b===-1)return this.blockLength=0,this.error=w.error,b;this.blockLength+=w.blockLength,v-=w.blockLength,this.value.push(w)}return b}toBER(u,g){const v=[];for(let b=0;b<this.value.length;b++){const w=this.value[b].toBER(u);if(w.byteLength===0)return this.error=this.value[b].error,EMPTY_BUFFER$2;v.push(w)}return concat(v)}fromString(u){this.value=[];let g=0,v=0,b="";do{v=u.indexOf(".",g),v===-1?b=u.substring(g):b=u.substring(g,v),g=v+1;const w=new LocalRelativeSidValueBlock;if(w.valueDec=parseInt(b,10),isNaN(w.valueDec))return!0;this.value.push(w)}while(v!==-1);return!0}toString(){let u="",g=!1;for(let v=0;v<this.value.length;v++){g=this.value[v].isHexOnly;let b=this.value[v].toString();v!==0&&(u=`${u}.`),g&&(b=`{${b}}`),u+=b}return u}toJSON(){const u={...super.toJSON(),value:this.toString(),sidArray:[]};for(let g=0;g<this.value.length;g++)u.sidArray.push(this.value[g].toJSON());return u}}LocalRelativeObjectIdentifierValueBlock.NAME="RelativeObjectIdentifierValueBlock";var _a$l;class RelativeObjectIdentifier extends BaseBlock{getValue(){return this.valueBlock.toString()}setValue(u){this.valueBlock.fromString(u)}constructor(u={}){super(u,LocalRelativeObjectIdentifierValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}_a$l=RelativeObjectIdentifier;typeStore.RelativeObjectIdentifier=_a$l;RelativeObjectIdentifier.NAME="RelativeObjectIdentifier";var _a$k;class Sequence extends Constructed{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}_a$k=Sequence;typeStore.Sequence=_a$k;Sequence.NAME="SEQUENCE";var _a$j;let Set$1=class extends Constructed{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};_a$j=Set$1;typeStore.Set=_a$j;Set$1.NAME="SET";class LocalStringValueBlock extends HexBlock(ValueBlock){constructor({...u}={}){super(u),this.isHexOnly=!0,this.value=EMPTY_STRING}toJSON(){return{...super.toJSON(),value:this.value}}}LocalStringValueBlock.NAME="StringValueBlock";class LocalSimpleStringValueBlock extends LocalStringValueBlock{}LocalSimpleStringValueBlock.NAME="SimpleStringValueBlock";class LocalSimpleStringBlock extends BaseStringBlock{constructor({...u}={}){super(u,LocalSimpleStringValueBlock)}fromBuffer(u){this.valueBlock.value=String.fromCharCode.apply(null,BufferSourceConverter.toUint8Array(u))}fromString(u){const g=u.length,v=this.valueBlock.valueHexView=new Uint8Array(g);for(let b=0;b<g;b++)v[b]=u.charCodeAt(b);this.valueBlock.value=u}}LocalSimpleStringBlock.NAME="SIMPLE STRING";class LocalUtf8StringValueBlock extends LocalSimpleStringBlock{fromBuffer(u){this.valueBlock.valueHexView=BufferSourceConverter.toUint8Array(u);try{this.valueBlock.value=Convert.ToUtf8String(u)}catch(g){this.warnings.push(`Error during "decodeURIComponent": ${g}, using raw string`),this.valueBlock.value=Convert.ToBinary(u)}}fromString(u){this.valueBlock.valueHexView=new Uint8Array(Convert.FromUtf8String(u)),this.valueBlock.value=u}}LocalUtf8StringValueBlock.NAME="Utf8StringValueBlock";var _a$i;class Utf8String extends LocalUtf8StringValueBlock{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}_a$i=Utf8String;typeStore.Utf8String=_a$i;Utf8String.NAME="UTF8String";class LocalBmpStringValueBlock extends LocalSimpleStringBlock{fromBuffer(u){this.valueBlock.value=Convert.ToUtf16String(u),this.valueBlock.valueHexView=BufferSourceConverter.toUint8Array(u)}fromString(u){this.valueBlock.value=u,this.valueBlock.valueHexView=new Uint8Array(Convert.FromUtf16String(u))}}LocalBmpStringValueBlock.NAME="BmpStringValueBlock";var _a$h;class BmpString extends LocalBmpStringValueBlock{constructor({...u}={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}_a$h=BmpString;typeStore.BmpString=_a$h;BmpString.NAME="BMPString";class LocalUniversalStringValueBlock extends LocalSimpleStringBlock{fromBuffer(u){const g=ArrayBuffer.isView(u)?u.slice().buffer:u.slice(0),v=new Uint8Array(g);for(let b=0;b<v.length;b+=4)v[b]=v[b+3],v[b+1]=v[b+2],v[b+2]=0,v[b+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(g))}fromString(u){const g=u.length,v=this.valueBlock.valueHexView=new Uint8Array(g*4);for(let b=0;b<g;b++){const w=utilToBase(u.charCodeAt(b),8),E=new Uint8Array(w);if(E.length>4)continue;const S=4-E.length;for(let A=E.length-1;A>=0;A--)v[b*4+A+S]=E[A]}this.valueBlock.value=u}}LocalUniversalStringValueBlock.NAME="UniversalStringValueBlock";var _a$g;class UniversalString extends LocalUniversalStringValueBlock{constructor({...u}={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}_a$g=UniversalString;typeStore.UniversalString=_a$g;UniversalString.NAME="UniversalString";var _a$f;class NumericString extends LocalSimpleStringBlock{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}_a$f=NumericString;typeStore.NumericString=_a$f;NumericString.NAME="NumericString";var _a$e;class PrintableString extends LocalSimpleStringBlock{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}_a$e=PrintableString;typeStore.PrintableString=_a$e;PrintableString.NAME="PrintableString";var _a$d;class TeletexString extends LocalSimpleStringBlock{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}_a$d=TeletexString;typeStore.TeletexString=_a$d;TeletexString.NAME="TeletexString";var _a$c;class VideotexString extends LocalSimpleStringBlock{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}_a$c=VideotexString;typeStore.VideotexString=_a$c;VideotexString.NAME="VideotexString";var _a$b;class IA5String extends LocalSimpleStringBlock{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}_a$b=IA5String;typeStore.IA5String=_a$b;IA5String.NAME="IA5String";var _a$a;class GraphicString extends LocalSimpleStringBlock{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}_a$a=GraphicString;typeStore.GraphicString=_a$a;GraphicString.NAME="GraphicString";var _a$9;class VisibleString extends LocalSimpleStringBlock{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}_a$9=VisibleString;typeStore.VisibleString=_a$9;VisibleString.NAME="VisibleString";var _a$8;class GeneralString extends LocalSimpleStringBlock{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}_a$8=GeneralString;typeStore.GeneralString=_a$8;GeneralString.NAME="GeneralString";var _a$7;class CharacterString extends LocalSimpleStringBlock{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}_a$7=CharacterString;typeStore.CharacterString=_a$7;CharacterString.NAME="CharacterString";var _a$6;class UTCTime extends VisibleString{constructor({value:u,valueDate:g,...v}={}){if(super(v),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,u){this.fromString(u),this.valueBlock.valueHexView=new Uint8Array(u.length);for(let b=0;b<u.length;b++)this.valueBlock.valueHexView[b]=u.charCodeAt(b)}g&&(this.fromDate(g),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(u){this.fromString(String.fromCharCode.apply(null,BufferSourceConverter.toUint8Array(u)))}toBuffer(){const u=this.toString(),g=new ArrayBuffer(u.length),v=new Uint8Array(g);for(let b=0;b<u.length;b++)v[b]=u.charCodeAt(b);return g}fromDate(u){this.year=u.getUTCFullYear(),this.month=u.getUTCMonth()+1,this.day=u.getUTCDate(),this.hour=u.getUTCHours(),this.minute=u.getUTCMinutes(),this.second=u.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(u){const v=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(u);if(v===null){this.error="Wrong input string for conversion";return}const b=parseInt(v[1],10);b>=50?this.year=1900+b:this.year=2e3+b,this.month=parseInt(v[2],10),this.day=parseInt(v[3],10),this.hour=parseInt(v[4],10),this.minute=parseInt(v[5],10),this.second=parseInt(v[6],10)}toString(u="iso"){if(u==="iso"){const g=new Array(7);return g[0]=padNumber(this.year<2e3?this.year-1900:this.year-2e3,2),g[1]=padNumber(this.month,2),g[2]=padNumber(this.day,2),g[3]=padNumber(this.hour,2),g[4]=padNumber(this.minute,2),g[5]=padNumber(this.second,2),g[6]="Z",g.join("")}return super.toString(u)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}_a$6=UTCTime;typeStore.UTCTime=_a$6;UTCTime.NAME="UTCTime";var _a$5;class GeneralizedTime extends UTCTime{constructor(u={}){var g;super(u),(g=this.millisecond)!==null&&g!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(u){super.fromDate(u),this.millisecond=u.getUTCMilliseconds()}toDate(){const u=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(u)}fromString(u){let g=!1,v="",b="",w=0,E,S=0,A=0;if(u[u.length-1]==="Z")v=u.substring(0,u.length-1),g=!0;else{const T=new Number(u[u.length-1]);if(isNaN(T.valueOf()))throw new Error("Wrong input string for conversion");v=u}if(g){if(v.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(v.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let T=1,O=v.indexOf("+"),B="";if(O===-1&&(O=v.indexOf("-"),T=-1),O!==-1){if(B=v.substring(O+1),v=v.substring(0,O),B.length!==2&&B.length!==4)throw new Error("Wrong input string for conversion");let F=parseInt(B.substring(0,2),10);if(isNaN(F.valueOf()))throw new Error("Wrong input string for conversion");if(S=T*F,B.length===4){if(F=parseInt(B.substring(2,4),10),isNaN(F.valueOf()))throw new Error("Wrong input string for conversion");A=T*F}}}let $=v.indexOf(".");if($===-1&&($=v.indexOf(",")),$!==-1){const T=new Number(`0${v.substring($)}`);if(isNaN(T.valueOf()))throw new Error("Wrong input string for conversion");w=T.valueOf(),b=v.substring(0,$)}else b=v;switch(!0){case b.length===8:if(E=/(\d{4})(\d{2})(\d{2})/ig,$!==-1)throw new Error("Wrong input string for conversion");break;case b.length===10:if(E=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,$!==-1){let T=60*w;this.minute=Math.floor(T),T=60*(T-this.minute),this.second=Math.floor(T),T=1e3*(T-this.second),this.millisecond=Math.floor(T)}break;case b.length===12:if(E=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,$!==-1){let T=60*w;this.second=Math.floor(T),T=1e3*(T-this.second),this.millisecond=Math.floor(T)}break;case b.length===14:if(E=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,$!==-1){const T=1e3*w;this.millisecond=Math.floor(T)}break;default:throw new Error("Wrong input string for conversion")}const R=E.exec(b);if(R===null)throw new Error("Wrong input string for conversion");for(let T=1;T<R.length;T++)switch(T){case 1:this.year=parseInt(R[T],10);break;case 2:this.month=parseInt(R[T],10);break;case 3:this.day=parseInt(R[T],10);break;case 4:this.hour=parseInt(R[T],10)+S;break;case 5:this.minute=parseInt(R[T],10)+A;break;case 6:this.second=parseInt(R[T],10);break;default:throw new Error("Wrong input string for conversion")}if(g===!1){const T=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=T.getUTCFullYear(),this.month=T.getUTCMonth(),this.day=T.getUTCDay(),this.hour=T.getUTCHours(),this.minute=T.getUTCMinutes(),this.second=T.getUTCSeconds(),this.millisecond=T.getUTCMilliseconds()}}toString(u="iso"){if(u==="iso"){const g=[];return g.push(padNumber(this.year,4)),g.push(padNumber(this.month,2)),g.push(padNumber(this.day,2)),g.push(padNumber(this.hour,2)),g.push(padNumber(this.minute,2)),g.push(padNumber(this.second,2)),this.millisecond!==0&&(g.push("."),g.push(padNumber(this.millisecond,3))),g.push("Z"),g.join("")}return super.toString(u)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}_a$5=GeneralizedTime;typeStore.GeneralizedTime=_a$5;GeneralizedTime.NAME="GeneralizedTime";var _a$4;class DATE extends Utf8String{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}_a$4=DATE;typeStore.DATE=_a$4;DATE.NAME="DATE";var _a$3$1;class TimeOfDay extends Utf8String{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}_a$3$1=TimeOfDay;typeStore.TimeOfDay=_a$3$1;TimeOfDay.NAME="TimeOfDay";var _a$2$1;class DateTime extends Utf8String{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}_a$2$1=DateTime;typeStore.DateTime=_a$2$1;DateTime.NAME="DateTime";var _a$1$1;class Duration extends Utf8String{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}_a$1$1=Duration;typeStore.Duration=_a$1$1;Duration.NAME="Duration";var _a$x;class TIME extends Utf8String{constructor(u={}){super(u),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}_a$x=TIME;typeStore.TIME=_a$x;TIME.NAME="TIME";class Any{constructor({name:u=EMPTY_STRING,optional:g=!1}={}){this.name=u,this.optional=g}}class Choice extends Any{constructor({value:u=[],...g}={}){super(g),this.value=u}}class Repeated extends Any{constructor({value:u=new Any,local:g=!1,...v}={}){super(v),this.value=u,this.local=g}}class RawData{get data(){return this.dataView.slice().buffer}set data(u){this.dataView=BufferSourceConverter.toUint8Array(u)}constructor({data:u=EMPTY_VIEW}={}){this.dataView=BufferSourceConverter.toUint8Array(u)}fromBER(u,g,v){const b=g+v;return this.dataView=BufferSourceConverter.toUint8Array(u).subarray(g,b),b}toBER(u){return this.dataView.slice().buffer}}function compareSchema(y,u,g){if(g instanceof Choice){for(const w of g.value)if(compareSchema(y,u,w).verified)return{verified:!0,result:y};{const w={verified:!1,result:{error:"Wrong values for Choice type"}};return g.hasOwnProperty(NAME$1)&&(w.name=g.name),w}}if(g instanceof Any)return g.hasOwnProperty(NAME$1)&&(y[g.name]=u),{verified:!0,result:y};if(!(y instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(u instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(g instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(ID_BLOCK in g))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(FROM_BER in g.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(TO_BER in g.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const v=g.idBlock.toBER(!1);if(v.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(g.idBlock.fromBER(v,0,v.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(g.idBlock.hasOwnProperty(TAG_CLASS)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(g.idBlock.tagClass!==u.idBlock.tagClass)return{verified:!1,result:y};if(g.idBlock.hasOwnProperty(TAG_NUMBER)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(g.idBlock.tagNumber!==u.idBlock.tagNumber)return{verified:!1,result:y};if(g.idBlock.hasOwnProperty(IS_CONSTRUCTED)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(g.idBlock.isConstructed!==u.idBlock.isConstructed)return{verified:!1,result:y};if(!(IS_HEX_ONLY in g.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(g.idBlock.isHexOnly!==u.idBlock.isHexOnly)return{verified:!1,result:y};if(g.idBlock.isHexOnly){if(!(VALUE_HEX_VIEW in g.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const w=g.idBlock.valueHexView,E=u.idBlock.valueHexView;if(w.length!==E.length)return{verified:!1,result:y};for(let S=0;S<w.length;S++)if(w[S]!==E[1])return{verified:!1,result:y}}if(g.name&&(g.name=g.name.replace(/^\s+|\s+$/g,EMPTY_STRING),g.name&&(y[g.name]=u)),g instanceof typeStore.Constructed){let w=0,E={verified:!1,result:{error:"Unknown error"}},S=g.valueBlock.value.length;if(S>0&&g.valueBlock.value[0]instanceof Repeated&&(S=u.valueBlock.value.length),S===0)return{verified:!0,result:y};if(u.valueBlock.value.length===0&&g.valueBlock.value.length!==0){let A=!0;for(let $=0;$<g.valueBlock.value.length;$++)A=A&&(g.valueBlock.value[$].optional||!1);return A?{verified:!0,result:y}:(g.name&&(g.name=g.name.replace(/^\s+|\s+$/g,EMPTY_STRING),g.name&&delete y[g.name]),y.error="Inconsistent object length",{verified:!1,result:y})}for(let A=0;A<S;A++)if(A-w>=u.valueBlock.value.length){if(g.valueBlock.value[A].optional===!1){const $={verified:!1,result:y};return y.error="Inconsistent length between ASN.1 data and schema",g.name&&(g.name=g.name.replace(/^\s+|\s+$/g,EMPTY_STRING),g.name&&(delete y[g.name],$.name=g.name)),$}}else if(g.valueBlock.value[0]instanceof Repeated){if(E=compareSchema(y,u.valueBlock.value[A],g.valueBlock.value[0].value),E.verified===!1)if(g.valueBlock.value[0].optional)w++;else return g.name&&(g.name=g.name.replace(/^\s+|\s+$/g,EMPTY_STRING),g.name&&delete y[g.name]),E;if(NAME$1 in g.valueBlock.value[0]&&g.valueBlock.value[0].name.length>0){let $={};LOCAL in g.valueBlock.value[0]&&g.valueBlock.value[0].local?$=u:$=y,typeof $[g.valueBlock.value[0].name]>"u"&&($[g.valueBlock.value[0].name]=[]),$[g.valueBlock.value[0].name].push(u.valueBlock.value[A])}}else if(E=compareSchema(y,u.valueBlock.value[A-w],g.valueBlock.value[A]),E.verified===!1)if(g.valueBlock.value[A].optional)w++;else return g.name&&(g.name=g.name.replace(/^\s+|\s+$/g,EMPTY_STRING),g.name&&delete y[g.name]),E;if(E.verified===!1){const A={verified:!1,result:y};return g.name&&(g.name=g.name.replace(/^\s+|\s+$/g,EMPTY_STRING),g.name&&(delete y[g.name],A.name=g.name)),A}return{verified:!0,result:y}}if(g.primitiveSchema&&VALUE_HEX_VIEW in u.valueBlock){const w=localFromBER(u.valueBlock.valueHexView);if(w.offset===-1){const E={verified:!1,result:w.result};return g.name&&(g.name=g.name.replace(/^\s+|\s+$/g,EMPTY_STRING),g.name&&(delete y[g.name],E.name=g.name)),E}return compareSchema(y,w.result,g.primitiveSchema)}return{verified:!0,result:y}}function verifySchema(y,u){if(!(u instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const g=localFromBER(BufferSourceConverter.toUint8Array(y));return g.offset===-1?{verified:!1,result:g.result}:compareSchema(g.result,g.result,u)}const asn1js=Object.freeze(Object.defineProperty({__proto__:null,Any,BaseBlock,BaseStringBlock,BitString:BitString$1,BmpString,Boolean:Boolean$1,CharacterString,Choice,Constructed,DATE,DateTime,Duration,EndOfContent,Enumerated,GeneralString,GeneralizedTime,GraphicString,HexBlock,IA5String,Integer,Null,NumericString,ObjectIdentifier,OctetString:OctetString$1,Primitive,PrintableString,RawData,RelativeObjectIdentifier,Repeated,Sequence,Set:Set$1,TIME,TeletexString,TimeOfDay,UTCTime,UniversalString,Utf8String,ValueBlock,VideotexString,ViewWriter,VisibleString,compareSchema,fromBER,verifySchema},Symbol.toStringTag,{value:"Module"})),SALT_LENGTH=16,KEY_SIZE=32,ITERATIONS=1e4;async function exporter(y,u){const v=await create$4().encrypt(y,u);return base64$1.encode(v)}async function exportPrivateKey(y,u,g){if(y.type==="RSA")return exportRSAPrivateKey(y,u,g);if(y.type==="Ed25519")return exportEd25519PrivateKey(y,u,g);if(y.type==="secp256k1")return exportSecp256k1PrivateKey(y,u,g);if(y.type==="ECDSA")return exportECDSAPrivateKey(y,u,g);throw new UnsupportedKeyTypeError}async function exportEd25519PrivateKey(y,u,g="libp2p-key"){if(g==="libp2p-key")return exporter(privateKeyToProtobuf(y),u);throw new InvalidParametersError$1(`export format '${g}' is not supported`)}async function exportSecp256k1PrivateKey(y,u,g="libp2p-key"){if(g==="libp2p-key")return exporter(privateKeyToProtobuf(y),u);throw new InvalidParametersError$1("Export format is not supported")}async function exportECDSAPrivateKey(y,u,g="libp2p-key"){if(g==="libp2p-key")return exporter(privateKeyToProtobuf(y),u);throw new InvalidParametersError$1(`export format '${g}' is not supported`)}async function exportRSAPrivateKey(y,u,g="pkcs-8"){if(g==="pkcs-8")return exportToPem(y,u);if(g==="libp2p-key")return exporter(privateKeyToProtobuf(y),u);throw new InvalidParametersError$1("Export format is not supported")}async function exportToPem(y,u){const g=webcrypto.get(),b=new Sequence({value:[new Integer({value:0}),new Sequence({value:[new ObjectIdentifier({value:"1.2.840.113549.1.1.1"}),new Null]}),new OctetString$1({valueHex:y.raw})]}).toBER(),w=new Uint8Array(b,0,b.byteLength),E=randomBytes$1(SALT_LENGTH),S=await pbkdf2Async(sha512$2,u,E,{c:ITERATIONS,dkLen:KEY_SIZE}),A=randomBytes$1(16),$=await g.subtle.importKey("raw",S,"AES-CBC",!1,["encrypt"]),R=await g.subtle.encrypt({name:"AES-CBC",iv:A},$,w),T=new Sequence({value:[new OctetString$1({valueHex:E}),new Integer({value:ITERATIONS}),new Integer({value:KEY_SIZE}),new Sequence({value:[new ObjectIdentifier({value:"1.2.840.113549.2.11"}),new Null]})]}),O=new Sequence({value:[new ObjectIdentifier({value:"1.2.840.113549.1.5.13"}),new Sequence({value:[new Sequence({value:[new ObjectIdentifier({value:"1.2.840.113549.1.5.12"}),T]}),new Sequence({value:[new ObjectIdentifier({value:"2.16.840.1.101.3.4.1.42"}),new OctetString$1({valueHex:A})]})]})]}),F=new Sequence({value:[O,new OctetString$1({valueHex:R})]}).toBER(),U=new Uint8Array(F,0,F.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...toString$3(U,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function importPrivateKey(y,u){try{const g=await importer(y,u);return privateKeyFromProtobuf(g)}catch{}if(!y.includes("BEGIN"))throw new InvalidParametersError$1("Encrypted key was not a libp2p-key or a PEM file");return importFromPem(y,u)}async function importer(y,u){const g=base64$1.decode(y);return create$4().decrypt(g,u)}async function importFromPem(y,u){const g=webcrypto.get();let v;if(y.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){const w=fromString$1(y.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:E}=fromBER(w),{iv:S,salt:A,iterations:$,keySize:R,cipherText:T}=findEncryptedPEMData(E),O=await pbkdf2Async(sha512$2,u,A,{c:$,dkLen:R}),B=await g.subtle.importKey("raw",O,"AES-CBC",!1,["decrypt"]),F=toUint8Array$1(await g.subtle.decrypt({name:"AES-CBC",iv:S},B,T)),{result:U}=fromBER(F);v=findPEMData(U)}else if(y.includes("-----BEGIN PRIVATE KEY-----")){const w=fromString$1(y.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:E}=fromBER(w);v=findPEMData(E)}else throw new InvalidParametersError$1("Could not parse private key from PEM data");const b=privateKeyFromRaw(v);if(b.type!=="RSA")throw new InvalidParametersError$1("Could not parse RSA private key from PEM data");return b}function findEncryptedPEMData(y){const u=y.valueBlock.value[0];if(u.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new InvalidParametersError$1("Only pkcs5PBES2 encrypted private keys are supported");const v=u.valueBlock.value[1].valueBlock.value[0];if(v.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new InvalidParametersError$1("Only pkcs5PBKDF2 key derivation functions are supported");const w=v.valueBlock.value[1],E=toUint8Array$1(w.valueBlock.value[0].getValue());let S=ITERATIONS,A=KEY_SIZE;if(w.valueBlock.value.length===3)S=Number(w.valueBlock.value[1].toBigInt()),A=Number(w.valueBlock.value[2].toBigInt());else if(w.valueBlock.value.length===2)throw new InvalidParametersError$1("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");const $=u.valueBlock.value[1].valueBlock.value[1],R=$.valueBlock.value[0].toString();if(R!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(R!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(R!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(R!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(R!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new InvalidParametersError$1("Only AES-CBC encryption schemes are supported")}}}}const T=toUint8Array$1($.valueBlock.value[1].getValue());return{cipherText:toUint8Array$1(y.valueBlock.value[1].getValue()),salt:E,iterations:S,keySize:A,iv:T}}function findPEMData(y){return toUint8Array$1(y.valueBlock.value[2].getValue())}function toUint8Array$1(y){return new Uint8Array(y,0,y.byteLength)}const keyPrefix="/pkcs8/",infoPrefix="/info/",privates=new WeakMap,NIST={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3};function validateKeyName(y){return y==null||typeof y!="string"?!1:y===sanitize(y.trim())&&y.length>0}async function randomDelay(){const g=Math.random()*800+200;await new Promise(v=>setTimeout(v,g))}function DsName(y){return new Key(keyPrefix+y)}function DsInfoName(y){return new Key(infoPrefix+y)}async function keyId(y){const u=privateKeyToProtobuf(y),g=await sha256$4.digest(u);return base58btc.encode(g.bytes).substring(1)}class Keychain{components;init;log;self;constructor(u,g){if(this.components=u,this.log=u.logger.forComponent("libp2p:keychain"),this.init={...g,dek:{...DEK_INIT,...g.dek}},this.self=g.selfKey??"self",this.init.pass!=null&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<NIST.minKeyLength)throw new Error(`dek.keyLength must be least ${NIST.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<NIST.minSaltLength)throw new Error(`dek.saltLength must be least ${NIST.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<NIST.minIterationCount)throw new Error(`dek.iterationCount must be least ${NIST.minIterationCount}`);const v=this.init.pass!=null&&this.init.dek?.salt!=null?pbkdf2(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";privates.set(this,{dek:v})}[Symbol.toStringTag]="@libp2p/keychain";[serviceCapabilities]=["@libp2p/keychain"];static generateOptions(){const u=Object.assign({},this.options),g=Math.ceil(NIST.minSaltLength/3)*3;return u.dek!=null&&(u.dek.salt=toString$3(randomBytes$1(g),"base64")),u}static get options(){return{dek:{...DEK_INIT}}}async findKeyByName(u){if(!validateKeyName(u))throw await randomDelay(),new InvalidParametersError$1(`Invalid key name '${u}'`);const g=DsInfoName(u);try{const v=await this.components.datastore.get(g);return JSON.parse(toString$3(v))}catch(v){throw await randomDelay(),this.log.error("could not read key from datastore - %e",v),new NotFoundError$1(`Key '${u}' does not exist.`)}}async findKeyById(u){try{const g={prefix:infoPrefix};for await(const v of this.components.datastore.query(g)){const b=JSON.parse(toString$3(v.value));if(b.id===u)return b}throw new InvalidParametersError$1(`Key with id '${u}' does not exist.`)}catch(g){throw await randomDelay(),g}}async importKey(u,g){if(!validateKeyName(u))throw await randomDelay(),new InvalidParametersError$1(`Invalid key name '${u}'`);if(g==null)throw await randomDelay(),new InvalidParametersError$1("Key is required");const v=DsName(u);if(await this.components.datastore.has(v))throw await randomDelay(),new InvalidParametersError$1(`Key '${u}' already exists`);let w,E;try{w=await keyId(g);const $=privates.get(this);if($==null)throw new InvalidParametersError$1("dek missing");const R=$.dek;E=await exportPrivateKey(g,R,g.type==="RSA"?"pkcs-8":"libp2p-key")}catch($){throw await randomDelay(),$}const S={name:u,id:w},A=this.components.datastore.batch();return A.put(v,fromString$1(E)),A.put(DsInfoName(u),fromString$1(JSON.stringify(S))),await A.commit(),S}async exportKey(u){if(!validateKeyName(u))throw await randomDelay(),new InvalidParametersError$1(`Invalid key name '${u}'`);const g=DsName(u);try{const v=await this.components.datastore.get(g),b=toString$3(v),w=privates.get(this);if(w==null)throw new InvalidParametersError$1("dek missing");const E=w.dek;return await importPrivateKey(b,E)}catch(v){throw await randomDelay(),v}}async removeKey(u){if(!validateKeyName(u)||u===this.self)throw await randomDelay(),new InvalidParametersError$1(`Invalid key name '${u}'`);const g=DsName(u),v=await this.findKeyByName(u),b=this.components.datastore.batch();return b.delete(g),b.delete(DsInfoName(u)),await b.commit(),v}async listKeys(){const u={prefix:infoPrefix},g=[];for await(const v of this.components.datastore.query(u))g.push(JSON.parse(toString$3(v.value)));return g}async renameKey(u,g){if(!validateKeyName(u)||u===this.self)throw await randomDelay(),new InvalidParametersError$1(`Invalid old key name '${u}'`);if(!validateKeyName(g)||g===this.self)throw await randomDelay(),new InvalidParametersError$1(`Invalid new key name '${g}'`);const v=DsName(u),b=DsName(g),w=DsInfoName(u),E=DsInfoName(g);if(await this.components.datastore.has(b))throw await randomDelay(),new InvalidParametersError$1(`Key '${g}' already exists`);try{const A=await this.components.datastore.get(v),$=await this.components.datastore.get(w),R=JSON.parse(toString$3($));R.name=g;const T=this.components.datastore.batch();return T.put(b,A),T.put(E,fromString$1(JSON.stringify(R))),T.delete(v),T.delete(w),await T.commit(),R}catch(A){throw await randomDelay(),A}}async rotateKeychainPass(u,g){if(typeof u!="string")throw await randomDelay(),new InvalidParametersError$1(`Invalid old pass type '${typeof u}'`);if(typeof g!="string")throw await randomDelay(),new InvalidParametersError$1(`Invalid new pass type '${typeof g}'`);if(g.length<20)throw await randomDelay(),new InvalidParametersError$1(`Invalid pass length ${g.length}`);this.log("recreating keychain");const v=privates.get(this);if(v==null)throw new InvalidParametersError$1("dek missing");const b=v.dek;this.init.pass=g;const w=g!=null&&this.init.dek?.salt!=null?pbkdf2(g,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";privates.set(this,{dek:w});const E=await this.listKeys();for(const S of E){const A=await this.components.datastore.get(DsName(S.name)),$=toString$3(A),R=await importPrivateKey($,b),T=w.toString(),O=await exportPrivateKey(R,T,R.type==="RSA"?"pkcs-8":"libp2p-key"),B=this.components.datastore.batch(),F={name:S.name,id:S.id};B.put(DsName(S.name),fromString$1(O)),B.put(DsInfoName(S.name),fromString$1(JSON.stringify(F))),await B.commit()}this.log("keychain reconstructed")}}function keychain(y={}){return u=>new Keychain(u,y)}async function loadOrCreateSelfKey(y,u={}){const g=u.selfKey??"self",v=keychain(u)({datastore:y,logger:defaultLogger()});let b;return await y.has(new Key(`/pkcs8/${g}`))?b=await v.exportKey(g):(b=await generateKeyPair(u.keyType??"Ed25519"),await v.importKey(g,b)),b}var define_globalThis_process_env_default={};const NOISE_MSG_MAX_LENGTH_BYTES=65535,NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG=NOISE_MSG_MAX_LENGTH_BYTES-16,DUMP_SESSION_KEYS=!!define_globalThis_process_env_default?.DUMP_SESSION_KEYS,CHACHA_TAG_LENGTH=16;function isBytes$4(y){return y instanceof Uint8Array||ArrayBuffer.isView(y)&&y.constructor.name==="Uint8Array"}function abool(y){if(typeof y!="boolean")throw new Error(`boolean expected, not ${y}`)}function anumber$2(y){if(!Number.isSafeInteger(y)||y<0)throw new Error("positive integer expected, got "+y)}function abytes$3(y,u,g=""){const v=isBytes$4(y),b=y?.length,w=u!==void 0;if(!v||w&&b!==u){const E=g&&`"${g}" `,S=w?` of length ${u}`:"",A=v?`length=${b}`:`type=${typeof y}`;throw new Error(E+"expected Uint8Array"+S+", got "+A)}return y}function aexists$2(y,u=!0){if(y.destroyed)throw new Error("Hash instance has been destroyed");if(u&&y.finished)throw new Error("Hash#digest() has already been called")}function aoutput$2(y,u){abytes$3(y,void 0,"output");const g=u.outputLen;if(y.length<g)throw new Error("digestInto() expects output buffer of length at least "+g)}function u32(y){return new Uint32Array(y.buffer,y.byteOffset,Math.floor(y.byteLength/4))}function clean$2(...y){for(let u=0;u<y.length;u++)y[u].fill(0)}function createView$2(y){return new DataView(y.buffer,y.byteOffset,y.byteLength)}const isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function checkOpts(y,u){if(u==null||typeof u!="object")throw new Error("options must be defined");return Object.assign(y,u)}function equalBytes(y,u){if(y.length!==u.length)return!1;let g=0;for(let v=0;v<y.length;v++)g|=y[v]^u[v];return g===0}const wrapCipher=(y,u)=>{function g(v,...b){if(abytes$3(v,void 0,"key"),!isLE)throw new Error("Non little-endian hardware is not yet supported");if(y.nonceLength!==void 0){const R=b[0];abytes$3(R,y.varSizeNonce?void 0:y.nonceLength,"nonce")}const w=y.tagLength;w&&b[1]!==void 0&&abytes$3(b[1],void 0,"AAD");const E=u(v,...b),S=(R,T)=>{if(T!==void 0){if(R!==2)throw new Error("cipher output not supported");abytes$3(T,void 0,"output")}};let A=!1;return{encrypt(R,T){if(A)throw new Error("cannot encrypt() twice with same key + nonce");return A=!0,abytes$3(R),S(E.encrypt.length,T),E.encrypt(R,T)},decrypt(R,T){if(abytes$3(R),w&&R.length<w)throw new Error('"ciphertext" expected length bigger than tagLength='+w);return S(E.decrypt.length,T),E.decrypt(R,T)}}}return Object.assign(g,y),g};function getOutput(y,u,g=!0){if(u===void 0)return new Uint8Array(y);if(u.length!==y)throw new Error('"output" expected Uint8Array of length '+y+", got: "+u.length);if(g&&!isAligned32$1(u))throw new Error("invalid output, must be aligned");return u}function u64Lengths(y,u,g){abool(g);const v=new Uint8Array(16),b=createView$2(v);return b.setBigUint64(0,BigInt(u),g),b.setBigUint64(8,BigInt(y),g),v}function isAligned32$1(y){return y.byteOffset%4===0}function copyBytes$1(y){return Uint8Array.from(y)}const encodeStr=y=>Uint8Array.from(y.split(""),u=>u.charCodeAt(0)),sigma16=encodeStr("expand 16-byte k"),sigma32=encodeStr("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);function rotl(y,u){return y<<u|y>>>32-u}function isAligned32(y){return y.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=Uint32Array.of();function runCipher(y,u,g,v,b,w,E,S){const A=b.length,$=new Uint8Array(BLOCK_LEN),R=u32($),T=isAligned32(b)&&isAligned32(w),O=T?u32(b):U32_EMPTY,B=T?u32(w):U32_EMPTY;for(let F=0;F<A;E++){if(y(u,g,v,R,E,S),E>=MAX_COUNTER)throw new Error("arx: counter overflow");const U=Math.min(BLOCK_LEN,A-F);if(T&&U===BLOCK_LEN){const q=F/4;if(F%4!==0)throw new Error("arx: invalid block position");for(let J=0,ie;J<BLOCK_LEN32;J++)ie=q+J,B[ie]=O[ie]^R[J];F+=BLOCK_LEN;continue}for(let q=0,J;q<U;q++)J=F+q,w[J]=b[J]^$[q];F+=U}}function createCipher(y,u){const{allowShortKeys:g,extendNonceFn:v,counterLength:b,counterRight:w,rounds:E}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},u);if(typeof y!="function")throw new Error("core must be a function");return anumber$2(b),anumber$2(E),abool(w),abool(g),(S,A,$,R,T=0)=>{abytes$3(S,void 0,"key"),abytes$3(A,void 0,"nonce"),abytes$3($,void 0,"data");const O=$.length;if(R===void 0&&(R=new Uint8Array(O)),abytes$3(R,void 0,"output"),anumber$2(T),T<0||T>=MAX_COUNTER)throw new Error("arx: counter overflow");if(R.length<O)throw new Error(`arx: output (${R.length}) is shorter than data (${O})`);const B=[];let F=S.length,U,q;if(F===32)B.push(U=copyBytes$1(S)),q=sigma32_32;else if(F===16&&g)U=new Uint8Array(32),U.set(S),U.set(S,16),q=sigma16_32,B.push(U);else throw abytes$3(S,32,"arx key"),new Error("invalid key size");isAligned32(A)||B.push(A=copyBytes$1(A));const J=u32(U);if(v){if(A.length!==24)throw new Error("arx: extended nonce must be 24 bytes");v(q,J,u32(A.subarray(0,16)),J),A=A.subarray(16)}const ie=16-b;if(ie!==A.length)throw new Error(`arx: nonce must be ${ie} or 16 bytes`);if(ie!==12){const le=new Uint8Array(12);le.set(A,w?0:12-A.length),A=le,B.push(A)}const oe=u32(A);return runCipher(y,q,J,oe,$,R,T,E),clean$2(...B),R}}function u8to16(y,u){return y[u++]&255|(y[u++]&255)<<8}class Poly1305{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(u){u=copyBytes$1(abytes$3(u,32,"key"));const g=u8to16(u,0),v=u8to16(u,2),b=u8to16(u,4),w=u8to16(u,6),E=u8to16(u,8),S=u8to16(u,10),A=u8to16(u,12),$=u8to16(u,14);this.r[0]=g&8191,this.r[1]=(g>>>13|v<<3)&8191,this.r[2]=(v>>>10|b<<6)&7939,this.r[3]=(b>>>7|w<<9)&8191,this.r[4]=(w>>>4|E<<12)&255,this.r[5]=E>>>1&8190,this.r[6]=(E>>>14|S<<2)&8191,this.r[7]=(S>>>11|A<<5)&8065,this.r[8]=(A>>>8|$<<8)&8191,this.r[9]=$>>>5&127;for(let R=0;R<8;R++)this.pad[R]=u8to16(u,16+2*R)}process(u,g,v=!1){const b=v?0:2048,{h:w,r:E}=this,S=E[0],A=E[1],$=E[2],R=E[3],T=E[4],O=E[5],B=E[6],F=E[7],U=E[8],q=E[9],J=u8to16(u,g+0),ie=u8to16(u,g+2),oe=u8to16(u,g+4),le=u8to16(u,g+6),de=u8to16(u,g+8),fe=u8to16(u,g+10),ye=u8to16(u,g+12),we=u8to16(u,g+14);let pe=w[0]+(J&8191),ve=w[1]+((J>>>13|ie<<3)&8191),he=w[2]+((ie>>>10|oe<<6)&8191),ae=w[3]+((oe>>>7|le<<9)&8191),Q=w[4]+((le>>>4|de<<12)&8191),j=w[5]+(de>>>1&8191),z=w[6]+((de>>>14|fe<<2)&8191),re=w[7]+((fe>>>11|ye<<5)&8191),Y=w[8]+((ye>>>8|we<<8)&8191),te=w[9]+(we>>>5|b),ne=0,se=ne+pe*S+ve*(5*q)+he*(5*U)+ae*(5*F)+Q*(5*B);ne=se>>>13,se&=8191,se+=j*(5*O)+z*(5*T)+re*(5*R)+Y*(5*$)+te*(5*A),ne+=se>>>13,se&=8191;let ee=ne+pe*A+ve*S+he*(5*q)+ae*(5*U)+Q*(5*F);ne=ee>>>13,ee&=8191,ee+=j*(5*B)+z*(5*O)+re*(5*T)+Y*(5*R)+te*(5*$),ne+=ee>>>13,ee&=8191;let Z=ne+pe*$+ve*A+he*S+ae*(5*q)+Q*(5*U);ne=Z>>>13,Z&=8191,Z+=j*(5*F)+z*(5*B)+re*(5*O)+Y*(5*T)+te*(5*R),ne+=Z>>>13,Z&=8191;let ue=ne+pe*R+ve*$+he*A+ae*S+Q*(5*q);ne=ue>>>13,ue&=8191,ue+=j*(5*U)+z*(5*F)+re*(5*B)+Y*(5*O)+te*(5*T),ne+=ue>>>13,ue&=8191;let _e=ne+pe*T+ve*R+he*$+ae*A+Q*S;ne=_e>>>13,_e&=8191,_e+=j*(5*q)+z*(5*U)+re*(5*F)+Y*(5*B)+te*(5*O),ne+=_e>>>13,_e&=8191;let Re=ne+pe*O+ve*T+he*R+ae*$+Q*A;ne=Re>>>13,Re&=8191,Re+=j*S+z*(5*q)+re*(5*U)+Y*(5*F)+te*(5*B),ne+=Re>>>13,Re&=8191;let Ae=ne+pe*B+ve*O+he*T+ae*R+Q*$;ne=Ae>>>13,Ae&=8191,Ae+=j*A+z*S+re*(5*q)+Y*(5*U)+te*(5*F),ne+=Ae>>>13,Ae&=8191;let ge=ne+pe*F+ve*B+he*O+ae*T+Q*R;ne=ge>>>13,ge&=8191,ge+=j*$+z*A+re*S+Y*(5*q)+te*(5*U),ne+=ge>>>13,ge&=8191;let be=ne+pe*U+ve*F+he*B+ae*O+Q*T;ne=be>>>13,be&=8191,be+=j*R+z*$+re*A+Y*S+te*(5*q),ne+=be>>>13,be&=8191;let Te=ne+pe*q+ve*U+he*F+ae*B+Q*O;ne=Te>>>13,Te&=8191,Te+=j*T+z*R+re*$+Y*A+te*S,ne+=Te>>>13,Te&=8191,ne=(ne<<2)+ne|0,ne=ne+se|0,se=ne&8191,ne=ne>>>13,ee+=ne,w[0]=se,w[1]=ee,w[2]=Z,w[3]=ue,w[4]=_e,w[5]=Re,w[6]=Ae,w[7]=ge,w[8]=be,w[9]=Te}finalize(){const{h:u,pad:g}=this,v=new Uint16Array(10);let b=u[1]>>>13;u[1]&=8191;for(let S=2;S<10;S++)u[S]+=b,b=u[S]>>>13,u[S]&=8191;u[0]+=b*5,b=u[0]>>>13,u[0]&=8191,u[1]+=b,b=u[1]>>>13,u[1]&=8191,u[2]+=b,v[0]=u[0]+5,b=v[0]>>>13,v[0]&=8191;for(let S=1;S<10;S++)v[S]=u[S]+b,b=v[S]>>>13,v[S]&=8191;v[9]-=8192;let w=(b^1)-1;for(let S=0;S<10;S++)v[S]&=w;w=~w;for(let S=0;S<10;S++)u[S]=u[S]&w|v[S];u[0]=(u[0]|u[1]<<13)&65535,u[1]=(u[1]>>>3|u[2]<<10)&65535,u[2]=(u[2]>>>6|u[3]<<7)&65535,u[3]=(u[3]>>>9|u[4]<<4)&65535,u[4]=(u[4]>>>12|u[5]<<1|u[6]<<14)&65535,u[5]=(u[6]>>>2|u[7]<<11)&65535,u[6]=(u[7]>>>5|u[8]<<8)&65535,u[7]=(u[8]>>>8|u[9]<<5)&65535;let E=u[0]+g[0];u[0]=E&65535;for(let S=1;S<8;S++)E=(u[S]+g[S]|0)+(E>>>16)|0,u[S]=E&65535;clean$2(v)}update(u){aexists$2(this),abytes$3(u),u=copyBytes$1(u);const{buffer:g,blockLen:v}=this,b=u.length;for(let w=0;w<b;){const E=Math.min(v-this.pos,b-w);if(E===v){for(;v<=b-w;w+=v)this.process(u,w);continue}g.set(u.subarray(w,w+E),this.pos),this.pos+=E,w+=E,this.pos===v&&(this.process(g,0,!1),this.pos=0)}return this}destroy(){clean$2(this.h,this.r,this.buffer,this.pad)}digestInto(u){aexists$2(this),aoutput$2(u,this),this.finished=!0;const{buffer:g,h:v}=this;let{pos:b}=this;if(b){for(g[b++]=1;b<16;b++)g[b]=0;this.process(g,0,!0)}this.finalize();let w=0;for(let E=0;E<8;E++)u[w++]=v[E]>>>0,u[w++]=v[E]>>>8;return u}digest(){const{buffer:u,outputLen:g}=this;this.digestInto(u);const v=u.slice(0,g);return this.destroy(),v}}function wrapConstructorWithKey(y){const u=(v,b)=>y(b).update(v).digest(),g=y(new Uint8Array(32));return u.outputLen=g.outputLen,u.blockLen=g.blockLen,u.create=v=>y(v),u}const poly1305=wrapConstructorWithKey(y=>new Poly1305(y));function chachaCore(y,u,g,v,b,w=20){let E=y[0],S=y[1],A=y[2],$=y[3],R=u[0],T=u[1],O=u[2],B=u[3],F=u[4],U=u[5],q=u[6],J=u[7],ie=b,oe=g[0],le=g[1],de=g[2],fe=E,ye=S,we=A,pe=$,ve=R,he=T,ae=O,Q=B,j=F,z=U,re=q,Y=J,te=ie,ne=oe,se=le,ee=de;for(let ue=0;ue<w;ue+=2)fe=fe+ve|0,te=rotl(te^fe,16),j=j+te|0,ve=rotl(ve^j,12),fe=fe+ve|0,te=rotl(te^fe,8),j=j+te|0,ve=rotl(ve^j,7),ye=ye+he|0,ne=rotl(ne^ye,16),z=z+ne|0,he=rotl(he^z,12),ye=ye+he|0,ne=rotl(ne^ye,8),z=z+ne|0,he=rotl(he^z,7),we=we+ae|0,se=rotl(se^we,16),re=re+se|0,ae=rotl(ae^re,12),we=we+ae|0,se=rotl(se^we,8),re=re+se|0,ae=rotl(ae^re,7),pe=pe+Q|0,ee=rotl(ee^pe,16),Y=Y+ee|0,Q=rotl(Q^Y,12),pe=pe+Q|0,ee=rotl(ee^pe,8),Y=Y+ee|0,Q=rotl(Q^Y,7),fe=fe+he|0,ee=rotl(ee^fe,16),re=re+ee|0,he=rotl(he^re,12),fe=fe+he|0,ee=rotl(ee^fe,8),re=re+ee|0,he=rotl(he^re,7),ye=ye+ae|0,te=rotl(te^ye,16),Y=Y+te|0,ae=rotl(ae^Y,12),ye=ye+ae|0,te=rotl(te^ye,8),Y=Y+te|0,ae=rotl(ae^Y,7),we=we+Q|0,ne=rotl(ne^we,16),j=j+ne|0,Q=rotl(Q^j,12),we=we+Q|0,ne=rotl(ne^we,8),j=j+ne|0,Q=rotl(Q^j,7),pe=pe+ve|0,se=rotl(se^pe,16),z=z+se|0,ve=rotl(ve^z,12),pe=pe+ve|0,se=rotl(se^pe,8),z=z+se|0,ve=rotl(ve^z,7);let Z=0;v[Z++]=E+fe|0,v[Z++]=S+ye|0,v[Z++]=A+we|0,v[Z++]=$+pe|0,v[Z++]=R+ve|0,v[Z++]=T+he|0,v[Z++]=O+ae|0,v[Z++]=B+Q|0,v[Z++]=F+j|0,v[Z++]=U+z|0,v[Z++]=q+re|0,v[Z++]=J+Y|0,v[Z++]=ie+te|0,v[Z++]=oe+ne|0,v[Z++]=le+se|0,v[Z++]=de+ee|0}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1}),ZEROS16=new Uint8Array(16),updatePadded=(y,u)=>{y.update(u);const g=u.length%16;g&&y.update(ZEROS16.subarray(g))},ZEROS32=new Uint8Array(32);function computeTag(y,u,g,v,b){b!==void 0&&abytes$3(b,void 0,"AAD");const w=y(u,g,ZEROS32),E=u64Lengths(v.length,b?b.length:0,!0),S=poly1305.create(w);b&&updatePadded(S,b),updatePadded(S,v),S.update(E);const A=S.digest();return clean$2(w,E),A}const _poly1305_aead=y=>(u,g,v)=>({encrypt(w,E){const S=w.length;E=getOutput(S+16,E,!1),E.set(w);const A=E.subarray(0,-16);y(u,g,A,A,1);const $=computeTag(y,u,g,A,v);return E.set($,S),clean$2($),E},decrypt(w,E){E=getOutput(w.length-16,E,!1);const S=w.subarray(0,-16),A=w.subarray(-16),$=computeTag(y,u,g,S,v);if(!equalBytes(A,$))throw new Error("invalid tag");return E.set(w.subarray(0,-16)),y(u,g,E,E,1),clean$2($),E}}),chacha20poly1305=wrapCipher({blockSize:64,nonceLength:12,tagLength:16},_poly1305_aead(chacha20));function isBytes$3(y){return y instanceof Uint8Array||ArrayBuffer.isView(y)&&y.constructor.name==="Uint8Array"}function anumber$1(y,u=""){if(!Number.isSafeInteger(y)||y<0){const g=u&&`"${u}" `;throw new Error(`${g}expected integer >= 0, got ${y}`)}}function abytes$2(y,u,g=""){const v=isBytes$3(y),b=y?.length,w=u!==void 0;if(!v||w&&b!==u){const E=g&&`"${g}" `,S=w?` of length ${u}`:"",A=v?`length=${b}`:`type=${typeof y}`;throw new Error(E+"expected Uint8Array"+S+", got "+A)}return y}function ahash$1(y){if(typeof y!="function"||typeof y.create!="function")throw new Error("Hash must wrapped by utils.createHasher");anumber$1(y.outputLen),anumber$1(y.blockLen)}function aexists$1(y,u=!0){if(y.destroyed)throw new Error("Hash instance has been destroyed");if(u&&y.finished)throw new Error("Hash#digest() has already been called")}function aoutput$1(y,u){abytes$2(y,void 0,"digestInto() output");const g=u.outputLen;if(y.length<g)throw new Error('"digestInto() output" expected to be of length >='+g)}function clean$1(...y){for(let u=0;u<y.length;u++)y[u].fill(0)}function createView$1(y){return new DataView(y.buffer,y.byteOffset,y.byteLength)}function rotr$1(y,u){return y<<32-u|y>>>u}const hasHexBuiltin=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes=Array.from({length:256},(y,u)=>u.toString(16).padStart(2,"0"));function bytesToHex$2(y){if(abytes$2(y),hasHexBuiltin)return y.toHex();let u="";for(let g=0;g<y.length;g++)u+=hexes[y[g]];return u}const asciis={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16(y){if(y>=asciis._0&&y<=asciis._9)return y-asciis._0;if(y>=asciis.A&&y<=asciis.F)return y-(asciis.A-10);if(y>=asciis.a&&y<=asciis.f)return y-(asciis.a-10)}function hexToBytes$2(y){if(typeof y!="string")throw new Error("hex string expected, got "+typeof y);if(hasHexBuiltin)return Uint8Array.fromHex(y);const u=y.length,g=u/2;if(u%2)throw new Error("hex string expected, got unpadded hex of length "+u);const v=new Uint8Array(g);for(let b=0,w=0;b<g;b++,w+=2){const E=asciiToBase16(y.charCodeAt(w)),S=asciiToBase16(y.charCodeAt(w+1));if(E===void 0||S===void 0){const A=y[w]+y[w+1];throw new Error('hex string expected, got non-hex character "'+A+'" at index '+w)}v[b]=E*16+S}return v}function createHasher$1(y,u={}){const g=(b,w)=>y(w).update(b).digest(),v=y(void 0);return g.outputLen=v.outputLen,g.blockLen=v.blockLen,g.create=b=>y(b),Object.assign(g,u),Object.freeze(g)}function randomBytes(y=32){const u=typeof globalThis=="object"?globalThis.crypto:null;if(typeof u?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return u.getRandomValues(new Uint8Array(y))}const oidNist=y=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,y])});function Chi$1(y,u,g){return y&u^~y&g}function Maj$1(y,u,g){return y&u^y&g^u&g}let HashMD$1=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(u,g,v,b){this.blockLen=u,this.outputLen=g,this.padOffset=v,this.isLE=b,this.buffer=new Uint8Array(u),this.view=createView$1(this.buffer)}update(u){aexists$1(this),abytes$2(u);const{view:g,buffer:v,blockLen:b}=this,w=u.length;for(let E=0;E<w;){const S=Math.min(b-this.pos,w-E);if(S===b){const A=createView$1(u);for(;b<=w-E;E+=b)this.process(A,E);continue}v.set(u.subarray(E,E+S),this.pos),this.pos+=S,E+=S,this.pos===b&&(this.process(g,0),this.pos=0)}return this.length+=u.length,this.roundClean(),this}digestInto(u){aexists$1(this),aoutput$1(u,this),this.finished=!0;const{buffer:g,view:v,blockLen:b,isLE:w}=this;let{pos:E}=this;g[E++]=128,clean$1(this.buffer.subarray(E)),this.padOffset>b-E&&(this.process(v,0),E=0);for(let T=E;T<b;T++)g[T]=0;v.setBigUint64(b-8,BigInt(this.length*8),w),this.process(v,0);const S=createView$1(u),A=this.outputLen;if(A%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const $=A/4,R=this.get();if($>R.length)throw new Error("_sha2: outputLen bigger than state");for(let T=0;T<$;T++)S.setUint32(4*T,R[T],w)}digest(){const{buffer:u,outputLen:g}=this;this.digestInto(u);const v=u.slice(0,g);return this.destroy(),v}_cloneInto(u){u||=new this.constructor,u.set(...this.get());const{blockLen:g,buffer:v,length:b,finished:w,destroyed:E,pos:S}=this;return u.destroyed=E,u.finished=w,u.length=b,u.pos=S,b%g&&u.buffer.set(v),u}clone(){return this._cloneInto()}};const SHA256_IV$1=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_K$1=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W$1=new Uint32Array(64);class SHA2_32B extends HashMD$1{constructor(u){super(64,u,8,!1)}get(){const{A:u,B:g,C:v,D:b,E:w,F:E,G:S,H:A}=this;return[u,g,v,b,w,E,S,A]}set(u,g,v,b,w,E,S,A){this.A=u|0,this.B=g|0,this.C=v|0,this.D=b|0,this.E=w|0,this.F=E|0,this.G=S|0,this.H=A|0}process(u,g){for(let T=0;T<16;T++,g+=4)SHA256_W$1[T]=u.getUint32(g,!1);for(let T=16;T<64;T++){const O=SHA256_W$1[T-15],B=SHA256_W$1[T-2],F=rotr$1(O,7)^rotr$1(O,18)^O>>>3,U=rotr$1(B,17)^rotr$1(B,19)^B>>>10;SHA256_W$1[T]=U+SHA256_W$1[T-7]+F+SHA256_W$1[T-16]|0}let{A:v,B:b,C:w,D:E,E:S,F:A,G:$,H:R}=this;for(let T=0;T<64;T++){const O=rotr$1(S,6)^rotr$1(S,11)^rotr$1(S,25),B=R+O+Chi$1(S,A,$)+SHA256_K$1[T]+SHA256_W$1[T]|0,U=(rotr$1(v,2)^rotr$1(v,13)^rotr$1(v,22))+Maj$1(v,b,w)|0;R=$,$=A,A=S,S=E+B|0,E=w,w=b,b=v,v=B+U|0}v=v+this.A|0,b=b+this.B|0,w=w+this.C|0,E=E+this.D|0,S=S+this.E|0,A=A+this.F|0,$=$+this.G|0,R=R+this.H|0,this.set(v,b,w,E,S,A,$,R)}roundClean(){clean$1(SHA256_W$1)}destroy(){this.set(0,0,0,0,0,0,0,0),clean$1(this.buffer)}}class _SHA256 extends SHA2_32B{A=SHA256_IV$1[0]|0;B=SHA256_IV$1[1]|0;C=SHA256_IV$1[2]|0;D=SHA256_IV$1[3]|0;E=SHA256_IV$1[4]|0;F=SHA256_IV$1[5]|0;G=SHA256_IV$1[6]|0;H=SHA256_IV$1[7]|0;constructor(){super(32)}}const sha256$2=createHasher$1(()=>new _SHA256,oidNist(1));const _0n$2=BigInt(0);function abignumber(y){if(typeof y=="bigint"){if(!isPosBig(y))throw new Error("positive bigint expected, got "+y)}else anumber$1(y);return y}function hexToNumber(y){if(typeof y!="string")throw new Error("hex string expected, got "+typeof y);return y===""?_0n$2:BigInt("0x"+y)}function bytesToNumberLE(y){return hexToNumber(bytesToHex$2(copyBytes(abytes$2(y)).reverse()))}function numberToBytesBE(y,u){anumber$1(u),y=abignumber(y);const g=hexToBytes$2(y.toString(16).padStart(u*2,"0"));if(g.length!==u)throw new Error("number too large");return g}function numberToBytesLE(y,u){return numberToBytesBE(y,u).reverse()}function copyBytes(y){return Uint8Array.from(y)}const isPosBig=y=>typeof y=="bigint"&&_0n$2<=y;function inRange(y,u,g){return isPosBig(y)&&isPosBig(u)&&isPosBig(g)&&u<=y&&y<g}function aInRange(y,u,g,v){if(!inRange(u,g,v))throw new Error("expected valid "+y+": "+g+" <= n < "+v+", got "+u)}function validateObject(y,u={},g={}){if(!y||typeof y!="object")throw new Error("expected valid options object");function v(w,E,S){const A=y[w];if(S&&A===void 0)return;const $=typeof A;if($!==E||A===null)throw new Error(`param "${w}" is invalid: expected ${E}, got ${$}`)}const b=(w,E)=>Object.entries(w).forEach(([S,A])=>v(S,A,E));b(u,!1),b(g,!0)}const _0n$1=BigInt(0);function mod(y,u){const g=y%u;return g>=_0n$1?g:u+g}function pow2$1(y,u,g){let v=y;for(;u-- >_0n$1;)v*=v,v%=g;return v}function createKeygen(y,u){return function(v){const b=y(v);return{secretKey:b,publicKey:u(b)}}}const _0n=BigInt(0),_1n$1=BigInt(1),_2n$1=BigInt(2);function validateOpts(y){return validateObject(y,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...y})}function montgomery(y){const u=validateOpts(y),{P:g,type:v,adjustScalarBytes:b,powPminus2:w,randomBytes:E}=u,S=v==="x25519";if(!S&&v!=="x448")throw new Error("invalid type");const A=E||randomBytes,$=S?255:448,R=S?32:56,T=BigInt(S?9:5),O=BigInt(S?121665:39081),B=S?_2n$1**BigInt(254):_2n$1**BigInt(447),F=S?BigInt(8)*_2n$1**BigInt(251)-_1n$1:BigInt(4)*_2n$1**BigInt(445)-_1n$1,U=B+F+_1n$1,q=j=>mod(j,g),J=ie(T);function ie(j){return numberToBytesLE(q(j),R)}function oe(j){const z=copyBytes(abytes$2(j,R,"uCoordinate"));return S&&(z[31]&=127),q(bytesToNumberLE(z))}function le(j){return bytesToNumberLE(b(copyBytes(abytes$2(j,R,"scalar"))))}function de(j,z){const re=ve(oe(z),le(j));if(re===_0n)throw new Error("invalid private or public key received");return ie(re)}function fe(j){return de(j,J)}const ye=fe,we=de;function pe(j,z,re){const Y=q(j*(z-re));return z=q(z-Y),re=q(re+Y),{x_2:z,x_3:re}}function ve(j,z){aInRange("u",j,_0n,g),aInRange("scalar",z,B,U);const re=z,Y=j;let te=_1n$1,ne=_0n,se=j,ee=_1n$1,Z=_0n;for(let _e=BigInt($-1);_e>=_0n;_e--){const Re=re>>_e&_1n$1;Z^=Re,{x_2:te,x_3:se}=pe(Z,te,se),{x_2:ne,x_3:ee}=pe(Z,ne,ee),Z=Re;const Ae=te+ne,ge=q(Ae*Ae),be=te-ne,Te=q(be*be),De=ge-Te,Ie=se+ee,Se=se-ee,Be=q(Se*Ae),Le=q(Ie*be),qe=Be+Le,Ke=Be-Le;se=q(qe*qe),ee=q(Y*q(Ke*Ke)),te=q(ge*Te),ne=q(De*(ge+q(O*De)))}({x_2:te,x_3:se}=pe(Z,te,se)),{x_2:ne,x_3:ee}=pe(Z,ne,ee);const ue=w(ne);return q(te*ue)}const he={secretKey:R,publicKey:R,seed:R},ae=(j=A(R))=>(abytes$2(j,he.seed,"seed"),j),Q={randomSecretKey:ae};return Object.freeze({keygen:createKeygen(ae,ye),getSharedSecret:we,getPublicKey:ye,scalarMult:de,scalarMultBase:fe,utils:Q,GuBytes:J.slice(),lengths:he})}const _1n=BigInt(1),_2n=BigInt(2),_3n=BigInt(3),_5n=BigInt(5);BigInt(8);const ed25519_CURVE_p=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed");function ed25519_pow_2_252_3(y){const u=BigInt(10),g=BigInt(20),v=BigInt(40),b=BigInt(80),w=ed25519_CURVE_p,S=y*y%w*y%w,A=pow2$1(S,_2n,w)*S%w,$=pow2$1(A,_1n,w)*y%w,R=pow2$1($,_5n,w)*$%w,T=pow2$1(R,u,w)*R%w,O=pow2$1(T,g,w)*T%w,B=pow2$1(O,v,w)*O%w,F=pow2$1(B,b,w)*B%w,U=pow2$1(F,b,w)*B%w,q=pow2$1(U,u,w)*R%w;return{pow_p_5_8:pow2$1(q,_2n,w)*y%w,b2:S}}function adjustScalarBytes(y){return y[0]&=248,y[31]&=127,y[31]|=64,y}const x25519=(()=>{const y=ed25519_CURVE_p;return montgomery({P:y,type:"x25519",powPminus2:u=>{const{pow_p_5_8:g,b2:v}=ed25519_pow_2_252_3(u);return mod(pow2$1(g,_3n,y)*v,y)},adjustScalarBytes})})();class _HMAC{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(u,g){if(ahash$1(u),abytes$2(g,void 0,"key"),this.iHash=u.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const v=this.blockLen,b=new Uint8Array(v);b.set(g.length>v?u.create().update(g).digest():g);for(let w=0;w<b.length;w++)b[w]^=54;this.iHash.update(b),this.oHash=u.create();for(let w=0;w<b.length;w++)b[w]^=106;this.oHash.update(b),clean$1(b)}update(u){return aexists$1(this),this.iHash.update(u),this}digestInto(u){aexists$1(this),abytes$2(u,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(u),this.oHash.update(u),this.oHash.digestInto(u),this.destroy()}digest(){const u=new Uint8Array(this.oHash.outputLen);return this.digestInto(u),u}_cloneInto(u){u||=Object.create(Object.getPrototypeOf(this),{});const{oHash:g,iHash:v,finished:b,destroyed:w,blockLen:E,outputLen:S}=this;return u=u,u.finished=b,u.destroyed=w,u.blockLen=E,u.outputLen=S,u.oHash=g._cloneInto(u.oHash),u.iHash=v._cloneInto(u.iHash),u}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac$1=(y,u,g)=>new _HMAC(y,u).update(g).digest();hmac$1.create=(y,u)=>new _HMAC(y,u);function extract$1(y,u,g){return ahash$1(y),g===void 0&&(g=new Uint8Array(y.outputLen)),hmac$1(y,g,u)}const HKDF_COUNTER$1=Uint8Array.of(0),EMPTY_BUFFER$1=Uint8Array.of();function expand$1(y,u,g,v=32){ahash$1(y),anumber$1(v,"length");const b=y.outputLen;if(v>255*b)throw new Error("Length must be <= 255*HashLen");const w=Math.ceil(v/b);g===void 0?g=EMPTY_BUFFER$1:abytes$2(g,void 0,"info");const E=new Uint8Array(w*b),S=hmac$1.create(y,u),A=S._cloneInto(),$=new Uint8Array(S.outputLen);for(let R=0;R<w;R++)HKDF_COUNTER$1[0]=R+1,A.update(R===0?EMPTY_BUFFER$1:$).update(g).update(HKDF_COUNTER$1).digestInto($),E.set($,b*R),S._cloneInto(A);return S.destroy(),A.destroy(),clean$1($,HKDF_COUNTER$1),E.slice(0,v)}const pureJsCrypto={hashSHA256(y){return sha256$2(y.subarray())},getHKDF(y,u){const g=extract$1(sha256$2,u,y),b=expand$1(sha256$2,g,void 0,96),w=b.subarray(0,32),E=b.subarray(32,64),S=b.subarray(64,96);return[w,E,S]},generateX25519KeyPair(){const y=x25519.utils.randomSecretKey();return{publicKey:x25519.getPublicKey(y),privateKey:y}},generateX25519KeyPairFromSeed(y){return{publicKey:x25519.getPublicKey(y),privateKey:y}},generateX25519SharedKey(y,u){return x25519.getSharedSecret(y.subarray(),u.subarray())},chaCha20Poly1305Encrypt(y,u,g,v){return chacha20poly1305(v,u,g).encrypt(y.subarray())},chaCha20Poly1305Decrypt(y,u,g,v,b){return chacha20poly1305(v,u,g).decrypt(y.subarray(),b)}},defaultCrypto=pureJsCrypto;function wrapCrypto(y){return{generateKeypair:y.generateX25519KeyPair,dh:(u,g)=>y.generateX25519SharedKey(u.privateKey,g).subarray(0,32),encrypt:y.chaCha20Poly1305Encrypt,decrypt:y.chaCha20Poly1305Decrypt,hash:y.hashSHA256,hkdf:y.getHKDF}}const uint16BEEncode=y=>{const u=allocUnsafe(2);return u[0]=y>>8,u[1]=y,u};uint16BEEncode.bytes=2;const uint16BEDecode=y=>{if(y.length<2)throw RangeError("Could not decode int16BE");if(y instanceof Uint8Array){let u=0;return u+=y[0]<<8,u+=y[1],u}return y.getUint16(0)};uint16BEDecode.bytes=2;function registerMetrics(y){return{xxHandshakeSuccesses:y.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:y.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:y.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:y.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:y.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function logLocalStaticKeys(y,u){!u.enabled||!DUMP_SESSION_KEYS||(y?(u(`LOCAL_STATIC_PUBLIC_KEY ${toString$3(y.publicKey,"hex")}`),u(`LOCAL_STATIC_PRIVATE_KEY ${toString$3(y.privateKey,"hex")}`)):u("Missing local static keys."))}function logLocalEphemeralKeys(y,u){!u.enabled||!DUMP_SESSION_KEYS||(y?(u(`LOCAL_PUBLIC_EPHEMERAL_KEY ${toString$3(y.publicKey,"hex")}`),u(`LOCAL_PRIVATE_EPHEMERAL_KEY ${toString$3(y.privateKey,"hex")}`)):u("Missing local ephemeral keys."))}function logRemoteStaticKey(y,u){!u.enabled||!DUMP_SESSION_KEYS||u(y?`REMOTE_STATIC_PUBLIC_KEY ${toString$3(y.subarray(),"hex")}`:"Missing remote static public key.")}function logRemoteEphemeralKey(y,u){!u.enabled||!DUMP_SESSION_KEYS||u(y?`REMOTE_EPHEMERAL_PUBLIC_KEY ${toString$3(y.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function logCipherState(y,u,g){!g.enabled||!DUMP_SESSION_KEYS||(g(`CIPHER_STATE_1 ${y.n.getUint64()} ${y.k&&toString$3(y.k,"hex")}`),g(`CIPHER_STATE_2 ${u.n.getUint64()} ${u.k&&toString$3(u.k,"hex")}`))}function xor(y,u){if(y.length!==u.length)throw new Error("Inputs should have the same length");const g=allocUnsafe(y.length);for(let v=0;v<y.length;v++)g[v]=y[v]^u[v];return g}class InvalidCryptoExchangeError extends Error{code;constructor(u="Invalid crypto exchange"){super(u),this.code=InvalidCryptoExchangeError.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}const MIN_NONCE=0,MAX_NONCE=4294967295,ERR_MAX_NONCE="Cipherstate has reached maximum n, a new handshake must be performed";class Nonce{n;bytes;view;constructor(u=MIN_NONCE){this.n=u,this.bytes=alloc$2(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,u,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>MAX_NONCE)throw new Error(ERR_MAX_NONCE)}}const ZEROLEN=alloc$2(0);class CipherState{k;n;crypto;constructor(u,g=void 0,v=0){this.crypto=u,this.k=g,this.n=new Nonce(v)}hasKey(){return!!this.k}encryptWithAd(u,g){if(!this.hasKey())return g;this.n.assertValue();const v=this.crypto.encrypt(g,this.n.getBytes(),u,this.k);return this.n.increment(),v}decryptWithAd(u,g,v){if(!this.hasKey())return g;this.n.assertValue();const b=this.crypto.decrypt(g,this.n.getBytes(),u,this.k,v);return this.n.increment(),b}}class SymmetricState{cs;ck;h;crypto;constructor(u,g){this.crypto=u;const v=fromString$1(g,"utf-8");this.h=hashProtocolName(u,v),this.ck=this.h,this.cs=new CipherState(u)}mixKey(u){const[g,v]=this.crypto.hkdf(this.ck,u);this.ck=g,this.cs=new CipherState(this.crypto,v)}mixHash(u){this.h=this.crypto.hash(new Uint8ArrayList(this.h,u))}encryptAndHash(u){const g=this.cs.encryptWithAd(this.h,u);return this.mixHash(g),g}decryptAndHash(u){const g=this.cs.decryptWithAd(this.h,u);return this.mixHash(u),g}split(){const[u,g]=this.crypto.hkdf(this.ck,ZEROLEN);return[new CipherState(this.crypto,u),new CipherState(this.crypto,g)]}}class AbstractHandshakeState{ss;s;e;rs;re;initiator;crypto;constructor(u){const{crypto:g,protocolName:v,prologue:b,initiator:w,s:E,e:S,rs:A,re:$}=u;this.crypto=g,this.ss=new SymmetricState(g,v),this.ss.mixHash(b),this.initiator=w,this.s=E,this.e=S,this.rs=A,this.re=$}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const u=this.crypto.generateKeypair();return this.ss.mixHash(u.publicKey),this.e=u,u.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(u,g=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(u.byteLength<g+32)throw new Error("message is not long enough");this.re=u.sublist(g,g+32),this.ss.mixHash(this.re)}readS(u,g=0){if(this.rs)throw new Error("remote static public key is already set");const v=32+(this.ss.cs.hasKey()?16:0);if(u.byteLength<g+v)throw new Error("message is not long enough");const b=u.sublist(g,g+v);return this.rs=this.ss.decryptAndHash(b),v}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class XXHandshakeState extends AbstractHandshakeState{writeMessageA(u){return new Uint8ArrayList(this.writeE(),this.ss.encryptAndHash(u))}writeMessageB(u){const g=this.writeE();this.writeEE();const v=this.writeS();return this.writeES(),new Uint8ArrayList(g,v,this.ss.encryptAndHash(u))}writeMessageC(u){const g=this.writeS();return this.writeSE(),new Uint8ArrayList(g,this.ss.encryptAndHash(u))}readMessageA(u){try{return this.readE(u),this.ss.decryptAndHash(u.sublist(32))}catch(g){throw new InvalidCryptoExchangeError(`handshake stage 0 validation fail: ${g.message}`)}}readMessageB(u){try{this.readE(u),this.readEE();const g=this.readS(u,32);return this.readES(),this.ss.decryptAndHash(u.sublist(32+g))}catch(g){throw new InvalidCryptoExchangeError(`handshake stage 1 validation fail: ${g.message}`)}}readMessageC(u){try{const g=this.readS(u);return this.readSE(),this.ss.decryptAndHash(u.sublist(g))}catch(g){throw new InvalidCryptoExchangeError(`handshake stage 2 validation fail: ${g.message}`)}}}function hashProtocolName(y,u){if(u.length<=32){const g=alloc$2(32);return g.set(u),g}else return y.hash(u)}var NoiseExtensions;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{if(b.lengthDelimited!==!1&&v.fork(),g.webtransportCerthashes!=null)for(const w of g.webtransportCerthashes)v.uint32(10),v.bytes(w);if(g.streamMuxers!=null)for(const w of g.streamMuxers)v.uint32(18),v.string(w);b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={webtransportCerthashes:[],streamMuxers:[]},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{if(b.limits?.webtransportCerthashes!=null&&w.webtransportCerthashes.length===b.limits.webtransportCerthashes)throw new MaxLengthError('Decode error - map field "webtransportCerthashes" had too many elements');w.webtransportCerthashes.push(g.bytes());break}case 2:{if(b.limits?.streamMuxers!=null&&w.streamMuxers.length===b.limits.streamMuxers)throw new MaxLengthError('Decode error - map field "streamMuxers" had too many elements');w.streamMuxers.push(g.string());break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(NoiseExtensions||(NoiseExtensions={}));var NoiseHandshakePayload;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.identityKey!=null&&g.identityKey.byteLength>0&&(v.uint32(10),v.bytes(g.identityKey)),g.identitySig!=null&&g.identitySig.byteLength>0&&(v.uint32(18),v.bytes(g.identitySig)),g.extensions!=null&&(v.uint32(34),NoiseExtensions.codec().encode(g.extensions,v)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={identityKey:alloc$2(0),identitySig:alloc$2(0)},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.identityKey=g.bytes();break}case 2:{w.identitySig=g.bytes();break}case 4:{w.extensions=NoiseExtensions.codec().decode(g,g.uint32(),{limits:b.limits?.extensions});break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(NoiseHandshakePayload||(NoiseHandshakePayload={}));async function createHandshakePayload(y,u,g){const v=await y.sign(getSignaturePayload(u));return NoiseHandshakePayload.encode({identityKey:publicKeyToProtobuf(y.publicKey),identitySig:v,extensions:g})}async function decodeHandshakePayload(y,u,g){try{const v=NoiseHandshakePayload.decode(y),b=publicKeyFromProtobuf(v.identityKey);if(g?.equals(b)===!1)throw new Error(`Payload identity key ${b} does not match expected remote identity key ${g}`);if(!u)throw new Error("Remote static does not exist");const w=getSignaturePayload(u);if(!await b.verify(w,v.identitySig))throw new Error("Invalid payload signature");return v}catch(v){throw new UnexpectedPeerError(v.message)}}function getSignaturePayload(y){const u=fromString$1("noise-libp2p-static-key:");return y instanceof Uint8Array?concat$2([u,y],u.length+y.length):(y.prepend(u),y)}class EncryptedMessageStream extends AbstractMessageStream{stream;handshake;metrics;decoder;constructor(u,g,v){super({log:u.log,inactivityTimeout:u.inactivityTimeout,maxReadBufferLength:u.maxReadBufferLength,direction:u.direction}),this.stream=u,this.handshake=g,this.metrics=v,this.decoder=new LengthPrefixedDecoder({lengthDecoder:uint16BEDecode,maxBufferSize:16*1024*1024,encodingLength:()=>2});const b=A=>{try{for(const $ of this.decoder.decode(A.data))this.onData(this.decrypt($))}catch($){this.abort($)}};this.stream.addEventListener("message",b);const w=A=>{A.error!=null?A.local===!0?this.abort(A.error):this.onRemoteReset():this.onTransportClosed()};this.stream.addEventListener("close",w);const E=()=>{this.safeDispatchEvent("drain")};this.stream.addEventListener("drain",E);const S=()=>{this.onRemoteCloseWrite()};this.stream.addEventListener("remoteCloseWrite",S)}encrypt(u){const g=new Uint8ArrayList;for(let v=0;v<u.byteLength;v+=NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG){let b=v+NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG;b>u.byteLength&&(b=u.byteLength);let w;u instanceof Uint8Array?w=this.handshake.encrypt(u.subarray(v,b)):w=this.handshake.encrypt(u.sublist(v,b)),this.metrics?.encryptedPackets.increment(),g.append(uint16BEEncode(w.byteLength)),g.append(w)}return g}decrypt(u){const g=new Uint8ArrayList;for(let v=0;v<u.byteLength;v+=NOISE_MSG_MAX_LENGTH_BYTES){let b=v+NOISE_MSG_MAX_LENGTH_BYTES;if(b>u.byteLength&&(b=u.byteLength),b-CHACHA_TAG_LENGTH<v)throw new Error("Invalid chunk");let w;u instanceof Uint8Array?w=u.subarray(v,b):w=u.sublist(v,b);const E=u.subarray(v,b-CHACHA_TAG_LENGTH);try{const S=this.handshake.decrypt(w,E);this.metrics?.decryptedPackets.increment(),g.append(S)}catch(S){throw this.metrics?.decryptErrors.increment(),S}}return g}close(u){return this.stream.close(u)}sendPause(){this.stream.pause()}sendResume(){this.stream.resume()}sendReset(u){this.stream.abort(u)}sendData(u){return{sentBytes:u.byteLength,canSendMore:this.stream.send(this.encrypt(u))}}}function toMessageStream(y,u,g){return new EncryptedMessageStream(y,u,g)}async function performHandshakeInitiator(y,u){const{log:g,connection:v,crypto:b,privateKey:w,prologue:E,s:S,remoteIdentityKey:A,extensions:$}=y,R=await createHandshakePayload(w,S.publicKey,$),T=new XXHandshakeState({crypto:b,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:E,s:S});logLocalStaticKeys(T.s,g),g.trace("Stage 0 - Initiator starting to send first message."),await v.write(T.writeMessageA(ZEROLEN),u),g.trace("Stage 0 - Initiator finished sending first message."),logLocalEphemeralKeys(T.e,g),g.trace("Stage 1 - Initiator waiting to receive first message from responder...");const O=T.readMessageB(await v.read(u));g.trace("Stage 1 - Initiator received the message."),logRemoteEphemeralKey(T.re,g),logRemoteStaticKey(T.rs,g),g.trace("Initiator going to check remote's signature...");const B=await decodeHandshakePayload(O,T.rs,A);g.trace("All good with the signature!"),g.trace("Stage 2 - Initiator sending third handshake message."),await v.write(T.writeMessageC(R),u),g.trace("Stage 2 - Initiator sent message with signed payload.");const[F,U]=T.ss.split();return logCipherState(F,U,g),{payload:B,encrypt:q=>F.encryptWithAd(ZEROLEN,q),decrypt:(q,J)=>U.decryptWithAd(ZEROLEN,q,J)}}async function performHandshakeResponder(y,u){const{log:g,connection:v,crypto:b,privateKey:w,prologue:E,s:S,remoteIdentityKey:A,extensions:$}=y,R=await createHandshakePayload(w,S.publicKey,$),T=new XXHandshakeState({crypto:b,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:E,s:S});logLocalStaticKeys(T.s,g),g.trace("Stage 0 - Responder waiting to receive first message."),T.readMessageA(await v.read(u)),g.trace("Stage 0 - Responder received first message."),logRemoteEphemeralKey(T.re,g),g.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await v.write(T.writeMessageB(R),u),g.trace("Stage 1 - Responder sent the second handshake message with signed payload."),logLocalEphemeralKeys(T.e,g),g.trace("Stage 2 - Responder waiting for third handshake message...");const O=T.readMessageC(await v.read(u));g.trace("Stage 2 - Responder received the message, finished handshake.");const B=await decodeHandshakePayload(O,T.rs,A),[F,U]=T.ss.split();return logCipherState(F,U,g),{payload:B,encrypt:q=>U.encryptWithAd(ZEROLEN,q),decrypt:(q,J)=>F.decryptWithAd(ZEROLEN,q,J)}}class Noise{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;log;constructor(u,g={}){const{staticNoiseKey:v,extensions:b,crypto:w,prologueBytes:E}=g,{metrics:S}=u;this.components=u,this.log=u.logger.forComponent("libp2p:noise");const A=w??defaultCrypto;this.crypto=wrapCrypto(A),this.extensions={webtransportCerthashes:[],...b},this.metrics=S?registerMetrics(S):void 0,v?this.staticKey=A.generateX25519KeyPairFromSeed(v):this.staticKey=A.generateX25519KeyPair(),this.prologue=E??alloc$2(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[serviceCapabilities]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(u,g){const v=u.log?.newScope("noise")??this.log,b=lpStream(u,{lengthEncoder:uint16BEEncode,lengthDecoder:uint16BEDecode,maxDataLength:NOISE_MSG_MAX_LENGTH_BYTES}),w=await this.performHandshakeInitiator(b,this.components.privateKey,v,g?.remotePeer?.publicKey,g),E=publicKeyFromProtobuf(w.payload.identityKey);return{connection:toMessageStream(b.unwrap(),w,this.metrics),remoteExtensions:w.payload.extensions,remotePeer:peerIdFromPublicKey(E),streamMuxer:g?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(w.payload.extensions?.streamMuxers)}}getStreamMuxer(u){if(u==null||u.length===0)return;const g=this.components.upgrader.getStreamMuxers();if(g!=null)for(const v of u){const b=g.get(v);if(b!=null)return b}if(u.length)throw new InvalidCryptoExchangeError$1("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(u,g){const v=u.log?.newScope("noise")??this.log,b=lpStream(u,{lengthEncoder:uint16BEEncode,lengthDecoder:uint16BEDecode,maxDataLength:NOISE_MSG_MAX_LENGTH_BYTES}),w=await this.performHandshakeResponder(b,this.components.privateKey,v,g?.remotePeer?.publicKey,g),E=publicKeyFromProtobuf(w.payload.identityKey);return{connection:toMessageStream(b.unwrap(),w,this.metrics),remoteExtensions:w.payload.extensions,remotePeer:peerIdFromPublicKey(E),streamMuxer:g?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(w.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(u,g,v,b,w){let E;const S=w?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{E=await performHandshakeInitiator({connection:u,privateKey:g,remoteIdentityKey:b,log:v.newScope("xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:S,webtransportCerthashes:[],...this.extensions}},w),this.metrics?.xxHandshakeSuccesses.increment()}catch(A){throw this.metrics?.xxHandshakeErrors.increment(),A}return E}async performHandshakeResponder(u,g,v,b,w){let E;const S=w?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{E=await performHandshakeResponder({connection:u,privateKey:g,remoteIdentityKey:b,log:v.newScope("xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:S,webtransportCerthashes:[],...this.extensions}},w),this.metrics?.xxHandshakeSuccesses.increment()}catch(A){throw this.metrics?.xxHandshakeErrors.increment(),A}return E}}function noise(y={}){return u=>new Noise(u,y)}var FrameType;(function(y){y[y.Data=0]="Data",y[y.WindowUpdate=1]="WindowUpdate",y[y.Ping=2]="Ping",y[y.GoAway=3]="GoAway"})(FrameType||(FrameType={}));var Flag;(function(y){y[y.SYN=1]="SYN",y[y.ACK=2]="ACK",y[y.FIN=4]="FIN",y[y.RST=8]="RST"})(Flag||(Flag={}));Object.values(Flag).filter(y=>typeof y!="string");const YAMUX_VERSION=0;var GoAwayCode;(function(y){y[y.NormalTermination=0]="NormalTermination",y[y.ProtocolError=1]="ProtocolError",y[y.InternalError=2]="InternalError"})(GoAwayCode||(GoAwayCode={}));const HEADER_LENGTH=12;class ProtocolError extends Error{static name="ProtocolError";reason;constructor(u,g){super(u),this.name="ProtocolError",this.reason=g}}function isProtocolError(y){return y?.reason!==null}class InvalidFrameError extends ProtocolError{static name="InvalidFrameError";constructor(u="The frame was invalid"){super(u,GoAwayCode.ProtocolError),this.name="InvalidFrameError"}}class UnRequestedPingError extends ProtocolError{static name="UnRequestedPingError";constructor(u="Un-requested ping error"){super(u,GoAwayCode.ProtocolError),this.name="UnRequestedPingError"}}class NotMatchingPingError extends ProtocolError{static name="NotMatchingPingError";constructor(u="Not matching ping error"){super(u,GoAwayCode.ProtocolError),this.name="NotMatchingPingError"}}class ReceiveWindowExceededError extends ProtocolError{static name="ReceiveWindowExceededError";constructor(u="Receive window exceeded"){super(u,GoAwayCode.ProtocolError),this.name="ReceiveWindowExceededError"}}const INITIAL_STREAM_WINDOW=256*1024,MAX_STREAM_WINDOW=16*1024*1024,defaultConfig={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3};function verifyConfig(y){if(y.keepAliveInterval!=null&&y.keepAliveInterval<=0)throw new InvalidParametersError$1("keep-alive interval must be positive");if(y.maxInboundStreams!=null&&y.maxInboundStreams<0)throw new InvalidParametersError$1("max inbound streams must be larger or equal 0");if(y.maxOutboundStreams!=null&&y.maxOutboundStreams<0)throw new InvalidParametersError$1("max outbound streams must be larger or equal 0");if(y.maxMessageSize!=null&&y.maxMessageSize<1024)throw new InvalidParametersError$1("MaxMessageSize must be greater than a kilobyte");if(y.streamOptions?.initialStreamWindowSize!=null&&y.streamOptions?.initialStreamWindowSize<INITIAL_STREAM_WINDOW)throw new InvalidParametersError$1("InitialStreamWindowSize must be larger or equal 256 kB");if(y.streamOptions?.maxStreamWindowSize!=null&&y.streamOptions?.initialStreamWindowSize!=null&&y.streamOptions?.maxStreamWindowSize<y.streamOptions?.initialStreamWindowSize)throw new InvalidParametersError$1("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(y.streamOptions?.maxStreamWindowSize!=null&&y.streamOptions?.maxStreamWindowSize>2**32-1)throw new InvalidParametersError$1("MaxStreamWindowSize must be less than equal MAX_UINT32")}function isDataFrame(y){return y.header.type===FrameType.Data&&y.data!==null}const twoPow24=2**24;function decodeHeader(y){if(y[0]!==YAMUX_VERSION)throw new InvalidFrameError("Invalid frame version");return{type:y[1],flag:(y[2]<<8)+y[3],streamID:y[4]*twoPow24+(y[5]<<16)+(y[6]<<8)+y[7],length:y[8]*twoPow24+(y[9]<<16)+(y[10]<<8)+y[11]}}let Decoder$1=class{buffer;constructor(){this.buffer=new Uint8ArrayList}*emitFrames(u){for(this.buffer.append(u);;){const g=this.readFrame();if(g===void 0)break;yield g}}readFrame(){let u=HEADER_LENGTH;if(this.buffer.byteLength<HEADER_LENGTH)return;const g=decodeHeader(this.buffer.subarray(0,HEADER_LENGTH));if(g.type===FrameType.Data){if(u+=g.length,this.buffer.byteLength<u)return;const v=this.buffer.sublist(HEADER_LENGTH,u);return this.buffer.consume(u),{header:g,data:v}}return this.buffer.consume(u),{header:g}}};function encodeHeader(y){const u=new Uint8Array(HEADER_LENGTH);return u[1]=y.type,u[2]=y.flag>>>8,u[3]=y.flag,u[4]=y.streamID>>>24,u[5]=y.streamID>>>16,u[6]=y.streamID>>>8,u[7]=y.streamID,u[8]=y.length>>>24,u[9]=y.length>>>16,u[10]=y.length>>>8,u[11]=y.length,u}var StreamState;(function(y){y[y.Init=0]="Init",y[y.SYNSent=1]="SYNSent",y[y.SYNReceived=2]="SYNReceived",y[y.Established=3]="Established",y[y.Finished=4]="Finished",y[y.Paused=5]="Paused"})(StreamState||(StreamState={}));class YamuxStream extends AbstractStream{streamId;state;sendWindowCapacity;recvWindow;recvWindowCapacity;maxStreamWindowSize;epochStart;getRTT;sendFrame;constructor(u){const g=u.initialStreamWindowSize??INITIAL_STREAM_WINDOW;super({...u,maxMessageSize:g-HEADER_LENGTH}),this.streamId=u.streamId,this.state=u.state,this.sendWindowCapacity=g,this.recvWindow=g,this.recvWindowCapacity=this.recvWindow,this.maxStreamWindowSize=u.maxStreamWindowSize??MAX_STREAM_WINDOW,this.epochStart=Date.now(),this.getRTT=u.getRTT,this.sendFrame=u.sendFrame;const v=()=>{this.state=StreamState.Finished};this.addEventListener("close",v)}sendData(u){const g=u.byteLength;let v=0,b=!0;for(this.log?.trace("send window capacity is %d bytes",this.sendWindowCapacity);u.byteLength>0;){if(this.sendWindowCapacity===0){b=!1,this.log?.trace("sent %d/%d bytes, exhausted send window, waiting for window update",v,g);break}const w=Math.min(this.sendWindowCapacity,u.byteLength),E=this.getSendFlags(),S=u.sublist(0,w);u.consume(w);const A=this.sendFrame({type:FrameType.Data,flag:E,streamID:this.streamId,length:w},S);if(this.sendWindowCapacity-=w,v+=w,!A){b=A,this.log.trace("sent %d/%d bytes, wait for muxer to have more send capacity",v,g);break}}return{sentBytes:v,canSendMore:b}}sendReset(){this.sendFrame({type:FrameType.WindowUpdate,flag:Flag.RST,streamID:this.streamId,length:0})}async sendCloseWrite(){const u=this.getSendFlags()|Flag.FIN;this.sendFrame({type:FrameType.WindowUpdate,flag:u,streamID:this.streamId,length:0})}async sendCloseRead(u){u?.signal?.throwIfAborted()}sendPause(){this.state=StreamState.Paused}sendResume(){this.state=StreamState.Established,this.sendWindowUpdate()}handleWindowUpdate(u){this.processFlags(u.header.flag),this.sendWindowCapacity+=u.header.length,this.maxMessageSize=this.sendWindowCapacity-HEADER_LENGTH,this.maxMessageSize<0&&(this.maxMessageSize=0),this.maxMessageSize!==0&&this.writeBuffer.byteLength>0&&(this.log?.trace("window update of %d bytes allows more data to be sent, have %d bytes queued, sending data %s",u.header.length,this.writeBuffer.byteLength,this.sendingData),this.safeDispatchEvent("drain"))}handleData(u){if(!isDataFrame(u))throw new InvalidFrameError("Frame was not data frame");if(this.processFlags(u.header.flag),this.recvWindowCapacity<u.header.length)throw new ReceiveWindowExceededError("Receive window exceeded");this.recvWindowCapacity-=u.header.length,this.onData(u.data),this.sendWindowUpdate()}processFlags(u){(u&Flag.ACK)===Flag.ACK&&this.state===StreamState.SYNSent&&(this.state=StreamState.Established),(u&Flag.FIN)===Flag.FIN&&this.onRemoteCloseWrite(),(u&Flag.RST)===Flag.RST&&this.onRemoteReset()}getSendFlags(){switch(this.state){case StreamState.Init:return this.state=StreamState.SYNSent,Flag.SYN;case StreamState.SYNReceived:return this.state=StreamState.Established,Flag.ACK;default:return 0}}sendWindowUpdate(){if(this.state===StreamState.Paused){this.epochStart=Date.now();return}const u=this.getSendFlags(),g=Date.now(),v=this.getRTT();if(u===0&&v>-1&&g-this.epochStart<=v*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&u===0)return;const b=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=g,this.sendFrame({type:FrameType.WindowUpdate,flag:u,streamID:this.streamId,length:b})}}function debugFrame(y){return{type:FrameType[y.type],flags:[(y.flag&Flag.SYN)===Flag.SYN?"SYN":void 0,(y.flag&Flag.ACK)===Flag.ACK?"ACK":void 0,(y.flag&Flag.FIN)===Flag.FIN?"FIN":void 0,(y.flag&Flag.RST)===Flag.RST?"RST":void 0].filter(Boolean),streamID:y.streamID,length:y.length}}const YAMUX_PROTOCOL_ID="/yamux/1.0.0";class Yamux{protocol=YAMUX_PROTOCOL_ID;_init;constructor(u={}){this._init=u}[Symbol.toStringTag]="@chainsafe/libp2p-yamux";[serviceCapabilities]=["@libp2p/stream-multiplexing"];createStreamMuxer(u){return new YamuxMuxer(u,{...this._init})}}class YamuxMuxer extends AbstractStreamMuxer{nextStreamID;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;decoder;keepAlive;enableKeepAlive;keepAliveInterval;maxInboundStreams;maxOutboundStreams;constructor(u,g={}){super(u,{...g,protocol:YAMUX_PROTOCOL_ID,name:"yamux"}),this.client=u.direction==="outbound",verifyConfig(g),this.enableKeepAlive=g.enableKeepAlive??defaultConfig.enableKeepAlive,this.keepAliveInterval=g.keepAliveInterval??defaultConfig.keepAliveInterval,this.maxInboundStreams=g.maxInboundStreams??defaultConfig.maxInboundStreams,this.maxOutboundStreams=g.maxOutboundStreams??defaultConfig.maxOutboundStreams,this.decoder=new Decoder$1,this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,this.log.trace("muxer created"),this.enableKeepAlive&&(this.log.trace("muxer keepalive enabled interval=%s",this.keepAliveInterval),this.keepAlive=repeatingTask(async v=>{try{await this.ping(v)}catch(b){this.log.error("ping error: %s",b)}},this.keepAliveInterval,{runImmediately:!0}),this.keepAlive.start())}onData(u){for(const g of this.decoder.emitFrames(u))this.handleFrame(g)}onCreateStream(){if(this.remoteGoAway!==void 0)throw new MuxerClosedError("Muxer closed remotely");if(this.localGoAway!==void 0)throw new MuxerClosedError("Muxer closed locally");const u=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.maxOutboundStreams)throw new TooManyOutboundProtocolStreamsError("max outbound streams exceeded");this.log.trace("new outgoing stream id=%s",u);const g=this._newStream(u,StreamState.Init,"outbound");return this.numOutboundStreams++,queueMicrotask(()=>{g.sendWindowUpdate()}),g}async ping(u){if(this.remoteGoAway!==void 0)throw new MuxerClosedError("Muxer closed remotely");if(this.localGoAway!==void 0)throw new MuxerClosedError("Muxer closed locally");if(this.activePing!=null)return raceSignal$2(this.activePing.promise,u?.signal);this.activePing=Object.assign(Promise.withResolvers(),{id:this.nextPingID++,start:Date.now()}),this.sendPing(this.activePing.id);try{this.rtt=await raceSignal$2(this.activePing.promise,u?.signal)}finally{this.activePing=void 0}return this.rtt}getRTT(){return this.rtt}async close(u={}){if(this.status==="open")try{const g=u?.reason??GoAwayCode.NormalTermination;this.log.trace("muxer close reason=%s",GoAwayCode[g]),await super.close(u),this.sendGoAway(g)}finally{this.keepAlive?.stop()}}abort(u){if(this.status==="open")try{super.abort(u);let g=GoAwayCode.InternalError;isProtocolError(u)&&(g=u.reason),this.log.error("muxer abort reason=%s error=%s",g,u),this.sendGoAway(g)}finally{this.keepAlive?.stop()}}onTransportClosed(){try{super.onTransportClosed()}finally{this.keepAlive?.stop()}}_newStream(u,g,v){if(this.streams.find(w=>w.streamId===u)!=null)throw new InvalidParametersError$1("Stream already exists with that id");const b=new YamuxStream({...this.streamOptions,id:`${u}`,streamId:u,state:g,direction:v,sendFrame:this.sendFrame.bind(this),log:this.log.newScope(`${v}:${u}`),getRTT:this.getRTT.bind(this)});return b.addEventListener("close",()=>{this.closeStream(u)},{once:!0}),b}closeStream(u){this.client===(u%2===0)?this.numInboundStreams--:this.numOutboundStreams--}handleFrame(u){const{streamID:g,type:v,length:b}=u.header;if(this.log.trace("received frame %o",debugFrame(u.header)),g===0)switch(v){case FrameType.Ping:{this.handlePing(u.header);return}case FrameType.GoAway:{this.handleGoAway(b);return}default:throw new InvalidFrameError("Invalid frame type")}else switch(u.header.type){case FrameType.Data:case FrameType.WindowUpdate:{this.handleStreamMessage(u);return}default:throw new InvalidFrameError("Invalid frame type")}}handlePing(u){if(u.flag===Flag.SYN)this.log.trace("received ping request pingId=%s",u.length),this.sendPing(u.length,Flag.ACK);else if(u.flag===Flag.ACK)this.log.trace("received ping response pingId=%s",u.length),this.handlePingResponse(u.length);else throw new InvalidFrameError("Invalid frame flag")}handlePingResponse(u){if(this.activePing===void 0)throw new UnRequestedPingError("ping not requested");if(this.activePing.id!==u)throw new NotMatchingPingError("ping doesn't match our id");this.activePing.resolve(Date.now()-this.activePing.start)}handleGoAway(u){this.log.trace("received GoAway reason=%s",GoAwayCode[u]??"unknown"),this.remoteGoAway=u,u===GoAwayCode.NormalTermination?this.onTransportClosed():this.abort(new Error("Remote sent GoAway"))}handleStreamMessage(u){const{streamID:g,flag:v,type:b}=u.header;(v&Flag.SYN)===Flag.SYN&&this.incomingStream(g);const w=this.streams.find(E=>E.streamId===g);if(w===void 0){this.log.trace("frame for missing stream id=%s",g);return}switch(b){case FrameType.WindowUpdate:{w.handleWindowUpdate(u);return}case FrameType.Data:{w.handleData(u);return}default:throw new Error("unreachable")}}incomingStream(u){if(this.client!==(u%2===0))throw new InvalidParametersError$1("Both endpoints are clients");if(this.streams.find(v=>v.streamId===u))return;if(this.log.trace("new incoming stream id=%s",u),this.localGoAway!==void 0){this.sendFrame({type:FrameType.WindowUpdate,flag:Flag.RST,streamID:u,length:0});return}if(this.numInboundStreams>=this.maxInboundStreams){this.log("maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:FrameType.WindowUpdate,flag:Flag.RST,streamID:u,length:0});return}const g=this._newStream(u,StreamState.SYNReceived,"inbound");this.numInboundStreams++,this.onRemoteStream(g)}sendFrame(u,g){let v;if(u.type===FrameType.Data){if(g==null)throw new InvalidFrameError("Invalid frame");v=new Uint8ArrayList(encodeHeader(u),g)}else v=encodeHeader(u);return this.log.trace("sending frame %o",debugFrame(u)),this.send(v)}sendPing(u,g=Flag.SYN){g===Flag.SYN?this.log.trace("sending ping request pingId=%s",u):this.log.trace("sending ping response pingId=%s",u),this.sendFrame({type:FrameType.Ping,flag:g,streamID:0,length:u})}sendGoAway(u=GoAwayCode.NormalTermination){this.log("sending GoAway reason=%s",GoAwayCode[u]),this.localGoAway=u,this.sendFrame({type:FrameType.GoAway,flag:0,streamID:0,length:u})}}function yamux(y={}){return()=>new Yamux(y)}const PROTOCOL_PREFIX$1="libp2p",PROTOCOL_NAME$1="autonat",PROTOCOL_VERSION$1="1.0.0",TIMEOUT$1=3e4,MAX_INBOUND_STREAMS$1=2,MAX_OUTBOUND_STREAMS$1=20,DEFAULT_CONNECTION_THRESHOLD=80,MAX_MESSAGE_SIZE$2=8192;var Message$3;(function(y){(function(b){b.DIAL="DIAL",b.DIAL_RESPONSE="DIAL_RESPONSE"})(y.MessageType||(y.MessageType={}));let u;(function(b){b[b.DIAL=0]="DIAL",b[b.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(u||(u={})),(function(b){b.codec=()=>enumeration(u)})(y.MessageType||(y.MessageType={})),(function(b){b.OK="OK",b.E_DIAL_ERROR="E_DIAL_ERROR",b.E_DIAL_REFUSED="E_DIAL_REFUSED",b.E_BAD_REQUEST="E_BAD_REQUEST",b.E_INTERNAL_ERROR="E_INTERNAL_ERROR"})(y.ResponseStatus||(y.ResponseStatus={}));let g;(function(b){b[b.OK=0]="OK",b[b.E_DIAL_ERROR=100]="E_DIAL_ERROR",b[b.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",b[b.E_BAD_REQUEST=200]="E_BAD_REQUEST",b[b.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(g||(g={})),(function(b){b.codec=()=>enumeration(g)})(y.ResponseStatus||(y.ResponseStatus={})),(function(b){let w;b.codec=()=>(w==null&&(w=message((E,S,A={})=>{if(A.lengthDelimited!==!1&&S.fork(),E.id!=null&&(S.uint32(10),S.bytes(E.id)),E.addrs!=null)for(const $ of E.addrs)S.uint32(18),S.bytes($);A.lengthDelimited!==!1&&S.ldelim()},(E,S,A={})=>{const $={addrs:[]},R=S==null?E.len:E.pos+S;for(;E.pos<R;){const T=E.uint32();switch(T>>>3){case 1:{$.id=E.bytes();break}case 2:{if(A.limits?.addrs!=null&&$.addrs.length===A.limits.addrs)throw new MaxLengthError('Decode error - map field "addrs" had too many elements');$.addrs.push(E.bytes());break}default:{E.skipType(T&7);break}}}return $})),w),b.encode=E=>encodeMessage$1(E,b.codec()),b.decode=(E,S)=>decodeMessage$1(E,b.codec(),S)})(y.PeerInfo||(y.PeerInfo={})),(function(b){let w;b.codec=()=>(w==null&&(w=message((E,S,A={})=>{A.lengthDelimited!==!1&&S.fork(),E.peer!=null&&(S.uint32(10),y.PeerInfo.codec().encode(E.peer,S)),A.lengthDelimited!==!1&&S.ldelim()},(E,S,A={})=>{const $={},R=S==null?E.len:E.pos+S;for(;E.pos<R;){const T=E.uint32();switch(T>>>3){case 1:{$.peer=y.PeerInfo.codec().decode(E,E.uint32(),{limits:A.limits?.peer});break}default:{E.skipType(T&7);break}}}return $})),w),b.encode=E=>encodeMessage$1(E,b.codec()),b.decode=(E,S)=>decodeMessage$1(E,b.codec(),S)})(y.Dial||(y.Dial={})),(function(b){let w;b.codec=()=>(w==null&&(w=message((E,S,A={})=>{A.lengthDelimited!==!1&&S.fork(),E.status!=null&&(S.uint32(8),y.ResponseStatus.codec().encode(E.status,S)),E.statusText!=null&&(S.uint32(18),S.string(E.statusText)),E.addr!=null&&(S.uint32(26),S.bytes(E.addr)),A.lengthDelimited!==!1&&S.ldelim()},(E,S,A={})=>{const $={},R=S==null?E.len:E.pos+S;for(;E.pos<R;){const T=E.uint32();switch(T>>>3){case 1:{$.status=y.ResponseStatus.codec().decode(E);break}case 2:{$.statusText=E.string();break}case 3:{$.addr=E.bytes();break}default:{E.skipType(T&7);break}}}return $})),w),b.encode=E=>encodeMessage$1(E,b.codec()),b.decode=(E,S)=>decodeMessage$1(E,b.codec(),S)})(y.DialResponse||(y.DialResponse={}));let v;y.codec=()=>(v==null&&(v=message((b,w,E={})=>{E.lengthDelimited!==!1&&w.fork(),b.type!=null&&(w.uint32(8),y.MessageType.codec().encode(b.type,w)),b.dial!=null&&(w.uint32(18),y.Dial.codec().encode(b.dial,w)),b.dialResponse!=null&&(w.uint32(26),y.DialResponse.codec().encode(b.dialResponse,w)),E.lengthDelimited!==!1&&w.ldelim()},(b,w,E={})=>{const S={},A=w==null?b.len:b.pos+w;for(;b.pos<A;){const $=b.uint32();switch($>>>3){case 1:{S.type=y.MessageType.codec().decode(b);break}case 2:{S.dial=y.Dial.codec().decode(b,b.uint32(),{limits:E.limits?.dial});break}case 3:{S.dialResponse=y.DialResponse.codec().decode(b,b.uint32(),{limits:E.limits?.dialResponse});break}default:{b.skipType($&7);break}}}return S})),v),y.encode=b=>encodeMessage$1(b,y.codec()),y.decode=(b,w)=>decodeMessage$1(b,y.codec(),w)})(Message$3||(Message$3={}));const REQUIRED_SUCCESSFUL_DIALS=4,REQUIRED_FAILED_DIALS=8;class AutoNATService{components;protocol;timeout;maxInboundStreams;maxOutboundStreams;maxMessageSize;started;log;topologyId;dialResults;findPeers;addressFilter;connectionThreshold;constructor(u,g){this.components=u,this.log=u.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${g.protocolPrefix??PROTOCOL_PREFIX$1}/${PROTOCOL_NAME$1}/${PROTOCOL_VERSION$1}`,this.timeout=g.timeout??TIMEOUT$1,this.maxInboundStreams=g.maxInboundStreams??MAX_INBOUND_STREAMS$1,this.maxOutboundStreams=g.maxOutboundStreams??MAX_OUTBOUND_STREAMS$1,this.connectionThreshold=g.connectionThreshold??DEFAULT_CONNECTION_THRESHOLD,this.maxMessageSize=g.maxMessageSize??MAX_MESSAGE_SIZE$2,this.dialResults=trackedMap({name:"libp2p_autonat_dial_results",metrics:u.metrics}),this.findPeers=repeatingTask(this.findRandomPeers.bind(this),6e4),this.addressFilter=createScalableCuckooFilter(1024)}[Symbol.toStringTag]="@libp2p/autonat";[serviceCapabilities]=["@libp2p/autonat"];get[serviceDependencies](){return["@libp2p/identify"]}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,(u,g)=>{this.handleIncomingAutonatStream(u,g).catch(v=>{this.log.error("error handling incoming autonat stream - %e",v)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=await this.components.registrar.register(this.protocol,{onConnect:(u,g)=>{this.verifyExternalAddresses(g).catch(v=>{this.log.error("could not verify addresses - %e",v)})}}),this.findPeers.start(),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),this.topologyId!=null&&await this.components.registrar.unhandle(this.topologyId),this.dialResults.clear(),this.findPeers.stop(),this.started=!1}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(u=>u.expires>Date.now()?!0:u.verified)}async findRandomPeers(u){if(this.allAddressesAreVerified())return;const g=anySignal([AbortSignal.timeout(1e4),u?.signal]);try{this.log("starting random walk to find peers to run AutoNAT");for await(const v of this.components.randomWalk.walk({signal:g})){if(!await this.components.connectionManager.isDialable(v.multiaddrs)){this.log.trace("random peer %p was not dialable %s",v.id,v.multiaddrs.map(b=>b.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",v.id),await this.components.connectionManager.openConnection(v.multiaddrs,{signal:g})}catch{}if(this.allAddressesAreVerified()){this.log("stopping random walk, all addresses are verified");return}if(!this.hasConnectionCapacity()){this.log("stopping random walk, too close to max connections");return}}}catch{}}async handleIncomingAutonatStream(u,g){const v=AbortSignal.timeout(this.timeout);try{const b=pbStream(u,{maxDataLength:this.maxMessageSize}).pb(Message$3),w=await b.read({signal:v}),E=await this.handleAutonatMessage(w,g,{signal:v});await b.write(E,{signal:v}),await u.close({signal:v})}catch(b){this.log.error("error handling incoming autonat stream - %e",b),u.abort(b)}}async handleAutonatMessage(u,g,v){const b=this.components.addressManager.getAddresses().map(T=>getNetConfig(T).host),w=u.dial;if(w==null)return this.log.error("dial was missing from message"),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let E;const S=w.peer;if(S?.id==null)return this.log.error("peerId missing from message"),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{const T=decode$8(S.id);E=peerIdFromMultihash(T)}catch(T){return this.log.error("invalid PeerId - %e",T),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",E),!g.remotePeer.equals(E))return this.log("target peer %p did not equal sending peer %p",E,g.remotePeer),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};const A=S.addrs.map(T=>multiaddr(T)).filter(T=>{try{const O=getNetConfig(T);return isPrivate(T)?!1:O.host!==getNetConfig(g.remoteAddr).host?(this.log.trace("not dialing %a - target host did not match remote host %a",T,g.remoteAddr),!1):b.includes(O.host)?!1:this.components.transportManager.dialTransportForMultiaddr(T)==null?(this.log.trace("not dialing %a - transport unsupported",T),!1):!0}catch{return!1}}).map(T=>(T.getComponents().find(O=>O.code===CODE_P2P)?.value==null&&(T=T.encapsulate(`/p2p/${E.toString()}`)),T));if(A.length===0)return this.log("refused to dial all multiaddrs for %p from message",E),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",A.map(T=>T.toString()).join(", "),E);let $="",R=A[0];for(const T of A){let O;R=T;try{if(O=await this.components.connectionManager.openConnection(T,v),!O.remoteAddr.equals(T))throw this.log.error("tried to dial %a but dialed %a",T,O.remoteAddr),new Error("Unexpected remote address");return this.log("successfully dialed %p via %a",E,T),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.OK,addr:O.remoteAddr.decapsulateCode(CODE_P2P).bytes}}}catch(B){this.log.error("could not dial %p - %e",E,B),$=B.message}finally{O!=null&&await O.close()}}return{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_DIAL_ERROR,statusText:$,addr:R.bytes}}}getFirstUnverifiedMultiaddr(u,g){const v=this.components.addressManager.getAddressesWithMetadata().sort((b,w)=>b.type==="observed"&&w.type!=="observed"?1:w.type==="observed"&&b.type!=="observed"?-1:0).filter(b=>!(!(b.expires<Date.now())||getNetConfig(b.multiaddr).type==="ip6"&&(!g||!isGlobalUnicast(b.multiaddr))||isPrivate(b.multiaddr)));for(const b of v){const w=b.multiaddr.toString();let E=this.dialResults.get(w);if(E!=null){if(E.networkSegments.includes(u)){this.log.trace("%a already has a network segment result from %s",E.multiaddr,u);continue}if(E.queue.size>10){this.log.trace("%a already has enough peers queued",E.multiaddr);continue}}if(E==null){const S=b.expires<Date.now();if(S&&this.addressFilter.remove?.(w),this.addressFilter.has(w))continue;this.addressFilter.add(w),this.log.trace("creating dial result %s %s",S?"to revalidate":"for",w),E={multiaddr:b.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:peerSet(),queue:new PeerQueue({concurrency:3,maxSize:50}),type:b.type,lastVerified:b.lastVerified},this.dialResults.set(w,E)}return E}}removeOutdatedMultiaddrResults(){const u=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:g})=>g<Date.now()).map(({multiaddr:g})=>g.toString()));for(const g of this.dialResults.keys())u.has(g)||(this.log.trace("remove results for %a",g),this.dialResults.delete(g))}async verifyExternalAddresses(u){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();const v=(await this.components.peerStore.get(u.remotePeer)).addresses.some(({multiaddr:E})=>getNetConfig(E).type==="ip6"),b=this.getNetworkSegment(u.remoteAddr),w=this.getFirstUnverifiedMultiaddr(b,v);if(w==null){this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",u.remotePeer);return}if(!this.hasConnectionCapacity()){w.lastVerified!=null?(this.log("automatically re-verifying %a because we are too close to the connection limit",w.multiaddr),this.confirmAddress(w)):this.log("skipping verifying %a because we are too close to the connection limit",w.multiaddr);return}w.queue.add(async E=>{await this.askPeerToVerify(u,b,E)},{peerId:u.remotePeer,multiaddr:w.multiaddr}).catch(E=>{w?.result==null&&this.log.error("error from %p verifying address %a - %e",u.remotePeer,w?.multiaddr,E)})}async askPeerToVerify(u,g,v){let b=this.dialResults.get(v.multiaddr.toString());if(b==null){this.log("%a was verified while %p was queued",v.multiaddr,u.remotePeer);return}const w=AbortSignal.timeout(this.timeout);this.log.trace("asking %a to verify multiaddr %s",u.remoteAddr,v.multiaddr);const E=await u.newStream(this.protocol,{signal:w});try{const S=pbStream(E).pb(Message$3),[,A]=await Promise.all([S.write({type:Message$3.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[v.multiaddr.bytes]}}},{signal:w}),S.read({signal:w})]);if(A.type!==Message$3.MessageType.DIAL_RESPONSE||A.dialResponse==null){this.log("invalid autonat response from %p - %j",u.remotePeer,A);return}const $=A.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",u.remotePeer,v.multiaddr,$),$!==Message$3.ResponseStatus.OK&&$!==Message$3.ResponseStatus.E_DIAL_ERROR)return;if(b=this.dialResults.get(v.multiaddr.toString()),b==null){this.log.trace("peer reported %a as %s but there is no result object",v.multiaddr,A.dialResponse.status);return}if(b.networkSegments.includes(g)){this.log.trace("%a results included network segment %s",v.multiaddr,g);return}if(b.result!=null){this.log.trace("already resolved result for %a, ignoring response from",v.multiaddr,u.remotePeer);return}if(b.verifyingPeers.has(u.remotePeer)){this.log.trace("peer %p has already verified %a, ignoring response",u.remotePeer,v.multiaddr);return}if(b.verifyingPeers.add(u.remotePeer),b.networkSegments.push(g),$===Message$3.ResponseStatus.OK){if(b.success++,b.type!=="observed"){this.confirmAddress(b);return}}else $===Message$3.ResponseStatus.E_DIAL_ERROR&&b.failure++;this.log("%a success %d failure %d",b.multiaddr,b.success,b.failure),b.success===REQUIRED_SUCCESSFUL_DIALS&&this.confirmAddress(b),b.failure===REQUIRED_FAILED_DIALS&&this.unconfirmAddress(b)}finally{try{await E.close({signal:w})}catch(S){E.abort(S)}}}hasConnectionCapacity(){const g=this.components.connectionManager.getConnections().length,v=this.components.connectionManager.getMaxConnections();return g/v*100<this.connectionThreshold}confirmAddress(u){this.log("%s address %a is externally dialable",u.type,u.multiaddr),this.components.addressManager.confirmObservedAddr(u.multiaddr),this.dialResults.delete(u.multiaddr.toString()),u.result=!0,u.queue.abort()}unconfirmAddress(u){this.log("%s address %a is not externally dialable",u.type,u.multiaddr),this.components.addressManager.removeObservedAddr(u.multiaddr),this.dialResults.delete(u.multiaddr.toString()),u.result=!1,u.queue.abort()}getNetworkSegment(u){const g=getNetConfig(u);switch(g.type){case"ip4":return g.host.split(".")[0].padStart(3,"0");case"ip6":return g.host.split(":")[0].padStart(4,"0");default:throw new InvalidParametersError$1(`Remote address ${u} was not an IPv4 or Ipv6 address`)}}}function autoNAT(y={}){return u=>new AutoNATService(u,y)}const DEFAULT_BOOTSTRAP_TAG_NAME="bootstrap",DEFAULT_BOOTSTRAP_TAG_VALUE=50,DEFAULT_BOOTSTRAP_DISCOVERY_TIMEOUT=1e3;class Bootstrap extends TypedEventEmitter{static tag="bootstrap";log;timer;list;timeout;components;_init;constructor(u,g={list:[]}){if(g.list==null||g.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=u,this.log=u.logger.forComponent("libp2p:bootstrap"),this.timeout=g.timeout??DEFAULT_BOOTSTRAP_DISCOVERY_TIMEOUT,this.list=g.list.map(v=>multiaddr(v)).filter(v=>P2P.matches(v)?v.getComponents().findLast(w=>w.code===CODE_P2P)?.value==null?(this.log.error("invalid bootstrap multiaddr without peer id"),!1):!0:(this.log.error("invalid multiaddr %a",v),!1)).map(v=>({id:peerIdFromString$1(v.getComponents().findLast(b=>b.code===CODE_P2P)?.value??""),multiaddrs:[v]})),this._init=g}[peerDiscoverySymbol]=this;[Symbol.toStringTag]="@libp2p/bootstrap";[serviceCapabilities]=["@libp2p/peer-discovery"];isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(u=>{this.log.error("failed to discover bootstrap peers - %e",u)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const u of this.list){if(await this.components.peerStore.merge(u.id,{tags:{[this._init.tagName??DEFAULT_BOOTSTRAP_TAG_NAME]:{value:this._init.tagValue??DEFAULT_BOOTSTRAP_TAG_VALUE,ttl:this._init.tagTTL}},multiaddrs:u.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:u}),this.components.connectionManager.openConnection(u.id).catch(g=>{this.log.error("could not dial bootstrap peer %p - %e",u.id,g)})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}function bootstrap(y){return u=>new Bootstrap(u,y)}const DEFAULT_RESERVATION_CONCURRENCY=1,DEFAULT_RESERVATION_COMPLETION_TIMEOUT=5e3,DEFAULT_MAX_RESERVATION_QUEUE_LENGTH=100,KEEP_ALIVE_TAG$1=`${KEEP_ALIVE}-circuit-relay`;BigInt(1<<17);const RELAY_V2_HOP_CODEC="/libp2p/circuit/relay/0.2.0/hop",RELAY_V2_STOP_CODEC="/libp2p/circuit/relay/0.2.0/stop",MAX_CONNECTIONS=300,DEFAULT_DISCOVERY_FILTER_SIZE=4096,DEFAULT_DISCOVERY_FILTER_ERROR_RATE=.001;var HopMessage;(function(y){(function(v){v.RESERVE="RESERVE",v.CONNECT="CONNECT",v.STATUS="STATUS"})(y.Type||(y.Type={}));let u;(function(v){v[v.RESERVE=0]="RESERVE",v[v.CONNECT=1]="CONNECT",v[v.STATUS=2]="STATUS"})(u||(u={})),(function(v){v.codec=()=>enumeration(u)})(y.Type||(y.Type={}));let g;y.codec=()=>(g==null&&(g=message((v,b,w={})=>{w.lengthDelimited!==!1&&b.fork(),v.type!=null&&(b.uint32(8),y.Type.codec().encode(v.type,b)),v.peer!=null&&(b.uint32(18),Peer.codec().encode(v.peer,b)),v.reservation!=null&&(b.uint32(26),Reservation.codec().encode(v.reservation,b)),v.limit!=null&&(b.uint32(34),Limit.codec().encode(v.limit,b)),v.status!=null&&(b.uint32(40),Status.codec().encode(v.status,b)),w.lengthDelimited!==!1&&b.ldelim()},(v,b,w={})=>{const E={},S=b==null?v.len:v.pos+b;for(;v.pos<S;){const A=v.uint32();switch(A>>>3){case 1:{E.type=y.Type.codec().decode(v);break}case 2:{E.peer=Peer.codec().decode(v,v.uint32(),{limits:w.limits?.peer});break}case 3:{E.reservation=Reservation.codec().decode(v,v.uint32(),{limits:w.limits?.reservation});break}case 4:{E.limit=Limit.codec().decode(v,v.uint32(),{limits:w.limits?.limit});break}case 5:{E.status=Status.codec().decode(v);break}default:{v.skipType(A&7);break}}}return E})),g),y.encode=v=>encodeMessage$1(v,y.codec()),y.decode=(v,b)=>decodeMessage$1(v,y.codec(),b)})(HopMessage||(HopMessage={}));var StopMessage;(function(y){(function(v){v.CONNECT="CONNECT",v.STATUS="STATUS"})(y.Type||(y.Type={}));let u;(function(v){v[v.CONNECT=0]="CONNECT",v[v.STATUS=1]="STATUS"})(u||(u={})),(function(v){v.codec=()=>enumeration(u)})(y.Type||(y.Type={}));let g;y.codec=()=>(g==null&&(g=message((v,b,w={})=>{w.lengthDelimited!==!1&&b.fork(),v.type!=null&&(b.uint32(8),y.Type.codec().encode(v.type,b)),v.peer!=null&&(b.uint32(18),Peer.codec().encode(v.peer,b)),v.limit!=null&&(b.uint32(26),Limit.codec().encode(v.limit,b)),v.status!=null&&(b.uint32(32),Status.codec().encode(v.status,b)),w.lengthDelimited!==!1&&b.ldelim()},(v,b,w={})=>{const E={},S=b==null?v.len:v.pos+b;for(;v.pos<S;){const A=v.uint32();switch(A>>>3){case 1:{E.type=y.Type.codec().decode(v);break}case 2:{E.peer=Peer.codec().decode(v,v.uint32(),{limits:w.limits?.peer});break}case 3:{E.limit=Limit.codec().decode(v,v.uint32(),{limits:w.limits?.limit});break}case 4:{E.status=Status.codec().decode(v);break}default:{v.skipType(A&7);break}}}return E})),g),y.encode=v=>encodeMessage$1(v,y.codec()),y.decode=(v,b)=>decodeMessage$1(v,y.codec(),b)})(StopMessage||(StopMessage={}));var Peer;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{if(b.lengthDelimited!==!1&&v.fork(),g.id!=null&&g.id.byteLength>0&&(v.uint32(10),v.bytes(g.id)),g.addrs!=null)for(const w of g.addrs)v.uint32(18),v.bytes(w);b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={id:alloc$2(0),addrs:[]},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.id=g.bytes();break}case 2:{if(b.limits?.addrs!=null&&w.addrs.length===b.limits.addrs)throw new MaxLengthError('Decode error - map field "addrs" had too many elements');w.addrs.push(g.bytes());break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Peer||(Peer={}));var Reservation;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{if(b.lengthDelimited!==!1&&v.fork(),g.expire!=null&&g.expire!==0n&&(v.uint32(8),v.uint64(g.expire)),g.addrs!=null)for(const w of g.addrs)v.uint32(18),v.bytes(w);g.voucher!=null&&(v.uint32(26),Envelope.codec().encode(g.voucher,v)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={expire:0n,addrs:[]},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.expire=g.uint64();break}case 2:{if(b.limits?.addrs!=null&&w.addrs.length===b.limits.addrs)throw new MaxLengthError('Decode error - map field "addrs" had too many elements');w.addrs.push(g.bytes());break}case 3:{w.voucher=Envelope.codec().decode(g,g.uint32(),{limits:b.limits?.voucher});break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Reservation||(Reservation={}));var Limit;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.duration!=null&&(v.uint32(8),v.uint32(g.duration)),g.data!=null&&(v.uint32(16),v.uint64(g.data)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.duration=g.uint32();break}case 2:{w.data=g.uint64();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Limit||(Limit={}));var Status;(function(y){y.UNUSED="UNUSED",y.OK="OK",y.RESERVATION_REFUSED="RESERVATION_REFUSED",y.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",y.PERMISSION_DENIED="PERMISSION_DENIED",y.CONNECTION_FAILED="CONNECTION_FAILED",y.NO_RESERVATION="NO_RESERVATION",y.MALFORMED_MESSAGE="MALFORMED_MESSAGE",y.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(Status||(Status={}));var __StatusValues;(function(y){y[y.UNUSED=0]="UNUSED",y[y.OK=100]="OK",y[y.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",y[y.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",y[y.PERMISSION_DENIED=202]="PERMISSION_DENIED",y[y.CONNECTION_FAILED=203]="CONNECTION_FAILED",y[y.NO_RESERVATION=204]="NO_RESERVATION",y[y.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",y[y.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(__StatusValues||(__StatusValues={}));(function(y){y.codec=()=>enumeration(__StatusValues)})(Status||(Status={}));var ReservationVoucher;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.relay!=null&&g.relay.byteLength>0&&(v.uint32(10),v.bytes(g.relay)),g.peer!=null&&g.peer.byteLength>0&&(v.uint32(18),v.bytes(g.peer)),g.expiration!=null&&g.expiration!==0n&&(v.uint32(24),v.uint64(g.expiration)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={relay:alloc$2(0),peer:alloc$2(0),expiration:0n},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.relay=g.bytes();break}case 2:{w.peer=g.bytes();break}case 3:{w.expiration=g.uint64();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(ReservationVoucher||(ReservationVoucher={}));var Envelope;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.publicKey!=null&&g.publicKey.byteLength>0&&(v.uint32(10),v.bytes(g.publicKey)),g.payloadType!=null&&g.payloadType.byteLength>0&&(v.uint32(18),v.bytes(g.payloadType)),g.payload!=null&&(v.uint32(26),ReservationVoucher.codec().encode(g.payload,v)),g.signature!=null&&g.signature.byteLength>0&&(v.uint32(42),v.bytes(g.signature)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={publicKey:alloc$2(0),payloadType:alloc$2(0),signature:alloc$2(0)},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.publicKey=g.bytes();break}case 2:{w.payloadType=g.bytes();break}case 3:{w.payload=ReservationVoucher.codec().decode(g,g.uint32(),{limits:b.limits?.payload});break}case 5:{w.signature=g.bytes();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Envelope||(Envelope={}));class HadEnoughRelaysError extends Error{static name="HadEnoughRelaysError";name="HadEnoughRelaysError"}class DoubleRelayError extends Error{static name="DoubleRelayError";name="DoubleRelayError"}class RelayQueueFullError extends Error{static name="RelayQueueFullError";name="RelayQueueFullError"}function getExpirationMilliseconds(y){const u=y*BigInt(1e3),g=new Date().getTime();return Number(u-BigInt(g))}class LimitTracker{expires;bytes;constructor(u){u?.duration!=null&&u?.duration!==0&&(this.expires=Date.now()+u.duration*1e3),this.bytes=u?.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(u){this.bytes!=null&&(this.bytes-=BigInt(u.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;const u={};if(this.bytes!=null){const g=this;Object.defineProperty(u,"bytes",{get(){return g.bytes}})}if(this.expires!=null){const g=this;Object.defineProperty(u,"seconds",{get(){return Math.round(((g.expires??0)-Date.now())/1e3)}})}return u}}const CircuitListen=fmt(and(P2P.matchers[0],code(CODE_P2P_CIRCUIT))),CircuitSearch=fmt(code(CODE_P2P_CIRCUIT));class RelayDiscovery extends TypedEventEmitter{components;started;running;topologyId;log;discoveryController;filter;queue;constructor(u,g={}){super(),this.log=u.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.components=u,this.started=!1,this.running=!1,this.filter=g.filter,this.discoveryController=new AbortController,this.discoveryController.signal,this.dialPeer=this.dialPeer.bind(this),this.onPeer=this.onPeer.bind(this)}isStarted(){return this.started}async start(){this.topologyId=await this.components.registrar.register(RELAY_V2_HOP_CODEC,{filter:this.filter,onConnect:u=>{this.log.trace("discovered relay %p queue (length: %d, active %d)",u,this.queue?.size,this.queue?.running),this.safeDispatchEvent("relay:discover",{detail:u})}}),this.started=!0}stop(){this.topologyId!=null&&this.components.registrar.unregister(this.topologyId),this.running&&this.stopDiscovery(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,this.components.events.addEventListener("peer:discovery",this.onPeer),Promise.resolve().then(async()=>{this.log("searching peer store for relays");const u=await this.components.peerStore.all({filters:[v=>v.protocols.includes(RELAY_V2_HOP_CODEC)],orders:[()=>Math.random()<.5?1:-1,(v,b)=>{const w=getLastDial(v),E=getLastDial(b);return w>E?-1:E>w?1:0}]});for(const v of u)this.log.trace("found relay peer %p in peer store",v.id),this.safeDispatchEvent("relay:discover",{detail:v.id});this.log("found %d relay peers in peer store",u.length);const g=this.queue=new PeerQueue({concurrency:5});this.log("start random walk");for await(const v of this.components.randomWalk.walk({signal:this.discoveryController.signal})){if(this.log.trace("found random peer %p",v.id),g.has(v.id)){this.log.trace("random peer %p was already in queue",v.id);continue}if(this.components.connectionManager.getConnections(v.id)?.length>0){this.log.trace("random peer %p was already connected",v.id);continue}if(!await this.components.connectionManager.isDialable(v.multiaddrs)){this.log.trace("random peer %p was not dialable",v.id,v.multiaddrs.map(b=>b.toString()));continue}g.queued>10&&(this.log.trace("wait for space in queue for %p",v.id),await g.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",v.id,g.size,g.running),g.add(this.dialPeer,{peerId:v.id,signal:this.discoveryController.signal}).catch(b=>{this.log.error("error opening connection to random peer %p - %e",v.id,b)})}this.log("stop random walk"),await g.onIdle()}).catch(u=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network - %e",u)}))}stopDiscovery(){this.log("stop discovery"),this.running=!1,this.discoveryController?.abort(),this.queue?.clear(),this.components.events.removeEventListener("peer:discovery",this.onPeer)}onPeer(u){this.log.trace("maybe dialing discovered peer %p",u.detail.id),this.maybeDialPeer(u).catch(g=>{this.log.trace("error dialing discovered peer %p - %e",u.detail.id,g)})}async maybeDialPeer(u){if(this.queue==null)return;const g=u.detail.id,v=u.detail.multiaddrs;if(this.queue.has(g)){this.log.trace("random peer %p was already in queue",g);return}if(this.components.connectionManager.getConnections(g)?.length>0){this.log.trace("random peer %p was already connected",g);return}if(!await this.components.connectionManager.isDialable(v)){this.log.trace("random peer %p was not dialable",g);return}this.queue?.add(this.dialPeer,{peerId:u.detail.id,signal:this.discoveryController.signal}).catch(b=>{this.log.error("error opening connection to discovered peer %p - %e",u.detail.id,b)})}async dialPeer({peerId:u,signal:g}){const v=anySignal([AbortSignal.timeout(5e3),g]);try{await this.components.connectionManager.openConnection(u,{signal:v})}finally{v.clear()}}}function getLastDial(y){const u=y.metadata.get("last-dial-success");return u==null?0:new Date(toString$3(u)).getTime()}class CircuitRelayTransportListener extends TypedEventEmitter{connectionManager;addressManager;reservationStore;listeningAddrs;log;listenTimeout;reservationId;relay;constructor(u,g={}){super(),this.log=u.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=u.connectionManager,this.addressManager=u.addressManager,this.reservationStore=u.reservationStore,this.listeningAddrs=[],this.listenTimeout=g.listenTimeout??DEFAULT_RESERVATION_COMPLETION_TIMEOUT,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}_onRemoveRelayPeer=u=>{this.log("relay removed %p our relay %p",u.detail.relay,this.relay,this.relay?.equals(u.detail.relay)),this.relay?.equals(u.detail.relay)===!0&&(this.log("relay peer removed %p",u.detail.relay),this.listeningAddrs.forEach(g=>{this.addressManager.removeObservedAddr(g)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))};_onAddRelayPeer=u=>{const{details:g}=u.detail;g.type!=="configured"&&g.id===this.reservationId&&this.addedRelay(u.detail)};async listen(u){if(CircuitSearch.exactMatch(u))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(CircuitListen.exactMatch(u)){this.log("listen on specific relay server %a",u);const g=AbortSignal.timeout(this.listenTimeout),v=u.decapsulate("/p2p-circuit"),b=await this.connectionManager.openConnection(v,{signal:g});if(!this.reservationStore.hasReservation(b.remotePeer)){this.log("making reservation on peer %p",b.remotePeer);const w=await this.reservationStore.addRelay(b.remotePeer,"configured");this.addedRelay(w)}}else throw new ListenError(`Could not listen on p2p-circuit address "${u}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(u){this.log("relay peer added %p",u.relay),this.relay=u.relay,this.listeningAddrs=u.details.reservation.addrs.map(g=>multiaddr(g).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(g=>{this.addressManager.confirmObservedAddr(g,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function createListener$1(y){return new CircuitRelayTransportListener(y)}const urlAlphabet$2="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let nanoid$4=(y=21)=>{let u="",g=crypto.getRandomValues(new Uint8Array(y|=0));for(;y--;)u+=urlAlphabet$2[g[y]&63];return u};const REFRESH_WINDOW=60*1e3*10,REFRESH_TIMEOUT=60*1e3*5,REFRESH_TIMEOUT_MIN=30*1e3;class ReservationStore extends TypedEventEmitter{peerId;connectionManager;peerStore;events;reserveQueue;reservations;pendingReservations;maxReservationQueueLength;reservationCompletionTimeout;started;log;relayFilter;constructor(u,g){super(),this.log=u.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=u.peerId,this.connectionManager=u.connectionManager,this.peerStore=u.peerStore,this.events=u.events,this.reservations=new PeerMap,this.pendingReservations=[],this.maxReservationQueueLength=g?.maxReservationQueueLength??DEFAULT_MAX_RESERVATION_QUEUE_LENGTH,this.reservationCompletionTimeout=g?.reservationCompletionTimeout??DEFAULT_RESERVATION_COMPLETION_TIMEOUT,this.started=!1,this.relayFilter=createScalableCuckooFilter(100),this.reserveQueue=new PeerQueue({concurrency:g?.reservationConcurrency??DEFAULT_RESERVATION_CONCURRENCY,metricName:"libp2p_relay_reservation_queue",metrics:u.metrics}),this.events.addEventListener("connection:close",v=>{[...this.reservations.values()].find(w=>w.connection===v.detail.id)!=null&&this.#t(v.detail.remotePeer).catch(w=>{this.log("could not remove relay %p - %e",v.detail,w)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{const u=await this.peerStore.all({filters:[g=>g.tags.has(KEEP_ALIVE_TAG$1)]});this.log("removing tag from %d old relays",u.length),await Promise.all(u.map(async g=>{await this.peerStore.merge(g.id,{tags:{[KEEP_ALIVE_TAG$1]:void 0}})})),this.log("redialing %d old relays",u.length),await Promise.all(u.map(async g=>this.addRelay(g.id,"discovered"))),this.#r()}).catch(u=>{this.log.error("failed to clean up and redial old relays during afterStart - %e",u)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:u})=>{clearTimeout(u)}),this.reservations.clear(),this.started=!1}reserveRelay(){const u=nanoid$4();return this.pendingReservations.push(u),this.#r(),u}async addRelay(u,g){if(this.peerId.equals(u))throw this.log.trace("not trying to use self as relay"),new ListenError("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new RelayQueueFullError("The reservation queue is full");const v=this.reserveQueue.find(u);if(v!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",u),v.join();if(this.relayFilter.has(u.toMultihash().bytes))throw new ListenError("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",u),this.reserveQueue.add(async()=>{const b=Date.now();try{const w=this.reservations.get(u);if(w!=null){const F=this.connectionManager.getConnections(u);let U=!1;if(F.length===0&&this.log("already have relay reservation with %p but we are no longer connected",u),F.map(q=>q.id).includes(w.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",u),U=!0),U&&getExpirationMilliseconds(w.reservation.expire)>REFRESH_WINDOW)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",u),{relay:u,details:w};await this.#t(u)}if(g==="discovered"&&this.pendingReservations.length===0)throw new HadEnoughRelaysError("Not making reservation on discovered relay because we do not need any more relays");const E=AbortSignal.timeout(this.reservationCompletionTimeout);const S=await this.connectionManager.openConnection(u,{signal:E});if(Circuit$1.matches(S.remoteAddr))throw new DoubleRelayError("not creating reservation over relayed connection");const A=await this.#e(S,{signal:E}),$=getExpirationMilliseconds(A.expire);this.log("created reservation on relay peer %p, expiry date is %s",u,new Date(Date.now()+$).toString());const R=Math.min(Math.max($-REFRESH_TIMEOUT,REFRESH_TIMEOUT_MIN),Math.pow(2,31)-1),T=setTimeout(()=>{this.log("refresh reservation to relay %p",u),this.addRelay(u,g).catch(async F=>{this.log.error("could not refresh reservation to relay %p - %e",u,F),await this.#t(u)}).catch(F=>{this.log.error("could not remove expired reservation to relay %p - %e",u,F)})},R);let O;if(g==="discovered"){const F=this.pendingReservations.pop();if(F==null)throw new HadEnoughRelaysError("Made reservation on relay but did not need any more discovered relays");O={timeout:T,reservation:A,type:g,connection:S.id,id:F}}else O={timeout:T,reservation:A,type:g,connection:S.id};this.reservations.set(u,O),await this.peerStore.merge(u,{tags:{[KEEP_ALIVE_TAG$1]:{value:1,ttl:$}}}),this.#r();const B={relay:u,details:O};return this.safeDispatchEvent("relay:created-reservation",{detail:B}),B}catch(w){throw g==="discovered"&&w.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",u,Date.now()-b,w),(w.name==="DialError"||w.name==="UnsupportedProtocolError")&&this.relayFilter.add(u.toMultihash().bytes),this.#t(u).catch(E=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",u,E)}),w}},{peerId:u})}hasReservation(u){return this.reservations.has(u)}getReservation(u){return this.reservations.get(u)?.reservation}reservationCount(u){return u==null?this.reservations.size:[...this.reservations.values()].reduce((g,v)=>(v.type===u&&g++,g),0)}cancelReservations(){[...this.reservations.values()].forEach(u=>{clearTimeout(u.timeout)}),this.reservations.clear()}async#e(u,g){g.signal?.throwIfAborted(),this.log("requesting reservation from %p",u.remotePeer);const v=await u.newStream(RELAY_V2_HOP_CODEC,g),w=pbStream(v).pb(HopMessage);this.log.trace("send RESERVE to %p",u.remotePeer),await w.write({type:HopMessage.Type.RESERVE},g);let E;try{this.log.trace("reading response from %p",u.remotePeer),E=await w.read(g)}catch(A){throw v.abort(A),A}finally{v.status!=="closed"&&await v.close(g)}if(this.log.trace("read response %s",E.status),E.status===Status.OK&&E.reservation!=null){const A=new Set;A.add(u.remoteAddr.toString());for(const $ of E.reservation.addrs){let R=multiaddr($);R.getComponents().find(T=>T.code===CODE_P2P)==null&&(R=R.encapsulate(`/p2p/${u.remotePeer}`)),R=multiaddr(R.toString().replace(`/p2p/${u.remotePeer}/p2p/${u.remotePeer}`,`/p2p/${u.remotePeer}`)),A.add(R.toString())}return E.reservation.addrs=[...A].map($=>multiaddr($).bytes),E.reservation}const S=`reservation failed with status ${E.status??"undefined"}`;throw this.log.error(S),new Error(S)}async#t(u){const g=this.reservations.get(u);g!=null&&(this.log("removing relay reservation with %p from local store",u),clearTimeout(g.timeout),this.reservations.delete(u),g.type==="discovered"&&this.pendingReservations.push(g.id),await this.peerStore.merge(u,{tags:{[KEEP_ALIVE_TAG$1]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:u,details:g}}),this.#r())}#r(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=createScalableCuckooFilter(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")}}class StreamMultiaddrConnection extends AbstractMultiaddrConnection{stream;init;constructor(u){super({...u,direction:u.stream.direction}),this.init=u,this.stream=u.stream,this.stream.addEventListener("close",g=>{this.onTransportClosed(g.error)}),this.stream.addEventListener("remoteCloseWrite",g=>{this.onRemoteCloseWrite(),this.close().catch(v=>{this.abort(v)})}),this.stream.addEventListener("message",g=>{u.onDataRead?.(g.data),this.onData(g.data)}),this.stream.addEventListener("drain",()=>{this.safeDispatchEvent("drain")})}sendData(u){return this.init.onDataWrite?.(u),{sentBytes:u.byteLength,canSendMore:this.stream.send(u)}}async sendClose(u){await this.stream.close(u)}sendReset(){this.stream.abort(new Error("An error occurred"))}sendPause(){this.stream.pause()}sendResume(){this.stream.resume()}}function streamToMaConnection(y){return new StreamMultiaddrConnection(y)}const isValidStop=y=>{if(y.peer==null)return!1;try{y.peer.addrs.forEach(multiaddr)}catch{return!1}return!0},defaults={maxInboundStopStreams:MAX_CONNECTIONS,maxOutboundStopStreams:MAX_CONNECTIONS};class CircuitRelayTransport{components;discovery;reservationStore;maxInboundStopStreams;maxOutboundStopStreams;started;log;shutdownController;constructor(u,g={}){this.components=u,this.log=u.logger.forComponent("libp2p:circuit-relay:transport"),this.maxInboundStopStreams=g.maxInboundStopStreams??defaults.maxInboundStopStreams,this.maxOutboundStopStreams=g.maxOutboundStopStreams??defaults.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new RelayDiscovery(u,{filter:g.discoveryFilter??peerFilter(DEFAULT_DISCOVERY_FILTER_SIZE,DEFAULT_DISCOVERY_FILTER_ERROR_RATE)}),this.discovery.addEventListener("relay:discover",v=>{this.reservationStore.addRelay(v.detail,"discovered").catch(b=>{b.name!=="HadEnoughRelaysError"&&b.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p - %e",v.detail,b)})}),this.reservationStore=new ReservationStore(u,g),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{this.discovery?.stopDiscovery()}),this.started=!1,this.onStop=this.onStop.bind(this)}[Symbol.toStringTag]="@libp2p/circuit-relay-v2-transport";[serviceCapabilities]=["@libp2p/transport","@libp2p/circuit-relay-v2-transport"];get[serviceDependencies](){return this.discovery!=null?["@libp2p/identify"]:[]}[transportSymbol]=!0;isStarted(){return this.started}async start(){this.shutdownController=new AbortController,this.shutdownController.signal,await this.components.registrar.handle(RELAY_V2_STOP_CODEC,this.onStop,{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await start(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await stop(this.discovery,this.reservationStore),await this.components.registrar.unhandle(RELAY_V2_STOP_CODEC),this.started=!1}async dial(u,g){const v=u.toString().split("/p2p-circuit"),b=multiaddr(v[0]),w=multiaddr(v[v.length-1]),E=b.getComponents().find(B=>B.code===CODE_P2P)?.value,S=w.getComponents().find(B=>B.code===CODE_P2P)?.value;if(E==null||S==null){const B=`ircuit relay dial to ${u.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${B}`),new DialError(`C${B}`)}const A=peerIdFromString$1(E),$=peerIdFromString$1(S);let T=this.components.connectionManager.getConnections(A)[0];T==null?(await this.components.peerStore.merge(A,{multiaddrs:[b]}),g.onProgress?.(new CustomProgressEvent("circuit-relay:open-connection")),T=await this.components.connectionManager.openConnection(A,g)):g.onProgress?.(new CustomProgressEvent("circuit-relay:reuse-connection"));let O;try{g.onProgress?.(new CustomProgressEvent("circuit-relay:open-hop-stream")),O=await T.newStream(RELAY_V2_HOP_CODEC,g);const B=pbStream(O).pb(HopMessage);g.onProgress?.(new CustomProgressEvent("circuit-relay:write-connect-message")),await B.write({type:HopMessage.Type.CONNECT,peer:{id:$.toMultihash().bytes,addrs:[multiaddr(w).bytes]}},g),g.onProgress?.(new CustomProgressEvent("circuit-relay:read-connect-response"));const F=await B.read(g);if(F.status!==Status.OK)throw new InvalidMessageError(`failed to connect via relay with status ${F?.status?.toString()??"undefined"}`);const U=new LimitTracker(F.limit),q=streamToMaConnection({stream:B.unwrap().unwrap(),remoteAddr:u,localAddr:b.encapsulate(`/p2p-circuit/p2p/${this.components.peerId.toString()}`),onDataRead:U.onData,onDataWrite:U.onData,log:O.log.newScope("circuit-relay:connection")}),J=await this.components.upgrader.upgradeOutbound(q,{...g,limits:U.getLimits()});return J.log("outbound relayed connection established to %p with limits %o, over connection %s",J.remotePeer,F.limit??"none",T.id),J}catch(B){throw this.log.error("circuit relay dial to destination %p via relay %p failed - %e",$,A,B),O?.abort(B),B}}createListener(u){return createListener$1({peerId:this.components.peerId,connectionManager:this.components.connectionManager,addressManager:this.components.addressManager,reservationStore:this.reservationStore,logger:this.components.logger})}listenFilter(u){return u=Array.isArray(u)?u:[u],u.filter(g=>CircuitListen.exactMatch(g)||CircuitSearch.exactMatch(g))}dialFilter(u){return u=Array.isArray(u)?u:[u],u.filter(g=>Circuit$1.exactMatch(g))}async onStop(u,g){const v=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);try{if(!this.reservationStore.hasReservation(g.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.components.transportManager.listen([g.remoteAddr.encapsulate("/p2p-circuit")])}catch(T){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on - %e",T)}const b=pbStream(u).pb(StopMessage),w=await b.read({signal:v});if(this.log("new circuit relay v2 stop stream from %p with type %s",g.remotePeer,w.type),w?.type===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",g.remotePeer),await b.write({type:StopMessage.Type.STATUS,status:Status.MALFORMED_MESSAGE},{signal:v}),await u.close({signal:v});return}if(w.type!==StopMessage.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",g.remotePeer),await b.write({type:StopMessage.Type.STATUS,status:Status.UNEXPECTED_MESSAGE},{signal:v}),await u.close({signal:v});return}if(!isValidStop(w)){this.log.error("invalid stop connect request via peer %p",g.remotePeer),await b.write({type:StopMessage.Type.STATUS,status:Status.MALFORMED_MESSAGE},{signal:v}),await u.close({signal:v});return}const E=peerIdFromMultihash(decode$8(w.peer.id));if(await this.components.connectionGater.denyInboundRelayedConnection?.(g.remotePeer,E)===!0){this.log.error("connection gater denied inbound relayed connection from %p",g.remotePeer),await b.write({type:StopMessage.Type.STATUS,status:Status.PERMISSION_DENIED},{signal:v}),await u.close({signal:v});return}this.log.trace("sending success response to %p",g.remotePeer),await b.write({type:StopMessage.Type.STATUS,status:Status.OK},{signal:v});const S=new LimitTracker(w.limit),A=g.remoteAddr.encapsulate(`/p2p-circuit/p2p/${E.toString()}`),$=this.components.addressManager.getAddresses()[0],R=streamToMaConnection({stream:b.unwrap().unwrap(),remoteAddr:A,localAddr:$,onDataRead:S.onData,onDataWrite:S.onData,log:u.log.newScope("circuit-relay:connection")});await this.components.upgrader.upgradeInbound(R,{limits:S.getLimits(),signal:v}),R.log("inbound relayed connection established to %p with limits %o, over connection %s",E,w.limit??"none",g.id)}finally{v?.clear()}}}function circuitRelayTransport(y={}){return u=>new CircuitRelayTransport(u,y)}var HolePunch;(function(y){(function(v){v.UNUSED="UNUSED",v.CONNECT="CONNECT",v.SYNC="SYNC"})(y.Type||(y.Type={}));let u;(function(v){v[v.UNUSED=0]="UNUSED",v[v.CONNECT=100]="CONNECT",v[v.SYNC=300]="SYNC"})(u||(u={})),(function(v){v.codec=()=>enumeration(u)})(y.Type||(y.Type={}));let g;y.codec=()=>(g==null&&(g=message((v,b,w={})=>{if(w.lengthDelimited!==!1&&b.fork(),v.type!=null&&(b.uint32(8),y.Type.codec().encode(v.type,b)),v.observedAddresses!=null)for(const E of v.observedAddresses)b.uint32(18),b.bytes(E);w.lengthDelimited!==!1&&b.ldelim()},(v,b,w={})=>{const E={observedAddresses:[]},S=b==null?v.len:v.pos+b;for(;v.pos<S;){const A=v.uint32();switch(A>>>3){case 1:{E.type=y.Type.codec().decode(v);break}case 2:{if(w.limits?.observedAddresses!=null&&E.observedAddresses.length===w.limits.observedAddresses)throw new MaxLengthError('Decode error - map field "observedAddresses" had too many elements');E.observedAddresses.push(v.bytes());break}default:{v.skipType(A&7);break}}}return E})),g),y.encode=v=>encodeMessage$1(v,y.codec()),y.decode=(v,b)=>decodeMessage$1(v,y.codec(),b)})(HolePunch||(HolePunch={}));function isPublicAndDialable(y,u){return Circuit$1.matches(y)||u.dialTransportForMultiaddr(y)==null?!1:DNS$1.matches(y)?!0:IP$1.matches(y)?!isPrivate(y):!1}const MAX_DCUTR_MESSAGE_SIZE=1024*4,DCUTR_DIAL_PRIORITY=100,defaultValues$1={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1};class DefaultDCUtRService{started;timeout;retries;maxInboundStreams;maxOutboundStreams;peerStore;registrar;connectionManager;addressManager;transportManager;topologyId;log;constructor(u,g){this.log=u.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=u.peerStore,this.registrar=u.registrar,this.addressManager=u.addressManager,this.connectionManager=u.connectionManager,this.transportManager=u.transportManager,this.timeout=g.timeout??defaultValues$1.timeout,this.retries=g.retries??defaultValues$1.retries,this.maxInboundStreams=g.maxInboundStreams??defaultValues$1.maxInboundStreams,this.maxOutboundStreams=g.maxOutboundStreams??defaultValues$1.maxOutboundStreams,this.handleIncomingUpgrade=this.handleIncomingUpgrade.bind(this)}[Symbol.toStringTag]="@libp2p/dcutr";[serviceDependencies]=["@libp2p/identify"];isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(multicodec,{notifyOnLimitedConnection:!0,onConnect:(u,g)=>{Circuit$1.exactMatch(g.remoteAddr)&&g.direction==="inbound"&&this.upgradeInbound(g).catch(v=>{this.log.error("error during outgoing DCUtR attempt - %e",v)})}}),await this.registrar.handle(multicodec,this.handleIncomingUpgrade,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(multicodec),this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(u){if(await this.attemptUnilateralConnectionUpgrade(u))return;let g;for(let v=0;v<this.retries;v++){const b={signal:AbortSignal.timeout(this.timeout)};try{g=await u.newStream([multicodec],{signal:b.signal,runOnLimitedConnection:!0});const w=pbStream(g,{maxDataLength:MAX_DCUTR_MESSAGE_SIZE}).pb(HolePunch);this.log("B sending connect to %p",u.remotePeer);const E=Date.now();await w.write({type:HolePunch.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(T=>T.bytes)},b),this.log("B receiving connect from %p",u.remotePeer);const S=await w.read(b);if(S.type!==HolePunch.Type.CONNECT)throw this.log("A sent wrong message type"),new InvalidMessageError("DCUtR message type was incorrect");const A=this.getDialableMultiaddrs(S.observedAddresses);if(A.length===0)throw this.log("A did not have any dialable multiaddrs"),new InvalidMessageError("DCUtR connect message had no multiaddrs");const $=Date.now()-E;this.log("A sending sync, rtt %dms",$),await w.write({type:HolePunch.Type.SYNC,observedAddresses:[]},b),this.log("A waiting for half RTT"),await delay($/2),this.log("B dialing",A);const R=await this.connectionManager.openConnection(A,{signal:b.signal,priority:DCUTR_DIAL_PRIORITY,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",u.remotePeer,R.remoteAddr),await u.close(b);break}catch(w){if(this.log.error("error while attempting DCUtR on attempt %d of %d - %e",v+1,this.retries,w),g?.abort(w),v===this.retries)throw w}finally{g!=null&&await g.close(b)}}}async attemptUnilateralConnectionUpgrade(u){const v=(await this.peerStore.get(u.remotePeer)).addresses.map(b=>{const w=b.multiaddr;return w.getComponents().find(E=>E.code===CODE_P2P)?.value==null?w.encapsulate(`/p2p/${u.remotePeer}`):w}).filter(b=>isPublicAndDialable(b,this.transportManager));if(v.length>0){const b=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",v);const w=await this.connectionManager.openConnection(v,{signal:b,force:!0});if(Circuit$1.exactMatch(w.remoteAddr))throw new Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",u.remotePeer,w.remoteAddr),await u.close({signal:b}),!0}catch(w){this.log.error("unilateral connection upgrade to %p on addresses %a failed - %e",u.remotePeer,v,w)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",u.remotePeer);return!1}async handleIncomingUpgrade(u,g){const v={signal:AbortSignal.timeout(this.timeout)},b=pbStream(u,{maxDataLength:MAX_DCUTR_MESSAGE_SIZE}).pb(HolePunch);this.log("A receiving connect");const w=await b.read(v);if(w.type!==HolePunch.Type.CONNECT)throw this.log("B sent wrong message type"),new InvalidMessageError("DCUtR message type was incorrect");if(w.observedAddresses.length===0)throw this.log("B sent no multiaddrs"),new InvalidMessageError("DCUtR connect message had no multiaddrs");const E=this.getDialableMultiaddrs(w.observedAddresses);if(E.length===0)throw this.log("B had no dialable multiaddrs in %o",w.observedAddresses.map($=>multiaddr($))),new InvalidMessageError("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),await b.write({type:HolePunch.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map($=>$.bytes)}),this.log("A receiving sync"),(await b.read(v)).type!==HolePunch.Type.SYNC)throw new InvalidMessageError("DCUtR message type was incorrect");this.log("A dialing",E);const A=await this.connectionManager.openConnection(E,{signal:v.signal,priority:DCUTR_DIAL_PRIORITY,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",g.remotePeer,A.remoteAddr),await g.close(v),await u.close(v)}getDialableMultiaddrs(u){const g=[];for(const v of u)if(!(v==null||v.length===0))try{const b=multiaddr(v);if(!isPublicAndDialable(b,this.transportManager))continue;g.push(b)}catch{}return g}}const multicodec="/libp2p/dcutr";function dcutr(y={}){return u=>new DefaultDCUtRService(u,y)}function HTTPParser(y){if(y!==void 0&&y!==HTTPParser.REQUEST&&y!==HTTPParser.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");y===void 0||this.initialize(y),this.maxHeaderSize=HTTPParser.maxHeaderSize}HTTPParser.prototype.initialize=function(y,u){if(y!==HTTPParser.REQUEST&&y!==HTTPParser.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");this.type=y,this.state=y+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1};HTTPParser.encoding="ascii";HTTPParser.maxHeaderSize=80*1024;HTTPParser.REQUEST="REQUEST";HTTPParser.RESPONSE="RESPONSE";var kOnHeaders=HTTPParser.kOnHeaders=1,kOnHeadersComplete=HTTPParser.kOnHeadersComplete=2,kOnBody=HTTPParser.kOnBody=3,kOnMessageComplete=HTTPParser.kOnMessageComplete=4;HTTPParser.prototype[kOnHeaders]=HTTPParser.prototype[kOnHeadersComplete]=HTTPParser.prototype[kOnBody]=HTTPParser.prototype[kOnMessageComplete]=function(){};var compatMode0_12=!0;Object.defineProperty(HTTPParser,"kOnExecute",{get:function(){return compatMode0_12=!1,99}});const methods=HTTPParser.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"];var method_connect=methods.indexOf("CONNECT");HTTPParser.prototype.reinitialize=HTTPParser;HTTPParser.prototype.close=HTTPParser.prototype.pause=HTTPParser.prototype.resume=HTTPParser.prototype.remove=HTTPParser.prototype.free=function(){};HTTPParser.prototype._compatMode0_11=!1;HTTPParser.prototype.getAsyncId=function(){return 0};var headerState={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};HTTPParser.prototype.execute=function(y,u,g){if(!(this instanceof HTTPParser))throw new TypeError("not a HTTPParser");u=u||0,g=typeof g=="number"?g:y.length,this.chunk=y,this.offset=u;var v=this.end=u+g;try{for(;this.offset<v&&!this[this.state](););}catch(b){if(this.isUserCall)throw b;return this.hadError=!0,b}return this.chunk=null,g=this.offset-u,headerState[this.state]&&(this.headerSize+=g,this.headerSize>(this.maxHeaderSize||HTTPParser.maxHeaderSize))?new Error("max header size exceeded"):g};var stateFinishAllowed={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};HTTPParser.prototype.finish=function(){if(!this.hadError){if(!stateFinishAllowed[this.state])return new Error("invalid state for EOF");this.state==="BODY_RAW"&&this.userCall()(this[kOnMessageComplete]())}};HTTPParser.prototype.consume=HTTPParser.prototype.unconsume=HTTPParser.prototype.getCurrentBuffer=function(){};HTTPParser.prototype.userCall=function(){this.isUserCall=!0;var y=this;return function(u){return y.isUserCall=!1,u}};HTTPParser.prototype.nextRequest=function(){this.userCall()(this[kOnMessageComplete]()),this.reinitialize(this.type)};HTTPParser.prototype.consumeLine=function(){for(var y=this.end,u=this.chunk,g=this.offset;g<y;g++)if(u[g]===10){var v=this.line+toString$3(u.subarray(this.offset,g),HTTPParser.encoding);return v.charAt(v.length-1)==="\r"&&(v=v.substr(0,v.length-1)),this.line="",this.offset=g+1,v}this.line+=toString$3(u.subarray(this.offset,this.end),HTTPParser.encoding),this.offset=this.end};var headerExp=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,headerContinueExp=/^[ \t]+(.*[^ \t])/;HTTPParser.prototype.parseHeader=function(y,u){if(y.indexOf("\r")!==-1)throw parseErrorCode("HPE_LF_EXPECTED");var g=headerExp.exec(y),v=g&&g[1];if(v)u.push(v),u.push(g[2]);else{var b=headerContinueExp.exec(y);b&&u.length&&(u[u.length-1]&&(u[u.length-1]+=" "),u[u.length-1]+=b[1])}};var requestExp=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;HTTPParser.prototype.REQUEST_LINE=function(){var y=this.consumeLine();if(y){var u=requestExp.exec(y);if(u===null)throw parseErrorCode("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?u[1]:methods.indexOf(u[1]),this.info.method===-1)throw new Error("invalid request method");this.info.url=u[2],this.info.versionMajor=+u[3],this.info.versionMinor=+u[4],this.body_bytes=0,this.state="HEADER"}};var responseExp=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;HTTPParser.prototype.RESPONSE_LINE=function(){var y=this.consumeLine();if(y){var u=responseExp.exec(y);if(u===null)throw parseErrorCode("HPE_INVALID_CONSTANT");this.info.versionMajor=+u[1],this.info.versionMinor=+u[2];var g=this.info.statusCode=+u[3];this.info.statusMessage=u[4],((g/100|0)===1||g===204||g===304)&&(this.body_bytes=0),this.state="HEADER"}};HTTPParser.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(this.connection.indexOf("close")!==-1)return!1}else if(this.connection.indexOf("keep-alive")===-1)return!1;return!!(this.body_bytes!==null||this.isChunked)};HTTPParser.prototype.HEADER=function(){var y=this.consumeLine();if(y!==void 0){var u=this.info;if(y)this.parseHeader(y,u.headers);else{for(var g=u.headers,v=!1,b,w=!1,E=0;E<g.length;E+=2)switch(g[E].toLowerCase()){case"transfer-encoding":this.isChunked=g[E+1].toLowerCase()==="chunked";break;case"content-length":if(b=+g[E+1],v){if(b!==this.body_bytes)throw parseErrorCode("HPE_UNEXPECTED_CONTENT_LENGTH")}else v=!0,this.body_bytes=b;break;case"connection":this.connection+=g[E+1].toLowerCase();break;case"upgrade":w=!0;break}this.isChunked&&v&&(v=!1,this.body_bytes=null),w&&this.connection.indexOf("upgrade")!=-1?u.upgrade=this.type===HTTPParser.REQUEST||u.statusCode===101:u.upgrade=u.method===method_connect,this.isChunked&&u.upgrade&&(this.isChunked=!1),u.shouldKeepAlive=this.shouldKeepAlive();var S;if(compatMode0_12?S=this.userCall()(this[kOnHeadersComplete](u)):S=this.userCall()(this[kOnHeadersComplete](u.versionMajor,u.versionMinor,u.headers,u.method,u.url,u.statusCode,u.statusMessage,u.upgrade,u.shouldKeepAlive)),S===2)return this.nextRequest(),!0;if(this.isChunked&&!S)this.state="BODY_CHUNKHEAD";else{if(S||this.body_bytes===0)return this.nextRequest(),u.upgrade;this.body_bytes===null?this.state="BODY_RAW":this.state="BODY_SIZED"}}}};HTTPParser.prototype.BODY_CHUNKHEAD=function(){var y=this.consumeLine();y!==void 0&&(this.body_bytes=parseInt(y,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")};HTTPParser.prototype.BODY_CHUNK=function(){var y=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[kOnBody](this.chunk.slice(this.offset,this.offset+y),0,y)),this.offset+=y,this.body_bytes-=y,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")};HTTPParser.prototype.BODY_CHUNKEMPTYLINE=function(){var y=this.consumeLine();if(y!==void 0){if(y!=="")throw new Error("Expected empty line");this.state="BODY_CHUNKHEAD"}};HTTPParser.prototype.BODY_CHUNKTRAILERS=function(){var y=this.consumeLine();y!==void 0&&(y?this.parseHeader(y,this.trailers):(this.trailers.length&&this.userCall()(this[kOnHeaders](this.trailers,"")),this.nextRequest()))};HTTPParser.prototype.BODY_RAW=function(){this.userCall()(this[kOnBody](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end};HTTPParser.prototype.BODY_SIZED=function(){var y=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[kOnBody](this.chunk.slice(this.offset,this.offset+y),0,y)),this.offset+=y,this.body_bytes-=y,this.body_bytes||this.nextRequest()};["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(y){var u=HTTPParser["kOn"+y];Object.defineProperty(HTTPParser.prototype,"on"+y,{get:function(){return this[u]},set:function(g){return this._compatMode0_11=!0,method_connect="CONNECT",this[u]=g}})});function parseErrorCode(y){var u=new Error("Parse Error");return u.code=y,u}function getIterator(y){if(y!=null){if(typeof y[Symbol.iterator]=="function")return y[Symbol.iterator]();if(typeof y[Symbol.asyncIterator]=="function")return y[Symbol.asyncIterator]();if(typeof y.next=="function")return y}throw new Error("argument is not an iterator or iterable")}function itToBrowserReadableStream(y,u={}){const g=getIterator(y),v={_cancelled:!1,async start(){this._cancelled=!1},async pull(b){try{const{value:w,done:E}=await g.next();if(this._cancelled)return;if(E===!0){b.close();return}b.enqueue(w)}catch(w){b.error(w)}},cancel(){this._cancelled=!0}};return new globalThis.ReadableStream(v,u)}const sha=y=>async u=>new Uint8Array(await crypto.subtle.digest(y,u)),sha1$1=from({name:"sha-1",code:17,encode:sha("SHA-1")});class Request extends globalThis.Request{constructor(u,g={}){const v=g.method??"GET",b=getHeaders(g),w=g.body;isWebSocketUpgrade(v,b)&&(g.method="UPGRADE"),super(u,g),Object.defineProperties(this,{body:{value:w,writable:!1},method:{value:v,writable:!1},headers:{value:b,writable:!1}})}}const STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a Teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};let Response$1=class extends globalThis.Response{constructor(u,g={}){const v=getHeaders(g),b=g.status??200;(b<200||b>599)&&(g.status=200),super(u,g),Object.defineProperties(this,{status:{value:b,writable:!1},statusText:{value:STATUS_CODES[b],writable:!1},headers:{value:v,writable:!1}})}};const DNS_CODECS=["dns","dns4","dns6","dnsaddr"];function toURL(y,u){if(y instanceof URL)return y;const g=getHost(y,u),{httpPath:v}=stripHTTPPath(y);return new URL(`http://${g}${v}`)}function toUint8Array(y){return y instanceof Uint8Array?y:y instanceof DataView?new Uint8Array(y.buffer,y.byteOffset,y.byteLength):new Uint8Array(y,0,y.byteLength)}function streamToRequest(y,u){const g={method:y.method,headers:y.headers};if((g.method!=="GET"||y.upgrade)&&g.method!=="HEAD"){let v=u;y.upgrade||(v=takeBytes(u,y.headers.get("content-length"))),g.body=itToBrowserReadableStream(v),g.duplex="half"}return new Request(normalizeUrl(y).toString(),g)}async function responseToStream(y,u){if(u.send(fromString$1([`HTTP/1.1 ${y.status} ${y.statusText}`,...writeHeaders(y.headers),"",""].join(`\r
`))),y.body==null){await u.close().catch(v=>{u.abort(v)});return}const g=y.body.getReader();for(;;){const v=await g.read();if(v.value!=null&&(u.send(v.value)||await u.onDrain()),v.done)break}await u.close().catch(v=>{u.abort(v)})}const NOT_FOUND_RESPONSE=fromString$1(["HTTP/1.1 404 Not Found","Connection: close","",""].join(`\r
`));fromString$1(["HTTP/1.1 400 Bad Request","Connection: close","",""].join(`\r
`));fromString$1(["HTTP/1.1 500 Internal Server Error","Connection: close","",""].join(`\r
`));fromString$1(["HTTP/1.1 501 Not Implemented","Connection: close","",""].join(`\r
`));function writeHeaders(y){const u=[];y.get("Connection")==null&&y.set("Connection","close");for(const[g,v]of y.entries())u.push(`${g}: ${v}`);return u}async function*takeBytes(y,u){if(u=parseInt(`${u??""}`),u==null||isNaN(u))return y;let g=0;for await(const v of y){if(g+=v.byteLength,g>u){yield v.subarray(0,g-u);return}if(yield v.subarray(),g===u)return}}function toResource(y,u){if(typeof y=="string"&&(y.startsWith("/")?y=multiaddr(y):y=new URL(y)),isPeerId(y)&&(y=multiaddr(`/p2p/${y}`)),y instanceof URL&&y.protocol==="multiaddr:"&&(y=uriToMultiaddr(y.toString())),isMultiaddr(y)&&(y=[y]),Array.isArray(y)){for(const g of y)if(g.getComponents().some(({name:b})=>b==="http")){const b=multiaddrToUri(g);return new URL(`${b}${u??""}`)}}return u==null?y:y instanceof URL?new URL(`${y}${u.substring(1)}`):y.map(g=>g.encapsulate(`/http-path/${encodeURIComponent(u.substring(1))}`))}function getHeaders(y={}){return y.headers instanceof Headers||(y.headers=new Headers(y.headers)),y.headers}function isValidHost(y){return y!=null&&y!==""}function getHost(y,u){let g,v=80,b="http:";if(y instanceof URL&&(g=y.hostname,v=parseInt(y.port,10),b=y.protocol),isValidHost(g)||(g=u.get("host")??void 0),!isValidHost(g)&&Array.isArray(y))for(const w of y){const S=w.getComponents().filter(({name:A})=>DNS_CODECS.includes(A))?.[0]?.value;if(S!=null){g=S;break}}if(!isValidHost(g)&&Array.isArray(y))for(const w of y){const E=w.getComponents().findLast(S=>S.code===CODE_P2P)?.value;try{const S=getNetConfig(w);S.port!=null&&(v=S.port)}catch{}if(E!=null){g=peerIdFromString$1(E).toCID().toString(base36);break}}if(!isValidHost(g)&&Array.isArray(y))for(const w of y)try{const E=getNetConfig(w);E.host!=null&&(g=E.host);break}catch{}if(isValidHost(g))return b==="http:"&&v!==80&&(g=`${g}:${v}`),b==="https:"&&v!==443&&(g=`${g}:${v}`),g;throw new InvalidParametersError$1("Could not determine request host name - a request must have a host header, be made to a DNS or IP-based multiaddr or an http(s) URL")}function stripHTTPPath(y){let u="/";return y=y.map(g=>multiaddr(g.getComponents().filter(v=>v.name==="http-path"?(u=v.value??"/",!1):!0))),{httpPath:u,addresses:y}}function normalizeMethod(y,u=["GET"]){return y==null?u:(typeof y=="string"&&(y=[y]),y.map(g=>g.toUpperCase()))}function normalizeUrl(y){const u=y.url??"/";if(u.startsWith("http"))return new URL(u);const g=getHostFromReq(y);return new URL(`http://${g}${u}`)}function getHostFromReq(y){let u=y.headers?.host;if(u==null&&(u=y.headers?.Host),u==null&&typeof y.headers.get=="function"&&(u=y.headers.get("host")),u==null)throw new InvalidParametersError$1("Could not read host");return u}function isWebSocketUpgrade(y,u){return y==="GET"&&u.get("connection")?.toLowerCase()==="upgrade"&&u.get("upgrade")?.toLowerCase()==="websocket"}function getHeaderFromHeaders(y,u){if(y instanceof Headers)return y.get(u)??void 0;const g=y[u];return Array.isArray(g)?g.join(","):g}async function getServerUpgradeHeaders(y){if(getHeaderFromHeaders(y,"sec-websocket-version")!=="13")throw new ProtocolError$1("Invalid version");const u=getHeaderFromHeaders(y,"sec-websocket-key");if(u==null)throw new ProtocolError$1("Missing sec-websocket-key");const g=`${u}258EAFA5-E914-47DA-95CA-C5AB0DC85B11`,v=await sha1$1.digest(fromString$1(g)),b=base64pad.encode(v.digest).substring(1);return new Headers({Upgrade:"websocket",Connection:"upgrade","Sec-WebSocket-Accept":b})}async function readHeaders(y,u){const g=new HTTPParser("REQUEST"),v=new Uint8ArrayList;let b;g[HTTPParser.kOnHeadersComplete]=w=>{const E=new Headers;for(let S=0;S<w.headers.length;S+=2)E.set(w.headers[S].toLowerCase(),w.headers[S+1]);b={...w,headers:E,raw:v,method:HTTPParser.methods[w.method]}};try{for(;;){const{data:w}=await raceEvent(y,"message",u?.signal),E=w.subarray(),S=g.execute(E,0,E.byteLength);if(S instanceof Error)throw S;if(v.append(E.subarray(0,S)),S<E.byteLength&&y.push(E.subarray(S)),b!=null)return b}}catch(w){y.abort(w)}finally{g.finish()}throw new Error("Failed to read header info from request")}class InvalidResponseError extends Error{static name="InvalidResponseError";name="InvalidResponseError"}const nullBodyStatus=[101,204,205,304];async function readResponse$1(y,u,g){const v=Promise.withResolvers(),b=new TransformStream,w=b.writable.getWriter();let E=!1;const S=new HTTPParser("RESPONSE");S.maxHeaderSize=g.maxHeaderSize??HTTPParser.maxHeaderSize,S[HTTPParser.kOnHeadersComplete]=$=>{g.log("response headers complete"),E=!0;const R=new Headers;for(let B=0;B<$.headers.length;B+=2)R.append($.headers[B],$.headers[B+1]);let T=b.readable;nullBodyStatus.includes($.statusCode)&&(b.writable.close().catch(()=>{}),b.readable.cancel().catch(()=>{}),T=null);const O=new Response$1(T,{status:$.statusCode,statusText:$.statusMessage,headers:R});v.resolve(O)},S[HTTPParser.kOnBody]=$=>{g.log("response read body %d bytes",$.byteLength),w.write($).catch(R=>{v.reject(R)})},S[HTTPParser.kOnMessageComplete]=()=>{g.log("response message complete"),w.close().catch($=>{v.reject($)})};let A=0;return y.addEventListener("message",({data:$})=>{g.log("response stream read %d bytes",$.byteLength),A+=$.byteLength;const R=S.execute($.subarray(),0,$.byteLength);R instanceof Error&&(y.abort(R),S.finish())}),y.addEventListener("remoteCloseWrite",()=>{E||v.reject(new InvalidResponseError(`Response ended before headers were received, read ${A} bytes`)),S.finish()}),v.promise}function blobBody(y,u){return u.set("Content-Length",`${y.size}`),u.set("Content-Type",y.type!=null&&y.type!==""?y.type:"application/octet-stream"),y.stream()}function bytesBody(y,u){return u.set("Content-Length",`${y.byteLength}`),u.set("Content-Type","application/octet-stream"),new ReadableStream({start(g){g.enqueue(toUint8Array(y)),g.close()}})}function calculateSize(y,u,g){const v=[`--${g}`];let b=0;const w=2;return typeof u=="string"?(v.push(`Content-Disposition: form-data; name="${y}"`,'Content-Type: text/plain; charset="UTF-8"',`Content-Length: ${u.length}`,""),b=u.length+w):(v.push(`Content-Disposition: form-data; name="${y}"; filename="${encodeURIComponent(u.name)}"`,"Content-Type: application/octet-stream",`Content-Length: ${u.size}`,""),b=u.size+w),fromString$1(v.join(`\r
`)).byteLength+b}function formDataBody(y,u){const g=`-----------------------------${crypto.randomUUID()}`;u.set("Content-Type",`multipart/form-data; boundary=${g}`);let v=0;for(const[A,$]of y.entries())v+=calculateSize(A,$,g);u.set("Content-Length",`${v}`);const b=y.entries();let w;function E(A,$,R,T){const O=[`--${T}`];typeof R=="string"?O.push(`Content-Disposition: form-data; name="${$}"`,'Content-Type: text/plain; charset="UTF-8"',`Content-Length: ${R.length}`,"",R,""):(O.push(`Content-Disposition: form-data; name="${$}"; filename="${encodeURIComponent(R.name)}"`,"Content-Type: application/octet-stream",`Content-Length: ${R.size}`,""),w=R.stream().getReader()),A.enqueue(fromString$1(O.join(`\r
`)))}async function S(A,$){if(w!=null){const O=await w.read();O.value!=null&&A.enqueue(O.value),O.done&&(A.enqueue(fromString$1(`\r
`)),w=void 0);return}const{done:R,value:T}=b.next();if(T!=null){const[O,B]=T;E(A,O,B,$)}R===!0&&A.close()}return new ReadableStream({async pull(A){await S(A,g)}})}function readableStreamBody(y,u){u.set("Content-Type","application/octet-stream"),u.set("Transfer-Encoding","chunked");const g=y.getReader();return new ReadableStream({async pull(v){const{done:b,value:w}=await g.read();w!=null&&(v.enqueue(fromString$1(`${w.byteLength}\r
`)),v.enqueue(w),v.enqueue(fromString$1(`\r
`))),b&&(v.enqueue(fromString$1(`0\r
\r
`)),v.close())}})}function stringBody(y,u){return u.set("Content-Length",`${y.length}`),u.set("Content-Type",'text/plain; charset="UTF-8"'),new ReadableStream({start(g){g.enqueue(fromString$1(y)),g.close()}})}function normalizeContent(y,u){if(y!=null){if(typeof y=="string")return stringBody(y,u);if(y instanceof Blob)return blobBody(y,u);if(isBytes$2(y))return bytesBody(y,u);if(y instanceof URLSearchParams)return stringBody(y.toString(),u);if(y instanceof ReadableStream)return readableStreamBody(y,u);if(y instanceof FormData)return formDataBody(y,u);throw new Error("Unsupported body type")}}function isBytes$2(y){return y==null?!1:y.byteLength!=null}async function sendRequest(y,u,g){const v=new Headers(g.headers),b=v.get("host")??u.hostname;v.set("host",b),v.get("user-agent")==null&&v.set("user-agent","libp2p/fetch");const w=normalizeContent(g.body,v),E=[`${g?.method?.toUpperCase()??"GET"} ${u.pathname??"/"} HTTP/1.1`,...writeHeaders(v),"",""];y.send(fromString$1(E.join(`\r
`)))||await y.onDrain({signal:g.signal??void 0}),w!=null&&(g.log("request sending body"),await sendBody(y,w,g))}async function sendBody(y,u,g){const v=u.getReader();for(;;){const{done:b,value:w}=await v.read();if(w!=null&&(g.log("request send %d bytes",w.byteLength),y.send(w)||await y.onDrain({signal:g.signal??void 0})),b){g.log("request finished sending body");break}}}async function fetch$1(y,u,g={}){const v=y.log.newScope("http-fetch");u=typeof u=="string"?new URL(u):u;const[b]=await Promise.all([readResponse$1(y,u,{...g,log:v}),sendRequest(y,u,{...g,log:v})]);return await y.close({signal:g.signal??void 0}),b}class ErrorEvent extends Event{message;error;filename="";lineno=0;colno=0;constructor(u){super("error"),this.error=u,this.message=u.message}}class CloseEvent extends Event{code;reason;wasClean;constructor(u,g){super(u),this.code=g?.code??0,this.reason=g?.reason??"",this.wasClean=g?.wasClean??!0}}const OP_CODES={CONTINUATION:0,TEXT:1,BINARY:2,CONNECTION_CLOSE:8,PING:9,PONG:10},MESSAGE_TYPES={0:"CONTINUATION",1:"TEXT",2:"BINARY",8:"CONNECTION_CLOSE",9:"PING",10:"PONG"},CLOSE_MESSAGES={NORMAL_CLOSURE:1e3,MESSAGE_TOO_BIG:1009};function decodeMessage(y){let u=0;if(y.byteLength<u+1)return;const v=y.get(u)&15;if(u++,MESSAGE_TYPES[v]==null)throw new Error(`Unknown opcode: ${v}`);if(y.byteLength<u+1)return;const b=y.get(u),w=(b&128)===128;let E=b&127;if(u++,E===126){if(y.byteLength<u+2)return;E=y.getUint16(u),u+=2}else if(E===127){if(y.byteLength<u+8)return;E=y.getUint32(u),u+=8}if(E===0)return y.consume(u),{type:MESSAGE_TYPES[v]};let S;if(w){if(y.byteLength<u+4)return;S=y.subarray(u,u+4),u+=4}if(y.byteLength<u+E)return;let A=y.subarray(u,u+E);return u+=E,S!=null&&(A=applyMask(A,S)),y.consume(u),{type:MESSAGE_TYPES[v],data:A}}function applyMask(y,u){let g=0;for(let v=0;v<y.byteLength;v++)y[v]=y[v]^u[g],g++,g===u.byteLength&&(g=0);return y}function encodeMessage(y,u,g){const v=new Uint8ArrayList(Uint8Array.from([128|OP_CODES[y]])),b=u?.byteLength??0;if(b<126)v.append(Uint8Array.from([b|(g===!0?128:0)]));else if(b<65535){const w=new Uint8ArrayList(new Uint8Array(3));w.set(0,126|(g===!0?128:0)),w.setUint16(1,b),v.append(w)}else if(b<18446744073709552e3){const w=new Uint8ArrayList(new Uint8Array(9));w.set(0,127|(g===!0?128:0)),w.setUint32(1,b),v.append(w)}else throw new Error("Payload too large");if(g===!0&&u!=null){const w=Uint8Array.from([0,0,0,0]);v.append(w),u=applyMask(u,w)}return u!=null&&v.append(u),v}function toBytes$1(y){if(y instanceof Uint8Array||y instanceof ArrayBuffer||y instanceof DataView)return toUint8Array(y);if(typeof y=="string")return fromString$1(y);if(y instanceof Blob)return y.arrayBuffer().then(u=>toUint8Array(u));throw new InvalidParametersError$1("Unsupported data type")}async function readResponse(y,u){return new Promise((g,v)=>{let b=!1;const w=new HTTPParser("RESPONSE");w[HTTPParser.kOnHeadersComplete]=E=>{b=!0;const S=[];for(let A=0;A<E.headers.length;A+=2)S.push([E.headers[A],E.headers[A+1]]);g(new Response$1(null,{status:E.statusCode,statusText:E.statusMessage,headers:new Headers(S)}))},Promise.resolve().then(async()=>{for(;;){const{data:E}=await raceEvent(y,"message",u.signal),S=E.subarray(),A=w.execute(S,0,S.byteLength);if(A instanceof Error)throw A;if(A<S.byteLength&&y.push(S.subarray(A)),b)break}}).catch(E=>{v(E)})})}async function*performClientUpgrade(y,u=[],g){const v=base64pad.encode(crypto.getRandomValues(new Uint8Array(16))).substring(1);g.set("host",y.hostname),g.set("connection","upgrade"),g.set("upgrade","websocket"),g.set("pragma","no-cache"),g.set("cache-control","no-cache"),g.set("sec-websocket-version","13"),g.set("sec-websocket-key",v),u.length>0&&g.set("sec-websocket-protocol",u.join(", ")),yield fromString$1([`GET ${y.pathname??"/"} HTTP/1.1`,...[...g.entries()].map(([b,w])=>`${b}: ${w}`),"",""].join(`\r
`))}const DATA_MESSAGES=["BINARY","TEXT","CONTINUATION"],MAX_MESSAGE_SIZE$1=10485760,HTTP_PROTOCOL$1="/http/1.1";class AbstractWebSocket extends TypedEventEmitter{binaryType="arraybuffer";bufferedAmount=0;extensions="";protocol="";readyState;url;CONNECTING=0;OPEN=1;CLOSING=2;CLOSED=3;_onclose;_onerror;_onmessage;_onopen;sentClose;isClient;buffer;maxMessageSize;_url;closeController;constructor(u,g={}){super(),this.readyState=this.CONNECTING,this.url=u.pathname,this.sentClose=!1,this.isClient=g.isClient??!0,this.buffer=new Uint8ArrayList,this.closeController=new AbortController,this.maxMessageSize=g.maxMessageSize??MAX_MESSAGE_SIZE$1}send(u){if(this.readyState!==this.OPEN)throw new Error("WebSocket was not open");const g=toBytes$1(u);isPromise$5(g)?g.then(v=>{this._send("BINARY",v)}).catch(v=>{this._errored(v)}):this._send("BINARY",g)}_send(u,g){if(this.readyState!==this.OPEN)return;const v=encodeMessage(u,g,this.isClient),b=v.byteLength;this.bufferedAmount+=b,this._write(v,w=>{this.bufferedAmount-=b,w!=null&&this._errored(w)})}close(u,g){if(this.readyState!==this.OPEN)throw new Error("WebSocket was not open");this.readyState=this.CLOSING,this.sentClose=!0,this._send("CONNECTION_CLOSE")}_errored(u){this.readyState=this.CLOSED,this.dispatchEvent(new ErrorEvent(u))}set onclose(u){this._onclose=u,this.addEventListener("close",u)}get onclose(){return this._onclose??null}set onerror(u){this._onerror=u,this.addEventListener("error",u)}get onerror(){return this._onerror??null}set onmessage(u){this._onmessage=u,this.addEventListener("message",u)}get onmessage(){return this._onmessage??null}set onopen(u){this._onopen=u,this.addEventListener("open",u)}get onopen(){return this._onopen??null}_push(u){if(this.buffer.append(u),this.buffer.byteLength>this.maxMessageSize){this.close(CLOSE_MESSAGES.MESSAGE_TOO_BIG,"Max message size exceeded");return}for(;;){const g=decodeMessage(this.buffer);if(g==null)break;if(DATA_MESSAGES.includes(g.type)&&g.data!=null){let v;this.binaryType==="blob"?v=new Blob([g.data]):g.data.byteOffset===0&&g.data.byteLength===g.data.buffer.byteLength?v=g.data.buffer:(v=new ArrayBuffer(g.data.byteLength),new Uint8Array(v,0,v.byteLength).set(g.data)),this.dispatchEvent(new MessageEvent("message",{data:v,origin:this._url?.hostname}))}g.type==="PING"&&this._send("PONG",g.data),g.type==="CONNECTION_CLOSE"&&(this.sentClose||this.close(),this.closeController.abort(),this._close(void 0,()=>{this.readyState=this.CLOSED,this.dispatchEvent(new CloseEvent("close"))}))}}_remoteClosed(u){this.readyState=this.CLOSING,this._close(u,()=>{this.readyState=this.CLOSED,this.dispatchEvent(new CloseEvent("close"))})}}class RequestWebSocket extends AbstractWebSocket{writer;writable;constructor(u,g,v={}){if(super(new URL(u.url),{...v,isClient:!1}),u.body==null)throw new InvalidParametersError$1("Request body cannot be null");this.readyState=this.OPEN,this.writable=g,this.writer=g.getWriter();const b=u.body.getReader();Promise.resolve().then(async()=>{for(this.dispatchEvent(new Event("open"));;){const{value:w,done:E}=await b.read();if(w!=null&&this._push(w),E){this._remoteClosed();break}}}).catch(w=>{this._errored(w)})}_write(u,g){this.writer?.write(u).then(()=>{g()},v=>{g(v)})}_close(u,g){u!=null?this.writable.abort(u).then(()=>{g()},()=>{g()}):this.writable.close().then(()=>{g()},()=>{g()})}}let WebSocket$1=class extends AbstractWebSocket{stream;handshakeTimeout;drainTimeout;constructor(u,g,v,b){super(g,{...b,isClient:!0}),this.handshakeTimeout=b.handshakeTimeout??1e4,this.drainTimeout=b.drainTimeout??1e4,Promise.resolve().then(async()=>{const w=AbortSignal.timeout(this.handshakeTimeout);this.stream=await v.openStream(u,HTTP_PROTOCOL$1,{...b,signal:w});for await(const S of performClientUpgrade(g,b.protocols,getHeaders(b)))this.stream.send(S)||await this.stream.onDrain({signal:w});const E=await readResponse(this.stream,{signal:w});if(E.status!==101)throw new Error("Invalid WebSocket handshake - response status "+E.status);await b.onHandshakeResponse?.(E,{signal:w}),this.protocol=E.headers.get("Sec-WebSocket-Protocol")??"",this.readyState=this.OPEN,this.dispatchEvent(new Event("open"));for await(const S of this.stream)this._push(S)}).catch(w=>{this._errored(w)})}_write(u,g){if(this.stream==null){g(new Error("WebSocket was not open"));return}this.stream.send(u)?g():this.stream.onDrain({signal:AbortSignal.timeout(this.drainTimeout)}).then(()=>{g()},v=>{g(v)})}_close(u,g){if(this.stream==null){g();return}if(u!=null){this.stream.abort(u),g();return}this.stream.close().catch(v=>{this.stream?.abort(v)}).finally(()=>{g()})}};const HTTP_PROTOCOL="/http/1.1",WEBSOCKET_HANDLER=Symbol.for("@libp2p/http/websocket-handler");class Cookies{log;cookies;constructor(u,g={}){this.log=u.logger.forComponent("libp2p:http:cookies"),this.cookies=new Map}async prepareRequest(u,g){if((g.credentials??"same-origin")==="omit")return;const b=g.headers.get("origin");if(b==null||b==="null")return;const w=toURL(u,g.headers),E=(this.cookies.get(w.hostname)??[]).filter(S=>!(S.expires!=null&&S.expires<Date.now()||S.path!=null&&!w.pathname.startsWith(S.path))).map(S=>`${S.name}=${S.value}`).join("; ");E.length>0&&g.headers.set("cookie",E)}async processResponse(u,g,v){if((g.credentials??"same-origin")==="omit"){removeSetCookie(v);return}const w=g.headers.get("origin");if(w==null||w==="null")return;const E=toURL(u,g.headers);for(const S of v.headers.getSetCookie()){const A=[...this.cookies.get(E.hostname)??[],...toCookies(cookie.parse(S))];this.cookies.set(E.hostname,A)}removeSetCookie(v)}}function removeSetCookie(y){return y.headers.has("set-cookie")&&y.headers.delete("set-cookie"),y}function toCookies(y){const u={},g=[];return Object.entries(y).forEach(([v,b])=>{v.toLowerCase()==="domain"&&b!=null&&(u.domain=b),v.toLowerCase()==="max-age"&&b!=null&&(u.expires=Date.now()+parseInt(b,10)*1e3),!COOKIE_FIELDS.includes(v.toLowerCase())&&b!=null&&g.push({name:v,value:b})}),g.map(v=>({...v,...u}))}const COOKIE_FIELDS=["domain","expires","httponly","max-age","partitioned","path","samesite","secure"];class Origin{async prepareRequest(u,g){if(g.headers.get("origin")!=null||g.mode==="no-cors")return;const v=toURL(u,g.headers);g.headers.set("origin",`${v.protocol}//${v.host}`)}}function isInitializable(y){return typeof y.init=="function"}function initializeRoute(y,u){if(isInitializable(y)){const g=y;return g.handler=y.init(u),delete g.init,g}return y}function webSocketRoute(y){const u=normalizeMethod(y.method,["GET"]);if(y.fallback==null&&u.filter(v=>v!=="GET").length>0)throw new InvalidParametersError$1("WebSocket handlers only support the GET HTTP method");const g={...y,init:v=>{const b=initializeRoute(y,v);return g[WEBSOCKET_HANDLER]=b.handler,async w=>{if(!isWebSocketUpgrade(w.method,w.headers))return y?.fallback!=null?y.fallback(w):new Response$1(null,{status:400});const E=new TransformStream;try{const S=new Response$1(E.readable,{status:101,headers:await getServerUpgradeHeaders(w.headers)}),A=new RequestWebSocket(w,E.writable,y);return b.handler(A),S}catch{return new Response$1(null,{status:500})}}}};return g}const WELL_KNOWN_PROTOCOLS_PATH="/.well-known/libp2p/protocols";function wellKnownRoute(y){return webSocketRoute({path:WELL_KNOWN_PROTOCOLS_PATH,method:["GET"],cors:!0,handler:u=>{const g=JSON.stringify(y.getProtocolMap());u.send(g),u.close()},fallback:async u=>{const g=JSON.stringify(y.getProtocolMap());return new Response(g,{headers:{"Content-Type":"application/json","Content-Length":`${g.length}`}})}})}class HTTPRegistrar{log;components;protocols;endpoint;constructor(u,g={}){this.components=u,this.log=u.logger.forComponent("libp2p:http:registrar"),this.protocols=[],this.onStream=this.onStream.bind(this),this.endpoint=g.server,this.handle("",wellKnownRoute(this))}async start(){await this.components.registrar.handle(HTTP_PROTOCOL,this.onStream.bind(this))}async stop(){await this.components.registrar.unhandle(HTTP_PROTOCOL)}async onStream(u,g){const v=await readHeaders(u);if(this.canHandle(v)){this.log("handling incoming request %s %s",v.method,v.url);const b=await this.onRequest(streamToRequest(v,u));await responseToStream(b,u),await u.close();return}if(this.endpoint==null){this.log("cannot handle incoming request %s %s and no endpoint configured",v.method,v.url),u.send(NOT_FOUND_RESPONSE),await u.close();return}this.log("passing incoming request %s %s to endpoint",v.method,v.url),this.endpoint.inject(v,u,g).catch(b=>{this.log.error("error injecting request to endpoint - %e",b),u.abort(b)})}canHandle(u){const g=normalizeUrl(u).pathname;return this.protocols.find(v=>v.route.path===g)!=null?(this.log.trace("can handle %s",g),!0):(this.log.trace("cannot handle %s",g),!1)}async onRequest(u){this.log("incoming request %s %s",u.method,u.url);const g=this.findHandler(u.url);if(g==null)return new Response(null,{status:404});let v;return g.route.method.includes(u.method)?v=await g.route.handler(u):u.method==="OPTIONS"?v=new Response(null,{status:204}):v=new Response(null,{status:405}),addHeaders(v,u,g),this.log("%s %s %d %s",u.method,u.url,v.status,v.statusText),v}onWebSocket(u){const g=this.findHandler(u.url);if(g!=null){const v=g.route[WEBSOCKET_HANDLER];if(v!=null){v(u);return}}u.close(CLOSE_MESSAGES.NORMAL_CLOSURE)}findHandler(u){const g=u.startsWith("/")?u:new URL(u).pathname;this.log("search for handler on path %s",g);const v=this.protocols.find(b=>b.route.path===g);return v!=null&&this.log("found handler for HTTP protocol %s on path %s",v.protocol,u),v}handle(u,g){if(g.path=g.path??u,this.protocols.find(v=>v.protocol===u)!=null)throw new InvalidParametersError$1(`HTTP protocol handler for ${u} already registered`);(g.path===""||!g.path.startsWith("/"))&&(g.path=`/${g.path}`),g.cors=g.cors??!0,g.method=normalizeMethod(g.method),g=initializeRoute(g,this.components),this.protocols.push({protocol:u,route:g}),this.protocols.sort(({route:{path:v}},{route:{path:b}})=>b.length-v.length)}unhandle(u){this.protocols=this.protocols.filter(g=>g.protocol===u)}getProtocolMap(){const u={};for(const g of this.protocols)g.protocol!==""&&(u[g.protocol]={path:g.route.path});return u}}function addHeaders(y,u,g){const v=[...new Set(["OPTIONS",...g.route.method])].join(", ");g.route.cors&&(u.headers.get("Access-Control-Request-Method")!=null&&y.headers.set("access-control-allow-methods",v),u.headers.get("Access-Control-Request-Headers")!=null&&y.headers.set("access-control-allow-headers",u.headers.get("Access-Control-Request-Headers")??""),u.headers.get("Origin")!=null&&(y.headers.set("access-control-allow-origin",u.headers.get("Origin")??""),y.headers.set("vary","Origin"))),u.method==="OPTIONS"&&y.headers.set("allow",v)}async function prepareAndSendRequest(y,u,g){for(const v of u.middleware)await v.prepareRequest?.(y,u);return g()}async function prepareAndConnect(y,u,g){for(const v of u.middleware)await v.prepareRequest?.(y,u);return g()}async function processResponse(y,u,g){for(const v of u.middleware)await v.processResponse?.(y,u,g);return g}class HTTP{log;components;httpRegistrar;origin;cookies;constructor(u,g={}){this.components=u,this.log=u.logger.forComponent("libp2p:http"),this.httpRegistrar=new HTTPRegistrar(u,g),this.origin=new Origin,this.cookies=new Cookies(u,g)}[Symbol.toStringTag]="@libp2p/http";[serviceCapabilities]=["@libp2p/http"];async start(){await start(this.httpRegistrar)}async stop(){await stop(this.httpRegistrar)}agent(...u){throw new UnsupportedOperationError("This method is not supported in browsers")}dispatcher(...u){throw new UnsupportedOperationError("This method is not supported in browsers")}async connect(u,g={}){const v=toResource(u),b=getHeaders(g),w={...g,headers:b,method:"GET",middleware:g.middleware?.map(E=>E(this.components))??[]};return b.set("connection","upgrade"),b.set("upgrade","websocket"),prepareAndConnect(v,w,async()=>{if(v instanceof URL){const A=new globalThis.WebSocket(v,g.protocols);return A.binaryType="arraybuffer",A}const{addresses:E,httpPath:S}=stripHTTPPath(v);return new WebSocket$1(E,new URL(`http://${getHost(v,w.headers)}${decodeURIComponent(S)}`),this.components.connectionManager,w)})}async fetch(u,g={}){const v=toResource(u),b={...g,headers:getHeaders(g),method:"GET",middleware:[this.origin,this.cookies,...g.middleware?.map(E=>E(this.components))??[]]},w=await prepareAndSendRequest(v,b,async()=>this.sendRequest(v,g));return processResponse(v,b,w)}async connectProtocol(u,g,v){const b=await this.getProtocolPath(u,g,v),w=toResource(u,b);return this.connect(w,v)}async fetchProtocol(u,g,v={}){const b=await this.getProtocolPath(u,g,v),w=toResource(u,b);return this.fetch(w,v)}async getSupportedProtocols(u,g={}){const v=toResource(u,WELL_KNOWN_PROTOCOLS_PATH),b=await this.fetch(v,{method:"GET",headers:{Accept:"application/json"},signal:g.signal});if(b.status!==200)throw new Error(`Unexpected status code: ${b.status}`);return b.json()}async getProtocolPath(u,g,v={}){const b=await this.getSupportedProtocols(u,v);if(b[g]==null)throw new Error(`Peer does not serve protocol: ${g}`);return b[g].path}canHandle(u){return this.httpRegistrar.canHandle(u)}async onRequest(u){return this.httpRegistrar.onRequest(u)}onWebSocket(u){this.httpRegistrar.onWebSocket(u)}handle(u,g){this.httpRegistrar.handle(u,g)}unhandle(u){this.httpRegistrar.unhandle(u)}getProtocolMap(){return this.httpRegistrar.getProtocolMap()}async sendRequest(u,g){if(u instanceof URL)return this.log("making request to %s with global fetch"),globalThis.fetch(u,g);this.log("making request to %s with libp2p fetch",u);const v=getHost(u,getHeaders(g)),{addresses:b,httpPath:w}=stripHTTPPath(u),S=await(await this.components.connectionManager.openConnection(b,{signal:g.signal??void 0})).newStream(HTTP_PROTOCOL,{signal:g.signal??void 0});return fetch$1(S,new URL(`http://${v}${decodeURIComponent(w)}`),g)}}function http(y={}){return u=>new HTTP(u,y)}const IDENTIFY_PROTOCOL_VERSION="0.1.0",MULTICODEC_IDENTIFY_PROTOCOL_NAME="id",MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME="id/push",MULTICODEC_IDENTIFY_PROTOCOL_VERSION="1.0.0",MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION="1.0.0",MAX_IDENTIFY_MESSAGE_SIZE=1024*8,MAX_PUSH_CONCURRENCY=32,PUSH_DEBOUNCE_MS=1e3;var Identify$1;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{if(b.lengthDelimited!==!1&&v.fork(),g.protocolVersion!=null&&(v.uint32(42),v.string(g.protocolVersion)),g.agentVersion!=null&&(v.uint32(50),v.string(g.agentVersion)),g.publicKey!=null&&(v.uint32(10),v.bytes(g.publicKey)),g.listenAddrs!=null)for(const w of g.listenAddrs)v.uint32(18),v.bytes(w);if(g.observedAddr!=null&&(v.uint32(34),v.bytes(g.observedAddr)),g.protocols!=null)for(const w of g.protocols)v.uint32(26),v.string(w);g.signedPeerRecord!=null&&(v.uint32(66),v.bytes(g.signedPeerRecord)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={listenAddrs:[],protocols:[]},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 5:{w.protocolVersion=g.string();break}case 6:{w.agentVersion=g.string();break}case 1:{w.publicKey=g.bytes();break}case 2:{if(b.limits?.listenAddrs!=null&&w.listenAddrs.length===b.limits.listenAddrs)throw new MaxLengthError('Decode error - map field "listenAddrs" had too many elements');w.listenAddrs.push(g.bytes());break}case 4:{w.observedAddr=g.bytes();break}case 3:{if(b.limits?.protocols!=null&&w.protocols.length===b.limits.protocols)throw new MaxLengthError('Decode error - map field "protocols" had too many elements');w.protocols.push(g.string());break}case 8:{w.signedPeerRecord=g.bytes();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Identify$1||(Identify$1={}));const defaultValues={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:MAX_IDENTIFY_MESSAGE_SIZE,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:MAX_PUSH_CONCURRENCY};function getCleanMultiaddr(y){if(y!=null&&y.length>0)try{return multiaddr(y)}catch{}}async function consumeIdentifyMessage(y,u,g,v,b){if(g("received identify from %p",v.remotePeer),b==null)throw new InvalidMessageError("message was null or undefined");const w={};if(b.listenAddrs.length>0&&(w.addresses=b.listenAddrs.map(A=>({isCertified:!1,multiaddr:multiaddr(A)}))),b.protocols.length>0&&(w.protocols=b.protocols),b.publicKey!=null){const A=publicKeyFromProtobuf(b.publicKey);if(!peerIdFromPublicKey(A).equals(v.remotePeer))throw new InvalidMessageError("public key did not match remote PeerId");w.publicKey=A}let E;if(b.signedPeerRecord!=null){g.trace("received signedPeerRecord from %p",v.remotePeer);let A=b.signedPeerRecord;const $=await RecordEnvelope.openAndCertify(A,PeerRecord.DOMAIN);let R=PeerRecord.createFromProtobuf($.payload);const T=peerIdFromCID($.publicKey.toCID());if(!R.peerId.equals(T))throw new InvalidMessageError("signing key does not match PeerId in the PeerRecord");if(!v.remotePeer.equals(R.peerId))throw new InvalidMessageError("signing key does not match remote PeerId");let O;try{O=await y.get(R.peerId)}catch(B){if(B.name!=="NotFoundError")throw B}if(O!=null&&(w.metadata=O.metadata,O.peerRecordEnvelope!=null)){const B=RecordEnvelope.createFromProtobuf(O.peerRecordEnvelope),F=PeerRecord.createFromProtobuf(B.payload);F.seqNumber>=R.seqNumber&&(g("sequence number was lower or equal to existing sequence number - stored: %d received: %d",F.seqNumber,R.seqNumber),R=F,A=O.peerRecordEnvelope)}w.peerRecordEnvelope=A,w.addresses=R.multiaddrs.map(B=>({isCertified:!0,multiaddr:B})),E={seq:R.seqNumber,addresses:R.multiaddrs}}else g("%p did not send a signed peer record",v.remotePeer);if(g.trace("patching %p with",v.remotePeer,w),await y.patch(v.remotePeer,w),b.agentVersion!=null||b.protocolVersion!=null){const A={};b.agentVersion!=null&&(A.AgentVersion=fromString$1(b.agentVersion)),b.protocolVersion!=null&&(A.ProtocolVersion=fromString$1(b.protocolVersion)),g.trace("merging %p metadata",v.remotePeer,A),await y.merge(v.remotePeer,{metadata:A})}const S={peerId:v.remotePeer,protocolVersion:b.protocolVersion,agentVersion:b.agentVersion,publicKey:b.publicKey,listenAddrs:b.listenAddrs.map(A=>multiaddr(A)),observedAddr:b.observedAddr==null?void 0:multiaddr(b.observedAddr),protocols:b.protocols,signedPeerRecord:E,connection:v};return u.safeDispatchEvent("peer:identify",{detail:S}),S}class AbstractIdentify{host;components;protocol;started;timeout;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;runOnLimitedConnection;log;constructor(u,g){this.protocol=g.protocol,this.started=!1,this.components=u,this.log=g.log,this.timeout=g.timeout??defaultValues.timeout,this.maxInboundStreams=g.maxInboundStreams??defaultValues.maxInboundStreams,this.maxOutboundStreams=g.maxOutboundStreams??defaultValues.maxOutboundStreams,this.maxMessageSize=g.maxMessageSize??defaultValues.maxMessageSize,this.maxObservedAddresses=g.maxObservedAddresses??defaultValues.maxObservedAddresses,this.runOnLimitedConnection=g.runOnLimitedConnection??defaultValues.runOnLimitedConnection,this.host={protocolVersion:`${g.protocolPrefix??defaultValues.protocolPrefix}/${IDENTIFY_PROTOCOL_VERSION}`,agentVersion:u.nodeInfo.userAgent},this.handleProtocol=this.handleProtocol.bind(this)}isStarted(){return this.started}async start(){this.started||(await this.components.peerStore.merge(this.components.peerId,{metadata:{AgentVersion:fromString$1(this.host.agentVersion),ProtocolVersion:fromString$1(this.host.protocolVersion)}}),await this.components.registrar.handle(this.protocol,this.handleProtocol,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}}class IdentifyPush extends AbstractIdentify{connectionManager;concurrency;_push;constructor(u,g={}){super(u,{...g,protocol:`/${g.protocolPrefix??defaultValues.protocolPrefix}/${MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME}/${MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION}`,log:u.logger.forComponent("libp2p:identify-push")}),this.connectionManager=u.connectionManager,this.concurrency=g.concurrency??defaultValues.concurrency,this._push=debounce$1(this.sendPushMessage.bind(this),g.debounce??PUSH_DEBOUNCE_MS),(g.runOnSelfUpdate??defaultValues.runOnSelfUpdate)&&u.events.addEventListener("self:peer:update",v=>{this.push().catch(b=>{this.log.error("error pushing updates to peers - %e",b)})})}[serviceCapabilities]=["@libp2p/identify-push"];async push(){this._push()}async sendPushMessage(){if(this.isStarted())try{const u=this.components.addressManager.getAddresses().map(R=>R.decapsulateCode(CODE_P2P)),g=new PeerRecord({peerId:this.components.peerId,multiaddrs:u}),v=await RecordEnvelope.seal(g,this.components.privateKey),b=this.components.registrar.getProtocols(),w=await this.components.peerStore.get(this.components.peerId),E=toString$3(w.metadata.get("AgentVersion")??fromString$1(this.host.agentVersion)),S=toString$3(w.metadata.get("ProtocolVersion")??fromString$1(this.host.protocolVersion)),A=this;async function*$(){for(const R of A.connectionManager.getConnections())(await A.components.peerStore.get(R.remotePeer)).protocols.includes(A.protocol)&&(yield async()=>{let O;const B=AbortSignal.timeout(A.timeout);try{O=await R.newStream(A.protocol,{signal:B,runOnLimitedConnection:A.runOnLimitedConnection}),await pbStream(O,{maxDataLength:A.maxMessageSize}).pb(Identify$1).write({listenAddrs:u.map(U=>U.bytes),signedPeerRecord:v.marshal(),protocols:b,agentVersion:E,protocolVersion:S},{signal:B}),await O.close({signal:B})}catch(F){O?.log.newScope("identify-push")?.error("could not push identify update to peer",F),O?.abort(F)}})}await drain(parallel($(),{concurrency:this.concurrency}))}catch(u){this.log.error("error pushing updates to peers - %e",u)}}async handleProtocol(u,g){const v=u.log.newScope("identify-push");if(this.components.peerId.equals(g.remotePeer))throw new Error("received push from ourselves?");const b={signal:AbortSignal.timeout(this.timeout)},E=await pbStream(u,{maxDataLength:this.maxMessageSize}).pb(Identify$1).read(b);await u.close(b),await consumeIdentifyMessage(this.components.peerStore,this.components.events,v,g,E),v.trace("handled push from %p",g.remotePeer)}}class Identify extends AbstractIdentify{constructor(u,g={}){super(u,{...g,protocol:`/${g.protocolPrefix??defaultValues.protocolPrefix}/${MULTICODEC_IDENTIFY_PROTOCOL_NAME}/${MULTICODEC_IDENTIFY_PROTOCOL_VERSION}`,log:u.logger.forComponent("libp2p:identify")}),(g.runOnConnectionOpen??defaultValues.runOnConnectionOpen)&&u.events.addEventListener("connection:open",v=>{const b=v.detail;this.identify(b).catch(()=>{})})}[serviceCapabilities]=["@libp2p/identify"];async _identify(u,g={}){let v,b;if(g.signal==null){const w=AbortSignal.timeout(this.timeout);g={...g,signal:w}}this.log("run identify on new connection %a",u.remoteAddr);try{v=await u.newStream(this.protocol,{...g,runOnLimitedConnection:this.runOnLimitedConnection}),b=v.log.newScope("identify");const w=pbStream(v,{maxDataLength:this.maxMessageSize}).pb(Identify$1),E=await w.read(g);return await w.unwrap().unwrap().close(g),E}catch(w){throw b?.error("identify failed - %e",w),v?.abort(w),w}}async identify(u,g={}){const v=await this._identify(u,g),{publicKey:b,protocols:w,observedAddr:E}=v;if(b==null)throw new InvalidMessageError("Public key was missing from identify message");const S=publicKeyFromProtobuf(b),A=peerIdFromCID(S.toCID());if(!u.remotePeer.equals(A))throw new InvalidMessageError("Identified peer does not match the expected peer");if(this.components.peerId.equals(A))throw new InvalidMessageError("Identified peer is our own peer id?");return this.maybeAddObservedAddress(E),this.log("completed for peer %p and protocols %o",A,w),consumeIdentifyMessage(this.components.peerStore,this.components.events,this.log,u,v)}maybeAddObservedAddress(u){const g=getCleanMultiaddr(u);if(g==null||(this.log.trace("our observed address was %a",g),isPrivate(g)))return;const v=g.getComponents();if((v[0].code===CODE_IP6||v[0].code===CODE_IP6ZONE&&v[1].code===CODE_IP6)&&!isGlobalUnicast(g)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}TCP.exactMatch(g)||(this.log.trace("storing the observed address"),this.components.addressManager.addObservedAddr(g))}async handleProtocol(u,g){const v=u.log.newScope("identify");v("responding to identify");const b=AbortSignal.timeout(this.timeout),w=await this.components.peerStore.get(this.components.peerId,{signal:b}),E=this.components.addressManager.getAddresses().map(R=>R.decapsulateCode(CODE_P2P));let S=w.peerRecordEnvelope;if(E.length>0&&S==null){const R=new PeerRecord({peerId:this.components.peerId,multiaddrs:E});S=(await RecordEnvelope.seal(R,this.components.privateKey,{signal:b})).marshal().subarray()}let A=g.remoteAddr.bytes;IP_OR_DOMAIN.matches(g.remoteAddr)||(A=void 0);const $=pbStream(u).pb(Identify$1);v("send response"),await $.write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:publicKeyToProtobuf(this.components.privateKey.publicKey),listenAddrs:E.map(R=>R.bytes),signedPeerRecord:S,observedAddr:A,protocols:w.protocols},{signal:b}),v("close write"),await $.unwrap().unwrap().close({signal:b})}}function identify(y={}){return u=>new Identify(u,y)}function identifyPush(y={}){return u=>new IdentifyPush(u,y)}const second=1e3,minute=60*second,hour=60*minute,PROTOCOL="/ipfs/kad/1.0.0",PROVIDERS_VALIDITY=48*hour,REPROVIDE_THRESHOLD=24*hour,REPROVIDE_CONCURRENCY=10,REPROVIDE_MAX_QUEUE_SIZE=16384,REPROVIDE_INTERVAL=hour,REPROVIDE_TIMEOUT=hour,ON_PEER_CONNECT_TIMEOUT=10*second,K=20,ALPHA=10,QUERY_SELF_INTERVAL=5*minute,QUERY_SELF_INITIAL_INTERVAL=second,QUERY_SELF_TIMEOUT=5*second,TABLE_REFRESH_INTERVAL=5*minute,TABLE_REFRESH_QUERY_TIMEOUT=30*second,DEFAULT_QUERY_TIMEOUT=180*second,KEEP_ALIVE_TAG=`${KEEP_ALIVE}-kad-dht`;var Record$1;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.key!=null&&g.key.byteLength>0&&(v.uint32(10),v.bytes(g.key)),g.value!=null&&g.value.byteLength>0&&(v.uint32(18),v.bytes(g.value)),g.timeReceived!=null&&g.timeReceived!==""&&(v.uint32(42),v.string(g.timeReceived)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={key:alloc$2(0),value:alloc$2(0),timeReceived:""},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.key=g.bytes();break}case 2:{w.value=g.bytes();break}case 5:{w.timeReceived=g.string();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Record$1||(Record$1={}));function toRFC3339(y){const u=y.getUTCFullYear(),g=String(y.getUTCMonth()+1).padStart(2,"0"),v=String(y.getUTCDate()).padStart(2,"0"),b=String(y.getUTCHours()).padStart(2,"0"),w=String(y.getUTCMinutes()).padStart(2,"0"),E=String(y.getUTCSeconds()).padStart(2,"0"),S=y.getUTCMilliseconds(),A=String(S*1e3*1e3).padStart(9,"0");return`${u}-${g}-${v}T${b}:${w}:${E}.${A}Z`}function parseRFC3339(y){const u=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),g=String(y).trim().match(u);if(g==null)throw new Error("Invalid format");const v=parseInt(g[1],10),b=parseInt(g[2],10)-1,w=parseInt(g[3],10),E=parseInt(g[4],10),S=parseInt(g[5],10),A=parseInt(g[6],10),$=parseInt(g[7].slice(0,-6),10);return new Date(Date.UTC(v,b,w,E,S,A,$))}class Libp2pRecord{key;value;timeReceived;constructor(u,g,v){if(!(u instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(g instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=u,this.value=g,this.timeReceived=v}serialize(){return Record$1.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:toRFC3339(this.timeReceived)}}static deserialize(u){const g=Record$1.decode(u);return new Libp2pRecord(g.key,g.value,new Date(g.timeReceived))}static fromDeserialized(u){const g=parseRFC3339(u.timeReceived);if(u.key==null)throw new Error("key missing from deserialized object");if(u.value==null)throw new Error("value missing from deserialized object");return new Libp2pRecord(u.key,u.value,g)}}class QueryError extends Error{constructor(u="Query error"){super(u),this.name="QueryError"}}class InvalidRecordError extends Error{constructor(u="Invalid record"){super(u),this.name="InvalidRecordError"}}class MissingSelectorError extends Error{constructor(u="No selector function configured for prefix"){super(u),this.name="MissingSelectorError"}}var Record;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),g.key!=null&&(v.uint32(10),v.bytes(g.key)),g.value!=null&&(v.uint32(18),v.bytes(g.value)),g.author!=null&&(v.uint32(26),v.bytes(g.author)),g.signature!=null&&(v.uint32(34),v.bytes(g.signature)),g.timeReceived!=null&&(v.uint32(42),v.string(g.timeReceived)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.key=g.bytes();break}case 2:{w.value=g.bytes();break}case 3:{w.author=g.bytes();break}case 4:{w.signature=g.bytes();break}case 5:{w.timeReceived=g.string();break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Record||(Record={}));var MessageType;(function(y){y.PUT_VALUE="PUT_VALUE",y.GET_VALUE="GET_VALUE",y.ADD_PROVIDER="ADD_PROVIDER",y.GET_PROVIDERS="GET_PROVIDERS",y.FIND_NODE="FIND_NODE",y.PING="PING"})(MessageType||(MessageType={}));var __MessageTypeValues;(function(y){y[y.PUT_VALUE=0]="PUT_VALUE",y[y.GET_VALUE=1]="GET_VALUE",y[y.ADD_PROVIDER=2]="ADD_PROVIDER",y[y.GET_PROVIDERS=3]="GET_PROVIDERS",y[y.FIND_NODE=4]="FIND_NODE",y[y.PING=5]="PING"})(__MessageTypeValues||(__MessageTypeValues={}));(function(y){y.codec=()=>enumeration(__MessageTypeValues)})(MessageType||(MessageType={}));var ConnectionType;(function(y){y.NOT_CONNECTED="NOT_CONNECTED",y.CONNECTED="CONNECTED",y.CAN_CONNECT="CAN_CONNECT",y.CANNOT_CONNECT="CANNOT_CONNECT"})(ConnectionType||(ConnectionType={}));var __ConnectionTypeValues;(function(y){y[y.NOT_CONNECTED=0]="NOT_CONNECTED",y[y.CONNECTED=1]="CONNECTED",y[y.CAN_CONNECT=2]="CAN_CONNECT",y[y.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(__ConnectionTypeValues||(__ConnectionTypeValues={}));(function(y){y.codec=()=>enumeration(__ConnectionTypeValues)})(ConnectionType||(ConnectionType={}));var PeerInfo;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{if(b.lengthDelimited!==!1&&v.fork(),g.id!=null&&g.id.byteLength>0&&(v.uint32(10),v.bytes(g.id)),g.multiaddrs!=null)for(const w of g.multiaddrs)v.uint32(18),v.bytes(w);g.connection!=null&&(v.uint32(24),ConnectionType.codec().encode(g.connection,v)),b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={id:alloc$2(0),multiaddrs:[]},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.id=g.bytes();break}case 2:{if(b.limits?.multiaddrs!=null&&w.multiaddrs.length===b.limits.multiaddrs)throw new MaxLengthError('Decode error - map field "multiaddrs" had too many elements');w.multiaddrs.push(g.bytes());break}case 3:{w.connection=ConnectionType.codec().decode(g);break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(PeerInfo||(PeerInfo={}));var Message$2;(function(y){let u;y.codec=()=>(u==null&&(u=message((g,v,b={})=>{if(b.lengthDelimited!==!1&&v.fork(),g.type!=null&&__MessageTypeValues[g.type]!==0&&(v.uint32(8),MessageType.codec().encode(g.type,v)),g.clusterLevel!=null&&(v.uint32(80),v.int32(g.clusterLevel)),g.key!=null&&(v.uint32(18),v.bytes(g.key)),g.record!=null&&(v.uint32(26),v.bytes(g.record)),g.closer!=null)for(const w of g.closer)v.uint32(66),PeerInfo.codec().encode(w,v);if(g.providers!=null)for(const w of g.providers)v.uint32(74),PeerInfo.codec().encode(w,v);b.lengthDelimited!==!1&&v.ldelim()},(g,v,b={})=>{const w={type:MessageType.PUT_VALUE,closer:[],providers:[]},E=v==null?g.len:g.pos+v;for(;g.pos<E;){const S=g.uint32();switch(S>>>3){case 1:{w.type=MessageType.codec().decode(g);break}case 10:{w.clusterLevel=g.int32();break}case 2:{w.key=g.bytes();break}case 3:{w.record=g.bytes();break}case 8:{if(b.limits?.closer!=null&&w.closer.length===b.limits.closer)throw new MaxLengthError('Decode error - map field "closer" had too many elements');w.closer.push(PeerInfo.codec().decode(g,g.uint32(),{limits:b.limits?.closer$}));break}case 9:{if(b.limits?.providers!=null&&w.providers.length===b.limits.providers)throw new MaxLengthError('Decode error - map field "providers" had too many elements');w.providers.push(PeerInfo.codec().decode(g,g.uint32(),{limits:b.limits?.providers$}));break}default:{g.skipType(S&7);break}}}return w})),u),y.encode=g=>encodeMessage$1(g,y.codec()),y.decode=(g,v)=>decodeMessage$1(g,y.codec(),v)})(Message$2||(Message$2={}));function sendQueryEvent(y,u={}){const g={...y,name:"SEND_QUERY",type:0,messageName:y.type,messageType:y.type};return u.onProgress?.(new CustomEvent("kad-dht:query:send-query",{detail:g})),g}function peerResponseEvent(y,u={}){const g={...y,name:"PEER_RESPONSE",type:1,messageName:y.messageType,closer:y.closer??[],providers:y.providers??[]};return u.onProgress?.(new CustomEvent("kad-dht:query:peer-response",{detail:g})),g}function finalPeerEvent(y,u={}){const g={...y,name:"FINAL_PEER",type:2};return u.onProgress?.(new CustomEvent("kad-dht:query:final-peer",{detail:g})),g}function queryErrorEvent(y,u={}){const g={...y,name:"QUERY_ERROR",type:3};return u.onProgress?.(new CustomEvent("kad-dht:query:query-error",{detail:g})),g}function providerEvent(y,u={}){const g={...y,name:"PROVIDER",type:4};return u.onProgress?.(new CustomEvent("kad-dht:query:provider",{detail:g})),g}function valueEvent(y,u={}){const g={...y,name:"VALUE",type:5};return u.onProgress?.(new CustomEvent("kad-dht:query:value",{detail:g})),g}function dialPeerEvent(y,u={}){const g={...y,name:"DIAL_PEER",type:7};return u.onProgress?.(new CustomEvent("kad-dht:query:dial-peer",{detail:g})),g}function pathEndedEvent(y,u={}){const g={...y,name:"PATH_ENDED",type:8};return u.onProgress?.(new CustomEvent("kad-dht:query:path-ended",{detail:g})),g}function bestRecord(y,u,g){if(g.length===0)throw new InvalidParametersError$1("No records given");const b=toString$3(u).split("/");if(b.length<3)throw new InvalidParametersError$1("Record key does not have a selector function");const w=y[b[1].toString()];if(w==null)throw new MissingSelectorError(`No selector function configured for key type "${b[1]}"`);return g.length===1?0:w(u,g)}function publicKey(y,u){return 0}const selectors={pk:publicKey};async function verifyRecord(y,u,g){const v=u.key,w=toString$3(v).split("/");if(w.length<3)return;const E=y[w[1].toString()];if(E==null)throw new InvalidParametersError$1(`No validator available for key type "${w[1]}"`);await E(v,u.value,g)}const validatePublicKeyRecord=async(y,u,g)=>{if(!(y instanceof Uint8Array))throw new InvalidParametersError$1('"key" must be a Uint8Array');if(y.byteLength<5)throw new InvalidParametersError$1("Invalid public key record");if(toString$3(y.subarray(0,4))!=="/pk/")throw new InvalidParametersError$1("key was not prefixed with /pk/");const b=publicKeyFromProtobuf(u),w=y.slice(4);if(!equals(w,b.toMultihash().bytes))throw new InvalidParametersError$1("public key does not match passed in key")},validators={pk:validatePublicKeyRecord},PK_PREFIX=fromString$1("/pk/");function removePrivateAddressesMapper(y){return{...y,multiaddrs:y.multiaddrs.filter(u=>!isPrivate(u))}}async function convertBuffer(y,u){const g=await sha256$4.digest(y);return u?.signal?.throwIfAborted(),g.digest}async function convertPeerId(y,u){return convertBuffer(y.toMultihash().bytes,u)}function bufferToRecordKey(y,u){return new Key(`${y}/${toString$3(u,"base32")}`,!1)}function keyForPublicKey(y){return concat$2([PK_PREFIX,y.toMultihash().bytes])}function isPublicKeyKey(y){return toString$3(y.subarray(0,4))==="/pk/"}function fromPublicKeyKey(y){const u=decode$8(y.subarray(4));return peerIdFromMultihash(u)}function createPutRecord(y,u){const g=new Date;return new Libp2pRecord(y,u,g).serialize()}function parseProviderKey(y){const u=y.toString().split("/"),g=u.pop(),v=u.pop();if(g==null||v==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${y.toString()}`);return{cid:CID.createV1(code$5,decode$8(fromString$1(v,"base32"))),peerId:peerIdFromString$1(g)}}function toProviderKey(y,u,g){const v=typeof u=="string"?u:toString$3(u.multihash.bytes,"base32"),b=[y,v];return g!=null&&b.push(g.toString()),new Key(b.join("/"))}function readProviderTime(y){return new Date(decode$7(y))}function timeOperationGenerator(y,u,g){return async function*(...v){const b=u.queryTime?.timer(g),w=u.errorTime?.timer(g);let E=!1;try{u.queries?.increment({[g]:!0}),yield*y(...v)}catch(S){throw E=!0,w?.(),u.errors?.increment({[g]:!0}),S}finally{u.queries?.decrement({[g]:!0}),E||b?.()}}}function timeOperationMethod(y,u,g){return async function(...v){const b=u?.queryTime?.timer(g),w=u?.errorTime?.timer(g);let E=!1;try{return u.queries?.increment({[g]:!0}),await y(...v)}catch(S){throw E=!0,w?.(),u.errors?.increment({[g]:!0}),S}finally{u.queries?.decrement({[g]:!0}),E||b?.()}}}class ContentFetching{log;components;validators;selectors;peerRouting;queryManager;network;datastorePrefix;constructor(u,g){const{validators:v,selectors:b,peerRouting:w,queryManager:E,network:S,logPrefix:A}=g;this.components=u,this.log=u.logger.forComponent(`${A}:content-fetching`),this.datastorePrefix=`${g.datastorePrefix}/record`,this.validators=v,this.selectors=b,this.peerRouting=w,this.queryManager=E,this.network=S,this.get=u.metrics?.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1})??this.get,this.put=u.metrics?.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2})??this.put}async getLocal(u,g){this.log("getLocal %b",u);const v=bufferToRecordKey(this.datastorePrefix,u);this.log("fetching record for key %k",v);const b=await this.components.datastore.get(v,g);this.log("found %k in local datastore",v);const w=Libp2pRecord.deserialize(b);return await verifyRecord(this.validators,w,g),w}async*sendCorrectionRecord(u,g,v,b){this.log("sendCorrection for %b",u);const w=createPutRecord(u,v);for(const{value:E,from:S}of g){if(equals(E,v)){this.log("record was ok");continue}if(this.components.peerId.equals(S)){try{const R=bufferToRecordKey(this.datastorePrefix,u);this.log(`Storing corrected record for key ${R.toString()}`),await this.components.datastore.put(R,w.subarray(),b)}catch(R){this.log.error("failed error correcting self - %e",R)}continue}let A=!1;const $={type:MessageType.PUT_VALUE,key:u,record:w};for await(const R of this.network.sendRequest(S,$,b))R.name==="PEER_RESPONSE"&&R.record!=null&&equals(R.record.value,Libp2pRecord.deserialize(w).value)&&(A=!0),yield R;if(!A)throw new QueryError("Could not send correction");this.log.error("failed error correcting entry")}}async*put(u,g,v){this.log("put key %b value %b",u,g);const b=createPutRecord(u,g),w=bufferToRecordKey(this.datastorePrefix,u);this.log(`storing record for key ${w.toString()}`),await this.components.datastore.put(w,b.subarray(),v),yield*pipe$1(this.peerRouting.getClosestPeers(u,{...v,signal:v.signal}),E=>map(E,S=>async()=>{if(S.name!=="FINAL_PEER")return[S];const A=[],$={type:MessageType.PUT_VALUE,key:u,record:b};this.log("send put to %p",S.peer.id);for await(const R of this.network.sendRequest(S.peer.id,$,{...v,path:S.path}))A.push(R),R.name==="PEER_RESPONSE"&&(R.record!=null&&equals(R.record.value,Libp2pRecord.deserialize(b).value)||A.push(queryErrorEvent({from:S.peer.id,error:new QueryError("Value not put correctly"),path:R.path},v)));return A}),E=>parallel(E,{ordered:!1,concurrency:ALPHA}),async function*(E){for await(const S of E)yield*S})}async*get(u,g){this.log("get %b",u);const v=[];for await(const S of this.getMany(u,g)){if(S.name==="VALUE"){v.push(S);continue}yield S}if(v.length===0)return;const b=v.map(S=>S.value);let w=0;try{w=bestRecord(this.selectors,u,b)}catch(S){if(S.name!=="InvalidParametersError")throw S}const E=b[w];if(this.log("GetValue %b %b",u,E),E==null)throw new NotFoundError$1("Best value was not found");yield*this.sendCorrectionRecord(u,v,E,{...g,path:{index:-1,queued:0,running:0,total:0}}),yield v[w]}async*getMany(u,g={}){this.log("getMany values for %b",u);try{const w=await this.getLocal(u,g);yield valueEvent({value:w.value,from:this.components.peerId,path:{index:-1,running:0,queued:0,total:0}},g)}catch(w){this.log("error getting local value for %b",u,w)}const v=this,b=async function*({peer:w,signal:E,path:S}){for await(const A of v.peerRouting.getValueOrPeers(w.id,u,{...g,signal:E,path:S}))yield A,A.name==="PEER_RESPONSE"&&A.record!=null&&(yield valueEvent({from:w.id,value:A.record.value,path:S},g))};yield*this.queryManager.run(u,b,g)}}function toPbPeerInfo(y,u){return{id:y.id.toMultihash().bytes,multiaddrs:(y.multiaddrs??[]).map(v=>v.bytes),connection:u}}function fromPbPeerInfo(y){if(y.id==null)throw new Error("Invalid peer in message");const u=decode$8(y.id);return{id:peerIdFromMultihash(u),multiaddrs:(y.multiaddrs??[]).map(g=>multiaddr(g))}}class ContentRouting{log;components;network;peerRouting;queryManager;routingTable;providers;constructor(u,g){const{network:v,peerRouting:b,queryManager:w,routingTable:E,providers:S,logPrefix:A}=g;this.components=u,this.log=u.logger.forComponent(`${A}:content-routing`),this.network=v,this.peerRouting=b,this.queryManager=w,this.routingTable=E,this.providers=S,this.findProviders=u.metrics?.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:($,R)=>($.name==="PROVIDER"&&(R.providers??=[],R.providers.push(...$.providers.map(T=>T.id.toString()))),R)})??this.findProviders,this.provide=u.metrics?.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:($,R)=>($.name==="PEER_RESPONSE"&&$.messageName==="ADD_PROVIDER"&&(R.providers??=[],R.providers.push($.from.toString())),R)})??this.provide}async*provide(u,g,v={}){this.log("provide %s",u);const b=u.multihash.bytes;await this.providers.addProvider(u,this.components.peerId,v);const w={type:MessageType.ADD_PROVIDER,key:b,providers:[toPbPeerInfo({id:this.components.peerId,multiaddrs:g})]};let E=0;const S=this;async function*A(T){try{S.log("sending provider record for %s to %p",u,T.peer.id);for await(const O of S.network.sendMessage(T.peer.id,w,{...v,path:T.path}))O.name==="PEER_RESPONSE"&&(S.log("sent provider record for %s to %p",u,T.peer.id),E++),yield O}catch(O){S.log.error("error sending provide record to peer %p - %e",T.peer.id,O),yield queryErrorEvent({from:T.peer.id,error:O,path:T.path},v)}}const $=pushable({objectMode:!0}),R=new Queue$1({concurrency:ALPHA});R.addEventListener("idle",()=>{$.end()}),R.addEventListener("failure",T=>{this.log.error("error publishing provider record to peer - %e",T.detail.error)}),R.add(async()=>{const T=[];for await(const O of this.peerRouting.getClosestPeers(b,v))$.push(O),O.name==="FINAL_PEER"&&T.push(O);T.forEach(O=>{R.add(async()=>{for await(const B of A(O))$.push(B)}).catch(B=>{this.log.error("error publishing provider record to peer - %e",B)})})}).catch(T=>{$.end(T)}),yield*$,this.log("sent provider records to %d peers",E)}async*findProviders(u,g){const v=this.routingTable.kBucketSize;let b=0;const w=u.multihash.bytes,E=this;this.log("findProviders %c",u);const S=await this.providers.getProviders(u,g);if(S.length>0){const R=[];for(const T of S.slice(0,v))try{const O=await this.components.peerStore.get(T,g);R.push({id:T,multiaddrs:O.addresses.map(({multiaddr:B})=>B)})}catch(O){if(O.name!=="NotFoundError")throw O;this.log("no peer store entry for %p",T)}if(yield peerResponseEvent({from:this.components.peerId,messageType:MessageType.GET_PROVIDERS,providers:R,path:{index:-1,queued:0,running:0,total:0}},g),yield providerEvent({from:this.components.peerId,providers:R,path:{index:-1,queued:0,running:0,total:0}},g),b+=R.length,b>=v)return}const A=async function*({peer:R,signal:T,path:O}){const B={type:MessageType.GET_PROVIDERS,key:w};yield*E.network.sendRequest(R.id,B,{...g,signal:T,path:O})},$=new PeerSet(S);for await(const R of this.queryManager.run(w,A,g))if(yield R,R.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",R.providers.length,u,R.closer.length);const T=[];for(const O of R.providers)$.has(O.id)||($.add(O.id),T.push(O));if(T.length>0&&(yield providerEvent({from:R.from,providers:T,path:R.path},g),b+=T.length,b>=v))return}}}class Network extends TypedEventEmitter{log;protocol;running;components;timeout;metrics;constructor(u,g){super(),this.components=u,this.log=u.logger.forComponent(`${g.logPrefix}:network`),this.running=!1,this.protocol=g.protocol,this.timeout=new AdaptiveTimeout({...g.timeout??{},metrics:u.metrics,metricName:`${g.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:u.metrics?.registerCounterGroup(`${g.metricsPrefix}_outbound_rpc_requests_total`),errors:u.metrics?.registerCounterGroup(`${g.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=u.metrics?.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([v,b],w){return{...w,to:v.toString(),"message type":`${b.type}`}},getAttributesFromYieldedValue:(v,b)=>(v.name==="PEER_RESPONSE"&&(v.providers.length>0&&v.providers.forEach((w,E)=>{b[`providers-${E}`]=w.id.toString()}),v.closer.length>0&&v.closer.forEach((w,E)=>{b[`closer-${E}`]=w.id.toString()})),b)})??this.sendRequest,this.sendMessage=u.metrics?.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([v,b],w){return{...w,to:v.toString(),"message type":`${b.type}`}},getAttributesFromYieldedValue:(v,b)=>(v.name==="PEER_RESPONSE"&&(v.providers.length>0&&v.providers.forEach((w,E)=>{b[`providers-${E}`]=w.id.toString()}),v.closer.length>0&&v.closer.forEach((w,E)=>{b[`closer-${E}`]=w.id.toString()})),b)})??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(u,g,v){if(!this.running)return;const b=g.type;if(b==null)throw new InvalidParametersError$1("Message type was missing");let w;const E=this.timeout.getTimeoutSignal(v);v={...v,signal:E};try{this.metrics.operations?.increment({[b]:!0}),this.log("dialling %p",u),yield dialPeerEvent({peer:u,path:v.path},v),w=await this.components.connectionManager.openStream(u,this.protocol,v),this.log("sending %s to %p",g.type,u),yield sendQueryEvent({to:u,type:b,path:v.path},v);const S=await this._writeReadMessage(w,g,v);w.close(v).catch(A=>{this.log.error("error closing stream to %p - %e",u,A),w?.abort(A)}),yield peerResponseEvent({from:u,messageType:S.type,closer:S.closer.map(fromPbPeerInfo),providers:S.providers.map(fromPbPeerInfo),record:S.record==null?void 0:Libp2pRecord.deserialize(S.record),path:v.path},v)}catch(S){this.metrics.errors?.increment({[b]:!0}),w?.abort(S),v.signal?.aborted!==!0&&this.log.error("could not send %s to %p - %e",g.type,u,S),yield queryErrorEvent({from:u,error:S,path:v.path},v)}finally{this.timeout.cleanUp(E)}}async*sendMessage(u,g,v){if(!this.running)return;const b=g.type;if(b==null)throw new InvalidParametersError$1("Message type was missing");let w;const E=this.timeout.getTimeoutSignal(v);v={...v,signal:E};try{this.metrics.operations?.increment({[b]:!0}),this.log("dialling %p",u),yield dialPeerEvent({peer:u,path:v.path},v),w=await this.components.connectionManager.openStream(u,this.protocol,v),this.log("sending %s to %p",g.type,u),yield sendQueryEvent({to:u,type:b,path:v.path},v),await this._writeMessage(w,g,v),w.close(v).catch(S=>{this.log.error("error closing stream to %p - %e",u,S),w?.abort(S)}),yield peerResponseEvent({from:u,messageType:b,path:v.path},v)}catch(S){this.metrics.errors?.increment({[b]:!0}),w?.abort(S),yield queryErrorEvent({from:u,error:S,path:v.path},v)}finally{this.timeout.cleanUp(E)}}async _writeMessage(u,g,v){await pbStream(u).write(g,Message$2,v)}async _writeReadMessage(u,g,v){const b=pbStream(u);await b.write(g,Message$2,v);const w=await b.read(Message$2,v);return w.closer.forEach(E=>{this.safeDispatchEvent("peer",{detail:fromPbPeerInfo(E)})}),w.providers.forEach(E=>{this.safeDispatchEvent("peer",{detail:fromPbPeerInfo(E)})}),w}}function xorCompare(y,u){if(y.byteLength!==u.byteLength)throw new Error("Inputs should have the same length");for(let g=0;g<y.byteLength;g++)if(y[g]!==u[g])return y[g]<u[g]?-1:1;return 0}class PeerDistanceList{originDhtKey;capacity;peerDistances;constructor(u,g){this.originDhtKey=u,this.capacity=g,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return[...this.peerDistances]}async add(u,g={index:-1,queued:0,running:0,total:0},v){const b=await convertPeerId(u.id,v);this.addWithKadId(u,b,g)}addWithKadId(u,g,v={index:-1,queued:0,running:0,total:0}){if(this.peerDistances.find(E=>E.peer.id.equals(u.id))!=null)return;const b={peer:u,distance:xor(this.originDhtKey,g),path:v};if(this.peerDistances.length===this.capacity){const E=this.peerDistances[this.peerDistances.length-1];if(E!=null&&xorCompare(b.distance,E.distance)!==-1)return}let w=!1;for(let E=0;E<this.peerDistances.length;E++){const S=xorCompare(this.peerDistances[E].distance,b.distance);if(S===0||S===1){w=!0,this.peerDistances.splice(E,0,b);break}}w||this.peerDistances.push(b),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(u,g){if(this.length===0)return!0;const v=await convertPeerId(u,g),b=xor(v,this.originDhtKey),w=this.peerDistances[this.peerDistances.length-1].distance;return xorCompare(b,w)===-1}async anyCloser(u,g){return u.length===0?!1:Promise.any(u.map(async v=>this.isCloser(v,g)))}}class PeerRouting{log;routingTable;network;validators;queryManager;components;constructor(u,g){this.routingTable=g.routingTable,this.network=g.network,this.validators=g.validators,this.queryManager=g.queryManager,this.components=u,this.log=u.logger.forComponent(`${g.logPrefix}:peer-routing`),this.findPeer=u.metrics?.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=u.metrics?.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}async findPeerLocal(u,g){let v;const b=await this.routingTable.find(u,g);if(b!=null){this.log("findPeerLocal found %p in routing table",u);try{v=await this.components.peerStore.get(b,g)}catch(w){if(w.name!=="NotFoundError")throw w}}if(v==null)try{v=await this.components.peerStore.get(u,g)}catch(w){if(w.name!=="NotFoundError")throw w}if(v!=null)return this.log("findPeerLocal found %p in peer store",u),{id:v.id,multiaddrs:v.addresses.map(w=>w.multiaddr)}}async*_getValueSingle(u,g,v){const b={type:MessageType.GET_VALUE,key:g};yield*this.network.sendRequest(u,b,v)}async*getPublicKeyFromNode(u,g={}){const v=keyForPublicKey(u),b={index:-1,queued:0,running:0,total:0};for await(const w of this._getValueSingle(u,v,{...g,path:b}))if(yield w,w.name==="PEER_RESPONSE"&&w.record!=null){const E=publicKeyFromProtobuf(w.record.value),S=peerIdFromPublicKey(E);if(!S.equals(u))throw new InvalidPublicKeyError("public key does not match id");if(S.publicKey==null)throw new InvalidPublicKeyError("public key missing");yield valueEvent({from:u,value:w.record.value,path:b},g)}throw new QueryError(`Node not responding with its public key: ${u.toString()}`)}async*findPeer(u,g={}){if(this.log("findPeer %p",u),g.useCache!==!1){const b=await this.findPeerLocal(u,g);if(b!=null){this.log("found local"),yield finalPeerEvent({from:this.components.peerId,peer:b,path:{index:-1,queued:0,running:0,total:0}},g);return}}let v=!1;if(g.useNetwork!==!1){const b=this,w=async function*({peer:E,signal:S,path:A}){const $={type:MessageType.FIND_NODE,key:u.toMultihash().bytes};for await(const R of b.network.sendRequest(E.id,$,{...g,signal:S,path:A}))if(yield R,R.name==="PEER_RESPONSE"){const T=R.closer.find(O=>O.id.equals(u));T!=null&&(yield finalPeerEvent({from:R.from,peer:T,path:R.path},g))}};for await(const E of this.queryManager.run(u.toMultihash().bytes,w,g))E.name==="FINAL_PEER"&&(v=!0),yield E}if(!v)throw new NotFoundError$1("Not found")}async*getClosestPeers(u,g={}){this.log("getClosestPeers to %b",u);const v=await convertBuffer(u,g),b=new PeerDistanceList(v,this.routingTable.kBucketSize),w=this,E=async function*({peer:S,path:A,peerKadId:$,signal:R}){w.log("getClosestPeers asking %p",S.id);const T={type:MessageType.FIND_NODE,key:u};yield*w.network.sendRequest(S.id,T,{...g,signal:R,path:A}),b.addWithKadId(S,$,A)};yield*this.queryManager.run(u,E,g),this.log("found %d peers close to %b",b.length,u);for(let{peer:S,path:A}of b.peers)try{if(S.multiaddrs.length===0&&(S=await w.components.peerStore.getInfo(S.id,g)),S.multiaddrs.length===0)continue;yield finalPeerEvent({from:this.components.peerId,peer:await w.components.peerStore.getInfo(S.id,g),path:{index:A.index,queued:0,running:0,total:0}},g)}catch{continue}}async*getValueOrPeers(u,g,v){for await(const b of this._getValueSingle(u,g,v)){if(b.name==="PEER_RESPONSE"&&b.record!=null)try{await this._verifyRecordOnline(b.record,v)}catch{const E="invalid record received, discarded";this.log(E),yield queryErrorEvent({from:b.from,error:new QueryError(E),path:v.path},v);continue}yield b}}async _verifyRecordOnline(u,g){if(u.timeReceived==null)throw new InvalidRecordError("invalid record received");await verifyRecord(this.validators,new Libp2pRecord(u.key,u.value,u.timeReceived),g)}async getClosestPeersOffline(u,g){const v=[];try{const E=decode$8(u),S=peerIdFromMultihash(E),A=await this.components.peerStore.get(S,g);v.push({id:A.id,multiaddrs:A.addresses.map(({multiaddr:$})=>$)})}catch{}const b=await convertBuffer(u,g),w=this.routingTable.closestPeers(b,g);for(const E of w)try{v.push(await this.components.peerStore.getInfo(E,g))}catch(S){if(S.name!=="NotFoundError")throw S}return v.length>0?this.log("getClosestPeersOffline returning the %d closest peer(s) we know to %b",v.length,u):this.log("getClosestPeersOffline could not any peers close to %b with %d peers in the routing table",u,this.routingTable.size),v}}class Providers{log;datastore;datastorePrefix;constructor(u,g){this.log=u.logger.forComponent(`${g.logPrefix}:providers`),this.datastorePrefix=`${g.datastorePrefix}/provider`,this.datastore=u.datastore}async addProvider(u,g,v){this.log.trace("%p provides %s",g,u),await this.writeProviderEntry(u,g,v)}async removeProvider(u,g,v){const b=toProviderKey(this.datastorePrefix,u,g);this.log.trace("%p no longer provides %s",g,u),await this.datastore.delete(b,v)}async getProviders(u,g){this.log.trace("get providers for %c",u);const v=await this.loadProviders(u,g);return this.log.trace("got %d providers for %c",v.size,u),[...v.keys()]}async writeProviderEntry(u,g,v){const b=toProviderKey(this.datastorePrefix,u,g),w=encode$9(v?.time?.getTime()??Date.now());await this.datastore.put(b,w,v)}async loadProviders(u,g){const v=new PeerMap,b=toProviderKey(this.datastorePrefix,u);for await(const w of this.datastore.query({prefix:b.toString()},g)){const{peerId:E}=parseProviderKey(w.key);v.set(E,readProviderTime(w.value))}return v}}async function*queryPath(y){const{key:u,startingPeers:g,ourPeerId:v,query:b,alpha:w,path:E,numPaths:S,log:A,peersSeen:$,connectionManager:R,signal:T}=y,O=pushable({objectMode:!0}),B=new Queue$1({concurrency:w,sort:(U,q)=>xorCompare(U.options.distance,q.options.distance)});B.addEventListener("idle",()=>{O.push(pathEndedEvent({path:{index:E,queued:B.queued,running:B.running,total:B.size}},y)),O.end()}),B.addEventListener("failure",U=>{A.error("error during query - %e",U.detail.error)});const F=()=>{B.abort(),O.end(new AbortError$6)};T.addEventListener("abort",F);try{let q=function(J,ie){if(J==null)return;$.add(J.id.toMultihash().bytes);const oe=xor(ie,U);B.add(async()=>{try{for await(const le of b({...y,key:u,peer:J,path:{index:E,queued:B.queued,running:B.running,total:B.size},numPaths:S,peerKadId:ie,signal:T})){if(le.name==="PEER_RESPONSE")for(const de of le.closer){if($.has(de.id.toMultihash().bytes)){A("already seen %p in query",de.id);continue}if(v.equals(de.id)){A("not querying ourselves");continue}if(!await R.isDialable(de.multiaddrs)){A("not querying undialable peer");continue}const fe=await convertPeerId(de.id,{signal:T}),ye=xor(fe,U);if(xorCompare(ye,oe)!==-1){A("skipping %p as they are not closer to %b than %p",de.id,u,J.id);continue}A("querying closer peer %p",de.id),q(de,fe)}O.push({...le,path:{index:E,queued:B.queued,running:B.running,total:B.size}})}}catch(le){O.push(queryErrorEvent({from:J.id,error:le,path:{index:E,queued:B.queued,running:B.running-1,total:B.size-1}},y))}},{distance:oe}).catch(le=>{A.error("error during query - %e",le)})};const U=await convertBuffer(u,{signal:T});await Promise.all(g.map(async J=>{q({id:J,multiaddrs:[]},await convertPeerId(J,{signal:T}))})),yield*O}finally{T.removeEventListener("abort",F)}}class QueryManager{disjointPaths;alpha;shutDownController;running;logger;peerId;connectionManager;routingTable;initialQuerySelfHasRun;logPrefix;allowQueryWithZeroPeers;constructor(u,g){this.logPrefix=g.logPrefix,this.disjointPaths=g.disjointPaths??K,this.alpha=g.alpha??ALPHA,this.initialQuerySelfHasRun=g.initialQuerySelfHasRun,this.routingTable=g.routingTable,this.logger=u.logger,this.peerId=u.peerId,this.connectionManager=u.connectionManager,this.allowQueryWithZeroPeers=g.allowQueryWithZeroPeers??!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(u,g,v={}){if(!this.running)throw new Error("QueryManager not started");if(v.signal==null){const A=AbortSignal.timeout(DEFAULT_QUERY_TIMEOUT);v={...v,signal:A}}const b=new AbortController,w=anySignal([this.shutDownController.signal,b.signal,v.signal]);b.signal;const E=this.logger.forComponent(`${this.logPrefix}:query:`+toString$3(u,"base58btc"));let S=!1;try{this.routingTable.size===0&&!this.allowQueryWithZeroPeers&&(E("routing table was empty, waiting for some peers before running%s query",v.isSelfQuery===!0?" self":""),await pEvent(this.routingTable,"peer:add",{signal:w,filter:B=>!this.peerId.equals(B.detail)}),E("routing table has peers, continuing with%s query",v.isSelfQuery===!0?" self":"")),v.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(E("waiting for initial self query before continuing"),await raceSignal$2(this.initialQuerySelfHasRun.promise,w),this.initialQuerySelfHasRun=void 0),E("query:start");const A=await convertBuffer(u,{signal:w}),$=this.routingTable.closestPeers(A,{count:this.routingTable.kBucketSize}),R=$.sort(()=>Math.random()>.5?1:-1).reduce((B,F,U)=>(B[U%this.disjointPaths].push(F),B),new Array(this.disjointPaths).fill(0).map(()=>[])).filter(B=>B.length>0);if($.length===0){E.error("running query with no peers");return}const T=createScalableCuckooFilter(1024),O=R.map((B,F)=>queryPath({...v,key:u,startingPeers:B,ourPeerId:this.peerId,signal:w,query:g,path:F,numPaths:R.length,alpha:this.alpha,log:E,peersSeen:T,onProgress:v.onProgress,connectionManager:this.connectionManager}));for await(const B of merge$1(...O)){if(B.name==="QUERY_ERROR"&&E.error("query error - %e",B.error),B.name==="PEER_RESPONSE")for(const F of[...B.closer,...B.providers])await this.connectionManager.isDialable(F.multiaddrs,{signal:w})&&await this.routingTable.add(F.id,{signal:w});w.throwIfAborted(),yield B}S=!0}catch(A){if(this.running)throw A}finally{S||(E("query exited early"),b.abort()),w.clear(),E("query finished")}}}function isAsyncIterable(y){return y[Symbol.asyncIterator]!=null}function length(y){if(isAsyncIterable(y))return(async()=>{let u=0;for await(const g of y)u++;return u})();{let u=0;for(const g of y)u++;return u}}class QuerySelf{log;peerId;peerRouting;events;count;interval;initialInterval;queryTimeout;running;timeoutId;controller;initialQuerySelfHasRun;querySelfPromise;constructor(u,g){this.peerId=u.peerId,this.log=u.logger.forComponent(`${g.logPrefix}:query-self`),this.events=u.events,this.running=!1,this.peerRouting=g.peerRouting,this.count=g.count??K,this.interval=g.interval??QUERY_SELF_INTERVAL,this.initialInterval=g.initialInterval??QUERY_SELF_INITIAL_INTERVAL,this.queryTimeout=g.queryTimeout??QUERY_SELF_TIMEOUT,this.initialQuerySelfHasRun=g.initialQuerySelfHasRun,this.querySelf=timeOperationMethod(this.querySelf.bind(this),g.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(u=>{this.log.error("error running self-query - %e",u)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=pDefer(),this.running){this.controller=new AbortController;const u=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const v=AbortSignal.timeout(this.queryTimeout);u.push(v)}const g=anySignal(u);this.controller.signal;try{this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const v=Date.now(),b=await pipe$1(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:g,isSelfQuery:!0}),E=>take(E,this.count),async E=>length(E));g?.throwIfAborted();const w=Date.now()-v;this.log("self-query found %d peers in %dms",b,w),this.events.dispatchEvent(new CustomEvent("kad-dht:query:self",{detail:{peers:b,duration:w}}))}catch(v){this.log.error("self-query error - %e",v)}finally{g.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(u=>{this.log.error("error running self-query - %e",u)})},this.interval))}}class Reprovider extends TypedEventEmitter{log;reprovideQueue;maxQueueSize;datastore;timeout;reprovideTimeout;running;shutdownController;reprovideThreshold;contentRouting;datastorePrefix;addressManager;validity;interval;peerId;constructor(u,g){super(),this.log=u.logger.forComponent(`${g.logPrefix}:reprovider`),this.peerId=u.peerId,this.reprovideQueue=new Queue$1({concurrency:g.concurrency??REPROVIDE_CONCURRENCY,metrics:u.metrics,metricName:`${g.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new AdaptiveTimeout({...g.timeout??{},metrics:u.metrics,metricName:`${g.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=u.datastore,this.addressManager=u.addressManager,this.datastorePrefix=`${g.datastorePrefix}/provider`,this.reprovideThreshold=g.threshold??REPROVIDE_THRESHOLD,this.maxQueueSize=g.maxQueueSize??REPROVIDE_MAX_QUEUE_SIZE,this.validity=g.validity??PROVIDERS_VALIDITY,this.interval=g.interval??REPROVIDE_INTERVAL,this.contentRouting=g.contentRouting,this.running=!1,this.reprovide=timeOperationMethod(this.reprovide.bind(this),g.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.processRecords({signal:AbortSignal.timeout(REPROVIDE_TIMEOUT)}).catch(u=>{this.log.error("error running process to reprovide/cleanup - %e",u)})},this.interval))}stop(){this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),this.shutdownController?.abort()}async processRecords(u){try{this.safeDispatchEvent("reprovide:start"),this.log("starting reprovide/cleanup");for await(const g of this.datastore.query({prefix:this.datastorePrefix},u))try{const{cid:v,peerId:b}=parseProviderKey(g.key),E=readProviderTime(g.value).getTime()+this.validity,S=Date.now(),A=S>E,$=this.peerId.equals(b);this.log.trace("comparing: %d (now) < %d (expires) = %s %s",S,E,A,A?"(expired)":"(valid)"),A&&!$&&await this.datastore.delete(g.key,u),this.shouldReprovide($,E)&&(this.log("reproviding %c as it is within the reprovide threshold (%d)",v,this.reprovideThreshold),this.queueReprovide(v).catch(R=>{this.log.error("could not reprovide %c - %e",v,R)}))}catch(v){this.log.error("error processing datastore key %s - %s",g.key,v.message)}this.log("reprovide/cleanup successful")}finally{this.safeDispatchEvent("reprovide:end"),this.running&&(this.log("queuing next re-provide/cleanup run in %d ms",this.interval),this.timeout=setTimeout(()=>{this.processRecords({signal:AbortSignal.timeout(REPROVIDE_TIMEOUT)}).catch(g=>{this.log.error("error running re-provide - %e",g)})},this.interval))}}shouldReprovide(u,g){if(!u)return!1;const v=Date.now();return g<v?!0:g-v<this.reprovideThreshold}async queueReprovide(u,g){if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",u),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize,g);const v=this.reprovideQueue.queue.find(b=>b.options.cid.equals(u));if(v!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",u),v.join();this.log.trace("adding %c to re-provide queue",u),this.reprovideQueue.add(async b=>{if(b.signal?.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",u);const w=this.reprovideTimeout.getTimeoutSignal(b);try{await this.reprovide(b.cid,b)}finally{this.reprovideTimeout.cleanUp(w)}this.log.trace("re-provided %c",u)},{signal:this.shutdownController?.signal,cid:u}).catch(b=>{this.log.error("could not re-provide key %c - %e",u,b)})}async reprovide(u,g){await drain(this.contentRouting.provide(u,this.addressManager.getAddresses(),g))}}const PEER_SET_SIZE=20,REFRESH_INTERVAL=5e3,KAD_CLOSE_TAG_NAME="kad-close",KAD_CLOSE_TAG_VALUE=50;class ClosestPeers{routingTable;components;closestPeers;newPeers;refreshInterval;peerSetSize;timeout;closeTagName;closeTagValue;log;running;constructor(u,g){this.components=u,this.log=u.logger.forComponent(`${g.logPrefix}:routing-table`),this.routingTable=g.routingTable,this.refreshInterval=g.refreshInterval??REFRESH_INTERVAL,this.peerSetSize=g.peerSetSize??PEER_SET_SIZE,this.closeTagName=g.closeTagName??KAD_CLOSE_TAG_NAME,this.closeTagValue=g.closeTagValue??KAD_CLOSE_TAG_VALUE,this.closestPeers=new PeerSet,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const u=await convertPeerId(this.components.peerId);this.newPeers=new PeerDistanceList(u,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(g=>{this.log.error("error updating peer tags - %e",g)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(u){this.newPeers?.add({id:u.detail,multiaddrs:[]}).catch(g=>{this.log.error("error adding peer to distance list - %e",g)})}async updatePeerTags(){const u=new PeerSet(this.newPeers?.peers.map(({peer:b})=>b.id)),g=u.difference(this.closestPeers),v=this.closestPeers.difference(u);this.closestPeers=u,await Promise.all([...[...g].map(async b=>{await this.components.peerStore.merge(b,{tags:{[this.closeTagName]:{value:this.closeTagValue},[KEEP_ALIVE_TAG]:{value:1}}})}),...[...v].map(async b=>{await this.components.peerStore.merge(b,{tags:{[this.closeTagName]:void 0,[KEEP_ALIVE_TAG]:void 0}})})])}}function isLeafBucket(y){return Array.isArray(y?.peers)}class KBucket{peerId;root;localPeer;prefixLength;splitThreshold;kBucketSize;numberOfNodesToPing;lastPingThreshold;ping;verify;onAdd;onRemove;onMove;addingPeerMap;constructor(u,g){this.peerId=u.peerId,this.prefixLength=g.prefixLength??PREFIX_LENGTH,this.kBucketSize=g.kBucketSize??KBUCKET_SIZE,this.splitThreshold=g.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=g.numberOfOldContactsToPing??PING_OLD_CONTACT_COUNT,this.lastPingThreshold=g.lastPingThreshold??LAST_PING_THRESHOLD,this.ping=g.ping,this.verify=g.verify,this.onAdd=g.onAdd,this.onRemove=g.onRemove,this.addingPeerMap=trackedPeerMap({name:`${g.metricsPrefix}_adding_peer_map`,metrics:u.metrics}),this.root={prefix:"",depth:0,peers:[]}}async start(){await this.addSelfPeer(this.peerId)}stop(){this.addingPeerMap.clear(),this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(u,g){this.localPeer={peerId:u,kadId:await convertPeerId(u,g),lastPing:Date.now()}}async add(u,g){const v={peerId:u,kadId:await convertPeerId(u,g),lastPing:0},b=this.addingPeerMap.get(u);if(b!=null)return b;try{const w=this._add(v,g);this.addingPeerMap.set(u,w),await w}finally{this.addingPeerMap.delete(u)}}async _add(u,g){const v=this._determineBucket(u.kadId);if(this._indexOf(v,u.kadId)>-1)return;if(v.peers.length===this.splitThreshold&&v.depth<this.prefixLength){await this._split(v,g),await this._add(u,g);return}if(v.peers.length<this.kBucketSize){if(!needsPing(u,this.lastPingThreshold)){v.peers.push(u),await this.onAdd?.(u,v,g);return}await this.verify(u,g)&&(u.lastPing=Date.now(),await this._add(u,g));return}const b=v.peers.filter(E=>!(E.peerId.equals(this.localPeer?.peerId)||E.lastPing>Date.now()-this.lastPingThreshold)).sort((E,S)=>E.lastPing<S.lastPing?-1:E.lastPing>S.lastPing?1:0).slice(0,this.numberOfNodesToPing);let w=!1;for await(const E of this.ping(b,g))w=!0,await this.remove(E.kadId,g);w&&await this._add(u,g)}*closest(u,g){const v=new PeerDistanceList(u,g?.count??this.kBucketSize);for(const b of this.toIterable())g?.exclude?.some(w=>w.equals(b.peerId))!==!0&&v.addWithKadId({id:b.peerId,multiaddrs:[]},b.kadId);yield*map(v.peers,({peer:b})=>b.id)}count(){function u(g){if(isLeafBucket(g))return g.peers.length;let v=0;return g.left!=null&&(v+=u(g.left)),g.right!=null&&(v+=u(g.right)),v}return u(this.root)}get(u){const g=this._determineBucket(u),v=this._indexOf(g,u);return g.peers[v]}async remove(u,g){const v=this._determineBucket(u),b=this._indexOf(v,u);if(b>-1){const w=v.peers.splice(b,1)[0];await this.onRemove?.(w,v,g)}}*toIterable(){function*u(g){if(isLeafBucket(g)){yield*g.peers;return}yield*u(g.left),yield*u(g.right)}yield*u(this.root)}distance(u,g){return BigInt("0x"+toString$3(xor(u,g),"base16"))}_determineBucket(u){const g=toString$3(u,"base2");function v(b,w=0){return isLeafBucket(b)?b:g[w]==="0"?v(b.left,w+1):v(b.right,w+1)}return v(this.root)}_indexOf(u,g){return u.peers.findIndex(v=>equals(v.kadId,g))}async _split(u,g){const v={prefix:"0",depth:u.depth+1,peers:[]},b={prefix:"1",depth:u.depth+1,peers:[]};for(const w of u.peers)toString$3(w.kadId,"base2")[u.depth]==="0"?(v.peers.push(w),await this.onMove?.(w,u,v,g)):(b.peers.push(w),await this.onMove?.(w,u,b,g));convertToInternalBucket(u,v,b)}}function convertToInternalBucket(y,u,g){return delete y.peers,y.left=u,y.right=g,y.prefix===""&&(delete y.depth,delete y.prefix),!0}function needsPing(y,u){return y.lastPing<Date.now()-u}const KBUCKET_SIZE=20,PREFIX_LENGTH=6,PING_NEW_CONTACT_CONCURRENCY=20,PING_NEW_CONTACT_MAX_QUEUE_SIZE=100,PING_OLD_CONTACT_COUNT=3,PING_OLD_CONTACT_CONCURRENCY=20,PING_OLD_CONTACT_MAX_QUEUE_SIZE=100,KAD_PEER_TAG_NAME="kad-peer",KAD_PEER_TAG_VALUE=1,LAST_PING_THRESHOLD=6e5,POPULATE_FROM_DATASTORE_ON_START=!0,POPULATE_FROM_DATASTORE_LIMIT=1e3;class RoutingTable extends TypedEventEmitter{kBucketSize;kb;network;closestPeerTagger;log;components;running;pingNewContactTimeout;pingNewContactQueue;pingOldContactTimeout;pingOldContactQueue;populateFromDatastoreOnStart;populateFromDatastoreLimit;protocol;peerTagName;peerTagValue;metrics;shutdownController;constructor(u,g){super(),this.components=u,this.log=u.logger.forComponent(`${g.logPrefix}:routing-table`),this.kBucketSize=g.kBucketSize??KBUCKET_SIZE,this.running=!1,this.protocol=g.protocol,this.network=g.network,this.peerTagName=g.peerTagName??KAD_PEER_TAG_NAME,this.peerTagValue=g.peerTagValue??KAD_PEER_TAG_VALUE,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=g.populateFromDatastoreOnStart??POPULATE_FROM_DATASTORE_ON_START,this.populateFromDatastoreLimit=g.populateFromDatastoreLimit??POPULATE_FROM_DATASTORE_LIMIT,this.shutdownController=new AbortController,this.shutdownController.signal,this.pingOldContactQueue=new PeerQueue({concurrency:g.pingOldContactConcurrency??PING_OLD_CONTACT_CONCURRENCY,metricName:`${g.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:g.pingOldContactMaxQueueSize??PING_OLD_CONTACT_MAX_QUEUE_SIZE}),this.pingOldContactTimeout=new AdaptiveTimeout({...g.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${g.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new PeerQueue({concurrency:g.pingNewContactConcurrency??PING_NEW_CONTACT_CONCURRENCY,metricName:`${g.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:g.pingNewContactMaxQueueSize??PING_NEW_CONTACT_MAX_QUEUE_SIZE}),this.pingNewContactTimeout=new AdaptiveTimeout({...g.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${g.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new KBucket(u,{kBucketSize:g.kBucketSize,prefixLength:g.prefixLength,splitThreshold:g.splitThreshold,numberOfOldContactsToPing:g.numberOfOldContactsToPing,lastPingThreshold:g.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved,metricsPrefix:g.metricsPrefix}),this.closestPeerTagger=new ClosestPeers(this.components,{logPrefix:g.logPrefix,routingTable:this,peerSetSize:g.closestPeerSetSize,refreshInterval:g.closestPeerSetRefreshInterval,closeTagName:g.closeTagName,closeTagValue:g.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${g.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${g.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${g.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${g.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${g.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${g.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${g.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,await start(this.closestPeerTagger,this.kb))}async afterStart(){let u=0;Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;const g=anySignal([this.shutdownController.signal,AbortSignal.timeout(2e4)]);try{for(const v of await this.components.peerStore.all({filters:[b=>b.protocols.includes(this.protocol)&&b.tags.has(KAD_PEER_TAG_NAME)],limit:this.populateFromDatastoreLimit,signal:g})){if(!this.running)return;try{await this.add(v.id,{signal:g}),u++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(v.id,{tags:{[this.peerTagName]:void 0}})}}}finally{g.clear()}this.log("added %d peer store peers to the routing table",u)}).catch(g=>{this.log.error("error adding %d, peer store peers to the routing table - %e",u,g)})}async stop(){this.running=!1,await stop(this.closestPeerTagger,this.kb),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort(),this.shutdownController.abort()}async peerAdded(u,g,v){this.components.peerId.equals(u.peerId)||await this.components.peerStore.merge(u.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}},v),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:u.peerId})}async peerRemoved(u,g,v){this.components.peerId.equals(u.peerId)||await this.components.peerStore.merge(u.peerId,{tags:{[this.peerTagName]:void 0}},v),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:u.peerId})}async*pingOldContacts(u,g){if(!this.running)return;const v=[];for(const b of u){if(this.kb.get(b.kadId)==null){this.log("asked to ping contact %p that was not in routing table",b.peerId);continue}this.metrics?.kadBucketEvents.increment({ping_old_contact:!0}),v.push(async()=>{const w=this.pingOldContactQueue.find(b.peerId);if(w!=null)return this.log("asked to ping contact %p was already being pinged",b.peerId),await w.join(g)?void 0:b;if(!await this.pingOldContactQueue.add(async S=>{const A=this.pingOldContactTimeout.getTimeoutSignal(),$=anySignal([A,this.shutdownController.signal,S?.signal]);try{return await this.pingContact(b,S)}catch{return this.metrics?.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(A),$.clear()}},{peerId:b.peerId,signal:g?.signal}))return b})}for await(const b of parallel(v))b!=null&&(yield b)}async verifyNewContact(u,g){const v=this.pingNewContactTimeout.getTimeoutSignal(),b=anySignal([v,this.shutdownController.signal,g?.signal]);try{const w=this.pingNewContactQueue.find(u.peerId);return w!=null?(this.log("joining existing ping to add new peer %p to routing table",u.peerId),await w.join({signal:b})):await this.pingNewContactQueue.add(async E=>(this.metrics?.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",u.peerId),this.pingContact(u,E)),{peerId:u.peerId,signal:b})}catch{return this.log.trace("tried to add peer %p but they were not online",u.peerId),this.metrics?.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(v),b.clear()}}async pingContact(u,g){try{return this.log("pinging contact %p",u.peerId),await this.components.ping.ping(u.peerId,g),this.log("contact %p ping ok",u.peerId),this.safeDispatchEvent("peer:ping",{detail:u.peerId}),!0}catch(v){return this.log("error pinging old contact %p - %e",u.peerId,v),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(u,g){const v=await convertPeerId(u,g);return this.kb.get(v)?.peerId}closestPeer(u){const g=this.closestPeers(u,{count:1});if(g.length>0)return g[0]}closestPeers(u,g){return this.kb==null?[]:[...this.kb.closest(u,g)]}async add(u,g){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(u,g)}async remove(u,g){if(this.kb==null)throw new Error("RoutingTable is not started");const v=await convertPeerId(u,g);await this.kb.remove(v,g)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let u=0,g=0,v=0,b=20,w=0;function E(S){if(isLeafBucket(S)){S.depth>v&&(v=S.depth),g++,u+=S.peers.length,S.peers.length<b&&(b=S.peers.length),S.peers.length>w&&(w=S.peers.length);return}E(S.left),E(S.right)}E(this.kb.root),this.metrics.routingTableSize.update(u),this.metrics.routingTableKadBucketTotal.update(g),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(u/g)),this.metrics.routingTableKadBucketMinOccupancy.update(b),this.metrics.routingTableKadBucketMaxOccupancy.update(w),this.metrics.routingTableKadBucketMaxDepth.update(v)}}const GENERATED_PREFIXES=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],MAX_COMMON_PREFIX_LENGTH=15;class RoutingTableRefresh{log;peerRouting;routingTable;refreshInterval;refreshQueryTimeout;commonPrefixLengthRefreshedAt;refreshTimeoutId;constructor(u,g){const{peerRouting:v,routingTable:b,refreshInterval:w,refreshQueryTimeout:E,logPrefix:S}=g;this.log=u.logger.forComponent(`${S}:routing-table:refresh`),this.peerRouting=v,this.routingTable=b,this.refreshInterval=w??TABLE_REFRESH_INTERVAL,this.refreshQueryTimeout=E??TABLE_REFRESH_QUERY_TIMEOUT,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(u=!1,g){this.log("refreshing routing table");const v=this._maxCommonPrefix(),b=this._getTrackedCommonPrefixLengthsForRefresh(v);this.log(`max common prefix length ${v}`),this.log(`tracked CPLs [ ${b.map(w=>w.toISOString()).join(", ")} ]`),Promise.all(b.map(async(w,E)=>{try{if(await this._refreshCommonPrefixLength(E,w,u,g),this._numPeersForCpl(v)===0){const S=Math.min(2*(E+1),b.length-1);for(let A=E+1;A<S+1;A++)try{await this._refreshCommonPrefixLength(A,w,u,g)}catch($){this.log.error("failed to refresh entries with common prefix length %d - %e",A,$)}}}catch(S){this.log.error("failed to refresh entries with common prefix length - %e",S)}})).catch(w=>{this.log.error("failed to refresh table - %e",w)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(w=>{this.log.error("failed to set refresh timeout - %e",w)})}async _refreshCommonPrefixLength(u,g,v,b){if(!v&&g.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",u);return}const w=this._generateRandomPeerId(u);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",u,w,this.routingTable.size);const E=anySignal([b?.signal,AbortSignal.timeout(this.refreshQueryTimeout)]);try{const S=await length(this.peerRouting.getClosestPeers(w.toMultihash().bytes,{signal:E}));this.log(`found ${S} peers that were close to imaginary peer %p`,w),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",u,w,this.routingTable.size)}finally{E.clear()}}_getTrackedCommonPrefixLengthsForRefresh(u){u>MAX_COMMON_PREFIX_LENGTH&&(u=MAX_COMMON_PREFIX_LENGTH);const g=[];for(let v=0;v<=u;v++)g[v]=this.commonPrefixLengthRefreshedAt[v]??new Date;return g}_generateRandomPeerId(u){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const g=randomBytes$1(2),v=(g[1]<<8)+g[0],b=this._makePeerId(this.routingTable.kb.localPeer.kadId,v,u),w=decode$8(b);return peerIdFromMultihash(w)}_makePeerId(u,g,v){if(v>MAX_COMMON_PREFIX_LENGTH)throw new Error(`Cannot generate peer ID for common prefix length greater than ${MAX_COMMON_PREFIX_LENGTH}`);const E=new DataView(u.buffer,u.byteOffset,u.byteLength).getUint16(0,!1)^32768>>v,S=65535<<16-(v+1),A=E&S|g&~S,$=GENERATED_PREFIXES[A],R=new ArrayBuffer(34),T=new DataView(R,0,R.byteLength);return T.setUint8(0,sha256$4.code),T.setUint8(1,32),T.setUint32(2,$,!1),new Uint8Array(T.buffer,T.byteOffset,T.byteLength)}_maxCommonPrefix(){let u=0;for(const g of this._prefixLengths())g>u&&(u=g);return u}_numPeersForCpl(u){let g=0;for(const v of this._prefixLengths())v===u&&g++;return g}*_prefixLengths(){if(this.routingTable.kb?.localPeer!=null)for(const{kadId:u}of this.routingTable.kb.toIterable()){const g=xor(this.routingTable.kb.localPeer.kadId,u);let v=0;for(const b of g)if(b===0)v++;else break;yield v}}}class AddProviderHandler{peerId;providers;peerStore;log;constructor(u,g){this.log=u.logger.forComponent(`${g.logPrefix}:rpc:handlers:add-provider`),this.peerId=u.peerId,this.providers=g.providers,this.peerStore=u.peerStore}async handle(u,g){if(g.key==null||g.key.length===0)throw new InvalidMessageError("Missing key");let v;try{v=CID.decode(g.key)}catch{throw new InvalidMessageError("Invalid CID")}(g.providers==null||g.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",u,this.peerId,v),await Promise.all(g.providers.map(async b=>{const w=decode$8(b.id),E=peerIdFromMultihash(w),S=b.multiaddrs.map(A=>multiaddr(A));if(!u.equals(E)){this.log("invalid provider peer %p from %p",b.id,u);return}if(b.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",u);return}this.log.trace("received provider %p for %s (addrs %s)",u,v,S),await this.providers.addProvider(v,E),await this.peerStore.merge(E,{multiaddrs:S})}))}}class FindNodeHandler{peerRouting;peerInfoMapper;peerId;addressManager;log;constructor(u,g){const{peerRouting:v,logPrefix:b}=g;this.log=u.logger.forComponent(`${b}:rpc:handlers:find-node`),this.peerId=u.peerId,this.addressManager=u.addressManager,this.peerRouting=v,this.peerInfoMapper=g.peerInfoMapper}async handle(u,g){this.log("incoming request from %p for peers close to %b",u,g.key);try{if(g.key==null)throw new InvalidMessageError("Invalid FIND_NODE message received - key was missing");const v=await this.peerRouting.getClosestPeersOffline(g.key,{exclude:[u,this.peerId]});equals(this.peerId.toMultihash().bytes,g.key)&&v.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(w=>w.decapsulateCode(CODE_P2P))});const b={type:MessageType.FIND_NODE,clusterLevel:g.clusterLevel,closer:v.map(this.peerInfoMapper).filter(({multiaddrs:w})=>w.length).map(w=>({id:w.id.toMultihash().bytes,multiaddrs:w.multiaddrs.map(E=>E.bytes)})),providers:[]};return b.closer.length===0?this.log("could not find any peers closer to %b for %p",g.key,u):this.log("found %d peers close to %b for %p",b.closer.length,g.key,u),b}catch(v){throw this.log("error during finding peers closer to %b for %p - %e",g.key,u,v),v}}}class GetProvidersHandler{peerId;peerRouting;providers;peerStore;peerInfoMapper;log;constructor(u,g){const{peerRouting:v,providers:b,logPrefix:w}=g;this.log=u.logger.forComponent(`${w}:rpc:handlers:get-providers`),this.peerId=u.peerId,this.peerStore=u.peerStore,this.peerRouting=v,this.providers=b,this.peerInfoMapper=g.peerInfoMapper}async handle(u,g){if(g.key==null)throw new InvalidMessageError("Invalid GET_PROVIDERS message received - key was missing");let v;try{v=CID.decode(g.key)}catch{throw new InvalidMessageError("Invalid CID")}this.log("%p asking for providers for %s",u,v);const[b,w]=await Promise.all([all(map(await this.providers.getProviders(v),async S=>{const A=await this.peerStore.get(S);return{id:A.id,multiaddrs:A.addresses.map(({multiaddr:R})=>R)}})),this.peerRouting.getClosestPeersOffline(g.key)]),E={type:MessageType.GET_PROVIDERS,key:g.key,clusterLevel:g.clusterLevel,closer:w.map(this.peerInfoMapper).filter(({id:S,multiaddrs:A})=>A.length>0).map(S=>({id:S.id.toMultihash().bytes,multiaddrs:S.multiaddrs.map(A=>A.bytes)})),providers:b.map(this.peerInfoMapper).filter(({id:S,multiaddrs:A})=>A.length>0).map(S=>({id:S.id.toMultihash().bytes,multiaddrs:S.multiaddrs.map(A=>A.bytes)}))};return this.log("got %s providers %s closerPeers",E.providers.length,E.closer.length),E}async _getAddresses(u){return[]}}class GetValueHandler{peerStore;datastore;peerRouting;log;datastorePrefix;constructor(u,g){this.log=u.logger.forComponent(`${g.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${g.datastorePrefix}/record`,this.peerStore=u.peerStore,this.datastore=u.datastore,this.peerRouting=g.peerRouting}async handle(u,g){const v=g.key;if(this.log("%p asked for key %b",u,v),v==null||v.length===0)throw new InvalidMessageError("Invalid key");const b={type:MessageType.GET_VALUE,key:v,clusterLevel:g.clusterLevel,closer:[],providers:[]};if(isPublicKeyKey(v)){this.log("is public key");const S=fromPublicKeyKey(v);let A;try{const $=await this.peerStore.get(S);if($.id.publicKey==null)throw new NotFoundError$1("No public key found in key book");A=publicKeyToProtobuf($.id.publicKey)}catch($){if($.name!=="NotFoundError")throw $}if(A!=null)return this.log("returning found public key"),b.record=new Libp2pRecord(v,A,new Date).serialize(),b}const[w,E]=await Promise.all([this._checkLocalDatastore(v),this.peerRouting.getClosestPeersOffline(v)]);return w!=null&&(this.log("had record for %b in local datastore",v),b.record=w.serialize()),E.length>0&&(this.log("had %s closer peers in routing table",E.length),b.closer=E.map(S=>({id:S.id.toMultihash().bytes,multiaddrs:S.multiaddrs.map(A=>A.bytes)}))),b}async _checkLocalDatastore(u){this.log("checkLocalDatastore looking for %b",u);const g=bufferToRecordKey(this.datastorePrefix,u);let v;try{v=await this.datastore.get(g)}catch(w){if(w.name==="NotFoundError")return;throw w}const b=Libp2pRecord.deserialize(v);if(b.timeReceived==null||Date.now()-b.timeReceived.getTime()>PROVIDERS_VALIDITY){await this.datastore.delete(g);return}return b}}class PingHandler{log;constructor(u,g){this.log=u.logger.forComponent(`${g.logPrefix}:rpc:handlers:ping`)}async handle(u,g){return this.log("ping from %p",u),g}}class PutValueHandler{components;validators;log;datastorePrefix;constructor(u,g){const{validators:v}=g;this.components=u,this.log=u.logger.forComponent(`${g.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${g.datastorePrefix}/record`,this.validators=v}async handle(u,g){const v=g.key;if(this.log("%p asked us to store value for key %b",u,v),g.record==null)throw this.log.error("empty record from %p",u),new InvalidMessageError(`Empty record from: ${u}`);try{const b=Libp2pRecord.deserialize(g.record);await verifyRecord(this.validators,b),b.timeReceived=new Date;const w=bufferToRecordKey(this.datastorePrefix,b.key);await this.components.datastore.put(w,b.serialize().subarray()),this.log("put record for %b into datastore under key %k",v,w)}catch(b){this.log("did not put record for key %b into datastore %o",v,b)}return g}}class RPC{handlers;log;metrics;incomingMessageTimeout;constructor(u,g){this.metrics={operations:u.metrics?.registerCounterGroup(`${g.metricsPrefix}_inbound_rpc_requests_total`),errors:u.metrics?.registerCounterGroup(`${g.metricsPrefix}_inbound_rpc_errors_total`),rpcTime:u.metrics?.registerMetricGroup(`${g.metricsPrefix}_inbound_rpc_time_seconds`,{label:"operation"})},this.log=u.logger.forComponent(`${g.logPrefix}:rpc`),this.incomingMessageTimeout=g.incomingMessageTimeout??1e4,this.handlers={[MessageType.GET_VALUE.toString()]:new GetValueHandler(u,g),[MessageType.PUT_VALUE.toString()]:new PutValueHandler(u,g),[MessageType.FIND_NODE.toString()]:new FindNodeHandler(u,g),[MessageType.ADD_PROVIDER.toString()]:new AddProviderHandler(u,g),[MessageType.GET_PROVIDERS.toString()]:new GetProvidersHandler(u,g),[MessageType.PING.toString()]:new PingHandler(u,g)}}async handleMessage(u,g){const v=this.handlers[g.type];if(v==null){this.log.error(`no handler found for message type: ${g.type}`);return}try{return this.metrics.operations?.increment({[g.type]:!0}),await v.handle(u,g)}catch{this.metrics.errors?.increment({[g.type]:!0})}}async onIncomingStream(u,g){const v=()=>{u.abort(new TimeoutError$2)};let b=AbortSignal.timeout(this.incomingMessageTimeout);b.addEventListener("abort",v);const w=pbStream(u).pb(Message$2);for(;;){if(u.readStatus!=="readable"){await u.close({signal:b});break}const E=await w.read({signal:b}),S=this.metrics?.rpcTime?.timer(E.type.toString()),A=this.metrics?.rpcTime?.timer(E.type.toString());let $=!1;try{this.log("incoming %s from %p",E.type,g.remotePeer);const R=await this.handleMessage(g.remotePeer,E);R!=null&&await w.write(R,{signal:b})}catch(R){throw $=!0,A?.(),R}finally{$||S?.()}b.removeEventListener("abort",v),b=AbortSignal.timeout(this.incomingMessageTimeout),b.addEventListener("abort",v)}}}class TopologyListener extends TypedEventEmitter{log;components;protocol;running;registrarId;constructor(u,g){super();const{protocol:v,logPrefix:b}=g;this.components=u,this.log=u.logger.forComponent(`${b}:topology-listener`),this.running=!1,this.protocol=v}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:u=>{this.log("observed peer %p with protocol %s",u,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:u}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class DHTContentRouting{dht;constructor(u){this.dht=u}async provide(u,g={}){await drain(this.dht.provide(u,g))}async cancelReprovide(u){await this.dht.cancelReprovide(u)}async*findProviders(u,g={}){for await(const v of this.dht.findProviders(u,g))v.name==="PROVIDER"&&(yield*v.providers.map(b=>({...b,routing:"kad-dht"})))}async put(u,g,v){await drain(this.dht.put(u,g,v))}async get(u,g){for await(const v of this.dht.get(u,g))if(v.name==="VALUE")return v.value;throw new NotFoundError$1("Could not find value for key")}}class DHTPeerRouting{dht;constructor(u){this.dht=u}async findPeer(u,g={}){for await(const v of this.dht.findPeer(u,g))if(v.name==="FINAL_PEER")return v.peer;throw new NotFoundError$1("Peer not found")}async*getClosestPeers(u,g={}){for await(const v of this.dht.getClosestPeers(u,g))v.name==="FINAL_PEER"&&(yield v.peer)}}const DEFAULT_MAX_INBOUND_STREAMS=32,DEFAULT_MAX_OUTBOUND_STREAMS=64;class KadDHT extends TypedEventEmitter{k;a;d;protocol;routingTable;providers;network;peerRouting;components;log;running;clientMode;validators;selectors;queryManager;contentFetching;contentRouting;routingTableRefresh;rpc;topologyListener;querySelf;maxInboundStreams;maxOutboundStreams;dhtContentRouting;dhtPeerRouting;peerInfoMapper;reprovider;onPeerConnectTimeout;constructor(u,g={}){super();const v=g.logPrefix??"libp2p:kad-dht",b=g.datastorePrefix??"/dht",w=g.metricsPrefix??"libp2p_kad_dht",E={queries:u.metrics?.registerMetricGroup(`${w}_operations_total`,{label:"operation"}),errors:u.metrics?.registerCounterGroup(`${w}_operation_errors_total`,{label:"operation"}),queryTime:u.metrics?.registerMetricGroup(`${w}_operation_time_seconds`,{label:"operation"}),errorTime:u.metrics?.registerMetricGroup(`${w}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=u,this.log=u.logger.forComponent(v),this.k=g.kBucketSize??KBUCKET_SIZE,this.a=g.alpha??ALPHA,this.d=g.disjointPaths??this.a,this.protocol=g.protocol??PROTOCOL,this.clientMode=g.clientMode??!0,this.maxInboundStreams=g.maxInboundStreams??DEFAULT_MAX_INBOUND_STREAMS,this.maxOutboundStreams=g.maxOutboundStreams??DEFAULT_MAX_OUTBOUND_STREAMS,this.peerInfoMapper=g.peerInfoMapper??removePrivateAddressesMapper,this.onPeerConnectTimeout=g.onPeerConnectTimeout??ON_PEER_CONNECT_TIMEOUT,this.providers=new Providers(u,{...g.providers,logPrefix:v,datastorePrefix:b}),this.validators={...validators,...g.validators},this.selectors={...selectors,...g.selectors},this.network=new Network(u,{protocol:this.protocol,logPrefix:v,metricsPrefix:w}),this.routingTable=new RoutingTable(u,{kBucketSize:this.k,pingOldContactTimeout:g.pingOldContactTimeout,pingOldContactConcurrency:g.pingOldContactConcurrency,pingOldContactMaxQueueSize:g.pingOldContactMaxQueueSize,pingNewContactTimeout:g.pingNewContactTimeout,pingNewContactConcurrency:g.pingNewContactConcurrency,pingNewContactMaxQueueSize:g.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:v,metricsPrefix:w,prefixLength:g.prefixLength,splitThreshold:g.kBucketSplitThreshold,network:this.network});const S=pDefer();g.allowQueryWithZeroPeers===!0&&S.resolve(),this.queryManager=new QueryManager(u,{disjointPaths:this.d,alpha:this.a,logPrefix:v,metricsPrefix:w,initialQuerySelfHasRun:S,routingTable:this.routingTable,allowQueryWithZeroPeers:g.allowQueryWithZeroPeers}),this.peerRouting=new PeerRouting(u,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:v}),this.contentFetching=new ContentFetching(u,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:v,datastorePrefix:b}),this.contentRouting=new ContentRouting(u,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:v}),this.routingTableRefresh=new RoutingTableRefresh(u,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:v}),this.rpc=new RPC(u,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:v,metricsPrefix:w,datastorePrefix:b,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new TopologyListener(u,{protocol:this.protocol,logPrefix:v}),this.querySelf=new QuerySelf(u,{peerRouting:this.peerRouting,interval:g.querySelfInterval,initialInterval:g.initialQuerySelfInterval,logPrefix:v,initialQuerySelfHasRun:S,operationMetrics:E}),this.reprovider=new Reprovider(u,{...g.reprovide,logPrefix:v,metricsPrefix:w,datastorePrefix:b,contentRouting:this.contentRouting,operationMetrics:E}),this.network.addEventListener("peer",A=>{const $=A.detail;this.onPeerConnect($).catch(R=>{this.log.error("could not add %p to routing table - %e",$.id,R)}),this.dispatchEvent(new CustomEvent("peer",{detail:$}))}),this.topologyListener.addEventListener("peer",A=>{const $=A.detail;Promise.resolve().then(async()=>{const R=await this.components.peerStore.get($),T={id:$,multiaddrs:R.addresses.map(({multiaddr:O})=>O),protocols:R.protocols};await this.onPeerConnect(T)}).catch(R=>{this.log.error("could not add %p to routing table - %e",$,R)})}),this.dhtPeerRouting=new DHTPeerRouting(this),this.dhtContentRouting=new DHTContentRouting(this),g.clientMode==null&&u.events.addEventListener("self:peer:update",A=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const $=A.detail.peer.addresses.some(({multiaddr:T})=>!isPrivate(T)&&!Circuit$1.exactMatch(T)),R=this.getMode();$&&R==="client"?await this.setMode("server"):R==="server"&&!$&&await this.setMode("client")}).catch($=>{this.log.error("error setting dht server mode - %e",$)})}),this.get=timeOperationGenerator(this.get.bind(this),E,"GET_VALUE"),this.findProviders=timeOperationGenerator(this.findProviders.bind(this),E,"FIND_PROVIDERS"),this.findPeer=timeOperationGenerator(this.findPeer.bind(this),E,"FIND_PEER"),this.getClosestPeers=timeOperationGenerator(this.getClosestPeers.bind(this),E,"GET_CLOSEST_PEERS"),this.provide=timeOperationGenerator(this.provide.bind(this),E,"PROVIDE"),this.put=timeOperationGenerator(this.put.bind(this),E,"PUT_VALUE")}[Symbol.toStringTag]="@libp2p/kad-dht";[serviceCapabilities]=["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery","@libp2p/kad-dht"];[serviceDependencies]=["@libp2p/identify","@libp2p/ping"];get[contentRoutingSymbol](){return this.dhtContentRouting}get[peerRoutingSymbol](){return this.dhtPeerRouting}get[peerDiscoverySymbol](){return this}async onPeerConnect(u){if(this.log.trace("peer %p connected",u.id,u.multiaddrs),u=this.peerInfoMapper(u),u.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",u.id,u.multiaddrs.map(v=>v.toString()));return}const g=AbortSignal.timeout(this.onPeerConnectTimeout);try{await this.routingTable.add(u.id,{signal:g})}catch(v){this.log.error("could not add %p to routing table - %e",u.id,v)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(u,g){if(u===this.getMode()&&g?.force!==!0){this.log("already in %s mode",u);return}if(await this.components.registrar.unhandle(this.protocol,g),u===this.getMode()&&g?.force!==!0){this.log("already in %s mode",u);return}u==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{signal:g?.signal,maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",{force:!0}),await start(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await start(this.querySelf))}async stop(){this.running=!1,await stop(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(u,g,v={}){yield*this.contentFetching.put(u,g,v)}async*get(u,g={}){yield*this.contentFetching.get(u,g)}async*provide(u,g={}){yield*this.contentRouting.provide(u,this.components.addressManager.getAddresses(),g)}async cancelReprovide(u,g){await this.providers.removeProvider(u,this.components.peerId,g)}async*findProviders(u,g={}){yield*this.contentRouting.findProviders(u,g)}async*findPeer(u,g={}){yield*this.peerRouting.findPeer(u,g)}async*getClosestPeers(u,g={}){yield*this.peerRouting.getClosestPeers(u,g)}async refreshRoutingTable(u){this.routingTableRefresh.refreshTable(!0,u)}}var EventTypes;(function(y){y[y.SEND_QUERY=0]="SEND_QUERY",y[y.PEER_RESPONSE=1]="PEER_RESPONSE",y[y.FINAL_PEER=2]="FINAL_PEER",y[y.QUERY_ERROR=3]="QUERY_ERROR",y[y.PROVIDER=4]="PROVIDER",y[y.VALUE=5]="VALUE",y[y.ADD_PEER=6]="ADD_PEER",y[y.DIAL_PEER=7]="DIAL_PEER",y[y.PATH_ENDED=8]="PATH_ENDED"})(EventTypes||(EventTypes={}));function kadDHT(y={}){return u=>new KadDHT(u,y)}var MessageTypes;(function(y){y[y.NEW_STREAM=0]="NEW_STREAM",y[y.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",y[y.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",y[y.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",y[y.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",y[y.RESET_RECEIVER=5]="RESET_RECEIVER",y[y.RESET_INITIATOR=6]="RESET_INITIATOR"})(MessageTypes||(MessageTypes={}));const MessageTypeNames=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),InitiatorMessageTypes=Object.freeze({NEW_STREAM:MessageTypes.NEW_STREAM,MESSAGE:MessageTypes.MESSAGE_INITIATOR,CLOSE:MessageTypes.CLOSE_INITIATOR,RESET:MessageTypes.RESET_INITIATOR}),ReceiverMessageTypes=Object.freeze({MESSAGE:MessageTypes.MESSAGE_RECEIVER,CLOSE:MessageTypes.CLOSE_RECEIVER,RESET:MessageTypes.RESET_RECEIVER}),MAX_MSG_SIZE=1<<20,MAX_MSG_QUEUE_SIZE=4<<20;class Decoder{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(u=MAX_MSG_SIZE,g=MAX_MSG_QUEUE_SIZE){this._buffer=new Uint8ArrayList,this._headerInfo=null,this._maxMessageSize=u,this._maxUnprocessedMessageQueueSize=g}write(u){if(u==null||u.length===0)return[];if(this._buffer.append(u),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new InvalidMessageError("Unprocessed message queue size too large!");const g=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch($){if($.name==="InvalidMessageError")throw $;break}const{id:v,type:b,length:w,offset:E}=this._headerInfo;if(this._buffer.length-E<w)break;const A={id:v,type:b};(b===MessageTypes.NEW_STREAM||b===MessageTypes.MESSAGE_INITIATOR||b===MessageTypes.MESSAGE_RECEIVER)&&(A.data=this._buffer.sublist(E,E+w)),g.push(A),this._buffer.consume(E+w),this._headerInfo=null}return g}_decodeHeader(u){const{value:g,offset:v}=readVarInt(u),{value:b,offset:w}=readVarInt(u,v),E=g&7;if(MessageTypeNames[E]==null)throw new Error(`Invalid type received: ${E}`);if(b>this._maxMessageSize)throw new InvalidMessageError("Message size too large");return{id:g>>3,type:E,offset:v+w,length:b}}}const MSB=128,REST=127;function readVarInt(y,u=0){let g=0,v=0,b=u,w;const E=y.length;do{if(b>=E||v>49)throw u=0,new RangeError("Could not decode varint");w=y.get(b++),g+=v<28?(w&REST)<<v:(w&REST)*Math.pow(2,v),v+=7}while(w>=MSB);return u=b-u,{value:g,offset:u}}const POOL_SIZE=10*1024;class Encoder{_pool;_poolOffset;constructor(){this._pool=allocUnsafe(POOL_SIZE),this._poolOffset=0}write(u,g){const v=this._pool;let b=this._poolOffset;encode$9(u.id<<3|u.type,v,b),b+=encodingLength(u.id<<3|u.type),(u.type===MessageTypes.NEW_STREAM||u.type===MessageTypes.MESSAGE_INITIATOR||u.type===MessageTypes.MESSAGE_RECEIVER)&&u.data!=null?(encode$9(u.data.length,v,b),b+=encodingLength(u.data.length)):(encode$9(0,v,b),b+=encodingLength(0));const w=v.subarray(this._poolOffset,b);POOL_SIZE-b<100?(this._pool=allocUnsafe(POOL_SIZE),this._poolOffset=0):this._poolOffset=b,g.append(w),(u.type===MessageTypes.NEW_STREAM||u.type===MessageTypes.MESSAGE_INITIATOR||u.type===MessageTypes.MESSAGE_RECEIVER)&&u.data!=null&&g.append(u.data)}}const encoder=new Encoder;function encode$2(y){const u=new Uint8ArrayList;return encoder.write(y,u),u}class MplexStream extends AbstractStream{streamId;types;maxDataSize;muxer;constructor(u){super(u),this.types=u.direction==="outbound"?InitiatorMessageTypes:ReceiverMessageTypes,this.maxDataSize=u.maxDataSize,this.muxer=u.muxer,this.streamId=parseInt(this.id.substring(1)),u.direction==="outbound"&&queueMicrotask(()=>{this.muxer.send(encode$2({id:this.streamId,type:InitiatorMessageTypes.NEW_STREAM,data:new Uint8ArrayList(fromString$1(this.id))}))})}sendData(u){const g=new Uint8ArrayList,v=u.byteLength;for(;u.byteLength>0;){const b=Math.min(u.byteLength,this.maxDataSize),w=u.sublist(0,b);u=u.sublist(b),g.append(encode$2({id:this.streamId,type:this.types.MESSAGE,data:w}))}return{sentBytes:v,canSendMore:this.muxer.send(g)}}sendReset(){return this.muxer.send(encode$2({id:this.streamId,type:this.types.RESET}))}async sendCloseWrite(u){this.muxer.send(encode$2({id:this.streamId,type:this.types.CLOSE})),u?.signal?.throwIfAborted()}async sendCloseRead(u){u?.signal?.throwIfAborted()}sendPause(){}sendResume(){}}function createStream$1(y){const{id:u,muxer:g,direction:v,maxMsgSize:b=MAX_MSG_SIZE}=y;return new MplexStream({...y,id:v==="outbound"?`i${u}`:`r${u}`,direction:v,maxDataSize:b,muxer:g,log:y.log.newScope(`${v}:${u}`),protocol:""})}const DISCONNECT_THRESHOLD=5;function printMessage(y){const u={...y,type:`${MessageTypeNames[y.type]} (${y.type})`};return y.type===MessageTypes.NEW_STREAM&&(u.data=toString$3(y.data.subarray())),(y.type===MessageTypes.MESSAGE_INITIATOR||y.type===MessageTypes.MESSAGE_RECEIVER)&&(u.data=toString$3(y.data.subarray(),"base16")),u}class MplexStreamMuxer extends AbstractStreamMuxer{_streamId;rateLimiter;maxMessageSize;maxUnprocessedMessageQueueSize;decoder;constructor(u,g){super(u,{...g,protocol:"/mplex/6.7.0",name:"mplex"}),this._streamId=0,this.maxMessageSize=g.maxMessageSize??MAX_MSG_SIZE,this.maxUnprocessedMessageQueueSize=g.maxUnprocessedMessageQueueSize??MAX_MSG_QUEUE_SIZE,this.decoder=new Decoder(this.maxMessageSize,this.maxUnprocessedMessageQueueSize),this.rateLimiter=new RateLimiter({points:g.disconnectThreshold??DISCONNECT_THRESHOLD,duration:1})}onData(u){for(const g of this.decoder.write(u))this.handleMessage(g)}onCreateStream(u){if(this.status!=="open")throw new MuxerClosedError("Muxer already closed");const g=this._streamId++;return this._newStream(g,"outbound",u)}_newStream(u,g,v){return this.log("new %s stream %s",g,u),createStream$1({...v,id:u,direction:g,maxMsgSize:this.maxMessageSize,log:this.log,muxer:this})}handleMessage(u){if(this.log.enabled&&this.log.trace("incoming message",printMessage(u)),u.type===MessageTypes.NEW_STREAM){try{this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}const b=this._newStream(u.id,"inbound",this.streamOptions);this.onRemoteStream(b);return}const g=`${(u.type&1)===1?"i":"r"}${u.id}`,v=this.streams.find(b=>b.id===g);if(v==null){this.log("missing stream %s for message type %s",g,MessageTypeNames[u.type]);try{this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}try{switch(u.type){case MessageTypes.MESSAGE_INITIATOR:case MessageTypes.MESSAGE_RECEIVER:v.onData(u.data);break;case MessageTypes.CLOSE_INITIATOR:case MessageTypes.CLOSE_RECEIVER:v.onRemoteCloseWrite();break;case MessageTypes.RESET_INITIATOR:case MessageTypes.RESET_RECEIVER:v.onRemoteReset();break;default:this.log("unknown message type")}}catch(b){this.log.error("error while processing message - %e",b),v.abort(b)}}}class Mplex{protocol="/mplex/6.7.0";_init;constructor(u={}){this._init=u}[Symbol.toStringTag]="@libp2p/mplex";[serviceCapabilities]=["@libp2p/stream-multiplexing"];createStreamMuxer(u){return new MplexStreamMuxer(u,{...this._init})}}function mplex(y={}){return()=>new Mplex(y)}const PING_LENGTH=32,PROTOCOL_VERSION="1.0.0",PROTOCOL_NAME="ping",PROTOCOL_PREFIX="ipfs",TIMEOUT=1e4,MAX_INBOUND_STREAMS=2,MAX_OUTBOUND_STREAMS=1;class Ping{protocol;components;started;timeout;maxInboundStreams;maxOutboundStreams;runOnLimitedConnection;constructor(u,g={}){this.components=u,this.started=!1,this.protocol=`/${g.protocolPrefix??PROTOCOL_PREFIX}/${PROTOCOL_NAME}/${PROTOCOL_VERSION}`,this.timeout=g.timeout??TIMEOUT,this.maxInboundStreams=g.maxInboundStreams??MAX_INBOUND_STREAMS,this.maxOutboundStreams=g.maxOutboundStreams??MAX_OUTBOUND_STREAMS,this.runOnLimitedConnection=g.runOnLimitedConnection??!0,this.handlePing=this.handlePing.bind(this)}[Symbol.toStringTag]="@libp2p/ping";[serviceCapabilities]=["@libp2p/ping"];async start(){await this.components.registrar.handle(this.protocol,this.handlePing,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}async handlePing(u,g){const v=u.log.newScope("ping");v.trace("ping from %p",g.remotePeer);const b=AbortSignal.timeout(this.timeout);b.addEventListener("abort",()=>{u.abort(new TimeoutError$2("Ping timed out"))});const w=Date.now();for await(const E of u){if(u.status!=="open"){v("stream status changed to %s",u.status);break}u.send(E)||(v("waiting for stream to drain"),await pEvent(u,"drain",{rejectionEvents:["close"],signal:b}),v("stream drained"))}v("ping from %p complete in %dms",g.remotePeer,Date.now()-w),await u.close({signal:b})}async ping(u,g={}){const v=randomBytes$1(PING_LENGTH),b=await this.components.connectionManager.openStream(u,this.protocol,{runOnLimitedConnection:this.runOnLimitedConnection,...g}),w=b.log.newScope("ping");try{const E=Date.now(),S=Promise.withResolvers(),A=new Uint8ArrayList,$=R=>{if(A.append(R.data),A.byteLength===PING_LENGTH){b.removeEventListener("message",$);const T=Date.now()-E;Promise.all([b.closeRead(g)]).then(()=>{if(equals(v,A.subarray()))S.resolve(T);else throw new ProtocolError$1(`Received wrong ping ack after ${T}ms`)}).catch(O=>{b.abort(O),S.reject(O)})}};return b.addEventListener("message",$),b.send(v),await b.close(g),await raceSignal$2(S.promise,g.signal)}catch(E){throw w.error("error while pinging %o - %e",u,E),b?.abort(E),E}finally{b?.close()}}}function ping(y={}){return u=>new Ping(u,y)}var Message$1;(function(y){(function(v){v.FIN="FIN",v.STOP_SENDING="STOP_SENDING",v.RESET="RESET",v.FIN_ACK="FIN_ACK"})(y.Flag||(y.Flag={}));let u;(function(v){v[v.FIN=0]="FIN",v[v.STOP_SENDING=1]="STOP_SENDING",v[v.RESET=2]="RESET",v[v.FIN_ACK=3]="FIN_ACK"})(u||(u={})),(function(v){v.codec=()=>enumeration(u)})(y.Flag||(y.Flag={}));let g;y.codec=()=>(g==null&&(g=message((v,b,w={})=>{w.lengthDelimited!==!1&&b.fork(),v.flag!=null&&(b.uint32(8),y.Flag.codec().encode(v.flag,b)),v.message!=null&&(b.uint32(18),b.bytes(v.message)),w.lengthDelimited!==!1&&b.ldelim()},(v,b,w={})=>{const E={},S=b==null?v.len:v.pos+b;for(;v.pos<S;){const A=v.uint32();switch(A>>>3){case 1:{E.flag=y.Flag.codec().decode(v);break}case 2:{E.message=v.bytes();break}default:{v.skipType(A&7);break}}}return E})),g),y.encode=v=>encodeMessage$1(v,y.codec()),y.decode=(v,b)=>decodeMessage$1(v,y.codec(),b)})(Message$1||(Message$1={}));const DEFAULT_ICE_SERVERS=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],UFRAG_ALPHABET=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),UFRAG_PREFIX="libp2p+webrtc+v1/",MAX_BUFFERED_AMOUNT=2*1024*1024,MAX_MESSAGE_SIZE=16*1024;function calculateProtobufOverhead(y=MAX_MESSAGE_SIZE){const u=encodingLength(y-encodingLength(y)),g=1+encodingLength(Object.keys(Message$1.Flag).length-1),v=1,b=y-u-g-v,w=encodingLength(b);return u+g+v+w}const PROTOBUF_OVERHEAD=calculateProtobufOverhead(),DEFAULT_FIN_ACK_TIMEOUT=1e4,MUXER_PROTOCOL="/webrtc",SIGNALING_PROTOCOL="/webrtc-signaling/0.0.1",DEFAULT_CERTIFICATE_DATASTORE_KEY="/libp2p/webrtc-direct/certificate",DEFAULT_CERTIFICATE_PRIVATE_KEY_NAME="webrtc-direct-certificate-private-key",DEFAULT_CERTIFICATE_LIFESPAN=12096e5,DEFAULT_CERTIFICATE_RENEWAL_THRESHOLD=864e5;var __spreadArray=function(y,u,g){if(g||arguments.length===2)for(var v=0,b=u.length,w;v<b;v++)(w||!(v in u))&&(w||(w=Array.prototype.slice.call(u,0,v)),w[v]=u[v]);return y.concat(w||Array.prototype.slice.call(u))},BrowserInfo=(function(){function y(u,g,v){this.name=u,this.version=g,this.os=v,this.type="browser"}return y})(),NodeInfo=(function(){function y(u){this.version=u,this.type="node",this.name="node",this.os=process$1.platform}return y})(),SearchBotDeviceInfo=(function(){function y(u,g,v,b){this.name=u,this.version=g,this.os=v,this.bot=b,this.type="bot-device"}return y})(),BotInfo=(function(){function y(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return y})(),ReactNativeInfo=(function(){function y(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return y})(),SEARCHBOX_UA_REGEX=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",SEARCHBOX_UA_REGEX]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(y){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ReactNativeInfo:typeof navigator<"u"?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(y){return y!==""&&userAgentRules.reduce(function(u,g){var v=g[0],b=g[1];if(u)return u;var w=b.exec(y);return!!w&&[v,w]},!1)}function parseUserAgent(y){var u=matchUserAgent(y);if(!u)return null;var g=u[0],v=u[1];if(g==="searchbot")return new BotInfo;var b=v[1]&&v[1].split(".").join("_").split("_").slice(0,3);b?b.length<REQUIRED_VERSION_PARTS&&(b=__spreadArray(__spreadArray([],b,!0),createVersionParts(REQUIRED_VERSION_PARTS-b.length),!0)):b=[];var w=b.join("."),E=detectOS(y),S=SEARCHBOT_OS_REGEX.exec(y);return S&&S[1]?new SearchBotDeviceInfo(g,w,E,S[1]):new BrowserInfo(g,w,E)}function detectOS(y){for(var u=0,g=operatingSystemRules.length;u<g;u++){var v=operatingSystemRules[u],b=v[0],w=v[1],E=w.exec(y);if(E)return b}return null}function getNodeVersion(){var y=typeof process$1<"u"&&process$1.version;return y?new NodeInfo(process$1.version.slice(1)):null}function createVersionParts(y){for(var u=[],g=0;g<y;g++)u.push("0");return u}const browser=detect(),isFirefox=browser!=null&&browser.name==="firefox";async function getRtcConfiguration(y){return y=y??{},typeof y=="function"&&(y=await y()),y.iceServers=y.iceServers??DEFAULT_ICE_SERVERS.map(u=>({urls:[u]})),y}const genUfrag=(y=32)=>UFRAG_PREFIX+[...Array(y)].map(()=>UFRAG_ALPHABET.at(Math.floor(Math.random()*UFRAG_ALPHABET.length))).join("");class WebRTCStream extends AbstractStream{channel;incomingData;maxBufferedAmount;receivedFinAck;finAckTimeout;constructor(u){super({...u,maxMessageSize:(u.maxMessageSize??MAX_MESSAGE_SIZE)-PROTOBUF_OVERHEAD}),this.channel=u.channel,this.channel.binaryType="arraybuffer",this.incomingData=pushable(),this.maxBufferedAmount=u.maxBufferedAmount??MAX_BUFFERED_AMOUNT,this.finAckTimeout=u.finAckTimeout??DEFAULT_FIN_ACK_TIMEOUT,this.channel.onclose=()=>{this.log.trace("received datachannel close event"),this.onRemoteCloseWrite(),this.onTransportClosed()},this.channel.onerror=v=>{const b=v.error;this.log.trace("received datachannel error event - %e",b),this.abort(b)},this.channel.onmessage=async v=>{this.log("incoming message %d bytes",v.data.byteLength);const{data:b}=v;b===null||b.byteLength===0||this.incomingData.push(new Uint8Array(b,0,b.byteLength))},this.channel.bufferedAmountLowThreshold=0,this.channel.onbufferedamountlow=()=>{this.writableNeedsDrain&&this.safeDispatchEvent("drain")},Promise.resolve().then(async()=>{for await(const v of decode$5(this.incomingData))this.processIncomingProtobuf(v)}).catch(v=>{this.log.error("error processing incoming data channel messages - %e",v)});const g=()=>{this.channel.readyState==="open"&&(this.log.trace("stream closed, closing underlying datachannel"),this.channel.close())};this.addEventListener("close",g),this.channel.readyState!=="open"&&(this.log('channel ready state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),pEvent(this.channel,"open",{rejectionEvents:["close","error"]}).then(()=>{this.log('channel ready state is now "%s", dispatching drain',this.channel.readyState),this.safeDispatchEvent("drain")}).catch(v=>{this.abort(v.error??v)}))}sendNewStream(){}_sendMessage(u){if(this.channel.readyState!=="open")throw new StreamStateError(`Invalid datachannel state - ${this.channel.readyState}`);if(this.log.trace('sending message, channel state "%s"',this.channel.readyState),isFirefox){this.channel.send(u.subarray());return}for(const g of u)this.channel.send(g)}sendData(u){return this.channel.readyState!=="open"?{sentBytes:0,canSendMore:!1}:(this._sendMessage(encode$7.single(Message$1.encode({message:u.subarray()}))),{sentBytes:u.byteLength,canSendMore:this.channel.bufferedAmount<this.maxBufferedAmount})}sendReset(u){try{this.log.error("sending reset - %e",u),this._sendFlag(Message$1.Flag.RESET),this.receivedFinAck?.reject(u)}catch(g){this.log.error("failed to send reset - %e",g)}}async sendCloseWrite(u){this._sendFlag(Message$1.Flag.FIN),u?.signal?.throwIfAborted(),this.receivedFinAck=Promise.withResolvers();const g=u?.signal??AbortSignal.timeout(this.finAckTimeout),v=[pEvent(this.channel,"close",{signal:g}),pEvent(this.channel,"error",{signal:g})];await Promise.any([raceSignal$2(this.receivedFinAck.promise,g),...v]).finally(()=>{v.forEach(b=>b.cancel())})}async sendCloseRead(u){this._sendFlag(Message$1.Flag.STOP_SENDING),u?.signal?.throwIfAborted()}processIncomingProtobuf(u){const g=Message$1.decode(u);g.message!=null&&(this.readStatus==="readable"||this.readStatus==="paused")&&this.onData(new Uint8ArrayList(g.message)),g.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',g.flag,this.writeStatus,this.readStatus),g.flag===Message$1.Flag.FIN&&(this._sendFlag(Message$1.Flag.FIN_ACK),this.onRemoteCloseWrite()),g.flag===Message$1.Flag.RESET&&(this.receivedFinAck?.reject(new StreamResetError("The stream was reset")),this.onRemoteReset()),g.flag===Message$1.Flag.STOP_SENDING&&this.onRemoteCloseRead(),g.flag===Message$1.Flag.FIN_ACK&&this.receivedFinAck?.resolve())}_sendFlag(u){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',u.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",u.toString());const g=Message$1.encode({flag:u}),v=encode$7.single(g);try{return this._sendMessage(v),!0}catch(b){this.log.error("could not send flag %s - %e",u.toString(),b)}return!1}sendPause(){}sendResume(){}}function createStream(y){const{channel:u,direction:g,isHandshake:v}=y;return new WebRTCStream({...y,id:`${u.id}`,log:y.log.newScope(`${v===!0?"handshake":g}:${u.id}`),protocol:""})}class DataChannelMuxerFactory{protocol;peerConnection;metrics;dataChannelOptions;earlyDataChannels;constructor(u){this.onEarlyDataChannel=this.onEarlyDataChannel.bind(this),this.peerConnection=u.peerConnection,this.metrics=u.metrics,this.protocol=u.protocol??MUXER_PROTOCOL,this.dataChannelOptions=u.dataChannelOptions??{},this.peerConnection.addEventListener("datachannel",this.onEarlyDataChannel),this.earlyDataChannels=[]}onEarlyDataChannel(u){this.earlyDataChannels.push(u.channel)}createStreamMuxer(u){return this.peerConnection.removeEventListener("datachannel",this.onEarlyDataChannel),new DataChannelMuxer(u,{peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,protocol:this.protocol,earlyDataChannels:this.earlyDataChannels})}}class DataChannelMuxer extends AbstractStreamMuxer{peerConnection;dataChannelOptions;constructor(u,g){super(u,{...g,name:"muxer"}),this.peerConnection=g.peerConnection,this.protocol=g.protocol??MUXER_PROTOCOL,this.dataChannelOptions=g.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:v})=>{this.onDataChannel(v)},queueMicrotask(()=>{if(this.status!=="open"){g.earlyDataChannels.forEach(v=>{v.close()});return}g.earlyDataChannels.forEach(v=>{this.onDataChannel(v)})})}onDataChannel(u){if(this.log("incoming datachannel with channel id %d, protocol %s and status %s",u.id,u.protocol,u.readyState),u.label==="init"){this.log.trace("closing init channel %d",u.id),u.close();return}const g=createStream({...this.streamOptions,...this.dataChannelOptions,channel:u,direction:"inbound",log:this.log});this.onRemoteStream(g)}async onCreateStream(u){const g=this.peerConnection.createDataChannel("",{});return this.log("open channel %d for protocol %s",g.id,u?.protocol),createStream({...u,...this.dataChannelOptions,channel:g,direction:"outbound",log:this.log})}onData(){}}class RTCPeerConnectionMultiaddrConnection extends AbstractMultiaddrConnection{peerConnection;constructor(u){super(u),this.peerConnection=u.peerConnection;const g=u.peerConnection.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change %s initial state %s",this.peerConnection.connectionState,g),(this.peerConnection.connectionState==="disconnected"||this.peerConnection.connectionState==="failed"||this.peerConnection.connectionState==="closed")&&(this.onTransportClosed(),this.peerConnection.close())}}sendData(u){return{sentBytes:u.byteLength,canSendMore:!0}}async sendClose(u){this.peerConnection.close(),u?.signal?.throwIfAborted()}sendReset(){this.peerConnection.close()}sendPause(){}sendResume(){}}const toMultiaddrConnection=y=>new RTCPeerConnectionMultiaddrConnection(y),RTCPeerConnection$1=globalThis.RTCPeerConnection,RTCSessionDescription=globalThis.RTCSessionDescription,RTCIceCandidate=globalThis.RTCIceCandidate;class WebRTCTransportError extends Error{constructor(u){super(`WebRTC transport error: ${u}`),this.name="WebRTCTransportError"}}class SDPHandshakeFailedError extends WebRTCTransportError{constructor(u="SDP handshake failed"){super(u),this.name="SDPHandshakeFailedError"}}class InvalidFingerprintError extends WebRTCTransportError{constructor(u,g){super(`Invalid fingerprint "${u}" within ${g}`),this.name="WebRTC/InvalidFingerprintError"}}class UnimplementedError extends WebRTCTransportError{constructor(u){super(`A method (${u}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class UnsupportedHashAlgorithmError extends WebRTCTransportError{constructor(u){super(`unsupported hash algorithm code: ${u} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}var Message;(function(y){(function(v){v.SDP_OFFER="SDP_OFFER",v.SDP_ANSWER="SDP_ANSWER",v.ICE_CANDIDATE="ICE_CANDIDATE"})(y.Type||(y.Type={}));let u;(function(v){v[v.SDP_OFFER=0]="SDP_OFFER",v[v.SDP_ANSWER=1]="SDP_ANSWER",v[v.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(u||(u={})),(function(v){v.codec=()=>enumeration(u)})(y.Type||(y.Type={}));let g;y.codec=()=>(g==null&&(g=message((v,b,w={})=>{w.lengthDelimited!==!1&&b.fork(),v.type!=null&&(b.uint32(8),y.Type.codec().encode(v.type,b)),v.data!=null&&(b.uint32(18),b.string(v.data)),w.lengthDelimited!==!1&&b.ldelim()},(v,b,w={})=>{const E={},S=b==null?v.len:v.pos+b;for(;v.pos<S;){const A=v.uint32();switch(A>>>3){case 1:{E.type=y.Type.codec().decode(v);break}case 2:{E.data=v.string();break}default:{v.skipType(A&7);break}}}return E})),g),y.encode=v=>encodeMessage$1(v,y.codec()),y.decode=(v,b)=>decodeMessage$1(v,y.codec(),b)})(Message||(Message={}));const readCandidatesUntilConnected=async(y,u,g)=>{try{const v=Promise.withResolvers();for(resolveOnConnected(y,v);;){const b=await Promise.race([v.promise,u.read({signal:g.signal})]);if(b==null){g.signal?.throwIfAborted();break}if(b.type!==Message.Type.ICE_CANDIDATE)throw new InvalidMessageError("ICE candidate message expected");const w=JSON.parse(b.data??"null");if(w===""||w===null){g.onProgress?.(new CustomProgressEvent("webrtc:end-of-ice-candidates")),g.log.trace("end-of-candidates received");continue}const E=new RTCIceCandidate(w);g.log.trace("%s received new ICE candidate %o",g.direction,w);try{g.onProgress?.(new CustomProgressEvent("webrtc:add-ice-candidate",E.candidate)),await y.addIceCandidate(E)}catch(S){g.log.error("%s bad candidate received %o - %e",g.direction,w,S)}}}catch(v){if(g.log.error("%s error parsing ICE candidate - %e",g.direction,v),g.signal?.aborted===!0&&y.connectionState!=="connected")throw v}};function resolveOnConnected(y,u){if(y.connectionState==="connected"){u.resolve();return}y.onconnectionstatechange=g=>{switch(y.connectionState){case"connected":u.resolve();break;case"failed":case"disconnected":case"closed":u.reject(new ConnectionFailedError(`RTCPeerConnection connection state became "${y.connectionState}"`));break}}}function getRemotePeer(y){let u;for(const g of y.getComponents())g.name==="p2p"&&(u=peerIdFromString$1(g.value??""));if(u==null)throw new InvalidMultiaddrError$1("Remote peerId must be present in multiaddr");return u}async function initiateConnection({rtcConfiguration:y,dataChannel:u,signal:g,metrics:v,multiaddr:b,connectionManager:w,transportManager:E,log:S,logger:A,onProgress:$}){const{circuitAddress:R,targetPeer:T}=splitAddr(b);v?.dialerEvents.increment({open:!0}),S.trace("dialing circuit address: %a",R);const O=w.getConnections(T);let B;O.length===0?($?.(new CustomProgressEvent("webrtc:dial-relay")),B=await E.dial(R,{signal:g,onProgress:$})):($?.(new CustomProgressEvent("webrtc:reuse-relay-connection")),B=O[0]),$?.(new CustomProgressEvent("webrtc:open-signaling-stream"));const F=await B.newStream(SIGNALING_PROTOCOL,{signal:g,runOnLimitedConnection:!0}),U=pbStream(F).pb(Message),q=new RTCPeerConnection$1(y);q.addEventListener("connectionstatechange",()=>{switch(q.connectionState){case"closed":q.close();break}});const J=new DataChannelMuxerFactory({peerConnection:q,dataChannelOptions:u});try{const ie=q.createDataChannel("init");q.onicecandidate=({candidate:fe})=>{if(q.connectionState==="connected"){S.trace("ignore new ice candidate as peer connection is already connected");return}if(fe==null||fe?.candidate===""){S.trace("initiator detected end of ICE candidates");return}const ye=JSON.stringify(fe?.toJSON()??null);S.trace("initiator sending ICE candidate %o",fe),U.write({type:Message.Type.ICE_CANDIDATE,data:ye},{signal:g}).catch(we=>{S.error("error sending ICE candidate - %e",we)})},q.onicecandidateerror=fe=>{S.error("initiator ICE candidate error",fe)};const oe=await q.createOffer().catch(fe=>{throw S.error("could not execute createOffer - %e",fe),new SDPHandshakeFailedError("Failed to set createOffer")});S.trace("initiator send SDP offer %s",oe.sdp),$?.(new CustomProgressEvent("webrtc:send-sdp-offer")),await U.write({type:Message.Type.SDP_OFFER,data:oe.sdp},{signal:g}),await q.setLocalDescription(oe).catch(fe=>{throw S.error("could not execute setLocalDescription - %e",fe),new SDPHandshakeFailedError("Failed to set localDescription")}),$?.(new CustomProgressEvent("webrtc:read-sdp-answer")),S.trace("initiator read SDP answer");const le=await U.read({signal:g});if(le.type!==Message.Type.SDP_ANSWER)throw new SDPHandshakeFailedError("Remote should send an SDP answer");S.trace("initiator received SDP answer %s",le.data);const de=new RTCSessionDescription({type:"answer",sdp:le.data});return await q.setRemoteDescription(de).catch(fe=>{throw S.error("could not execute setRemoteDescription - %e",fe),new SDPHandshakeFailedError("Failed to set remoteDescription")}),S.trace("initiator read candidates until connected"),$?.(new CustomProgressEvent("webrtc:read-ice-candidates")),await readCandidatesUntilConnected(q,U,{direction:"initiator",signal:g,log:S,onProgress:$}),S.trace("initiator connected"),ie.readyState!=="open"&&(S.trace("wait for init channel to open"),await pEvent(ie,"open",{signal:g})),S.trace("closing init channel"),ie.close(),S.trace("waiting for init channel to close"),await pEvent(ie,"close",{signal:g}),$?.(new CustomProgressEvent("webrtc:close-signaling-stream")),S.trace("closing signaling channel"),await F.close({signal:g}),S.trace("initiator connected to remote address %s",b),{remoteAddress:b,peerConnection:q,muxerFactory:J}}catch(ie){throw S.error("outgoing signaling error - %e",ie),q.close(),F.abort(ie),ie}finally{q.onicecandidate=null,q.onicecandidateerror=null}}const Circuit=fmt(P2P.matchers[0],code(CODE_P2P_CIRCUIT));class WebRTCPeerListener extends TypedEventEmitter{transportManager;shutdownController;events;constructor(u,g){super(),this.transportManager=u.transportManager,this.events=u.events,this.shutdownController=g.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(u){u.detail.getAddrs().filter(v=>Circuit.exactMatch(v)).map(v=>v.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(u=>!(u instanceof WebRTCPeerListener)).map(u=>u.getAddrs().filter(g=>Circuit.exactMatch(g)).map(g=>g.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function handleIncomingStream(y,u,{peerConnection:g,signal:v,log:b}){b.trace("new inbound signaling stream");const w=pbStream(y).pb(Message);try{g.onicecandidate=({candidate:T})=>{if(g.connectionState==="connected"){b.trace("ignore new ice candidate as peer connection is already connected");return}if(T==null||T?.candidate===""){b.trace("recipient detected end of ICE candidates");return}const O=JSON.stringify(T?.toJSON()??null);b.trace("recipient sending ICE candidate %s",O),w.write({type:Message.Type.ICE_CANDIDATE,data:O},{signal:v}).catch(B=>{b.error("error sending ICE candidate - %e",B)})},b.trace("recipient read SDP offer");const A=await w.read({signal:v});if(A.type!==Message.Type.SDP_OFFER)throw new SDPHandshakeFailedError(`expected message type SDP_OFFER, received: ${A.type??"undefined"} `);b.trace("recipient received SDP offer %s",A.data);const $=new RTCSessionDescription({type:"offer",sdp:A.data});await g.setRemoteDescription($).catch(T=>{throw b.error("could not execute setRemoteDescription - %e",T),new SDPHandshakeFailedError("Failed to set remoteDescription")});const R=await g.createAnswer().catch(T=>{throw b.error("could not execute createAnswer - %e",T),new SDPHandshakeFailedError("Failed to create answer")});b.trace("recipient send SDP answer %s",R.sdp),await w.write({type:Message.Type.SDP_ANSWER,data:R.sdp},{signal:v}),await g.setLocalDescription(R).catch(T=>{throw b.error("could not execute setLocalDescription - %e",T),new SDPHandshakeFailedError("Failed to set localDescription")}),b.trace("recipient read candidates until connected"),await readCandidatesUntilConnected(g,w,{direction:"recipient",signal:v,log:b})}catch(A){if(g.connectionState!=="connected")throw b.error("error while handling signaling stream from peer %a - %e",u.remoteAddr,A),g.close(),A;b("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",u.remoteAddr,A)}const E=getRemotePeer(u.remoteAddr),S=multiaddr(`/webrtc/p2p/${E}`);return b.trace("recipient connected to remote address %s",S),{remoteAddress:S,remotePeer:E}}class WebRTCTransport{components;init;log;_started=!1;metrics;shutdownController;constructor(u,g={}){this.components=u,this.init=g,this.log=u.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,u.metrics!=null&&(this.metrics={dialerEvents:u.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:u.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[transportSymbol]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[serviceCapabilities]=["@libp2p/transport"];[serviceDependencies]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}async start(){await this.components.registrar.handle(SIGNALING_PROTOCOL,(u,g)=>{const v=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(u,g,v).catch(b=>{this.log.error("failed to handle incoming connect from %p - %e",g.remotePeer,b)}).finally(()=>{v.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(SIGNALING_PROTOCOL),this._started=!1}createListener(u){return new WebRTCPeerListener(this.components,{shutdownController:this.shutdownController})}listenFilter(u){return u.filter(WebRTC.exactMatch)}dialFilter(u){return this.listenFilter(u)}async dial(u,g){this.log.trace("dialing address: %a",u);const{remoteAddress:v,peerConnection:b,muxerFactory:w}=await initiateConnection({rtcConfiguration:await getRtcConfiguration(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:u,dataChannelOptions:this.init.dataChannel,signal:g.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:g.onProgress}),E=toMultiaddrConnection({peerConnection:b,remoteAddr:v,metrics:this.metrics?.dialerEvents,direction:"outbound",log:this.components.logger.forComponent("libp2p:webrtc:connection")}),S=await g.upgrader.upgradeOutbound(E,{skipProtection:!0,skipEncryption:!0,remotePeer:getRemotePeer(u),muxerFactory:w,onProgress:g.onProgress,signal:g.signal});return this._closeOnShutdown(b,E),S}async _onProtocol(u,g,v){const b=new RTCPeerConnection$1(await getRtcConfiguration(this.init.rtcConfiguration));b.addEventListener("connectionstatechange",()=>{switch(b.connectionState){case"closed":b.close();break}});const w=new DataChannelMuxerFactory({peerConnection:b,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:E,remotePeer:S}=await handleIncomingStream(u,g,{peerConnection:b,signal:v,log:this.log});await u.close({signal:v});const A=toMultiaddrConnection({peerConnection:b,remoteAddr:E,metrics:this.metrics?.listenerEvents,direction:"inbound",log:this.components.logger.forComponent("libp2p:webrtc:connection")});await this.components.upgrader.upgradeInbound(A,{skipEncryption:!0,skipProtection:!0,remotePeer:S,muxerFactory:w,signal:v}),this._closeOnShutdown(b,A)}catch(E){throw this.log.error("incoming signaling error - %e",E),b.close(),u.abort(E),E}}_closeOnShutdown(u,g){const v=()=>{g.close().catch(b=>{this.log.error("could not close WebRTCMultiaddrConnection - %e",b)})};this.shutdownController.signal.addEventListener("abort",v),u.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",v)})}}function splitAddr(y){const u=y.getComponents().filter(({name:v})=>v==="p2p").map(({value:v})=>v).pop();if(u==null)throw new InvalidParametersError$1("Destination peer id was missing");return{circuitAddress:multiaddr(y.getComponents().filter(({name:v})=>v!=="webrtc")),targetPeer:peerIdFromString$1(u)}}var _Reflect={};var hasRequired_Reflect;function require_Reflect(){if(hasRequired_Reflect)return _Reflect;hasRequired_Reflect=1;var y;return(function(u){(function(g){var v=typeof globalThis=="object"?globalThis:typeof commonjsGlobal=="object"?commonjsGlobal:typeof self=="object"?self:typeof this=="object"?this:A(),b=w(u);typeof v.Reflect<"u"&&(b=w(v.Reflect,b)),g(b,v),typeof v.Reflect>"u"&&(v.Reflect=u);function w($,R){return function(T,O){Object.defineProperty($,T,{configurable:!0,writable:!0,value:O}),R&&R(T,O)}}function E(){try{return Function("return this;")()}catch{}}function S(){try{return(0,eval)("(function() { return this; })()")}catch{}}function A(){return E()||S()}})(function(g,v){var b=Object.prototype.hasOwnProperty,w=typeof Symbol=="function",E=w&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",S=w&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",A=typeof Object.create=="function",$={__proto__:[]}instanceof Array,R=!A&&!$,T={create:A?function(){return Ce(Object.create(null))}:$?function(){return Ce({__proto__:null})}:function(){return Ce({})},has:R?function(Ee,Pe){return b.call(Ee,Pe)}:function(Ee,Pe){return Pe in Ee},get:R?function(Ee,Pe){return b.call(Ee,Pe)?Ee[Pe]:void 0}:function(Ee,Pe){return Ee[Pe]}},O=Object.getPrototypeOf(Function),B=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:kt(),F=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ct(),U=typeof WeakMap=="function"?WeakMap:Me(),q=w?Symbol.for("@reflect-metadata:registry"):void 0,J=ot(),ie=vt(J);function oe(Ee,Pe,je,He){if(ue(je)){if(!Se(Ee))throw new TypeError;if(!Le(Pe))throw new TypeError;return Q(Ee,Pe)}else{if(!Se(Ee))throw new TypeError;if(!Ae(Pe))throw new TypeError;if(!Ae(He)&&!ue(He)&&!_e(He))throw new TypeError;return _e(He)&&(He=void 0),je=Ie(je),j(Ee,Pe,je,He)}}g("decorate",oe);function le(Ee,Pe){function je(He,Ve){if(!Ae(He))throw new TypeError;if(!ue(Ve)&&!qe(Ve))throw new TypeError;ne(Ee,Pe,He,Ve)}return je}g("metadata",le);function de(Ee,Pe,je,He){if(!Ae(je))throw new TypeError;return ue(He)||(He=Ie(He)),ne(Ee,Pe,je,He)}g("defineMetadata",de);function fe(Ee,Pe,je){if(!Ae(Pe))throw new TypeError;return ue(je)||(je=Ie(je)),z(Ee,Pe,je)}g("hasMetadata",fe);function ye(Ee,Pe,je){if(!Ae(Pe))throw new TypeError;return ue(je)||(je=Ie(je)),re(Ee,Pe,je)}g("hasOwnMetadata",ye);function we(Ee,Pe,je){if(!Ae(Pe))throw new TypeError;return ue(je)||(je=Ie(je)),Y(Ee,Pe,je)}g("getMetadata",we);function pe(Ee,Pe,je){if(!Ae(Pe))throw new TypeError;return ue(je)||(je=Ie(je)),te(Ee,Pe,je)}g("getOwnMetadata",pe);function ve(Ee,Pe){if(!Ae(Ee))throw new TypeError;return ue(Pe)||(Pe=Ie(Pe)),se(Ee,Pe)}g("getMetadataKeys",ve);function he(Ee,Pe){if(!Ae(Ee))throw new TypeError;return ue(Pe)||(Pe=Ie(Pe)),ee(Ee,Pe)}g("getOwnMetadataKeys",he);function ae(Ee,Pe,je){if(!Ae(Pe))throw new TypeError;if(ue(je)||(je=Ie(je)),!Ae(Pe))throw new TypeError;ue(je)||(je=Ie(je));var He=lt(Pe,je,!1);return ue(He)?!1:He.OrdinaryDeleteMetadata(Ee,Pe,je)}g("deleteMetadata",ae);function Q(Ee,Pe){for(var je=Ee.length-1;je>=0;--je){var He=Ee[je],Ve=He(Pe);if(!ue(Ve)&&!_e(Ve)){if(!Le(Ve))throw new TypeError;Pe=Ve}}return Pe}function j(Ee,Pe,je,He){for(var Ve=Ee.length-1;Ve>=0;--Ve){var dt=Ee[Ve],xt=dt(Pe,je,He);if(!ue(xt)&&!_e(xt)){if(!Ae(xt))throw new TypeError;He=xt}}return He}function z(Ee,Pe,je){var He=re(Ee,Pe,je);if(He)return!0;var Ve=nt(Pe);return _e(Ve)?!1:z(Ee,Ve,je)}function re(Ee,Pe,je){var He=lt(Pe,je,!1);return ue(He)?!1:Te(He.OrdinaryHasOwnMetadata(Ee,Pe,je))}function Y(Ee,Pe,je){var He=re(Ee,Pe,je);if(He)return te(Ee,Pe,je);var Ve=nt(Pe);if(!_e(Ve))return Y(Ee,Ve,je)}function te(Ee,Pe,je){var He=lt(Pe,je,!1);if(!ue(He))return He.OrdinaryGetOwnMetadata(Ee,Pe,je)}function ne(Ee,Pe,je,He){var Ve=lt(je,He,!0);Ve.OrdinaryDefineOwnMetadata(Ee,Pe,je,He)}function se(Ee,Pe){var je=ee(Ee,Pe),He=nt(Ee);if(He===null)return je;var Ve=se(He,Pe);if(Ve.length<=0)return je;if(je.length<=0)return Ve;for(var dt=new F,xt=[],mt=0,gt=je;mt<gt.length;mt++){var at=gt[mt],ht=dt.has(at);ht||(dt.add(at),xt.push(at))}for(var _t=0,$t=Ve;_t<$t.length;_t++){var at=$t[_t],ht=dt.has(at);ht||(dt.add(at),xt.push(at))}return xt}function ee(Ee,Pe){var je=lt(Ee,Pe,!1);return je?je.OrdinaryOwnMetadataKeys(Ee,Pe):[]}function Z(Ee){if(Ee===null)return 1;switch(typeof Ee){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ee===null?1:6;default:return 6}}function ue(Ee){return Ee===void 0}function _e(Ee){return Ee===null}function Re(Ee){return typeof Ee=="symbol"}function Ae(Ee){return typeof Ee=="object"?Ee!==null:typeof Ee=="function"}function ge(Ee,Pe){switch(Z(Ee)){case 0:return Ee;case 1:return Ee;case 2:return Ee;case 3:return Ee;case 4:return Ee;case 5:return Ee}var je="string",He=Ge(Ee,E);if(He!==void 0){var Ve=He.call(Ee,je);if(Ae(Ve))throw new TypeError;return Ve}return be(Ee)}function be(Ee,Pe){var je,He,Ve;{var dt=Ee.toString;if(Be(dt)){var He=dt.call(Ee);if(!Ae(He))return He}var je=Ee.valueOf;if(Be(je)){var He=je.call(Ee);if(!Ae(He))return He}}throw new TypeError}function Te(Ee){return!!Ee}function De(Ee){return""+Ee}function Ie(Ee){var Pe=ge(Ee);return Re(Pe)?Pe:De(Pe)}function Se(Ee){return Array.isArray?Array.isArray(Ee):Ee instanceof Object?Ee instanceof Array:Object.prototype.toString.call(Ee)==="[object Array]"}function Be(Ee){return typeof Ee=="function"}function Le(Ee){return typeof Ee=="function"}function qe(Ee){switch(Z(Ee)){case 3:return!0;case 4:return!0;default:return!1}}function Ke(Ee,Pe){return Ee===Pe||Ee!==Ee&&Pe!==Pe}function Ge(Ee,Pe){var je=Ee[Pe];if(je!=null){if(!Be(je))throw new TypeError;return je}}function Xe(Ee){var Pe=Ge(Ee,S);if(!Be(Pe))throw new TypeError;var je=Pe.call(Ee);if(!Ae(je))throw new TypeError;return je}function ze(Ee){return Ee.value}function et(Ee){var Pe=Ee.next();return Pe.done?!1:Pe}function Ze(Ee){var Pe=Ee.return;Pe&&Pe.call(Ee)}function nt(Ee){var Pe=Object.getPrototypeOf(Ee);if(typeof Ee!="function"||Ee===O||Pe!==O)return Pe;var je=Ee.prototype,He=je&&Object.getPrototypeOf(je);if(He==null||He===Object.prototype)return Pe;var Ve=He.constructor;return typeof Ve!="function"||Ve===Ee?Pe:Ve}function ut(){var Ee;!ue(q)&&typeof v.Reflect<"u"&&!(q in v.Reflect)&&typeof v.Reflect.defineMetadata=="function"&&(Ee=bt(v.Reflect));var Pe,je,He,Ve=new U,dt={registerProvider:xt,getProvider:gt,setProvider:ht};return dt;function xt(_t){if(!Object.isExtensible(dt))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case Ee===_t:break;case ue(Pe):Pe=_t;break;case Pe===_t:break;case ue(je):je=_t;break;case je===_t:break;default:He===void 0&&(He=new F),He.add(_t);break}}function mt(_t,$t){if(!ue(Pe)){if(Pe.isProviderFor(_t,$t))return Pe;if(!ue(je)){if(je.isProviderFor(_t,$t))return Pe;if(!ue(He))for(var St=Xe(He);;){var ft=et(St);if(!ft)return;var At=ze(ft);if(At.isProviderFor(_t,$t))return Ze(St),At}}}if(!ue(Ee)&&Ee.isProviderFor(_t,$t))return Ee}function gt(_t,$t){var St=Ve.get(_t),ft;return ue(St)||(ft=St.get($t)),ue(ft)&&(ft=mt(_t,$t),ue(ft)||(ue(St)&&(St=new B,Ve.set(_t,St)),St.set($t,ft))),ft}function at(_t){if(ue(_t))throw new TypeError;return Pe===_t||je===_t||!ue(He)&&He.has(_t)}function ht(_t,$t,St){if(!at(St))throw new Error("Metadata provider not registered.");var ft=gt(_t,$t);if(ft!==St){if(!ue(ft))return!1;var At=Ve.get(_t);ue(At)&&(At=new B,Ve.set(_t,At)),At.set($t,St)}return!0}}function ot(){var Ee;return!ue(q)&&Ae(v.Reflect)&&Object.isExtensible(v.Reflect)&&(Ee=v.Reflect[q]),ue(Ee)&&(Ee=ut()),!ue(q)&&Ae(v.Reflect)&&Object.isExtensible(v.Reflect)&&Object.defineProperty(v.Reflect,q,{enumerable:!1,configurable:!1,writable:!1,value:Ee}),Ee}function vt(Ee){var Pe=new U,je={isProviderFor:function(at,ht){var _t=Pe.get(at);return ue(_t)?!1:_t.has(ht)},OrdinaryDefineOwnMetadata:xt,OrdinaryHasOwnMetadata:Ve,OrdinaryGetOwnMetadata:dt,OrdinaryOwnMetadataKeys:mt,OrdinaryDeleteMetadata:gt};return J.registerProvider(je),je;function He(at,ht,_t){var $t=Pe.get(at),St=!1;if(ue($t)){if(!_t)return;$t=new B,Pe.set(at,$t),St=!0}var ft=$t.get(ht);if(ue(ft)){if(!_t)return;if(ft=new B,$t.set(ht,ft),!Ee.setProvider(at,ht,je))throw $t.delete(ht),St&&Pe.delete(at),new Error("Wrong provider for target.")}return ft}function Ve(at,ht,_t){var $t=He(ht,_t,!1);return ue($t)?!1:Te($t.has(at))}function dt(at,ht,_t){var $t=He(ht,_t,!1);if(!ue($t))return $t.get(at)}function xt(at,ht,_t,$t){var St=He(_t,$t,!0);St.set(at,ht)}function mt(at,ht){var _t=[],$t=He(at,ht,!1);if(ue($t))return _t;for(var St=$t.keys(),ft=Xe(St),At=0;;){var Oe=et(ft);if(!Oe)return _t.length=At,_t;var $e=ze(Oe);try{_t[At]=$e}catch(ke){try{Ze(ft)}finally{throw ke}}At++}}function gt(at,ht,_t){var $t=He(ht,_t,!1);if(ue($t)||!$t.delete(at))return!1;if($t.size===0){var St=Pe.get(ht);ue(St)||(St.delete(_t),St.size===0&&Pe.delete(St))}return!0}}function bt(Ee){var Pe=Ee.defineMetadata,je=Ee.hasOwnMetadata,He=Ee.getOwnMetadata,Ve=Ee.getOwnMetadataKeys,dt=Ee.deleteMetadata,xt=new U,mt={isProviderFor:function(gt,at){var ht=xt.get(gt);return!ue(ht)&&ht.has(at)?!0:Ve(gt,at).length?(ue(ht)&&(ht=new F,xt.set(gt,ht)),ht.add(at),!0):!1},OrdinaryDefineOwnMetadata:Pe,OrdinaryHasOwnMetadata:je,OrdinaryGetOwnMetadata:He,OrdinaryOwnMetadataKeys:Ve,OrdinaryDeleteMetadata:dt};return mt}function lt(Ee,Pe,je){var He=J.getProvider(Ee,Pe);if(!ue(He))return He;if(je){if(J.setProvider(Ee,Pe,ie))return ie;throw new Error("Illegal state.")}}function kt(){var Ee={},Pe=[],je=(function(){function mt(gt,at,ht){this._index=0,this._keys=gt,this._values=at,this._selector=ht}return mt.prototype["@@iterator"]=function(){return this},mt.prototype[S]=function(){return this},mt.prototype.next=function(){var gt=this._index;if(gt>=0&&gt<this._keys.length){var at=this._selector(this._keys[gt],this._values[gt]);return gt+1>=this._keys.length?(this._index=-1,this._keys=Pe,this._values=Pe):this._index++,{value:at,done:!1}}return{value:void 0,done:!0}},mt.prototype.throw=function(gt){throw this._index>=0&&(this._index=-1,this._keys=Pe,this._values=Pe),gt},mt.prototype.return=function(gt){return this._index>=0&&(this._index=-1,this._keys=Pe,this._values=Pe),{value:gt,done:!0}},mt})(),He=(function(){function mt(){this._keys=[],this._values=[],this._cacheKey=Ee,this._cacheIndex=-2}return Object.defineProperty(mt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),mt.prototype.has=function(gt){return this._find(gt,!1)>=0},mt.prototype.get=function(gt){var at=this._find(gt,!1);return at>=0?this._values[at]:void 0},mt.prototype.set=function(gt,at){var ht=this._find(gt,!0);return this._values[ht]=at,this},mt.prototype.delete=function(gt){var at=this._find(gt,!1);if(at>=0){for(var ht=this._keys.length,_t=at+1;_t<ht;_t++)this._keys[_t-1]=this._keys[_t],this._values[_t-1]=this._values[_t];return this._keys.length--,this._values.length--,Ke(gt,this._cacheKey)&&(this._cacheKey=Ee,this._cacheIndex=-2),!0}return!1},mt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ee,this._cacheIndex=-2},mt.prototype.keys=function(){return new je(this._keys,this._values,Ve)},mt.prototype.values=function(){return new je(this._keys,this._values,dt)},mt.prototype.entries=function(){return new je(this._keys,this._values,xt)},mt.prototype["@@iterator"]=function(){return this.entries()},mt.prototype[S]=function(){return this.entries()},mt.prototype._find=function(gt,at){if(!Ke(this._cacheKey,gt)){this._cacheIndex=-1;for(var ht=0;ht<this._keys.length;ht++)if(Ke(this._keys[ht],gt)){this._cacheIndex=ht;break}}return this._cacheIndex<0&&at&&(this._cacheIndex=this._keys.length,this._keys.push(gt),this._values.push(void 0)),this._cacheIndex},mt})();return He;function Ve(mt,gt){return mt}function dt(mt,gt){return gt}function xt(mt,gt){return[mt,gt]}}function Ct(){var Ee=(function(){function Pe(){this._map=new B}return Object.defineProperty(Pe.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Pe.prototype.has=function(je){return this._map.has(je)},Pe.prototype.add=function(je){return this._map.set(je,je),this},Pe.prototype.delete=function(je){return this._map.delete(je)},Pe.prototype.clear=function(){this._map.clear()},Pe.prototype.keys=function(){return this._map.keys()},Pe.prototype.values=function(){return this._map.keys()},Pe.prototype.entries=function(){return this._map.entries()},Pe.prototype["@@iterator"]=function(){return this.keys()},Pe.prototype[S]=function(){return this.keys()},Pe})();return Ee}function Me(){var Ee=16,Pe=T.create(),je=He();return(function(){function gt(){this._key=He()}return gt.prototype.has=function(at){var ht=Ve(at,!1);return ht!==void 0?T.has(ht,this._key):!1},gt.prototype.get=function(at){var ht=Ve(at,!1);return ht!==void 0?T.get(ht,this._key):void 0},gt.prototype.set=function(at,ht){var _t=Ve(at,!0);return _t[this._key]=ht,this},gt.prototype.delete=function(at){var ht=Ve(at,!1);return ht!==void 0?delete ht[this._key]:!1},gt.prototype.clear=function(){this._key=He()},gt})();function He(){var gt;do gt="@@WeakMap@@"+mt();while(T.has(Pe,gt));return Pe[gt]=!0,gt}function Ve(gt,at){if(!b.call(gt,je)){if(!at)return;Object.defineProperty(gt,je,{value:T.create()})}return gt[je]}function dt(gt,at){for(var ht=0;ht<at;++ht)gt[ht]=Math.random()*255|0;return gt}function xt(gt){if(typeof Uint8Array=="function"){var at=new Uint8Array(gt);return typeof crypto<"u"?crypto.getRandomValues(at):typeof msCrypto<"u"?msCrypto.getRandomValues(at):dt(at,gt),at}return dt(new Array(gt),gt)}function mt(){var gt=xt(Ee);gt[6]=gt[6]&79|64,gt[8]=gt[8]&191|128;for(var at="",ht=0;ht<Ee;++ht){var _t=gt[ht];(ht===4||ht===6||ht===8)&&(at+="-"),_t<16&&(at+="0"),at+=_t.toString(16).toLowerCase()}return at}}function Ce(Ee){return Ee.__=void 0,delete Ee.__,Ee}})})(y||(y={})),_Reflect}require_Reflect();var AsnTypeTypes;(function(y){y[y.Sequence=0]="Sequence",y[y.Set=1]="Set",y[y.Choice=2]="Choice"})(AsnTypeTypes||(AsnTypeTypes={}));var AsnPropTypes;(function(y){y[y.Any=1]="Any",y[y.Boolean=2]="Boolean",y[y.OctetString=3]="OctetString",y[y.BitString=4]="BitString",y[y.Integer=5]="Integer",y[y.Enumerated=6]="Enumerated",y[y.ObjectIdentifier=7]="ObjectIdentifier",y[y.Utf8String=8]="Utf8String",y[y.BmpString=9]="BmpString",y[y.UniversalString=10]="UniversalString",y[y.NumericString=11]="NumericString",y[y.PrintableString=12]="PrintableString",y[y.TeletexString=13]="TeletexString",y[y.VideotexString=14]="VideotexString",y[y.IA5String=15]="IA5String",y[y.GraphicString=16]="GraphicString",y[y.VisibleString=17]="VisibleString",y[y.GeneralString=18]="GeneralString",y[y.CharacterString=19]="CharacterString",y[y.UTCTime=20]="UTCTime",y[y.GeneralizedTime=21]="GeneralizedTime",y[y.DATE=22]="DATE",y[y.TimeOfDay=23]="TimeOfDay",y[y.DateTime=24]="DateTime",y[y.Duration=25]="Duration",y[y.TIME=26]="TIME",y[y.Null=27]="Null"})(AsnPropTypes||(AsnPropTypes={}));class BitString{constructor(u,g=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),u)if(typeof u=="number")this.fromNumber(u);else if(BufferSourceConverter.isBufferSource(u))this.unusedBits=g,this.value=BufferSourceConverter.toArrayBuffer(u);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(u){if(!(u instanceof BitString$1))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=u.valueBlock.unusedBits,this.value=u.valueBlock.valueHex,this}toASN(){return new BitString$1({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(u){return new BitString$1({name:u})}toNumber(){let u="";const g=new Uint8Array(this.value);for(const v of g)u+=v.toString(2).padStart(8,"0");return u=u.split("").reverse().join(""),this.unusedBits&&(u=u.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(u,2)}fromNumber(u){let g=u.toString(2);const v=g.length+7>>3;this.unusedBits=(v<<3)-g.length;const b=new Uint8Array(v);g=g.padStart(v<<3,"0").split("").reverse().join("");let w=0;for(;w<v;)b[w]=parseInt(g.slice(w<<3,(w<<3)+8),2),w++;this.value=b.buffer}}class OctetString{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(u){typeof u=="number"?this.buffer=new ArrayBuffer(u):BufferSourceConverter.isBufferSource(u)?this.buffer=BufferSourceConverter.toArrayBuffer(u):Array.isArray(u)?this.buffer=new Uint8Array(u):this.buffer=new ArrayBuffer(0)}fromASN(u){if(!(u instanceof OctetString$1))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=u.valueBlock.valueHex,this}toASN(){return new OctetString$1({valueHex:this.buffer})}toSchema(u){return new OctetString$1({name:u})}}const AsnAnyConverter={fromASN:y=>y instanceof Null?null:y.valueBeforeDecodeView,toASN:y=>{if(y===null)return new Null;const u=fromBER(y);if(u.result.error)throw new Error(u.result.error);return u.result}},AsnIntegerConverter={fromASN:y=>y.valueBlock.valueHexView.byteLength>=4?y.valueBlock.toString():y.valueBlock.valueDec,toASN:y=>new Integer({value:+y})},AsnEnumeratedConverter={fromASN:y=>y.valueBlock.valueDec,toASN:y=>new Enumerated({value:y})},AsnIntegerArrayBufferConverter={fromASN:y=>y.valueBlock.valueHexView,toASN:y=>new Integer({valueHex:y})},AsnBitStringConverter={fromASN:y=>y.valueBlock.valueHexView,toASN:y=>new BitString$1({valueHex:y})},AsnObjectIdentifierConverter={fromASN:y=>y.valueBlock.toString(),toASN:y=>new ObjectIdentifier({value:y})},AsnBooleanConverter={fromASN:y=>y.valueBlock.value,toASN:y=>new Boolean$1({value:y})},AsnOctetStringConverter={fromASN:y=>y.valueBlock.valueHexView,toASN:y=>new OctetString$1({valueHex:y})},AsnConstructedOctetStringConverter={fromASN:y=>new OctetString(y.getValue()),toASN:y=>y.toASN()};function createStringConverter(y){return{fromASN:u=>u.valueBlock.value,toASN:u=>new y({value:u})}}const AsnUtf8StringConverter=createStringConverter(Utf8String),AsnBmpStringConverter=createStringConverter(BmpString),AsnUniversalStringConverter=createStringConverter(UniversalString),AsnNumericStringConverter=createStringConverter(NumericString),AsnPrintableStringConverter=createStringConverter(PrintableString),AsnTeletexStringConverter=createStringConverter(TeletexString),AsnVideotexStringConverter=createStringConverter(VideotexString),AsnIA5StringConverter=createStringConverter(IA5String),AsnGraphicStringConverter=createStringConverter(GraphicString),AsnVisibleStringConverter=createStringConverter(VisibleString),AsnGeneralStringConverter=createStringConverter(GeneralString),AsnCharacterStringConverter=createStringConverter(CharacterString),AsnUTCTimeConverter={fromASN:y=>y.toDate(),toASN:y=>new UTCTime({valueDate:y})},AsnGeneralizedTimeConverter={fromASN:y=>y.toDate(),toASN:y=>new GeneralizedTime({valueDate:y})},AsnNullConverter={fromASN:()=>null,toASN:()=>new Null};function defaultConverter(y){switch(y){case AsnPropTypes.Any:return AsnAnyConverter;case AsnPropTypes.BitString:return AsnBitStringConverter;case AsnPropTypes.BmpString:return AsnBmpStringConverter;case AsnPropTypes.Boolean:return AsnBooleanConverter;case AsnPropTypes.CharacterString:return AsnCharacterStringConverter;case AsnPropTypes.Enumerated:return AsnEnumeratedConverter;case AsnPropTypes.GeneralString:return AsnGeneralStringConverter;case AsnPropTypes.GeneralizedTime:return AsnGeneralizedTimeConverter;case AsnPropTypes.GraphicString:return AsnGraphicStringConverter;case AsnPropTypes.IA5String:return AsnIA5StringConverter;case AsnPropTypes.Integer:return AsnIntegerConverter;case AsnPropTypes.Null:return AsnNullConverter;case AsnPropTypes.NumericString:return AsnNumericStringConverter;case AsnPropTypes.ObjectIdentifier:return AsnObjectIdentifierConverter;case AsnPropTypes.OctetString:return AsnOctetStringConverter;case AsnPropTypes.PrintableString:return AsnPrintableStringConverter;case AsnPropTypes.TeletexString:return AsnTeletexStringConverter;case AsnPropTypes.UTCTime:return AsnUTCTimeConverter;case AsnPropTypes.UniversalString:return AsnUniversalStringConverter;case AsnPropTypes.Utf8String:return AsnUtf8StringConverter;case AsnPropTypes.VideotexString:return AsnVideotexStringConverter;case AsnPropTypes.VisibleString:return AsnVisibleStringConverter;default:return null}}function isConvertible(y){return typeof y=="function"&&y.prototype?y.prototype.toASN&&y.prototype.fromASN?!0:isConvertible(y.prototype):!!(y&&typeof y=="object"&&"toASN"in y&&"fromASN"in y)}function isTypeOfArray(y){var u;if(y){const g=Object.getPrototypeOf(y);return((u=g?.prototype)===null||u===void 0?void 0:u.constructor)===Array?!0:isTypeOfArray(g)}return!1}function isArrayEqual(y,u){if(!(y&&u)||y.byteLength!==u.byteLength)return!1;const g=new Uint8Array(y),v=new Uint8Array(u);for(let b=0;b<y.byteLength;b++)if(g[b]!==v[b])return!1;return!0}class AsnSchemaStorage{constructor(){this.items=new WeakMap}has(u){return this.items.has(u)}get(u,g=!1){const v=this.items.get(u);if(!v)throw new Error(`Cannot get schema for '${u.prototype.constructor.name}' target`);if(g&&!v.schema)throw new Error(`Schema '${u.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return v}cache(u){const g=this.get(u);g.schema||(g.schema=this.create(u,!0))}createDefault(u){const g={type:AsnTypeTypes.Sequence,items:{}},v=this.findParentSchema(u);return v&&(Object.assign(g,v),g.items=Object.assign({},g.items,v.items)),g}create(u,g){const v=this.items.get(u)||this.createDefault(u),b=[];for(const w in v.items){const E=v.items[w],S=g?w:"";let A;if(typeof E.type=="number"){const R=AsnPropTypes[E.type],T=asn1js[R];if(!T)throw new Error(`Cannot get ASN1 class by name '${R}'`);A=new T({name:S})}else isConvertible(E.type)?A=new E.type().toSchema(S):E.optional?this.get(E.type).type===AsnTypeTypes.Choice?A=new Any({name:S}):(A=this.create(E.type,!1),A.name=S):A=new Any({name:S});const $=!!E.optional||E.defaultValue!==void 0;if(E.repeated){A.name="";const R=E.repeated==="set"?Set$1:Sequence;A=new R({name:"",value:[new Repeated({name:S,value:A})]})}if(E.context!==null&&E.context!==void 0)if(E.implicit)if(typeof E.type=="number"||isConvertible(E.type)){const R=E.repeated?Constructed:Primitive;b.push(new R({name:S,optional:$,idBlock:{tagClass:3,tagNumber:E.context}}))}else{this.cache(E.type);const R=!!E.repeated;let T=R?A:this.get(E.type,!0).schema;T="valueBlock"in T?T.valueBlock.value:T.value,b.push(new Constructed({name:R?"":S,optional:$,idBlock:{tagClass:3,tagNumber:E.context},value:T}))}else b.push(new Constructed({optional:$,idBlock:{tagClass:3,tagNumber:E.context},value:[A]}));else A.optional=$,b.push(A)}switch(v.type){case AsnTypeTypes.Sequence:return new Sequence({value:b,name:""});case AsnTypeTypes.Set:return new Set$1({value:b,name:""});case AsnTypeTypes.Choice:return new Choice({value:b,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(u,g){return this.items.set(u,g),this}findParentSchema(u){const g=Object.getPrototypeOf(u);return g?this.items.get(g)||this.findParentSchema(g):null}}const schemaStorage=new AsnSchemaStorage,AsnType=y=>u=>{let g;schemaStorage.has(u)?g=schemaStorage.get(u):(g=schemaStorage.createDefault(u),schemaStorage.set(u,g)),Object.assign(g,y)},AsnProp=y=>(u,g)=>{let v;schemaStorage.has(u.constructor)?v=schemaStorage.get(u.constructor):(v=schemaStorage.createDefault(u.constructor),schemaStorage.set(u.constructor,v));const b=Object.assign({},y);if(typeof b.type=="number"&&!b.converter){const w=defaultConverter(y.type);if(!w)throw new Error(`Cannot get default converter for property '${g}' of ${u.constructor.name}`);b.converter=w}b.raw=y.raw,v.items[g]=b};class AsnSchemaValidationError extends Error{constructor(){super(...arguments),this.schemas=[]}}class AsnParser{static parse(u,g){const v=fromBER(u);if(v.result.error)throw new Error(v.result.error);return this.fromASN(v.result,g)}static fromASN(u,g){try{if(isConvertible(g))return new g().fromASN(u);const v=schemaStorage.get(g);schemaStorage.cache(g);let b=v.schema;const w=this.handleChoiceTypes(u,v,g,b);if(w?.result)return w.result;w?.targetSchema&&(b=w.targetSchema);const E=this.handleSequenceTypes(u,v,g,b),S=new g;return isTypeOfArray(g)?this.handleArrayTypes(u,v,g):(this.processSchemaItems(v,E,S),S)}catch(v){throw v instanceof AsnSchemaValidationError&&v.schemas.push(g.name),v}}static handleChoiceTypes(u,g,v,b){if(u.constructor===Constructed&&g.type===AsnTypeTypes.Choice&&u.idBlock.tagClass===3)for(const w in g.items){const E=g.items[w];if(E.context===u.idBlock.tagNumber&&E.implicit&&typeof E.type=="function"&&schemaStorage.has(E.type)){const S=schemaStorage.get(E.type);if(S&&S.type===AsnTypeTypes.Sequence){const A=new Sequence;if("value"in u.valueBlock&&Array.isArray(u.valueBlock.value)&&"value"in A.valueBlock){A.valueBlock.value=u.valueBlock.value;const $=this.fromASN(A,E.type),R=new v;return R[w]=$,{result:R}}}}}else if(u.constructor===Constructed&&g.type!==AsnTypeTypes.Choice){const w=new Constructed({idBlock:{tagClass:3,tagNumber:u.idBlock.tagNumber},value:g.schema.valueBlock.value});for(const E in g.items)delete u[E];return{targetSchema:w}}return null}static handleSequenceTypes(u,g,v,b){if(g.type===AsnTypeTypes.Sequence){const w=compareSchema({},u,b);if(!w.verified)throw new AsnSchemaValidationError(`Data does not match to ${v.name} ASN1 schema.${w.result.error?` ${w.result.error}`:""}`);return w}else{const w=compareSchema({},u,b);if(!w.verified)throw new AsnSchemaValidationError(`Data does not match to ${v.name} ASN1 schema.${w.result.error?` ${w.result.error}`:""}`);return w}}static processRepeatedField(u,g,v){let b=u.slice(g);if(b.length===1&&b[0].constructor.name==="Sequence"){const w=b[0];w.valueBlock&&w.valueBlock.value&&Array.isArray(w.valueBlock.value)&&(b=w.valueBlock.value)}if(typeof v.type=="number"){const w=defaultConverter(v.type);if(!w)throw new Error(`No converter for ASN.1 type ${v.type}`);return b.filter(E=>E&&E.valueBlock).map(E=>{try{return w.fromASN(E)}catch{return}}).filter(E=>E!==void 0)}else return b.filter(w=>w&&w.valueBlock).map(w=>{try{return this.fromASN(w,v.type)}catch{return}}).filter(w=>w!==void 0)}static processPrimitiveField(u,g){const v=defaultConverter(g.type);if(!v)throw new Error(`No converter for ASN.1 type ${g.type}`);return v.fromASN(u)}static isOptionalChoiceField(u){return u.optional&&typeof u.type=="function"&&schemaStorage.has(u.type)&&schemaStorage.get(u.type).type===AsnTypeTypes.Choice}static processOptionalChoiceField(u,g){try{return{processed:!0,value:this.fromASN(u,g.type)}}catch(v){if(v instanceof AsnSchemaValidationError&&/Wrong values for Choice type/.test(v.message))return{processed:!1};throw v}}static handleArrayTypes(u,g,v){if(!("value"in u.valueBlock&&Array.isArray(u.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const b=g.itemType;if(typeof b=="number"){const w=defaultConverter(b);if(!w)throw new Error(`Cannot get default converter for array item of ${v.name} ASN1 schema`);return v.from(u.valueBlock.value,E=>w.fromASN(E))}else return v.from(u.valueBlock.value,w=>this.fromASN(w,b))}static processSchemaItems(u,g,v){for(const b in u.items){const w=g.result[b];if(!w)continue;const E=u.items[b],S=E.type;let A;typeof S=="number"||isConvertible(S)?A=this.processPrimitiveSchemaItem(w,E,S):A=this.processComplexSchemaItem(w,E,S),A&&typeof A=="object"&&"value"in A&&"raw"in A?(v[b]=A.value,v[`${b}Raw`]=A.raw):v[b]=A}}static processPrimitiveSchemaItem(u,g,v){var b;const w=(b=g.converter)!==null&&b!==void 0?b:isConvertible(v)?new v:null;if(!w)throw new Error("Converter is empty");return g.repeated?this.processRepeatedPrimitiveItem(u,g,w):this.processSinglePrimitiveItem(u,g,v,w)}static processRepeatedPrimitiveItem(u,g,v){if(g.implicit){const b=g.repeated==="sequence"?Sequence:Set$1,w=new b;w.valueBlock=u.valueBlock;const E=fromBER(w.toBER(!1));if(E.offset===-1)throw new Error(`Cannot parse the child item. ${E.result.error}`);if(!("value"in E.result.valueBlock&&Array.isArray(E.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const S=E.result.valueBlock.value;return Array.from(S,A=>v.fromASN(A))}else return Array.from(u,b=>v.fromASN(b))}static processSinglePrimitiveItem(u,g,v,b){let w=u;if(g.implicit){let E;if(isConvertible(v))E=new v().toSchema("");else{const S=AsnPropTypes[v],A=asn1js[S];if(!A)throw new Error(`Cannot get '${S}' class from asn1js module`);E=new A}E.valueBlock=w.valueBlock,w=fromBER(E.toBER(!1)).result}return b.fromASN(w)}static processComplexSchemaItem(u,g,v){if(g.repeated){if(!Array.isArray(u))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");return Array.from(u,b=>this.fromASN(b,v))}else{const b=this.handleImplicitTagging(u,g,v);if(this.isOptionalChoiceField(g))try{return this.fromASN(b,v)}catch(w){if(w instanceof AsnSchemaValidationError&&/Wrong values for Choice type/.test(w.message))return;throw w}else{const w=this.fromASN(b,v);return g.raw?{value:w,raw:u.valueBeforeDecodeView}:w}}}static handleImplicitTagging(u,g,v){if(g.implicit&&typeof g.context=="number"){const b=schemaStorage.get(v);if(b.type===AsnTypeTypes.Sequence){const w=new Sequence;if("value"in u.valueBlock&&Array.isArray(u.valueBlock.value)&&"value"in w.valueBlock)return w.valueBlock.value=u.valueBlock.value,w}else if(b.type===AsnTypeTypes.Set){const w=new Set$1;if("value"in u.valueBlock&&Array.isArray(u.valueBlock.value)&&"value"in w.valueBlock)return w.valueBlock.value=u.valueBlock.value,w}}return u}}class AsnSerializer{static serialize(u){return u instanceof BaseBlock?u.toBER(!1):this.toASN(u).toBER(!1)}static toASN(u){if(u&&typeof u=="object"&&isConvertible(u))return u.toASN();if(!(u&&typeof u=="object"))throw new TypeError("Parameter 1 should be type of Object.");const g=u.constructor,v=schemaStorage.get(g);schemaStorage.cache(g);let b=[];if(v.itemType){if(!Array.isArray(u))throw new TypeError("Parameter 1 should be type of Array.");if(typeof v.itemType=="number"){const E=defaultConverter(v.itemType);if(!E)throw new Error(`Cannot get default converter for array item of ${g.name} ASN1 schema`);b=u.map(S=>E.toASN(S))}else b=u.map(E=>this.toAsnItem({type:v.itemType},"[]",g,E))}else for(const E in v.items){const S=v.items[E],A=u[E];if(A===void 0||S.defaultValue===A||typeof S.defaultValue=="object"&&typeof A=="object"&&isArrayEqual(this.serialize(S.defaultValue),this.serialize(A)))continue;const $=AsnSerializer.toAsnItem(S,E,g,A);if(typeof S.context=="number")if(S.implicit)if(!S.repeated&&(typeof S.type=="number"||isConvertible(S.type))){const R={};R.valueHex=$ instanceof Null?$.valueBeforeDecodeView:$.valueBlock.toBER(),b.push(new Primitive({optional:S.optional,idBlock:{tagClass:3,tagNumber:S.context},...R}))}else b.push(new Constructed({optional:S.optional,idBlock:{tagClass:3,tagNumber:S.context},value:$.valueBlock.value}));else b.push(new Constructed({optional:S.optional,idBlock:{tagClass:3,tagNumber:S.context},value:[$]}));else S.repeated?b=b.concat($):b.push($)}let w;switch(v.type){case AsnTypeTypes.Sequence:w=new Sequence({value:b});break;case AsnTypeTypes.Set:w=new Set$1({value:b});break;case AsnTypeTypes.Choice:if(!b[0])throw new Error(`Schema '${g.name}' has wrong data. Choice cannot be empty.`);w=b[0];break}return w}static toAsnItem(u,g,v,b){let w;if(typeof u.type=="number"){const E=u.converter;if(!E)throw new Error(`Property '${g}' doesn't have converter for type ${AsnPropTypes[u.type]} in schema '${v.name}'`);if(u.repeated){if(!Array.isArray(b))throw new TypeError("Parameter 'objProp' should be type of Array.");const S=Array.from(b,$=>E.toASN($)),A=u.repeated==="sequence"?Sequence:Set$1;w=new A({value:S})}else w=E.toASN(b)}else if(u.repeated){if(!Array.isArray(b))throw new TypeError("Parameter 'objProp' should be type of Array.");const E=Array.from(b,A=>this.toASN(A)),S=u.repeated==="sequence"?Sequence:Set$1;w=new S({value:E})}else w=this.toASN(b);return w}}class AsnArray extends Array{constructor(u=[]){if(typeof u=="number")super(u);else{super();for(const g of u)this.push(g)}}}class AsnConvert{static serialize(u){return AsnSerializer.serialize(u)}static parse(u,g){return AsnParser.parse(u,g)}static toString(u){const g=BufferSourceConverter.isBufferSource(u)?BufferSourceConverter.toArrayBuffer(u):AsnConvert.serialize(u),v=fromBER(g);if(v.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${v.result.error}`);return v.result.toString()}}function __decorate(y,u,g,v){var b=arguments.length,w=b<3?u:v===null?v=Object.getOwnPropertyDescriptor(u,g):v,E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(y,u,g,v);else for(var S=y.length-1;S>=0;S--)(E=y[S])&&(w=(b<3?E(w):b>3?E(u,g,w):E(u,g))||w);return b>3&&w&&Object.defineProperty(u,g,w),w}function __classPrivateFieldGet(y,u,g,v){if(g==="a"&&!v)throw new TypeError("Private accessor was defined without a getter");if(typeof u=="function"?y!==u||!v:!u.has(y))throw new TypeError("Cannot read private member from an object whose class did not declare it");return g==="m"?v:g==="a"?v.call(y):v?v.value:u.get(y)}function __classPrivateFieldSet(y,u,g,v,b){if(v==="m")throw new TypeError("Private method is not writable");if(v==="a"&&!b)throw new TypeError("Private accessor was defined without a setter");if(typeof u=="function"?y!==u||!b:!u.has(y))throw new TypeError("Cannot write private member to an object whose class did not declare it");return v==="a"?b.call(y,g):b?b.value=g:u.set(y,g),g}typeof SuppressedError=="function"&&SuppressedError;class IpConverter{static isIPv4(u){return/^(\d{1,3}\.){3}\d{1,3}$/.test(u)}static parseIPv4(u){const g=u.split(".");if(g.length!==4)throw new Error("Invalid IPv4 address");return g.map(v=>{const b=parseInt(v,10);if(isNaN(b)||b<0||b>255)throw new Error("Invalid IPv4 address part");return b})}static parseIPv6(u){const v=this.expandIPv6(u).split(":");if(v.length!==8)throw new Error("Invalid IPv6 address");return v.reduce((b,w)=>{const E=parseInt(w,16);if(isNaN(E)||E<0||E>65535)throw new Error("Invalid IPv6 address part");return b.push(E>>8&255),b.push(E&255),b},[])}static expandIPv6(u){if(!u.includes("::"))return u;const g=u.split("::");if(g.length>2)throw new Error("Invalid IPv6 address");const v=g[0]?g[0].split(":"):[],b=g[1]?g[1].split(":"):[],w=8-(v.length+b.length);if(w<0)throw new Error("Invalid IPv6 address");return[...v,...Array(w).fill("0"),...b].join(":")}static formatIPv6(u){const g=[];for(let v=0;v<16;v+=2)g.push((u[v]<<8|u[v+1]).toString(16));return this.compressIPv6(g.join(":"))}static compressIPv6(u){const g=u.split(":");let v=-1,b=0,w=-1,E=0;for(let S=0;S<g.length;S++)g[S]==="0"?(w===-1&&(w=S),E++):(E>b&&(v=w,b=E),w=-1,E=0);if(E>b&&(v=w,b=E),b>1){const S=g.slice(0,v).join(":"),A=g.slice(v+b).join(":");return`${S}::${A}`}return u}static parseCIDR(u){const[g,v]=u.split("/"),b=parseInt(v,10);if(this.isIPv4(g)){if(b<0||b>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(g),b]}else{if(b<0||b>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(g),b]}}static decodeIP(u){if(u.length===64&&parseInt(u,16)===0)return"::/0";if(u.length!==16)return u;const g=parseInt(u.slice(8),16).toString(2).split("").reduce((b,w)=>b+ +w,0);let v=u.slice(0,8).replace(/(.{2})/g,b=>`${parseInt(b,16)}.`);return v=v.slice(0,-1),`${v}/${g}`}static toString(u){const g=new Uint8Array(u);if(g.length===4)return Array.from(g).join(".");if(g.length===16)return this.formatIPv6(g);if(g.length===8||g.length===32){const v=g.length/2,b=g.slice(0,v),w=g.slice(v);if(g.every(A=>A===0))return g.length===8?"0.0.0.0/0":"::/0";const S=w.reduce((A,$)=>A+($.toString(2).match(/1/g)||[]).length,0);return g.length===8?`${Array.from(b).join(".")}/${S}`:`${this.formatIPv6(b)}/${S}`}return this.decodeIP(Convert.ToHex(u))}static fromString(u){if(u.includes("/")){const[v,b]=this.parseCIDR(u),w=new Uint8Array(v.length);let E=b;for(let A=0;A<w.length;A++)E>=8?(w[A]=255,E-=8):E>0&&(w[A]=255<<8-E,E=0);const S=new Uint8Array(v.length*2);return S.set(v,0),S.set(w,v.length),S.buffer}const g=this.isIPv4(u)?this.parseIPv4(u):this.parseIPv6(u);return new Uint8Array(g).buffer}}var RelativeDistinguishedName_1,RDNSequence_1,Name_1;let DirectoryString=class{constructor(u={}){Object.assign(this,u)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};__decorate([AsnProp({type:AsnPropTypes.TeletexString})],DirectoryString.prototype,"teletexString",void 0);__decorate([AsnProp({type:AsnPropTypes.PrintableString})],DirectoryString.prototype,"printableString",void 0);__decorate([AsnProp({type:AsnPropTypes.UniversalString})],DirectoryString.prototype,"universalString",void 0);__decorate([AsnProp({type:AsnPropTypes.Utf8String})],DirectoryString.prototype,"utf8String",void 0);__decorate([AsnProp({type:AsnPropTypes.BmpString})],DirectoryString.prototype,"bmpString",void 0);DirectoryString=__decorate([AsnType({type:AsnTypeTypes.Choice})],DirectoryString);let AttributeValue=class extends DirectoryString{constructor(u={}){super(u),Object.assign(this,u)}toString(){return this.ia5String||(this.anyValue?Convert.ToHex(this.anyValue):super.toString())}};__decorate([AsnProp({type:AsnPropTypes.IA5String})],AttributeValue.prototype,"ia5String",void 0);__decorate([AsnProp({type:AsnPropTypes.Any})],AttributeValue.prototype,"anyValue",void 0);AttributeValue=__decorate([AsnType({type:AsnTypeTypes.Choice})],AttributeValue);class AttributeTypeAndValue{constructor(u={}){this.type="",this.value=new AttributeValue,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],AttributeTypeAndValue.prototype,"type",void 0);__decorate([AsnProp({type:AttributeValue})],AttributeTypeAndValue.prototype,"value",void 0);let RelativeDistinguishedName=RelativeDistinguishedName_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,RelativeDistinguishedName_1.prototype)}};RelativeDistinguishedName=RelativeDistinguishedName_1=__decorate([AsnType({type:AsnTypeTypes.Set,itemType:AttributeTypeAndValue})],RelativeDistinguishedName);let RDNSequence=RDNSequence_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,RDNSequence_1.prototype)}};RDNSequence=RDNSequence_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:RelativeDistinguishedName})],RDNSequence);let Name$1=Name_1=class extends RDNSequence{constructor(u){super(u),Object.setPrototypeOf(this,Name_1.prototype)}};Name$1=Name_1=__decorate([AsnType({type:AsnTypeTypes.Sequence})],Name$1);const AsnIpConverter={fromASN:y=>IpConverter.toString(AsnOctetStringConverter.fromASN(y)),toASN:y=>AsnOctetStringConverter.toASN(IpConverter.fromString(y))};class OtherName{constructor(u={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],OtherName.prototype,"typeId",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,context:0})],OtherName.prototype,"value",void 0);class EDIPartyName{constructor(u={}){this.partyName=new DirectoryString,Object.assign(this,u)}}__decorate([AsnProp({type:DirectoryString,optional:!0,context:0,implicit:!0})],EDIPartyName.prototype,"nameAssigner",void 0);__decorate([AsnProp({type:DirectoryString,context:1,implicit:!0})],EDIPartyName.prototype,"partyName",void 0);let GeneralName$1=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:OtherName,context:0,implicit:!0})],GeneralName$1.prototype,"otherName",void 0);__decorate([AsnProp({type:AsnPropTypes.IA5String,context:1,implicit:!0})],GeneralName$1.prototype,"rfc822Name",void 0);__decorate([AsnProp({type:AsnPropTypes.IA5String,context:2,implicit:!0})],GeneralName$1.prototype,"dNSName",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,context:3,implicit:!0})],GeneralName$1.prototype,"x400Address",void 0);__decorate([AsnProp({type:Name$1,context:4,implicit:!1})],GeneralName$1.prototype,"directoryName",void 0);__decorate([AsnProp({type:EDIPartyName,context:5})],GeneralName$1.prototype,"ediPartyName",void 0);__decorate([AsnProp({type:AsnPropTypes.IA5String,context:6,implicit:!0})],GeneralName$1.prototype,"uniformResourceIdentifier",void 0);__decorate([AsnProp({type:AsnPropTypes.OctetString,context:7,implicit:!0,converter:AsnIpConverter})],GeneralName$1.prototype,"iPAddress",void 0);__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier,context:8,implicit:!0})],GeneralName$1.prototype,"registeredID",void 0);GeneralName$1=__decorate([AsnType({type:AsnTypeTypes.Choice})],GeneralName$1);const id_pkix="1.3.6.1.5.5.7",id_pe=`${id_pkix}.1`,id_kp=`${id_pkix}.3`,id_ad=`${id_pkix}.48`,id_ad_ocsp=`${id_ad}.1`,id_ad_caIssuers=`${id_ad}.2`,id_ad_timeStamping=`${id_ad}.3`,id_ad_caRepository=`${id_ad}.5`,id_ce="2.5.29";var AuthorityInfoAccessSyntax_1;const id_pe_authorityInfoAccess=`${id_pe}.1`;class AccessDescription{constructor(u={}){this.accessMethod="",this.accessLocation=new GeneralName$1,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],AccessDescription.prototype,"accessMethod",void 0);__decorate([AsnProp({type:GeneralName$1})],AccessDescription.prototype,"accessLocation",void 0);let AuthorityInfoAccessSyntax=AuthorityInfoAccessSyntax_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,AuthorityInfoAccessSyntax_1.prototype)}};AuthorityInfoAccessSyntax=AuthorityInfoAccessSyntax_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:AccessDescription})],AuthorityInfoAccessSyntax);const id_ce_authorityKeyIdentifier=`${id_ce}.35`;class KeyIdentifier extends OctetString{}class AuthorityKeyIdentifier{constructor(u={}){u&&Object.assign(this,u)}}__decorate([AsnProp({type:KeyIdentifier,context:0,optional:!0,implicit:!0})],AuthorityKeyIdentifier.prototype,"keyIdentifier",void 0);__decorate([AsnProp({type:GeneralName$1,context:1,optional:!0,implicit:!0,repeated:"sequence"})],AuthorityKeyIdentifier.prototype,"authorityCertIssuer",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,context:2,optional:!0,implicit:!0,converter:AsnIntegerArrayBufferConverter})],AuthorityKeyIdentifier.prototype,"authorityCertSerialNumber",void 0);const id_ce_basicConstraints=`${id_ce}.19`;class BasicConstraints{constructor(u={}){this.cA=!1,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Boolean,defaultValue:!1})],BasicConstraints.prototype,"cA",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,optional:!0})],BasicConstraints.prototype,"pathLenConstraint",void 0);var GeneralNames_1;let GeneralNames$1=GeneralNames_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,GeneralNames_1.prototype)}};GeneralNames$1=GeneralNames_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:GeneralName$1})],GeneralNames$1);var CertificateIssuer_1;let CertificateIssuer=CertificateIssuer_1=class extends GeneralNames$1{constructor(u){super(u),Object.setPrototypeOf(this,CertificateIssuer_1.prototype)}};CertificateIssuer=CertificateIssuer_1=__decorate([AsnType({type:AsnTypeTypes.Sequence})],CertificateIssuer);var CertificatePolicies_1;const id_ce_certificatePolicies=`${id_ce}.32`;let DisplayText=class{constructor(u={}){Object.assign(this,u)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};__decorate([AsnProp({type:AsnPropTypes.IA5String})],DisplayText.prototype,"ia5String",void 0);__decorate([AsnProp({type:AsnPropTypes.VisibleString})],DisplayText.prototype,"visibleString",void 0);__decorate([AsnProp({type:AsnPropTypes.BmpString})],DisplayText.prototype,"bmpString",void 0);__decorate([AsnProp({type:AsnPropTypes.Utf8String})],DisplayText.prototype,"utf8String",void 0);DisplayText=__decorate([AsnType({type:AsnTypeTypes.Choice})],DisplayText);class NoticeReference{constructor(u={}){this.organization=new DisplayText,this.noticeNumbers=[],Object.assign(this,u)}}__decorate([AsnProp({type:DisplayText})],NoticeReference.prototype,"organization",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,repeated:"sequence"})],NoticeReference.prototype,"noticeNumbers",void 0);class UserNotice{constructor(u={}){Object.assign(this,u)}}__decorate([AsnProp({type:NoticeReference,optional:!0})],UserNotice.prototype,"noticeRef",void 0);__decorate([AsnProp({type:DisplayText,optional:!0})],UserNotice.prototype,"explicitText",void 0);let Qualifier=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:AsnPropTypes.IA5String})],Qualifier.prototype,"cPSuri",void 0);__decorate([AsnProp({type:UserNotice})],Qualifier.prototype,"userNotice",void 0);Qualifier=__decorate([AsnType({type:AsnTypeTypes.Choice})],Qualifier);class PolicyQualifierInfo{constructor(u={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],PolicyQualifierInfo.prototype,"policyQualifierId",void 0);__decorate([AsnProp({type:AsnPropTypes.Any})],PolicyQualifierInfo.prototype,"qualifier",void 0);class PolicyInformation{constructor(u={}){this.policyIdentifier="",Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],PolicyInformation.prototype,"policyIdentifier",void 0);__decorate([AsnProp({type:PolicyQualifierInfo,repeated:"sequence",optional:!0})],PolicyInformation.prototype,"policyQualifiers",void 0);let CertificatePolicies=CertificatePolicies_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,CertificatePolicies_1.prototype)}};CertificatePolicies=CertificatePolicies_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:PolicyInformation})],CertificatePolicies);let CRLNumber=class{constructor(u=0){this.value=u}};__decorate([AsnProp({type:AsnPropTypes.Integer})],CRLNumber.prototype,"value",void 0);CRLNumber=__decorate([AsnType({type:AsnTypeTypes.Choice})],CRLNumber);let BaseCRLNumber=class extends CRLNumber{};BaseCRLNumber=__decorate([AsnType({type:AsnTypeTypes.Choice})],BaseCRLNumber);var CRLDistributionPoints_1;const id_ce_cRLDistributionPoints=`${id_ce}.31`;var ReasonFlags;(function(y){y[y.unused=1]="unused",y[y.keyCompromise=2]="keyCompromise",y[y.cACompromise=4]="cACompromise",y[y.affiliationChanged=8]="affiliationChanged",y[y.superseded=16]="superseded",y[y.cessationOfOperation=32]="cessationOfOperation",y[y.certificateHold=64]="certificateHold",y[y.privilegeWithdrawn=128]="privilegeWithdrawn",y[y.aACompromise=256]="aACompromise"})(ReasonFlags||(ReasonFlags={}));class Reason extends BitString{toJSON(){const u=[],g=this.toNumber();return g&ReasonFlags.aACompromise&&u.push("aACompromise"),g&ReasonFlags.affiliationChanged&&u.push("affiliationChanged"),g&ReasonFlags.cACompromise&&u.push("cACompromise"),g&ReasonFlags.certificateHold&&u.push("certificateHold"),g&ReasonFlags.cessationOfOperation&&u.push("cessationOfOperation"),g&ReasonFlags.keyCompromise&&u.push("keyCompromise"),g&ReasonFlags.privilegeWithdrawn&&u.push("privilegeWithdrawn"),g&ReasonFlags.superseded&&u.push("superseded"),g&ReasonFlags.unused&&u.push("unused"),u}toString(){return`[${this.toJSON().join(", ")}]`}}let DistributionPointName=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:GeneralName$1,context:0,repeated:"sequence",implicit:!0})],DistributionPointName.prototype,"fullName",void 0);__decorate([AsnProp({type:RelativeDistinguishedName,context:1,implicit:!0})],DistributionPointName.prototype,"nameRelativeToCRLIssuer",void 0);DistributionPointName=__decorate([AsnType({type:AsnTypeTypes.Choice})],DistributionPointName);class DistributionPoint{constructor(u={}){Object.assign(this,u)}}__decorate([AsnProp({type:DistributionPointName,context:0,optional:!0})],DistributionPoint.prototype,"distributionPoint",void 0);__decorate([AsnProp({type:Reason,context:1,optional:!0,implicit:!0})],DistributionPoint.prototype,"reasons",void 0);__decorate([AsnProp({type:GeneralName$1,context:2,optional:!0,repeated:"sequence",implicit:!0})],DistributionPoint.prototype,"cRLIssuer",void 0);let CRLDistributionPoints=CRLDistributionPoints_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,CRLDistributionPoints_1.prototype)}};CRLDistributionPoints=CRLDistributionPoints_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:DistributionPoint})],CRLDistributionPoints);var FreshestCRL_1;let FreshestCRL=FreshestCRL_1=class extends CRLDistributionPoints{constructor(u){super(u),Object.setPrototypeOf(this,FreshestCRL_1.prototype)}};FreshestCRL=FreshestCRL_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:DistributionPoint})],FreshestCRL);class IssuingDistributionPoint{constructor(u={}){this.onlyContainsUserCerts=IssuingDistributionPoint.ONLY,this.onlyContainsCACerts=IssuingDistributionPoint.ONLY,this.indirectCRL=IssuingDistributionPoint.ONLY,this.onlyContainsAttributeCerts=IssuingDistributionPoint.ONLY,Object.assign(this,u)}}IssuingDistributionPoint.ONLY=!1;__decorate([AsnProp({type:DistributionPointName,context:0,optional:!0})],IssuingDistributionPoint.prototype,"distributionPoint",void 0);__decorate([AsnProp({type:AsnPropTypes.Boolean,context:1,defaultValue:IssuingDistributionPoint.ONLY,implicit:!0})],IssuingDistributionPoint.prototype,"onlyContainsUserCerts",void 0);__decorate([AsnProp({type:AsnPropTypes.Boolean,context:2,defaultValue:IssuingDistributionPoint.ONLY,implicit:!0})],IssuingDistributionPoint.prototype,"onlyContainsCACerts",void 0);__decorate([AsnProp({type:Reason,context:3,optional:!0,implicit:!0})],IssuingDistributionPoint.prototype,"onlySomeReasons",void 0);__decorate([AsnProp({type:AsnPropTypes.Boolean,context:4,defaultValue:IssuingDistributionPoint.ONLY,implicit:!0})],IssuingDistributionPoint.prototype,"indirectCRL",void 0);__decorate([AsnProp({type:AsnPropTypes.Boolean,context:5,defaultValue:IssuingDistributionPoint.ONLY,implicit:!0})],IssuingDistributionPoint.prototype,"onlyContainsAttributeCerts",void 0);var CRLReasons;(function(y){y[y.unspecified=0]="unspecified",y[y.keyCompromise=1]="keyCompromise",y[y.cACompromise=2]="cACompromise",y[y.affiliationChanged=3]="affiliationChanged",y[y.superseded=4]="superseded",y[y.cessationOfOperation=5]="cessationOfOperation",y[y.certificateHold=6]="certificateHold",y[y.removeFromCRL=8]="removeFromCRL",y[y.privilegeWithdrawn=9]="privilegeWithdrawn",y[y.aACompromise=10]="aACompromise"})(CRLReasons||(CRLReasons={}));let CRLReason=class{constructor(u=CRLReasons.unspecified){this.reason=CRLReasons.unspecified,this.reason=u}toJSON(){return CRLReasons[this.reason]}toString(){return this.toJSON()}};__decorate([AsnProp({type:AsnPropTypes.Enumerated})],CRLReason.prototype,"reason",void 0);CRLReason=__decorate([AsnType({type:AsnTypeTypes.Choice})],CRLReason);var ExtendedKeyUsage_1;const id_ce_extKeyUsage=`${id_ce}.37`;let ExtendedKeyUsage$1=ExtendedKeyUsage_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,ExtendedKeyUsage_1.prototype)}};ExtendedKeyUsage$1=ExtendedKeyUsage_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:AsnPropTypes.ObjectIdentifier})],ExtendedKeyUsage$1);const id_kp_serverAuth=`${id_kp}.1`,id_kp_clientAuth=`${id_kp}.2`,id_kp_codeSigning=`${id_kp}.3`,id_kp_emailProtection=`${id_kp}.4`,id_kp_timeStamping=`${id_kp}.8`,id_kp_OCSPSigning=`${id_kp}.9`;let InhibitAnyPolicy=class{constructor(u=new ArrayBuffer(0)){this.value=u}};__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],InhibitAnyPolicy.prototype,"value",void 0);InhibitAnyPolicy=__decorate([AsnType({type:AsnTypeTypes.Choice})],InhibitAnyPolicy);let InvalidityDate=class{constructor(u){this.value=new Date,u&&(this.value=u)}};__decorate([AsnProp({type:AsnPropTypes.GeneralizedTime})],InvalidityDate.prototype,"value",void 0);InvalidityDate=__decorate([AsnType({type:AsnTypeTypes.Choice})],InvalidityDate);var IssueAlternativeName_1;const id_ce_issuerAltName=`${id_ce}.18`;let IssueAlternativeName=IssueAlternativeName_1=class extends GeneralNames$1{constructor(u){super(u),Object.setPrototypeOf(this,IssueAlternativeName_1.prototype)}};IssueAlternativeName=IssueAlternativeName_1=__decorate([AsnType({type:AsnTypeTypes.Sequence})],IssueAlternativeName);const id_ce_keyUsage=`${id_ce}.15`;var KeyUsageFlags$1;(function(y){y[y.digitalSignature=1]="digitalSignature",y[y.nonRepudiation=2]="nonRepudiation",y[y.keyEncipherment=4]="keyEncipherment",y[y.dataEncipherment=8]="dataEncipherment",y[y.keyAgreement=16]="keyAgreement",y[y.keyCertSign=32]="keyCertSign",y[y.cRLSign=64]="cRLSign",y[y.encipherOnly=128]="encipherOnly",y[y.decipherOnly=256]="decipherOnly"})(KeyUsageFlags$1||(KeyUsageFlags$1={}));class KeyUsage extends BitString{toJSON(){const u=this.toNumber(),g=[];return u&KeyUsageFlags$1.cRLSign&&g.push("crlSign"),u&KeyUsageFlags$1.dataEncipherment&&g.push("dataEncipherment"),u&KeyUsageFlags$1.decipherOnly&&g.push("decipherOnly"),u&KeyUsageFlags$1.digitalSignature&&g.push("digitalSignature"),u&KeyUsageFlags$1.encipherOnly&&g.push("encipherOnly"),u&KeyUsageFlags$1.keyAgreement&&g.push("keyAgreement"),u&KeyUsageFlags$1.keyCertSign&&g.push("keyCertSign"),u&KeyUsageFlags$1.keyEncipherment&&g.push("keyEncipherment"),u&KeyUsageFlags$1.nonRepudiation&&g.push("nonRepudiation"),g}toString(){return`[${this.toJSON().join(", ")}]`}}var GeneralSubtrees_1;class GeneralSubtree{constructor(u={}){this.base=new GeneralName$1,this.minimum=0,Object.assign(this,u)}}__decorate([AsnProp({type:GeneralName$1})],GeneralSubtree.prototype,"base",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,context:0,defaultValue:0,implicit:!0})],GeneralSubtree.prototype,"minimum",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,context:1,optional:!0,implicit:!0})],GeneralSubtree.prototype,"maximum",void 0);let GeneralSubtrees=GeneralSubtrees_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,GeneralSubtrees_1.prototype)}};GeneralSubtrees=GeneralSubtrees_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:GeneralSubtree})],GeneralSubtrees);class NameConstraints{constructor(u={}){Object.assign(this,u)}}__decorate([AsnProp({type:GeneralSubtrees,context:0,optional:!0,implicit:!0})],NameConstraints.prototype,"permittedSubtrees",void 0);__decorate([AsnProp({type:GeneralSubtrees,context:1,optional:!0,implicit:!0})],NameConstraints.prototype,"excludedSubtrees",void 0);class PolicyConstraints{constructor(u={}){Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer,context:0,implicit:!0,optional:!0,converter:AsnIntegerArrayBufferConverter})],PolicyConstraints.prototype,"requireExplicitPolicy",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,context:1,implicit:!0,optional:!0,converter:AsnIntegerArrayBufferConverter})],PolicyConstraints.prototype,"inhibitPolicyMapping",void 0);var PolicyMappings_1;class PolicyMapping{constructor(u={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],PolicyMapping.prototype,"issuerDomainPolicy",void 0);__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],PolicyMapping.prototype,"subjectDomainPolicy",void 0);let PolicyMappings=PolicyMappings_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,PolicyMappings_1.prototype)}};PolicyMappings=PolicyMappings_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:PolicyMapping})],PolicyMappings);var SubjectAlternativeName_1;const id_ce_subjectAltName=`${id_ce}.17`;let SubjectAlternativeName=SubjectAlternativeName_1=class extends GeneralNames$1{constructor(u){super(u),Object.setPrototypeOf(this,SubjectAlternativeName_1.prototype)}};SubjectAlternativeName=SubjectAlternativeName_1=__decorate([AsnType({type:AsnTypeTypes.Sequence})],SubjectAlternativeName);let Attribute$2=class{constructor(u={}){this.type="",this.values=[],Object.assign(this,u)}};__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],Attribute$2.prototype,"type",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,repeated:"set"})],Attribute$2.prototype,"values",void 0);var SubjectDirectoryAttributes_1;let SubjectDirectoryAttributes=SubjectDirectoryAttributes_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,SubjectDirectoryAttributes_1.prototype)}};SubjectDirectoryAttributes=SubjectDirectoryAttributes_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:Attribute$2})],SubjectDirectoryAttributes);const id_ce_subjectKeyIdentifier=`${id_ce}.14`;class SubjectKeyIdentifier extends KeyIdentifier{}class PrivateKeyUsagePeriod{constructor(u={}){Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.GeneralizedTime,context:0,implicit:!0,optional:!0})],PrivateKeyUsagePeriod.prototype,"notBefore",void 0);__decorate([AsnProp({type:AsnPropTypes.GeneralizedTime,context:1,implicit:!0,optional:!0})],PrivateKeyUsagePeriod.prototype,"notAfter",void 0);var EntrustInfoFlags;(function(y){y[y.keyUpdateAllowed=1]="keyUpdateAllowed",y[y.newExtensions=2]="newExtensions",y[y.pKIXCertificate=4]="pKIXCertificate"})(EntrustInfoFlags||(EntrustInfoFlags={}));class EntrustInfo extends BitString{toJSON(){const u=[],g=this.toNumber();return g&EntrustInfoFlags.pKIXCertificate&&u.push("pKIXCertificate"),g&EntrustInfoFlags.newExtensions&&u.push("newExtensions"),g&EntrustInfoFlags.keyUpdateAllowed&&u.push("keyUpdateAllowed"),u}toString(){return`[${this.toJSON().join(", ")}]`}}class EntrustVersionInfo{constructor(u={}){this.entrustVers="",this.entrustInfoFlags=new EntrustInfo,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.GeneralString})],EntrustVersionInfo.prototype,"entrustVers",void 0);__decorate([AsnProp({type:EntrustInfo})],EntrustVersionInfo.prototype,"entrustInfoFlags",void 0);var SubjectInfoAccessSyntax_1;let SubjectInfoAccessSyntax=SubjectInfoAccessSyntax_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,SubjectInfoAccessSyntax_1.prototype)}};SubjectInfoAccessSyntax=SubjectInfoAccessSyntax_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:AccessDescription})],SubjectInfoAccessSyntax);class AlgorithmIdentifier{constructor(u={}){this.algorithm="",Object.assign(this,u)}isEqual(u){return u instanceof AlgorithmIdentifier&&u.algorithm==this.algorithm&&(u.parameters&&this.parameters&&isEqual(u.parameters,this.parameters)||u.parameters===this.parameters)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],AlgorithmIdentifier.prototype,"algorithm",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,optional:!0})],AlgorithmIdentifier.prototype,"parameters",void 0);class SubjectPublicKeyInfo{constructor(u={}){this.algorithm=new AlgorithmIdentifier,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AlgorithmIdentifier})],SubjectPublicKeyInfo.prototype,"algorithm",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString})],SubjectPublicKeyInfo.prototype,"subjectPublicKey",void 0);let Time=class{constructor(u){if(u)if(typeof u=="string"||typeof u=="number"||u instanceof Date){const g=new Date(u);g.getUTCFullYear()>2049?this.generalTime=g:this.utcTime=g}else Object.assign(this,u)}getTime(){const u=this.utcTime||this.generalTime;if(!u)throw new Error("Cannot get time from CHOICE object");return u}};__decorate([AsnProp({type:AsnPropTypes.UTCTime})],Time.prototype,"utcTime",void 0);__decorate([AsnProp({type:AsnPropTypes.GeneralizedTime})],Time.prototype,"generalTime",void 0);Time=__decorate([AsnType({type:AsnTypeTypes.Choice})],Time);class Validity{constructor(u){this.notBefore=new Time(new Date),this.notAfter=new Time(new Date),u&&(this.notBefore=new Time(u.notBefore),this.notAfter=new Time(u.notAfter))}}__decorate([AsnProp({type:Time})],Validity.prototype,"notBefore",void 0);__decorate([AsnProp({type:Time})],Validity.prototype,"notAfter",void 0);var Extensions_1;let Extension$1=class uh{constructor(u={}){this.extnID="",this.critical=uh.CRITICAL,this.extnValue=new OctetString,Object.assign(this,u)}};Extension$1.CRITICAL=!1;__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],Extension$1.prototype,"extnID",void 0);__decorate([AsnProp({type:AsnPropTypes.Boolean,defaultValue:Extension$1.CRITICAL})],Extension$1.prototype,"critical",void 0);__decorate([AsnProp({type:OctetString})],Extension$1.prototype,"extnValue",void 0);let Extensions=Extensions_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,Extensions_1.prototype)}};Extensions=Extensions_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:Extension$1})],Extensions);var Version$1;(function(y){y[y.v1=0]="v1",y[y.v2=1]="v2",y[y.v3=2]="v3"})(Version$1||(Version$1={}));class TBSCertificate{constructor(u={}){this.version=Version$1.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new AlgorithmIdentifier,this.issuer=new Name$1,this.validity=new Validity,this.subject=new Name$1,this.subjectPublicKeyInfo=new SubjectPublicKeyInfo,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer,context:0,defaultValue:Version$1.v1})],TBSCertificate.prototype,"version",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],TBSCertificate.prototype,"serialNumber",void 0);__decorate([AsnProp({type:AlgorithmIdentifier})],TBSCertificate.prototype,"signature",void 0);__decorate([AsnProp({type:Name$1})],TBSCertificate.prototype,"issuer",void 0);__decorate([AsnProp({type:Validity})],TBSCertificate.prototype,"validity",void 0);__decorate([AsnProp({type:Name$1})],TBSCertificate.prototype,"subject",void 0);__decorate([AsnProp({type:SubjectPublicKeyInfo})],TBSCertificate.prototype,"subjectPublicKeyInfo",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString,context:1,implicit:!0,optional:!0})],TBSCertificate.prototype,"issuerUniqueID",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString,context:2,implicit:!0,optional:!0})],TBSCertificate.prototype,"subjectUniqueID",void 0);__decorate([AsnProp({type:Extensions,context:3,optional:!0})],TBSCertificate.prototype,"extensions",void 0);class Certificate{constructor(u={}){this.tbsCertificate=new TBSCertificate,this.signatureAlgorithm=new AlgorithmIdentifier,this.signatureValue=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:TBSCertificate,raw:!0})],Certificate.prototype,"tbsCertificate",void 0);__decorate([AsnProp({type:AlgorithmIdentifier})],Certificate.prototype,"signatureAlgorithm",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString})],Certificate.prototype,"signatureValue",void 0);class RevokedCertificate{constructor(u={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new Time,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],RevokedCertificate.prototype,"userCertificate",void 0);__decorate([AsnProp({type:Time})],RevokedCertificate.prototype,"revocationDate",void 0);__decorate([AsnProp({type:Extension$1,optional:!0,repeated:"sequence"})],RevokedCertificate.prototype,"crlEntryExtensions",void 0);class TBSCertList{constructor(u={}){this.signature=new AlgorithmIdentifier,this.issuer=new Name$1,this.thisUpdate=new Time,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer,optional:!0})],TBSCertList.prototype,"version",void 0);__decorate([AsnProp({type:AlgorithmIdentifier})],TBSCertList.prototype,"signature",void 0);__decorate([AsnProp({type:Name$1})],TBSCertList.prototype,"issuer",void 0);__decorate([AsnProp({type:Time})],TBSCertList.prototype,"thisUpdate",void 0);__decorate([AsnProp({type:Time,optional:!0})],TBSCertList.prototype,"nextUpdate",void 0);__decorate([AsnProp({type:RevokedCertificate,repeated:"sequence",optional:!0})],TBSCertList.prototype,"revokedCertificates",void 0);__decorate([AsnProp({type:Extension$1,optional:!0,context:0,repeated:"sequence"})],TBSCertList.prototype,"crlExtensions",void 0);class CertificateList{constructor(u={}){this.tbsCertList=new TBSCertList,this.signatureAlgorithm=new AlgorithmIdentifier,this.signature=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:TBSCertList,raw:!0})],CertificateList.prototype,"tbsCertList",void 0);__decorate([AsnProp({type:AlgorithmIdentifier})],CertificateList.prototype,"signatureAlgorithm",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString})],CertificateList.prototype,"signature",void 0);class IssuerAndSerialNumber{constructor(u={}){this.issuer=new Name$1,this.serialNumber=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:Name$1})],IssuerAndSerialNumber.prototype,"issuer",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],IssuerAndSerialNumber.prototype,"serialNumber",void 0);let SignerIdentifier=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:SubjectKeyIdentifier,context:0,implicit:!0})],SignerIdentifier.prototype,"subjectKeyIdentifier",void 0);__decorate([AsnProp({type:IssuerAndSerialNumber})],SignerIdentifier.prototype,"issuerAndSerialNumber",void 0);SignerIdentifier=__decorate([AsnType({type:AsnTypeTypes.Choice})],SignerIdentifier);var CMSVersion;(function(y){y[y.v0=0]="v0",y[y.v1=1]="v1",y[y.v2=2]="v2",y[y.v3=3]="v3",y[y.v4=4]="v4",y[y.v5=5]="v5"})(CMSVersion||(CMSVersion={}));let DigestAlgorithmIdentifier=class extends AlgorithmIdentifier{};DigestAlgorithmIdentifier=__decorate([AsnType({type:AsnTypeTypes.Sequence})],DigestAlgorithmIdentifier);let SignatureAlgorithmIdentifier=class extends AlgorithmIdentifier{};SignatureAlgorithmIdentifier=__decorate([AsnType({type:AsnTypeTypes.Sequence})],SignatureAlgorithmIdentifier);let KeyEncryptionAlgorithmIdentifier=class extends AlgorithmIdentifier{};KeyEncryptionAlgorithmIdentifier=__decorate([AsnType({type:AsnTypeTypes.Sequence})],KeyEncryptionAlgorithmIdentifier);let ContentEncryptionAlgorithmIdentifier=class extends AlgorithmIdentifier{};ContentEncryptionAlgorithmIdentifier=__decorate([AsnType({type:AsnTypeTypes.Sequence})],ContentEncryptionAlgorithmIdentifier);let MessageAuthenticationCodeAlgorithm=class extends AlgorithmIdentifier{};MessageAuthenticationCodeAlgorithm=__decorate([AsnType({type:AsnTypeTypes.Sequence})],MessageAuthenticationCodeAlgorithm);let KeyDerivationAlgorithmIdentifier=class extends AlgorithmIdentifier{};KeyDerivationAlgorithmIdentifier=__decorate([AsnType({type:AsnTypeTypes.Sequence})],KeyDerivationAlgorithmIdentifier);let Attribute$1=class{constructor(u={}){this.attrType="",this.attrValues=[],Object.assign(this,u)}};__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],Attribute$1.prototype,"attrType",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,repeated:"set"})],Attribute$1.prototype,"attrValues",void 0);var SignerInfos_1;class SignerInfo{constructor(u={}){this.version=CMSVersion.v0,this.sid=new SignerIdentifier,this.digestAlgorithm=new DigestAlgorithmIdentifier,this.signatureAlgorithm=new SignatureAlgorithmIdentifier,this.signature=new OctetString,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],SignerInfo.prototype,"version",void 0);__decorate([AsnProp({type:SignerIdentifier})],SignerInfo.prototype,"sid",void 0);__decorate([AsnProp({type:DigestAlgorithmIdentifier})],SignerInfo.prototype,"digestAlgorithm",void 0);__decorate([AsnProp({type:Attribute$1,repeated:"set",context:0,implicit:!0,optional:!0,raw:!0})],SignerInfo.prototype,"signedAttrs",void 0);__decorate([AsnProp({type:SignatureAlgorithmIdentifier})],SignerInfo.prototype,"signatureAlgorithm",void 0);__decorate([AsnProp({type:OctetString})],SignerInfo.prototype,"signature",void 0);__decorate([AsnProp({type:Attribute$1,repeated:"set",context:1,implicit:!0,optional:!0})],SignerInfo.prototype,"unsignedAttrs",void 0);let SignerInfos=SignerInfos_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,SignerInfos_1.prototype)}};SignerInfos=SignerInfos_1=__decorate([AsnType({type:AsnTypeTypes.Set,itemType:SignerInfo})],SignerInfos);let CounterSignature$1=class extends SignerInfo{};CounterSignature$1=__decorate([AsnType({type:AsnTypeTypes.Sequence})],CounterSignature$1);let SigningTime$1=class extends Time{};SigningTime$1=__decorate([AsnType({type:AsnTypeTypes.Choice})],SigningTime$1);class ACClearAttrs{constructor(u={}){this.acIssuer=new GeneralName$1,this.acSerial=0,this.attrs=[],Object.assign(this,u)}}__decorate([AsnProp({type:GeneralName$1})],ACClearAttrs.prototype,"acIssuer",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer})],ACClearAttrs.prototype,"acSerial",void 0);__decorate([AsnProp({type:Attribute$2,repeated:"sequence"})],ACClearAttrs.prototype,"attrs",void 0);var AttrSpec_1;let AttrSpec=AttrSpec_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,AttrSpec_1.prototype)}};AttrSpec=AttrSpec_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:AsnPropTypes.ObjectIdentifier})],AttrSpec);class AAControls{constructor(u={}){this.permitUnSpecified=!0,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer,optional:!0})],AAControls.prototype,"pathLenConstraint",void 0);__decorate([AsnProp({type:AttrSpec,implicit:!0,context:0,optional:!0})],AAControls.prototype,"permittedAttrs",void 0);__decorate([AsnProp({type:AttrSpec,implicit:!0,context:1,optional:!0})],AAControls.prototype,"excludedAttrs",void 0);__decorate([AsnProp({type:AsnPropTypes.Boolean,defaultValue:!0})],AAControls.prototype,"permitUnSpecified",void 0);class IssuerSerial{constructor(u={}){this.issuer=new GeneralNames$1,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:GeneralNames$1})],IssuerSerial.prototype,"issuer",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],IssuerSerial.prototype,"serial",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString,optional:!0})],IssuerSerial.prototype,"issuerUID",void 0);var DigestedObjectType;(function(y){y[y.publicKey=0]="publicKey",y[y.publicKeyCert=1]="publicKeyCert",y[y.otherObjectTypes=2]="otherObjectTypes"})(DigestedObjectType||(DigestedObjectType={}));class ObjectDigestInfo{constructor(u={}){this.digestedObjectType=DigestedObjectType.publicKey,this.digestAlgorithm=new AlgorithmIdentifier,this.objectDigest=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Enumerated})],ObjectDigestInfo.prototype,"digestedObjectType",void 0);__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier,optional:!0})],ObjectDigestInfo.prototype,"otherObjectTypeID",void 0);__decorate([AsnProp({type:AlgorithmIdentifier})],ObjectDigestInfo.prototype,"digestAlgorithm",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString})],ObjectDigestInfo.prototype,"objectDigest",void 0);class V2Form{constructor(u={}){Object.assign(this,u)}}__decorate([AsnProp({type:GeneralNames$1,optional:!0})],V2Form.prototype,"issuerName",void 0);__decorate([AsnProp({type:IssuerSerial,context:0,implicit:!0,optional:!0})],V2Form.prototype,"baseCertificateID",void 0);__decorate([AsnProp({type:ObjectDigestInfo,context:1,implicit:!0,optional:!0})],V2Form.prototype,"objectDigestInfo",void 0);let AttCertIssuer=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:GeneralName$1,repeated:"sequence"})],AttCertIssuer.prototype,"v1Form",void 0);__decorate([AsnProp({type:V2Form,context:0,implicit:!0})],AttCertIssuer.prototype,"v2Form",void 0);AttCertIssuer=__decorate([AsnType({type:AsnTypeTypes.Choice})],AttCertIssuer);class AttCertValidityPeriod{constructor(u={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.GeneralizedTime})],AttCertValidityPeriod.prototype,"notBeforeTime",void 0);__decorate([AsnProp({type:AsnPropTypes.GeneralizedTime})],AttCertValidityPeriod.prototype,"notAfterTime",void 0);class Holder{constructor(u={}){Object.assign(this,u)}}__decorate([AsnProp({type:IssuerSerial,implicit:!0,context:0,optional:!0})],Holder.prototype,"baseCertificateID",void 0);__decorate([AsnProp({type:GeneralNames$1,implicit:!0,context:1,optional:!0})],Holder.prototype,"entityName",void 0);__decorate([AsnProp({type:ObjectDigestInfo,implicit:!0,context:2,optional:!0})],Holder.prototype,"objectDigestInfo",void 0);var AttCertVersion;(function(y){y[y.v2=1]="v2"})(AttCertVersion||(AttCertVersion={}));class AttributeCertificateInfo{constructor(u={}){this.version=AttCertVersion.v2,this.holder=new Holder,this.issuer=new AttCertIssuer,this.signature=new AlgorithmIdentifier,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new AttCertValidityPeriod,this.attributes=[],Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],AttributeCertificateInfo.prototype,"version",void 0);__decorate([AsnProp({type:Holder})],AttributeCertificateInfo.prototype,"holder",void 0);__decorate([AsnProp({type:AttCertIssuer})],AttributeCertificateInfo.prototype,"issuer",void 0);__decorate([AsnProp({type:AlgorithmIdentifier})],AttributeCertificateInfo.prototype,"signature",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],AttributeCertificateInfo.prototype,"serialNumber",void 0);__decorate([AsnProp({type:AttCertValidityPeriod})],AttributeCertificateInfo.prototype,"attrCertValidityPeriod",void 0);__decorate([AsnProp({type:Attribute$2,repeated:"sequence"})],AttributeCertificateInfo.prototype,"attributes",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString,optional:!0})],AttributeCertificateInfo.prototype,"issuerUniqueID",void 0);__decorate([AsnProp({type:Extensions,optional:!0})],AttributeCertificateInfo.prototype,"extensions",void 0);class AttributeCertificate{constructor(u={}){this.acinfo=new AttributeCertificateInfo,this.signatureAlgorithm=new AlgorithmIdentifier,this.signatureValue=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AttributeCertificateInfo})],AttributeCertificate.prototype,"acinfo",void 0);__decorate([AsnProp({type:AlgorithmIdentifier})],AttributeCertificate.prototype,"signatureAlgorithm",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString})],AttributeCertificate.prototype,"signatureValue",void 0);var ClassListFlags;(function(y){y[y.unmarked=1]="unmarked",y[y.unclassified=2]="unclassified",y[y.restricted=4]="restricted",y[y.confidential=8]="confidential",y[y.secret=16]="secret",y[y.topSecret=32]="topSecret"})(ClassListFlags||(ClassListFlags={}));class ClassList extends BitString{}class SecurityCategory{constructor(u={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier,implicit:!0,context:0})],SecurityCategory.prototype,"type",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,implicit:!0,context:1})],SecurityCategory.prototype,"value",void 0);class Clearance{constructor(u={}){this.policyId="",this.classList=new ClassList(ClassListFlags.unclassified),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],Clearance.prototype,"policyId",void 0);__decorate([AsnProp({type:ClassList,defaultValue:new ClassList(ClassListFlags.unclassified)})],Clearance.prototype,"classList",void 0);__decorate([AsnProp({type:SecurityCategory,repeated:"set"})],Clearance.prototype,"securityCategories",void 0);class IetfAttrSyntaxValueChoices{constructor(u={}){Object.assign(this,u)}}__decorate([AsnProp({type:OctetString})],IetfAttrSyntaxValueChoices.prototype,"cotets",void 0);__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],IetfAttrSyntaxValueChoices.prototype,"oid",void 0);__decorate([AsnProp({type:AsnPropTypes.Utf8String})],IetfAttrSyntaxValueChoices.prototype,"string",void 0);class IetfAttrSyntax{constructor(u={}){this.values=[],Object.assign(this,u)}}__decorate([AsnProp({type:GeneralNames$1,implicit:!0,context:0,optional:!0})],IetfAttrSyntax.prototype,"policyAuthority",void 0);__decorate([AsnProp({type:IetfAttrSyntaxValueChoices,repeated:"sequence"})],IetfAttrSyntax.prototype,"values",void 0);var Targets_1;class TargetCert{constructor(u={}){this.targetCertificate=new IssuerSerial,Object.assign(this,u)}}__decorate([AsnProp({type:IssuerSerial})],TargetCert.prototype,"targetCertificate",void 0);__decorate([AsnProp({type:GeneralName$1,optional:!0})],TargetCert.prototype,"targetName",void 0);__decorate([AsnProp({type:ObjectDigestInfo,optional:!0})],TargetCert.prototype,"certDigestInfo",void 0);let Target=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:GeneralName$1,context:0,implicit:!0})],Target.prototype,"targetName",void 0);__decorate([AsnProp({type:GeneralName$1,context:1,implicit:!0})],Target.prototype,"targetGroup",void 0);__decorate([AsnProp({type:TargetCert,context:2,implicit:!0})],Target.prototype,"targetCert",void 0);Target=__decorate([AsnType({type:AsnTypeTypes.Choice})],Target);let Targets=Targets_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,Targets_1.prototype)}};Targets=Targets_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:Target})],Targets);var ProxyInfo_1;let ProxyInfo=ProxyInfo_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,ProxyInfo_1.prototype)}};ProxyInfo=ProxyInfo_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:Targets})],ProxyInfo);class RoleSyntax{constructor(u={}){Object.assign(this,u)}}__decorate([AsnProp({type:GeneralNames$1,implicit:!0,context:0,optional:!0})],RoleSyntax.prototype,"roleAuthority",void 0);__decorate([AsnProp({type:GeneralName$1,implicit:!0,context:1})],RoleSyntax.prototype,"roleName",void 0);class SvceAuthInfo{constructor(u={}){this.service=new GeneralName$1,this.ident=new GeneralName$1,Object.assign(this,u)}}__decorate([AsnProp({type:GeneralName$1})],SvceAuthInfo.prototype,"service",void 0);__decorate([AsnProp({type:GeneralName$1})],SvceAuthInfo.prototype,"ident",void 0);__decorate([AsnProp({type:OctetString,optional:!0})],SvceAuthInfo.prototype,"authInfo",void 0);var CertificateSet_1;class OtherCertificateFormat{constructor(u={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],OtherCertificateFormat.prototype,"otherCertFormat",void 0);__decorate([AsnProp({type:AsnPropTypes.Any})],OtherCertificateFormat.prototype,"otherCert",void 0);let CertificateChoices=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:Certificate})],CertificateChoices.prototype,"certificate",void 0);__decorate([AsnProp({type:AttributeCertificate,context:2,implicit:!0})],CertificateChoices.prototype,"v2AttrCert",void 0);__decorate([AsnProp({type:OtherCertificateFormat,context:3,implicit:!0})],CertificateChoices.prototype,"other",void 0);CertificateChoices=__decorate([AsnType({type:AsnTypeTypes.Choice})],CertificateChoices);let CertificateSet=CertificateSet_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,CertificateSet_1.prototype)}};CertificateSet=CertificateSet_1=__decorate([AsnType({type:AsnTypeTypes.Set,itemType:CertificateChoices})],CertificateSet);class ContentInfo{constructor(u={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],ContentInfo.prototype,"contentType",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,context:0})],ContentInfo.prototype,"content",void 0);let EncapsulatedContent=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:OctetString})],EncapsulatedContent.prototype,"single",void 0);__decorate([AsnProp({type:AsnPropTypes.Any})],EncapsulatedContent.prototype,"any",void 0);EncapsulatedContent=__decorate([AsnType({type:AsnTypeTypes.Choice})],EncapsulatedContent);class EncapsulatedContentInfo{constructor(u={}){this.eContentType="",Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],EncapsulatedContentInfo.prototype,"eContentType",void 0);__decorate([AsnProp({type:EncapsulatedContent,context:0,optional:!0})],EncapsulatedContentInfo.prototype,"eContent",void 0);let EncryptedContent=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:OctetString,context:0,implicit:!0,optional:!0})],EncryptedContent.prototype,"value",void 0);__decorate([AsnProp({type:OctetString,converter:AsnConstructedOctetStringConverter,context:0,implicit:!0,optional:!0,repeated:"sequence"})],EncryptedContent.prototype,"constructedValue",void 0);EncryptedContent=__decorate([AsnType({type:AsnTypeTypes.Choice})],EncryptedContent);class EncryptedContentInfo{constructor(u={}){this.contentType="",this.contentEncryptionAlgorithm=new ContentEncryptionAlgorithmIdentifier,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],EncryptedContentInfo.prototype,"contentType",void 0);__decorate([AsnProp({type:ContentEncryptionAlgorithmIdentifier})],EncryptedContentInfo.prototype,"contentEncryptionAlgorithm",void 0);__decorate([AsnProp({type:EncryptedContent,optional:!0})],EncryptedContentInfo.prototype,"encryptedContent",void 0);class OtherKeyAttribute{constructor(u={}){this.keyAttrId="",Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],OtherKeyAttribute.prototype,"keyAttrId",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,optional:!0})],OtherKeyAttribute.prototype,"keyAttr",void 0);var RecipientEncryptedKeys_1;class RecipientKeyIdentifier{constructor(u={}){this.subjectKeyIdentifier=new SubjectKeyIdentifier,Object.assign(this,u)}}__decorate([AsnProp({type:SubjectKeyIdentifier})],RecipientKeyIdentifier.prototype,"subjectKeyIdentifier",void 0);__decorate([AsnProp({type:AsnPropTypes.GeneralizedTime,optional:!0})],RecipientKeyIdentifier.prototype,"date",void 0);__decorate([AsnProp({type:OtherKeyAttribute,optional:!0})],RecipientKeyIdentifier.prototype,"other",void 0);let KeyAgreeRecipientIdentifier=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:RecipientKeyIdentifier,context:0,implicit:!0,optional:!0})],KeyAgreeRecipientIdentifier.prototype,"rKeyId",void 0);__decorate([AsnProp({type:IssuerAndSerialNumber,optional:!0})],KeyAgreeRecipientIdentifier.prototype,"issuerAndSerialNumber",void 0);KeyAgreeRecipientIdentifier=__decorate([AsnType({type:AsnTypeTypes.Choice})],KeyAgreeRecipientIdentifier);class RecipientEncryptedKey{constructor(u={}){this.rid=new KeyAgreeRecipientIdentifier,this.encryptedKey=new OctetString,Object.assign(this,u)}}__decorate([AsnProp({type:KeyAgreeRecipientIdentifier})],RecipientEncryptedKey.prototype,"rid",void 0);__decorate([AsnProp({type:OctetString})],RecipientEncryptedKey.prototype,"encryptedKey",void 0);let RecipientEncryptedKeys=RecipientEncryptedKeys_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,RecipientEncryptedKeys_1.prototype)}};RecipientEncryptedKeys=RecipientEncryptedKeys_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:RecipientEncryptedKey})],RecipientEncryptedKeys);class OriginatorPublicKey{constructor(u={}){this.algorithm=new AlgorithmIdentifier,this.publicKey=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AlgorithmIdentifier})],OriginatorPublicKey.prototype,"algorithm",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString})],OriginatorPublicKey.prototype,"publicKey",void 0);let OriginatorIdentifierOrKey=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:SubjectKeyIdentifier,context:0,implicit:!0,optional:!0})],OriginatorIdentifierOrKey.prototype,"subjectKeyIdentifier",void 0);__decorate([AsnProp({type:OriginatorPublicKey,context:1,implicit:!0,optional:!0})],OriginatorIdentifierOrKey.prototype,"originatorKey",void 0);__decorate([AsnProp({type:IssuerAndSerialNumber,optional:!0})],OriginatorIdentifierOrKey.prototype,"issuerAndSerialNumber",void 0);OriginatorIdentifierOrKey=__decorate([AsnType({type:AsnTypeTypes.Choice})],OriginatorIdentifierOrKey);class KeyAgreeRecipientInfo{constructor(u={}){this.version=CMSVersion.v3,this.originator=new OriginatorIdentifierOrKey,this.keyEncryptionAlgorithm=new KeyEncryptionAlgorithmIdentifier,this.recipientEncryptedKeys=new RecipientEncryptedKeys,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],KeyAgreeRecipientInfo.prototype,"version",void 0);__decorate([AsnProp({type:OriginatorIdentifierOrKey,context:0})],KeyAgreeRecipientInfo.prototype,"originator",void 0);__decorate([AsnProp({type:OctetString,context:1,optional:!0})],KeyAgreeRecipientInfo.prototype,"ukm",void 0);__decorate([AsnProp({type:KeyEncryptionAlgorithmIdentifier})],KeyAgreeRecipientInfo.prototype,"keyEncryptionAlgorithm",void 0);__decorate([AsnProp({type:RecipientEncryptedKeys})],KeyAgreeRecipientInfo.prototype,"recipientEncryptedKeys",void 0);let RecipientIdentifier=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:SubjectKeyIdentifier,context:0,implicit:!0})],RecipientIdentifier.prototype,"subjectKeyIdentifier",void 0);__decorate([AsnProp({type:IssuerAndSerialNumber})],RecipientIdentifier.prototype,"issuerAndSerialNumber",void 0);RecipientIdentifier=__decorate([AsnType({type:AsnTypeTypes.Choice})],RecipientIdentifier);class KeyTransRecipientInfo{constructor(u={}){this.version=CMSVersion.v0,this.rid=new RecipientIdentifier,this.keyEncryptionAlgorithm=new KeyEncryptionAlgorithmIdentifier,this.encryptedKey=new OctetString,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],KeyTransRecipientInfo.prototype,"version",void 0);__decorate([AsnProp({type:RecipientIdentifier})],KeyTransRecipientInfo.prototype,"rid",void 0);__decorate([AsnProp({type:KeyEncryptionAlgorithmIdentifier})],KeyTransRecipientInfo.prototype,"keyEncryptionAlgorithm",void 0);__decorate([AsnProp({type:OctetString})],KeyTransRecipientInfo.prototype,"encryptedKey",void 0);class KEKIdentifier{constructor(u={}){this.keyIdentifier=new OctetString,Object.assign(this,u)}}__decorate([AsnProp({type:OctetString})],KEKIdentifier.prototype,"keyIdentifier",void 0);__decorate([AsnProp({type:AsnPropTypes.GeneralizedTime,optional:!0})],KEKIdentifier.prototype,"date",void 0);__decorate([AsnProp({type:OtherKeyAttribute,optional:!0})],KEKIdentifier.prototype,"other",void 0);class KEKRecipientInfo{constructor(u={}){this.version=CMSVersion.v4,this.kekid=new KEKIdentifier,this.keyEncryptionAlgorithm=new KeyEncryptionAlgorithmIdentifier,this.encryptedKey=new OctetString,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],KEKRecipientInfo.prototype,"version",void 0);__decorate([AsnProp({type:KEKIdentifier})],KEKRecipientInfo.prototype,"kekid",void 0);__decorate([AsnProp({type:KeyEncryptionAlgorithmIdentifier})],KEKRecipientInfo.prototype,"keyEncryptionAlgorithm",void 0);__decorate([AsnProp({type:OctetString})],KEKRecipientInfo.prototype,"encryptedKey",void 0);class PasswordRecipientInfo{constructor(u={}){this.version=CMSVersion.v0,this.keyEncryptionAlgorithm=new KeyEncryptionAlgorithmIdentifier,this.encryptedKey=new OctetString,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],PasswordRecipientInfo.prototype,"version",void 0);__decorate([AsnProp({type:KeyDerivationAlgorithmIdentifier,context:0,optional:!0})],PasswordRecipientInfo.prototype,"keyDerivationAlgorithm",void 0);__decorate([AsnProp({type:KeyEncryptionAlgorithmIdentifier})],PasswordRecipientInfo.prototype,"keyEncryptionAlgorithm",void 0);__decorate([AsnProp({type:OctetString})],PasswordRecipientInfo.prototype,"encryptedKey",void 0);class OtherRecipientInfo{constructor(u={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],OtherRecipientInfo.prototype,"oriType",void 0);__decorate([AsnProp({type:AsnPropTypes.Any})],OtherRecipientInfo.prototype,"oriValue",void 0);let RecipientInfo=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:KeyTransRecipientInfo,optional:!0})],RecipientInfo.prototype,"ktri",void 0);__decorate([AsnProp({type:KeyAgreeRecipientInfo,context:1,implicit:!0,optional:!0})],RecipientInfo.prototype,"kari",void 0);__decorate([AsnProp({type:KEKRecipientInfo,context:2,implicit:!0,optional:!0})],RecipientInfo.prototype,"kekri",void 0);__decorate([AsnProp({type:PasswordRecipientInfo,context:3,implicit:!0,optional:!0})],RecipientInfo.prototype,"pwri",void 0);__decorate([AsnProp({type:OtherRecipientInfo,context:4,implicit:!0,optional:!0})],RecipientInfo.prototype,"ori",void 0);RecipientInfo=__decorate([AsnType({type:AsnTypeTypes.Choice})],RecipientInfo);var RecipientInfos_1;let RecipientInfos=RecipientInfos_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,RecipientInfos_1.prototype)}};RecipientInfos=RecipientInfos_1=__decorate([AsnType({type:AsnTypeTypes.Set,itemType:RecipientInfo})],RecipientInfos);var RevocationInfoChoices_1;class OtherRevocationInfoFormat{constructor(u={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],OtherRevocationInfoFormat.prototype,"otherRevInfoFormat",void 0);__decorate([AsnProp({type:AsnPropTypes.Any})],OtherRevocationInfoFormat.prototype,"otherRevInfo",void 0);let RevocationInfoChoice=class{constructor(u={}){this.other=new OtherRevocationInfoFormat,Object.assign(this,u)}};__decorate([AsnProp({type:OtherRevocationInfoFormat,context:1,implicit:!0})],RevocationInfoChoice.prototype,"other",void 0);RevocationInfoChoice=__decorate([AsnType({type:AsnTypeTypes.Choice})],RevocationInfoChoice);let RevocationInfoChoices=RevocationInfoChoices_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,RevocationInfoChoices_1.prototype)}};RevocationInfoChoices=RevocationInfoChoices_1=__decorate([AsnType({type:AsnTypeTypes.Set,itemType:RevocationInfoChoice})],RevocationInfoChoices);class OriginatorInfo{constructor(u={}){Object.assign(this,u)}}__decorate([AsnProp({type:CertificateSet,context:0,implicit:!0,optional:!0})],OriginatorInfo.prototype,"certs",void 0);__decorate([AsnProp({type:RevocationInfoChoices,context:1,implicit:!0,optional:!0})],OriginatorInfo.prototype,"crls",void 0);var UnprotectedAttributes_1;let UnprotectedAttributes=UnprotectedAttributes_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,UnprotectedAttributes_1.prototype)}};UnprotectedAttributes=UnprotectedAttributes_1=__decorate([AsnType({type:AsnTypeTypes.Set,itemType:Attribute$1})],UnprotectedAttributes);class EnvelopedData{constructor(u={}){this.version=CMSVersion.v0,this.recipientInfos=new RecipientInfos,this.encryptedContentInfo=new EncryptedContentInfo,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],EnvelopedData.prototype,"version",void 0);__decorate([AsnProp({type:OriginatorInfo,context:0,implicit:!0,optional:!0})],EnvelopedData.prototype,"originatorInfo",void 0);__decorate([AsnProp({type:RecipientInfos})],EnvelopedData.prototype,"recipientInfos",void 0);__decorate([AsnProp({type:EncryptedContentInfo})],EnvelopedData.prototype,"encryptedContentInfo",void 0);__decorate([AsnProp({type:UnprotectedAttributes,context:1,implicit:!0,optional:!0})],EnvelopedData.prototype,"unprotectedAttrs",void 0);const id_signedData="1.2.840.113549.1.7.2";var DigestAlgorithmIdentifiers_1;let DigestAlgorithmIdentifiers=DigestAlgorithmIdentifiers_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,DigestAlgorithmIdentifiers_1.prototype)}};DigestAlgorithmIdentifiers=DigestAlgorithmIdentifiers_1=__decorate([AsnType({type:AsnTypeTypes.Set,itemType:DigestAlgorithmIdentifier})],DigestAlgorithmIdentifiers);class SignedData{constructor(u={}){this.version=CMSVersion.v0,this.digestAlgorithms=new DigestAlgorithmIdentifiers,this.encapContentInfo=new EncapsulatedContentInfo,this.signerInfos=new SignerInfos,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],SignedData.prototype,"version",void 0);__decorate([AsnProp({type:DigestAlgorithmIdentifiers})],SignedData.prototype,"digestAlgorithms",void 0);__decorate([AsnProp({type:EncapsulatedContentInfo})],SignedData.prototype,"encapContentInfo",void 0);__decorate([AsnProp({type:CertificateSet,context:0,implicit:!0,optional:!0})],SignedData.prototype,"certificates",void 0);__decorate([AsnProp({type:RevocationInfoChoices,context:1,implicit:!0,optional:!0})],SignedData.prototype,"crls",void 0);__decorate([AsnProp({type:SignerInfos})],SignedData.prototype,"signerInfos",void 0);const id_ecPublicKey="1.2.840.10045.2.1",id_ecdsaWithSHA1="1.2.840.10045.4.1",id_ecdsaWithSHA224="1.2.840.10045.4.3.1",id_ecdsaWithSHA256="1.2.840.10045.4.3.2",id_ecdsaWithSHA384="1.2.840.10045.4.3.3",id_ecdsaWithSHA512="1.2.840.10045.4.3.4",id_secp256r1="1.2.840.10045.3.1.7",id_secp384r1="1.3.132.0.34",id_secp521r1="1.3.132.0.35";function create$3(y){return new AlgorithmIdentifier({algorithm:y})}const ecdsaWithSHA1=create$3(id_ecdsaWithSHA1);create$3(id_ecdsaWithSHA224);const ecdsaWithSHA256=create$3(id_ecdsaWithSHA256),ecdsaWithSHA384=create$3(id_ecdsaWithSHA384),ecdsaWithSHA512=create$3(id_ecdsaWithSHA512);let FieldID=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],FieldID.prototype,"fieldType",void 0);__decorate([AsnProp({type:AsnPropTypes.Any})],FieldID.prototype,"parameters",void 0);FieldID=__decorate([AsnType({type:AsnTypeTypes.Sequence})],FieldID);class ECPoint extends OctetString{}let Curve=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:AsnPropTypes.OctetString})],Curve.prototype,"a",void 0);__decorate([AsnProp({type:AsnPropTypes.OctetString})],Curve.prototype,"b",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString,optional:!0})],Curve.prototype,"seed",void 0);Curve=__decorate([AsnType({type:AsnTypeTypes.Sequence})],Curve);var ECPVer;(function(y){y[y.ecpVer1=1]="ecpVer1"})(ECPVer||(ECPVer={}));let SpecifiedECDomain=class{constructor(u={}){this.version=ECPVer.ecpVer1,Object.assign(this,u)}};__decorate([AsnProp({type:AsnPropTypes.Integer})],SpecifiedECDomain.prototype,"version",void 0);__decorate([AsnProp({type:FieldID})],SpecifiedECDomain.prototype,"fieldID",void 0);__decorate([AsnProp({type:Curve})],SpecifiedECDomain.prototype,"curve",void 0);__decorate([AsnProp({type:ECPoint})],SpecifiedECDomain.prototype,"base",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],SpecifiedECDomain.prototype,"order",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,optional:!0})],SpecifiedECDomain.prototype,"cofactor",void 0);SpecifiedECDomain=__decorate([AsnType({type:AsnTypeTypes.Sequence})],SpecifiedECDomain);let ECParameters=class{constructor(u={}){Object.assign(this,u)}};__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],ECParameters.prototype,"namedCurve",void 0);__decorate([AsnProp({type:AsnPropTypes.Null})],ECParameters.prototype,"implicitCurve",void 0);__decorate([AsnProp({type:SpecifiedECDomain})],ECParameters.prototype,"specifiedCurve",void 0);ECParameters=__decorate([AsnType({type:AsnTypeTypes.Choice})],ECParameters);class ECPrivateKey{constructor(u={}){this.version=1,this.privateKey=new OctetString,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],ECPrivateKey.prototype,"version",void 0);__decorate([AsnProp({type:OctetString})],ECPrivateKey.prototype,"privateKey",void 0);__decorate([AsnProp({type:ECParameters,context:0,optional:!0})],ECPrivateKey.prototype,"parameters",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString,context:1,optional:!0})],ECPrivateKey.prototype,"publicKey",void 0);class ECDSASigValue{constructor(u={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],ECDSASigValue.prototype,"r",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],ECDSASigValue.prototype,"s",void 0);const id_pkcs_1="1.2.840.113549.1.1",id_rsaEncryption=`${id_pkcs_1}.1`,id_RSAES_OAEP=`${id_pkcs_1}.7`,id_pSpecified=`${id_pkcs_1}.9`,id_RSASSA_PSS=`${id_pkcs_1}.10`,id_md2WithRSAEncryption=`${id_pkcs_1}.2`,id_md5WithRSAEncryption=`${id_pkcs_1}.4`,id_sha1WithRSAEncryption=`${id_pkcs_1}.5`,id_sha224WithRSAEncryption=`${id_pkcs_1}.14`,id_sha256WithRSAEncryption=`${id_pkcs_1}.11`,id_sha384WithRSAEncryption=`${id_pkcs_1}.12`,id_sha512WithRSAEncryption=`${id_pkcs_1}.13`,id_sha512_224WithRSAEncryption=`${id_pkcs_1}.15`,id_sha512_256WithRSAEncryption=`${id_pkcs_1}.16`,id_sha1="1.3.14.3.2.26",id_sha224="2.16.840.1.101.3.4.2.4",id_sha256="2.16.840.1.101.3.4.2.1",id_sha384="2.16.840.1.101.3.4.2.2",id_sha512="2.16.840.1.101.3.4.2.3",id_sha512_224="2.16.840.1.101.3.4.2.5",id_sha512_256="2.16.840.1.101.3.4.2.6",id_md2="1.2.840.113549.2.2",id_md5="1.2.840.113549.2.5",id_mgf1=`${id_pkcs_1}.8`;function create$2(y){return new AlgorithmIdentifier({algorithm:y,parameters:null})}create$2(id_md2);create$2(id_md5);const sha1=create$2(id_sha1);create$2(id_sha224);create$2(id_sha256);create$2(id_sha384);create$2(id_sha512);create$2(id_sha512_224);create$2(id_sha512_256);const mgf1SHA1=new AlgorithmIdentifier({algorithm:id_mgf1,parameters:AsnConvert.serialize(sha1)}),pSpecifiedEmpty=new AlgorithmIdentifier({algorithm:id_pSpecified,parameters:AsnConvert.serialize(AsnOctetStringConverter.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});create$2(id_rsaEncryption);create$2(id_md2WithRSAEncryption);create$2(id_md5WithRSAEncryption);create$2(id_sha1WithRSAEncryption);create$2(id_sha512_224WithRSAEncryption);create$2(id_sha512_256WithRSAEncryption);create$2(id_sha384WithRSAEncryption);create$2(id_sha512WithRSAEncryption);create$2(id_sha512_224WithRSAEncryption);create$2(id_sha512_256WithRSAEncryption);class RsaEsOaepParams{constructor(u={}){this.hashAlgorithm=new AlgorithmIdentifier(sha1),this.maskGenAlgorithm=new AlgorithmIdentifier({algorithm:id_mgf1,parameters:AsnConvert.serialize(sha1)}),this.pSourceAlgorithm=new AlgorithmIdentifier(pSpecifiedEmpty),Object.assign(this,u)}}__decorate([AsnProp({type:AlgorithmIdentifier,context:0,defaultValue:sha1})],RsaEsOaepParams.prototype,"hashAlgorithm",void 0);__decorate([AsnProp({type:AlgorithmIdentifier,context:1,defaultValue:mgf1SHA1})],RsaEsOaepParams.prototype,"maskGenAlgorithm",void 0);__decorate([AsnProp({type:AlgorithmIdentifier,context:2,defaultValue:pSpecifiedEmpty})],RsaEsOaepParams.prototype,"pSourceAlgorithm",void 0);new AlgorithmIdentifier({algorithm:id_RSAES_OAEP,parameters:AsnConvert.serialize(new RsaEsOaepParams)});class RsaSaPssParams{constructor(u={}){this.hashAlgorithm=new AlgorithmIdentifier(sha1),this.maskGenAlgorithm=new AlgorithmIdentifier({algorithm:id_mgf1,parameters:AsnConvert.serialize(sha1)}),this.saltLength=20,this.trailerField=1,Object.assign(this,u)}}__decorate([AsnProp({type:AlgorithmIdentifier,context:0,defaultValue:sha1})],RsaSaPssParams.prototype,"hashAlgorithm",void 0);__decorate([AsnProp({type:AlgorithmIdentifier,context:1,defaultValue:mgf1SHA1})],RsaSaPssParams.prototype,"maskGenAlgorithm",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,context:2,defaultValue:20})],RsaSaPssParams.prototype,"saltLength",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,context:3,defaultValue:1})],RsaSaPssParams.prototype,"trailerField",void 0);new AlgorithmIdentifier({algorithm:id_RSASSA_PSS,parameters:AsnConvert.serialize(new RsaSaPssParams)});class DigestInfo{constructor(u={}){this.digestAlgorithm=new AlgorithmIdentifier,this.digest=new OctetString,Object.assign(this,u)}}__decorate([AsnProp({type:AlgorithmIdentifier})],DigestInfo.prototype,"digestAlgorithm",void 0);__decorate([AsnProp({type:OctetString})],DigestInfo.prototype,"digest",void 0);var OtherPrimeInfos_1;class OtherPrimeInfo{constructor(u={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],OtherPrimeInfo.prototype,"prime",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],OtherPrimeInfo.prototype,"exponent",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],OtherPrimeInfo.prototype,"coefficient",void 0);let OtherPrimeInfos=OtherPrimeInfos_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,OtherPrimeInfos_1.prototype)}};OtherPrimeInfos=OtherPrimeInfos_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:OtherPrimeInfo})],OtherPrimeInfos);class RSAPrivateKey{constructor(u={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],RSAPrivateKey.prototype,"version",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],RSAPrivateKey.prototype,"modulus",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],RSAPrivateKey.prototype,"publicExponent",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],RSAPrivateKey.prototype,"privateExponent",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],RSAPrivateKey.prototype,"prime1",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],RSAPrivateKey.prototype,"prime2",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],RSAPrivateKey.prototype,"exponent1",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],RSAPrivateKey.prototype,"exponent2",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],RSAPrivateKey.prototype,"coefficient",void 0);__decorate([AsnProp({type:OtherPrimeInfos,optional:!0})],RSAPrivateKey.prototype,"otherPrimeInfos",void 0);class RSAPublicKey{constructor(u={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],RSAPublicKey.prototype,"modulus",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,converter:AsnIntegerArrayBufferConverter})],RSAPublicKey.prototype,"publicExponent",void 0);var Lifecycle;(function(y){y[y.Transient=0]="Transient",y[y.Singleton=1]="Singleton",y[y.ResolutionScoped=2]="ResolutionScoped",y[y.ContainerScoped=3]="ContainerScoped"})(Lifecycle||(Lifecycle={}));const Lifecycle$1=Lifecycle;var extendStatics=function(y,u){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,v){g.__proto__=v}||function(g,v){for(var b in v)v.hasOwnProperty(b)&&(g[b]=v[b])},extendStatics(y,u)};function __extends(y,u){extendStatics(y,u);function g(){this.constructor=y}y.prototype=u===null?Object.create(u):(g.prototype=u.prototype,new g)}function __awaiter(y,u,g,v){function b(w){return w instanceof g?w:new g(function(E){E(w)})}return new(g||(g=Promise))(function(w,E){function S(R){try{$(v.next(R))}catch(T){E(T)}}function A(R){try{$(v.throw(R))}catch(T){E(T)}}function $(R){R.done?w(R.value):b(R.value).then(S,A)}$((v=v.apply(y,[])).next())})}function __generator(y,u){var g={label:0,sent:function(){if(w[0]&1)throw w[1];return w[1]},trys:[],ops:[]},v,b,w,E;return E={next:S(0),throw:S(1),return:S(2)},typeof Symbol=="function"&&(E[Symbol.iterator]=function(){return this}),E;function S($){return function(R){return A([$,R])}}function A($){if(v)throw new TypeError("Generator is already executing.");for(;g;)try{if(v=1,b&&(w=$[0]&2?b.return:$[0]?b.throw||((w=b.return)&&w.call(b),0):b.next)&&!(w=w.call(b,$[1])).done)return w;switch(b=0,w&&($=[$[0]&2,w.value]),$[0]){case 0:case 1:w=$;break;case 4:return g.label++,{value:$[1],done:!1};case 5:g.label++,b=$[1],$=[0];continue;case 7:$=g.ops.pop(),g.trys.pop();continue;default:if(w=g.trys,!(w=w.length>0&&w[w.length-1])&&($[0]===6||$[0]===2)){g=0;continue}if($[0]===3&&(!w||$[1]>w[0]&&$[1]<w[3])){g.label=$[1];break}if($[0]===6&&g.label<w[1]){g.label=w[1],w=$;break}if(w&&g.label<w[2]){g.label=w[2],g.ops.push($);break}w[2]&&g.ops.pop(),g.trys.pop();continue}$=u.call(y,g)}catch(R){$=[6,R],b=0}finally{v=w=0}if($[0]&5)throw $[1];return{value:$[0]?$[1]:void 0,done:!0}}}function __values(y){var u=typeof Symbol=="function"&&Symbol.iterator,g=u&&y[u],v=0;if(g)return g.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&v>=y.length&&(y=void 0),{value:y&&y[v++],done:!y}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(y,u){var g=typeof Symbol=="function"&&y[Symbol.iterator];if(!g)return y;var v=g.call(y),b,w=[],E;try{for(;(u===void 0||u-- >0)&&!(b=v.next()).done;)w.push(b.value)}catch(S){E={error:S}}finally{try{b&&!b.done&&(g=v.return)&&g.call(v)}finally{if(E)throw E.error}}return w}function __spread(){for(var y=[],u=0;u<arguments.length;u++)y=y.concat(__read(arguments[u]));return y}var INJECTION_TOKEN_METADATA_KEY="injectionTokens";function getParamInfo(y){var u=Reflect.getMetadata("design:paramtypes",y)||[],g=Reflect.getOwnMetadata(INJECTION_TOKEN_METADATA_KEY,y)||{};return Object.keys(g).forEach(function(v){u[+v]=g[v]}),u}function isClassProvider(y){return!!y.useClass}function isFactoryProvider(y){return!!y.useFactory}var DelayedConstructor=(function(){function y(u){this.wrap=u,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return y.prototype.createProxy=function(u){var g=this,v={},b=!1,w,E=function(){return b||(w=u(g.wrap()),b=!0),w};return new Proxy(v,this.createHandler(E))},y.prototype.createHandler=function(u){var g={},v=function(b){g[b]=function(){for(var w=[],E=0;E<arguments.length;E++)w[E]=arguments[E];w[0]=u();var S=Reflect[b];return S.apply(void 0,__spread(w))}};return this.reflectMethods.forEach(v),g},y})();function isNormalToken(y){return typeof y=="string"||typeof y=="symbol"}function isTokenDescriptor(y){return typeof y=="object"&&"token"in y&&"multiple"in y}function isTransformDescriptor(y){return typeof y=="object"&&"token"in y&&"transform"in y}function isConstructorToken(y){return typeof y=="function"||y instanceof DelayedConstructor}function isTokenProvider(y){return!!y.useToken}function isValueProvider(y){return y.useValue!=null}function isProvider(y){return isClassProvider(y)||isValueProvider(y)||isTokenProvider(y)||isFactoryProvider(y)}var RegistryBase=(function(){function y(){this._registryMap=new Map}return y.prototype.entries=function(){return this._registryMap.entries()},y.prototype.getAll=function(u){return this.ensure(u),this._registryMap.get(u)},y.prototype.get=function(u){this.ensure(u);var g=this._registryMap.get(u);return g[g.length-1]||null},y.prototype.set=function(u,g){this.ensure(u),this._registryMap.get(u).push(g)},y.prototype.setAll=function(u,g){this._registryMap.set(u,g)},y.prototype.has=function(u){return this.ensure(u),this._registryMap.get(u).length>0},y.prototype.clear=function(){this._registryMap.clear()},y.prototype.ensure=function(u){this._registryMap.has(u)||this._registryMap.set(u,[])},y})(),Registry=(function(y){__extends(u,y);function u(){return y!==null&&y.apply(this,arguments)||this}return u})(RegistryBase),ResolutionContext=(function(){function y(){this.scopedResolutions=new Map}return y})();function formatDependency(y,u){if(y===null)return"at position #"+u;var g=y.split(",")[u].trim();return'"'+g+'" at position #'+u}function composeErrorMessage(y,u,g){return g===void 0&&(g="    "),__spread([y],u.message.split(`
`).map(function(v){return g+v})).join(`
`)}function formatErrorCtor(y,u,g){var v=__read(y.toString().match(/constructor\(([\w, ]+)\)/)||[],2),b=v[1],w=b===void 0?null:b,E=formatDependency(w,u);return composeErrorMessage("Cannot inject the dependency "+E+' of "'+y.name+'" constructor. Reason:',g)}function isDisposable(y){if(typeof y.dispose!="function")return!1;var u=y.dispose;return!(u.length>0)}var PreResolutionInterceptors=(function(y){__extends(u,y);function u(){return y!==null&&y.apply(this,arguments)||this}return u})(RegistryBase),PostResolutionInterceptors=(function(y){__extends(u,y);function u(){return y!==null&&y.apply(this,arguments)||this}return u})(RegistryBase),Interceptors=(function(){function y(){this.preResolution=new PreResolutionInterceptors,this.postResolution=new PostResolutionInterceptors}return y})(),typeInfo=new Map,InternalDependencyContainer=(function(){function y(u){this.parent=u,this._registry=new Registry,this.interceptors=new Interceptors,this.disposed=!1,this.disposables=new Set}return y.prototype.register=function(u,g,v){v===void 0&&(v={lifecycle:Lifecycle$1.Transient}),this.ensureNotDisposed();var b;if(isProvider(g)?b=g:b={useClass:g},isTokenProvider(b))for(var w=[u],E=b;E!=null;){var S=E.useToken;if(w.includes(S))throw new Error("Token registration cycle detected! "+__spread(w,[S]).join(" -> "));w.push(S);var A=this._registry.get(S);A&&isTokenProvider(A.provider)?E=A.provider:E=null}if((v.lifecycle===Lifecycle$1.Singleton||v.lifecycle==Lifecycle$1.ContainerScoped||v.lifecycle==Lifecycle$1.ResolutionScoped)&&(isValueProvider(b)||isFactoryProvider(b)))throw new Error('Cannot use lifecycle "'+Lifecycle$1[v.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(u,{provider:b,options:v}),this},y.prototype.registerType=function(u,g){return this.ensureNotDisposed(),isNormalToken(g)?this.register(u,{useToken:g}):this.register(u,{useClass:g})},y.prototype.registerInstance=function(u,g){return this.ensureNotDisposed(),this.register(u,{useValue:g})},y.prototype.registerSingleton=function(u,g){if(this.ensureNotDisposed(),isNormalToken(u)){if(isNormalToken(g))return this.register(u,{useToken:g},{lifecycle:Lifecycle$1.Singleton});if(g)return this.register(u,{useClass:g},{lifecycle:Lifecycle$1.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var v=u;return g&&!isNormalToken(g)&&(v=g),this.register(u,{useClass:v},{lifecycle:Lifecycle$1.Singleton})},y.prototype.resolve=function(u,g,v){g===void 0&&(g=new ResolutionContext),v===void 0&&(v=!1),this.ensureNotDisposed();var b=this.getRegistration(u);if(!b&&isNormalToken(u)){if(v)return;throw new Error('Attempted to resolve unregistered dependency token: "'+u.toString()+'"')}if(this.executePreResolutionInterceptor(u,"Single"),b){var w=this.resolveRegistration(b,g);return this.executePostResolutionInterceptor(u,w,"Single"),w}if(isConstructorToken(u)){var w=this.construct(u,g);return this.executePostResolutionInterceptor(u,w,"Single"),w}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},y.prototype.executePreResolutionInterceptor=function(u,g){var v,b;if(this.interceptors.preResolution.has(u)){var w=[];try{for(var E=__values(this.interceptors.preResolution.getAll(u)),S=E.next();!S.done;S=E.next()){var A=S.value;A.options.frequency!="Once"&&w.push(A),A.callback(u,g)}}catch($){v={error:$}}finally{try{S&&!S.done&&(b=E.return)&&b.call(E)}finally{if(v)throw v.error}}this.interceptors.preResolution.setAll(u,w)}},y.prototype.executePostResolutionInterceptor=function(u,g,v){var b,w;if(this.interceptors.postResolution.has(u)){var E=[];try{for(var S=__values(this.interceptors.postResolution.getAll(u)),A=S.next();!A.done;A=S.next()){var $=A.value;$.options.frequency!="Once"&&E.push($),$.callback(u,g,v)}}catch(R){b={error:R}}finally{try{A&&!A.done&&(w=S.return)&&w.call(S)}finally{if(b)throw b.error}}this.interceptors.postResolution.setAll(u,E)}},y.prototype.resolveRegistration=function(u,g){if(this.ensureNotDisposed(),u.options.lifecycle===Lifecycle$1.ResolutionScoped&&g.scopedResolutions.has(u))return g.scopedResolutions.get(u);var v=u.options.lifecycle===Lifecycle$1.Singleton,b=u.options.lifecycle===Lifecycle$1.ContainerScoped,w=v||b,E;return isValueProvider(u.provider)?E=u.provider.useValue:isTokenProvider(u.provider)?E=w?u.instance||(u.instance=this.resolve(u.provider.useToken,g)):this.resolve(u.provider.useToken,g):isClassProvider(u.provider)?E=w?u.instance||(u.instance=this.construct(u.provider.useClass,g)):this.construct(u.provider.useClass,g):isFactoryProvider(u.provider)?E=u.provider.useFactory(this):E=this.construct(u.provider,g),u.options.lifecycle===Lifecycle$1.ResolutionScoped&&g.scopedResolutions.set(u,E),E},y.prototype.resolveAll=function(u,g,v){var b=this;g===void 0&&(g=new ResolutionContext),v===void 0&&(v=!1),this.ensureNotDisposed();var w=this.getAllRegistrations(u);if(!w&&isNormalToken(u)){if(v)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+u.toString()+'"')}if(this.executePreResolutionInterceptor(u,"All"),w){var E=w.map(function(A){return b.resolveRegistration(A,g)});return this.executePostResolutionInterceptor(u,E,"All"),E}var S=[this.construct(u,g)];return this.executePostResolutionInterceptor(u,S,"All"),S},y.prototype.isRegistered=function(u,g){return g===void 0&&(g=!1),this.ensureNotDisposed(),this._registry.has(u)||g&&(this.parent||!1)&&this.parent.isRegistered(u,!0)},y.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},y.prototype.clearInstances=function(){var u,g;this.ensureNotDisposed();try{for(var v=__values(this._registry.entries()),b=v.next();!b.done;b=v.next()){var w=__read(b.value,2),E=w[0],S=w[1];this._registry.setAll(E,S.filter(function(A){return!isValueProvider(A.provider)}).map(function(A){return A.instance=void 0,A}))}}catch(A){u={error:A}}finally{try{b&&!b.done&&(g=v.return)&&g.call(v)}finally{if(u)throw u.error}}},y.prototype.createChildContainer=function(){var u,g;this.ensureNotDisposed();var v=new y(this);try{for(var b=__values(this._registry.entries()),w=b.next();!w.done;w=b.next()){var E=__read(w.value,2),S=E[0],A=E[1];A.some(function($){var R=$.options;return R.lifecycle===Lifecycle$1.ContainerScoped})&&v._registry.setAll(S,A.map(function($){return $.options.lifecycle===Lifecycle$1.ContainerScoped?{provider:$.provider,options:$.options}:$}))}}catch($){u={error:$}}finally{try{w&&!w.done&&(g=b.return)&&g.call(b)}finally{if(u)throw u.error}}return v},y.prototype.beforeResolution=function(u,g,v){v===void 0&&(v={frequency:"Always"}),this.interceptors.preResolution.set(u,{callback:g,options:v})},y.prototype.afterResolution=function(u,g,v){v===void 0&&(v={frequency:"Always"}),this.interceptors.postResolution.set(u,{callback:g,options:v})},y.prototype.dispose=function(){return __awaiter(this,void 0,void 0,function(){var u;return __generator(this,function(g){switch(g.label){case 0:return this.disposed=!0,u=[],this.disposables.forEach(function(v){var b=v.dispose();b&&u.push(b)}),[4,Promise.all(u)];case 1:return g.sent(),[2]}})})},y.prototype.getRegistration=function(u){return this.isRegistered(u)?this._registry.get(u):this.parent?this.parent.getRegistration(u):null},y.prototype.getAllRegistrations=function(u){return this.isRegistered(u)?this._registry.getAll(u):this.parent?this.parent.getAllRegistrations(u):null},y.prototype.construct=function(u,g){var v=this;if(u instanceof DelayedConstructor)return u.createProxy(function(w){return v.resolve(w,g)});var b=(function(){var w=typeInfo.get(u);if(!w||w.length===0){if(u.length===0)return new u;throw new Error('TypeInfo not known for "'+u.name+'"')}var E=w.map(v.resolveParams(g,u));return new(u.bind.apply(u,__spread([void 0],E)))})();return isDisposable(b)&&this.disposables.add(b),b},y.prototype.resolveParams=function(u,g){var v=this;return function(b,w){var E,S,A;try{return isTokenDescriptor(b)?isTransformDescriptor(b)?b.multiple?(E=v.resolve(b.transform)).transform.apply(E,__spread([v.resolveAll(b.token,new ResolutionContext,b.isOptional)],b.transformArgs)):(S=v.resolve(b.transform)).transform.apply(S,__spread([v.resolve(b.token,u,b.isOptional)],b.transformArgs)):b.multiple?v.resolveAll(b.token,new ResolutionContext,b.isOptional):v.resolve(b.token,u,b.isOptional):isTransformDescriptor(b)?(A=v.resolve(b.transform,u)).transform.apply(A,__spread([v.resolve(b.token,u)],b.transformArgs)):v.resolve(b,u)}catch($){throw new Error(formatErrorCtor(g,w,$))}}},y.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},y})(),instance=new InternalDependencyContainer;function injectable(y){return function(u){typeInfo.set(u,getParamInfo(u))}}if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var PKCS12AttrSet_1;class PKCS12Attribute{constructor(u={}){this.attrId="",this.attrValues=[],Object.assign(u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],PKCS12Attribute.prototype,"attrId",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,repeated:"set"})],PKCS12Attribute.prototype,"attrValues",void 0);let PKCS12AttrSet=PKCS12AttrSet_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,PKCS12AttrSet_1.prototype)}};PKCS12AttrSet=PKCS12AttrSet_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:PKCS12Attribute})],PKCS12AttrSet);var AuthenticatedSafe_1;let AuthenticatedSafe=AuthenticatedSafe_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,AuthenticatedSafe_1.prototype)}};AuthenticatedSafe=AuthenticatedSafe_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:ContentInfo})],AuthenticatedSafe);class CertBag{constructor(u={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],CertBag.prototype,"certId",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,context:0})],CertBag.prototype,"certValue",void 0);class CRLBag{constructor(u={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],CRLBag.prototype,"crlId",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,context:0})],CRLBag.prototype,"crltValue",void 0);class EncryptedData extends OctetString{}let EncryptedPrivateKeyInfo$1=class{constructor(u={}){this.encryptionAlgorithm=new AlgorithmIdentifier,this.encryptedData=new EncryptedData,Object.assign(this,u)}};__decorate([AsnProp({type:AlgorithmIdentifier})],EncryptedPrivateKeyInfo$1.prototype,"encryptionAlgorithm",void 0);__decorate([AsnProp({type:EncryptedData})],EncryptedPrivateKeyInfo$1.prototype,"encryptedData",void 0);var Attributes_1$1,Version;(function(y){y[y.v1=0]="v1"})(Version||(Version={}));class PrivateKey extends OctetString{}let Attributes$1=Attributes_1$1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,Attributes_1$1.prototype)}};Attributes$1=Attributes_1$1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:Attribute$2})],Attributes$1);class PrivateKeyInfo{constructor(u={}){this.version=Version.v1,this.privateKeyAlgorithm=new AlgorithmIdentifier,this.privateKey=new PrivateKey,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],PrivateKeyInfo.prototype,"version",void 0);__decorate([AsnProp({type:AlgorithmIdentifier})],PrivateKeyInfo.prototype,"privateKeyAlgorithm",void 0);__decorate([AsnProp({type:PrivateKey})],PrivateKeyInfo.prototype,"privateKey",void 0);__decorate([AsnProp({type:Attributes$1,implicit:!0,context:0,optional:!0})],PrivateKeyInfo.prototype,"attributes",void 0);let KeyBag=class extends PrivateKeyInfo{};KeyBag=__decorate([AsnType({type:AsnTypeTypes.Sequence})],KeyBag);let PKCS8ShroudedKeyBag=class extends EncryptedPrivateKeyInfo$1{};PKCS8ShroudedKeyBag=__decorate([AsnType({type:AsnTypeTypes.Sequence})],PKCS8ShroudedKeyBag);class SecretBag{constructor(u={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],SecretBag.prototype,"secretTypeId",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,context:0})],SecretBag.prototype,"secretValue",void 0);class MacData{constructor(u={}){this.mac=new DigestInfo,this.macSalt=new OctetString,this.iterations=1,Object.assign(this,u)}}__decorate([AsnProp({type:DigestInfo})],MacData.prototype,"mac",void 0);__decorate([AsnProp({type:OctetString})],MacData.prototype,"macSalt",void 0);__decorate([AsnProp({type:AsnPropTypes.Integer,defaultValue:1})],MacData.prototype,"iterations",void 0);class PFX{constructor(u={}){this.version=3,this.authSafe=new ContentInfo,this.macData=new MacData,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],PFX.prototype,"version",void 0);__decorate([AsnProp({type:ContentInfo})],PFX.prototype,"authSafe",void 0);__decorate([AsnProp({type:MacData,optional:!0})],PFX.prototype,"macData",void 0);var SafeContents_1;class SafeBag{constructor(u={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],SafeBag.prototype,"bagId",void 0);__decorate([AsnProp({type:AsnPropTypes.Any,context:0})],SafeBag.prototype,"bagValue",void 0);__decorate([AsnProp({type:PKCS12Attribute,repeated:"set",optional:!0})],SafeBag.prototype,"bagAttributes",void 0);let SafeContents=SafeContents_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,SafeContents_1.prototype)}};SafeContents=SafeContents_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:SafeBag})],SafeContents);var ExtensionRequest_1,ExtendedCertificateAttributes_1,SMIMECapabilities_1;const id_pkcs9="1.2.840.113549.1.9",id_pkcs9_at_challengePassword=`${id_pkcs9}.7`,id_pkcs9_at_extensionRequest=`${id_pkcs9}.14`;let PKCS9String=class extends DirectoryString{constructor(u={}){super(u)}toString(){return this.ia5String||super.toString()}};__decorate([AsnProp({type:AsnPropTypes.IA5String})],PKCS9String.prototype,"ia5String",void 0);PKCS9String=__decorate([AsnType({type:AsnTypeTypes.Choice})],PKCS9String);let Pkcs7PDU=class extends ContentInfo{};Pkcs7PDU=__decorate([AsnType({type:AsnTypeTypes.Sequence})],Pkcs7PDU);let UserPKCS12=class extends PFX{};UserPKCS12=__decorate([AsnType({type:AsnTypeTypes.Sequence})],UserPKCS12);let EncryptedPrivateKeyInfo=class extends EncryptedPrivateKeyInfo$1{};EncryptedPrivateKeyInfo=__decorate([AsnType({type:AsnTypeTypes.Sequence})],EncryptedPrivateKeyInfo);let EmailAddress=class{constructor(u=""){this.value=u}toString(){return this.value}};__decorate([AsnProp({type:AsnPropTypes.IA5String})],EmailAddress.prototype,"value",void 0);EmailAddress=__decorate([AsnType({type:AsnTypeTypes.Choice})],EmailAddress);let UnstructuredName=class extends PKCS9String{};UnstructuredName=__decorate([AsnType({type:AsnTypeTypes.Choice})],UnstructuredName);let UnstructuredAddress=class extends DirectoryString{};UnstructuredAddress=__decorate([AsnType({type:AsnTypeTypes.Choice})],UnstructuredAddress);let DateOfBirth=class{constructor(u=new Date){this.value=u}};__decorate([AsnProp({type:AsnPropTypes.GeneralizedTime})],DateOfBirth.prototype,"value",void 0);DateOfBirth=__decorate([AsnType({type:AsnTypeTypes.Choice})],DateOfBirth);let PlaceOfBirth=class extends DirectoryString{};PlaceOfBirth=__decorate([AsnType({type:AsnTypeTypes.Choice})],PlaceOfBirth);let Gender=class{constructor(u="M"){this.value=u}toString(){return this.value}};__decorate([AsnProp({type:AsnPropTypes.PrintableString})],Gender.prototype,"value",void 0);Gender=__decorate([AsnType({type:AsnTypeTypes.Choice})],Gender);let CountryOfCitizenship=class{constructor(u=""){this.value=u}toString(){return this.value}};__decorate([AsnProp({type:AsnPropTypes.PrintableString})],CountryOfCitizenship.prototype,"value",void 0);CountryOfCitizenship=__decorate([AsnType({type:AsnTypeTypes.Choice})],CountryOfCitizenship);let CountryOfResidence=class extends CountryOfCitizenship{};CountryOfResidence=__decorate([AsnType({type:AsnTypeTypes.Choice})],CountryOfResidence);let Pseudonym=class extends DirectoryString{};Pseudonym=__decorate([AsnType({type:AsnTypeTypes.Choice})],Pseudonym);let ContentType=class{constructor(u=""){this.value=u}toString(){return this.value}};__decorate([AsnProp({type:AsnPropTypes.ObjectIdentifier})],ContentType.prototype,"value",void 0);ContentType=__decorate([AsnType({type:AsnTypeTypes.Choice})],ContentType);let SigningTime=class extends Time{};SigningTime=__decorate([AsnType({type:AsnTypeTypes.Choice})],SigningTime);let SequenceNumber=class{constructor(u=0){this.value=u}toString(){return this.value.toString()}};__decorate([AsnProp({type:AsnPropTypes.Integer})],SequenceNumber.prototype,"value",void 0);SequenceNumber=__decorate([AsnType({type:AsnTypeTypes.Choice})],SequenceNumber);let CounterSignature=class extends SignerInfo{};CounterSignature=__decorate([AsnType({type:AsnTypeTypes.Sequence})],CounterSignature);let ChallengePassword=class extends DirectoryString{};ChallengePassword=__decorate([AsnType({type:AsnTypeTypes.Choice})],ChallengePassword);let ExtensionRequest=ExtensionRequest_1=class extends Extensions{constructor(u){super(u),Object.setPrototypeOf(this,ExtensionRequest_1.prototype)}};ExtensionRequest=ExtensionRequest_1=__decorate([AsnType({type:AsnTypeTypes.Sequence})],ExtensionRequest);let ExtendedCertificateAttributes=ExtendedCertificateAttributes_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,ExtendedCertificateAttributes_1.prototype)}};ExtendedCertificateAttributes=ExtendedCertificateAttributes_1=__decorate([AsnType({type:AsnTypeTypes.Set,itemType:Attribute$1})],ExtendedCertificateAttributes);let FriendlyName=class{constructor(u=""){this.value=u}toString(){return this.value}};__decorate([AsnProp({type:AsnPropTypes.BmpString})],FriendlyName.prototype,"value",void 0);FriendlyName=__decorate([AsnType({type:AsnTypeTypes.Choice})],FriendlyName);let SMIMECapability=class extends AlgorithmIdentifier{};SMIMECapability=__decorate([AsnType({type:AsnTypeTypes.Sequence})],SMIMECapability);let SMIMECapabilities=SMIMECapabilities_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,SMIMECapabilities_1.prototype)}};SMIMECapabilities=SMIMECapabilities_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:SMIMECapability})],SMIMECapabilities);var Attributes_1;let Attributes=Attributes_1=class extends AsnArray{constructor(u){super(u),Object.setPrototypeOf(this,Attributes_1.prototype)}};Attributes=Attributes_1=__decorate([AsnType({type:AsnTypeTypes.Sequence,itemType:Attribute$2})],Attributes);class CertificationRequestInfo{constructor(u={}){this.version=0,this.subject=new Name$1,this.subjectPKInfo=new SubjectPublicKeyInfo,this.attributes=new Attributes,Object.assign(this,u)}}__decorate([AsnProp({type:AsnPropTypes.Integer})],CertificationRequestInfo.prototype,"version",void 0);__decorate([AsnProp({type:Name$1})],CertificationRequestInfo.prototype,"subject",void 0);__decorate([AsnProp({type:SubjectPublicKeyInfo})],CertificationRequestInfo.prototype,"subjectPKInfo",void 0);__decorate([AsnProp({type:Attributes,implicit:!0,context:0,optional:!0})],CertificationRequestInfo.prototype,"attributes",void 0);class CertificationRequest{constructor(u={}){this.certificationRequestInfo=new CertificationRequestInfo,this.signatureAlgorithm=new AlgorithmIdentifier,this.signature=new ArrayBuffer(0),Object.assign(this,u)}}__decorate([AsnProp({type:CertificationRequestInfo,raw:!0})],CertificationRequest.prototype,"certificationRequestInfo",void 0);__decorate([AsnProp({type:AlgorithmIdentifier})],CertificationRequest.prototype,"signatureAlgorithm",void 0);__decorate([AsnProp({type:AsnPropTypes.BitString})],CertificationRequest.prototype,"signature",void 0);const diAlgorithm="crypto.algorithm";class AlgorithmProvider{getAlgorithms(){return instance.resolveAll(diAlgorithm)}toAsnAlgorithm(u){({...u});for(const g of this.getAlgorithms()){const v=g.toAsnAlgorithm(u);if(v)return v}if(/^[0-9.]+$/.test(u.name)){const g=new AlgorithmIdentifier({algorithm:u.name});if("parameters"in u){const v=u;g.parameters=v.parameters}return g}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(u){for(const v of this.getAlgorithms()){const b=v.toWebAlgorithm(u);if(b)return b}return{name:u.algorithm,parameters:u.parameters}}}const diAlgorithmProvider="crypto.algorithmProvider";instance.registerSingleton(diAlgorithmProvider,AlgorithmProvider);var EcAlgorithm_1;const idVersionOne="1.3.36.3.3.2.8.1.1",idBrainpoolP160r1=`${idVersionOne}.1`,idBrainpoolP160t1=`${idVersionOne}.2`,idBrainpoolP192r1=`${idVersionOne}.3`,idBrainpoolP192t1=`${idVersionOne}.4`,idBrainpoolP224r1=`${idVersionOne}.5`,idBrainpoolP224t1=`${idVersionOne}.6`,idBrainpoolP256r1=`${idVersionOne}.7`,idBrainpoolP256t1=`${idVersionOne}.8`,idBrainpoolP320r1=`${idVersionOne}.9`,idBrainpoolP320t1=`${idVersionOne}.10`,idBrainpoolP384r1=`${idVersionOne}.11`,idBrainpoolP384t1=`${idVersionOne}.12`,idBrainpoolP512r1=`${idVersionOne}.13`,idBrainpoolP512t1=`${idVersionOne}.14`,brainpoolP160r1="brainpoolP160r1",brainpoolP160t1="brainpoolP160t1",brainpoolP192r1="brainpoolP192r1",brainpoolP192t1="brainpoolP192t1",brainpoolP224r1="brainpoolP224r1",brainpoolP224t1="brainpoolP224t1",brainpoolP256r1="brainpoolP256r1",brainpoolP256t1="brainpoolP256t1",brainpoolP320r1="brainpoolP320r1",brainpoolP320t1="brainpoolP320t1",brainpoolP384r1="brainpoolP384r1",brainpoolP384t1="brainpoolP384t1",brainpoolP512r1="brainpoolP512r1",brainpoolP512t1="brainpoolP512t1",ECDSA="ECDSA";let EcAlgorithm=EcAlgorithm_1=class{toAsnAlgorithm(u){switch(u.name.toLowerCase()){case ECDSA.toLowerCase():if("hash"in u)switch((typeof u.hash=="string"?u.hash:u.hash.name).toLowerCase()){case"sha-1":return ecdsaWithSHA1;case"sha-256":return ecdsaWithSHA256;case"sha-384":return ecdsaWithSHA384;case"sha-512":return ecdsaWithSHA512}else if("namedCurve"in u){let g="";switch(u.namedCurve){case"P-256":g=id_secp256r1;break;case"K-256":g=EcAlgorithm_1.SECP256K1;break;case"P-384":g=id_secp384r1;break;case"P-521":g=id_secp521r1;break;case brainpoolP160r1:g=idBrainpoolP160r1;break;case brainpoolP160t1:g=idBrainpoolP160t1;break;case brainpoolP192r1:g=idBrainpoolP192r1;break;case brainpoolP192t1:g=idBrainpoolP192t1;break;case brainpoolP224r1:g=idBrainpoolP224r1;break;case brainpoolP224t1:g=idBrainpoolP224t1;break;case brainpoolP256r1:g=idBrainpoolP256r1;break;case brainpoolP256t1:g=idBrainpoolP256t1;break;case brainpoolP320r1:g=idBrainpoolP320r1;break;case brainpoolP320t1:g=idBrainpoolP320t1;break;case brainpoolP384r1:g=idBrainpoolP384r1;break;case brainpoolP384t1:g=idBrainpoolP384t1;break;case brainpoolP512r1:g=idBrainpoolP512r1;break;case brainpoolP512t1:g=idBrainpoolP512t1;break}if(g)return new AlgorithmIdentifier({algorithm:id_ecPublicKey,parameters:AsnConvert.serialize(new ECParameters({namedCurve:g}))})}}return null}toWebAlgorithm(u){switch(u.algorithm){case id_ecdsaWithSHA1:return{name:ECDSA,hash:{name:"SHA-1"}};case id_ecdsaWithSHA256:return{name:ECDSA,hash:{name:"SHA-256"}};case id_ecdsaWithSHA384:return{name:ECDSA,hash:{name:"SHA-384"}};case id_ecdsaWithSHA512:return{name:ECDSA,hash:{name:"SHA-512"}};case id_ecPublicKey:{if(!u.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(AsnConvert.parse(u.parameters,ECParameters).namedCurve){case id_secp256r1:return{name:ECDSA,namedCurve:"P-256"};case EcAlgorithm_1.SECP256K1:return{name:ECDSA,namedCurve:"K-256"};case id_secp384r1:return{name:ECDSA,namedCurve:"P-384"};case id_secp521r1:return{name:ECDSA,namedCurve:"P-521"};case idBrainpoolP160r1:return{name:ECDSA,namedCurve:brainpoolP160r1};case idBrainpoolP160t1:return{name:ECDSA,namedCurve:brainpoolP160t1};case idBrainpoolP192r1:return{name:ECDSA,namedCurve:brainpoolP192r1};case idBrainpoolP192t1:return{name:ECDSA,namedCurve:brainpoolP192t1};case idBrainpoolP224r1:return{name:ECDSA,namedCurve:brainpoolP224r1};case idBrainpoolP224t1:return{name:ECDSA,namedCurve:brainpoolP224t1};case idBrainpoolP256r1:return{name:ECDSA,namedCurve:brainpoolP256r1};case idBrainpoolP256t1:return{name:ECDSA,namedCurve:brainpoolP256t1};case idBrainpoolP320r1:return{name:ECDSA,namedCurve:brainpoolP320r1};case idBrainpoolP320t1:return{name:ECDSA,namedCurve:brainpoolP320t1};case idBrainpoolP384r1:return{name:ECDSA,namedCurve:brainpoolP384r1};case idBrainpoolP384t1:return{name:ECDSA,namedCurve:brainpoolP384t1};case idBrainpoolP512r1:return{name:ECDSA,namedCurve:brainpoolP512r1};case idBrainpoolP512t1:return{name:ECDSA,namedCurve:brainpoolP512t1}}}}return null}};EcAlgorithm.SECP256K1="1.3.132.0.10";EcAlgorithm=EcAlgorithm_1=__decorate([injectable()],EcAlgorithm);instance.registerSingleton(diAlgorithm,EcAlgorithm);const NAME=Symbol("name"),VALUE=Symbol("value");class TextObject{constructor(u,g={},v=""){this[NAME]=u,this[VALUE]=v;for(const b in g)this[b]=g[b]}}TextObject.NAME=NAME;TextObject.VALUE=VALUE;class DefaultAlgorithmSerializer{static toTextObject(u){const g=new TextObject("Algorithm Identifier",{},OidSerializer.toString(u.algorithm));if(u.parameters)switch(u.algorithm){case id_ecPublicKey:{const v=new EcAlgorithm().toWebAlgorithm(u);v&&"namedCurve"in v?g["Named Curve"]=v.namedCurve:g.Parameters=u.parameters;break}default:g.Parameters=u.parameters}return g}}class OidSerializer{static toString(u){const g=this.items[u];return g||u}}OidSerializer.items={[id_sha1]:"sha1",[id_sha224]:"sha224",[id_sha256]:"sha256",[id_sha384]:"sha384",[id_sha512]:"sha512",[id_rsaEncryption]:"rsaEncryption",[id_sha1WithRSAEncryption]:"sha1WithRSAEncryption",[id_sha224WithRSAEncryption]:"sha224WithRSAEncryption",[id_sha256WithRSAEncryption]:"sha256WithRSAEncryption",[id_sha384WithRSAEncryption]:"sha384WithRSAEncryption",[id_sha512WithRSAEncryption]:"sha512WithRSAEncryption",[id_ecPublicKey]:"ecPublicKey",[id_ecdsaWithSHA1]:"ecdsaWithSHA1",[id_ecdsaWithSHA224]:"ecdsaWithSHA224",[id_ecdsaWithSHA256]:"ecdsaWithSHA256",[id_ecdsaWithSHA384]:"ecdsaWithSHA384",[id_ecdsaWithSHA512]:"ecdsaWithSHA512",[id_kp_serverAuth]:"TLS WWW server authentication",[id_kp_clientAuth]:"TLS WWW client authentication",[id_kp_codeSigning]:"Code Signing",[id_kp_emailProtection]:"E-mail Protection",[id_kp_timeStamping]:"Time Stamping",[id_kp_OCSPSigning]:"OCSP Signing",[id_signedData]:"Signed Data"};class TextConverter{static serialize(u){return this.serializeObj(u).join(`
`)}static pad(u=0){return"".padStart(2*u," ")}static serializeObj(u,g=0){const v=[];let b=this.pad(g++),w="";const E=u[TextObject.VALUE];E&&(w=` ${E}`),v.push(`${b}${u[TextObject.NAME]}:${w}`),b=this.pad(g);for(const S in u){if(typeof S=="symbol")continue;const A=u[S],$=S?`${S}: `:"";if(typeof A=="string"||typeof A=="number"||typeof A=="boolean")v.push(`${b}${$}${A}`);else if(A instanceof Date)v.push(`${b}${$}${A.toUTCString()}`);else if(Array.isArray(A))for(const R of A)R[TextObject.NAME]=S,v.push(...this.serializeObj(R,g));else if(A instanceof TextObject)A[TextObject.NAME]=S,v.push(...this.serializeObj(A,g));else if(BufferSourceConverter.isBufferSource(A))S?(v.push(`${b}${$}`),v.push(...this.serializeBufferSource(A,g+1))):v.push(...this.serializeBufferSource(A,g));else if("toTextObject"in A){const R=A.toTextObject();R[TextObject.NAME]=S,v.push(...this.serializeObj(R,g))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return v}static serializeBufferSource(u,g=0){const v=this.pad(g),b=BufferSourceConverter.toUint8Array(u),w=[];for(let E=0;E<b.length;){const S=[];for(let A=0;A<16&&E<b.length;A++){A===8&&S.push("");const $=b[E++].toString(16).padStart(2,"0");S.push($)}w.push(`${v}${S.join(" ")}`)}return w}static serializeAlgorithm(u){return this.algorithmSerializer.toTextObject(u)}}TextConverter.oidSerializer=OidSerializer;TextConverter.algorithmSerializer=DefaultAlgorithmSerializer;var _AsnData_rawData;class AsnData{get rawData(){return __classPrivateFieldGet(this,_AsnData_rawData,"f")||__classPrivateFieldSet(this,_AsnData_rawData,AsnConvert.serialize(this.asn),"f"),__classPrivateFieldGet(this,_AsnData_rawData,"f")}constructor(...u){_AsnData_rawData.set(this,void 0),BufferSourceConverter.isBufferSource(u[0])?(this.asn=AsnConvert.parse(u[0],u[1]),__classPrivateFieldSet(this,_AsnData_rawData,BufferSourceConverter.toArrayBuffer(u[0]),"f"),this.onInit(this.asn)):(this.asn=u[0],this.onInit(this.asn))}equal(u){return u instanceof AsnData?isEqual(u.rawData,this.rawData):!1}toString(u="text"){switch(u){case"asn":return AsnConvert.toString(this.rawData);case"text":return TextConverter.serialize(this.toTextObject());case"hex":return Convert.ToHex(this.rawData);case"base64":return Convert.ToBase64(this.rawData);case"base64url":return Convert.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){const u=this.toTextObjectEmpty();return u[""]=this.rawData,u}toTextObjectEmpty(u){return new TextObject(this.getTextName(),{},u)}}_AsnData_rawData=new WeakMap;AsnData.NAME="ASN";class Extension extends AsnData{constructor(...u){let g;BufferSourceConverter.isBufferSource(u[0])?g=BufferSourceConverter.toArrayBuffer(u[0]):g=AsnConvert.serialize(new Extension$1({extnID:u[0],critical:u[1],extnValue:new OctetString(BufferSourceConverter.toArrayBuffer(u[2]))})),super(g,Extension$1)}onInit(u){this.type=u.extnID,this.critical=u.critical,this.value=u.extnValue.buffer}toTextObject(){const u=this.toTextObjectWithoutValue();return u[""]=this.value,u}toTextObjectWithoutValue(){const u=this.toTextObjectEmpty(this.critical?"critical":void 0);return u[TextObject.NAME]===Extension.NAME&&(u[TextObject.NAME]=OidSerializer.toString(this.type)),u}}var _a$3;class CryptoProvider{static isCryptoKeyPair(u){return u&&u.privateKey&&u.publicKey}static isCryptoKey(u){return u&&u.usages&&u.type&&u.algorithm&&u.extractable!==void 0}constructor(){this.items=new Map,this[_a$3]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(CryptoProvider.DEFAULT,crypto):typeof global$1<"u"&&global$1.crypto&&global$1.crypto.subtle&&this.set(CryptoProvider.DEFAULT,global$1.crypto)}clear(){this.items.clear()}delete(u){return this.items.delete(u)}forEach(u,g){return this.items.forEach(u,g)}has(u){return this.items.has(u)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(u=CryptoProvider.DEFAULT){const g=this.items.get(u.toLowerCase());if(!g)throw new Error(`Cannot get Crypto by name '${u}'`);return g}set(u,g){if(typeof u=="string"){if(!g)throw new TypeError("Argument 'value' is required");this.items.set(u.toLowerCase(),g)}else this.items.set(CryptoProvider.DEFAULT,u);return this}}_a$3=Symbol.toStringTag;CryptoProvider.DEFAULT="default";const cryptoProvider=new CryptoProvider,OID_REGEX=/^[0-2](?:\.[1-9][0-9]*)+$/;function isOID(y){return new RegExp(OID_REGEX).test(y)}class NameIdentifier{constructor(u={}){this.items={};for(const g in u)this.register(g,u[g])}get(u){return this.items[u]||null}findId(u){return isOID(u)?u:this.get(u)}register(u,g){this.items[u]=g,this.items[g]=u}}const names=new NameIdentifier;names.register("CN","2.5.4.3");names.register("L","2.5.4.7");names.register("ST","2.5.4.8");names.register("O","2.5.4.10");names.register("OU","2.5.4.11");names.register("C","2.5.4.6");names.register("DC","0.9.2342.19200300.100.1.25");names.register("E","1.2.840.113549.1.9.1");names.register("G","2.5.4.42");names.register("I","2.5.4.43");names.register("SN","2.5.4.4");names.register("T","2.5.4.12");function replaceUnknownCharacter(y,u){return`\\${Convert.ToHex(Convert.FromUtf8String(u)).toUpperCase()}`}function escape$1(y){return y.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,replaceUnknownCharacter)}class Name{static isASCII(u){for(let g=0;g<u.length;g++)if(u.charCodeAt(g)>255)return!1;return!0}static isPrintableString(u){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(u)}constructor(u,g={}){this.extraNames=new NameIdentifier,this.asn=new Name$1;for(const v in g)if(Object.prototype.hasOwnProperty.call(g,v)){const b=g[v];this.extraNames.register(v,b)}typeof u=="string"?this.asn=this.fromString(u):u instanceof Name$1?this.asn=u:BufferSourceConverter.isBufferSource(u)?this.asn=AsnConvert.parse(u,Name$1):this.asn=this.fromJSON(u)}getField(u){const g=this.extraNames.findId(u)||names.findId(u),v=[];for(const b of this.asn)for(const w of b)w.type===g&&v.push(w.value.toString());return v}getName(u){return this.extraNames.get(u)||names.get(u)}toString(){return this.asn.map(u=>u.map(g=>{const v=this.getName(g.type)||g.type,b=g.value.anyValue?`#${Convert.ToHex(g.value.anyValue)}`:escape$1(g.value.toString());return`${v}=${b}`}).join("+")).join(", ")}toJSON(){var u;const g=[];for(const v of this.asn){const b={};for(const w of v){const E=this.getName(w.type)||w.type;(u=b[E])!==null&&u!==void 0||(b[E]=[]),b[E].push(w.value.anyValue?`#${Convert.ToHex(w.value.anyValue)}`:w.value.toString())}g.push(b)}return g}fromString(u){const g=new Name$1,v=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+"\\](?=[,+]|$))|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let b=null,w=",";for(;b=v.exec(`${u},`);){let[,E,S]=b;const A=S[S.length-1];(A===","||A==="+")&&(S=S.slice(0,S.length-1),b[3]=A);const $=b[3];E=this.getTypeOid(E);const R=this.createAttribute(E,S);w==="+"?g[g.length-1].push(R):g.push(new RelativeDistinguishedName([R])),w=$}return g}fromJSON(u){const g=new Name$1;for(const v of u){const b=new RelativeDistinguishedName;for(const w in v){const E=this.getTypeOid(w),S=v[w];for(const A of S){const $=this.createAttribute(E,A);b.push($)}}g.push(b)}return g}getTypeOid(u){if(/[\d.]+/.test(u)||(u=this.getName(u)||""),!u)throw new Error(`Cannot get OID for name type '${u}'`);return u}createAttribute(u,g){const v=new AttributeTypeAndValue({type:u});if(typeof g=="object")for(const b in g)switch(b){case"ia5String":v.value.ia5String=g[b];break;case"utf8String":v.value.utf8String=g[b];break;case"universalString":v.value.universalString=g[b];break;case"bmpString":v.value.bmpString=g[b];break;case"printableString":v.value.printableString=g[b];break}else if(g[0]==="#")v.value.anyValue=Convert.FromHex(g.slice(1));else{const b=this.processStringValue(g);u===this.getName("E")||u===this.getName("DC")?v.value.ia5String=b:Name.isPrintableString(b)?v.value.printableString=b:v.value.utf8String=b}return v}processStringValue(u){const g=/"(.*?[^\\])?"/.exec(u);return g&&(u=g[1]),u.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return AsnConvert.serialize(this.asn)}async getThumbprint(...u){var g;let v,b="SHA-1";return u.length>=1&&!(!((g=u[0])===null||g===void 0)&&g.subtle)?(b=u[0]||b,v=u[1]||cryptoProvider.get()):v=u[0]||cryptoProvider.get(),await v.subtle.digest(b,this.toArrayBuffer())}}const ERR_GN_CONSTRUCTOR="Cannot initialize GeneralName from ASN.1 data.",ERR_GN_STRING_FORMAT=`${ERR_GN_CONSTRUCTOR} Unsupported string format in use.`,ERR_GUID=`${ERR_GN_CONSTRUCTOR} Value doesn't match to GUID regular expression.`,GUID_REGEX=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,id_GUID="1.3.6.1.4.1.311.25.1",id_UPN="1.3.6.1.4.1.311.20.2.3",DNS="dns",DN="dn",EMAIL="email",IP="ip",URL$1="url",GUID="guid",UPN="upn",REGISTERED_ID="id";class GeneralName extends AsnData{constructor(...u){let g;if(u.length===2)switch(u[0]){case DN:{const v=new Name(u[1]).toArrayBuffer(),b=AsnConvert.parse(v,Name$1);g=new GeneralName$1({directoryName:b});break}case DNS:g=new GeneralName$1({dNSName:u[1]});break;case EMAIL:g=new GeneralName$1({rfc822Name:u[1]});break;case GUID:{const v=new RegExp(GUID_REGEX,"i").exec(u[1]);if(!v)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const b=v.slice(1).map((w,E)=>E<3?Convert.ToHex(new Uint8Array(Convert.FromHex(w)).reverse()):w).join("");g=new GeneralName$1({otherName:new OtherName({typeId:id_GUID,value:AsnConvert.serialize(new OctetString(Convert.FromHex(b)))})});break}case IP:g=new GeneralName$1({iPAddress:u[1]});break;case REGISTERED_ID:g=new GeneralName$1({registeredID:u[1]});break;case UPN:{g=new GeneralName$1({otherName:new OtherName({typeId:id_UPN,value:AsnConvert.serialize(AsnUtf8StringConverter.toASN(u[1]))})});break}case URL$1:g=new GeneralName$1({uniformResourceIdentifier:u[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else BufferSourceConverter.isBufferSource(u[0])?g=AsnConvert.parse(u[0],GeneralName$1):g=u[0];super(g)}onInit(u){if(u.dNSName!=null)this.type=DNS,this.value=u.dNSName;else if(u.rfc822Name!=null)this.type=EMAIL,this.value=u.rfc822Name;else if(u.iPAddress!=null)this.type=IP,this.value=u.iPAddress;else if(u.uniformResourceIdentifier!=null)this.type=URL$1,this.value=u.uniformResourceIdentifier;else if(u.registeredID!=null)this.type=REGISTERED_ID,this.value=u.registeredID;else if(u.directoryName!=null)this.type=DN,this.value=new Name(u.directoryName).toString();else if(u.otherName!=null)if(u.otherName.typeId===id_GUID){this.type=GUID;const g=AsnConvert.parse(u.otherName.value,OctetString),v=new RegExp(GUID_REGEX,"i").exec(Convert.ToHex(g));if(!v)throw new Error(ERR_GUID);this.value=v.slice(1).map((b,w)=>w<3?Convert.ToHex(new Uint8Array(Convert.FromHex(b)).reverse()):b).join("-")}else if(u.otherName.typeId===id_UPN)this.type=UPN,this.value=AsnConvert.parse(u.otherName.value,DirectoryString).toString();else throw new Error(ERR_GN_STRING_FORMAT);else throw new Error(ERR_GN_STRING_FORMAT)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let u;switch(this.type){case DN:case DNS:case GUID:case IP:case REGISTERED_ID:case UPN:case URL$1:u=this.type.toUpperCase();break;case EMAIL:u="Email";break;default:throw new Error("Unsupported GeneralName type")}let g=this.value;return this.type===REGISTERED_ID&&(g=OidSerializer.toString(g)),new TextObject(u,void 0,g)}}class GeneralNames extends AsnData{constructor(u){let g;if(u instanceof GeneralNames$1)g=u;else if(Array.isArray(u)){const v=[];for(const b of u)if(b instanceof GeneralName$1)v.push(b);else{const w=AsnConvert.parse(new GeneralName(b.type,b.value).rawData,GeneralName$1);v.push(w)}g=new GeneralNames$1(v)}else if(BufferSourceConverter.isBufferSource(u))g=AsnConvert.parse(u,GeneralNames$1);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(g)}onInit(u){const g=[];for(const v of u){let b=null;try{b=new GeneralName(v)}catch{continue}g.push(b)}this.items=g}toJSON(){return this.items.map(u=>u.toJSON())}toTextObject(){const u=super.toTextObjectEmpty();for(const g of this.items){const v=g.toTextObject();let b=u[v[TextObject.NAME]];Array.isArray(b)||(b=[],u[v[TextObject.NAME]]=b),b.push(v)}return u}}GeneralNames.NAME="GeneralNames";const rPaddingTag="-{5}",rEolChars="\\n",rNameTag=`[^${rEolChars}]+`,rBeginTag=`${rPaddingTag}BEGIN (${rNameTag}(?=${rPaddingTag}))${rPaddingTag}`,rEndTag=`${rPaddingTag}END \\1${rPaddingTag}`,rEolGroup="\\n",rHeaderKey=`[^:${rEolChars}]+`,rHeaderValue=`(?:[^${rEolChars}]+${rEolGroup}(?: +[^${rEolChars}]+${rEolGroup})*)`,rBase64Chars="[a-zA-Z0-9=+/]+",rBase64=`(?:${rBase64Chars}${rEolGroup})+`,rPem=`${rBeginTag}${rEolGroup}(?:((?:${rHeaderKey}: ${rHeaderValue})+))?${rEolGroup}?(${rBase64})${rEndTag}`;class PemConverter{static isPem(u){return typeof u=="string"&&new RegExp(rPem,"g").test(u.replace(/\r/g,""))}static decodeWithHeaders(u){u=u.replace(/\r/g,"");const g=new RegExp(rPem,"g"),v=[];let b=null;for(;b=g.exec(u);){const w=b[3].replace(new RegExp(`[${rEolChars}]+`,"g"),""),E={type:b[1],headers:[],rawData:Convert.FromBase64(w)},S=b[2];if(S){const A=S.split(new RegExp(rEolGroup,"g"));let $=null;for(const R of A){const[T,O]=R.split(/:(.*)/);if(O===void 0){if(!$)throw new Error("Cannot parse PEM string. Incorrect header value");$.value+=T.trim()}else $&&E.headers.push($),$={key:T,value:O.trim()}}$&&E.headers.push($)}v.push(E)}return v}static decode(u){return this.decodeWithHeaders(u).map(v=>v.rawData)}static decodeFirst(u){const g=this.decode(u);if(!g.length)throw new RangeError("PEM string doesn't contain any objects");return g[0]}static encode(u,g){if(Array.isArray(u)){const v=new Array;return g?u.forEach(b=>{if(!BufferSourceConverter.isBufferSource(b))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");v.push(this.encodeStruct({type:g,rawData:BufferSourceConverter.toArrayBuffer(b)}))}):u.forEach(b=>{if(!("type"in b))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");v.push(this.encodeStruct(b))}),v.join(`
`)}else{if(!g)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:g,rawData:BufferSourceConverter.toArrayBuffer(u)})}}static encodeStruct(u){var g;const v=u.type.toLocaleUpperCase(),b=[];if(b.push(`-----BEGIN ${v}-----`),!((g=u.headers)===null||g===void 0)&&g.length){for(const $ of u.headers)b.push(`${$.key}: ${$.value}`);b.push("")}const w=Convert.ToBase64(u.rawData);let E,S=0;const A=Array();for(;S<w.length&&(w.length-S<64?E=w.substring(S):(E=w.substring(S,S+64),S+=64),E.length!==0);)if(A.push(E),E.length<64)break;return b.push(...A),b.push(`-----END ${v}-----`),b.join(`
`)}}PemConverter.CertificateTag="CERTIFICATE";PemConverter.CrlTag="CRL";PemConverter.CertificateRequestTag="CERTIFICATE REQUEST";PemConverter.PublicKeyTag="PUBLIC KEY";PemConverter.PrivateKeyTag="PRIVATE KEY";class PemData extends AsnData{static isAsnEncoded(u){return BufferSourceConverter.isBufferSource(u)||typeof u=="string"}static toArrayBuffer(u){if(typeof u=="string"){if(PemConverter.isPem(u))return PemConverter.decode(u)[0];if(Convert.isHex(u))return Convert.FromHex(u);if(Convert.isBase64(u))return Convert.FromBase64(u);if(Convert.isBase64Url(u))return Convert.FromBase64Url(u);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{const g=BufferSourceConverter.toUint8Array(u);if(g.length>0&&g[0]===48)return BufferSourceConverter.toArrayBuffer(u);const v=Convert.ToBinary(u);if(PemConverter.isPem(v))return PemConverter.decode(v)[0];if(Convert.isHex(v))return Convert.FromHex(v);if(Convert.isBase64(v))return Convert.FromBase64(v);if(Convert.isBase64Url(v))return Convert.FromBase64Url(v);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}}constructor(...u){PemData.isAsnEncoded(u[0])?super(PemData.toArrayBuffer(u[0]),u[1]):super(u[0])}toString(u="pem"){switch(u){case"pem":return PemConverter.encode(this.rawData,this.tag);default:return super.toString(u)}}}class PublicKey extends PemData{static async create(u,g=cryptoProvider.get()){if(u instanceof PublicKey)return u;if(CryptoProvider.isCryptoKey(u)){if(u.type!=="public")throw new TypeError("Public key is required");const v=await g.subtle.exportKey("spki",u);return new PublicKey(v)}else{if(u.publicKey)return u.publicKey;if(BufferSourceConverter.isBufferSource(u))return new PublicKey(u);throw new TypeError("Unsupported PublicKeyType")}}constructor(u){PemData.isAsnEncoded(u)?super(u,SubjectPublicKeyInfo):super(u),this.tag=PemConverter.PublicKeyTag}async export(...u){let g,v=["verify"],b={hash:"SHA-256",...this.algorithm};u.length>1?(b=u[0]||b,v=u[1]||v,g=u[2]||cryptoProvider.get()):g=u[0]||cryptoProvider.get();let w=this.rawData;const E=AsnConvert.parse(this.rawData,SubjectPublicKeyInfo);return E.algorithm.algorithm===id_RSASSA_PSS&&(w=convertSpkiToRsaPkcs1(E,w)),g.subtle.importKey("spki",w,b,!0,v)}onInit(u){const g=instance.resolve(diAlgorithmProvider),v=this.algorithm=g.toWebAlgorithm(u.algorithm);switch(u.algorithm.algorithm){case id_rsaEncryption:{const b=AsnConvert.parse(u.subjectPublicKey,RSAPublicKey),w=BufferSourceConverter.toUint8Array(b.modulus);v.publicExponent=BufferSourceConverter.toUint8Array(b.publicExponent),v.modulusLength=(w[0]?w:w.slice(1)).byteLength<<3;break}}}async getThumbprint(...u){var g;let v,b="SHA-1";return u.length>=1&&!(!((g=u[0])===null||g===void 0)&&g.subtle)?(b=u[0]||b,v=u[1]||cryptoProvider.get()):v=u[0]||cryptoProvider.get(),await v.subtle.digest(b,this.rawData)}async getKeyIdentifier(...u){let g,v="SHA-1";u.length===1?typeof u[0]=="string"?(v=u[0],g=cryptoProvider.get()):g=u[0]:u.length===2?(v=u[0],g=u[1]):g=cryptoProvider.get();const b=AsnConvert.parse(this.rawData,SubjectPublicKeyInfo);return await g.subtle.digest(v,b.subjectPublicKey)}toTextObject(){const u=this.toTextObjectEmpty(),g=AsnConvert.parse(this.rawData,SubjectPublicKeyInfo);switch(u.Algorithm=TextConverter.serializeAlgorithm(g.algorithm),g.algorithm.algorithm){case id_ecPublicKey:u["EC Point"]=g.subjectPublicKey;break;case id_rsaEncryption:default:u["Raw Data"]=g.subjectPublicKey}return u}}function convertSpkiToRsaPkcs1(y,u){return y.algorithm=new AlgorithmIdentifier({algorithm:id_rsaEncryption,parameters:null}),u=AsnConvert.serialize(y),u}class AuthorityKeyIdentifierExtension extends Extension{static async create(u,g=!1,v=cryptoProvider.get()){if("name"in u&&"serialNumber"in u)return new AuthorityKeyIdentifierExtension(u,g);const w=await(await PublicKey.create(u,v)).getKeyIdentifier(v);return new AuthorityKeyIdentifierExtension(Convert.ToHex(w),g)}constructor(...u){if(BufferSourceConverter.isBufferSource(u[0]))super(u[0]);else if(typeof u[0]=="string"){const g=new AuthorityKeyIdentifier({keyIdentifier:new KeyIdentifier(Convert.FromHex(u[0]))});super(id_ce_authorityKeyIdentifier,u[1],AsnConvert.serialize(g))}else{const g=u[0],v=g.name instanceof GeneralNames?AsnConvert.parse(g.name.rawData,GeneralNames$1):g.name,b=new AuthorityKeyIdentifier({authorityCertIssuer:v,authorityCertSerialNumber:Convert.FromHex(g.serialNumber)});super(id_ce_authorityKeyIdentifier,u[1],AsnConvert.serialize(b))}}onInit(u){super.onInit(u);const g=AsnConvert.parse(u.extnValue,AuthorityKeyIdentifier);g.keyIdentifier&&(this.keyId=Convert.ToHex(g.keyIdentifier)),(g.authorityCertIssuer||g.authorityCertSerialNumber)&&(this.certId={name:g.authorityCertIssuer||[],serialNumber:g.authorityCertSerialNumber?Convert.ToHex(g.authorityCertSerialNumber):""})}toTextObject(){const u=this.toTextObjectWithoutValue(),g=AsnConvert.parse(this.value,AuthorityKeyIdentifier);return g.authorityCertIssuer&&(u["Authority Issuer"]=new GeneralNames(g.authorityCertIssuer).toTextObject()),g.authorityCertSerialNumber&&(u["Authority Serial Number"]=g.authorityCertSerialNumber),g.keyIdentifier&&(u[""]=g.keyIdentifier),u}}AuthorityKeyIdentifierExtension.NAME="Authority Key Identifier";class BasicConstraintsExtension extends Extension{constructor(...u){if(BufferSourceConverter.isBufferSource(u[0])){super(u[0]);const g=AsnConvert.parse(this.value,BasicConstraints);this.ca=g.cA,this.pathLength=g.pathLenConstraint}else{const g=new BasicConstraints({cA:u[0],pathLenConstraint:u[1]});super(id_ce_basicConstraints,u[2],AsnConvert.serialize(g)),this.ca=u[0],this.pathLength=u[1]}}toTextObject(){const u=this.toTextObjectWithoutValue();return this.ca&&(u.CA=this.ca),this.pathLength!==void 0&&(u["Path Length"]=this.pathLength),u}}BasicConstraintsExtension.NAME="Basic Constraints";var ExtendedKeyUsage;(function(y){y.serverAuth="1.3.6.1.5.5.7.3.1",y.clientAuth="1.3.6.1.5.5.7.3.2",y.codeSigning="1.3.6.1.5.5.7.3.3",y.emailProtection="1.3.6.1.5.5.7.3.4",y.timeStamping="1.3.6.1.5.5.7.3.8",y.ocspSigning="1.3.6.1.5.5.7.3.9"})(ExtendedKeyUsage||(ExtendedKeyUsage={}));class ExtendedKeyUsageExtension extends Extension{constructor(...u){if(BufferSourceConverter.isBufferSource(u[0])){super(u[0]);const g=AsnConvert.parse(this.value,ExtendedKeyUsage$1);this.usages=g.map(v=>v)}else{const g=new ExtendedKeyUsage$1(u[0]);super(id_ce_extKeyUsage,u[1],AsnConvert.serialize(g)),this.usages=u[0]}}toTextObject(){const u=this.toTextObjectWithoutValue();return u[""]=this.usages.map(g=>OidSerializer.toString(g)).join(", "),u}}ExtendedKeyUsageExtension.NAME="Extended Key Usages";var KeyUsageFlags;(function(y){y[y.digitalSignature=1]="digitalSignature",y[y.nonRepudiation=2]="nonRepudiation",y[y.keyEncipherment=4]="keyEncipherment",y[y.dataEncipherment=8]="dataEncipherment",y[y.keyAgreement=16]="keyAgreement",y[y.keyCertSign=32]="keyCertSign",y[y.cRLSign=64]="cRLSign",y[y.encipherOnly=128]="encipherOnly",y[y.decipherOnly=256]="decipherOnly"})(KeyUsageFlags||(KeyUsageFlags={}));class KeyUsagesExtension extends Extension{constructor(...u){if(BufferSourceConverter.isBufferSource(u[0])){super(u[0]);const g=AsnConvert.parse(this.value,KeyUsage);this.usages=g.toNumber()}else{const g=new KeyUsage(u[0]);super(id_ce_keyUsage,u[1],AsnConvert.serialize(g)),this.usages=u[0]}}toTextObject(){const u=this.toTextObjectWithoutValue(),g=AsnConvert.parse(this.value,KeyUsage);return u[""]=g.toJSON().join(", "),u}}KeyUsagesExtension.NAME="Key Usages";class SubjectKeyIdentifierExtension extends Extension{static async create(u,g=!1,v=cryptoProvider.get()){const w=await(await PublicKey.create(u,v)).getKeyIdentifier(v);return new SubjectKeyIdentifierExtension(Convert.ToHex(w),g)}constructor(...u){if(BufferSourceConverter.isBufferSource(u[0])){super(u[0]);const g=AsnConvert.parse(this.value,SubjectKeyIdentifier);this.keyId=Convert.ToHex(g)}else{const g=typeof u[0]=="string"?Convert.FromHex(u[0]):u[0],v=new SubjectKeyIdentifier(g);super(id_ce_subjectKeyIdentifier,u[1],AsnConvert.serialize(v)),this.keyId=Convert.ToHex(g)}}toTextObject(){const u=this.toTextObjectWithoutValue(),g=AsnConvert.parse(this.value,SubjectKeyIdentifier);return u[""]=g,u}}SubjectKeyIdentifierExtension.NAME="Subject Key Identifier";class SubjectAlternativeNameExtension extends Extension{constructor(...u){BufferSourceConverter.isBufferSource(u[0])?super(u[0]):super(id_ce_subjectAltName,u[1],new GeneralNames(u[0]||[]).rawData)}onInit(u){super.onInit(u);const g=AsnConvert.parse(u.extnValue,SubjectAlternativeName);this.names=new GeneralNames(g)}toTextObject(){const u=this.toTextObjectWithoutValue(),g=this.names.toTextObject();for(const v in g)u[v]=g[v];return u}}SubjectAlternativeNameExtension.NAME="Subject Alternative Name";class ExtensionFactory{static register(u,g){this.items.set(u,g)}static create(u){const g=new Extension(u),v=this.items.get(g.type);return v?new v(u):g}}ExtensionFactory.items=new Map;class CertificatePolicyExtension extends Extension{constructor(...u){var g;if(BufferSourceConverter.isBufferSource(u[0])){super(u[0]);const v=AsnConvert.parse(this.value,CertificatePolicies);this.policies=v.map(b=>b.policyIdentifier)}else{const v=u[0],b=(g=u[1])!==null&&g!==void 0?g:!1,w=new CertificatePolicies(v.map(E=>new PolicyInformation({policyIdentifier:E})));super(id_ce_certificatePolicies,b,AsnConvert.serialize(w)),this.policies=v}}toTextObject(){const u=this.toTextObjectWithoutValue();return u.Policy=this.policies.map(g=>new TextObject("",{},OidSerializer.toString(g))),u}}CertificatePolicyExtension.NAME="Certificate Policies";ExtensionFactory.register(id_ce_certificatePolicies,CertificatePolicyExtension);class CRLDistributionPointsExtension extends Extension{constructor(...u){var g;if(BufferSourceConverter.isBufferSource(u[0]))super(u[0]);else if(Array.isArray(u[0])&&typeof u[0][0]=="string"){const b=u[0].map(E=>new DistributionPoint({distributionPoint:new DistributionPointName({fullName:[new GeneralName$1({uniformResourceIdentifier:E})]})})),w=new CRLDistributionPoints(b);super(id_ce_cRLDistributionPoints,u[1],AsnConvert.serialize(w))}else{const v=new CRLDistributionPoints(u[0]);super(id_ce_cRLDistributionPoints,u[1],AsnConvert.serialize(v))}(g=this.distributionPoints)!==null&&g!==void 0||(this.distributionPoints=[])}onInit(u){super.onInit(u);const g=AsnConvert.parse(u.extnValue,CRLDistributionPoints);this.distributionPoints=g}toTextObject(){const u=this.toTextObjectWithoutValue();return u["Distribution Point"]=this.distributionPoints.map(g=>{var v;const b={};return g.distributionPoint&&(b[""]=(v=g.distributionPoint.fullName)===null||v===void 0?void 0:v.map(w=>new GeneralName(w).toString()).join(", ")),g.reasons&&(b.Reasons=g.reasons.toString()),g.cRLIssuer&&(b["CRL Issuer"]=g.cRLIssuer.map(w=>w.toString()).join(", ")),b}),u}}CRLDistributionPointsExtension.NAME="CRL Distribution Points";class AuthorityInfoAccessExtension extends Extension{constructor(...u){var g,v,b,w;if(BufferSourceConverter.isBufferSource(u[0]))super(u[0]);else if(u[0]instanceof AuthorityInfoAccessSyntax){const E=new AuthorityInfoAccessSyntax(u[0]);super(id_pe_authorityInfoAccess,u[1],AsnConvert.serialize(E))}else{const E=u[0],S=new AuthorityInfoAccessSyntax;addAccessDescriptions(S,E,id_ad_ocsp,"ocsp"),addAccessDescriptions(S,E,id_ad_caIssuers,"caIssuers"),addAccessDescriptions(S,E,id_ad_timeStamping,"timeStamping"),addAccessDescriptions(S,E,id_ad_caRepository,"caRepository"),super(id_pe_authorityInfoAccess,u[1],AsnConvert.serialize(S))}(g=this.ocsp)!==null&&g!==void 0||(this.ocsp=[]),(v=this.caIssuers)!==null&&v!==void 0||(this.caIssuers=[]),(b=this.timeStamping)!==null&&b!==void 0||(this.timeStamping=[]),(w=this.caRepository)!==null&&w!==void 0||(this.caRepository=[])}onInit(u){super.onInit(u),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],AsnConvert.parse(u.extnValue,AuthorityInfoAccessSyntax).forEach(v=>{switch(v.accessMethod){case id_ad_ocsp:this.ocsp.push(new GeneralName(v.accessLocation));break;case id_ad_caIssuers:this.caIssuers.push(new GeneralName(v.accessLocation));break;case id_ad_timeStamping:this.timeStamping.push(new GeneralName(v.accessLocation));break;case id_ad_caRepository:this.caRepository.push(new GeneralName(v.accessLocation));break}})}toTextObject(){const u=this.toTextObjectWithoutValue();return this.ocsp.length&&addUrlsToObject(u,"OCSP",this.ocsp),this.caIssuers.length&&addUrlsToObject(u,"CA Issuers",this.caIssuers),this.timeStamping.length&&addUrlsToObject(u,"Time Stamping",this.timeStamping),this.caRepository.length&&addUrlsToObject(u,"CA Repository",this.caRepository),u}}AuthorityInfoAccessExtension.NAME="Authority Info Access";function addUrlsToObject(y,u,g){if(g.length===1)y[u]=g[0].toTextObject();else{const v=new TextObject("");g.forEach((b,w)=>{const E=b.toTextObject(),S=`${E[TextObject.NAME]} ${w+1}`;let A=v[S];Array.isArray(A)||(A=[],v[S]=A),A.push(E)}),y[u]=v}}function addAccessDescriptions(y,u,g,v){const b=u[v];b&&(Array.isArray(b)?b:[b]).forEach(E=>{typeof E=="string"&&(E=new GeneralName("url",E)),y.push(new AccessDescription({accessMethod:g,accessLocation:AsnConvert.parse(E.rawData,GeneralName$1)}))})}class IssuerAlternativeNameExtension extends Extension{constructor(...u){BufferSourceConverter.isBufferSource(u[0])?super(u[0]):super(id_ce_issuerAltName,u[1],new GeneralNames(u[0]||[]).rawData)}onInit(u){super.onInit(u);const g=AsnConvert.parse(u.extnValue,GeneralNames$1);this.names=new GeneralNames(g)}toTextObject(){const u=this.toTextObjectWithoutValue(),g=this.names.toTextObject();for(const v in g)u[v]=g[v];return u}}IssuerAlternativeNameExtension.NAME="Issuer Alternative Name";class Attribute extends AsnData{constructor(...u){let g;if(BufferSourceConverter.isBufferSource(u[0]))g=BufferSourceConverter.toArrayBuffer(u[0]);else{const v=u[0],b=Array.isArray(u[1])?u[1].map(w=>BufferSourceConverter.toArrayBuffer(w)):[];g=AsnConvert.serialize(new Attribute$2({type:v,values:b}))}super(g,Attribute$2)}onInit(u){this.type=u.type,this.values=u.values}toTextObject(){const u=this.toTextObjectWithoutValue();return u.Value=this.values.map(g=>new TextObject("",{"":g})),u}toTextObjectWithoutValue(){const u=this.toTextObjectEmpty();return u[TextObject.NAME]===Attribute.NAME&&(u[TextObject.NAME]=OidSerializer.toString(this.type)),u}}Attribute.NAME="Attribute";class ChallengePasswordAttribute extends Attribute{constructor(...u){var g;if(BufferSourceConverter.isBufferSource(u[0]))super(u[0]);else{const v=new ChallengePassword({printableString:u[0]});super(id_pkcs9_at_challengePassword,[AsnConvert.serialize(v)])}(g=this.password)!==null&&g!==void 0||(this.password="")}onInit(u){if(super.onInit(u),this.values[0]){const g=AsnConvert.parse(this.values[0],ChallengePassword);this.password=g.toString()}}toTextObject(){const u=this.toTextObjectWithoutValue();return u[TextObject.VALUE]=this.password,u}}ChallengePasswordAttribute.NAME="Challenge Password";class ExtensionsAttribute extends Attribute{constructor(...u){var g;if(BufferSourceConverter.isBufferSource(u[0]))super(u[0]);else{const v=u[0],b=new Extensions;for(const w of v)b.push(AsnConvert.parse(w.rawData,Extension$1));super(id_pkcs9_at_extensionRequest,[AsnConvert.serialize(b)])}(g=this.items)!==null&&g!==void 0||(this.items=[])}onInit(u){if(super.onInit(u),this.values[0]){const g=AsnConvert.parse(this.values[0],Extensions);this.items=g.map(v=>ExtensionFactory.create(AsnConvert.serialize(v)))}}toTextObject(){const u=this.toTextObjectWithoutValue(),g=this.items.map(v=>v.toTextObject());for(const v of g)u[v[TextObject.NAME]]=v;return u}}ExtensionsAttribute.NAME="Extensions";class AttributeFactory{static register(u,g){this.items.set(u,g)}static create(u){const g=new Attribute(u),v=this.items.get(g.type);return v?new v(u):g}}AttributeFactory.items=new Map;const diAsnSignatureFormatter="crypto.signatureFormatter";class AsnDefaultSignatureFormatter{toAsnSignature(u,g){return BufferSourceConverter.toArrayBuffer(g)}toWebSignature(u,g){return BufferSourceConverter.toArrayBuffer(g)}}var RsaAlgorithm_1;let RsaAlgorithm=RsaAlgorithm_1=class{static createPssParams(u,g){const v=RsaAlgorithm_1.getHashAlgorithm(u);return v?new RsaSaPssParams({hashAlgorithm:v,maskGenAlgorithm:new AlgorithmIdentifier({algorithm:id_mgf1,parameters:AsnConvert.serialize(v)}),saltLength:g}):null}static getHashAlgorithm(u){const g=instance.resolve(diAlgorithmProvider);return typeof u=="string"?g.toAsnAlgorithm({name:u}):typeof u=="object"&&u&&"name"in u?g.toAsnAlgorithm(u):null}toAsnAlgorithm(u){switch(u.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in u){let g;if(typeof u.hash=="string")g=u.hash;else if(u.hash&&typeof u.hash=="object"&&"name"in u.hash&&typeof u.hash.name=="string")g=u.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(g.toLowerCase()){case"sha-1":return new AlgorithmIdentifier({algorithm:id_sha1WithRSAEncryption,parameters:null});case"sha-256":return new AlgorithmIdentifier({algorithm:id_sha256WithRSAEncryption,parameters:null});case"sha-384":return new AlgorithmIdentifier({algorithm:id_sha384WithRSAEncryption,parameters:null});case"sha-512":return new AlgorithmIdentifier({algorithm:id_sha512WithRSAEncryption,parameters:null})}}else return new AlgorithmIdentifier({algorithm:id_rsaEncryption,parameters:null});break;case"rsa-pss":if("hash"in u){if(!("saltLength"in u&&typeof u.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");const g=RsaAlgorithm_1.createPssParams(u.hash,u.saltLength);if(!g)throw new Error("Cannot create PSS parameters");return new AlgorithmIdentifier({algorithm:id_RSASSA_PSS,parameters:AsnConvert.serialize(g)})}else return new AlgorithmIdentifier({algorithm:id_RSASSA_PSS,parameters:null})}return null}toWebAlgorithm(u){switch(u.algorithm){case id_rsaEncryption:return{name:"RSASSA-PKCS1-v1_5"};case id_sha1WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case id_sha256WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case id_sha384WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case id_sha512WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case id_RSASSA_PSS:if(u.parameters){const g=AsnConvert.parse(u.parameters,RsaSaPssParams);return{name:"RSA-PSS",hash:instance.resolve(diAlgorithmProvider).toWebAlgorithm(g.hashAlgorithm),saltLength:g.saltLength}}else return{name:"RSA-PSS"}}return null}};RsaAlgorithm=RsaAlgorithm_1=__decorate([injectable()],RsaAlgorithm);instance.registerSingleton(diAlgorithm,RsaAlgorithm);let ShaAlgorithm=class{toAsnAlgorithm(u){switch(u.name.toLowerCase()){case"sha-1":return new AlgorithmIdentifier({algorithm:id_sha1});case"sha-256":return new AlgorithmIdentifier({algorithm:id_sha256});case"sha-384":return new AlgorithmIdentifier({algorithm:id_sha384});case"sha-512":return new AlgorithmIdentifier({algorithm:id_sha512})}return null}toWebAlgorithm(u){switch(u.algorithm){case id_sha1:return{name:"SHA-1"};case id_sha256:return{name:"SHA-256"};case id_sha384:return{name:"SHA-384"};case id_sha512:return{name:"SHA-512"}}return null}};ShaAlgorithm=__decorate([injectable()],ShaAlgorithm);instance.registerSingleton(diAlgorithm,ShaAlgorithm);class AsnEcSignatureFormatter{addPadding(u,g){const v=BufferSourceConverter.toUint8Array(g),b=new Uint8Array(u);return b.set(v,u-v.length),b.buffer}removePadding(u,g=!1){let v=BufferSourceConverter.toUint8Array(u);for(let b=0;b<v.length;b++)if(v[b]){v=v.slice(b);break}if(g&&v[0]>127){const b=new Uint8Array(v.length+1);return b.set(v,1),b.buffer}return v.buffer}toAsnSignature(u,g){if(u.name==="ECDSA"){const v=u.namedCurve,b=AsnEcSignatureFormatter.namedCurveSize.get(v)||AsnEcSignatureFormatter.defaultNamedCurveSize,w=new ECDSASigValue,E=BufferSourceConverter.toUint8Array(g);return w.r=this.removePadding(E.slice(0,b),!0),w.s=this.removePadding(E.slice(b,b+b),!0),AsnConvert.serialize(w)}return null}toWebSignature(u,g){if(u.name==="ECDSA"){const v=AsnConvert.parse(g,ECDSASigValue),b=u.namedCurve,w=AsnEcSignatureFormatter.namedCurveSize.get(b)||AsnEcSignatureFormatter.defaultNamedCurveSize,E=this.addPadding(w,this.removePadding(v.r)),S=this.addPadding(w,this.removePadding(v.s));return combine(E,S)}return null}}AsnEcSignatureFormatter.namedCurveSize=new Map;AsnEcSignatureFormatter.defaultNamedCurveSize=32;const idX25519="1.3.101.110",idX448="1.3.101.111",idEd25519="1.3.101.112",idEd448="1.3.101.113";let EdAlgorithm=class{toAsnAlgorithm(u){let g=null;switch(u.name.toLowerCase()){case"ed25519":g=idEd25519;break;case"x25519":g=idX25519;break;case"eddsa":switch(u.namedCurve.toLowerCase()){case"ed25519":g=idEd25519;break;case"ed448":g=idEd448;break}break;case"ecdh-es":switch(u.namedCurve.toLowerCase()){case"x25519":g=idX25519;break;case"x448":g=idX448;break}}return g?new AlgorithmIdentifier({algorithm:g}):null}toWebAlgorithm(u){switch(u.algorithm){case idEd25519:return{name:"Ed25519"};case idEd448:return{name:"EdDSA",namedCurve:"Ed448"};case idX25519:return{name:"X25519"};case idX448:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};EdAlgorithm=__decorate([injectable()],EdAlgorithm);instance.registerSingleton(diAlgorithm,EdAlgorithm);var _Pkcs10CertificateRequest_tbs,_Pkcs10CertificateRequest_subjectName,_Pkcs10CertificateRequest_subject,_Pkcs10CertificateRequest_signatureAlgorithm,_Pkcs10CertificateRequest_signature,_Pkcs10CertificateRequest_publicKey,_Pkcs10CertificateRequest_attributes,_Pkcs10CertificateRequest_extensions;class Pkcs10CertificateRequest extends PemData{get subjectName(){return __classPrivateFieldGet(this,_Pkcs10CertificateRequest_subjectName,"f")||__classPrivateFieldSet(this,_Pkcs10CertificateRequest_subjectName,new Name(this.asn.certificationRequestInfo.subject),"f"),__classPrivateFieldGet(this,_Pkcs10CertificateRequest_subjectName,"f")}get subject(){return __classPrivateFieldGet(this,_Pkcs10CertificateRequest_subject,"f")||__classPrivateFieldSet(this,_Pkcs10CertificateRequest_subject,this.subjectName.toString(),"f"),__classPrivateFieldGet(this,_Pkcs10CertificateRequest_subject,"f")}get signatureAlgorithm(){if(!__classPrivateFieldGet(this,_Pkcs10CertificateRequest_signatureAlgorithm,"f")){const u=instance.resolve(diAlgorithmProvider);__classPrivateFieldSet(this,_Pkcs10CertificateRequest_signatureAlgorithm,u.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return __classPrivateFieldGet(this,_Pkcs10CertificateRequest_signatureAlgorithm,"f")}get signature(){return __classPrivateFieldGet(this,_Pkcs10CertificateRequest_signature,"f")||__classPrivateFieldSet(this,_Pkcs10CertificateRequest_signature,this.asn.signature,"f"),__classPrivateFieldGet(this,_Pkcs10CertificateRequest_signature,"f")}get publicKey(){return __classPrivateFieldGet(this,_Pkcs10CertificateRequest_publicKey,"f")||__classPrivateFieldSet(this,_Pkcs10CertificateRequest_publicKey,new PublicKey(this.asn.certificationRequestInfo.subjectPKInfo),"f"),__classPrivateFieldGet(this,_Pkcs10CertificateRequest_publicKey,"f")}get attributes(){return __classPrivateFieldGet(this,_Pkcs10CertificateRequest_attributes,"f")||__classPrivateFieldSet(this,_Pkcs10CertificateRequest_attributes,this.asn.certificationRequestInfo.attributes.map(u=>AttributeFactory.create(AsnConvert.serialize(u))),"f"),__classPrivateFieldGet(this,_Pkcs10CertificateRequest_attributes,"f")}get extensions(){if(!__classPrivateFieldGet(this,_Pkcs10CertificateRequest_extensions,"f")){__classPrivateFieldSet(this,_Pkcs10CertificateRequest_extensions,[],"f");const u=this.getAttribute(id_pkcs9_at_extensionRequest);u instanceof ExtensionsAttribute&&__classPrivateFieldSet(this,_Pkcs10CertificateRequest_extensions,u.items,"f")}return __classPrivateFieldGet(this,_Pkcs10CertificateRequest_extensions,"f")}get tbs(){return __classPrivateFieldGet(this,_Pkcs10CertificateRequest_tbs,"f")||__classPrivateFieldSet(this,_Pkcs10CertificateRequest_tbs,this.asn.certificationRequestInfoRaw||AsnConvert.serialize(this.asn.certificationRequestInfo),"f"),__classPrivateFieldGet(this,_Pkcs10CertificateRequest_tbs,"f")}constructor(u){const g=PemData.isAsnEncoded(u)?[u,CertificationRequest]:[u];super(g[0],g[1]),_Pkcs10CertificateRequest_tbs.set(this,void 0),_Pkcs10CertificateRequest_subjectName.set(this,void 0),_Pkcs10CertificateRequest_subject.set(this,void 0),_Pkcs10CertificateRequest_signatureAlgorithm.set(this,void 0),_Pkcs10CertificateRequest_signature.set(this,void 0),_Pkcs10CertificateRequest_publicKey.set(this,void 0),_Pkcs10CertificateRequest_attributes.set(this,void 0),_Pkcs10CertificateRequest_extensions.set(this,void 0),this.tag=PemConverter.CertificateRequestTag}onInit(u){}getAttribute(u){for(const g of this.attributes)if(g.type===u)return g;return null}getAttributes(u){return this.attributes.filter(g=>g.type===u)}getExtension(u){for(const g of this.extensions)if(g.type===u)return g;return null}getExtensions(u){return this.extensions.filter(g=>g.type===u)}async verify(u=cryptoProvider.get()){const g={...this.publicKey.algorithm,...this.signatureAlgorithm},v=await this.publicKey.export(g,["verify"],u),b=instance.resolveAll(diAsnSignatureFormatter).reverse();let w=null;for(const S of b)if(w=S.toWebSignature(g,this.signature),w)break;if(!w)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await u.subtle.verify(this.signatureAlgorithm,v,w,this.tbs)}toTextObject(){const u=this.toTextObjectEmpty(),g=AsnConvert.parse(this.rawData,CertificationRequest),v=g.certificationRequestInfo,b=new TextObject("",{Version:`${Version$1[v.version]} (${v.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){const w=new TextObject("");for(const E of this.attributes){const S=E.toTextObject();w[S[TextObject.NAME]]=S}b.Attributes=w}return u.Data=b,u.Signature=new TextObject("",{Algorithm:TextConverter.serializeAlgorithm(g.signatureAlgorithm),"":g.signature}),u}}_Pkcs10CertificateRequest_tbs=new WeakMap,_Pkcs10CertificateRequest_subjectName=new WeakMap,_Pkcs10CertificateRequest_subject=new WeakMap,_Pkcs10CertificateRequest_signatureAlgorithm=new WeakMap,_Pkcs10CertificateRequest_signature=new WeakMap,_Pkcs10CertificateRequest_publicKey=new WeakMap,_Pkcs10CertificateRequest_attributes=new WeakMap,_Pkcs10CertificateRequest_extensions=new WeakMap;Pkcs10CertificateRequest.NAME="PKCS#10 Certificate Request";var _X509Certificate_tbs,_X509Certificate_serialNumber,_X509Certificate_subjectName,_X509Certificate_subject,_X509Certificate_issuerName,_X509Certificate_issuer,_X509Certificate_notBefore,_X509Certificate_notAfter,_X509Certificate_signatureAlgorithm,_X509Certificate_signature,_X509Certificate_extensions,_X509Certificate_publicKey;class X509Certificate extends PemData{get publicKey(){return __classPrivateFieldGet(this,_X509Certificate_publicKey,"f")||__classPrivateFieldSet(this,_X509Certificate_publicKey,new PublicKey(this.asn.tbsCertificate.subjectPublicKeyInfo),"f"),__classPrivateFieldGet(this,_X509Certificate_publicKey,"f")}get serialNumber(){if(!__classPrivateFieldGet(this,_X509Certificate_serialNumber,"f")){const u=this.asn.tbsCertificate;let g=new Uint8Array(u.serialNumber);g.length>1&&g[0]===0&&g[1]>127&&(g=g.slice(1)),__classPrivateFieldSet(this,_X509Certificate_serialNumber,Convert.ToHex(g),"f")}return __classPrivateFieldGet(this,_X509Certificate_serialNumber,"f")}get subjectName(){return __classPrivateFieldGet(this,_X509Certificate_subjectName,"f")||__classPrivateFieldSet(this,_X509Certificate_subjectName,new Name(this.asn.tbsCertificate.subject),"f"),__classPrivateFieldGet(this,_X509Certificate_subjectName,"f")}get subject(){return __classPrivateFieldGet(this,_X509Certificate_subject,"f")||__classPrivateFieldSet(this,_X509Certificate_subject,this.subjectName.toString(),"f"),__classPrivateFieldGet(this,_X509Certificate_subject,"f")}get issuerName(){return __classPrivateFieldGet(this,_X509Certificate_issuerName,"f")||__classPrivateFieldSet(this,_X509Certificate_issuerName,new Name(this.asn.tbsCertificate.issuer),"f"),__classPrivateFieldGet(this,_X509Certificate_issuerName,"f")}get issuer(){return __classPrivateFieldGet(this,_X509Certificate_issuer,"f")||__classPrivateFieldSet(this,_X509Certificate_issuer,this.issuerName.toString(),"f"),__classPrivateFieldGet(this,_X509Certificate_issuer,"f")}get notBefore(){if(!__classPrivateFieldGet(this,_X509Certificate_notBefore,"f")){const u=this.asn.tbsCertificate.validity.notBefore.utcTime||this.asn.tbsCertificate.validity.notBefore.generalTime;if(!u)throw new Error("Cannot get 'notBefore' value");__classPrivateFieldSet(this,_X509Certificate_notBefore,u,"f")}return __classPrivateFieldGet(this,_X509Certificate_notBefore,"f")}get notAfter(){if(!__classPrivateFieldGet(this,_X509Certificate_notAfter,"f")){const u=this.asn.tbsCertificate.validity.notAfter.utcTime||this.asn.tbsCertificate.validity.notAfter.generalTime;if(!u)throw new Error("Cannot get 'notAfter' value");__classPrivateFieldSet(this,_X509Certificate_notAfter,u,"f")}return __classPrivateFieldGet(this,_X509Certificate_notAfter,"f")}get signatureAlgorithm(){if(!__classPrivateFieldGet(this,_X509Certificate_signatureAlgorithm,"f")){const u=instance.resolve(diAlgorithmProvider);__classPrivateFieldSet(this,_X509Certificate_signatureAlgorithm,u.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return __classPrivateFieldGet(this,_X509Certificate_signatureAlgorithm,"f")}get signature(){return __classPrivateFieldGet(this,_X509Certificate_signature,"f")||__classPrivateFieldSet(this,_X509Certificate_signature,this.asn.signatureValue,"f"),__classPrivateFieldGet(this,_X509Certificate_signature,"f")}get extensions(){return __classPrivateFieldGet(this,_X509Certificate_extensions,"f")||(__classPrivateFieldSet(this,_X509Certificate_extensions,[],"f"),this.asn.tbsCertificate.extensions&&__classPrivateFieldSet(this,_X509Certificate_extensions,this.asn.tbsCertificate.extensions.map(u=>ExtensionFactory.create(AsnConvert.serialize(u))),"f")),__classPrivateFieldGet(this,_X509Certificate_extensions,"f")}get tbs(){return __classPrivateFieldGet(this,_X509Certificate_tbs,"f")||__classPrivateFieldSet(this,_X509Certificate_tbs,this.asn.tbsCertificateRaw||AsnConvert.serialize(this.asn.tbsCertificate),"f"),__classPrivateFieldGet(this,_X509Certificate_tbs,"f")}constructor(u){const g=PemData.isAsnEncoded(u)?[u,Certificate]:[u];super(g[0],g[1]),_X509Certificate_tbs.set(this,void 0),_X509Certificate_serialNumber.set(this,void 0),_X509Certificate_subjectName.set(this,void 0),_X509Certificate_subject.set(this,void 0),_X509Certificate_issuerName.set(this,void 0),_X509Certificate_issuer.set(this,void 0),_X509Certificate_notBefore.set(this,void 0),_X509Certificate_notAfter.set(this,void 0),_X509Certificate_signatureAlgorithm.set(this,void 0),_X509Certificate_signature.set(this,void 0),_X509Certificate_extensions.set(this,void 0),_X509Certificate_publicKey.set(this,void 0),this.tag=PemConverter.CertificateTag}onInit(u){}getExtension(u){for(const g of this.extensions)if(typeof u=="string"){if(g.type===u)return g}else if(g instanceof u)return g;return null}getExtensions(u){return this.extensions.filter(g=>typeof u=="string"?g.type===u:g instanceof u)}async verify(u={},g=cryptoProvider.get()){let v,b;const w=u.publicKey;try{if(!w)v={...this.publicKey.algorithm,...this.signatureAlgorithm},b=await this.publicKey.export(v,["verify"],g);else if("publicKey"in w)v={...w.publicKey.algorithm,...this.signatureAlgorithm},b=await w.publicKey.export(v,["verify"],g);else if(w instanceof PublicKey)v={...w.algorithm,...this.signatureAlgorithm},b=await w.export(v,["verify"],g);else if(BufferSourceConverter.isBufferSource(w)){const $=new PublicKey(w);v={...$.algorithm,...this.signatureAlgorithm},b=await $.export(v,["verify"],g)}else v={...w.algorithm,...this.signatureAlgorithm},b=w}catch{return!1}const E=instance.resolveAll(diAsnSignatureFormatter).reverse();let S=null;for(const $ of E)if(S=$.toWebSignature(v,this.signature),S)break;if(!S)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const A=await g.subtle.verify(this.signatureAlgorithm,b,S,this.tbs);if(u.signatureOnly)return A;{const R=(u.date||new Date).getTime();return A&&this.notBefore.getTime()<R&&R<this.notAfter.getTime()}}async getThumbprint(...u){let g,v="SHA-1";return u[0]&&(u[0].subtle?g=u[0]:(v=u[0]||v,g=u[1])),g??(g=cryptoProvider.get()),await g.subtle.digest(v,this.rawData)}async isSelfSigned(u=cryptoProvider.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},u)}toTextObject(){const u=this.toTextObjectEmpty(),g=AsnConvert.parse(this.rawData,Certificate),v=g.tbsCertificate,b=new TextObject("",{Version:`${Version$1[v.version]} (${v.version})`,"Serial Number":v.serialNumber,"Signature Algorithm":TextConverter.serializeAlgorithm(v.signature),Issuer:this.issuer,Validity:new TextObject("",{"Not Before":v.validity.notBefore.getTime(),"Not After":v.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(v.issuerUniqueID&&(b["Issuer Unique ID"]=v.issuerUniqueID),v.subjectUniqueID&&(b["Subject Unique ID"]=v.subjectUniqueID),this.extensions.length){const w=new TextObject("");for(const E of this.extensions){const S=E.toTextObject();w[S[TextObject.NAME]]=S}b.Extensions=w}return u.Data=b,u.Signature=new TextObject("",{Algorithm:TextConverter.serializeAlgorithm(g.signatureAlgorithm),"":g.signatureValue}),u}}_X509Certificate_tbs=new WeakMap,_X509Certificate_serialNumber=new WeakMap,_X509Certificate_subjectName=new WeakMap,_X509Certificate_subject=new WeakMap,_X509Certificate_issuerName=new WeakMap,_X509Certificate_issuer=new WeakMap,_X509Certificate_notBefore=new WeakMap,_X509Certificate_notAfter=new WeakMap,_X509Certificate_signatureAlgorithm=new WeakMap,_X509Certificate_signature=new WeakMap,_X509Certificate_extensions=new WeakMap,_X509Certificate_publicKey=new WeakMap;X509Certificate.NAME="Certificate";function generateCertificateSerialNumber(y,u=cryptoProvider.get()){const g=BufferSourceConverter.toUint8Array(Convert.FromHex(y||""));let v=g&&g.length&&g.some(w=>w>0)?new Uint8Array(g):void 0;v||(v=u.getRandomValues(new Uint8Array(16)));let b=0;for(;b<v.length-1&&v[b]===0;)b++;if(v=v.slice(b),v[0]>127){const w=new Uint8Array(v.length+1);w[0]=0,w.set(v,1),v=w}return v.buffer}class X509CertificateGenerator{static async createSelfSigned(u,g=cryptoProvider.get()){if(!u.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!u.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:u.serialNumber,subject:u.name,issuer:u.name,notBefore:u.notBefore,notAfter:u.notAfter,publicKey:u.keys.publicKey,signingKey:u.keys.privateKey,signingAlgorithm:u.signingAlgorithm,extensions:u.extensions},g)}static async create(u,g=cryptoProvider.get()){var v;let b;u.publicKey instanceof PublicKey?b=u.publicKey.rawData:"publicKey"in u.publicKey?b=u.publicKey.publicKey.rawData:BufferSourceConverter.isBufferSource(u.publicKey)?b=u.publicKey:b=await g.subtle.exportKey("spki",u.publicKey);const w=generateCertificateSerialNumber(u.serialNumber,g),E=u.notBefore||new Date,S=u.notAfter||new Date(E.getTime()+31536e6),A=new Certificate({tbsCertificate:new TBSCertificate({version:Version$1.v3,serialNumber:w,validity:new Validity({notBefore:E,notAfter:S}),extensions:new Extensions(((v=u.extensions)===null||v===void 0?void 0:v.map(q=>AsnConvert.parse(q.rawData,Extension$1)))||[]),subjectPublicKeyInfo:AsnConvert.parse(b,SubjectPublicKeyInfo)})});if(u.subject){const q=u.subject instanceof Name?u.subject:new Name(u.subject);A.tbsCertificate.subject=AsnConvert.parse(q.toArrayBuffer(),Name$1)}if(u.issuer){const q=u.issuer instanceof Name?u.issuer:new Name(u.issuer);A.tbsCertificate.issuer=AsnConvert.parse(q.toArrayBuffer(),Name$1)}const $={hash:"SHA-256"},R="signingKey"in u?{...$,...u.signingAlgorithm,...u.signingKey.algorithm}:{...$,...u.signingAlgorithm},T=instance.resolve(diAlgorithmProvider);A.tbsCertificate.signature=A.signatureAlgorithm=T.toAsnAlgorithm(R);const O=AsnConvert.serialize(A.tbsCertificate),B="signingKey"in u?await g.subtle.sign(R,u.signingKey,O):u.signature,F=instance.resolveAll(diAsnSignatureFormatter).reverse();let U=null;for(const q of F)if(U=q.toAsnSignature(R,B),U)break;if(!U)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return A.signatureValue=U,new X509Certificate(AsnConvert.serialize(A))}}var X509CrlReason;(function(y){y[y.unspecified=0]="unspecified",y[y.keyCompromise=1]="keyCompromise",y[y.cACompromise=2]="cACompromise",y[y.affiliationChanged=3]="affiliationChanged",y[y.superseded=4]="superseded",y[y.cessationOfOperation=5]="cessationOfOperation",y[y.certificateHold=6]="certificateHold",y[y.removeFromCRL=8]="removeFromCRL",y[y.privilegeWithdrawn=9]="privilegeWithdrawn",y[y.aACompromise=10]="aACompromise"})(X509CrlReason||(X509CrlReason={}));ExtensionFactory.register(id_ce_basicConstraints,BasicConstraintsExtension);ExtensionFactory.register(id_ce_extKeyUsage,ExtendedKeyUsageExtension);ExtensionFactory.register(id_ce_keyUsage,KeyUsagesExtension);ExtensionFactory.register(id_ce_subjectKeyIdentifier,SubjectKeyIdentifierExtension);ExtensionFactory.register(id_ce_authorityKeyIdentifier,AuthorityKeyIdentifierExtension);ExtensionFactory.register(id_ce_subjectAltName,SubjectAlternativeNameExtension);ExtensionFactory.register(id_ce_cRLDistributionPoints,CRLDistributionPointsExtension);ExtensionFactory.register(id_pe_authorityInfoAccess,AuthorityInfoAccessExtension);ExtensionFactory.register(id_ce_issuerAltName,IssuerAlternativeNameExtension);AttributeFactory.register(id_pkcs9_at_challengePassword,ChallengePasswordAttribute);AttributeFactory.register(id_pkcs9_at_extensionRequest,ExtensionsAttribute);instance.registerSingleton(diAsnSignatureFormatter,AsnDefaultSignatureFormatter);instance.registerSingleton(diAsnSignatureFormatter,AsnEcSignatureFormatter);AsnEcSignatureFormatter.namedCurveSize.set("P-256",32);AsnEcSignatureFormatter.namedCurveSize.set("K-256",32);AsnEcSignatureFormatter.namedCurveSize.set("P-384",48);AsnEcSignatureFormatter.namedCurveSize.set("P-521",66);class WebRTCDirectListener extends TypedEventEmitter{async listen(){throw new UnimplementedError("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}}const multibaseDecoder=Object.values(bases).map(y=>y.decoder).reduce((y,u)=>y.or(u)),fingerprintRegex=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function getFingerprintFromSdp(y){return y?.match(fingerprintRegex)?.groups?.fingerprint}function certhash(y){const g=y.getComponents().find(v=>v.code===CODE_CERTHASH)?.value;if(g===void 0||g==="")throw new InvalidParametersError$1(`Couldn't find a certhash component of multiaddr: ${y.toString()}`);return g}function decodeCerthash(y){return decode$8(multibaseDecoder.decode(y))}function ma2Fingerprint(y){const u=decodeCerthash(certhash(y)),g=toSupportedHashFunction(u.code),v=u.digest.reduce((w,E)=>w+E.toString(16).padStart(2,"0"),""),b=v.match(/.{1,2}/g);if(b==null)throw new InvalidFingerprintError(v,y.toString());return`${g} ${b.join(":").toUpperCase()}`}function fingerprint2Ma(y){const u=y.split(":").map(b=>parseInt(b,16)),g=Uint8Array.from(u),v=create$5(sha256$4.code,g);return multiaddr(`/certhash/${base64url$1.encode(v.bytes)}`)}function toSupportedHashFunction(y){switch(y){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new UnsupportedHashAlgorithmError(y)}}function serverAnswerFromMultiaddr(y,u){const{host:g,port:v,type:b}=getNetConfig(y);if(b!=="ip4"&&b!=="ip6")throw new InvalidParametersError$1(`Multiaddr ${y} was not an IPv4 or IPv6 address`);const w=ma2Fingerprint(y);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${b==="ip4"?4:6} ${g}
s=-
t=0 0
a=ice-lite
m=application ${v} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${b==="ip4"?4:6} ${g}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${u}
a=ice-pwd:${u}
a=fingerprint:${w}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${MAX_MESSAGE_SIZE}
a=candidate:1467250027 1 UDP 1467250027 ${g} ${v} typ host
a=end-of-candidates
`}}function clientOfferFromMultiAddr(y,u){const{host:g,port:v,type:b}=getNetConfig(y);if(b!=="ip4"&&b!=="ip6")throw new InvalidParametersError$1(`Multiaddr ${y} was not an IPv4 or IPv6 address`);return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${b==="ip4"?4:6} ${g}
s=-
c=IN IP${b==="ip4"?4:6} ${g}
t=0 0
a=ice-options:ice2,trickle
m=application ${v} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${u}
a=ice-pwd:${u}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${MAX_MESSAGE_SIZE}
a=candidate:1467250027 1 UDP 1467250027 ${g} ${v} typ host
a=end-of-candidates
`}}function munge(y,u){if(y.sdp===void 0)throw new InvalidParametersError$1("Can't munge a missing SDP");const g=y.sdp.includes(`\r
`)?`\r
`:`
`;try{y.sdp=y.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+u+g).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+u+g)}catch{}return y}const PREFIX=fromString$1("libp2p-webrtc-noise:");function generateNoisePrologue(y,u,g){const v=y.trim().toLowerCase().replaceAll(":",""),b=fromString$1(v,"hex"),w=create$5(sha256$4.code,b),E=multibaseDecoder.decode(certhash(u)),S=PREFIX.byteLength+w.bytes.byteLength+E.byteLength;return concat$2(g==="server"?[PREFIX,E,w.bytes]:[PREFIX,w.bytes,E],S)}const CONNECTION_STATE_CHANGE_EVENT=isFirefox?"iceconnectionstatechange":"connectionstatechange";function isServer(y,u){return y.role==="server"}async function connect$1(y,u,g,v){const b=y.createDataChannel("",{negotiated:!0,id:0});try{if(v.role==="client"){v.log.trace("client creating local offer");const T=await y.createOffer();v.log.trace("client created local offer %s",T.sdp);const O=munge(T,g);v.log.trace("client setting local offer %s",O.sdp),await y.setLocalDescription(O);const B=serverAnswerFromMultiaddr(v.remoteAddr,g);v.log.trace("client setting server description %s",B.sdp),await y.setRemoteDescription(B)}else{const T=clientOfferFromMultiAddr(v.remoteAddr,g);v.log.trace("server setting client %s %s",T.type,T.sdp),await y.setRemoteDescription(T),v.log.trace("server creating local answer");const O=await y.createAnswer();v.log.trace("server created local answer");const B=munge(O,g);v.log.trace("server setting local description %s",O.sdp),await y.setLocalDescription(B)}if(b.readyState!=="open"&&(v.log.trace("%s wait for handshake channel to open, starting status %s",v.role,b.readyState),await pEvent(b,"open",v)),v.log.trace("%s handshake channel opened",v.role),isServer(v,y)){const T=y.remoteFingerprint()?.value??"";v.remoteAddr=v.remoteAddr.encapsulate(fingerprint2Ma(T))}const w=getFingerprintFromSdp(y.localDescription?.sdp);if(w==null)throw new WebRTCTransportError("Could not get fingerprint from local description sdp");v.log.trace("%s performing noise handshake",v.role);const E=generateNoisePrologue(w,v.remoteAddr,v.role),S=noise({prologueBytes:E})(v),A=createStream({channel:b,direction:"outbound",isHandshake:!0,log:v.log,...v.dataChannel??{}}),$=toMultiaddrConnection({peerConnection:y,remoteAddr:v.remoteAddr,metrics:v.events,direction:v.role==="client"?"outbound":"inbound",log:v.logger.forComponent("libp2p:webrtc-direct:connection")});if(y.addEventListener(CONNECTION_STATE_CHANGE_EVENT,()=>{switch(y.connectionState){case"failed":case"disconnected":case"closed":$.close().catch(T=>{v.log.error("error closing connection - %e",T),$.abort(T)});break;default:break}}),v.events?.increment({peer_connection:!0}),v.role==="client"){v.log.trace("%s secure inbound",v.role);const T=await S.secureInbound(A,{remotePeer:v.remotePeer,signal:v.signal,skipStreamMuxerNegotiation:!0});return v.log.trace("%s upgrade outbound",v.role),await v.upgrader.upgradeOutbound($,{skipProtection:!0,skipEncryption:!0,remotePeer:T.remotePeer,muxerFactory:u,signal:v.signal})}v.log.trace("%s secure outbound",v.role);const R=await S.secureOutbound(A,{remotePeer:v.remotePeer,signal:v.signal,skipStreamMuxerNegotiation:!0});$.remoteAddr=$.remoteAddr.encapsulate(`/p2p/${R.remotePeer}`),v.log.trace("%s upgrade inbound",v.role),await v.upgrader.upgradeInbound($,{skipProtection:!0,skipEncryption:!0,remotePeer:R.remotePeer,muxerFactory:u,signal:v.signal})}catch(w){throw b.close(),y.close(),w}}async function createDialerRTCPeerConnection(y,u,g={}){let v=g.certificate;v==null&&(v=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));const b=typeof g.rtcConfiguration=="function"?await g.rtcConfiguration():g.rtcConfiguration,w=new RTCPeerConnection({...b??{},certificates:[v]}),E=new DataChannelMuxerFactory({peerConnection:w,metrics:g.events,dataChannelOptions:g.dataChannel});return{peerConnection:w,muxerFactory:E}}async function formatAsPem(y){const u=await privateKeyToCryptoKeyPair(y),g=await crypto.subtle.exportKey("pkcs8",u.privateKey);return["-----BEGIN PRIVATE KEY-----",...toString$3(new Uint8Array(g),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}class WebRTCDirectTransport{log;metrics;components;init;certificate;privateKey;emitter;renewCertificateTask;constructor(u,g={}){if(this.log=u.logger.forComponent("libp2p:webrtc-direct"),this.components=u,this.init=g,this.emitter=new TypedEventEmitter,g.certificateLifespan!=null&&g.certificateRenewalThreshold!=null&&g.certificateRenewalThreshold>=g.certificateLifespan)throw new InvalidParametersError$1("Certificate renewal threshold must be less than certificate lifespan");u.metrics!=null&&(this.metrics={dialerEvents:u.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}[transportSymbol]=!0;[Symbol.toStringTag]="@libp2p/webrtc-direct";[serviceCapabilities]=["@libp2p/transport"];async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(u,g){this.log("dial %a",u),g.signal.throwIfAborted();let v;const b=u.getComponents().findLast(A=>A.code===CODE_P2P)?.value;b!=null&&(v=peerIdFromString$1(b));const w=genUfrag(),{peerConnection:E,muxerFactory:S}=await createDialerRTCPeerConnection("client",w,{rtcConfiguration:typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{},dataChannel:this.init.dataChannel});try{return await connect$1(E,S,w,{role:"client",log:this.log,logger:this.components.logger,events:this.metrics?.dialerEvents,signal:g.signal,remoteAddr:u,dataChannel:this.init.dataChannel,upgrader:g.upgrader,peerId:this.components.peerId,remotePeer:v,privateKey:this.components.privateKey})}catch(A){throw E.close(),A}}createListener(u){if(this.certificate==null)throw new NotStartedError;return new WebRTCDirectListener(this.components,{...this.init,...u,certificate:this.certificate,emitter:this.emitter})}listenFilter(u){return u.filter(WebRTCDirect.exactMatch)}dialFilter(u){return this.listenFilter(u)}async getCertificate(u){if(isTransportCertificate(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;const g=await this.loadOrCreatePrivateKey(),{pem:v,certhash:b}=await this.loadOrCreateCertificate(g,u);return{privateKey:await formatAsPem(g),pem:v,certhash:b}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;const u=this.init.certificateKeychainName??DEFAULT_CERTIFICATE_PRIVATE_KEY_NAME,g=this.getKeychain();try{if(g==null)throw this.log("no keychain configured - not checking for stored private key"),new NotFoundError$1;this.log.trace("checking for stored private key"),this.privateKey=await g.exportKey(u)}catch(v){if(v.name!=="NotFoundError")throw v;this.log.trace("generating private key"),this.privateKey=await generateKeyPair("ECDSA","P-256"),g!=null?(this.log.trace("storing private key"),await g.importKey(u,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(u,g){if(this.certificate!=null&&g!==!0)return this.certificate;let v;const b=new Key(this.init.certificateDatastoreKey??DEFAULT_CERTIFICATE_DATASTORE_KEY),w=await privateKeyToCryptoKeyPair(u);try{if(g===!0)throw this.log.trace("forcing renewal of TLS certificate"),new NotFoundError$1;this.log.trace("checking for stored TLS certificate"),v=await this.loadCertificate(b,w)}catch(S){if(S.name!=="NotFoundError")throw S;this.log.trace("generating new TLS certificate"),v=await this.createCertificate(b,w)}let E=v.notAfter.getTime()-(this.init.certificateRenewalThreshold??DEFAULT_CERTIFICATE_RENEWAL_THRESHOLD)-Date.now();return E<0&&(E=100),this.log("will renew TLS certificate after %d ms",E),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(S=>{this.certificate=S,this.emitter.safeDispatchEvent("certificate:renew",{detail:S})}).catch(S=>{this.log.error("could not renew certificate - %e",S)})},E),{pem:v.toString("pem"),certhash:base64url$1.encode((await sha256$4.digest(new Uint8Array(v.rawData))).bytes)}}async loadCertificate(u,g){const v=await this.components.datastore.get(u),b=new X509Certificate(v),w=b.notAfter.getTime()-(this.init.certificateRenewalThreshold??DEFAULT_CERTIFICATE_RENEWAL_THRESHOLD);if(Date.now()>w)throw this.log("stored TLS certificate has expired"),new NotFoundError$1;this.log("loaded certificate, expires in %d ms",w);const E=await b.publicKey.export(crypto),S=await crypto.subtle.exportKey("raw",E),A=await crypto.subtle.exportKey("raw",g.publicKey);if(!equals(new Uint8Array(S,0,S.byteLength),new Uint8Array(A,0,A.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new NotFoundError$1;return this.log("loaded certificate, expiry time is %o",w),b}async createCertificate(u,g){const v=new Date,b=new Date(Date.now()+(this.init.certificateLifespan??DEFAULT_CERTIFICATE_LIFESPAN));v.setMilliseconds(0),b.setMilliseconds(0);const w=await X509CertificateGenerator.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:v,notAfter:b,keys:g,extensions:[new BasicConstraintsExtension(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(u,fromString$1(w.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),w}getKeychain(){try{return this.components.keychain}catch{}}}function isTransportCertificate(y){return y==null?!1:typeof y.privateKey=="string"&&typeof y.pem=="string"&&typeof y.certhash=="string"}function webRTCDirect(y){return u=>new WebRTCDirectTransport(u,y)}function webRTC(y){return u=>new WebRTCTransport(u,y)}function createListener(){throw new Error("WebSocket Servers can not be created in the browser!")}const DEFAULT_MAX_BUFFERED_AMOUNT=1024*1024*4,DEFAULT_BUFFERED_AMOUNT_POLL_INTERVAL=10;class WebSocketMultiaddrConnection extends AbstractMultiaddrConnection{websocket;maxBufferedAmount;checkBufferedAmountTask;constructor(u){super(u),this.websocket=u.websocket,this.maxBufferedAmount=u.maxBufferedAmount??DEFAULT_MAX_BUFFERED_AMOUNT,this.checkBufferedAmountTask=repeatingTask(this.checkBufferedAmount.bind(this),u.bufferedAmountPollInterval??DEFAULT_BUFFERED_AMOUNT_POLL_INTERVAL),this.websocket.addEventListener("close",g=>{if(this.log('closed - code %d, reason "%s", wasClean %s',g.code,g.reason,g.wasClean),this.checkBufferedAmountTask.stop(),!g.wasClean){this.onRemoteReset();return}this.onTransportClosed()},{once:!0}),this.websocket.addEventListener("message",g=>{try{let v;if(typeof g.data=="string")v=fromString$1(g.data);else if(g.data instanceof ArrayBuffer)v=new Uint8Array(g.data,0,g.data.byteLength);else{this.abort(new Error("Incorrect binary type"));return}this.onData(v)}catch(v){this.log.error("error receiving data - %e",v)}})}sendData(u){for(const v of u)this.websocket.send(v);const g=this.websocket.bufferedAmount<this.maxBufferedAmount;return g||this.checkBufferedAmountTask.start(),{sentBytes:u.byteLength,canSendMore:g}}sendReset(){this.websocket.close(1006)}async sendClose(u){this.websocket.close(),u?.signal?.throwIfAborted()}sendPause(){}sendResume(){}checkBufferedAmount(){this.log("buffered amount now %d",this.websocket.bufferedAmount),this.websocket.bufferedAmount===0&&(this.checkBufferedAmountTask.stop(),this.safeDispatchEvent("drain"))}}function webSocketToMaConn(y){return new WebSocketMultiaddrConnection(y)}class WebSockets{log;init;logger;metrics;components;constructor(u,g={}){this.log=u.logger.forComponent("libp2p:websockets"),this.logger=u.logger,this.components=u,this.init=g,u.metrics!=null&&(this.metrics={dialerEvents:u.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}[transportSymbol]=!0;[Symbol.toStringTag]="@libp2p/websockets";[serviceCapabilities]=["@libp2p/transport"];async dial(u,g){this.log("dialing %s",u),g=g??{};const v=webSocketToMaConn({websocket:await this._connect(u,g),remoteAddr:u,metrics:this.metrics?.dialerEvents,direction:"outbound",log:this.components.logger.forComponent("libp2p:websockets:connection"),maxBufferedAmount:this.init.maxBufferedAmount,bufferedAmountPollInterval:this.init.bufferedAmountPollInterval});this.log("new outbound connection %s",v.remoteAddr);const b=await g.upgrader.upgradeOutbound(v,g);return this.log("outbound connection %s upgraded",v.remoteAddr),b}async _connect(u,g){g?.signal?.throwIfAborted();const v=multiaddrToUri(u);this.log("create websocket connection to %s",v);const b=new WebSocket(v);b.binaryType="arraybuffer";try{g.onProgress?.(new CustomProgressEvent("websockets:open-connection")),await pEvent(b,"open",g)}catch(w){if(g.signal?.aborted)throw this.metrics?.dialerEvents.increment({abort:!0}),new ConnectionFailedError(`Could not connect to ${v}`);this.metrics?.dialerEvents.increment({error:!0});try{b.close()}catch{}throw w}return this.log("connected %s",u),this.metrics?.dialerEvents.increment({connect:!0}),b}createListener(u){return createListener({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...u})}listenFilter(u){return u.filter(g=>WebSockets$1.exactMatch(g)||WebSocketsSecure.exactMatch(g))}dialFilter(u){return this.listenFilter(u)}}function webSockets(y={}){return u=>new WebSockets(u,y)}function ipnsSelector(y,u){const g=u.map((v,b)=>({record:unmarshalIPNSRecord(v),index:b}));return g.sort((v,b)=>{const w=v.record.sequence,E=b.record.sequence;if(w>E)return-1;if(w<E)return 1;if(v.record.validityType===IpnsEntry.ValidityType.EOL&&b.record.validityType===IpnsEntry.ValidityType.EOL){const S=NanoDate.fromString(v.record.validity).toDate(),A=NanoDate.fromString(b.record.validity).toDate();if(S.getTime()>A.getTime())return-1;if(S.getTime()<A.getTime())return 1}return 0}),g[0].index}const version$1="6.0.11",name="helia",bootstrapConfig={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function libp2pDefaults(y={}){const u=`${name}/${version$1} ${userAgent$1()}`;return{privateKey:y.privateKey,dns:y.dns,nodeInfo:{userAgent:u},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[circuitRelayTransport(),webRTC(),webRTCDirect(),webSockets()],connectionEncrypters:[noise()],streamMuxers:[yamux(),mplex()],peerDiscovery:[bootstrap(bootstrapConfig)],services:{autoNAT:autoNAT(),dcutr:dcutr(),delegatedRouting:()=>createDelegatedRoutingV1HttpApiClient("https://delegated-ipfs.dev",delegatedHTTPRoutingDefaults()),dht:kadDHT({clientMode:!0,validators:{ipns:ipnsValidator},selectors:{ipns:ipnsSelector}}),identify:identify(),identifyPush:identifyPush(),keychain:keychain(y.keychain),ping:ping(),http:http()}}}async function createLibp2p(y){const u=y.libp2p??{};u.privateKey==null&&y.datastore!=null&&(u.privateKey=await loadOrCreateSelfKey(y.datastore,y.keychain));const g=libp2pDefaults(u);return g.datastore=g.datastore??y.datastore,await createLibp2p$1({...g,...u,start:!1})}async function heliaDefaults(y={}){const u=y.datastore??new MemoryDatastore,g=y.blockstore??new MemoryBlockstore;let v;return isLibp2p(y.libp2p)?v=y.libp2p:v=await createLibp2p({...y,libp2p:{dns:y.dns,...y.libp2p,start:void 0},datastore:u}),{...y,libp2p:v,datastore:u,blockstore:g,blockBrokers:y.blockBrokers??[trustlessGateway(),bitswap()],routers:y.routers??[libp2pRouting(v),httpGatewayRouting()],metrics:v.metrics}}async function createHelia(y={}){const u=await heliaDefaults(y),g=new Helia(u);return u.start!==!1&&await g.start(),g}let JSON$1=class{components;constructor(u){this.components=u}async add(u,g={}){const v=encode$d(u),b=await(g.hasher??sha256$4).digest(v),w=CID.createV1(code$6,b);return await this.components.blockstore.put(w,v,g),w}async get(u,g={}){if(u.code!==code$6)throw new InvalidCodecError("The passed CID had an incorrect codec, it may correspond to a non-JSON block");const v=await toBuffer(this.components.blockstore.get(u,g));return decode$c(v)}};function json(y){return new JSON$1(y)}function isBytes$1(y){return y instanceof Uint8Array||ArrayBuffer.isView(y)&&y.constructor.name==="Uint8Array"}function anumber(y){if(!Number.isSafeInteger(y)||y<0)throw new Error("positive integer expected, got "+y)}function abytes$1(y,...u){if(!isBytes$1(y))throw new Error("Uint8Array expected");if(u.length>0&&!u.includes(y.length))throw new Error("Uint8Array expected of length "+u+", got length="+y.length)}function ahash(y){if(typeof y!="function"||typeof y.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");anumber(y.outputLen),anumber(y.blockLen)}function aexists(y,u=!0){if(y.destroyed)throw new Error("Hash instance has been destroyed");if(u&&y.finished)throw new Error("Hash#digest() has already been called")}function aoutput(y,u){abytes$1(y);const g=u.outputLen;if(y.length<g)throw new Error("digestInto() expects output buffer of length at least "+g)}function clean(...y){for(let u=0;u<y.length;u++)y[u].fill(0)}function createView(y){return new DataView(y.buffer,y.byteOffset,y.byteLength)}function rotr(y,u){return y<<32-u|y>>>u}function utf8ToBytes(y){if(typeof y!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(y))}function toBytes(y){return typeof y=="string"&&(y=utf8ToBytes(y)),abytes$1(y),y}class Hash{}function createHasher(y){const u=v=>y().update(toBytes(v)).digest(),g=y();return u.outputLen=g.outputLen,u.blockLen=g.blockLen,u.create=()=>y(),u}class HMAC extends Hash{constructor(u,g){super(),this.finished=!1,this.destroyed=!1,ahash(u);const v=toBytes(g);if(this.iHash=u.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const b=this.blockLen,w=new Uint8Array(b);w.set(v.length>b?u.create().update(v).digest():v);for(let E=0;E<w.length;E++)w[E]^=54;this.iHash.update(w),this.oHash=u.create();for(let E=0;E<w.length;E++)w[E]^=106;this.oHash.update(w),clean(w)}update(u){return aexists(this),this.iHash.update(u),this}digestInto(u){aexists(this),abytes$1(u,this.outputLen),this.finished=!0,this.iHash.digestInto(u),this.oHash.update(u),this.oHash.digestInto(u),this.destroy()}digest(){const u=new Uint8Array(this.oHash.outputLen);return this.digestInto(u),u}_cloneInto(u){u||(u=Object.create(Object.getPrototypeOf(this),{}));const{oHash:g,iHash:v,finished:b,destroyed:w,blockLen:E,outputLen:S}=this;return u=u,u.finished=b,u.destroyed=w,u.blockLen=E,u.outputLen=S,u.oHash=g._cloneInto(u.oHash),u.iHash=v._cloneInto(u.iHash),u}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=(y,u,g)=>new HMAC(y,u).update(g).digest();hmac.create=(y,u)=>new HMAC(y,u);function extract(y,u,g){return ahash(y),g===void 0&&(g=new Uint8Array(y.outputLen)),hmac(y,toBytes(g),toBytes(u))}const HKDF_COUNTER=Uint8Array.from([0]),EMPTY_BUFFER=Uint8Array.of();function expand(y,u,g,v=32){ahash(y),anumber(v);const b=y.outputLen;if(v>255*b)throw new Error("Length should be <= 255*HashLen");const w=Math.ceil(v/b);g===void 0&&(g=EMPTY_BUFFER);const E=new Uint8Array(w*b),S=hmac.create(y,u),A=S._cloneInto(),$=new Uint8Array(S.outputLen);for(let R=0;R<w;R++)HKDF_COUNTER[0]=R+1,A.update(R===0?EMPTY_BUFFER:$).update(g).update(HKDF_COUNTER).digestInto($),E.set($,b*R),S._cloneInto(A);return S.destroy(),A.destroy(),clean($,HKDF_COUNTER),E.slice(0,v)}const hkdf=(y,u,g,v,b)=>expand(y,extract(y,u,g),v,b);function setBigUint64(y,u,g,v){if(typeof y.setBigUint64=="function")return y.setBigUint64(u,g,v);const b=BigInt(32),w=BigInt(4294967295),E=Number(g>>b&w),S=Number(g&w),A=v?4:0,$=v?0:4;y.setUint32(u+A,E,v),y.setUint32(u+$,S,v)}function Chi(y,u,g){return y&u^~y&g}function Maj(y,u,g){return y&u^y&g^u&g}class HashMD extends Hash{constructor(u,g,v,b){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=u,this.outputLen=g,this.padOffset=v,this.isLE=b,this.buffer=new Uint8Array(u),this.view=createView(this.buffer)}update(u){aexists(this),u=toBytes(u),abytes$1(u);const{view:g,buffer:v,blockLen:b}=this,w=u.length;for(let E=0;E<w;){const S=Math.min(b-this.pos,w-E);if(S===b){const A=createView(u);for(;b<=w-E;E+=b)this.process(A,E);continue}v.set(u.subarray(E,E+S),this.pos),this.pos+=S,E+=S,this.pos===b&&(this.process(g,0),this.pos=0)}return this.length+=u.length,this.roundClean(),this}digestInto(u){aexists(this),aoutput(u,this),this.finished=!0;const{buffer:g,view:v,blockLen:b,isLE:w}=this;let{pos:E}=this;g[E++]=128,clean(this.buffer.subarray(E)),this.padOffset>b-E&&(this.process(v,0),E=0);for(let T=E;T<b;T++)g[T]=0;setBigUint64(v,b-8,BigInt(this.length*8),w),this.process(v,0);const S=createView(u),A=this.outputLen;if(A%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const $=A/4,R=this.get();if($>R.length)throw new Error("_sha2: outputLen bigger than state");for(let T=0;T<$;T++)S.setUint32(4*T,R[T],w)}digest(){const{buffer:u,outputLen:g}=this;this.digestInto(u);const v=u.slice(0,g);return this.destroy(),v}_cloneInto(u){u||(u=new this.constructor),u.set(...this.get());const{blockLen:g,buffer:v,length:b,finished:w,destroyed:E,pos:S}=this;return u.destroyed=E,u.finished=w,u.length=b,u.pos=S,b%g&&u.buffer.set(v),u}clone(){return this._cloneInto()}}const SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),U32_MASK64=BigInt(2**32-1),_32n=BigInt(32);function fromBig(y,u=!1){return u?{h:Number(y&U32_MASK64),l:Number(y>>_32n&U32_MASK64)}:{h:Number(y>>_32n&U32_MASK64)|0,l:Number(y&U32_MASK64)|0}}function split(y,u=!1){const g=y.length;let v=new Uint32Array(g),b=new Uint32Array(g);for(let w=0;w<g;w++){const{h:E,l:S}=fromBig(y[w],u);[v[w],b[w]]=[E,S]}return[v,b]}const shrSH=(y,u,g)=>y>>>g,shrSL=(y,u,g)=>y<<32-g|u>>>g,rotrSH=(y,u,g)=>y>>>g|u<<32-g,rotrSL=(y,u,g)=>y<<32-g|u>>>g,rotrBH=(y,u,g)=>y<<64-g|u>>>g-32,rotrBL=(y,u,g)=>y>>>g-32|u<<64-g;function add(y,u,g,v){const b=(u>>>0)+(v>>>0);return{h:y+g+(b/2**32|0)|0,l:b|0}}const add3L=(y,u,g)=>(y>>>0)+(u>>>0)+(g>>>0),add3H=(y,u,g,v)=>u+g+v+(y/2**32|0)|0,add4L=(y,u,g,v)=>(y>>>0)+(u>>>0)+(g>>>0)+(v>>>0),add4H=(y,u,g,v,b)=>u+g+v+b+(y/2**32|0)|0,add5L=(y,u,g,v,b)=>(y>>>0)+(u>>>0)+(g>>>0)+(v>>>0)+(b>>>0),add5H=(y,u,g,v,b,w)=>u+g+v+b+w+(y/2**32|0)|0,SHA256_K=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(u=32){super(64,u,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:u,B:g,C:v,D:b,E:w,F:E,G:S,H:A}=this;return[u,g,v,b,w,E,S,A]}set(u,g,v,b,w,E,S,A){this.A=u|0,this.B=g|0,this.C=v|0,this.D=b|0,this.E=w|0,this.F=E|0,this.G=S|0,this.H=A|0}process(u,g){for(let T=0;T<16;T++,g+=4)SHA256_W[T]=u.getUint32(g,!1);for(let T=16;T<64;T++){const O=SHA256_W[T-15],B=SHA256_W[T-2],F=rotr(O,7)^rotr(O,18)^O>>>3,U=rotr(B,17)^rotr(B,19)^B>>>10;SHA256_W[T]=U+SHA256_W[T-7]+F+SHA256_W[T-16]|0}let{A:v,B:b,C:w,D:E,E:S,F:A,G:$,H:R}=this;for(let T=0;T<64;T++){const O=rotr(S,6)^rotr(S,11)^rotr(S,25),B=R+O+Chi(S,A,$)+SHA256_K[T]+SHA256_W[T]|0,U=(rotr(v,2)^rotr(v,13)^rotr(v,22))+Maj(v,b,w)|0;R=$,$=A,A=S,S=E+B|0,E=w,w=b,b=v,v=B+U|0}v=v+this.A|0,b=b+this.B|0,w=w+this.C|0,E=E+this.D|0,S=S+this.E|0,A=A+this.F|0,$=$+this.G|0,R=R+this.H|0,this.set(v,b,w,E,S,A,$,R)}roundClean(){clean(SHA256_W)}destroy(){this.set(0,0,0,0,0,0,0,0),clean(this.buffer)}}const K512=split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(y=>BigInt(y))),SHA512_Kh=K512[0],SHA512_Kl=K512[1],SHA512_W_H=new Uint32Array(80),SHA512_W_L=new Uint32Array(80);class SHA512 extends HashMD{constructor(u=64){super(128,u,16,!1),this.Ah=SHA512_IV[0]|0,this.Al=SHA512_IV[1]|0,this.Bh=SHA512_IV[2]|0,this.Bl=SHA512_IV[3]|0,this.Ch=SHA512_IV[4]|0,this.Cl=SHA512_IV[5]|0,this.Dh=SHA512_IV[6]|0,this.Dl=SHA512_IV[7]|0,this.Eh=SHA512_IV[8]|0,this.El=SHA512_IV[9]|0,this.Fh=SHA512_IV[10]|0,this.Fl=SHA512_IV[11]|0,this.Gh=SHA512_IV[12]|0,this.Gl=SHA512_IV[13]|0,this.Hh=SHA512_IV[14]|0,this.Hl=SHA512_IV[15]|0}get(){const{Ah:u,Al:g,Bh:v,Bl:b,Ch:w,Cl:E,Dh:S,Dl:A,Eh:$,El:R,Fh:T,Fl:O,Gh:B,Gl:F,Hh:U,Hl:q}=this;return[u,g,v,b,w,E,S,A,$,R,T,O,B,F,U,q]}set(u,g,v,b,w,E,S,A,$,R,T,O,B,F,U,q){this.Ah=u|0,this.Al=g|0,this.Bh=v|0,this.Bl=b|0,this.Ch=w|0,this.Cl=E|0,this.Dh=S|0,this.Dl=A|0,this.Eh=$|0,this.El=R|0,this.Fh=T|0,this.Fl=O|0,this.Gh=B|0,this.Gl=F|0,this.Hh=U|0,this.Hl=q|0}process(u,g){for(let oe=0;oe<16;oe++,g+=4)SHA512_W_H[oe]=u.getUint32(g),SHA512_W_L[oe]=u.getUint32(g+=4);for(let oe=16;oe<80;oe++){const le=SHA512_W_H[oe-15]|0,de=SHA512_W_L[oe-15]|0,fe=rotrSH(le,de,1)^rotrSH(le,de,8)^shrSH(le,de,7),ye=rotrSL(le,de,1)^rotrSL(le,de,8)^shrSL(le,de,7),we=SHA512_W_H[oe-2]|0,pe=SHA512_W_L[oe-2]|0,ve=rotrSH(we,pe,19)^rotrBH(we,pe,61)^shrSH(we,pe,6),he=rotrSL(we,pe,19)^rotrBL(we,pe,61)^shrSL(we,pe,6),ae=add4L(ye,he,SHA512_W_L[oe-7],SHA512_W_L[oe-16]),Q=add4H(ae,fe,ve,SHA512_W_H[oe-7],SHA512_W_H[oe-16]);SHA512_W_H[oe]=Q|0,SHA512_W_L[oe]=ae|0}let{Ah:v,Al:b,Bh:w,Bl:E,Ch:S,Cl:A,Dh:$,Dl:R,Eh:T,El:O,Fh:B,Fl:F,Gh:U,Gl:q,Hh:J,Hl:ie}=this;for(let oe=0;oe<80;oe++){const le=rotrSH(T,O,14)^rotrSH(T,O,18)^rotrBH(T,O,41),de=rotrSL(T,O,14)^rotrSL(T,O,18)^rotrBL(T,O,41),fe=T&B^~T&U,ye=O&F^~O&q,we=add5L(ie,de,ye,SHA512_Kl[oe],SHA512_W_L[oe]),pe=add5H(we,J,le,fe,SHA512_Kh[oe],SHA512_W_H[oe]),ve=we|0,he=rotrSH(v,b,28)^rotrBH(v,b,34)^rotrBH(v,b,39),ae=rotrSL(v,b,28)^rotrBL(v,b,34)^rotrBL(v,b,39),Q=v&w^v&S^w&S,j=b&E^b&A^E&A;J=U|0,ie=q|0,U=B|0,q=F|0,B=T|0,F=O|0,{h:T,l:O}=add($|0,R|0,pe|0,ve|0),$=S|0,R=A|0,S=w|0,A=E|0,w=v|0,E=b|0;const z=add3L(ve,ae,j);v=add3H(z,pe,he,Q),b=z|0}({h:v,l:b}=add(this.Ah|0,this.Al|0,v|0,b|0)),{h:w,l:E}=add(this.Bh|0,this.Bl|0,w|0,E|0),{h:S,l:A}=add(this.Ch|0,this.Cl|0,S|0,A|0),{h:$,l:R}=add(this.Dh|0,this.Dl|0,$|0,R|0),{h:T,l:O}=add(this.Eh|0,this.El|0,T|0,O|0),{h:B,l:F}=add(this.Fh|0,this.Fl|0,B|0,F|0),{h:U,l:q}=add(this.Gh|0,this.Gl|0,U|0,q|0),{h:J,l:ie}=add(this.Hh|0,this.Hl|0,J|0,ie|0),this.set(v,b,w,E,S,A,$,R,T,O,B,F,U,q,J,ie)}roundClean(){clean(SHA512_W_H,SHA512_W_L)}destroy(){clean(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const sha256$1=createHasher(()=>new SHA256),sha512$1=createHasher(()=>new SHA512),sha256=sha256$1,sha512=sha512$1;const ed25519_CURVE={p:0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffedn,n:0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3edn,h:8n,a:0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffecn,d:0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3n,Gx:0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51an,Gy:0x6666666666666666666666666666666666666666666666666666666666666658n},{p:P,n:N,Gx,Gy,a:_a$2,d:_d,h}=ed25519_CURVE,L=32,L2=64,captureTrace=(...y)=>{"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(...y)},err=(y="")=>{const u=new Error(y);throw captureTrace(u,err),u},isBig=y=>typeof y=="bigint",isStr=y=>typeof y=="string",isBytes=y=>y instanceof Uint8Array||ArrayBuffer.isView(y)&&y.constructor.name==="Uint8Array",abytes=(y,u,g="")=>{const v=isBytes(y),b=y?.length,w=u!==void 0;if(!v||w&&b!==u){const E=g&&`"${g}" `,S=w?` of length ${u}`:"",A=v?`length=${b}`:`type=${typeof y}`;err(E+"expected Uint8Array"+S+", got "+A)}return y},u8n=y=>new Uint8Array(y),u8fr=y=>Uint8Array.from(y),padh=(y,u)=>y.toString(16).padStart(u,"0"),bytesToHex$1=y=>Array.from(abytes(y)).map(u=>padh(u,2)).join(""),C={_0:48,_9:57,A:65,F:70,a:97,f:102},_ch=y=>{if(y>=C._0&&y<=C._9)return y-C._0;if(y>=C.A&&y<=C.F)return y-(C.A-10);if(y>=C.a&&y<=C.f)return y-(C.a-10)},hexToBytes$1=y=>{const u="hex invalid";if(!isStr(y))return err(u);const g=y.length,v=g/2;if(g%2)return err(u);const b=u8n(v);for(let w=0,E=0;w<v;w++,E+=2){const S=_ch(y.charCodeAt(E)),A=_ch(y.charCodeAt(E+1));if(S===void 0||A===void 0)return err(u);b[w]=S*16+A}return b},cr=()=>globalThis?.crypto,subtle=()=>cr()?.subtle??err("crypto.subtle must be defined, consider polyfill"),concatBytes=(...y)=>{const u=u8n(y.reduce((v,b)=>v+abytes(b).length,0));let g=0;return y.forEach(v=>{u.set(v,g),g+=v.length}),u},big=BigInt,assertRange=(y,u,g,v="bad number: out of range")=>isBig(y)&&u<=y&&y<g?y:err(v),M=(y,u=P)=>{const g=y%u;return g>=0n?g:u+g},modN=y=>M(y,N),invert=(y,u)=>{(y===0n||u<=0n)&&err("no inverse n="+y+" mod="+u);let g=M(y,u),v=u,b=0n,w=1n;for(;g!==0n;){const E=v/g,S=v%g,A=b-w*E;v=g,g=S,b=w,w=A}return v===1n?M(b,u):err("no inverse")},callHash=y=>{const u=hashes[y];return typeof u!="function"&&err("hashes."+y+" not set"),u},apoint=y=>y instanceof Point?y:err("Point expected"),B256=2n**256n;class Point{static BASE;static ZERO;X;Y;Z;T;constructor(u,g,v,b){const w=B256;this.X=assertRange(u,0n,w),this.Y=assertRange(g,0n,w),this.Z=assertRange(v,1n,w),this.T=assertRange(b,0n,w),Object.freeze(this)}static CURVE(){return ed25519_CURVE}static fromAffine(u){return new Point(u.x,u.y,1n,M(u.x*u.y))}static fromBytes(u,g=!1){const v=_d,b=u8fr(abytes(u,L)),w=u[31];b[31]=w&-129;const E=bytesToNumLE(b);assertRange(E,0n,g?B256:P);const A=M(E*E),$=M(A-1n),R=M(v*A+1n);let{isValid:T,value:O}=uvRatio($,R);T||err("bad point: y not sqrt");const B=(O&1n)===1n,F=(w&128)!==0;return!g&&O===0n&&F&&err("bad point: x==0, isLastByteOdd"),F!==B&&(O=M(-O)),new Point(O,E,1n,M(O*E))}static fromHex(u,g){return Point.fromBytes(hexToBytes$1(u),g)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}assertValidity(){const u=_a$2,g=_d,v=this;if(v.is0())return err("bad point: ZERO");const{X:b,Y:w,Z:E,T:S}=v,A=M(b*b),$=M(w*w),R=M(E*E),T=M(R*R),O=M(A*u),B=M(R*M(O+$)),F=M(T+M(g*M(A*$)));if(B!==F)return err("bad point: equation left != right (1)");const U=M(b*w),q=M(E*S);return U!==q?err("bad point: equation left != right (2)"):this}equals(u){const{X:g,Y:v,Z:b}=this,{X:w,Y:E,Z:S}=apoint(u),A=M(g*S),$=M(w*b),R=M(v*S),T=M(E*b);return A===$&&R===T}is0(){return this.equals(I)}negate(){return new Point(M(-this.X),this.Y,this.Z,M(-this.T))}double(){const{X:u,Y:g,Z:v}=this,b=_a$2,w=M(u*u),E=M(g*g),S=M(2n*M(v*v)),A=M(b*w),$=u+g,R=M(M($*$)-w-E),T=A+E,O=T-S,B=A-E,F=M(R*O),U=M(T*B),q=M(R*B),J=M(O*T);return new Point(F,U,J,q)}add(u){const{X:g,Y:v,Z:b,T:w}=this,{X:E,Y:S,Z:A,T:$}=apoint(u),R=_a$2,T=_d,O=M(g*E),B=M(v*S),F=M(w*T*$),U=M(b*A),q=M((g+v)*(E+S)-O-B),J=M(U-F),ie=M(U+F),oe=M(B-R*O),le=M(q*J),de=M(ie*oe),fe=M(q*oe),ye=M(J*ie);return new Point(le,de,ye,fe)}subtract(u){return this.add(apoint(u).negate())}multiply(u,g=!0){if(!g&&(u===0n||this.is0()))return I;if(assertRange(u,1n,N),u===1n)return this;if(this.equals(G))return wNAF(u).p;let v=I,b=G;for(let w=this;u>0n;w=w.double(),u>>=1n)u&1n?v=v.add(w):g&&(b=b.add(w));return v}multiplyUnsafe(u){return this.multiply(u,!1)}toAffine(){const{X:u,Y:g,Z:v}=this;if(this.equals(I))return{x:0n,y:1n};const b=invert(v,P);M(v*b)!==1n&&err("invalid inverse");const w=M(u*b),E=M(g*b);return{x:w,y:E}}toBytes(){const{x:u,y:g}=this.assertValidity().toAffine(),v=numTo32bLE(g);return v[31]|=u&1n?128:0,v}toHex(){return bytesToHex$1(this.toBytes())}clearCofactor(){return this.multiply(big(h),!1)}isSmallOrder(){return this.clearCofactor().is0()}isTorsionFree(){let u=this.multiply(N/2n,!1).double();return N%2n&&(u=u.add(this)),u.is0()}}const G=new Point(Gx,Gy,1n,M(Gx*Gy)),I=new Point(0n,1n,1n,0n);Point.BASE=G;Point.ZERO=I;const numTo32bLE=y=>hexToBytes$1(padh(assertRange(y,0n,B256),L2)).reverse(),bytesToNumLE=y=>big("0x"+bytesToHex$1(u8fr(abytes(y)).reverse())),pow2=(y,u)=>{let g=y;for(;u-- >0n;)g*=g,g%=P;return g},pow_2_252_3=y=>{const g=y*y%P*y%P,v=pow2(g,2n)*g%P,b=pow2(v,1n)*y%P,w=pow2(b,5n)*b%P,E=pow2(w,10n)*w%P,S=pow2(E,20n)*E%P,A=pow2(S,40n)*S%P,$=pow2(A,80n)*A%P,R=pow2($,80n)*A%P,T=pow2(R,10n)*w%P;return{pow_p_5_8:pow2(T,2n)*y%P,b2:g}},RM1=0x2b8324804fc1df0b2b4d00993dfbd7a72f431806ad2fe478c4ee1b274a0ea0b0n,uvRatio=(y,u)=>{const g=M(u*u*u),v=M(g*g*u),b=pow_2_252_3(y*v).pow_p_5_8;let w=M(y*g*b);const E=M(u*w*w),S=w,A=M(w*RM1),$=E===y,R=E===M(-y),T=E===M(-y*RM1);return $&&(w=S),(R||T)&&(w=A),(M(w)&1n)===1n&&(w=M(-w)),{isValid:$||R,value:w}},modL_LE=y=>modN(bytesToNumLE(y)),sha512s=(...y)=>callHash("sha512")(concatBytes(...y)),hash2extK=y=>{const u=y.slice(0,L);u[0]&=248,u[31]&=127,u[31]|=64;const g=y.slice(L,L2),v=modL_LE(u),b=G.multiply(v),w=b.toBytes();return{head:u,prefix:g,scalar:v,point:b,pointBytes:w}},getExtendedPublicKey=y=>hash2extK(sha512s(abytes(y,L))),getPublicKey=y=>getExtendedPublicKey(y).pointBytes,hashes={sha512Async:async y=>{const u=subtle(),g=concatBytes(y);return u8n(await u.digest("SHA-512",g.buffer))},sha512:void 0},W=8,scalarBits=256,pwindows=Math.ceil(scalarBits/W)+1,pwindowSize=2**(W-1),precompute=()=>{const y=[];let u=G,g=u;for(let v=0;v<pwindows;v++){g=u,y.push(g);for(let b=1;b<pwindowSize;b++)g=g.add(u),y.push(g);u=g.double()}return y};let Gpows;const ctneg=(y,u)=>{const g=u.negate();return y?g:u},wNAF=y=>{const u=Gpows||(Gpows=precompute());let g=I,v=G;const b=2**W,w=b,E=big(b-1),S=big(W);for(let A=0;A<pwindows;A++){let $=Number(y&E);y>>=S,$>pwindowSize&&($-=w,y+=1n);const R=A*pwindowSize,T=R,O=R+Math.abs($)-1,B=A%2!==0,F=$<0;$===0?v=v.add(ctneg(B,u[T])):g=g.add(ctneg(F,u[O]))}return y!==0n&&err("invalid wnaf"),{p:g,f:v}},ARCHIVED_PREFIX="_archived_",FORKED_PREFIX="_forked_";function isArchivedKey(y){return y.startsWith(ARCHIVED_PREFIX)}function isForkedKey(y){return y.startsWith(FORKED_PREFIX)}function isActiveTokenKey(y){return y.startsWith("_")&&!y.startsWith(ARCHIVED_PREFIX)&&!y.startsWith(FORKED_PREFIX)&&y!=="_meta"&&y!=="_nametag"&&y!=="_tombstones"&&y!=="_outbox"&&y!=="_integrity"}function isTokenKey(y){return isActiveTokenKey(y)}function tokenIdFromKey(y){return y.startsWith("_")?y.substring(1):y}function keyFromTokenId(y){return`_${y}`}function archivedKeyFromTokenId(y){return`${ARCHIVED_PREFIX}${y}`}function tokenIdFromArchivedKey(y){return y.startsWith(ARCHIVED_PREFIX)?y.substring(ARCHIVED_PREFIX.length):y}function forkedKeyFromTokenIdAndState(y,u){return`${FORKED_PREFIX}${y}_${u}`}function parseForkedKey(y){if(!y.startsWith(FORKED_PREFIX))return null;const u=y.substring(FORKED_PREFIX.length),g=u.indexOf("_");return g===-1||g<64?null:{tokenId:u.substring(0,g),stateHash:u.substring(g+1)}}function $constructor(y,u,g){function v(S,A){if(S._zod||Object.defineProperty(S,"_zod",{value:{def:A,constr:E,traits:new Set},enumerable:!1}),S._zod.traits.has(y))return;S._zod.traits.add(y),u(S,A);const $=E.prototype,R=Object.keys($);for(let T=0;T<R.length;T++){const O=R[T];O in S||(S[O]=$[O].bind(S))}}const b=g?.Parent??Object;class w extends b{}Object.defineProperty(w,"name",{value:y});function E(S){var A;const $=g?.Parent?new w:this;v($,S),(A=$._zod).deferred??(A.deferred=[]);for(const R of $._zod.deferred)R();return $}return Object.defineProperty(E,"init",{value:v}),Object.defineProperty(E,Symbol.hasInstance,{value:S=>g?.Parent&&S instanceof g.Parent?!0:S?._zod?.traits?.has(y)}),Object.defineProperty(E,"name",{value:y}),E}class $ZodAsyncError extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class $ZodEncodeError extends Error{constructor(u){super(`Encountered unidirectional transform during encode: ${u}`),this.name="ZodEncodeError"}}const globalConfig={};function config(y){return globalConfig}function getEnumValues(y){const u=Object.values(y).filter(v=>typeof v=="number");return Object.entries(y).filter(([v,b])=>u.indexOf(+v)===-1).map(([v,b])=>b)}function jsonStringifyReplacer(y,u){return typeof u=="bigint"?u.toString():u}function cached(y){return{get value(){{const u=y();return Object.defineProperty(this,"value",{value:u}),u}}}}function nullish(y){return y==null}function cleanRegex(y){const u=y.startsWith("^")?1:0,g=y.endsWith("$")?y.length-1:y.length;return y.slice(u,g)}function floatSafeRemainder(y,u){const g=(y.toString().split(".")[1]||"").length,v=u.toString();let b=(v.split(".")[1]||"").length;if(b===0&&/\d?e-\d?/.test(v)){const A=v.match(/\d?e-(\d?)/);A?.[1]&&(b=Number.parseInt(A[1]))}const w=g>b?g:b,E=Number.parseInt(y.toFixed(w).replace(".","")),S=Number.parseInt(u.toFixed(w).replace(".",""));return E%S/10**w}const EVALUATING=Symbol("evaluating");function defineLazy(y,u,g){let v;Object.defineProperty(y,u,{get(){if(v!==EVALUATING)return v===void 0&&(v=EVALUATING,v=g()),v},set(b){Object.defineProperty(y,u,{value:b})},configurable:!0})}function assignProp(y,u,g){Object.defineProperty(y,u,{value:g,writable:!0,enumerable:!0,configurable:!0})}function mergeDefs(...y){const u={};for(const g of y){const v=Object.getOwnPropertyDescriptors(g);Object.assign(u,v)}return Object.defineProperties({},u)}function esc(y){return JSON.stringify(y)}function slugify(y){return y.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const captureStackTrace="captureStackTrace"in Error?Error.captureStackTrace:(...y)=>{};function isObject$1(y){return typeof y=="object"&&y!==null&&!Array.isArray(y)}const allowsEval=cached(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const y=Function;return new y(""),!0}catch{return!1}});function isPlainObject(y){if(isObject$1(y)===!1)return!1;const u=y.constructor;if(u===void 0||typeof u!="function")return!0;const g=u.prototype;return!(isObject$1(g)===!1||Object.prototype.hasOwnProperty.call(g,"isPrototypeOf")===!1)}function shallowClone(y){return isPlainObject(y)?{...y}:Array.isArray(y)?[...y]:y}const propertyKeyTypes=new Set(["string","number","symbol"]);function escapeRegex(y){return y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function clone(y,u,g){const v=new y._zod.constr(u??y._zod.def);return(!u||g?.parent)&&(v._zod.parent=y),v}function normalizeParams(y){const u=y;if(!u)return{};if(typeof u=="string")return{error:()=>u};if(u?.message!==void 0){if(u?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");u.error=u.message}return delete u.message,typeof u.error=="string"?{...u,error:()=>u.error}:u}function optionalKeys(y){return Object.keys(y).filter(u=>y[u]._zod.optin==="optional"&&y[u]._zod.optout==="optional")}const NUMBER_FORMAT_RANGES={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function pick(y,u){const g=y._zod.def,v=mergeDefs(y._zod.def,{get shape(){const b={};for(const w in u){if(!(w in g.shape))throw new Error(`Unrecognized key: "${w}"`);u[w]&&(b[w]=g.shape[w])}return assignProp(this,"shape",b),b},checks:[]});return clone(y,v)}function omit(y,u){const g=y._zod.def,v=mergeDefs(y._zod.def,{get shape(){const b={...y._zod.def.shape};for(const w in u){if(!(w in g.shape))throw new Error(`Unrecognized key: "${w}"`);u[w]&&delete b[w]}return assignProp(this,"shape",b),b},checks:[]});return clone(y,v)}function extend(y,u){if(!isPlainObject(u))throw new Error("Invalid input to extend: expected a plain object");const g=y._zod.def.checks;if(g&&g.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const b=mergeDefs(y._zod.def,{get shape(){const w={...y._zod.def.shape,...u};return assignProp(this,"shape",w),w},checks:[]});return clone(y,b)}function safeExtend(y,u){if(!isPlainObject(u))throw new Error("Invalid input to safeExtend: expected a plain object");const g={...y._zod.def,get shape(){const v={...y._zod.def.shape,...u};return assignProp(this,"shape",v),v},checks:y._zod.def.checks};return clone(y,g)}function merge(y,u){const g=mergeDefs(y._zod.def,{get shape(){const v={...y._zod.def.shape,...u._zod.def.shape};return assignProp(this,"shape",v),v},get catchall(){return u._zod.def.catchall},checks:[]});return clone(y,g)}function partial(y,u,g){const v=mergeDefs(u._zod.def,{get shape(){const b=u._zod.def.shape,w={...b};if(g)for(const E in g){if(!(E in b))throw new Error(`Unrecognized key: "${E}"`);g[E]&&(w[E]=y?new y({type:"optional",innerType:b[E]}):b[E])}else for(const E in b)w[E]=y?new y({type:"optional",innerType:b[E]}):b[E];return assignProp(this,"shape",w),w},checks:[]});return clone(u,v)}function required(y,u,g){const v=mergeDefs(u._zod.def,{get shape(){const b=u._zod.def.shape,w={...b};if(g)for(const E in g){if(!(E in w))throw new Error(`Unrecognized key: "${E}"`);g[E]&&(w[E]=new y({type:"nonoptional",innerType:b[E]}))}else for(const E in b)w[E]=new y({type:"nonoptional",innerType:b[E]});return assignProp(this,"shape",w),w},checks:[]});return clone(u,v)}function aborted(y,u=0){if(y.aborted===!0)return!0;for(let g=u;g<y.issues.length;g++)if(y.issues[g]?.continue!==!0)return!0;return!1}function prefixIssues(y,u){return u.map(g=>{var v;return(v=g).path??(v.path=[]),g.path.unshift(y),g})}function unwrapMessage(y){return typeof y=="string"?y:y?.message}function finalizeIssue(y,u,g){const v={...y,path:y.path??[]};if(!y.message){const b=unwrapMessage(y.inst?._zod.def?.error?.(y))??unwrapMessage(u?.error?.(y))??unwrapMessage(g.customError?.(y))??unwrapMessage(g.localeError?.(y))??"Invalid input";v.message=b}return delete v.inst,delete v.continue,u?.reportInput||delete v.input,v}function getLengthableOrigin(y){return Array.isArray(y)?"array":typeof y=="string"?"string":"unknown"}function issue(...y){const[u,g,v]=y;return typeof u=="string"?{message:u,code:"custom",input:g,inst:v}:{...u}}const initializer$1=(y,u)=>{y.name="$ZodError",Object.defineProperty(y,"_zod",{value:y._zod,enumerable:!1}),Object.defineProperty(y,"issues",{value:u,enumerable:!1}),y.message=JSON.stringify(u,jsonStringifyReplacer,2),Object.defineProperty(y,"toString",{value:()=>y.message,enumerable:!1})},$ZodError=$constructor("$ZodError",initializer$1),$ZodRealError=$constructor("$ZodError",initializer$1,{Parent:Error});function flattenError(y,u=g=>g.message){const g={},v=[];for(const b of y.issues)b.path.length>0?(g[b.path[0]]=g[b.path[0]]||[],g[b.path[0]].push(u(b))):v.push(u(b));return{formErrors:v,fieldErrors:g}}function formatError(y,u=g=>g.message){const g={_errors:[]},v=b=>{for(const w of b.issues)if(w.code==="invalid_union"&&w.errors.length)w.errors.map(E=>v({issues:E}));else if(w.code==="invalid_key")v({issues:w.issues});else if(w.code==="invalid_element")v({issues:w.issues});else if(w.path.length===0)g._errors.push(u(w));else{let E=g,S=0;for(;S<w.path.length;){const A=w.path[S];S===w.path.length-1?(E[A]=E[A]||{_errors:[]},E[A]._errors.push(u(w))):E[A]=E[A]||{_errors:[]},E=E[A],S++}}};return v(y),g}const _parse=y=>(u,g,v,b)=>{const w=v?Object.assign(v,{async:!1}):{async:!1},E=u._zod.run({value:g,issues:[]},w);if(E instanceof Promise)throw new $ZodAsyncError;if(E.issues.length){const S=new(b?.Err??y)(E.issues.map(A=>finalizeIssue(A,w,config())));throw captureStackTrace(S,b?.callee),S}return E.value},_parseAsync=y=>async(u,g,v,b)=>{const w=v?Object.assign(v,{async:!0}):{async:!0};let E=u._zod.run({value:g,issues:[]},w);if(E instanceof Promise&&(E=await E),E.issues.length){const S=new(b?.Err??y)(E.issues.map(A=>finalizeIssue(A,w,config())));throw captureStackTrace(S,b?.callee),S}return E.value},_safeParse=y=>(u,g,v)=>{const b=v?{...v,async:!1}:{async:!1},w=u._zod.run({value:g,issues:[]},b);if(w instanceof Promise)throw new $ZodAsyncError;return w.issues.length?{success:!1,error:new(y??$ZodError)(w.issues.map(E=>finalizeIssue(E,b,config())))}:{success:!0,data:w.value}},safeParse$1=_safeParse($ZodRealError),_safeParseAsync=y=>async(u,g,v)=>{const b=v?Object.assign(v,{async:!0}):{async:!0};let w=u._zod.run({value:g,issues:[]},b);return w instanceof Promise&&(w=await w),w.issues.length?{success:!1,error:new y(w.issues.map(E=>finalizeIssue(E,b,config())))}:{success:!0,data:w.value}},safeParseAsync$1=_safeParseAsync($ZodRealError),_encode=y=>(u,g,v)=>{const b=v?Object.assign(v,{direction:"backward"}):{direction:"backward"};return _parse(y)(u,g,b)},_decode=y=>(u,g,v)=>_parse(y)(u,g,v),_encodeAsync=y=>async(u,g,v)=>{const b=v?Object.assign(v,{direction:"backward"}):{direction:"backward"};return _parseAsync(y)(u,g,b)},_decodeAsync=y=>async(u,g,v)=>_parseAsync(y)(u,g,v),_safeEncode=y=>(u,g,v)=>{const b=v?Object.assign(v,{direction:"backward"}):{direction:"backward"};return _safeParse(y)(u,g,b)},_safeDecode=y=>(u,g,v)=>_safeParse(y)(u,g,v),_safeEncodeAsync=y=>async(u,g,v)=>{const b=v?Object.assign(v,{direction:"backward"}):{direction:"backward"};return _safeParseAsync(y)(u,g,b)},_safeDecodeAsync=y=>async(u,g,v)=>_safeParseAsync(y)(u,g,v),cuid=/^[cC][^\s-]{8,}$/,cuid2=/^[0-9a-z]+$/,ulid=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,xid=/^[0-9a-vA-V]{20}$/,ksuid=/^[A-Za-z0-9]{27}$/,nanoid$3=/^[a-zA-Z0-9_-]{21}$/,duration$1=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,guid=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,uuid=y=>y?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${y}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,email=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,_emoji$1="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function emoji(){return new RegExp(_emoji$1,"u")}const ipv4=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,cidrv4=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,cidrv6=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,base64url=/^[A-Za-z0-9_-]*$/,e164=/^\+(?:[0-9]){6,14}[0-9]$/,dateSource="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",date$1=new RegExp(`^${dateSource}$`);function timeSource(y){const u="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof y.precision=="number"?y.precision===-1?`${u}`:y.precision===0?`${u}:[0-5]\\d`:`${u}:[0-5]\\d\\.\\d{${y.precision}}`:`${u}(?::[0-5]\\d(?:\\.\\d+)?)?`}function time$1(y){return new RegExp(`^${timeSource(y)}$`)}function datetime$1(y){const u=timeSource({precision:y.precision}),g=["Z"];y.local&&g.push(""),y.offset&&g.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const v=`${u}(?:${g.join("|")})`;return new RegExp(`^${dateSource}T(?:${v})$`)}const string$1=y=>{const u=y?`[\\s\\S]{${y?.minimum??0},${y?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${u}$`)},integer=/^-?\d+$/,number$1=/^-?\d+(?:\.\d+)?/,lowercase=/^[^A-Z]*$/,uppercase=/^[^a-z]*$/,$ZodCheck=$constructor("$ZodCheck",(y,u)=>{var g;y._zod??(y._zod={}),y._zod.def=u,(g=y._zod).onattach??(g.onattach=[])}),numericOriginMap={number:"number",bigint:"bigint",object:"date"},$ZodCheckLessThan=$constructor("$ZodCheckLessThan",(y,u)=>{$ZodCheck.init(y,u);const g=numericOriginMap[typeof u.value];y._zod.onattach.push(v=>{const b=v._zod.bag,w=(u.inclusive?b.maximum:b.exclusiveMaximum)??Number.POSITIVE_INFINITY;u.value<w&&(u.inclusive?b.maximum=u.value:b.exclusiveMaximum=u.value)}),y._zod.check=v=>{(u.inclusive?v.value<=u.value:v.value<u.value)||v.issues.push({origin:g,code:"too_big",maximum:u.value,input:v.value,inclusive:u.inclusive,inst:y,continue:!u.abort})}}),$ZodCheckGreaterThan=$constructor("$ZodCheckGreaterThan",(y,u)=>{$ZodCheck.init(y,u);const g=numericOriginMap[typeof u.value];y._zod.onattach.push(v=>{const b=v._zod.bag,w=(u.inclusive?b.minimum:b.exclusiveMinimum)??Number.NEGATIVE_INFINITY;u.value>w&&(u.inclusive?b.minimum=u.value:b.exclusiveMinimum=u.value)}),y._zod.check=v=>{(u.inclusive?v.value>=u.value:v.value>u.value)||v.issues.push({origin:g,code:"too_small",minimum:u.value,input:v.value,inclusive:u.inclusive,inst:y,continue:!u.abort})}}),$ZodCheckMultipleOf=$constructor("$ZodCheckMultipleOf",(y,u)=>{$ZodCheck.init(y,u),y._zod.onattach.push(g=>{var v;(v=g._zod.bag).multipleOf??(v.multipleOf=u.value)}),y._zod.check=g=>{if(typeof g.value!=typeof u.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof g.value=="bigint"?g.value%u.value===BigInt(0):floatSafeRemainder(g.value,u.value)===0)||g.issues.push({origin:typeof g.value,code:"not_multiple_of",divisor:u.value,input:g.value,inst:y,continue:!u.abort})}}),$ZodCheckNumberFormat=$constructor("$ZodCheckNumberFormat",(y,u)=>{$ZodCheck.init(y,u),u.format=u.format||"float64";const g=u.format?.includes("int"),v=g?"int":"number",[b,w]=NUMBER_FORMAT_RANGES[u.format];y._zod.onattach.push(E=>{const S=E._zod.bag;S.format=u.format,S.minimum=b,S.maximum=w,g&&(S.pattern=integer)}),y._zod.check=E=>{const S=E.value;if(g){if(!Number.isInteger(S)){E.issues.push({expected:v,format:u.format,code:"invalid_type",continue:!1,input:S,inst:y});return}if(!Number.isSafeInteger(S)){S>0?E.issues.push({input:S,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:y,origin:v,continue:!u.abort}):E.issues.push({input:S,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:y,origin:v,continue:!u.abort});return}}S<b&&E.issues.push({origin:"number",input:S,code:"too_small",minimum:b,inclusive:!0,inst:y,continue:!u.abort}),S>w&&E.issues.push({origin:"number",input:S,code:"too_big",maximum:w,inst:y})}}),$ZodCheckMaxLength=$constructor("$ZodCheckMaxLength",(y,u)=>{var g;$ZodCheck.init(y,u),(g=y._zod.def).when??(g.when=v=>{const b=v.value;return!nullish(b)&&b.length!==void 0}),y._zod.onattach.push(v=>{const b=v._zod.bag.maximum??Number.POSITIVE_INFINITY;u.maximum<b&&(v._zod.bag.maximum=u.maximum)}),y._zod.check=v=>{const b=v.value;if(b.length<=u.maximum)return;const E=getLengthableOrigin(b);v.issues.push({origin:E,code:"too_big",maximum:u.maximum,inclusive:!0,input:b,inst:y,continue:!u.abort})}}),$ZodCheckMinLength=$constructor("$ZodCheckMinLength",(y,u)=>{var g;$ZodCheck.init(y,u),(g=y._zod.def).when??(g.when=v=>{const b=v.value;return!nullish(b)&&b.length!==void 0}),y._zod.onattach.push(v=>{const b=v._zod.bag.minimum??Number.NEGATIVE_INFINITY;u.minimum>b&&(v._zod.bag.minimum=u.minimum)}),y._zod.check=v=>{const b=v.value;if(b.length>=u.minimum)return;const E=getLengthableOrigin(b);v.issues.push({origin:E,code:"too_small",minimum:u.minimum,inclusive:!0,input:b,inst:y,continue:!u.abort})}}),$ZodCheckLengthEquals=$constructor("$ZodCheckLengthEquals",(y,u)=>{var g;$ZodCheck.init(y,u),(g=y._zod.def).when??(g.when=v=>{const b=v.value;return!nullish(b)&&b.length!==void 0}),y._zod.onattach.push(v=>{const b=v._zod.bag;b.minimum=u.length,b.maximum=u.length,b.length=u.length}),y._zod.check=v=>{const b=v.value,w=b.length;if(w===u.length)return;const E=getLengthableOrigin(b),S=w>u.length;v.issues.push({origin:E,...S?{code:"too_big",maximum:u.length}:{code:"too_small",minimum:u.length},inclusive:!0,exact:!0,input:v.value,inst:y,continue:!u.abort})}}),$ZodCheckStringFormat=$constructor("$ZodCheckStringFormat",(y,u)=>{var g,v;$ZodCheck.init(y,u),y._zod.onattach.push(b=>{const w=b._zod.bag;w.format=u.format,u.pattern&&(w.patterns??(w.patterns=new Set),w.patterns.add(u.pattern))}),u.pattern?(g=y._zod).check??(g.check=b=>{u.pattern.lastIndex=0,!u.pattern.test(b.value)&&b.issues.push({origin:"string",code:"invalid_format",format:u.format,input:b.value,...u.pattern?{pattern:u.pattern.toString()}:{},inst:y,continue:!u.abort})}):(v=y._zod).check??(v.check=()=>{})}),$ZodCheckRegex=$constructor("$ZodCheckRegex",(y,u)=>{$ZodCheckStringFormat.init(y,u),y._zod.check=g=>{u.pattern.lastIndex=0,!u.pattern.test(g.value)&&g.issues.push({origin:"string",code:"invalid_format",format:"regex",input:g.value,pattern:u.pattern.toString(),inst:y,continue:!u.abort})}}),$ZodCheckLowerCase=$constructor("$ZodCheckLowerCase",(y,u)=>{u.pattern??(u.pattern=lowercase),$ZodCheckStringFormat.init(y,u)}),$ZodCheckUpperCase=$constructor("$ZodCheckUpperCase",(y,u)=>{u.pattern??(u.pattern=uppercase),$ZodCheckStringFormat.init(y,u)}),$ZodCheckIncludes=$constructor("$ZodCheckIncludes",(y,u)=>{$ZodCheck.init(y,u);const g=escapeRegex(u.includes),v=new RegExp(typeof u.position=="number"?`^.{${u.position}}${g}`:g);u.pattern=v,y._zod.onattach.push(b=>{const w=b._zod.bag;w.patterns??(w.patterns=new Set),w.patterns.add(v)}),y._zod.check=b=>{b.value.includes(u.includes,u.position)||b.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:u.includes,input:b.value,inst:y,continue:!u.abort})}}),$ZodCheckStartsWith=$constructor("$ZodCheckStartsWith",(y,u)=>{$ZodCheck.init(y,u);const g=new RegExp(`^${escapeRegex(u.prefix)}.*`);u.pattern??(u.pattern=g),y._zod.onattach.push(v=>{const b=v._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(g)}),y._zod.check=v=>{v.value.startsWith(u.prefix)||v.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:u.prefix,input:v.value,inst:y,continue:!u.abort})}}),$ZodCheckEndsWith=$constructor("$ZodCheckEndsWith",(y,u)=>{$ZodCheck.init(y,u);const g=new RegExp(`.*${escapeRegex(u.suffix)}$`);u.pattern??(u.pattern=g),y._zod.onattach.push(v=>{const b=v._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(g)}),y._zod.check=v=>{v.value.endsWith(u.suffix)||v.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:u.suffix,input:v.value,inst:y,continue:!u.abort})}}),$ZodCheckOverwrite=$constructor("$ZodCheckOverwrite",(y,u)=>{$ZodCheck.init(y,u),y._zod.check=g=>{g.value=u.tx(g.value)}});class Doc{constructor(u=[]){this.content=[],this.indent=0,this&&(this.args=u)}indented(u){this.indent+=1,u(this),this.indent-=1}write(u){if(typeof u=="function"){u(this,{execution:"sync"}),u(this,{execution:"async"});return}const v=u.split(`
`).filter(E=>E),b=Math.min(...v.map(E=>E.length-E.trimStart().length)),w=v.map(E=>E.slice(b)).map(E=>" ".repeat(this.indent*2)+E);for(const E of w)this.content.push(E)}compile(){const u=Function,g=this?.args,b=[...(this?.content??[""]).map(w=>`  ${w}`)];return new u(...g,b.join(`
`))}}const version={major:4,minor:1,patch:13},$ZodType=$constructor("$ZodType",(y,u)=>{var g;y??(y={}),y._zod.def=u,y._zod.bag=y._zod.bag||{},y._zod.version=version;const v=[...y._zod.def.checks??[]];y._zod.traits.has("$ZodCheck")&&v.unshift(y);for(const b of v)for(const w of b._zod.onattach)w(y);if(v.length===0)(g=y._zod).deferred??(g.deferred=[]),y._zod.deferred?.push(()=>{y._zod.run=y._zod.parse});else{const b=(E,S,A)=>{let $=aborted(E),R;for(const T of S){if(T._zod.def.when){if(!T._zod.def.when(E))continue}else if($)continue;const O=E.issues.length,B=T._zod.check(E);if(B instanceof Promise&&A?.async===!1)throw new $ZodAsyncError;if(R||B instanceof Promise)R=(R??Promise.resolve()).then(async()=>{await B,E.issues.length!==O&&($||($=aborted(E,O)))});else{if(E.issues.length===O)continue;$||($=aborted(E,O))}}return R?R.then(()=>E):E},w=(E,S,A)=>{if(aborted(E))return E.aborted=!0,E;const $=b(S,v,A);if($ instanceof Promise){if(A.async===!1)throw new $ZodAsyncError;return $.then(R=>y._zod.parse(R,A))}return y._zod.parse($,A)};y._zod.run=(E,S)=>{if(S.skipChecks)return y._zod.parse(E,S);if(S.direction==="backward"){const $=y._zod.parse({value:E.value,issues:[]},{...S,skipChecks:!0});return $ instanceof Promise?$.then(R=>w(R,E,S)):w($,E,S)}const A=y._zod.parse(E,S);if(A instanceof Promise){if(S.async===!1)throw new $ZodAsyncError;return A.then($=>b($,v,S))}return b(A,v,S)}}y["~standard"]={validate:b=>{try{const w=safeParse$1(y,b);return w.success?{value:w.data}:{issues:w.error?.issues}}catch{return safeParseAsync$1(y,b).then(E=>E.success?{value:E.data}:{issues:E.error?.issues})}},vendor:"zod",version:1}}),$ZodString=$constructor("$ZodString",(y,u)=>{$ZodType.init(y,u),y._zod.pattern=[...y?._zod.bag?.patterns??[]].pop()??string$1(y._zod.bag),y._zod.parse=(g,v)=>{if(u.coerce)try{g.value=String(g.value)}catch{}return typeof g.value=="string"||g.issues.push({expected:"string",code:"invalid_type",input:g.value,inst:y}),g}}),$ZodStringFormat=$constructor("$ZodStringFormat",(y,u)=>{$ZodCheckStringFormat.init(y,u),$ZodString.init(y,u)}),$ZodGUID=$constructor("$ZodGUID",(y,u)=>{u.pattern??(u.pattern=guid),$ZodStringFormat.init(y,u)}),$ZodUUID=$constructor("$ZodUUID",(y,u)=>{if(u.version){const v={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[u.version];if(v===void 0)throw new Error(`Invalid UUID version: "${u.version}"`);u.pattern??(u.pattern=uuid(v))}else u.pattern??(u.pattern=uuid());$ZodStringFormat.init(y,u)}),$ZodEmail=$constructor("$ZodEmail",(y,u)=>{u.pattern??(u.pattern=email),$ZodStringFormat.init(y,u)}),$ZodURL=$constructor("$ZodURL",(y,u)=>{$ZodStringFormat.init(y,u),y._zod.check=g=>{try{const v=g.value.trim(),b=new URL(v);u.hostname&&(u.hostname.lastIndex=0,u.hostname.test(b.hostname)||g.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:u.hostname.source,input:g.value,inst:y,continue:!u.abort})),u.protocol&&(u.protocol.lastIndex=0,u.protocol.test(b.protocol.endsWith(":")?b.protocol.slice(0,-1):b.protocol)||g.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:u.protocol.source,input:g.value,inst:y,continue:!u.abort})),u.normalize?g.value=b.href:g.value=v;return}catch{g.issues.push({code:"invalid_format",format:"url",input:g.value,inst:y,continue:!u.abort})}}}),$ZodEmoji=$constructor("$ZodEmoji",(y,u)=>{u.pattern??(u.pattern=emoji()),$ZodStringFormat.init(y,u)}),$ZodNanoID=$constructor("$ZodNanoID",(y,u)=>{u.pattern??(u.pattern=nanoid$3),$ZodStringFormat.init(y,u)}),$ZodCUID=$constructor("$ZodCUID",(y,u)=>{u.pattern??(u.pattern=cuid),$ZodStringFormat.init(y,u)}),$ZodCUID2=$constructor("$ZodCUID2",(y,u)=>{u.pattern??(u.pattern=cuid2),$ZodStringFormat.init(y,u)}),$ZodULID=$constructor("$ZodULID",(y,u)=>{u.pattern??(u.pattern=ulid),$ZodStringFormat.init(y,u)}),$ZodXID=$constructor("$ZodXID",(y,u)=>{u.pattern??(u.pattern=xid),$ZodStringFormat.init(y,u)}),$ZodKSUID=$constructor("$ZodKSUID",(y,u)=>{u.pattern??(u.pattern=ksuid),$ZodStringFormat.init(y,u)}),$ZodISODateTime=$constructor("$ZodISODateTime",(y,u)=>{u.pattern??(u.pattern=datetime$1(u)),$ZodStringFormat.init(y,u)}),$ZodISODate=$constructor("$ZodISODate",(y,u)=>{u.pattern??(u.pattern=date$1),$ZodStringFormat.init(y,u)}),$ZodISOTime=$constructor("$ZodISOTime",(y,u)=>{u.pattern??(u.pattern=time$1(u)),$ZodStringFormat.init(y,u)}),$ZodISODuration=$constructor("$ZodISODuration",(y,u)=>{u.pattern??(u.pattern=duration$1),$ZodStringFormat.init(y,u)}),$ZodIPv4=$constructor("$ZodIPv4",(y,u)=>{u.pattern??(u.pattern=ipv4),$ZodStringFormat.init(y,u),y._zod.bag.format="ipv4"}),$ZodIPv6=$constructor("$ZodIPv6",(y,u)=>{u.pattern??(u.pattern=ipv6),$ZodStringFormat.init(y,u),y._zod.bag.format="ipv6",y._zod.check=g=>{try{new URL(`http://[${g.value}]`)}catch{g.issues.push({code:"invalid_format",format:"ipv6",input:g.value,inst:y,continue:!u.abort})}}}),$ZodCIDRv4=$constructor("$ZodCIDRv4",(y,u)=>{u.pattern??(u.pattern=cidrv4),$ZodStringFormat.init(y,u)}),$ZodCIDRv6=$constructor("$ZodCIDRv6",(y,u)=>{u.pattern??(u.pattern=cidrv6),$ZodStringFormat.init(y,u),y._zod.check=g=>{const v=g.value.split("/");try{if(v.length!==2)throw new Error;const[b,w]=v;if(!w)throw new Error;const E=Number(w);if(`${E}`!==w)throw new Error;if(E<0||E>128)throw new Error;new URL(`http://[${b}]`)}catch{g.issues.push({code:"invalid_format",format:"cidrv6",input:g.value,inst:y,continue:!u.abort})}}});function isValidBase64(y){if(y==="")return!0;if(y.length%4!==0)return!1;try{return atob(y),!0}catch{return!1}}const $ZodBase64=$constructor("$ZodBase64",(y,u)=>{u.pattern??(u.pattern=base64),$ZodStringFormat.init(y,u),y._zod.bag.contentEncoding="base64",y._zod.check=g=>{isValidBase64(g.value)||g.issues.push({code:"invalid_format",format:"base64",input:g.value,inst:y,continue:!u.abort})}});function isValidBase64URL(y){if(!base64url.test(y))return!1;const u=y.replace(/[-_]/g,v=>v==="-"?"+":"/"),g=u.padEnd(Math.ceil(u.length/4)*4,"=");return isValidBase64(g)}const $ZodBase64URL=$constructor("$ZodBase64URL",(y,u)=>{u.pattern??(u.pattern=base64url),$ZodStringFormat.init(y,u),y._zod.bag.contentEncoding="base64url",y._zod.check=g=>{isValidBase64URL(g.value)||g.issues.push({code:"invalid_format",format:"base64url",input:g.value,inst:y,continue:!u.abort})}}),$ZodE164=$constructor("$ZodE164",(y,u)=>{u.pattern??(u.pattern=e164),$ZodStringFormat.init(y,u)});function isValidJWT(y,u=null){try{const g=y.split(".");if(g.length!==3)return!1;const[v]=g;if(!v)return!1;const b=JSON.parse(atob(v));return!("typ"in b&&b?.typ!=="JWT"||!b.alg||u&&(!("alg"in b)||b.alg!==u))}catch{return!1}}const $ZodJWT=$constructor("$ZodJWT",(y,u)=>{$ZodStringFormat.init(y,u),y._zod.check=g=>{isValidJWT(g.value,u.alg)||g.issues.push({code:"invalid_format",format:"jwt",input:g.value,inst:y,continue:!u.abort})}}),$ZodNumber=$constructor("$ZodNumber",(y,u)=>{$ZodType.init(y,u),y._zod.pattern=y._zod.bag.pattern??number$1,y._zod.parse=(g,v)=>{if(u.coerce)try{g.value=Number(g.value)}catch{}const b=g.value;if(typeof b=="number"&&!Number.isNaN(b)&&Number.isFinite(b))return g;const w=typeof b=="number"?Number.isNaN(b)?"NaN":Number.isFinite(b)?void 0:"Infinity":void 0;return g.issues.push({expected:"number",code:"invalid_type",input:b,inst:y,...w?{received:w}:{}}),g}}),$ZodNumberFormat=$constructor("$ZodNumberFormat",(y,u)=>{$ZodCheckNumberFormat.init(y,u),$ZodNumber.init(y,u)}),$ZodUnknown=$constructor("$ZodUnknown",(y,u)=>{$ZodType.init(y,u),y._zod.parse=g=>g}),$ZodNever=$constructor("$ZodNever",(y,u)=>{$ZodType.init(y,u),y._zod.parse=(g,v)=>(g.issues.push({expected:"never",code:"invalid_type",input:g.value,inst:y}),g)});function handleArrayResult(y,u,g){y.issues.length&&u.issues.push(...prefixIssues(g,y.issues)),u.value[g]=y.value}const $ZodArray=$constructor("$ZodArray",(y,u)=>{$ZodType.init(y,u),y._zod.parse=(g,v)=>{const b=g.value;if(!Array.isArray(b))return g.issues.push({expected:"array",code:"invalid_type",input:b,inst:y}),g;g.value=Array(b.length);const w=[];for(let E=0;E<b.length;E++){const S=b[E],A=u.element._zod.run({value:S,issues:[]},v);A instanceof Promise?w.push(A.then($=>handleArrayResult($,g,E))):handleArrayResult(A,g,E)}return w.length?Promise.all(w).then(()=>g):g}});function handlePropertyResult(y,u,g,v){y.issues.length&&u.issues.push(...prefixIssues(g,y.issues)),y.value===void 0?g in v&&(u.value[g]=void 0):u.value[g]=y.value}function normalizeDef(y){const u=Object.keys(y.shape);for(const v of u)if(!y.shape?.[v]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${v}": expected a Zod schema`);const g=optionalKeys(y.shape);return{...y,keys:u,keySet:new Set(u),numKeys:u.length,optionalKeys:new Set(g)}}function handleCatchall(y,u,g,v,b,w){const E=[],S=b.keySet,A=b.catchall._zod,$=A.def.type;for(const R in u){if(S.has(R))continue;if($==="never"){E.push(R);continue}const T=A.run({value:u[R],issues:[]},v);T instanceof Promise?y.push(T.then(O=>handlePropertyResult(O,g,R,u))):handlePropertyResult(T,g,R,u)}return E.length&&g.issues.push({code:"unrecognized_keys",keys:E,input:u,inst:w}),y.length?Promise.all(y).then(()=>g):g}const $ZodObject=$constructor("$ZodObject",(y,u)=>{if($ZodType.init(y,u),!Object.getOwnPropertyDescriptor(u,"shape")?.get){const S=u.shape;Object.defineProperty(u,"shape",{get:()=>{const A={...S};return Object.defineProperty(u,"shape",{value:A}),A}})}const v=cached(()=>normalizeDef(u));defineLazy(y._zod,"propValues",()=>{const S=u.shape,A={};for(const $ in S){const R=S[$]._zod;if(R.values){A[$]??(A[$]=new Set);for(const T of R.values)A[$].add(T)}}return A});const b=isObject$1,w=u.catchall;let E;y._zod.parse=(S,A)=>{E??(E=v.value);const $=S.value;if(!b($))return S.issues.push({expected:"object",code:"invalid_type",input:$,inst:y}),S;S.value={};const R=[],T=E.shape;for(const O of E.keys){const F=T[O]._zod.run({value:$[O],issues:[]},A);F instanceof Promise?R.push(F.then(U=>handlePropertyResult(U,S,O,$))):handlePropertyResult(F,S,O,$)}return w?handleCatchall(R,$,S,A,v.value,y):R.length?Promise.all(R).then(()=>S):S}}),$ZodObjectJIT=$constructor("$ZodObjectJIT",(y,u)=>{$ZodObject.init(y,u);const g=y._zod.parse,v=cached(()=>normalizeDef(u)),b=O=>{const B=new Doc(["shape","payload","ctx"]),F=v.value,U=oe=>{const le=esc(oe);return`shape[${le}]._zod.run({ value: input[${le}], issues: [] }, ctx)`};B.write("const input = payload.value;");const q=Object.create(null);let J=0;for(const oe of F.keys)q[oe]=`key_${J++}`;B.write("const newResult = {};");for(const oe of F.keys){const le=q[oe],de=esc(oe);B.write(`const ${le} = ${U(oe)};`),B.write(`
        if (${le}.issues.length) {
          payload.issues = payload.issues.concat(${le}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${de}, ...iss.path] : [${de}]
          })));
        }
        
        
        if (${le}.value === undefined) {
          if (${de} in input) {
            newResult[${de}] = undefined;
          }
        } else {
          newResult[${de}] = ${le}.value;
        }
        
      `)}B.write("payload.value = newResult;"),B.write("return payload;");const ie=B.compile();return(oe,le)=>ie(O,oe,le)};let w;const E=isObject$1,S=!globalConfig.jitless,$=S&&allowsEval.value,R=u.catchall;let T;y._zod.parse=(O,B)=>{T??(T=v.value);const F=O.value;return E(F)?S&&$&&B?.async===!1&&B.jitless!==!0?(w||(w=b(u.shape)),O=w(O,B),R?handleCatchall([],F,O,B,T,y):O):g(O,B):(O.issues.push({expected:"object",code:"invalid_type",input:F,inst:y}),O)}});function handleUnionResults(y,u,g,v){for(const w of y)if(w.issues.length===0)return u.value=w.value,u;const b=y.filter(w=>!aborted(w));return b.length===1?(u.value=b[0].value,b[0]):(u.issues.push({code:"invalid_union",input:u.value,inst:g,errors:y.map(w=>w.issues.map(E=>finalizeIssue(E,v,config())))}),u)}const $ZodUnion=$constructor("$ZodUnion",(y,u)=>{$ZodType.init(y,u),defineLazy(y._zod,"optin",()=>u.options.some(b=>b._zod.optin==="optional")?"optional":void 0),defineLazy(y._zod,"optout",()=>u.options.some(b=>b._zod.optout==="optional")?"optional":void 0),defineLazy(y._zod,"values",()=>{if(u.options.every(b=>b._zod.values))return new Set(u.options.flatMap(b=>Array.from(b._zod.values)))}),defineLazy(y._zod,"pattern",()=>{if(u.options.every(b=>b._zod.pattern)){const b=u.options.map(w=>w._zod.pattern);return new RegExp(`^(${b.map(w=>cleanRegex(w.source)).join("|")})$`)}});const g=u.options.length===1,v=u.options[0]._zod.run;y._zod.parse=(b,w)=>{if(g)return v(b,w);let E=!1;const S=[];for(const A of u.options){const $=A._zod.run({value:b.value,issues:[]},w);if($ instanceof Promise)S.push($),E=!0;else{if($.issues.length===0)return $;S.push($)}}return E?Promise.all(S).then(A=>handleUnionResults(A,b,y,w)):handleUnionResults(S,b,y,w)}}),$ZodIntersection=$constructor("$ZodIntersection",(y,u)=>{$ZodType.init(y,u),y._zod.parse=(g,v)=>{const b=g.value,w=u.left._zod.run({value:b,issues:[]},v),E=u.right._zod.run({value:b,issues:[]},v);return w instanceof Promise||E instanceof Promise?Promise.all([w,E]).then(([A,$])=>handleIntersectionResults(g,A,$)):handleIntersectionResults(g,w,E)}});function mergeValues(y,u){if(y===u)return{valid:!0,data:y};if(y instanceof Date&&u instanceof Date&&+y==+u)return{valid:!0,data:y};if(isPlainObject(y)&&isPlainObject(u)){const g=Object.keys(u),v=Object.keys(y).filter(w=>g.indexOf(w)!==-1),b={...y,...u};for(const w of v){const E=mergeValues(y[w],u[w]);if(!E.valid)return{valid:!1,mergeErrorPath:[w,...E.mergeErrorPath]};b[w]=E.data}return{valid:!0,data:b}}if(Array.isArray(y)&&Array.isArray(u)){if(y.length!==u.length)return{valid:!1,mergeErrorPath:[]};const g=[];for(let v=0;v<y.length;v++){const b=y[v],w=u[v],E=mergeValues(b,w);if(!E.valid)return{valid:!1,mergeErrorPath:[v,...E.mergeErrorPath]};g.push(E.data)}return{valid:!0,data:g}}return{valid:!1,mergeErrorPath:[]}}function handleIntersectionResults(y,u,g){if(u.issues.length&&y.issues.push(...u.issues),g.issues.length&&y.issues.push(...g.issues),aborted(y))return y;const v=mergeValues(u.value,g.value);if(!v.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(v.mergeErrorPath)}`);return y.value=v.data,y}const $ZodTuple=$constructor("$ZodTuple",(y,u)=>{$ZodType.init(y,u);const g=u.items;y._zod.parse=(v,b)=>{const w=v.value;if(!Array.isArray(w))return v.issues.push({input:w,inst:y,expected:"tuple",code:"invalid_type"}),v;v.value=[];const E=[],S=[...g].reverse().findIndex(R=>R._zod.optin!=="optional"),A=S===-1?0:g.length-S;if(!u.rest){const R=w.length>g.length,T=w.length<A-1;if(R||T)return v.issues.push({...R?{code:"too_big",maximum:g.length}:{code:"too_small",minimum:g.length},input:w,inst:y,origin:"array"}),v}let $=-1;for(const R of g){if($++,$>=w.length&&$>=A)continue;const T=R._zod.run({value:w[$],issues:[]},b);T instanceof Promise?E.push(T.then(O=>handleTupleResult(O,v,$))):handleTupleResult(T,v,$)}if(u.rest){const R=w.slice(g.length);for(const T of R){$++;const O=u.rest._zod.run({value:T,issues:[]},b);O instanceof Promise?E.push(O.then(B=>handleTupleResult(B,v,$))):handleTupleResult(O,v,$)}}return E.length?Promise.all(E).then(()=>v):v}});function handleTupleResult(y,u,g){y.issues.length&&u.issues.push(...prefixIssues(g,y.issues)),u.value[g]=y.value}const $ZodRecord=$constructor("$ZodRecord",(y,u)=>{$ZodType.init(y,u),y._zod.parse=(g,v)=>{const b=g.value;if(!isPlainObject(b))return g.issues.push({expected:"record",code:"invalid_type",input:b,inst:y}),g;const w=[],E=u.keyType._zod.values;if(E){g.value={};const S=new Set;for(const $ of E)if(typeof $=="string"||typeof $=="number"||typeof $=="symbol"){S.add(typeof $=="number"?$.toString():$);const R=u.valueType._zod.run({value:b[$],issues:[]},v);R instanceof Promise?w.push(R.then(T=>{T.issues.length&&g.issues.push(...prefixIssues($,T.issues)),g.value[$]=T.value})):(R.issues.length&&g.issues.push(...prefixIssues($,R.issues)),g.value[$]=R.value)}let A;for(const $ in b)S.has($)||(A=A??[],A.push($));A&&A.length>0&&g.issues.push({code:"unrecognized_keys",input:b,inst:y,keys:A})}else{g.value={};for(const S of Reflect.ownKeys(b)){if(S==="__proto__")continue;const A=u.keyType._zod.run({value:S,issues:[]},v);if(A instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(A.issues.length){g.issues.push({code:"invalid_key",origin:"record",issues:A.issues.map(R=>finalizeIssue(R,v,config())),input:S,path:[S],inst:y}),g.value[A.value]=A.value;continue}const $=u.valueType._zod.run({value:b[S],issues:[]},v);$ instanceof Promise?w.push($.then(R=>{R.issues.length&&g.issues.push(...prefixIssues(S,R.issues)),g.value[A.value]=R.value})):($.issues.length&&g.issues.push(...prefixIssues(S,$.issues)),g.value[A.value]=$.value)}}return w.length?Promise.all(w).then(()=>g):g}}),$ZodEnum=$constructor("$ZodEnum",(y,u)=>{$ZodType.init(y,u);const g=getEnumValues(u.entries),v=new Set(g);y._zod.values=v,y._zod.pattern=new RegExp(`^(${g.filter(b=>propertyKeyTypes.has(typeof b)).map(b=>typeof b=="string"?escapeRegex(b):b.toString()).join("|")})$`),y._zod.parse=(b,w)=>{const E=b.value;return v.has(E)||b.issues.push({code:"invalid_value",values:g,input:E,inst:y}),b}}),$ZodLiteral=$constructor("$ZodLiteral",(y,u)=>{if($ZodType.init(y,u),u.values.length===0)throw new Error("Cannot create literal schema with no valid values");const g=new Set(u.values);y._zod.values=g,y._zod.pattern=new RegExp(`^(${u.values.map(v=>typeof v=="string"?escapeRegex(v):v?escapeRegex(v.toString()):String(v)).join("|")})$`),y._zod.parse=(v,b)=>{const w=v.value;return g.has(w)||v.issues.push({code:"invalid_value",values:u.values,input:w,inst:y}),v}}),$ZodTransform=$constructor("$ZodTransform",(y,u)=>{$ZodType.init(y,u),y._zod.parse=(g,v)=>{if(v.direction==="backward")throw new $ZodEncodeError(y.constructor.name);const b=u.transform(g.value,g);if(v.async)return(b instanceof Promise?b:Promise.resolve(b)).then(E=>(g.value=E,g));if(b instanceof Promise)throw new $ZodAsyncError;return g.value=b,g}});function handleOptionalResult(y,u){return y.issues.length&&u===void 0?{issues:[],value:void 0}:y}const $ZodOptional=$constructor("$ZodOptional",(y,u)=>{$ZodType.init(y,u),y._zod.optin="optional",y._zod.optout="optional",defineLazy(y._zod,"values",()=>u.innerType._zod.values?new Set([...u.innerType._zod.values,void 0]):void 0),defineLazy(y._zod,"pattern",()=>{const g=u.innerType._zod.pattern;return g?new RegExp(`^(${cleanRegex(g.source)})?$`):void 0}),y._zod.parse=(g,v)=>{if(u.innerType._zod.optin==="optional"){const b=u.innerType._zod.run(g,v);return b instanceof Promise?b.then(w=>handleOptionalResult(w,g.value)):handleOptionalResult(b,g.value)}return g.value===void 0?g:u.innerType._zod.run(g,v)}}),$ZodNullable=$constructor("$ZodNullable",(y,u)=>{$ZodType.init(y,u),defineLazy(y._zod,"optin",()=>u.innerType._zod.optin),defineLazy(y._zod,"optout",()=>u.innerType._zod.optout),defineLazy(y._zod,"pattern",()=>{const g=u.innerType._zod.pattern;return g?new RegExp(`^(${cleanRegex(g.source)}|null)$`):void 0}),defineLazy(y._zod,"values",()=>u.innerType._zod.values?new Set([...u.innerType._zod.values,null]):void 0),y._zod.parse=(g,v)=>g.value===null?g:u.innerType._zod.run(g,v)}),$ZodDefault=$constructor("$ZodDefault",(y,u)=>{$ZodType.init(y,u),y._zod.optin="optional",defineLazy(y._zod,"values",()=>u.innerType._zod.values),y._zod.parse=(g,v)=>{if(v.direction==="backward")return u.innerType._zod.run(g,v);if(g.value===void 0)return g.value=u.defaultValue,g;const b=u.innerType._zod.run(g,v);return b instanceof Promise?b.then(w=>handleDefaultResult(w,u)):handleDefaultResult(b,u)}});function handleDefaultResult(y,u){return y.value===void 0&&(y.value=u.defaultValue),y}const $ZodPrefault=$constructor("$ZodPrefault",(y,u)=>{$ZodType.init(y,u),y._zod.optin="optional",defineLazy(y._zod,"values",()=>u.innerType._zod.values),y._zod.parse=(g,v)=>(v.direction==="backward"||g.value===void 0&&(g.value=u.defaultValue),u.innerType._zod.run(g,v))}),$ZodNonOptional=$constructor("$ZodNonOptional",(y,u)=>{$ZodType.init(y,u),defineLazy(y._zod,"values",()=>{const g=u.innerType._zod.values;return g?new Set([...g].filter(v=>v!==void 0)):void 0}),y._zod.parse=(g,v)=>{const b=u.innerType._zod.run(g,v);return b instanceof Promise?b.then(w=>handleNonOptionalResult(w,y)):handleNonOptionalResult(b,y)}});function handleNonOptionalResult(y,u){return!y.issues.length&&y.value===void 0&&y.issues.push({code:"invalid_type",expected:"nonoptional",input:y.value,inst:u}),y}const $ZodCatch=$constructor("$ZodCatch",(y,u)=>{$ZodType.init(y,u),defineLazy(y._zod,"optin",()=>u.innerType._zod.optin),defineLazy(y._zod,"optout",()=>u.innerType._zod.optout),defineLazy(y._zod,"values",()=>u.innerType._zod.values),y._zod.parse=(g,v)=>{if(v.direction==="backward")return u.innerType._zod.run(g,v);const b=u.innerType._zod.run(g,v);return b instanceof Promise?b.then(w=>(g.value=w.value,w.issues.length&&(g.value=u.catchValue({...g,error:{issues:w.issues.map(E=>finalizeIssue(E,v,config()))},input:g.value}),g.issues=[]),g)):(g.value=b.value,b.issues.length&&(g.value=u.catchValue({...g,error:{issues:b.issues.map(w=>finalizeIssue(w,v,config()))},input:g.value}),g.issues=[]),g)}}),$ZodPipe=$constructor("$ZodPipe",(y,u)=>{$ZodType.init(y,u),defineLazy(y._zod,"values",()=>u.in._zod.values),defineLazy(y._zod,"optin",()=>u.in._zod.optin),defineLazy(y._zod,"optout",()=>u.out._zod.optout),defineLazy(y._zod,"propValues",()=>u.in._zod.propValues),y._zod.parse=(g,v)=>{if(v.direction==="backward"){const w=u.out._zod.run(g,v);return w instanceof Promise?w.then(E=>handlePipeResult(E,u.in,v)):handlePipeResult(w,u.in,v)}const b=u.in._zod.run(g,v);return b instanceof Promise?b.then(w=>handlePipeResult(w,u.out,v)):handlePipeResult(b,u.out,v)}});function handlePipeResult(y,u,g){return y.issues.length?(y.aborted=!0,y):u._zod.run({value:y.value,issues:y.issues},g)}const $ZodReadonly=$constructor("$ZodReadonly",(y,u)=>{$ZodType.init(y,u),defineLazy(y._zod,"propValues",()=>u.innerType._zod.propValues),defineLazy(y._zod,"values",()=>u.innerType._zod.values),defineLazy(y._zod,"optin",()=>u.innerType?._zod?.optin),defineLazy(y._zod,"optout",()=>u.innerType?._zod?.optout),y._zod.parse=(g,v)=>{if(v.direction==="backward")return u.innerType._zod.run(g,v);const b=u.innerType._zod.run(g,v);return b instanceof Promise?b.then(handleReadonlyResult):handleReadonlyResult(b)}});function handleReadonlyResult(y){return y.value=Object.freeze(y.value),y}const $ZodCustom=$constructor("$ZodCustom",(y,u)=>{$ZodCheck.init(y,u),$ZodType.init(y,u),y._zod.parse=(g,v)=>g,y._zod.check=g=>{const v=g.value,b=u.fn(v);if(b instanceof Promise)return b.then(w=>handleRefineResult(w,g,v,y));handleRefineResult(b,g,v,y)}});function handleRefineResult(y,u,g,v){if(!y){const b={code:"custom",input:g,inst:v,path:[...v._zod.def.path??[]],continue:!v._zod.def.abort};v._zod.def.params&&(b.params=v._zod.def.params),u.issues.push(issue(b))}}var _a$1;class $ZodRegistry{constructor(){this._map=new WeakMap,this._idmap=new Map}add(u,...g){const v=g[0];if(this._map.set(u,v),v&&typeof v=="object"&&"id"in v){if(this._idmap.has(v.id))throw new Error(`ID ${v.id} already exists in the registry`);this._idmap.set(v.id,u)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(u){const g=this._map.get(u);return g&&typeof g=="object"&&"id"in g&&this._idmap.delete(g.id),this._map.delete(u),this}get(u){const g=u._zod.parent;if(g){const v={...this.get(g)??{}};delete v.id;const b={...v,...this._map.get(u)};return Object.keys(b).length?b:void 0}return this._map.get(u)}has(u){return this._map.has(u)}}function registry(){return new $ZodRegistry}(_a$1=globalThis).__zod_globalRegistry??(_a$1.__zod_globalRegistry=registry());const globalRegistry=globalThis.__zod_globalRegistry;function _string(y,u){return new y({type:"string",...normalizeParams(u)})}function _email(y,u){return new y({type:"string",format:"email",check:"string_format",abort:!1,...normalizeParams(u)})}function _guid(y,u){return new y({type:"string",format:"guid",check:"string_format",abort:!1,...normalizeParams(u)})}function _uuid(y,u){return new y({type:"string",format:"uuid",check:"string_format",abort:!1,...normalizeParams(u)})}function _uuidv4(y,u){return new y({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...normalizeParams(u)})}function _uuidv6(y,u){return new y({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...normalizeParams(u)})}function _uuidv7(y,u){return new y({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...normalizeParams(u)})}function _url(y,u){return new y({type:"string",format:"url",check:"string_format",abort:!1,...normalizeParams(u)})}function _emoji(y,u){return new y({type:"string",format:"emoji",check:"string_format",abort:!1,...normalizeParams(u)})}function _nanoid(y,u){return new y({type:"string",format:"nanoid",check:"string_format",abort:!1,...normalizeParams(u)})}function _cuid(y,u){return new y({type:"string",format:"cuid",check:"string_format",abort:!1,...normalizeParams(u)})}function _cuid2(y,u){return new y({type:"string",format:"cuid2",check:"string_format",abort:!1,...normalizeParams(u)})}function _ulid(y,u){return new y({type:"string",format:"ulid",check:"string_format",abort:!1,...normalizeParams(u)})}function _xid(y,u){return new y({type:"string",format:"xid",check:"string_format",abort:!1,...normalizeParams(u)})}function _ksuid(y,u){return new y({type:"string",format:"ksuid",check:"string_format",abort:!1,...normalizeParams(u)})}function _ipv4(y,u){return new y({type:"string",format:"ipv4",check:"string_format",abort:!1,...normalizeParams(u)})}function _ipv6(y,u){return new y({type:"string",format:"ipv6",check:"string_format",abort:!1,...normalizeParams(u)})}function _cidrv4(y,u){return new y({type:"string",format:"cidrv4",check:"string_format",abort:!1,...normalizeParams(u)})}function _cidrv6(y,u){return new y({type:"string",format:"cidrv6",check:"string_format",abort:!1,...normalizeParams(u)})}function _base64(y,u){return new y({type:"string",format:"base64",check:"string_format",abort:!1,...normalizeParams(u)})}function _base64url(y,u){return new y({type:"string",format:"base64url",check:"string_format",abort:!1,...normalizeParams(u)})}function _e164(y,u){return new y({type:"string",format:"e164",check:"string_format",abort:!1,...normalizeParams(u)})}function _jwt(y,u){return new y({type:"string",format:"jwt",check:"string_format",abort:!1,...normalizeParams(u)})}function _isoDateTime(y,u){return new y({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...normalizeParams(u)})}function _isoDate(y,u){return new y({type:"string",format:"date",check:"string_format",...normalizeParams(u)})}function _isoTime(y,u){return new y({type:"string",format:"time",check:"string_format",precision:null,...normalizeParams(u)})}function _isoDuration(y,u){return new y({type:"string",format:"duration",check:"string_format",...normalizeParams(u)})}function _number(y,u){return new y({type:"number",checks:[],...normalizeParams(u)})}function _int(y,u){return new y({type:"number",check:"number_format",abort:!1,format:"safeint",...normalizeParams(u)})}function _unknown(y){return new y({type:"unknown"})}function _never(y,u){return new y({type:"never",...normalizeParams(u)})}function _lt(y,u){return new $ZodCheckLessThan({check:"less_than",...normalizeParams(u),value:y,inclusive:!1})}function _lte(y,u){return new $ZodCheckLessThan({check:"less_than",...normalizeParams(u),value:y,inclusive:!0})}function _gt(y,u){return new $ZodCheckGreaterThan({check:"greater_than",...normalizeParams(u),value:y,inclusive:!1})}function _gte(y,u){return new $ZodCheckGreaterThan({check:"greater_than",...normalizeParams(u),value:y,inclusive:!0})}function _multipleOf(y,u){return new $ZodCheckMultipleOf({check:"multiple_of",...normalizeParams(u),value:y})}function _maxLength(y,u){return new $ZodCheckMaxLength({check:"max_length",...normalizeParams(u),maximum:y})}function _minLength(y,u){return new $ZodCheckMinLength({check:"min_length",...normalizeParams(u),minimum:y})}function _length(y,u){return new $ZodCheckLengthEquals({check:"length_equals",...normalizeParams(u),length:y})}function _regex(y,u){return new $ZodCheckRegex({check:"string_format",format:"regex",...normalizeParams(u),pattern:y})}function _lowercase(y){return new $ZodCheckLowerCase({check:"string_format",format:"lowercase",...normalizeParams(y)})}function _uppercase(y){return new $ZodCheckUpperCase({check:"string_format",format:"uppercase",...normalizeParams(y)})}function _includes(y,u){return new $ZodCheckIncludes({check:"string_format",format:"includes",...normalizeParams(u),includes:y})}function _startsWith(y,u){return new $ZodCheckStartsWith({check:"string_format",format:"starts_with",...normalizeParams(u),prefix:y})}function _endsWith(y,u){return new $ZodCheckEndsWith({check:"string_format",format:"ends_with",...normalizeParams(u),suffix:y})}function _overwrite(y){return new $ZodCheckOverwrite({check:"overwrite",tx:y})}function _normalize(y){return _overwrite(u=>u.normalize(y))}function _trim(){return _overwrite(y=>y.trim())}function _toLowerCase(){return _overwrite(y=>y.toLowerCase())}function _toUpperCase(){return _overwrite(y=>y.toUpperCase())}function _slugify(){return _overwrite(y=>slugify(y))}function _array(y,u,g){return new y({type:"array",element:u,...normalizeParams(g)})}function _refine(y,u,g){return new y({type:"custom",check:"custom",fn:u,...normalizeParams(g)})}function _superRefine(y){const u=_check(g=>(g.addIssue=v=>{if(typeof v=="string")g.issues.push(issue(v,g.value,u._zod.def));else{const b=v;b.fatal&&(b.continue=!1),b.code??(b.code="custom"),b.input??(b.input=g.value),b.inst??(b.inst=u),b.continue??(b.continue=!u._zod.def.abort),g.issues.push(issue(b))}},y(g.value,g)));return u}function _check(y,u){const g=new $ZodCheck({check:"custom",...normalizeParams(u)});return g._zod.check=y,g}const ZodISODateTime=$constructor("ZodISODateTime",(y,u)=>{$ZodISODateTime.init(y,u),ZodStringFormat.init(y,u)});function datetime(y){return _isoDateTime(ZodISODateTime,y)}const ZodISODate=$constructor("ZodISODate",(y,u)=>{$ZodISODate.init(y,u),ZodStringFormat.init(y,u)});function date(y){return _isoDate(ZodISODate,y)}const ZodISOTime=$constructor("ZodISOTime",(y,u)=>{$ZodISOTime.init(y,u),ZodStringFormat.init(y,u)});function time(y){return _isoTime(ZodISOTime,y)}const ZodISODuration=$constructor("ZodISODuration",(y,u)=>{$ZodISODuration.init(y,u),ZodStringFormat.init(y,u)});function duration(y){return _isoDuration(ZodISODuration,y)}const initializer=(y,u)=>{$ZodError.init(y,u),y.name="ZodError",Object.defineProperties(y,{format:{value:g=>formatError(y,g)},flatten:{value:g=>flattenError(y,g)},addIssue:{value:g=>{y.issues.push(g),y.message=JSON.stringify(y.issues,jsonStringifyReplacer,2)}},addIssues:{value:g=>{y.issues.push(...g),y.message=JSON.stringify(y.issues,jsonStringifyReplacer,2)}},isEmpty:{get(){return y.issues.length===0}}})},ZodRealError=$constructor("ZodError",initializer,{Parent:Error}),parse$6=_parse(ZodRealError),parseAsync=_parseAsync(ZodRealError),safeParse=_safeParse(ZodRealError),safeParseAsync=_safeParseAsync(ZodRealError),encode$1=_encode(ZodRealError),decode=_decode(ZodRealError),encodeAsync=_encodeAsync(ZodRealError),decodeAsync=_decodeAsync(ZodRealError),safeEncode=_safeEncode(ZodRealError),safeDecode=_safeDecode(ZodRealError),safeEncodeAsync=_safeEncodeAsync(ZodRealError),safeDecodeAsync=_safeDecodeAsync(ZodRealError),ZodType=$constructor("ZodType",(y,u)=>($ZodType.init(y,u),y.def=u,y.type=u.type,Object.defineProperty(y,"_def",{value:u}),y.check=(...g)=>y.clone(mergeDefs(u,{checks:[...u.checks??[],...g.map(v=>typeof v=="function"?{_zod:{check:v,def:{check:"custom"},onattach:[]}}:v)]})),y.clone=(g,v)=>clone(y,g,v),y.brand=()=>y,y.register=((g,v)=>(g.add(y,v),y)),y.parse=(g,v)=>parse$6(y,g,v,{callee:y.parse}),y.safeParse=(g,v)=>safeParse(y,g,v),y.parseAsync=async(g,v)=>parseAsync(y,g,v,{callee:y.parseAsync}),y.safeParseAsync=async(g,v)=>safeParseAsync(y,g,v),y.spa=y.safeParseAsync,y.encode=(g,v)=>encode$1(y,g,v),y.decode=(g,v)=>decode(y,g,v),y.encodeAsync=async(g,v)=>encodeAsync(y,g,v),y.decodeAsync=async(g,v)=>decodeAsync(y,g,v),y.safeEncode=(g,v)=>safeEncode(y,g,v),y.safeDecode=(g,v)=>safeDecode(y,g,v),y.safeEncodeAsync=async(g,v)=>safeEncodeAsync(y,g,v),y.safeDecodeAsync=async(g,v)=>safeDecodeAsync(y,g,v),y.refine=(g,v)=>y.check(refine(g,v)),y.superRefine=g=>y.check(superRefine(g)),y.overwrite=g=>y.check(_overwrite(g)),y.optional=()=>optional(y),y.nullable=()=>nullable(y),y.nullish=()=>optional(nullable(y)),y.nonoptional=g=>nonoptional(y,g),y.array=()=>array(y),y.or=g=>union([y,g]),y.and=g=>intersection(y,g),y.transform=g=>pipe(y,transform(g)),y.default=g=>_default(y,g),y.prefault=g=>prefault(y,g),y.catch=g=>_catch(y,g),y.pipe=g=>pipe(y,g),y.readonly=()=>readonly(y),y.describe=g=>{const v=y.clone();return globalRegistry.add(v,{description:g}),v},Object.defineProperty(y,"description",{get(){return globalRegistry.get(y)?.description},configurable:!0}),y.meta=(...g)=>{if(g.length===0)return globalRegistry.get(y);const v=y.clone();return globalRegistry.add(v,g[0]),v},y.isOptional=()=>y.safeParse(void 0).success,y.isNullable=()=>y.safeParse(null).success,y)),_ZodString=$constructor("_ZodString",(y,u)=>{$ZodString.init(y,u),ZodType.init(y,u);const g=y._zod.bag;y.format=g.format??null,y.minLength=g.minimum??null,y.maxLength=g.maximum??null,y.regex=(...v)=>y.check(_regex(...v)),y.includes=(...v)=>y.check(_includes(...v)),y.startsWith=(...v)=>y.check(_startsWith(...v)),y.endsWith=(...v)=>y.check(_endsWith(...v)),y.min=(...v)=>y.check(_minLength(...v)),y.max=(...v)=>y.check(_maxLength(...v)),y.length=(...v)=>y.check(_length(...v)),y.nonempty=(...v)=>y.check(_minLength(1,...v)),y.lowercase=v=>y.check(_lowercase(v)),y.uppercase=v=>y.check(_uppercase(v)),y.trim=()=>y.check(_trim()),y.normalize=(...v)=>y.check(_normalize(...v)),y.toLowerCase=()=>y.check(_toLowerCase()),y.toUpperCase=()=>y.check(_toUpperCase()),y.slugify=()=>y.check(_slugify())}),ZodString=$constructor("ZodString",(y,u)=>{$ZodString.init(y,u),_ZodString.init(y,u),y.email=g=>y.check(_email(ZodEmail,g)),y.url=g=>y.check(_url(ZodURL,g)),y.jwt=g=>y.check(_jwt(ZodJWT,g)),y.emoji=g=>y.check(_emoji(ZodEmoji,g)),y.guid=g=>y.check(_guid(ZodGUID,g)),y.uuid=g=>y.check(_uuid(ZodUUID,g)),y.uuidv4=g=>y.check(_uuidv4(ZodUUID,g)),y.uuidv6=g=>y.check(_uuidv6(ZodUUID,g)),y.uuidv7=g=>y.check(_uuidv7(ZodUUID,g)),y.nanoid=g=>y.check(_nanoid(ZodNanoID,g)),y.guid=g=>y.check(_guid(ZodGUID,g)),y.cuid=g=>y.check(_cuid(ZodCUID,g)),y.cuid2=g=>y.check(_cuid2(ZodCUID2,g)),y.ulid=g=>y.check(_ulid(ZodULID,g)),y.base64=g=>y.check(_base64(ZodBase64,g)),y.base64url=g=>y.check(_base64url(ZodBase64URL,g)),y.xid=g=>y.check(_xid(ZodXID,g)),y.ksuid=g=>y.check(_ksuid(ZodKSUID,g)),y.ipv4=g=>y.check(_ipv4(ZodIPv4,g)),y.ipv6=g=>y.check(_ipv6(ZodIPv6,g)),y.cidrv4=g=>y.check(_cidrv4(ZodCIDRv4,g)),y.cidrv6=g=>y.check(_cidrv6(ZodCIDRv6,g)),y.e164=g=>y.check(_e164(ZodE164,g)),y.datetime=g=>y.check(datetime(g)),y.date=g=>y.check(date(g)),y.time=g=>y.check(time(g)),y.duration=g=>y.check(duration(g))});function string(y){return _string(ZodString,y)}const ZodStringFormat=$constructor("ZodStringFormat",(y,u)=>{$ZodStringFormat.init(y,u),_ZodString.init(y,u)}),ZodEmail=$constructor("ZodEmail",(y,u)=>{$ZodEmail.init(y,u),ZodStringFormat.init(y,u)}),ZodGUID=$constructor("ZodGUID",(y,u)=>{$ZodGUID.init(y,u),ZodStringFormat.init(y,u)}),ZodUUID=$constructor("ZodUUID",(y,u)=>{$ZodUUID.init(y,u),ZodStringFormat.init(y,u)}),ZodURL=$constructor("ZodURL",(y,u)=>{$ZodURL.init(y,u),ZodStringFormat.init(y,u)}),ZodEmoji=$constructor("ZodEmoji",(y,u)=>{$ZodEmoji.init(y,u),ZodStringFormat.init(y,u)}),ZodNanoID=$constructor("ZodNanoID",(y,u)=>{$ZodNanoID.init(y,u),ZodStringFormat.init(y,u)}),ZodCUID=$constructor("ZodCUID",(y,u)=>{$ZodCUID.init(y,u),ZodStringFormat.init(y,u)}),ZodCUID2=$constructor("ZodCUID2",(y,u)=>{$ZodCUID2.init(y,u),ZodStringFormat.init(y,u)}),ZodULID=$constructor("ZodULID",(y,u)=>{$ZodULID.init(y,u),ZodStringFormat.init(y,u)}),ZodXID=$constructor("ZodXID",(y,u)=>{$ZodXID.init(y,u),ZodStringFormat.init(y,u)}),ZodKSUID=$constructor("ZodKSUID",(y,u)=>{$ZodKSUID.init(y,u),ZodStringFormat.init(y,u)}),ZodIPv4=$constructor("ZodIPv4",(y,u)=>{$ZodIPv4.init(y,u),ZodStringFormat.init(y,u)}),ZodIPv6=$constructor("ZodIPv6",(y,u)=>{$ZodIPv6.init(y,u),ZodStringFormat.init(y,u)}),ZodCIDRv4=$constructor("ZodCIDRv4",(y,u)=>{$ZodCIDRv4.init(y,u),ZodStringFormat.init(y,u)}),ZodCIDRv6=$constructor("ZodCIDRv6",(y,u)=>{$ZodCIDRv6.init(y,u),ZodStringFormat.init(y,u)}),ZodBase64=$constructor("ZodBase64",(y,u)=>{$ZodBase64.init(y,u),ZodStringFormat.init(y,u)}),ZodBase64URL=$constructor("ZodBase64URL",(y,u)=>{$ZodBase64URL.init(y,u),ZodStringFormat.init(y,u)}),ZodE164=$constructor("ZodE164",(y,u)=>{$ZodE164.init(y,u),ZodStringFormat.init(y,u)}),ZodJWT=$constructor("ZodJWT",(y,u)=>{$ZodJWT.init(y,u),ZodStringFormat.init(y,u)}),ZodNumber=$constructor("ZodNumber",(y,u)=>{$ZodNumber.init(y,u),ZodType.init(y,u),y.gt=(v,b)=>y.check(_gt(v,b)),y.gte=(v,b)=>y.check(_gte(v,b)),y.min=(v,b)=>y.check(_gte(v,b)),y.lt=(v,b)=>y.check(_lt(v,b)),y.lte=(v,b)=>y.check(_lte(v,b)),y.max=(v,b)=>y.check(_lte(v,b)),y.int=v=>y.check(int(v)),y.safe=v=>y.check(int(v)),y.positive=v=>y.check(_gt(0,v)),y.nonnegative=v=>y.check(_gte(0,v)),y.negative=v=>y.check(_lt(0,v)),y.nonpositive=v=>y.check(_lte(0,v)),y.multipleOf=(v,b)=>y.check(_multipleOf(v,b)),y.step=(v,b)=>y.check(_multipleOf(v,b)),y.finite=()=>y;const g=y._zod.bag;y.minValue=Math.max(g.minimum??Number.NEGATIVE_INFINITY,g.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,y.maxValue=Math.min(g.maximum??Number.POSITIVE_INFINITY,g.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,y.isInt=(g.format??"").includes("int")||Number.isSafeInteger(g.multipleOf??.5),y.isFinite=!0,y.format=g.format??null});function number(y){return _number(ZodNumber,y)}const ZodNumberFormat=$constructor("ZodNumberFormat",(y,u)=>{$ZodNumberFormat.init(y,u),ZodNumber.init(y,u)});function int(y){return _int(ZodNumberFormat,y)}const ZodUnknown=$constructor("ZodUnknown",(y,u)=>{$ZodUnknown.init(y,u),ZodType.init(y,u)});function unknown(){return _unknown(ZodUnknown)}const ZodNever=$constructor("ZodNever",(y,u)=>{$ZodNever.init(y,u),ZodType.init(y,u)});function never(y){return _never(ZodNever,y)}const ZodArray=$constructor("ZodArray",(y,u)=>{$ZodArray.init(y,u),ZodType.init(y,u),y.element=u.element,y.min=(g,v)=>y.check(_minLength(g,v)),y.nonempty=g=>y.check(_minLength(1,g)),y.max=(g,v)=>y.check(_maxLength(g,v)),y.length=(g,v)=>y.check(_length(g,v)),y.unwrap=()=>y.element});function array(y,u){return _array(ZodArray,y,u)}const ZodObject=$constructor("ZodObject",(y,u)=>{$ZodObjectJIT.init(y,u),ZodType.init(y,u),defineLazy(y,"shape",()=>u.shape),y.keyof=()=>_enum(Object.keys(y._zod.def.shape)),y.catchall=g=>y.clone({...y._zod.def,catchall:g}),y.passthrough=()=>y.clone({...y._zod.def,catchall:unknown()}),y.loose=()=>y.clone({...y._zod.def,catchall:unknown()}),y.strict=()=>y.clone({...y._zod.def,catchall:never()}),y.strip=()=>y.clone({...y._zod.def,catchall:void 0}),y.extend=g=>extend(y,g),y.safeExtend=g=>safeExtend(y,g),y.merge=g=>merge(y,g),y.pick=g=>pick(y,g),y.omit=g=>omit(y,g),y.partial=(...g)=>partial(ZodOptional,y,g[0]),y.required=(...g)=>required(ZodNonOptional,y,g[0])});function object(y,u){const g={type:"object",shape:y??{},...normalizeParams(u)};return new ZodObject(g)}const ZodUnion=$constructor("ZodUnion",(y,u)=>{$ZodUnion.init(y,u),ZodType.init(y,u),y.options=u.options});function union(y,u){return new ZodUnion({type:"union",options:y,...normalizeParams(u)})}const ZodIntersection=$constructor("ZodIntersection",(y,u)=>{$ZodIntersection.init(y,u),ZodType.init(y,u)});function intersection(y,u){return new ZodIntersection({type:"intersection",left:y,right:u})}const ZodTuple=$constructor("ZodTuple",(y,u)=>{$ZodTuple.init(y,u),ZodType.init(y,u),y.rest=g=>y.clone({...y._zod.def,rest:g})});function tuple(y,u,g){const v=u instanceof $ZodType,b=v?g:u,w=v?u:null;return new ZodTuple({type:"tuple",items:y,rest:w,...normalizeParams(b)})}const ZodRecord=$constructor("ZodRecord",(y,u)=>{$ZodRecord.init(y,u),ZodType.init(y,u),y.keyType=u.keyType,y.valueType=u.valueType});function record$1(y,u,g){return new ZodRecord({type:"record",keyType:y,valueType:u,...normalizeParams(g)})}const ZodEnum=$constructor("ZodEnum",(y,u)=>{$ZodEnum.init(y,u),ZodType.init(y,u),y.enum=u.entries,y.options=Object.values(u.entries);const g=new Set(Object.keys(u.entries));y.extract=(v,b)=>{const w={};for(const E of v)if(g.has(E))w[E]=u.entries[E];else throw new Error(`Key ${E} not found in enum`);return new ZodEnum({...u,checks:[],...normalizeParams(b),entries:w})},y.exclude=(v,b)=>{const w={...u.entries};for(const E of v)if(g.has(E))delete w[E];else throw new Error(`Key ${E} not found in enum`);return new ZodEnum({...u,checks:[],...normalizeParams(b),entries:w})}});function _enum(y,u){const g=Array.isArray(y)?Object.fromEntries(y.map(v=>[v,v])):y;return new ZodEnum({type:"enum",entries:g,...normalizeParams(u)})}const ZodLiteral=$constructor("ZodLiteral",(y,u)=>{$ZodLiteral.init(y,u),ZodType.init(y,u),y.values=new Set(u.values),Object.defineProperty(y,"value",{get(){if(u.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return u.values[0]}})});function literal(y,u){return new ZodLiteral({type:"literal",values:Array.isArray(y)?y:[y],...normalizeParams(u)})}const ZodTransform=$constructor("ZodTransform",(y,u)=>{$ZodTransform.init(y,u),ZodType.init(y,u),y._zod.parse=(g,v)=>{if(v.direction==="backward")throw new $ZodEncodeError(y.constructor.name);g.addIssue=w=>{if(typeof w=="string")g.issues.push(issue(w,g.value,u));else{const E=w;E.fatal&&(E.continue=!1),E.code??(E.code="custom"),E.input??(E.input=g.value),E.inst??(E.inst=y),g.issues.push(issue(E))}};const b=u.transform(g.value,g);return b instanceof Promise?b.then(w=>(g.value=w,g)):(g.value=b,g)}});function transform(y){return new ZodTransform({type:"transform",transform:y})}const ZodOptional=$constructor("ZodOptional",(y,u)=>{$ZodOptional.init(y,u),ZodType.init(y,u),y.unwrap=()=>y._zod.def.innerType});function optional(y){return new ZodOptional({type:"optional",innerType:y})}const ZodNullable=$constructor("ZodNullable",(y,u)=>{$ZodNullable.init(y,u),ZodType.init(y,u),y.unwrap=()=>y._zod.def.innerType});function nullable(y){return new ZodNullable({type:"nullable",innerType:y})}const ZodDefault=$constructor("ZodDefault",(y,u)=>{$ZodDefault.init(y,u),ZodType.init(y,u),y.unwrap=()=>y._zod.def.innerType,y.removeDefault=y.unwrap});function _default(y,u){return new ZodDefault({type:"default",innerType:y,get defaultValue(){return typeof u=="function"?u():shallowClone(u)}})}const ZodPrefault=$constructor("ZodPrefault",(y,u)=>{$ZodPrefault.init(y,u),ZodType.init(y,u),y.unwrap=()=>y._zod.def.innerType});function prefault(y,u){return new ZodPrefault({type:"prefault",innerType:y,get defaultValue(){return typeof u=="function"?u():shallowClone(u)}})}const ZodNonOptional=$constructor("ZodNonOptional",(y,u)=>{$ZodNonOptional.init(y,u),ZodType.init(y,u),y.unwrap=()=>y._zod.def.innerType});function nonoptional(y,u){return new ZodNonOptional({type:"nonoptional",innerType:y,...normalizeParams(u)})}const ZodCatch=$constructor("ZodCatch",(y,u)=>{$ZodCatch.init(y,u),ZodType.init(y,u),y.unwrap=()=>y._zod.def.innerType,y.removeCatch=y.unwrap});function _catch(y,u){return new ZodCatch({type:"catch",innerType:y,catchValue:typeof u=="function"?u:()=>u})}const ZodPipe=$constructor("ZodPipe",(y,u)=>{$ZodPipe.init(y,u),ZodType.init(y,u),y.in=u.in,y.out=u.out});function pipe(y,u){return new ZodPipe({type:"pipe",in:y,out:u})}const ZodReadonly=$constructor("ZodReadonly",(y,u)=>{$ZodReadonly.init(y,u),ZodType.init(y,u),y.unwrap=()=>y._zod.def.innerType});function readonly(y){return new ZodReadonly({type:"readonly",innerType:y})}const ZodCustom=$constructor("ZodCustom",(y,u)=>{$ZodCustom.init(y,u),ZodType.init(y,u)});function refine(y,u={}){return _refine(ZodCustom,y,u)}function superRefine(y){return _superRefine(y)}const hexString=string().regex(/^[0-9a-fA-F]*$/,"Must be hex string"),hexString64=string().regex(/^[0-9a-fA-F]{64}$/,"Must be 64-char hex"),TxfMerkleStepSchema=object({data:string(),path:string()}),TxfMerkleTreePathSchema=object({root:string(),steps:array(TxfMerkleStepSchema)}),TxfAuthenticatorSchema=object({algorithm:string(),publicKey:hexString,signature:hexString,stateHash:string()}),TxfInclusionProofSchema=object({authenticator:TxfAuthenticatorSchema,merkleTreePath:TxfMerkleTreePathSchema,transactionHash:string(),unicityCertificate:string()}),TxfGenesisDataSchema=object({tokenId:hexString64,tokenType:hexString64,coinData:array(tuple([string(),string()])),tokenData:string(),salt:hexString64,recipient:string(),recipientDataHash:string().nullable(),reason:string().nullable()}),TxfGenesisSchema=object({data:TxfGenesisDataSchema,inclusionProof:TxfInclusionProofSchema}),TxfStateSchema=object({data:string(),predicate:string()}),TxfTransactionSchema=object({previousStateHash:string(),newStateHash:string(),predicate:string(),inclusionProof:TxfInclusionProofSchema.nullable(),data:record$1(string(),unknown()).optional()}),TxfIntegritySchema=object({genesisDataJSONHash:string()}),TxfTokenSchema=object({version:literal("2.0"),genesis:TxfGenesisSchema,state:TxfStateSchema,transactions:array(TxfTransactionSchema),nametags:array(string()),_integrity:TxfIntegritySchema}),TxfMetaSchema=object({version:number().int().nonnegative(),address:string(),ipnsName:string(),formatVersion:literal("2.0"),lastCid:string().optional()}),NametagDataSchema=object({name:string(),tokenId:string(),registeredAt:number().optional()}).passthrough();object({_meta:TxfMetaSchema,_nametag:NametagDataSchema.optional()}).catchall(union([TxfTokenSchema,unknown()]));function safeParseTxfToken(y){const u=TxfTokenSchema.safeParse(y);return u.success?u.data:(console.warn("TxfToken validation failed:",u.error.format()),null)}function safeParseTxfMeta(y){const u=TxfMetaSchema.safeParse(y);return u.success?u.data:(console.warn("TxfMeta validation failed:",u.error.format()),null)}function validateTokenEntry(y,u){if(!y.startsWith("_")||y==="_meta"||y==="_nametag"||y==="_integrity")return{valid:!1,error:"Invalid token key"};const g=TxfTokenSchema.safeParse(u);return g.success?{valid:!0,token:g.data}:{valid:!1,error:g.error.message}}function tokenToTxf(y){if(!y.jsonData)return console.warn(`Token ${y.id} has no jsonData, skipping TXF conversion`),null;try{const u=JSON.parse(y.jsonData);if(!u.genesis||!u.state)return console.warn(`Token ${y.id} jsonData is not in TXF format`,{hasGenesis:!!u.genesis,hasState:!!u.state,topLevelKeys:Object.keys(u),genesisKeys:u.genesis?Object.keys(u.genesis):[]}),null;u.version||(u.version="2.0"),u.transactions||(u.transactions=[]),u.nametags||(u.nametags=[]),u._integrity||(u._integrity={genesisDataJSONHash:computeGenesisHash(u.genesis.data)});const g=safeParseTxfToken(u);return g||(console.warn(`Token ${y.id}: Zod validation failed, using unvalidated data`),u)}catch(u){return console.error(`Failed to parse token ${y.id} jsonData:`,u),null}}function computeGenesisHash(y){return"0000"+"0".repeat(60)}function txfToToken(y,u){const g=u.genesis.data.coinData,v=g.reduce((A,[,$])=>A+BigInt($||"0"),BigInt(0));let b=g[0]?.[0]||"";for(const[A,$]of g)if(BigInt($||"0")>0){b=A;break}let w=TokenStatus.CONFIRMED;u.transactions.length>0&&u.transactions[u.transactions.length-1].inclusionProof===null&&(w=TokenStatus.PENDING);const S=u.genesis.data.tokenType==="455ad8720656b08e8dbd5bac1f3c73eeea5431565f6c1c3af742b1aa12d41d89";return new Token$3({id:y,name:S?"NFT":"Token",type:S?"NFT":"UCT",timestamp:Date.now(),jsonData:JSON.stringify(u),status:w,amount:v.toString(),coinId:b,symbol:S?"NFT":"UCT",sizeBytes:JSON.stringify(u).length})}function buildTxfStorageData(y,u,g,v,b,w,E){const S={_meta:{...u,formatVersion:"2.0"}};g&&(S._nametag=g),v&&v.length>0&&(S._tombstones=v),E&&E.length>0&&(S._outbox=E);for(const A of y){const $=tokenToTxf(A);if($){const R=$.genesis.data.tokenId;S[keyFromTokenId(R)]=$}}if(b&&b.size>0)for(const[A,$]of b)S[archivedKeyFromTokenId(A)]=$;if(w&&w.size>0)for(const[A,$]of w){const[R,T]=A.split("_");R&&T&&(S[forkedKeyFromTokenIdAndState(R,T)]=$)}return S}function parseTxfStorageData(y){const u={tokens:[],meta:null,nametag:null,tombstones:[],archivedTokens:new Map,forkedTokens:new Map,outboxEntries:[],validationErrors:[]};if(!y||typeof y!="object")return u.validationErrors.push("Storage data is not an object"),u;const g=y;if(g._meta){const v=safeParseTxfMeta(g._meta);v?u.meta=v:(u.validationErrors.push("Invalid _meta structure"),typeof g._meta=="object"&&(u.meta=g._meta))}if(g._nametag&&typeof g._nametag=="object"&&(u.nametag=g._nametag),g._tombstones&&Array.isArray(g._tombstones))for(const v of g._tombstones)typeof v=="object"&&v!==null&&typeof v.tokenId=="string"&&typeof v.stateHash=="string"&&typeof v.timestamp=="number"&&u.tombstones.push(v);if(g._outbox&&Array.isArray(g._outbox))for(const v of g._outbox)typeof v=="object"&&v!==null&&typeof v.id=="string"&&typeof v.status=="string"&&typeof v.sourceTokenId=="string"&&typeof v.salt=="string"&&typeof v.commitmentJson=="string"?u.outboxEntries.push(v):u.validationErrors.push("Invalid outbox entry structure");for(const v of Object.keys(g))if(isTokenKey(v)){const b=tokenIdFromKey(v),w=validateTokenEntry(v,g[v]);if(w.valid&&w.token)try{const E=txfToToken(b,w.token);u.tokens.push(E)}catch(E){u.validationErrors.push(`Token ${b}: conversion failed - ${E}`)}else{u.validationErrors.push(`Token ${b}: ${w.error||"validation failed"}`);try{const E=g[v];if(E?.genesis?.data?.tokenId){const S=txfToToken(b,E);u.tokens.push(S),console.warn(`Token ${b} loaded with fallback (failed Zod validation)`)}}catch{}}}else if(isArchivedKey(v)){const b=tokenIdFromArchivedKey(v);try{const w=g[v];w?.genesis?.data?.tokenId&&u.archivedTokens.set(b,w)}catch{u.validationErrors.push(`Archived token ${b}: invalid structure`)}}else if(isForkedKey(v)){const b=parseForkedKey(v);if(b)try{const w=g[v];if(w?.genesis?.data?.tokenId){const E=`${b.tokenId}_${b.stateHash}`;u.forkedTokens.set(E,w)}}catch{u.validationErrors.push(`Forked token ${b.tokenId}: invalid structure`)}}return u.validationErrors.length>0&&console.warn("TXF storage data validation issues:",u.validationErrors),u}function buildTxfExportFile(y){const u={};for(const g of y){const v=tokenToTxf(g);if(v){const b=v.genesis.data.tokenId;u[keyFromTokenId(b)]=v}}return u}function parseTxfFile(y){if(!y||typeof y!="object")return{tokens:[],errors:["Content is not an object"]};const u=[],g=[],v=y;for(const b of Object.keys(v))if(isTokenKey(b)){const w=tokenIdFromKey(b),E=safeParseTxfToken(v[b]);if(E)try{const S=txfToToken(w,E);u.push(S)}catch(S){g.push(`Token ${w}: conversion failed - ${S}`)}else{g.push(`Token ${w}: Zod validation failed, trying fallback`);try{const S=v[b];if(S?.genesis?.data?.tokenId){const A=txfToToken(w,S);u.push(A)}}catch(S){g.push(`Token ${w}: fallback also failed - ${S}`)}}}return g.length>0&&console.warn("TXF file parsing issues:",g),{tokens:u,errors:g}}function getCurrentStateHash(y){return y.transactions.length===0?y.genesis.inclusionProof.authenticator.stateHash:y.transactions[y.transactions.length-1].newStateHash}const TxfSerializer=Object.freeze(Object.defineProperty({__proto__:null,buildTxfExportFile,buildTxfStorageData,getCurrentStateHash,parseTxfFile,parseTxfStorageData,tokenToTxf,txfToToken},Symbol.toStringTag,{value:"Module"})),DEFAULT_AGGREGATOR_URL="https://alpha-aggregator.unicity.network";class TokenValidationService{aggregatorUrl;trustBaseCache=null;trustBaseCacheTime=0;TRUST_BASE_CACHE_TTL=3600*1e3;constructor(u=DEFAULT_AGGREGATOR_URL){this.aggregatorUrl=u}async validateAllTokens(u,g){const v=[],b=[],w=g?.batchSize??5,E=u.length;let S=0;for(let A=0;A<u.length;A+=w){const $=u.slice(A,A+w),R=await Promise.allSettled($.map(async T=>{try{const O=await this.validateToken(T);return{token:T,result:O}}catch(O){return{token:T,result:{isValid:!1,reason:O instanceof Error?O.message:String(O)}}}}));for(const T of R)if(S++,T.status==="fulfilled"){const{token:O,result:B}=T.value;B.isValid&&B.token?v.push(B.token):b.push({tokenId:O.id,reason:B.reason||"Unknown validation error",recoverable:!1})}else b.push({tokenId:$[R.indexOf(T)]?.id||"unknown",reason:String(T.reason),recoverable:!1});g?.onProgress&&g.onProgress(S,E)}return{validTokens:v,issues:b}}async validateToken(u){if(!u.jsonData)return{isValid:!1,reason:"Token has no jsonData field"};let g;try{g=JSON.parse(u.jsonData)}catch{return{isValid:!1,reason:"Failed to parse token jsonData as JSON"}}if(!this.hasValidTxfStructure(g))return{isValid:!1,reason:"Token jsonData missing required TXF fields (genesis, state)"};const v=this.getUncommittedTransactions(g);if(v.length>0){console.log(` Token ${u.id} has ${v.length} uncommitted transaction(s), attempting to fetch proofs...`);const b=await this.fetchMissingProofs(u);return b?(console.log(` Token ${u.id} proofs recovered successfully`),{isValid:!0,token:b}):{isValid:!1,reason:`${v.length} uncommitted transaction(s), could not fetch proofs from aggregator`}}try{const b=await this.verifyWithSdk(g);if(!b.success)return{isValid:!1,reason:b.error||"SDK verification failed"}}catch(b){console.warn(` SDK verification skipped for token ${u.id}:`,b instanceof Error?b.message:b)}return{isValid:!0,token:u}}async fetchMissingProofs(u){if(!u.jsonData)return null;let g;try{g=JSON.parse(u.jsonData)}catch{return null}const v=g.transactions;if(!v||v.length===0)return null;let b=!1;for(let w=0;w<v.length;w++){const E=v[w];if(E.inclusionProof===null)try{const S=await this.fetchProofFromAggregator(E.newStateHash);S&&(v[w]={...E,inclusionProof:S},b=!0)}catch(S){console.warn(` Failed to fetch proof for transaction ${w}:`,S instanceof Error?S.message:S)}}return b?new Token$3({...u,jsonData:JSON.stringify(g),status:TokenStatus.CONFIRMED}):null}async isPendingTransactionSubmittable(u,g){const v=tokenToTxf(u);if(!v)return{submittable:!1,reason:"Invalid token",action:"DISCARD_FORK"};const b=v.transactions[g];if(!b)return{submittable:!1,reason:"Transaction index out of bounds",action:"DISCARD_FORK"};if(b.inclusionProof!==null)return{submittable:!0,action:"ACCEPT"};let w;if(g===0)w=v.genesis.inclusionProof.authenticator.stateHash;else{const A=v.transactions[g-1];if(!A)return{submittable:!1,reason:"Previous transaction not found",action:"DISCARD_FORK"};w=A.newStateHash}const E=await this.getTrustBase();if(!E)return{submittable:!0,reason:"Cannot verify - trust base unavailable",action:"RETRY_LATER"};let S;try{const{ServiceProvider:A}=await __vitePreload(async()=>{const{ServiceProvider:$}=await Promise.resolve().then(()=>ServiceProvider$1);return{ServiceProvider:$}},void 0);S=A.stateTransitionClient}catch{return{submittable:!0,reason:"Cannot verify - client unavailable",action:"RETRY_LATER"}}if(!S)return{submittable:!0,reason:"Cannot verify - client is null",action:"RETRY_LATER"};try{const{Token:A}=await __vitePreload(async()=>{const{Token:F}=await Promise.resolve().then(()=>Token$2);return{Token:F}},void 0),$=await A.fromJSON(v),{IdentityManager:R}=await __vitePreload(async()=>{const{IdentityManager:F}=await Promise.resolve().then(()=>IdentityManager$1);return{IdentityManager:F}},void 0),T=await R.getInstance().getCurrentIdentity();if(!T?.publicKey)return{submittable:!0,reason:"Cannot verify - no identity",action:"RETRY_LATER"};const O=Buffer.from(T.publicKey,"hex");return await S.isTokenStateSpent(E,$,O)?{submittable:!1,reason:`Source state ${w.slice(0,12)}... already spent - transaction can never be committed`,action:"DISCARD_FORK"}:{submittable:!0,action:"ACCEPT"}}catch(A){return console.warn(" isPendingTransactionSubmittable: Error checking state:",A),{submittable:!0,reason:`Verification error: ${A instanceof Error?A.message:String(A)}`,action:"RETRY_LATER"}}}async checkAllPendingTransactions(u){const g=tokenToTxf(u);if(!g)return{pendingCount:0,submittable:0,dead:0,deadTransactions:[]};let v=0,b=0,w=0;const E=[];for(let S=0;S<g.transactions.length;S++)if(g.transactions[S].inclusionProof===null){v++;const $=await this.isPendingTransactionSubmittable(u,S);$.submittable?b++:(w++,E.push({index:S,reason:$.reason||"Unknown"}))}return{pendingCount:v,submittable:b,dead:w,deadTransactions:E}}async validateSplitTokens(u){const g=[],v=[],b=[];for(const w of u){const E=tokenToTxf(w);if(!E){v.push(w),b.push({tokenId:w.id,reason:"Invalid TXF structure"});continue}const A=E.genesis?.data?.reason;if(!A){g.push(w);continue}let $=null;if(typeof A=="string"){if(A.startsWith("SPLIT_MINT:"))$=A.substring(11);else if(A.startsWith("{"))try{const T=JSON.parse(A);T.splitMintReason?.burnTransactionHash?$=T.splitMintReason.burnTransactionHash:T.burnTransactionHash&&($=T.burnTransactionHash)}catch{}}if(!$){g.push(w);continue}console.log(` Validating split token ${w.id.slice(0,8)}... (burn hash: ${$.slice(0,12)}...)`);const R=await this.checkBurnTransactionCommitted($);R.committed?(g.push(w),console.log(` Split token ${w.id.slice(0,8)}... is VALID (burn committed)`)):(v.push(w),b.push({tokenId:w.id,reason:R.error||"Burn transaction not committed - split token invalid"}),console.warn(` Split token ${w.id.slice(0,8)}... is INVALID: ${R.error}`))}return console.log(` Split token validation: ${g.length} valid, ${v.length} invalid`),{valid:g,invalid:v,errors:b}}async checkBurnTransactionCommitted(u){if(!await this.getTrustBase())return{committed:!0,error:"Cannot verify - trust base unavailable"};try{return await this.fetchProofFromAggregator(u)?{committed:!0}:{committed:!1,error:"Burn transaction proof not found - may be pending or rejected"}}catch(v){return{committed:!1,error:`Failed to verify burn: ${v instanceof Error?v.message:String(v)}`}}}identifySplitTokens(u){const g=[],v=[];for(const b of u){const w=tokenToTxf(b);if(!w){v.push(b);continue}const E=w.genesis?.data?.reason;E&&(typeof E=="string"&&E.startsWith("SPLIT_MINT:")||typeof E=="string"&&E.includes("burnTransactionHash"))?g.push(b):v.push(b)}return{splitTokens:g,regularTokens:v}}async checkUnspentTokens(u,g){if(u.size===0)return[];const v=[];console.log(` Sanity check: Verifying ${u.size} token(s) with aggregator...`);const b=await this.getTrustBase();if(!b)return console.warn(" Sanity check: Trust base not available, assuming all tokens unspent (safe fallback)"),[...u.keys()];let w;try{const{ServiceProvider:E}=await __vitePreload(async()=>{const{ServiceProvider:S}=await Promise.resolve().then(()=>ServiceProvider$1);return{ServiceProvider:S}},void 0);w=E.stateTransitionClient}catch{return console.warn(" Sanity check: StateTransitionClient not available, assuming all tokens unspent"),[...u.keys()]}if(!w)return console.warn(" Sanity check: StateTransitionClient is null, assuming all tokens unspent"),[...u.keys()];for(const[E,S]of u)try{const{Token:A}=await __vitePreload(async()=>{const{Token:O}=await Promise.resolve().then(()=>Token$2);return{Token:O}},void 0),$=await A.fromJSON(S),R=Buffer.from(g,"hex");await w.isTokenStateSpent(b,$,R)?console.log(` Token ${E.slice(0,8)}... is SPENT`):(v.push(E),console.log(` Token ${E.slice(0,8)}... is NOT spent`))}catch(A){console.warn(` Sanity check: Error checking token ${E.slice(0,8)}...:`,A),v.push(E)}return console.log(` Sanity check result: ${v.length} unspent, ${u.size-v.length} spent`),v}async checkSpentTokens(u,g,v){const b=[],w=[],E=v?.batchSize??3,S=u.length;let A=0;const $=await this.getTrustBase();if(!$)return console.warn(" Sanity check: Trust base not available, skipping"),{spentTokens:[],errors:["Trust base not available"]};let R;try{const{ServiceProvider:T}=await __vitePreload(async()=>{const{ServiceProvider:O}=await Promise.resolve().then(()=>ServiceProvider$1);return{ServiceProvider:O}},void 0);R=T.stateTransitionClient}catch{return console.warn(" Sanity check: StateTransitionClient not available"),{spentTokens:[],errors:["StateTransitionClient not available"]}}for(let T=0;T<u.length;T+=E){const O=u.slice(T,T+E),B=await Promise.allSettled(O.map(async F=>{try{return await this.checkSingleTokenSpent(F,g,$,R)}catch(U){return{tokenId:F.id,localId:F.id,stateHash:"",spent:!1,error:U instanceof Error?U.message:String(U)}}}));for(const F of B)A++,F.status==="fulfilled"?(F.value.spent&&b.push({tokenId:F.value.tokenId,localId:F.value.localId,stateHash:F.value.stateHash}),F.value.error&&w.push(`Token ${F.value.tokenId}: ${F.value.error}`)):w.push(String(F.reason));v?.onProgress&&v.onProgress(A,S)}return{spentTokens:b,errors:w}}async checkSingleTokenSpent(u,g,v,b){if(!u.jsonData)return{tokenId:u.id,localId:u.id,stateHash:"",spent:!1,error:"No jsonData"};let w;try{w=JSON.parse(u.jsonData)}catch{return{tokenId:u.id,localId:u.id,stateHash:"",spent:!1,error:"Invalid JSON"}}const E=w.genesis?.data?.tokenId||u.id,S=getCurrentStateHash(w);try{const{Token:A}=await __vitePreload(async()=>{const{Token:O}=await Promise.resolve().then(()=>Token$2);return{Token:O}},void 0),$=await A.fromJSON(w),R=Buffer.from(g,"hex"),T=await b.isTokenStateSpent(v,$,R);return{tokenId:E,localId:u.id,stateHash:S,spent:T===!0}}catch(A){return{tokenId:E,localId:u.id,stateHash:S,spent:!1,error:A instanceof Error?A.message:String(A)}}}hasValidTxfStructure(u){if(!u||typeof u!="object")return!1;const g=u;return!!(g.genesis&&typeof g.genesis=="object"&&g.state&&typeof g.state=="object")}getUncommittedTransactions(u){const v=u.transactions;return!v||!Array.isArray(v)?[]:v.filter(b=>b.inclusionProof===null)}async fetchProofFromAggregator(u){try{const g=await fetch(`${this.aggregatorUrl}/proof`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:"getInclusionProof",params:{stateHash:u},id:Date.now()})});if(!g.ok)return null;const v=await g.json();return v.error||!v.result?null:v.result}catch{return null}}async verifyWithSdk(u){try{const{Token:g}=await __vitePreload(async()=>{const{Token:E}=await Promise.resolve().then(()=>Token$2);return{Token:E}},void 0),v=await g.fromJSON(u),b=await this.getTrustBase();if(!b)return{success:!0};const w=await v.verify(b);return w.isSuccessful?{success:!0}:{success:!1,error:String(w)||"Verification failed"}}catch{return{success:!0}}}async getTrustBase(){if(this.trustBaseCache&&Date.now()-this.trustBaseCacheTime<this.TRUST_BASE_CACHE_TTL)return this.trustBaseCache;try{const{ServiceProvider:u}=await __vitePreload(async()=>{const{ServiceProvider:v}=await Promise.resolve().then(()=>ServiceProvider$1);return{ServiceProvider:v}},void 0),g=u.getRootTrustBase();return this.trustBaseCache=g,this.trustBaseCacheTime=Date.now(),g}catch(u){return console.warn(" Failed to get trust base from ServiceProvider:",u),null}}}let validationServiceInstance=null;function getTokenValidationService(){return validationServiceInstance||(validationServiceInstance=new TokenValidationService),validationServiceInstance}class ConflictResolutionService{resolveConflict(u,g){const v=u._meta.version,b=g._meta.version;console.log(` Resolving conflict: local v${v} vs remote v${b}`);let w,E,S,A;b>v?(w={...g._meta,version:b+1},E=this.extractTokens(g),S=this.extractTokens(u),A=!1,console.log(" Remote is newer, using remote as base")):v>b?(w={...u._meta,version:v+1},E=this.extractTokens(u),S=this.extractTokens(g),A=!0,console.log(" Local is newer, using local as base")):(w={...u._meta,version:v+1},E=this.extractTokens(u),S=this.extractTokens(g),A=!0,console.log(" Same version, using local as base (local wins on tie)"));const $=[],R=[],T=[],O=new Map(E);for(const[he,ae]of S)if(E.has(he)){const Q=E.get(he),{winner:j,resolution:z,reason:re}=this.resolveTokenConflict(A?Q:ae,A?ae:Q);O.set(he,j),z!==(A?"local":"remote")&&$.push({tokenId:he,localVersion:A?Q:ae,remoteVersion:A?ae:Q,resolution:z,reason:re})}else O.set(he,ae),R.push(he),console.log(` Adding token ${he.slice(0,8)}... from other source`);const B={_meta:w},F=u._nametag,U=g._nametag;(F||U)&&(B._nametag=this.mergeNametags(F,U));const q=u._tombstones||[],J=g._tombstones||[],ie=new Map;for(const he of[...q,...J]){const ae=`${he.tokenId}:${he.stateHash}`;ie.has(ae)||ie.set(ae,he)}const oe=[...ie.values()];oe.length>0&&(B._tombstones=oe,console.log(` Merged ${oe.length} tombstone(s) (${q.length} local + ${J.length} remote)`));const le=new Set(ie.keys());for(const[he,ae]of O){const Q=getCurrentStateHash(ae),j=`${he}:${Q}`;if(le.has(j)){console.log(` Excluding tombstoned token ${he.slice(0,8)}... (state ${Q.slice(0,12)}...) from merge`),T.push(he);continue}B[keyFromTokenId(he)]=ae}const de=this.extractArchivedTokens(u),fe=this.extractArchivedTokens(g),ye=this.mergeArchivedTokenMaps(de,fe);for(const[he,ae]of ye)B[archivedKeyFromTokenId(he)]=ae;ye.size>0&&console.log(` Merged ${ye.size} archived token(s)`);const we=this.extractForkedTokens(u),pe=this.extractForkedTokens(g),ve=this.mergeForkedTokenMaps(we,pe);for(const[he,ae]of ve){const Q=he.split("_");if(Q.length>=2){const j=Q[0],z=Q.slice(1).join("_");B[forkedKeyFromTokenIdAndState(j,z)]=ae}}return ve.size>0&&console.log(` Merged ${ve.size} forked token(s)`),console.log(` Merge complete: ${O.size-T.length} active, ${ye.size} archived, ${ve.size} forked, ${$.length} conflicts resolved, ${R.length} new, ${T.length} tombstoned`),{merged:B,conflicts:$,newTokens:R,removedTokens:T}}resolveTokenConflict(u,g){const v=u.transactions.length,b=g.transactions.length;if(v!==b)return v>b?{winner:u,resolution:"local",reason:`Longer chain (${v} vs ${b})`}:{winner:g,resolution:"remote",reason:`Longer chain (${b} vs ${v})`};const w=this.countProofs(u),E=this.countProofs(g);if(w!==E)return w>E?{winner:u,resolution:"local",reason:`More proofs (${w} vs ${E})`}:{winner:g,resolution:"remote",reason:`More proofs (${E} vs ${w})`};const S=u._integrity?.genesisDataJSONHash||"",A=g._integrity?.genesisDataJSONHash||"";return S!==A?S>A?{winner:u,resolution:"local",reason:"Deterministic tiebreaker (hash comparison)"}:{winner:g,resolution:"remote",reason:"Deterministic tiebreaker (hash comparison)"}:{winner:u,resolution:"local",reason:"Identical tokens, preferring local"}}countProofs(u){let g=0;return u.genesis?.inclusionProof&&g++,u.transactions&&(g+=u.transactions.filter(v=>v.inclusionProof!==null).length),g}extractTokens(u){const g=new Map;for(const v of Object.keys(u))if(isTokenKey(v)){const b=tokenIdFromKey(v),w=u[v];w&&w.genesis&&g.set(b,w)}return g}mergeNametags(u,g){return u&&g?u:u||g}hasConflict(u,g){return u._meta.version!==g._meta.version}isRemoteNewer(u,g){const v=u._meta.version;if(g._meta.version<=v)return!1;const w=this.extractTokens(u),E=this.extractTokens(g);for(const[S]of w)if(!E.has(S))return!1;return!0}isLocalNewer(u,g){const v=u._meta.version,b=g._meta.version;if(v<=b)return!1;const w=this.extractTokens(u),E=this.extractTokens(g);for(const[S]of E)if(!w.has(S))return!1;return!0}extractArchivedTokens(u){const g=new Map;for(const v of Object.keys(u))if(isArchivedKey(v)){const b=tokenIdFromArchivedKey(v),w=u[v];w&&w.genesis&&g.set(b,w)}return g}extractForkedTokens(u){const g=new Map;for(const v of Object.keys(u))if(isForkedKey(v)){const b=parseForkedKey(v);if(b){const w=u[v];if(w&&w.genesis){const E=`${b.tokenId}_${b.stateHash}`;g.set(E,w)}}}return g}mergeArchivedTokenMaps(u,g){const v=new Map(u);for(const[b,w]of g){const E=v.get(b);if(!E)v.set(b,w);else{const S=E.transactions?.length||0;(w.transactions?.length||0)>S&&v.set(b,w)}}return v}mergeForkedTokenMaps(u,g){const v=new Map(u);for(const[b,w]of g)v.has(b)||v.set(b,w);return v}}let conflictServiceInstance=null;function getConflictResolutionService(){return conflictServiceInstance||(conflictServiceInstance=new ConflictResolutionService),conflictServiceInstance}let coordinatorInstance=null;class SyncCoordinator{channel;instanceId;isLeader=!1;leaderId=null;leaderLastSeen=0;isSyncing=!1;syncQueue=[];heartbeatInterval=null;leaderCheckInterval=null;LEADER_TIMEOUT=1e4;HEARTBEAT_INTERVAL=3e3;LOCK_TIMEOUT=3e4;constructor(){this.instanceId=crypto.randomUUID(),this.channel=new BroadcastChannel("ipfs-sync-coordinator"),this.channel.onmessage=this.handleMessage.bind(this),this.leaderCheckInterval=setInterval(()=>this.checkLeaderLiveness(),this.LEADER_TIMEOUT/2),this.requestLeadership(),window.addEventListener("beforeunload",()=>this.cleanup()),console.log(` SyncCoordinator initialized: ${this.instanceId.slice(0,8)}...`)}static getInstance(){return coordinatorInstance||(coordinatorInstance=new SyncCoordinator),coordinatorInstance}async acquireLock(u=this.LOCK_TIMEOUT){return this.isLeader&&!this.isSyncing?(this.isSyncing=!0,this.broadcast({type:"sync-start"}),!0):new Promise(g=>{const v=setTimeout(()=>{this.syncQueue=this.syncQueue.filter(b=>b.resolve!==g),g(!1)},u);this.syncQueue.push({resolve:g,timeout:v}),this.broadcast({type:"ping"})})}releaseLock(){this.isSyncing&&(this.isSyncing=!1,this.broadcast({type:"sync-complete"}),this.processQueue())}hasLock(){return this.isLeader&&this.isSyncing}isCurrentLeader(){return this.isLeader}requestLeadership(){!this.leaderId||this.isLeaderDead()?this.becomeLeader():this.broadcast({type:"leader-request"})}becomeLeader(){this.isLeader=!0,this.leaderId=this.instanceId,this.leaderLastSeen=Date.now(),this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.heartbeatInterval=setInterval(()=>{this.broadcast({type:"heartbeat"})},this.HEARTBEAT_INTERVAL),this.broadcast({type:"leader-announce"}),console.log(` Became sync leader: ${this.instanceId.slice(0,8)}...`),this.processQueue()}isLeaderDead(){return this.leaderId?this.leaderId===this.instanceId?!1:Date.now()-this.leaderLastSeen>this.LEADER_TIMEOUT:!0}checkLeaderLiveness(){this.isLeader||this.isLeaderDead()&&(console.log(` Leader ${this.leaderId?.slice(0,8)}... appears dead, taking over`),this.becomeLeader())}processQueue(){if(!this.isLeader||this.isSyncing||this.syncQueue.length===0)return;const u=this.syncQueue.shift();u&&(clearTimeout(u.timeout),this.isSyncing=!0,this.broadcast({type:"sync-start"}),u.resolve(!0))}handleMessage(u){const g=u.data;if(g.from!==this.instanceId)switch(g.type){case"leader-announce":this.isLeader&&g.from!==this.instanceId?g.from>this.instanceId?(console.log(` Yielding leadership to ${g.from.slice(0,8)}...`),this.isLeader=!1,this.leaderId=g.from,this.leaderLastSeen=Date.now(),this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)):this.broadcast({type:"leader-announce"}):(this.leaderId=g.from,this.leaderLastSeen=Date.now(),console.log(` Acknowledged leader: ${g.from.slice(0,8)}...`));break;case"heartbeat":g.from===this.leaderId&&(this.leaderLastSeen=Date.now());break;case"leader-request":this.isLeader&&this.broadcast({type:"heartbeat"});break;case"sync-start":this.leaderLastSeen=Date.now();break;case"sync-complete":this.leaderLastSeen=Date.now(),this.isLeader&&this.processQueue();break;case"ping":this.isLeader&&this.broadcast({type:"pong"});break;case"pong":g.from===this.leaderId&&(this.leaderLastSeen=Date.now());break}}broadcast(u){this.channel.postMessage({...u,from:this.instanceId,timestamp:Date.now()})}cleanup(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.leaderCheckInterval&&clearInterval(this.leaderCheckInterval),this.isLeader&&this.broadcast({type:"sync-complete"}),this.channel.close()}shutdown(){this.cleanup(),coordinatorInstance=null,console.log(` SyncCoordinator shutdown: ${this.instanceId.slice(0,8)}...`)}}function getSyncCoordinator(){return SyncCoordinator.getInstance()}class TokenBackupService{static instance=null;BACKUP_STALE_DAYS=7;SYNC_WARNING_DAYS=3;static getInstance(){return TokenBackupService.instance||(TokenBackupService.instance=new TokenBackupService),TokenBackupService.instance}async createEncryptedBackup(u,g,v){const b=u.filter(A=>A.jsonData).map(A=>({id:A.id,jsonData:A.jsonData,coinId:A.coinId||"",amount:A.amount||"0",symbol:A.symbol||"",type:A.type})),w=await this.calculateChecksum(JSON.stringify(b)),E={metadata:{version:"1.0",timestamp:Date.now(),tokenCount:b.length,walletAddress:v,checksum:w},tokens:b},S=await this.encryptWithPassword(JSON.stringify(E),g);return this.updateBackupTimestamp(),console.log(` Backup created: ${b.length} tokens, checksum: ${w.slice(0,16)}...`),{blob:new Blob([S],{type:"application/octet-stream"}),tokenCount:b.length,checksum:w}}async restoreFromBackup(u,g){const v=[];let b;try{b=await this.decryptWithPassword(u,g)}catch{throw new Error("Failed to decrypt backup. Wrong password or corrupted file.")}let w;try{w=JSON.parse(b)}catch{throw new Error("Invalid backup format. File may be corrupted.")}if(!w.metadata||!w.tokens||!Array.isArray(w.tokens))throw new Error("Invalid backup structure");await this.calculateChecksum(JSON.stringify(w.tokens))!==w.metadata.checksum&&v.push("Checksum mismatch - backup may have been tampered with");const A=(Date.now()-w.metadata.timestamp)/(1e3*60*60*24);A>this.BACKUP_STALE_DAYS&&v.push(`Backup is ${Math.floor(A)} days old. Some tokens may have changed.`);const $=w.tokens.map(R=>new Token$3({id:R.id,name:R.type==="NFT"?"NFT":"Token",type:R.type,timestamp:w.metadata.timestamp,jsonData:R.jsonData,status:TokenStatus.CONFIRMED,amount:R.amount,coinId:R.coinId,symbol:R.symbol,sizeBytes:R.jsonData.length}));return console.log(` Backup restored: ${$.length} tokens from ${new Date(w.metadata.timestamp).toISOString()}`),{tokens:$,metadata:w.metadata,warnings:v}}async createLocalBackup(u,g,v){const{blob:b}=await this.createEncryptedBackup(u,g,v),w=await b.arrayBuffer(),E=this.arrayBufferToBase64(w);localStorage.setItem(STORAGE_KEYS.ENCRYPTED_TOKEN_BACKUP,E),console.log(" Local backup saved to localStorage")}async restoreFromLocalBackup(u){const g=localStorage.getItem(STORAGE_KEYS.ENCRYPTED_TOKEN_BACKUP);if(!g)return null;const v=this.base64ToArrayBuffer(g);return this.restoreFromBackup(v,u)}checkBackupStatus(){const u=localStorage.getItem(STORAGE_KEYS.TOKEN_BACKUP_TIMESTAMP),g=localStorage.getItem(STORAGE_KEYS.LAST_IPFS_SYNC_SUCCESS),v=Date.now(),b=u?parseInt(u,10):null,w=g?parseInt(g,10):null,E=b?(v-b)/(1e3*60*60*24):null,S=w?(v-w)/(1e3*60*60*24):null;let A=!1,$="";return b?E!==null&&E>this.BACKUP_STALE_DAYS?(A=!0,$=`Last backup was ${Math.floor(E)} days ago. Create a fresh backup!`):w?S!==null&&S>this.SYNC_WARNING_DAYS&&(A=!0,$=`No IPFS sync in ${Math.floor(S)} days. Create a backup!`):(A=!0,$="No IPFS sync recorded. Backup recommended to protect tokens."):(A=!0,$="No backup recorded. Create your first backup to protect your tokens!"),{needsBackup:A,reason:$,lastBackupTime:b,daysSinceBackup:E,lastSyncTime:w,daysSinceSync:S}}updateBackupTimestamp(){localStorage.setItem(STORAGE_KEYS.TOKEN_BACKUP_TIMESTAMP,Date.now().toString())}updateSyncTimestamp(){localStorage.setItem(STORAGE_KEYS.LAST_IPFS_SYNC_SUCCESS,Date.now().toString())}async getBackupInfo(u,g){try{const v=await this.decryptWithPassword(u,g);return JSON.parse(v).metadata}catch{return null}}async verifyBackup(u,g){try{const v=await this.decryptWithPassword(u,g),b=JSON.parse(v);if(await this.calculateChecksum(JSON.stringify(b.tokens))!==b.metadata.checksum)return{valid:!1,error:"Checksum mismatch"};for(const E of b.tokens)try{const S=JSON.parse(E.jsonData);if(!S.genesis||!S.state)return{valid:!1,error:`Token ${E.id} has invalid structure`}}catch{return{valid:!1,error:`Token ${E.id} has invalid JSON`}}return{valid:!0}}catch(v){return{valid:!1,error:v instanceof Error?v.message:String(v)}}}getBackupFilename(u){const g=new Date().toISOString().split("T")[0];return`unicity-tokens-backup-${u.slice(0,8)}-${g}.enc`}async encryptWithPassword(u,g){const v=new TextEncoder,b=crypto.getRandomValues(new Uint8Array(16)),w=crypto.getRandomValues(new Uint8Array(12)),E=await crypto.subtle.importKey("raw",v.encode(g),"PBKDF2",!1,["deriveKey"]),S=await crypto.subtle.deriveKey({name:"PBKDF2",salt:b,iterations:1e5,hash:"SHA-256"},E,{name:"AES-GCM",length:256},!1,["encrypt"]),A=await crypto.subtle.encrypt({name:"AES-GCM",iv:w},S,v.encode(u)),$=new Uint8Array(b.length+w.length+A.byteLength);return $.set(b,0),$.set(w,b.length),$.set(new Uint8Array(A),b.length+w.length),$.buffer}async decryptWithPassword(u,g){const v=new TextEncoder,b=new TextDecoder,w=new Uint8Array(u),E=w.slice(0,16),S=w.slice(16,28),A=w.slice(28),$=await crypto.subtle.importKey("raw",v.encode(g),"PBKDF2",!1,["deriveKey"]),R=await crypto.subtle.deriveKey({name:"PBKDF2",salt:E,iterations:1e5,hash:"SHA-256"},$,{name:"AES-GCM",length:256},!1,["decrypt"]),T=await crypto.subtle.decrypt({name:"AES-GCM",iv:S},R,A);return b.decode(T)}async calculateChecksum(u){const g=new TextEncoder,v=await crypto.subtle.digest("SHA-256",g.encode(u));return Array.from(new Uint8Array(v)).map(w=>w.toString(16).padStart(2,"0")).join("")}arrayBufferToBase64(u){const g=new Uint8Array(u);let v="";for(let b=0;b<g.byteLength;b++)v+=String.fromCharCode(g[b]);return btoa(v)}base64ToArrayBuffer(u){const g=atob(u),v=new Uint8Array(g.length);for(let b=0;b<g.length;b++)v[b]=g.charCodeAt(b);return v.buffer}}function getTokenBackupService(){return TokenBackupService.getInstance()}const CUSTOM_PEERS=[{host:"unicity-ipfs1.dyndns.org",peerId:"12D3KooWDKJqEMAhH4nsSSiKtK1VLcas5coUqSPZAfbWbZpxtL4u",wsPort:4002,wssPort:4003},{host:"unicity-ipfs2.dyndns.org",peerId:"12D3KooWLNi5NDPPHbrfJakAQqwBqymYTTwMQXQKEWuCrJNDdmfh",wsPort:4002,wssPort:4003},{host:"unicity-ipfs3.dyndns.org",peerId:"12D3KooWQ4aujVE4ShLjdusNZBdffq3TbzrwT2DuWZY9H1Gxhwn6",wsPort:4002,wssPort:4003},{host:"unicity-ipfs4.dyndns.org",peerId:"12D3KooWJ1ByPfUzUrpYvgxKU8NZrR8i6PU1tUgMEbQX9Hh2DEn1",wsPort:4002,wssPort:4003},{host:"unicity-ipfs5.dyndns.org",peerId:"12D3KooWB1MdZZGHN5B8TvWXntbycfe7Cjcz7n6eZ9eykZadvmDv",wsPort:4002,wssPort:4003}],DEFAULT_BOOTSTRAP_PEERS=["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"];function isPeerConfigured(y){return!!(y&&!y.startsWith("<")&&y.length>10&&(y.startsWith("12D3KooW")||y.startsWith("Qm")))}function getBootstrapPeers(){const y=typeof window<"u"&&window.location.protocol==="https:",u=CUSTOM_PEERS.filter(v=>isPeerConfigured(v.peerId)).map(v=>y&&v.wssPort?`/dns4/${v.host}/tcp/${v.wssPort}/wss/p2p/${v.peerId}`:`/dns4/${v.host}/tcp/${v.wsPort}/ws/p2p/${v.peerId}`),g=DEFAULT_BOOTSTRAP_PEERS[0];return[...u,g]}function getConfiguredCustomPeers(){return CUSTOM_PEERS.filter(y=>isPeerConfigured(y.peerId))}const IPFS_CONFIG={connectionTimeout:1e4,maxConnections:10,enableAutoSync:!0,syncIntervalMs:300*1e3},IPNS_RESOLUTION_CONFIG={initialTimeoutMs:1e4,maxWaitMs:3e4,pollingIntervalMinMs:45e3,pollingIntervalMaxMs:75e3,inactivePollingIntervalMinMs:24e4,inactivePollingIntervalMaxMs:27e4,perGatewayTimeoutMs:25e3,gatewayPathTimeoutMs:5e3};function getBackendGatewayUrl(){const y=CUSTOM_PEERS.find(g=>isPeerConfigured(g.peerId));return y?typeof window<"u"&&window.location.protocol==="https:"?`https://${y.host}`:`http://${y.host}:9080`:null}function getAllBackendGatewayUrls(){const y=typeof window<"u"&&window.location.protocol==="https:";return CUSTOM_PEERS.filter(u=>isPeerConfigured(u.peerId)).map(u=>y?`https://${u.host}`:`http://${u.host}:9080`)}function getBackendPeerId(){return CUSTOM_PEERS.find(u=>isPeerConfigured(u.peerId))?.peerId||null}hashes.sha512=y=>sha512(y);const HKDF_INFO$1="ipfs-storage-ed25519-v1",SYNC_DEBOUNCE_MS$1=5e3;class IpfsStorageService{static instance=null;helia=null;ed25519PrivateKey=null;ed25519PublicKey=null;cachedIpnsName=null;ipnsKeyPair=null;ipnsSequenceNumber=0n;identityManager;eventCallbacks=[];isInitializing=!1;isSyncing=!1;isInitialSyncing=!1;pendingSync=!1;syncTimer=null;lastSync=null;autoSyncEnabled=!1;boundSyncHandler=null;connectionMaintenanceInterval=null;ipnsPollingInterval=null;boundVisibilityHandler=null;lastKnownRemoteSequence=0n;isTabVisible=!0;currentIdentityAddress=null;constructor(u){this.identityManager=u}static getInstance(u){return IpfsStorageService.instance||(IpfsStorageService.instance=new IpfsStorageService(u)),IpfsStorageService.instance}static async resetInstance(){IpfsStorageService.instance&&(console.log(" Resetting IpfsStorageService instance for identity switch..."),await IpfsStorageService.instance.shutdown(),IpfsStorageService.instance=null)}startAutoSync(){this.autoSyncEnabled||(this.boundSyncHandler=()=>this.scheduleSync(),window.addEventListener("wallet-updated",this.boundSyncHandler),this.autoSyncEnabled=!0,console.log(" IPFS auto-sync enabled"),this.setupVisibilityListener(),this.syncFromIpns().catch(console.error))}async shutdown(){this.boundSyncHandler&&(window.removeEventListener("wallet-updated",this.boundSyncHandler),this.boundSyncHandler=null),this.autoSyncEnabled=!1,this.cleanupVisibilityListener(),this.syncTimer&&(clearTimeout(this.syncTimer),this.syncTimer=null),this.connectionMaintenanceInterval&&(clearInterval(this.connectionMaintenanceInterval),this.connectionMaintenanceInterval=null),this.helia&&(await this.helia.stop(),this.helia=null),console.log(" IPFS storage service stopped")}onEvent(u){return this.eventCallbacks.push(u),()=>{this.eventCallbacks=this.eventCallbacks.filter(g=>g!==u)}}async emitEvent(u){if(window.dispatchEvent(new CustomEvent("ipfs-storage-event",{detail:u})),u.type==="storage:completed")try{getTokenBackupService().updateSyncTimestamp()}catch{}for(const g of this.eventCallbacks)try{await g(u)}catch(v){console.error(" Storage event callback error:",v)}}emitSyncStateChange(){const u=this.isSyncing||this.isInitialSyncing;console.log(` Sync state changed: isSyncing=${u}`),window.dispatchEvent(new CustomEvent("ipfs-storage-event",{detail:{type:"sync:state-changed",timestamp:Date.now(),data:{isSyncing:u}}}))}isWebCryptoAvailable(){try{return typeof crypto<"u"&&crypto.subtle!==void 0&&typeof crypto.subtle.digest=="function"}catch{return!1}}async ensureInitialized(){const u=await this.identityManager.getCurrentIdentity();if(!u)return console.warn(" No wallet identity - skipping IPFS init"),!1;if(this.currentIdentityAddress&&this.currentIdentityAddress!==u.address&&(console.log(` Identity changed: ${this.currentIdentityAddress.slice(0,20)}...  ${u.address.slice(0,20)}...`),console.log(" Clearing cached IPNS keys for re-derivation"),this.ed25519PrivateKey=null,this.ed25519PublicKey=null,this.ipnsKeyPair=null,this.cachedIpnsName=null,this.ipnsSequenceNumber=0n),this.helia&&this.ed25519PrivateKey)return!0;if(this.isInitializing)return await new Promise(g=>setTimeout(g,100)),this.ensureInitialized();this.isInitializing=!0;try{if(!this.isWebCryptoAvailable())return console.warn(" WebCrypto (crypto.subtle) not available - IPFS sync disabled"),console.warn(" This typically happens in non-secure contexts (HTTP instead of HTTPS)"),console.warn(" Wallet will continue to work, but IPFS backup/sync is unavailable"),!1;const g=this.hexToBytes(u.privateKey),v=hkdf(sha256,g,void 0,HKDF_INFO$1,32);this.ed25519PrivateKey=v,this.ed25519PublicKey=getPublicKey(v),this.ipnsKeyPair=await generateKeyPairFromSeed("Ed25519",v);const b=peerIdFromPrivateKey(this.ipnsKeyPair),w=`ipns-${this.bytesToHex(this.ed25519PublicKey).slice(0,32)}`,E=b.toString();this.cachedIpnsName=E,this.currentIdentityAddress=u.address,this.migrateStorageKeys(w,E),this.ipnsSequenceNumber=this.getIpnsSequenceNumber();const S=getBootstrapPeers(),A=getConfiguredCustomPeers().length;console.log(" Initializing Helia with restricted peer connections..."),console.log(` Bootstrap peers: ${S.length} total (${A} custom, ${S.length-A} fallback)`);const $=this.createConnectionGater(S);this.helia=await createHelia({libp2p:{connectionGater:$,peerDiscovery:[bootstrap({list:S})],connectionManager:{maxConnections:IPFS_CONFIG.maxConnections}}});const R=this.helia.libp2p.peerId.toString();console.log(" IPFS storage service initialized"),console.log(" Browser Peer ID:",R),console.log(" IPNS name:",this.cachedIpnsName),console.log(" Identity address:",u.address.slice(0,30)+"...");const T=new Set(S.map(O=>{const B=O.match(/\/p2p\/([^/]+)$/);return B?B[1]:null}).filter(Boolean));return this.helia.libp2p.addEventListener("peer:connect",O=>{const B=O.detail.toString();T.has(B)&&console.log(` Connected to bootstrap peer: ${B.slice(0,16)}...`)}),this.helia.libp2p.addEventListener("peer:disconnect",O=>{const B=O.detail.toString();T.has(B)&&console.log(` Disconnected from bootstrap peer: ${B.slice(0,16)}...`)}),setTimeout(()=>{const O=this.helia?.libp2p.getConnections()||[];console.log(` Active connections: ${O.length}`),O.slice(0,5).forEach(B=>{console.log(`   - ${B.remotePeer.toString().slice(0,16)}... via ${B.remoteAddr.toString()}`)})},5e3),this.startBackendConnectionMaintenance(),!0}catch(g){return console.error(" Failed to initialize IPFS storage:",g),g instanceof Error&&g.message.includes("crypto")&&(console.warn(" This error is likely due to missing WebCrypto support"),console.warn(" Consider using HTTPS or a secure development environment")),!1}finally{this.isInitializing=!1}}hexToBytes(u){const g=new Uint8Array(u.length/2);for(let v=0;v<g.length;v++)g[v]=parseInt(u.substr(v*2,2),16);return g}bytesToHex(u){return Array.from(u).map(g=>g.toString(16).padStart(2,"0")).join("")}migrateStorageKeys(u,g){if(u===g)return;const v=`${STORAGE_KEY_PREFIXES.IPFS_VERSION}${u}`,b=`${STORAGE_KEY_PREFIXES.IPFS_VERSION}${g}`,w=localStorage.getItem(v);w&&!localStorage.getItem(b)&&(localStorage.setItem(b,w),localStorage.removeItem(v),console.log(` Migrated version key: ${u} -> ${g}`));const E=`${STORAGE_KEY_PREFIXES.IPFS_LAST_CID}${u}`,S=`${STORAGE_KEY_PREFIXES.IPFS_LAST_CID}${g}`,A=localStorage.getItem(E);A&&!localStorage.getItem(S)&&(localStorage.setItem(S,A),localStorage.removeItem(E),console.log(` Migrated CID key: ${u} -> ${g}`))}createConnectionGater(u){const g=new Set(u.map(v=>{const b=v.match(/\/p2p\/([^/]+)$/);return b?b[1]:null}).filter(v=>v!==null));return console.log(` Connection gater: allowing ${g.size} peer(s)`),{denyDialMultiaddr:async()=>!1,denyDialPeer:async v=>{const b=v.toString(),w=!g.has(b);return w&&console.debug(` Blocked dial to non-bootstrap peer: ${b.slice(0,16)}...`),w},denyInboundConnection:async()=>!1,denyOutboundConnection:async v=>{const b=v.toString();return!g.has(b)},denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0}}getIpnsSequenceNumber(){if(!this.cachedIpnsName)return 0n;const u=`${STORAGE_KEY_PREFIXES.IPNS_SEQ}${this.cachedIpnsName}`,g=localStorage.getItem(u);return g?BigInt(g):0n}setIpnsSequenceNumber(u){if(!this.cachedIpnsName)return;const g=`${STORAGE_KEY_PREFIXES.IPNS_SEQ}${this.cachedIpnsName}`;localStorage.setItem(g,u.toString())}async publishIpnsViaHttp(u){const g=getAllBackendGatewayUrls();if(g.length===0)return console.warn(" No backend gateways configured for HTTP IPNS publish"),!1;const v=this.cachedIpnsName;if(!v)return console.warn(" No IPNS name cached - cannot publish via HTTP"),!1;console.log(` Publishing IPNS via HTTP to ${g.length} backend(s)...`);const w=(await Promise.allSettled(g.map(async E=>{try{const S=new FormData;S.append("file",new Blob([new Uint8Array(u)]),"record");const A=await fetch(`${E}/api/v0/routing/put?arg=/ipns/${v}&allow-offline=true`,{method:"POST",body:S,signal:AbortSignal.timeout(3e4)});if(!A.ok){const R=await A.text().catch(()=>"");throw new Error(`HTTP ${A.status}: ${R.slice(0,100)}`)}const $=new URL(E).hostname;return console.log(` IPNS record accepted by ${$}`),E}catch(S){const A=new URL(E).hostname;throw console.warn(` HTTP IPNS publish to ${A} failed:`,S),S}}))).filter(E=>E.status==="fulfilled");return w.length>0?(console.log(` IPNS record published via HTTP to ${w.length}/${g.length} backends`),!0):(console.warn(" HTTP IPNS publish failed on all backends"),!1)}publishIpnsViaDhtAsync(u,g){if(!this.helia)return;const v=this.helia,b=6e4;(async()=>{try{await Promise.race([v.routing.put(u,g),new Promise((w,E)=>setTimeout(()=>E(new Error("DHT background timeout")),b))]),console.log(" IPNS record also propagated via browser DHT")}catch(w){console.debug(" Browser DHT IPNS publish completed with:",w)}})()}async publishToIpns(u){if(!this.helia||!this.ipnsKeyPair)return console.warn(" IPNS key not initialized - skipping IPNS publish"),null;const g=99*365*24*60*60*1e3,v=this.ipnsKeyPair;try{console.log(` Publishing to IPNS: ${this.cachedIpnsName?.slice(0,16)}... -> ${u.toString().slice(0,16)}...`);const b=this.ipnsSequenceNumber>this.lastKnownRemoteSequence?this.ipnsSequenceNumber:this.lastKnownRemoteSequence;this.ipnsSequenceNumber=b+1n,console.log(` IPNS sequence: local=${this.ipnsSequenceNumber-1n}, remote=${this.lastKnownRemoteSequence}, using=${this.ipnsSequenceNumber}`);const w=await createIPNSRecord(v,`/ipfs/${u.toString()}`,this.ipnsSequenceNumber,g),E=marshalIPNSRecord(w),S=multihashToIPNSRoutingKey(v.publicKey.toMultihash()),A=await this.publishIpnsViaHttp(E);return this.publishIpnsViaDhtAsync(S,E),A?(this.setIpnsSequenceNumber(this.ipnsSequenceNumber),console.log(` IPNS record published successfully (seq: ${this.ipnsSequenceNumber})`),this.cachedIpnsName):(console.warn(" HTTP IPNS publish failed, DHT attempting in background"),null)}catch(b){return this.ipnsSequenceNumber--,console.warn(" IPNS publish failed:",b),null}}async resolveIpnsFromGateway(u){if(!this.cachedIpnsName)return null;try{const g=new AbortController,v=setTimeout(()=>g.abort(),IPNS_RESOLUTION_CONFIG.perGatewayTimeoutMs),b=await fetch(`${u}/api/v0/routing/get?arg=/ipns/${this.cachedIpnsName}`,{method:"POST",signal:g.signal});if(clearTimeout(v),!b.ok)return console.debug(` Gateway ${new URL(u).hostname} returned ${b.status}`),null;const w=await b.json();if(!w.Extra)return console.debug(` Gateway ${new URL(u).hostname} returned no Extra field`),null;const E=Uint8Array.from(atob(w.Extra),$=>$.charCodeAt(0)),S=unmarshalIPNSRecord(E),A=S.value.match(/^\/ipfs\/(.+)$/);return A?{cid:A[1],sequence:S.sequence,gateway:u,recordData:E}:(console.debug(` Gateway ${new URL(u).hostname} returned invalid IPNS value: ${S.value}`),null)}catch(g){const v=new URL(u).hostname;return g instanceof Error&&g.name==="AbortError"?console.debug(` Gateway ${v} timeout`):console.debug(` Gateway ${v} error:`,g),null}}async resolveIpnsViaGatewayPath(u){if(!this.cachedIpnsName)return null;const g=Date.now(),v=new AbortController,b=setTimeout(()=>v.abort(),IPNS_RESOLUTION_CONFIG.gatewayPathTimeoutMs);try{const w=`${u}/ipns/${this.cachedIpnsName}?format=dag-json`,E=await fetch(w,{signal:v.signal,headers:{Accept:"application/vnd.ipld.dag-json, application/json"}});if(clearTimeout(b),!E.ok)return null;const $=E.headers.get("X-Ipfs-Path")?.match(/^\/ipfs\/(.+)$/)?.[1]||"",R=await E.json(),T=Date.now()-g;return $||console.debug(` Gateway ${new URL(u).hostname} returned no X-Ipfs-Path header`),{cid:$,content:R,latency:T}}catch(w){clearTimeout(b);const E=new URL(u).hostname;return w instanceof Error&&w.name==="AbortError"?console.debug(` Gateway path ${E} timeout`):console.debug(` Gateway path ${E} error:`,w),null}}async resolveIpnsProgressively(u){const g=getAllBackendGatewayUrls();if(g.length===0||!this.cachedIpnsName)return{best:null,allResults:[],respondedCount:0,totalGateways:0};console.log(` Racing IPNS resolution from ${g.length} gateways (gateway path + routing API)...`);const v=[],b=new Map,w=g.map(async T=>{const O=new URL(T).hostname,B=this.resolveIpnsViaGatewayPath(T),F=this.resolveIpnsFromGateway(T),[U,q]=await Promise.allSettled([B,F]);let J=null,ie=null;if(U.status==="fulfilled"&&U.value){const{cid:oe,content:le,latency:de}=U.value;oe&&(J=oe,ie=le,b.set(T,{cid:oe,content:le,latency:de}),console.log(` Gateway path ${O}: CID=${oe.slice(0,16)}... (${de}ms)`))}if(q.status==="fulfilled"&&q.value){const oe=q.value;return ie&&J===oe.cid&&(oe._cachedContent=ie),v.push(oe),console.log(` Routing API ${O}: seq=${oe.sequence}, CID=${oe.cid.slice(0,16)}...`),oe}if(J&&ie){const oe={cid:J,sequence:0n,gateway:T,recordData:new Uint8Array,_cachedContent:ie};return v.push(oe),console.log(` Gateway path only ${O}: CID=${J.slice(0,16)}... (seq unknown)`),oe}return null});await Promise.race([Promise.allSettled(w),new Promise(T=>setTimeout(T,IPNS_RESOLUTION_CONFIG.initialTimeoutMs))]);const E=T=>{if(T.length===0)return null;const O=T.filter(F=>F.sequence>0n);return O.length>0?O.reduce((F,U)=>U.sequence>F.sequence?U:F):T.find(F=>F._cachedContent)||T[0]},S=E(v),A=v.length,$=S?.sequence??0n,R=!!S?._cachedContent;return console.log(` Initial timeout: ${A}/${g.length} responded, best seq=${$.toString()}, hasContent=${R}`),u&&A<g.length&&Promise.allSettled(w).then(()=>{const T=E(v);T&&T.sequence>$&&(console.log(` Late response with higher sequence: seq=${T.sequence} from ${new URL(T.gateway).hostname} (was seq=${$})`),u(T))}),{best:S,allResults:[...v],respondedCount:A,totalGateways:g.length}}async handleHigherSequenceDiscovered(u){if(console.log(` Handling higher sequence discovery: seq=${u.sequence}, cid=${u.cid.slice(0,16)}...`),this.isSyncing){console.log(" Sync in progress, deferring higher sequence handling");return}this.lastKnownRemoteSequence=u.sequence;const g=await this.fetchRemoteContent(u.cid);if(!g){console.warn(` Failed to fetch content for higher sequence CID: ${u.cid.slice(0,16)}...`);return}const v=this.getVersionCounter(),b=g._meta.version;if(b>v){console.log(` Remote version ${b} > local ${v}, importing...`);const w=await this.importRemoteData(g);this.setVersionCounter(b),this.setLastCid(u.cid),console.log(` Imported ${w} token(s) from late-arriving higher sequence`),await this.emitEvent({type:"storage:completed",timestamp:Date.now(),data:{cid:u.cid,tokenCount:w}}),window.dispatchEvent(new Event("wallet-updated"))}else{console.log(` Remote version ${b} not newer than local ${v}, checking for new tokens...`);const w=await this.importRemoteData(g);w>0&&(console.log(` Imported ${w} new token(s) from remote despite lower version`),window.dispatchEvent(new Event("wallet-updated"))),this.localDiffersFromRemote(g)?(console.log(" Local differs from remote, scheduling sync to publish merged state"),this.scheduleSync(),await this.emitEvent({type:"storage:completed",timestamp:Date.now(),data:{cid:u.cid,tokenCount:w}})):(console.log(" Local now matches remote after import, no sync needed"),this.setLastCid(u.cid),this.setVersionCounter(b))}}startIpnsPolling(){if(this.ipnsPollingInterval)return;const u=async()=>{if(!this.cachedIpnsName||this.isSyncing)return;console.log(" IPNS poll: checking for remote updates...");const w=await this.resolveIpnsProgressively();if(w.best){const E=this.ipnsSequenceNumber,S=w.best.sequence>E&&w.best.sequence>this.lastKnownRemoteSequence,A=this.getLastCid(),$=A&&w.best.cid!==A&&w.best.sequence>=E;S?(console.log(` IPNS poll detected higher sequence: remote=${w.best.sequence}, local=${E}`),await this.handleHigherSequenceDiscovered(w.best)):$?(console.log(` IPNS poll detected different CID at same sequence: remote=${w.best.cid.slice(0,16)}... != local=${A?.slice(0,16)}...`),await this.handleHigherSequenceDiscovered(w.best)):console.log(` IPNS poll: no updates (remote seq=${w.best.sequence}, local seq=${E}, cid match=${w.best.cid===A})`)}await this.runSpentTokenSanityCheck()},g=()=>{const w=IPNS_RESOLUTION_CONFIG,E=this.isTabVisible?w.pollingIntervalMinMs:w.inactivePollingIntervalMinMs,S=this.isTabVisible?w.pollingIntervalMaxMs:w.inactivePollingIntervalMaxMs;return E+Math.random()*(S-E)},v=()=>{const w=g();this.ipnsPollingInterval=setTimeout(async()=>{await u(),v()},w)};v();const b=this.isTabVisible?`${IPNS_RESOLUTION_CONFIG.pollingIntervalMinMs/1e3}-${IPNS_RESOLUTION_CONFIG.pollingIntervalMaxMs/1e3}s`:`${IPNS_RESOLUTION_CONFIG.inactivePollingIntervalMinMs/1e3}-${IPNS_RESOLUTION_CONFIG.inactivePollingIntervalMaxMs/1e3}s (inactive)`;console.log(` IPNS polling started (interval: ${b})`),setTimeout(u,5e3)}stopIpnsPolling(){this.ipnsPollingInterval&&(clearTimeout(this.ipnsPollingInterval),this.ipnsPollingInterval=null,console.log(" IPNS polling stopped"))}handleVisibilityChange=()=>{const u=this.isTabVisible;this.isTabVisible=document.visibilityState==="visible",this.isTabVisible!==u&&(this.stopIpnsPolling(),this.isTabVisible?console.log(" Tab visible, switching to active polling interval (45-75s)"):console.log(" Tab hidden, switching to slower polling interval (4-4.5 min)"),this.startIpnsPolling())};setupVisibilityListener(){this.boundVisibilityHandler||(this.isTabVisible=document.visibilityState==="visible",this.boundVisibilityHandler=this.handleVisibilityChange,document.addEventListener("visibilitychange",this.boundVisibilityHandler),console.log(` Visibility listener registered (tab ${this.isTabVisible?"visible":"hidden"})`),this.startIpnsPolling())}cleanupVisibilityListener(){this.boundVisibilityHandler&&(document.removeEventListener("visibilitychange",this.boundVisibilityHandler),this.boundVisibilityHandler=null),this.stopIpnsPolling()}startBackendConnectionMaintenance(){const u=getBackendPeerId();if(!u||!this.helia)return;const g=async()=>{if(this.helia)try{const v=this.helia.libp2p.getConnections();if(v.some(w=>w.remotePeer.toString()===u)){const w=v.find(E=>E.remotePeer.toString()===u);w&&console.log(` Backend connection alive: ${w.remoteAddr.toString()}`)}else{console.log(" Backend peer disconnected, reconnecting...");const E=getBootstrapPeers().find(S=>S.includes(u));if(E)try{const{multiaddr:S}=await __vitePreload(async()=>{const{multiaddr:A}=await Promise.resolve().then(()=>index$2);return{multiaddr:A}},void 0);await this.helia.libp2p.dial(S(E)),console.log(" Reconnected to backend peer")}catch(S){console.warn(" Failed to reconnect to backend:",S)}}}catch(v){console.warn(" Connection maintenance error:",v)}};setTimeout(g,2e3),this.connectionMaintenanceInterval=setInterval(g,3e4),console.log(" Backend connection maintenance started")}async ensureBackendConnected(){const u=getBackendPeerId();if(!u||!this.helia)return!1;if(this.helia.libp2p.getConnections().some(E=>E.remotePeer.toString()===u))return!0;console.log(" Backend not connected, dialing...");const w=getBootstrapPeers().find(E=>E.includes(u));if(w)try{const{multiaddr:E}=await __vitePreload(async()=>{const{multiaddr:S}=await Promise.resolve().then(()=>index$2);return{multiaddr:S}},void 0);return await this.helia.libp2p.dial(E(w)),console.log(" Connected to backend for content transfer"),!0}catch(E){return console.warn(" Failed to connect to backend:",E),!1}return!1}getVersionCounter(){if(!this.cachedIpnsName)return 0;const u=`${STORAGE_KEY_PREFIXES.IPFS_VERSION}${this.cachedIpnsName}`;return parseInt(localStorage.getItem(u)||"0",10)}incrementVersionCounter(){if(!this.cachedIpnsName)return 1;const u=`${STORAGE_KEY_PREFIXES.IPFS_VERSION}${this.cachedIpnsName}`,v=this.getVersionCounter()+1;return localStorage.setItem(u,String(v)),v}setVersionCounter(u){if(!this.cachedIpnsName)return;const g=`${STORAGE_KEY_PREFIXES.IPFS_VERSION}${this.cachedIpnsName}`;localStorage.setItem(g,String(u))}getLastCid(){if(!this.cachedIpnsName)return null;const u=`${STORAGE_KEY_PREFIXES.IPFS_LAST_CID}${this.cachedIpnsName}`;return localStorage.getItem(u)}setLastCid(u){if(!this.cachedIpnsName)return;const g=`${STORAGE_KEY_PREFIXES.IPFS_LAST_CID}${this.cachedIpnsName}`;localStorage.setItem(g,u)}getPendingIpnsPublish(){if(!this.cachedIpnsName)return null;const u=`${STORAGE_KEY_PREFIXES.IPFS_PENDING_IPNS}${this.cachedIpnsName}`;return localStorage.getItem(u)}setPendingIpnsPublish(u){if(!this.cachedIpnsName)return;const g=`${STORAGE_KEY_PREFIXES.IPFS_PENDING_IPNS}${this.cachedIpnsName}`;localStorage.setItem(g,u),console.log(` IPNS publish marked as pending for CID: ${u.slice(0,16)}...`)}clearPendingIpnsPublish(){if(!this.cachedIpnsName)return;const u=`${STORAGE_KEY_PREFIXES.IPFS_PENDING_IPNS}${this.cachedIpnsName}`;localStorage.removeItem(u)}async retryPendingIpnsPublish(){const u=this.getPendingIpnsPublish();if(!u)return!0;console.log(` Retrying pending IPNS publish for CID: ${u.slice(0,16)}...`);try{const{CID:g}=await __vitePreload(async()=>{const{CID:w}=await Promise.resolve().then(()=>cid);return{CID:w}},void 0),v=g.parse(u);return await this.publishToIpns(v)?(this.clearPendingIpnsPublish(),this.setLastCid(u),console.log(" Pending IPNS publish succeeded"),!0):!1}catch(g){return console.warn(" Pending IPNS publish retry failed:",g),!1}}async fetchRemoteContent(u){if(!this.helia)return null;const g=15e3;try{console.log(` Fetching remote content: ${u.slice(0,16)}...`);const v=json(this.helia),{CID:b}=await __vitePreload(async()=>{const{CID:S}=await Promise.resolve().then(()=>cid);return{CID:S}},void 0),w=b.parse(u),E=await Promise.race([v.get(w),new Promise((S,A)=>setTimeout(()=>A(new Error("Fetch timeout")),g))]);return E&&typeof E=="object"&&"_meta"in E?(console.log(" Remote content fetched successfully"),E):(console.warn(" Remote content is not valid TXF format"),null)}catch(v){return console.warn(` Failed to fetch CID ${u.slice(0,16)}...:`,v),null}}async sanityCheckTombstones(u,g){const v=[],b=[],w=[];if(u.length===0)return{validTombstones:v,invalidTombstones:b,tokensToRestore:w};const E=await this.identityManager.getCurrentIdentity();if(!E)return console.warn(" No identity available, skipping tombstone verification (accepting all tombstones)"),{validTombstones:u,invalidTombstones:[],tokensToRestore:[]};const S=new Map;for(const O of u){const B=g.getBestArchivedVersion(O.tokenId);B&&S.set(O.tokenId,B)}if(S.size===0)return console.warn(" No archived tokens available for verification, accepting all tombstones"),{validTombstones:u,invalidTombstones:[],tokensToRestore:[]};const A=getTokenValidationService(),$=E.publicKey,R=await A.checkUnspentTokens(S,$),T=new Set(R);for(const O of u)if(T.has(O.tokenId)){b.push(O);const B=g.getBestArchivedVersion(O.tokenId);B&&w.push({tokenId:O.tokenId,txf:B}),console.log(` Invalid tombstone for ${O.tokenId.slice(0,8)}... - token is NOT spent on Unicity`)}else v.push(O);return u.length>0&&console.log(` Tombstone sanity check: ${v.length} valid, ${b.length} invalid`),{validTombstones:v,invalidTombstones:b,tokensToRestore:w}}async sanityCheckMissingTokens(u,g,v){const b=[],w=[];for(const O of u){const B=tokenToTxf(O);if(!B)continue;const F=B.genesis.data.tokenId;!g.has(F)&&!v.has(F)&&w.push(O)}if(w.length===0)return[];console.log(` Found ${w.length} token(s) missing from remote (no tombstone)`);const E=await this.identityManager.getCurrentIdentity();if(!E){console.warn(" No identity available, preserving all missing tokens (safe fallback)");for(const O of w){const B=tokenToTxf(O);B&&b.push({tokenId:B.genesis.data.tokenId,txf:B})}return b}const S=new Map;for(const O of w){const B=tokenToTxf(O);if(!B)continue;const F=B.genesis.data.tokenId;S.set(F,B)}if(S.size===0)return b;const A=getTokenValidationService(),$=E.publicKey,R=await A.checkUnspentTokens(S,$),T=new Set(R);for(const[O,B]of S)T.has(O)?(b.push({tokenId:O,txf:B}),console.log(` Preserving missing token ${O.slice(0,8)}... - NOT spent on Unicity`)):console.log(` Token ${O.slice(0,8)}... legitimately removed (spent on Unicity)`);return b}verifyIntegrityInvariants(u){const g=u.getTombstones(),v=u.getArchivedTokens(),b=u.getTokens();let w=0;for(const S of g)v.has(S.tokenId)||(console.warn(` Integrity: Tombstone ${S.tokenId.slice(0,8)}... has no archive entry`),w++);const E=new Set(g.map(S=>`${S.tokenId}:${S.stateHash}`));for(const S of b){const A=tokenToTxf(S);if(!A)continue;const $=A.genesis.data.tokenId,R=getCurrentStateHash(A),T=`${$}:${R}`;E.has(T)&&(console.warn(` Integrity: Active token ${$.slice(0,8)}... matches a tombstone`),w++)}w>0?console.warn(` Integrity check found ${w} issue(s)`):console.log(" Integrity check passed")}compareTokenVersions(u,g){const v=U=>U.transactions.filter(q=>q.inclusionProof!==null).length,b=v(u),w=v(g),E=u.transactions.some(U=>U.inclusionProof===null),S=g.transactions.some(U=>U.inclusionProof===null);if(b>0&&w===0&&S)return console.log(` compareTokenVersions: Local wins (committed=${b} beats pending-only remote)`),"local";if(w>0&&b===0&&E)return console.log(` compareTokenVersions: Remote wins (committed=${w} beats pending-only local)`),"remote";if(b>w)return console.log(` compareTokenVersions: Local wins (${b} committed > ${w} committed)`),"local";if(w>b)return console.log(` compareTokenVersions: Remote wins (${w} committed > ${b} committed)`),"remote";const A=U=>{let q=U.genesis?.inclusionProof?1:0;return q+=U.transactions.filter(J=>J.inclusionProof!==null).length,q},$=A(u),R=A(g);if($>R)return"local";if(R>$)return"remote";const T=getCurrentStateHash(u),O=getCurrentStateHash(g);if(T===O)return"equal";const B=u._integrity?.genesisDataJSONHash||"",F=g._integrity?.genesisDataJSONHash||"";return B>F?"local":F>B?"remote":"local"}localDiffersFromRemote(u){const g=WalletRepository.getInstance(),v=g.getTokens(),b=g.getNametag(),w=u._nametag;if(b&&!w)return console.log(` Local has nametag "${b.name}" not in remote`),!0;if(b&&w&&b.name!==w.name)return console.log(` Local nametag "${b.name}" differs from remote "${w.name}"`),!0;const E=new Map;for(const S of Object.keys(u))if(isTokenKey(S)){const A=tokenIdFromKey(S),$=u[S];$?.genesis?.data?.tokenId&&E.set(A,$)}for(const S of v){const A=tokenToTxf(S);if(!A)continue;const $=A.genesis.data.tokenId,R=E.get($);if(!R)return console.log(` Local has token ${$.slice(0,8)}... not in remote`),!0;if(this.compareTokenVersions(A,R)==="local"){const O=A.transactions.filter(F=>F.inclusionProof!==null).length,B=R.transactions.filter(F=>F.inclusionProof!==null).length;return console.log(` Local token ${$.slice(0,8)}... is better than remote (local: ${O} committed, remote: ${B} committed)`),!0}}return!1}async importRemoteData(u){const g=WalletRepository.getInstance(),v=u._tombstones;console.log(" Raw remote _tombstones field:",v);const{tokens:b,nametag:w,tombstones:E,archivedTokens:S,forkedTokens:A,outboxEntries:$}=parseTxfStorageData(u);$&&$.length>0&&(OutboxRepository.getInstance().importFromRemote($),console.log(` Imported ${$.length} outbox entries from remote`)),console.log(` Parsed remote tombstones (${E.length}):`,E.map(ve=>`${ve.tokenId.slice(0,8)}:${ve.stateHash.slice(0,8)}`));const R=g.getWallet()?.tokens||[],T=new Set(R.map(ve=>ve.id)),O=g.getTombstones();console.log(` Local token IDs (${T.size}):`,[...T].map(ve=>ve.slice(0,8)+"..."));let B=0;const F=new Set;for(const ve of b){const he=tokenToTxf(ve);he&&F.add(he.genesis.data.tokenId)}const U=new Set(E.map(ve=>ve.tokenId)),q=await this.sanityCheckMissingTokens(R,F,U),J=new Set(O.map(ve=>`${ve.tokenId}:${ve.stateHash}`)),ie=E.filter(ve=>!J.has(`${ve.tokenId}:${ve.stateHash}`));let oe=[],le=ie;if(ie.length>0){console.log(` Sanity checking ${ie.length} new tombstone(s) with Unicity...`);const ve=await this.sanityCheckTombstones(ie,g);le=ve.validTombstones,oe=ve.tokensToRestore,ve.invalidTombstones.length>0&&console.log(` Rejected ${ve.invalidTombstones.length} invalid tombstone(s)`)}const de=[...oe,...q];for(const{tokenId:ve,txf:he}of de)g.restoreTokenFromArchive(ve,he);const fe=[...O];for(const ve of le)J.has(`${ve.tokenId}:${ve.stateHash}`)||fe.push(ve);if(fe.length>0){console.log(` Processing ${fe.length} valid tombstone(s)`);const ve=g.mergeTombstones(fe);ve>0&&console.log(` Removed ${ve} tombstoned token(s) from local`)}const ye=new Set;for(const ve of g.getTombstones())ye.add(`${ve.tokenId}:${ve.stateHash}`);const we=g.getWallet()?.tokens||[],pe=new Map;for(const ve of we){const he=tokenToTxf(ve);he&&pe.set(he.genesis.data.tokenId,ve)}for(const ve of b){const he=tokenToTxf(ve);if(!he)continue;const ae=he.genesis.data.tokenId,Q=getCurrentStateHash(he),j=`${ae}:${Q}`;if(ye.has(j)){console.log(` Skipping tombstoned token ${ae.slice(0,8)}... state ${Q.slice(0,8)}... from remote`);continue}const z=pe.get(ae);if(!z)g.addToken(ve),console.log(` Imported new token ${ae.slice(0,8)}... from remote`),B++;else{const re=tokenToTxf(z);if(!re)continue;const Y=this.compareTokenVersions(re,he);if(Y==="remote"){const te=re.transactions.length,ne=he.transactions.length;console.log(` Updating token ${ae.slice(0,8)}... from remote (remote: ${ne} txns > local: ${te} txns)`);const se=getCurrentStateHash(re);se!==Q&&(g.storeForkedToken(ae,se,re),console.log(` Archived forked local version of ${ae.slice(0,8)}... (state ${se.slice(0,8)}...)`)),g.updateToken(ve),B++}else if(Y==="local"){const te=getCurrentStateHash(he),ne=getCurrentStateHash(re);te!==ne&&(g.storeForkedToken(ae,te,he),console.log(` Archived forked remote version of ${ae.slice(0,8)}... (state ${te.slice(0,8)}...)`))}}}if(w&&!g.getNametag()&&(g.setNametag(w),console.log(` Imported nametag "${w.name}" from remote`)),S.size>0){const ve=g.mergeArchivedTokens(S);ve>0&&console.log(` Merged ${ve} archived token(s) from remote`)}if(A.size>0){const ve=g.mergeForkedTokens(A);ve>0&&console.log(` Merged ${ve} forked token(s) from remote`)}return g.pruneTombstones(),g.pruneArchivedTokens(),g.pruneForkedTokens(),this.verifyIntegrityInvariants(g),B}scheduleSync(){if(this.isSyncing){console.log(" Sync in progress - marking pending sync for after completion"),this.pendingSync=!0;return}this.syncTimer&&clearTimeout(this.syncTimer),this.syncTimer=setTimeout(()=>{this.syncNow().catch(console.error)},SYNC_DEBOUNCE_MS$1)}async syncFromIpns(){console.log(" Starting IPNS-based sync..."),this.isInitialSyncing=!0,this.emitSyncStateChange();try{if(!await this.ensureInitialized())return console.warn(" Not initialized, skipping IPNS sync"),{success:!1,timestamp:Date.now(),error:"Not initialized"};await this.retryPendingIpnsPublish();const g=await this.resolveIpnsProgressively(R=>this.handleHigherSequenceDiscovered(R)),v=g.best?.cid||null,b=this.getLastCid();g.best&&(this.lastKnownRemoteSequence=g.best.sequence,console.log(` IPNS resolved: seq=${g.best.sequence}, ${g.respondedCount}/${g.totalGateways} gateways responded`)),console.log(` IPNS sync: remote=${v?.slice(0,16)||"none"}..., local=${b?.slice(0,16)||"none"}...`);const w=!v&&!!b;w&&console.log(" IPNS recovery needed - IPNS empty but local CID exists");const E=v||b;if(!E){const R=g.respondedCount===0,T=WalletRepository.getInstance(),O=T.getTokens().length,B=T.getNametag();return R&&O===0&&!B?(console.warn(` IPNS resolution failed (0/${g.totalGateways} responded) and no local tokens`),console.warn(" Skipping upload to prevent overwriting existing remote tokens"),console.warn(" Will retry IPNS resolution on next poll"),{success:!1,timestamp:Date.now(),error:"IPNS resolution failed - waiting for successful resolution before sync"}):(console.log(" No IPNS record or local CID - fresh wallet, triggering initial sync"),this.syncNow())}v&&v!==b&&console.log(" IPNS CID differs from local! Remote may have been updated from another device");let S=null;if(g.best?._cachedContent&&g.best.cid===E?(S=g.best._cachedContent,console.log(" Using cached content from gateway path (avoided re-fetch)")):S=await this.fetchRemoteContent(E),!S)return console.warn(` Failed to fetch remote content (CID: ${E.slice(0,16)}...), will republish local`),this.syncNow({forceIpnsPublish:w});const A=this.getVersionCounter(),$=S._meta.version;if(console.log(` Version comparison: local=v${A}, remote=v${$}`),$>A){console.log(` Remote is newer (v${$} > v${A}), importing...`);const R=await this.importRemoteData(S);return this.setVersionCounter($),this.setLastCid(E),console.log(` Imported ${R} token(s) from remote, now at v${$}`),w?(console.log(" Content imported but IPNS needs recovery - publishing to IPNS"),this.syncNow({forceIpnsPublish:!0})):{success:!0,cid:E,ipnsName:this.cachedIpnsName||void 0,timestamp:Date.now(),version:$}}else if($<A){console.log(` Local is newer (v${A} > v${$}), checking for new remote tokens first...`);const R=await this.importRemoteData(S);return R>0&&(console.log(` Imported ${R} new token(s) from remote before updating IPNS`),window.dispatchEvent(new Event("wallet-updated"))),this.localDiffersFromRemote(S)?(console.log(" Local differs from remote, syncing merged state..."),this.syncNow({forceIpnsPublish:w})):(console.log(" Local now matches remote after import, no sync needed"),this.setLastCid(E),this.setVersionCounter($),w?(console.log(" Content synced but IPNS needs recovery - publishing to IPNS"),this.syncNow({forceIpnsPublish:!0})):{success:!0,cid:E,ipnsName:this.cachedIpnsName||void 0,timestamp:Date.now(),version:$})}else return v&&v!==b&&(this.setLastCid(v),console.log(" Updated local CID to match IPNS")),console.log(` Versions match (v${$}), remote verified accessible`),w?(console.log(" Content synced but IPNS needs recovery - publishing to IPNS"),this.syncNow({forceIpnsPublish:!0})):{success:!0,cid:E,ipnsName:this.cachedIpnsName||void 0,timestamp:Date.now(),version:$}}finally{this.isInitialSyncing=!1,this.emitSyncStateChange()}}async syncNow(u){const{forceIpnsPublish:g=!1}=u||{},v=getSyncCoordinator();if(this.isSyncing)return{success:!1,timestamp:Date.now(),error:"Sync already in progress"};if(!await v.acquireLock())return console.log(" Another tab is syncing, skipping this sync"),{success:!1,timestamp:Date.now(),error:"Another tab is syncing"};this.isSyncing=!0,this.emitSyncStateChange(),await this.emitEvent({type:"storage:started",timestamp:Date.now()});try{if(!await this.ensureInitialized()||!this.helia||!this.ed25519PrivateKey||!this.ed25519PublicKey)throw new Error("IPFS not initialized");const E=WalletRepository.getInstance().getWallet();if(!E)throw new Error("No wallet found");const S=await this.identityManager.getCurrentIdentity();if(S&&E.address!==S.address)throw new Error(`Cannot sync: wallet address mismatch (wallet=${E.address}, identity=${S.address})`);const A=WalletRepository.getInstance(),$=A.getNametag(),R=getTokenValidationService(),{validTokens:T,issues:O}=await R.validateAllTokens(E.tokens);O.length>0&&console.warn(` ${O.length} token(s) failed validation and will be excluded:`,O.map(ne=>`${ne.tokenId.slice(0,8)}...: ${ne.reason}`).join(", ")),console.log(` Syncing ${T.length} tokens${$?` + nametag "${$.name}"`:""} to IPFS (TXF format)...`);let B=T,F=0;const U=this.getLastCid();if(U)try{console.log(` Checking for remote conflicts (last CID: ${U.slice(0,16)}...)...`);const ne=json(this.helia),{CID:se}=await __vitePreload(async()=>{const{CID:_e}=await Promise.resolve().then(()=>cid);return{CID:_e}},void 0),ee=se.parse(U),Z=15e3,ue=await Promise.race([ne.get(ee),new Promise((_e,Re)=>setTimeout(()=>Re(new Error("Remote fetch timeout")),Z))]);if(ue&&typeof ue=="object"&&"_meta"in ue){const _e=ue,Re=_e._meta.version,Ae=this.getVersionCounter();if(Re!==Ae){console.log(` Version mismatch detected: local v${Ae} vs remote v${Re}`);const ge={version:Ae,address:E.address,ipnsName:this.cachedIpnsName||""},be=A.getTombstones(),Te=buildTxfStorageData(T,ge,$||void 0,be),Ie=getConflictResolutionService().resolveConflict(Te,_e);if(Ie.conflicts.length>0){console.log(` Resolved ${Ie.conflicts.length} token conflict(s):`);for(const Ge of Ie.conflicts)console.log(`   - ${Ge.tokenId.slice(0,8)}...: ${Ge.reason} (${Ge.resolution} wins)`);F=Ie.conflicts.length}if(Ie.newTokens.length>0){console.log(` Added ${Ie.newTokens.length} token(s) from remote`);for(const Ge of Ie.newTokens){const Xe=`_${Ge}`,ze=Ie.merged[Xe];if(ze){const et=txfToToken(Ge,ze);A.addToken(et),console.log(` Synced token ${Ge.slice(0,8)}... from IPFS to local`)}}}const Se=_e._tombstones||[];if(Se.length>0){console.log(` Processing ${Se.length} remote tombstone(s)`);const Ge=A.mergeTombstones(Se);Ge>0&&console.log(` Removed ${Ge} tombstoned token(s) from local during conflict resolution`)}const{archivedTokens:Be,forkedTokens:Le,outboxEntries:qe}=parseTxfStorageData(_e);if(Be.size>0){const Ge=A.mergeArchivedTokens(Be);Ge>0&&console.log(` Merged ${Ge} archived token(s) from remote`)}if(Le.size>0){const Ge=A.mergeForkedTokens(Le);Ge>0&&console.log(` Merged ${Ge} forked token(s) from remote`)}qe&&qe.length>0&&(OutboxRepository.getInstance().importFromRemote(qe),console.log(` Imported ${qe.length} outbox entries from remote during conflict resolution`)),!$&&Ie.merged._nametag&&(A.setNametag(Ie.merged._nametag),console.log(` Synced nametag "${Ie.merged._nametag.name}" from IPFS to local`));const{tokens:Ke}=parseTxfStorageData(Ie.merged);B=Ke,this.setVersionCounter(Ie.merged._meta.version)}else{const ge=T.map(Te=>{try{return JSON.parse(Te.jsonData||"{}").genesis?.data?.tokenId||Te.id}catch{return Te.id}}).sort().join(","),be=Object.keys(_e).filter(Te=>Te.startsWith("_")&&Te!=="_meta"&&Te!=="_nametag"&&Te!=="_tombstones").map(Te=>Te.slice(1)).sort().join(",");if(ge===be&&!g)return console.log(` Remote is in sync (v${Re}) - no changes to upload`),this.isSyncing=!1,this.emitSyncStateChange(),v.releaseLock(),{success:!0,cid:U||void 0,ipnsName:this.cachedIpnsName||void 0,timestamp:Date.now(),version:Re,tokenCount:T.length};ge===be&&g&&console.log(" Remote is in sync but IPNS recovery needed - continuing to publish IPNS"),console.log(" Remote version matches but local has token changes - uploading...")}}}catch(ne){console.warn(" Could not fetch remote for conflict check:",ne instanceof Error?ne.message:ne)}const q=this.incrementVersionCounter(),J=A.getTombstones(),ie=A.getArchivedTokens(),oe=A.getForkedTokens(),le=OutboxRepository.getInstance();le.setCurrentAddress(E.address);const de=le.getAllForSync(),fe={version:q,address:E.address,ipnsName:this.cachedIpnsName||"",lastCid:this.getLastCid()||void 0},ye=buildTxfStorageData(B,fe,$||void 0,J,ie,oe,de);(J.length>0||ie.size>0||oe.size>0||de.length>0)&&console.log(` Including ${J.length} tombstone(s), ${ie.size} archived, ${oe.size} forked, ${de.length} outbox in sync`);const we=await this.ensureBackendConnected();we&&console.log(" Backend connected - content will be available via bitswap");const ve=await json(this.helia).add(ye),he=ve.toString();we&&(console.log(" Waiting for bitswap block exchange..."),await new Promise(ne=>setTimeout(ne,3e3)));const ae=getAllBackendGatewayUrls();if(ae.length>0){console.log(` Uploading to ${ae.length} IPFS node(s)...`);const ne=new Blob([JSON.stringify(ye)],{type:"application/json"}),se=ae.map(async ue=>{try{const _e=new FormData;_e.append("file",ne,"wallet.json");const Re=await fetch(`${ue}/api/v0/add?pin=true&cid-version=1`,{method:"POST",body:_e});if(Re.ok){const Ae=await Re.json(),ge=new URL(ue).hostname;return console.log(` Uploaded to ${ge}: ${Ae.Hash}`),{success:!0,host:ue,cid:Ae.Hash}}return{success:!1,host:ue,error:Re.status}}catch(_e){const Re=new URL(ue).hostname;return console.warn(` Upload to ${Re} failed:`,_e),{success:!1,host:ue,error:_e}}}),Z=(await Promise.allSettled(se)).filter(ue=>ue.status==="fulfilled"&&ue.value.success).length;console.log(` Content uploaded to ${Z}/${ae.length} nodes`)}const Q=1e4;try{console.log(` Announcing CID to network: ${he.slice(0,16)}...`),await Promise.race([this.helia.routing.provide(ve),new Promise((ne,se)=>setTimeout(()=>se(new Error("DHT provide timeout")),Q))]),console.log(" CID announced to network")}catch(ne){console.warn(" Could not announce to DHT (non-fatal):",ne)}const j=this.getLastCid();let z=!1,re=!1;he!==j||g?(g&&he===j&&console.log(" Forcing IPNS republish (CID unchanged but IPNS may be expired)"),await this.publishToIpns(ve)?(z=!0,this.clearPendingIpnsPublish()):(this.setPendingIpnsPublish(he),re=!0)):(console.log(` CID unchanged (${he.slice(0,16)}...) - skipping IPNS publish`),this.clearPendingIpnsPublish()),this.setLastCid(he),console.log(` Tokens stored to IPFS (v${q}): ${he}`),console.log(` IPNS name: ${this.cachedIpnsName}`);const te={success:!0,cid:he,ipnsName:this.cachedIpnsName||void 0,timestamp:Date.now(),version:q,tokenCount:B.length,validationIssues:O.length>0?O.map(ne=>ne.reason):void 0,conflictsResolved:F>0?F:void 0,ipnsPublished:z,ipnsPublishPending:re||void 0};return this.lastSync=te,await this.emitEvent({type:"storage:completed",timestamp:Date.now(),data:{cid:he,ipnsName:this.cachedIpnsName||void 0,tokenCount:T.length}}),await this.emitEvent({type:"ipns:published",timestamp:Date.now(),data:{cid:he,ipnsName:this.cachedIpnsName||void 0}}),te}catch(w){const E=w instanceof Error?w.message:"Unknown error";console.error(" Storage sync failed:",E);const S={success:!1,timestamp:Date.now(),error:E};return this.lastSync=S,await this.emitEvent({type:"storage:failed",timestamp:Date.now(),data:{error:E}}),S}finally{this.isSyncing=!1,this.emitSyncStateChange(),v.releaseLock(),this.pendingSync&&(console.log(" Processing pending sync request that arrived during sync"),this.pendingSync=!1,setTimeout(()=>{this.scheduleSync()},100))}}async runSpentTokenSanityCheck(){console.log(" Running spent token sanity check...");try{const u=await this.identityManager.getCurrentIdentity();if(!u){console.warn(" Sanity check: No identity, skipping");return}const g=WalletRepository.getInstance(),v=g.getTokens();if(v.length===0){console.log(" Sanity check: No tokens to check");return}const w=await getTokenValidationService().checkSpentTokens(v,u.publicKey,{batchSize:3,onProgress:(E,S)=>{(E%5===0||E===S)&&console.log(` Sanity check progress: ${E}/${S}`)}});if(w.spentTokens.length>0){console.log(` Sanity check found ${w.spentTokens.length} spent token(s):`);for(const E of w.spentTokens){const S=E.tokenId||E.localId||"unknown",A=E.stateHash||"unknown";console.log(`   - Removing spent token ${S.slice(0,8)}... (state: ${A.slice(0,12)}...)`),E.localId&&g.removeToken(E.localId,void 0,!0)}window.dispatchEvent(new Event("wallet-updated")),console.log(` Sanity check complete: removed ${w.spentTokens.length} spent token(s)`)}else console.log(" Sanity check complete: no spent tokens found");w.errors.length>0&&console.warn(` Sanity check had ${w.errors.length} error(s):`,w.errors.slice(0,3))}catch(u){console.warn(" Sanity check failed (non-fatal):",u instanceof Error?u.message:u)}}async restore(u){try{if(!await this.ensureInitialized()||!this.helia)throw new Error("IPFS not initialized");console.log(` Restoring from CID: ${u}`);const v=json(this.helia),{CID:b}=await __vitePreload(async()=>{const{CID:A}=await Promise.resolve().then(()=>cid);return{CID:A}},void 0),w=b.parse(u),E=await v.get(w);if(E&&typeof E=="object"&&"_meta"in E){const A=E,{tokens:$,meta:R,nametag:T,validationErrors:O}=parseTxfStorageData(A);O.length>0&&console.warn(" Validation warnings during restore:",O);const B=await this.identityManager.getCurrentIdentity();if(B&&R&&R.address!==B.address)throw console.warn(` Address mismatch: stored=${R.address}, current=${B.address}`),new Error("Cannot restore tokens: address mismatch. This data belongs to a different identity.");return R&&this.setVersionCounter(R.version),console.log(` Restored ${$.length} tokens (TXF v${R?.version||"?"})${T?` + nametag "${T.name}"`:""} from IPFS`),{success:!0,tokens:$,nametag:T||void 0,version:R?.version,timestamp:Date.now()}}else{const A=E;if(!A||!A.version)throw new Error("Invalid storage data format");const $=await this.identityManager.getCurrentIdentity();if($&&A.address!==$.address)throw console.warn(` Address mismatch: stored=${A.address}, current=${$.address}`),new Error("Cannot restore tokens: address mismatch. This data belongs to a different identity.");console.log(` Restored ${A.tokens.length} tokens (legacy format)${A.nametag?` + nametag "${A.nametag.name}"`:""} from IPFS`);const{Token:R,TokenStatus:T}=await __vitePreload(async()=>{const{Token:B,TokenStatus:F}=await Promise.resolve().then(()=>index$3);return{Token:B,TokenStatus:F}},void 0);return{success:!0,tokens:A.tokens.map(B=>new R({id:B.id,name:B.name,symbol:B.symbol,amount:B.amount,coinId:B.coinId,jsonData:B.jsonData,status:B.status in T?B.status:T.CONFIRMED,timestamp:B.timestamp,type:B.type,iconUrl:B.iconUrl})),nametag:A.nametag,timestamp:Date.now()}}}catch(g){const v=g instanceof Error?g.message:"Unknown error";return console.error(" Restore failed:",v),{success:!1,timestamp:Date.now(),error:v}}}async restoreFromLastCid(){const u=this.getLastCid();return u?this.restore(u):{success:!1,timestamp:Date.now(),error:"No previous CID found for recovery"}}async getIpnsName(){if(this.cachedIpnsName)return this.cachedIpnsName;const u=await this.identityManager.getCurrentIdentity();if(!u)return null;try{const g=this.hexToBytes(u.privateKey),v=hkdf(sha256,g,void 0,HKDF_INFO$1,32),b=await generateKeyPairFromSeed("Ed25519",v),w=peerIdFromPrivateKey(b);return this.cachedIpnsName=w.toString(),this.cachedIpnsName}catch(g){return console.warn(" Failed to compute IPNS name:",g),null}}getStatus(){return{initialized:this.helia!==null,isSyncing:this.isSyncing||this.isInitialSyncing,lastSync:this.lastSync,ipnsName:this.cachedIpnsName,webCryptoAvailable:this.isWebCryptoAvailable(),currentVersion:this.getVersionCounter(),lastCid:this.getLastCid()}}getCurrentVersion(){return this.getVersionCounter()}isCurrentlySyncing(){return this.isSyncing||this.isInitialSyncing}async exportAsTxf(){try{const u=WalletRepository.getInstance().getWallet();if(!u)return{success:!1,error:"No wallet found"};const{buildTxfExportFile:g}=await __vitePreload(async()=>{const{buildTxfExportFile:E}=await Promise.resolve().then(()=>TxfSerializer);return{buildTxfExportFile:E}},void 0),v=g(u.tokens),b=`tokens-${u.address.slice(0,8)}-${Date.now()}.txf`,w=JSON.stringify(v,null,2);return console.log(` Exported ${u.tokens.length} tokens as TXF`),{success:!0,data:w,filename:b}}catch(u){const g=u instanceof Error?u.message:"Unknown error";return console.error(" TXF export failed:",g),{success:!1,error:g}}}async importFromTxf(u){try{const g=JSON.parse(u),{parseTxfFile:v}=await __vitePreload(async()=>{const{parseTxfFile:$}=await Promise.resolve().then(()=>TxfSerializer);return{parseTxfFile:$}},void 0),b=getTokenValidationService(),{tokens:w,errors:E}=v(g);if(E.length>0&&console.warn(" TXF file parsing warnings:",E),w.length===0)return{success:!1,error:"No valid tokens found in TXF file"};const S=[];let A=0;for(const $ of w){const R=await b.validateToken($);R.isValid&&R.token?S.push(R.token):(A++,console.warn(` Skipping invalid token ${$.id.slice(0,8)}...: ${R.reason}`))}return console.log(` Imported ${S.length} tokens from TXF (${A} skipped)`),{success:!0,tokens:S,imported:S.length,skipped:A}}catch(g){const v=g instanceof Error?g.message:"Unknown error";return console.error(" TXF import failed:",v),{success:!1,error:v}}}}const IpfsStorageService$1=Object.freeze(Object.defineProperty({__proto__:null,IpfsStorageService},Symbol.toStringTag,{value:"Module"})),ServicesContext=reactExports.createContext(void 0),useServices=()=>{const y=reactExports.useContext(ServicesContext);if(!y)throw new Error("useServices must be used within ServicesProvider");return y},PERIODIC_RETRY_INTERVAL_MS=6e4,ENTRY_BACKOFF_BASE_MS=3e4,ENTRY_MAX_BACKOFF_MS=36e5,MAX_RETRIES_PER_ENTRY=10,COMPLETED_CLEANUP_AGE_MS=1440*60*1e3;class OutboxRecoveryService{static instance;identityManager=null;isRecovering=!1;periodicRetryInterval=null;walletAddress=null;nostrServiceRef=null;constructor(){}static getInstance(){return OutboxRecoveryService.instance||(OutboxRecoveryService.instance=new OutboxRecoveryService),OutboxRecoveryService.instance}setIdentityManager(u){this.identityManager=u}hasPendingRecovery(u){const g=OutboxRepository.getInstance();return g.setCurrentAddress(u),g.getPendingCount()>0}getPendingCount(u){const g=OutboxRepository.getInstance();return g.setCurrentAddress(u),g.getPendingCount()}startPeriodicRetry(u,g){this.stopPeriodicRetry(),this.walletAddress=u,this.nostrServiceRef=g,console.log(` OutboxRecovery: Starting periodic retry (every ${PERIODIC_RETRY_INTERVAL_MS/1e3}s)`),this.periodicRetryInterval=setInterval(()=>{this.runPeriodicRecovery()},PERIODIC_RETRY_INTERVAL_MS)}stopPeriodicRetry(){this.periodicRetryInterval&&(clearInterval(this.periodicRetryInterval),this.periodicRetryInterval=null,console.log(" OutboxRecovery: Stopped periodic retry")),this.walletAddress=null,this.nostrServiceRef=null}async runPeriodicRecovery(){if(!this.walletAddress||!this.nostrServiceRef||this.isRecovering)return;const u=OutboxRepository.getInstance();u.setCurrentAddress(this.walletAddress);const g=u.getPendingCount();if(g===0)return;const b=u.getPendingEntries().filter(w=>this.isReadyForRetry(w));b.length!==0&&(console.log(` OutboxRecovery: Periodic check - ${b.length}/${g} entries ready for retry`),await this.recoverPendingTransfers(this.walletAddress,this.nostrServiceRef),u.cleanupCompleted(COMPLETED_CLEANUP_AGE_MS))}isReadyForRetry(u){if(u.status==="FAILED"||u.status==="COMPLETED")return!1;if(u.retryCount>=MAX_RETRIES_PER_ENTRY)return!0;const g=Math.min(ENTRY_BACKOFF_BASE_MS*Math.pow(2,u.retryCount),ENTRY_MAX_BACKOFF_MS);return Date.now()-u.updatedAt>=g}async recoverPendingTransfers(u,g){if(this.isRecovering)return console.log(" OutboxRecovery: Recovery already in progress, skipping"),{recovered:0,failed:0,skipped:0,details:[]};this.isRecovering=!0;const v={recovered:0,failed:0,skipped:0,details:[]};try{const b=OutboxRepository.getInstance();b.setCurrentAddress(u);const w=b.getPendingEntries();if(w.length===0)return console.log(" OutboxRecovery: No pending entries to recover"),v;console.log(` OutboxRecovery: Found ${w.length} pending entries`);for(const E of w){const S=await this.recoverEntry(E,b,g);switch(v.details.push(S),S.status){case"recovered":v.recovered++;break;case"failed":v.failed++;break;case"skipped":v.skipped++;break}}if(this.identityManager&&(v.recovered>0||v.failed>0))try{await IpfsStorageService.getInstance(this.identityManager).syncNow(),console.log(" OutboxRecovery: Final IPFS sync completed")}catch(E){console.warn(" OutboxRecovery: Final IPFS sync failed:",E)}return console.log(` OutboxRecovery: Complete - ${v.recovered} recovered, ${v.failed} failed, ${v.skipped} skipped`),v}finally{this.isRecovering=!1}}async recoverEntry(u,g,v){const b={entryId:u.id,status:"skipped",previousStatus:u.status};console.log(` OutboxRecovery: Processing entry ${u.id.slice(0,8)}... (status=${u.status}, type=${u.type})`);try{switch(u.status){case"PENDING_IPFS_SYNC":await this.resumeFromPendingIpfs(u,g,v),b.status="recovered",b.newStatus="COMPLETED";break;case"READY_TO_SUBMIT":await this.resumeFromReadyToSubmit(u,g,v),b.status="recovered",b.newStatus="COMPLETED";break;case"SUBMITTED":await this.resumeFromSubmitted(u,g,v),b.status="recovered",b.newStatus="COMPLETED";break;case"PROOF_RECEIVED":await this.resumeFromProofReceived(u,g,v),b.status="recovered",b.newStatus="COMPLETED";break;case"NOSTR_SENT":g.updateStatus(u.id,"COMPLETED"),b.status="recovered",b.newStatus="COMPLETED";break;case"COMPLETED":b.status="skipped";break;case"FAILED":console.warn(` OutboxRecovery: Entry ${u.id.slice(0,8)}... is FAILED, skipping`),b.status="skipped";break}}catch(w){console.error(` OutboxRecovery: Failed to recover entry ${u.id.slice(0,8)}...`,w);const E=u.retryCount+1;g.updateEntry(u.id,{lastError:w instanceof Error?w.message:String(w),retryCount:E}),E>=MAX_RETRIES_PER_ENTRY&&g.updateStatus(u.id,"FAILED",`Max retries exceeded (${MAX_RETRIES_PER_ENTRY})`),b.status="failed",b.error=w instanceof Error?w.message:String(w)}return b}async resumeFromPendingIpfs(u,g,v){if(console.log(" OutboxRecovery: Resuming from PENDING_IPFS_SYNC..."),this.identityManager&&!(await IpfsStorageService.getInstance(this.identityManager).syncNow()).success)throw new Error("IPFS sync failed during recovery");g.updateStatus(u.id,"READY_TO_SUBMIT"),u.status="READY_TO_SUBMIT",await this.resumeFromReadyToSubmit(u,g,v)}async resumeFromReadyToSubmit(u,g,v){console.log(" OutboxRecovery: Resuming from READY_TO_SUBMIT...");const b=await this.reconstructCommitment(u),E=await ServiceProvider.stateTransitionClient.submitTransferCommitment(b);if(E.status!=="SUCCESS"&&E.status!=="REQUEST_ID_EXISTS")throw new Error(`Aggregator submission failed: ${E.status}`);g.updateStatus(u.id,"SUBMITTED"),u.status="SUBMITTED",await this.resumeFromSubmitted(u,g,v)}async resumeFromSubmitted(u,g,v){console.log(" OutboxRecovery: Resuming from SUBMITTED...");const b=await this.reconstructCommitment(u),w=ServiceProvider.getRootTrustBase(),E=ServiceProvider.stateTransitionClient,S=await waitInclusionProof(w,E,b),A=b.toTransaction(S);g.updateEntry(u.id,{status:"PROOF_RECEIVED",inclusionProofJson:JSON.stringify(S.toJSON()),transferTxJson:JSON.stringify(A.toJSON())}),u.status="PROOF_RECEIVED",u.inclusionProofJson=JSON.stringify(S.toJSON()),u.transferTxJson=JSON.stringify(A.toJSON()),await this.resumeFromProofReceived(u,g,v)}async resumeFromProofReceived(u,g,v){if(console.log(" OutboxRecovery: Resuming from PROOF_RECEIVED..."),!u.transferTxJson)throw new Error("Missing transferTxJson for Nostr delivery");const b=JSON.stringify({sourceToken:u.sourceTokenJson,transferTx:u.transferTxJson});await v.sendTokenTransfer(u.recipientPubkey,b),g.updateStatus(u.id,"NOSTR_SENT"),g.updateStatus(u.id,"COMPLETED"),console.log(` OutboxRecovery: Entry ${u.id.slice(0,8)}... recovered and completed`)}async reconstructCommitment(u){try{const g=JSON.parse(u.commitmentJson);return await TransferCommitment.fromJSON(g)}catch(g){throw new Error(`Failed to reconstruct commitment: ${g instanceof Error?g.message:String(g)}`)}}}function saveWalletToStorage(y,u){localStorage.setItem(STORAGE_KEY_GENERATORS.l1WalletByKey(y),JSON.stringify(u))}function loadWalletFromStorage(y){const u=localStorage.getItem(STORAGE_KEY_GENERATORS.l1WalletByKey(y));if(!u)return null;try{return JSON.parse(u)}catch{return console.error(`[Storage] Failed to parse wallet data for key: ${y}`),null}}function generateAddress(y){const u=y.addresses.filter(w=>!w.isChange),v=(u.length>0?Math.max(...u.map(w=>w.index??0)):-1)+1,b=y.isImportedAlphaWallet&&y.chainCode?generateHDAddressBIP32(y.masterPrivateKey,y.chainCode,v,y.descriptorPath?`m/${y.descriptorPath}`:void 0,!1):generateAddressFromMasterKey(y.masterPrivateKey,v);return y.addresses.push(b),saveWalletToStorage("main",y),b}function bytesToHex(y){return Array.from(y).map(u=>u.toString(16).padStart(2,"0")).join("")}function addressToScriptHash(y){const u=decodeBech32(y);if(!u)throw new Error("Invalid bech32 address: "+y);const g="0014"+bytesToHex(u.data);return CryptoJS.SHA256(CryptoJS.enc.Hex.parse(g)).toString().match(/../g).reverse().join("")}const DEFAULT_ENDPOINT="wss://fulcrum.unicity.network:50004";let ws=null,isConnected=!1,isConnecting=!1,requestId=0,intentionalClose=!1,reconnectAttempts=0,isBlockSubscribed=!1,lastBlockHeader=null;const pending={},blockSubscribers=[],connectionCallbacks=[],MAX_RECONNECT_ATTEMPTS=10,BASE_DELAY=2e3,MAX_DELAY=6e4,RPC_TIMEOUT=3e4,CONNECTION_TIMEOUT=3e4;function isWebSocketConnected(){return isConnected&&ws!==null&&ws.readyState===WebSocket.OPEN}function waitForConnection(){return isWebSocketConnected()?Promise.resolve():new Promise((y,u)=>{const g={resolve:()=>{g.timeoutId&&clearTimeout(g.timeoutId),y()},reject:v=>{g.timeoutId&&clearTimeout(g.timeoutId),u(v)}};g.timeoutId=setTimeout(()=>{const v=connectionCallbacks.indexOf(g);v>-1&&connectionCallbacks.splice(v,1),u(new Error("Connection timeout"))},CONNECTION_TIMEOUT),connectionCallbacks.push(g)})}function connect(y=DEFAULT_ENDPOINT){return console.log("[L1] connect() called, endpoint:",y),console.log("[L1] connect() state - isConnected:",isConnected,"isConnecting:",isConnecting),isConnected?(console.log("[L1] Already connected, returning immediately"),Promise.resolve()):isConnecting?(console.log("[L1] Already connecting, waiting for connection..."),waitForConnection()):(isConnecting=!0,console.log("[L1] Starting new connection to:",y),new Promise((u,g)=>{let v=!1;console.log("[L1] Creating WebSocket object...");try{ws=new WebSocket(y),console.log("[L1] WebSocket object created, readyState:",ws.readyState)}catch(b){console.error("[L1] WebSocket constructor threw exception:",b),isConnecting=!1,g(b);return}ws.onopen=()=>{console.log("[L1] WebSocket connected:",y),isConnected=!0,isConnecting=!1,reconnectAttempts=0,v=!0,u(),connectionCallbacks.forEach(b=>{b.timeoutId&&clearTimeout(b.timeoutId),b.resolve()}),connectionCallbacks.length=0},ws.onclose=()=>{if(isConnected=!1,isBlockSubscribed=!1,Object.values(pending).forEach(w=>{w.timeoutId&&clearTimeout(w.timeoutId),w.reject(new Error("WebSocket connection closed"))}),Object.keys(pending).forEach(w=>delete pending[Number(w)]),intentionalClose){console.log("[L1] WebSocket closed intentionally"),intentionalClose=!1,isConnecting=!1,reconnectAttempts=0,v||(v=!0,g(new Error("WebSocket connection closed intentionally")));return}if(reconnectAttempts>=MAX_RECONNECT_ATTEMPTS){console.error("[L1] Max reconnect attempts reached. Giving up."),isConnecting=!1;const w=new Error("Max reconnect attempts reached");connectionCallbacks.forEach(E=>{E.timeoutId&&clearTimeout(E.timeoutId),E.reject(w)}),connectionCallbacks.length=0,v||(v=!0,g(w));return}const b=Math.min(BASE_DELAY*Math.pow(2,reconnectAttempts),MAX_DELAY);reconnectAttempts++,console.warn(`[L1] WebSocket closed unexpectedly. Reconnecting in ${b}ms (attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS})...`),setTimeout(()=>{connect(y).then(()=>{v||(v=!0,u())}).catch(w=>{v||(v=!0,g(w))})},b)},ws.onerror=b=>{console.error("[L1] WebSocket error:",b),console.error("[L1] WebSocket error - readyState:",ws?.readyState),console.error("[L1] WebSocket error - url:",y)},ws.onmessage=b=>handleMessage(b)}))}function handleMessage(y){const u=JSON.parse(y.data);if(u.id&&pending[u.id]){const g=pending[u.id];delete pending[u.id],u.error?g.reject(u.error):g.resolve(u.result)}if(u.method==="blockchain.headers.subscribe"){const g=u.params[0];lastBlockHeader=g,blockSubscribers.forEach(v=>v(g))}}async function rpc(y,u=[]){return!isConnected&&!isConnecting&&(console.log("[L1] RPC: Auto-connecting to WebSocket..."),await connect()),isWebSocketConnected()||(console.log("[L1] RPC: Waiting for WebSocket connection..."),await waitForConnection()),new Promise((g,v)=>{if(!ws||ws.readyState!==WebSocket.OPEN)return v(new Error("WebSocket not connected (OPEN)"));const b=++requestId,w=setTimeout(()=>{pending[b]&&(delete pending[b],v(new Error(`RPC timeout: ${y}`)))},RPC_TIMEOUT);pending[b]={resolve:E=>{clearTimeout(w),g(E)},reject:E=>{clearTimeout(w),v(E)},timeoutId:w},ws.send(JSON.stringify({jsonrpc:"2.0",id:b,method:y,params:u}))})}async function getUtxo(y){const u=addressToScriptHash(y),g=await rpc("blockchain.scripthash.listunspent",[u]);return Array.isArray(g)?g.map(v=>({tx_hash:v.tx_hash,tx_pos:v.tx_pos,value:v.value,height:v.height,address:y})):(console.warn("listunspent returned non-array:",g),[])}async function getBalance(y){const u=addressToScriptHash(y),g=await rpc("blockchain.scripthash.get_balance",[u]),v=g.confirmed||0,b=g.unconfirmed||0;return(v+b)/1e8}async function broadcast(y){return await rpc("blockchain.transaction.broadcast",[y])}async function subscribeBlocks(y){if(!isConnected&&!isConnecting&&await connect(),isWebSocketConnected()||await waitForConnection(),blockSubscribers.push(y),isBlockSubscribed)lastBlockHeader&&y(lastBlockHeader);else{isBlockSubscribed=!0;const u=await rpc("blockchain.headers.subscribe",[]);u&&(lastBlockHeader=u,blockSubscribers.forEach(g=>g(u)))}return()=>{const u=blockSubscribers.indexOf(y);u>-1&&blockSubscribers.splice(u,1)}}async function getTransactionHistory(y){const u=addressToScriptHash(y),g=await rpc("blockchain.scripthash.get_history",[u]);return Array.isArray(g)?g:(console.warn("get_history returned non-array:",g),[])}async function getTransaction(y){return await rpc("blockchain.transaction.get",[y,!0])}async function getCurrentBlockHeight(){try{return(await rpc("blockchain.headers.subscribe",[]))?.height||0}catch(y){return console.error("Error getting current block height:",y),0}}function disconnect(){ws&&(intentionalClose=!0,ws.close(),ws=null),isConnected=!1,isConnecting=!1,reconnectAttempts=0,isBlockSubscribed=!1,Object.values(pending).forEach(y=>{y.timeoutId&&clearTimeout(y.timeoutId)}),Object.keys(pending).forEach(y=>delete pending[Number(y)]),connectionCallbacks.forEach(y=>{y.timeoutId&&clearTimeout(y.timeoutId)}),connectionCallbacks.length=0}const VESTING_THRESHOLD=28e4;let currentBlockHeight=null;class VestingClassifier{memoryCache=new Map;dbName="SphereVestingCacheV5";storeName="vestingCache";db=null;async initDB(){return new Promise((u,g)=>{const v=indexedDB.open(this.dbName,1);v.onupgradeneeded=b=>{const w=b.target.result;w.objectStoreNames.contains(this.storeName)||w.createObjectStore(this.storeName,{keyPath:"txHash"})},v.onsuccess=b=>{this.db=b.target.result,u()},v.onerror=()=>g(v.error)})}isCoinbaseTransaction(u){if(u.vin&&u.vin.length===1){const g=u.vin[0];if(g.coinbase||!g.txid&&g.coinbase!==void 0||g.txid==="0000000000000000000000000000000000000000000000000000000000000000")return!0}return!1}async loadFromDB(u){return this.db?new Promise(g=>{const w=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).get(u);w.onsuccess=()=>{w.result?g({blockHeight:w.result.blockHeight,isCoinbase:w.result.isCoinbase,inputTxId:w.result.inputTxId}):g(null)},w.onerror=()=>g(null)}):null}async saveToDB(u,g){if(this.db)return new Promise(v=>{const b=this.db.transaction(this.storeName,"readwrite");b.objectStore(this.storeName).put({txHash:u,...g}),b.oncomplete=()=>v(),b.onerror=()=>v()})}async traceToOrigin(u){let g=u,v=0;const b=1e4;for(;v<b;){v++;const w=this.memoryCache.get(g);if(w){if(w.isCoinbase){if(w.blockHeight!==null&&w.blockHeight!==void 0)return{coinbaseHeight:w.blockHeight}}else if(w.inputTxId){g=w.inputTxId;continue}}const E=await this.loadFromDB(g);if(E){if(this.memoryCache.set(g,E),E.isCoinbase){if(E.blockHeight!==null&&E.blockHeight!==void 0)return{coinbaseHeight:E.blockHeight}}else if(E.inputTxId){g=E.inputTxId;continue}}const S=await getTransaction(g);if(!S||!S.txid)return{coinbaseHeight:null,error:`Failed to fetch tx ${g}`};const A=this.isCoinbaseTransaction(S);let $=null;S.confirmations&&currentBlockHeight!==null&&currentBlockHeight!==void 0&&($=currentBlockHeight-S.confirmations+1);let R=null;!A&&S.vin&&S.vin.length>0&&S.vin[0].txid&&(R=S.vin[0].txid);const T={blockHeight:$,isCoinbase:A,inputTxId:R};if(this.memoryCache.set(g,T),await this.saveToDB(g,T),A)return console.log(`Traced to coinbase at block ${$}, isVested: ${$!==null&&$<=VESTING_THRESHOLD}`),{coinbaseHeight:$};if(!R)return{coinbaseHeight:null,error:"Could not find input transaction"};g=R}return{coinbaseHeight:null,error:"Max iterations exceeded"}}async classifyUtxo(u){const g=u.tx_hash||u.txid;if(!g)return{isVested:!1,coinbaseHeight:null,error:"No transaction hash"};try{const v=await this.traceToOrigin(g);return v.error||v.coinbaseHeight===null?{isVested:!1,coinbaseHeight:null,error:v.error||"Could not trace to origin"}:{isVested:v.coinbaseHeight<=VESTING_THRESHOLD,coinbaseHeight:v.coinbaseHeight}}catch(v){return{isVested:!1,coinbaseHeight:null,error:v instanceof Error?v.message:String(v)}}}async classifyUtxos(u,g){currentBlockHeight=await getCurrentBlockHeight(),console.log(`VestingClassifier: blockHeight=${currentBlockHeight}, threshold=${VESTING_THRESHOLD}, utxos=${u.length}`),this.memoryCache.clear();const v=[],b=[],w=[];for(let E=0;E<u.length;E++){const S=u[E],A=await this.classifyUtxo(S);A.error?(w.push({utxo:S,error:A.error}),b.push({...S,vestingStatus:"error",coinbaseHeight:null})):A.isVested?v.push({...S,vestingStatus:"vested",coinbaseHeight:A.coinbaseHeight}):b.push({...S,vestingStatus:"unvested",coinbaseHeight:A.coinbaseHeight}),g&&g(E+1,u.length),E%5===0&&await new Promise($=>setTimeout($,0))}return console.log(`VestingClassifier: ${v.length} vested, ${b.length} unvested, ${w.length} errors`),{vested:v,unvested:b,errors:w}}clearCaches(){this.memoryCache.clear(),this.db&&this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).clear()}}const vestingClassifier=new VestingClassifier;class VestingStateManager{currentMode="all";addressCache=new Map;classificationInProgress=!1;setMode(u){if(!["all","vested","unvested"].includes(u))throw new Error(`Invalid vesting mode: ${u}`);this.currentMode=u}getMode(){return this.currentMode}async classifyAddressUtxos(u,g,v){if(!this.classificationInProgress){this.classificationInProgress=!0;try{await vestingClassifier.initDB();const b=await vestingClassifier.classifyUtxos(g,v),w=b.vested.reduce((S,A)=>S+BigInt(A.value),0n),E=b.unvested.reduce((S,A)=>S+BigInt(A.value),0n);this.addressCache.set(u,{classifiedUtxos:{vested:b.vested,unvested:b.unvested,all:[...b.vested,...b.unvested]},vestingBalances:{vested:w,unvested:E,all:w+E}}),b.errors.length>0&&(console.warn(`Vesting classification errors: ${b.errors.length}`),b.errors.slice(0,5).forEach(S=>{const A=S.utxo.tx_hash||S.utxo.txid;console.warn(`  ${A}: ${S.error}`)}))}finally{this.classificationInProgress=!1}}}getFilteredUtxos(u){const g=this.addressCache.get(u);if(!g)return[];switch(this.currentMode){case"vested":return g.classifiedUtxos.vested;case"unvested":return g.classifiedUtxos.unvested;default:return g.classifiedUtxos.all}}getAllUtxos(u){const g=this.addressCache.get(u);return g?g.classifiedUtxos.all:[]}getBalance(u){const g=this.addressCache.get(u);return g?g.vestingBalances[this.currentMode]:0n}getAllBalances(u){const g=this.addressCache.get(u);return g?g.vestingBalances:{vested:0n,unvested:0n,all:0n}}hasClassifiedData(u){return this.addressCache.has(u)}isClassifying(){return this.classificationInProgress}clearAddressCache(u){this.addressCache.delete(u)}clearAllCaches(){this.addressCache.clear(),vestingClassifier.clearCaches()}}const vestingState=new VestingStateManager;class WalletAddressHelper{static findByPath(u,g){return u.addresses.find(v=>v.path===g)}static getDefault(u){return u.addresses.find(g=>!g.isChange)??u.addresses[0]}static getDefaultOrNull(u){if(!(!u.addresses||u.addresses.length===0))return u.addresses.find(g=>!g.isChange)??u.addresses[0]}static add(u,g){if(!g.path)throw new Error("Cannot add address without a path");const v=this.findByPath(u,g.path);if(v){if(v.address!==g.address)throw new Error(`CRITICAL: Attempted to overwrite address for path ${g.path}
Existing: ${v.address}
New: ${g.address}
This indicates master key corruption or derivation logic error.`);return u}return{...u,addresses:[...u.addresses,g]}}static removeByPath(u,g){return{...u,addresses:u.addresses.filter(v=>v.path!==g)}}static getExternal(u){return u.addresses.filter(g=>!g.isChange)}static getChange(u){return u.addresses.filter(g=>g.isChange)}static hasPath(u,g){return u.addresses.some(v=>v.path===g)}static validate(u){const g=u.addresses.map(b=>b.path).filter(Boolean),v=new Set(g);if(g.length!==v.size){const b=g.filter((w,E)=>g.indexOf(w)!==E);throw new Error(`CRITICAL: Wallet has duplicate paths: ${b.join(", ")}
This indicates data corruption. Please restore from backup.`)}}static sortAddresses(u){const g=[...u.addresses].sort((v,b)=>{const w=v.isChange?1:0,E=b.isChange?1:0;return w!==E?w-E:v.index-b.index});return{...u,addresses:g}}}const ec$1=new elliptic.ec("secp256k1"),FEE=1e4,DUST=546,SAT=1e8;function createScriptPubKey(y){if(!y||typeof y!="string")throw new Error("Invalid address: must be a string");const u=decodeBech32(y);if(!u)throw new Error("Invalid bech32 address: "+y);return"0014"+Array.from(u.data).map(v=>v.toString(16).padStart(2,"0")).join("")}function createSignatureHash(y,u){let g="";g+="02000000";const v=y.input.tx_hash.match(/../g).reverse().join(""),b=("00000000"+y.input.tx_pos.toString(16)).slice(-8).match(/../g).reverse().join(""),w=v+b,E=CryptoJS.SHA256(CryptoJS.SHA256(CryptoJS.enc.Hex.parse(w))).toString();g+=E;const S="feffffff",A=CryptoJS.SHA256(CryptoJS.SHA256(CryptoJS.enc.Hex.parse(S))).toString();g+=A,g+=y.input.tx_hash.match(/../g).reverse().join(""),g+=("00000000"+y.input.tx_pos.toString(16)).slice(-8).match(/../g).reverse().join("");const R="1976a914"+CryptoJS.RIPEMD160(CryptoJS.SHA256(CryptoJS.enc.Hex.parse(u))).toString()+"88ac";g+=R;const T=y.input.value.toString(16).padStart(16,"0");g+=T.match(/../g).reverse().join(""),g+=S;let O="";for(const q of y.outputs){const J=q.value.toString(16).padStart(16,"0");O+=J.match(/../g).reverse().join("");const ie=createScriptPubKey(q.address),oe=(ie.length/2).toString(16).padStart(2,"0");O+=oe,O+=ie}const B=CryptoJS.SHA256(CryptoJS.SHA256(CryptoJS.enc.Hex.parse(O))).toString();g+=B,g+="00000000",g+="01000000";const F=CryptoJS.SHA256(CryptoJS.enc.Hex.parse(g));return CryptoJS.SHA256(F).toString()}function createWitnessData(y,u,g){const v=createSignatureHash(y,g),b=u.sign(v),w=ec$1.curve.n.shrn(1);b.s.cmp(w)>0&&(b.s=ec$1.curve.n.sub(b.s));const E=b.toDER("hex")+"01";let S="";S+="02";const A=(E.length/2).toString(16).padStart(2,"0");S+=A,S+=E;const $=(g.length/2).toString(16).padStart(2,"0");return S+=$,S+=g,S}function buildSegWitTransaction(y,u,g){let v="";v+="02000000",v+="00",v+="01",v+="01";const w=y.input.tx_hash.match(/../g).reverse().join("");v+=w;const E=y.input.tx_pos;v+=("00000000"+E.toString(16)).slice(-8).match(/../g).reverse().join(""),v+="00",v+="feffffff";const S=y.outputs.length;v+=("0"+S.toString(16)).slice(-2);for(const F of y.outputs){const U=F.value.toString(16).padStart(16,"0");v+=U.match(/../g).reverse().join("");const q=createScriptPubKey(F.address),J=(q.length/2).toString(16).padStart(2,"0");v+=J,v+=q}const A=createWitnessData(y,u,g);v+=A,v+="00000000";let $="";$+="02000000",$+="01";const R=y.input.tx_hash.match(/../g).reverse().join("");$+=R,$+=("00000000"+y.input.tx_pos.toString(16)).slice(-8).match(/../g).reverse().join(""),$+="00",$+="feffffff",$+=("0"+y.outputs.length.toString(16)).slice(-2);for(const F of y.outputs){const q=("0000000000000000"+F.value.toString(16)).slice(-16).match(/../g).reverse().join("");$+=q;const J=createScriptPubKey(F.address),ie=("0"+(J.length/2).toString(16)).slice(-2);$+=ie,$+=J}$+="00000000";const T=CryptoJS.SHA256(CryptoJS.enc.Hex.parse($)),B=CryptoJS.SHA256(T).toString().match(/../g).reverse().join("");return{hex:v,txid:B}}function createAndSignTransaction(y,u){const g=u.input.address,v=y.addresses.find($=>$.address===g);let b;if(v?.privateKey?b=v.privateKey:y.childPrivateKey?b=y.childPrivateKey:b=y.masterPrivateKey,!b)throw new Error("No private key available for address: "+g);const w=ec$1.keyFromPrivate(b,"hex"),E=w.getPublic(!0,"hex"),S={input:{tx_hash:u.input.txid,tx_pos:u.input.vout,value:u.input.value},outputs:u.outputs},A=buildSegWitTransaction(S,w,E);return{raw:A.hex,txid:A.txid}}function collectUtxosForAmount(y,u,g,v){const b=y.reduce((R,T)=>R+T.value,0);if(b<u+FEE)return{success:!1,transactions:[],error:`Insufficient funds. Available: ${b/SAT} ALPHA, Required: ${(u+FEE)/SAT} ALPHA (including fee)`};const E=[...y].sort((R,T)=>R.value-T.value).find(R=>R.value>=u+FEE);if(E){const R=E.value-u-FEE,T={input:{txid:E.txid??E.tx_hash??"",vout:E.vout??E.tx_pos??0,value:E.value,address:E.address??v},outputs:[{address:g,value:u}],fee:FEE,changeAmount:R,changeAddress:v};return R>DUST&&T.outputs.push({value:R,address:v}),{success:!0,transactions:[T]}}const S=[...y].sort((R,T)=>T.value-R.value),A=[];let $=u;for(const R of S){if($<=0)break;const T=R.value;let O=0,B=0;if(T>=$+FEE)O=$,B=T-$-FEE,$=0;else{if(O=T-FEE,O<=0)continue;$-=O}const F={input:{txid:R.txid??R.tx_hash??"",vout:R.vout??R.tx_pos??0,value:R.value,address:R.address??v},outputs:[{address:g,value:O}],fee:FEE,changeAmount:B,changeAddress:v};B>DUST&&F.outputs.push({value:B,address:v}),A.push(F)}return $>0?{success:!1,transactions:[],error:`Unable to collect enough UTXOs. Short by ${$/SAT} ALPHA after fees.`}:{success:!0,transactions:A}}async function createTransactionPlan(y,u,g,v){if(!decodeBech32(u))throw new Error("Invalid recipient address");const b=WalletAddressHelper.getDefault(y),w=v||b.address,E=Math.floor(g*SAT);let S;const A=vestingState.getMode();if(vestingState.hasClassifiedData(w)?(S=vestingState.getFilteredUtxos(w),console.log(`Using ${S.length} ${A} UTXOs`)):(S=await getUtxo(w),console.log(`Using ${S.length} UTXOs (vesting not classified yet)`)),!Array.isArray(S)||S.length===0){const $=A!=="all"?` (${A} coins)`:"";throw new Error(`No UTXOs available${$} for address: `+w)}return collectUtxosForAmount(S,E,u,w)}const HKDF_INFO="ipfs-storage-ed25519-v1";function hexToBytes(y){const u=new Uint8Array(y.length/2);for(let g=0;g<u.length;g++)u[g]=parseInt(y.substr(g*2,2),16);return u}async function deriveIpnsNameFromPrivateKey(y){const u=hexToBytes(y),g=hkdf(sha256,u,void 0,HKDF_INFO,32),v=await generateKeyPairFromSeed("Ed25519",g);return peerIdFromPrivateKey(v).toString()}async function fetchNametagFromIpns(y){let u="";try{u=await deriveIpnsNameFromPrivateKey(y);const g=await fetchViaHttpGateway(u);return g?{ipnsName:u,nametag:g.name,nametagData:{name:g.name,token:g.data.token||{},timestamp:g.data.timestamp,format:g.data.format},source:"http"}:{ipnsName:u,nametag:null,source:"none"}}catch(g){const v=g instanceof Error?g.message:String(g);return console.warn(`Failed to fetch nametag for IPNS ${u}:`,v),{ipnsName:u||"unknown",nametag:null,source:"none",error:v}}}async function fetchWithTimeout(y,u){const g=new AbortController,v=setTimeout(()=>g.abort(),u);try{return await fetch(y,{signal:g.signal,headers:{Accept:"application/json, application/vnd.ipld.dag-json"}})}finally{clearTimeout(v)}}async function fetchViaHttpGateway(y){const u=getAllBackendGatewayUrls();if(u.length===0){const v=getBackendGatewayUrl();if(!v)throw new Error("No IPFS gateway configured");u.push(v)}const g=u.flatMap(v=>[tryGatewayPath(v,y).catch(()=>null),tryRoutingApi(v,y).catch(()=>null)]);try{return await Promise.any(g.map(async b=>{const w=await b;if(w===null)throw new Error("No result");return w}))}catch{return null}}async function tryGatewayPath(y,u){const g=`${y}/ipns/${u}?format=dag-json`;let v;try{v=await fetchWithTimeout(g,IPNS_RESOLUTION_CONFIG.gatewayPathTimeoutMs)}catch(w){throw w instanceof Error&&w.name==="AbortError"?new Error("IPNS gateway path timeout"):w}if(!v.ok)return null;let b;try{b=await v.json()}catch{return null}return b._nametag&&typeof b._nametag.name=="string"?{name:b._nametag.name,data:b._nametag}:null}async function tryRoutingApi(y,u){const g=new AbortController,v=setTimeout(()=>g.abort(),IPNS_RESOLUTION_CONFIG.perGatewayTimeoutMs);try{const b=`${y}/api/v0/routing/get?arg=/ipns/${u}`,w=await fetch(b,{method:"POST",signal:g.signal});if(!w.ok)return null;const E=await w.json();if(!E.Extra)return null;const S=Uint8Array.from(atob(E.Extra),F=>F.charCodeAt(0)),$=unmarshalIPNSRecord(S).value.match(/^\/ipfs\/(.+)$/);if(!$)return null;const R=$[1],T=`${y}/ipfs/${R}?format=dag-json`,O=await fetch(T,{signal:g.signal,headers:{Accept:"application/vnd.ipld.dag-json, application/json"}});if(!O.ok)return null;let B;try{B=await O.json()}catch{return null}return B._nametag&&typeof B._nametag.name=="string"?{name:B._nametag.name,data:B._nametag}:null}catch(b){throw b instanceof Error&&b.name==="AbortError"?new Error("IPNS routing API timeout"):b}finally{clearTimeout(v)}}function generateAddressAtPath(y,u,g){const v=deriveKeyAtPath(y,u,g),w=ec$3.keyFromPrivate(v.privateKey).getPublic(!0,"hex");return{address:publicKeyToAddress(w),privateKey:v.privateKey,publicKey:w,path:g}}const ACTIVE_SYNC_LIMIT=10;async function getCachedL3Info(y){try{const g=await IdentityManager.getInstance("user-pin-1234").deriveIdentityFromPath(y),v=g.address,b=WalletRepository.checkNametagForAddress(v),w=WalletRepository.checkTokensForAddress(v);return{nametag:b?.name,hasInventory:!!b||w,l3Address:v,l3PrivateKey:g.privateKey}}catch(u){return console.warn("Error getting cached L3 info:",u),{hasInventory:!1}}}async function scanWalletAddresses(y,u=200,g,v){const b=[];let w=0,E=!1;if(!y.masterPrivateKey)throw new Error("No master private key in wallet");const S=y.masterChainCode||y.chainCode;if(!S)throw new Error("No chain code found - cannot derive BIP32 addresses");const A=y.descriptorPath?[`m/${y.descriptorPath}`]:["m/44'/0'/0'"];console.log(`[Scan] Using base path: ${A[0]}`),console.log(`[Scan] Master key prefix: ${y.masterPrivateKey.slice(0,16)}...`),console.log(`[Scan] Chain code prefix: ${S.slice(0,16)}...`),await UnifiedKeyManager.getInstance("user-pin-1234").importWithMode(y.masterPrivateKey,S,"bip32",A[0]),console.log(`[Scan] UnifiedKeyManager initialized with basePath: ${A[0]}`);const R=[0,1],T=new Map,O=[],B=new Map;console.log("[Scan] Starting IPNS nametag prefetch in background...");const U=(async()=>{for(const ie of A)for(const oe of[0,1])for(let le=0;le<Math.min(ACTIVE_SYNC_LIMIT,u);le++){const de=`${ie}/${oe}/${le}`;try{const fe=generateAddressAtPath(y.masterPrivateKey,S,de);B.has(fe.privateKey)||(O.push({privateKey:fe.privateKey,index:le,chain:oe,basePath:ie}),B.set(fe.privateKey,{address:fe.address,path:de,privateKey:fe.privateKey,publicKey:fe.publicKey,index:le,chain:oe}))}catch{}}const J=O.map(async({privateKey:ie,index:oe,chain:le,basePath:de})=>{try{const fe=await fetchNametagFromIpns(ie);if(fe.nametag){T.set(ie,fe.nametag);const ye=le===1?"change":"external",we=`${de}/${le}/${oe}`;console.log(`[Scan] Found nametag from IPNS for ${ye} index ${oe} (path: ${we}, key: ${ie.slice(0,8)}...): ${fe.nametag}`);const pe=B.get(ie);if(pe){const ve=pe.chain===1,he=b.findIndex(ae=>ae.privateKey===ie);he>=0?b[he].l3Nametag||(b[he].l3Nametag=fe.nametag,b[he].hasL3Inventory=!0,console.log(`[Scan] Updated ${ye} index ${pe.index} with nametag @${fe.nametag}`)):(b.push({index:pe.index,address:pe.address,path:pe.path,balance:0,privateKey:pe.privateKey,publicKey:pe.publicKey,isChange:ve,l3Nametag:fe.nametag,hasL3Inventory:!0,l3Synced:!1}),console.log(`[Scan] Added L3 ${ye} address ${pe.index} with nametag @${fe.nametag}`)),g?.({current:Math.max(...b.map(ae=>ae.index),0)+1,total:u,found:b.length,totalBalance:w,foundAddresses:[...b],l1ScanComplete:E})}}}catch{}});await Promise.race([Promise.all(J),new Promise(ie=>setTimeout(ie,3e4))]),console.log(`[Scan] IPNS prefetch complete, found ${T.size} nametags`)})();for(let J=0;J<u&&!v?.();J++){for(const ie of A)for(const oe of R)try{const le=`${ie}/${oe}/${J}`,de=generateAddressAtPath(y.masterPrivateKey,S,le),fe=await getBalance(de.address),ye=await getCachedL3Info(le),we=T.get(de.privateKey),pe=ye.hasInventory||!!we,ve=fe>0||pe,he=b.findIndex(ae=>ae.privateKey===de.privateKey);if(ve)if(he>=0){const ae=b[he];fe>0&&ae.balance===0?(b[he]={...ae,address:de.address,path:de.path,balance:fe,privateKey:de.privateKey,publicKey:de.publicKey,l3Nametag:we||ye.nametag||ae.l3Nametag,hasL3Inventory:pe||ae.hasL3Inventory},w+=fe):fe===0&&ae.balance===0&&(b[he]={...ae,l3Nametag:we||ye.nametag||ae.l3Nametag,hasL3Inventory:pe||ae.hasL3Inventory})}else b.push({index:J,address:de.address,path:de.path,balance:fe,privateKey:de.privateKey,publicKey:de.publicKey,isChange:oe===1,l3Nametag:we||ye.nametag,hasL3Inventory:pe,l3Synced:!1}),w+=fe}catch(le){console.warn(`Error deriving address at ${ie}/${oe}/${J}:`,le)}g?.({current:J+1,total:u,found:b.length,totalBalance:w,foundAddresses:[...b]}),J%10===0&&J>0&&await new Promise(ie=>setTimeout(ie,50))}E=!0,g?.({current:u,total:u,found:b.length,totalBalance:w,foundAddresses:[...b],l1ScanComplete:!0}),console.log("[Scan] Main scan complete. Waiting for IPNS prefetch to finish..."),await U;let q=0;for(const[J,ie]of T){if(!ie)continue;const oe=B.get(J);if(!oe)continue;const le=oe.chain===1,de=le?"change":"external",fe=b.findIndex(ye=>ye.privateKey===J);fe>=0?b[fe].l3Nametag||(b[fe].l3Nametag=ie,b[fe].hasL3Inventory=!0):(b.push({index:oe.index,address:oe.address,path:oe.path,balance:0,privateKey:oe.privateKey,publicKey:oe.publicKey,isChange:le,l3Nametag:ie,hasL3Inventory:!0,l3Synced:!1}),q++,console.log(`[Scan] Safety net: Added ${de} address ${oe.index} with nametag @${ie}`))}return q>0&&g?.({current:u,total:u,found:b.length,totalBalance:w,foundAddresses:[...b],l1ScanComplete:!0}),b.length>0&&console.log(`[Scan] Scan complete: found ${b.length} addresses (${q} from IPNS prefetch)`),{addresses:b,totalBalance:w,scannedCount:Math.min(u,v?.()?0:u)}}const SESSION_KEY$5="user-pin-1234";async function loadWalletFromUnifiedKeyManager(){const y=UnifiedKeyManager.getInstance(SESSION_KEY$5);if(!await y.initialize()||!y.isInitialized())return null;const g=loadWalletFromStorage("main");if(g&&g.addresses&&g.addresses.length>0)return console.log(` Loading L1 wallet from storage with ${g.addresses.length} addresses`),g;const v=y.getWalletInfo(),b=y.getMasterKeyHex(),w=y.getChainCodeHex();if(!b)return null;const E=localStorage.getItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH),A=`${y.getBasePath()}/0/0`,$=E||A,R=y.deriveAddressFromPath($),T=[{address:R.l1Address,publicKey:R.publicKey,privateKey:R.privateKey,path:R.path,index:R.index}];return{masterPrivateKey:b,chainCode:w||void 0,addresses:T,createdAt:Date.now(),isImportedAlphaWallet:v.source==="file",isBIP32:v.derivationMode==="bip32",childPrivateKey:R.privateKey||null}}function getUnifiedKeyManager(){return UnifiedKeyManager.getInstance(SESSION_KEY$5)}const L1_KEYS={WALLET:["l1","wallet"],BALANCE:y=>["l1","balance",y],TOTAL_BALANCE:["l1","totalBalance"],TRANSACTIONS:y=>["l1","transactions",y],BLOCK_HEIGHT:["l1","blockHeight"],VESTING:y=>["l1","vesting",y]};function useL1Wallet(y){const u=useQueryClient(),g=useQuery({queryKey:L1_KEYS.WALLET,queryFn:async()=>await loadWalletFromUnifiedKeyManager(),staleTime:1/0}),v=reactExports.useMemo(()=>{if(y)return y;const ie=g.data;if(!ie||ie.addresses.length===0)return"";const oe=localStorage.getItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH);if(oe){const le=ie.addresses.find(de=>de.path===oe);if(le)return le.address}return ie.addresses[0]?.address||""},[y,g.data]),b=reactExports.useRef(v||"");reactExports.useEffect(()=>{b.current=v||""},[v]),reactExports.useEffect(()=>{let ie=!0,oe=null;return(async()=>{try{const le=await subscribeBlocks(()=>{ie&&b.current&&(u.invalidateQueries({queryKey:L1_KEYS.BALANCE(b.current)}),u.invalidateQueries({queryKey:L1_KEYS.TOTAL_BALANCE}),u.invalidateQueries({queryKey:L1_KEYS.TRANSACTIONS(b.current)}),u.invalidateQueries({queryKey:L1_KEYS.VESTING(b.current)}),u.invalidateQueries({queryKey:L1_KEYS.BLOCK_HEIGHT}))});ie?oe=le:le()}catch(le){console.error("Error subscribing to blocks:",le)}})(),()=>{ie=!1,oe&&oe()}},[u]);const w=useQuery({queryKey:L1_KEYS.BALANCE(v||""),queryFn:()=>getBalance(v),enabled:!!v,staleTime:3e4}),E=useQuery({queryKey:[...L1_KEYS.TOTAL_BALANCE,g.data?.addresses.map(ie=>ie.address).join(",")],queryFn:async()=>{const ie=g.data;return!ie||ie.addresses.length===0?0:(await Promise.all(ie.addresses.map(le=>getBalance(le.address)))).reduce((le,de)=>le+de,0)},enabled:!!g.data&&g.data.addresses.length>0,staleTime:3e4}),S=useQuery({queryKey:L1_KEYS.BLOCK_HEIGHT,queryFn:getCurrentBlockHeight,staleTime:6e4}),A=useQuery({queryKey:L1_KEYS.TRANSACTIONS(v||""),queryFn:async()=>{if(!v)return{transactions:[],details:{}};const oe=[...await getTransactionHistory(v)].sort((de,fe)=>de.height===0&&fe.height===0?0:de.height===0?-1:fe.height===0?1:fe.height-de.height),le={};for(const de of oe)try{const fe=await getTransaction(de.tx_hash);le[de.tx_hash]=fe}catch(fe){console.error(`Error loading transaction ${de.tx_hash}:`,fe)}return{transactions:oe,details:le}},enabled:!!v,staleTime:3e4}),$=useQuery({queryKey:L1_KEYS.VESTING(v||""),queryFn:async()=>{if(!v)return{balances:{vested:0n,unvested:0n,all:0n},mode:vestingState.getMode(),isClassifying:!1};const ie=await getUtxo(v);return ie.length>0&&await vestingState.classifyAddressUtxos(v,ie),{balances:vestingState.getAllBalances(v),mode:vestingState.getMode(),isClassifying:vestingState.isClassifying()}},enabled:!!v,staleTime:6e4}),R=useMutation({mutationFn:async()=>{UnifiedKeyManager.clearAll(),await getUnifiedKeyManager().generateNew(12);const oe=await loadWalletFromUnifiedKeyManager();if(!oe)throw new Error("Failed to create wallet");return oe},onSuccess:()=>{u.invalidateQueries({queryKey:L1_KEYS.WALLET}),u.invalidateQueries({queryKey:["l3","identity"]}),u.invalidateQueries({queryKey:["l3","nametag"]}),u.invalidateQueries({queryKey:["l3","tokens"]})}}),T=useMutation({mutationFn:async({file:ie,password:oe})=>{UnifiedKeyManager.clearAll();const le=getUnifiedKeyManager(),de=await ie.text();if(oe){const ye=await importWallet(ie,oe);if(!ye.success||!ye.wallet)throw new Error(ye.error||"Import failed");const we=ye.wallet.masterPrivateKey,pe=ye.wallet.chainCode;let ve=`MASTER PRIVATE KEY:
${we}`;pe&&(ve+=`

MASTER CHAIN CODE:
${pe}`),await le.importFromFileContent(ve)}else await le.importFromFileContent(de);const fe=await loadWalletFromUnifiedKeyManager();if(!fe)throw new Error("Failed to import wallet");return fe},onSuccess:()=>{u.invalidateQueries({queryKey:L1_KEYS.WALLET}),u.invalidateQueries({queryKey:["l3","identity"]}),u.invalidateQueries({queryKey:["l3","nametag"]}),u.invalidateQueries({queryKey:["l3","tokens"]})}}),O=useMutation({mutationFn:async()=>{UnifiedKeyManager.clearAll(),WalletRepository.getInstance().resetInMemoryState()},onSuccess:()=>{u.setQueryData(KEYS$1.IDENTITY,null),u.setQueryData(KEYS$1.NAMETAG,null),u.removeQueries({queryKey:["wallet"]}),u.removeQueries({queryKey:["l1"]})}}),B=useMutation({mutationFn:async({wallet:ie,destination:oe,amount:le,fromAddress:de})=>{const fe=Number(le);if(isNaN(fe)||fe<=0)throw new Error("Invalid amount");const ye=await createTransactionPlan(ie,oe,fe,de);if(!ye.success)throw new Error(ye.error||"Failed to create transaction plan");const we=[],pe=[];for(const ve of ye.transactions)try{const he=createAndSignTransaction(ie,ve),ae=await broadcast(he.raw);we.push({txid:he.txid,raw:he.raw,result:ae})}catch(he){console.error("Broadcast failed for tx",he),pe.push(he instanceof Error?he.message:String(he))}if(pe.length>0)throw new Error(`Some transactions failed:
${pe.join(`
`)}`);return we},onSuccess:()=>{v&&(vestingState.clearAddressCache(v),u.invalidateQueries({queryKey:L1_KEYS.BALANCE(v)}),u.invalidateQueries({queryKey:L1_KEYS.TRANSACTIONS(v)}),u.invalidateQueries({queryKey:L1_KEYS.VESTING(v)}))}}),F=(ie,oe,le)=>{try{const de=exportWallet(ie,{password:le||void 0,filename:oe});return downloadWalletFile(de,oe),{success:!0}}catch(de){return{success:!1,error:de instanceof Error?de.message:String(de)}}},U=(ie,oe,le,de)=>{if(!oe||!le)return{direction:"unknown",amount:0,fromAddresses:[],toAddresses:[]};const fe=new Set(le.addresses.map(se=>se.address.toLowerCase())),ye=de?.toLowerCase();if(le.masterPrivateKey&&le.chainCode){const se=le.descriptorPath?`m/${le.descriptorPath}`:le.isImportedAlphaWallet?"m/84'/1'/0'":null;for(let ee=0;ee<20;ee++)try{let Z;se?Z=generateHDAddressBIP32(le.masterPrivateKey,le.chainCode,ee,se,!0):Z=generateHDAddress(le.masterPrivateKey,le.chainCode,1e6+ee),fe.add(Z.address.toLowerCase())}catch(Z){console.error(`Failed to generate change address ${ee}:`,Z)}}const we=A.data?.details||{};let pe=!1,ve=0;const he=[];if(oe.vin)for(const se of oe.vin){if(!se.txid)continue;const ee=we[se.txid];if(ee&&ee.vout&&ee.vout[se.vout]){const Z=ee.vout[se.vout],ue=Z.scriptPubKey.addresses||(Z.scriptPubKey.address?[Z.scriptPubKey.address]:[]);he.push(...ue),(ye?ue.some(Re=>Re.toLowerCase()===ye):ue.some(Re=>fe.has(Re.toLowerCase())))&&(pe=!0,ve+=Z.value)}}let ae=0,Q=0;const j=[],z=[];for(const se of oe.vout){const ee=se.scriptPubKey.addresses||(se.scriptPubKey.address?[se.scriptPubKey.address]:[]);z.push(...ee),(ye?ee.some(ue=>ue.toLowerCase()===ye):ee.some(ue=>fe.has(ue.toLowerCase())))?ae+=se.value:(Q+=se.value,j.push(...ee))}const re=pe?"sent":"received";let Y;if(re==="sent")if(Q>0)Y=Q;else{const ee=ve-ae;Y=ee>0?ee:0}else Y=ae;let te=[],ne=[];return re==="sent"?ne=j.length>0?j:z:te=ye?he:he.filter(se=>!fe.has(se.toLowerCase())),{direction:re,amount:Y,fromAddresses:te,toAddresses:ne}},q=ie=>{vestingState.setMode(ie),v&&u.invalidateQueries({queryKey:L1_KEYS.VESTING(v)})},J=()=>{u.invalidateQueries({queryKey:L1_KEYS.WALLET}),v&&(u.invalidateQueries({queryKey:L1_KEYS.BALANCE(v)}),u.invalidateQueries({queryKey:L1_KEYS.TRANSACTIONS(v)}),u.invalidateQueries({queryKey:L1_KEYS.VESTING(v)}))};return{wallet:g.data,isLoadingWallet:g.isLoading,balance:w.data??0,totalBalance:E.data??0,isLoadingBalance:w.isLoading,transactions:A.data?.transactions??[],transactionDetails:A.data?.details??{},isLoadingTransactions:A.isLoading,currentBlockHeight:S.data??0,vestingBalances:$.data?.balances??{vested:0n,unvested:0n,all:0n},vestingMode:$.data?.mode??"all",isLoadingVesting:$.isLoading,isClassifyingVesting:$.data?.isClassifying??!1,createWallet:R.mutateAsync,isCreatingWallet:R.isPending,importWallet:T.mutateAsync,isImportingWallet:T.isPending,importError:T.error,deleteWallet:O.mutateAsync,isDeletingWallet:O.isPending,sendTransaction:B.mutateAsync,isSendingTransaction:B.isPending,sendError:B.error,exportWallet:F,analyzeTransaction:U,refreshAll:J,setVestingMode:q,invalidateWallet:()=>u.invalidateQueries({queryKey:L1_KEYS.WALLET}),invalidateBalance:()=>v&&u.invalidateQueries({queryKey:L1_KEYS.BALANCE(v)}),invalidateTransactions:()=>v&&u.invalidateQueries({queryKey:L1_KEYS.TRANSACTIONS(v)}),invalidateVesting:()=>v&&u.invalidateQueries({queryKey:L1_KEYS.VESTING(v)})}}const KEYS$1={IDENTITY:["wallet","identity"],TOKENS:["wallet","tokens"],PRICES:["market","prices"],REGISTRY:["market","registry"],AGGREGATED:["wallet","aggregated"],NAMETAG:["wallet","nametag"]},walletRepo$1=WalletRepository.getInstance(),registryService$1=RegistryService.getInstance(),useWallet=()=>{const y=useQueryClient(),{identityManager:u,nostrService:g}=useServices(),v=NametagService.getInstance(u);reactExports.useEffect(()=>{const de=()=>{y.refetchQueries({queryKey:KEYS$1.TOKENS}),y.refetchQueries({queryKey:KEYS$1.AGGREGATED})},fe=()=>{console.log(" useWallet: wallet-loaded event received, refreshing queries..."),y.invalidateQueries({queryKey:KEYS$1.IDENTITY}),y.invalidateQueries({queryKey:KEYS$1.NAMETAG}),y.invalidateQueries({queryKey:L1_KEYS.WALLET}),y.refetchQueries({queryKey:KEYS$1.TOKENS}),y.refetchQueries({queryKey:KEYS$1.AGGREGATED})};return window.addEventListener("wallet-updated",de),window.addEventListener("wallet-loaded",fe),()=>{window.removeEventListener("wallet-updated",de),window.removeEventListener("wallet-loaded",fe)}},[y]),reactExports.useEffect(()=>{},[u]);const b=useQuery({queryKey:KEYS$1.IDENTITY,queryFn:async()=>await u.getCurrentIdentity(),staleTime:5e3}),w=useQuery({queryKey:[...KEYS$1.NAMETAG,b.data?.address],queryFn:()=>{const de=b.data;if(!de?.address)return null;const fe=walletRepo$1.getWallet();return(!fe||fe.address!==de.address)&&(walletRepo$1.loadWalletForAddress(de.address)||walletRepo$1.createWallet(de.address)),v.getActiveNametag()},enabled:!!b.data?.address});reactExports.useEffect(()=>{const de=b.data,fe=w.data;de&&fe&&IpfsStorageService.getInstance(u).startAutoSync()},[b.data,w.data,u]),reactExports.useEffect(()=>{const de=b.data;if(!de?.address||!g)return;const fe=OutboxRecoveryService.getInstance();fe.setIdentityManager(u);const ye=fe.getPendingCount(de.address);return ye>0&&console.log(` useWallet: Found ${ye} pending outbox entries, starting recovery...`),fe.recoverPendingTransfers(de.address,g).then(we=>{(we.recovered>0||we.failed>0)&&(console.log(` useWallet: Initial recovery - ${we.recovered} recovered, ${we.failed} failed`),y.invalidateQueries({queryKey:KEYS$1.TOKENS}),y.invalidateQueries({queryKey:KEYS$1.AGGREGATED})),fe.startPeriodicRetry(de.address,g)}).catch(we=>{console.error(" useWallet: Initial recovery failed:",we),fe.startPeriodicRetry(de.address,g)}),()=>{fe.stopPeriodicRetry()}},[b.data?.address,g,u,y]);const E=useQuery({queryKey:KEYS$1.REGISTRY,queryFn:async()=>(await registryService$1.ensureInitialized(),!0),staleTime:1/0}),S=useQuery({queryKey:KEYS$1.PRICES,queryFn:ApiService.fetchPrices,refetchInterval:6e4,staleTime:3e4}),A=useQuery({queryKey:[...KEYS$1.TOKENS,b.data?.address],queryFn:async()=>{const de=b.data;if(!de?.address)return[];const fe=walletRepo$1.getWallet();(!fe||fe.address!==de.address)&&(walletRepo$1.loadWalletForAddress(de.address)||walletRepo$1.createWallet(de.address));const ye=walletRepo$1.getWallet();return!ye||ye.address!==de.address?(console.warn(`Wallet address mismatch after load: wallet=${ye?.address}, identity=${de.address}`),[]):walletRepo$1.getTokens()},enabled:!!b.data?.address}),$=useQuery({queryKey:[...KEYS$1.AGGREGATED,A.dataUpdatedAt],queryFn:async()=>{await registryService$1.ensureInitialized();const de=A.data||[],fe=S.data||{},ye={};return de.forEach(pe=>{if(pe.status===TokenStatus.BURNED||pe.status===TokenStatus.TRANSFERRED)return;const ve=pe.coinId||pe.id;ye[ve]||(ye[ve]=[]),ye[ve].push(pe)}),Object.keys(ye).map(pe=>{const ve=ye[pe],he=ve[0],ae=registryService$1.getCoinDefinition(pe);let Q=BigInt(0);ve.forEach(se=>{se.amount&&(Q+=BigInt(se.amount))});const j=ae?.symbol||he.symbol||"UNK",z=ae?.name||he.name||"Unknown Token",re=j.toLowerCase()==="btc"?"bitcoin":j.toLowerCase()==="eth"?"ethereum":j.toLowerCase()==="sol"?"solana":"tether",Y=ae?.decimals||0,te=fe[re],ne=ae?registryService$1.getIconUrl(ae):he.iconUrl;return new AggregatedAsset({coinId:pe,symbol:j,name:z,totalAmount:Q.toString(),decimals:Y,tokenCount:ve.length,iconUrl:ne,priceUsd:te?.priceUsd||0,priceEur:te?.priceEur||0,change24h:te?.change24h||0})}).sort((pe,ve)=>{const he=pe.priceUsd*pe.getAmountAsDecimal();return ve.priceUsd*ve.getAmountAsDecimal()-he})},enabled:!!E.data&&!!A.data&&!!S.data}),R=useMutation({mutationFn:async()=>{const de=await u.generateNewIdentity();return walletRepo$1.createWallet(de.address),de},onSuccess:async()=>{await y.removeQueries({queryKey:KEYS$1.IDENTITY}),await y.removeQueries({queryKey:KEYS$1.TOKENS}),await y.removeQueries({queryKey:KEYS$1.NAMETAG}),await y.removeQueries({queryKey:KEYS$1.AGGREGATED}),await y.invalidateQueries({queryKey:KEYS$1.IDENTITY})}}),T=useMutation({mutationFn:async de=>{const fe=await u.deriveIdentityFromMnemonic(de);return walletRepo$1.createWallet(fe.address),fe},onSuccess:()=>{y.invalidateQueries({queryKey:["wallet"]})}}),O=useMutation({mutationFn:async de=>{const fe=await v.mintNametagAndPublish(de);if(fe.status==="error")throw new Error(fe.message);return fe},onSuccess:()=>{y.invalidateQueries({queryKey:["wallet"]})}}),B=useMutation({mutationFn:async de=>{const{recipientNametag:fe,token:ye}=de;console.log(`Starting transfer of ${ye.symbol} to ${fe}`);const we=await u.getCurrentIdentity();if(!we)throw new Error("Wallet locked or missing");const pe=Buffer.from(we.privateKey,"hex"),ve=await g.queryPubkeyByNametag(fe);if(!ve)throw new Error(`Recipient ${fe} not found on Nostr`);const he=await ProxyAddress.fromNameTag(fe);if(!ye.jsonData)throw new Error("Token data missing");const ae=await Token$1.fromJSON(ye.jsonData),Q=await SigningService.createFromSecret(pe),j=window.crypto.getRandomValues(Buffer.alloc(32)),z=await TransferCommitment.create(ae,he,j,null,null,Q),re=ServiceProvider.stateTransitionClient,Y=await re.submitTransferCommitment(z);if(Y.status!=="SUCCESS")throw new Error(`Transfer failed: ${Y.status}`);const te=await waitInclusionProof(ServiceProvider.getRootTrustBase(),re,z),ne=z.toTransaction(te),se=JSON.stringify({sourceToken:ae.toJSON(),transferTx:ne.toJSON()});if(!await g.sendTokenTransfer(ve,se))throw new Error("Failed to send p2p message via Nostr");return walletRepo$1.removeToken(ye.id),!0},onSuccess:()=>{y.invalidateQueries({queryKey:KEYS$1.TOKENS}),y.invalidateQueries({queryKey:KEYS$1.AGGREGATED})}}),F=useMutation({mutationFn:async de=>{const fe=BigInt(de.amount),{recipientNametag:ye}=de;console.log(` Starting SMART SEND: ${de.amount} of ${de.coinId} to ${ye}`);const we=await u.getCurrentIdentity();if(!we)throw new Error("Wallet locked");const pe=Buffer.from(we.privateKey,"hex"),ve=await SigningService.createFromSecret(pe),he=await g.queryPubkeyByNametag(ye);if(!he)throw new Error(`Recipient @${ye} not found on Nostr`);const ae=await TokenId.fromNameTag(ye),Q=await ProxyAddress.fromTokenId(ae),j=new TokenSplitCalculator,z=walletRepo$1.getTokens(),re=await j.calculateOptimalSplit(z,fe,de.coinId);if(!re)throw new Error("Insufficient funds or no suitable tokens found");console.log(" Transfer Plan:",{direct:re.tokensToTransferDirectly.length,split:re.requiresSplit?"YES":"NO",splitAmount:re.splitAmount?.toString(),remainder:re.remainderAmount?.toString()});for(const Y of re.tokensToTransferDirectly)console.log(` Sending whole token ${Y.uiToken.id.slice(0,8)}...`),await U(Y.sdkToken,Y.uiToken.id,Q,he,ve,g,ye);if(re.requiresSplit){console.log(" Executing split...");const{OutboxRepository:Y}=await __vitePreload(async()=>{const{OutboxRepository:_e}=await Promise.resolve().then(()=>OutboxRepository$1);return{OutboxRepository:_e}},void 0),te=Y.getInstance(),se=walletRepo$1.getWallet()?.address||"";se&&te.setCurrentAddress(se);const ee=se?{walletAddress:se,recipientNametag:ye,recipientPubkey:he}:void 0,ue=await new TokenSplitExecutor().executeSplitPlan(re,Q,ve,_e=>walletRepo$1.removeToken(_e,void 0,!0),ee);if(re.splitAmount){const _e=registryService$1.getCoinDefinition(de.coinId),Re=_e&&registryService$1.getIconUrl(_e)||void 0;walletRepo$1.addSentTransaction(re.splitAmount.toString(),de.coinId,_e?.symbol||"UNK",Re,ye)}for(let _e=0;_e<ue.tokensForRecipient.length;_e++){const Re=ue.tokensForRecipient[_e],Ae=ue.recipientTransferTxs[_e],ge=ue.outboxEntryIds[_e],be=JSON.stringify(Re.toJSON()),Te=JSON.stringify(Ae.toJSON()),De=JSON.stringify({sourceToken:be,transferTx:Te});console.log(" Sending split token via Nostr..."),await g.sendTokenTransfer(he,De,void 0,void 0,de.eventId),ge&&(te.updateStatus(ge,"NOSTR_SENT"),console.log(` Outbox: Split transfer ${ge.slice(0,8)}... sent via Nostr`))}for(const _e of ue.tokensKeptBySender)q(_e,de.coinId);for(const _e of ue.outboxEntryIds)_e&&(te.updateStatus(_e,"COMPLETED"),console.log(` Outbox: Split transfer ${_e.slice(0,8)}... completed`));ue.splitGroupId&&te.removeSplitGroup(ue.splitGroupId),se&&await IpfsStorageService.getInstance(u).syncNow().catch(Re=>{console.warn(" Final IPFS sync after split failed:",Re)})}return!0},onSuccess:()=>{setTimeout(()=>{y.invalidateQueries({queryKey:KEYS$1.TOKENS}),y.invalidateQueries({queryKey:KEYS$1.AGGREGATED})},200)}}),U=async(de,fe,ye,we,pe,ve,he)=>{const{OutboxRepository:ae}=await __vitePreload(async()=>{const{OutboxRepository:Te}=await Promise.resolve().then(()=>OutboxRepository$1);return{OutboxRepository:Te}},void 0),{createOutboxEntry:Q}=await __vitePreload(async()=>{const{createOutboxEntry:Te}=await Promise.resolve().then(()=>OutboxTypes);return{createOutboxEntry:Te}},void 0),j=ae.getInstance(),z=walletRepo$1.getWallet();z?.address&&j.setCurrentAddress(z.address);const re=Buffer.alloc(32);window.crypto.getRandomValues(re);const Y=await TransferCommitment.create(de,ye,re,null,null,pe);let te="0",ne="";const se=de.coins;if(se){const De=se.coins[0];if(Array.isArray(De)&&De.length===2){ne=De[0]?.toString()||"";const Ie=De[1];Array.isArray(Ie)?te=Ie[1]?.toString()||"0":Ie&&(te=Ie.toString())}}const ee=Q("DIRECT_TRANSFER",fe,he,we,JSON.stringify(ye.toJSON?ye.toJSON():ye),te,ne,Buffer.from(re).toString("hex"),JSON.stringify(de.toJSON()),JSON.stringify(Y.toJSON()));j.addEntry(ee),console.log(` Outbox: Created entry ${ee.id.slice(0,8)}... for direct transfer`);try{const De=await IpfsStorageService.getInstance(u).syncNow();if(!De.success)throw j.removeEntry(ee.id),new Error(`Failed to sync outbox to IPFS - aborting transfer: ${De.error}`);console.log(` Outbox entry synced to IPFS: ${De.cid?.slice(0,12)}...`)}catch(Te){throw j.removeEntry(ee.id),Te}j.updateEntry(ee.id,{status:"READY_TO_SUBMIT"});const Z=ServiceProvider.stateTransitionClient,ue=await Z.submitTransferCommitment(Y);if(ue.status!=="SUCCESS"&&ue.status!=="REQUEST_ID_EXISTS")throw j.updateEntry(ee.id,{status:"FAILED",lastError:`Aggregator error: ${ue.status}`}),new Error(`Direct transfer failed: ${ue.status}`);j.updateEntry(ee.id,{status:"SUBMITTED"}),console.log(` Transfer submitted to aggregator (status: ${ue.status})`);const _e=await waitInclusionProof(ServiceProvider.getRootTrustBase(),Z,Y),Re=Y.toTransaction(_e);j.updateEntry(ee.id,{status:"PROOF_RECEIVED",inclusionProofJson:JSON.stringify(_e.toJSON()),transferTxJson:JSON.stringify(Re.toJSON())}),console.log(" Inclusion proof received");const Ae=JSON.stringify(de.toJSON()),ge=JSON.stringify(Re.toJSON()),be=JSON.stringify({sourceToken:Ae,transferTx:ge});await ve.sendTokenTransfer(we,be),j.updateEntry(ee.id,{status:"NOSTR_SENT"}),console.log(` Token sent via Nostr to ${he}`),walletRepo$1.removeToken(fe,he),j.updateEntry(ee.id,{status:"COMPLETED"}),console.log(` Direct transfer completed - outbox entry ${ee.id.slice(0,8)}... marked complete`);try{await IpfsStorageService.getInstance(u).syncNow()}catch(Te){console.warn(" Final IPFS sync after transfer failed:",Te)}},q=(de,fe)=>{let ye="0";const pe=de.coins;if(pe){const re=pe.coins;let Y=null;const te=re[0];Array.isArray(te)&&te.length===2&&(Y=te[1]),Array.isArray(Y)?ye=Y[1]?.toString()||"0":Y&&(ye=Y.toString())}const ve=registryService$1.getCoinDefinition(fe),he=ve?registryService$1.getIconUrl(ve):void 0,ae=de.toJSON();!ae.genesis||!ae.state?console.error(" Change token missing required TXF fields!",{hasGenesis:!!ae.genesis,hasState:!!ae.state,keys:Object.keys(ae)}):console.log(" Change token has valid TXF structure");const Q={...ae,version:ae.version||"2.0",transactions:ae.transactions||[],nametags:ae.nametags||[],_integrity:ae._integrity||{genesisDataJSONHash:"0000"+"0".repeat(60)}},j=ae.genesis?.data?.tokenId,z=new Token$3({id:v4$1(),name:ve?.symbol||"Change Token",symbol:ve?.symbol||"UNK",type:"Fungible",jsonData:JSON.stringify(Q),status:TokenStatus.CONFIRMED,amount:ye,coinId:fe,iconUrl:he||void 0,timestamp:Date.now()});console.log(` Saving change token: ${ye} ${ve?.symbol}, tokenId: ${j?.slice(0,8)||"unknown"}...`),walletRepo$1.addToken(z,!0)},J=async()=>{const de=await u.getCurrentIdentity();return de?.mnemonic?de.mnemonic.split(" "):null},ie=async()=>u.getL1Address(),oe=()=>u.getUnifiedKeyManager(),le=async de=>await v.isNametagAvailable(de);return{identity:b.data,isLoadingIdentity:b.isLoading,l1Address:b.data?.l1Address||null,nametag:w.data,isLoadingNametag:w.isLoading,assets:$.data||[],isLoadingAssets:$.isLoading,tokens:A.data||[],createWallet:R.mutateAsync,restoreWallet:T.mutateAsync,mintNametag:O.mutateAsync,sentToken:B.mutateAsync,sendAmount:F.mutateAsync,isSending:F.isPending||B.isPending,getSeedPhrase:J,getL1Address:ie,getUnifiedKeyManager:oe,checkNametagAvailability:le}},SESSION_KEY$4="user-pin-1234",identityManager$2=IdentityManager.getInstance(SESSION_KEY$4);function useOnboardingFlow(){const{identity:y,nametag:u,createWallet:g,mintNametag:v,getUnifiedKeyManager:b,checkNametagAvailability:w}=useWallet(),[E,S]=reactExports.useState("start"),[A,$]=reactExports.useState(!1),[R,T]=reactExports.useState(null),[O,B]=reactExports.useState(Array(12).fill("")),[F,U]=reactExports.useState(null),[q,J]=reactExports.useState(10),[ie,oe]=reactExports.useState(!0),[le,de]=reactExports.useState(!1),[fe,ye]=reactExports.useState(""),[we,pe]=reactExports.useState(""),[ve,he]=reactExports.useState([]),[ae,Q]=reactExports.useState(null),[j,z]=reactExports.useState(!1),[re,Y]=reactExports.useState(!1),[te,ne]=reactExports.useState(null),[se,ee]=reactExports.useState(!0),[Z,ue]=reactExports.useState(!1);reactExports.useEffect(()=>{if(E!=="start"||!y||u||Z)return;(async()=>{ue(!0),console.log(" [Complete Setup] Checking IPNS for existing nametag...");try{const qe=await fetchNametagFromIpns(y.privateKey);qe.nametag&&qe.nametagData?(console.log(` [Complete Setup] Found nametag: ${qe.nametag}`),WalletRepository.saveNametagForAddress(y.address,{name:qe.nametagData.name,token:qe.nametagData.token,timestamp:qe.nametagData.timestamp||Date.now(),format:qe.nametagData.format||"TXF",version:"1.0"}),console.log(" [Complete Setup] Nametag found, proceeding to wallet..."),window.location.reload()):(console.log(" [Complete Setup] No nametag found in IPNS"),ue(!1))}catch(qe){console.warn(" [Complete Setup] IPNS fetch error:",qe),ue(!1)}})()},[E,y,u,Z]);const _e=reactExports.useCallback(async()=>{const Le=ve.length,qe=b(),Ge=`${qe.getBasePath()}/0/${Le}`,Xe=qe.deriveAddressFromPath(Ge),ze=await identityManager$2.deriveIdentityFromPath(Ge),et=WalletRepository.checkNametagForAddress(ze.address),Ze=!!et;he(nt=>[...nt,{index:Le,l1Address:Xe.l1Address,l3Address:ze.address,path:Ge,hasNametag:Ze,existingNametag:et?.name,privateKey:Ze?void 0:ze.privateKey,ipnsLoading:!Ze,balanceLoading:!0}])},[ve.length,b]);reactExports.useEffect(()=>{if(E!=="addressSelection"||ve.length===0||re)return;const Le=ve.find(Ke=>Ke.ipnsLoading&&Ke.privateKey||Ke.balanceLoading);if(!Le){console.log(" All current addresses checked");return}(async()=>{Y(!0);const Ke=Le,Ge=Ke.isChange?"change":"external";console.log(` Checking ${Ge} #${Ke.index} (path: ${Ke.path})...`);let Xe,ze,et,Ze,nt=0;if(Ke.ipnsLoading&&Ke.privateKey)try{const vt=await fetchNametagFromIpns(Ke.privateKey);console.log(` IPNS result for ${Ge} (path: ${Ke.path}): ${vt.nametag||"none"} (via ${vt.source})`),Xe=vt.nametag||void 0,ze=vt.nametagData,et=vt.ipnsName,Ze=vt.error}catch(vt){const bt=vt instanceof Error?vt.message:"Unknown error";console.warn(` IPNS fetch error for ${Ge} (path: ${Ke.path}):`,bt),Ze=bt}else Ke.existingNametag&&(Xe=Ke.existingNametag);if(Ke.balanceLoading)try{nt=await getBalance(Ke.l1Address),console.log(` L1 balance for ${Ge} #${Ke.index}: ${nt} ALPHA`)}catch(vt){console.warn(` Balance fetch error for ${Ge} #${Ke.index}:`,vt),nt=0}else nt=Ke.l1Balance??0;he(vt=>vt.map(bt=>bt.path===Ke.path?{...bt,ipnsName:et,hasNametag:!!Xe,existingNametag:Xe,nametagData:ze,ipnsLoading:!1,ipnsError:Ze,privateKey:void 0,l1Balance:nt,balanceLoading:!1}:bt)),Xe&&!te?(console.log(` Found FIRST nametag "${Xe}" at ${Ge} #${Ke.index}, auto-selecting`),ne(Ke.path),Q(Ke.path)):Xe&&console.log(` Found another nametag "${Xe}" at ${Ge} #${Ke.index}`),Y(!1);const ut=WalletRepository.checkTokensForAddress(Ke.l3Address),ot=!!Xe||nt>0||ut;se&&ot&&ve.length<20?(console.log(` Address has activity (nametag: ${!!Xe}, L1: ${nt}, L3: ${ut}), deriving next (#${ve.length})...`),await _e()):ot||console.log(` Gap detected at ${Ge} #${Ke.index} (no nametag, no L1 balance, no L3 tokens). Stopping auto-derive.`)})()},[E,ve,re,te,se,_e]);const Re=reactExports.useCallback(async Le=>{const qe=b(),Ke=qe.getBasePath(),Ge=[];for(let Xe=0;Xe<Le;Xe++){const ze=`${Ke}/0/${Xe}`,et=qe.deriveAddressFromPath(ze),Ze=await identityManager$2.deriveIdentityFromPath(ze),nt=WalletRepository.checkNametagForAddress(Ze.address),ut=!!nt;Ge.push({index:Xe,l1Address:et.l1Address,l3Address:Ze.address,path:ze,hasNametag:ut,existingNametag:nt?.name,privateKey:ut?void 0:Ze.privateKey,ipnsLoading:!ut,balanceLoading:!0})}return Ge},[b]),Ae=reactExports.useCallback(()=>{S("start"),B(Array(12).fill("")),U(null),J(10),oe(!0),de(!1),T(null)},[]),ge=async(Le,qe,Ke=3e4)=>{const Ge=Date.now(),Xe=3e3;for(;Date.now()-Ge<Ke;){try{console.log(` IPNS verification attempt for "${qe}"...`);const et=await fetchNametagFromIpns(Le);if(et.nametag===qe)return!0;console.log(` IPNS returned "${et.nametag||"null"}", expected "${qe}"`)}catch(et){console.log(" IPNS verification attempt failed, retrying...",et)}Ke-(Date.now()-Ge)>Xe&&await new Promise(et=>setTimeout(et,Xe))}return!1},be=reactExports.useCallback(async()=>{if(!A){$(!0),T(null);try{UnifiedKeyManager.clearAll(),await g();const Le=b(),Ke=`${Le.getBasePath()}/0/0`,Ge=Le.deriveAddressFromPath(Ke),Xe={masterPrivateKey:Le.getMasterKeyHex()||"",chainCode:Le.getChainCodeHex()||void 0,addresses:[{index:0,address:Ge.l1Address,privateKey:Ge.privateKey,publicKey:Ge.publicKey,path:Ke,isChange:!1,createdAt:new Date().toISOString()}],isBIP32:Le.getDerivationMode()==="bip32"};saveWalletToStorage("main",Xe),console.log(" Saved L1 wallet for new wallet"),S("nametag")}catch(Le){const qe=Le instanceof Error?Le.message:"Failed to generate keys";T(qe)}finally{$(!1)}}},[A,g,b]),Te=reactExports.useCallback(async()=>{const Le=O.map(Ke=>Ke.trim().toLowerCase()),qe=Le.findIndex(Ke=>Ke==="");if(qe!==-1){T(`Please fill in word ${qe+1}`);return}$(!0),T(null);try{UnifiedKeyManager.clearAll();const Ke=Le.join(" ");await b().createFromMnemonic(Ke),await Se()}catch(Ke){const Ge=Ke instanceof Error?Ke.message:"Invalid recovery phrase";T(Ge),$(!1)}},[O,b]),De=reactExports.useCallback(async()=>{if(fe.trim()){$(!0),T(null);try{const Le=fe.trim().replace("@","");if(!await w(Le)){T(`${Le} already exists.`),$(!1);return}S("processing"),pe("Minting Unicity ID on blockchain..."),await v(Le),console.log(" Nametag minted and saved to localStorage"),pe("Syncing to IPFS storage...");try{await IpfsStorageService.getInstance(identityManager$2).syncNow(),console.log(" IPFS sync completed")}catch(Xe){console.warn(" IPFS sync failed, continuing anyway:",Xe)}pe("Verifying IPFS availability...");const Ke=await identityManager$2.getCurrentIdentity();(Ke?await ge(Ke.privateKey,Le,3e4):!1)?console.log(` Verified nametag "${Le}" available via IPNS`):console.warn(" IPNS verification timed out after 30s, proceeding anyway"),console.log(" Step 4: All steps completed, notifying app..."),window.dispatchEvent(new Event("wallet-loaded")),window.dispatchEvent(new Event("wallet-updated")),await new Promise(Xe=>setTimeout(Xe,500)),S("start")}catch(Le){const qe=Le instanceof Error?Le.message:"Minting failed";console.error(" Nametag minting failed:",Le),T(qe),S("nametag")}finally{$(!1)}}},[fe,w,v]),Ie=reactExports.useCallback(async()=>{$(!0);try{const Le=ve.length,qe=b(),Ge=`${qe.getBasePath()}/0/${Le}`,Xe=qe.deriveAddressFromPath(Ge),ze=await identityManager$2.deriveIdentityFromPath(Ge),et=WalletRepository.checkNametagForAddress(ze.address),Ze=!!et;he([...ve,{index:Le,l1Address:Xe.l1Address,l3Address:ze.address,path:Ge,hasNametag:Ze,existingNametag:et?.name,privateKey:Ze?void 0:ze.privateKey,ipnsLoading:!Ze,balanceLoading:!0}])}catch(Le){const qe=Le instanceof Error?Le.message:"Failed to derive new address";T(qe)}finally{$(!1)}},[ve,b]),Se=reactExports.useCallback(async(Le=!1)=>{$(!0),T(null);try{const qe=loadWalletFromStorage("main");if(qe&&qe.addresses&&qe.addresses.length>0){const Ke=qe.addresses,Ge=Ke.filter(et=>et.isChange).length;console.log(` Loading ${Ke.length} addresses from L1 wallet storage (${Ke.length-Ge} external, ${Ge} change)`);const Xe=[],ze=b();console.log(" [goToAddressSelection] UnifiedKeyManager state:",{basePath:ze.getBasePath(),isInitialized:ze.isInitialized(),masterKeyPrefix:ze.getMasterKeyHex()?.slice(0,16)||"unknown"});for(const et of Ke){if(!et.path){console.warn(` Address ${et.address.slice(0,20)}... has no path, skipping`);continue}const Ze=await identityManager$2.deriveIdentityFromPath(et.path),nt=WalletRepository.checkNametagForAddress(Ze.address),ut=et.isChange??!1,ot=ut?"change":"external";console.log(` Address (path: ${et.path}, ${ot}): L1=${et.address.slice(0,20)}... L3=${Ze.address.slice(0,20)}... hasNametag=${!!nt}`);const vt=!nt;Xe.push({index:et.index,l1Address:et.address,l3Address:Ze.address,path:et.path,hasNametag:!!nt,existingNametag:nt?.name,isChange:ut,fromL1Wallet:!0,privateKey:vt?Ze.privateKey:void 0,ipnsLoading:vt,balanceLoading:!0})}Xe.sort((et,Ze)=>{const nt=et.isChange?1:0,ut=Ze.isChange?1:0;return nt!==ut?nt-ut:et.index-Ze.index}),he(Xe),Q(Xe[0]?.path||null)}else{console.log(" No L1 wallet addresses found, deriving from UnifiedKeyManager");const Ke=await Re(1);he(Ke),Q(Ke[0]?.path||null)}Y(!1),ne(null),ee(!Le),S("addressSelection")}catch(qe){const Ke=qe instanceof Error?qe.message:"Failed to derive addresses";T(Ke)}finally{$(!1)}},[b,Re]),Be=reactExports.useCallback(async()=>{$(!0),T(null);try{const Le=ve.filter(ze=>!ze.ipnsLoading||ze.fromL1Wallet),qe=Le.find(ze=>ze.path===ae)||Le[0];if(!qe)throw new Error("No address selected");identityManager$2.setSelectedAddressPath(qe.path);const Ke=b();console.log(" All derived addresses:",ve.map(ze=>({index:ze.index,path:ze.path,hasNametag:ze.hasNametag,nametag:ze.existingNametag,hasNametagData:!!ze.nametagData})));const Ge=ve.filter(ze=>ze.hasNametag||ze.path===qe.path).map(ze=>{const et=Ke.deriveAddressFromPath(ze.path);return{index:ze.index,address:et.l1Address,privateKey:et.privateKey,publicKey:et.publicKey,path:ze.path,isChange:ze.isChange,createdAt:new Date().toISOString()}});console.log(` Addresses to save: ${Ge.length}`);const Xe={masterPrivateKey:Ke.getMasterKeyHex()||"",chainCode:Ke.getChainCodeHex()||void 0,addresses:Ge,isBIP32:Ke.getDerivationMode()==="bip32"};saveWalletToStorage("main",Xe),console.log(` Saved L1 wallet with ${Ge.length} addresses`),await IpfsStorageService.resetInstance();for(const ze of ve)ze.hasNametag&&ze.nametagData&&ze.l3Address&&(console.log(` Saving nametag for ${ze.l3Address.slice(0,20)}...`),WalletRepository.saveNametagForAddress(ze.l3Address,{name:ze.nametagData.name,token:ze.nametagData.token,timestamp:ze.nametagData.timestamp||Date.now(),format:ze.nametagData.format||"TXF",version:"1.0"}));qe.hasNametag?(console.log(" Address has existing nametag, proceeding to main app"),window.location.reload()):S("nametag")}catch(Le){const qe=Le instanceof Error?Le.message:"Failed to select address";T(qe)}finally{$(!1)}},[ve,ae,b]);return{step:E,setStep:S,goToStart:Ae,isBusy:A,error:R,setError:T,setIsBusy:$,seedWords:O,setSeedWords:B,selectedFile:F,scanCount:q,needsScanning:ie,isDragging:le,setSelectedFile:U,setScanCount:J,setNeedsScanning:oe,setIsDragging:de,nametagInput:fe,setNametagInput:ye,processingStatus:we,derivedAddresses:ve,selectedAddressPath:ae,showAddressDropdown:j,isCheckingIpns:re,ipnsFetchingNametag:Z,setSelectedAddressPath:Q,setShowAddressDropdown:z,handleCreateKeys:be,handleRestoreWallet:Te,handleMintNametag:De,handleDeriveNewAddress:Ie,handleContinueWithAddress:Be,goToAddressSelection:Se,identity:y,nametag:u,getUnifiedKeyManager:b}}function isEncryptedWallet(y){try{if(JSON.parse(y).encrypted)return!0}catch{}return y.includes("ENCRYPTED MASTER KEY")}function isBIP32Wallet(y){try{const u=JSON.parse(y);if(u.derivationMode==="bip32"||u.chainCode)return!0}catch{}return y.includes("MASTER CHAIN CODE")||y.includes("WALLET TYPE: BIP32")||y.includes("WALLET TYPE: Alpha descriptor")}function hasMnemonicInJSON(y){try{const u=JSON.parse(y);return!!(u.mnemonic||u.seed||u.recoveryPhrase||Array.isArray(u.words)&&u.words.length>=12||u.encrypted?.mnemonic)}catch{return!1}}function extractMnemonic(y){return typeof y.mnemonic=="string"?y.mnemonic:typeof y.seed=="string"?y.seed:typeof y.recoveryPhrase=="string"?y.recoveryPhrase:Array.isArray(y.words)?y.words.join(" "):null}function needsBlockchainScanning(y,u){if(y.endsWith(".dat"))return!0;if(y.endsWith(".json")||isJSONWalletFormat(u)){const g=hasMnemonicInJSON(u),v=isBIP32Wallet(u);return!g&&v}return isBIP32Wallet(u)}function isValidMnemonicFormat(y){const u=y.trim().split(/\s+/);return u.length!==12&&u.length!==24?!1:u.every(g=>/^[a-z]+$/.test(g.toLowerCase()))}function truncateAddress(y,u=12,g=8){return y?y.length<=u+g+3?y:`${y.slice(0,u)}...${y.slice(-g)}`:""}const SESSION_KEY$3="user-pin-1234",identityManager$1=IdentityManager.getInstance(SESSION_KEY$3);function useWalletImport({getUnifiedKeyManager:y,goToAddressSelection:u,setError:g,setIsBusy:v}){const[b,w]=reactExports.useState(null),[E,S]=reactExports.useState(10),[A,$]=reactExports.useState(!0),[R,T]=reactExports.useState(!1),[O,B]=reactExports.useState(!1),[F,U]=reactExports.useState(!1),[q,J]=reactExports.useState(null),[ie,oe]=reactExports.useState(null),[le,de]=reactExports.useState(10),fe=reactExports.useCallback(async Y=>{try{if(Y.name.endsWith(".dat")){$(!0),S(10);return}const te=await Y.text();$(needsBlockchainScanning(Y.name,te)),S(10)}catch(te){console.error("Error checking file type:",te),$(!0)}},[]),ye=reactExports.useCallback(async Y=>{w(Y),await fe(Y)},[fe]),we=reactExports.useCallback(Y=>{Y.preventDefault(),T(!0)},[]),pe=reactExports.useCallback(Y=>{Y.preventDefault(),T(!1)},[]),ve=reactExports.useCallback(async Y=>{Y.preventDefault(),T(!1);const te=Y.dataTransfer.files[0];te&&(te.name.endsWith(".txt")||te.name.endsWith(".dat")||te.name.endsWith(".json"))&&await ye(te)},[ye]),he=reactExports.useCallback(()=>{b&&ae(b,E)},[b,E]),ae=reactExports.useCallback(async(Y,te)=>{v(!0),g(null);try{const ne=y();if(ne?.isInitialized()&&(console.log(" Clearing existing wallet before importing from file"),ne.clear(),UnifiedKeyManager.resetInstance()),localStorage.removeItem(STORAGE_KEYS.WALLET_MAIN),Y.name.endsWith(".dat")){const Z=await importWallet(Y);if(!Z.success&&Z.isEncryptedDat){console.log(" .dat file is encrypted, showing password modal"),oe(Y),de(te||100),U(!0),v(!1);return}if(!Z.success||!Z.wallet)throw new Error(Z.error||"Import failed");console.log(" .dat file imported, showing scan modal"),J(Z.wallet),de(te||100),B(!0),v(!1);return}const se=await Y.text();if(Y.name.endsWith(".json")||isJSONWalletFormat(se))try{if(JSON.parse(se).encrypted){oe(Y),de(te||10),U(!0),v(!1);return}const ue=await importWalletFromJSON(se);if(!ue.success||!ue.wallet)throw new Error(ue.error||"Import failed");if(ue.mnemonic){await y().createFromMnemonic(ue.mnemonic),localStorage.removeItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH),localStorage.removeItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_INDEX_LEGACY),await u();return}if(ue.derivationMode==="bip32"||ue.wallet.chainCode){const Ae=y(),ge=ue.wallet.chainCode||ue.wallet.masterChainCode||null,be=ue.wallet.descriptorPath?`m/${ue.wallet.descriptorPath}`:void 0;await Ae.importWithMode(ue.wallet.masterPrivateKey,ge,ue.derivationMode||"bip32",be),J(ue.wallet),de(te||10),B(!0),v(!1);return}await y().importWithMode(ue.wallet.masterPrivateKey,null,"wif_hmac"),saveWalletToStorage("main",ue.wallet),await u();return}catch(Z){if(Y.name.endsWith(".json"))throw new Error(`Invalid JSON wallet file: ${Z instanceof Error?Z.message:String(Z)}`)}if(isEncryptedWallet(se)){oe(Y),de(te||10),U(!0),v(!1);return}if(isBIP32Wallet(se)&&se.includes("MASTER PRIVATE KEY")){const Z=await importWallet(Y);if(!Z.success||!Z.wallet)throw new Error(Z.error||"Import failed");J(Z.wallet),de(te||10),B(!0),v(!1);return}let ee=!1;try{const Z=JSON.parse(se),ue=extractMnemonic(Z);ue&&(await y().createFromMnemonic(ue),ee=!0)}catch{}if(!ee){const Z=se.trim();isValidMnemonicFormat(Z)&&(await y().createFromMnemonic(Z),ee=!0)}if(!ee&&se.includes("MASTER PRIVATE KEY")){const Z=await importWallet(Y);if(!Z.success||!Z.wallet)throw new Error(Z.error||"Import failed");await y().importFromFileContent(se),Z.wallet.addresses.length>0&&saveWalletToStorage("main",Z.wallet),ee=!0}if(!ee)throw new Error("Could not import wallet from file");await u()}catch(ne){const se=ne instanceof Error?ne.message:"Failed to import wallet from file";g(se),v(!1)}},[y,u,g,v]),Q=reactExports.useCallback(async Y=>{if(q)try{v(!0),g(null);const te={...q,addresses:[{index:Y.index,address:Y.address,privateKey:Y.privateKey,publicKey:Y.publicKey,path:Y.path,createdAt:new Date().toISOString()}]};if(saveWalletToStorage("main",te),Y.l3Nametag&&Y.path)try{const ee=await identityManager$1.deriveIdentityFromPath(Y.path);WalletRepository.saveNametagForAddress(ee.address,{name:Y.l3Nametag,token:{},timestamp:Date.now(),format:"TXF",version:"1.0"})}catch(ee){console.warn(`Failed to save nametag for address ${Y.path}:`,ee)}const ne=y(),se=q.descriptorPath?`m/${q.descriptorPath}`:void 0;q.masterPrivateKey&&q.masterChainCode?await ne.importWithMode(q.masterPrivateKey,q.masterChainCode,"bip32",se):q.masterPrivateKey&&await ne.importWithMode(q.masterPrivateKey,null,"wif_hmac"),B(!1),J(null),await u(!0)}catch(te){const ne=te instanceof Error?te.message:"Failed to import wallet";g(ne),v(!1)}},[q,y,u,g,v]),j=reactExports.useCallback(async Y=>{if(!(!q||Y.length===0))try{v(!0),g(null);const te={...q,addresses:Y.map(ee=>({index:ee.index,address:ee.address,privateKey:ee.privateKey,publicKey:ee.publicKey,path:ee.path,createdAt:new Date().toISOString(),isChange:ee.isChange}))};saveWalletToStorage("main",te);for(const ee of Y)if(ee.l3Nametag&&ee.path)try{const Z=await identityManager$1.deriveIdentityFromPath(ee.path);WalletRepository.saveNametagForAddress(Z.address,{name:ee.l3Nametag,token:{},timestamp:Date.now(),format:"TXF",version:"1.0"})}catch(Z){console.warn(`Failed to save nametag for address ${ee.path}:`,Z)}const ne=y(),se=q.descriptorPath?`m/${q.descriptorPath}`:void 0;q.masterPrivateKey&&q.masterChainCode?await ne.importWithMode(q.masterPrivateKey,q.masterChainCode,"bip32",se):q.masterPrivateKey&&await ne.importWithMode(q.masterPrivateKey,null,"wif_hmac"),B(!1),J(null),await u(!0)}catch(te){const ne=te instanceof Error?te.message:"Failed to import wallet";g(ne),v(!1)}},[q,y,u,g,v]),z=reactExports.useCallback(()=>{B(!1),J(null)},[]),re=reactExports.useCallback(async Y=>{if(ie)try{v(!0),g(null),U(!1);const te=await ie.text();if(ie.name.endsWith(".json")||isJSONWalletFormat(te)){const se=await importWalletFromJSON(te,Y);if(!se.success||!se.wallet)throw new Error(se.error||"Import failed");if(oe(null),se.mnemonic){await y().createFromMnemonic(se.mnemonic),localStorage.removeItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH),localStorage.removeItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_INDEX_LEGACY),await u();return}if(se.derivationMode==="bip32"||se.wallet.chainCode){const ue=y(),_e=se.wallet.chainCode||se.wallet.masterChainCode||null,Re=se.wallet.descriptorPath?`m/${se.wallet.descriptorPath}`:void 0;await ue.importWithMode(se.wallet.masterPrivateKey,_e,se.derivationMode||"bip32",Re),J(se.wallet),B(!0),v(!1);return}await y().importWithMode(se.wallet.masterPrivateKey,null,"wif_hmac"),saveWalletToStorage("main",se.wallet),await u();return}const ne=await importWallet(ie,Y);if(!ne.success||!ne.wallet)throw new Error(ne.error||"Import failed");if(oe(null),ne.wallet.masterChainCode||ne.wallet.isImportedAlphaWallet)J(ne.wallet),B(!0),v(!1);else{const se=y(),ee=ne.wallet.descriptorPath?`m/${ne.wallet.descriptorPath}`:void 0;ne.wallet.masterPrivateKey&&ne.wallet.masterChainCode?await se.importWithMode(ne.wallet.masterPrivateKey,ne.wallet.masterChainCode,"bip32",ee):ne.wallet.masterPrivateKey&&await se.importWithMode(ne.wallet.masterPrivateKey,null,"wif_hmac"),ne.wallet.addresses.length>0&&saveWalletToStorage("main",ne.wallet),await u()}}catch(te){const ne=te instanceof Error?te.message:"Failed to decrypt wallet";g(ne),v(!1)}},[ie,y,u,g,v]);return{showScanModal:O,showLoadPasswordModal:F,pendingWallet:q,pendingFile:ie,initialScanCount:le,selectedFile:b,scanCount:E,needsScanning:A,isDragging:R,setSelectedFile:w,setScanCount:S,setShowScanModal:B,setShowLoadPasswordModal:U,handleFileSelect:ye,handleDragOver:we,handleDragLeave:pe,handleDrop:ve,handleConfirmImport:he,handleImportFromFile:ae,onSelectScannedAddress:Q,onSelectAllScannedAddresses:j,onCancelScan:z,onConfirmLoadWithPassword:re}}function useOnboardingConnectionStatus(){const[y,u]=reactExports.useState(()=>({state:isWebSocketConnected()?"connected":"disconnected",message:isWebSocketConnected()?"Connected to Fulcrum":"Not connected"})),g=reactExports.useRef(!0),v=reactExports.useRef(!1),b=reactExports.useCallback(async()=>{if(!(!g.current||v.current)){v.current=!0,u({state:"connecting",message:"Connecting to Fulcrum server..."});try{if(await connect(),!g.current)return;u({state:"connected",message:"Connected to Fulcrum"})}catch(S){if(!g.current)return;const A=S instanceof Error?S.message:"Connection failed";u({state:"error",message:"Connection failed after multiple attempts",error:A})}finally{v.current=!1}}},[]),w=reactExports.useCallback(()=>{b()},[b]),E=reactExports.useCallback(()=>{v.current=!1,disconnect(),u({state:"disconnected",message:"Connection cancelled"})},[]);return reactExports.useEffect(()=>(g.current=!0,isWebSocketConnected()||b(),()=>{g.current=!1}),[b]),reactExports.useEffect(()=>{const A=setInterval(()=>{if(!g.current)return;const $=isWebSocketConnected();$&&y.state!=="connected"?u({state:"connected",message:"Connected to Fulcrum"}):!$&&y.state==="connected"&&b()},2e3);return()=>clearInterval(A)},[y.state,b]),reactExports.useEffect(()=>{const S=()=>{g.current&&(y.state==="error"||y.state==="disconnected")&&b()};return window.addEventListener("online",S),()=>window.removeEventListener("online",S)},[y.state,b]),{...y,isConnected:y.state==="connected",isConnecting:y.state==="connecting",manualConnect:w,cancelConnect:E}}function WalletScanModal({show:y,wallet:u,initialScanCount:g=100,onSelectAddress:v,onSelectAll:b,onCancel:w}){const[E,S]=reactExports.useState(!1),[A,$]=reactExports.useState({current:0,total:g,found:0,totalBalance:0,foundAddresses:[]}),[R,T]=reactExports.useState([]),[O,B]=reactExports.useState(new Set),[F,U]=reactExports.useState(g),[q,J]=reactExports.useState(!1),ie=reactExports.useRef(!1);reactExports.useEffect(()=>(y&&u&&(U(g),T([]),B(new Set),$({current:0,total:g,found:0,totalBalance:0,foundAddresses:[]}),J(!1),ie.current=!1,oe(g)),()=>{ie.current=!0}),[y,u,g]);const oe=async ve=>{if(!u)return;const he=ve??F;S(!0),T([]),B(new Set),$({current:0,total:he,found:0,totalBalance:0,foundAddresses:[]}),ie.current=!1;try{const ae=await scanWalletAddresses(u,he,Q=>{$(Q),Q.l1ScanComplete&&J(!0),Q.foundAddresses&&Q.foundAddresses.length>0&&(T(Q.foundAddresses),B(new Set(Q.foundAddresses.map(j=>j.address))))},()=>ie.current);T(ae.addresses),B(new Set(ae.addresses.map(Q=>Q.address)))}catch(ae){console.error("Scan error:",ae)}finally{S(!1)}},le=()=>{ie.current=!0,S(!1)},de=()=>{ie.current=!0,w()},fe=ve=>{B(he=>{const ae=new Set(he);return ae.has(ve)?ae.delete(ve):ae.add(ve),ae})},ye=()=>{const ve=R.filter(he=>O.has(he.address));ve.length!==0&&(ve.length>1&&b?b(ve):v(ve[0]))},we=R.filter(ve=>O.has(ve.address)).reduce((ve,he)=>ve+he.balance,0);if(!y)return null;const pe=A.total>0?A.current/A.total*100:0;return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center z-40 p-4",onClick:de,children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",duration:.4},className:"relative w-full max-w-md bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-2xl shadow-2xl p-4 overflow-hidden max-h-[85vh] flex flex-col",onClick:ve=>ve.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-9 h-9 bg-blue-500/10 rounded-full flex items-center justify-center shrink-0",children:jsxRuntimeExports.jsx(Search,{className:"w-4 h-4 text-blue-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white text-base font-bold",children:"Scanning Wallet"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-xs",children:E&&!q?"Searching for addresses with balances...":E?"Resolving Unicity IDs...":"Click addresses to select/deselect"})]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-3",children:[jsxRuntimeExports.jsx("div",{className:"h-2 bg-neutral-200 dark:bg-neutral-800 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx(motion.div,{className:"h-full bg-blue-500",initial:{width:0},animate:{width:`${pe}%`},transition:{duration:.3}})}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between mt-1 text-[11px] text-neutral-500 dark:text-neutral-400",children:[jsxRuntimeExports.jsx("span",{children:E?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}),"Found ",A.found]}):`Found ${R.length}  Selected ${O.size}`}),jsxRuntimeExports.jsxs("span",{children:[A.current,"/",A.total]})]}),O.size>0&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-center text-green-600 dark:text-green-400 font-medium",children:["Selected: ",we.toFixed(8)," ALPHA"]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto min-h-[100px] max-h-[200px] border border-neutral-200 dark:border-neutral-700 rounded-lg mb-3",children:R.length===0?jsxRuntimeExports.jsx("div",{className:"h-full flex items-center justify-center text-neutral-400 dark:text-neutral-500 text-xs p-4",children:E?"Searching...":"No addresses found"}):jsxRuntimeExports.jsx("div",{className:"divide-y divide-neutral-200 dark:divide-neutral-700",children:R.map(ve=>{const he=O.has(ve.address);return jsxRuntimeExports.jsx("div",{onClick:()=>fe(ve.address),className:`p-2 cursor-pointer transition-colors ${he?"bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30":"hover:bg-neutral-100 dark:hover:bg-neutral-800/50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[he?jsxRuntimeExports.jsx(SquareCheckBig,{className:"w-4 h-4 text-blue-500 shrink-0"}):jsxRuntimeExports.jsx(Square,{className:"w-4 h-4 text-neutral-400 shrink-0"}),jsxRuntimeExports.jsxs("div",{className:"min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx(Wallet$1,{className:"w-3 h-3 text-blue-500 shrink-0"}),jsxRuntimeExports.jsxs("span",{className:"text-neutral-900 dark:text-white font-medium text-xs",children:[ve.isChange?"Change":"Address"," #",ve.index]}),ve.isChange&&jsxRuntimeExports.jsx("span",{className:"px-1 py-0.5 bg-amber-500/20 text-amber-600 dark:text-amber-400 text-[9px] font-bold rounded",children:"CHANGE"}),ve.l3Nametag&&jsxRuntimeExports.jsx("span",{className:"px-1 py-0.5 bg-purple-500/20 text-purple-600 dark:text-purple-400 text-[9px] font-bold rounded",children:ve.l3Nametag})]}),jsxRuntimeExports.jsx("div",{className:"text-[10px] text-neutral-400 dark:text-neutral-500 font-mono truncate",children:ve.address})]})]}),jsxRuntimeExports.jsxs("div",{className:"text-right shrink-0",children:[jsxRuntimeExports.jsx("div",{className:"text-green-600 dark:text-green-400 font-bold text-sm",children:ve.balance.toFixed(8)}),jsxRuntimeExports.jsx("div",{className:"text-[10px] text-neutral-500",children:"ALPHA"})]})]})},ve.address)})})}),jsxRuntimeExports.jsx("div",{className:"mb-3 p-2 bg-neutral-50 dark:bg-neutral-800/30 rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("label",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:"Scan:"}),jsxRuntimeExports.jsx("input",{type:"number",value:F,onChange:ve=>U(Math.max(1,parseInt(ve.target.value)||10)),disabled:E,className:"w-20 px-2 py-1 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded text-xs text-neutral-900 dark:text-white disabled:opacity-50",min:1}),!E&&jsxRuntimeExports.jsx("button",{onClick:()=>oe(),className:"px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-500 transition-colors",children:"Rescan"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:de,className:"flex-1 py-1.5 bg-neutral-200 dark:bg-neutral-700 rounded-lg text-neutral-700 dark:text-white text-sm hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-colors",children:"Cancel"}),E&&!q?jsxRuntimeExports.jsx("button",{onClick:le,className:"flex-1 py-1.5 bg-red-600 rounded-lg text-white text-sm hover:bg-red-500 transition-colors",children:"Stop Scan"}):O.size>0&&jsxRuntimeExports.jsxs("button",{onClick:ye,className:"flex-1 py-1.5 bg-blue-600 rounded-lg text-white text-sm hover:bg-blue-500 transition-colors flex items-center justify-center gap-1",children:[jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"}),"Load Selected (",O.size,")"]})]})]})})}function LoadPasswordModal({show:y,onConfirm:u,onCancel:g}){const[v,b]=reactExports.useState(""),[w,E]=reactExports.useState("");if(!y)return null;const S=()=>{if(E(""),!v){E("Please enter password");return}u(v),b(""),E("")},A=()=>{b(""),E(""),g()};return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center z-40 p-6",onClick:A,children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",duration:.4},className:"relative w-full max-w-md bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl p-6 overflow-hidden",onClick:$=>$.stopPropagation(),children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1},className:"flex flex-col items-center text-center mb-6",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"w-12 h-12 bg-blue-500/10 rounded-full flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(Lock,{className:"w-6 h-6 text-blue-500"})}),jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white text-xl font-bold mb-2",children:"Enter Password"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm",children:"This wallet is encrypted. Please enter your password to unlock it."})]}),jsxRuntimeExports.jsx("input",{placeholder:"Password",type:"password",value:v,onChange:$=>b($.target.value),onKeyDown:$=>{$.key==="Enter"&&S()},className:"w-full mb-4 px-3 py-2 bg-neutral-100 dark:bg-neutral-800 rounded text-neutral-800 dark:text-neutral-200 placeholder-neutral-400 border border-neutral-200 dark:border-neutral-700 focus:border-blue-500 outline-none transition-colors"}),w&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-4 p-3 bg-red-500/10 border border-red-900/50 rounded-lg flex items-center gap-2",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-4 h-4 text-red-500 shrink-0"}),jsxRuntimeExports.jsx("span",{className:"text-red-400 text-sm",children:w})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:A,className:"flex-1 py-2 bg-neutral-200 dark:bg-neutral-700 rounded text-neutral-700 dark:text-white hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:S,className:"flex-1 py-2 bg-blue-600 rounded text-white hover:bg-blue-500 transition-colors",children:"Unlock"})]})]})})}function ConnectionStatus({state:y,message:u,error:g,onRetry:v,onCancel:b}){if(y==="connected")return null;const w=y==="connecting",E=y==="error";return jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] p-6",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"flex flex-col items-center text-center max-w-sm",children:[w?jsxRuntimeExports.jsxs("div",{className:"relative w-20 h-20 mb-6",children:[jsxRuntimeExports.jsx(motion.div,{className:"absolute inset-0 border-3 border-neutral-200 dark:border-neutral-800/50 rounded-full",animate:{rotate:360},transition:{duration:3,repeat:1/0,ease:"linear"}}),jsxRuntimeExports.jsx(motion.div,{className:"absolute inset-1.5 border-3 rounded-full border-blue-500/30 border-t-blue-500 border-r-blue-500",animate:{rotate:-360},transition:{duration:2,repeat:1/0,ease:"linear"}}),jsxRuntimeExports.jsx("div",{className:"absolute inset-3 rounded-full blur-xl bg-blue-500/20"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx(motion.div,{animate:{scale:[1,1.1,1],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-7 h-7 animate-spin text-blue-500 dark:text-blue-400"})})})]}):E?jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring"},className:"w-20 h-20 rounded-full bg-red-500/10 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx(CircleX,{className:"w-10 h-10 text-red-500"})}):jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring"},className:"w-20 h-20 rounded-full bg-neutral-500/10 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx(WifiOff,{className:"w-10 h-10 text-neutral-400"})}),jsxRuntimeExports.jsxs("h3",{className:`text-xl font-bold mb-2 ${E?"text-red-600 dark:text-red-400":w?"text-blue-600 dark:text-blue-400":"text-neutral-600 dark:text-neutral-400"}`,children:[y==="connecting"&&"Connecting to Blockchain",y==="error"&&"Connection Failed",y==="disconnected"&&"Disconnected"]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400 mb-4",children:u}),w&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center gap-3 px-4 py-3 rounded-xl backdrop-blur-sm border mb-4 text-neutral-700 dark:text-neutral-300 bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-700/30",children:[jsxRuntimeExports.jsx(motion.span,{className:"w-2 h-2 rounded-full bg-blue-500",animate:{scale:[1,1.5,1],opacity:[1,.5,1]},transition:{duration:1.5,repeat:1/0}}),jsxRuntimeExports.jsx("span",{className:"text-sm",children:"Establishing connection..."})]}),g&&E&&jsxRuntimeExports.jsx("div",{className:"w-full p-3 mb-4 bg-red-500/10 border border-red-500/20 rounded-xl",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 font-mono break-all",children:g})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[(E||y==="disconnected")&&jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:v,className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-xl flex items-center gap-2 transition-colors",children:[jsxRuntimeExports.jsx(RefreshCw,{className:"w-4 h-4"}),"Retry Connection"]}),w&&jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:b,className:"px-6 py-2.5 bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600 text-neutral-700 dark:text-neutral-200 font-medium rounded-xl flex items-center gap-2 transition-colors",children:[jsxRuntimeExports.jsx(CircleX,{className:"w-4 h-4"}),"Cancel"]})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-neutral-400 dark:text-neutral-500 mt-6",children:"Fulcrum Server: fulcrum.unicity.network:50004"})]})})}function StartScreen({identity:y,nametag:u,isBusy:g,ipnsFetchingNametag:v,error:b,onCreateWallet:w,onContinueSetup:E,onRestore:S}){const A=y&&!u;return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.1},className:"relative z-10 w-full max-w-[280px] md:max-w-[340px]",children:[jsxRuntimeExports.jsxs(motion.div,{className:"relative w-16 h-16 md:w-20 md:h-20 mx-auto mb-6",whileHover:{scale:1.05},children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-br from-orange-500 to-orange-600 rounded-2xl md:rounded-3xl blur-xl opacity-50"}),jsxRuntimeExports.jsx("div",{className:"relative w-full h-full rounded-2xl md:rounded-3xl bg-linear-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-2xl shadow-orange-500/30",children:jsxRuntimeExports.jsx(Wallet$1,{className:"w-8 h-8 md:w-10 md:h-10 text-white"})})]}),jsxRuntimeExports.jsx("h2",{className:"text-2xl md:text-3xl font-black text-neutral-900 dark:text-white mb-2 md:mb-3 tracking-tight",children:A?"Complete Setup":"No Wallet Found"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-xs md:text-sm mb-6 md:mb-8 mx-auto leading-relaxed",children:A?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Your wallet is ready. Create a"," ",jsxRuntimeExports.jsx("span",{className:"text-orange-500 dark:text-orange-400 font-semibold",children:"Unicity ID"})," ","to complete setup."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Create a new secure wallet to start using the"," ",jsxRuntimeExports.jsx("span",{className:"text-orange-500 dark:text-orange-400 font-semibold",children:"Unicity Network"})]})}),A&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(motion.button,{onClick:E,disabled:g,whileHover:{scale:1.02},whileTap:{scale:.98},transition:{duration:.1},className:"relative w-full py-3 md:py-3.5 px-5 md:px-6 rounded-xl bg-linear-to-r from-emerald-500 to-emerald-600 text-white text-sm md:text-base font-bold shadow-xl shadow-emerald-500/30 flex items-center justify-center gap-2 md:gap-3 disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group mb-3",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-r from-emerald-400 to-emerald-500 opacity-0 group-hover:opacity-100 transition-opacity"}),jsxRuntimeExports.jsxs("span",{className:"relative z-10 flex items-center gap-2 md:gap-3",children:[jsxRuntimeExports.jsx(ShieldCheck,{className:"w-4 h-4 md:w-5 md:h-5"}),"Continue Setup"]})]}),v&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-center gap-2 text-neutral-500 dark:text-neutral-400 text-xs mb-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Checking for existing Unicity ID..."})]})]}),A&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 my-4",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 h-px bg-neutral-200 dark:bg-neutral-700"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-neutral-400 dark:text-neutral-500",children:"or start fresh"}),jsxRuntimeExports.jsx("div",{className:"flex-1 h-px bg-neutral-200 dark:bg-neutral-700"})]}),jsxRuntimeExports.jsxs(motion.button,{onClick:w,disabled:g,whileHover:{scale:1.02},whileTap:{scale:.98},transition:{duration:.1},className:"relative w-full py-3 md:py-3.5 px-5 md:px-6 rounded-xl bg-linear-to-r from-orange-500 to-orange-600 text-white text-sm md:text-base font-bold shadow-xl shadow-orange-500/30 flex items-center justify-center gap-2 md:gap-3 disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-r from-orange-400 to-orange-500 opacity-0 group-hover:opacity-100 transition-opacity"}),jsxRuntimeExports.jsx("span",{className:"relative z-10 flex items-center gap-2 md:gap-3",children:g?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 md:w-5 md:h-5 animate-spin"}),"Creating..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Create New Wallet",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4 md:w-5 md:h-5"})]})})]}),jsxRuntimeExports.jsxs(motion.button,{onClick:S,disabled:g,whileHover:{scale:1.02},whileTap:{scale:.98},transition:{duration:.1},className:"relative w-full py-3 md:py-3.5 px-5 md:px-6 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 text-neutral-700 dark:text-neutral-300 text-sm md:text-base font-bold border-2 border-neutral-200 dark:border-neutral-700/50 flex items-center justify-center gap-2 md:gap-3 disabled:opacity-50 disabled:cursor-not-allowed mt-3 hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors",children:[jsxRuntimeExports.jsx(KeyRound,{className:"w-4 h-4 md:w-5 md:h-5"}),"Restore Wallet"]}),b&&jsxRuntimeExports.jsx(motion.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-3 md:mt-4 text-red-500 dark:text-red-400 text-xs md:text-sm bg-red-500/10 border border-red-500/20 p-2 md:p-3 rounded-lg",children:b})]},"start")}function RestoreScreen({seedWords:y,isBusy:u,error:g,onSeedWordsChange:v,onRestore:b,onBack:w}){const E=(R,T)=>{const O=[...y];O[R]=T,v(O)},S=R=>{const O=R.clipboardData.getData("text").trim().split(/\s+/).filter(B=>B.length>0);if(O.length>1){R.preventDefault();const B=Array(12).fill("");O.slice(0,12).forEach((F,U)=>{B[U]=F.toLowerCase()}),v(B)}},A=(R,T)=>{R.key==="Enter"&&T<11?R.currentTarget.parentElement?.nextElementSibling?.querySelector("input")?.focus():R.key==="Enter"&&T===11&&b()},$=y.every(R=>R.trim());return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},className:"relative z-10 w-full max-w-[400px] md:max-w-[480px]",children:[jsxRuntimeExports.jsxs(motion.div,{className:"relative w-16 h-16 md:w-20 md:h-20 mx-auto mb-6",whileHover:{scale:1.05},children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-blue-500/30 rounded-2xl md:rounded-3xl blur-xl"}),jsxRuntimeExports.jsx("div",{className:"relative w-full h-full rounded-2xl md:rounded-3xl bg-linear-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-2xl shadow-blue-500/30",children:jsxRuntimeExports.jsx(KeyRound,{className:"w-8 h-8 md:w-10 md:h-10 text-white"})})]}),jsxRuntimeExports.jsx("h2",{className:"text-2xl md:text-3xl font-black text-neutral-900 dark:text-white mb-2 md:mb-3 tracking-tight",children:"Restore Wallet"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-xs md:text-sm mb-6 md:mb-8 mx-auto leading-relaxed",children:"Enter your 12-word recovery phrase to restore your wallet"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-3 gap-2 md:gap-3 mb-6",children:Array.from({length:12}).map((R,T)=>jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("span",{className:"absolute left-2 md:left-3 top-1/2 -translate-y-1/2 text-[10px] md:text-xs text-neutral-400 dark:text-neutral-600 font-medium z-10",children:[T+1,"."]}),jsxRuntimeExports.jsx("input",{type:"text",value:y[T],onChange:O=>E(T,O.target.value),onPaste:S,onKeyDown:O=>A(O,T),placeholder:"word",className:"w-full bg-neutral-100 dark:bg-neutral-800/50 border border-neutral-200 dark:border-neutral-700/50 rounded-lg py-2 md:py-2.5 pl-7 md:pl-9 pr-2 md:pr-3 text-xs md:text-sm text-neutral-900 dark:text-white placeholder-neutral-400 dark:placeholder-neutral-600 focus:outline-none focus:border-blue-500 focus:bg-white dark:focus:bg-neutral-800 transition-all",autoFocus:T===0})]},`seed-input-${T}`))}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs(motion.button,{onClick:w,disabled:u,whileHover:{scale:1.02},whileTap:{scale:.98},className:"flex-1 py-3 md:py-3.5 px-5 md:px-6 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 text-neutral-700 dark:text-neutral-300 text-sm md:text-base font-bold border-2 border-neutral-200 dark:border-neutral-700/50 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4 md:w-5 md:h-5"}),"Back"]}),jsxRuntimeExports.jsxs(motion.button,{onClick:b,disabled:u||!$,whileHover:{scale:1.02},whileTap:{scale:.98},className:"flex-2 relative py-3 md:py-3.5 px-5 md:px-6 rounded-xl bg-linear-to-r from-blue-500 to-blue-600 text-white text-sm md:text-base font-bold shadow-xl shadow-blue-500/30 flex items-center justify-center gap-2 md:gap-3 disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-r from-blue-400 to-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"}),jsxRuntimeExports.jsx("span",{className:"relative z-10 flex items-center gap-2 md:gap-3",children:u?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 md:w-5 md:h-5 animate-spin"}),"Restoring..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Restore",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4 md:w-5 md:h-5"})]})})]})]}),g&&jsxRuntimeExports.jsx(motion.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-3 md:mt-4 text-red-500 dark:text-red-400 text-xs md:text-sm bg-red-500/10 border border-red-500/20 p-2 md:p-3 rounded-lg",children:g})]},"restore")}function RestoreMethodScreen({isBusy:y,error:u,onSelectMnemonic:g,onSelectFile:v,onBack:b}){return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},className:"relative z-10 w-full max-w-[320px] md:max-w-[400px]",children:[jsxRuntimeExports.jsxs(motion.div,{className:"relative w-16 h-16 md:w-20 md:h-20 mx-auto mb-6",whileHover:{scale:1.05},children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-blue-500/30 rounded-2xl md:rounded-3xl blur-xl"}),jsxRuntimeExports.jsx("div",{className:"relative w-full h-full rounded-2xl md:rounded-3xl bg-linear-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-2xl shadow-blue-500/30",children:jsxRuntimeExports.jsx(KeyRound,{className:"w-8 h-8 md:w-10 md:h-10 text-white"})})]}),jsxRuntimeExports.jsx("h2",{className:"text-2xl md:text-3xl font-black text-neutral-900 dark:text-white mb-2 md:mb-3 tracking-tight",children:"Restore Wallet"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-xs md:text-sm mb-6 md:mb-8 mx-auto leading-relaxed",children:"Choose how you want to restore your wallet"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 mb-6",children:[jsxRuntimeExports.jsx(motion.button,{onClick:g,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full p-4 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 border-2 border-neutral-200 dark:border-neutral-700/50 hover:border-blue-500/50 dark:hover:border-blue-500/50 transition-all text-left group",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-lg bg-blue-500/10 flex items-center justify-center group-hover:bg-blue-500/20 transition-colors",children:jsxRuntimeExports.jsx(KeyRound,{className:"w-6 h-6 text-blue-500"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("div",{className:"font-bold text-neutral-900 dark:text-white mb-1",children:"Recovery Phrase"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Use your 12-word mnemonic phrase"})]}),jsxRuntimeExports.jsx(ArrowRight,{className:"w-5 h-5 text-neutral-400 group-hover:text-blue-500 transition-colors"})]})}),jsxRuntimeExports.jsx(motion.button,{onClick:v,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full p-4 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 border-2 border-neutral-200 dark:border-neutral-700/50 hover:border-orange-500/50 dark:hover:border-orange-500/50 transition-all text-left group",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-lg bg-orange-500/10 flex items-center justify-center group-hover:bg-orange-500/20 transition-colors",children:jsxRuntimeExports.jsx(Upload,{className:"w-6 h-6 text-orange-500"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("div",{className:"font-bold text-neutral-900 dark:text-white mb-1",children:"Import from File"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Import wallet from .json, .dat or .txt file"})]}),jsxRuntimeExports.jsx(ArrowRight,{className:"w-5 h-5 text-neutral-400 group-hover:text-orange-500 transition-colors"})]})})]}),jsxRuntimeExports.jsxs(motion.button,{onClick:b,disabled:y,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full py-3 md:py-3.5 px-5 md:px-6 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 text-neutral-700 dark:text-neutral-300 text-sm md:text-base font-bold border-2 border-neutral-200 dark:border-neutral-700/50 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4 md:w-5 md:h-5"}),"Back"]}),u&&jsxRuntimeExports.jsx(motion.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-3 md:mt-4 text-red-500 dark:text-red-400 text-xs md:text-sm bg-red-500/10 border border-red-500/20 p-2 md:p-3 rounded-lg",children:u})]},"restoreMethod")}function ImportFileScreen({selectedFile:y,scanCount:u,needsScanning:g,isDragging:v,isBusy:b,error:w,onFileSelect:E,onClearFile:S,onScanCountChange:A,onDragOver:$,onDragLeave:R,onDrop:T,onImport:O,onBack:B}){return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},className:"relative z-10 w-full max-w-[320px] md:max-w-[400px]",children:[jsxRuntimeExports.jsxs(motion.div,{className:"relative w-16 h-16 md:w-20 md:h-20 mx-auto mb-6",whileHover:{scale:1.05},children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-orange-500/30 rounded-2xl md:rounded-3xl blur-xl"}),jsxRuntimeExports.jsx("div",{className:"relative w-full h-full rounded-2xl md:rounded-3xl bg-linear-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-2xl shadow-orange-500/30",children:jsxRuntimeExports.jsx(Upload,{className:"w-8 h-8 md:w-10 md:h-10 text-white"})})]}),jsxRuntimeExports.jsx("h2",{className:"text-2xl md:text-3xl font-black text-neutral-900 dark:text-white mb-2 md:mb-3 tracking-tight",children:"Import Wallet"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-xs md:text-sm mb-6 md:mb-8 mx-auto leading-relaxed",children:"Select a wallet file to import"}),y?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"p-4 bg-neutral-100 dark:bg-neutral-800/50 border border-neutral-200 dark:border-neutral-700 rounded-xl mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[y.name.endsWith(".json")?jsxRuntimeExports.jsx(FileBraces,{className:"w-6 h-6 text-orange-500 shrink-0"}):jsxRuntimeExports.jsx(FileText,{className:"w-6 h-6 text-orange-500 shrink-0"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("p",{className:"text-sm md:text-base text-neutral-900 dark:text-white font-medium truncate",children:y.name}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-neutral-500",children:[(y.size/1024).toFixed(1)," KB"]})]}),jsxRuntimeExports.jsx("button",{onClick:S,className:"p-1.5 hover:bg-neutral-200 dark:hover:bg-neutral-700 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4 text-neutral-400"})})]})}),g?jsxRuntimeExports.jsxs("div",{className:"p-4 bg-neutral-100 dark:bg-neutral-800/50 border border-neutral-200 dark:border-neutral-700 rounded-xl mb-4",children:[jsxRuntimeExports.jsx("p",{className:"text-xs md:text-sm text-neutral-700 dark:text-neutral-300 mb-2 font-medium",children:"How many addresses to scan?"}),jsxRuntimeExports.jsx("input",{type:"number",value:u,onChange:F=>A(Math.max(1,parseInt(F.target.value)||10)),className:"w-full px-3 py-2 bg-white dark:bg-neutral-900 border border-neutral-300 dark:border-neutral-600 rounded-lg text-sm text-neutral-900 dark:text-white focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500",min:1})]}):jsxRuntimeExports.jsx("div",{className:"p-4 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-xl mb-4",children:jsxRuntimeExports.jsx("p",{className:"text-xs md:text-sm text-emerald-700 dark:text-emerald-300 font-medium",children:"Addresses will be imported from file"})})]}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{onDragOver:$,onDragLeave:R,onDrop:T,className:`w-full border-2 border-dashed rounded-xl p-8 md:p-10 text-center transition-colors mb-6 ${v?"border-orange-500 bg-orange-500/10":"border-neutral-300 dark:border-neutral-600 hover:border-orange-400 hover:bg-neutral-50 dark:hover:bg-neutral-800/50"}`,children:[jsxRuntimeExports.jsx(Upload,{className:`w-12 h-12 md:w-14 md:h-14 mx-auto mb-4 ${v?"text-orange-500":"text-neutral-400"}`}),jsxRuntimeExports.jsx("p",{className:"text-sm md:text-base text-neutral-700 dark:text-neutral-300 font-medium mb-2",children:"Select wallet file"}),jsxRuntimeExports.jsx("p",{className:"text-xs md:text-sm text-neutral-400 dark:text-neutral-500 mb-3",children:".json, .txt or .dat"}),jsxRuntimeExports.jsxs("label",{className:"inline-block cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"file",className:"hidden",accept:".json,.txt,.dat",onChange:F=>{const U=F.target.files?.[0];U&&E(U)}}),jsxRuntimeExports.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white text-sm font-medium rounded-lg transition-colors",children:[jsxRuntimeExports.jsx(Upload,{className:"w-4 h-4"}),"Choose File"]})]}),jsxRuntimeExports.jsx("p",{className:"text-[10px] md:text-xs text-neutral-400 dark:text-neutral-600 mt-3 hidden sm:block",children:"or drag & drop here"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs(motion.button,{onClick:B,disabled:b,whileHover:{scale:1.02},whileTap:{scale:.98},className:"flex-1 py-3 md:py-3.5 px-5 md:px-6 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 text-neutral-700 dark:text-neutral-300 text-sm md:text-base font-bold border-2 border-neutral-200 dark:border-neutral-700/50 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4 md:w-5 md:h-5"}),"Back"]}),y&&jsxRuntimeExports.jsxs(motion.button,{onClick:O,disabled:b,whileHover:{scale:1.02},whileTap:{scale:.98},className:"flex-2 relative py-3 md:py-3.5 px-5 md:px-6 rounded-xl bg-linear-to-r from-orange-500 to-orange-600 text-white text-sm md:text-base font-bold shadow-xl shadow-orange-500/30 flex items-center justify-center gap-2 md:gap-3 disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-r from-orange-400 to-orange-500 opacity-0 group-hover:opacity-100 transition-opacity"}),jsxRuntimeExports.jsx("span",{className:"relative z-10 flex items-center gap-2 md:gap-3",children:b?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 md:w-5 md:h-5 animate-spin"}),"Importing..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Import",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4 md:w-5 md:h-5"})]})})]})]}),w&&jsxRuntimeExports.jsx(motion.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-3 md:mt-4 text-red-500 dark:text-red-400 text-xs md:text-sm bg-red-500/10 border border-red-500/20 p-2 md:p-3 rounded-lg",children:w})]},"importFile")}function AddressSelectionScreen({derivedAddresses:y,selectedAddressPath:u,showAddressDropdown:g,isCheckingIpns:v,isBusy:b,error:w,onSelectAddress:E,onToggleDropdown:S,onDeriveNewAddress:A,onContinue:$,onBack:R}){const T=y.filter(B=>!B.ipnsLoading&&!B.balanceLoading||B.fromL1Wallet),O=T.find(B=>B.path===u)||T[0];return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},className:"relative z-10 w-full max-w-[320px] md:max-w-[400px]",children:[jsxRuntimeExports.jsxs(motion.div,{className:"relative w-16 h-16 md:w-20 md:h-20 mx-auto mb-6",whileHover:{scale:1.05},children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-purple-500/30 rounded-2xl md:rounded-3xl blur-xl"}),jsxRuntimeExports.jsx("div",{className:"relative w-full h-full rounded-2xl md:rounded-3xl bg-linear-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-2xl shadow-purple-500/30",children:jsxRuntimeExports.jsx(Wallet$1,{className:"w-8 h-8 md:w-10 md:h-10 text-white"})})]}),jsxRuntimeExports.jsx("h2",{className:"text-2xl md:text-3xl font-black text-neutral-900 dark:text-white mb-2 md:mb-3 tracking-tight",children:"Select Address"}),jsxRuntimeExports.jsxs("p",{className:"text-neutral-500 dark:text-neutral-400 text-xs md:text-sm mb-6 md:mb-8 mx-auto leading-relaxed",children:["Choose which address to use for your"," ",jsxRuntimeExports.jsx("span",{className:"text-purple-500 dark:text-purple-400 font-semibold",children:"Unicity identity"})]}),jsxRuntimeExports.jsxs("div",{className:"relative mb-4",children:[T.length===0?jsxRuntimeExports.jsxs("div",{className:"w-full bg-neutral-100 dark:bg-neutral-800/50 border-2 border-neutral-200 dark:border-neutral-700/50 rounded-xl py-3 md:py-3.5 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin text-purple-500"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Checking addresses..."})]}):jsxRuntimeExports.jsxs("button",{onClick:S,className:"w-full bg-neutral-100 dark:bg-neutral-800/50 border-2 border-neutral-200 dark:border-neutral-700/50 rounded-xl py-3 md:py-3.5 px-4 text-left flex items-center justify-between hover:border-purple-500/50 transition-all",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs text-neutral-400 dark:text-neutral-500",children:["#",O?.index??0]}),jsxRuntimeExports.jsx("span",{className:"text-sm md:text-base font-mono text-neutral-900 dark:text-white truncate",children:truncateAddress(O?.l1Address||"")}),O?.isChange&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 bg-amber-500/20 text-amber-600 dark:text-amber-400 text-[9px] font-bold rounded shrink-0",children:"Change"}),O?.ipnsLoading?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3.5 h-3.5 animate-spin text-neutral-400"}):O?.hasNametag?jsxRuntimeExports.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 text-xs font-medium",children:[jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"}),O?.existingNametag]}):null]})}),jsxRuntimeExports.jsx(motion.div,{animate:{rotate:g?180:0},transition:{duration:.2},children:jsxRuntimeExports.jsx(ChevronDown,{className:"w-5 h-5 text-neutral-400 dark:text-neutral-500"})})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:g&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"absolute top-full left-0 right-0 mt-2 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-xl shadow-xl overflow-hidden z-50",children:[jsxRuntimeExports.jsx("div",{className:"max-h-64 overflow-y-auto",children:T.map(B=>jsxRuntimeExports.jsxs("button",{onClick:()=>{E(B.path),S()},className:`w-full px-4 py-3 flex items-center gap-3 hover:bg-neutral-100 dark:hover:bg-neutral-700/50 transition-colors ${B.path===u?"bg-purple-50 dark:bg-purple-900/20":""}`,children:[jsxRuntimeExports.jsxs("span",{className:"text-xs text-neutral-400 dark:text-neutral-500 w-6",children:["#",B.index]}),jsxRuntimeExports.jsx("span",{className:"flex-1 text-sm font-mono text-neutral-900 dark:text-white truncate text-left",children:truncateAddress(B.l1Address)}),B.isChange&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 bg-amber-500/20 text-amber-600 dark:text-amber-400 text-[9px] font-bold rounded shrink-0",children:"Change"}),B.ipnsLoading?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3.5 h-3.5 animate-spin text-neutral-400"}):B.hasNametag?jsxRuntimeExports.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 text-xs font-medium",children:[jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"}),B.existingNametag]}):null,B.path===u&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"})]},B.l1Address))}),v||y.some(B=>B.ipnsLoading||B.balanceLoading)?jsxRuntimeExports.jsxs("div",{className:"w-full px-4 py-3 flex items-center gap-3 border-t border-neutral-200 dark:border-neutral-700 text-neutral-500 dark:text-neutral-400",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}),jsxRuntimeExports.jsx("span",{className:"text-sm",children:"Checking addresses..."})]}):jsxRuntimeExports.jsxs("button",{onClick:A,disabled:b,className:"w-full px-4 py-3 flex items-center gap-3 border-t border-neutral-200 dark:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-700/50 transition-colors text-purple-600 dark:text-purple-400 disabled:opacity-50",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:"Derive New Address"}),b&&jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin ml-auto"})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6 p-3 bg-neutral-100 dark:bg-neutral-800/50 rounded-lg border border-neutral-200 dark:border-neutral-700/50",children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 mb-1",children:"L3 Unicity Address"}),jsxRuntimeExports.jsx("div",{className:"text-xs font-mono text-neutral-700 dark:text-neutral-300 break-all",children:O?.l3Address||"..."})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs(motion.button,{onClick:R,disabled:b,whileHover:{scale:1.02},whileTap:{scale:.98},className:"flex-1 py-3 md:py-3.5 px-5 md:px-6 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 text-neutral-700 dark:text-neutral-300 text-sm md:text-base font-bold border-2 border-neutral-200 dark:border-neutral-700/50 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4 md:w-5 md:h-5"}),"Back"]}),jsxRuntimeExports.jsxs(motion.button,{onClick:$,disabled:b||y.length===0,whileHover:{scale:1.02},whileTap:{scale:.98},className:"flex-2 relative py-3 md:py-3.5 px-5 md:px-6 rounded-xl bg-linear-to-r from-purple-500 to-purple-600 text-white text-sm md:text-base font-bold shadow-xl shadow-purple-500/30 flex items-center justify-center gap-2 md:gap-3 disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden group",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-r from-purple-400 to-purple-500 opacity-0 group-hover:opacity-100 transition-opacity"}),jsxRuntimeExports.jsx("span",{className:"relative z-10 flex items-center gap-2 md:gap-3",children:b?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 md:w-5 md:h-5 animate-spin"}),"Loading..."]}):O?.hasNametag?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Continue",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4 md:w-5 md:h-5"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Create ID",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4 md:w-5 md:h-5"})]})})]})]}),O?.hasNametag&&jsxRuntimeExports.jsx(motion.p,{initial:{opacity:0},animate:{opacity:1},className:"mt-4 text-xs text-emerald-600 dark:text-emerald-400 bg-emerald-500/10 border border-emerald-500/20 p-3 rounded-lg",children:"This address already has a Unicity ID. You can continue directly."}),w&&jsxRuntimeExports.jsx(motion.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-3 md:mt-4 text-red-500 dark:text-red-400 text-xs md:text-sm bg-red-500/10 border border-red-500/20 p-2 md:p-3 rounded-lg",children:w})]},"addressSelection")}function NametagScreen({nametagInput:y,isBusy:u,error:g,onNametagChange:v,onSubmit:b}){const w=S=>{const A=S.target.value.toLowerCase();/^[a-z0-9_\-+.]*$/.test(A)&&v(A)},E=S=>{S.key==="Enter"&&y&&!u&&b()};return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},className:"relative z-10 w-full max-w-[280px] md:max-w-[340px]",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:15},className:"relative w-16 h-16 md:w-18 md:h-18 mx-auto mb-5",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-emerald-500/30 rounded-full blur-xl"}),jsxRuntimeExports.jsx("div",{className:"relative w-full h-full rounded-full bg-neutral-100 dark:bg-neutral-800/80 border-2 border-emerald-500/50 flex items-center justify-center backdrop-blur-sm",children:jsxRuntimeExports.jsx(ShieldCheck,{className:"w-8 h-8 md:w-9 md:h-9 text-emerald-500 dark:text-emerald-400"})})]}),jsxRuntimeExports.jsx(motion.h2,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-xl md:text-2xl font-black text-neutral-900 dark:text-white mb-2 md:mb-3 tracking-tight",children:"Wallet Created!"}),jsxRuntimeExports.jsxs(motion.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-neutral-500 dark:text-neutral-400 text-xs md:text-sm mb-5 md:mb-6 mx-auto leading-relaxed",children:["Now, choose a unique"," ",jsxRuntimeExports.jsx("span",{className:"text-orange-500 dark:text-orange-400 font-bold",children:"Unicity ID"})," ","to receive tokens easily without long addresses."]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"relative mb-4 md:mb-5 group",children:[jsxRuntimeExports.jsx("div",{className:"absolute right-3 md:right-4 top-1/2 -translate-y-1/2 text-neutral-400 dark:text-neutral-500 group-focus-within:text-orange-500 dark:group-focus-within:text-orange-400 transition-colors z-10 text-xs md:text-sm font-medium",children:"@unicity"}),jsxRuntimeExports.jsx("input",{type:"text",value:y,onChange:w,onKeyDown:E,placeholder:"id",className:"w-full bg-neutral-100 dark:bg-neutral-800/50 border-2 border-neutral-200 dark:border-neutral-700/50 rounded-xl py-3 md:py-3.5 pl-3 md:pl-4 pr-24 md:pr-28 text-sm md:text-base text-neutral-900 dark:text-white placeholder-neutral-400 dark:placeholder-neutral-600 focus:outline-none focus:border-orange-500 focus:bg-white dark:focus:bg-neutral-800 transition-all backdrop-blur-sm",autoFocus:!0}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-xl bg-linear-to-r from-orange-500/0 via-orange-500/5 to-purple-500/0 opacity-0 group-focus-within:opacity-100 transition-opacity pointer-events-none"})]}),jsxRuntimeExports.jsxs(motion.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},onClick:b,disabled:!y||u,whileHover:{scale:1.02},whileTap:{scale:.98},className:"relative w-full py-3 md:py-3.5 px-5 md:px-6 rounded-xl bg-linear-to-r from-orange-500 to-orange-600 text-white text-sm md:text-base font-bold shadow-xl shadow-orange-500/30 flex items-center justify-center gap-2 md:gap-3 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 overflow-hidden group",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-r from-orange-400 to-orange-500 opacity-0 group-hover:opacity-100 transition-opacity"}),jsxRuntimeExports.jsxs("span",{className:"relative z-10 flex items-center gap-2 md:gap-3",children:["Continue",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4 md:w-5 md:h-5"})]})]}),g&&jsxRuntimeExports.jsx(motion.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-3 md:mt-4 text-red-500 dark:text-red-400 text-xs md:text-sm bg-red-500/10 border border-red-500/20 p-2 md:p-3 rounded-lg",children:g})]},"nametag")}function ProcessingScreen({status:y}){return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},className:"relative z-10 text-center w-full max-w-[280px] md:max-w-[360px]",children:[jsxRuntimeExports.jsxs("div",{className:"relative mx-auto w-24 h-24 md:w-28 md:h-28 mb-6",children:[jsxRuntimeExports.jsx(motion.div,{className:"absolute inset-0 border-3 md:border-4 border-neutral-200 dark:border-neutral-800/50 rounded-full",animate:{rotate:360},transition:{duration:3,repeat:1/0,ease:"linear"}}),jsxRuntimeExports.jsx(motion.div,{className:"absolute inset-1.5 md:inset-2 border-3 md:border-4 border-orange-500/30 rounded-full border-t-orange-500 border-r-orange-500",animate:{rotate:-360},transition:{duration:2,repeat:1/0,ease:"linear"}}),jsxRuntimeExports.jsx("div",{className:"absolute inset-3 md:inset-4 bg-orange-500/20 rounded-full blur-xl"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx(motion.div,{animate:{scale:[1,1.1,1],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 md:w-9 md:h-9 text-orange-500 dark:text-orange-400 animate-spin"})})})]}),jsxRuntimeExports.jsx(motion.h3,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-xl md:text-2xl font-black text-neutral-900 dark:text-white mb-5 md:mb-6 tracking-tight",children:"Setting up Profile..."}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"space-y-2 md:space-y-2.5 text-xs md:text-sm",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center gap-2 md:gap-3 text-neutral-700 dark:text-neutral-300 bg-orange-50 dark:bg-orange-900/20 px-3 md:px-4 py-2.5 md:py-3 rounded-lg backdrop-blur-sm border border-orange-200 dark:border-orange-700/30",children:[jsxRuntimeExports.jsx(motion.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0},className:"w-2 h-2 md:w-2.5 md:h-2.5 rounded-full bg-orange-500 dark:bg-orange-400 shrink-0"}),jsxRuntimeExports.jsx("span",{className:"text-left font-medium",children:y||"Initializing..."})]},y),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",children:[jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${y.includes("Minting")?"bg-orange-500":y.includes("Syncing")||y.includes("Verifying")?"bg-emerald-500":"bg-neutral-300 dark:bg-neutral-600"}`}),jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${y.includes("Syncing")?"bg-orange-500":y.includes("Verifying")?"bg-emerald-500":"bg-neutral-300 dark:bg-neutral-600"}`}),jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${y.includes("Verifying")?"bg-orange-500":"bg-neutral-300 dark:bg-neutral-600"}`})]})]}),jsxRuntimeExports.jsx(motion.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"mt-4 md:mt-5 text-[10px] md:text-xs text-neutral-400 dark:text-neutral-500",children:y.includes("Verifying")?"Verifying IPFS storage (up to 30 seconds)...":"This may take a few moments..."})]},"processing")}function CreateWalletFlow(){const y=useOnboardingConnectionStatus(),{step:u,setStep:g,goToStart:v,isBusy:b,error:w,setError:E,setIsBusy:S,seedWords:A,setSeedWords:$,nametagInput:R,setNametagInput:T,processingStatus:O,derivedAddresses:B,selectedAddressPath:F,showAddressDropdown:U,isCheckingIpns:q,ipnsFetchingNametag:J,setSelectedAddressPath:ie,setShowAddressDropdown:oe,handleCreateKeys:le,handleRestoreWallet:de,handleMintNametag:fe,handleDeriveNewAddress:ye,handleContinueWithAddress:we,goToAddressSelection:pe,identity:ve,nametag:he,getUnifiedKeyManager:ae}=useOnboardingFlow(),Q=useWalletImport({getUnifiedKeyManager:ae,goToAddressSelection:pe,setError:E,setIsBusy:S});return!y.isConnected&&u==="start"?jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center justify-center p-4 md:p-8 text-center relative",children:jsxRuntimeExports.jsx(ConnectionStatus,{state:y.state,message:y.message,error:y.error,onRetry:y.manualConnect,onCancel:y.cancelConnect})}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center p-4 md:p-8 text-center relative",children:[jsxRuntimeExports.jsxs(AnimatePresence,{mode:"wait",children:[u==="start"&&jsxRuntimeExports.jsx(StartScreen,{identity:ve,nametag:he,isBusy:b,ipnsFetchingNametag:J,error:w,onCreateWallet:le,onContinueSetup:()=>g("nametag"),onRestore:()=>g("restoreMethod")}),u==="restoreMethod"&&jsxRuntimeExports.jsx(RestoreMethodScreen,{isBusy:b,error:w,onSelectMnemonic:()=>g("restore"),onSelectFile:()=>g("importFile"),onBack:v}),u==="restore"&&jsxRuntimeExports.jsx(RestoreScreen,{seedWords:A,isBusy:b,error:w,onSeedWordsChange:$,onRestore:de,onBack:()=>g("restoreMethod")}),u==="importFile"&&jsxRuntimeExports.jsx(ImportFileScreen,{selectedFile:Q.selectedFile,scanCount:Q.scanCount,needsScanning:Q.needsScanning,isDragging:Q.isDragging,isBusy:b,error:w,onFileSelect:Q.handleFileSelect,onClearFile:()=>Q.setSelectedFile(null),onScanCountChange:Q.setScanCount,onDragOver:Q.handleDragOver,onDragLeave:Q.handleDragLeave,onDrop:Q.handleDrop,onImport:Q.handleConfirmImport,onBack:()=>{Q.setSelectedFile(null),g("restoreMethod")}}),u==="addressSelection"&&jsxRuntimeExports.jsx(AddressSelectionScreen,{derivedAddresses:B,selectedAddressPath:F,showAddressDropdown:U,isCheckingIpns:q,isBusy:b,error:w,onSelectAddress:ie,onToggleDropdown:()=>oe(!U),onDeriveNewAddress:ye,onContinue:we,onBack:v}),u==="nametag"&&jsxRuntimeExports.jsx(NametagScreen,{nametagInput:R,isBusy:b,error:w,onNametagChange:T,onSubmit:fe}),u==="processing"&&jsxRuntimeExports.jsx(ProcessingScreen,{status:O})]}),jsxRuntimeExports.jsx(LoadPasswordModal,{show:Q.showLoadPasswordModal,onConfirm:Q.onConfirmLoadWithPassword,onCancel:()=>{Q.setShowLoadPasswordModal(!1),Q.setSelectedFile(null)}}),jsxRuntimeExports.jsx(WalletScanModal,{show:Q.showScanModal,wallet:Q.pendingWallet,initialScanCount:Q.initialScanCount,onSelectAddress:Q.onSelectScannedAddress,onSelectAll:Q.onSelectAllScannedAddresses,onCancel:Q.onCancelScan})]})}const NOSTR_PIN_CONFIG={enabled:!0,eventKind:30078,dTag:"ipfs-pin"};class NostrPinPublisher{static instance=null;isStarted=!1;boundHandler=null;constructor(){}static getInstance(){return NostrPinPublisher.instance||(NostrPinPublisher.instance=new NostrPinPublisher),NostrPinPublisher.instance}async start(){this.isStarted||(this.boundHandler=u=>{this.handleStorageEvent(u)},window.addEventListener("ipfs-storage-event",this.boundHandler),this.isStarted=!0,console.log(" NostrPinPublisher started - listening for IPFS storage events"))}stop(){!this.isStarted||!this.boundHandler||(window.removeEventListener("ipfs-storage-event",this.boundHandler),this.boundHandler=null,this.isStarted=!1,console.log(" NostrPinPublisher stopped"))}isRunning(){return this.isStarted}async handleStorageEvent(u){const g=u.detail;if(g.type!=="storage:completed")return;const v=g.data?.cid;if(!v){console.log(" Storage event without CID, skipping");return}const b=g.data?.ipnsName,w=g.data?.tokenCount;console.log(` Publishing pin request for CID: ${v.slice(0,16)}...`);try{await this.publishPinRequest(v,b,w)}catch(E){console.error(" Failed to publish pin request:",E)}}async publishPinRequest(u,g,v){const b=NostrService.getInstance(),w=[["d",NOSTR_PIN_CONFIG.dTag],["cid",u]];g&&w.push(["ipns",g]);const E=v!==void 0?JSON.stringify({tokenCount:v,timestamp:Date.now()}):"",S=await b.publishAppDataEvent(NOSTR_PIN_CONFIG.eventKind,w,E);S?console.log(` Pin request published: ${S.slice(0,8)}... for CID ${u.slice(0,16)}...`):console.warn(" Failed to publish pin request to Nostr")}}function AnimatedBackground(){return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{className:"absolute top-1/4 right-1/4 w-64 h-64 bg-orange-500/20 rounded-full blur-3xl pointer-events-none",animate:{scale:[1,1.2,1],opacity:[.2,.3,.2]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}}),jsxRuntimeExports.jsx(motion.div,{className:"absolute bottom-1/4 left-1/4 w-64 h-64 bg-purple-500/20 rounded-full blur-3xl pointer-events-none",animate:{scale:[1,1.3,1],opacity:[.2,.3,.2]},transition:{duration:5,repeat:1/0,ease:"easeInOut",delay:1}})]})}function LoadingScreen(){return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-linear-to-br from-neutral-950 via-neutral-900 to-neutral-950 flex items-center justify-center relative overflow-hidden",children:[jsxRuntimeExports.jsx(AnimatedBackground,{}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center relative z-10",children:[jsxRuntimeExports.jsxs("div",{className:"relative mx-auto w-20 h-20 mb-6",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 border-4 border-neutral-800 rounded-full"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 border-4 border-orange-500 rounded-full border-t-transparent animate-spin"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 text-orange-500 animate-spin"})})]}),jsxRuntimeExports.jsx("p",{className:"text-neutral-400",children:"Loading wallet..."})]})]})}function OnboardingScreen(){return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-linear-to-br from-neutral-100 via-white to-neutral-100 dark:from-neutral-950 dark:via-neutral-900 dark:to-neutral-950 flex items-center justify-center relative overflow-hidden",children:[jsxRuntimeExports.jsx(AnimatedBackground,{}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md relative z-10",children:jsxRuntimeExports.jsx(CreateWalletFlow,{})})]})}function WalletGate({children:y}){const{identity:u,nametag:g,isLoadingIdentity:v,isLoadingNametag:b}=useWallet(),w=v||!!u&&b,E=!!u&&!!g;return reactExports.useEffect(()=>{if(E&&NOSTR_PIN_CONFIG.enabled){const S=NostrPinPublisher.getInstance();return S.start().catch(A=>{console.error("Failed to start NostrPinPublisher:",A)}),()=>{S.stop()}}},[E]),w?jsxRuntimeExports.jsx(LoadingScreen,{}):E?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:y}):jsxRuntimeExports.jsx(OnboardingScreen,{})}const DiscordIcon=({className:y})=>jsxRuntimeExports.jsx("svg",{className:y,viewBox:"0 0 24 24",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"})});function SplashScreen({onEnter:y}){return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-linear-to-br from-neutral-100 via-white to-neutral-100 dark:from-neutral-950 dark:via-neutral-900 dark:to-neutral-950 cursor-pointer",onClick:y,children:[jsxRuntimeExports.jsx(motion.div,{className:"absolute top-1/4 left-1/4 w-48 h-48 md:w-96 md:h-96 bg-orange-500/10 dark:bg-orange-500/20 rounded-full blur-2xl md:blur-3xl",animate:{scale:[1,1.2,1],opacity:[.1,.2,.1]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}}),jsxRuntimeExports.jsx(motion.div,{className:"absolute bottom-1/4 right-1/4 w-48 h-48 md:w-96 md:h-96 bg-purple-500/10 dark:bg-purple-500/20 rounded-full blur-2xl md:blur-3xl ",animate:{scale:[1,1.3,1],opacity:[.1,.2,.1]},transition:{duration:5,repeat:1/0,ease:"easeInOut",delay:1}}),jsxRuntimeExports.jsx(motion.div,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[400px] h-[400px] md:w-[600px] md:h-[600px] bg-orange-500/5 dark:bg-orange-500/10 rounded-full blur-3xl will-change-transform",animate:{scale:[1,1.2,1],rotate:[0,180,360]},transition:{duration:20,repeat:1/0,ease:"easeInOut"},style:{backfaceVisibility:"hidden",perspective:1e3}}),jsxRuntimeExports.jsxs("div",{className:"relative z-10 text-center px-4 md:px-8 flex flex-col items-center justify-between h-full py-12 md:py-20",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.8,ease:"easeOut"},className:"relative mb-6 md:mb-12",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-r from-orange-500/10 dark:from-orange-500/20 to-orange-600/10 dark:to-orange-600/20 blur-2xl md:blur-3xl",style:{animation:"pulse-slow 3s ease-in-out infinite"}}),jsxRuntimeExports.jsxs("div",{className:"relative flex items-center justify-center gap-0 flex-wrap",children:[jsxRuntimeExports.jsx(motion.div,{className:"relative",animate:{textShadow:["0 0 20px rgba(0, 0, 0, 0.1)","0 0 30px rgba(0, 0, 0, 0.15)","0 0 20px rgba(0, 0, 0, 0.1)"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:jsxRuntimeExports.jsx("span",{className:"text-4xl sm:text-5xl md:text-7xl lg:text-8xl text-neutral-900 dark:text-white tracking-tight",style:{fontFamily:"system-ui, -apple-system, sans-serif",fontWeight:900},children:"AGENT"})}),jsxRuntimeExports.jsx(motion.div,{className:"relative",initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{duration:.8,delay:.3},children:jsxRuntimeExports.jsx(motion.span,{className:"text-4xl sm:text-5xl md:text-7xl lg:text-8xl bg-linear-to-r from-orange-500 via-orange-400 to-orange-600 bg-clip-text text-transparent tracking-tight",style:{fontFamily:"system-ui, -apple-system, sans-serif",fontWeight:900},animate:{backgroundPosition:["0% 50%","100% 50%","0% 50%"]},transition:{duration:3,repeat:1/0,ease:"linear"},children:"SPHERE"})})]})]}),jsxRuntimeExports.jsx(motion.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.5},className:"text-neutral-500 dark:text-neutral-400 text-sm sm:text-base md:text-lg lg:text-xl tracking-wide",children:"Dive in and feel the difference"}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.6},className:"flex items-center gap-4 mt-6",onClick:u=>u.stopPropagation(),children:[jsxRuntimeExports.jsx(motion.a,{href:"https://github.com/unicitynetwork",target:"_blank",rel:"noopener noreferrer",whileHover:{scale:1.1,y:-2},whileTap:{scale:.95},className:"p-3 rounded-full bg-neutral-200/50 dark:bg-neutral-800/50 hover:bg-neutral-300/50 dark:hover:bg-neutral-700/50 transition-colors group",children:jsxRuntimeExports.jsx(Github,{className:"w-5 h-5 md:w-6 md:h-6 text-neutral-600 dark:text-neutral-400 group-hover:text-orange-500 dark:group-hover:text-orange-400 transition-colors"})}),jsxRuntimeExports.jsx(motion.a,{href:"https://discord.gg/S9f57ZKdt",target:"_blank",rel:"noopener noreferrer",whileHover:{scale:1.1,y:-2},whileTap:{scale:.95},className:"p-3 rounded-full bg-neutral-200/50 dark:bg-neutral-800/50 hover:bg-neutral-300/50 dark:hover:bg-neutral-700/50 transition-colors group",children:jsxRuntimeExports.jsx(DiscordIcon,{className:"w-5 h-5 md:w-6 md:h-6 text-neutral-600 dark:text-neutral-400 group-hover:text-orange-500 dark:group-hover:text-orange-400 transition-colors"})})]})]}),jsxRuntimeExports.jsxs(motion.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.8},className:"text-neutral-500 dark:text-neutral-400 flex items-center gap-3 group mt-8",whileHover:{scale:1.05},whileTap:{scale:.95},children:[jsxRuntimeExports.jsx("span",{className:"relative z-10 group-hover:text-orange-500 dark:group-hover:text-orange-400 transition-colors text-sm md:text-base",children:"Tap to join"}),jsxRuntimeExports.jsx(motion.div,{animate:{x:[0,5,0]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},children:jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4 md:w-5 md:h-5 relative z-10 text-orange-500 dark:text-orange-400"})})]})]}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 opacity-10 dark:opacity-20 md:opacity-15 md:dark:opacity-30 pointer-events-none",style:{backgroundImage:`
            radial-gradient(at 20% 30%, rgba(251, 146, 60, 0.15) 0px, transparent 50%),
            radial-gradient(at 80% 70%, rgba(168, 85, 247, 0.15) 0px, transparent 50%)
          `}}),jsxRuntimeExports.jsx("style",{children:`
        @keyframes pulse-slow {
          0%, 100% { transform: scale(1); opacity: 0.2; }
          50% { transform: scale(1.15); opacity: 0.3; }
        }
        @media (prefers-reduced-motion: reduce) {
          .will-change-transform {
            animation: none !important;
          }
        }
      `})]})}function WelcomeModal({show:y,onAccept:u}){const[g,v]=reactExports.useState(!1),[b,w]=reactExports.useState(!1),E=g&&b,S=[{icon:Coins,title:"Buy & Trade",description:"Access decentralized markets"},{icon:Rocket,title:"Bet & Win",description:"Prediction markets & games"},{icon:MessageCircle,title:"Chat & Connect",description:"Private, encrypted messaging"}];return jsxRuntimeExports.jsx(AnimatePresence,{children:y&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-white/80 dark:bg-black/80 backdrop-blur-md flex items-center justify-center z-60 p-4",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:30},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:30},transition:{type:"spring",duration:.5},className:"relative w-full max-w-lg bg-linear-to-b from-neutral-100 to-white dark:from-neutral-900 dark:to-black border border-orange-500/20 rounded-3xl shadow-2xl shadow-orange-500/10 overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-3/4 h-32 bg-orange-500/10 blur-3xl pointer-events-none"}),jsxRuntimeExports.jsxs("div",{className:"relative p-6 md:p-8",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-center mb-6",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-linear-to-br from-orange-500 to-orange-600 mb-4",children:jsxRuntimeExports.jsx(Shield,{className:"w-8 h-8 text-white"})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-neutral-900 dark:text-white mb-2",children:"Welcome Aboard"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm md:text-base",children:"Infrastructure for a free Internet"})]}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-neutral-200/50 dark:bg-neutral-800/50 border border-neutral-300/50 dark:border-neutral-700/50 rounded-2xl p-4 mb-6",children:jsxRuntimeExports.jsx("p",{className:"text-neutral-600 dark:text-neutral-300 text-sm md:text-base text-center italic",children:`"Privacy isn't a feature. It's the foundation of freedom."`})}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"grid grid-cols-3 gap-3 mb-6",children:S.map((A,$)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.4+$*.1},className:"flex flex-col items-center text-center p-3 rounded-xl bg-neutral-200/30 dark:bg-neutral-800/30 border border-neutral-300/30 dark:border-neutral-700/30",children:[jsxRuntimeExports.jsx(A.icon,{className:"w-6 h-6 text-orange-500 mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-neutral-900 dark:text-white text-xs font-medium",children:A.title}),jsxRuntimeExports.jsx("span",{className:"text-neutral-500 text-[10px] mt-0.5",children:A.description})]},A.title))}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"space-y-3 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-500/10 border border-amber-500/20 rounded-xl",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-amber-700 dark:text-amber-200/80 text-xs",children:"This platform involves financial transactions and prediction markets. You are solely responsible for your actions."})]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-3 p-3 bg-neutral-200/50 dark:bg-neutral-800/50 rounded-xl cursor-pointer group",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:g,onChange:A=>v(A.target.checked),className:"sr-only"}),jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded border-2 transition-colors ${g?"bg-orange-500 border-orange-500":"border-neutral-400 dark:border-neutral-600 group-hover:border-neutral-500"}`,children:g&&jsxRuntimeExports.jsx(motion.svg,{initial:{scale:0},animate:{scale:1},className:"w-full h-full text-white p-0.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})})]}),jsxRuntimeExports.jsx("span",{className:"text-neutral-600 dark:text-neutral-300 text-sm",children:"I confirm that I am at least 18 years old"})]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-3 p-3 bg-neutral-200/50 dark:bg-neutral-800/50 rounded-xl cursor-pointer group",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:b,onChange:A=>w(A.target.checked),className:"sr-only"}),jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded border-2 transition-colors ${b?"bg-orange-500 border-orange-500":"border-neutral-400 dark:border-neutral-600 group-hover:border-neutral-500"}`,children:b&&jsxRuntimeExports.jsx(motion.svg,{initial:{scale:0},animate:{scale:1},className:"w-full h-full text-white p-0.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})})]}),jsxRuntimeExports.jsx("span",{className:"text-neutral-600 dark:text-neutral-300 text-sm",children:"I understand that I use this platform at my own risk"})]})]}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:jsxRuntimeExports.jsxs(motion.button,{whileHover:E?{scale:1.02}:{},whileTap:E?{scale:.98}:{},onClick:E?u:void 0,disabled:!E,className:`w-full py-4 rounded-xl font-semibold text-white flex items-center justify-center gap-2 transition-all ${E?"bg-linear-to-r from-orange-500 to-orange-600 hover:from-orange-400 hover:to-orange-500 shadow-lg shadow-orange-500/25":"bg-neutral-400 dark:bg-neutral-700 cursor-not-allowed opacity-50"}`,children:[jsxRuntimeExports.jsx("span",{children:"Enter the Sphere"}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5"})]})})]})]})})})}function IntroPage(){const y=useNavigate(),[u,g]=reactExports.useState(!1),[v,b]=reactExports.useState(null);reactExports.useEffect(()=>{const S=localStorage.getItem(STORAGE_KEYS.WELCOME_ACCEPTED)==="true";b(S)},[]);const w=()=>{v?y("/home"):g(!0)},E=()=>{localStorage.setItem(STORAGE_KEYS.WELCOME_ACCEPTED,"true"),g(!1),y("/home")};return v===null?null:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SplashScreen,{onEnter:w}),jsxRuntimeExports.jsx(WelcomeModal,{show:u,onAccept:E})]})}function AgentCard({id:y,name:u,Icon:g,category:v,color:b,isSelected:w}){return jsxRuntimeExports.jsx(Link$1,{to:`/agents/${y}`,children:jsxRuntimeExports.jsxs(motion.div,{whileHover:{scale:1.05,y:-4},whileTap:{scale:.95},transition:{duration:.05},className:`relative rounded-xl md:rounded-2xl p-2 md:p-6 aspect-square md:aspect-auto md:h-[180px] flex flex-col items-center justify-center gap-2 md:gap-4 transition-all duration-150 overflow-hidden group cursor-pointer ${w?"ring-2 ring-orange-500 ring-offset-1 md:ring-offset-2 ring-offset-neutral-100 dark:ring-offset-neutral-950":""}`,children:[jsxRuntimeExports.jsx("div",{className:`absolute inset-0 bg-linear-to-br ${b} opacity-90 group-hover:opacity-100 transition-all duration-200`}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 opacity-30 group-hover:opacity-50 transition-opacity duration-500",style:{backgroundImage:`radial-gradient(at 27% 37%, rgba(255, 255, 255, 0.1) 0px, transparent 50%),
                           radial-gradient(at 97% 21%, rgba(255, 255, 255, 0.1) 0px, transparent 50%),
                           radial-gradient(at 52% 99%, rgba(255, 255, 255, 0.1) 0px, transparent 50%),
                           radial-gradient(at 10% 29%, rgba(255, 255, 255, 0.1) 0px, transparent 50%)`}}),jsxRuntimeExports.jsx(motion.div,{className:"absolute inset-0 bg-linear-to-tr from-transparent via-white/30 to-transparent hidden md:block",initial:{x:"-100%",opacity:0},whileHover:{x:"100%",opacity:1},transition:{duration:.6,ease:"easeInOut"}}),jsxRuntimeExports.jsx("div",{className:`absolute -inset-1 bg-linear-to-br ${b} blur-2xl opacity-0 group-hover:opacity-70 transition-all duration-300 hidden md:block`}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-white/0 group-hover:bg-white/5 backdrop-blur-0 group-hover:backdrop-blur-sm transition-all duration-300 rounded-xl md:rounded-2xl"}),jsxRuntimeExports.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-1.5 md:gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute -inset-1 md:-inset-2 rounded-xl md:rounded-2xl bg-white/20 blur-sm group-hover:bg-white/30 transition-all duration-300"}),jsxRuntimeExports.jsx("div",{className:"relative w-12 h-12 md:w-16 md:h-16 rounded-xl md:rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/40 group-hover:scale-110 group-hover:rotate-3 transition-all duration-300 shadow-2xl",children:jsxRuntimeExports.jsx(g,{className:"w-7 h-7 md:w-8 md:h-8 text-white drop-shadow-2xl"})}),jsxRuntimeExports.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 rounded-full bg-white/60 group-hover:scale-150 transition-transform duration-300 hidden md:block"}),jsxRuntimeExports.jsx("div",{className:"absolute -bottom-1 -left-1 w-2 h-2 rounded-full bg-white/40 group-hover:scale-150 transition-transform duration-300 hidden md:block"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-[11px] md:text-base text-white drop-shadow-lg md:mb-1.5 group-hover:scale-105 transition-transform duration-300 leading-tight",children:u}),jsxRuntimeExports.jsx("div",{className:"hidden md:block text-xs text-white/90 drop-shadow px-3 py-1 rounded-full bg-white/10 backdrop-blur-sm border border-white/20",children:v})]})]}),jsxRuntimeExports.jsx("div",{className:"absolute top-0 right-0 w-10 h-10 md:w-24 md:h-24 bg-white/10 rounded-bl-full group-hover:w-12 group-hover:h-12 md:group-hover:w-28 md:group-hover:h-28 transition-all duration-300"}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 w-8 h-8 md:w-20 md:h-20 bg-black/10 rounded-tr-full group-hover:w-10 group-hover:h-10 md:group-hover:w-24 md:group-hover:h-24 transition-all duration-300"}),w&&jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},className:"absolute top-2 right-2 md:top-4 md:right-4 w-2 h-2 md:w-3 md:h-3 rounded-full bg-white shadow-lg z-20",children:jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-full bg-white animate-ping"})})]})})}const QUERY_KEYS$1={CONVERSATIONS:["chat","conversations"],MESSAGES:y=>["chat","messages",y],UNREAD_COUNT:["chat","unreadCount"]},chatRepository=ChatRepository.getInstance(),useChat=()=>{const y=useQueryClient(),{nostrService:u}=useServices(),[g,v]=reactExports.useState(null),[b,w]=reactExports.useState(""),[E,S]=reactExports.useState("");reactExports.useEffect(()=>{const ie=()=>{y.invalidateQueries({queryKey:QUERY_KEYS$1.CONVERSATIONS}),g&&y.invalidateQueries({queryKey:QUERY_KEYS$1.MESSAGES(g.id)}),y.invalidateQueries({queryKey:QUERY_KEYS$1.UNREAD_COUNT})},oe=le=>{const de=le.detail;g&&de.conversationId===g.id&&(y.invalidateQueries({queryKey:QUERY_KEYS$1.MESSAGES(g.id)}),chatRepository.markConversationAsRead(g.id)),y.invalidateQueries({queryKey:QUERY_KEYS$1.CONVERSATIONS}),y.invalidateQueries({queryKey:QUERY_KEYS$1.UNREAD_COUNT})};return window.addEventListener("chat-updated",ie),window.addEventListener("dm-received",oe),()=>{window.removeEventListener("chat-updated",ie),window.removeEventListener("dm-received",oe)}},[y,g]);const A=useQuery({queryKey:QUERY_KEYS$1.CONVERSATIONS,queryFn:()=>chatRepository.getConversations(),staleTime:3e4}),$=useQuery({queryKey:QUERY_KEYS$1.MESSAGES(g?.id||""),queryFn:()=>g?chatRepository.getMessagesForConversation(g.id):[],enabled:!!g,staleTime:1e4}),R=useQuery({queryKey:QUERY_KEYS$1.UNREAD_COUNT,queryFn:()=>chatRepository.getTotalUnreadCount(),staleTime:3e4}),T=useMutation({mutationFn:async ie=>{if(!g)throw new Error("No conversation selected");return!!await u.sendDirectMessage(g.participantPubkey,ie,g.participantNametag)},onSuccess:()=>{w(""),y.invalidateQueries({queryKey:QUERY_KEYS$1.MESSAGES(g?.id||"")}),y.invalidateQueries({queryKey:QUERY_KEYS$1.CONVERSATIONS})}}),O=reactExports.useCallback(async ie=>{try{let oe=ie,le;if(ie.includes("@")||!/^[0-9a-fA-F]{64}$/.test(ie)){le=ie.replace("@","");const fe=await u.queryPubkeyByNametag(le);if(!fe)return console.error(`Could not resolve nametag: ${le}`),null;oe=fe}const de=chatRepository.getOrCreateConversation(oe,le);return v(de),y.invalidateQueries({queryKey:QUERY_KEYS$1.CONVERSATIONS}),de}catch(oe){return console.error("Failed to start conversation",oe),null}},[u,y]),B=reactExports.useCallback(ie=>{v(ie),ie&&(chatRepository.markConversationAsRead(ie.id),y.invalidateQueries({queryKey:QUERY_KEYS$1.UNREAD_COUNT}))},[y]),F=reactExports.useCallback(ie=>{chatRepository.deleteConversation(ie),g?.id===ie&&v(null),y.invalidateQueries({queryKey:QUERY_KEYS$1.CONVERSATIONS})},[y,g]),U=reactExports.useCallback(ie=>{chatRepository.markConversationAsRead(ie),y.invalidateQueries({queryKey:QUERY_KEYS$1.UNREAD_COUNT})},[y]),q=reactExports.useCallback(async ie=>ie.trim()?T.mutateAsync(ie):!1,[T]),J=reactExports.useMemo(()=>{const ie=A.data||[];if(!E.trim())return ie;const oe=E.toLowerCase();return ie.filter(le=>le.getDisplayName().toLowerCase().includes(oe)||le.lastMessageText.toLowerCase().includes(oe))},[A.data,E]);return{conversations:A.data||[],isLoadingConversations:A.isLoading,selectedConversation:g,selectConversation:B,startNewConversation:O,deleteConversation:F,messages:$.data||[],isLoadingMessages:$.isLoading,sendMessage:q,isSending:T.isPending,messageInput:b,setMessageInput:w,totalUnreadCount:R.data||0,markAsRead:U,searchQuery:E,setSearchQuery:S,filteredConversations:J}};function DMConversationItem({conversation:y,isSelected:u,onClick:g,onDelete:v}){const b=w=>{w.stopPropagation(),v()};return jsxRuntimeExports.jsxs(motion.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:g,className:`p-3 rounded-xl cursor-pointer transition-all relative overflow-hidden group ${u?"bg-linear-to-br from-orange-500 to-orange-600 text-white shadow-lg shadow-orange-500/30":"bg-neutral-100 dark:bg-neutral-800/50 hover:bg-neutral-200 dark:hover:bg-neutral-700/50 border border-neutral-200 dark:border-neutral-700/50"}`,children:[u&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-tr from-white/0 via-white/10 to-white/0"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center text-sm font-medium shrink-0 ${u?"bg-white/20 text-white":"bg-linear-to-br from-orange-500 to-orange-600 text-white shadow-md"}`,children:y.getAvatar()}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-2",children:[jsxRuntimeExports.jsx("span",{className:`font-medium truncate ${u?"text-white":"text-neutral-900 dark:text-white"}`,children:y.getDisplayName()}),jsxRuntimeExports.jsx("span",{className:`text-xs shrink-0 ${u?"text-white/70":"text-neutral-500 dark:text-neutral-400"}`,children:y.getFormattedLastMessageTime()})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-2 mt-0.5",children:[jsxRuntimeExports.jsx("p",{className:`text-sm truncate ${u?"text-white/80":"text-neutral-500 dark:text-neutral-400"}`,children:y.lastMessageText||"No messages yet"}),y.unreadCount>0&&jsxRuntimeExports.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full shrink-0 ${u?"bg-white/20 text-white":"bg-orange-500 text-white"}`,children:y.unreadCount>99?"99+":y.unreadCount})]})]}),jsxRuntimeExports.jsx(motion.button,{onClick:b,className:`absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity ${u?"hover:bg-white/20 text-white":"hover:bg-red-100 dark:hover:bg-red-900/30 text-red-500"}`,whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]})}function DMConversationList({conversations:y,selectedConversation:u,onSelect:g,onDelete:v,onNewConversation:b,searchQuery:w,onSearchChange:E,isOpen:S,onClose:A,isCollapsed:$,onCollapse:R,totalUnreadCount:T,onModeChange:O}){return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatePresence,{children:S&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"lg:hidden absolute inset-0 bg-black/50 z-40 rounded-3xl",onClick:A})}),jsxRuntimeExports.jsxs("div",{className:`
        w-72 border-r border-neutral-200 dark:border-neutral-800/50 flex flex-col z-50 overflow-hidden
        absolute lg:relative inset-y-0 left-0 min-h-0
        transform transition-all duration-300 ease-in-out
        ${S?"translate-x-0":"-translate-x-full lg:translate-x-0"}
        ${$?"lg:w-0 lg:border-0 lg:min-w-0":"lg:w-72"}
        bg-white/95 dark:bg-neutral-900/95 lg:bg-transparent backdrop-blur-xl lg:backdrop-blur-none rounded-l-3xl lg:rounded-none
      `,children:[jsxRuntimeExports.jsxs("div",{className:"shrink-0 p-4 border-b border-neutral-200 dark:border-neutral-800/50 bg-linear-to-br from-white/80 dark:from-neutral-900/80 to-neutral-50/40 dark:to-neutral-800/40 backdrop-blur-sm relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-orange-500/5 rounded-bl-full"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3 relative z-10",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white font-medium",children:"Messages"}),jsxRuntimeExports.jsx(Sparkles,{className:"w-4 h-4 text-orange-500 animate-pulse"}),T>0&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-xs rounded-full bg-orange-500 text-white",children:T>99?"99+":T})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(motion.button,{onClick:b,className:"p-2 rounded-lg bg-linear-to-br from-orange-500 to-orange-600 text-white shadow-lg shadow-orange-500/30",title:"New conversation",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(MessageSquarePlus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(motion.button,{onClick:R,className:"hidden lg:flex p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors border border-neutral-200 dark:border-neutral-700/50",title:"Collapse sidebar",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(PanelLeftClose,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(motion.button,{onClick:A,className:"lg:hidden p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors border border-neutral-200 dark:border-neutral-700/50",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2 relative z-10 mb-3",children:[jsxRuntimeExports.jsxs(motion.button,{onClick:()=>O("global"),className:"px-4 py-3 rounded-xl text-sm transition-all relative overflow-hidden bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 border border-neutral-200 dark:border-neutral-700/50",whileHover:{scale:1.02},whileTap:{scale:.98},children:[jsxRuntimeExports.jsx(Hash$2,{className:"w-4 h-4 inline mr-2"}),jsxRuntimeExports.jsx("span",{children:"Global"})]}),jsxRuntimeExports.jsxs(motion.button,{className:"px-4 py-3 rounded-xl text-sm transition-all relative overflow-hidden bg-linear-to-br from-orange-500 to-orange-600 text-white shadow-lg shadow-orange-500/30",whileHover:{scale:1.02},whileTap:{scale:.98},children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-tr from-white/0 via-white/20 to-white/0"}),jsxRuntimeExports.jsx(User,{className:"w-4 h-4 inline mr-2"}),jsxRuntimeExports.jsx("span",{className:"relative z-10",children:"DM"})]})]}),jsxRuntimeExports.jsxs("div",{className:"relative z-10",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400"}),jsxRuntimeExports.jsx("input",{type:"text",value:w,onChange:B=>E(B.target.value),placeholder:"Search conversations...",className:"w-full pl-9 pr-3 py-2 bg-neutral-100 dark:bg-neutral-800/50 text-neutral-900 dark:text-white placeholder-neutral-400 rounded-xl text-sm border border-neutral-200 dark:border-neutral-700/50 focus:outline-none focus:border-orange-500 transition-colors"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:y.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-2xl bg-neutral-100 dark:bg-neutral-800/50 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(MessageSquarePlus,{className:"w-8 h-8 text-neutral-400"})}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm",children:"No conversations yet"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-400 dark:text-neutral-500 text-xs mt-1",children:"Start a new conversation to begin"})]}):jsxRuntimeExports.jsx(AnimatePresence,{mode:"popLayout",children:y.map(B=>jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},layout:!0,children:jsxRuntimeExports.jsx(DMConversationItem,{conversation:B,isSelected:u?.id===B.id,onClick:()=>g(B),onDelete:()=>v(B.id)})},B.id))})})]})]})}function DMMessageBubble({message:y,delay:u=0}){const g=y.isFromMe,v=()=>{switch(y.status){case MessageStatus.PENDING:return jsxRuntimeExports.jsx(Clock,{className:"w-3 h-3 text-white/60"});case MessageStatus.SENT:return jsxRuntimeExports.jsx(Check,{className:"w-3 h-3 text-white/60"});case MessageStatus.DELIVERED:return jsxRuntimeExports.jsx(CheckCheck,{className:"w-3 h-3 text-white/60"});case MessageStatus.READ:return jsxRuntimeExports.jsx(CheckCheck,{className:"w-3 h-3 text-blue-300"});case MessageStatus.FAILED:return jsxRuntimeExports.jsx(CircleAlert,{className:"w-3 h-3 text-red-300"});default:return jsxRuntimeExports.jsx(Check,{className:"w-3 h-3 text-white/60"})}};return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:u},className:`flex gap-3 ${g?"flex-row-reverse":""}`,children:[!g&&jsxRuntimeExports.jsx("div",{className:"shrink-0 px-2 py-1 rounded-lg bg-linear-to-br from-orange-500 to-orange-600 text-white text-xs font-medium shadow-md self-start",children:y.senderNametag?`@${y.senderNametag.replace("@","")}`:y.senderPubkey?.slice(0,8)||"??"}),jsxRuntimeExports.jsxs("div",{className:`flex flex-col ${g?"items-end":"items-start"} max-w-[75%]`,children:[jsxRuntimeExports.jsxs(motion.div,{whileHover:{scale:1.01},className:`rounded-2xl px-4 py-3 relative overflow-hidden ${g?"bg-linear-to-br from-orange-500 to-orange-600 text-white shadow-lg shadow-orange-500/20":"bg-neutral-100 dark:bg-neutral-800/80 backdrop-blur-sm text-neutral-800 dark:text-neutral-100 border border-neutral-200 dark:border-neutral-700/50"}`,children:[g&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-tr from-white/0 via-white/10 to-white/0"}),jsxRuntimeExports.jsx("p",{className:"text-sm leading-relaxed relative z-10 break-words whitespace-pre-wrap",children:y.content})]}),jsxRuntimeExports.jsxs("div",{className:`flex items-center gap-1.5 mt-1 px-1 ${g?"flex-row-reverse":""}`,children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:y.getFormattedTime()}),g&&jsxRuntimeExports.jsx(v,{})]})]})]})}function DMMessageList({messages:y,isLoading:u}){const g=reactExports.useRef(null),v=reactExports.useRef(null);reactExports.useEffect(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[y]);const b=y.reduce((w,E)=>{const S=E.getFormattedDate();return w[S]||(w[S]=[]),w[S].push(E),w},{});return u?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-0",children:jsxRuntimeExports.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-orange-500 border-t-transparent rounded-full"})}):y.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center text-center p-8 min-h-0",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"w-20 h-20 rounded-2xl bg-neutral-100 dark:bg-neutral-800/50 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(MessageCircle,{className:"w-10 h-10 text-neutral-400"})}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"No messages yet"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-400 dark:text-neutral-500 text-sm mt-1",children:"Start the conversation by sending a message"})]}):jsxRuntimeExports.jsxs("div",{ref:g,className:"overflow-y-auto px-4 py-4 space-y-4 min-h-0",children:[jsxRuntimeExports.jsx(AnimatePresence,{mode:"popLayout",children:Object.entries(b).map(([w,E])=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-3",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center my-4",children:jsxRuntimeExports.jsx("div",{className:"px-3 py-1 rounded-full bg-neutral-100 dark:bg-neutral-800/50 text-xs text-neutral-500 dark:text-neutral-400 border border-neutral-200 dark:border-neutral-700/50",children:w})}),E.map((S,A)=>jsxRuntimeExports.jsx(DMMessageBubble,{message:S,delay:A*.05},S.id))]},w))}),jsxRuntimeExports.jsx("div",{ref:v})]})}const DMChatInput=reactExports.forwardRef(function y({value:u,onChange:g,onSend:v,isSending:b=!1,placeholder:w="Type a message...",disabled:E=!1},S){const A=reactExports.useRef(null);reactExports.useImperativeHandle(S,()=>A.current,[]);const $=R=>{R.key==="Enter"&&!R.shiftKey&&(R.preventDefault(),u.trim()&&!b&&!E&&v())};return jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-neutral-200 dark:border-neutral-800/50 bg-white/80 dark:bg-neutral-900/80 backdrop-blur-sm theme-transition",style:{paddingBottom:"calc(1rem + var(--safe-area-bottom, 0px))"},children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("textarea",{ref:A,value:u,onChange:R=>g(R.target.value),onKeyDown:$,placeholder:w,disabled:E||b,className:"flex-1 bg-neutral-100 dark:bg-neutral-800/50 text-neutral-900 dark:text-white placeholder-neutral-400 dark:placeholder-neutral-500 outline-none resize-none rounded-xl p-3 min-h-11 max-h-[120px] border border-neutral-200 dark:border-neutral-700/50 text-base theme-transition disabled:opacity-50",rows:1,enterKeyHint:"send"}),jsxRuntimeExports.jsx(motion.button,{onClick:v,disabled:!u.trim()||b||E,className:"px-5 py-2 rounded-xl bg-linear-to-r from-orange-500 to-orange-600 text-white disabled:opacity-50 flex items-center justify-center min-w-[60px]",whileHover:{scale:1.05},whileTap:{scale:.95},children:b?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):jsxRuntimeExports.jsx(Send,{className:"w-4 h-4"})})]})})});function NewConversationModal({isOpen:y,onClose:u,onStart:g}){const[v,b]=reactExports.useState(""),[w,E]=reactExports.useState(!1),[S,A]=reactExports.useState(null),$=async()=>{if(v.trim()){E(!0),A(null);try{await g(v.trim())?(b(""),u()):A("Could not start conversation. Please check the nametag or public key.")}catch{A("Failed to start conversation. Please try again.")}finally{E(!1)}}},R=T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),$()),T.key==="Escape"&&u()};return jsxRuntimeExports.jsx(AnimatePresence,{children:y&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:u}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-2xl shadow-2xl border border-neutral-200 dark:border-neutral-700/50 overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800/50 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-linear-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-lg",children:jsxRuntimeExports.jsx(User,{className:"w-5 h-5 text-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white font-medium",children:"New Conversation"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"Start a private chat"})]})]}),jsxRuntimeExports.jsx(motion.button,{onClick:u,className:"p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm text-neutral-600 dark:text-neutral-400 mb-2",children:"Enter nametag or public key"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(AtSign,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-neutral-400"}),jsxRuntimeExports.jsx("input",{type:"text",value:v,onChange:T=>b(T.target.value),onKeyDown:R,placeholder:"e.g., alice or npub1...",className:"w-full pl-10 pr-4 py-3 bg-neutral-100 dark:bg-neutral-800/50 text-neutral-900 dark:text-white placeholder-neutral-400 rounded-xl border border-neutral-200 dark:border-neutral-700/50 focus:outline-none focus:border-orange-500 transition-colors",autoFocus:!0})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-2",children:"You can enter a nametag (without @) or a full Nostr public key"})]}),S&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 text-sm",children:S})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t border-neutral-200 dark:border-neutral-800/50 flex gap-3",children:[jsxRuntimeExports.jsx(motion.button,{onClick:u,className:"flex-1 py-3 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 text-neutral-700 dark:text-neutral-300 font-medium border border-neutral-200 dark:border-neutral-700/50 hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Cancel"}),jsxRuntimeExports.jsx(motion.button,{onClick:$,disabled:!v.trim()||w,className:"flex-1 py-3 rounded-xl bg-linear-to-r from-orange-500 to-orange-600 text-white font-medium disabled:opacity-50 flex items-center justify-center gap-2",whileHover:{scale:1.02},whileTap:{scale:.98},children:w?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Starting..."})]}):jsxRuntimeExports.jsx("span",{children:"Start Chat"})})]})]})})]})})}const agents=[{id:"chat",name:"Chat",description:"DM and group messaging",Icon:MessageSquare,category:"Social",color:"from-blue-500 to-cyan-500",type:"chat"},{id:"ai",name:"Uncensored AI",description:"Viktor can assist with anything",Icon:Sparkles,category:"Assistant",color:"from-orange-500 to-amber-500",type:"simple-ai",greetingMessage:`Hi! I'm Viktor, your personal assistant.
I care a great deal about privacy. I don't know you, I don't log you, I don't even know your IP address. You are invisible here and nothing will be recorded about our conversation.
How can I help?`,backendActivityId:"ama",quickActions:[{label:"Research",message:"Research the latest news"},{label:"Explain",message:"Explain how something works"},{label:"Help",message:"Help me with a task"}]},{id:"trivia",name:"Unicity Trivia",description:"Test your knowledge!",Icon:Brain,category:"Entertainment",color:"from-indigo-500 to-cyan-500",type:"unified",greetingMessage:"Welcome to Trivia Challenge! I can quiz you on various topics. Say 'start' to begin, or ask for available categories!",backendActivityId:"trivia",quickActions:[{label:"Start game",message:"Start game"},{label:"Categories",message:"Show categories"},{label:"My score",message:"Show my score"},{label:"A",message:"A"},{label:"B",message:"B"},{label:"C",message:"C"},{label:"D",message:"D"}],contentType:"none"},{id:"games",name:"P2P Gaming",description:"Discover and play games",Icon:Gamepad2,category:"Entertainment",color:"from-purple-500 to-pink-500",type:"unified",greetingMessage:"Welcome to Unicity Gaming!  I can help you access our games. Ask me what games are available!",backendActivityId:"gaming",quickActions:[{label:"All games",message:"Show me all games"},{label:"Quake",message:"Tell me about Quake"}],contentType:"game"},{id:"sport",name:"P2P Prediction",description:"Sports prediction markets",Icon:Trophy,category:"Prediction",color:"from-emerald-500 to-teal-500",type:"ai-with-sidebar",greetingMessage:"Welcome to the P2P Prediction Marketplace!  Right now I'm only able to help you make predictions on sports games. I can help you check odds, make a prediction and show you what your active predictions are. What are we looking at ? English Premier League ? IPL ? Let me know and we can have some fun.",backendActivityId:"sports",quickActions:[{label:"Basketball",message:"Show me basketball"},{label:"Soccer",message:"Show me soccer"},{label:"Tennis",message:"Show me tennis"},{label:"Cricket",message:"Show me cricket"},{label:"My bets",message:"Show my bets"}],contentType:"match",hasSidebar:!0},{id:"p2p",name:"OTC",description:"Peer-to-peer trading",Icon:ShoppingBag,category:"Trading",color:"from-orange-500 to-red-500",type:"ai-with-sidebar",greetingMessage:"Welcome to OTC Madness! I'll help you navigate the world of over-the-counter crypto trading. Ready to post an offer or browse available deals?",backendActivityId:"p2p",quickActions:[{label:"Buy 20 ALPHA",message:"Buy 20 ALPHA"},{label:"Buy 100 ALPHA",message:"Buy 100 ALPHA"}],contentType:"product",hasSidebar:!0},{id:"merch",name:"Unicity Merch",description:"Merchandise store",Icon:Shirt,category:"Shopping",color:"from-yellow-500 to-orange-500",type:"ai-with-sidebar",greetingMessage:"Welcome to the Merch Store! Check out our exclusive merchandise. What are you looking for today?",backendActivityId:"merch",quickActions:[{label:"All items",message:"Show all merch"},{label:"Mugs",message:"Show mugs"},{label:"T-Shirts",message:"Show t-shirts"}],contentType:"merch",hasSidebar:!0},{id:"casino",name:"Agent Casino",description:"Verifiably Fair",Icon:Dices,category:"Entertainment",color:"from-red-500 to-pink-500",type:"simple-ai",greetingMessage:"Welcome to Agent Casino! Our games are verifiably fair using cryptographic proofs. Ready to try your luck?"},{id:"p2p-sports",name:"P2P Sports",description:"Private Betting",Icon:Trophy,category:"Prediction",color:"from-green-500 to-emerald-500",type:"simple-ai",greetingMessage:"Welcome to P2P Sports! Create private betting pools with friends. What sport interests you?"},{id:"p2p-derivatives",name:"P2P Derivatives",description:"Get Leverage",Icon:TrendingUp,category:"Trading",color:"from-blue-500 to-indigo-500",type:"simple-ai",greetingMessage:"Welcome to P2P Derivatives! Trade with leverage in a peer-to-peer marketplace. What would you like to trade?"},{id:"payday-loans",name:"P2P Payday Loans",description:"Instant approval",Icon:Banknote,category:"Finance",color:"from-lime-500 to-green-500",type:"simple-ai",greetingMessage:"Welcome to P2P Payday Loans! Get instant approval for short-term loans. How can I help you today?"},{id:"crypto-offramp",name:"P2P Crypto Offramp",description:"Convert to cash",Icon:CreditCard,category:"Trading",color:"from-cyan-500 to-blue-500",type:"simple-ai",greetingMessage:"Welcome to P2P Crypto Offramp! Convert your crypto to cash easily. What would you like to sell?"},{id:"fiat-onramp",name:"P2P Fiat Onramp",description:"Convert your cash",Icon:ArrowRightLeft,category:"Trading",color:"from-violet-500 to-purple-500",type:"simple-ai",greetingMessage:"Welcome to P2P Fiat Onramp! Convert your cash to crypto. What currency do you want to buy?"},{id:"friendly-miners",name:"Friendly Miners",description:"Buy hash rate",Icon:Cpu,category:"Mining",color:"from-amber-500 to-orange-500",type:"simple-ai",greetingMessage:"Welcome to Friendly Miners! Purchase hash rate from our network of miners. What are you looking for?"},{id:"buy-anything",name:"Buy Anything",description:"Get product now",Icon:Package,category:"Shopping",color:"from-rose-500 to-red-500",type:"simple-ai",greetingMessage:"Welcome to Buy Anything! Tell me what you're looking for and I'll help you find it."},{id:"sell-anything",name:"Sell Anything",description:"Get a quote",Icon:Tag$1,category:"Shopping",color:"from-teal-500 to-cyan-500",type:"simple-ai",greetingMessage:"Welcome to Sell Anything! Describe what you want to sell and I'll get you a quote."},{id:"get-uct",name:"Get UCT",description:"Get unicity tokens",Icon:Coins,category:"Tokens",color:"from-yellow-400 to-amber-500",type:"simple-ai",greetingMessage:"Welcome! I can help you acquire UCT (Unicity Tokens). How would you like to proceed?"},{id:"p2p-swaps",name:"P2P Swaps",description:"Swap tokens directly",Icon:Repeat,category:"Trading",color:"from-purple-500 to-fuchsia-500",type:"simple-ai",greetingMessage:"Welcome to P2P Swaps! Exchange tokens directly with other users."},{id:"medication",name:"Medication",description:"Health & wellness",Icon:Pill,category:"Health",color:"from-red-500 to-rose-500",type:"simple-ai",greetingMessage:"Welcome to Medication! I can help you with health and wellness information."},{id:"pokemon",name:"Pokemon",description:"Catch em all",Icon:Zap,category:"Entertainment",color:"from-yellow-500 to-red-500",type:"simple-ai",greetingMessage:"Welcome to Pokemon! Ready to start your adventure?"}];function getAgentConfig(y){return agents.find(u=>u.id===y)}function DMChatSection({onModeChange:y}){const u=useNavigate(),{selectedConversation:g,selectConversation:v,deleteConversation:b,startNewConversation:w,messages:E,isLoadingMessages:S,sendMessage:A,isSending:$,messageInput:R,setMessageInput:T,searchQuery:O,setSearchQuery:B,filteredConversations:F,totalUnreadCount:U}=useChat(),[q,J]=reactExports.useState(!1),[ie,oe]=reactExports.useState(!1),[le,de]=reactExports.useState(!1),[fe,ye]=reactExports.useState(!1),we=reactExports.useRef(null),pe=reactExports.useRef(null);reactExports.useEffect(()=>{function j(z){we.current&&!we.current.contains(z.target)&&ye(!1)}return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]),reactExports.useEffect(()=>{!$&&g&&window.innerWidth>=1024&&pe.current?.focus({preventScroll:!0})},[$,g]),reactExports.useEffect(()=>{g&&window.innerWidth>=1024&&setTimeout(()=>{pe.current?.focus({preventScroll:!0})},100)},[g]);const ve=j=>{u(`/agents/${j}`),ye(!1)},he=agents.find(j=>j.id==="chat"),ae=()=>{R.trim()&&A(R)},Q=async j=>!!await w(j);return jsxRuntimeExports.jsxs("div",{className:"bg-white/60 dark:bg-neutral-900/70 backdrop-blur-xl rounded-3xl border border-neutral-200 dark:border-neutral-800/50 overflow-hidden grid grid-cols-1 lg:grid-cols-[auto_1fr] relative lg:shadow-xl dark:lg:shadow-2xl h-full min-h-0 theme-transition",children:[jsxRuntimeExports.jsx("div",{className:"absolute -top-20 -right-20 w-96 h-96 bg-blue-500/5 rounded-full blur-3xl"}),jsxRuntimeExports.jsx("div",{className:"absolute -bottom-20 -left-20 w-96 h-96 bg-purple-500/5 rounded-full blur-3xl"}),jsxRuntimeExports.jsx(DMConversationList,{conversations:F,selectedConversation:g,onSelect:j=>{v(j),J(!1)},onDelete:b,onNewConversation:()=>de(!0),searchQuery:O,onSearchChange:B,isOpen:q,onClose:()=>J(!1),isCollapsed:ie,onCollapse:()=>oe(!0),totalUnreadCount:U,onModeChange:y}),jsxRuntimeExports.jsxs("div",{className:"grid grid-rows-[auto_1fr_auto] z-10 min-w-0 h-full min-h-0",children:[jsxRuntimeExports.jsxs("div",{className:"shrink-0 p-4 border-b border-neutral-200 dark:border-neutral-800/50 flex items-center justify-between bg-linear-to-br from-white/80 dark:from-neutral-900/80 to-neutral-50/40 dark:to-neutral-800/40 backdrop-blur-sm relative z-20 theme-transition",children:[jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-orange-500/5 rounded-tr-full"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[ie&&jsxRuntimeExports.jsx(motion.button,{onClick:()=>oe(!1),className:"hidden lg:flex p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors border border-neutral-200 dark:border-neutral-700/50",whileHover:{scale:1.1},whileTap:{scale:.9},title:"Expand sidebar",children:jsxRuntimeExports.jsx(PanelLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx(motion.button,{onClick:()=>J(!0),className:"lg:hidden p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors border border-neutral-200 dark:border-neutral-700/50",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(Menu,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{ref:we,className:"relative lg:hidden",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>ye(!fe),className:"flex items-center gap-2 active:scale-95 transition-transform",children:[jsxRuntimeExports.jsx("div",{className:`p-2.5 rounded-xl bg-linear-to-br ${he.color}`,children:jsxRuntimeExports.jsx(he.Icon,{className:"w-5 h-5 text-white"})}),jsxRuntimeExports.jsx("span",{className:"text-lg text-neutral-900 dark:text-white font-medium",children:he.name}),jsxRuntimeExports.jsx(ChevronDown,{className:`w-4 h-4 text-neutral-500 dark:text-neutral-400 transition-transform ${fe?"rotate-180":""}`})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:fe&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 mt-2 w-56 bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700/50 rounded-xl shadow-xl overflow-hidden z-50",children:agents.map(j=>jsxRuntimeExports.jsxs("button",{onClick:()=>ve(j.id),className:`w-full flex items-center gap-3 p-3 hover:bg-neutral-100 dark:hover:bg-neutral-800/50 transition-colors ${j.id==="chat"?"bg-neutral-100 dark:bg-neutral-800/80":""}`,children:[jsxRuntimeExports.jsx("div",{className:`p-2 rounded-lg bg-linear-to-br ${j.color}`,children:jsxRuntimeExports.jsx(j.Icon,{className:"w-4 h-4 text-white"})}),jsxRuntimeExports.jsx("span",{className:"text-neutral-900 dark:text-white text-sm",children:j.name})]},j.id))})})]}),jsxRuntimeExports.jsx("div",{className:"hidden lg:flex items-center gap-3",children:g?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(motion.div,{whileHover:{scale:1.05},className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-orange-500 rounded-xl blur-lg opacity-50"}),jsxRuntimeExports.jsx("div",{className:"relative w-12 h-12 rounded-xl bg-linear-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-xl text-white font-medium",children:g.getAvatar()})]}),jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white font-medium",children:g.getDisplayName()})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 flex items-center justify-center border border-neutral-200 dark:border-neutral-700/50",children:jsxRuntimeExports.jsx(MessageCircle,{className:"w-6 h-6 text-neutral-400"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white font-medium",children:"Direct Messages"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Select a conversation to start"})]})]})})]})]}),g?jsxRuntimeExports.jsx(DMMessageList,{messages:E,isLoading:S}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center text-center p-8 min-h-0",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"w-24 h-24 rounded-2xl bg-neutral-100 dark:bg-neutral-800/50 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(MessageCircle,{className:"w-12 h-12 text-neutral-400"})}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"Welcome to Direct Messages"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-400 dark:text-neutral-500 text-sm mt-1",children:"Select a conversation or start a new one"}),jsxRuntimeExports.jsx(motion.button,{onClick:()=>de(!0),className:"mt-4 px-6 py-3 rounded-xl bg-linear-to-r from-orange-500 to-orange-600 text-white font-medium shadow-lg shadow-orange-500/30",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Start New Conversation"})]}),g&&jsxRuntimeExports.jsx("div",{className:"shrink-0 bg-white/95 dark:bg-neutral-900/95 backdrop-blur-sm theme-transition",children:jsxRuntimeExports.jsx(DMChatInput,{ref:pe,value:R,onChange:T,onSend:ae,isSending:$,placeholder:`Message ${g.getDisplayName()}...`})})]}),jsxRuntimeExports.jsx(NewConversationModal,{isOpen:le,onClose:()=>de(!1),onStart:Q})]})}const GroupRole={ADMIN:"ADMIN",MODERATOR:"MODERATOR",MEMBER:"MEMBER"},GroupVisibility={PUBLIC:"PUBLIC",PRIVATE:"PRIVATE"};class Group{id;relayUrl;name;description;picture;visibility;createdAt;updatedAt;memberCount;unreadCount;lastMessageTime;lastMessageText;constructor(u){this.id=u.id,this.relayUrl=u.relayUrl,this.name=u.name,this.description=u.description,this.picture=u.picture,this.visibility=u.visibility||GroupVisibility.PUBLIC,this.createdAt=u.createdAt||Date.now(),this.updatedAt=u.updatedAt,this.memberCount=u.memberCount||0,this.unreadCount=u.unreadCount||0,this.lastMessageTime=u.lastMessageTime||Date.now(),this.lastMessageText=u.lastMessageText||""}getDisplayName(){return this.name||this.id.slice(0,8)+"..."}getAvatar(){return this.name.slice(0,2).toUpperCase()}getFullIdentifier(){return`${this.relayUrl}'${this.id}`}getFormattedLastMessageTime(){const u=new Date(this.lastMessageTime),v=new Date().getTime()-u.getTime();return v<6e4?"now":v<36e5?`${Math.floor(v/6e4)}m`:v<864e5?`${Math.floor(v/36e5)}h`:v<6048e5?`${Math.floor(v/864e5)}d`:u.toLocaleDateString()}toJSON(){return{id:this.id,relayUrl:this.relayUrl,name:this.name,description:this.description,picture:this.picture,visibility:this.visibility,createdAt:this.createdAt,updatedAt:this.updatedAt,memberCount:this.memberCount,unreadCount:this.unreadCount,lastMessageTime:this.lastMessageTime,lastMessageText:this.lastMessageText}}static fromJSON(u){return new Group(u)}}class GroupMessage{id;groupId;content;timestamp;senderPubkey;senderNametag;replyToId;previousIds;metadata;constructor(u){this.id=u.id||v4$1(),this.groupId=u.groupId,this.content=u.content,this.timestamp=u.timestamp||Date.now(),this.senderPubkey=u.senderPubkey,this.senderNametag=u.senderNametag,this.replyToId=u.replyToId,this.previousIds=u.previousIds,this.metadata=u.metadata}getFormattedTime(){return new Date(this.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}getFormattedDate(){const u=new Date(this.timestamp),g=new Date,v=new Date(g);return v.setDate(v.getDate()-1),u.toDateString()===g.toDateString()?"Today":u.toDateString()===v.toDateString()?"Yesterday":u.toLocaleDateString()}getSenderDisplayName(){return this.senderNametag?`@${this.senderNametag.replace("@","")}`:this.senderPubkey.slice(0,8)+"..."}getSenderAvatar(){return(this.senderNametag||this.senderPubkey).slice(0,2).toUpperCase()}toJSON(){return{id:this.id,groupId:this.groupId,content:this.content,timestamp:this.timestamp,senderPubkey:this.senderPubkey,senderNametag:this.senderNametag,replyToId:this.replyToId,previousIds:this.previousIds,metadata:this.metadata}}static fromJSON(u){return new GroupMessage(u)}}class GroupMember{pubkey;groupId;role;nametag;joinedAt;constructor(u){this.pubkey=u.pubkey,this.groupId=u.groupId,this.role=u.role||GroupRole.MEMBER,this.nametag=u.nametag,this.joinedAt=u.joinedAt||Date.now()}getDisplayName(){return this.nametag?`@${this.nametag.replace("@","")}`:this.pubkey.slice(0,8)+"..."}getAvatar(){return(this.nametag||this.pubkey).slice(0,2).toUpperCase()}isAdmin(){return this.role===GroupRole.ADMIN}isModerator(){return this.role===GroupRole.MODERATOR||this.role===GroupRole.ADMIN}toJSON(){return{pubkey:this.pubkey,groupId:this.groupId,role:this.role,nametag:this.nametag,joinedAt:this.joinedAt}}static fromJSON(u){return new GroupMember(u)}}class GroupChatRepository{static instance;constructor(){}static getInstance(){return GroupChatRepository.instance||(GroupChatRepository.instance=new GroupChatRepository),GroupChatRepository.instance}getGroups(){try{const u=localStorage.getItem(STORAGE_KEYS.GROUP_CHAT_GROUPS);return u?JSON.parse(u).map(v=>Group.fromJSON(v)).sort((v,b)=>b.lastMessageTime-v.lastMessageTime):[]}catch(u){return console.error("Failed to parse groups",u),[]}}getGroup(u){return this.getGroups().find(v=>v.id===u)||null}saveGroup(u){const g=this.getGroups(),v=g.findIndex(b=>b.id===u.id);v>=0?g[v]=u:g.push(u),this.saveGroups(g),this.notifyUpdate()}saveGroups(u){localStorage.setItem(STORAGE_KEYS.GROUP_CHAT_GROUPS,JSON.stringify(u.map(g=>g.toJSON())))}deleteGroup(u){const g=this.getGroups().filter(w=>w.id!==u);this.saveGroups(g);const v=this.getAllMessages().filter(w=>w.groupId!==u);this.saveMessages(v);const b=this.getAllMembers().filter(w=>w.groupId!==u);this.saveAllMembers(b),this.notifyUpdate()}updateGroupLastMessage(u,g,v){const b=this.getGroup(u);b&&(b.lastMessageText=g,b.lastMessageTime=v,this.saveGroup(b))}incrementUnreadCount(u){const g=this.getGroup(u);g&&(g.unreadCount+=1,this.saveGroup(g))}markGroupAsRead(u){const g=this.getGroup(u);g&&g.unreadCount>0&&(g.unreadCount=0,this.saveGroup(g))}getTotalUnreadCount(){return this.getGroups().reduce((u,g)=>u+g.unreadCount,0)}getAllMessages(){try{const u=localStorage.getItem(STORAGE_KEYS.GROUP_CHAT_MESSAGES);return u?JSON.parse(u).map(v=>GroupMessage.fromJSON(v)):[]}catch(u){return console.error("Failed to parse group messages",u),[]}}saveMessages(u){localStorage.setItem(STORAGE_KEYS.GROUP_CHAT_MESSAGES,JSON.stringify(u.map(g=>g.toJSON())))}getMessagesForGroup(u){return this.getAllMessages().filter(g=>g.groupId===u).sort((g,v)=>g.timestamp-v.timestamp)}getMessage(u){return this.getAllMessages().find(g=>g.id===u)||null}saveMessage(u){const g=this.getAllMessages(),v=g.findIndex(b=>b.id===u.id);v>=0?g[v]=u:g.push(u),this.saveMessages(g),this.updateGroupLastMessage(u.groupId,u.content.slice(0,100),u.timestamp),this.notifyUpdate()}deleteMessage(u){const g=this.getAllMessages().filter(v=>v.id!==u);this.saveMessages(g),this.notifyUpdate()}getRecentMessageIds(u,g=3){return this.getMessagesForGroup(u).slice(-g).map(v=>v.id.slice(0,8))}getAllMembers(){try{const u=localStorage.getItem(STORAGE_KEYS.GROUP_CHAT_MEMBERS);return u?JSON.parse(u).map(v=>GroupMember.fromJSON(v)):[]}catch(u){return console.error("Failed to parse group members",u),[]}}saveAllMembers(u){localStorage.setItem(STORAGE_KEYS.GROUP_CHAT_MEMBERS,JSON.stringify(u.map(g=>g.toJSON())))}getMembersForGroup(u){return this.getAllMembers().filter(g=>g.groupId===u).sort((g,v)=>g.joinedAt-v.joinedAt)}getMember(u,g){return this.getAllMembers().find(v=>v.groupId===u&&v.pubkey===g)||null}saveMember(u){const g=this.getAllMembers(),v=g.findIndex(w=>w.groupId===u.groupId&&w.pubkey===u.pubkey);v>=0?g[v]=u:g.push(u),this.saveAllMembers(g);const b=this.getGroup(u.groupId);b&&(b.memberCount=this.getMembersForGroup(u.groupId).length,this.saveGroup(b))}removeMember(u,g){const v=this.getAllMembers().filter(w=>!(w.groupId===u&&w.pubkey===g));this.saveAllMembers(v);const b=this.getGroup(u);b&&(b.memberCount=this.getMembersForGroup(u).length,this.saveGroup(b)),this.notifyUpdate()}getProcessedEventIds(){try{const u=localStorage.getItem(STORAGE_KEYS.GROUP_CHAT_PROCESSED_EVENTS);return u?new Set(JSON.parse(u)):new Set}catch(u){return console.error("Failed to parse processed events",u),new Set}}addProcessedEventId(u){const g=this.getProcessedEventIds();g.add(u);const v=Array.from(g);v.length>1e4&&v.splice(0,v.length-1e4),localStorage.setItem(STORAGE_KEYS.GROUP_CHAT_PROCESSED_EVENTS,JSON.stringify(v))}isEventProcessed(u){return this.getProcessedEventIds().has(u)}notifyUpdate(){window.dispatchEvent(new CustomEvent("group-chat-updated"))}clearAllData(){localStorage.removeItem(STORAGE_KEYS.GROUP_CHAT_GROUPS),localStorage.removeItem(STORAGE_KEYS.GROUP_CHAT_MESSAGES),localStorage.removeItem(STORAGE_KEYS.GROUP_CHAT_MEMBERS),localStorage.removeItem(STORAGE_KEYS.GROUP_CHAT_PROCESSED_EVENTS),this.notifyUpdate()}checkAndClearOnRelayChange(u){const g=localStorage.getItem(STORAGE_KEYS.GROUP_CHAT_RELAY_URL);return g&&g!==u?(console.log(` Group chat relay URL changed from ${g} to ${u}, clearing cached data`),this.clearAllData(),localStorage.setItem(STORAGE_KEYS.GROUP_CHAT_RELAY_URL,u),!0):this.getGroups().some(w=>w.relayUrl&&w.relayUrl!==u)?(console.log(` Found groups from different relay, clearing cached data for ${u}`),this.clearAllData(),localStorage.setItem(STORAGE_KEYS.GROUP_CHAT_RELAY_URL,u),!0):(g||localStorage.setItem(STORAGE_KEYS.GROUP_CHAT_RELAY_URL,u),!1)}}const QUERY_KEYS={GROUPS:["groupChat","groups"],MESSAGES:y=>["groupChat","messages",y],MEMBERS:y=>["groupChat","members",y],AVAILABLE_GROUPS:["groupChat","available"],UNREAD_COUNT:["groupChat","unreadCount"]},groupRepository=GroupChatRepository.getInstance(),useGroupChat=()=>{const y=useQueryClient(),{groupChatService:u}=useServices(),[g,v]=reactExports.useState(null),[b,w]=reactExports.useState(""),[E,S]=reactExports.useState(""),[A,$]=reactExports.useState(!1);reactExports.useEffect(()=>{(async()=>{u&&(await u.start(),$(u.getConnectionStatus()))})()},[u]),reactExports.useEffect(()=>{const pe=()=>{y.invalidateQueries({queryKey:QUERY_KEYS.GROUPS}),g&&y.invalidateQueries({queryKey:QUERY_KEYS.MESSAGES(g.id)}),y.invalidateQueries({queryKey:QUERY_KEYS.UNREAD_COUNT})},ve=he=>{const ae=he.detail;g&&ae.groupId===g.id&&(y.invalidateQueries({queryKey:QUERY_KEYS.MESSAGES(g.id)}),groupRepository.markGroupAsRead(g.id)),y.invalidateQueries({queryKey:QUERY_KEYS.GROUPS}),y.invalidateQueries({queryKey:QUERY_KEYS.UNREAD_COUNT})};return window.addEventListener("group-chat-updated",pe),window.addEventListener("group-message-received",ve),()=>{window.removeEventListener("group-chat-updated",pe),window.removeEventListener("group-message-received",ve)}},[y,g]);const R=useQuery({queryKey:QUERY_KEYS.GROUPS,queryFn:()=>groupRepository.getGroups(),staleTime:3e4}),T=useQuery({queryKey:QUERY_KEYS.AVAILABLE_GROUPS,queryFn:async()=>u?u.fetchAvailableGroups():[],staleTime:6e4,enabled:!!u}),O=useQuery({queryKey:QUERY_KEYS.MESSAGES(g?.id||""),queryFn:()=>g?groupRepository.getMessagesForGroup(g.id):[],enabled:!!g,staleTime:1e4}),B=useQuery({queryKey:QUERY_KEYS.MEMBERS(g?.id||""),queryFn:()=>g?groupRepository.getMembersForGroup(g.id):[],enabled:!!g,staleTime:6e4}),F=useQuery({queryKey:QUERY_KEYS.UNREAD_COUNT,queryFn:()=>groupRepository.getTotalUnreadCount(),staleTime:3e4}),U=useMutation({mutationFn:async({groupId:pe,inviteCode:ve})=>{if(!u)throw new Error("Group chat service not available");return u.joinGroup(pe,ve)},onSuccess:(pe,{groupId:ve})=>{y.invalidateQueries({queryKey:QUERY_KEYS.GROUPS}),y.invalidateQueries({queryKey:QUERY_KEYS.AVAILABLE_GROUPS}),y.invalidateQueries({queryKey:QUERY_KEYS.MESSAGES(ve)})}}),q=useMutation({mutationFn:async pe=>{if(!u)throw new Error("Group chat service not available");return u.leaveGroup(pe)},onSuccess:(pe,ve)=>{g?.id===ve&&v(null),y.invalidateQueries({queryKey:QUERY_KEYS.GROUPS}),y.invalidateQueries({queryKey:QUERY_KEYS.AVAILABLE_GROUPS})}}),J=useMutation({mutationFn:async({content:pe,replyToId:ve})=>{if(!g)throw new Error("No group selected");if(!u)throw new Error("Group chat service not available");return!!await u.sendMessage(g.id,pe,ve)},onSuccess:()=>{w(""),y.invalidateQueries({queryKey:QUERY_KEYS.MESSAGES(g?.id||"")}),y.invalidateQueries({queryKey:QUERY_KEYS.GROUPS})}}),ie=reactExports.useCallback(async pe=>{v(pe),pe&&(groupRepository.markGroupAsRead(pe.id),y.invalidateQueries({queryKey:QUERY_KEYS.UNREAD_COUNT}),groupRepository.getMessagesForGroup(pe.id).length===0&&u&&(await u.fetchMessages(pe.id),y.invalidateQueries({queryKey:QUERY_KEYS.MESSAGES(pe.id)})))},[y,u]),oe=reactExports.useCallback(async(pe,ve)=>U.mutateAsync({groupId:pe,inviteCode:ve}),[U]),le=reactExports.useCallback(async pe=>q.mutateAsync(pe),[q]),de=reactExports.useCallback(async(pe,ve)=>pe.trim()?J.mutateAsync({content:pe,replyToId:ve}):!1,[J]),fe=reactExports.useCallback(pe=>{groupRepository.markGroupAsRead(pe),y.invalidateQueries({queryKey:QUERY_KEYS.UNREAD_COUNT})},[y]),ye=reactExports.useCallback(()=>{y.invalidateQueries({queryKey:QUERY_KEYS.AVAILABLE_GROUPS})},[y]),we=reactExports.useMemo(()=>{const pe=R.data||[];if(!E.trim())return pe;const ve=E.toLowerCase();return pe.filter(he=>he.getDisplayName().toLowerCase().includes(ve)||he.description?.toLowerCase().includes(ve)||he.lastMessageText.toLowerCase().includes(ve))},[R.data,E]);return{groups:R.data||[],isLoadingGroups:R.isLoading,selectedGroup:g,selectGroup:ie,joinGroup:oe,leaveGroup:le,availableGroups:T.data||[],isLoadingAvailable:T.isLoading,refreshAvailableGroups:ye,messages:O.data||[],isLoadingMessages:O.isLoading,sendMessage:de,isSending:J.isPending,members:B.data||[],isLoadingMembers:B.isLoading,messageInput:b,setMessageInput:w,totalUnreadCount:F.data||0,markAsRead:fe,searchQuery:E,setSearchQuery:S,filteredGroups:we,isConnected:A}};function GroupItem({group:y,isSelected:u,onClick:g,onLeave:v}){const[b,w]=reactExports.useState(!1),E=reactExports.useRef(null);return reactExports.useEffect(()=>{function S(A){E.current&&!E.current.contains(A.target)&&w(!1)}return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[]),jsxRuntimeExports.jsx(motion.div,{onClick:g,className:`p-3 rounded-xl cursor-pointer transition-all relative group ${u?"bg-linear-to-br from-blue-500/10 to-purple-500/10 border border-blue-500/30":"hover:bg-neutral-100 dark:hover:bg-neutral-800/50 border border-transparent"}`,whileHover:{scale:1.01},whileTap:{scale:.99},children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center text-sm font-medium ${u?"bg-linear-to-br from-blue-500 to-purple-600 text-white":"bg-neutral-200 dark:bg-neutral-700 text-neutral-600 dark:text-neutral-300"}`,children:y.visibility===GroupVisibility.PRIVATE?jsxRuntimeExports.jsx(Lock,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(Hash$2,{className:"w-4 h-4"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:`font-medium truncate ${u?"text-neutral-900 dark:text-white":"text-neutral-700 dark:text-neutral-200"}`,children:y.getDisplayName()}),y.unreadCount>0&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-xs rounded-full bg-blue-500 text-white shrink-0",children:y.unreadCount>99?"99+":y.unreadCount})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate",children:y.lastMessageText||y.description||"No messages yet"})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-end gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-neutral-400 dark:text-neutral-500",children:y.getFormattedLastMessageTime()}),jsxRuntimeExports.jsxs("div",{ref:E,className:"relative",children:[jsxRuntimeExports.jsx("button",{onClick:S=>{S.stopPropagation(),w(!b)},className:"p-1 rounded-lg opacity-0 group-hover:opacity-100 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-all",children:jsxRuntimeExports.jsx(EllipsisVertical,{className:"w-4 h-4 text-neutral-400"})}),b&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"absolute right-0 top-full mt-1 w-32 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-lg shadow-lg overflow-hidden z-50",children:jsxRuntimeExports.jsxs("button",{onClick:S=>{S.stopPropagation(),v(),w(!1)},className:"w-full px-3 py-2 text-left text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2",children:[jsxRuntimeExports.jsx(LogOut,{className:"w-4 h-4"}),"Leave Group"]})})]})]})]})})}function GroupList({groups:y,selectedGroup:u,onSelect:g,onLeave:v,onJoinGroup:b,searchQuery:w,onSearchChange:E,isOpen:S,onClose:A,isCollapsed:$,onCollapse:R,totalUnreadCount:T,onModeChange:O}){return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatePresence,{children:S&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"lg:hidden absolute inset-0 bg-black/50 z-40 rounded-3xl",onClick:A})}),jsxRuntimeExports.jsxs("div",{className:`
        w-72 border-r border-neutral-200 dark:border-neutral-800/50 flex flex-col z-50 overflow-hidden
        absolute lg:relative inset-y-0 left-0 min-h-0
        transform transition-all duration-300 ease-in-out
        ${S?"translate-x-0":"-translate-x-full lg:translate-x-0"}
        ${$?"lg:w-0 lg:border-0 lg:min-w-0":"lg:w-72"}
        bg-white/95 dark:bg-neutral-900/95 lg:bg-transparent backdrop-blur-xl lg:backdrop-blur-none rounded-l-3xl lg:rounded-none
      `,children:[jsxRuntimeExports.jsxs("div",{className:"shrink-0 p-4 border-b border-neutral-200 dark:border-neutral-800/50 bg-linear-to-br from-white/80 dark:from-neutral-900/80 to-neutral-50/40 dark:to-neutral-800/40 backdrop-blur-sm relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-blue-500/5 rounded-bl-full"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3 relative z-10",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white font-medium",children:"Groups"}),jsxRuntimeExports.jsx(Sparkles,{className:"w-4 h-4 text-blue-500 animate-pulse"}),T>0&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-xs rounded-full bg-blue-500 text-white",children:T>99?"99+":T})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(motion.button,{onClick:b,className:"p-2 rounded-lg bg-linear-to-br from-blue-500 to-purple-600 text-white shadow-lg shadow-blue-500/30",title:"Join group",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(motion.button,{onClick:R,className:"hidden lg:flex p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors border border-neutral-200 dark:border-neutral-700/50",title:"Collapse sidebar",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(PanelLeftClose,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(motion.button,{onClick:A,className:"lg:hidden p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors border border-neutral-200 dark:border-neutral-700/50",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2 relative z-10 mb-3",children:[jsxRuntimeExports.jsxs(motion.button,{className:"px-4 py-3 rounded-xl text-sm transition-all relative overflow-hidden bg-linear-to-br from-blue-500 to-purple-600 text-white shadow-lg shadow-blue-500/30",whileHover:{scale:1.02},whileTap:{scale:.98},children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-tr from-white/0 via-white/20 to-white/0"}),jsxRuntimeExports.jsx(Hash$2,{className:"w-4 h-4 inline mr-2"}),jsxRuntimeExports.jsx("span",{className:"relative z-10",children:"Global"})]}),jsxRuntimeExports.jsxs(motion.button,{onClick:()=>O("dm"),className:"px-4 py-3 rounded-xl text-sm transition-all relative overflow-hidden bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 border border-neutral-200 dark:border-neutral-700/50",whileHover:{scale:1.02},whileTap:{scale:.98},children:[jsxRuntimeExports.jsx(User,{className:"w-4 h-4 inline mr-2"}),jsxRuntimeExports.jsx("span",{children:"DM"})]})]}),jsxRuntimeExports.jsxs("div",{className:"relative z-10",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400"}),jsxRuntimeExports.jsx("input",{type:"text",value:w,onChange:B=>E(B.target.value),placeholder:"Search groups...",className:"w-full pl-9 pr-3 py-2 bg-neutral-100 dark:bg-neutral-800/50 text-neutral-900 dark:text-white placeholder-neutral-400 rounded-xl text-sm border border-neutral-200 dark:border-neutral-700/50 focus:outline-none focus:border-blue-500 transition-colors"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:y.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-2xl bg-neutral-100 dark:bg-neutral-800/50 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(Hash$2,{className:"w-8 h-8 text-neutral-400"})}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm",children:"No groups yet"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-400 dark:text-neutral-500 text-xs mt-1",children:"Join a group to start chatting"})]}):jsxRuntimeExports.jsx(AnimatePresence,{mode:"popLayout",children:y.map(B=>jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},layout:!0,children:jsxRuntimeExports.jsx(GroupItem,{group:B,isSelected:u?.id===B.id,onClick:()=>g(B),onLeave:()=>v(B.id)})},B.id))})})]})]})}function getColorFromPubkey(y){const u=["from-blue-500 to-blue-600","from-purple-500 to-purple-600","from-green-500 to-green-600","from-pink-500 to-pink-600","from-indigo-500 to-indigo-600","from-teal-500 to-teal-600","from-cyan-500 to-cyan-600","from-rose-500 to-rose-600"];let g=0;for(let v=0;v<y.length;v++)g=y.charCodeAt(v)+((g<<5)-g);return u[Math.abs(g)%u.length]}function GroupMessageBubble({message:y,isOwnMessage:u,delay:g=0}){const v=getColorFromPubkey(y.senderPubkey);return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:g},className:`flex gap-3 ${u?"flex-row-reverse":""}`,children:[jsxRuntimeExports.jsx("div",{className:`shrink-0 w-8 h-8 rounded-lg bg-linear-to-br ${v} text-white text-xs font-medium flex items-center justify-center shadow-md`,children:y.getSenderAvatar()}),jsxRuntimeExports.jsxs("div",{className:`flex flex-col ${u?"items-end":"items-start"} max-w-[75%]`,children:[jsxRuntimeExports.jsx("span",{className:`text-xs font-medium mb-1 ${u?"text-orange-500":"text-neutral-500 dark:text-neutral-400"}`,children:y.getSenderDisplayName()}),jsxRuntimeExports.jsxs(motion.div,{whileHover:{scale:1.01},className:`rounded-2xl px-4 py-3 relative overflow-hidden ${u?"bg-linear-to-br from-orange-500 to-orange-600 text-white shadow-lg shadow-orange-500/20":"bg-neutral-100 dark:bg-neutral-800/80 backdrop-blur-sm text-neutral-800 dark:text-neutral-100 border border-neutral-200 dark:border-neutral-700/50"}`,children:[u&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-tr from-white/0 via-white/10 to-white/0"}),jsxRuntimeExports.jsx("p",{className:"text-sm leading-relaxed relative z-10 break-words whitespace-pre-wrap",children:y.content})]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1 px-1",children:y.getFormattedTime()})]})]})}function GroupMessageList({messages:y,isLoading:u,myPubkey:g}){const v=reactExports.useRef(null);reactExports.useEffect(()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight)},[y]);const b=[];let w="";return y.forEach(E=>{const S=E.getFormattedDate();S!==w&&(w=S,b.push({date:S,messages:[]})),b[b.length-1].messages.push(E)}),u?jsxRuntimeExports.jsx("div",{className:"flex-1 flex items-center justify-center min-h-0",children:jsxRuntimeExports.jsx(motion.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 text-blue-500"})})}):jsxRuntimeExports.jsxs("div",{ref:v,className:"flex-1 overflow-y-auto px-4 py-4 space-y-6 min-h-0",children:[b.map((E,S)=>jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"px-3 py-1 rounded-full bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 text-xs font-medium",children:E.date})}),E.messages.map((A,$)=>jsxRuntimeExports.jsx(GroupMessageBubble,{message:A,isOwnMessage:A.senderPubkey===g,delay:S===b.length-1?$*.05:0},A.id))]},E.date)),y.length===0&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"No messages yet"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-400 dark:text-neutral-500 text-sm mt-1",children:"Be the first to send a message!"})]})]})}function JoinGroupModal({isOpen:y,onClose:u,availableGroups:g,isLoading:v,onRefresh:b,onJoin:w,initialInviteLink:E}){const[S,A]=reactExports.useState(E?"invite":"browse"),[$,R]=reactExports.useState(""),[T,O]=reactExports.useState(null),[B,F]=reactExports.useState(""),[U,q]=reactExports.useState(""),[J,ie]=reactExports.useState(!1),[oe,le]=reactExports.useState(null),de=g.filter(he=>he.name.toLowerCase().includes($.toLowerCase())||he.description?.toLowerCase().includes($.toLowerCase())),fe=he=>{const ae=he.trim(),Q=ae.indexOf("/");return Q===-1||Q===0||Q===ae.length-1?null:{groupId:ae.substring(0,Q),code:ae.substring(Q+1)}},ye=async()=>{if(T){ie(!0),le(null);try{await w(T,B||void 0)?(u(),O(null),F(""),R("")):le("Failed to join group. Please try again.")}catch{le("An error occurred. Please try again.")}finally{ie(!1)}}},we=async()=>{const he=fe(U);if(!he){le("Invalid invite link format. Expected: groupId/inviteCode");return}ie(!0),le(null);try{await w(he.groupId,he.code)?(u(),q("")):le("Failed to join group. Check your invite link and try again.")}catch{le("An error occurred. Please try again.")}finally{ie(!1)}},pe=g.find(he=>he.id===T),ve=()=>{R(""),O(null),F(""),q(""),le(null)};return reactExports.useEffect(()=>{y&&E&&(A("invite"),q(E))},[y,E]),jsxRuntimeExports.jsx(AnimatePresence,{children:y&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:u,children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:he=>he.stopPropagation(),className:"w-full max-w-md bg-white dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-medium text-neutral-900 dark:text-white",children:"Join Group"}),jsxRuntimeExports.jsx("button",{onClick:u,className:"p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-neutral-500"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-1 p-1 bg-neutral-100 dark:bg-neutral-800 rounded-lg",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>{A("browse"),ve()},className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors ${S==="browse"?"bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white shadow-sm":"text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300"}`,children:[jsxRuntimeExports.jsx(Hash$2,{className:"w-4 h-4"}),"Browse"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{A("invite"),ve()},className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors ${S==="invite"?"bg-white dark:bg-neutral-700 text-neutral-900 dark:text-white shadow-sm":"text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300"}`,children:[jsxRuntimeExports.jsx(Link,{className:"w-4 h-4"}),"Join with Invite"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[S==="browse"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 relative",children:[jsxRuntimeExports.jsx(Hash$2,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400"}),jsxRuntimeExports.jsx("input",{type:"text",value:$,onChange:he=>R(he.target.value),placeholder:"Search groups...",className:"w-full pl-9 pr-3 py-2.5 bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-white placeholder-neutral-400 rounded-xl text-sm border border-neutral-200 dark:border-neutral-700 focus:outline-none focus:border-blue-500 transition-colors"})]}),jsxRuntimeExports.jsx(motion.button,{onClick:b,disabled:v,className:"p-2.5 rounded-xl bg-neutral-100 dark:bg-neutral-800 text-neutral-500 hover:text-neutral-900 dark:hover:text-white border border-neutral-200 dark:border-neutral-700 transition-colors disabled:opacity-50",whileHover:{scale:1.05},whileTap:{scale:.95},children:jsxRuntimeExports.jsx(RefreshCw,{className:`w-5 h-5 ${v?"animate-spin":""}`})})]}),jsxRuntimeExports.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2",children:v&&de.length===0?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-8",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 text-blue-500 animate-spin"})}):de.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-8 text-neutral-500 dark:text-neutral-400",children:[jsxRuntimeExports.jsx("p",{children:"No groups found"}),jsxRuntimeExports.jsx("p",{className:"text-sm mt-1",children:"Try refreshing or check back later"})]}):de.map(he=>jsxRuntimeExports.jsx(motion.button,{onClick:()=>O(he.id),className:`w-full p-3 rounded-xl text-left transition-all ${T===he.id?"bg-blue-500/10 border-2 border-blue-500":"bg-neutral-50 dark:bg-neutral-800/50 border-2 border-transparent hover:border-neutral-200 dark:hover:border-neutral-700"}`,whileHover:{scale:1.01},whileTap:{scale:.99},children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${T===he.id?"bg-blue-500 text-white":"bg-neutral-200 dark:bg-neutral-700 text-neutral-500 dark:text-neutral-400"}`,children:he.visibility===GroupVisibility.PRIVATE?jsxRuntimeExports.jsx(Lock,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(Hash$2,{className:"w-4 h-4"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-neutral-900 dark:text-white truncate",children:he.name}),he.memberCount!==void 0&&jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1 text-xs text-neutral-500",children:[jsxRuntimeExports.jsx(Users,{className:"w-3 h-3"}),he.memberCount]})]}),he.description&&jsxRuntimeExports.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400 truncate mt-0.5",children:he.description})]})]})},he.id))}),pe?.visibility===GroupVisibility.PRIVATE&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Invite Code"}),jsxRuntimeExports.jsx("input",{type:"text",value:B,onChange:he=>F(he.target.value),placeholder:"Enter invite code...",className:"w-full px-3 py-2.5 bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-white placeholder-neutral-400 rounded-xl text-sm border border-neutral-200 dark:border-neutral-700 focus:outline-none focus:border-blue-500 transition-colors"})]})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"text-center py-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 mx-auto mb-3 rounded-full bg-blue-500/10 flex items-center justify-center",children:jsxRuntimeExports.jsx(Lock,{className:"w-6 h-6 text-blue-500"})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Enter the invite link shared by the group admin"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Invite Link"}),jsxRuntimeExports.jsx("input",{type:"text",value:U,onChange:he=>{q(he.target.value),le(null)},placeholder:"groupId/inviteCode",className:"w-full px-3 py-2.5 bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-white placeholder-neutral-400 rounded-xl text-sm border border-neutral-200 dark:border-neutral-700 focus:outline-none focus:border-blue-500 transition-colors font-mono"}),jsxRuntimeExports.jsx("p",{className:"mt-1.5 text-xs text-neutral-400",children:"Format: groupId/inviteCode"})]})]}),oe&&jsxRuntimeExports.jsx("p",{className:"text-sm text-red-500 text-center",children:oe})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t border-neutral-200 dark:border-neutral-800 flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:u,className:"flex-1 py-2.5 rounded-xl bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 font-medium hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors",children:"Cancel"}),S==="browse"?jsxRuntimeExports.jsx(motion.button,{onClick:ye,disabled:!T||J,className:"flex-1 py-2.5 rounded-xl bg-linear-to-r from-blue-500 to-purple-600 text-white font-medium disabled:opacity-50 flex items-center justify-center gap-2",whileHover:{scale:1.02},whileTap:{scale:.98},children:J?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}),"Joining..."]}):"Join Group"}):jsxRuntimeExports.jsx(motion.button,{onClick:we,disabled:!U.trim()||J,className:"flex-1 py-2.5 rounded-xl bg-linear-to-r from-blue-500 to-purple-600 text-white font-medium disabled:opacity-50 flex items-center justify-center gap-2",whileHover:{scale:1.02},whileTap:{scale:.98},children:J?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}),"Joining..."]}):"Join with Invite"})]})]})})})}function GroupChatSection({onModeChange:y}){const u=useNavigate(),[g,v]=useSearchParams(),{selectedGroup:b,selectGroup:w,leaveGroup:E,joinGroup:S,filteredGroups:A,availableGroups:$,isLoadingAvailable:R,refreshAvailableGroups:T,messages:O,isLoadingMessages:B,sendMessage:F,isSending:U,messageInput:q,setMessageInput:J,searchQuery:ie,setSearchQuery:oe,totalUnreadCount:le,isConnected:de}=useGroupChat(),[fe,ye]=reactExports.useState(!1),[we,pe]=reactExports.useState(!1),[ve,he]=reactExports.useState(!1),[ae,Q]=reactExports.useState(!1),[j,z]=reactExports.useState(null),re=reactExports.useRef(null),Y=reactExports.useRef(null);reactExports.useEffect(()=>{const Re=g.get("join");Re&&(z(Re),he(!0),v(Ae=>(Ae.delete("join"),Ae)))},[g,v]);const{groupChatService:te}=useServices(),ne=te?.getMyPublicKey()||null;reactExports.useEffect(()=>{function Re(Ae){re.current&&!re.current.contains(Ae.target)&&Q(!1)}return document.addEventListener("mousedown",Re),()=>document.removeEventListener("mousedown",Re)},[]),reactExports.useEffect(()=>{!U&&b&&window.innerWidth>=1024&&Y.current?.focus({preventScroll:!0})},[U,b]),reactExports.useEffect(()=>{b&&window.innerWidth>=1024&&setTimeout(()=>{Y.current?.focus({preventScroll:!0})},100)},[b]);const se=Re=>{u(`/agents/${Re}`),Q(!1)},ee=agents.find(Re=>Re.id==="chat"),Z=()=>{q.trim()&&F(q)},ue=async(Re,Ae)=>{const ge=await S(Re,Ae);if(ge){const be=$.find(Te=>Te.id===Re);be&&w(be)}return ge},_e=async Re=>{await E(Re)};return jsxRuntimeExports.jsxs("div",{className:"bg-white/60 dark:bg-neutral-900/70 backdrop-blur-xl rounded-3xl border border-neutral-200 dark:border-neutral-800/50 overflow-hidden grid grid-cols-1 lg:grid-cols-[auto_1fr] relative lg:shadow-xl dark:lg:shadow-2xl h-full min-h-0 theme-transition",children:[jsxRuntimeExports.jsx("div",{className:"absolute -top-20 -right-20 w-96 h-96 bg-blue-500/5 rounded-full blur-3xl"}),jsxRuntimeExports.jsx("div",{className:"absolute -bottom-20 -left-20 w-96 h-96 bg-purple-500/5 rounded-full blur-3xl"}),jsxRuntimeExports.jsx(GroupList,{groups:A,selectedGroup:b,onSelect:Re=>{w(Re),ye(!1)},onLeave:_e,onJoinGroup:()=>he(!0),searchQuery:ie,onSearchChange:oe,isOpen:fe,onClose:()=>ye(!1),isCollapsed:we,onCollapse:()=>pe(!0),totalUnreadCount:le,onModeChange:y}),jsxRuntimeExports.jsxs("div",{className:"grid grid-rows-[auto_1fr_auto] z-10 min-w-0 h-full min-h-0",children:[jsxRuntimeExports.jsxs("div",{className:"shrink-0 p-4 border-b border-neutral-200 dark:border-neutral-800/50 flex items-center justify-between bg-linear-to-br from-white/80 dark:from-neutral-900/80 to-neutral-50/40 dark:to-neutral-800/40 backdrop-blur-sm relative z-20 theme-transition",children:[jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-blue-500/5 rounded-tr-full"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[we&&jsxRuntimeExports.jsx(motion.button,{onClick:()=>pe(!1),className:"hidden lg:flex p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors border border-neutral-200 dark:border-neutral-700/50",whileHover:{scale:1.1},whileTap:{scale:.9},title:"Expand sidebar",children:jsxRuntimeExports.jsx(PanelLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx(motion.button,{onClick:()=>ye(!0),className:"lg:hidden p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors border border-neutral-200 dark:border-neutral-700/50",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(Menu,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{ref:re,className:"relative lg:hidden",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>Q(!ae),className:"flex items-center gap-2 active:scale-95 transition-transform",children:[jsxRuntimeExports.jsx("div",{className:`p-2.5 rounded-xl bg-linear-to-br ${ee.color}`,children:jsxRuntimeExports.jsx(ee.Icon,{className:"w-5 h-5 text-white"})}),jsxRuntimeExports.jsx("span",{className:"text-lg text-neutral-900 dark:text-white font-medium",children:ee.name}),jsxRuntimeExports.jsx(ChevronDown,{className:`w-4 h-4 text-neutral-500 dark:text-neutral-400 transition-transform ${ae?"rotate-180":""}`})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:ae&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 mt-2 w-56 bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700/50 rounded-xl shadow-xl overflow-hidden z-50",children:agents.map(Re=>jsxRuntimeExports.jsxs("button",{onClick:()=>se(Re.id),className:`w-full flex items-center gap-3 p-3 hover:bg-neutral-100 dark:hover:bg-neutral-800/50 transition-colors ${Re.id==="chat"?"bg-neutral-100 dark:bg-neutral-800/80":""}`,children:[jsxRuntimeExports.jsx("div",{className:`p-2 rounded-lg bg-linear-to-br ${Re.color}`,children:jsxRuntimeExports.jsx(Re.Icon,{className:"w-4 h-4 text-white"})}),jsxRuntimeExports.jsx("span",{className:"text-neutral-900 dark:text-white text-sm",children:Re.name})]},Re.id))})})]}),jsxRuntimeExports.jsx("div",{className:"hidden lg:flex items-center gap-3",children:b?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(motion.div,{whileHover:{scale:1.05},className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-blue-500 rounded-xl blur-lg opacity-50"}),jsxRuntimeExports.jsx("div",{className:"relative w-12 h-12 rounded-xl bg-linear-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-xl text-white font-medium",children:jsxRuntimeExports.jsx(Hash$2,{className:"w-6 h-6"})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white font-medium",children:b.getDisplayName()}),b.memberCount!==void 0&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-neutral-500 dark:text-neutral-400 flex items-center gap-1",children:[jsxRuntimeExports.jsx(Users,{className:"w-3 h-3"}),b.memberCount," members"]})]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 flex items-center justify-center border border-neutral-200 dark:border-neutral-700/50",children:jsxRuntimeExports.jsx(Hash$2,{className:"w-6 h-6 text-neutral-400"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white font-medium",children:"Group Chat"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:de?"Select a group to start":"Connecting..."})]})]})})]})]}),b?jsxRuntimeExports.jsx(GroupMessageList,{messages:O,isLoading:B,myPubkey:ne}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center text-center p-8 min-h-0",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"w-24 h-24 rounded-2xl bg-neutral-100 dark:bg-neutral-800/50 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(Hash$2,{className:"w-12 h-12 text-neutral-400"})}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"Welcome to Group Chat"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-400 dark:text-neutral-500 text-sm mt-1",children:"Select a group or join a new one"}),jsxRuntimeExports.jsx(motion.button,{onClick:()=>he(!0),className:"mt-4 px-6 py-3 rounded-xl bg-linear-to-r from-blue-500 to-purple-600 text-white font-medium shadow-lg shadow-blue-500/30",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Browse Groups"})]}),b&&jsxRuntimeExports.jsx("div",{className:"shrink-0 bg-white/95 dark:bg-neutral-900/95 backdrop-blur-sm theme-transition",children:jsxRuntimeExports.jsx(DMChatInput,{ref:Y,value:q,onChange:J,onSend:Z,isSending:U,placeholder:`Message #${b.getDisplayName()}...`})})]}),jsxRuntimeExports.jsx(JoinGroupModal,{isOpen:ve,onClose:()=>{he(!1),z(null)},availableGroups:$,isLoading:R,onRefresh:T,onJoin:ue,initialInviteLink:j||void 0})]})}function ChatSection(){const[y,u]=reactExports.useState("dm"),g=v=>{u(v)};return y==="dm"?jsxRuntimeExports.jsx(DMChatSection,{onModeChange:g}):jsxRuntimeExports.jsx(GroupChatSection,{onModeChange:g})}function ChatHeader({agent:y,rightContent:u,onToggleSidebar:g,onExpandSidebar:v,showMenuButton:b,sidebarCollapsed:w}){const E=useNavigate(),[S,A]=reactExports.useState(!1),$=reactExports.useRef(null);reactExports.useEffect(()=>{function T(O){$.current&&!$.current.contains(O.target)&&A(!1)}return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[]);const R=T=>{E(`/agents/${T}`),A(!1)};return jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800/50 relative z-20 theme-transition",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[b&&w&&v&&jsxRuntimeExports.jsx(motion.button,{onClick:v,className:"hidden lg:block p-2 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors border border-neutral-200 dark:border-neutral-700/50",whileHover:{scale:1.05},whileTap:{scale:.95},title:"Expand sidebar",children:jsxRuntimeExports.jsx(PanelLeft,{className:"w-5 h-5"})}),b&&g&&jsxRuntimeExports.jsx(motion.button,{onClick:g,className:"lg:hidden p-2 rounded-xl bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors border border-neutral-200 dark:border-neutral-700/50",whileHover:{scale:1.05},whileTap:{scale:.95},children:jsxRuntimeExports.jsx(Menu,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{ref:$,className:"relative lg:hidden",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>A(!S),className:"flex items-center gap-2 active:scale-95 transition-transform",children:[jsxRuntimeExports.jsx("div",{className:`p-2.5 rounded-xl bg-linear-to-br ${y.color}`,children:jsxRuntimeExports.jsx(y.Icon,{className:"w-5 h-5 text-white"})}),jsxRuntimeExports.jsx("span",{className:"text-lg text-neutral-900 dark:text-white font-medium",children:y.name}),jsxRuntimeExports.jsx(ChevronDown,{className:`w-4 h-4 text-neutral-500 dark:text-neutral-400 transition-transform ${S?"rotate-180":""}`})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:S&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 mt-2 w-56 bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700/50 rounded-xl shadow-xl overflow-hidden",children:agents.map(T=>jsxRuntimeExports.jsxs("button",{onClick:()=>R(T.id),className:`w-full flex items-center gap-3 p-3 hover:bg-neutral-100 dark:hover:bg-neutral-800/50 transition-colors ${T.id===y.id?"bg-neutral-100 dark:bg-neutral-800/80":""}`,children:[jsxRuntimeExports.jsx("div",{className:`p-2 rounded-lg bg-linear-to-br ${T.color}`,children:jsxRuntimeExports.jsx(T.Icon,{className:"w-4 h-4 text-white"})}),jsxRuntimeExports.jsx("span",{className:"text-neutral-900 dark:text-white text-sm",children:T.name})]},T.id))})})]}),jsxRuntimeExports.jsxs("div",{className:"hidden lg:flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`p-2.5 rounded-xl bg-linear-to-br ${y.color}`,children:jsxRuntimeExports.jsx(y.Icon,{className:"w-5 h-5 text-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-lg text-neutral-900 dark:text-white font-medium",children:y.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:y.description})]})]})]}),u&&jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:u})]})})}function CodeBlock({code:y,language:u,keyPrefix:g}){const[v,b]=reactExports.useState(!1),w=async()=>{await navigator.clipboard.writeText(y),b(!0),setTimeout(()=>b(!1),2e3)};return jsxRuntimeExports.jsxs("div",{className:"relative group my-3 rounded-xl overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-neutral-200 dark:bg-neutral-800 border-b border-neutral-300 dark:border-neutral-700",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 font-mono",children:u||"code"}),jsxRuntimeExports.jsx("button",{onClick:w,className:"flex items-center gap-1.5 text-xs text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white transition-colors",children:v?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Check,{className:"w-3.5 h-3.5 text-green-400"}),jsxRuntimeExports.jsx("span",{className:"text-green-400",children:"Copied!"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Copy,{className:"w-3.5 h-3.5"}),jsxRuntimeExports.jsx("span",{children:"Copy"})]})})]}),jsxRuntimeExports.jsx("pre",{className:"p-4 bg-neutral-100 dark:bg-neutral-900 overflow-x-auto",children:jsxRuntimeExports.jsx("code",{className:"text-sm text-neutral-800 dark:text-neutral-200 font-mono whitespace-pre",children:y})})]},g)}function MathBlock({latex:y,displayMode:u,keyPrefix:g}){const[v,b]=reactExports.useState(null),[w,E]=reactExports.useState("");return React.useEffect(()=>{try{__vitePreload(()=>import("./katex-XbL3y5x-.js"),[]).then(S=>{const A=S.default.renderToString(y,{displayMode:u,throwOnError:!1,errorColor:"#ef4444",strict:!1,trust:!1});E(A),b(null)}).catch(S=>{b(S instanceof Error?S.message:"Failed to load KaTeX")})}catch(S){b(S instanceof Error?S.message:"Failed to render LaTeX")}},[y,u]),v?jsxRuntimeExports.jsx("div",{className:`my-2 p-3 rounded-lg border-2 border-red-400 dark:border-red-600 bg-red-50 dark:bg-red-900/20 ${u?"block":"inline-block"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-red-600 dark:text-red-400 font-mono",children:""}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("div",{className:"text-red-700 dark:text-red-300 font-semibold mb-1",children:"LaTeX Error"}),jsxRuntimeExports.jsx("pre",{className:"text-xs text-neutral-600 dark:text-neutral-400 font-mono overflow-x-auto",children:y}),v&&jsxRuntimeExports.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:v})]})]})},g):jsxRuntimeExports.jsx("div",{className:`my-2 ${u?"text-center overflow-x-auto":"inline"}`,dangerouslySetInnerHTML:{__html:w},role:"math","aria-label":`Math formula: ${y}`},g)}function replaceMathPlaceholders(y,u,g,v){const b="\0MATH",w=[],E=new RegExp(`${b}(\\d+)\0`,"g");let S=0,A,$=v;for(;(A=E.exec(y))!==null;){A.index>S&&w.push(y.slice(S,A.index));const R=parseInt(A[1],10);w.push(jsxRuntimeExports.jsx(MathBlock,{latex:u[R],displayMode:!1,keyPrefix:`math-inline-${$}`},`${g}-math-${$++}`)),S=A.index+A[0].length}return S<y.length&&w.push(y.slice(S)),w.length>0?w:[y]}function parseInline(y,u){const g=y.replace(/\\([*_`[\]()#+-.|!\\])/g,"$1"),v=[],b="\0MATH",w=g.replace(new RegExp("(?<!\\\\)((?:\\\\\\\\)*)\\\\\\((.+?)\\\\\\)","g"),(T,O,B)=>{if(O&&O.length%2===1)return T.slice(1);const F=v.push(B)-1;return`${b}${F}\0`}),E=[];let S=0;const A=/(\*\*(.+?)\*\*|\*([^\s*](?:[^*]*[^\s*])?)\*|_([^_]+?)_|`([^`]+?)`|<br\s*\/?>|<b>(.+?)<\/b>|<strong>(.+?)<\/strong>|<i>(.+?)<\/i>|<em>(.+?)<\/em>|<code>(.+?)<\/code>|<a\s+href=["']([^"']+)["']>(.+?)<\/a>|\[([^\]]+)\]\(((?:[^\s()]|\([^\s)]*\))+)(?:\s+"([^"]+)")?\)|!\[([^\]]*)\]\(((?:[^()]|\([^)]*\))+)\)|(https?:\/\/[^\s<>[\]()]+[^\s<>[\]().,;:!?'"]))/gi;let $=0,R;for(;(R=A.exec(w))!==null;){if(R.index>$){const T=w.slice($,R.index);E.push(...replaceMathPlaceholders(T,v,u,S)),S+=v.length}if(R[2]){const T=replaceMathPlaceholders(R[2],v,`${u}-bold`,S);E.push(jsxRuntimeExports.jsx("strong",{children:T},`${u}-strong-${S++}`))}else if(R[3]){const T=replaceMathPlaceholders(R[3],v,`${u}-italic`,S);E.push(jsxRuntimeExports.jsx("em",{children:T},`${u}-em-${S++}`))}else if(R[4]){const T=replaceMathPlaceholders(R[4],v,`${u}-italic2`,S);E.push(jsxRuntimeExports.jsx("em",{children:T},`${u}-em2-${S++}`))}else if(R[5])E.push(jsxRuntimeExports.jsx("code",{className:"bg-neutral-200 dark:bg-neutral-700/50 text-neutral-900 dark:text-neutral-200 px-1.5 py-0.5 rounded text-sm font-mono",children:R[5]},`${u}-code-${S++}`));else if(R[0].toLowerCase().startsWith("<br"))E.push(jsxRuntimeExports.jsx("br",{},`${u}-br-${S++}`));else if(R[6]){const T=replaceMathPlaceholders(R[6],v,`${u}-b`,S);E.push(jsxRuntimeExports.jsx("strong",{children:T},`${u}-b-${S++}`))}else if(R[7]){const T=replaceMathPlaceholders(R[7],v,`${u}-strong`,S);E.push(jsxRuntimeExports.jsx("strong",{children:T},`${u}-strong2-${S++}`))}else if(R[8]){const T=replaceMathPlaceholders(R[8],v,`${u}-i`,S);E.push(jsxRuntimeExports.jsx("em",{children:T},`${u}-i-${S++}`))}else if(R[9]){const T=replaceMathPlaceholders(R[9],v,`${u}-em`,S);E.push(jsxRuntimeExports.jsx("em",{children:T},`${u}-em3-${S++}`))}else if(R[10])E.push(jsxRuntimeExports.jsx("code",{className:"bg-neutral-200 dark:bg-neutral-700/50 text-neutral-900 dark:text-neutral-200 px-1.5 py-0.5 rounded text-sm font-mono",children:R[10]},`${u}-code2-${S++}`));else if(R[11]&&R[12]){const T=replaceMathPlaceholders(R[12],v,`${u}-a`,S);E.push(jsxRuntimeExports.jsx("a",{href:R[11],target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 underline",children:T},`${u}-a-${S++}`))}else if(R[13]&&R[14]){const T=replaceMathPlaceholders(R[13],v,`${u}-link`,S),O=R[15];E.push(jsxRuntimeExports.jsx("a",{href:R[14],target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 underline",title:O||void 0,children:T},`${u}-link-${S++}`))}else if(R[17]){const T=R[16]||"image",O=R[17];E.push(jsxRuntimeExports.jsx("img",{src:O,alt:T,className:"max-w-full h-auto rounded-lg my-2 border border-neutral-300 dark:border-neutral-700/50",loading:"lazy"},`${u}-img-${S++}`))}else if(R[18]){const T=R[18];E.push(jsxRuntimeExports.jsx("a",{href:T,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 underline break-all",children:T},`${u}-url-${S++}`))}$=R.index+R[0].length}if($<w.length){const T=w.slice($);E.push(...replaceMathPlaceholders(T,v,u,S))}return E.length>0?E:[y]}function splitTableRow(y){const u=[];let g="",v=!1,b=!1,w=0,E=!1;for(let S=0;S<y.length;S++){const A=y[S];if(b){g+=A,b=!1;continue}if(A==="\\"){b=!0,g+=A;continue}if(A==="["){w++,g+=A;continue}if(A==="]"&&w>0){w--,g+=A,w===0&&S+1<y.length&&y[S+1]==="("&&(E=!0);continue}if(A==='"'&&(E||v)){v=!v,g+=A;continue}if(A===")"&&E&&!v){E=!1,g+=A;continue}if(A==="|"&&!v&&w===0&&!E){u.push(g),g="";continue}g+=A}return(g||y.endsWith("|"))&&u.push(g),u.slice(1,-1).map(S=>S.trim())}function parseTable(y,u){const g=y.filter(w=>!w.match(/^\|[\s-:|]+\|$/)).map(w=>splitTableRow(w));if(g.length===0)return null;const[v,...b]=g;return jsxRuntimeExports.jsx("div",{className:"overflow-x-auto my-2",children:jsxRuntimeExports.jsxs("table",{className:"w-full text-sm border-collapse",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsx("tr",{className:"border-b border-neutral-300 dark:border-neutral-600",children:v.map((w,E)=>jsxRuntimeExports.jsx("th",{className:"text-left p-2 font-semibold text-neutral-800 dark:text-neutral-200",children:parseInline(w,`${u}-th-${E}`)},E))})}),jsxRuntimeExports.jsx("tbody",{children:b.map((w,E)=>jsxRuntimeExports.jsx("tr",{className:"border-b border-neutral-200 dark:border-neutral-700/50 hover:bg-neutral-100 dark:hover:bg-neutral-700/20",children:w.map((S,A)=>jsxRuntimeExports.jsx("td",{className:"p-2 text-neutral-700 dark:text-neutral-300",children:parseInline(S,`${u}-td-${E}-${A}`)},A))},E))})]})},u)}function parseHeader(y,u){const g=y.match(/^(#{1,6})\s+(.+)$/);if(!g)return null;const v=g[1].length,b=g[2],w={1:"text-2xl font-bold text-neutral-900 dark:text-white mt-4 mb-2",2:"text-xl font-bold text-neutral-900 dark:text-white mt-3 mb-2",3:"text-lg font-semibold text-neutral-800 dark:text-neutral-100 mt-3 mb-1",4:"text-base font-semibold text-neutral-700 dark:text-neutral-200 mt-2 mb-1",5:"text-sm font-semibold text-neutral-600 dark:text-neutral-300 mt-2 mb-1",6:"text-sm font-medium text-neutral-500 dark:text-neutral-400 mt-2 mb-1"},E=parseInline(b,`${u}-h`);switch(v){case 1:return jsxRuntimeExports.jsx("h1",{className:w[1],children:E},u);case 2:return jsxRuntimeExports.jsx("h2",{className:w[2],children:E},u);case 3:return jsxRuntimeExports.jsx("h3",{className:w[3],children:E},u);case 4:return jsxRuntimeExports.jsx("h4",{className:w[4],children:E},u);case 5:return jsxRuntimeExports.jsx("h5",{className:w[5],children:E},u);case 6:return jsxRuntimeExports.jsx("h6",{className:w[6],children:E},u);default:return jsxRuntimeExports.jsx("p",{className:w[1],children:E},u)}}function MarkdownContent({text:y}){const u=[];let g=0;const v=y.split(`
`);let b=0;for(;b<v.length;){const w=v[b];if(w.includes("\\[")){const S=w.match(/\\\\?\[/);if(S&&S[0]==="\\["){const A=w.slice(0,S.index),$=w.slice(S.index+2);A.trim()&&u.push(jsxRuntimeExports.jsx("p",{className:"leading-relaxed",children:parseInline(A,`line-${g}`)},`p-${g++}`));const R=[];let T=$,O=!1;for(;b<v.length;){const B=T.match(/\\\\?\]/);if(B&&B[0]==="\\]"){R.push(T.slice(0,B.index));const F=T.slice(B.index+2);O=!0;const U=R.join(`
`).trim();u.push(jsxRuntimeExports.jsx(MathBlock,{latex:U,displayMode:!0,keyPrefix:`mathblock-${g}`},`math-${g++}`)),F.trim()&&u.push(jsxRuntimeExports.jsx("p",{className:"leading-relaxed",children:parseInline(F,`line-${g}`)},`p-${g++}`)),b++;break}else if(R.push(T),b++,b<v.length)T=v[b];else{O=!1;break}}if(!O){const B="\\["+R.join(`
`);u.push(jsxRuntimeExports.jsx("p",{className:"leading-relaxed",children:parseInline(B,`line-${g}`)},`p-${g++}`))}continue}else if(S&&S[0]==="\\\\["){const A=w.replace("\\\\[","\\[");u.push(jsxRuntimeExports.jsx("p",{className:"leading-relaxed",children:parseInline(A,`line-${g}`)},`p-${g++}`)),b++;continue}}if(w.trim().startsWith("```")){const S=w.trim().slice(3).trim(),A=[];for(b++;b<v.length&&!v[b].trim().startsWith("```");)A.push(v[b]),b++;b++;const $=A.join(`
`);u.push(jsxRuntimeExports.jsx(CodeBlock,{code:$,language:S,keyPrefix:`codeblock-${g}`},`code-${g++}`));continue}if(w.trim().match(/^#{1,6}\s+/)){const S=parseHeader(w.trim(),`header-${g++}`);if(S){u.push(S),b++;continue}}if(w.trim().match(/^([-*_])\1{2,}$/)){u.push(jsxRuntimeExports.jsx("hr",{className:"my-4 border-t border-neutral-300 dark:border-neutral-700"},`hr-${g++}`)),b++;continue}if(w.trim().startsWith("|")&&w.trim().endsWith("|")){const S=[];for(;b<v.length&&v[b].trim().startsWith("|")&&v[b].trim().endsWith("|");)S.push(v[b]),b++;S.length>=2&&u.push(parseTable(S,`table-${g++}`));continue}if(w.match(/^(\s*)([*-])\s+(.*)$/)){const S=[];for(;b<v.length;){const A=v[b].match(/^(\s*)([*-])\s+(.*)$/);if(A)S.push({content:A[3]}),b++;else break}S.length>0&&u.push(jsxRuntimeExports.jsx("ul",{className:"list-disc list-inside space-y-1 ml-1",children:S.map((A,$)=>jsxRuntimeExports.jsx("li",{className:"text-neutral-800 dark:text-neutral-200",children:parseInline(A.content,`li-${g}-${$}`)},$))},`ul-${g++}`));continue}if(w.trim()===""){u.push(jsxRuntimeExports.jsx("div",{className:"h-2"},`space-${g++}`)),b++;continue}u.push(jsxRuntimeExports.jsx("p",{className:"leading-relaxed",children:parseInline(w,`line-${g}`)},`p-${g++}`)),b++}return jsxRuntimeExports.jsx("div",{className:"space-y-1",children:u})}function AnimatedDots({color:y}){return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("div",{className:`w-1.5 h-1.5 ${y} rounded-full animate-bounce`}),jsxRuntimeExports.jsx("div",{className:`w-1.5 h-1.5 ${y} rounded-full animate-bounce`,style:{animationDelay:"0.1s"}}),jsxRuntimeExports.jsx("div",{className:`w-1.5 h-1.5 ${y} rounded-full animate-bounce`,style:{animationDelay:"0.2s"}})]})}function ChatBubble({role:y,content:u,agentName:g,agentColor:v,thinking:b,showCopy:w=!1,isCopied:E=!1,onCopy:S,children:A,isStreaming:$=!1,currentStatus:R=null}){const T=O=>O.includes("indigo")?"bg-indigo-500":O.includes("emerald")||O.includes("teal")?"bg-emerald-500":O.includes("orange")||O.includes("red")?"bg-orange-500":O.includes("purple")||O.includes("pink")?"bg-purple-500":"bg-indigo-500";return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`flex ${y==="user"?"justify-end":"justify-start"}`,children:jsxRuntimeExports.jsxs("div",{className:`max-w-[85%] rounded-2xl p-4 ${y==="user"?`bg-linear-to-br ${v} text-white shadow-lg`:"bg-neutral-100 dark:bg-neutral-800/80 backdrop-blur-xl border border-neutral-200 dark:border-neutral-700/50 text-neutral-800 dark:text-neutral-200"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[y==="assistant"&&jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded-full bg-linear-to-br ${v} flex items-center justify-center`,children:jsxRuntimeExports.jsx(Sparkles,{className:"w-2.5 h-2.5 text-white"})}),jsxRuntimeExports.jsx("span",{className:`text-xs ${y==="user"?"text-white/80":"text-neutral-500 dark:text-neutral-400"}`,children:y==="user"?"You":g})]}),y==="assistant"&&($||b)&&jsxRuntimeExports.jsx("div",{className:"mb-2",children:jsxRuntimeExports.jsxs("details",{className:"group",children:[jsxRuntimeExports.jsxs("summary",{className:"flex items-center gap-2 text-xs text-neutral-400 dark:text-neutral-500 cursor-pointer list-none",children:[$&&jsxRuntimeExports.jsx(AnimatedDots,{color:T(v)}),jsxRuntimeExports.jsx("span",{children:R||"Thinking..."}),b&&jsxRuntimeExports.jsx("span",{className:"text-neutral-300 dark:text-neutral-600 ml-1",children:""})]}),b&&jsxRuntimeExports.jsx("div",{className:"mt-2 pl-1",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-neutral-400 dark:text-neutral-500 italic leading-relaxed",children:b})})]})}),u&&u.trim()&&jsxRuntimeExports.jsx("div",{className:"leading-relaxed",children:jsxRuntimeExports.jsx(MarkdownContent,{text:u})}),A,w&&y==="assistant"&&u&&S&&jsxRuntimeExports.jsx("button",{onClick:S,className:"mt-3 flex items-center gap-1 text-xs text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors",children:E?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Check,{className:"w-3 h-3 text-green-500 dark:text-green-400"}),jsxRuntimeExports.jsx("span",{className:"text-green-500 dark:text-green-400",children:"Copied!"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Copy,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{children:"Copy"})]})})]})})}const ChatInput=reactExports.forwardRef(function y({value:u,onChange:g,onSend:v,onKeyDown:b,placeholder:w="Type a message...",disabled:E=!1,isStreaming:S=!1,onStop:A,agentColor:$},R){const T=reactExports.useRef(null);return reactExports.useImperativeHandle(R,()=>T.current,[]),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-neutral-200 dark:border-neutral-800/50 bg-white/80 dark:bg-neutral-900/80 backdrop-blur-sm theme-transition",style:{paddingBottom:"calc(1rem + var(--safe-area-bottom, 0px))"},children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("textarea",{ref:T,value:u,onChange:O=>g(O.target.value),onKeyDown:b,placeholder:w,className:"flex-1 bg-neutral-100 dark:bg-neutral-800/50 text-neutral-900 dark:text-white placeholder-neutral-400 dark:placeholder-neutral-500 outline-none resize-none rounded-xl p-3 min-h-11 max-h-[120px] border border-neutral-200 dark:border-neutral-700/50 text-base theme-transition",rows:1,disabled:E||S,enterKeyHint:"send"}),S&&A?jsxRuntimeExports.jsx(motion.button,{onClick:A,className:`px-5 py-2 rounded-xl bg-linear-to-r ${$} text-white`,whileHover:{scale:1.05},whileTap:{scale:.95},children:jsxRuntimeExports.jsx(Square,{className:"w-4 h-4"})}):jsxRuntimeExports.jsx(motion.button,{onClick:v,disabled:!u.trim()||E,className:`px-5 py-2 rounded-xl bg-linear-to-r ${$} text-white disabled:opacity-50`,whileHover:{scale:1.05},whileTap:{scale:.95},children:jsxRuntimeExports.jsx(Send,{className:"w-4 h-4"})})]})})});function QuickActions({actions:y,onAction:u,disabled:g=!1}){if(!y.length)return null;const v=E=>E.length===1,b=y.filter(E=>!v(E.label)),w=y.filter(E=>v(E.label));return jsxRuntimeExports.jsxs("div",{className:"px-4 py-2 border-t border-neutral-200/50 dark:border-neutral-800/30 relative z-10 space-y-2",children:[b.length>0&&jsxRuntimeExports.jsx("div",{className:"flex gap-2 flex-wrap lg:flex-nowrap lg:overflow-x-auto scrollbar-hide",children:b.map(E=>jsxRuntimeExports.jsx("button",{onClick:()=>u(E.message),disabled:g,className:"px-3 py-1.5 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-600 dark:text-neutral-400 text-sm hover:bg-neutral-200 dark:hover:bg-neutral-700/50 hover:text-neutral-900 dark:hover:text-white transition-colors whitespace-nowrap disabled:opacity-50 max-w-[140px] lg:max-w-none truncate",children:E.label},E.label))}),w.length>0&&jsxRuntimeExports.jsx("div",{className:"flex gap-2",children:w.map(E=>jsxRuntimeExports.jsx("button",{onClick:()=>u(E.message),disabled:g,className:"w-8 h-8 flex items-center justify-center rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-600 dark:text-neutral-400 text-sm hover:bg-neutral-200 dark:hover:bg-neutral-700/50 hover:text-neutral-900 dark:hover:text-white transition-colors disabled:opacity-50",children:E.label},E.label))})]})}const HKDF_INFO_CHAT="ipfs-chat-history-ed25519-v1",SYNC_DEBOUNCE_MS=3e3,TOMBSTONE_MAX_AGE_MS=720*60*60*1e3;class ChatHistoryIpfsService{static instance=null;helia=null;ed25519PrivateKey=null;cachedIpnsName=null;ipnsKeyPair=null;ipnsSequenceNumber=0n;identityManager;isInitializing=!1;isSyncing=!1;pendingSync=!1;syncTimer=null;lastSync=null;autoSyncEnabled=!1;boundSyncHandler=null;boundBeforeUnloadHandler=null;currentIdentityAddress=null;lastKnownRemoteSequence=0n;hasPendingChanges=!1;currentStep="idle";stepProgress="";statusListeners=new Set;constructor(u){this.identityManager=u}static getInstance(){return ChatHistoryIpfsService.instance||(ChatHistoryIpfsService.instance=new ChatHistoryIpfsService(IdentityManager.getInstance())),ChatHistoryIpfsService.instance}static async resetInstance(){ChatHistoryIpfsService.instance&&(console.log(" Resetting ChatHistoryIpfsService instance..."),await ChatHistoryIpfsService.instance.shutdown(),ChatHistoryIpfsService.instance=null)}startAutoSync(){this.autoSyncEnabled||(this.cleanupOldTombstones(),this.boundSyncHandler=()=>{this.hasPendingChanges=!0,this.scheduleSync()},window.addEventListener("agent-chat-history-updated",this.boundSyncHandler),this.boundBeforeUnloadHandler=()=>{this.hasPendingChanges&&this.syncTimer&&(console.log(" Page closing - triggering immediate sync"),clearTimeout(this.syncTimer),this.syncTimer=null,this.syncBeforeUnload())},window.addEventListener("beforeunload",this.boundBeforeUnloadHandler),this.autoSyncEnabled=!0,console.log(" Chat history IPFS auto-sync enabled"),this.syncFromIpns().catch(console.error))}syncBeforeUnload(){const u=this.buildStorageData(),g=JSON.stringify(u),v=getAllBackendGatewayUrls();if(v.length>0&&navigator.sendBeacon){const b=new FormData;b.append("file",new Blob([g],{type:"application/json"}));const w=`${v[0]}/api/v0/add?pin=true&cid-version=1`,E=navigator.sendBeacon(w,b);console.log(` sendBeacon sync: ${E?"sent":"failed"}`)}}async shutdown(){this.boundSyncHandler&&(window.removeEventListener("agent-chat-history-updated",this.boundSyncHandler),this.boundSyncHandler=null),this.boundBeforeUnloadHandler&&(window.removeEventListener("beforeunload",this.boundBeforeUnloadHandler),this.boundBeforeUnloadHandler=null),this.autoSyncEnabled=!1,this.syncTimer&&(clearTimeout(this.syncTimer),this.syncTimer=null),this.helia&&(await this.helia.stop(),this.helia=null),console.log(" Chat history IPFS service stopped")}isWebCryptoAvailable(){try{return typeof crypto<"u"&&crypto.subtle!==void 0&&typeof crypto.subtle.digest=="function"}catch{return!1}}async ensureInitialized(){const u=await this.identityManager.getCurrentIdentity();if(!u)return console.warn(" No wallet identity - skipping chat IPFS init"),!1;if(this.currentIdentityAddress&&this.currentIdentityAddress!==u.address&&(console.log(" Identity changed, clearing cached keys"),this.ed25519PrivateKey=null,this.ipnsKeyPair=null,this.cachedIpnsName=null,this.ipnsSequenceNumber=0n),this.helia&&this.ed25519PrivateKey)return!0;if(this.isInitializing)return await new Promise(g=>setTimeout(g,100)),this.ensureInitialized();this.isInitializing=!0;try{if(!this.isWebCryptoAvailable())return console.warn(" WebCrypto not available - chat IPFS sync disabled"),!1;const g=this.hexToBytes(u.privateKey),v=hkdf(sha256,g,void 0,HKDF_INFO_CHAT,32);this.ed25519PrivateKey=v,this.ipnsKeyPair=await generateKeyPairFromSeed("Ed25519",v);const b=peerIdFromPrivateKey(this.ipnsKeyPair);this.cachedIpnsName=b.toString(),this.currentIdentityAddress=u.address,this.ipnsSequenceNumber=this.getIpnsSequenceNumber();const w=getBootstrapPeers();return console.log(" Initializing Helia for chat history..."),this.helia=await createHelia({libp2p:{peerDiscovery:[bootstrap({list:w})],connectionManager:{maxConnections:IPFS_CONFIG.maxConnections}}}),console.log(" Chat history IPFS service initialized"),console.log(" Chat IPNS name:",this.cachedIpnsName),!0}catch(g){return console.error(" Failed to initialize chat IPFS:",g),!1}finally{this.isInitializing=!1}}hexToBytes(u){const g=new Uint8Array(u.length/2);for(let v=0;v<g.length;v++)g[v]=parseInt(u.substr(v*2,2),16);return g}getVersionCounter(){if(!this.cachedIpnsName)return 0;const u=STORAGE_KEY_GENERATORS.ipfsChatVersion(this.cachedIpnsName);return parseInt(localStorage.getItem(u)||"0",10)}incrementVersionCounter(){if(!this.cachedIpnsName)return 1;const u=STORAGE_KEY_GENERATORS.ipfsChatVersion(this.cachedIpnsName),g=this.getVersionCounter()+1;return localStorage.setItem(u,String(g)),g}setVersionCounter(u){if(!this.cachedIpnsName)return;const g=STORAGE_KEY_GENERATORS.ipfsChatVersion(this.cachedIpnsName);localStorage.setItem(g,String(u))}getLastCid(){if(!this.cachedIpnsName)return null;const u=STORAGE_KEY_GENERATORS.ipfsChatCid(this.cachedIpnsName);return localStorage.getItem(u)}setLastCid(u){if(!this.cachedIpnsName)return;const g=STORAGE_KEY_GENERATORS.ipfsChatCid(this.cachedIpnsName);localStorage.setItem(g,u)}getIpnsSequenceNumber(){if(!this.cachedIpnsName)return 0n;const u=STORAGE_KEY_GENERATORS.ipfsChatSeq(this.cachedIpnsName),g=localStorage.getItem(u);return g?BigInt(g):0n}setIpnsSequenceNumber(u){if(!this.cachedIpnsName)return;const g=STORAGE_KEY_GENERATORS.ipfsChatSeq(this.cachedIpnsName);localStorage.setItem(g,u.toString())}async resolveIpnsViaGatewayPath(u){if(!this.cachedIpnsName)return null;const g=new URL(u).hostname,v=5e3;console.log(` Gateway path ${g}: trying /ipns/${this.cachedIpnsName?.slice(0,16)}...`);try{const b=new AbortController,w=setTimeout(()=>b.abort(),v),E=`${u}/ipns/${this.cachedIpnsName}?format=dag-json`,S=await fetch(E,{method:"GET",signal:b.signal,headers:{Accept:"application/vnd.ipld.dag-json, application/json"}});if(clearTimeout(w),!S.ok)return console.log(` Gateway path ${g}: HTTP ${S.status}`),null;const A=await S.json();if(!A._meta||A._meta.type!=="chat-history")return console.log(` Gateway path ${g}: not chat-history format, got:`,A._meta),null;const $=S.headers.get("X-Ipfs-Path");let R="";if($){const T=$.match(/\/ipfs\/([^/]+)/);T&&(R=T[1])}return console.log(` Gateway path ${g}: SUCCESS - got content (v${A._meta.version}), ${Object.keys(A.sessions).length} sessions`),{cid:R,content:A}}catch(b){const w=b instanceof Error?b.message:String(b);return console.log(` Gateway path ${g}: error - ${w}`),null}}async resolveIpnsViaRoutingApi(u){if(!this.cachedIpnsName)return null;const g=new URL(u).hostname;console.log(` Routing API ${g}: trying...`);try{const v=new AbortController,b=setTimeout(()=>v.abort(),IPNS_RESOLUTION_CONFIG.perGatewayTimeoutMs),w=await fetch(`${u}/api/v0/routing/get?arg=/ipns/${this.cachedIpnsName}`,{method:"POST",signal:v.signal});if(clearTimeout(b),!w.ok)return console.log(` Routing API ${g}: HTTP ${w.status}`),null;const E=await w.json();if(!E.Extra)return console.log(` Routing API ${g}: no Extra field in response`),null;const S=Uint8Array.from(atob(E.Extra),R=>R.charCodeAt(0)),A=unmarshalIPNSRecord(S),$=A.value.match(/^\/ipfs\/(.+)$/);return $?(console.log(` Routing API ${g}: SUCCESS - cid=${$[1].slice(0,16)}..., seq=${A.sequence}`),{cid:$[1],sequence:A.sequence}):(console.log(` Routing API ${g}: no CID in record value`),null)}catch(v){const b=v instanceof Error?v.message:String(v);return console.log(` Routing API ${g}: error - ${b}`),null}}async resolveIpnsProgressively(){const u=getAllBackendGatewayUrls();if(console.log(` Resolving IPNS from ${u.length} gateways: ${u.map(v=>new URL(v).hostname).join(", ")}`),console.log(` IPNS name: ${this.cachedIpnsName}`),u.length===0)return console.warn(" No gateways configured!"),null;const g=15e3;return new Promise(v=>{let b=!1,w=null,E=null,S=0,A=0;const $=u.length,R=O=>{if(b)return;b=!0;const B=E?.sequence||0n,F=w?.sequence||0n;console.log(` Resolving (${O}): gatewayPath seq=${B}, routingApi seq=${F}`),F>B&&w?(console.log(` Using routing API result (newer): cid=${w.cid.slice(0,16)}..., seq=${F}`),v(w)):E?(console.log(` Using gateway path result: v${E.content._meta.version}, ${Object.keys(E.content.sessions).length} sessions`),v(E)):w?(console.log(` Using routing API result (only available): cid=${w.cid.slice(0,16)}..., seq=${F}`),v(w)):(console.log(" IPNS resolution: no results found"),v(null))},T=()=>{if(b)return;const O=S>=$,B=A>=$,F=E!==null,U=w!==null;if(F&&U){R("both results available");return}if(O&&B){R("all requests completed");return}if(F&&!B){console.log(` Gateway path ready, waiting for routing API (${A}/${$} done)`);return}if(U&&!O){console.log(` Routing API ready, waiting for gateway path (${S}/${$} done)`);return}};u.forEach(O=>{this.resolveIpnsViaGatewayPath(O).then(B=>{B&&!E&&(E={cid:B.cid,sequence:BigInt(B.content._meta.version),content:B.content},console.log(` Gateway path got result: v${B.content._meta.version}, ${Object.keys(B.content.sessions).length} sessions`))}).catch(B=>{console.log(` Gateway path ${new URL(O).hostname}: caught error`,B)}).finally(()=>{S++,T()})}),u.forEach(O=>{this.resolveIpnsViaRoutingApi(O).then(B=>{B&&(console.log(` Routing API got result: cid=${B.cid.slice(0,16)}..., seq=${B.sequence}`),(!w||B.sequence>w.sequence)&&(w=B))}).catch(B=>{console.log(` Routing API ${new URL(O).hostname}: caught error`,B)}).finally(()=>{A++,T()})}),setTimeout(()=>{b||R(`timeout after ${g}ms`)},g)})}async publishIpnsViaHttp(u){const g=getAllBackendGatewayUrls();if(g.length===0||!this.cachedIpnsName)return!1;console.log(` Publishing chat IPNS via HTTP to ${g.length} backend(s)...`);const b=(await Promise.allSettled(g.map(async w=>{const E=new URL(w).hostname;try{const S=new FormData;S.append("file",new Blob([new Uint8Array(u)]),"record");const A=await fetch(`${w}/api/v0/routing/put?arg=/ipns/${this.cachedIpnsName}&allow-offline=true`,{method:"POST",body:S,signal:AbortSignal.timeout(3e4)});if(!A.ok)throw console.warn(` IPNS publish to ${E}: HTTP ${A.status}`),new Error(`HTTP ${A.status}`);return console.log(` IPNS publish to ${E}: success`),w}catch(S){throw console.log(` IPNS publish to ${E}: failed`,S instanceof Error?S.message:S),S}}))).filter(w=>w.status==="fulfilled");return console.log(` IPNS publish: ${b.length}/${g.length} backends succeeded`),b.length>0}async publishToIpns(u){if(!this.helia||!this.ipnsKeyPair)return null;const g=99*365*24*60*60*1e3;try{console.log(` Publishing chat to IPNS: ${u.toString().slice(0,16)}...`);const v=this.ipnsSequenceNumber>this.lastKnownRemoteSequence?this.ipnsSequenceNumber:this.lastKnownRemoteSequence;this.ipnsSequenceNumber=v+1n;const b=await createIPNSRecord(this.ipnsKeyPair,`/ipfs/${u.toString()}`,this.ipnsSequenceNumber,g),w=marshalIPNSRecord(b);return await this.publishIpnsViaHttp(w)?(this.setIpnsSequenceNumber(this.ipnsSequenceNumber),console.log(` Chat IPNS published (seq: ${this.ipnsSequenceNumber})`),this.cachedIpnsName):(this.ipnsSequenceNumber--,null)}catch(v){return this.ipnsSequenceNumber--,console.warn(" Chat IPNS publish failed:",v),null}}async fetchRemoteContent(u){console.log(` Fetching remote chat content: ${u.slice(0,16)}...`);const g=getAllBackendGatewayUrls();for(const v of g)try{const b=new URL(v).hostname,w=new AbortController,E=setTimeout(()=>w.abort(),1e4),S=await fetch(`${v}/ipfs/${u}`,{method:"GET",signal:w.signal,headers:{Accept:"application/json"}});if(clearTimeout(E),S.ok){const A=await S.json();if(A&&A._meta&&A._meta.type==="chat-history")return console.log(` Remote chat content fetched via ${b}`),A}}catch{continue}if(this.helia)try{console.log(` Trying Helia bitswap for ${u.slice(0,16)}...`);const v=json(this.helia),{CID:b}=await __vitePreload(async()=>{const{CID:S}=await Promise.resolve().then(()=>cid);return{CID:S}},void 0),w=b.parse(u),E=await Promise.race([v.get(w),new Promise((S,A)=>setTimeout(()=>A(new Error("Fetch timeout")),15e3))]);if(E&&typeof E=="object"&&"_meta"in E&&E._meta.type==="chat-history")return console.log(" Remote chat content fetched via bitswap"),E}catch(v){console.warn(" Bitswap fetch failed:",v)}return console.warn(" Failed to fetch chat CID from any source"),null}async storeContent(u){if(!this.helia)return null;try{const v=await json(this.helia).add(u);return console.log(` Chat content stored locally: ${v.toString().slice(0,16)}...`),await this.uploadToGateways(v.toString(),u),v}catch(g){return console.error(" Failed to store chat content:",g),null}}async uploadToGateways(u,g){const v=getAllBackendGatewayUrls(),b=new Blob([JSON.stringify(g)],{type:"application/json"});console.log(` Uploading chat content to ${v.length} gateway(s)...`);const E=(await Promise.allSettled(v.map(async S=>{const A=new URL(S).hostname;try{const $=new FormData;$.append("file",b);const R=await fetch(`${S}/api/v0/add?pin=true&cid-version=1`,{method:"POST",body:$,signal:AbortSignal.timeout(3e4)});if(!R.ok)throw new Error(`HTTP ${R.status}`);const T=await R.json();return console.log(` Uploaded to ${A}: ${T.Hash?.slice(0,16)}...`),S}catch($){throw console.log(` Upload to ${A} failed:`,$ instanceof Error?$.message:$),$}}))).filter(S=>S.status==="fulfilled");console.log(` Content uploaded to ${E.length}/${v.length} gateways`)}scheduleSync(){if(console.log(` scheduleSync called, isSyncing=${this.isSyncing}`),this.isSyncing){this.pendingSync=!0,console.log(" Sync in progress, marking pending");return}this.syncTimer&&clearTimeout(this.syncTimer),console.log(` Scheduling sync in ${SYNC_DEBOUNCE_MS}ms`),this.syncTimer=setTimeout(()=>{this.syncTimer=null,this.syncNow().catch(console.error)},SYNC_DEBOUNCE_MS),this.notifyStatusListeners()}async syncImmediately(){return console.log(" syncImmediately called"),this.syncTimer&&(clearTimeout(this.syncTimer),this.syncTimer=null),this.syncNow()}async syncFromIpns(){console.log(" Starting chat IPNS sync..."),this.setStep("initializing");try{if(!await this.ensureInitialized())return this.setStep("error","Not initialized"),{success:!1,timestamp:Date.now(),error:"Not initialized"};this.setStep("resolving-ipns","Looking up chat history...");const g=await this.resolveIpnsProgressively(),v=g?.cid||null,b=this.getLastCid(),w=g?.content!==void 0;if(g&&(this.lastKnownRemoteSequence=g.sequence,console.log(` Chat IPNS resolved: seq=${g.sequence}, hasCid=${!!v}, hasContent=${w}`)),!v&&!b&&!w)return console.log(" No remote or local chat data - fresh state"),this.setStep("complete"),{success:!0,timestamp:Date.now(),sessionCount:0};let E=null;if(g?.content)E=g.content,console.log(` Using cached content from gateway path (${Object.keys(E.sessions).length} sessions)`);else{const R=v||b;R&&(this.setStep("fetching-content","Downloading history..."),E=await this.fetchRemoteContent(R))}if(!E)return console.warn(" Failed to fetch remote chat content"),this.setStep("error","Failed to fetch content"),{success:!1,timestamp:Date.now(),error:"Failed to fetch remote content"};const S=this.getVersionCounter(),A=E._meta.version,$=v||b||"";return console.log(` Chat version: local=v${S}, remote=v${A}`),A>S?(this.setStep("importing-data",`Importing ${Object.keys(E.sessions).length} session(s)...`),console.log(` Importing ${Object.keys(E.sessions).length} session(s) from remote...`),await this.importRemoteData(E),this.setVersionCounter(A),$&&this.setLastCid($),this.setStep("complete"),window.dispatchEvent(new CustomEvent("agent-chat-history-updated")),{success:!0,cid:$||void 0,timestamp:Date.now(),sessionCount:Object.keys(E.sessions).length}):A<S?(this.setStep("importing-data","Merging local and remote..."),await this.importRemoteData(E),this.syncNow()):($&&this.setLastCid($),this.setStep("complete"),{success:!0,cid:$||void 0,timestamp:Date.now(),sessionCount:Object.keys(E.sessions).length})}catch(u){return console.error(" Chat IPNS sync failed:",u),this.setStep("error",String(u)),{success:!1,timestamp:Date.now(),error:String(u)}}}pendingSyncResolvers=[];async syncNow(){if(console.log(" syncNow called"),this.isSyncing)return console.log(" syncNow: already syncing, queuing request..."),new Promise(u=>{this.pendingSyncResolvers.push(u)});this.isSyncing=!0,this.setStep("initializing");try{if(console.log(" syncNow: ensuring initialized..."),!await this.ensureInitialized()||!this.helia)throw console.warn(" syncNow: IPFS not initialized"),new Error("IPFS not initialized");this.setStep("building-data","Preparing chat data..."),console.log(" syncNow: building storage data...");const g=this.buildStorageData();console.log(` syncNow: ${Object.keys(g.sessions).length} sessions, ${Object.keys(g.messages).length} message sets`),this.setStep("uploading",`Uploading ${Object.keys(g.sessions).length} session(s)...`);const v=await this.storeContent(g);if(!v)throw new Error("Failed to store content");this.setStep("publishing-ipns","Publishing to network...");const b=await this.publishToIpns(v);this.setLastCid(v.toString());const w=this.incrementVersionCounter(),E={success:!0,cid:v.toString(),ipnsName:b||void 0,timestamp:Date.now(),sessionCount:Object.keys(g.sessions).length};return this.lastSync=E,this.hasPendingChanges=!1,this.setStep("complete"),console.log(` Chat sync complete: v${w}, ${E.sessionCount} sessions`),E}catch(u){return console.error(" Chat sync failed:",u),this.setStep("error",String(u)),{success:!1,timestamp:Date.now(),error:String(u)}}finally{if(this.isSyncing=!1,this.pendingSyncResolvers.length>0){const u=this.pendingSyncResolvers;this.pendingSyncResolvers=[],console.log(` syncNow: resolving ${u.length} queued request(s) with a final sync`),this.syncNow().then(g=>{u.forEach(v=>v(g))}).catch(g=>{const v={success:!1,timestamp:Date.now(),error:String(g)};u.forEach(b=>b(v))})}else this.pendingSync?(this.pendingSync=!1,this.scheduleSync()):setTimeout(()=>{(this.currentStep==="complete"||this.currentStep==="error")&&this.setStep("idle")},2e3)}}buildStorageData(){const u=localStorage.getItem(STORAGE_KEYS.AGENT_CHAT_SESSIONS),g=u?JSON.parse(u):[];console.log(` buildStorageData: found ${g.length} sessions in localStorage`);const v={},b={};for(const S of g){v[S.id]=S,console.log(`   - Session ${S.id.slice(0,8)}... agentId=${S.agentId}, title="${S.title.slice(0,20)}..."`);const A=localStorage.getItem(STORAGE_KEY_GENERATORS.agentChatMessages(S.id));if(A){const $=JSON.parse(A);b[S.id]=$,console.log(`     Messages: ${$.length}`)}}const w=localStorage.getItem(STORAGE_KEYS.AGENT_CHAT_TOMBSTONES),E=w?JSON.parse(w):{};return console.log(` buildStorageData: ${Object.keys(E).length} tombstones`),{_meta:{version:this.getVersionCounter()+1,timestamp:Date.now(),address:this.currentIdentityAddress||"",type:"chat-history"},sessions:v,messages:b,tombstones:E}}async importRemoteData(u){console.log(` importRemoteData: remote has ${Object.keys(u.sessions).length} sessions, ${Object.keys(u.tombstones).length} tombstones`);const g=localStorage.getItem(STORAGE_KEYS.AGENT_CHAT_SESSIONS),v=g?JSON.parse(g):[],b=new Map(v.map($=>[$.id,$]));console.log(` importRemoteData: local has ${v.length} sessions`);const w=localStorage.getItem(STORAGE_KEYS.AGENT_CHAT_TOMBSTONES),E=w?JSON.parse(w):{};console.log(` importRemoteData: local has ${Object.keys(E).length} tombstones`);let S=0;for(const[$,R]of Object.entries(u.sessions)){if(E[$]){console.log(`   - Skip ${$.slice(0,8)}... (locally tombstoned)`);continue}if(u.tombstones[$]){console.log(`   - Skip ${$.slice(0,8)}... (remotely tombstoned)`);continue}const T=b.get($);if(!T||R.updatedAt>T.updatedAt){console.log(`   - Import ${$.slice(0,8)}... agentId=${R.agentId}, title="${R.title.slice(0,20)}..."`),b.set($,R);const O=u.messages[$];O&&(localStorage.setItem(STORAGE_KEY_GENERATORS.agentChatMessages($),JSON.stringify(O)),console.log(`     Messages: ${O.length}`)),S++}else console.log(`   - Skip ${$.slice(0,8)}... (local is newer or same)`)}for(const[$,R]of Object.entries(u.tombstones))if(b.has($)){const T=b.get($);R.deletedAt>T.updatedAt&&(b.delete($),localStorage.removeItem(STORAGE_KEY_GENERATORS.agentChatMessages($)),E[$]=R)}else E[$]=R;const A=Array.from(b.values());return localStorage.setItem(STORAGE_KEYS.AGENT_CHAT_SESSIONS,JSON.stringify(A)),localStorage.setItem(STORAGE_KEYS.AGENT_CHAT_TOMBSTONES,JSON.stringify(E)),console.log(` Imported ${S} chat session(s) from remote`),S}recordSessionDeletion(u){const g=localStorage.getItem(STORAGE_KEYS.AGENT_CHAT_TOMBSTONES),v=g?JSON.parse(g):{};v[u]={sessionId:u,deletedAt:Date.now(),reason:"user-deleted"},localStorage.setItem(STORAGE_KEYS.AGENT_CHAT_TOMBSTONES,JSON.stringify(v))}recordBulkDeletion(u){const g=localStorage.getItem(STORAGE_KEYS.AGENT_CHAT_TOMBSTONES),v=g?JSON.parse(g):{},b=Date.now();for(const w of u)v[w]={sessionId:w,deletedAt:b,reason:"clear-all"};localStorage.setItem(STORAGE_KEYS.AGENT_CHAT_TOMBSTONES,JSON.stringify(v))}cleanupOldTombstones(){const u=localStorage.getItem(STORAGE_KEYS.AGENT_CHAT_TOMBSTONES);if(!u)return 0;const g=JSON.parse(u),b=Date.now()-TOMBSTONE_MAX_AGE_MS;let w=0;const E={};for(const[S,A]of Object.entries(g))A.deletedAt>=b?E[S]=A:w++;return w>0&&(localStorage.setItem(STORAGE_KEYS.AGENT_CHAT_TOMBSTONES,JSON.stringify(E)),console.log(` Cleaned up ${w} old tombstone(s) (older than 30 days)`)),w}clearLocalStateOnly(){console.log(" Clearing chat IPFS local state (no sync)"),this.cachedIpnsName&&(localStorage.removeItem(STORAGE_KEY_GENERATORS.ipfsChatVersion(this.cachedIpnsName)),localStorage.removeItem(STORAGE_KEY_GENERATORS.ipfsChatCid(this.cachedIpnsName)),localStorage.removeItem(STORAGE_KEY_GENERATORS.ipfsChatSeq(this.cachedIpnsName))),localStorage.removeItem(STORAGE_KEYS.AGENT_CHAT_TOMBSTONES),this.ipnsSequenceNumber=0n,this.lastKnownRemoteSequence=0n,this.lastSync=null,this.hasPendingChanges=!1,console.log(" Chat IPFS local state cleared (no network operations)")}setStep(u,g){this.currentStep=u,this.stepProgress=g||"",this.notifyStatusListeners()}notifyStatusListeners(){this.statusListeners.forEach(u=>u())}onStatusChange(u){return this.statusListeners.add(u),()=>{this.statusListeners.delete(u)}}getStatus(){return{initialized:this.helia!==null,isSyncing:this.isSyncing,hasPendingSync:this.syncTimer!==null||this.hasPendingChanges,lastSync:this.lastSync,ipnsName:this.cachedIpnsName,currentStep:this.currentStep,stepProgress:this.stepProgress}}}let chatHistoryIpfsServiceInstance=null;function getChatHistoryIpfsService(){return chatHistoryIpfsServiceInstance||(chatHistoryIpfsServiceInstance=ChatHistoryIpfsService.getInstance()),chatHistoryIpfsServiceInstance}const MAX_STORAGE_SIZE=4*1024*1024,MAX_SESSIONS_PER_AGENT=50,MAX_MESSAGES_PER_SESSION=100;class ChatHistoryRepository{static instance;constructor(){}static getInstance(){return ChatHistoryRepository.instance||(ChatHistoryRepository.instance=new ChatHistoryRepository),ChatHistoryRepository.instance}isLocalStorageAvailable(){try{const u="__localStorage_test__";return localStorage.setItem(u,u),localStorage.removeItem(u),!0}catch{return!1}}getStorageSize(){let u=0;for(const g in localStorage)Object.prototype.hasOwnProperty.call(localStorage,g)&&(u+=localStorage.getItem(g)?.length||0);return u*2}generateId(){return`${Date.now()}-${Math.random().toString(36).substring(2,9)}`}getMessagesKey(u){return STORAGE_KEY_GENERATORS.agentChatMessages(u)}getAllSessions(){if(!this.isLocalStorageAvailable())return[];try{const u=localStorage.getItem(STORAGE_KEYS.AGENT_CHAT_SESSIONS);return u?JSON.parse(u).sort((v,b)=>b.updatedAt-v.updatedAt):[]}catch(u){return console.error("[ChatHistory] Failed to parse sessions",u),[]}}getSessionsForAgent(u,g){return this.getAllSessions().filter(v=>v.agentId===u&&(g?v.userId===g:!0))}getSession(u){return this.getAllSessions().find(g=>g.id===u)||null}saveSessions(u){if(this.isLocalStorageAvailable())try{localStorage.setItem(STORAGE_KEYS.AGENT_CHAT_SESSIONS,JSON.stringify(u))}catch(g){if(g instanceof DOMException&&(g.name==="QuotaExceededError"||g.name==="NS_ERROR_DOM_QUOTA_REACHED")){console.warn("[ChatHistory] Storage quota exceeded, triggering cleanup"),this.cleanupOldSessions();try{localStorage.setItem(STORAGE_KEYS.AGENT_CHAT_SESSIONS,JSON.stringify(u))}catch{console.error("[ChatHistory] Failed to save sessions after cleanup")}}else console.error("[ChatHistory] Failed to save sessions",g)}}createSession(u,g,v){const b={id:this.generateId(),agentId:u,userId:g,title:this.generateTitle(v),preview:v?.content.slice(0,100)||"",createdAt:Date.now(),updatedAt:Date.now(),messageCount:v?1:0};console.log(` [Repository] createSession: id=${b.id.slice(0,8)}..., agentId=${u}, userId=${g}`);const w=this.getAllSessions();w.unshift(b),this.saveSessions(w),v&&this.saveMessages(b.id,[v]);try{getChatHistoryIpfsService().syncImmediately().catch(E=>{console.warn("[ChatHistory] Failed to sync session creation:",E)})}catch(E){console.warn("[ChatHistory] Failed to trigger IPFS sync:",E)}return this.notifyUpdate(),b}updateSession(u,g){const v=this.getAllSessions(),b=v.findIndex(w=>w.id===u);b>=0&&(v[b]={...v[b],...g,updatedAt:Date.now()},this.saveSessions(v),this.notifyUpdate())}deleteSession(u){const g=this.getAllSessions().filter(v=>v.id!==u);this.saveSessions(g),this.isLocalStorageAvailable()&&localStorage.removeItem(this.getMessagesKey(u));try{const v=getChatHistoryIpfsService();v.recordSessionDeletion(u),v.syncImmediately().catch(b=>{console.warn("[ChatHistory] Failed to sync session deletion:",b)})}catch(v){console.warn("[ChatHistory] Failed to record IPFS tombstone:",v)}this.notifyUpdate()}deleteAllSessionsForAgent(u,g){const v=this.getAllSessions(),b=v.filter(E=>E.agentId===u&&(g?E.userId===g:!0)),w=v.filter(E=>!(E.agentId===u&&(!g||E.userId===g)));if(b.forEach(E=>{this.isLocalStorageAvailable()&&localStorage.removeItem(this.getMessagesKey(E.id))}),b.length>0)try{const E=getChatHistoryIpfsService();E.recordBulkDeletion(b.map(S=>S.id)),E.syncImmediately().catch(S=>{console.warn("[ChatHistory] Failed to sync bulk deletion:",S)})}catch(E){console.warn("[ChatHistory] Failed to record IPFS bulk tombstones:",E)}this.saveSessions(w),this.notifyUpdate()}clearAllHistory(){if(!this.isLocalStorageAvailable())return;const u=this.getAllSessions();if(u.forEach(g=>{localStorage.removeItem(this.getMessagesKey(g.id))}),u.length>0)try{const g=getChatHistoryIpfsService();g.recordBulkDeletion(u.map(v=>v.id)),g.syncImmediately().catch(v=>{console.warn("[ChatHistory] Failed to sync clear all:",v)})}catch(g){console.warn("[ChatHistory] Failed to record IPFS bulk tombstones:",g)}localStorage.removeItem(STORAGE_KEYS.AGENT_CHAT_SESSIONS),this.notifyUpdate()}clearAllLocalHistoryOnly(){if(!this.isLocalStorageAvailable())return;console.log("[ChatHistory] Clearing all local history (localStorage only, no IPFS sync)");const u=this.getAllSessions();u.forEach(g=>{localStorage.removeItem(this.getMessagesKey(g.id))}),localStorage.removeItem(STORAGE_KEYS.AGENT_CHAT_SESSIONS),localStorage.removeItem(STORAGE_KEYS.AGENT_CHAT_TOMBSTONES),console.log(`[ChatHistory] Cleared ${u.length} sessions from localStorage (no IPFS sync)`),this.notifyUpdate()}getMessages(u){if(!this.isLocalStorageAvailable())return[];try{const g=localStorage.getItem(this.getMessagesKey(u));return g?JSON.parse(g):[]}catch(g){return console.error("[ChatHistory] Failed to parse messages",g),[]}}saveMessages(u,g){if(!this.isLocalStorageAvailable())return;const v=this.getSession(u),b=g.length;console.log(` [Repository] saveMessages: sessionId=${u.slice(0,8)}..., agentId=${v?.agentId||"unknown"}, messageCount=${b}`),this.getStorageSize()>MAX_STORAGE_SIZE&&this.cleanupOldSessions();const w=g.length>MAX_MESSAGES_PER_SESSION?g.slice(-MAX_MESSAGES_PER_SESSION):g;g.length>MAX_MESSAGES_PER_SESSION&&console.log(` [Repository] Trimming ${g.length} messages to ${MAX_MESSAGES_PER_SESSION} for localStorage`);try{localStorage.setItem(this.getMessagesKey(u),JSON.stringify(w));const E=g[g.length-1];this.updateSession(u,{title:this.generateTitleFromMessages(g),preview:E?.content.slice(0,100)||"",messageCount:g.length});try{console.log(" [Repository] Triggering IPFS sync after saving messages"),getChatHistoryIpfsService().scheduleSync()}catch(S){console.warn("[ChatHistory] Failed to schedule IPFS sync:",S)}}catch(E){if(E instanceof DOMException&&(E.name==="QuotaExceededError"||E.name==="NS_ERROR_DOM_QUOTA_REACHED")){console.warn("[ChatHistory] Storage quota exceeded, triggering cleanup"),this.cleanupOldSessions();try{localStorage.setItem(this.getMessagesKey(u),JSON.stringify(w))}catch{console.error("[ChatHistory] Failed to save messages after cleanup")}}else console.error("[ChatHistory] Failed to save messages",E)}}appendMessage(u,g){const v=this.getMessages(u),b=v.findIndex(w=>w.id===g.id);b>=0?v[b]=g:v.push(g),this.saveMessages(u,v)}generateTitle(u){if(!u||!u.content)return"New conversation";const g=u.content.trim();return g.length<=40?g:g.slice(0,37)+"..."}generateTitleFromMessages(u){const g=u.find(v=>v.role==="user");return this.generateTitle(g)}searchSessions(u,g,v){const b=u.toLowerCase().trim();return b?(g?this.getSessionsForAgent(g,v):this.getAllSessions()).filter(E=>E.title.toLowerCase().includes(b)||E.preview.toLowerCase().includes(b)?!0:this.getMessages(E.id).some(A=>A.content.toLowerCase().includes(b))):g?this.getSessionsForAgent(g,v):this.getAllSessions()}cleanupOldSessions(){console.log("[ChatHistory] Running cleanup...");const u=this.getAllSessions(),g={};u.forEach(w=>{g[w.agentId]||(g[w.agentId]=[]),g[w.agentId].push(w)});const v=[];Object.values(g).forEach(w=>{w.length>MAX_SESSIONS_PER_AGENT&&(w.sort((S,A)=>A.updatedAt-S.updatedAt),w.slice(MAX_SESSIONS_PER_AGENT).forEach(S=>v.push(S.id)))}),v.forEach(w=>{this.isLocalStorageAvailable()&&localStorage.removeItem(this.getMessagesKey(w))});const b=u.filter(w=>!v.includes(w.id));this.saveSessions(b),console.log(`[ChatHistory] Cleaned up ${v.length} old sessions`)}notifyUpdate(){window.dispatchEvent(new CustomEvent("agent-chat-history-updated"))}getSessionWithMessages(u){const g=this.getSession(u);return g?{...g,messages:this.getMessages(u)}:null}}const chatHistoryRepository=ChatHistoryRepository.getInstance(),chatHistorySyncKeys={all:["chat-history-sync"],ipns:y=>[...chatHistorySyncKeys.all,"ipns",y],status:()=>[...chatHistorySyncKeys.all,"status"]};function useChatHistorySync({userId:y,enabled:u=!0}){const g=useQueryClient(),v=reactExports.useRef(null),b=reactExports.useRef(!1),{data:w}=useQuery({queryKey:chatHistorySyncKeys.status(),queryFn:()=>getChatHistoryIpfsService().getStatus(),staleTime:1/0,gcTime:1/0}),E=w?.currentStep??"idle",S=w?.stepProgress??"";reactExports.useEffect(()=>{const ye=getChatHistoryIpfsService();return g.setQueryData(chatHistorySyncKeys.status(),ye.getStatus()),ye.onStatusChange(()=>{const pe=ye.getStatus();g.setQueryData(chatHistorySyncKeys.status(),pe)})},[g]);const{data:A,isLoading:$,isFetching:R,isRefetching:T,error:O,refetch:B}=useQuery({queryKey:chatHistorySyncKeys.ipns(y||""),queryFn:async()=>{const ye=getChatHistoryIpfsService();return ye.startAutoSync(),ye.syncFromIpns()},enabled:u&&!!y,staleTime:3e4,gcTime:300*1e3,refetchOnWindowFocus:!0,refetchOnReconnect:!0,retry:2,retryDelay:ye=>Math.min(1e3*2**ye,1e4)}),{mutate:F,mutateAsync:U,isPending:q,error:J}=useMutation({mutationFn:async()=>getChatHistoryIpfsService().syncNow(),onSuccess:ye=>{y&&g.setQueryData(chatHistorySyncKeys.ipns(y),ye),window.dispatchEvent(new CustomEvent("agent-chat-history-synced"))},onError:ye=>{console.error("[useChatHistorySync] Upload failed:",ye)}}),ie=reactExports.useCallback((ye=3e3)=>{if(v.current&&clearTimeout(v.current),q){b.current=!0;return}v.current=setTimeout(()=>{v.current=null,F()},ye)},[q,F]),oe=reactExports.useCallback(async()=>(v.current&&(clearTimeout(v.current),v.current=null),U()),[U]);reactExports.useEffect(()=>{!q&&b.current&&(b.current=!1,ie(1e3))},[q,ie]),reactExports.useEffect(()=>{if(!u||!y)return;const ye=()=>{ie()};return window.addEventListener("agent-chat-history-updated",ye),()=>{window.removeEventListener("agent-chat-history-updated",ye),v.current&&clearTimeout(v.current)}},[u,y,ie]),reactExports.useEffect(()=>()=>{v.current&&clearTimeout(v.current)},[]);const le=E!=="idle"&&E!=="complete"&&E!=="error";return{syncState:{isInitialLoading:$,isFetching:R||le,isRefetching:T,fetchError:O,isUploading:q||(E==="building-data"||E==="uploading"||E==="publishing-ipns"),uploadError:J,isSyncing:R||q||le,isError:!!O||!!J||E==="error",lastSyncTime:A?.timestamp||null,sessionCount:A?.sessionCount??null,currentStep:E,stepProgress:S||void 0},refetch:B,scheduleSync:ie,syncImmediately:oe,syncResult:A}}function useChatHistory({agentId:y,userId:u,enabled:g=!0}){const[v,b]=reactExports.useState([]),[w,E]=reactExports.useState(null),[S,A]=reactExports.useState(!0),[$,R]=reactExports.useState(!1),T=reactExports.useRef(null),O=reactExports.useRef(u),{syncState:B,syncImmediately:F}=useChatHistorySync({userId:u,enabled:g&&!!u});reactExports.useEffect(()=>{T.current=w},[w]),reactExports.useEffect(()=>{O.current=u},[u]),reactExports.useEffect(()=>{if(!g){A(!1);return}(()=>{const pe=chatHistoryRepository.getSessionsForAgent(y,u);b(pe),A(!1),E(null)})();const we=()=>{const pe=chatHistoryRepository.getSessionsForAgent(y,u);b(pe)};return window.addEventListener("agent-chat-history-updated",we),window.addEventListener("agent-chat-history-synced",we),()=>{window.removeEventListener("agent-chat-history-updated",we),window.removeEventListener("agent-chat-history-synced",we)}},[y,u,g]);const U=reactExports.useCallback(()=>{if(!O.current)return null;const ye=chatHistoryRepository.createSession(y,O.current);return E(ye),b(we=>[ye,...we]),ye},[y]),q=reactExports.useCallback(ye=>{const we=chatHistoryRepository.getSessionWithMessages(ye);return we?(E(we),we.messages):[]},[]),J=reactExports.useCallback(ye=>{chatHistoryRepository.deleteSession(ye),b(we=>we.filter(pe=>pe.id!==ye)),T.current?.id===ye&&E(null)},[]),ie=reactExports.useCallback(()=>{chatHistoryRepository.deleteAllSessionsForAgent(y,O.current),b([]),E(null)},[y]),oe=reactExports.useCallback(()=>{R(!0),setTimeout(()=>R(!1),2e3)},[]),le=reactExports.useCallback(()=>{E(null)},[]),de=reactExports.useCallback(ye=>{if(!g||!O.current)return;const we=ye.filter(ve=>ve.id!=="greeting"&&ve.content.trim());if(we.length===0)return;let pe=T.current;if(!pe){const ve=we.find(he=>he.role==="user");pe=chatHistoryRepository.createSession(y,O.current,ve),E(pe),b(he=>he.some(ae=>ae.id===pe.id)?he:[pe,...he])}chatHistoryRepository.saveMessages(pe.id,we),E(ve=>ve?{...ve,messageCount:we.length,updatedAt:Date.now()}:null)},[y,g]),fe=reactExports.useCallback(ye=>chatHistoryRepository.searchSessions(ye,y,O.current),[y]);return{sessions:v,currentSession:w,createNewSession:U,loadSession:q,deleteSession:J,clearAllHistory:ie,resetCurrentSession:le,showDeleteSuccess:oe,saveCurrentMessages:de,searchSessions:fe,isLoading:S,justDeleted:$,syncState:B,syncImmediately:F}}const sessionKeys={all:["agent-session"],session:y=>[...sessionKeys.all,y]};function useUrlSession({sessions:y}){const u=useQueryClient(),[g,v]=useSearchParams(),b=g.get("session"),w=reactExports.useMemo(()=>b?y.some(O=>O.id===b):!1,[b,y]),{data:E,isLoading:S}=useQuery({queryKey:sessionKeys.session(b||""),queryFn:()=>{if(!b)return null;const O=chatHistoryRepository.getSessionWithMessages(b);return O?{session:O,messages:O.messages}:null},enabled:!!b&&w,staleTime:1/0,gcTime:300*1e3}),A=reactExports.useCallback(O=>{const B=chatHistoryRepository.getSessionWithMessages(O);B&&u.setQueryData(sessionKeys.session(O),{session:B,messages:B.messages}),v({session:O},{replace:!0})},[u,v]),$=reactExports.useCallback(()=>{v({},{replace:!0})},[v]),R=reactExports.useCallback(O=>{u.invalidateQueries({queryKey:sessionKeys.session(O)})},[u]),T=reactExports.useCallback((O,B)=>{u.setQueryData(sessionKeys.session(O),F=>F&&{...F,messages:B,session:{...F.session,messageCount:B.length,updatedAt:Date.now()}})},[u]);return{urlSessionId:b,currentSession:E?.session??null,currentMessages:E?.messages??[],isLoading:S,navigateToSession:A,clearSession:$,invalidateSession:R,updateSessionCache:T}}function AgentChat({agent:y,getMockResponse:u,processMessage:g,renderMessageCard:v,actionConfig:b,renderMessageActions:w,additionalContent:E,bgGradient:S={from:"bg-indigo-500/5",to:"bg-cyan-500/5"},sidebarConfig:A}){const[$,R]=reactExports.useState(""),[T,O]=reactExports.useState([]),[B,F]=reactExports.useState(null),[U,q]=reactExports.useState(!1),[J,ie]=reactExports.useState(!1),[oe,le]=reactExports.useState(!1),[de,fe]=reactExports.useState("history"),[ye,we]=reactExports.useState(!1),[pe,ve]=reactExports.useState(""),[he,ae]=reactExports.useState(null),[Q,j]=reactExports.useState(!1),z=reactExports.useRef(null),re=reactExports.useRef(null),Y=reactExports.useRef(!1),te=reactExports.useRef(y.id),ne=reactExports.useRef(null),se=reactExports.useRef(""),ee=reactExports.useRef(!0),{nametag:Z}=useWallet(),{sessions:ue,currentSession:_e,loadSession:Re,deleteSession:Ae,clearAllHistory:ge,resetCurrentSession:be,showDeleteSuccess:Te,saveCurrentMessages:De,searchSessions:Ie,syncState:Se,syncImmediately:Be,justDeleted:Le}=useChatHistory({agentId:y.id,userId:Z??void 0,enabled:!!Z}),{urlSessionId:qe,currentSession:Ke,currentMessages:Ge,navigateToSession:Xe,clearSession:ze}=useUrlSession({sessions:ue});reactExports.useEffect(()=>{_e?.id&&_e.id!==qe&&Xe(_e.id)},[_e?.id,qe,Xe]);const et=pe.trim()?Ie(pe):ue,{messages:Ze,setMessages:nt,isStreaming:ut,currentStatus:ot,sendMessage:vt,stopGeneration:bt,agentMode:lt}=useAgentChat({activityId:y.backendActivityId||y.id,userId:Z??void 0}),kt=lt==="mock",Ct=ut,Me=async(ft,At)=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(ft);else{const Oe=document.createElement("textarea");Oe.value=ft,Oe.style.position="fixed",Oe.style.left="-9999px",document.body.appendChild(Oe),Oe.select(),document.execCommand("copy"),document.body.removeChild(Oe)}F(At),setTimeout(()=>F(null),2e3)}catch{console.warn("Failed to copy text")}};reactExports.useEffect(()=>(ee.current=!0,()=>{ee.current=!1}),[]),reactExports.useEffect(()=>{te.current!==y.id&&(te.current=y.id,O([]),R(""),Y.current=!1,se.current="",nt([]))},[y.id,nt,kt]),reactExports.useEffect(()=>{ne.current!==Z&&(ne.current=Z??null,O([]),R(""),Y.current=!1,se.current="",nt([]))},[Z,nt,kt]),reactExports.useEffect(()=>{if(!qe||Ge.length===0)return;const ft=Ge.map(At=>({id:At.id,role:At.role,content:At.content,timestamp:At.timestamp,thinking:At.thinking}));O(ft),nt(Ge),Y.current=!0,se.current=JSON.stringify(Ge.map(At=>({id:At.id,content:At.content})))},[qe,Ge,nt,kt]),reactExports.useEffect(()=>{O(ft=>Ze.map(Oe=>{const $e=ft.find(Ue=>Ue.id===Oe.id),ke={...Oe,cardData:$e?.cardData,showActionButton:$e?.showActionButton};return g?g(ke,ft):ke}))},[Ze,kt,g]),reactExports.useEffect(()=>{if(Ct)return;const ft=T.filter($e=>$e.id!=="greeting"&&$e.content.trim());if(ft.length===0)return;const At=JSON.stringify(ft.map($e=>({id:$e.id,content:$e.content})));if(At===se.current)return;const Oe=setTimeout(()=>{const $e=ft.map(ke=>({id:ke.id,role:ke.role,content:ke.content,timestamp:ke.timestamp,thinking:ke.thinking}));De($e),se.current=At},1e3);return()=>clearTimeout(Oe)},[T,Ct,De]),reactExports.useEffect(()=>{!Y.current&&T.length===0&&y.greetingMessage&&!qe&&(Y.current=!0,nt([{id:"greeting",role:"assistant",content:y.greetingMessage,timestamp:Date.now()}]))},[y.greetingMessage,T.length,nt,kt,qe]);const Ce=reactExports.useCallback((ft=!1)=>{const At=z.current;At&&At.scrollTo({top:At.scrollHeight,behavior:ft?"instant":"smooth"})},[]);reactExports.useEffect(()=>{Ce()},[T,Ct,Ce]),reactExports.useEffect(()=>{!Ct&&window.innerWidth>=1024&&re.current?.focus({preventScroll:!0})},[Ct]),reactExports.useEffect(()=>{const ft=re.current;if(!ft)return;const At=()=>{window.innerWidth<1024&&setTimeout(()=>{Ce(!0)},300)};return ft.addEventListener("focus",At),()=>ft.removeEventListener("focus",At)},[Ce]);const Ee=async ft=>{const At=ft||$;!At.trim()||Ct||(At.toLowerCase(),R(""),window.innerWidth>=1024&&setTimeout(()=>{re.current?.focus({preventScroll:!0})},0),await vt(At))},Pe=ft=>{ft.key==="Enter"&&!ft.shiftKey&&(ft.preventDefault(),Ee())},je=ft=>{Ct||Ee(ft)},He=ft=>{b&&b.onAction(ft)},Ve=()=>{O([]),nt([]),Y.current=!1,se.current="",be(),ze()},dt=reactExports.useCallback(ft=>{Re(ft),Xe(ft),ie(!1)},[Re,Xe]),xt=async ft=>{const At=Ke?.id===ft;Ae(ft),ae(null),At&&Ve();try{await Be(),ee.current&&Te()}catch(Oe){console.error("Failed to sync after deleting session:",Oe)}},mt=async()=>{ge(),j(!1),Ve();try{await Be(),ee.current&&Te()}catch(ft){console.error("Failed to sync after clearing history:",ft)}},gt=ft=>b?typeof b.label=="function"?b.label(ft):b.label:"",at=ft=>{const Oe=Date.now()-ft,$e=Math.floor(Oe/6e4),ke=Math.floor(Oe/36e5),Ue=Math.floor(Oe/864e5);return $e<1?"Just now":$e<60?`${$e}m ago`:ke<24?`${ke}h ago`:Ue<7?`${Ue}d ago`:new Date(ft).toLocaleDateString()},ht=ft=>{switch(ft.currentStep){case"initializing":return{label:"Initializing...",icon:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}),color:"text-blue-500"};case"resolving-ipns":return{label:"Looking up...",icon:jsxRuntimeExports.jsx(Cloud,{className:"w-3 h-3"}),color:"text-blue-500"};case"fetching-content":return{label:"Downloading...",icon:jsxRuntimeExports.jsx(Cloud,{className:"w-3 h-3 animate-pulse"}),color:"text-blue-500"};case"importing-data":return{label:"Importing...",icon:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}),color:"text-blue-500"};case"building-data":return{label:"Preparing...",icon:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}),color:"text-amber-500"};case"uploading":return{label:"Uploading...",icon:jsxRuntimeExports.jsx(Cloud,{className:"w-3 h-3 animate-pulse"}),color:"text-amber-500"};case"publishing-ipns":return{label:"Publishing...",icon:jsxRuntimeExports.jsx(Cloud,{className:"w-3 h-3 animate-pulse"}),color:"text-amber-500"};case"complete":return{label:"Synced",icon:jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"}),color:"text-green-500"};case"error":return{label:"Sync error",icon:jsxRuntimeExports.jsx(CircleAlert,{className:"w-3 h-3"}),color:"text-red-500"};case"idle":default:return ft.isError?{label:"Sync error",icon:jsxRuntimeExports.jsx(CircleAlert,{className:"w-3 h-3"}),color:"text-red-500"}:{label:"Synced",icon:jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"}),color:"text-neutral-400"}}},_t=()=>{if(Le)return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-green-500 px-2 py-1 rounded-lg bg-neutral-100 dark:bg-neutral-800/50",children:[jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{children:"Successfully deleted"})]});const{label:ft,icon:At,color:Oe}=ht(Se);return jsxRuntimeExports.jsxs("div",{className:`flex items-center gap-1.5 text-xs ${Oe} px-2 py-1 rounded-lg bg-neutral-100 dark:bg-neutral-800/50`,children:[At,jsxRuntimeExports.jsx("span",{children:Se.stepProgress||ft})]})},$t=()=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatePresence,{children:J&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"lg:hidden absolute inset-0 bg-black/50 z-40 rounded-3xl",onClick:()=>ie(!1)})}),jsxRuntimeExports.jsxs("div",{className:`
          w-64 border-r border-neutral-200 dark:border-neutral-800/50 flex flex-col z-50 overflow-hidden
          absolute lg:relative inset-y-0 left-0
          transform transition-all duration-300 ease-in-out
          ${J?"translate-x-0":"-translate-x-full lg:translate-x-0"}
          ${oe?"lg:w-0 lg:border-0 lg:min-w-0":"lg:w-64"}
          bg-white/95 dark:bg-neutral-900/95 lg:bg-transparent dark:lg:bg-transparent backdrop-blur-xl lg:backdrop-blur-none rounded-l-3xl lg:rounded-none
        `,children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800/50",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[A?jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>we(!ye),className:"text-neutral-900 dark:text-white font-medium flex items-center gap-2 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors",children:[de==="history"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Clock,{className:"w-4 h-4"}),"Chat History"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Activity,{className:"w-4 h-4"}),A.title]}),jsxRuntimeExports.jsx(ChevronDown,{className:`w-4 h-4 transition-transform ${ye?"rotate-180":""}`})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:ye&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"absolute top-full left-0 mt-1 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-lg shadow-lg overflow-hidden z-10 min-w-[160px]",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>{fe("history"),we(!1)},className:`w-full px-3 py-2 text-sm text-left flex items-center gap-2 transition-colors ${de==="history"?"bg-neutral-100 dark:bg-neutral-700 text-neutral-900 dark:text-white":"text-neutral-600 dark:text-neutral-400 hover:bg-neutral-50 dark:hover:bg-neutral-700/50"}`,children:[jsxRuntimeExports.jsx(Clock,{className:"w-4 h-4"}),"Chat History"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{fe("activity"),we(!1)},className:`w-full px-3 py-2 text-sm text-left flex items-center gap-2 transition-colors ${de==="activity"?"bg-neutral-100 dark:bg-neutral-700 text-neutral-900 dark:text-white":"text-neutral-600 dark:text-neutral-400 hover:bg-neutral-50 dark:hover:bg-neutral-700/50"}`,children:[jsxRuntimeExports.jsx(Activity,{className:"w-4 h-4"}),A.title]})]})})]}):jsxRuntimeExports.jsxs("h3",{className:"text-neutral-900 dark:text-white font-medium flex items-center gap-2",children:[jsxRuntimeExports.jsx(Clock,{className:"w-4 h-4"}),"Chat History"]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[de==="history"&&jsxRuntimeExports.jsx(motion.button,{onClick:Ve,className:`p-2 rounded-lg bg-linear-to-br ${y.color} text-white`,whileHover:{scale:1.05},whileTap:{scale:.95},title:"New chat",children:jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(motion.button,{onClick:()=>le(!0),className:"hidden lg:flex p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors",title:"Collapse sidebar",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(PanelLeftClose,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(motion.button,{onClick:()=>ie(!1),className:"lg:hidden p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800/50 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700/50 transition-colors",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]}),(!A||de==="history")&&jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400"}),jsxRuntimeExports.jsx("input",{type:"text",value:pe,onChange:ft=>ve(ft.target.value),placeholder:"Search history...",className:"w-full pl-9 pr-3 py-2 bg-neutral-100 dark:bg-neutral-800/50 border border-neutral-200 dark:border-neutral-700/50 rounded-lg text-sm text-neutral-900 dark:text-white placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-600"})]})]}),(!A||de==="history")&&jsxRuntimeExports.jsx("div",{className:"px-3 py-2 border-b border-neutral-200 dark:border-neutral-800/50",children:_t()}),!A||de==="history"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:et.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center text-neutral-500 py-8",children:[jsxRuntimeExports.jsx(MessageSquare,{className:"w-8 h-8 mx-auto opacity-50 mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:pe?"No matching conversations":"No chat history yet"})]}):et.map(ft=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:`
                        p-3 rounded-xl cursor-pointer transition-colors group relative
                        ${Ke?.id===ft.id?"bg-neutral-200 dark:bg-neutral-700/50 border border-neutral-300 dark:border-neutral-600":"bg-neutral-100 dark:bg-neutral-800/50 border border-neutral-200 dark:border-neutral-700/30 hover:bg-neutral-200 dark:hover:bg-neutral-700/50"}
                      `,onClick:()=>dt(ft.id),children:[jsxRuntimeExports.jsxs("div",{className:"pr-8",children:[jsxRuntimeExports.jsx("p",{className:"text-neutral-900 dark:text-white text-sm font-medium truncate",children:ft.title}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 text-xs truncate mt-1",children:ft.preview||"No preview"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-neutral-400",children:[jsxRuntimeExports.jsx(Clock,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{children:at(ft.updatedAt)}),jsxRuntimeExports.jsx("span",{children:""}),jsxRuntimeExports.jsxs("span",{children:[ft.messageCount," messages"]})]})]}),jsxRuntimeExports.jsx(motion.button,{onClick:At=>{At.stopPropagation(),ae(ft.id)},className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg opacity-0 group-hover:opacity-100 text-neutral-400 hover:text-red-500 hover:bg-red-500/10 transition-all",whileHover:{scale:1.1},whileTap:{scale:.9},children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]},ft.id))}),ue.length>0&&jsxRuntimeExports.jsx("div",{className:"p-3 border-t border-neutral-200 dark:border-neutral-800/50",children:jsxRuntimeExports.jsxs("button",{onClick:()=>j(!0),className:"w-full py-2 px-3 rounded-lg text-sm text-red-500 hover:bg-red-500/10 transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"}),"Clear all history"]})})]}):jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:A.items.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center text-neutral-500 py-8",children:[A.emptyIcon||jsxRuntimeExports.jsx(Activity,{className:"w-8 h-8 mx-auto opacity-50 mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:A.emptyText})]}):A.items.map(ft=>jsxRuntimeExports.jsx("div",{children:A.renderItem(ft,()=>A.onItemClick?.(ft))},ft.id))})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:he&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4",onClick:()=>ae(null),children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 rounded-2xl p-6 max-w-sm w-full shadow-xl",onClick:ft=>ft.stopPropagation(),children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-neutral-900 dark:text-white mb-2",children:"Delete conversation?"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm mb-6",children:"This action cannot be undone."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ae(null),className:"flex-1 py-2 px-4 rounded-lg bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-white font-medium border border-neutral-200 dark:border-neutral-700",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:()=>xt(he),className:"flex-1 py-2 px-4 rounded-lg bg-red-500 text-white font-medium",children:"Delete"})]})]})})}),jsxRuntimeExports.jsx(AnimatePresence,{children:Q&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4",onClick:()=>j(!1),children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 rounded-2xl p-6 max-w-sm w-full shadow-xl",onClick:ft=>ft.stopPropagation(),children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-neutral-900 dark:text-white mb-2",children:"Clear all history?"}),jsxRuntimeExports.jsxs("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm mb-6",children:["This will delete all ",ue.length," conversations. This action cannot be undone."]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>j(!1),className:"flex-1 py-2 px-4 rounded-lg bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-white font-medium border border-neutral-200 dark:border-neutral-700",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:mt,className:"flex-1 py-2 px-4 rounded-lg bg-red-500 text-white font-medium",children:"Clear all"})]})]})})})]}),St=()=>jsxRuntimeExports.jsxs("div",{className:"grid grid-rows-[auto_1fr_auto] z-10 h-full min-h-0",children:[jsxRuntimeExports.jsx(ChatHeader,{agent:y,onToggleSidebar:()=>ie(!0),onExpandSidebar:()=>le(!1),showMenuButton:!0,sidebarCollapsed:oe}),jsxRuntimeExports.jsxs("div",{ref:z,className:"overflow-y-auto p-4 space-y-4 min-h-0",children:[jsxRuntimeExports.jsx(AnimatePresence,{children:Le&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex items-center justify-center gap-2 px-4 py-3 bg-green-500/10 border border-green-500/20 rounded-xl text-green-600 dark:text-green-400 text-sm font-medium",children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"}),"Successfully deleted"]})}),jsxRuntimeExports.jsx(AnimatePresence,{initial:!1,children:T.map(ft=>{const At=ft.id===T[T.length-1]?.id,Oe=Ct&&At;return jsxRuntimeExports.jsxs(ChatBubble,{role:ft.role,content:ft.content,agentName:y.name,agentColor:y.color,thinking:ft.thinking,showCopy:!0,isCopied:B===ft.id,onCopy:()=>Me(ft.content,ft.id),isStreaming:Oe,currentStatus:Oe?ot:null,children:[ft.cardData&&v&&v(ft.cardData,ft),w&&w(ft),ft.showActionButton&&ft.cardData&&b&&jsxRuntimeExports.jsx(motion.button,{onClick:()=>He(ft.cardData),className:`mt-2 w-full py-3 rounded-xl bg-linear-to-r ${y.color} text-white font-medium`,whileHover:{scale:1.02},whileTap:{scale:.98},children:gt(ft.cardData)})]},ft.id)})})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white/95 dark:bg-neutral-900/95 backdrop-blur-sm theme-transition",children:[y.quickActions&&jsxRuntimeExports.jsx(QuickActions,{actions:y.quickActions,onAction:je,disabled:Ct}),jsxRuntimeExports.jsx(ChatInput,{ref:re,value:$,onChange:R,onSend:()=>Ee(),onKeyDown:Pe,placeholder:y.placeholder||`Message ${y.name}...`,disabled:!1,isStreaming:ut,onStop:bt,agentColor:y.color})]})]});return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"bg-white/60 dark:bg-neutral-900/70 backdrop-blur-xl rounded-3xl border border-neutral-200 dark:border-neutral-800/50 overflow-hidden relative lg:grid lg:grid-cols-[auto_1fr] lg:shadow-xl dark:lg:shadow-2xl h-full min-h-0 theme-transition",children:[jsxRuntimeExports.jsx("div",{className:`absolute -top-20 -right-20 w-96 h-96 ${S.from} rounded-full blur-3xl`}),jsxRuntimeExports.jsx("div",{className:`absolute -bottom-20 -left-20 w-96 h-96 ${S.to} rounded-full blur-3xl`}),$t(),St()]}),E]})}function SportChat({agent:y}){const[u,g]=reactExports.useState(!1),[v,b]=reactExports.useState(null),[w,E]=reactExports.useState(null),[S,A]=reactExports.useState("10"),[$,R]=reactExports.useState("confirm"),T=async(U,q)=>{if(await new Promise(J=>setTimeout(J,1e3)),U.includes("match")||U.includes("football")||U.includes("bet")||U.includes("game")){const J=mockMatches[Math.floor(Math.random()*mockMatches.length)];q(`Great choice! Here's an upcoming match:

${J.team1Flag} **${J.team1}** vs **${J.team2}** ${J.team2Flag}

**Date:** ${J.date} at ${J.time}

**Odds:**
- ${J.team1} wins: ${J.odds1}
- Draw: ${J.oddsDraw}
- ${J.team2} wins: ${J.odds2}

Would you like to place a bet on this match?`,{match:J},!0)}else if(U.includes("hello")||U.includes("hi"))q("Hey there! Ready to place some bets? Tell me what sport or match you're interested in!");else{const J=mockMatches[0];q(`I found a great match for you!

${J.team1Flag} **${J.team1}** vs **${J.team2}** ${J.team2Flag}

**Date:** ${J.date} at ${J.time}

**Odds:**
- ${J.team1} wins: ${J.odds1}
- Draw: ${J.oddsDraw}
- ${J.team2} wins: ${J.odds2}

Click the button below to place your bet!`,{match:J},!0)}},O=U=>{b(U.match),E({choice:U.match.team1,odds:U.match.odds1}),A("10"),R("confirm"),g(!0)},B=async()=>{!v||!w||(R("processing"),await new Promise(U=>setTimeout(U,2e3)),R("success"),await new Promise(U=>setTimeout(U,1500)),g(!1),b(null),E(null))},F=(U,q)=>{E({choice:U,odds:q})};return jsxRuntimeExports.jsx(AgentChat,{agent:y,getMockResponse:T,renderMessageCard:U=>jsxRuntimeExports.jsxs("div",{className:"mt-4 rounded-xl overflow-hidden border border-neutral-300 dark:border-neutral-600/50",children:[jsxRuntimeExports.jsx("img",{src:U.match.image,alt:"Match",className:"w-full h-32 object-cover"}),jsxRuntimeExports.jsxs("div",{className:"p-3 bg-neutral-100 dark:bg-neutral-900/80",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between text-lg font-medium text-neutral-900 dark:text-white",children:[jsxRuntimeExports.jsxs("span",{children:[U.match.team1Flag," ",U.match.team1]}),jsxRuntimeExports.jsx("span",{className:"text-neutral-500",children:"vs"}),jsxRuntimeExports.jsxs("span",{children:[U.match.team2," ",U.match.team2Flag]})]}),jsxRuntimeExports.jsxs("p",{className:"text-center text-neutral-500 dark:text-neutral-400 text-sm mt-1",children:[U.match.date," - ",U.match.time]})]})]}),actionConfig:{label:"Place Bet",onAction:O},bgGradient:{from:"bg-emerald-500/5",to:"bg-teal-500/5"},additionalContent:jsxRuntimeExports.jsx(AnimatePresence,{children:u&&v&&w&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 dark:bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>$==="confirm"&&g(!1),children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 rounded-2xl p-6 max-w-md w-full shadow-2xl",onClick:U=>U.stopPropagation(),children:[$==="confirm"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white",children:"Confirm Bet"}),jsxRuntimeExports.jsx("button",{onClick:()=>g(!1),className:"text-neutral-400 hover:text-neutral-900 dark:hover:text-white",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-xl overflow-hidden border border-neutral-200 dark:border-neutral-700 mb-4",children:[jsxRuntimeExports.jsx("img",{src:v.image,alt:"",className:"w-full h-24 object-cover"}),jsxRuntimeExports.jsx("div",{className:"p-3 bg-neutral-100 dark:bg-neutral-800",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between font-medium text-neutral-900 dark:text-white",children:[jsxRuntimeExports.jsxs("span",{children:[v.team1Flag," ",v.team1]}),jsxRuntimeExports.jsx("span",{className:"text-neutral-500",children:"vs"}),jsxRuntimeExports.jsxs("span",{children:[v.team2," ",v.team2Flag]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"text-neutral-500 dark:text-neutral-400 text-sm mb-2 block",children:"Select your bet:"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>F(v.team1,v.odds1),className:`p-3 rounded-lg border text-center transition-all ${w.choice===v.team1?"border-emerald-500 bg-emerald-500/20 text-emerald-600 dark:text-emerald-400":"border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:border-neutral-300 dark:hover:border-neutral-600"}`,children:[jsxRuntimeExports.jsx("div",{className:"text-sm",children:v.team1}),jsxRuntimeExports.jsx("div",{className:"text-lg font-bold",children:v.odds1})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>F("Draw",v.oddsDraw),className:`p-3 rounded-lg border text-center transition-all ${w.choice==="Draw"?"border-emerald-500 bg-emerald-500/20 text-emerald-600 dark:text-emerald-400":"border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:border-neutral-300 dark:hover:border-neutral-600"}`,children:[jsxRuntimeExports.jsx("div",{className:"text-sm",children:"Draw"}),jsxRuntimeExports.jsx("div",{className:"text-lg font-bold",children:v.oddsDraw})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>F(v.team2,v.odds2),className:`p-3 rounded-lg border text-center transition-all ${w.choice===v.team2?"border-emerald-500 bg-emerald-500/20 text-emerald-600 dark:text-emerald-400":"border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:border-neutral-300 dark:hover:border-neutral-600"}`,children:[jsxRuntimeExports.jsx("div",{className:"text-sm",children:v.team2}),jsxRuntimeExports.jsx("div",{className:"text-lg font-bold",children:v.odds2})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("label",{className:"text-neutral-500 dark:text-neutral-400 text-sm mb-2 block",children:"Bet amount (USDT):"}),jsxRuntimeExports.jsx("div",{className:"flex gap-2",children:["5","10","25","50","100"].map(U=>jsxRuntimeExports.jsx("button",{onClick:()=>A(U),className:`flex-1 py-2 rounded-lg border transition-all ${S===U?"border-emerald-500 bg-emerald-500/20 text-emerald-600 dark:text-emerald-400":"border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:border-neutral-300 dark:hover:border-neutral-600"}`,children:U},U))})]}),jsxRuntimeExports.jsxs("div",{className:"bg-neutral-100 dark:bg-neutral-800 rounded-xl p-4 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-neutral-500 dark:text-neutral-400 mb-2",children:[jsxRuntimeExports.jsx("span",{children:"Your bet:"}),jsxRuntimeExports.jsxs("span",{className:"text-neutral-900 dark:text-white",children:[S," USDT"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-neutral-500 dark:text-neutral-400",children:[jsxRuntimeExports.jsx("span",{children:"Potential win:"}),jsxRuntimeExports.jsxs("span",{className:"text-emerald-600 dark:text-emerald-400 font-bold",children:[(parseFloat(S)*w.odds).toFixed(2)," USDT"]})]})]}),jsxRuntimeExports.jsxs(motion.button,{onClick:B,className:"w-full py-4 rounded-xl bg-linear-to-r from-emerald-500 to-teal-500 text-white font-bold flex items-center justify-center gap-2",whileHover:{scale:1.02},whileTap:{scale:.98},children:[jsxRuntimeExports.jsx(Wallet$1,{className:"w-5 h-5"}),"Confirm & Pay"]})]}),$==="processing"&&jsxRuntimeExports.jsxs("div",{className:"py-12 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-emerald-500/20 flex items-center justify-center",children:jsxRuntimeExports.jsx(motion.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:jsxRuntimeExports.jsx(Wallet$1,{className:"w-8 h-8 text-emerald-600 dark:text-emerald-500"})})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white mb-2",children:"Processing Transaction"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"Please wait while we confirm your bet..."})]}),$==="success"&&jsxRuntimeExports.jsxs("div",{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},className:"w-16 h-16 mx-auto mb-4 rounded-full bg-emerald-500 flex items-center justify-center",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-8 h-8 text-white"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white mb-2",children:"Bet Placed!"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"Good luck with your bet!"})]})]})})})})}function P2PChat({agent:y}){const u=useNavigate(),[g,v]=reactExports.useState(!1),[b,w]=reactExports.useState(null),[E,S]=reactExports.useState("confirm"),A=(O,B,F,U,q)=>{const J=new URLSearchParams({sellerId:O.id,...B&&{product:B},...F&&{image:F},...U&&{price:U.toString()},...q});u(`/agents/chat?${J.toString()}`)},$=async(O,B)=>{if(await new Promise(F=>setTimeout(F,800)),O.includes("sofa")||O.includes("couch")||O.includes("furniture")){const F=p2pListings[0];B(`Found a great deal!

**${F.name}**
${F.description}

**Seller:** ${F.seller.name}
**Location:** ${F.location}
**Price:** $${F.price}

Interested?`,{title:F.name,image:F.image,price:F.price,description:F.description,seller:F.seller},!0)}else if(O.includes("phone")||O.includes("iphone")||O.includes("mobile")){const F=p2pListings[1];B(`Check this out!

**${F.name}**
${F.description}

**Seller:** ${F.seller.name}
**Location:** ${F.location}
**Price:** $${F.price}

Want to buy?`,{title:F.name,image:F.image,price:F.price,description:F.description,seller:F.seller},!0)}else if(O.includes("bike")||O.includes("bicycle")){const F=p2pListings[2];B(`Perfect for you!

**${F.name}**
${F.description}

**Seller:** ${F.seller.name}
**Location:** ${F.location}
**Price:** $${F.price}

Ready to ride?`,{title:F.name,image:F.image,price:F.price,description:F.description,seller:F.seller},!0)}else if(O.includes("pc")||O.includes("computer")||O.includes("gaming")){const F=p2pListings[3];B(`Beast machine!

**${F.name}**
${F.description}

**Seller:** ${F.seller.name}
**Location:** ${F.location}
**Price:** $${F.price}

Level up?`,{title:F.name,image:F.image,price:F.price,description:F.description,seller:F.seller},!0)}else O.includes("available")||O.includes("show")||O.includes("what")||O.includes("list")?B(`Here's what people are selling:

`+p2pListings.map(F=>`- **${F.name}** - $${F.price} (${F.seller.name})`).join(`
`)+`

Ask me about any item!`):B(`I can help you find great deals!

Try asking for:
- Furniture (sofas, chairs)
- Electronics (phones, computers)
- Sports equipment (bikes)

Or say "What's available?" to browse!`)},R=O=>{w(O),S("confirm"),v(!0)},T=async()=>{b&&(S("processing"),await new Promise(O=>setTimeout(O,2e3)),S("success"),await new Promise(O=>setTimeout(O,1500)),v(!1),w(null))};return jsxRuntimeExports.jsx(AgentChat,{agent:y,getMockResponse:$,renderMessageCard:O=>jsxRuntimeExports.jsx("div",{className:"mt-4 rounded-xl overflow-hidden border border-neutral-300 dark:border-neutral-600/50",children:jsxRuntimeExports.jsx("img",{src:O.image,alt:"",className:"w-full h-28 object-cover"})}),renderMessageActions:O=>O.cardData?.seller?jsxRuntimeExports.jsxs(motion.button,{onClick:()=>A(O.cardData.seller,O.cardData.title,O.cardData.image,O.cardData.price),className:"mt-3 w-full py-2 rounded-xl bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 text-sm font-medium flex items-center justify-center gap-2 border border-blue-500/30",whileHover:{scale:1.01},whileTap:{scale:.99},children:[jsxRuntimeExports.jsx(MessageSquare,{className:"w-4 h-4"}),"Contact ",O.cardData.seller.name]}):null,actionConfig:{label:O=>`Buy Now - $${O.price}`,onAction:R},bgGradient:{from:"bg-orange-500/5",to:"bg-red-500/5"},additionalContent:jsxRuntimeExports.jsx(AnimatePresence,{children:g&&b&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 dark:bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>E==="confirm"&&v(!1),children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 rounded-2xl p-6 max-w-md w-full shadow-2xl",onClick:O=>O.stopPropagation(),children:[E==="confirm"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white",children:"Confirm Purchase"}),jsxRuntimeExports.jsx("button",{onClick:()=>v(!1),className:"text-neutral-400 hover:text-neutral-900 dark:hover:text-white",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-xl overflow-hidden border border-neutral-200 dark:border-neutral-700 mb-4",children:[jsxRuntimeExports.jsx("img",{src:b.image,alt:"",className:"w-full h-32 object-cover"}),jsxRuntimeExports.jsxs("div",{className:"p-4 bg-neutral-100 dark:bg-neutral-800",children:[jsxRuntimeExports.jsx("p",{className:"text-neutral-900 dark:text-white font-medium",children:b.title}),b.description&&jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm mt-1",children:b.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-3 p-2 bg-neutral-200 dark:bg-neutral-700/50 rounded-lg",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs font-medium",children:b.seller.avatar}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-neutral-900 dark:text-white text-sm font-medium",children:b.seller.name}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-xs",children:"Seller"})]})]}),jsxRuntimeExports.jsxs("p",{className:"text-orange-600 dark:text-orange-400 text-lg font-bold mt-3",children:["$",b.price]})]})]}),jsxRuntimeExports.jsxs(motion.button,{onClick:T,className:`w-full py-4 rounded-xl bg-linear-to-r ${y.color} text-white font-bold flex items-center justify-center gap-2`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[jsxRuntimeExports.jsx(Wallet$1,{className:"w-5 h-5"}),"Confirm & Pay"]})]}),E==="processing"&&jsxRuntimeExports.jsxs("div",{className:"py-12 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-orange-500/20 flex items-center justify-center",children:jsxRuntimeExports.jsx(motion.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:jsxRuntimeExports.jsx(Wallet$1,{className:"w-8 h-8 text-orange-600 dark:text-orange-500"})})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white mb-2",children:"Processing"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"Contacting seller..."})]}),E==="success"&&jsxRuntimeExports.jsxs("div",{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},className:"w-16 h-16 mx-auto mb-4 rounded-full bg-green-500 flex items-center justify-center",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-8 h-8 text-white"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white mb-2",children:"Seller Notified!"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"They will contact you soon."})]})]})})})})}function MerchChat({agent:y}){const[u,g]=reactExports.useState(!1),[v,b]=reactExports.useState(null),[w,E]=reactExports.useState("confirm"),S=async(R,T)=>{if(await new Promise(O=>setTimeout(O,800)),R.includes("hoodie")||R.includes("sweatshirt")){const O=merchItems[0];T(`Great choice!

**${O.name}**
${O.description}

**Sizes:** ${O.sizes.join(", ")}
**Price:** $${O.price}

Our bestseller!`,{title:O.name,image:O.image,price:O.price,description:O.description},!0)}else if(R.includes("shirt")||R.includes("tee")){const O=merchItems[1];T(`Classic style!

**${O.name}**
${O.description}

**Sizes:** ${O.sizes.join(", ")}
**Price:** $${O.price}

Comfortable and stylish!`,{title:O.name,image:O.image,price:O.price,description:O.description},!0)}else if(R.includes("cap")||R.includes("hat")){const O=merchItems[2];T(`Looking sharp!

**${O.name}**
${O.description}

**Size:** ${O.sizes.join(", ")}
**Price:** $${O.price}`,{title:O.name,image:O.image,price:O.price,description:O.description},!0)}else if(R.includes("mug")||R.includes("cup")){const O=merchItems[3];T(`For your coding sessions!

**${O.name}**
${O.description}

**Price:** $${O.price}

The logo changes color with hot drinks!`,{title:O.name,image:O.image,price:O.price,description:O.description},!0)}else R.includes("store")||R.includes("show")||R.includes("what")||R.includes("all")||R.includes("available")?T(`Here's our collection:

`+merchItems.map(O=>`- **${O.name}** - $${O.price}`).join(`
`)+`

Ask me about any item for details!`):R.includes("test")||R.includes("image")||R.includes("base64")?T(`**Test: Base64 Image in Markdown**

Here's an image rendered from base64:

![Sphere Logo](`+"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM4QjVDRjYiLz48c3RvcCBvZmZzZXQ9IjUwJSIgc3RvcC1jb2xvcj0iI0VDNDg5OSIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iI0Y5NzMxNiIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTAwIiBmaWxsPSJ1cmwoI2cpIiByeD0iMTIiLz48dGV4dCB4PSIxMDAiIHk9IjU1IiBmb250LWZhbWlseT0ic3lzdGVtLXVpIiBmb250LXNpemU9IjIwIiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlNwaGVyZTwvdGV4dD48L3N2Zz4="+")\n\nThis works with any `data:image/...;base64,...` URL!"):T(`I can help you find the perfect merch!

We have:
- Clothing (hoodies, t-shirts)
- Accessories (caps, mugs)

Just tell me what you're looking for!`)},A=R=>{b(R),E("confirm"),g(!0)},$=async()=>{v&&(E("processing"),await new Promise(R=>setTimeout(R,2e3)),E("success"),await new Promise(R=>setTimeout(R,1500)),g(!1),b(null))};return jsxRuntimeExports.jsx(AgentChat,{agent:y,getMockResponse:S,renderMessageCard:R=>jsxRuntimeExports.jsx("div",{className:"mt-4 rounded-xl overflow-hidden border border-neutral-300 dark:border-neutral-600/50",children:jsxRuntimeExports.jsx("img",{src:R.image,alt:"",className:"w-full h-28 object-cover"})}),actionConfig:{label:R=>`Order Now - $${R.price}`,onAction:A},bgGradient:{from:"bg-purple-500/5",to:"bg-pink-500/5"},additionalContent:jsxRuntimeExports.jsx(AnimatePresence,{children:u&&v&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 dark:bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>w==="confirm"&&g(!1),children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 rounded-2xl p-6 max-w-md w-full shadow-2xl",onClick:R=>R.stopPropagation(),children:[w==="confirm"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white",children:"Confirm Order"}),jsxRuntimeExports.jsx("button",{onClick:()=>g(!1),className:"text-neutral-400 hover:text-neutral-900 dark:hover:text-white",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-xl overflow-hidden border border-neutral-200 dark:border-neutral-700 mb-4",children:[jsxRuntimeExports.jsx("img",{src:v.image,alt:"",className:"w-full h-32 object-cover"}),jsxRuntimeExports.jsxs("div",{className:"p-4 bg-neutral-100 dark:bg-neutral-800",children:[jsxRuntimeExports.jsx("p",{className:"text-neutral-900 dark:text-white font-medium",children:v.title}),v.description&&jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm mt-1",children:v.description}),jsxRuntimeExports.jsxs("p",{className:"text-purple-600 dark:text-purple-400 text-lg font-bold mt-2",children:["$",v.price]})]})]}),jsxRuntimeExports.jsxs(motion.button,{onClick:$,className:`w-full py-4 rounded-xl bg-linear-to-r ${y.color} text-white font-bold flex items-center justify-center gap-2`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[jsxRuntimeExports.jsx(Wallet$1,{className:"w-5 h-5"}),"Confirm & Pay"]})]}),w==="processing"&&jsxRuntimeExports.jsxs("div",{className:"py-12 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-purple-500/20 flex items-center justify-center",children:jsxRuntimeExports.jsx(motion.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:jsxRuntimeExports.jsx(Wallet$1,{className:"w-8 h-8 text-purple-600 dark:text-purple-500"})})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white mb-2",children:"Processing"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"Confirming your order..."})]}),w==="success"&&jsxRuntimeExports.jsxs("div",{className:"py-12 text-center",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},className:"w-16 h-16 mx-auto mb-4 rounded-full bg-green-500 flex items-center justify-center",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-8 h-8 text-white"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white mb-2",children:"Order Placed!"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"Your merch is on the way!"})]})]})})})})}function TriviaChat({agent:y}){return jsxRuntimeExports.jsx(AgentChat,{agent:y,bgGradient:{from:"bg-indigo-500/5",to:"bg-cyan-500/5"}})}function GamesChat({agent:y}){const u=g=>(g.role!=="assistant"||g.cardData,g);return jsxRuntimeExports.jsx(AgentChat,{agent:y,processMessage:u,renderMessageCard:g=>jsxRuntimeExports.jsx("div",{className:"mt-4 space-y-3",children:g.games.map(v=>jsxRuntimeExports.jsxs("div",{className:"rounded-xl overflow-hidden border border-neutral-600/50",children:[jsxRuntimeExports.jsx("img",{src:v.image,alt:v.name,className:"w-full h-28 object-cover"}),jsxRuntimeExports.jsxs("div",{className:"p-3 bg-neutral-900/80",children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-white",children:v.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:v.description}),jsxRuntimeExports.jsxs("a",{href:v.url,target:"_blank",rel:"noopener noreferrer",className:`mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-linear-to-r ${y.color} text-white text-sm font-medium`,children:["Play Now ",jsxRuntimeExports.jsx(ExternalLink,{className:"w-3 h-3"})]})]})]},v.id))}),bgGradient:{from:"bg-purple-500/5",to:"bg-pink-500/5"}})}function AIChat({agent:y}){return jsxRuntimeExports.jsx(AgentChat,{agent:y,bgGradient:{from:"bg-orange-500/5",to:"bg-amber-500/5"}})}function AssetRow({asset:y,showBalances:u,delay:g,onClick:v,layer:b}){const w=y.change24h>=0?"text-emerald-500 dark:text-emerald-400":"text-red-500 dark:text-red-400",E=y.change24h>=0?"+":"",S=u?`$${y.getTotalFiatValue("USD").toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"",A=u?`${y.getFormattedAmount()} ${y.symbol}`:"";return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:g},layout:!0,whileHover:{x:4,backgroundColor:"var(--color-surface-hover)"},onClick:v,className:"p-3 rounded-xl transition-all cursor-pointer group border border-transparent hover:border-neutral-200/50 dark:hover:border-white/5",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"relative w-10 h-10 rounded-xl flex items-center justify-center overflow-hidden",children:y.iconUrl?jsxRuntimeExports.jsx("img",{src:y.iconUrl,alt:y.symbol,className:"w-full h-full object-cover"}):jsxRuntimeExports.jsx(Box,{className:"w-5 h-5 text-neutral-400 dark:text-neutral-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"text-neutral-900 dark:text-white font-medium text-sm",children:y.symbol}),b&&jsxRuntimeExports.jsx("span",{className:`px-1.5 py-0.5 text-[10px] font-bold rounded ${b==="L1"?"bg-blue-500/20 text-blue-600 dark:text-blue-400":"bg-orange-500/20 text-orange-600 dark:text-orange-400"}`,children:b}),jsxRuntimeExports.jsx("div",{className:"text-xs text-neutral-500 truncate max-w-[100px]",children:y.name})]}),jsxRuntimeExports.jsx("div",{className:"text-xs text-left text-neutral-500",children:A})]})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsx("div",{className:"text-neutral-900 dark:text-white font-medium text-sm",children:S}),jsxRuntimeExports.jsxs("div",{className:`text-xs ${w} flex justify-end items-center`,children:[E,y.change24h.toFixed(2),"%"]})]})]})})}const CurrencyUtils={toSmallestUnit:(y,u)=>{if(!y)return 0n;try{const[g,v=""]=y.split("."),b=v.padEnd(u,"0").slice(0,u);return BigInt(g+b)}catch(g){return console.error("Invalid amount format",g),0n}},toHumanReadable:(y,u)=>{const g=y.toString().padStart(u+1,"0"),v=g.slice(0,-u),b=g.slice(-u).replace(/0+$/,"");return b?`${v}.${b}`:v}},AmountFormatUtils={formatDisplayAmount:(y,u)=>{try{if(y===void 0||u===void 0)return"";const g=parseFloat(y),w=RegistryService.getInstance().getCoinDefinition(u)?.decimals??6,E=Math.pow(10,w),S=g/E;return new Intl.NumberFormat("en-US",{maximumFractionDigits:6}).format(S)}catch(g){return console.warn("Error formatting amount",g),y||""}}};function TokenRow({token:y,delay:u}){const[g,v]=reactExports.useState(!1),b=AmountFormatUtils.formatDisplayAmount(y.amount,y.coinId),w=E=>{E.stopPropagation(),navigator.clipboard.writeText(y.id),v(!0),setTimeout(()=>v(!1),2e3)};return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:u},className:"p-3 rounded-xl bg-neutral-50 dark:bg-neutral-800/30 border border-neutral-200/50 dark:border-white/5 hover:border-neutral-300 dark:hover:border-white/10 transition-all group",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"relative w-10 h-10 rounded-lg  flex items-center justify-center overflow-hidden",children:y.iconUrl?jsxRuntimeExports.jsx("img",{src:y.iconUrl,alt:y.symbol,className:"w-full h-full object-cover"}):jsxRuntimeExports.jsx(Box,{className:"w-5 h-5 text-neutral-400 dark:text-neutral-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-neutral-900 dark:text-white font-medium text-sm",children:`${b} ${y.symbol}`}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-neutral-500 font-mono cursor-pointer hover:text-orange-500 dark:hover:text-orange-400 transition-colors",onClick:w,children:[jsxRuntimeExports.jsxs("span",{children:["ID: ",y.id.slice(0,8),"..."]}),g?jsxRuntimeExports.jsx(CircleCheck,{className:"w-3 h-3"}):jsxRuntimeExports.jsx(Copy,{className:"w-3 h-3 opacity-0 group-hover:opacity-100"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-end gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold px-2 py-0.5 rounded-md bg-neutral-100 dark:bg-neutral-700/50 text-neutral-500 dark:text-neutral-400 border border-neutral-200 dark:border-neutral-700",children:"Token"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] text-neutral-400 dark:text-neutral-600",children:new Date(y.timestamp).toLocaleDateString()})]})]})})}const SESSION_KEY$2="user-pin-1234",INITIAL_POLL_INTERVAL=5e3,SUBSEQUENT_POLL_INTERVAL=3e4,FREQUENT_POLL_DURATION=6e4;function useAddressNametags(y){const[u,g]=reactExports.useState([]),v=reactExports.useRef(null),b=reactExports.useRef(!0),w=reactExports.useRef(new Set),E=reactExports.useRef(new Set);reactExports.useEffect(()=>(b.current=!0,()=>{b.current=!1,v.current&&clearTimeout(v.current)}),[]);const S=reactExports.useCallback(async R=>{try{const O=await IdentityManager.getInstance(SESSION_KEY$2).deriveIdentityFromPath(R),B=O.address,F=await fetchNametagFromIpns(O.privateKey),U=WalletRepository.checkNametagForAddress(B),q=WalletRepository.checkTokensForAddress(B),J=!!F.nametag||!!U||q;return{hasNametag:!!F.nametag,nametag:F.nametag||U?.name||void 0,ipnsName:F.ipnsName,ipnsError:F.error,hasL3Inventory:J,l3Address:B}}catch(T){return{hasNametag:!1,ipnsError:T instanceof Error?T.message:String(T),hasL3Inventory:!1}}},[]);reactExports.useEffect(()=>{if(!y||y.length===0){g([]),w.current.clear();return}const R=y.filter(O=>O.path&&!w.current.has(O.path));if(R.length===0)return;console.log(` [L1] Initializing ${R.length} new addresses for nametag fetch...`),R.forEach(O=>{O.path&&w.current.add(O.path)}),(async()=>{const O=await Promise.all(R.map(async F=>{try{const q=await IdentityManager.getInstance(SESSION_KEY$2).deriveIdentityFromPath(F.path),J=WalletRepository.checkNametagForAddress(q.address),ie=WalletRepository.checkTokensForAddress(q.address);if(J)return console.log(` [L1] Found local nametag for ${F.address.slice(0,12)}...: ${J.name}`),{address:F.address,path:F.path,index:F.index,isChange:F.isChange,ipnsLoading:!1,hasNametag:!0,nametag:J.name,l3Address:q.address,hasL3Inventory:!0,firstFetchTime:Date.now()};if(ie)return{address:F.address,path:F.path,index:F.index,isChange:F.isChange,ipnsLoading:!0,hasNametag:!1,nametag:void 0,l3Address:q.address,hasL3Inventory:!0,firstFetchTime:Date.now()}}catch(U){console.warn(`[L1] Error checking local nametag for ${F.address.slice(0,12)}...`,U)}return{address:F.address,path:F.path,index:F.index,isChange:F.isChange,ipnsLoading:!0,hasNametag:!1,nametag:void 0,firstFetchTime:Date.now()}}));if(!b.current)return;g(F=>[...F,...O]);const B=O.filter(F=>F.ipnsLoading);for(const F of B){if(!b.current)return;const U=R.find(J=>J.path===F.path);if(!U?.path||E.current.has(U.path))continue;E.current.add(U.path),console.log(` [L1] Fetching nametag for ${U.address.slice(0,12)}... (path: ${U.path})`);const q=await S(U.path);if(!b.current)return;console.log(` [L1] IPNS result for ${U.address.slice(0,12)}...: ${q.nametag||"none"}`),g(J=>J.map(ie=>ie.path===U.path?{...ie,ipnsLoading:!1,hasNametag:q.hasNametag,nametag:q.nametag,ipnsName:q.ipnsName,ipnsError:q.ipnsError,lastFetchTime:Date.now(),hasL3Inventory:q.hasL3Inventory,l3Address:q.l3Address}:ie)),E.current.delete(U.path)}})()},[y,S]),reactExports.useEffect(()=>{const R=()=>{v.current&&clearTimeout(v.current);const T=u.filter(q=>!q.hasNametag&&!q.ipnsLoading&&q.firstFetchTime&&!E.current.has(q.path));if(T.length===0)return;const O=Date.now(),F=T.some(q=>q.firstFetchTime&&O-q.firstFetchTime<FREQUENT_POLL_DURATION)?INITIAL_POLL_INTERVAL:SUBSEQUENT_POLL_INTERVAL,U=T.filter(q=>{if(!q.lastFetchTime)return!0;const J=O-q.lastFetchTime,oe=q.firstFetchTime&&O-q.firstFetchTime<FREQUENT_POLL_DURATION?INITIAL_POLL_INTERVAL:SUBSEQUENT_POLL_INTERVAL;return J>=oe});U.length>0?v.current=setTimeout(async()=>{if(b.current){console.log(` [L1] Polling ${U.length} addresses for nametags...`);for(const q of U){if(!b.current)return;if(E.current.has(q.path))continue;E.current.add(q.path),g(ie=>ie.map(oe=>oe.path===q.path?{...oe,ipnsLoading:!0}:oe));const J=await S(q.path);if(!b.current)return;J.hasNametag&&console.log(` [L1] Found nametag for ${q.address.slice(0,12)}...: ${J.nametag} (path=${q.path})`),g(ie=>ie.map(oe=>oe.path===q.path?{...oe,ipnsLoading:!1,hasNametag:J.hasNametag,nametag:J.nametag,ipnsName:J.ipnsName,ipnsError:J.ipnsError,lastFetchTime:Date.now(),hasL3Inventory:J.hasL3Inventory,l3Address:J.l3Address}:oe)),E.current.delete(q.path)}b.current&&R()}},100):v.current=setTimeout(()=>{b.current&&R()},F)};if(u.length>0){const T=setTimeout(()=>{b.current&&R()},1e3);return()=>{clearTimeout(T),v.current&&clearTimeout(v.current)}}},[u,S]);const A=reactExports.useCallback(async R=>{if(E.current.has(R))return;E.current.add(R),g(O=>O.map(B=>B.path===R?{...B,ipnsLoading:!0,hasNametag:!1,nametag:void 0}:B));const T=await S(R);g(O=>O.map(B=>B.path===R?{...B,ipnsLoading:!1,hasNametag:T.hasNametag,nametag:T.nametag,ipnsName:T.ipnsName,ipnsError:T.ipnsError,lastFetchTime:Date.now(),hasL3Inventory:T.hasL3Inventory,l3Address:T.l3Address}:B)),E.current.delete(R)},[S]),$={};for(const R of u)$[R.address]=R;return{nametagState:$,addressesWithNametags:u,refreshNametag:A}}function truncateNametag(y,u=12){return y.length<=u?y:`${y.slice(0,6)}...${y.slice(-3)}`}function AddressSelector({currentNametag:y,compact:u=!0}){const[g,v]=reactExports.useState(!1),[b,w]=reactExports.useState(!1),[E,S]=reactExports.useState(!1),{wallet:A,invalidateWallet:$}=useL1Wallet(),{nametagState:R,addressesWithNametags:T}=useAddressNametags(A?.addresses),O=reactExports.useMemo(()=>T.some(fe=>fe.ipnsLoading),[T]),B=localStorage.getItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH),F=reactExports.useMemo(()=>A?.addresses?B&&A.addresses.find(fe=>fe.path===B)||A.addresses[0]:null,[A?.addresses,B]),U=reactExports.useMemo(()=>A?.addresses?[...A.addresses].sort((fe,ye)=>{const we=fe.isChange?1:0,pe=ye.isChange?1:0;return we!==pe?we-pe:(fe.index??0)-(ye.index??0)}):[],[A?.addresses]),q=fe=>{const ye=A?.addresses.find(we=>we.address===fe);ye?.path?localStorage.setItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH,ye.path):localStorage.removeItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH),WalletRepository.getInstance().resetInMemoryState(),v(!1),window.location.reload()},J=async()=>{if(!(!A||E||O)){S(!0);try{const fe=generateAddress(A);loadWalletFromStorage("main")&&fe.path&&($(),localStorage.setItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH,fe.path),WalletRepository.getInstance().resetInMemoryState(),v(!1),window.location.reload())}catch(fe){console.error("Failed to generate address:",fe)}finally{S(!1)}}},ie=async()=>{if(y)try{await navigator.clipboard.writeText(`@${y}`),w(!0),setTimeout(()=>w(!1),2e3)}catch(fe){console.error("Failed to copy nametag:",fe)}},oe=F?R[F.address]:null,le=y||oe?.nametag,de=oe?.ipnsLoading;return!A?.addresses||A.addresses.length===0?null:u?jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>v(fe=>!fe),className:"flex items-center gap-1 text-[10px] sm:text-xs text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300 transition-colors",children:[de?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}):le?jsxRuntimeExports.jsxs("span",{className:"font-medium",title:`@${le}`,children:["@",truncateNametag(le)]}):jsxRuntimeExports.jsxs("span",{className:"font-mono",children:[F?.address.slice(0,8),"..."]}),jsxRuntimeExports.jsx(ChevronDown,{className:`w-3 h-3 transition-transform ${g?"rotate-180":""}`})]}),le&&jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:ie,className:"p-1 hover:bg-neutral-100 dark:hover:bg-neutral-800/80 rounded transition-colors",title:"Copy nametag",children:b?jsxRuntimeExports.jsx(Check,{className:"w-3 h-3 text-emerald-500"}):jsxRuntimeExports.jsx(Copy,{className:"w-3 h-3 text-neutral-500"})})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:g&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 bg-black/10",onClick:()=>v(!1)}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute left-0 top-full mt-2 z-50 min-w-[280px] bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 rounded-xl shadow-xl overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"px-3 py-2 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-medium text-neutral-500 dark:text-neutral-400 flex items-center gap-1.5",children:[O&&jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}),O?"Checking nametags...":`Addresses (${U.length})`]}),jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:E||O?1:1.05},whileTap:{scale:E||O?1:.95},onClick:J,disabled:E||O,className:"flex items-center gap-1 px-2 py-1 text-xs bg-orange-500/10 hover:bg-orange-500/20 text-orange-600 dark:text-orange-400 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed shrink-0",title:O?"Wait for nametag check to complete":"Create new address",children:[E?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}):jsxRuntimeExports.jsx(Plus,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{children:"New"})]})]}),jsxRuntimeExports.jsx("div",{className:"max-h-64 overflow-y-auto custom-scrollbar",children:U.map(fe=>{const ye=R[fe.address],we=fe.address===F?.address,pe=fe.isChange;return jsxRuntimeExports.jsxs("button",{onClick:()=>q(fe.address),className:`w-full flex items-center gap-2 px-3 py-2.5 text-left hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors ${we?"bg-orange-50 dark:bg-orange-900/20":""}`,children:[jsxRuntimeExports.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${we?"bg-orange-500":"bg-transparent"}`}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:!ye||ye.ipnsLoading?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin text-neutral-400"}),jsxRuntimeExports.jsxs("span",{className:"text-xs font-mono text-neutral-600 dark:text-neutral-400 truncate",children:[fe.address.slice(0,12),"...",fe.address.slice(-6)]})]}):ye.nametag?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-medium text-blue-600 dark:text-blue-400",children:["@",ye.nametag]}),jsxRuntimeExports.jsxs("span",{className:"text-xs font-mono text-neutral-400 dark:text-neutral-500",children:["(",fe.address.slice(0,8),"...",fe.address.slice(-6),")"]})]}):ye.hasL3Inventory?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-mono text-neutral-700 dark:text-neutral-300 truncate",children:[fe.address.slice(0,12),"...",fe.address.slice(-6)]}),jsxRuntimeExports.jsx("span",{className:"px-1 py-0.5 bg-purple-500/20 text-purple-600 dark:text-purple-400 text-[9px] font-bold rounded shrink-0",children:"L3"})]}):jsxRuntimeExports.jsxs("span",{className:"text-xs font-mono text-neutral-600 dark:text-neutral-400 truncate",children:[fe.address.slice(0,12),"...",fe.address.slice(-6)]})}),pe&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 bg-amber-500/20 text-amber-600 dark:text-amber-400 text-[9px] font-bold rounded shrink-0",children:"Change"})]},fe.address)})})]})]})})]}):jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>v(fe=>!fe),className:"flex items-center gap-2 px-3 py-2 bg-neutral-100 dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 hover:bg-neutral-200/50 dark:hover:bg-neutral-700/50 transition-colors",children:[de?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin text-neutral-400"}):le?jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:["@",le]}):jsxRuntimeExports.jsxs("span",{className:"text-sm font-mono text-neutral-700 dark:text-neutral-300",children:[F?.address.slice(0,8),"...",F?.address.slice(-6)]}),jsxRuntimeExports.jsx(ChevronDown,{className:`w-4 h-4 text-neutral-500 transition-transform ${g?"rotate-180":""}`})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:g&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40",onClick:()=>v(!1)}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute left-0 top-full mt-2 z-50 min-w-[300px] bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 rounded-xl shadow-xl overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"px-3 py-2 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-neutral-500 dark:text-neutral-400",children:"Select Address"}),jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:J,disabled:E,className:"flex items-center gap-1 px-2 py-1 text-xs bg-orange-500/10 hover:bg-orange-500/20 text-orange-600 dark:text-orange-400 rounded-lg transition-colors disabled:opacity-50",children:[E?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}):jsxRuntimeExports.jsx(Plus,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{children:"New Address"})]})]}),jsxRuntimeExports.jsx("div",{className:"max-h-64 overflow-y-auto custom-scrollbar",children:U.map(fe=>{const ye=R[fe.address],we=fe.address===F?.address;return jsxRuntimeExports.jsxs("button",{onClick:()=>q(fe.address),className:`w-full flex items-center gap-2 px-3 py-2.5 text-left hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors ${we?"bg-orange-50 dark:bg-orange-900/20":""}`,children:[jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full shrink-0 ${we?"bg-orange-500":"bg-transparent"}`}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:ye?.nametag?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:["@",ye.nametag]}),jsxRuntimeExports.jsxs("span",{className:"text-xs font-mono text-neutral-400",children:[fe.address.slice(0,6),"..."]})]}):jsxRuntimeExports.jsx("span",{className:"text-sm font-mono text-neutral-700 dark:text-neutral-300 truncate",children:fe.address})})]},fe.address)})})]})]})})]})}function SendModal$1({isOpen:y,onClose:u}){const{assets:g,sendAmount:v}=useWallet(),[b,w]=reactExports.useState("recipient"),[E,S]=reactExports.useState(""),[A,$]=reactExports.useState(!1),[R,T]=reactExports.useState(null),[O,B]=reactExports.useState(null),[F,U]=reactExports.useState(""),[q,J]=reactExports.useState(null),[ie,oe]=reactExports.useState(!1),le=ve=>{const he=ve.target.value.toLowerCase();/^[a-z0-9_\-+.]*$/.test(he)&&(S(he),T(null))},de=()=>{w("recipient"),S(""),B(null),U(""),J(null),T(null)},fe=()=>{de(),u()},ye=async()=>{if(E.trim()){$(!0),T(null);try{const ve=IdentityManager.getInstance(),he=NostrService.getInstance(ve),ae=E.replace("@","").replace("@unicity","").trim();await he.queryPubkeyByNametag(ae)?(S(ae),w("asset")):T(`User @${ae} not found`)}catch{T("Network error")}finally{$(!1)}}},we=async()=>{if(!O||!F)return;const ve=CurrencyUtils.toSmallestUnit(F,O.decimals);if(!(ve<=0n)){oe(!0);try{const he=new TokenSplitCalculator,Q=WalletRepository.getInstance().getTokens(),j=await he.calculateOptimalSplit(Q,ve,O.coinId);j?(J(j),w("confirm")):T("Insufficient funds or no suitable tokens")}catch(he){console.error(he)}finally{oe(!1)}}},pe=async()=>{if(!(!O||!F||!E)){w("processing");try{console.log(E),await v({recipientNametag:E,amount:CurrencyUtils.toSmallestUnit(F,O.decimals).toString(),coinId:O.coinId}),w("success")}catch(ve){console.error(ve),T(ve.message||"Transfer failed"),w("confirm")}}};return y?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:fe,className:"absolute inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm"}),jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"relative w-full max-w-md bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-6 border-b border-neutral-200 dark:border-white/5 flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-white",children:[b==="recipient"&&"Send To",b==="asset"&&"Select Asset",b==="amount"&&"Enter Amount",b==="confirm"&&"Confirm Transfer",b==="processing"&&"Processing...",b==="success"&&"Sent!"]}),jsxRuntimeExports.jsx("button",{onClick:fe,className:"p-2 hover:bg-neutral-100 dark:hover:bg-white/5 rounded-full transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-neutral-500 dark:text-neutral-400"})})]}),jsxRuntimeExports.jsx("div",{className:"p-6",children:jsxRuntimeExports.jsxs(AnimatePresence,{mode:"wait",children:[b==="recipient"&&jsxRuntimeExports.jsxs(motion.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-neutral-500 dark:text-neutral-400 block mb-2",children:"Unicity Nametag"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400 dark:text-neutral-500",children:"@"}),jsxRuntimeExports.jsx("input",{autoFocus:!0,value:E,onChange:le,onKeyDown:ve=>ve.key==="Enter"&&ye(),className:"w-full bg-neutral-100 dark:bg-neutral-900 border border-neutral-200 dark:border-white/10 rounded-xl py-3 pl-8 pr-4 text-neutral-900 dark:text-white focus:border-orange-500 outline-none",placeholder:"Unicity ID"})]}),R&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-sm mt-2",children:R})]}),jsxRuntimeExports.jsx("button",{onClick:ye,disabled:!E||A,className:"w-full py-3 bg-orange-500 hover:bg-orange-600 text-white font-medium rounded-xl flex items-center justify-center gap-2 transition-colors disabled:opacity-50",children:A?jsxRuntimeExports.jsx(LoaderCircle,{className:"animate-spin"}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Continue ",jsxRuntimeExports.jsx(ArrowRight,{size:18})]})})]},"rec"),b==="asset"&&jsxRuntimeExports.jsx(motion.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},className:"space-y-2",children:g.map(ve=>jsxRuntimeExports.jsxs("button",{onClick:()=>{B(ve),w("amount")},className:"w-full p-3 flex items-center gap-3 bg-neutral-50 dark:bg-neutral-900/50 hover:bg-neutral-100 dark:hover:bg-neutral-800 border border-neutral-200 dark:border-white/5 rounded-xl transition-colors text-left",children:[jsxRuntimeExports.jsx("img",{src:ve.iconUrl||"",className:"w-8 h-8 rounded-full",alt:""}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("div",{className:"text-neutral-900 dark:text-white font-medium",children:ve.symbol}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:[ve.getFormattedAmount()," available"]})]}),jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4 text-neutral-400 dark:text-neutral-600"})]},ve.coinId))},"asset"),b==="amount"&&O&&jsxRuntimeExports.jsxs(motion.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-neutral-500 dark:text-neutral-400",children:"Amount"}),jsxRuntimeExports.jsxs("span",{className:"text-neutral-500 dark:text-neutral-400",children:["Available: ",jsxRuntimeExports.jsx("span",{className:"text-neutral-900 dark:text-white",children:O.getFormattedAmount()})]})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{autoFocus:!0,type:"number",value:F,onChange:ve=>U(ve.target.value),className:"w-full bg-neutral-100 dark:bg-neutral-900 border border-neutral-200 dark:border-white/10 rounded-xl py-3 px-4 text-neutral-900 dark:text-white text-2xl font-mono focus:border-orange-500 outline-none",placeholder:"0.00"}),jsxRuntimeExports.jsx("button",{onClick:()=>U(O.getFormattedAmount()),className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs bg-neutral-200 dark:bg-neutral-800 text-orange-500 dark:text-orange-400 px-2 py-1 rounded hover:bg-neutral-300 dark:hover:bg-neutral-700",children:"MAX"})]}),R&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-sm mt-2",children:R})]}),jsxRuntimeExports.jsx("button",{onClick:we,disabled:!F||ie,className:"w-full py-3 bg-orange-500 hover:bg-orange-600 text-white font-medium rounded-xl flex items-center justify-center gap-2 transition-colors disabled:opacity-50",children:ie?jsxRuntimeExports.jsx(LoaderCircle,{className:"animate-spin"}):"Review"})]},"amt"),b==="confirm"&&O&&q&&jsxRuntimeExports.jsxs(motion.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},children:[jsxRuntimeExports.jsxs("div",{className:"bg-neutral-100 dark:bg-neutral-900 rounded-2xl p-5 mb-6 border border-neutral-200 dark:border-white/10 text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400 mb-1",children:"You are sending"}),jsxRuntimeExports.jsxs("div",{className:"text-3xl font-bold text-neutral-900 dark:text-white mb-4",children:[F," ",jsxRuntimeExports.jsx("span",{className:"text-orange-500",children:O.symbol})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm bg-neutral-200 dark:bg-neutral-800/50 p-2 rounded-lg mx-auto max-w-max",children:[jsxRuntimeExports.jsx(User,{className:"w-4 h-4 text-neutral-500 dark:text-neutral-400"}),jsxRuntimeExports.jsxs("span",{className:"text-neutral-700 dark:text-neutral-300",children:["@",E]})]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6 space-y-2",children:[jsxRuntimeExports.jsx("div",{className:"text-xs font-bold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider ml-1",children:"Strategy"}),q.requiresSplit?jsxRuntimeExports.jsxs("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-xl flex items-start gap-3",children:[jsxRuntimeExports.jsx(Scissors,{className:"w-5 h-5 text-blue-500 dark:text-blue-400 mt-0.5"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-blue-600 dark:text-blue-400 text-sm font-medium",children:"Token Split Required"}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:["We will take a token of ",jsxRuntimeExports.jsxs("b",{children:[CurrencyUtils.toHumanReadable(q.tokenToSplit.amount,O.decimals)," ",O.symbol]}),", send exact amount, and keep the change."]})]})]}):jsxRuntimeExports.jsxs("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-xl flex items-start gap-3",children:[jsxRuntimeExports.jsx(Coins,{className:"w-5 h-5 text-emerald-500 dark:text-emerald-400 mt-0.5"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-emerald-600 dark:text-emerald-400 text-sm font-medium",children:"Direct Transfer"}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:["We found ",q.tokensToTransferDirectly.length," token(s) that match the amount exactly. No split needed."]})]})]})]}),R&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-sm mb-4 text-center",children:R}),jsxRuntimeExports.jsx("button",{onClick:pe,className:"w-full py-3 bg-neutral-900 dark:bg-white text-white dark:text-black font-bold rounded-xl hover:bg-neutral-800 dark:hover:bg-neutral-200 transition-colors",children:"Confirm & Send"})]},"conf"),b==="processing"&&jsxRuntimeExports.jsxs(motion.div,{className:"py-10 text-center",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-12 h-12 text-orange-500 animate-spin mx-auto mb-4"}),jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white font-medium text-lg",children:"Sending Transaction..."}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 text-sm mt-2",children:"Processing proofs and broadcasting via Nostr"})]},"proc"),b==="success"&&jsxRuntimeExports.jsxs(motion.div,{className:"py-10 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-4 border border-emerald-500/50",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-8 h-8 text-emerald-500"})}),jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white font-bold text-2xl mb-2",children:"Success!"}),jsxRuntimeExports.jsxs("p",{className:"text-neutral-500 dark:text-neutral-400",children:["Successfully sent ",jsxRuntimeExports.jsxs("b",{children:[F," ",O?.symbol]})," to ",jsxRuntimeExports.jsxs("b",{children:["@",E]})]}),jsxRuntimeExports.jsx("button",{onClick:fe,className:"mt-8 px-8 py-2 bg-neutral-100 dark:bg-neutral-800 rounded-lg hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-900 dark:text-white transition-colors",children:"Close"})]},"done")]})})]})]}):null}const FAUCET_API_URL="https://faucet.unicity.network/api/v1/faucet/request";class FaucetService{static async requestTokens(u,g,v){console.log(` Requesting ${v} ${g} for @${u}...`);try{const b={unicityId:u,coin:g,amount:v};console.log(" Sending request:",b);const w=await fetch(FAUCET_API_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(console.log(` Response status for ${g}:`,w.status,w.statusText),!w.ok){const S=await w.text();throw console.error(` Failed response for ${g}:`,S),new Error(`Failed to request ${g}: ${w.statusText} - ${S}`)}const E=await w.json();return console.log(` Success for ${g}:`,E),{success:!0,coin:g,amount:v,...E}}catch(b){return console.error(` Faucet request failed for ${g}:`,b),{success:!1,message:b instanceof Error?b.message:"Unknown error",coin:g,amount:v}}}static async requestAllCoins(u){const g=[{coin:"unicity",amount:100},{coin:"bitcoin",amount:1},{coin:"solana",amount:1e3},{coin:"ethereum",amount:42},{coin:"tether",amount:1e3},{coin:"usd-coin",amount:1e3},{coin:"unicity-usd",amount:1e3}];console.log(` Starting parallel faucet requests for @${u}...`);const v=await Promise.all(g.map(({coin:w,amount:E})=>this.requestTokens(u,w,E)));console.log(" Faucet results:",v);const b=v.filter(w=>w.success).length;return console.log(` ${b}/${v.length} requests successful`),window.dispatchEvent(new Event("wallet-updated")),v}}function SwapModal({isOpen:y,onClose:u}){const{assets:g,sendAmount:v,nametag:b}=useWallet(),[w,E]=reactExports.useState("swap"),[S,A]=reactExports.useState(null),[$,R]=reactExports.useState(null),[T,O]=reactExports.useState(""),[B,F]=reactExports.useState(!1),[U,q]=reactExports.useState(!1),[J,ie]=reactExports.useState(null),[oe,le]=reactExports.useState([]);reactExports.useEffect(()=>{y&&(async()=>{const Q=RegistryService.getInstance();await Q.ensureInitialized();const j=await ApiService.fetchPrices(),z=Q.getAllDefinitions(),re=["bitcoin","ethereum","solana","unicity","tether","usd-coin","unicity-usd"],te=z.filter(ne=>ne.assetKind==="fungible"&&re.includes(ne.name.toLowerCase())).map(ne=>{const se=ne.symbol||ne.name.toUpperCase(),ee=ne.name.toLowerCase(),Z=j[ee],ue=Q.getIconUrl(ne);return new AggregatedAsset({coinId:ne.id,symbol:se,name:ne.name,totalAmount:"0",decimals:ne.decimals||0,tokenCount:0,iconUrl:ue,priceUsd:Z?.priceUsd||1,priceEur:Z?.priceEur||.92,change24h:Z?.change24h||0})});le(te)})()},[y]);const de=ae=>{const Q=g.find(j=>j.coinId===ae);return Q?Q.getFormattedAmount():"0"},fe=reactExports.useMemo(()=>{if(!S||!$||!T||parseFloat(T)<=0)return null;const ae=parseFloat(T),Q=S.priceUsd,j=$.priceUsd;if(j===0)return null;const z=Q/j,re=ae*z;return{rate:z,fromValueUSD:ae*Q,toAmount:re,toValueUSD:re*j}},[S,$,T]),ye=()=>{E("swap"),A(null),R(null),O(""),ie(null),F(!1),q(!1)},we=()=>{ye(),u()},pe=async()=>{if(!(!S||!$||!T||!fe||!b)){E("processing"),ie(null);try{const ae=CurrencyUtils.toSmallestUnit(T,S.decimals);await v({recipientNametag:"swap",amount:ae.toString(),coinId:S.coinId}),await FaucetService.requestTokens(b,$.name.toLowerCase(),fe.toAmount),E("success")}catch(ae){console.error("Swap failed:",ae),ie(ae.message||"Swap failed"),E("swap")}}},ve=()=>{if(!S||!$)return;const ae=g.find(j=>j.coinId===$.coinId),Q=oe.find(j=>j.coinId===S.coinId);if(!ae){ie(`You don't have any ${$.symbol} to swap from`);return}if(A(ae),R(Q||S),ie(null),fe&&fe.toAmount>0){const j=parseFloat(fe.toAmount.toFixed(6));O(j.toString())}else O("")},he=reactExports.useMemo(()=>{if(!S||!T)return!1;const ae=parseFloat(T);if(isNaN(ae)||ae<=0)return!1;const Q=parseFloat(S.getFormattedAmount());return ae<=Q},[S,T]);return y?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:we,className:"absolute inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm"}),jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"relative w-full max-w-md bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-6 border-b border-neutral-200 dark:border-white/5 flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-white",children:[w==="swap"&&"Swap Tokens",w==="processing"&&"Processing Swap...",w==="success"&&"Swap Complete!"]}),jsxRuntimeExports.jsx("button",{onClick:we,className:"p-2 hover:bg-neutral-100 dark:hover:bg-white/5 rounded-full transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-neutral-500 dark:text-neutral-400"})})]}),jsxRuntimeExports.jsx("div",{className:"p-6",children:jsxRuntimeExports.jsxs(AnimatePresence,{mode:"wait",children:[w==="swap"&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[jsxRuntimeExports.jsxs("div",{className:"mb-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-neutral-500 dark:text-neutral-400",children:"From"}),S&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate ml-2",children:["Balance: ",jsxRuntimeExports.jsx("span",{className:"text-neutral-900 dark:text-white",children:S.getFormattedAmount()})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900/50 rounded-2xl p-3 sm:p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"relative shrink-0",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>F(!B),className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-2 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-white/10 rounded-xl hover:bg-neutral-50 dark:hover:bg-neutral-700/50 transition-colors whitespace-nowrap",children:[S?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("img",{src:S.iconUrl||"",className:"w-5 h-5 sm:w-6 sm:h-6 rounded-full shrink-0",alt:""}),jsxRuntimeExports.jsx("span",{className:"text-neutral-900 dark:text-white font-medium text-sm sm:text-base",children:S.symbol})]}):jsxRuntimeExports.jsx("span",{className:"text-neutral-500 text-sm sm:text-base",children:"Select"}),jsxRuntimeExports.jsx(ArrowDown,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-neutral-400 shrink-0"})]}),B&&jsxRuntimeExports.jsx("div",{className:"absolute top-full left-0 mt-2 w-48 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-white/10 rounded-xl shadow-xl z-60 max-h-48 overflow-y-auto",children:g.map(ae=>jsxRuntimeExports.jsxs("button",{onClick:()=>{A(ae),F(!1),O("")},className:"w-full flex items-center gap-3 p-3 hover:bg-neutral-50 dark:hover:bg-neutral-700/50 transition-colors text-left",children:[jsxRuntimeExports.jsx("img",{src:ae.iconUrl||"",className:"w-6 h-6 rounded-full",alt:""}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"text-neutral-900 dark:text-white font-medium text-sm truncate",children:ae.symbol}),jsxRuntimeExports.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate",children:ae.getFormattedAmount()})]})]},ae.coinId))})]}),jsxRuntimeExports.jsx("input",{type:"number",value:T,onChange:ae=>O(ae.target.value),placeholder:"0.00",disabled:!S,className:"flex-1 bg-transparent text-right text-xl sm:text-2xl font-mono text-neutral-900 dark:text-white outline-none disabled:opacity-50 min-w-0"})]}),S&&T&&jsxRuntimeExports.jsxs("div",{className:"mt-2 text-right text-xs text-neutral-500 dark:text-neutral-400",children:[" $",(parseFloat(T)*S.priceUsd).toFixed(2)]})]})]}),jsxRuntimeExports.jsx("div",{className:"flex justify-center items-center mt-4 mb-1 relative z-10",children:jsxRuntimeExports.jsx("button",{onClick:ve,className:"p-2 bg-white dark:bg-neutral-900 border-2 border-neutral-200 dark:border-neutral-700 rounded-full hover:bg-neutral-50 dark:hover:bg-neutral-800 transition-colors",children:jsxRuntimeExports.jsx(ArrowDownUp,{className:"w-5 h-5 text-neutral-600 dark:text-neutral-400"})})}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-neutral-500 dark:text-neutral-400",children:"To"}),$&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate ml-2",children:["Balance: ",jsxRuntimeExports.jsx("span",{className:"text-neutral-900 dark:text-white",children:de($.coinId)})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900/50 rounded-2xl p-3 sm:p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"relative shrink-0",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>q(!U),className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-2 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-white/10 rounded-xl hover:bg-neutral-50 dark:hover:bg-neutral-700/50 transition-colors whitespace-nowrap",children:[$?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("img",{src:$.iconUrl||"",className:"w-5 h-5 sm:w-6 sm:h-6 rounded-full shrink-0",alt:""}),jsxRuntimeExports.jsx("span",{className:"text-neutral-900 dark:text-white font-medium text-sm sm:text-base",children:$.symbol})]}):jsxRuntimeExports.jsx("span",{className:"text-neutral-500 text-sm sm:text-base",children:"Select"}),jsxRuntimeExports.jsx(ArrowDown,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-neutral-400 shrink-0"})]}),U&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-white/10 rounded-xl shadow-xl z-60 max-h-48 overflow-y-auto",children:oe.map(ae=>jsxRuntimeExports.jsxs("button",{onClick:()=>{R(ae),q(!1)},className:"w-full flex items-center gap-3 p-3 hover:bg-neutral-50 dark:hover:bg-neutral-700/50 transition-colors text-left",children:[jsxRuntimeExports.jsx("img",{src:ae.iconUrl||"",className:"w-6 h-6 rounded-full",alt:""}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"text-neutral-900 dark:text-white font-medium text-sm truncate",children:ae.symbol}),jsxRuntimeExports.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate",children:de(ae.coinId)})]})]},ae.coinId))})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 text-right text-xl sm:text-2xl font-mono text-neutral-900 dark:text-white break-all min-w-0",children:fe?fe.toAmount.toFixed(6):"0.00"})]}),fe&&jsxRuntimeExports.jsxs("div",{className:"mt-2 text-right text-xs text-neutral-500 dark:text-neutral-400",children:[" $",fe.toValueUSD.toFixed(2)]})]})]}),fe&&S&&$&&jsxRuntimeExports.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-500/10 border border-blue-200 dark:border-blue-500/20 rounded-xl",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-4 h-4 text-blue-500"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Exchange Rate"})]}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:["1 ",S.symbol," = ",fe.rate.toFixed(6)," ",$.symbol]})]}),J&&jsxRuntimeExports.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-500/10 border border-red-200 dark:border-red-500/20 rounded-xl",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:J})}),jsxRuntimeExports.jsxs("button",{onClick:pe,disabled:!he||!$||!fe,className:"w-full py-3 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(ArrowDownUp,{className:"w-5 h-5"}),"Swap Tokens"]})]},"swap"),w==="processing"&&jsxRuntimeExports.jsxs(motion.div,{className:"py-10 text-center",initial:{opacity:0},animate:{opacity:1},children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-12 h-12 text-orange-500 animate-spin mx-auto mb-4"}),jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white font-medium text-lg",children:"Processing Swap..."}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 text-sm mt-2",children:"Sending tokens and requesting swap"})]},"processing"),w==="success"&&S&&$&&fe&&jsxRuntimeExports.jsxs(motion.div,{className:"py-10 text-center",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-4 border border-emerald-500/50",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-8 h-8 text-emerald-500"})}),jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white font-bold text-2xl mb-2",children:"Swap Complete!"}),jsxRuntimeExports.jsxs("p",{className:"text-neutral-500 dark:text-neutral-400 mb-1",children:["Swapped ",jsxRuntimeExports.jsxs("b",{children:[T," ",S.symbol]})]}),jsxRuntimeExports.jsxs("p",{className:"text-neutral-500 dark:text-neutral-400",children:["for ",jsxRuntimeExports.jsxs("b",{children:[fe.toAmount.toFixed(6)," ",$.symbol]})]}),jsxRuntimeExports.jsx("button",{onClick:we,className:"mt-8 px-8 py-2 bg-neutral-100 dark:bg-neutral-800 rounded-lg hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-900 dark:text-white transition-colors",children:"Close"})]},"success")]})})]})]}):null}const useIncomingPaymentRequests=()=>{const{nostrService:y}=useServices(),[u,g]=reactExports.useState([]);return reactExports.useEffect(()=>{const v=()=>{const b=[...y.getPaymentRequests()];console.log(" useIncomingPaymentRequests update:",{count:b.length,pendingCount:b.filter(w=>w.status==="PENDING").length}),g(b)};return v(),window.addEventListener("payment-requests-updated",v),()=>{window.removeEventListener("payment-requests-updated",v)}},[y]),{requests:u,pendingCount:u.filter(v=>v.status==="PENDING").length,accept:v=>y.acceptPaymentRequest(v),reject:v=>y.rejectPaymentRequest(v),paid:v=>y.paidPaymentRequest(v),clearProcessed:()=>y.clearProcessedPaymentRequests()}};function PaymentRequestsModal({isOpen:y,onClose:u}){const{requests:g,pendingCount:v,reject:b,clearProcessed:w,paid:E}=useIncomingPaymentRequests(),{sendAmount:S}=useWallet(),[A,$]=reactExports.useState(null),[R,T]=reactExports.useState({}),O=g.some(q=>q.status!==PaymentRequestStatus.PENDING),B=!!A,F=()=>{B||(T({}),u())},U=async q=>{$(q.id),T(J=>({...J,[q.id]:""}));try{console.log(`Initiating payment for request ${q.requestId} to @${q.recipientNametag}`),await S({recipientNametag:q.recipientNametag,amount:q.amount.toString(),coinId:q.coinId,eventId:q.id}),E(q)}catch(J){console.error("Failed to execute payment transaction:",J);let ie="Transaction failed";J instanceof Error&&(J.message.includes("Insufficient")?ie="Insufficient funds":ie=J.message),T(oe=>({...oe,[q.id]:ie}))}finally{$(null)}};return jsxRuntimeExports.jsx(AnimatePresence,{children:y&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:F,className:"fixed inset-0 z-100 bg-black/60 dark:bg-black/80 backdrop-blur-sm"}),jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-100 flex items-center justify-center p-4 sm:p-6 pointer-events-none",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",bounce:.2,duration:.6},className:"relative w-full max-w-md max-h-[600px] bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl pointer-events-auto flex flex-col overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 right-0 w-48 h-48 bg-orange-500/10 rounded-full blur-3xl pointer-events-none"}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-purple-500/10 rounded-full blur-3xl pointer-events-none"}),jsxRuntimeExports.jsxs("div",{className:"relative shrink-0 px-6 py-4 border-b border-neutral-200/50 dark:border-neutral-700/50 flex justify-between items-center z-20",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(motion.div,{whileHover:{scale:1.05},className:"relative w-11 h-11 rounded-xl bg-linear-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-lg shadow-orange-500/30",children:jsxRuntimeExports.jsx(Receipt,{className:"w-5 h-5 text-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-neutral-900 dark:text-white leading-tight",children:"Payment Requests"}),v>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[jsxRuntimeExports.jsxs("span",{className:"flex h-2 w-2 relative",children:[jsxRuntimeExports.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"}),jsxRuntimeExports.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-orange-500"})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-orange-500 dark:text-orange-400 font-semibold",children:[v," pending"]})]})]})]}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:F,disabled:B,className:`w-9 h-9 flex items-center justify-center rounded-xl transition-colors ${B?"bg-neutral-200/50 dark:bg-neutral-800/50 text-neutral-400 dark:text-neutral-600 cursor-not-allowed":"bg-neutral-200/80 dark:bg-neutral-800/80 hover:bg-neutral-300/80 dark:hover:bg-neutral-700/80 text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-white"}`,children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsx("div",{className:"relative flex-1 overflow-y-auto custom-scrollbar p-4 space-y-3 z-10 min-h-0",children:g.length===0?jsxRuntimeExports.jsxs("div",{className:"h-full min-h-[300px] flex flex-col items-center justify-center text-center py-12",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:15},className:"relative w-20 h-20 mb-6",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-orange-500/20 rounded-3xl blur-xl"}),jsxRuntimeExports.jsx("div",{className:"relative w-full h-full bg-neutral-200/80 dark:bg-neutral-800/80 rounded-3xl flex items-center justify-center border border-neutral-300/50 dark:border-neutral-700/50",children:jsxRuntimeExports.jsx(Sparkles,{className:"w-10 h-10 text-orange-500 dark:text-orange-400"})})]}),jsxRuntimeExports.jsx("p",{className:"text-neutral-900 dark:text-white font-bold text-lg mb-2",children:"No Requests"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm max-w-[220px] leading-relaxed",children:"Incoming payment requests will appear here"})]}):jsxRuntimeExports.jsx(AnimatePresence,{mode:"popLayout",children:g.map(q=>jsxRuntimeExports.jsx(RequestCard,{req:q,error:R[q.id],onPay:()=>U(q),onReject:()=>b(q),isProcessing:A===q.id,isGlobalDisabled:B},q.id))})}),O&&jsxRuntimeExports.jsx("div",{className:"relative shrink-0 p-4 border-t border-neutral-200/50 dark:border-neutral-700/50 backdrop-blur-xl z-20",children:jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:w,disabled:B,className:"w-full py-3 flex items-center justify-center gap-2 text-xs font-bold uppercase tracking-wider text-neutral-500 hover:text-red-500 dark:hover:text-red-400 hover:bg-red-500/10 rounded-xl transition-all disabled:opacity-50 border border-neutral-200/50 dark:border-neutral-700/50 hover:border-red-500/30",children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})," Clear History"]})})]})})]})})}function RequestCard({req:y,error:u,onPay:g,onReject:v,isProcessing:b,isGlobalDisabled:w}){const E=y.status===PaymentRequestStatus.PENDING,S=AmountFormatUtils.formatDisplayAmount(y.amount.toString(),y.coinId),A=getTimeAgo(y.timestamp),R={[PaymentRequestStatus.ACCEPTED]:{color:"text-emerald-500",bg:"bg-emerald-500/10",border:"border-emerald-500/20",icon:Check,label:"Payment Sent"},[PaymentRequestStatus.PAID]:{color:"text-emerald-500",bg:"bg-emerald-500/10",border:"border-emerald-500/20",icon:Check,label:"Paid Successfully"},[PaymentRequestStatus.REJECTED]:{color:"text-red-500",bg:"bg-red-500/10",border:"border-red-500/20",icon:X,label:"Request Declined"},[PaymentRequestStatus.PENDING]:{color:"text-orange-500",bg:"bg-orange-500/10",border:"border-orange-500/20",icon:Clock,label:"Awaiting Payment"}}[y.status],T=R.icon,O=w&&!b;return jsxRuntimeExports.jsxs(motion.div,{layout:!0,initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,transition:{duration:.2}},className:`relative rounded-2xl overflow-hidden border transition-all duration-300 ${E?"bg-white/60 dark:bg-neutral-800/60 border-neutral-200/60 dark:border-neutral-700/60 shadow-xl shadow-black/10 dark:shadow-black/30 backdrop-blur-xl":"bg-neutral-100/40 dark:bg-neutral-800/40 border-neutral-200/40 dark:border-neutral-700/40 opacity-70"} ${O?"opacity-50 pointer-events-none":""}`,children:[E&&jsxRuntimeExports.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-linear-to-r from-orange-500 via-orange-400 to-orange-600"}),jsxRuntimeExports.jsxs("div",{className:"p-5",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-5",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] text-neutral-500 font-bold uppercase tracking-wider mb-1.5",children:"From"}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:jsxRuntimeExports.jsxs("span",{className:"text-neutral-900 dark:text-white font-bold text-base",children:["@",y.recipientNametag]})})]}),jsxRuntimeExports.jsx("div",{className:"bg-neutral-200/50 dark:bg-neutral-700/50 px-2.5 py-1 rounded-lg text-[10px] text-neutral-500 dark:text-neutral-400 font-medium",children:A})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-3 mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"text-4xl font-black text-neutral-900 dark:text-white tracking-tight flex items-baseline gap-2",children:[S," ",jsxRuntimeExports.jsx("span",{className:"text-xl text-orange-500 dark:text-orange-400 font-bold",children:y.symbol})]}),y.message&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"mt-4 text-xs text-neutral-700 dark:text-neutral-300 bg-neutral-200/50 dark:bg-neutral-700/50 px-4 py-2 rounded-xl border border-neutral-300/50 dark:border-neutral-600/50 backdrop-blur-sm max-w-full",children:[jsxRuntimeExports.jsx("span",{className:"text-neutral-500",children:'"'}),y.message,jsxRuntimeExports.jsx("span",{className:"text-neutral-500",children:'"'})]})]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 bg-neutral-100/50 dark:bg-neutral-900/50 border-t border-neutral-200/50 dark:border-neutral-700/50 backdrop-blur-sm",children:E?jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsx(AnimatePresence,{children:u&&jsxRuntimeExports.jsxs(motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"flex items-center justify-center gap-2 text-red-400 text-xs font-semibold bg-red-500/10 py-2.5 rounded-xl border border-red-500/30",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-3.5 h-3.5"}),u]})}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-[1fr_2fr] gap-3",children:[jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.97},onClick:v,disabled:w,className:"py-3 rounded-xl font-bold text-xs bg-neutral-200/80 dark:bg-neutral-800/80 text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-white hover:bg-neutral-300/80 dark:hover:bg-neutral-700/80 border border-neutral-300/60 dark:border-neutral-700/60 hover:border-neutral-400 dark:hover:border-neutral-600 transition-all",children:"Decline"}),jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.97},onClick:g,disabled:w,className:"relative py-3 rounded-xl font-bold text-sm text-white bg-linear-to-r from-orange-500 to-orange-600 shadow-xl shadow-orange-500/30 flex items-center justify-center gap-2 transition-all disabled:opacity-50 disabled:shadow-none overflow-hidden group",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-linear-to-r from-orange-400 to-orange-500 opacity-0 group-hover:opacity-100 transition-opacity"}),jsxRuntimeExports.jsx("span",{className:"relative z-10 flex items-center gap-2",children:b?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"})," Processing"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Pay Now ",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4"})]})})]})]})]}):jsxRuntimeExports.jsxs("div",{className:`flex items-center justify-center gap-2 py-2.5 text-xs font-bold uppercase tracking-wider rounded-lg ${R.bg} ${R.color} border ${R.border}`,children:[jsxRuntimeExports.jsx(T,{className:"w-4 h-4"}),R.label]})})]})}const getTimeAgo=y=>{const u=Math.floor((Date.now()-y)/1e3);if(u<60)return"Just now";const g=Math.floor(u/60);if(g<60)return`${g}m ago`;const v=Math.floor(g/60);return v<24?`${v}h ago`:new Date(y).toLocaleDateString(void 0,{month:"short",day:"numeric"})};function SeedPhraseModal({isOpen:y,onClose:u,seedPhrase:g}){const[v,b]=reactExports.useState(!1),[w,E]=reactExports.useState(!1);reactExports.useEffect(()=>{y||(b(!1),E(!1))},[y]);const S=async()=>{try{await navigator.clipboard.writeText(g.join(" ")),E(!0),setTimeout(()=>E(!1),2e3)}catch(A){console.error("Failed to copy seed phrase:",A)}};return jsxRuntimeExports.jsx(AnimatePresence,{children:y&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:u,className:"fixed inset-0 z-100 bg-black/60 dark:bg-black/80 backdrop-blur-sm"}),jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-100 flex items-center justify-center p-4 pointer-events-none",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",bounce:.2,duration:.6},className:"relative w-full max-w-md bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl pointer-events-auto overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"relative px-6 py-4 border-b border-neutral-200/50 dark:border-neutral-700/50 flex justify-between items-center",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-neutral-900 dark:text-white",children:"Recovery Phrase"}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:u,className:"w-9 h-9 flex items-center justify-center rounded-xl bg-neutral-200/80 dark:bg-neutral-800/80 hover:bg-neutral-300/80 dark:hover:bg-neutral-700/80 text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-white transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-6",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-xl flex items-start gap-3",children:[jsxRuntimeExports.jsx(ShieldAlert,{className:"w-5 h-5 text-red-500 dark:text-red-400 shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-red-600 dark:text-red-400",children:[jsxRuntimeExports.jsx("p",{className:"font-bold mb-1",children:"Never share your recovery phrase!"}),jsxRuntimeExports.jsx("p",{children:"Anyone with these words can access your wallet and steal your funds."})]})]}),jsxRuntimeExports.jsx("div",{className:"mb-6",children:v?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"grid grid-cols-3 gap-2 mb-4",children:g.map((A,$)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:$*.03},className:"relative",children:[jsxRuntimeExports.jsxs("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-[10px] text-neutral-400 dark:text-neutral-600 font-medium z-10",children:[$+1,"."]}),jsxRuntimeExports.jsx("div",{className:"w-full bg-neutral-100 dark:bg-neutral-800/50 border border-neutral-200 dark:border-neutral-700/50 rounded-lg py-2 pl-7 pr-2 text-xs text-neutral-900 dark:text-white font-mono",children:A})]},`seed-word-${$}`))}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>b(!1),className:"flex-1 px-4 py-2.5 rounded-xl bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-900 dark:text-white text-sm font-medium flex items-center justify-center gap-2 transition-colors",children:[jsxRuntimeExports.jsx(EyeOff,{className:"w-4 h-4"}),"Hide"]}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:S,className:"flex-1 px-4 py-2.5 rounded-xl bg-orange-500 hover:bg-orange-600 text-white text-sm font-medium flex items-center justify-center gap-2 transition-colors",children:w?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"}),"Copied!"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"}),"Copy"]})})]})]}):jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>b(!0),className:"px-6 py-3 rounded-xl bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-900 dark:text-white font-medium flex items-center gap-2 mx-auto transition-colors",children:[jsxRuntimeExports.jsx(Eye,{className:"w-4 h-4"}),"Reveal Recovery Phrase"]})})}),jsxRuntimeExports.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 text-center",children:"Write down these 12 words in order and store them safely. You'll need them to recover your wallet."})]})]})})]})})}const IPFS_STORAGE_KEYS={STATUS:["ipfs","storage","status"],IPNS_NAME:["ipfs","storage","ipnsName"]},SESSION_KEY$1="user-pin-1234",identityManager=IdentityManager.getInstance(SESSION_KEY$1);function useIpfsStorage(){const y=useQueryClient(),[u,g]=reactExports.useState(null),[v,b]=reactExports.useState(!1),[w,E]=reactExports.useState(!1),S=!0,A=IpfsStorageService.getInstance(identityManager);reactExports.useEffect(()=>{console.log(" useIpfsStorage: setting up event listener");const J=ie=>{g(ie.detail),ie.detail.type==="sync:state-changed"&&ie.detail.data?.isSyncing!==void 0&&(console.log(` useIpfsStorage: received sync:state-changed, isSyncing=${ie.detail.data.isSyncing}`),E(ie.detail.data.isSyncing)),(ie.detail.type==="storage:completed"||ie.detail.type==="storage:failed")&&y.invalidateQueries({queryKey:IPFS_STORAGE_KEYS.STATUS})};return window.addEventListener("ipfs-storage-event",J),()=>{window.removeEventListener("ipfs-storage-event",J)}},[y]),reactExports.useEffect(()=>{if(!A)return;A.startAutoSync(),b(!0);const J=A.isCurrentlySyncing();return console.log(` useIpfsStorage: initializing sync state to ${J}`),E(J),()=>{}},[A]);const $=useQuery({queryKey:IPFS_STORAGE_KEYS.STATUS,queryFn:()=>A.getStatus(),refetchInterval:3e4,enabled:v&&!!A}),R=useQuery({queryKey:IPFS_STORAGE_KEYS.IPNS_NAME,queryFn:()=>A.getIpnsName(),staleTime:1/0,enabled:v&&!!A}),T=useMutation({mutationFn:()=>A.syncNow(),onSuccess:()=>{y.invalidateQueries({queryKey:IPFS_STORAGE_KEYS.STATUS})}}),O=useMutation({mutationFn:async J=>{const ie=await A.restore(J);if(ie.success&&ie.tokens){const oe=WalletRepository.getInstance();for(const le of ie.tokens)oe.addToken(le);ie.nametag&&oe.setNametag(ie.nametag)}return ie},onSuccess:J=>{J.success&&y.invalidateQueries({queryKey:["wallet"]})}}),B=useMutation({mutationFn:async()=>{const J=await A.restoreFromLastCid();if(J.success&&J.tokens){const ie=WalletRepository.getInstance();for(const oe of J.tokens)ie.addToken(oe);J.nametag&&ie.setNametag(J.nametag)}return J},onSuccess:J=>{J.success&&y.invalidateQueries({queryKey:["wallet"]})}}),F=useMutation({mutationFn:async()=>{const J=await A.exportAsTxf();if(J.success&&J.data&&J.filename){const ie=new Blob([J.data],{type:"application/json"}),oe=URL.createObjectURL(ie),le=document.createElement("a");le.href=oe,le.download=J.filename,document.body.appendChild(le),le.click(),document.body.removeChild(le),URL.revokeObjectURL(oe)}return J}}),U=useMutation({mutationFn:async J=>{const ie=await A.importFromTxf(J);if(ie.success&&ie.tokens){const oe=WalletRepository.getInstance();for(const le of ie.tokens)oe.addToken(le)}return ie},onSuccess:J=>{J.success&&y.invalidateQueries({queryKey:["wallet"]})}}),q=reactExports.useCallback(J=>A?A.onEvent(J):()=>{},[A]);return{isEnabled:S,status:$.data,isLoadingStatus:$.isLoading,isServiceReady:v,currentVersion:$.data?.currentVersion??0,lastCid:$.data?.lastCid??null,ipnsName:R.data,isLoadingIpnsName:R.isLoading,sync:T.mutateAsync,isSyncing:T.isPending||w||(A?.isCurrentlySyncing()??!1),syncError:T.error,restore:O.mutateAsync,isRestoring:O.isPending,restoreError:O.error,restoreFromLast:B.mutateAsync,isRestoringFromLast:B.isPending,exportTxf:F.mutateAsync,isExportingTxf:F.isPending,exportTxfError:F.error,importTxf:U.mutateAsync,isImportingTxf:U.isPending,importTxfError:U.error,lastEvent:u,onStorageEvent:q}}const KEYS={TRANSACTION_HISTORY:["wallet","transaction-history"]},walletRepo=WalletRepository.getInstance(),useTransactionHistory=()=>{const y=useQueryClient();reactExports.useEffect(()=>{const g=()=>{console.log(" Wallet update detected! Refreshing transaction history..."),y.refetchQueries({queryKey:KEYS.TRANSACTION_HISTORY})};return window.addEventListener("wallet-updated",g),()=>window.removeEventListener("wallet-updated",g)},[y]);const u=useQuery({queryKey:KEYS.TRANSACTION_HISTORY,queryFn:()=>walletRepo.getTransactionHistory(),staleTime:3e4});return{history:u.data||[],isLoading:u.isLoading}},registryService=RegistryService.getInstance();function TransactionHistoryModal({isOpen:y,onClose:u}){const{history:g,isLoading:v}=useTransactionHistory(),b=reactExports.useMemo(()=>g.map(w=>{const S=registryService.getCoinDefinition(w.coinId)?.decimals||0,A=BigInt(w.amount),$=BigInt(10**S),R=A/$,O=(A%$).toString().padStart(S,"0"),B=S>0?`${R}.${O}`.replace(/\.?0+$/,""):R.toString();return{...w,formattedAmount:B,date:new Date(w.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),time:new Date(w.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}}),[g]);return jsxRuntimeExports.jsx(AnimatePresence,{children:y&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:u,className:"fixed inset-0 z-100 bg-black/60 dark:bg-black/80 backdrop-blur-sm"}),jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-100 flex items-center justify-center p-4 sm:p-6 pointer-events-none",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",bounce:.2,duration:.6},className:"relative w-full max-w-md max-h-[600px] bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl pointer-events-auto flex flex-col overflow-hidden",onClick:w=>w.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"px-6 py-5 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(motion.div,{whileHover:{scale:1.05},className:"relative w-11 h-11 rounded-xl bg-linear-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-lg shadow-orange-500/30",children:jsxRuntimeExports.jsx(Clock,{className:"w-5 h-5 text-white"})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-neutral-900 dark:text-white leading-tight",children:"Transaction History"})})]}),jsxRuntimeExports.jsx("button",{onClick:u,className:"p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-xl transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-neutral-500 dark:text-neutral-400"})})]}),jsxRuntimeExports.jsx("div",{className:"relative flex-1 overflow-y-auto custom-scrollbar p-4 space-y-3 z-10 min-h-0",children:v?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-20",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 animate-spin text-orange-500"})}):g.length===0?jsxRuntimeExports.jsxs("div",{className:"h-full min-h-[300px] flex flex-col items-center justify-center text-center py-12",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:15},className:"relative w-20 h-20 mb-6",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-orange-500/20 rounded-3xl blur-xl"}),jsxRuntimeExports.jsx("div",{className:"relative w-full h-full bg-neutral-200/80 dark:bg-neutral-800/80 rounded-3xl flex items-center justify-center border border-neutral-300/50 dark:border-neutral-700/50",children:jsxRuntimeExports.jsx(ArrowUpRight,{className:"w-10 h-10 text-orange-500 dark:text-orange-400"})})]}),jsxRuntimeExports.jsx("p",{className:"text-neutral-900 dark:text-white font-bold text-lg mb-2",children:"No Transactions"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm max-w-[220px] leading-relaxed",children:"Your transaction history will appear here"})]}):jsxRuntimeExports.jsx("div",{className:"space-y-2",children:b.map((w,E)=>jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:E*.05},className:"p-4 bg-neutral-50 dark:bg-neutral-800/50 border border-neutral-200 dark:border-neutral-700/50 rounded-xl hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${w.type==="RECEIVED"?"bg-emerald-500/10 dark:bg-emerald-500/20":"bg-orange-500/10 dark:bg-orange-500/20"}`,children:w.type==="RECEIVED"?jsxRuntimeExports.jsx(ArrowDownLeft,{className:"w-5 h-5 text-emerald-500"}):jsxRuntimeExports.jsx(ArrowUpRight,{className:"w-5 h-5 text-orange-500"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-neutral-900 dark:text-white",children:w.type==="RECEIVED"?"Received":"Sent"}),w.recipientNametag&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate",children:["to @",w.recipientNametag]}),w.senderPubkey&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate",children:["from ",w.senderPubkey.slice(0,8),"...",w.senderPubkey.slice(-4)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-500 dark:text-neutral-400",children:[jsxRuntimeExports.jsx("span",{children:w.date}),jsxRuntimeExports.jsx("span",{children:""}),jsxRuntimeExports.jsx("span",{children:w.time})]})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsxs("div",{className:`text-sm font-semibold ${w.type==="RECEIVED"?"text-emerald-600 dark:text-emerald-400":"text-neutral-900 dark:text-white"}`,children:[w.type==="RECEIVED"?"+":"-",w.formattedAmount]}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 flex items-center gap-1.5 justify-end mt-0.5",children:[w.iconUrl&&jsxRuntimeExports.jsx("img",{src:w.iconUrl,className:"w-3 h-3 rounded-full",alt:""}),jsxRuntimeExports.jsx("span",{children:w.symbol})]})]})]})},w.id))})})]})})]})})}function SettingsModal({isOpen:y,onClose:u,onOpenL1Wallet:g,onBackupWallet:v,onLogout:b,l1Balance:w}){return jsxRuntimeExports.jsx(AnimatePresence,{children:y&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:u,className:"fixed inset-0 z-50 bg-black/60 dark:bg-black/80 backdrop-blur-sm"}),jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",bounce:.2,duration:.6},className:"relative w-full max-w-sm bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-3xl shadow-2xl pointer-events-auto overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"relative px-6 py-4 border-b border-neutral-200/50 dark:border-neutral-700/50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-neutral-100 dark:bg-neutral-800 flex items-center justify-center",children:jsxRuntimeExports.jsx(Settings,{className:"w-5 h-5 text-neutral-600 dark:text-neutral-400"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-neutral-900 dark:text-white",children:"Settings"}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:u,className:"absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-xl bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-500 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-2",children:[jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.01,x:2},whileTap:{scale:.99},onClick:()=>{u(),g()},className:"w-full flex items-center gap-4 p-4 bg-neutral-50 dark:bg-neutral-800/50 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-2xl transition-colors group",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center shrink-0",children:jsxRuntimeExports.jsx(Layers,{className:"w-6 h-6 text-blue-500"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-neutral-900 dark:text-white block",children:"L1 Wallet"}),w&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:[w," ALPHA"]})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-neutral-400 group-hover:text-neutral-600 dark:group-hover:text-neutral-300 transition-colors"})]}),jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.01,x:2},whileTap:{scale:.99},onClick:()=>{u(),v()},className:"w-full flex items-center gap-4 p-4 bg-neutral-50 dark:bg-neutral-800/50 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-2xl transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-500/10 flex items-center justify-center shrink-0",children:jsxRuntimeExports.jsx(Download,{className:"w-6 h-6 text-green-500"})}),jsxRuntimeExports.jsx("div",{className:"flex-1 text-left",children:jsxRuntimeExports.jsx("span",{className:"font-semibold text-neutral-900 dark:text-white block",children:"Backup Wallet"})})]}),jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.01,x:2},whileTap:{scale:.99},onClick:()=>{u(),b()},className:"w-full flex items-center gap-4 p-4 bg-neutral-50 dark:bg-neutral-800/50 hover:bg-red-50 dark:hover:bg-red-900/10 rounded-2xl transition-colors group",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-500/10 flex items-center justify-center shrink-0",children:jsxRuntimeExports.jsx(LogOut,{className:"w-6 h-6 text-red-500"})}),jsxRuntimeExports.jsx("div",{className:"flex-1 text-left",children:jsxRuntimeExports.jsx("span",{className:"font-semibold text-red-500 block",children:"Logout"})})]})]})]})})]})})}function BackupWalletModal({isOpen:y,onClose:u,onExportWalletFile:g,onShowRecoveryPhrase:v}){return jsxRuntimeExports.jsx(AnimatePresence,{children:y&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:u,className:"fixed inset-0 z-50 bg-black/60 dark:bg-black/80 backdrop-blur-sm"}),jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",bounce:.2,duration:.6},className:"relative w-full max-w-sm bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-3xl shadow-2xl pointer-events-auto overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"relative px-6 py-5 flex flex-col items-center text-center",children:[jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:u,className:"absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-xl bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-500 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring"},className:"w-16 h-16 rounded-full bg-green-500/10 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(ShieldCheck,{className:"w-8 h-8 text-green-500"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white mb-1",children:"Backup Wallet"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Choose how you want to backup your wallet"})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-6 space-y-3",children:[jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{u(),g()},className:"w-full flex items-center gap-4 p-4 bg-neutral-100 dark:bg-neutral-800/50 hover:bg-neutral-200 dark:hover:bg-neutral-800 rounded-2xl transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center shrink-0",children:jsxRuntimeExports.jsx(Download,{className:"w-6 h-6 text-blue-500"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-neutral-900 dark:text-white block",children:"Export Wallet File"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"Download encrypted JSON file"})]})]}),jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{u(),v()},className:"w-full flex items-center gap-4 p-4 bg-neutral-100 dark:bg-neutral-800/50 hover:bg-neutral-200 dark:hover:bg-neutral-800 rounded-2xl transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl bg-amber-500/10 flex items-center justify-center shrink-0",children:jsxRuntimeExports.jsx(Key$1,{className:"w-6 h-6 text-amber-500"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-neutral-900 dark:text-white block",children:"Show Recovery Phrase"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"View 12-word seed phrase"})]})]}),jsxRuntimeExports.jsx("button",{onClick:u,className:"w-full py-3 text-sm text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300 transition-colors",children:"Cancel"})]})]})})]})})}const SESSION_KEY="user-pin-1234";function useGlobalSyncStatus(){const[y,u]=reactExports.useState(!1),[g,v]=reactExports.useState("idle"),[b,w]=reactExports.useState(!1);reactExports.useEffect(()=>{const A=getChatHistoryIpfsService(),$=()=>{const T=A.getStatus(),O=T.isSyncing||T.hasPendingSync||T.currentStep!=="idle"&&T.currentStep!=="complete"&&T.currentStep!=="error";u(O),v(T.currentStep)};return $(),A.onStatusChange($)},[]),reactExports.useEffect(()=>{const A=IdentityManager.getInstance(SESSION_KEY),$=IpfsStorageService.getInstance(A);w($.isCurrentlySyncing());const R=O=>{O.detail?.type==="sync:state-changed"&&O.detail.data?.isSyncing!==void 0&&w(O.detail.data.isSyncing)};window.addEventListener("ipfs-storage-event",R);const T=setInterval(()=>{const O=$.isCurrentlySyncing();w(O)},500);return()=>{window.removeEventListener("ipfs-storage-event",R),clearInterval(T)}},[]);const E=y||b,S=reactExports.useCallback(()=>{const A=[];if(y)switch(g){case"initializing":A.push("Initializing...");break;case"resolving-ipns":A.push("Resolving chat history...");break;case"fetching-content":A.push("Fetching chat history...");break;case"importing-data":A.push("Importing chat data...");break;case"building-data":A.push("Preparing chat data...");break;case"uploading":A.push("Uploading chat history...");break;case"publishing-ipns":A.push("Publishing chat to network...");break;case"idle":case"complete":case"error":A.push("Preparing to sync chat...");break;default:A.push("Syncing chat history...")}return b&&A.push("Syncing tokens..."),A.length===0?"All data synced":A.join(" ")},[y,g,b]);return{chatSyncing:y,chatStep:g,tokenSyncing:b,isAnySyncing:E,statusMessage:S()}}function LogoutConfirmModal({isOpen:y,onClose:u,onBackupAndLogout:g,onLogoutWithoutBackup:v}){const{isAnySyncing:b,statusMessage:w}=useGlobalSyncStatus(),[E,S]=reactExports.useState(!1),[A,$]=reactExports.useState(!1),R=()=>{b?(S(!0),$(!1)):v()},T=()=>{S(!1),$(!1),v()},O=()=>{S(!1),$(!1)},B=!b||A;return jsxRuntimeExports.jsx(AnimatePresence,{children:y&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:E?O:u,className:"fixed inset-0 z-50 bg-black/60 dark:bg-black/80 backdrop-blur-sm"}),jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:jsxRuntimeExports.jsx(AnimatePresence,{mode:"wait",children:E?jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",bounce:.2,duration:.6},className:"relative w-full max-w-sm bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-3xl shadow-2xl pointer-events-auto overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"relative px-6 py-5 flex flex-col items-center text-center",children:[jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:O,className:"absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-xl bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-500 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})}),b?jsxRuntimeExports.jsxs("div",{className:"relative w-20 h-20 mb-4",children:[jsxRuntimeExports.jsx(motion.div,{className:"absolute inset-0 border-3 border-neutral-200 dark:border-neutral-800/50 rounded-full",animate:{rotate:360},transition:{duration:3,repeat:1/0,ease:"linear"}}),jsxRuntimeExports.jsx(motion.div,{className:"absolute inset-1.5 border-3 border-amber-500/30 rounded-full border-t-amber-500 border-r-amber-500",animate:{rotate:-360},transition:{duration:2,repeat:1/0,ease:"linear"}}),jsxRuntimeExports.jsx("div",{className:"absolute inset-3 bg-amber-500/20 rounded-full blur-xl"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx(motion.div,{animate:{scale:[1,1.1,1],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-7 h-7 text-amber-500 dark:text-amber-400 animate-spin"})})})]}):jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring"},className:"w-16 h-16 rounded-full bg-green-500/10 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(Check,{className:"w-8 h-8 text-green-500"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white mb-2",children:b?"Sync in Progress":"Sync Complete"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400 mb-4",children:b?"Please wait while your data is being synchronized.":"All data has been synchronized."}),b&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center gap-3 text-neutral-700 dark:text-neutral-300 bg-amber-50 dark:bg-amber-900/20 px-4 py-3 rounded-xl backdrop-blur-sm border border-amber-200 dark:border-amber-700/30 mb-3",children:[jsxRuntimeExports.jsx(motion.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0},className:"w-2.5 h-2.5 rounded-full bg-amber-500 dark:bg-amber-400 shrink-0"}),jsxRuntimeExports.jsx("span",{className:"text-left text-sm font-medium",children:w})]},w)]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-6 space-y-4",children:[b&&jsxRuntimeExports.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[jsxRuntimeExports.jsxs("div",{className:"relative shrink-0 mt-0.5",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:A,onChange:F=>$(F.target.checked),className:"sr-only peer"}),jsxRuntimeExports.jsx("div",{className:"w-5 h-5 border-2 border-neutral-300 dark:border-neutral-600 rounded-md peer-checked:border-red-500 peer-checked:bg-red-500 transition-all flex items-center justify-center",children:A&&jsxRuntimeExports.jsx(Check,{className:"w-3 h-3 text-white"})})]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 group-hover:text-neutral-700 dark:group-hover:text-neutral-300 transition-colors",children:"I understand that logging out now may result in data loss on other devices"})]}),jsxRuntimeExports.jsxs(motion.button,{whileHover:B?{scale:1.02}:{},whileTap:B?{scale:.98}:{},onClick:B?T:void 0,disabled:!B,className:`w-full flex items-center justify-center gap-2 py-3.5 font-semibold rounded-xl transition-all ${B?"bg-red-600 text-white hover:bg-red-500":"bg-neutral-200 dark:bg-neutral-800 text-neutral-400 dark:text-neutral-500 cursor-not-allowed"}`,children:[jsxRuntimeExports.jsx(LogOut,{className:"w-4 h-4"}),b?"Logout Now":"Logout"]}),jsxRuntimeExports.jsx("button",{onClick:O,className:"w-full py-3 text-sm text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300 transition-colors",children:"Cancel"})]})]},"sync-warning"):jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",bounce:.2,duration:.6},className:"relative w-full max-w-sm bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-3xl shadow-2xl pointer-events-auto overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"relative px-6 py-5 flex flex-col items-center text-center",children:[jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:u,className:"absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-xl bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-500 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring"},className:"w-16 h-16 rounded-full bg-amber-500/10 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(TriangleAlert,{className:"w-8 h-8 text-amber-500"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-neutral-900 dark:text-white mb-2",children:"Logout from Wallet?"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"All local data will be deleted. Make sure you have a backup to restore your wallet later."}),b&&jsxRuntimeExports.jsxs("div",{className:"mt-3 flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:w})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-6 space-y-3",children:[jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:g,className:"w-full flex items-center justify-center gap-2 py-3.5 bg-linear-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-semibold rounded-xl transition-all shadow-lg shadow-orange-500/20",children:[jsxRuntimeExports.jsx(Download,{className:"w-4 h-4"}),"Save Backup First"]}),jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:R,className:"w-full flex items-center justify-center gap-2 py-3.5 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 text-red-500 dark:text-red-400 font-semibold rounded-xl transition-colors",children:[jsxRuntimeExports.jsx(LogOut,{className:"w-4 h-4"}),"Logout without backup"]}),jsxRuntimeExports.jsx("button",{onClick:u,className:"w-full py-3 text-sm text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300 transition-colors",children:"Cancel"})]})]},"logout-confirm")})})]})})}var qrCodeStyling$1={exports:{}},qrCodeStyling=qrCodeStyling$1.exports,hasRequiredQrCodeStyling;function requireQrCodeStyling(){return hasRequiredQrCodeStyling||(hasRequiredQrCodeStyling=1,(function(y,u){(function(g,v){y.exports=v()})(qrCodeStyling,(()=>(()=>{var g={873:(E,S)=>{var A,$,R=(function(){var T=function(j,z){var re=j,Y=J[z],te=null,ne=0,se=null,ee=[],Z={},ue=function(Se,Be){te=(function(Le){for(var qe=new Array(Le),Ke=0;Ke<Le;Ke+=1){qe[Ke]=new Array(Le);for(var Ge=0;Ge<Le;Ge+=1)qe[Ke][Ge]=null}return qe})(ne=4*re+17),_e(0,0),_e(ne-7,0),_e(0,ne-7),Ae(),Re(),be(Se,Be),re>=7&&ge(Se),se==null&&(se=De(re,Y,ee)),Te(se,Be)},_e=function(Se,Be){for(var Le=-1;Le<=7;Le+=1)if(!(Se+Le<=-1||ne<=Se+Le))for(var qe=-1;qe<=7;qe+=1)Be+qe<=-1||ne<=Be+qe||(te[Se+Le][Be+qe]=0<=Le&&Le<=6&&(qe==0||qe==6)||0<=qe&&qe<=6&&(Le==0||Le==6)||2<=Le&&Le<=4&&2<=qe&&qe<=4)},Re=function(){for(var Se=8;Se<ne-8;Se+=1)te[Se][6]==null&&(te[Se][6]=Se%2==0);for(var Be=8;Be<ne-8;Be+=1)te[6][Be]==null&&(te[6][Be]=Be%2==0)},Ae=function(){for(var Se=ie.getPatternPosition(re),Be=0;Be<Se.length;Be+=1)for(var Le=0;Le<Se.length;Le+=1){var qe=Se[Be],Ke=Se[Le];if(te[qe][Ke]==null)for(var Ge=-2;Ge<=2;Ge+=1)for(var Xe=-2;Xe<=2;Xe+=1)te[qe+Ge][Ke+Xe]=Ge==-2||Ge==2||Xe==-2||Xe==2||Ge==0&&Xe==0}},ge=function(Se){for(var Be=ie.getBCHTypeNumber(re),Le=0;Le<18;Le+=1){var qe=!Se&&(Be>>Le&1)==1;te[Math.floor(Le/3)][Le%3+ne-8-3]=qe}for(Le=0;Le<18;Le+=1)qe=!Se&&(Be>>Le&1)==1,te[Le%3+ne-8-3][Math.floor(Le/3)]=qe},be=function(Se,Be){for(var Le=Y<<3|Be,qe=ie.getBCHTypeInfo(Le),Ke=0;Ke<15;Ke+=1){var Ge=!Se&&(qe>>Ke&1)==1;Ke<6?te[Ke][8]=Ge:Ke<8?te[Ke+1][8]=Ge:te[ne-15+Ke][8]=Ge}for(Ke=0;Ke<15;Ke+=1)Ge=!Se&&(qe>>Ke&1)==1,Ke<8?te[8][ne-Ke-1]=Ge:Ke<9?te[8][15-Ke-1+1]=Ge:te[8][15-Ke-1]=Ge;te[ne-8][8]=!Se},Te=function(Se,Be){for(var Le=-1,qe=ne-1,Ke=7,Ge=0,Xe=ie.getMaskFunction(Be),ze=ne-1;ze>0;ze-=2)for(ze==6&&(ze-=1);;){for(var et=0;et<2;et+=1)if(te[qe][ze-et]==null){var Ze=!1;Ge<Se.length&&(Ze=(Se[Ge]>>>Ke&1)==1),Xe(qe,ze-et)&&(Ze=!Ze),te[qe][ze-et]=Ze,(Ke-=1)==-1&&(Ge+=1,Ke=7)}if((qe+=Le)<0||ne<=qe){qe-=Le,Le=-Le;break}}},De=function(Se,Be,Le){for(var qe=de.getRSBlocks(Se,Be),Ke=fe(),Ge=0;Ge<Le.length;Ge+=1){var Xe=Le[Ge];Ke.put(Xe.getMode(),4),Ke.put(Xe.getLength(),ie.getLengthInBits(Xe.getMode(),Se)),Xe.write(Ke)}var ze=0;for(Ge=0;Ge<qe.length;Ge+=1)ze+=qe[Ge].dataCount;if(Ke.getLengthInBits()>8*ze)throw"code length overflow. ("+Ke.getLengthInBits()+">"+8*ze+")";for(Ke.getLengthInBits()+4<=8*ze&&Ke.put(0,4);Ke.getLengthInBits()%8!=0;)Ke.putBit(!1);for(;!(Ke.getLengthInBits()>=8*ze||(Ke.put(236,8),Ke.getLengthInBits()>=8*ze));)Ke.put(17,8);return(function(et,Ze){for(var nt=0,ut=0,ot=0,vt=new Array(Ze.length),bt=new Array(Ze.length),lt=0;lt<Ze.length;lt+=1){var kt=Ze[lt].dataCount,Ct=Ze[lt].totalCount-kt;ut=Math.max(ut,kt),ot=Math.max(ot,Ct),vt[lt]=new Array(kt);for(var Me=0;Me<vt[lt].length;Me+=1)vt[lt][Me]=255&et.getBuffer()[Me+nt];nt+=kt;var Ce=ie.getErrorCorrectPolynomial(Ct),Ee=le(vt[lt],Ce.getLength()-1).mod(Ce);for(bt[lt]=new Array(Ce.getLength()-1),Me=0;Me<bt[lt].length;Me+=1){var Pe=Me+Ee.getLength()-bt[lt].length;bt[lt][Me]=Pe>=0?Ee.getAt(Pe):0}}var je=0;for(Me=0;Me<Ze.length;Me+=1)je+=Ze[Me].totalCount;var He=new Array(je),Ve=0;for(Me=0;Me<ut;Me+=1)for(lt=0;lt<Ze.length;lt+=1)Me<vt[lt].length&&(He[Ve]=vt[lt][Me],Ve+=1);for(Me=0;Me<ot;Me+=1)for(lt=0;lt<Ze.length;lt+=1)Me<bt[lt].length&&(He[Ve]=bt[lt][Me],Ve+=1);return He})(Ke,qe)};Z.addData=function(Se,Be){var Le=null;switch(Be=Be||"Byte"){case"Numeric":Le=ye(Se);break;case"Alphanumeric":Le=we(Se);break;case"Byte":Le=pe(Se);break;case"Kanji":Le=ve(Se);break;default:throw"mode:"+Be}ee.push(Le),se=null},Z.isDark=function(Se,Be){if(Se<0||ne<=Se||Be<0||ne<=Be)throw Se+","+Be;return te[Se][Be]},Z.getModuleCount=function(){return ne},Z.make=function(){if(re<1){for(var Se=1;Se<40;Se++){for(var Be=de.getRSBlocks(Se,Y),Le=fe(),qe=0;qe<ee.length;qe++){var Ke=ee[qe];Le.put(Ke.getMode(),4),Le.put(Ke.getLength(),ie.getLengthInBits(Ke.getMode(),Se)),Ke.write(Le)}var Ge=0;for(qe=0;qe<Be.length;qe++)Ge+=Be[qe].dataCount;if(Le.getLengthInBits()<=8*Ge)break}re=Se}ue(!1,(function(){for(var Xe=0,ze=0,et=0;et<8;et+=1){ue(!0,et);var Ze=ie.getLostPoint(Z);(et==0||Xe>Ze)&&(Xe=Ze,ze=et)}return ze})())},Z.createTableTag=function(Se,Be){Se=Se||2;var Le="";Le+='<table style="',Le+=" border-width: 0px; border-style: none;",Le+=" border-collapse: collapse;",Le+=" padding: 0px; margin: "+(Be=Be===void 0?4*Se:Be)+"px;",Le+='">',Le+="<tbody>";for(var qe=0;qe<Z.getModuleCount();qe+=1){Le+="<tr>";for(var Ke=0;Ke<Z.getModuleCount();Ke+=1)Le+='<td style="',Le+=" border-width: 0px; border-style: none;",Le+=" border-collapse: collapse;",Le+=" padding: 0px; margin: 0px;",Le+=" width: "+Se+"px;",Le+=" height: "+Se+"px;",Le+=" background-color: ",Le+=Z.isDark(qe,Ke)?"#000000":"#ffffff",Le+=";",Le+='"/>';Le+="</tr>"}return(Le+="</tbody>")+"</table>"},Z.createSvgTag=function(Se,Be,Le,qe){var Ke={};typeof arguments[0]=="object"&&(Se=(Ke=arguments[0]).cellSize,Be=Ke.margin,Le=Ke.alt,qe=Ke.title),Se=Se||2,Be=Be===void 0?4*Se:Be,(Le=typeof Le=="string"?{text:Le}:Le||{}).text=Le.text||null,Le.id=Le.text?Le.id||"qrcode-description":null,(qe=typeof qe=="string"?{text:qe}:qe||{}).text=qe.text||null,qe.id=qe.text?qe.id||"qrcode-title":null;var Ge,Xe,ze,et,Ze=Z.getModuleCount()*Se+2*Be,nt="";for(et="l"+Se+",0 0,"+Se+" -"+Se+",0 0,-"+Se+"z ",nt+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"',nt+=Ke.scalable?"":' width="'+Ze+'px" height="'+Ze+'px"',nt+=' viewBox="0 0 '+Ze+" "+Ze+'" ',nt+=' preserveAspectRatio="xMinYMin meet"',nt+=qe.text||Le.text?' role="img" aria-labelledby="'+Ie([qe.id,Le.id].join(" ").trim())+'"':"",nt+=">",nt+=qe.text?'<title id="'+Ie(qe.id)+'">'+Ie(qe.text)+"</title>":"",nt+=Le.text?'<description id="'+Ie(Le.id)+'">'+Ie(Le.text)+"</description>":"",nt+='<rect width="100%" height="100%" fill="white" cx="0" cy="0"/>',nt+='<path d="',Xe=0;Xe<Z.getModuleCount();Xe+=1)for(ze=Xe*Se+Be,Ge=0;Ge<Z.getModuleCount();Ge+=1)Z.isDark(Xe,Ge)&&(nt+="M"+(Ge*Se+Be)+","+ze+et);return(nt+='" stroke="transparent" fill="black"/>')+"</svg>"},Z.createDataURL=function(Se,Be){Se=Se||2,Be=Be===void 0?4*Se:Be;var Le=Z.getModuleCount()*Se+2*Be,qe=Be,Ke=Le-Be;return Q(Le,Le,(function(Ge,Xe){if(qe<=Ge&&Ge<Ke&&qe<=Xe&&Xe<Ke){var ze=Math.floor((Ge-qe)/Se),et=Math.floor((Xe-qe)/Se);return Z.isDark(et,ze)?0:1}return 1}))},Z.createImgTag=function(Se,Be,Le){Se=Se||2,Be=Be===void 0?4*Se:Be;var qe=Z.getModuleCount()*Se+2*Be,Ke="";return Ke+="<img",Ke+=' src="',Ke+=Z.createDataURL(Se,Be),Ke+='"',Ke+=' width="',Ke+=qe,Ke+='"',Ke+=' height="',Ke+=qe,Ke+='"',Le&&(Ke+=' alt="',Ke+=Ie(Le),Ke+='"'),Ke+"/>"};var Ie=function(Se){for(var Be="",Le=0;Le<Se.length;Le+=1){var qe=Se.charAt(Le);switch(qe){case"<":Be+="&lt;";break;case">":Be+="&gt;";break;case"&":Be+="&amp;";break;case'"':Be+="&quot;";break;default:Be+=qe}}return Be};return Z.createASCII=function(Se,Be){if((Se=Se||1)<2)return(function(vt){vt=vt===void 0?2:vt;var bt,lt,kt,Ct,Me,Ce=1*Z.getModuleCount()+2*vt,Ee=vt,Pe=Ce-vt,je={"":""," ":""," ":"","  ":" "},He={"":""," ":""," ":" ","  ":" "},Ve="";for(bt=0;bt<Ce;bt+=2){for(kt=Math.floor((bt-Ee)/1),Ct=Math.floor((bt+1-Ee)/1),lt=0;lt<Ce;lt+=1)Me="",Ee<=lt&&lt<Pe&&Ee<=bt&&bt<Pe&&Z.isDark(kt,Math.floor((lt-Ee)/1))&&(Me=" "),Ee<=lt&&lt<Pe&&Ee<=bt+1&&bt+1<Pe&&Z.isDark(Ct,Math.floor((lt-Ee)/1))?Me+=" ":Me+="",Ve+=vt<1&&bt+1>=Pe?He[Me]:je[Me];Ve+=`
`}return Ce%2&&vt>0?Ve.substring(0,Ve.length-Ce-1)+Array(Ce+1).join(""):Ve.substring(0,Ve.length-1)})(Be);Se-=1,Be=Be===void 0?2*Se:Be;var Le,qe,Ke,Ge,Xe=Z.getModuleCount()*Se+2*Be,ze=Be,et=Xe-Be,Ze=Array(Se+1).join(""),nt=Array(Se+1).join("  "),ut="",ot="";for(Le=0;Le<Xe;Le+=1){for(Ke=Math.floor((Le-ze)/Se),ot="",qe=0;qe<Xe;qe+=1)Ge=1,ze<=qe&&qe<et&&ze<=Le&&Le<et&&Z.isDark(Ke,Math.floor((qe-ze)/Se))&&(Ge=0),ot+=Ge?Ze:nt;for(Ke=0;Ke<Se;Ke+=1)ut+=ot+`
`}return ut.substring(0,ut.length-1)},Z.renderTo2dContext=function(Se,Be){Be=Be||2;for(var Le=Z.getModuleCount(),qe=0;qe<Le;qe++)for(var Ke=0;Ke<Le;Ke++)Se.fillStyle=Z.isDark(qe,Ke)?"black":"white",Se.fillRect(qe*Be,Ke*Be,Be,Be)},Z};T.stringToBytes=(T.stringToBytesFuncs={default:function(j){for(var z=[],re=0;re<j.length;re+=1){var Y=j.charCodeAt(re);z.push(255&Y)}return z}}).default,T.createStringToBytes=function(j,z){var re=(function(){for(var te=ae(j),ne=function(){var Re=te.read();if(Re==-1)throw"eof";return Re},se=0,ee={};;){var Z=te.read();if(Z==-1)break;var ue=ne(),_e=ne()<<8|ne();ee[String.fromCharCode(Z<<8|ue)]=_e,se+=1}if(se!=z)throw se+" != "+z;return ee})(),Y=63;return function(te){for(var ne=[],se=0;se<te.length;se+=1){var ee=te.charCodeAt(se);if(ee<128)ne.push(ee);else{var Z=re[te.charAt(se)];typeof Z=="number"?(255&Z)==Z?ne.push(Z):(ne.push(Z>>>8),ne.push(255&Z)):ne.push(Y)}}return ne}};var O,B,F,U,q,J={L:1,M:0,Q:3,H:2},ie=(O=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],B=1335,F=7973,q=function(j){for(var z=0;j!=0;)z+=1,j>>>=1;return z},(U={}).getBCHTypeInfo=function(j){for(var z=j<<10;q(z)-q(B)>=0;)z^=B<<q(z)-q(B);return 21522^(j<<10|z)},U.getBCHTypeNumber=function(j){for(var z=j<<12;q(z)-q(F)>=0;)z^=F<<q(z)-q(F);return j<<12|z},U.getPatternPosition=function(j){return O[j-1]},U.getMaskFunction=function(j){switch(j){case 0:return function(z,re){return(z+re)%2==0};case 1:return function(z,re){return z%2==0};case 2:return function(z,re){return re%3==0};case 3:return function(z,re){return(z+re)%3==0};case 4:return function(z,re){return(Math.floor(z/2)+Math.floor(re/3))%2==0};case 5:return function(z,re){return z*re%2+z*re%3==0};case 6:return function(z,re){return(z*re%2+z*re%3)%2==0};case 7:return function(z,re){return(z*re%3+(z+re)%2)%2==0};default:throw"bad maskPattern:"+j}},U.getErrorCorrectPolynomial=function(j){for(var z=le([1],0),re=0;re<j;re+=1)z=z.multiply(le([1,oe.gexp(re)],0));return z},U.getLengthInBits=function(j,z){if(1<=z&&z<10)switch(j){case 1:return 10;case 2:return 9;case 4:case 8:return 8;default:throw"mode:"+j}else if(z<27)switch(j){case 1:return 12;case 2:return 11;case 4:return 16;case 8:return 10;default:throw"mode:"+j}else{if(!(z<41))throw"type:"+z;switch(j){case 1:return 14;case 2:return 13;case 4:return 16;case 8:return 12;default:throw"mode:"+j}}},U.getLostPoint=function(j){for(var z=j.getModuleCount(),re=0,Y=0;Y<z;Y+=1)for(var te=0;te<z;te+=1){for(var ne=0,se=j.isDark(Y,te),ee=-1;ee<=1;ee+=1)if(!(Y+ee<0||z<=Y+ee))for(var Z=-1;Z<=1;Z+=1)te+Z<0||z<=te+Z||ee==0&&Z==0||se==j.isDark(Y+ee,te+Z)&&(ne+=1);ne>5&&(re+=3+ne-5)}for(Y=0;Y<z-1;Y+=1)for(te=0;te<z-1;te+=1){var ue=0;j.isDark(Y,te)&&(ue+=1),j.isDark(Y+1,te)&&(ue+=1),j.isDark(Y,te+1)&&(ue+=1),j.isDark(Y+1,te+1)&&(ue+=1),ue!=0&&ue!=4||(re+=3)}for(Y=0;Y<z;Y+=1)for(te=0;te<z-6;te+=1)j.isDark(Y,te)&&!j.isDark(Y,te+1)&&j.isDark(Y,te+2)&&j.isDark(Y,te+3)&&j.isDark(Y,te+4)&&!j.isDark(Y,te+5)&&j.isDark(Y,te+6)&&(re+=40);for(te=0;te<z;te+=1)for(Y=0;Y<z-6;Y+=1)j.isDark(Y,te)&&!j.isDark(Y+1,te)&&j.isDark(Y+2,te)&&j.isDark(Y+3,te)&&j.isDark(Y+4,te)&&!j.isDark(Y+5,te)&&j.isDark(Y+6,te)&&(re+=40);var _e=0;for(te=0;te<z;te+=1)for(Y=0;Y<z;Y+=1)j.isDark(Y,te)&&(_e+=1);return re+Math.abs(100*_e/z/z-50)/5*10},U),oe=(function(){for(var j=new Array(256),z=new Array(256),re=0;re<8;re+=1)j[re]=1<<re;for(re=8;re<256;re+=1)j[re]=j[re-4]^j[re-5]^j[re-6]^j[re-8];for(re=0;re<255;re+=1)z[j[re]]=re;return{glog:function(Y){if(Y<1)throw"glog("+Y+")";return z[Y]},gexp:function(Y){for(;Y<0;)Y+=255;for(;Y>=256;)Y-=255;return j[Y]}}})();function le(j,z){if(j.length===void 0)throw j.length+"/"+z;var re=(function(){for(var te=0;te<j.length&&j[te]==0;)te+=1;for(var ne=new Array(j.length-te+z),se=0;se<j.length-te;se+=1)ne[se]=j[se+te];return ne})(),Y={getAt:function(te){return re[te]},getLength:function(){return re.length},multiply:function(te){for(var ne=new Array(Y.getLength()+te.getLength()-1),se=0;se<Y.getLength();se+=1)for(var ee=0;ee<te.getLength();ee+=1)ne[se+ee]^=oe.gexp(oe.glog(Y.getAt(se))+oe.glog(te.getAt(ee)));return le(ne,0)},mod:function(te){if(Y.getLength()-te.getLength()<0)return Y;for(var ne=oe.glog(Y.getAt(0))-oe.glog(te.getAt(0)),se=new Array(Y.getLength()),ee=0;ee<Y.getLength();ee+=1)se[ee]=Y.getAt(ee);for(ee=0;ee<te.getLength();ee+=1)se[ee]^=oe.gexp(oe.glog(te.getAt(ee))+ne);return le(se,0).mod(te)}};return Y}var de=(function(){var j=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],z=function(Y,te){var ne={};return ne.totalCount=Y,ne.dataCount=te,ne},re={getRSBlocks:function(Y,te){var ne=(function(ge,be){switch(be){case J.L:return j[4*(ge-1)+0];case J.M:return j[4*(ge-1)+1];case J.Q:return j[4*(ge-1)+2];case J.H:return j[4*(ge-1)+3];default:return}})(Y,te);if(ne===void 0)throw"bad rs block @ typeNumber:"+Y+"/errorCorrectionLevel:"+te;for(var se=ne.length/3,ee=[],Z=0;Z<se;Z+=1)for(var ue=ne[3*Z+0],_e=ne[3*Z+1],Re=ne[3*Z+2],Ae=0;Ae<ue;Ae+=1)ee.push(z(_e,Re));return ee}};return re})(),fe=function(){var j=[],z=0,re={getBuffer:function(){return j},getAt:function(Y){var te=Math.floor(Y/8);return(j[te]>>>7-Y%8&1)==1},put:function(Y,te){for(var ne=0;ne<te;ne+=1)re.putBit((Y>>>te-ne-1&1)==1)},getLengthInBits:function(){return z},putBit:function(Y){var te=Math.floor(z/8);j.length<=te&&j.push(0),Y&&(j[te]|=128>>>z%8),z+=1}};return re},ye=function(j){var z=j,re={getMode:function(){return 1},getLength:function(ne){return z.length},write:function(ne){for(var se=z,ee=0;ee+2<se.length;)ne.put(Y(se.substring(ee,ee+3)),10),ee+=3;ee<se.length&&(se.length-ee==1?ne.put(Y(se.substring(ee,ee+1)),4):se.length-ee==2&&ne.put(Y(se.substring(ee,ee+2)),7))}},Y=function(ne){for(var se=0,ee=0;ee<ne.length;ee+=1)se=10*se+te(ne.charAt(ee));return se},te=function(ne){if("0"<=ne&&ne<="9")return ne.charCodeAt(0)-48;throw"illegal char :"+ne};return re},we=function(j){var z=j,re={getMode:function(){return 2},getLength:function(te){return z.length},write:function(te){for(var ne=z,se=0;se+1<ne.length;)te.put(45*Y(ne.charAt(se))+Y(ne.charAt(se+1)),11),se+=2;se<ne.length&&te.put(Y(ne.charAt(se)),6)}},Y=function(te){if("0"<=te&&te<="9")return te.charCodeAt(0)-48;if("A"<=te&&te<="Z")return te.charCodeAt(0)-65+10;switch(te){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw"illegal char :"+te}};return re},pe=function(j){var z=T.stringToBytes(j);return{getMode:function(){return 4},getLength:function(re){return z.length},write:function(re){for(var Y=0;Y<z.length;Y+=1)re.put(z[Y],8)}}},ve=function(j){var z=T.stringToBytesFuncs.SJIS;if(!z)throw"sjis not supported.";(function(){var te=z("");if(te.length!=2||(te[0]<<8|te[1])!=38726)throw"sjis not supported."})();var re=z(j),Y={getMode:function(){return 8},getLength:function(te){return~~(re.length/2)},write:function(te){for(var ne=re,se=0;se+1<ne.length;){var ee=(255&ne[se])<<8|255&ne[se+1];if(33088<=ee&&ee<=40956)ee-=33088;else{if(!(57408<=ee&&ee<=60351))throw"illegal char at "+(se+1)+"/"+ee;ee-=49472}ee=192*(ee>>>8&255)+(255&ee),te.put(ee,13),se+=2}if(se<ne.length)throw"illegal char at "+(se+1)}};return Y},he=function(){var j=[],z={writeByte:function(re){j.push(255&re)},writeShort:function(re){z.writeByte(re),z.writeByte(re>>>8)},writeBytes:function(re,Y,te){Y=Y||0,te=te||re.length;for(var ne=0;ne<te;ne+=1)z.writeByte(re[ne+Y])},writeString:function(re){for(var Y=0;Y<re.length;Y+=1)z.writeByte(re.charCodeAt(Y))},toByteArray:function(){return j},toString:function(){var re="";re+="[";for(var Y=0;Y<j.length;Y+=1)Y>0&&(re+=","),re+=j[Y];return re+"]"}};return z},ae=function(j){var z=j,re=0,Y=0,te=0,ne={read:function(){for(;te<8;){if(re>=z.length){if(te==0)return-1;throw"unexpected end of file./"+te}var ee=z.charAt(re);if(re+=1,ee=="=")return te=0,-1;ee.match(/^\s$/)||(Y=Y<<6|se(ee.charCodeAt(0)),te+=6)}var Z=Y>>>te-8&255;return te-=8,Z}},se=function(ee){if(65<=ee&&ee<=90)return ee-65;if(97<=ee&&ee<=122)return ee-97+26;if(48<=ee&&ee<=57)return ee-48+52;if(ee==43)return 62;if(ee==47)return 63;throw"c:"+ee};return ne},Q=function(j,z,re){for(var Y=(function(_e,Re){var Ae=_e,ge=Re,be=new Array(_e*Re),Te={setPixel:function(Se,Be,Le){be[Be*Ae+Se]=Le},write:function(Se){Se.writeString("GIF87a"),Se.writeShort(Ae),Se.writeShort(ge),Se.writeByte(128),Se.writeByte(0),Se.writeByte(0),Se.writeByte(0),Se.writeByte(0),Se.writeByte(0),Se.writeByte(255),Se.writeByte(255),Se.writeByte(255),Se.writeString(","),Se.writeShort(0),Se.writeShort(0),Se.writeShort(Ae),Se.writeShort(ge),Se.writeByte(0);var Be=De(2);Se.writeByte(2);for(var Le=0;Be.length-Le>255;)Se.writeByte(255),Se.writeBytes(Be,Le,255),Le+=255;Se.writeByte(Be.length-Le),Se.writeBytes(Be,Le,Be.length-Le),Se.writeByte(0),Se.writeString(";")}},De=function(Se){for(var Be=1<<Se,Le=1+(1<<Se),qe=Se+1,Ke=Ie(),Ge=0;Ge<Be;Ge+=1)Ke.add(String.fromCharCode(Ge));Ke.add(String.fromCharCode(Be)),Ke.add(String.fromCharCode(Le));var Xe,ze,et,Ze=he(),nt=(Xe=Ze,ze=0,et=0,{write:function(bt,lt){if(bt>>>lt)throw"length over";for(;ze+lt>=8;)Xe.writeByte(255&(bt<<ze|et)),lt-=8-ze,bt>>>=8-ze,et=0,ze=0;et|=bt<<ze,ze+=lt},flush:function(){ze>0&&Xe.writeByte(et)}});nt.write(Be,qe);var ut=0,ot=String.fromCharCode(be[ut]);for(ut+=1;ut<be.length;){var vt=String.fromCharCode(be[ut]);ut+=1,Ke.contains(ot+vt)?ot+=vt:(nt.write(Ke.indexOf(ot),qe),Ke.size()<4095&&(Ke.size()==1<<qe&&(qe+=1),Ke.add(ot+vt)),ot=vt)}return nt.write(Ke.indexOf(ot),qe),nt.write(Le,qe),nt.flush(),Ze.toByteArray()},Ie=function(){var Se={},Be=0,Le={add:function(qe){if(Le.contains(qe))throw"dup key:"+qe;Se[qe]=Be,Be+=1},size:function(){return Be},indexOf:function(qe){return Se[qe]},contains:function(qe){return Se[qe]!==void 0}};return Le};return Te})(j,z),te=0;te<z;te+=1)for(var ne=0;ne<j;ne+=1)Y.setPixel(ne,te,re(ne,te));var se=he();Y.write(se);for(var ee=(function(){var _e=0,Re=0,Ae=0,ge="",be={},Te=function(Ie){ge+=String.fromCharCode(De(63&Ie))},De=function(Ie){if(!(Ie<0)){if(Ie<26)return 65+Ie;if(Ie<52)return Ie-26+97;if(Ie<62)return Ie-52+48;if(Ie==62)return 43;if(Ie==63)return 47}throw"n:"+Ie};return be.writeByte=function(Ie){for(_e=_e<<8|255&Ie,Re+=8,Ae+=1;Re>=6;)Te(_e>>>Re-6),Re-=6},be.flush=function(){if(Re>0&&(Te(_e<<6-Re),_e=0,Re=0),Ae%3!=0)for(var Ie=3-Ae%3,Se=0;Se<Ie;Se+=1)ge+="="},be.toString=function(){return ge},be})(),Z=se.toByteArray(),ue=0;ue<Z.length;ue+=1)ee.writeByte(Z[ue]);return ee.flush(),"data:image/gif;base64,"+ee};return T})();R.stringToBytesFuncs["UTF-8"]=function(T){return(function(O){for(var B=[],F=0;F<O.length;F++){var U=O.charCodeAt(F);U<128?B.push(U):U<2048?B.push(192|U>>6,128|63&U):U<55296||U>=57344?B.push(224|U>>12,128|U>>6&63,128|63&U):(F++,U=65536+((1023&U)<<10|1023&O.charCodeAt(F)),B.push(240|U>>18,128|U>>12&63,128|U>>6&63,128|63&U))}return B})(T)},($=typeof(A=function(){return R})=="function"?A.apply(S,[]):A)===void 0||(E.exports=$)}},v={};function b(E){var S=v[E];if(S!==void 0)return S.exports;var A=v[E]={exports:{}};return g[E](A,A.exports,b),A.exports}b.n=E=>{var S=E&&E.__esModule?()=>E.default:()=>E;return b.d(S,{a:S}),S},b.d=(E,S)=>{for(var A in S)b.o(S,A)&&!b.o(E,A)&&Object.defineProperty(E,A,{enumerable:!0,get:S[A]})},b.o=(E,S)=>Object.prototype.hasOwnProperty.call(E,S);var w={};return(()=>{b.d(w,{default:()=>z});const E=re=>!!re&&typeof re=="object"&&!Array.isArray(re);function S(re,...Y){if(!Y.length)return re;const te=Y.shift();return te!==void 0&&E(re)&&E(te)?(re=Object.assign({},re),Object.keys(te).forEach((ne=>{const se=re[ne],ee=te[ne];Array.isArray(se)&&Array.isArray(ee)?re[ne]=ee:E(se)&&E(ee)?re[ne]=S(Object.assign({},se),ee):re[ne]=ee})),S(re,...Y)):re}function A(re,Y){const te=document.createElement("a");te.download=Y,te.href=re,document.body.appendChild(te),te.click(),document.body.removeChild(te)}const $={L:.07,M:.15,Q:.25,H:.3};class R{constructor({svg:Y,type:te,window:ne}){this._svg=Y,this._type=te,this._window=ne}draw(Y,te,ne,se){let ee;switch(this._type){case"dots":ee=this._drawDot;break;case"classy":ee=this._drawClassy;break;case"classy-rounded":ee=this._drawClassyRounded;break;case"rounded":ee=this._drawRounded;break;case"extra-rounded":ee=this._drawExtraRounded;break;default:ee=this._drawSquare}ee.call(this,{x:Y,y:te,size:ne,getNeighbor:se})}_rotateFigure({x:Y,y:te,size:ne,rotation:se=0,draw:ee}){var Z;const ue=Y+ne/2,_e=te+ne/2;ee(),(Z=this._element)===null||Z===void 0||Z.setAttribute("transform",`rotate(${180*se/Math.PI},${ue},${_e})`)}_basicDot(Y){const{size:te,x:ne,y:se}=Y;this._rotateFigure(Object.assign(Object.assign({},Y),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","circle"),this._element.setAttribute("cx",String(ne+te/2)),this._element.setAttribute("cy",String(se+te/2)),this._element.setAttribute("r",String(te/2))}}))}_basicSquare(Y){const{size:te,x:ne,y:se}=Y;this._rotateFigure(Object.assign(Object.assign({},Y),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","rect"),this._element.setAttribute("x",String(ne)),this._element.setAttribute("y",String(se)),this._element.setAttribute("width",String(te)),this._element.setAttribute("height",String(te))}}))}_basicSideRounded(Y){const{size:te,x:ne,y:se}=Y;this._rotateFigure(Object.assign(Object.assign({},Y),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("d",`M ${ne} ${se}v ${te}h `+te/2+`a ${te/2} ${te/2}, 0, 0, 0, 0 ${-te}`)}}))}_basicCornerRounded(Y){const{size:te,x:ne,y:se}=Y;this._rotateFigure(Object.assign(Object.assign({},Y),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("d",`M ${ne} ${se}v ${te}h ${te}v `+-te/2+`a ${te/2} ${te/2}, 0, 0, 0, ${-te/2} ${-te/2}`)}}))}_basicCornerExtraRounded(Y){const{size:te,x:ne,y:se}=Y;this._rotateFigure(Object.assign(Object.assign({},Y),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("d",`M ${ne} ${se}v ${te}h ${te}a ${te} ${te}, 0, 0, 0, ${-te} ${-te}`)}}))}_basicCornersRounded(Y){const{size:te,x:ne,y:se}=Y;this._rotateFigure(Object.assign(Object.assign({},Y),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("d",`M ${ne} ${se}v `+te/2+`a ${te/2} ${te/2}, 0, 0, 0, ${te/2} ${te/2}h `+te/2+"v "+-te/2+`a ${te/2} ${te/2}, 0, 0, 0, ${-te/2} ${-te/2}`)}}))}_drawDot({x:Y,y:te,size:ne}){this._basicDot({x:Y,y:te,size:ne,rotation:0})}_drawSquare({x:Y,y:te,size:ne}){this._basicSquare({x:Y,y:te,size:ne,rotation:0})}_drawRounded({x:Y,y:te,size:ne,getNeighbor:se}){const ee=se?+se(-1,0):0,Z=se?+se(1,0):0,ue=se?+se(0,-1):0,_e=se?+se(0,1):0,Re=ee+Z+ue+_e;if(Re!==0)if(Re>2||ee&&Z||ue&&_e)this._basicSquare({x:Y,y:te,size:ne,rotation:0});else{if(Re===2){let Ae=0;return ee&&ue?Ae=Math.PI/2:ue&&Z?Ae=Math.PI:Z&&_e&&(Ae=-Math.PI/2),void this._basicCornerRounded({x:Y,y:te,size:ne,rotation:Ae})}if(Re===1){let Ae=0;return ue?Ae=Math.PI/2:Z?Ae=Math.PI:_e&&(Ae=-Math.PI/2),void this._basicSideRounded({x:Y,y:te,size:ne,rotation:Ae})}}else this._basicDot({x:Y,y:te,size:ne,rotation:0})}_drawExtraRounded({x:Y,y:te,size:ne,getNeighbor:se}){const ee=se?+se(-1,0):0,Z=se?+se(1,0):0,ue=se?+se(0,-1):0,_e=se?+se(0,1):0,Re=ee+Z+ue+_e;if(Re!==0)if(Re>2||ee&&Z||ue&&_e)this._basicSquare({x:Y,y:te,size:ne,rotation:0});else{if(Re===2){let Ae=0;return ee&&ue?Ae=Math.PI/2:ue&&Z?Ae=Math.PI:Z&&_e&&(Ae=-Math.PI/2),void this._basicCornerExtraRounded({x:Y,y:te,size:ne,rotation:Ae})}if(Re===1){let Ae=0;return ue?Ae=Math.PI/2:Z?Ae=Math.PI:_e&&(Ae=-Math.PI/2),void this._basicSideRounded({x:Y,y:te,size:ne,rotation:Ae})}}else this._basicDot({x:Y,y:te,size:ne,rotation:0})}_drawClassy({x:Y,y:te,size:ne,getNeighbor:se}){const ee=se?+se(-1,0):0,Z=se?+se(1,0):0,ue=se?+se(0,-1):0,_e=se?+se(0,1):0;ee+Z+ue+_e!==0?ee||ue?Z||_e?this._basicSquare({x:Y,y:te,size:ne,rotation:0}):this._basicCornerRounded({x:Y,y:te,size:ne,rotation:Math.PI/2}):this._basicCornerRounded({x:Y,y:te,size:ne,rotation:-Math.PI/2}):this._basicCornersRounded({x:Y,y:te,size:ne,rotation:Math.PI/2})}_drawClassyRounded({x:Y,y:te,size:ne,getNeighbor:se}){const ee=se?+se(-1,0):0,Z=se?+se(1,0):0,ue=se?+se(0,-1):0,_e=se?+se(0,1):0;ee+Z+ue+_e!==0?ee||ue?Z||_e?this._basicSquare({x:Y,y:te,size:ne,rotation:0}):this._basicCornerExtraRounded({x:Y,y:te,size:ne,rotation:Math.PI/2}):this._basicCornerExtraRounded({x:Y,y:te,size:ne,rotation:-Math.PI/2}):this._basicCornersRounded({x:Y,y:te,size:ne,rotation:Math.PI/2})}}const T={dot:"dot",square:"square",extraRounded:"extra-rounded"},O=Object.values(T);class B{constructor({svg:Y,type:te,window:ne}){this._svg=Y,this._type=te,this._window=ne}draw(Y,te,ne,se){let ee;switch(this._type){case T.square:ee=this._drawSquare;break;case T.extraRounded:ee=this._drawExtraRounded;break;default:ee=this._drawDot}ee.call(this,{x:Y,y:te,size:ne,rotation:se})}_rotateFigure({x:Y,y:te,size:ne,rotation:se=0,draw:ee}){var Z;const ue=Y+ne/2,_e=te+ne/2;ee(),(Z=this._element)===null||Z===void 0||Z.setAttribute("transform",`rotate(${180*se/Math.PI},${ue},${_e})`)}_basicDot(Y){const{size:te,x:ne,y:se}=Y,ee=te/7;this._rotateFigure(Object.assign(Object.assign({},Y),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("clip-rule","evenodd"),this._element.setAttribute("d",`M ${ne+te/2} ${se}a ${te/2} ${te/2} 0 1 0 0.1 0zm 0 ${ee}a ${te/2-ee} ${te/2-ee} 0 1 1 -0.1 0Z`)}}))}_basicSquare(Y){const{size:te,x:ne,y:se}=Y,ee=te/7;this._rotateFigure(Object.assign(Object.assign({},Y),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("clip-rule","evenodd"),this._element.setAttribute("d",`M ${ne} ${se}v ${te}h ${te}v `+-te+`zM ${ne+ee} ${se+ee}h `+(te-2*ee)+"v "+(te-2*ee)+"h "+(2*ee-te)+"z")}}))}_basicExtraRounded(Y){const{size:te,x:ne,y:se}=Y,ee=te/7;this._rotateFigure(Object.assign(Object.assign({},Y),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("clip-rule","evenodd"),this._element.setAttribute("d",`M ${ne} ${se+2.5*ee}v `+2*ee+`a ${2.5*ee} ${2.5*ee}, 0, 0, 0, ${2.5*ee} ${2.5*ee}h `+2*ee+`a ${2.5*ee} ${2.5*ee}, 0, 0, 0, ${2.5*ee} ${2.5*-ee}v `+-2*ee+`a ${2.5*ee} ${2.5*ee}, 0, 0, 0, ${2.5*-ee} ${2.5*-ee}h `+-2*ee+`a ${2.5*ee} ${2.5*ee}, 0, 0, 0, ${2.5*-ee} ${2.5*ee}M ${ne+2.5*ee} ${se+ee}h `+2*ee+`a ${1.5*ee} ${1.5*ee}, 0, 0, 1, ${1.5*ee} ${1.5*ee}v `+2*ee+`a ${1.5*ee} ${1.5*ee}, 0, 0, 1, ${1.5*-ee} ${1.5*ee}h `+-2*ee+`a ${1.5*ee} ${1.5*ee}, 0, 0, 1, ${1.5*-ee} ${1.5*-ee}v `+-2*ee+`a ${1.5*ee} ${1.5*ee}, 0, 0, 1, ${1.5*ee} ${1.5*-ee}`)}}))}_drawDot({x:Y,y:te,size:ne,rotation:se}){this._basicDot({x:Y,y:te,size:ne,rotation:se})}_drawSquare({x:Y,y:te,size:ne,rotation:se}){this._basicSquare({x:Y,y:te,size:ne,rotation:se})}_drawExtraRounded({x:Y,y:te,size:ne,rotation:se}){this._basicExtraRounded({x:Y,y:te,size:ne,rotation:se})}}const F={dot:"dot",square:"square"},U=Object.values(F);class q{constructor({svg:Y,type:te,window:ne}){this._svg=Y,this._type=te,this._window=ne}draw(Y,te,ne,se){let ee;ee=this._type===F.square?this._drawSquare:this._drawDot,ee.call(this,{x:Y,y:te,size:ne,rotation:se})}_rotateFigure({x:Y,y:te,size:ne,rotation:se=0,draw:ee}){var Z;const ue=Y+ne/2,_e=te+ne/2;ee(),(Z=this._element)===null||Z===void 0||Z.setAttribute("transform",`rotate(${180*se/Math.PI},${ue},${_e})`)}_basicDot(Y){const{size:te,x:ne,y:se}=Y;this._rotateFigure(Object.assign(Object.assign({},Y),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","circle"),this._element.setAttribute("cx",String(ne+te/2)),this._element.setAttribute("cy",String(se+te/2)),this._element.setAttribute("r",String(te/2))}}))}_basicSquare(Y){const{size:te,x:ne,y:se}=Y;this._rotateFigure(Object.assign(Object.assign({},Y),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","rect"),this._element.setAttribute("x",String(ne)),this._element.setAttribute("y",String(se)),this._element.setAttribute("width",String(te)),this._element.setAttribute("height",String(te))}}))}_drawDot({x:Y,y:te,size:ne,rotation:se}){this._basicDot({x:Y,y:te,size:ne,rotation:se})}_drawSquare({x:Y,y:te,size:ne,rotation:se}){this._basicSquare({x:Y,y:te,size:ne,rotation:se})}}const J="circle",ie=[[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],oe=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]];class le{constructor(Y,te){this._roundSize=ne=>this._options.dotsOptions.roundSize?Math.floor(ne):ne,this._window=te,this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","svg"),this._element.setAttribute("width",String(Y.width)),this._element.setAttribute("height",String(Y.height)),this._element.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),Y.dotsOptions.roundSize||this._element.setAttribute("shape-rendering","crispEdges"),this._element.setAttribute("viewBox",`0 0 ${Y.width} ${Y.height}`),this._defs=this._window.document.createElementNS("http://www.w3.org/2000/svg","defs"),this._element.appendChild(this._defs),this._imageUri=Y.image,this._instanceId=le.instanceCount++,this._options=Y}get width(){return this._options.width}get height(){return this._options.height}getElement(){return this._element}async drawQR(Y){const te=Y.getModuleCount(),ne=Math.min(this._options.width,this._options.height)-2*this._options.margin,se=this._options.shape===J?ne/Math.sqrt(2):ne,ee=this._roundSize(se/te);let Z={hideXDots:0,hideYDots:0,width:0,height:0};if(this._qr=Y,this._options.image){if(await this.loadImage(),!this._image)return;const{imageOptions:ue,qrOptions:_e}=this._options,Re=ue.imageSize*$[_e.errorCorrectionLevel],Ae=Math.floor(Re*te*te);Z=(function({originalHeight:ge,originalWidth:be,maxHiddenDots:Te,maxHiddenAxisDots:De,dotSize:Ie}){const Se={x:0,y:0},Be={x:0,y:0};if(ge<=0||be<=0||Te<=0||Ie<=0)return{height:0,width:0,hideYDots:0,hideXDots:0};const Le=ge/be;return Se.x=Math.floor(Math.sqrt(Te/Le)),Se.x<=0&&(Se.x=1),De&&De<Se.x&&(Se.x=De),Se.x%2==0&&Se.x--,Be.x=Se.x*Ie,Se.y=1+2*Math.ceil((Se.x*Le-1)/2),Be.y=Math.round(Be.x*Le),(Se.y*Se.x>Te||De&&De<Se.y)&&(De&&De<Se.y?(Se.y=De,Se.y%2==0&&Se.x--):Se.y-=2,Be.y=Se.y*Ie,Se.x=1+2*Math.ceil((Se.y/Le-1)/2),Be.x=Math.round(Be.y/Le)),{height:Be.y,width:Be.x,hideYDots:Se.y,hideXDots:Se.x}})({originalWidth:this._image.width,originalHeight:this._image.height,maxHiddenDots:Ae,maxHiddenAxisDots:te-14,dotSize:ee})}this.drawBackground(),this.drawDots(((ue,_e)=>{var Re,Ae,ge,be,Te,De;return!(this._options.imageOptions.hideBackgroundDots&&ue>=(te-Z.hideYDots)/2&&ue<(te+Z.hideYDots)/2&&_e>=(te-Z.hideXDots)/2&&_e<(te+Z.hideXDots)/2||!((Re=ie[ue])===null||Re===void 0)&&Re[_e]||!((Ae=ie[ue-te+7])===null||Ae===void 0)&&Ae[_e]||!((ge=ie[ue])===null||ge===void 0)&&ge[_e-te+7]||!((be=oe[ue])===null||be===void 0)&&be[_e]||!((Te=oe[ue-te+7])===null||Te===void 0)&&Te[_e]||!((De=oe[ue])===null||De===void 0)&&De[_e-te+7])})),this.drawCorners(),this._options.image&&await this.drawImage({width:Z.width,height:Z.height,count:te,dotSize:ee})}drawBackground(){var Y,te,ne;const se=this._element,ee=this._options;if(se){const Z=(Y=ee.backgroundOptions)===null||Y===void 0?void 0:Y.gradient,ue=(te=ee.backgroundOptions)===null||te===void 0?void 0:te.color;let _e=ee.height,Re=ee.width;if(Z||ue){const Ae=this._window.document.createElementNS("http://www.w3.org/2000/svg","rect");this._backgroundClipPath=this._window.document.createElementNS("http://www.w3.org/2000/svg","clipPath"),this._backgroundClipPath.setAttribute("id",`clip-path-background-color-${this._instanceId}`),this._defs.appendChild(this._backgroundClipPath),!((ne=ee.backgroundOptions)===null||ne===void 0)&&ne.round&&(_e=Re=Math.min(ee.width,ee.height),Ae.setAttribute("rx",String(_e/2*ee.backgroundOptions.round))),Ae.setAttribute("x",String(this._roundSize((ee.width-Re)/2))),Ae.setAttribute("y",String(this._roundSize((ee.height-_e)/2))),Ae.setAttribute("width",String(Re)),Ae.setAttribute("height",String(_e)),this._backgroundClipPath.appendChild(Ae),this._createColor({options:Z,color:ue,additionalRotation:0,x:0,y:0,height:ee.height,width:ee.width,name:`background-color-${this._instanceId}`})}}}drawDots(Y){var te,ne;if(!this._qr)throw"QR code is not defined";const se=this._options,ee=this._qr.getModuleCount();if(ee>se.width||ee>se.height)throw"The canvas is too small.";const Z=Math.min(se.width,se.height)-2*se.margin,ue=se.shape===J?Z/Math.sqrt(2):Z,_e=this._roundSize(ue/ee),Re=this._roundSize((se.width-ee*_e)/2),Ae=this._roundSize((se.height-ee*_e)/2),ge=new R({svg:this._element,type:se.dotsOptions.type,window:this._window});this._dotsClipPath=this._window.document.createElementNS("http://www.w3.org/2000/svg","clipPath"),this._dotsClipPath.setAttribute("id",`clip-path-dot-color-${this._instanceId}`),this._defs.appendChild(this._dotsClipPath),this._createColor({options:(te=se.dotsOptions)===null||te===void 0?void 0:te.gradient,color:se.dotsOptions.color,additionalRotation:0,x:0,y:0,height:se.height,width:se.width,name:`dot-color-${this._instanceId}`});for(let be=0;be<ee;be++)for(let Te=0;Te<ee;Te++)Y&&!Y(be,Te)||!((ne=this._qr)===null||ne===void 0)&&ne.isDark(be,Te)&&(ge.draw(Re+Te*_e,Ae+be*_e,_e,((De,Ie)=>!(Te+De<0||be+Ie<0||Te+De>=ee||be+Ie>=ee)&&!(Y&&!Y(be+Ie,Te+De))&&!!this._qr&&this._qr.isDark(be+Ie,Te+De))),ge._element&&this._dotsClipPath&&this._dotsClipPath.appendChild(ge._element));if(se.shape===J){const be=this._roundSize((Z/_e-ee)/2),Te=ee+2*be,De=Re-be*_e,Ie=Ae-be*_e,Se=[],Be=this._roundSize(Te/2);for(let Le=0;Le<Te;Le++){Se[Le]=[];for(let qe=0;qe<Te;qe++)Le>=be-1&&Le<=Te-be&&qe>=be-1&&qe<=Te-be||Math.sqrt((Le-Be)*(Le-Be)+(qe-Be)*(qe-Be))>Be?Se[Le][qe]=0:Se[Le][qe]=this._qr.isDark(qe-2*be<0?qe:qe>=ee?qe-2*be:qe-be,Le-2*be<0?Le:Le>=ee?Le-2*be:Le-be)?1:0}for(let Le=0;Le<Te;Le++)for(let qe=0;qe<Te;qe++)Se[Le][qe]&&(ge.draw(De+qe*_e,Ie+Le*_e,_e,((Ke,Ge)=>{var Xe;return!!(!((Xe=Se[Le+Ge])===null||Xe===void 0)&&Xe[qe+Ke])})),ge._element&&this._dotsClipPath&&this._dotsClipPath.appendChild(ge._element))}}drawCorners(){if(!this._qr)throw"QR code is not defined";const Y=this._element,te=this._options;if(!Y)throw"Element code is not defined";const ne=this._qr.getModuleCount(),se=Math.min(te.width,te.height)-2*te.margin,ee=te.shape===J?se/Math.sqrt(2):se,Z=this._roundSize(ee/ne),ue=7*Z,_e=3*Z,Re=this._roundSize((te.width-ne*Z)/2),Ae=this._roundSize((te.height-ne*Z)/2);[[0,0,0],[1,0,Math.PI/2],[0,1,-Math.PI/2]].forEach((([ge,be,Te])=>{var De,Ie,Se,Be,Le,qe,Ke,Ge,Xe,ze,et,Ze,nt,ut;const ot=Re+ge*Z*(ne-7),vt=Ae+be*Z*(ne-7);let bt=this._dotsClipPath,lt=this._dotsClipPath;if((!((De=te.cornersSquareOptions)===null||De===void 0)&&De.gradient||!((Ie=te.cornersSquareOptions)===null||Ie===void 0)&&Ie.color)&&(bt=this._window.document.createElementNS("http://www.w3.org/2000/svg","clipPath"),bt.setAttribute("id",`clip-path-corners-square-color-${ge}-${be}-${this._instanceId}`),this._defs.appendChild(bt),this._cornersSquareClipPath=this._cornersDotClipPath=lt=bt,this._createColor({options:(Se=te.cornersSquareOptions)===null||Se===void 0?void 0:Se.gradient,color:(Be=te.cornersSquareOptions)===null||Be===void 0?void 0:Be.color,additionalRotation:Te,x:ot,y:vt,height:ue,width:ue,name:`corners-square-color-${ge}-${be}-${this._instanceId}`})),((Le=te.cornersSquareOptions)===null||Le===void 0?void 0:Le.type)&&O.includes(te.cornersSquareOptions.type)){const kt=new B({svg:this._element,type:te.cornersSquareOptions.type,window:this._window});kt.draw(ot,vt,ue,Te),kt._element&&bt&&bt.appendChild(kt._element)}else{const kt=new R({svg:this._element,type:((qe=te.cornersSquareOptions)===null||qe===void 0?void 0:qe.type)||te.dotsOptions.type,window:this._window});for(let Ct=0;Ct<ie.length;Ct++)for(let Me=0;Me<ie[Ct].length;Me++)!((Ke=ie[Ct])===null||Ke===void 0)&&Ke[Me]&&(kt.draw(ot+Me*Z,vt+Ct*Z,Z,((Ce,Ee)=>{var Pe;return!!(!((Pe=ie[Ct+Ee])===null||Pe===void 0)&&Pe[Me+Ce])})),kt._element&&bt&&bt.appendChild(kt._element))}if((!((Ge=te.cornersDotOptions)===null||Ge===void 0)&&Ge.gradient||!((Xe=te.cornersDotOptions)===null||Xe===void 0)&&Xe.color)&&(lt=this._window.document.createElementNS("http://www.w3.org/2000/svg","clipPath"),lt.setAttribute("id",`clip-path-corners-dot-color-${ge}-${be}-${this._instanceId}`),this._defs.appendChild(lt),this._cornersDotClipPath=lt,this._createColor({options:(ze=te.cornersDotOptions)===null||ze===void 0?void 0:ze.gradient,color:(et=te.cornersDotOptions)===null||et===void 0?void 0:et.color,additionalRotation:Te,x:ot+2*Z,y:vt+2*Z,height:_e,width:_e,name:`corners-dot-color-${ge}-${be}-${this._instanceId}`})),((Ze=te.cornersDotOptions)===null||Ze===void 0?void 0:Ze.type)&&U.includes(te.cornersDotOptions.type)){const kt=new q({svg:this._element,type:te.cornersDotOptions.type,window:this._window});kt.draw(ot+2*Z,vt+2*Z,_e,Te),kt._element&&lt&&lt.appendChild(kt._element)}else{const kt=new R({svg:this._element,type:((nt=te.cornersDotOptions)===null||nt===void 0?void 0:nt.type)||te.dotsOptions.type,window:this._window});for(let Ct=0;Ct<oe.length;Ct++)for(let Me=0;Me<oe[Ct].length;Me++)!((ut=oe[Ct])===null||ut===void 0)&&ut[Me]&&(kt.draw(ot+Me*Z,vt+Ct*Z,Z,((Ce,Ee)=>{var Pe;return!!(!((Pe=oe[Ct+Ee])===null||Pe===void 0)&&Pe[Me+Ce])})),kt._element&&lt&&lt.appendChild(kt._element))}}))}loadImage(){return new Promise(((Y,te)=>{var ne;const se=this._options;if(!se.image)return te("Image is not defined");if(!((ne=se.nodeCanvas)===null||ne===void 0)&&ne.loadImage)se.nodeCanvas.loadImage(se.image).then((ee=>{var Z,ue;if(this._image=ee,this._options.imageOptions.saveAsBlob){const _e=(Z=se.nodeCanvas)===null||Z===void 0?void 0:Z.createCanvas(this._image.width,this._image.height);(ue=_e?.getContext("2d"))===null||ue===void 0||ue.drawImage(ee,0,0),this._imageUri=_e?.toDataURL()}Y()})).catch(te);else{const ee=new this._window.Image;typeof se.imageOptions.crossOrigin=="string"&&(ee.crossOrigin=se.imageOptions.crossOrigin),this._image=ee,ee.onload=async()=>{this._options.imageOptions.saveAsBlob&&(this._imageUri=await(async function(Z,ue){return new Promise((_e=>{const Re=new ue.XMLHttpRequest;Re.onload=function(){const Ae=new ue.FileReader;Ae.onloadend=function(){_e(Ae.result)},Ae.readAsDataURL(Re.response)},Re.open("GET",Z),Re.responseType="blob",Re.send()}))})(se.image||"",this._window)),Y()},ee.src=se.image}}))}async drawImage({width:Y,height:te,count:ne,dotSize:se}){const ee=this._options,Z=this._roundSize((ee.width-ne*se)/2),ue=this._roundSize((ee.height-ne*se)/2),_e=Z+this._roundSize(ee.imageOptions.margin+(ne*se-Y)/2),Re=ue+this._roundSize(ee.imageOptions.margin+(ne*se-te)/2),Ae=Y-2*ee.imageOptions.margin,ge=te-2*ee.imageOptions.margin,be=this._window.document.createElementNS("http://www.w3.org/2000/svg","image");be.setAttribute("href",this._imageUri||""),be.setAttribute("xlink:href",this._imageUri||""),be.setAttribute("x",String(_e)),be.setAttribute("y",String(Re)),be.setAttribute("width",`${Ae}px`),be.setAttribute("height",`${ge}px`),this._element.appendChild(be)}_createColor({options:Y,color:te,additionalRotation:ne,x:se,y:ee,height:Z,width:ue,name:_e}){const Re=ue>Z?ue:Z,Ae=this._window.document.createElementNS("http://www.w3.org/2000/svg","rect");if(Ae.setAttribute("x",String(se)),Ae.setAttribute("y",String(ee)),Ae.setAttribute("height",String(Z)),Ae.setAttribute("width",String(ue)),Ae.setAttribute("clip-path",`url('#clip-path-${_e}')`),Y){let ge;if(Y.type==="radial")ge=this._window.document.createElementNS("http://www.w3.org/2000/svg","radialGradient"),ge.setAttribute("id",_e),ge.setAttribute("gradientUnits","userSpaceOnUse"),ge.setAttribute("fx",String(se+ue/2)),ge.setAttribute("fy",String(ee+Z/2)),ge.setAttribute("cx",String(se+ue/2)),ge.setAttribute("cy",String(ee+Z/2)),ge.setAttribute("r",String(Re/2));else{const be=((Y.rotation||0)+ne)%(2*Math.PI),Te=(be+2*Math.PI)%(2*Math.PI);let De=se+ue/2,Ie=ee+Z/2,Se=se+ue/2,Be=ee+Z/2;Te>=0&&Te<=.25*Math.PI||Te>1.75*Math.PI&&Te<=2*Math.PI?(De-=ue/2,Ie-=Z/2*Math.tan(be),Se+=ue/2,Be+=Z/2*Math.tan(be)):Te>.25*Math.PI&&Te<=.75*Math.PI?(Ie-=Z/2,De-=ue/2/Math.tan(be),Be+=Z/2,Se+=ue/2/Math.tan(be)):Te>.75*Math.PI&&Te<=1.25*Math.PI?(De+=ue/2,Ie+=Z/2*Math.tan(be),Se-=ue/2,Be-=Z/2*Math.tan(be)):Te>1.25*Math.PI&&Te<=1.75*Math.PI&&(Ie+=Z/2,De+=ue/2/Math.tan(be),Be-=Z/2,Se-=ue/2/Math.tan(be)),ge=this._window.document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),ge.setAttribute("id",_e),ge.setAttribute("gradientUnits","userSpaceOnUse"),ge.setAttribute("x1",String(Math.round(De))),ge.setAttribute("y1",String(Math.round(Ie))),ge.setAttribute("x2",String(Math.round(Se))),ge.setAttribute("y2",String(Math.round(Be)))}Y.colorStops.forEach((({offset:be,color:Te})=>{const De=this._window.document.createElementNS("http://www.w3.org/2000/svg","stop");De.setAttribute("offset",100*be+"%"),De.setAttribute("stop-color",Te),ge.appendChild(De)})),Ae.setAttribute("fill",`url('#${_e}')`),this._defs.appendChild(ge)}else te&&Ae.setAttribute("fill",te);this._element.appendChild(Ae)}}le.instanceCount=0;const de=le,fe="canvas",ye={};for(let re=0;re<=40;re++)ye[re]=re;const we={type:fe,shape:"square",width:300,height:300,data:"",margin:0,qrOptions:{typeNumber:ye[0],mode:void 0,errorCorrectionLevel:"Q"},imageOptions:{saveAsBlob:!0,hideBackgroundDots:!0,imageSize:.4,crossOrigin:void 0,margin:0},dotsOptions:{type:"square",color:"#000",roundSize:!0},backgroundOptions:{round:0,color:"#fff"}};function pe(re){const Y=Object.assign({},re);if(!Y.colorStops||!Y.colorStops.length)throw"Field 'colorStops' is required in gradient";return Y.rotation?Y.rotation=Number(Y.rotation):Y.rotation=0,Y.colorStops=Y.colorStops.map((te=>Object.assign(Object.assign({},te),{offset:Number(te.offset)}))),Y}function ve(re){const Y=Object.assign({},re);return Y.width=Number(Y.width),Y.height=Number(Y.height),Y.margin=Number(Y.margin),Y.imageOptions=Object.assign(Object.assign({},Y.imageOptions),{hideBackgroundDots:!!Y.imageOptions.hideBackgroundDots,imageSize:Number(Y.imageOptions.imageSize),margin:Number(Y.imageOptions.margin)}),Y.margin>Math.min(Y.width,Y.height)&&(Y.margin=Math.min(Y.width,Y.height)),Y.dotsOptions=Object.assign({},Y.dotsOptions),Y.dotsOptions.gradient&&(Y.dotsOptions.gradient=pe(Y.dotsOptions.gradient)),Y.cornersSquareOptions&&(Y.cornersSquareOptions=Object.assign({},Y.cornersSquareOptions),Y.cornersSquareOptions.gradient&&(Y.cornersSquareOptions.gradient=pe(Y.cornersSquareOptions.gradient))),Y.cornersDotOptions&&(Y.cornersDotOptions=Object.assign({},Y.cornersDotOptions),Y.cornersDotOptions.gradient&&(Y.cornersDotOptions.gradient=pe(Y.cornersDotOptions.gradient))),Y.backgroundOptions&&(Y.backgroundOptions=Object.assign({},Y.backgroundOptions),Y.backgroundOptions.gradient&&(Y.backgroundOptions.gradient=pe(Y.backgroundOptions.gradient))),Y}var he=b(873),ae=b.n(he);function Q(re){if(!re)throw new Error("Extension must be defined");re[0]==="."&&(re=re.substring(1));const Y={bmp:"image/bmp",gif:"image/gif",ico:"image/vnd.microsoft.icon",jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",webp:"image/webp",pdf:"application/pdf"}[re.toLowerCase()];if(!Y)throw new Error(`Extension "${re}" is not supported`);return Y}class j{constructor(Y){Y?.jsdom?this._window=new Y.jsdom("",{resources:"usable"}).window:this._window=window,this._options=Y?ve(S(we,Y)):we,this.update()}static _clearContainer(Y){Y&&(Y.innerHTML="")}_setupSvg(){if(!this._qr)return;const Y=new de(this._options,this._window);this._svg=Y.getElement(),this._svgDrawingPromise=Y.drawQR(this._qr).then((()=>{var te;this._svg&&((te=this._extension)===null||te===void 0||te.call(this,Y.getElement(),this._options))}))}_setupCanvas(){var Y,te;this._qr&&(!((Y=this._options.nodeCanvas)===null||Y===void 0)&&Y.createCanvas?(this._nodeCanvas=this._options.nodeCanvas.createCanvas(this._options.width,this._options.height),this._nodeCanvas.width=this._options.width,this._nodeCanvas.height=this._options.height):(this._domCanvas=document.createElement("canvas"),this._domCanvas.width=this._options.width,this._domCanvas.height=this._options.height),this._setupSvg(),this._canvasDrawingPromise=(te=this._svgDrawingPromise)===null||te===void 0?void 0:te.then((()=>{var ne;if(!this._svg)return;const se=this._svg,ee=new this._window.XMLSerializer().serializeToString(se),Z=btoa(ee),ue=`data:${Q("svg")};base64,${Z}`;if(!((ne=this._options.nodeCanvas)===null||ne===void 0)&&ne.loadImage)return this._options.nodeCanvas.loadImage(ue).then((_e=>{var Re,Ae;_e.width=this._options.width,_e.height=this._options.height,(Ae=(Re=this._nodeCanvas)===null||Re===void 0?void 0:Re.getContext("2d"))===null||Ae===void 0||Ae.drawImage(_e,0,0)}));{const _e=new this._window.Image;return new Promise((Re=>{_e.onload=()=>{var Ae,ge;(ge=(Ae=this._domCanvas)===null||Ae===void 0?void 0:Ae.getContext("2d"))===null||ge===void 0||ge.drawImage(_e,0,0),Re()},_e.src=ue}))}})))}async _getElement(Y="png"){if(!this._qr)throw"QR code is empty";return Y.toLowerCase()==="svg"?(this._svg&&this._svgDrawingPromise||this._setupSvg(),await this._svgDrawingPromise,this._svg):((this._domCanvas||this._nodeCanvas)&&this._canvasDrawingPromise||this._setupCanvas(),await this._canvasDrawingPromise,this._domCanvas||this._nodeCanvas)}update(Y){j._clearContainer(this._container),this._options=Y?ve(S(this._options,Y)):this._options,this._options.data&&(this._qr=ae()(this._options.qrOptions.typeNumber,this._options.qrOptions.errorCorrectionLevel),this._qr.addData(this._options.data,this._options.qrOptions.mode||(function(te){switch(!0){case/^[0-9]*$/.test(te):return"Numeric";case/^[0-9A-Z $%*+\-./:]*$/.test(te):return"Alphanumeric";default:return"Byte"}})(this._options.data)),this._qr.make(),this._options.type===fe?this._setupCanvas():this._setupSvg(),this.append(this._container))}append(Y){if(Y){if(typeof Y.appendChild!="function")throw"Container should be a single DOM node";this._options.type===fe?this._domCanvas&&Y.appendChild(this._domCanvas):this._svg&&Y.appendChild(this._svg),this._container=Y}}applyExtension(Y){if(!Y)throw"Extension function should be defined.";this._extension=Y,this.update()}deleteExtension(){this._extension=void 0,this.update()}async getRawData(Y="png"){if(!this._qr)throw"QR code is empty";const te=await this._getElement(Y),ne=Q(Y);if(!te)return null;if(Y.toLowerCase()==="svg"){const se=`<?xml version="1.0" standalone="no"?>\r
${new this._window.XMLSerializer().serializeToString(te)}`;return typeof Blob>"u"||this._options.jsdom?Buffer.from(se):new Blob([se],{type:ne})}return new Promise((se=>{const ee=te;if("toBuffer"in ee)if(ne==="image/png")se(ee.toBuffer(ne));else if(ne==="image/jpeg")se(ee.toBuffer(ne));else{if(ne!=="application/pdf")throw Error("Unsupported extension");se(ee.toBuffer(ne))}else"toBlob"in ee&&ee.toBlob(se,ne,1)}))}async download(Y){if(!this._qr)throw"QR code is empty";if(typeof Blob>"u")throw"Cannot download in Node.js, call getRawData instead.";let te="png",ne="qr";typeof Y=="string"?(te=Y,console.warn("Extension is deprecated as argument for 'download' method, please pass object { name: '...', extension: '...' } as argument")):typeof Y=="object"&&Y!==null&&(Y.name&&(ne=Y.name),Y.extension&&(te=Y.extension));const se=await this._getElement(te);if(se)if(te.toLowerCase()==="svg"){let ee=new XMLSerializer().serializeToString(se);ee=`<?xml version="1.0" standalone="no"?>\r
`+ee,A(`data:${Q(te)};charset=utf-8,${encodeURIComponent(ee)}`,`${ne}.svg`)}else A(se.toDataURL(Q(te)),`${ne}.${te}`)}}const z=j})(),w.default})()))})(qrCodeStyling$1)),qrCodeStyling$1.exports}var qrCodeStylingExports=requireQrCodeStyling();const QRCodeStyling=getDefaultExportFromCjs$3(qrCodeStylingExports),unicityLogo="/sphere/dev/images/unicity_logo.svg";function getQRSize(){if(typeof window>"u")return 200;const y=window.innerWidth;return y<360?160:y<400?180:200}function QRModal({show:y,address:u,onClose:g}){const v=reactExports.useRef(null),[b,w]=reactExports.useState(!1),[E,S]=reactExports.useState(getQRSize);return reactExports.useEffect(()=>{const A=()=>S(getQRSize());return window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]),reactExports.useEffect(()=>{y&&u&&v.current&&(v.current.innerHTML="",new QRCodeStyling({width:E,height:E,data:u,margin:0,qrOptions:{typeNumber:0,mode:"Byte",errorCorrectionLevel:"M"},imageOptions:{hideBackgroundDots:!0,imageSize:.2,margin:3},dotsOptions:{type:"rounded",color:"#ffffff"},backgroundOptions:{color:"#1a1a1a"},cornersSquareOptions:{type:"extra-rounded",color:"#ffffff"},cornersDotOptions:{type:"dot",color:"#ffffff"},image:unicityLogo}).append(v.current))},[y,u,E]),y?jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:g,children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.8,opacity:0,y:20},transition:{type:"spring",duration:.5},className:"relative w-full max-w-sm bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl p-4 sm:p-6 overflow-hidden max-h-[90vh] overflow-y-auto",onClick:A=>A.stopPropagation(),children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-center mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg sm:text-xl font-bold text-neutral-900 dark:text-white mb-1",children:"Receive ALPHA"}),jsxRuntimeExports.jsx("p",{className:"text-xs sm:text-sm text-neutral-500 dark:text-neutral-400",children:"Scan QR code to receive payment"})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2,type:"spring"},className:"relative bg-neutral-900 p-4 sm:p-6 rounded-2xl shadow-inner mb-4 flex items-center justify-center",children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"absolute top-2 left-2 w-5 h-5 sm:w-6 sm:h-6 border-t-[3px] border-l-[3px] sm:border-t-4 sm:border-l-4 border-blue-500 rounded-tl-lg"}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.35},className:"absolute top-2 right-2 w-5 h-5 sm:w-6 sm:h-6 border-t-[3px] border-r-[3px] sm:border-t-4 sm:border-r-4 border-blue-500 rounded-tr-lg"}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"absolute bottom-2 left-2 w-5 h-5 sm:w-6 sm:h-6 border-b-[3px] border-l-[3px] sm:border-b-4 sm:border-l-4 border-blue-500 rounded-bl-lg"}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.45},className:"absolute bottom-2 right-2 w-5 h-5 sm:w-6 sm:h-6 border-b-[3px] border-r-[3px] sm:border-b-4 sm:border-r-4 border-blue-500 rounded-br-lg"}),jsxRuntimeExports.jsx("div",{ref:v,style:{width:E,height:E}})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-neutral-100 dark:bg-neutral-800/50 rounded-xl p-3 sm:p-4 mb-4 border border-neutral-200 dark:border-neutral-700/50 backdrop-blur-sm",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mb-2 text-center",children:"Your Address"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("a",{href:`https://www.unicity.network/address/${u}`,target:"_blank",rel:"noopener noreferrer",className:"flex-1 text-xs font-mono text-blue-500 dark:text-blue-400 hover:text-blue-400 dark:hover:text-blue-300 break-all text-center transition-colors",children:u}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{navigator.clipboard.writeText(u),w(!0),setTimeout(()=>w(!1),2e3)},className:`p-2 rounded-lg transition-all ${b?"bg-green-600 hover:bg-green-500 shadow-lg shadow-green-500/20":"bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600"} text-neutral-800 dark:text-white`,title:b?"Copied!":"Copy address",children:jsxRuntimeExports.jsx(motion.div,{initial:!1,animate:{rotate:b?[0,-10,10,0]:0},transition:{duration:.3},children:b?jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 text-white"}):jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"})})})]})]}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:g,className:"w-full px-4 py-2.5 sm:py-3 rounded-xl bg-linear-to-br from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-semibold shadow-lg shadow-blue-500/20 transition-all text-sm sm:text-base",children:"Close"})]})}):null}function SaveWalletModal({show:y,onConfirm:u,onCancel:g,hasMnemonic:v}){const[b,w]=reactExports.useState("alpha_wallet_backup"),[E,S]=reactExports.useState(""),[A,$]=reactExports.useState(""),[R,T]=reactExports.useState("");if(!y)return null;const O=()=>{if(T(""),E){if(E!==A){T("Passwords do not match!");return}if(E.length<4){T("Password must be at least 4 characters");return}}u(b,E||void 0),w("alpha_wallet_backup"),S(""),$(""),T("")};return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:g,children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",duration:.4},className:"relative w-full max-w-md bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl p-6 overflow-hidden",onClick:B=>B.stopPropagation(),children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1},className:"flex flex-col items-center text-center mb-6",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"w-12 h-12 bg-blue-500/10 rounded-full flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(motion.div,{animate:{y:[0,-2,0]},transition:{delay:.3,duration:1.5,repeat:1/0,ease:"easeInOut"},children:jsxRuntimeExports.jsx(Shield,{className:"w-6 h-6 text-blue-500"})})}),jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white text-xl font-bold mb-2",children:"Backup Wallet"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"Export your wallet keys to a JSON file. Keep this safe!"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4 p-2 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:[jsxRuntimeExports.jsx(FileBraces,{className:"w-4 h-4 text-blue-500"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-blue-500 font-medium",children:"JSON Format"}),v&&jsxRuntimeExports.jsx("span",{className:"text-[10px] bg-green-500/20 text-green-500 px-1.5 py-0.5 rounded",children:"+mnemonic"})]}),jsxRuntimeExports.jsxs("p",{className:"text-[10px] text-neutral-400 mb-4 text-center",children:["Includes verification address",v?" and recovery phrase":""]}),jsxRuntimeExports.jsx("label",{className:"text-xs text-neutral-500 mb-1 block",children:"Filename"}),jsxRuntimeExports.jsx("input",{placeholder:"Filename",value:b,onChange:B=>w(B.target.value),className:"w-full mb-3 px-3 py-2 bg-neutral-100 dark:bg-neutral-800 rounded text-neutral-800 dark:text-neutral-200 placeholder-neutral-400 border border-neutral-200 dark:border-neutral-700 focus:border-blue-500 outline-none transition-colors"}),jsxRuntimeExports.jsx("label",{className:"text-xs text-neutral-500 mb-1 block",children:"Encryption Password (Optional)"}),jsxRuntimeExports.jsx("input",{placeholder:"Password",type:"password",value:E,onChange:B=>S(B.target.value),className:"w-full mb-3 px-3 py-2 bg-neutral-100 dark:bg-neutral-800 rounded text-neutral-800 dark:text-neutral-200 placeholder-neutral-400 border border-neutral-200 dark:border-neutral-700 focus:border-blue-500 outline-none transition-colors"}),jsxRuntimeExports.jsx("input",{placeholder:"Confirm Password",type:"password",value:A,onChange:B=>$(B.target.value),className:"w-full mb-4 px-3 py-2 bg-neutral-100 dark:bg-neutral-800 rounded text-neutral-800 dark:text-neutral-200 placeholder-neutral-400 border border-neutral-200 dark:border-neutral-700 focus:border-blue-500 outline-none transition-colors"}),R&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-4 p-3 bg-red-500/10 border border-red-900/50 rounded-lg flex items-center gap-2",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-4 h-4 text-red-500 shrink-0"}),jsxRuntimeExports.jsx("span",{className:"text-red-400 text-sm",children:R})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:g,className:"flex-1 py-2 bg-neutral-200 dark:bg-neutral-700 rounded text-neutral-700 dark:text-white hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:O,className:"flex-1 py-2 bg-linear-to-br from-blue-600 to-blue-700 rounded text-white hover:from-blue-500 hover:to-blue-600 transition-all shadow-lg shadow-blue-500/20",children:"Save"})]})]})})}function TransactionConfirmationModal({show:y,txPlan:u,destination:g,amount:v,isSending:b,onConfirm:w,onCancel:E}){return!y||!u?null:jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"relative w-full max-w-md bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl p-6 overflow-hidden",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl text-neutral-900 dark:text-white font-bold mb-4",children:"Confirm Transaction"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-neutral-500 dark:text-neutral-400",children:"Recipient"}),jsxRuntimeExports.jsx("span",{className:"text-neutral-900 dark:text-white font-mono truncate max-w-[200px]",children:g})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-neutral-500 dark:text-neutral-400",children:"Amount"}),jsxRuntimeExports.jsxs("span",{className:"text-neutral-900 dark:text-white",children:[v," ALPHA"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-neutral-500 dark:text-neutral-400",children:"Transactions"}),jsxRuntimeExports.jsx("span",{className:"text-neutral-900 dark:text-white",children:u.transactions.length})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-neutral-500 dark:text-neutral-400",children:"Total Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-neutral-900 dark:text-white",children:[u.transactions.length*1e4/1e8," ALPHA"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:E,className:"flex-1 px-4 py-3 rounded-xl bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-white font-semibold hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors",disabled:b,children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:w,className:"flex-1 px-4 py-3 rounded-xl bg-green-600 text-white font-semibold hover:bg-green-500 flex items-center justify-center gap-2 transition-colors disabled:opacity-70",disabled:b,children:b?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}),"Sending..."]}):"Confirm & Send"})]})]})})}const ec=new elliptic.ec("secp256k1"),L3_PROXY_URL="https://alpha-migri.dyndns.org",MESSAGE_PREFIX=`Alpha Signed Message:
`;function varintBuf(y){if(y<253)return new Uint8Array([y]);if(y<65536){const u=new Uint8Array(3);return u[0]=253,u[1]=y&255,u[2]=y>>8&255,u}throw new Error("Message too long")}function createMessageHash(y){const u=new TextEncoder().encode(MESSAGE_PREFIX),g=new TextEncoder().encode(y),v=varintBuf(u.length),b=varintBuf(g.length),w=new Uint8Array(v.length+u.length+b.length+g.length);let E=0;w.set(v,E),E+=v.length,w.set(u,E),E+=u.length,w.set(b,E),E+=b.length,w.set(g,E);const S=Array.from(w).map(R=>R.toString(16).padStart(2,"0")).join(""),A=CryptoJS.SHA256(CryptoJS.enc.Hex.parse(S)).toString();return CryptoJS.SHA256(CryptoJS.enc.Hex.parse(A)).toString()}function signMessage(y,u){const g=ec.keyFromPrivate(y,"hex"),v=createMessageHash(u),b=Buffer.from(v,"hex"),w=g.sign(b,{canonical:!0}),E=g.getPublic();let S=-1;for(let T=0;T<4;T++)try{if(ec.recoverPubKey(b,w,T).eq(E)){S=T;break}}catch{continue}if(S===-1)throw new Error("Could not find recovery parameter");const A=31+S,$=w.r.toString("hex").padStart(64,"0"),R=w.s.toString("hex").padStart(64,"0");return A.toString(16).padStart(2,"0")+$+R}function BridgeModal({show:y,address:u,privateKey:g,onClose:v,onSuccess:b}){const[w,E]=reactExports.useState(""),[S,A]=reactExports.useState("idle"),[$,R]=reactExports.useState(null),[T,O]=reactExports.useState(null),B=reactExports.useCallback(async()=>{A("checking"),O(null);try{const q=await(await fetch(`${L3_PROXY_URL}/api/v1/faucet/balance/${u}`)).json();if(!q.success){A("not_eligible"),O(q.error||"Address not found in snapshot");return}R(q),q.spent?A("already_minted"):q.inSnapshot&&q.amount>0?A("available"):(A("not_eligible"),O("Address is not eligible for migration"))}catch(U){A("error"),O("Failed to check balance: "+(U instanceof Error?U.message:String(U)))}},[u]);reactExports.useEffect(()=>{y&&u?B():(A("idle"),R(null),O(null),E(""))},[y,u,B]);const F=async()=>{if(!w.trim()){O("Please enter your L3 Unicity ID");return}if(!$){O("Balance info not available");return}const U=w.trim();O(null),A("signing");try{const q=$.amountInSmallUnits,J=`${u}:${U}:${q}`,ie=signMessage(g,J);A("minting");const le=await(await fetch(`${L3_PROXY_URL}/api/v1/faucet/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({l1_addr:u,unicityId:U,amount:q,signature:ie})})).json();le.success?(A("success"),b&&b(le.txId,le.amount)):(A("error"),O(le.error||"Minting failed"))}catch(q){A("error"),O("Bridge failed: "+(q instanceof Error?q.message:String(q)))}};return y?jsxRuntimeExports.jsx(AnimatePresence,{children:jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:v,children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",duration:.4},className:"relative w-full max-w-md bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl p-4 sm:p-6 max-h-[85vh] overflow-y-auto",onClick:U=>U.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsxs("h3",{className:"text-neutral-900 dark:text-white text-xl font-bold flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-linear-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeftRight,{className:"w-4 h-4 text-white"})}),"Bridge to L3"]}),jsxRuntimeExports.jsx("button",{onClick:v,className:"text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-4 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-amber-500 mt-0.5 shrink-0"}),jsxRuntimeExports.jsxs("div",{className:"text-sm",children:[jsxRuntimeExports.jsx("p",{className:"text-amber-400 font-medium mb-1",children:"Demo Implementation"}),jsxRuntimeExports.jsx("p",{className:"text-amber-300/70",children:"This is an alpha test bridge. Your L1 ALPHA tokens will NOT be burned. You will receive equivalent ALPHT tokens on L3 for testing purposes."})]})]})}),jsxRuntimeExports.jsx("div",{className:"mb-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx(Info,{className:"w-5 h-5 text-blue-400 mt-0.5 shrink-0"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-blue-300/70",children:jsxRuntimeExports.jsx("p",{children:"Bridge clones your L1 ALPHA coins to L3 ALPHT tokens on Unicity Network. You need to provide your L3 Unicity ID as the destination."})})]})}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-neutral-500 dark:text-neutral-400 text-xs mb-1",children:"Source L1 Address"}),jsxRuntimeExports.jsx("div",{className:"bg-neutral-100 dark:bg-neutral-800/50 p-3 rounded-lg border border-neutral-200 dark:border-neutral-700/50",children:jsxRuntimeExports.jsx("span",{className:"text-neutral-700 dark:text-neutral-200 font-mono text-sm break-all",children:u})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-neutral-500 dark:text-neutral-400 text-xs mb-1",children:"Mintable Balance"}),jsxRuntimeExports.jsxs("div",{className:"bg-neutral-100 dark:bg-neutral-800/50 p-3 rounded-lg border border-neutral-200 dark:border-neutral-700/50",children:[S==="checking"&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-neutral-500 dark:text-neutral-400",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Checking eligibility..."})]}),S==="available"&&$&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("span",{className:"text-green-400 font-bold text-lg",children:[$.amount," ALPHA"]}),jsxRuntimeExports.jsxs("span",{className:"text-green-500 text-xs flex items-center gap-1",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-3 h-3"}),"Available"]})]}),S==="already_minted"&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-amber-400",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Already minted to L3"})]}),S==="not_eligible"&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[jsxRuntimeExports.jsx(X,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Not eligible for migration"})]}),S==="error"&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[jsxRuntimeExports.jsx(X,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Error checking balance"})]}),(S==="signing"||S==="minting"||S==="success")&&$&&jsxRuntimeExports.jsxs("span",{className:"text-green-400 font-bold text-lg",children:[$.amount," ALPHA"]})]})]}),S==="available"&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-neutral-500 dark:text-neutral-400 text-xs mb-1",children:"Destination L3 Unicity ID"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Enter your Unicity ID",value:w,onChange:U=>E(U.target.value),className:"w-full px-3 py-2 bg-neutral-100 dark:bg-neutral-800/50 rounded-lg text-neutral-800 dark:text-neutral-200 placeholder-neutral-400 dark:placeholder-neutral-500 border border-neutral-200 dark:border-neutral-700/50 focus:border-purple-500 focus:bg-neutral-50 dark:focus:bg-neutral-800 outline-none transition-all font-mono text-sm"})]}),T&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-red-400 text-sm",children:T})}),(S==="signing"||S==="minting")&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"mb-4 p-6 bg-purple-500/10 border border-purple-500/30 rounded-lg text-center",children:[jsxRuntimeExports.jsxs("div",{className:"relative w-16 h-16 mx-auto mb-4",children:[jsxRuntimeExports.jsx(motion.div,{className:"absolute inset-0 border-4 border-purple-500/30 rounded-full"}),jsxRuntimeExports.jsx(motion.div,{className:"absolute inset-0 border-4 border-transparent border-t-purple-500 rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})]}),jsxRuntimeExports.jsx("p",{className:"text-purple-500 dark:text-purple-400 font-medium mb-1",children:S==="signing"?"Signing transaction...":"Minting tokens..."}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-500 text-sm",children:"Please wait, this may take a moment"})]}),S==="success"&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"mb-4 p-4 bg-green-500/10 border border-green-500/30 rounded-lg text-center",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-12 h-12 text-green-500 mx-auto mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-green-500 dark:text-green-400 font-bold mb-2",children:"Bridge Successful!"}),jsxRuntimeExports.jsxs("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm",children:[$?.amount," ALPHT minted to your L3 address"]})]}),S!=="signing"&&S!=="minting"&&jsxRuntimeExports.jsx("div",{className:"flex gap-3",children:S==="success"?jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:v,className:"flex-1 py-3 bg-green-600 hover:bg-green-500 rounded-xl text-white font-medium transition-colors",children:"Done"}):S==="available"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:v,className:"flex-1 py-3 bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600 rounded-xl text-neutral-700 dark:text-white font-medium transition-colors",children:"Cancel"}),jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:F,className:"flex-1 py-3 bg-linear-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 rounded-xl text-white font-medium transition-colors flex items-center justify-center gap-2",children:["Bridge ",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4"})]})]}):jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:v,className:"flex-1 py-3 bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600 rounded-xl text-neutral-700 dark:text-white font-medium transition-colors",children:"Close"})})]})})}):null}function SendModal({show:y,selectedAddress:u,onClose:g,onSend:v}){const[b,w]=reactExports.useState(""),[E,S]=reactExports.useState(""),[A,$]=reactExports.useState(null),[R,T]=reactExports.useState("all"),[O,B]=reactExports.useState({vested:0n,unvested:0n,all:0n});reactExports.useEffect(()=>{y?B(vestingState.getAllBalances(u)):(w(""),S(""),$(null),T("all"))},[y,u]);const F=J=>{vestingState.setMode(J),T(J),S("")},U=()=>O[R],q=async()=>{if(!b.trim()||!E.trim()){$("Please fill in all fields");return}const J=parseFloat(E);if(isNaN(J)||J<=0){$("Please enter a valid amount");return}$(null);try{await v(b,E),g()}catch(ie){$(ie instanceof Error?ie.message:"Transaction creation failed")}};return y?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:g,className:"absolute inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm"}),jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"relative w-full max-w-md bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-6 border-b border-neutral-200 dark:border-white/5 flex justify-between items-center",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-white",children:"Send ALPHA"}),jsxRuntimeExports.jsx("button",{onClick:g,className:"p-2 hover:bg-neutral-100 dark:hover:bg-white/5 rounded-full transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-neutral-500 dark:text-neutral-400"})})]}),jsxRuntimeExports.jsx("div",{className:"p-6",children:jsxRuntimeExports.jsxs(motion.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},children:[jsxRuntimeExports.jsxs("div",{className:"mb-5",children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-neutral-500 dark:text-neutral-400 block mb-2",children:"Coin Type"}),jsxRuntimeExports.jsx("div",{className:"flex gap-3",children:[{value:"all",label:"All",balance:O.all},{value:"vested",label:"Vested",balance:O.vested},{value:"unvested",label:"Unvested",balance:O.unvested}].map(J=>{const ie=R===J.value,oe=J.value==="vested"?"border-green-500 bg-green-500/10 text-green-600 dark:text-green-400":J.value==="unvested"?"border-orange-500 bg-orange-500/10 text-orange-600 dark:text-orange-400":"border-blue-500 bg-blue-500/10 text-blue-600 dark:text-blue-400";return jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>F(J.value),className:`flex-1 py-3 px-4 rounded-xl border-2 transition-all ${ie?oe:"border-neutral-200 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400 hover:border-neutral-300 dark:hover:border-neutral-600"}`,children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-semibold",children:J.label}),jsxRuntimeExports.jsx("div",{className:"text-xs font-mono mt-1",children:(Number(J.balance)/1e8).toFixed(4)})]},J.value)})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-neutral-500 dark:text-neutral-400 block mb-2",children:"Destination Address"}),jsxRuntimeExports.jsx("input",{autoFocus:!0,value:b,onChange:J=>w(J.target.value),onKeyDown:J=>J.key==="Enter"&&q(),className:"w-full bg-neutral-100 dark:bg-neutral-900 border border-neutral-200 dark:border-white/10 rounded-xl py-3 px-4 text-neutral-900 dark:text-white focus:border-green-500 outline-none font-mono text-sm",placeholder:"Enter wallet address"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[jsxRuntimeExports.jsx("label",{className:"text-neutral-500 dark:text-neutral-400",children:"Amount"}),jsxRuntimeExports.jsxs("span",{className:"text-neutral-500 dark:text-neutral-400",children:["Available:"," ",jsxRuntimeExports.jsxs("span",{className:"text-neutral-900 dark:text-white",children:[(Number(U())/1e8).toFixed(8)," ALPHA"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"number",step:"any",value:E,onChange:J=>S(J.target.value),onKeyDown:J=>J.key==="Enter"&&q(),className:"w-full bg-neutral-100 dark:bg-neutral-900 border border-neutral-200 dark:border-white/10 rounded-xl py-3 px-4 pr-32 text-neutral-900 dark:text-white text-2xl font-mono focus:border-green-500 outline-none",placeholder:"0.00"}),jsxRuntimeExports.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{const J=Number(U())/1e8;S(String(Math.floor(J*.25*1e8)/1e8))},className:"px-2 py-1 text-xs bg-neutral-200 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 rounded hover:bg-neutral-300 dark:hover:bg-neutral-700",children:"25%"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{const J=Number(U())/1e8;S(String(Math.floor(J*.5*1e8)/1e8))},className:"px-2 py-1 text-xs bg-neutral-200 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 rounded hover:bg-neutral-300 dark:hover:bg-neutral-700",children:"50%"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{const J=Number(U())/1e8;S(String(J))},className:"px-2 py-1 text-xs bg-green-600 hover:bg-green-500 text-white rounded",children:"MAX"})]})]}),A&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-sm mt-2",children:A})]}),jsxRuntimeExports.jsxs("button",{onClick:q,disabled:!b||!E,className:"w-full py-3 bg-linear-to-br from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white font-medium rounded-xl flex items-center justify-center gap-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-xl shadow-green-500/20",children:["Send Transaction",jsxRuntimeExports.jsx(ArrowRight,{size:18})]})]})})]})]}):null}function L3WalletView({showBalances:y,setShowBalances:u,isHistoryOpen:g,setIsHistoryOpen:v,isRequestsOpen:b,setIsRequestsOpen:w,isSettingsOpen:E,setIsSettingsOpen:S,setIsL1WalletOpen:A}){const $=useNavigate(),{identity:R,assets:T,tokens:O,isLoadingAssets:B,isLoadingIdentity:F,nametag:U,getSeedPhrase:q}=useWallet(),{exportTxf:J,importTxf:ie,isExportingTxf:oe,isImportingTxf:le,isSyncing:de,isEnabled:fe}=useIpfsStorage(),{balance:ye,deleteWallet:we}=useL1Wallet(),[pe,ve]=reactExports.useState("assets"),[he,ae]=reactExports.useState(!1),[Q,j]=reactExports.useState(!1),[z,re]=reactExports.useState(!1),[Y,te]=reactExports.useState([]),[ne,se]=reactExports.useState(!1),[ee,Z]=reactExports.useState(!1),[ue,_e]=reactExports.useState(null),[Re,Ae]=reactExports.useState(!1),[ge,be]=reactExports.useState(null),[Te,De]=reactExports.useState(!1),Ie=reactExports.useRef(!1),Se=reactExports.useRef(null),[Be,Le]=reactExports.useState(!1),[qe,Ke]=reactExports.useState(!1),[Ge,Xe]=reactExports.useState(!1);reactExports.useEffect(()=>{de&&fe&&(Ie.current=!0,console.log(" L3WalletView: sync started, hasSyncStarted=true")),!de&&fe&&!Te&&Ie.current&&(console.log(" L3WalletView: sync completed, marking initialSyncComplete=true"),De(!0))},[de,fe,Te]);const ze=reactExports.useMemo(()=>{const Ee=BigInt(Math.round(ye*1e8));return new AggregatedAsset({coinId:"l1-alpha",symbol:"ALPHA",name:"Unicity Mainnet",totalAmount:Ee.toString(),decimals:8,tokenCount:1,iconUrl:null,priceUsd:1,priceEur:.92,change24h:0})},[ye]),et=reactExports.useMemo(()=>{const Ee=T.reduce((je,He)=>je+He.getTotalFiatValue("USD"),0),Pe=ze.getTotalFiatValue("USD");return Ee+Pe},[T,ze]);console.log(` L3WalletView render: isSyncing=${de}, isIpfsEnabled=${fe}, initialSyncComplete=${Te}, shouldShowSpinner=${de&&fe&&!Te}`);const nt=async()=>{if(!U){_e("Nametag is required to request tokens");return}se(!0),_e(null),Z(!1);try{const Pe=(await FaucetService.requestAllCoins(U)).filter(je=>!je.success);if(Pe.length>0){const je=Pe.map(He=>He.coin).join(", ");_e(`Failed to request: ${je}`)}else Z(!0),setTimeout(()=>Z(!1),3e3)}catch(Ee){_e(Ee instanceof Error?Ee.message:"Failed to request tokens")}finally{se(!1)}},ut=async()=>{const Ee=await q();Ee?(te(Ee),re(!0)):alert(`Recovery phrase not available.

This wallet was imported from a file that doesn't contain a mnemonic phrase. Only the master key was imported.`)},ot=reactExports.useCallback(async()=>{try{be(null),await J()}catch(Ee){console.error("Export failed:",Ee)}},[J]),vt=reactExports.useCallback(async Ee=>{const Pe=Ee.target.files?.[0];if(Pe){be(null),Ae(!1);try{const je=await Pe.text(),He=await ie(je);He.success?(Ae(!0),setTimeout(()=>Ae(!1),3e3)):be(He.error||"Import failed")}catch(je){be(je instanceof Error?je.message:"Import failed")}Se.current&&(Se.current.value="")}},[ie]),bt=reactExports.useMemo(()=>{try{return UnifiedKeyManager.getInstance("user-pin-1234").getMnemonic()!==null}catch{return!1}},[]),lt=()=>{Xe(!0)},kt=(Ee,Pe)=>{try{UnifiedKeyManager.getInstance("user-pin-1234").downloadJSON(Ee,{password:Pe}),Xe(!1)}catch(je){console.error("Failed to save wallet:",je)}},Ct=async()=>{try{await we(),$("/")}catch(Ee){console.error("Failed to logout:",Ee)}},Me=()=>{Ke(!1),Le(!0)},Ce=Ee=>Ee.toLocaleString("en-US",{minimumFractionDigits:4,maximumFractionDigits:4});return F?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"animate-spin text-neutral-400 dark:text-neutral-600"})}):!R||!U?jsxRuntimeExports.jsx(CreateWalletFlow,{}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col h-full relative",children:[jsxRuntimeExports.jsxs("div",{className:"px-6 mb-6 shrink-0",children:[jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center justify-center mb-6 pt-2",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("h2",{className:"text-4xl text-neutral-900 dark:text-white font-bold tracking-tight",children:y?`$${et.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:""}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>u(!y),className:"p-1.5 hover:bg-neutral-100 dark:hover:bg-neutral-800/80 rounded-lg transition-colors text-neutral-400 dark:text-neutral-500 hover:text-neutral-900 dark:hover:text-white",title:y?"Hide balances":"Show balances",children:y?jsxRuntimeExports.jsx(Eye,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(EyeOff,{className:"w-5 h-5"})}),de&&fe&&jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin text-blue-500"})]})}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:ne?1:1.02,y:ne?0:-2},whileTap:{scale:ne?1:.98},onClick:nt,disabled:ne||!U,className:"relative px-3 py-3 rounded-xl bg-linear-to-br from-orange-500 to-orange-600 text-white text-sm shadow-xl shadow-orange-500/20 flex items-center justify-center gap-2 overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed",children:ne?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Requesting..."})]}):ee?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Success!"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Top Up"})]})}),jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:()=>j(!0),className:"relative px-3 py-3 rounded-xl bg-neutral-100 dark:bg-neutral-800/80 hover:bg-neutral-200 dark:hover:bg-neutral-700/80 text-neutral-900 dark:text-white text-sm border border-neutral-200 dark:border-neutral-700/50 flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(ArrowDownUp,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Swap"})]}),jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:()=>ae(!0),className:"relative px-3 py-3 rounded-xl bg-neutral-100 dark:bg-neutral-800/80 hover:bg-neutral-200 dark:hover:bg-neutral-700/80 text-neutral-900 dark:text-white text-sm border border-neutral-200 dark:border-neutral-700/50 flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(ArrowUpRight,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Send"})]})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:ue&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mt-3 flex items-start gap-2 p-3 bg-red-500/10 border border-red-500/20 rounded-xl",children:[jsxRuntimeExports.jsx(CircleX,{className:"w-4 h-4 text-red-500 dark:text-red-400 shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:ue})]})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 mb-4 shrink-0",children:jsxRuntimeExports.jsxs("div",{className:"flex p-1 bg-neutral-100 dark:bg-neutral-900/50 rounded-xl border border-neutral-200 dark:border-neutral-800",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>ve("assets"),className:`flex-1 flex items-center justify-center gap-2 py-2 text-xs font-medium rounded-lg transition-all relative ${pe==="assets"?"text-neutral-900 dark:text-white":"text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-400"}`,children:[pe==="assets"&&jsxRuntimeExports.jsx(motion.div,{layoutId:"activeTab",className:"absolute inset-0 bg-white dark:bg-neutral-800 rounded-lg shadow-sm",transition:{type:"spring",bounce:.2,duration:.6}}),jsxRuntimeExports.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Layers,{className:"w-3 h-3"})," Assets"]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>ve("tokens"),className:`flex-1 flex items-center justify-center gap-2 py-2 text-xs font-medium rounded-lg transition-all relative ${pe==="tokens"?"text-neutral-900 dark:text-white":"text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-400"}`,children:[pe==="tokens"&&jsxRuntimeExports.jsx(motion.div,{layoutId:"activeTab",className:"absolute inset-0 bg-white dark:bg-neutral-800 rounded-lg shadow-sm",transition:{type:"spring",bounce:.2,duration:.6}}),jsxRuntimeExports.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Coins,{className:"w-3 h-3"})," Tokens"]})]})]})}),jsxRuntimeExports.jsxs("div",{className:"p-6 pt-0 flex-1 overflow-y-auto custom-scrollbar",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Sparkles,{className:"w-4 h-4 text-orange-500"}),jsxRuntimeExports.jsx("h4",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Network Assets"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("input",{ref:Se,type:"file",accept:".txf,.json",onChange:vt,className:"hidden"}),jsxRuntimeExports.jsxs("button",{onClick:()=>Se.current?.click(),disabled:!0,className:"flex items-center gap-1 text-xs text-orange-500 dark:text-orange-400 hover:text-orange-600 dark:hover:text-orange-300 disabled:opacity-50",title:"Import tokens from TXF file",children:[le?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}):jsxRuntimeExports.jsx(Download,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{children:"Import"})]}),jsxRuntimeExports.jsxs("button",{onClick:ot,disabled:!0,className:"flex items-center gap-1 text-xs text-orange-500 dark:text-orange-400 hover:text-orange-600 dark:hover:text-orange-300 disabled:opacity-50",title:"Export tokens as TXF file",children:[oe?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}):jsxRuntimeExports.jsx(Upload,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{children:"Export"})]})]})]}),jsxRuntimeExports.jsxs(AnimatePresence,{children:[Re&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-4 flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/20 rounded-xl",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4 text-green-500 dark:text-green-400 shrink-0"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Tokens imported successfully!"})]}),ge&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-4 flex items-start gap-2 p-3 bg-red-500/10 border border-red-500/20 rounded-xl",children:[jsxRuntimeExports.jsx(CircleX,{className:"w-4 h-4 text-red-500 dark:text-red-400 shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:ge})]})]}),jsxRuntimeExports.jsx("div",{className:"relative min-h-[200px]",children:B?jsxRuntimeExports.jsx("div",{className:"py-10 text-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 text-orange-500 animate-spin mx-auto"})}):jsxRuntimeExports.jsxs(AnimatePresence,{mode:"wait",children:[pe==="assets"&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},className:"space-y-2",children:T.length===0&&ye===0?jsxRuntimeExports.jsx(EmptyState,{}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AssetRow,{asset:ze,showBalances:y,delay:0,layer:"L1",onClick:()=>A(!0)},"l1-alpha"),T.map((Ee,Pe)=>jsxRuntimeExports.jsx(AssetRow,{asset:Ee,showBalances:y,delay:(Pe+1)*.05,layer:"L3"},Ee.coinId))]})},"assets"),pe==="tokens"&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"space-y-2",children:O.filter(Ee=>Ee.type!=="Nametag").length===0?jsxRuntimeExports.jsx(EmptyState,{text:"No individual tokens found."}):O.filter(Ee=>Ee.type!=="Nametag").sort((Ee,Pe)=>Pe.timestamp-Ee.timestamp).map((Ee,Pe)=>jsxRuntimeExports.jsx(TokenRow,{token:Ee,delay:Pe*.05},Ee.id))},"tokens")]})})]}),jsxRuntimeExports.jsx(SendModal$1,{isOpen:he,onClose:()=>ae(!1)}),jsxRuntimeExports.jsx(SwapModal,{isOpen:Q,onClose:()=>j(!1)}),jsxRuntimeExports.jsx(PaymentRequestsModal,{isOpen:b,onClose:()=>w(!1)}),jsxRuntimeExports.jsx(SeedPhraseModal,{isOpen:z,onClose:()=>re(!1),seedPhrase:Y}),jsxRuntimeExports.jsx(TransactionHistoryModal,{isOpen:g,onClose:()=>v(!1)}),jsxRuntimeExports.jsx(SettingsModal,{isOpen:E,onClose:()=>S(!1),onOpenL1Wallet:()=>A(!0),onBackupWallet:()=>Le(!0),onLogout:()=>Ke(!0),l1Balance:Ce(ye)}),jsxRuntimeExports.jsx(BackupWalletModal,{isOpen:Be,onClose:()=>Le(!1),onExportWalletFile:lt,onShowRecoveryPhrase:ut}),jsxRuntimeExports.jsx(LogoutConfirmModal,{isOpen:qe,onClose:()=>Ke(!1),onBackupAndLogout:Me,onLogoutWithoutBackup:Ct}),jsxRuntimeExports.jsx(SaveWalletModal,{show:Ge,onConfirm:kt,onCancel:()=>Xe(!1),hasMnemonic:bt})]})}function EmptyState({text:y}){return jsxRuntimeExports.jsxs("div",{className:"text-center py-10 flex flex-col items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-neutral-100 dark:bg-neutral-800 flex items-center justify-center",children:jsxRuntimeExports.jsx(Sparkles,{className:"w-6 h-6 text-neutral-400 dark:text-neutral-600"})}),jsxRuntimeExports.jsx("div",{className:"text-neutral-500 text-sm",children:y||jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Wallet is empty.",jsxRuntimeExports.jsx("br",{}),"Mint some tokens to start!"]})})]})}function useConnectionStatus(){const[y,u]=reactExports.useState(()=>({state:isWebSocketConnected()?"connected":"disconnected",message:isWebSocketConnected()?"Connected to Fulcrum":"Not connected"})),g=reactExports.useRef(!0),v=reactExports.useRef(!1),b=reactExports.useCallback(async()=>{if(!(!g.current||v.current)){v.current=!0,u({state:"connecting",message:"Connecting to Fulcrum server..."});try{if(await connect(),!g.current)return;u({state:"connected",message:"Connected to Fulcrum"})}catch(S){if(!g.current)return;const A=S instanceof Error?S.message:"Connection failed";u({state:"error",message:"Connection failed after multiple attempts",error:A})}finally{v.current=!1}}},[]),w=reactExports.useCallback(()=>{b()},[b]),E=reactExports.useCallback(()=>{disconnect(),u({state:"disconnected",message:"Connection cancelled"})},[]);return reactExports.useEffect(()=>(g.current=!0,isWebSocketConnected()||b(),()=>{g.current=!1}),[b]),reactExports.useEffect(()=>{const A=setInterval(()=>{if(!g.current)return;const $=isWebSocketConnected();$&&y.state!=="connected"?u({state:"connected",message:"Connected to Fulcrum"}):!$&&y.state==="connected"&&b()},2e3);return()=>clearInterval(A)},[y.state,b]),{...y,isConnected:y.state==="connected",isConnecting:y.state==="connecting",manualConnect:w,cancelConnect:E}}const iconMap={success:CircleCheckBig,error:CircleX,warning:TriangleAlert,info:Info},colorMap={success:{bg:"bg-emerald-500/10",text:"text-emerald-500",border:"border-emerald-900/50",button:"bg-emerald-600 hover:bg-emerald-500"},error:{bg:"bg-red-500/10",text:"text-red-500",border:"border-red-900/50",button:"bg-red-600 hover:bg-red-500"},warning:{bg:"bg-amber-500/10",text:"text-amber-500",border:"border-amber-900/50",button:"bg-amber-600 hover:bg-amber-500"},info:{bg:"bg-blue-500/10",text:"text-blue-500",border:"border-blue-900/50",button:"bg-blue-600 hover:bg-blue-500"}};function TxidItem({txid:y}){const[u,g]=reactExports.useState(!1),v=async()=>{await navigator.clipboard.writeText(y),g(!0),setTimeout(()=>g(!1),2e3)},b=`https://www.unicity.network/tx/${y}`;return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 p-2 bg-neutral-100 dark:bg-neutral-800/50 rounded-lg",children:[jsxRuntimeExports.jsxs("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:"flex-1 text-xs text-blue-500 dark:text-blue-400 hover:text-blue-400 dark:hover:text-blue-300 font-mono truncate",title:y,children:[y.slice(0,12),"...",y.slice(-12)]}),jsxRuntimeExports.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 text-neutral-500 dark:text-neutral-400 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",title:"Open in explorer",children:jsxRuntimeExports.jsx(ExternalLink,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("button",{onClick:v,className:"p-1.5 text-neutral-500 dark:text-neutral-400 hover:text-emerald-500 dark:hover:text-emerald-400 transition-colors",title:"Copy TXID",children:u?jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 text-emerald-500 dark:text-emerald-400"}):jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"})})]})}function MessageModal({show:y,type:u,title:g,message:v,txids:b,onClose:w}){if(!y)return null;const E=iconMap[u],S=colorMap[u];return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:w,children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",duration:.4},className:"relative w-full max-w-md bg-white dark:bg-[#111] border border-neutral-200 dark:border-white/10 rounded-3xl shadow-2xl p-6 overflow-hidden",onClick:A=>A.stopPropagation(),children:[jsxRuntimeExports.jsx("button",{onClick:w,className:"absolute top-4 right-4 text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1},className:"flex flex-col items-center text-center mb-6",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:`w-12 h-12 ${S.bg} rounded-full flex items-center justify-center mb-4`,children:jsxRuntimeExports.jsx(motion.div,{initial:{scale:.8},animate:{scale:1},transition:{delay:.3},children:jsxRuntimeExports.jsx(E,{className:`w-6 h-6 ${S.text}`})})}),jsxRuntimeExports.jsx("h3",{className:"text-neutral-900 dark:text-white text-xl font-bold mb-2",children:g}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm whitespace-pre-wrap",children:v})]}),b&&b.length>0&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.25},className:"mb-4 space-y-2",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-neutral-500 mb-2",children:["Transaction ID",b.length>1?"s":"",":"]}),b.map(A=>jsxRuntimeExports.jsx(TxidItem,{txid:A},A))]}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:w,className:`w-full py-3 ${S.button} rounded-xl text-white font-medium transition-colors`,children:"OK"})})]})})}function VestingDisplay({showBalances:y=!0,balances:u,isClassifying:g=!1}){const v=E=>(Number(E)/1e8).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:8}),b=u?.vested??0n,w=u?.unvested??0n;return jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 rounded-xl bg-green-500/10 border border-green-500/20 p-3",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400 font-medium block mb-1",children:["Vested",g&&jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin inline ml-1"})]}),y?jsxRuntimeExports.jsx("span",{className:"text-sm font-mono text-green-600 dark:text-green-400",children:v(b)}):jsxRuntimeExports.jsx("span",{className:"text-sm text-green-600 dark:text-green-400",children:""})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 rounded-xl bg-orange-500/10 border border-orange-500/20 p-3",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs text-orange-600 dark:text-orange-400 font-medium block mb-1",children:["Unvested",g&&jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin inline ml-1"})]}),y?jsxRuntimeExports.jsx("span",{className:"text-sm font-mono text-orange-600 dark:text-orange-400",children:v(w)}):jsxRuntimeExports.jsx("span",{className:"text-sm text-orange-600 dark:text-orange-400",children:""})]})]})}function formatTimestamp(y){return y?new Date(y*1e3).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function HistoryView({wallet:y,selectedAddress:u,transactions:g,loadingTransactions:v,currentBlockHeight:b,transactionDetails:w,analyzeTransaction:E,onBackToMain:S,hideBackButton:A}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col h-full relative",children:[jsxRuntimeExports.jsxs("div",{className:"px-6 mb-4",children:[!A&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.95},onClick:S,className:"p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-900 dark:text-white transition-colors",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl text-neutral-900 dark:text-white font-bold",children:"Transaction History"})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:[u.slice(0,10),"...",u.slice(-6)]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto px-6 custom-scrollbar",children:v?jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center h-32 gap-3",children:[jsxRuntimeExports.jsx(motion.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm",children:"Loading transactions..."})]}):g.length===0?jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center h-32",children:jsxRuntimeExports.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"No transactions found"})}):jsxRuntimeExports.jsx("div",{className:"space-y-3",children:g.map(($,R)=>{const T=$.height>0&&b>0?Math.max(0,b-$.height+1):0,O=T>0?"#10b981":"#fbbf24",B=T>0?`${T} confirmations`:"Unconfirmed",F=$.tx_hash.substring(0,6)+"..."+$.tx_hash.substring($.tx_hash.length-6),U=w[$.tx_hash],q=E($,U,y,u),J=q.direction==="sent",ie=J?"Sent":"Received",oe=J?"#ef4444":"#10b981";return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:R*.05,duration:.3},whileHover:{x:4},className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-4 transition-all cursor-pointer hover:border-neutral-300 dark:hover:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-800/50",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold",style:{color:oe},children:[J?"":""," ",ie]}),jsxRuntimeExports.jsx("a",{href:`https://www.unicity.network/tx/${$.tx_hash}`,target:"_blank",rel:"noopener noreferrer",className:"font-mono text-xs text-blue-500 dark:text-blue-400 hover:text-blue-400 dark:hover:text-blue-300",children:F})]}),jsxRuntimeExports.jsx("div",{className:"text-right",children:jsxRuntimeExports.jsxs("div",{className:"font-bold text-sm",style:{color:oe},children:[J?"-":"",q.amount.toFixed(8)," ALPHA"]})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs mb-2",children:[jsxRuntimeExports.jsx("span",{style:{color:O},children:B}),$.height>0&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"text-neutral-400 dark:text-neutral-600",children:""}),jsxRuntimeExports.jsxs("span",{className:"text-neutral-500 dark:text-neutral-400",children:["Block ",$.height]})]}),U?.blocktime&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"text-neutral-400 dark:text-neutral-600",children:""}),jsxRuntimeExports.jsx("span",{className:"text-neutral-500 dark:text-neutral-400",children:formatTimestamp(U.blocktime)})]})]}),U&&jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[q.fromAddresses.length>0&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:["From:"," ",jsxRuntimeExports.jsxs("a",{href:`https://www.unicity.network/address/${q.fromAddresses[0]}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 dark:text-blue-400 hover:text-blue-400 dark:hover:text-blue-300 font-mono",children:[q.fromAddresses[0].substring(0,11),"...",q.fromAddresses[0].substring(q.fromAddresses[0].length-6)]})]}),q.toAddresses.length>0&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:["To:"," ",jsxRuntimeExports.jsxs("a",{href:`https://www.unicity.network/address/${q.toAddresses[0]}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 dark:text-blue-400 hover:text-blue-400 dark:hover:text-blue-300 font-mono",children:[q.toAddresses[0].substring(0,11),"...",q.toAddresses[0].substring(q.toAddresses[0].length-6)]})]})]})]},$.tx_hash)})})})]})}function L1WalletModal({isOpen:y,onClose:u,showBalances:g}){const[v,b]=reactExports.useState(""),[w,E]=reactExports.useState("main"),[S,A]=reactExports.useState(null),$=useConnectionStatus(),[R,T]=reactExports.useState(!1),[O,B]=reactExports.useState(!1),[F,U]=reactExports.useState(!1),[q,J]=reactExports.useState(!1),[ie,oe]=reactExports.useState(!1),[le,de]=reactExports.useState(!1),[fe,ye]=reactExports.useState(!1),[we,pe]=reactExports.useState(""),[ve,he]=reactExports.useState(""),[ae,Q]=reactExports.useState({show:!1,type:"info",title:"",message:""}),{wallet:j,isLoadingWallet:z,balance:re,totalBalance:Y,transactions:te,transactionDetails:ne,isLoadingTransactions:se,currentBlockHeight:ee,analyzeTransaction:Z,invalidateWallet:ue,vestingBalances:_e,isClassifyingVesting:Re}=useL1Wallet(v),Ae=j?.addresses.map(ze=>ze.address)??[],{nametagState:ge,addressesWithNametags:be}=useAddressNametags(j?.addresses),Te=be.some(ze=>ze.ipnsLoading),De=reactExports.useCallback((ze,et,Ze,nt)=>{Q({show:!0,type:ze,title:et,message:Ze,txids:nt})},[]),Ie=reactExports.useCallback(()=>{Q(ze=>({...ze,show:!1}))},[]);reactExports.useEffect(()=>{if(j&&j.addresses.length>0){const ze=localStorage.getItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH),Ze=(ze?j.addresses.find(nt=>nt.path===ze)?.address:j.addresses[0]?.address)||j.addresses[0]?.address;Ze&&v!==Ze&&b(Ze)}},[v,j]),reactExports.useEffect(()=>{y&&E("main")},[y]);const Se=async()=>{if(!(!j||Te))try{const ze=generateAddress(j);loadWalletFromStorage("main")&&(ue(),b(ze.address))}catch{De("error","Error","Failed to generate address")}},Be=async(ze,et)=>{if(j)try{const Ze=Number(et);if(isNaN(Ze)||Ze<=0){De("error","Invalid Amount","Please enter a valid amount");return}const nt=await createTransactionPlan(j,ze,Ze,v);if(!nt.success){De("error","Transaction Failed","Transaction failed: "+nt.error);return}A(nt)}catch(Ze){De("error","Transaction Failed","Transaction failed: "+(Ze instanceof Error?Ze.message:String(Ze)))}},Le=async(ze,et)=>{pe(ze),he(et),await Be(ze,et),ye(!0)},qe=async()=>{if(!(!j||!S)){T(!0);try{const ze=[],et=[];for(const Ze of S.transactions)try{const nt=createAndSignTransaction(j,Ze),ut=await broadcast(nt.raw);ze.push({txid:nt.txid,raw:nt.raw,result:ut})}catch(nt){et.push(nt instanceof Error?nt.message:String(nt))}A(null),ye(!1),et.length>0?ze.length>0?De("warning","Partial Success",`Some transactions failed:
${et.join(`
`)}`,ze.map(Ze=>Ze.txid)):De("error","Transaction Failed",`Transaction failed:
${et.join(`
`)}`):De("success","Transaction Sent",`Sent ${ze.length} transaction(s)!`,ze.map(Ze=>Ze.txid))}finally{T(!1)}}},Ke=ze=>{const et=j?.addresses.find(Ze=>Ze.address===ze);et?.path?localStorage.setItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH,et.path):localStorage.removeItem(STORAGE_KEYS.L3_SELECTED_ADDRESS_PATH),WalletRepository.getInstance().resetInMemoryState(),window.location.reload()},Ge=ze=>ze.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:8}),Xe=j?.addresses.find(ze=>ze.address===v)?.privateKey??"";return y?jsxRuntimeExports.jsx(AnimatePresence,{children:y&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-50 flex items-center justify-center p-2",children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/60 backdrop-blur-sm rounded-2xl",onClick:u}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",duration:.5},className:"relative w-[94%] max-h-[92%] bg-white dark:bg-neutral-900 rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 dark:border-neutral-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[w==="history"&&jsxRuntimeExports.jsx("button",{onClick:()=>E("main"),className:"p-1.5 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:jsxRuntimeExports.jsx(ChevronLeft,{className:"w-5 h-5 text-neutral-600 dark:text-neutral-400"})}),jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-white font-bold text-sm",children:"L1"})}),jsxRuntimeExports.jsx("span",{className:"text-lg font-semibold text-neutral-900 dark:text-white",children:w==="history"?"Transaction History":"L1 Wallet"})]}),jsxRuntimeExports.jsx("button",{onClick:u,className:"p-2 rounded-xl hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-neutral-500"})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto",children:$.isConnected?z?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-64",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-blue-500"})}):j?w==="history"?jsxRuntimeExports.jsx(HistoryView,{wallet:j,selectedAddress:v,transactions:te,loadingTransactions:se,currentBlockHeight:ee,transactionDetails:ne,analyzeTransaction:Z,onBackToMain:()=>E("main"),hideBackButton:!0}):jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"text-center py-4",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400 mb-1",children:"Total Balance"}),jsxRuntimeExports.jsx("h2",{className:"text-3xl font-bold text-neutral-900 dark:text-white",children:g?`${Ge(Y)} ALPHA`:""})]}),jsxRuntimeExports.jsx(VestingDisplay,{showBalances:g,balances:_e,isClassifying:Re}),jsxRuntimeExports.jsxs("div",{className:"bg-neutral-100 dark:bg-neutral-800/50 rounded-xl p-3",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mb-2 flex items-center gap-1.5",children:[Te&&jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin"}),Te?"Checking nametags...":"Active Address"]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>B(ze=>!ze),className:"w-full flex items-center justify-between gap-2 p-2 bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-700/50 transition-colors",children:[(()=>{const ze=ge[v];return!ze||ze.ipnsLoading?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2 text-xs",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin text-neutral-400"}),jsxRuntimeExports.jsxs("span",{className:"font-mono text-neutral-700 dark:text-neutral-300 truncate",children:[v.slice(0,16),"...",v.slice(-8)]})]}):ze.nametag?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2 text-xs",children:[jsxRuntimeExports.jsxs("span",{className:"font-mono text-neutral-700 dark:text-neutral-300",children:[v.slice(0,12),"...",v.slice(-6)]}),jsxRuntimeExports.jsxs("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:["@",ze.nametag]})]}):jsxRuntimeExports.jsxs("span",{className:"text-xs font-mono text-neutral-700 dark:text-neutral-300 truncate",children:[v.slice(0,16),"...",v.slice(-8)]})})(),jsxRuntimeExports.jsx(ChevronDown,{className:`w-4 h-4 text-neutral-500 transition-transform shrink-0 ${O?"rotate-180":""}`})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:O&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-10",onClick:()=>B(!1)}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute z-20 mt-2 w-full bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 rounded-xl shadow-xl max-h-40 overflow-y-auto",children:Ae.map(ze=>{const et=ge[ze],Ze=ze===v,ut=j?.addresses.find(ot=>ot.address===ze)?.isChange;return jsxRuntimeExports.jsxs("button",{onClick:()=>{Ke(ze),B(!1)},className:`w-full flex items-center gap-2 px-3 py-2.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors ${Ze?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[jsxRuntimeExports.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${Ze?"bg-blue-500":"bg-transparent"}`}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:!et||et.ipnsLoading?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-3 h-3 animate-spin text-neutral-400"}),jsxRuntimeExports.jsxs("span",{className:"font-mono text-neutral-700 dark:text-neutral-300 truncate",children:[ze.slice(0,12),"...",ze.slice(-6)]})]}):et.nametag?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"font-mono text-neutral-700 dark:text-neutral-300",children:[ze.slice(0,12),"...",ze.slice(-6)]}),jsxRuntimeExports.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:["@",et.nametag]})]}):et.hasL3Inventory?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsxs("span",{className:"font-mono text-neutral-700 dark:text-neutral-300 truncate",children:[ze.slice(0,12),"...",ze.slice(-6)]}),jsxRuntimeExports.jsx("span",{className:"px-1 py-0.5 bg-purple-500/20 text-purple-600 dark:text-purple-400 text-[9px] font-bold rounded shrink-0",children:"L3"})]}):jsxRuntimeExports.jsxs("span",{className:"font-mono text-neutral-700 dark:text-neutral-300 truncate",children:[ze.slice(0,12),"...",ze.slice(-6)]})}),ut&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 bg-amber-500/20 text-amber-600 dark:text-amber-400 text-[9px] font-bold rounded shrink-0",children:"Change"})]},ze)})})]})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:g?`${Ge(re)} ALPHA`:""}),jsxRuntimeExports.jsx("div",{className:"flex-1"}),jsxRuntimeExports.jsx("button",{onClick:()=>{navigator.clipboard.writeText(v),U(!0),setTimeout(()=>U(!1),2e3)},className:`p-1.5 rounded-lg transition-colors ${F?"bg-green-500 text-white":"hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-500"}`,children:F?jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("button",{onClick:Se,disabled:Te,className:"p-1.5 rounded-lg hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:Te?"Wait for nametag check to complete":"Create new address",children:jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("a",{href:`https://www.unicity.network/address/${v}`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-lg hover:bg-neutral-200 dark:hover:bg-neutral-700 text-neutral-500 transition-colors",children:jsxRuntimeExports.jsx(ExternalLink,{className:"w-4 h-4"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>J(!0),className:"w-full flex items-center gap-3 p-3 bg-neutral-100 dark:bg-neutral-800/50 hover:bg-neutral-200 dark:hover:bg-neutral-800 rounded-xl transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center",children:jsxRuntimeExports.jsx(QrCode,{className:"w-5 h-5 text-blue-500"})}),jsxRuntimeExports.jsx("span",{className:"font-medium text-neutral-900 dark:text-white",children:"Receive (Show QR)"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>oe(!0),className:"w-full flex items-center gap-3 p-3 bg-neutral-100 dark:bg-neutral-800/50 hover:bg-neutral-200 dark:hover:bg-neutral-800 rounded-xl transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-500/10 flex items-center justify-center",children:jsxRuntimeExports.jsx(Send,{className:"w-5 h-5 text-green-500"})}),jsxRuntimeExports.jsx("span",{className:"font-medium text-neutral-900 dark:text-white",children:"Send ALPHA"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>E("history"),className:"w-full flex items-center gap-3 p-3 bg-neutral-100 dark:bg-neutral-800/50 hover:bg-neutral-200 dark:hover:bg-neutral-800 rounded-xl transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center",children:jsxRuntimeExports.jsx(History,{className:"w-5 h-5 text-purple-500"})}),jsxRuntimeExports.jsx("span",{className:"font-medium text-neutral-900 dark:text-white",children:"Transaction History"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>de(!0),className:"w-full flex items-center gap-3 p-3 bg-neutral-100 dark:bg-neutral-800/50 hover:bg-neutral-200 dark:hover:bg-neutral-800 rounded-xl transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500/10 to-blue-500/10 flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowRightLeft,{className:"w-5 h-5 text-purple-500"})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-neutral-900 dark:text-white",children:"Bridge to L3"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-neutral-500 bg-neutral-200 dark:bg-neutral-700 px-1.5 py-0.5 rounded",children:"(Demo)"})]})]})]})]}):jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-64 text-neutral-500",children:"No wallet found"}):jsxRuntimeExports.jsx(ConnectionStatus,{state:$.state,message:$.message,error:$.error,onRetry:$.manualConnect,onCancel:$.cancelConnect})}),jsxRuntimeExports.jsx(QRModal,{show:q,address:v,onClose:()=>J(!1)}),jsxRuntimeExports.jsx(SendModal,{show:ie,selectedAddress:v,onClose:()=>oe(!1),onSend:Le}),jsxRuntimeExports.jsx(TransactionConfirmationModal,{show:fe,txPlan:S,destination:we,amount:ve,isSending:R,onConfirm:qe,onCancel:()=>ye(!1)}),jsxRuntimeExports.jsx(BridgeModal,{show:le,address:v,privateKey:Xe,onClose:()=>de(!1)}),jsxRuntimeExports.jsx(MessageModal,{show:ae.show,type:ae.type,title:ae.title,message:ae.message,txids:ae.txids,onClose:Ie})]})]})}):null}function WalletPanel(){const[y,u]=reactExports.useState(!0),[g,v]=reactExports.useState(!1),[b,w]=reactExports.useState(!1),[E,S]=reactExports.useState(!1),[A,$]=reactExports.useState(!1),{identity:R,nametag:T,isLoadingIdentity:O}=useWallet(),{pendingCount:B,requests:F}=useIncomingPaymentRequests(),U=reactExports.useRef(null),q=reactExports.useRef(!1);return reactExports.useEffect(()=>{if(console.log(" WalletPanel useEffect:",{pendingCount:B,requestsLength:F.length,prevCount:U.current,isInitialized:q.current}),!q.current){(F.length>0||B===0)&&(U.current=B,q.current=!0,console.log(" WalletPanel initialized with pendingCount:",B));return}U.current!==null&&B>U.current&&(console.log(" New payment request detected, opening modal..."),w(!0)),U.current=B},[B,F.length]),O||!R||!T?null:jsxRuntimeExports.jsxs("div",{className:"bg-white/60 dark:bg-neutral-900/90 backdrop-blur-xl rounded-3xl border border-neutral-200 dark:border-neutral-800/50 overflow-hidden h-full relative lg:shadow-xl dark:lg:shadow-2xl flex flex-col transition-all duration-500 theme-transition",children:[jsxRuntimeExports.jsx("div",{className:"absolute -top-20 -right-20 w-80 h-80 rounded-full blur-3xl bg-orange-500/5 dark:bg-orange-500/10"}),jsxRuntimeExports.jsx("div",{className:"absolute -bottom-20 -left-20 w-80 h-80 rounded-full blur-3xl bg-purple-500/5 dark:bg-purple-500/10"}),jsxRuntimeExports.jsx("div",{className:"p-3 sm:p-4 lg:p-6 pb-2 relative shrink-0",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[jsxRuntimeExports.jsxs(motion.div,{whileHover:{scale:1.05},className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-lg sm:rounded-xl blur-lg opacity-50 bg-orange-500"}),jsxRuntimeExports.jsx("div",{className:"relative w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl bg-linear-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-xl",children:jsxRuntimeExports.jsx(Wallet$1,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:"text-sm sm:text-base text-neutral-900 dark:text-white font-medium tracking-wide",children:"Wallet"}),jsxRuntimeExports.jsx(AddressSelector,{currentNametag:T,compact:!0})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>v(!0),className:"p-1.5 sm:p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800/80 rounded-lg transition-colors text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white",title:"Transaction history",children:jsxRuntimeExports.jsx(Clock,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>w(!0),className:"relative p-1.5 sm:p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800/80 rounded-lg transition-colors text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white",title:"Payment requests",children:[jsxRuntimeExports.jsx(Bell,{className:"w-5 h-5"}),B>0&&jsxRuntimeExports.jsxs("span",{className:"absolute top-0.5 right-0.5 flex h-2.5 w-2.5",children:[jsxRuntimeExports.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),jsxRuntimeExports.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-red-500"})]})]}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>S(!0),className:"p-1.5 sm:p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800/80 rounded-lg transition-colors text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white",title:"Settings",children:jsxRuntimeExports.jsx(EllipsisVertical,{className:"w-5 h-5"})})]})]})}),jsxRuntimeExports.jsx("div",{className:"flex-1 relative overflow-hidden",children:jsxRuntimeExports.jsx(L3WalletView,{showBalances:y,setShowBalances:u,isHistoryOpen:g,setIsHistoryOpen:v,isRequestsOpen:b,setIsRequestsOpen:w,isSettingsOpen:E,setIsSettingsOpen:S,isL1WalletOpen:A,setIsL1WalletOpen:$})}),jsxRuntimeExports.jsx(L1WalletModal,{isOpen:A,onClose:()=>$(!1),showBalances:y})]})}const DEFAULT_VISIBLE_AGENTS=7;function AgentPage(){const{agentId:y}=useParams(),u=reactExports.useRef(null),[g,v]=reactExports.useState("chat"),[b,w]=reactExports.useState(!1),[E,S]=reactExports.useState([]),A=agents.length>DEFAULT_VISIBLE_AGENTS;reactExports.useEffect(()=>{y&&S(U=>{if(U[0]===y)return U;const q=U.filter(J=>J!==y);return[y,...q].slice(0,DEFAULT_VISIBLE_AGENTS)})},[y]);const $=(()=>{if(b)return agents;const U=E.map(ie=>agents.find(oe=>oe.id===ie)).filter(ie=>ie!==void 0),q=agents.filter(ie=>!E.includes(ie.id));return[...U,...q].slice(0,DEFAULT_VISIBLE_AGENTS)})(),R=y?getAgentConfig(y):void 0,T=reactExports.useRef(null),O=()=>{!u.current||window.innerWidth>=1024||(T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{if(!u.current)return;const U=u.current.scrollLeft,q=u.current.offsetWidth;v(U>q/2?"wallet":"chat")},50))},B=U=>{if(!u.current)return;const q=u.current.offsetWidth;u.current.scrollTo({left:U==="wallet"?q:0,behavior:"smooth"}),v(U)};if(reactExports.useEffect(()=>{window.innerWidth<1024&&u.current&&(u.current.scrollTo({left:0,behavior:"instant"}),v("chat"))},[y]),reactExports.useEffect(()=>{const U=()=>{window.innerWidth<1024&&(console.log(" Payment request received, switching to wallet panel..."),B("wallet"))};return window.addEventListener("payment-requests-updated",U),()=>{window.removeEventListener("payment-requests-updated",U)}},[]),!R)return jsxRuntimeExports.jsx(Navigate,{to:"/agents/chat",replace:!0});const F=()=>{switch(R.id){case"chat":return jsxRuntimeExports.jsx(ChatSection,{});case"ai":return jsxRuntimeExports.jsx(AIChat,{agent:R});case"trivia":return jsxRuntimeExports.jsx(TriviaChat,{agent:R});case"games":return jsxRuntimeExports.jsx(GamesChat,{agent:R});case"sport":return jsxRuntimeExports.jsx(SportChat,{agent:R});case"p2p":return jsxRuntimeExports.jsx(P2PChat,{agent:R});case"merch":return jsxRuntimeExports.jsx(MerchChat,{agent:R});default:return jsxRuntimeExports.jsx(ChatSection,{})}};return jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"hidden lg:block mb-8 relative px-8 pt-8 pb-5 rounded-2xl dark:bg-linear-to-br dark:from-neutral-900/40 dark:to-neutral-800/20 backdrop-blur-sm border border-neutral-200 dark:border-neutral-800/50",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 left-0 w-32 h-32 border-l-2 border-t-2 border-orange-500/50 rounded-tl-2xl"}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 right-0 w-32 h-32 border-r-2 border-b-2 border-orange-500/50 rounded-br-2xl"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-7 gap-4",children:[$.slice(0,DEFAULT_VISIBLE_AGENTS).map(U=>jsxRuntimeExports.jsx(AgentCard,{id:U.id,name:U.name,Icon:U.Icon,category:U.category,color:U.color,isSelected:y===U.id},U.id)),jsxRuntimeExports.jsx(AnimatePresence,{initial:!1,mode:"sync",children:b&&$.slice(DEFAULT_VISIBLE_AGENTS).map((U,q)=>jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9,transition:{duration:.1}},transition:{duration:.15,delay:q*.02},children:jsxRuntimeExports.jsx(AgentCard,{id:U.id,name:U.name,Icon:U.Icon,category:U.category,color:U.color,isSelected:y===U.id})},U.id))})]}),A&&jsxRuntimeExports.jsx("div",{className:"flex justify-center mt-2",children:jsxRuntimeExports.jsx("button",{onClick:()=>w(!b),className:"flex items-center gap-1.5 px-4 pt-2 text-sm font-medium text-neutral-600 dark:text-neutral-400 hover:text-orange-500 dark:hover:text-orange-400 transition-colors duration-200",children:b?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{children:"Hide all"}),jsxRuntimeExports.jsx(ChevronUp,{className:"w-4 h-4"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{children:"View all"}),jsxRuntimeExports.jsx(ChevronDown,{className:"w-4 h-4"})]})})})]})]}),jsxRuntimeExports.jsxs("div",{className:"lg:hidden shrink-0 relative flex p-1 mb-3 bg-neutral-100 dark:bg-neutral-800/50 rounded-2xl backdrop-blur-sm border border-neutral-200 dark:border-neutral-700/30 overflow-hidden",children:[jsxRuntimeExports.jsx(motion.div,{className:"absolute top-1 bottom-1 left-1 bg-linear-to-r from-orange-500 to-orange-600 rounded-xl shadow-lg shadow-orange-500/20",initial:!1,animate:{x:g==="chat"?"0%":"100%",width:"calc(50% - 0.25rem)"},transition:{type:"spring",stiffness:300,damping:30}}),jsxRuntimeExports.jsxs("button",{onClick:()=>B("chat"),className:`relative z-10 flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl font-medium transition-colors duration-200 ${g==="chat"?"text-white":"text-neutral-500 dark:text-neutral-400"}`,children:[jsxRuntimeExports.jsx(MessageSquare,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Agents"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>B("wallet"),className:`relative z-10 flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl font-medium transition-colors duration-200 ${g==="wallet"?"text-white":"text-neutral-500 dark:text-neutral-400"}`,children:[jsxRuntimeExports.jsx(Wallet$1,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Wallet"})]})]}),jsxRuntimeExports.jsxs("div",{ref:u,onScroll:O,className:"lg:hidden flex-1 min-h-0 flex overflow-x-auto snap-x snap-mandatory scrollbar-hide py-1",children:[jsxRuntimeExports.jsx("div",{className:"w-full shrink-0 snap-center h-full",children:F()}),jsxRuntimeExports.jsx("div",{className:"w-full shrink-0 snap-center h-full",children:jsxRuntimeExports.jsx(WalletPanel,{})})]}),jsxRuntimeExports.jsxs("div",{className:"hidden lg:grid lg:grid-cols-3 lg:gap-8 lg:flex-1 lg:min-h-[650px] lg:py-2",children:[jsxRuntimeExports.jsx("div",{className:"lg:col-span-2 h-full min-h-0",children:F()}),jsxRuntimeExports.jsx("div",{className:"h-full min-h-0",children:jsxRuntimeExports.jsx(WalletPanel,{})})]})]})}function App(){const y=useLocation(),u=y.pathname.startsWith("/agents/")?"/agents":y.pathname;return jsxRuntimeExports.jsx(AnimatePresence,{mode:"wait",children:jsxRuntimeExports.jsxs(Routes,{location:y,children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(IntroPage,{})}),jsxRuntimeExports.jsxs(Route,{element:jsxRuntimeExports.jsx(WalletGate,{children:jsxRuntimeExports.jsx(DashboardLayout,{})}),children:[jsxRuntimeExports.jsx(Route,{path:"/home",element:jsxRuntimeExports.jsx(Navigate,{to:"/agents/chat",replace:!0})}),jsxRuntimeExports.jsx(Route,{path:"/agents/:agentId",element:jsxRuntimeExports.jsx(AgentPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/ai",element:jsxRuntimeExports.jsx(Navigate,{to:"/agents/ai",replace:!0})})]})]},u)})}function parseRelayUrls(y,u){return u}const DEFAULT_GROUP_CHAT_RELAYS=["wss://sphere-relay.unicity.network"],GROUP_CHAT_CONFIG={RELAYS:parseRelayUrls(void 0,DEFAULT_GROUP_CHAT_RELAYS),DEFAULT_MESSAGE_LIMIT:50,MAX_PREVIOUS_TAGS:3,RECONNECT_DELAY_MS:3e3,MAX_RECONNECT_ATTEMPTS:5};function createNip29Filter(y){return new Filter(y)}const NIP29_KINDS={CHAT_MESSAGE:9,THREAD_ROOT:11,THREAD_REPLY:12,JOIN_REQUEST:9021,LEAVE_REQUEST:9022,PUT_USER:9e3,REMOVE_USER:9001,EDIT_METADATA:9002,DELETE_EVENT:9005,CREATE_GROUP:9007,DELETE_GROUP:9008,CREATE_INVITE:9009,GROUP_METADATA:39e3,GROUP_ADMINS:39001,GROUP_MEMBERS:39002,GROUP_ROLES:39003};class GroupChatService{static instance;client=null;identityManager;repository;relayUrls;isConnected=!1;isConnecting=!1;connectPromise=null;messageListeners=[];reconnectAttempts=0;constructor(u,g){this.identityManager=u,this.relayUrls=g||GROUP_CHAT_CONFIG.RELAYS,this.repository=GroupChatRepository.getInstance()}static getInstance(u,g){if(!GroupChatService.instance){const v=u||IdentityManager.getInstance();GroupChatService.instance=new GroupChatService(v,g)}return GroupChatService.instance}async start(){if(!this.isConnected){if(this.isConnecting&&this.connectPromise)return this.connectPromise;this.isConnecting=!0,this.connectPromise=this.doConnect();try{await this.connectPromise}finally{this.isConnecting=!1,this.connectPromise=null}}}async reset(){if(console.log(" Resetting GroupChatService connection..."),this.client){try{await this.client.disconnect()}catch(u){console.warn("Error disconnecting group chat client:",u)}this.client=null}this.isConnected=!1,this.isConnecting=!1,this.connectPromise=null,this.reconnectAttempts=0,console.log(" GroupChatService reset complete")}async doConnect(){const u=this.relayUrls[0];this.repository.checkAndClearOnRelayChange(u);const g=await this.identityManager.getCurrentIdentity();if(!g)throw new Error("No identity found for group chat");const v=Buffer$1.from(g.privateKey,"hex"),b=NostrKeyManager.fromPrivateKey(v);this.client=new NostrClient(b),console.log(` Connecting to group chat relays: ${this.relayUrls.join(", ")}`);try{await this.client.connect(...this.relayUrls),this.isConnected=!0,this.reconnectAttempts=0,console.log(" Connected to group chat relays"),await this.subscribeToJoinedGroups()}catch(w){console.error(" Failed to connect to group chat relays",w),this.scheduleReconnect()}}scheduleReconnect(){if(this.reconnectAttempts>=GROUP_CHAT_CONFIG.MAX_RECONNECT_ATTEMPTS){console.error("Max reconnection attempts reached");return}this.reconnectAttempts++,console.log(` Scheduling reconnect attempt ${this.reconnectAttempts}...`),setTimeout(()=>{this.start().catch(console.error)},GROUP_CHAT_CONFIG.RECONNECT_DELAY_MS)}getConnectionStatus(){return this.isConnected}async subscribeToJoinedGroups(){if(!this.client)return;const u=this.repository.getGroups();if(u.length===0){console.log("No joined groups to subscribe to");return}const g=u.map(w=>w.id);console.log(` Subscribing to ${g.length} groups`);const v=createNip29Filter({kinds:[NIP29_KINDS.CHAT_MESSAGE,NIP29_KINDS.THREAD_ROOT,NIP29_KINDS.THREAD_REPLY],"#h":g});this.client.subscribe(v,{onEvent:w=>this.handleGroupEvent(w),onEndOfStoredEvents:()=>{console.log("End of stored group messages")}});const b=createNip29Filter({kinds:[NIP29_KINDS.GROUP_METADATA,NIP29_KINDS.GROUP_MEMBERS,NIP29_KINDS.GROUP_ADMINS],"#d":g});this.client.subscribe(b,{onEvent:w=>this.handleMetadataEvent(w),onEndOfStoredEvents:()=>{console.log("End of stored group metadata")}})}subscribeToGroup(u){if(!this.client)return;console.log(` Subscribing to group: ${u}`);const g=createNip29Filter({kinds:[NIP29_KINDS.CHAT_MESSAGE,NIP29_KINDS.THREAD_ROOT,NIP29_KINDS.THREAD_REPLY],"#h":[u]});this.client.subscribe(g,{onEvent:v=>this.handleGroupEvent(v),onEndOfStoredEvents:()=>{console.log(`End of stored messages for group ${u}`)}})}handleGroupEvent(u){if(this.repository.isEventProcessed(u.id))return;const g=this.getGroupIdFromEvent(u);if(!g){console.warn("Group event missing h tag:",u);return}if(!this.repository.getGroup(g)){console.log(`Ignoring event for non-joined group: ${g}`);return}const{text:b,senderNametag:w}=this.unwrapMessageContent(u.content);console.log(` Group message in ${g} from ${w||u.pubkey.slice(0,8)}: ${b.slice(0,50)}...`);const E=new GroupMessage({id:u.id,groupId:g,content:b,timestamp:u.created_at*1e3,senderPubkey:u.pubkey,senderNametag:w||void 0,replyToId:this.extractReplyTo(u),previousIds:this.extractPreviousIds(u)});this.repository.saveMessage(E),this.repository.addProcessedEventId(u.id),this.notifyMessageListeners(E),window.dispatchEvent(new CustomEvent("group-message-received",{detail:E}))}handleMetadataEvent(u){const g=this.getGroupIdFromMetadataEvent(u);if(!g)return;const v=this.repository.getGroup(g);if(v)if(u.kind===NIP29_KINDS.GROUP_METADATA)try{const b=JSON.parse(u.content);v.name=b.name||v.name,v.description=b.about||v.description,v.picture=b.picture||v.picture,v.updatedAt=u.created_at*1e3,this.repository.saveGroup(v)}catch(b){console.error("Failed to parse group metadata",b)}else u.kind===NIP29_KINDS.GROUP_MEMBERS&&this.updateMembersFromEvent(g,u)}updateMembersFromEvent(u,g){const v=g.tags.filter(b=>b[0]==="p");for(const b of v){const w=b[1],E=b[3]||GroupRole.MEMBER,S=new GroupMember({pubkey:w,groupId:u,role:E,joinedAt:g.created_at*1e3});this.repository.saveMember(S)}}async fetchAvailableGroups(){return this.client||await this.start(),this.client?new Promise(u=>{const g=new Map,v=new Map;let b=!1,w=!1;const E=()=>{if(b&&w){for(const[R,T]of v){const O=g.get(R);O&&(O.memberCount=T)}const $=Array.from(g.values());console.log(`Found ${$.length} available groups`),u($)}},S=new Filter({kinds:[NIP29_KINDS.GROUP_METADATA]});this.client.subscribe(S,{onEvent:$=>{const R=this.parseGroupMetadata($);if(R&&R.visibility===GroupVisibility.PUBLIC){const T=g.get(R.id);(!T||R.createdAt>T.createdAt)&&g.set(R.id,R)}},onEndOfStoredEvents:()=>{b=!0,E()}});const A=new Filter({kinds:[NIP29_KINDS.GROUP_MEMBERS]});this.client.subscribe(A,{onEvent:$=>{const R=this.getGroupIdFromMetadataEvent($);if(R){const T=$.tags.filter(O=>O[0]==="p");v.set(R,T.length)}},onEndOfStoredEvents:()=>{w=!0,E()}}),setTimeout(()=>{b=!0,w=!0,E()},1e4)}):[]}async fetchGroupMetadata(u){return this.client||await this.start(),this.client?new Promise(g=>{const v=new Filter({kinds:[NIP29_KINDS.GROUP_METADATA],"#d":[u]});let b=!1;this.client.subscribe(v,{onEvent:w=>{b||(b=!0,g(this.parseGroupMetadata(w)))},onEndOfStoredEvents:()=>{b||g(null)}}),setTimeout(()=>{b||g(null)},5e3)}):null}async fetchGroupMembers(u){return this.client||await this.start(),this.client?new Promise(g=>{const v=[],b=new Filter({kinds:[NIP29_KINDS.GROUP_MEMBERS],"#d":[u]});this.client.subscribe(b,{onEvent:w=>{const E=w.tags.filter(S=>S[0]==="p");for(const S of E)v.push(new GroupMember({pubkey:S[1],groupId:u,role:S[3]||GroupRole.MEMBER,joinedAt:w.created_at*1e3}))},onEndOfStoredEvents:()=>{g(v)}}),setTimeout(()=>g(v),5e3)}):[]}async fetchAndSaveMembers(u){const g=await this.fetchGroupMembers(u);console.log(` Fetched ${g.length} members for group ${u}`);for(const v of g)this.repository.saveMember(v)}async joinGroup(u,g){if(this.client||await this.start(),!this.client)return!1;try{const v=await this.fetchGroupMetadata(u);if(!v)return console.error(`Group not found: ${u}`),!1;const b=[["h",u]];return g&&b.push(["code",g]),await this.client.createAndPublishEvent({kind:NIP29_KINDS.JOIN_REQUEST,tags:b,content:""})?(console.log(` Join request sent for group ${u}`),this.repository.saveGroup(v),this.subscribeToGroup(u),await Promise.all([this.fetchMessages(u),this.fetchAndSaveMembers(u)]),!0):!1}catch(v){if((v instanceof Error?v.message:String(v)).includes("already a member")){console.log(` Already a member of group ${u}, syncing local state...`);const w=await this.fetchGroupMetadata(u);if(w)return this.repository.saveGroup(w),this.subscribeToGroup(u),await Promise.all([this.fetchMessages(u),this.fetchAndSaveMembers(u)]),!0}return console.error("Failed to join group",v),!1}}async leaveGroup(u){if(this.client||await this.start(),!this.client)return!1;try{return await this.client.createAndPublishEvent({kind:NIP29_KINDS.LEAVE_REQUEST,tags:[["h",u]],content:""})?(console.log(` Left group ${u}`),this.repository.deleteGroup(u),!0):!1}catch(g){return console.error("Failed to leave group",g),!1}}async sendMessage(u,g,v){if(this.client||await this.start(),!this.client)return null;try{const b=await this.identityManager.getCurrentIdentity();if(!b)throw new Error("No identity for sending group message");const w=await this.getMyNametag(),E=v?NIP29_KINDS.THREAD_REPLY:NIP29_KINDS.CHAT_MESSAGE,S=[["h",u]],A=this.repository.getRecentMessageIds(u,GROUP_CHAT_CONFIG.MAX_PREVIOUS_TAGS);A.length>0&&S.push(["previous",...A]),v&&S.push(["e",v,"","reply"]);const $=this.wrapMessageContent(g,w),R=await this.client.createAndPublishEvent({kind:E,tags:S,content:$});if(R){const T=new GroupMessage({id:R,groupId:u,content:g,timestamp:Date.now(),senderPubkey:b.publicKey,senderNametag:w||void 0,replyToId:v,previousIds:A});return this.repository.saveMessage(T),this.repository.addProcessedEventId(R),console.log(` Group message sent to ${u}`),T}return null}catch(b){return console.error("Failed to send group message",b),null}}async fetchMessages(u,g,v){return this.client||await this.start(),this.client?new Promise(b=>{const w=[],E={kinds:[NIP29_KINDS.CHAT_MESSAGE,NIP29_KINDS.THREAD_ROOT,NIP29_KINDS.THREAD_REPLY],"#h":[u]};g&&(E.since=Math.floor(g/1e3)),v&&(E.limit=v);const S=createNip29Filter(E);console.log(" Message filter:",JSON.stringify(S.toJSON())),this.client.subscribe(S,{onEvent:A=>{const{text:$,senderNametag:R}=this.unwrapMessageContent(A.content),T=new GroupMessage({id:A.id,groupId:u,content:$,timestamp:A.created_at*1e3,senderPubkey:A.pubkey,senderNametag:R||void 0,replyToId:this.extractReplyTo(A),previousIds:this.extractPreviousIds(A)});w.push(T),this.repository.saveMessage(T),this.repository.addProcessedEventId(A.id)},onEndOfStoredEvents:()=>{console.log(`Fetched ${w.length} messages for group ${u}`),b(w)}}),setTimeout(()=>b(w),1e4)}):[]}async createGroup(u){if(this.client||await this.start(),!this.client)return null;try{const g=await this.client.createAndPublishEvent({kind:NIP29_KINDS.CREATE_GROUP,tags:[],content:JSON.stringify({name:u.name,about:u.description,picture:u.picture,private:u.visibility===GroupVisibility.PRIVATE})});if(g){const v=new Group({id:g.slice(0,12),relayUrl:this.relayUrls[0],name:u.name,description:u.description,picture:u.picture,visibility:u.visibility||GroupVisibility.PUBLIC,createdAt:Date.now()});return console.log(" Group create request sent"),v}return null}catch(g){return console.error("Failed to create group",g),null}}wrapMessageContent(u,g){return g?JSON.stringify({senderNametag:g,text:u}):u}unwrapMessageContent(u){try{const g=JSON.parse(u);if(typeof g=="object"&&g.text!==void 0)return{text:g.text,senderNametag:g.senderNametag||null}}catch{}return{text:u,senderNametag:null}}getGroupIdFromEvent(u){const g=u.tags.find(v=>v[0]==="h");return g?g[1]:null}getGroupIdFromMetadataEvent(u){const g=u.tags.find(v=>v[0]==="d");return g?g[1]:null}extractReplyTo(u){const g=u.tags.find(v=>v[0]==="e"&&v[3]==="reply");return g?g[1]:void 0}extractPreviousIds(u){const g=u.tags.find(v=>v[0]==="previous");return g?g.slice(1):void 0}parseGroupMetadata(u){try{const g=this.getGroupIdFromMetadataEvent(u);if(!g)return null;let v="Unnamed Group",b,w,E=!1;if(u.content&&u.content.trim())try{const S=JSON.parse(u.content);v=S.name||v,b=S.about||S.description,w=S.picture,E=S.private===!0}catch{}for(const S of u.tags)S[0]==="name"&&S[1]&&(v=S[1]),S[0]==="about"&&S[1]&&(b=S[1]),S[0]==="picture"&&S[1]&&(w=S[1]),S[0]==="private"&&(E=!0),S[0]==="public"&&S[1]==="false"&&(E=!0);return new Group({id:g,relayUrl:this.relayUrls[0],name:v,description:b,picture:w,visibility:E?GroupVisibility.PRIVATE:GroupVisibility.PUBLIC,createdAt:u.created_at*1e3})}catch(g){return console.error("Failed to parse group metadata",g),null}}addMessageListener(u){this.messageListeners.push(u)}removeMessageListener(u){this.messageListeners=this.messageListeners.filter(g=>g!==u)}notifyMessageListeners(u){this.messageListeners.forEach(g=>g(u))}getMyPublicKey(){return this.client?.getKeyManager()?.getPublicKeyHex()||null}async getMyNametag(){return NametagService.getInstance(this.identityManager).getActiveNametag()}getRelayUrls(){return this.relayUrls}}const ServicesProvider=({children:y})=>{const[u,g]=reactExports.useState(!1),[v,b]=reactExports.useState(!1),w=IdentityManager.getInstance(),E=NostrService.getInstance(w),S=GroupChatService.getInstance(w);return reactExports.useEffect(()=>{let A=!0;const $=async()=>{try{const T=await w.getCurrentIdentity();if(!T){console.log(" No identity found. Services on standby.");return}const O=NostrKeyManager.fromPrivateKey(Buffer.from(T.privateKey,"hex"));console.log(" Nostr pubkey:",O.getPublicKeyHex()),await E.start(),A&&g(!0)}catch(T){console.error(" Failed to start services:",T)}};$();const R=async()=>{await E.reset(),await S.reset(),g(!1),b(!1),$()};return window.addEventListener("wallet-loaded",R),()=>{A=!1,window.removeEventListener("wallet-loaded",R),console.log(" ServicesProvider cleanup")}},[w,E,S]),jsxRuntimeExports.jsx(ServicesContext.Provider,{value:{identityManager:w,nostrService:E,isNostrConnected:u,groupChatService:S,isGroupChatConnected:v},children:y})};var define_process_env_default={},win;if(typeof window>"u"){var loc={hostname:""};win={crypto:{randomUUID:function(){throw Error("unsupported")}},navigator:{userAgent:"",onLine:!0},document:{createElement:function(){return{}},location:loc,referrer:""},screen:{width:0,height:0},location:loc,addEventListener:function(){},removeEventListener:function(){}}}else win=window;function _array_like_to_array(y,u){(u==null||u>y.length)&&(u=y.length);for(var g=0,v=new Array(u);g<u;g++)v[g]=y[g];return v}function asyncGeneratorStep(y,u,g,v,b,w,E){try{var S=y[w](E),A=S.value}catch($){g($);return}S.done?u(A):Promise.resolve(A).then(v,b)}function _async_to_generator(y){return function(){var u=this,g=arguments;return new Promise(function(v,b){var w=y.apply(u,g);function E(A){asyncGeneratorStep(w,v,b,E,S,"next",A)}function S(A){asyncGeneratorStep(w,v,b,E,S,"throw",A)}E(void 0)})}}function _construct(y,u,g){return _is_native_reflect_construct()?_construct=Reflect.construct:_construct=function(b,w,E){var S=[null];S.push.apply(S,w);var A=Function.bind.apply(b,S),$=new A;return E&&_set_prototype_of($,E.prototype),$},_construct.apply(null,arguments)}function _defineProperties(y,u){for(var g=0;g<u.length;g++){var v=u[g];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(y,v.key,v)}}function _create_class(y,u,g){return u&&_defineProperties(y.prototype,u),y}function _extends(){return _extends=Object.assign||function(y){for(var u=1;u<arguments.length;u++){var g=arguments[u];for(var v in g)Object.prototype.hasOwnProperty.call(g,v)&&(y[v]=g[v])}return y},_extends.apply(this,arguments)}function _get_prototype_of(y){return _get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function(g){return g.__proto__||Object.getPrototypeOf(g)},_get_prototype_of(y)}function _inherits(y,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");y.prototype=Object.create(u&&u.prototype,{constructor:{value:y,writable:!0,configurable:!0}}),u&&_set_prototype_of(y,u)}function _instanceof(y,u){return u!=null&&typeof Symbol<"u"&&u[Symbol.hasInstance]?!!u[Symbol.hasInstance](y):y instanceof u}function _is_native_function(y){return Function.toString.call(y).indexOf("[native code]")!==-1}function _object_without_properties_loose(y,u){if(y==null)return{};var g={},v=Object.keys(y),b,w;for(w=0;w<v.length;w++)b=v[w],!(u.indexOf(b)>=0)&&(g[b]=y[b]);return g}function _set_prototype_of(y,u){return _set_prototype_of=Object.setPrototypeOf||function(v,b){return v.__proto__=b,v},_set_prototype_of(y,u)}function _type_of(y){"@swc/helpers - typeof";return y&&typeof Symbol<"u"&&y.constructor===Symbol?"symbol":typeof y}function _unsupported_iterable_to_array(y,u){if(y){if(typeof y=="string")return _array_like_to_array(y,u);var g=Object.prototype.toString.call(y).slice(8,-1);if(g==="Object"&&y.constructor&&(g=y.constructor.name),g==="Map"||g==="Set")return Array.from(g);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _array_like_to_array(y,u)}}function _wrap_native_super(y){var u=typeof Map=="function"?new Map:void 0;return _wrap_native_super=function(v){if(v===null||!_is_native_function(v))return v;if(typeof v!="function")throw new TypeError("Super expression must either be null or a function");if(typeof u<"u"){if(u.has(v))return u.get(v);u.set(v,b)}function b(){return _construct(v,arguments,_get_prototype_of(this).constructor)}return b.prototype=Object.create(v.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),_set_prototype_of(b,v)},_wrap_native_super(y)}function _is_native_reflect_construct(){try{var y=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_is_native_reflect_construct=function(){return!!y})()}function _create_for_of_iterator_helper_loose(y,u){var g=typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(g)return(g=g.call(y)).next.bind(g);if(Array.isArray(y)||(g=_unsupported_iterable_to_array(y))||u){g&&(y=g);var v=0;return function(){return v>=y.length?{done:!0}:{done:!1,value:y[v++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _ts_generator(y,u){var g,v,b,w,E={label:0,sent:function(){if(b[0]&1)throw b[1];return b[1]},trys:[],ops:[]};return w={next:S(0),throw:S(1),return:S(2)},typeof Symbol=="function"&&(w[Symbol.iterator]=function(){return this}),w;function S($){return function(R){return A([$,R])}}function A($){if(g)throw new TypeError("Generator is already executing.");for(;E;)try{if(g=1,v&&(b=$[0]&2?v.return:$[0]?v.throw||((b=v.return)&&b.call(v),0):v.next)&&!(b=b.call(v,$[1])).done)return b;switch(v=0,b&&($=[$[0]&2,b.value]),$[0]){case 0:case 1:b=$;break;case 4:return E.label++,{value:$[1],done:!1};case 5:E.label++,v=$[1],$=[0];continue;case 7:$=E.ops.pop(),E.trys.pop();continue;default:if(b=E.trys,!(b=b.length>0&&b[b.length-1])&&($[0]===6||$[0]===2)){E=0;continue}if($[0]===3&&(!b||$[1]>b[0]&&$[1]<b[3])){E.label=$[1];break}if($[0]===6&&E.label<b[1]){E.label=b[1],b=$;break}if(b&&E.label<b[2]){E.label=b[2],E.ops.push($);break}b[2]&&E.ops.pop(),E.trys.pop();continue}$=u.call(y,E)}catch(R){$=[6,R],v=0}finally{g=b=0}if($[0]&5)throw $[1];return{value:$[0]?$[1]:void 0,done:!0}}}function _ts_values(y){var u=typeof Symbol=="function"&&Symbol.iterator,g=u&&y[u],v=0;if(g)return g.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&v>=y.length&&(y=void 0),{value:y&&y[v++],done:!y}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")}var __defProp$1=Object.defineProperty,__defNormalProp$1=function(y,u,g){return u in y?__defProp$1(y,u,{enumerable:!0,configurable:!0,writable:!0,value:g}):y[u]=g},__publicField$1=function(y,u,g){return __defNormalProp$1(y,(typeof u>"u"?"undefined":_type_of(u))!=="symbol"?u+"":u,g)},_a,__defProp$1$1=Object.defineProperty,__defNormalProp$1$1=function(y,u,g){return u in y?__defProp$1$1(y,u,{enumerable:!0,configurable:!0,writable:!0,value:g}):y[u]=g},__publicField$1$1=function(y,u,g){return __defNormalProp$1$1(y,(typeof u>"u"?"undefined":_type_of(u))!=="symbol"?u+"":u,g)},NodeType$3=(function(y){return y[y.Document=0]="Document",y[y.DocumentType=1]="DocumentType",y[y.Element=2]="Element",y[y.Text=3]="Text",y[y.CDATA=4]="CDATA",y[y.Comment=5]="Comment",y})(NodeType$3||{}),testableAccessors$1={Node:["childNodes","parentNode","parentElement","textContent"],ShadowRoot:["host","styleSheets"],Element:["shadowRoot","querySelector","querySelectorAll"],MutationObserver:[]},testableMethods$1={Node:["contains","getRootNode"],ShadowRoot:["getSelection"],Element:[],MutationObserver:["constructor"]},untaintedBasePrototype$1={},isAngularZonePresent$1=function(){return!!globalThis.Zone};function getUntaintedPrototype$1(y){if(untaintedBasePrototype$1[y])return untaintedBasePrototype$1[y];var u=globalThis[y],g=u.prototype,v=y in testableAccessors$1?testableAccessors$1[y]:void 0,b=!!(v&&v.every(function(R){var T,O;return!!((O=(T=Object.getOwnPropertyDescriptor(g,R))==null?void 0:T.get)!=null&&O.toString().includes("[native code]"))})),w=y in testableMethods$1?testableMethods$1[y]:void 0,E=!!(w&&w.every(function(R){var T;return typeof g[R]=="function"&&((T=g[R])==null?void 0:T.toString().includes("[native code]"))}));if(b&&E&&!isAngularZonePresent$1())return untaintedBasePrototype$1[y]=u.prototype,u.prototype;try{var S=document.createElement("iframe");document.body.appendChild(S);var A=S.contentWindow;if(!A)return u.prototype;var $=A[y].prototype;return document.body.removeChild(S),$?untaintedBasePrototype$1[y]=$:g}catch{return g}}var untaintedAccessorCache$1={};function getUntaintedAccessor$1(y,u,g){var v,b=y+"."+String(g);if(untaintedAccessorCache$1[b])return untaintedAccessorCache$1[b].call(u);var w=getUntaintedPrototype$1(y),E=(v=Object.getOwnPropertyDescriptor(w,g))==null?void 0:v.get;return E?(untaintedAccessorCache$1[b]=E,E.call(u)):u[g]}var untaintedMethodCache$1={};function getUntaintedMethod$1(y,u,g){var v=y+"."+String(g);if(untaintedMethodCache$1[v])return untaintedMethodCache$1[v].bind(u);var b=getUntaintedPrototype$1(y),w=b[g];return typeof w!="function"?u[g]:(untaintedMethodCache$1[v]=w,w.bind(u))}function childNodes$1(y){return getUntaintedAccessor$1("Node",y,"childNodes")}function parentNode$1(y){return getUntaintedAccessor$1("Node",y,"parentNode")}function parentElement$1(y){return getUntaintedAccessor$1("Node",y,"parentElement")}function textContent$1(y){return getUntaintedAccessor$1("Node",y,"textContent")}function contains$1(y,u){return getUntaintedMethod$1("Node",y,"contains")(u)}function getRootNode$1(y){return getUntaintedMethod$1("Node",y,"getRootNode")()}function host$1(y){return!y||!("host"in y)?null:getUntaintedAccessor$1("ShadowRoot",y,"host")}function styleSheets$1(y){return y.styleSheets}function shadowRoot$1(y){return!y||!("shadowRoot"in y)?null:getUntaintedAccessor$1("Element",y,"shadowRoot")}function querySelector$1(y,u){return getUntaintedAccessor$1("Element",y,"querySelector")(u)}function querySelectorAll$1(y,u){return getUntaintedAccessor$1("Element",y,"querySelectorAll")(u)}function mutationObserverCtor$1(){return getUntaintedPrototype$1("MutationObserver").constructor}function patch$1(y,u,g){try{if(!(u in y))return function(){};var v=y[u],b=g(v);return typeof b=="function"&&(b.prototype=b.prototype||{},Object.defineProperties(b,{__rrweb_original__:{enumerable:!1,value:v}})),y[u]=b,function(){y[u]=v}}catch{return function(){}}}var index$1={childNodes:childNodes$1,parentNode:parentNode$1,parentElement:parentElement$1,textContent:textContent$1,contains:contains$1,getRootNode:getRootNode$1,host:host$1,styleSheets:styleSheets$1,shadowRoot:shadowRoot$1,querySelector:querySelector$1,querySelectorAll:querySelectorAll$1,mutationObserver:mutationObserverCtor$1,patch:patch$1};function isElement(y){return y.nodeType===y.ELEMENT_NODE}function isShadowRoot(y){var u=y&&"host"in y&&"mode"in y&&index$1.host(y)||null;return!!(u&&"shadowRoot"in u&&index$1.shadowRoot(u)===y)}function isNativeShadowDom(y){return Object.prototype.toString.call(y)==="[object ShadowRoot]"}function fixBrowserCompatibilityIssuesInCSS(y){return y.includes(" background-clip: text;")&&!y.includes(" -webkit-background-clip: text;")&&(y=y.replace(/\sbackground-clip:\s*text;/g," -webkit-background-clip: text; background-clip: text;")),y}function escapeImportStatement(y){var u=y.cssText;if(u.split('"').length<3)return u;var g=["@import","url("+JSON.stringify(y.href)+")"];return y.layerName===""?g.push("layer"):y.layerName&&g.push("layer("+y.layerName+")"),y.supportsText&&g.push("supports("+y.supportsText+")"),y.media.length&&g.push(y.media.mediaText),g.join(" ")+";"}function stringifyStylesheet(y){try{var u=y.rules||y.cssRules;if(!u)return null;var g=y.href;!g&&y.ownerNode&&y.ownerNode.ownerDocument&&(g=y.ownerNode.ownerDocument.location.href);var v=Array.from(u,function(b){return stringifyRule(b,g)}).join("");return fixBrowserCompatibilityIssuesInCSS(v)}catch{return null}}function stringifyRule(y,u){if(isCSSImportRule(y)){var g;try{g=stringifyStylesheet(y.styleSheet)||escapeImportStatement(y)}catch{g=y.cssText}return y.styleSheet.href?absolutifyURLs(g,y.styleSheet.href):g}else{var v=y.cssText;return isCSSStyleRule(y)&&y.selectorText.includes(":")&&(v=fixSafariColons(v)),u?absolutifyURLs(v,u):v}}function fixSafariColons(y){var u=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return y.replace(u,"$1\\$2")}function isCSSImportRule(y){return"styleSheet"in y}function isCSSStyleRule(y){return"selectorText"in y}var Mirror=(function(){function y(){__publicField$1$1(this,"idNodeMap",new Map),__publicField$1$1(this,"nodeMetaMap",new WeakMap)}var u=y.prototype;return u.getId=function(v){var b;if(!v)return-1;var w=(b=this.getMeta(v))==null?void 0:b.id;return w??-1},u.getNode=function(v){return this.idNodeMap.get(v)||null},u.getIds=function(){return Array.from(this.idNodeMap.keys())},u.getMeta=function(v){return this.nodeMetaMap.get(v)||null},u.removeNodeFromMap=function(v){var b=this,w=this.getId(v);this.idNodeMap.delete(w),v.childNodes&&v.childNodes.forEach(function(E){return b.removeNodeFromMap(E)})},u.has=function(v){return this.idNodeMap.has(v)},u.hasNode=function(v){return this.nodeMetaMap.has(v)},u.add=function(v,b){var w=b.id;this.idNodeMap.set(w,v),this.nodeMetaMap.set(v,b)},u.replace=function(v,b){var w=this.getNode(v);if(w){var E=this.nodeMetaMap.get(w);E&&this.nodeMetaMap.set(b,E)}this.idNodeMap.set(v,b)},u.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},y})();function createMirror$2(){return new Mirror}function maskInputValue(y){var u=y.element,g=y.maskInputOptions,v=y.tagName,b=y.type,w=y.value,E=y.maskInputFn,S=w||"",A=b&&toLowerCase(b);return(g[v.toLowerCase()]||A&&g[A])&&(E?S=E(S,u):S="*".repeat(S.length)),S}function toLowerCase(y){return y.toLowerCase()}var ORIGINAL_ATTRIBUTE_NAME="__rrweb_original__";function is2DCanvasBlank(y){var u=y.getContext("2d");if(!u)return!0;for(var g=50,v=0;v<y.width;v+=g)for(var b=0;b<y.height;b+=g){var w=u.getImageData,E=ORIGINAL_ATTRIBUTE_NAME in w?w[ORIGINAL_ATTRIBUTE_NAME]:w,S=new Uint32Array(E.call(u,v,b,Math.min(g,y.width-v),Math.min(g,y.height-b)).data.buffer);if(S.some(function(A){return A!==0}))return!1}return!0}function getInputType(y){var u=y.type;return y.hasAttribute("data-rr-is-password")?"password":u?toLowerCase(u):null}function extractFileExtension(y,u){var g;try{g=new URL(y,u??window.location.href)}catch{return null}var v=/\.([0-9a-z]+)(?:$)/i,b=g.pathname.match(v),w;return(w=b?.[1])!=null?w:null}function extractOrigin(y){var u="";return y.indexOf("//")>-1?u=y.split("/").slice(0,3).join("/"):u=y.split("/")[0],u=u.split("?")[0],u}var URL_IN_CSS_REF=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,URL_PROTOCOL_MATCH=/^(?:[a-z+]+:)?\/\//i,URL_WWW_MATCH=/^www\..*/i,DATA_URI=/^(data:)([^,]*),(.*)/i;function absolutifyURLs(y,u){return(y||"").replace(URL_IN_CSS_REF,function(g,v,b,w,E,S){var A=b||E||S,$=v||w||"";if(!A)return g;if(URL_PROTOCOL_MATCH.test(A)||URL_WWW_MATCH.test(A)||DATA_URI.test(A))return"url("+$+A+$+")";if(A[0]==="/")return"url("+$+(extractOrigin(u)+A)+$+")";var R=u.split("/"),T=A.split("/");R.pop();for(var O=_create_for_of_iterator_helper_loose(T),B;!(B=O()).done;){var F=B.value;F!=="."&&(F===".."?R.pop():R.push(F))}return"url("+$+R.join("/")+$+")"})}function normalizeCssString(y,u){return u===void 0&&(u=!1),u?y.replace(/(\/\*[^*]*\*\/)|[\s;]/g,""):y.replace(/(\/\*[^*]*\*\/)|[\s;]/g,"").replace(/0px/g,"0")}function splitCssText(y,u,g){g===void 0&&(g=!1);var v=Array.from(u.childNodes),b=[],w=0;if(v.length>1&&y&&typeof y=="string"){for(var E=normalizeCssString(y,g),S=E.length/y.length,A=1;A<v.length;A++)if(v[A].textContent&&typeof v[A].textContent=="string"){for(var $=normalizeCssString(v[A].textContent,g),R=100,T=3;T<$.length&&($[T].match(/[a-zA-Z0-9]/)||$.indexOf($.substring(0,T),1)!==-1);T++);for(;T<$.length;T++){var O=$.substring(0,T),B=E.split(O),F=-1;if(B.length===2)F=B[0].length;else if(B.length>2&&B[0]===""&&v[A-1].textContent!=="")F=E.indexOf(O,1);else if(B.length===1){if(O=O.substring(0,O.length-1),B=E.split(O),B.length<=1)return b.push(y),b;T=R+1}else T===$.length-1&&(F=E.indexOf(O));if(B.length>=2&&T>R){var U=v[A-1].textContent;if(U&&typeof U=="string"){var q=normalizeCssString(U).length;F=E.indexOf(O,q)}F===-1&&(F=B[0].length)}if(F!==-1){for(var J=Math.floor(F/S);J>0&&J<y.length;){if(w+=1,w>50*v.length)return b.push(y),b;var ie=normalizeCssString(y.substring(0,J),g);if(ie.length===F){b.push(y.substring(0,J)),y=y.substring(J),E=E.substring(F);break}else ie.length<F?J+=Math.max(1,Math.floor((F-ie.length)/S)):J-=Math.max(1,Math.floor((ie.length-F)*S))}break}}}}return b.push(y),b}function markCssSplits(y,u){return splitCssText(y,u).join("/* rr_split */")}var _id=1,tagNameRegex=new RegExp("[^a-z0-9-_:]"),IGNORED_NODE=-2;function genId(){return _id++}function getValidTagName$1(y){if(_instanceof(y,HTMLFormElement))return"form";var u=toLowerCase(y.tagName);return tagNameRegex.test(u)?"div":u}var canvasService,canvasCtx,SRCSET_NOT_SPACES=/^[^ \t\n\r\u000c]+/,SRCSET_COMMAS_OR_SPACES=/^[, \t\n\r\u000c]+/;function getAbsoluteSrcsetString(y,u){if(u.trim()==="")return u;var g=0;function v($){var R,T=$.exec(u.substring(g));return T?(R=T[0],g+=R.length,R):""}for(var b=[];v(SRCSET_COMMAS_OR_SPACES),!(g>=u.length);){var w=v(SRCSET_NOT_SPACES);if(w.slice(-1)===",")w=absoluteToDoc(y,w.substring(0,w.length-1)),b.push(w);else{var E="";w=absoluteToDoc(y,w);for(var S=!1;;){var A=u.charAt(g);if(A===""){b.push((w+E).trim());break}else if(S)A===")"&&(S=!1);else if(A===","){g+=1,b.push((w+E).trim());break}else A==="("&&(S=!0);E+=A,g+=1}}}return b.join(", ")}var cachedDocument=new WeakMap;function absoluteToDoc(y,u){return!u||u.trim()===""?u:getHref(y,u)}function isSVGElement(y){return!!(y.tagName==="svg"||y.ownerSVGElement)}function getHref(y,u){var g=cachedDocument.get(y);if(g||(g=y.createElement("a"),cachedDocument.set(y,g)),!u)u="";else if(u.startsWith("blob:")||u.startsWith("data:"))return u;return g.setAttribute("href",u),g.href}function transformAttribute(y,u,g,v){return v&&(g==="src"||g==="href"&&!(u==="use"&&v[0]==="#")||g==="xlink:href"&&v[0]!=="#"||g==="background"&&(u==="table"||u==="td"||u==="th")?absoluteToDoc(y,v):g==="srcset"?getAbsoluteSrcsetString(y,v):g==="style"?absolutifyURLs(v,getHref(y)):u==="object"&&g==="data"?absoluteToDoc(y,v):v)}function ignoreAttribute(y,u,g){return(y==="video"||y==="audio")&&u==="autoplay"}function _isBlockedElement(y,u,g){try{if(typeof u=="string"){if(y.classList.contains(u))return!0}else for(var v=y.classList.length;v--;){var b=y.classList[v];if(u.test(b))return!0}if(g)return y.matches(g)}catch{}return!1}function classMatchesRegex(y,u,g){if(!y)return!1;if(y.nodeType!==y.ELEMENT_NODE)return g?classMatchesRegex(index$1.parentNode(y),u,g):!1;for(var v=y.classList.length;v--;){var b=y.classList[v];if(u.test(b))return!0}return g?classMatchesRegex(index$1.parentNode(y),u,g):!1}function needMaskingText(y,u,g,v){var b;if(isElement(y)){if(b=y,!index$1.childNodes(b).length)return!1}else{if(index$1.parentElement(y)===null)return!1;b=index$1.parentElement(y)}try{if(typeof u=="string"){if(v){if(b.closest("."+u))return!0}else if(b.classList.contains(u))return!0}else if(classMatchesRegex(b,u,v))return!0;if(g){if(v){if(b.closest(g))return!0}else if(b.matches(g))return!0}}catch{}return!1}function onceIframeLoaded(y,u,g){var v=y.contentWindow;if(v){var b=!1,w;try{w=v.document.readyState}catch{return}if(w!=="complete"){var E=setTimeout(function(){b||(u(),b=!0)},g);y.addEventListener("load",function(){clearTimeout(E),b=!0,u()});return}var S="about:blank";if(v.location.href!==S||y.src===S||y.src==="")return setTimeout(u,0),y.addEventListener("load",u);y.addEventListener("load",u)}}function onceStylesheetLoaded(y,u,g){var v=!1,b;try{b=y.sheet}catch{return}if(!b){var w=setTimeout(function(){v||(u(),v=!0)},g);y.addEventListener("load",function(){clearTimeout(w),v=!0,u()})}}function serializeNode(y,u){var g=u.doc,v=u.mirror,b=u.blockClass,w=u.blockSelector,E=u.needsMask,S=u.inlineStylesheet,A=u.maskInputOptions,$=A===void 0?{}:A,R=u.maskTextFn,T=u.maskInputFn,O=u.dataURLOptions,B=O===void 0?{}:O,F=u.inlineImages,U=u.recordCanvas,q=u.keepIframeSrcFn,J=u.newlyAddedElement,ie=J===void 0?!1:J,oe=u.cssCaptured,le=oe===void 0?!1:oe,de=getRootId(g,v);switch(y.nodeType){case y.DOCUMENT_NODE:return y.compatMode!=="CSS1Compat"?{type:NodeType$3.Document,childNodes:[],compatMode:y.compatMode}:{type:NodeType$3.Document,childNodes:[]};case y.DOCUMENT_TYPE_NODE:return{type:NodeType$3.DocumentType,name:y.name,publicId:y.publicId,systemId:y.systemId,rootId:de};case y.ELEMENT_NODE:return serializeElementNode(y,{doc:g,blockClass:b,blockSelector:w,inlineStylesheet:S,maskInputOptions:$,maskInputFn:T,dataURLOptions:B,inlineImages:F,recordCanvas:U,keepIframeSrcFn:q,newlyAddedElement:ie,rootId:de});case y.TEXT_NODE:return serializeTextNode(y,{doc:g,needsMask:E,maskTextFn:R,rootId:de,cssCaptured:le});case y.CDATA_SECTION_NODE:return{type:NodeType$3.CDATA,textContent:"",rootId:de};case y.COMMENT_NODE:return{type:NodeType$3.Comment,textContent:index$1.textContent(y)||"",rootId:de};default:return!1}}function getRootId(y,u){if(u.hasNode(y)){var g=u.getId(y);return g===1?void 0:g}}function serializeTextNode(y,u){var g=u.needsMask,v=u.maskTextFn,b=u.rootId,w=u.cssCaptured,E=index$1.parentNode(y),S=E&&E.tagName,A="",$=S==="STYLE"?!0:void 0,R=S==="SCRIPT"?!0:void 0;return R?A="SCRIPT_PLACEHOLDER":w||(A=index$1.textContent(y),$&&A&&(A=absolutifyURLs(A,getHref(u.doc)))),!$&&!R&&A&&g&&(A=v?v(A,index$1.parentElement(y)):A.replace(/[\S]/g,"*")),{type:NodeType$3.Text,textContent:A||"",rootId:b}}function serializeElementNode(y,u){for(var g=u.doc,v=u.blockClass,b=u.blockSelector,w=u.inlineStylesheet,E=u.maskInputOptions,S=E===void 0?{}:E,A=u.maskInputFn,$=u.dataURLOptions,R=$===void 0?{}:$,T=u.inlineImages,O=u.recordCanvas,B=u.keepIframeSrcFn,F=u.newlyAddedElement,U=F===void 0?!1:F,q=u.rootId,J=_isBlockedElement(y,v,b),ie=getValidTagName$1(y),oe={},le=y.attributes.length,de=0;de<le;de++){var fe=y.attributes[de];ignoreAttribute(ie,fe.name,fe.value)||(oe[fe.name]=transformAttribute(g,ie,toLowerCase(fe.name),fe.value))}if(ie==="link"&&w){var ye=Array.from(g.styleSheets).find(function(_e){return _e.href===y.href}),we=null;ye&&(we=stringifyStylesheet(ye)),we&&(delete oe.rel,delete oe.href,oe._cssText=we)}if(ie==="style"&&y.sheet){var pe=stringifyStylesheet(y.sheet);pe&&(y.childNodes.length>1&&(pe=markCssSplits(pe,y)),oe._cssText=pe)}if(ie==="input"||ie==="textarea"||ie==="select"){var ve=y.value,he=y.checked;oe.type!=="radio"&&oe.type!=="checkbox"&&oe.type!=="submit"&&oe.type!=="button"&&ve?oe.value=maskInputValue({element:y,type:getInputType(y),tagName:ie,value:ve,maskInputOptions:S,maskInputFn:A}):he&&(oe.checked=he)}if(ie==="option"&&(y.selected&&!S.select?oe.selected=!0:delete oe.selected),ie==="dialog"&&y.open&&(oe.rr_open_mode=y.matches("dialog:modal")?"modal":"non-modal"),ie==="canvas"&&O){if(y.__context==="2d")is2DCanvasBlank(y)||(oe.rr_dataURL=y.toDataURL(R.type,R.quality));else if(!("__context"in y)){var ae=y.toDataURL(R.type,R.quality),Q=g.createElement("canvas");Q.width=y.width,Q.height=y.height;var j=Q.toDataURL(R.type,R.quality);ae!==j&&(oe.rr_dataURL=ae)}}if(ie==="img"&&T){canvasService||(canvasService=g.createElement("canvas"),canvasCtx=canvasService.getContext("2d"));var z=y,re=z.currentSrc||z.getAttribute("src")||"<unknown-src>",Y=z.crossOrigin,te=function(){z.removeEventListener("load",te);try{canvasService.width=z.naturalWidth,canvasService.height=z.naturalHeight,canvasCtx.drawImage(z,0,0),oe.rr_dataURL=canvasService.toDataURL(R.type,R.quality)}catch(_e){if(z.crossOrigin!=="anonymous"){z.crossOrigin="anonymous",z.complete&&z.naturalWidth!==0?te():z.addEventListener("load",te);return}else console.warn("Cannot inline img src="+re+"! Error: "+_e)}z.crossOrigin==="anonymous"&&(Y?oe.crossOrigin=Y:z.removeAttribute("crossorigin"))};z.complete&&z.naturalWidth!==0?te():z.addEventListener("load",te)}if(ie==="audio"||ie==="video"){var ne=oe;ne.rr_mediaState=y.paused?"paused":"played",ne.rr_mediaCurrentTime=y.currentTime,ne.rr_mediaPlaybackRate=y.playbackRate,ne.rr_mediaMuted=y.muted,ne.rr_mediaLoop=y.loop,ne.rr_mediaVolume=y.volume}if(U||(y.scrollLeft&&(oe.rr_scrollLeft=y.scrollLeft),y.scrollTop&&(oe.rr_scrollTop=y.scrollTop)),J){var se=y.getBoundingClientRect(),ee=se.width,Z=se.height;oe={class:oe.class,rr_width:""+ee+"px",rr_height:""+Z+"px"}}ie==="iframe"&&!B(oe.src)&&(y.contentDocument||(oe.rr_src=oe.src),delete oe.src);var ue;try{customElements.get(ie)&&(ue=!0)}catch{}return{type:NodeType$3.Element,tagName:ie,attributes:oe,childNodes:[],isSVG:isSVGElement(y)||void 0,needBlock:J,rootId:q,isCustom:ue}}function lowerIfExists(y){return y==null?"":y.toLowerCase()}function slimDOMExcluded(y,u){if(u.comment&&y.type===NodeType$3.Comment)return!0;if(y.type===NodeType$3.Element){if(u.script&&(y.tagName==="script"||y.tagName==="link"&&(y.attributes.rel==="preload"&&y.attributes.as==="script"||y.attributes.rel==="modulepreload")||y.tagName==="link"&&y.attributes.rel==="prefetch"&&typeof y.attributes.href=="string"&&extractFileExtension(y.attributes.href)==="js"))return!0;if(u.headFavicon&&(y.tagName==="link"&&y.attributes.rel==="shortcut icon"||y.tagName==="meta"&&(lowerIfExists(y.attributes.name).match(/^msapplication-tile(image|color)$/)||lowerIfExists(y.attributes.name)==="application-name"||lowerIfExists(y.attributes.rel)==="icon"||lowerIfExists(y.attributes.rel)==="apple-touch-icon"||lowerIfExists(y.attributes.rel)==="shortcut icon")))return!0;if(y.tagName==="meta"){if(u.headMetaDescKeywords&&lowerIfExists(y.attributes.name).match(/^description|keywords$/))return!0;if(u.headMetaSocial&&(lowerIfExists(y.attributes.property).match(/^(og|twitter|fb):/)||lowerIfExists(y.attributes.name).match(/^(og|twitter):/)||lowerIfExists(y.attributes.name)==="pinterest"))return!0;if(u.headMetaRobots&&(lowerIfExists(y.attributes.name)==="robots"||lowerIfExists(y.attributes.name)==="googlebot"||lowerIfExists(y.attributes.name)==="bingbot"))return!0;if(u.headMetaHttpEquiv&&y.attributes["http-equiv"]!==void 0)return!0;if(u.headMetaAuthorship&&(lowerIfExists(y.attributes.name)==="author"||lowerIfExists(y.attributes.name)==="generator"||lowerIfExists(y.attributes.name)==="framework"||lowerIfExists(y.attributes.name)==="publisher"||lowerIfExists(y.attributes.name)==="progid"||lowerIfExists(y.attributes.property).match(/^article:/)||lowerIfExists(y.attributes.property).match(/^product:/)))return!0;if(u.headMetaVerification&&(lowerIfExists(y.attributes.name)==="google-site-verification"||lowerIfExists(y.attributes.name)==="yandex-verification"||lowerIfExists(y.attributes.name)==="csrf-token"||lowerIfExists(y.attributes.name)==="p:domain_verify"||lowerIfExists(y.attributes.name)==="verify-v1"||lowerIfExists(y.attributes.name)==="verification"||lowerIfExists(y.attributes.name)==="shopify-checkout-api-token"))return!0}}return!1}function serializeNodeWithId(y,u){var g=u.doc,v=u.mirror,b=u.blockClass,w=u.blockSelector,E=u.maskTextClass,S=u.maskTextSelector,A=u.skipChild,$=A===void 0?!1:A,R=u.inlineStylesheet,T=R===void 0?!0:R,O=u.maskInputOptions,B=O===void 0?{}:O,F=u.maskTextFn,U=u.maskInputFn,q=u.slimDOMOptions,J=u.dataURLOptions,ie=J===void 0?{}:J,oe=u.inlineImages,le=oe===void 0?!1:oe,de=u.recordCanvas,fe=de===void 0?!1:de,ye=u.onSerialize,we=u.onIframeLoad,pe=u.iframeLoadTimeout,ve=pe===void 0?5e3:pe,he=u.onStylesheetLoad,ae=u.stylesheetLoadTimeout,Q=ae===void 0?5e3:ae,j=u.keepIframeSrcFn,z=j===void 0?function(){return!1}:j,re=u.newlyAddedElement,Y=re===void 0?!1:re,te=u.cssCaptured,ne=te===void 0?!1:te,se=u.needsMask,ee=u.preserveWhiteSpace,Z=ee===void 0?!0:ee;if(!se){var ue=se===void 0;se=needMaskingText(y,E,S,ue)}var _e=serializeNode(y,{doc:g,mirror:v,blockClass:b,blockSelector:w,needsMask:se,inlineStylesheet:T,maskInputOptions:B,maskTextFn:F,maskInputFn:U,dataURLOptions:ie,inlineImages:le,recordCanvas:fe,keepIframeSrcFn:z,newlyAddedElement:Y,cssCaptured:ne});if(!_e)return console.warn(y,"not serialized"),null;var Re;v.hasNode(y)?Re=v.getId(y):slimDOMExcluded(_e,q)||!Z&&_e.type===NodeType$3.Text&&!_e.textContent.replace(/^\s+|\s+$/gm,"").length?Re=IGNORED_NODE:Re=genId();var Ae=Object.assign(_e,{id:Re});if(v.add(y,Ae),Re===IGNORED_NODE)return null;ye&&ye(y);var ge=!$;if(Ae.type===NodeType$3.Element){ge=ge&&!Ae.needBlock,delete Ae.needBlock;var be=index$1.shadowRoot(y);be&&isNativeShadowDom(be)&&(Ae.isShadowHost=!0)}if((Ae.type===NodeType$3.Document||Ae.type===NodeType$3.Element)&&ge){q.headWhitespace&&Ae.type===NodeType$3.Element&&Ae.tagName==="head"&&(Z=!1);var Te={doc:g,mirror:v,blockClass:b,blockSelector:w,needsMask:se,maskTextClass:E,maskTextSelector:S,skipChild:$,inlineStylesheet:T,maskInputOptions:B,maskTextFn:F,maskInputFn:U,slimDOMOptions:q,dataURLOptions:ie,inlineImages:le,recordCanvas:fe,preserveWhiteSpace:Z,onSerialize:ye,onIframeLoad:we,iframeLoadTimeout:ve,onStylesheetLoad:he,stylesheetLoadTimeout:Q,keepIframeSrcFn:z,cssCaptured:!1};if(!(Ae.type===NodeType$3.Element&&Ae.tagName==="textarea"&&Ae.attributes.value!==void 0)){Ae.type===NodeType$3.Element&&Ae.attributes._cssText!==void 0&&typeof Ae.attributes._cssText=="string"&&(Te.cssCaptured=!0);for(var De=_create_for_of_iterator_helper_loose(Array.from(index$1.childNodes(y))),Ie;!(Ie=De()).done;){var Se=Ie.value,Be=serializeNodeWithId(Se,Te);Be&&Ae.childNodes.push(Be)}}var Le=null;if(isElement(y)&&(Le=index$1.shadowRoot(y)))for(var qe=_create_for_of_iterator_helper_loose(Array.from(index$1.childNodes(Le))),Ke;!(Ke=qe()).done;){var Ge=Ke.value,Xe=serializeNodeWithId(Ge,Te);Xe&&(isNativeShadowDom(Le)&&(Xe.isShadow=!0),Ae.childNodes.push(Xe))}}var ze=index$1.parentNode(y);return ze&&isShadowRoot(ze)&&isNativeShadowDom(ze)&&(Ae.isShadow=!0),Ae.type===NodeType$3.Element&&Ae.tagName==="iframe"&&onceIframeLoaded(y,function(){var et=y.contentDocument;if(et&&we){var Ze=serializeNodeWithId(et,{doc:et,mirror:v,blockClass:b,blockSelector:w,needsMask:se,maskTextClass:E,maskTextSelector:S,skipChild:!1,inlineStylesheet:T,maskInputOptions:B,maskTextFn:F,maskInputFn:U,slimDOMOptions:q,dataURLOptions:ie,inlineImages:le,recordCanvas:fe,preserveWhiteSpace:Z,onSerialize:ye,onIframeLoad:we,iframeLoadTimeout:ve,onStylesheetLoad:he,stylesheetLoadTimeout:Q,keepIframeSrcFn:z});Ze&&we(y,Ze)}},ve),Ae.type===NodeType$3.Element&&Ae.tagName==="link"&&typeof Ae.attributes.rel=="string"&&(Ae.attributes.rel==="stylesheet"||Ae.attributes.rel==="preload"&&typeof Ae.attributes.href=="string"&&extractFileExtension(Ae.attributes.href)==="css")&&onceStylesheetLoaded(y,function(){if(he){var et=serializeNodeWithId(y,{doc:g,mirror:v,blockClass:b,blockSelector:w,needsMask:se,maskTextClass:E,maskTextSelector:S,skipChild:!1,inlineStylesheet:T,maskInputOptions:B,maskTextFn:F,maskInputFn:U,slimDOMOptions:q,dataURLOptions:ie,inlineImages:le,recordCanvas:fe,preserveWhiteSpace:Z,onSerialize:ye,onIframeLoad:we,iframeLoadTimeout:ve,onStylesheetLoad:he,stylesheetLoadTimeout:Q,keepIframeSrcFn:z});et&&he(y,et)}},Q),Ae}function snapshot(y,u){var g=u||{},v=g.mirror,b=v===void 0?new Mirror:v,w=g.blockClass,E=w===void 0?"rr-block":w,S=g.blockSelector,A=S===void 0?null:S,$=g.maskTextClass,R=$===void 0?"rr-mask":$,T=g.maskTextSelector,O=T===void 0?null:T,B=g.inlineStylesheet,F=B===void 0?!0:B,U=g.inlineImages,q=U===void 0?!1:U,J=g.recordCanvas,ie=J===void 0?!1:J,oe=g.maskAllInputs,le=oe===void 0?!1:oe,de=g.maskTextFn,fe=g.maskInputFn,ye=g.slimDOM,we=ye===void 0?!1:ye,pe=g.dataURLOptions,ve=g.preserveWhiteSpace,he=g.onSerialize,ae=g.onIframeLoad,Q=g.iframeLoadTimeout,j=g.onStylesheetLoad,z=g.stylesheetLoadTimeout,re=g.keepIframeSrcFn,Y=re===void 0?function(){return!1}:re,te=le===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0,hidden:!0}:le===!1?{password:!0}:le,ne=we===!0||we==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:we==="all",headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:we===!1?{}:we;return serializeNodeWithId(y,{doc:y,mirror:b,blockClass:E,blockSelector:A,maskTextClass:R,maskTextSelector:O,skipChild:!1,inlineStylesheet:F,maskInputOptions:te,maskTextFn:de,maskInputFn:fe,slimDOMOptions:ne,dataURLOptions:pe,inlineImages:q,recordCanvas:ie,preserveWhiteSpace:ve,onSerialize:he,onIframeLoad:ae,iframeLoadTimeout:Q,onStylesheetLoad:j,stylesheetLoadTimeout:z,keepIframeSrcFn:Y,newlyAddedElement:!1})}function getDefaultExportFromCjs$1(y){return y&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y}function getAugmentedNamespace$1(y){if(y.__esModule)return y;var u=y.default;if(typeof u=="function"){var g=function v(){return _instanceof(this,v)?Reflect.construct(u,arguments,this.constructor):u.apply(this,arguments)};g.prototype=u.prototype}else g={};return Object.defineProperty(g,"__esModule",{value:!0}),Object.keys(y).forEach(function(v){var b=Object.getOwnPropertyDescriptor(y,v);Object.defineProperty(g,v,b.get?b:{enumerable:!0,get:function(){return y[v]}})}),g}var picocolors_browser$1={exports:{}},x$1=String,create$1=function y(){return{isColorSupported:!1,reset:x$1,bold:x$1,dim:x$1,italic:x$1,underline:x$1,inverse:x$1,hidden:x$1,strikethrough:x$1,black:x$1,red:x$1,green:x$1,yellow:x$1,blue:x$1,magenta:x$1,cyan:x$1,white:x$1,gray:x$1,bgBlack:x$1,bgRed:x$1,bgGreen:x$1,bgYellow:x$1,bgBlue:x$1,bgMagenta:x$1,bgCyan:x$1,bgWhite:x$1}};picocolors_browser$1.exports=create$1();picocolors_browser$1.exports.createColors=create$1;var picocolors_browserExports$1=picocolors_browser$1.exports,__viteBrowserExternal$2={},__viteBrowserExternal$1$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal$2},Symbol.toStringTag,{value:"Module"})),require$$2$1=getAugmentedNamespace$1(__viteBrowserExternal$1$1),pico$1=picocolors_browserExports$1,terminalHighlight$1$1=require$$2$1,CssSyntaxError$3$1=(function(y){_inherits(u,y);function u(v,b,w,E,S,A){var $;return $=y.call(this,v)||this,$.name="CssSyntaxError",$.reason=v,S&&($.file=S),E&&($.source=E),A&&($.plugin=A),typeof b<"u"&&typeof w<"u"&&(typeof b=="number"?($.line=b,$.column=w):($.line=b.line,$.column=b.column,$.endLine=w.line,$.endColumn=w.column)),$.setMessage(),Error.captureStackTrace&&Error.captureStackTrace($,u),$}var g=u.prototype;return g.setMessage=function(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",typeof this.line<"u"&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason},g.showSourceCode=function(b){var w=this;if(!this.source)return"";var E=this.source;b==null&&(b=pico$1.isColorSupported),terminalHighlight$1$1&&b&&(E=terminalHighlight$1$1(E));var S=E.split(/\r?\n/),A=Math.max(this.line-3,0),$=Math.min(this.line+2,S.length),R=String($).length,T,O;if(b){var B=pico$1.createColors(!0),F=B.bold,U=B.gray,q=B.red;T=function(J){return F(q(J))},O=function(J){return U(J)}}else T=O=function(J){return J};return S.slice(A,$).map(function(J,ie){var oe=A+1+ie,le=" "+(" "+oe).slice(-R)+" | ";if(oe===w.line){var de=O(le.replace(/\d/g," "))+J.slice(0,w.column-1).replace(/[^\t]/g," ");return T(">")+O(le)+J+`
 `+de+T("^")}return" "+O(le)+J}).join(`
`)},g.toString=function(){var b=this.showSourceCode();return b&&(b=`

`+b+`
`),this.name+": "+this.message+b},u})(_wrap_native_super(Error)),cssSyntaxError$1=CssSyntaxError$3$1;CssSyntaxError$3$1.default=CssSyntaxError$3$1;var symbols$1={};symbols$1.isClean=Symbol("isClean");symbols$1.my=Symbol("my");var DEFAULT_RAW$1={after:`
`,beforeClose:`
`,beforeComment:`
`,beforeDecl:`
`,beforeOpen:" ",beforeRule:`
`,colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};function capitalize$1(y){return y[0].toUpperCase()+y.slice(1)}var Stringifier$2$1=(function(){function y(g){this.builder=g}var u=y.prototype;return u.atrule=function(v,b){var w="@"+v.name,E=v.params?this.rawValue(v,"params"):"";if(typeof v.raws.afterName<"u"?w+=v.raws.afterName:E&&(w+=" "),v.nodes)this.block(v,w+E);else{var S=(v.raws.between||"")+(b?";":"");this.builder(w+E+S,v)}},u.beforeAfter=function(v,b){var w;v.type==="decl"?w=this.raw(v,null,"beforeDecl"):v.type==="comment"?w=this.raw(v,null,"beforeComment"):b==="before"?w=this.raw(v,null,"beforeRule"):w=this.raw(v,null,"beforeClose");for(var E=v.parent,S=0;E&&E.type!=="root";)S+=1,E=E.parent;if(w.includes(`
`)){var A=this.raw(v,null,"indent");if(A.length)for(var $=0;$<S;$++)w+=A}return w},u.block=function(v,b){var w=this.raw(v,"between","beforeOpen");this.builder(b+w+"{",v,"start");var E;v.nodes&&v.nodes.length?(this.body(v),E=this.raw(v,"after")):E=this.raw(v,"after","emptyBody"),E&&this.builder(E),this.builder("}",v,"end")},u.body=function(v){for(var b=v.nodes.length-1;b>0&&v.nodes[b].type==="comment";)b-=1;for(var w=this.raw(v,"semicolon"),E=0;E<v.nodes.length;E++){var S=v.nodes[E],A=this.raw(S,"before");A&&this.builder(A),this.stringify(S,b!==E||w)}},u.comment=function(v){var b=this.raw(v,"left","commentLeft"),w=this.raw(v,"right","commentRight");this.builder("/*"+b+v.text+w+"*/",v)},u.decl=function(v,b){var w=this.raw(v,"between","colon"),E=v.prop+w+this.rawValue(v,"value");v.important&&(E+=v.raws.important||" !important"),b&&(E+=";"),this.builder(E,v)},u.document=function(v){this.body(v)},u.raw=function(v,b,w){var E;if(w||(w=b),b&&(E=v.raws[b],typeof E<"u"))return E;var S=v.parent;if(w==="before"&&(!S||S.type==="root"&&S.first===v||S&&S.type==="document"))return"";if(!S)return DEFAULT_RAW$1[w];var A=v.root();if(A.rawCache||(A.rawCache={}),typeof A.rawCache[w]<"u")return A.rawCache[w];if(w==="before"||w==="after")return this.beforeAfter(v,w);var $="raw"+capitalize$1(w);return this[$]?E=this[$](A,v):A.walk(function(R){if(E=R.raws[b],typeof E<"u")return!1}),typeof E>"u"&&(E=DEFAULT_RAW$1[w]),A.rawCache[w]=E,E},u.rawBeforeClose=function(v){var b;return v.walk(function(w){if(w.nodes&&w.nodes.length>0&&typeof w.raws.after<"u")return b=w.raws.after,b.includes(`
`)&&(b=b.replace(/[^\n]+$/,"")),!1}),b&&(b=b.replace(/\S/g,"")),b},u.rawBeforeComment=function(v,b){var w;return v.walkComments(function(E){if(typeof E.raws.before<"u")return w=E.raws.before,w.includes(`
`)&&(w=w.replace(/[^\n]+$/,"")),!1}),typeof w>"u"?w=this.raw(b,null,"beforeDecl"):w&&(w=w.replace(/\S/g,"")),w},u.rawBeforeDecl=function(v,b){var w;return v.walkDecls(function(E){if(typeof E.raws.before<"u")return w=E.raws.before,w.includes(`
`)&&(w=w.replace(/[^\n]+$/,"")),!1}),typeof w>"u"?w=this.raw(b,null,"beforeRule"):w&&(w=w.replace(/\S/g,"")),w},u.rawBeforeOpen=function(v){var b;return v.walk(function(w){if(w.type!=="decl"&&(b=w.raws.between,typeof b<"u"))return!1}),b},u.rawBeforeRule=function(v){var b;return v.walk(function(w){if(w.nodes&&(w.parent!==v||v.first!==w)&&typeof w.raws.before<"u")return b=w.raws.before,b.includes(`
`)&&(b=b.replace(/[^\n]+$/,"")),!1}),b&&(b=b.replace(/\S/g,"")),b},u.rawColon=function(v){var b;return v.walkDecls(function(w){if(typeof w.raws.between<"u")return b=w.raws.between.replace(/[^\s:]/g,""),!1}),b},u.rawEmptyBody=function(v){var b;return v.walk(function(w){if(w.nodes&&w.nodes.length===0&&(b=w.raws.after,typeof b<"u"))return!1}),b},u.rawIndent=function(v){if(v.raws.indent)return v.raws.indent;var b;return v.walk(function(w){var E=w.parent;if(E&&E!==v&&E.parent&&E.parent===v&&typeof w.raws.before<"u"){var S=w.raws.before.split(`
`);return b=S[S.length-1],b=b.replace(/\S/g,""),!1}}),b},u.rawSemicolon=function(v){var b;return v.walk(function(w){if(w.nodes&&w.nodes.length&&w.last.type==="decl"&&(b=w.raws.semicolon,typeof b<"u"))return!1}),b},u.rawValue=function(v,b){var w=v[b],E=v.raws[b];return E&&E.value===w?E.raw:w},u.root=function(v){this.body(v),v.raws.after&&this.builder(v.raws.after)},u.rule=function(v){this.block(v,this.rawValue(v,"selector")),v.raws.ownSemicolon&&this.builder(v.raws.ownSemicolon,v,"end")},u.stringify=function(v,b){if(!this[v.type])throw new Error("Unknown AST node type "+v.type+". Maybe you need to change PostCSS stringifier.");this[v.type](v,b)},y})(),stringifier$1=Stringifier$2$1;Stringifier$2$1.default=Stringifier$2$1;var Stringifier$1$1=stringifier$1;function stringify$4$1(y,u){var g=new Stringifier$1$1(u);g.stringify(y)}var stringify_1$1=stringify$4$1;stringify$4$1.default=stringify$4$1;var isClean$2$1=symbols$1.isClean,my$2$1=symbols$1.my,CssSyntaxError$2$1=cssSyntaxError$1,Stringifier2$1=stringifier$1,stringify$3$1=stringify_1$1;function cloneNode$1(y,u){var g=new y.constructor;for(var v in y)if(Object.prototype.hasOwnProperty.call(y,v)&&v!=="proxyCache"){var b=y[v],w=typeof b>"u"?"undefined":_type_of(b);v==="parent"&&w==="object"?u&&(g[v]=u):v==="source"?g[v]=b:Array.isArray(b)?g[v]=b.map(function(E){return cloneNode$1(E,g)}):(w==="object"&&b!==null&&(b=cloneNode$1(b)),g[v]=b)}return g}var Node$4$1=(function(){function y(g){g===void 0&&(g={}),this.raws={},this[isClean$2$1]=!1,this[my$2$1]=!0;for(var v in g)if(v==="nodes"){this.nodes=[];for(var b=_create_for_of_iterator_helper_loose(g[v]),w;!(w=b()).done;){var E=w.value;typeof E.clone=="function"?this.append(E.clone()):this.append(E)}}else this[v]=g[v]}var u=y.prototype;return u.addToError=function(v){if(v.postcssNode=this,v.stack&&this.source&&/\n\s{4}at /.test(v.stack)){var b=this.source;v.stack=v.stack.replace(/\n\s{4}at /,"$&"+b.input.from+":"+b.start.line+":"+b.start.column+"$&")}return v},u.after=function(v){return this.parent.insertAfter(this,v),this},u.assign=function(v){v===void 0&&(v={});for(var b in v)this[b]=v[b];return this},u.before=function(v){return this.parent.insertBefore(this,v),this},u.cleanRaws=function(v){delete this.raws.before,delete this.raws.after,v||delete this.raws.between},u.clone=function(v){v===void 0&&(v={});var b=cloneNode$1(this);for(var w in v)b[w]=v[w];return b},u.cloneAfter=function(v){v===void 0&&(v={});var b=this.clone(v);return this.parent.insertAfter(this,b),b},u.cloneBefore=function(v){v===void 0&&(v={});var b=this.clone(v);return this.parent.insertBefore(this,b),b},u.error=function(v,b){if(b===void 0&&(b={}),this.source){var w=this.rangeBy(b),E=w.end,S=w.start;return this.source.input.error(v,{column:S.column,line:S.line},{column:E.column,line:E.line},b)}return new CssSyntaxError$2$1(v)},u.getProxyProcessor=function(){return{get:function(b,w){return w==="proxyOf"?b:w==="root"?function(){return b.root().toProxy()}:b[w]},set:function(b,w,E){return b[w]===E||(b[w]=E,(w==="prop"||w==="value"||w==="name"||w==="params"||w==="important"||w==="text")&&b.markDirty()),!0}}},u.markDirty=function(){if(this[isClean$2$1]){this[isClean$2$1]=!1;for(var v=this;v=v.parent;)v[isClean$2$1]=!1}},u.next=function(){if(this.parent){var v=this.parent.index(this);return this.parent.nodes[v+1]}},u.positionBy=function(v,b){var w=this.source.start;if(v.index)w=this.positionInside(v.index,b);else if(v.word){b=this.toString();var E=b.indexOf(v.word);E!==-1&&(w=this.positionInside(E,b))}return w},u.positionInside=function(v,b){for(var w=b||this.toString(),E=this.source.start.column,S=this.source.start.line,A=0;A<v;A++)w[A]===`
`?(E=1,S+=1):E+=1;return{column:E,line:S}},u.prev=function(){if(this.parent){var v=this.parent.index(this);return this.parent.nodes[v-1]}},u.rangeBy=function(v){var b={column:this.source.start.column,line:this.source.start.line},w=this.source.end?{column:this.source.end.column+1,line:this.source.end.line}:{column:b.column+1,line:b.line};if(v.word){var E=this.toString(),S=E.indexOf(v.word);S!==-1&&(b=this.positionInside(S,E),w=this.positionInside(S+v.word.length,E))}else v.start?b={column:v.start.column,line:v.start.line}:v.index&&(b=this.positionInside(v.index)),v.end?w={column:v.end.column,line:v.end.line}:typeof v.endIndex=="number"?w=this.positionInside(v.endIndex):v.index&&(w=this.positionInside(v.index+1));return(w.line<b.line||w.line===b.line&&w.column<=b.column)&&(w={column:b.column+1,line:b.line}),{end:w,start:b}},u.raw=function(v,b){var w=new Stringifier2$1;return w.raw(this,v,b)},u.remove=function(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this},u.replaceWith=function(){for(var v=arguments.length,b=new Array(v),w=0;w<v;w++)b[w]=arguments[w];if(this.parent){for(var E=this,S=!1,A=_create_for_of_iterator_helper_loose(b),$;!($=A()).done;){var R=$.value;R===this?S=!0:S?(this.parent.insertAfter(E,R),E=R):this.parent.insertBefore(E,R)}S||this.remove()}return this},u.root=function(){for(var v=this;v.parent&&v.parent.type!=="document";)v=v.parent;return v},u.toJSON=function(v,b){var w={},E=b==null;b=b||new Map;var S=0;for(var A in this)if(Object.prototype.hasOwnProperty.call(this,A)&&!(A==="parent"||A==="proxyCache")){var $=this[A];if(Array.isArray($))w[A]=$.map(function(T){return(typeof T>"u"?"undefined":_type_of(T))==="object"&&T.toJSON?T.toJSON(null,b):T});else if((typeof $>"u"?"undefined":_type_of($))==="object"&&$.toJSON)w[A]=$.toJSON(null,b);else if(A==="source"){var R=b.get($.input);R==null&&(R=S,b.set($.input,S),S++),w[A]={end:$.end,inputId:R,start:$.start}}else w[A]=$}return E&&(w.inputs=[].concat(b.keys()).map(function(T){return T.toJSON()})),w},u.toProxy=function(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache},u.toString=function(v){v===void 0&&(v=stringify$3$1),v.stringify&&(v=v.stringify);var b="";return v(this,function(w){b+=w}),b},u.warn=function(v,b,w){var E={node:this};for(var S in w)E[S]=w[S];return v.warn(b,E)},_create_class(y,[{key:"proxyOf",get:function(){return this}}]),y})(),node$1=Node$4$1;Node$4$1.default=Node$4$1;var Node$3$1=node$1,Declaration$4$1=(function(y){_inherits(u,y);function u(g){var v;return g&&typeof g.value<"u"&&typeof g.value!="string"&&(g=_extends({},g,{value:String(g.value)})),v=y.call(this,g)||this,v.type="decl",v}return _create_class(u,[{key:"variable",get:function(){return this.prop.startsWith("--")||this.prop[0]==="$"}}]),u})(Node$3$1),declaration$1=Declaration$4$1;Declaration$4$1.default=Declaration$4$1;var urlAlphabet$1="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",nanoid$1$1=function(y){y===void 0&&(y=21);for(var u="",g=y;g--;)u+=urlAlphabet$1[Math.random()*64|0];return u},nonSecure$1={nanoid:nanoid$1$1},SourceMapConsumer$2$1=require$$2$1.SourceMapConsumer,SourceMapGenerator$2$1=require$$2$1.SourceMapGenerator,existsSync$1=require$$2$1.existsSync,readFileSync$1=require$$2$1.readFileSync,dirname$1$1=require$$2$1.dirname,join$1=require$$2$1.join;function fromBase64$1(y){return Buffer?Buffer.from(y,"base64").toString():window.atob(y)}var PreviousMap$2$1=(function(){function y(g,v){if(v.map!==!1){this.loadAnnotation(g),this.inline=this.startWith(this.annotation,"data:");var b=v.map?v.map.prev:void 0,w=this.loadMap(v.from,b);!this.mapFile&&v.from&&(this.mapFile=v.from),this.mapFile&&(this.root=dirname$1$1(this.mapFile)),w&&(this.text=w)}}var u=y.prototype;return u.consumer=function(){return this.consumerCache||(this.consumerCache=new SourceMapConsumer$2$1(this.text)),this.consumerCache},u.decodeInline=function(v){var b=/^data:application\/json;charset=utf-?8;base64,/,w=/^data:application\/json;base64,/,E=/^data:application\/json;charset=utf-?8,/,S=/^data:application\/json,/;if(E.test(v)||S.test(v))return decodeURIComponent(v.substr(RegExp.lastMatch.length));if(b.test(v)||w.test(v))return fromBase64$1(v.substr(RegExp.lastMatch.length));var A=v.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+A)},u.getAnnotationURL=function(v){return v.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()},u.isMap=function(v){return(typeof v>"u"?"undefined":_type_of(v))!=="object"?!1:typeof v.mappings=="string"||typeof v._mappings=="string"||Array.isArray(v.sections)},u.loadAnnotation=function(v){var b=v.match(/\/\*\s*# sourceMappingURL=/gm);if(b){var w=v.lastIndexOf(b.pop()),E=v.indexOf("*/",w);w>-1&&E>-1&&(this.annotation=this.getAnnotationURL(v.substring(w,E)))}},u.loadFile=function(v){if(this.root=dirname$1$1(v),existsSync$1(v))return this.mapFile=v,readFileSync$1(v,"utf-8").toString().trim()},u.loadMap=function(v,b){if(b===!1)return!1;if(b){if(typeof b=="string")return b;if(typeof b=="function"){var w=b(v);if(w){var E=this.loadFile(w);if(!E)throw new Error("Unable to load previous source map: "+w.toString());return E}}else{if(_instanceof(b,SourceMapConsumer$2$1))return SourceMapGenerator$2$1.fromSourceMap(b).toString();if(_instanceof(b,SourceMapGenerator$2$1))return b.toString();if(this.isMap(b))return JSON.stringify(b);throw new Error("Unsupported previous source map format: "+b.toString())}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){var S=this.annotation;return v&&(S=join$1(dirname$1$1(v),S)),this.loadFile(S)}}},u.startWith=function(v,b){return v?v.substr(0,b.length)===b:!1},u.withContent=function(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)},y})(),previousMap$1=PreviousMap$2$1;PreviousMap$2$1.default=PreviousMap$2$1;var SourceMapConsumer$1$1=require$$2$1.SourceMapConsumer,SourceMapGenerator$1$1=require$$2$1.SourceMapGenerator,fileURLToPath$1=require$$2$1.fileURLToPath,pathToFileURL$1$1=require$$2$1.pathToFileURL,isAbsolute$1=require$$2$1.isAbsolute,resolve$1$1=require$$2$1.resolve,nanoid$2=nonSecure$1.nanoid,terminalHighlight$2=require$$2$1,CssSyntaxError$1$1=cssSyntaxError$1,PreviousMap$1$1=previousMap$1,fromOffsetCache$1=Symbol("fromOffsetCache"),sourceMapAvailable$1$1=!!(SourceMapConsumer$1$1&&SourceMapGenerator$1$1),pathAvailable$1$1=!!(resolve$1$1&&isAbsolute$1),Input$4$1=(function(){function y(g,v){if(v===void 0&&(v={}),g===null||typeof g>"u"||(typeof g>"u"?"undefined":_type_of(g))==="object"&&!g.toString)throw new Error("PostCSS received "+g+" instead of CSS string");if(this.css=g.toString(),this.css[0]==="\uFEFF"||this.css[0]===""?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,v.from&&(!pathAvailable$1$1||/^\w+:\/\//.test(v.from)||isAbsolute$1(v.from)?this.file=v.from:this.file=resolve$1$1(v.from)),pathAvailable$1$1&&sourceMapAvailable$1$1){var b=new PreviousMap$1$1(this.css,v);if(b.text){this.map=b;var w=b.consumer().file;!this.file&&w&&(this.file=this.mapResolve(w))}}this.file||(this.id="<input css "+nanoid$2(6)+">"),this.map&&(this.map.file=this.from)}var u=y.prototype;return u.error=function(v,b,w,E){E===void 0&&(E={});var S,A,$;if(b&&(typeof b>"u"?"undefined":_type_of(b))==="object"){var R=b,T=w;if(typeof R.offset=="number"){var O=this.fromOffset(R.offset);b=O.line,w=O.col}else b=R.line,w=R.column;if(typeof T.offset=="number"){var B=this.fromOffset(T.offset);A=B.line,$=B.col}else A=T.line,$=T.column}else if(!w){var F=this.fromOffset(b);b=F.line,w=F.col}var U=this.origin(b,w,A,$);return U?S=new CssSyntaxError$1$1(v,U.endLine===void 0?U.line:{column:U.column,line:U.line},U.endLine===void 0?U.column:{column:U.endColumn,line:U.endLine},U.source,U.file,E.plugin):S=new CssSyntaxError$1$1(v,A===void 0?b:{column:w,line:b},A===void 0?w:{column:$,line:A},this.css,this.file,E.plugin),S.input={column:w,endColumn:$,endLine:A,line:b,source:this.css},this.file&&(pathToFileURL$1$1&&(S.input.url=pathToFileURL$1$1(this.file).toString()),S.input.file=this.file),S},u.fromOffset=function(v){var b,w;if(this[fromOffsetCache$1])w=this[fromOffsetCache$1];else{var E=this.css.split(`
`);w=new Array(E.length);for(var S=0,A=0,$=E.length;A<$;A++)w[A]=S,S+=E[A].length+1;this[fromOffsetCache$1]=w}b=w[w.length-1];var R=0;if(v>=b)R=w.length-1;else for(var T=w.length-2,O;R<T;)if(O=R+(T-R>>1),v<w[O])T=O-1;else if(v>=w[O+1])R=O+1;else{R=O;break}return{col:v-w[R]+1,line:R+1}},u.mapResolve=function(v){return/^\w+:\/\//.test(v)?v:resolve$1$1(this.map.consumer().sourceRoot||this.map.root||".",v)},u.origin=function(v,b,w,E){if(!this.map)return!1;var S=this.map.consumer(),A=S.originalPositionFor({column:b,line:v});if(!A.source)return!1;var $;typeof w=="number"&&($=S.originalPositionFor({column:E,line:w}));var R;isAbsolute$1(A.source)?R=pathToFileURL$1$1(A.source):R=new URL(A.source,this.map.consumer().sourceRoot||pathToFileURL$1$1(this.map.mapFile));var T={column:A.column,endColumn:$&&$.column,endLine:$&&$.line,line:A.line,url:R.toString()};if(R.protocol==="file:")if(fileURLToPath$1)T.file=fileURLToPath$1(R);else throw new Error("file: protocol is not available in this PostCSS build");var O=S.sourceContentFor(A.source);return O&&(T.source=O),T},u.toJSON=function(){for(var v={},b=0,w=["hasBOM","css","file","id"];b<w.length;b++){var E=w[b];this[E]!=null&&(v[E]=this[E])}return this.map&&(v.map=_extends({},this.map),v.map.consumerCache&&(v.map.consumerCache=void 0)),v},_create_class(y,[{key:"from",get:function(){return this.file||this.id}}]),y})(),input$1=Input$4$1;Input$4$1.default=Input$4$1;terminalHighlight$2&&terminalHighlight$2.registerInput&&terminalHighlight$2.registerInput(Input$4$1);var SourceMapConsumer$3=require$$2$1.SourceMapConsumer,SourceMapGenerator$3=require$$2$1.SourceMapGenerator,dirname$2=require$$2$1.dirname,relative$1=require$$2$1.relative,resolve$2=require$$2$1.resolve,sep$1=require$$2$1.sep,pathToFileURL$2=require$$2$1.pathToFileURL,Input$3$1=input$1,sourceMapAvailable$2=!!(SourceMapConsumer$3&&SourceMapGenerator$3),pathAvailable$2=!!(dirname$2&&resolve$2&&relative$1&&sep$1),MapGenerator$2$1=(function(){function y(g,v,b,w){this.stringify=g,this.mapOpts=b.map||{},this.root=v,this.opts=b,this.css=w,this.originalCSS=w,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}var u=y.prototype;return u.addAnnotation=function(){var v;this.isInline()?v="data:application/json;base64,"+this.toBase64(this.map.toString()):typeof this.mapOpts.annotation=="string"?v=this.mapOpts.annotation:typeof this.mapOpts.annotation=="function"?v=this.mapOpts.annotation(this.opts.to,this.root):v=this.outputFile()+".map";var b=`
`;this.css.includes(`\r
`)&&(b=`\r
`),this.css+=b+"/*# sourceMappingURL="+v+" */"},u.applyPrevMaps=function(){for(var v=_create_for_of_iterator_helper_loose(this.previous()),b;!(b=v()).done;){var w=b.value,E=this.toUrl(this.path(w.file)),S=w.root||dirname$2(w.file),A=void 0;this.mapOpts.sourcesContent===!1?(A=new SourceMapConsumer$3(w.text),A.sourcesContent&&(A.sourcesContent=null)):A=w.consumer(),this.map.applySourceMap(A,E,this.toUrl(this.path(S)))}},u.clearAnnotation=function(){if(this.mapOpts.annotation!==!1)if(this.root)for(var v,b=this.root.nodes.length-1;b>=0;b--)v=this.root.nodes[b],v.type==="comment"&&v.text.indexOf("# sourceMappingURL=")===0&&this.root.removeChild(b);else this.css&&(this.css=this.css.replace(/\n*?\/\*#[\S\s]*?\*\/$/gm,""))},u.generate=function(){if(this.clearAnnotation(),pathAvailable$2&&sourceMapAvailable$2&&this.isMap())return this.generateMap();var v="";return this.stringify(this.root,function(b){v+=b}),[v]},u.generateMap=function(){if(this.root)this.generateString();else if(this.previous().length===1){var v=this.previous()[0].consumer();v.file=this.outputFile(),this.map=SourceMapGenerator$3.fromSourceMap(v,{ignoreInvalidMapping:!0})}else this.map=new SourceMapGenerator$3({file:this.outputFile(),ignoreInvalidMapping:!0}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]},u.generateString=function(){var v=this;this.css="",this.map=new SourceMapGenerator$3({file:this.outputFile(),ignoreInvalidMapping:!0});var b=1,w=1,E="<no source>",S={generated:{column:0,line:0},original:{column:0,line:0},source:""},A,$;this.stringify(this.root,function(R,T,O){if(v.css+=R,T&&O!=="end"&&(S.generated.line=b,S.generated.column=w-1,T.source&&T.source.start?(S.source=v.sourcePath(T),S.original.line=T.source.start.line,S.original.column=T.source.start.column-1,v.map.addMapping(S)):(S.source=E,S.original.line=1,S.original.column=0,v.map.addMapping(S))),A=R.match(/\n/g),A?(b+=A.length,$=R.lastIndexOf(`
`),w=R.length-$):w+=R.length,T&&O!=="start"){var B=T.parent||{raws:{}},F=T.type==="decl"||T.type==="atrule"&&!T.nodes;(!F||T!==B.last||B.raws.semicolon)&&(T.source&&T.source.end?(S.source=v.sourcePath(T),S.original.line=T.source.end.line,S.original.column=T.source.end.column-1,S.generated.line=b,S.generated.column=w-2,v.map.addMapping(S)):(S.source=E,S.original.line=1,S.original.column=0,S.generated.line=b,S.generated.column=w-1,v.map.addMapping(S)))}})},u.isAnnotation=function(){return this.isInline()?!0:typeof this.mapOpts.annotation<"u"?this.mapOpts.annotation:this.previous().length?this.previous().some(function(v){return v.annotation}):!0},u.isInline=function(){if(typeof this.mapOpts.inline<"u")return this.mapOpts.inline;var v=this.mapOpts.annotation;return typeof v<"u"&&v!==!0?!1:this.previous().length?this.previous().some(function(b){return b.inline}):!0},u.isMap=function(){return typeof this.opts.map<"u"?!!this.opts.map:this.previous().length>0},u.isSourcesContent=function(){return typeof this.mapOpts.sourcesContent<"u"?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(function(v){return v.withContent()}):!0},u.outputFile=function(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"},u.path=function(v){if(this.mapOpts.absolute||v.charCodeAt(0)===60||/^\w+:\/\//.test(v))return v;var b=this.memoizedPaths.get(v);if(b)return b;var w=this.opts.to?dirname$2(this.opts.to):".";typeof this.mapOpts.annotation=="string"&&(w=dirname$2(resolve$2(w,this.mapOpts.annotation)));var E=relative$1(w,v);return this.memoizedPaths.set(v,E),E},u.previous=function(){var v=this;if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk(function(w){if(w.source&&w.source.input.map){var E=w.source.input.map;v.previousMaps.includes(E)||v.previousMaps.push(E)}});else{var b=new Input$3$1(this.originalCSS,this.opts);b.map&&this.previousMaps.push(b.map)}return this.previousMaps},u.setSourcesContent=function(){var v=this,b={};if(this.root)this.root.walk(function(E){if(E.source){var S=E.source.input.from;if(S&&!b[S]){b[S]=!0;var A=v.usesFileUrls?v.toFileUrl(S):v.toUrl(v.path(S));v.map.setSourceContent(A,E.source.input.css)}}});else if(this.css){var w=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(w,this.css)}},u.sourcePath=function(v){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(v.source.input.from):this.toUrl(this.path(v.source.input.from))},u.toBase64=function(v){return Buffer?Buffer.from(v).toString("base64"):window.btoa(unescape(encodeURIComponent(v)))},u.toFileUrl=function(v){var b=this.memoizedFileURLs.get(v);if(b)return b;if(pathToFileURL$2){var w=pathToFileURL$2(v).toString();return this.memoizedFileURLs.set(v,w),w}else throw new Error("`map.absolute` option is not available in this PostCSS build")},u.toUrl=function(v){var b=this.memoizedURLs.get(v);if(b)return b;sep$1==="\\"&&(v=v.replace(/\\/g,"/"));var w=encodeURI(v).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(v,w),w},y})(),mapGenerator$1=MapGenerator$2$1,Node$2$1=node$1,Comment$4$1=(function(y){_inherits(u,y);function u(g){var v;return v=y.call(this,g)||this,v.type="comment",v}return u})(Node$2$1),comment$1=Comment$4$1;Comment$4$1.default=Comment$4$1;var isClean$1$1=symbols$1.isClean,my$1$1=symbols$1.my,Declaration$3$1=declaration$1,Comment$3$1=comment$1,Node$1$1=node$1,parse$4$1,Rule$4$1,AtRule$4$1,Root$6$1;function cleanSource$1(y){return y.map(function(u){return u.nodes&&(u.nodes=cleanSource$1(u.nodes)),delete u.source,u})}function markDirtyUp$1(y){if(y[isClean$1$1]=!1,y.proxyOf.nodes)for(var u=_create_for_of_iterator_helper_loose(y.proxyOf.nodes),g;!(g=u()).done;){var v=g.value;markDirtyUp$1(v)}}var Container$7$1=(function(y){_inherits(u,y);function u(){return y.apply(this,arguments)||this}var g=u.prototype;return g.append=function(){for(var b=arguments.length,w=new Array(b),E=0;E<b;E++)w[E]=arguments[E];for(var S=_create_for_of_iterator_helper_loose(w),A;!(A=S()).done;)for(var $=A.value,R=this.normalize($,this.last),T=_create_for_of_iterator_helper_loose(R),O;!(O=T()).done;){var B=O.value;this.proxyOf.nodes.push(B)}return this.markDirty(),this},g.cleanRaws=function(b){if(y.prototype.cleanRaws.call(this,b),this.nodes)for(var w=_create_for_of_iterator_helper_loose(this.nodes),E;!(E=w()).done;){var S=E.value;S.cleanRaws(b)}},g.each=function(b){if(this.proxyOf.nodes){for(var w=this.getIterator(),E,S;this.indexes[w]<this.proxyOf.nodes.length&&(E=this.indexes[w],S=b(this.proxyOf.nodes[E],E),S!==!1);)this.indexes[w]+=1;return delete this.indexes[w],S}},g.every=function(b){return this.nodes.every(b)},g.getIterator=function(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;var b=this.lastEach;return this.indexes[b]=0,b},g.getProxyProcessor=function(){return{get:function(w,E){return E==="proxyOf"?w:w[E]?E==="each"||typeof E=="string"&&E.startsWith("walk")?function(){for(var S=arguments.length,A=new Array(S),$=0;$<S;$++)A[$]=arguments[$];var R;return(R=w)[E].apply(R,[].concat(A.map(function(T){return typeof T=="function"?function(O,B){return T(O.toProxy(),B)}:T})))}:E==="every"||E==="some"?function(S){return w[E](function(A){for(var $=arguments.length,R=new Array($>1?$-1:0),T=1;T<$;T++)R[T-1]=arguments[T];return S.apply(void 0,[].concat([A.toProxy()],R))})}:E==="root"?function(){return w.root().toProxy()}:E==="nodes"?w.nodes.map(function(S){return S.toProxy()}):E==="first"||E==="last"?w[E].toProxy():w[E]:w[E]},set:function(w,E,S){return w[E]===S||(w[E]=S,(E==="name"||E==="params"||E==="selector")&&w.markDirty()),!0}}},g.index=function(b){return typeof b=="number"?b:(b.proxyOf&&(b=b.proxyOf),this.proxyOf.nodes.indexOf(b))},g.insertAfter=function(b,w){var E=this.index(b),S=this.normalize(w,this.proxyOf.nodes[E]).reverse();E=this.index(b);for(var A=_create_for_of_iterator_helper_loose(S),$;!($=A()).done;){var R=$.value;this.proxyOf.nodes.splice(E+1,0,R)}var T;for(var O in this.indexes)T=this.indexes[O],E<T&&(this.indexes[O]=T+S.length);return this.markDirty(),this},g.insertBefore=function(b,w){var E=this.index(b),S=E===0?"prepend":!1,A=this.normalize(w,this.proxyOf.nodes[E],S).reverse();E=this.index(b);for(var $=_create_for_of_iterator_helper_loose(A),R;!(R=$()).done;){var T=R.value;this.proxyOf.nodes.splice(E,0,T)}var O;for(var B in this.indexes)O=this.indexes[B],E<=O&&(this.indexes[B]=O+A.length);return this.markDirty(),this},g.normalize=function(b,w){var E=this;if(typeof b=="string")b=cleanSource$1(parse$4$1(b).nodes);else if(typeof b>"u")b=[];else if(Array.isArray(b)){b=b.slice(0);for(var S=_create_for_of_iterator_helper_loose(b),A;!(A=S()).done;){var $=A.value;$.parent&&$.parent.removeChild($,"ignore")}}else if(b.type==="root"&&this.type!=="document"){b=b.nodes.slice(0);for(var R=_create_for_of_iterator_helper_loose(b),T;!(T=R()).done;){var O=T.value;O.parent&&O.parent.removeChild(O,"ignore")}}else if(b.type)b=[b];else if(b.prop){if(typeof b.value>"u")throw new Error("Value field is missed in node creation");typeof b.value!="string"&&(b.value=String(b.value)),b=[new Declaration$3$1(b)]}else if(b.selector)b=[new Rule$4$1(b)];else if(b.name)b=[new AtRule$4$1(b)];else if(b.text)b=[new Comment$3$1(b)];else throw new Error("Unknown node type in node creation");var B=b.map(function(F){return F[my$1$1]||u.rebuild(F),F=F.proxyOf,F.parent&&F.parent.removeChild(F),F[isClean$1$1]&&markDirtyUp$1(F),typeof F.raws.before>"u"&&w&&typeof w.raws.before<"u"&&(F.raws.before=w.raws.before.replace(/\S/g,"")),F.parent=E.proxyOf,F});return B},g.prepend=function(){for(var b=arguments.length,w=new Array(b),E=0;E<b;E++)w[E]=arguments[E];w=w.reverse();for(var S=_create_for_of_iterator_helper_loose(w),A;!(A=S()).done;){for(var $=A.value,R=this.normalize($,this.first,"prepend").reverse(),T=_create_for_of_iterator_helper_loose(R),O;!(O=T()).done;){var B=O.value;this.proxyOf.nodes.unshift(B)}for(var F in this.indexes)this.indexes[F]=this.indexes[F]+R.length}return this.markDirty(),this},g.push=function(b){return b.parent=this,this.proxyOf.nodes.push(b),this},g.removeAll=function(){for(var b=_create_for_of_iterator_helper_loose(this.proxyOf.nodes),w;!(w=b()).done;){var E=w.value;E.parent=void 0}return this.proxyOf.nodes=[],this.markDirty(),this},g.removeChild=function(b){b=this.index(b),this.proxyOf.nodes[b].parent=void 0,this.proxyOf.nodes.splice(b,1);var w;for(var E in this.indexes)w=this.indexes[E],w>=b&&(this.indexes[E]=w-1);return this.markDirty(),this},g.replaceValues=function(b,w,E){return E||(E=w,w={}),this.walkDecls(function(S){w.props&&!w.props.includes(S.prop)||w.fast&&!S.value.includes(w.fast)||(S.value=S.value.replace(b,E))}),this.markDirty(),this},g.some=function(b){return this.nodes.some(b)},g.walk=function(b){return this.each(function(w,E){var S;try{S=b(w,E)}catch(A){throw w.addToError(A)}return S!==!1&&w.walk&&(S=w.walk(b)),S})},g.walkAtRules=function(b,w){return w?_instanceof(b,RegExp)?this.walk(function(E,S){if(E.type==="atrule"&&b.test(E.name))return w(E,S)}):this.walk(function(E,S){if(E.type==="atrule"&&E.name===b)return w(E,S)}):(w=b,this.walk(function(E,S){if(E.type==="atrule")return w(E,S)}))},g.walkComments=function(b){return this.walk(function(w,E){if(w.type==="comment")return b(w,E)})},g.walkDecls=function(b,w){return w?_instanceof(b,RegExp)?this.walk(function(E,S){if(E.type==="decl"&&b.test(E.prop))return w(E,S)}):this.walk(function(E,S){if(E.type==="decl"&&E.prop===b)return w(E,S)}):(w=b,this.walk(function(E,S){if(E.type==="decl")return w(E,S)}))},g.walkRules=function(b,w){return w?_instanceof(b,RegExp)?this.walk(function(E,S){if(E.type==="rule"&&b.test(E.selector))return w(E,S)}):this.walk(function(E,S){if(E.type==="rule"&&E.selector===b)return w(E,S)}):(w=b,this.walk(function(E,S){if(E.type==="rule")return w(E,S)}))},_create_class(u,[{key:"first",get:function(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}},{key:"last",get:function(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}}]),u})(Node$1$1);Container$7$1.registerParse=function(y){parse$4$1=y};Container$7$1.registerRule=function(y){Rule$4$1=y};Container$7$1.registerAtRule=function(y){AtRule$4$1=y};Container$7$1.registerRoot=function(y){Root$6$1=y};var container$1=Container$7$1;Container$7$1.default=Container$7$1;Container$7$1.rebuild=function(y){y.type==="atrule"?Object.setPrototypeOf(y,AtRule$4$1.prototype):y.type==="rule"?Object.setPrototypeOf(y,Rule$4$1.prototype):y.type==="decl"?Object.setPrototypeOf(y,Declaration$3$1.prototype):y.type==="comment"?Object.setPrototypeOf(y,Comment$3$1.prototype):y.type==="root"&&Object.setPrototypeOf(y,Root$6$1.prototype),y[my$1$1]=!0,y.nodes&&y.nodes.forEach(function(u){Container$7$1.rebuild(u)})};var Container$6$1=container$1,LazyResult$4$1,Processor$3$1,Document$3$1=(function(y){_inherits(u,y);function u(v){var b;return b=y.call(this,_extends({type:"document"},v))||this,b.nodes||(b.nodes=[]),b}var g=u.prototype;return g.toResult=function(b){b===void 0&&(b={});var w=new LazyResult$4$1(new Processor$3$1,this,b);return w.stringify()},u})(Container$6$1);Document$3$1.registerLazyResult=function(y){LazyResult$4$1=y};Document$3$1.registerProcessor=function(y){Processor$3$1=y};var document$1$1=Document$3$1;Document$3$1.default=Document$3$1;var Warning$2$1=(function(){function y(g,v){if(v===void 0&&(v={}),this.type="warning",this.text=g,v.node&&v.node.source){var b=v.node.rangeBy(v);this.line=b.start.line,this.column=b.start.column,this.endLine=b.end.line,this.endColumn=b.end.column}for(var w in v)this[w]=v[w]}var u=y.prototype;return u.toString=function(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text},y})(),warning$1=Warning$2$1;Warning$2$1.default=Warning$2$1;var Warning$1$1=warning$1,Result$3$1=(function(){function y(g,v,b){this.processor=g,this.messages=[],this.root=v,this.opts=b,this.css=void 0,this.map=void 0}var u=y.prototype;return u.toString=function(){return this.css},u.warn=function(v,b){b===void 0&&(b={}),b.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(b.plugin=this.lastPlugin.postcssPlugin);var w=new Warning$1$1(v,b);return this.messages.push(w),w},u.warnings=function(){return this.messages.filter(function(v){return v.type==="warning"})},_create_class(y,[{key:"content",get:function(){return this.css}}]),y})(),result$1=Result$3$1;Result$3$1.default=Result$3$1;var SINGLE_QUOTE$1=39,DOUBLE_QUOTE$1=34,BACKSLASH$1=92,SLASH$1=47,NEWLINE$1=10,SPACE$1=32,FEED$1=12,TAB$1=9,CR$1=13,OPEN_SQUARE$1=91,CLOSE_SQUARE$1=93,OPEN_PARENTHESES$1=40,CLOSE_PARENTHESES$1=41,OPEN_CURLY$1=123,CLOSE_CURLY$1=125,SEMICOLON$1=59,ASTERISK$1=42,COLON$1=58,AT$1=64,RE_AT_END$1=/[\t\n\f\r "#'()/;[\\\]{}]/g,RE_WORD_END$1=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,RE_BAD_BRACKET$1=/.[\r\n"'(/\\]/,RE_HEX_ESCAPE$1=/[\da-f]/i,tokenize$1=function y(u,g){g===void 0&&(g={});var v=u.css.valueOf(),b=g.ignoreErrors,w,E,S,A,$,R,T,O,B,F,U=v.length,q=0,J=[],ie=[];function oe(){return q}function le(we){throw u.error("Unclosed "+we,q)}function de(){return ie.length===0&&q>=U}function fe(we){if(ie.length)return ie.pop();if(!(q>=U)){var pe=we?we.ignoreUnclosed:!1;switch(w=v.charCodeAt(q),w){case NEWLINE$1:case SPACE$1:case TAB$1:case CR$1:case FEED$1:{E=q;do E+=1,w=v.charCodeAt(E);while(w===SPACE$1||w===NEWLINE$1||w===TAB$1||w===CR$1||w===FEED$1);F=["space",v.slice(q,E)],q=E-1;break}case OPEN_SQUARE$1:case CLOSE_SQUARE$1:case OPEN_CURLY$1:case CLOSE_CURLY$1:case COLON$1:case SEMICOLON$1:case CLOSE_PARENTHESES$1:{var ve=String.fromCharCode(w);F=[ve,ve,q];break}case OPEN_PARENTHESES$1:{if(O=J.length?J.pop()[1]:"",B=v.charCodeAt(q+1),O==="url"&&B!==SINGLE_QUOTE$1&&B!==DOUBLE_QUOTE$1&&B!==SPACE$1&&B!==NEWLINE$1&&B!==TAB$1&&B!==FEED$1&&B!==CR$1){E=q;do{if(R=!1,E=v.indexOf(")",E+1),E===-1)if(b||pe){E=q;break}else le("bracket");for(T=E;v.charCodeAt(T-1)===BACKSLASH$1;)T-=1,R=!R}while(R);F=["brackets",v.slice(q,E+1),q,E],q=E}else E=v.indexOf(")",q+1),A=v.slice(q,E+1),E===-1||RE_BAD_BRACKET$1.test(A)?F=["(","(",q]:(F=["brackets",A,q,E],q=E);break}case SINGLE_QUOTE$1:case DOUBLE_QUOTE$1:{S=w===SINGLE_QUOTE$1?"'":'"',E=q;do{if(R=!1,E=v.indexOf(S,E+1),E===-1)if(b||pe){E=q+1;break}else le("string");for(T=E;v.charCodeAt(T-1)===BACKSLASH$1;)T-=1,R=!R}while(R);F=["string",v.slice(q,E+1),q,E],q=E;break}case AT$1:{RE_AT_END$1.lastIndex=q+1,RE_AT_END$1.test(v),RE_AT_END$1.lastIndex===0?E=v.length-1:E=RE_AT_END$1.lastIndex-2,F=["at-word",v.slice(q,E+1),q,E],q=E;break}case BACKSLASH$1:{for(E=q,$=!0;v.charCodeAt(E+1)===BACKSLASH$1;)E+=1,$=!$;if(w=v.charCodeAt(E+1),$&&w!==SLASH$1&&w!==SPACE$1&&w!==NEWLINE$1&&w!==TAB$1&&w!==CR$1&&w!==FEED$1&&(E+=1,RE_HEX_ESCAPE$1.test(v.charAt(E)))){for(;RE_HEX_ESCAPE$1.test(v.charAt(E+1));)E+=1;v.charCodeAt(E+1)===SPACE$1&&(E+=1)}F=["word",v.slice(q,E+1),q,E],q=E;break}default:{w===SLASH$1&&v.charCodeAt(q+1)===ASTERISK$1?(E=v.indexOf("*/",q+2)+1,E===0&&(b||pe?E=v.length:le("comment")),F=["comment",v.slice(q,E+1),q,E],q=E):(RE_WORD_END$1.lastIndex=q+1,RE_WORD_END$1.test(v),RE_WORD_END$1.lastIndex===0?E=v.length-1:E=RE_WORD_END$1.lastIndex-2,F=["word",v.slice(q,E+1),q,E],J.push(F),q=E);break}}return q++,F}}function ye(we){ie.push(we)}return{back:ye,endOfFile:de,nextToken:fe,position:oe}},Container$5$1=container$1,AtRule$3$1=(function(y){_inherits(u,y);function u(v){var b;return b=y.call(this,v)||this,b.type="atrule",b}var g=u.prototype;return g.append=function(){for(var b=arguments.length,w=new Array(b),E=0;E<b;E++)w[E]=arguments[E];var S;return this.proxyOf.nodes||(this.nodes=[]),(S=y.prototype.append).call.apply(S,[].concat([this],w))},g.prepend=function(){for(var b=arguments.length,w=new Array(b),E=0;E<b;E++)w[E]=arguments[E];var S;return this.proxyOf.nodes||(this.nodes=[]),(S=y.prototype.prepend).call.apply(S,[].concat([this],w))},u})(Container$5$1),atRule$1=AtRule$3$1;AtRule$3$1.default=AtRule$3$1;Container$5$1.registerAtRule(AtRule$3$1);var Container$4$1=container$1,LazyResult$3$1,Processor$2$1,Root$5$1=(function(y){_inherits(u,y);function u(v){var b;return b=y.call(this,v)||this,b.type="root",b.nodes||(b.nodes=[]),b}var g=u.prototype;return g.normalize=function(b,w,E){var S=y.prototype.normalize.call(this,b);if(w){if(E==="prepend")this.nodes.length>1?w.raws.before=this.nodes[1].raws.before:delete w.raws.before;else if(this.first!==w)for(var A=_create_for_of_iterator_helper_loose(S),$;!($=A()).done;){var R=$.value;R.raws.before=w.raws.before}}return S},g.removeChild=function(b,w){var E=this.index(b);return!w&&E===0&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[E].raws.before),y.prototype.removeChild.call(this,b)},g.toResult=function(b){b===void 0&&(b={});var w=new LazyResult$3$1(new Processor$2$1,this,b);return w.stringify()},u})(Container$4$1);Root$5$1.registerLazyResult=function(y){LazyResult$3$1=y};Root$5$1.registerProcessor=function(y){Processor$2$1=y};var root$1=Root$5$1;Root$5$1.default=Root$5$1;Container$4$1.registerRoot(Root$5$1);var list$2$1={comma:function y(u){return list$2$1.split(u,[","],!0)},space:function y(u){var g=[" ",`
`,"	"];return list$2$1.split(u,g)},split:function y(u,g,v){for(var b=[],w="",E=!1,S=0,A=!1,$="",R=!1,T=_create_for_of_iterator_helper_loose(u),O;!(O=T()).done;){var B=O.value;R?R=!1:B==="\\"?R=!0:A?B===$&&(A=!1):B==='"'||B==="'"?(A=!0,$=B):B==="("?S+=1:B===")"?S>0&&(S-=1):S===0&&g.includes(B)&&(E=!0),E?(w!==""&&b.push(w.trim()),w="",E=!1):w+=B}return(v||w!=="")&&b.push(w.trim()),b}},list_1$1=list$2$1;list$2$1.default=list$2$1;var Container$3$1=container$1,list$1$1=list_1$1,Rule$3$1=(function(y){_inherits(u,y);function u(g){var v;return v=y.call(this,g)||this,v.type="rule",v.nodes||(v.nodes=[]),v}return _create_class(u,[{key:"selectors",get:function(){return list$1$1.comma(this.selector)},set:function(v){var b=this.selector?this.selector.match(/,\s*/):null,w=b?b[0]:","+this.raw("between","beforeOpen");this.selector=v.join(w)}}]),u})(Container$3$1),rule$1=Rule$3$1;Rule$3$1.default=Rule$3$1;Container$3$1.registerRule(Rule$3$1);var Declaration$2$1=declaration$1,tokenizer2$1=tokenize$1,Comment$2$1=comment$1,AtRule$2$1=atRule$1,Root$4$1=root$1,Rule$2$1=rule$1,SAFE_COMMENT_NEIGHBOR$1={empty:!0,space:!0};function findLastWithPosition$1(y){for(var u=y.length-1;u>=0;u--){var g=y[u],v=g[3]||g[2];if(v)return v}}var Parser$1$1=(function(){function y(g){this.input=g,this.root=new Root$4$1,this.current=this.root,this.spaces="",this.semicolon=!1,this.createTokenizer(),this.root.source={input:g,start:{column:1,line:1,offset:0}}}var u=y.prototype;return u.atrule=function(v){var b=new AtRule$2$1;b.name=v[1].slice(1),b.name===""&&this.unnamedAtrule(b,v),this.init(b,v[2]);for(var w,E,S,A=!1,$=!1,R=[],T=[];!this.tokenizer.endOfFile();){if(v=this.tokenizer.nextToken(),w=v[0],w==="("||w==="["?T.push(w==="("?")":"]"):w==="{"&&T.length>0?T.push("}"):w===T[T.length-1]&&T.pop(),T.length===0)if(w===";"){b.source.end=this.getPosition(v[2]),b.source.end.offset++,this.semicolon=!0;break}else if(w==="{"){$=!0;break}else if(w==="}"){if(R.length>0){for(S=R.length-1,E=R[S];E&&E[0]==="space";)E=R[--S];E&&(b.source.end=this.getPosition(E[3]||E[2]),b.source.end.offset++)}this.end(v);break}else R.push(v);else R.push(v);if(this.tokenizer.endOfFile()){A=!0;break}}b.raws.between=this.spacesAndCommentsFromEnd(R),R.length?(b.raws.afterName=this.spacesAndCommentsFromStart(R),this.raw(b,"params",R),A&&(v=R[R.length-1],b.source.end=this.getPosition(v[3]||v[2]),b.source.end.offset++,this.spaces=b.raws.between,b.raws.between="")):(b.raws.afterName="",b.params=""),$&&(b.nodes=[],this.current=b)},u.checkMissedSemicolon=function(v){var b=this.colon(v);if(b!==!1){for(var w=0,E,S=b-1;S>=0&&(E=v[S],!(E[0]!=="space"&&(w+=1,w===2)));S--);throw this.input.error("Missed semicolon",E[0]==="word"?E[3]+1:E[2])}},u.colon=function(v){for(var b=0,w,E,S,A=_create_for_of_iterator_helper_loose(v.entries()),$;!($=A()).done;){var R=$.value,T=R[0],O=R[1];if(w=O,E=w[0],E==="("&&(b+=1),E===")"&&(b-=1),b===0&&E===":")if(!S)this.doubleColon(w);else{if(S[0]==="word"&&S[1]==="progid")continue;return T}S=w}return!1},u.comment=function(v){var b=new Comment$2$1;this.init(b,v[2]),b.source.end=this.getPosition(v[3]||v[2]),b.source.end.offset++;var w=v[1].slice(2,-2);if(/^\s*$/.test(w))b.text="",b.raws.left=w,b.raws.right="";else{var E=w.match(/^(\s*)([^]*\S)(\s*)$/);b.text=E[2],b.raws.left=E[1],b.raws.right=E[3]}},u.createTokenizer=function(){this.tokenizer=tokenizer2$1(this.input)},u.decl=function(v,b){var w=new Declaration$2$1;this.init(w,v[0][2]);var E=v[v.length-1];for(E[0]===";"&&(this.semicolon=!0,v.pop()),w.source.end=this.getPosition(E[3]||E[2]||findLastWithPosition$1(v)),w.source.end.offset++;v[0][0]!=="word";)v.length===1&&this.unknownWord(v),w.raws.before+=v.shift()[1];for(w.source.start=this.getPosition(v[0][2]),w.prop="";v.length;){var S=v[0][0];if(S===":"||S==="space"||S==="comment")break;w.prop+=v.shift()[1]}w.raws.between="";for(var A;v.length;)if(A=v.shift(),A[0]===":"){w.raws.between+=A[1];break}else A[0]==="word"&&/\w/.test(A[1])&&this.unknownWord([A]),w.raws.between+=A[1];(w.prop[0]==="_"||w.prop[0]==="*")&&(w.raws.before+=w.prop[0],w.prop=w.prop.slice(1));for(var $=[],R;v.length&&(R=v[0][0],!(R!=="space"&&R!=="comment"));)$.push(v.shift());this.precheckMissedSemicolon(v);for(var T=v.length-1;T>=0;T--){if(A=v[T],A[1].toLowerCase()==="!important"){w.important=!0;var O=this.stringFrom(v,T);O=this.spacesFromEnd(v)+O,O!==" !important"&&(w.raws.important=O);break}else if(A[1].toLowerCase()==="important"){for(var B=v.slice(0),F="",U=T;U>0;U--){var q=B[U][0];if(F.trim().indexOf("!")===0&&q!=="space")break;F=B.pop()[1]+F}F.trim().indexOf("!")===0&&(w.important=!0,w.raws.important=F,v=B)}if(A[0]!=="space"&&A[0]!=="comment")break}var J=v.some(function(ie){return ie[0]!=="space"&&ie[0]!=="comment"});J&&(w.raws.between+=$.map(function(ie){return ie[1]}).join(""),$=[]),this.raw(w,"value",$.concat(v),b),w.value.includes(":")&&!b&&this.checkMissedSemicolon(v)},u.doubleColon=function(v){throw this.input.error("Double colon",{offset:v[2]},{offset:v[2]+v[1].length})},u.emptyRule=function(v){var b=new Rule$2$1;this.init(b,v[2]),b.selector="",b.raws.between="",this.current=b},u.end=function(v){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(v[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(v)},u.endFile=function(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())},u.freeSemicolon=function(v){if(this.spaces+=v[1],this.current.nodes){var b=this.current.nodes[this.current.nodes.length-1];b&&b.type==="rule"&&!b.raws.ownSemicolon&&(b.raws.ownSemicolon=this.spaces,this.spaces="")}},u.getPosition=function(v){var b=this.input.fromOffset(v);return{column:b.col,line:b.line,offset:v}},u.init=function(v,b){this.current.push(v),v.source={input:this.input,start:this.getPosition(b)},v.raws.before=this.spaces,this.spaces="",v.type!=="comment"&&(this.semicolon=!1)},u.other=function(v){for(var b=!1,w=null,E=!1,S=null,A=[],$=v[1].startsWith("--"),R=[],T=v;T;){if(w=T[0],R.push(T),w==="("||w==="[")S||(S=T),A.push(w==="("?")":"]");else if($&&E&&w==="{")S||(S=T),A.push("}");else if(A.length===0)if(w===";")if(E){this.decl(R,$);return}else break;else if(w==="{"){this.rule(R);return}else if(w==="}"){this.tokenizer.back(R.pop()),b=!0;break}else w===":"&&(E=!0);else w===A[A.length-1]&&(A.pop(),A.length===0&&(S=null));T=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(b=!0),A.length>0&&this.unclosedBracket(S),b&&E){if(!$)for(;R.length&&(T=R[R.length-1][0],!(T!=="space"&&T!=="comment"));)this.tokenizer.back(R.pop());this.decl(R,$)}else this.unknownWord(R)},u.parse=function(){for(var v;!this.tokenizer.endOfFile();)switch(v=this.tokenizer.nextToken(),v[0]){case"space":this.spaces+=v[1];break;case";":this.freeSemicolon(v);break;case"}":this.end(v);break;case"comment":this.comment(v);break;case"at-word":this.atrule(v);break;case"{":this.emptyRule(v);break;default:this.other(v);break}this.endFile()},u.precheckMissedSemicolon=function(){},u.raw=function(v,b,w,E){for(var S,A,$=w.length,R="",T=!0,O,B,F=0;F<$;F+=1)S=w[F],A=S[0],A==="space"&&F===$-1&&!E?T=!1:A==="comment"?(B=w[F-1]?w[F-1][0]:"empty",O=w[F+1]?w[F+1][0]:"empty",!SAFE_COMMENT_NEIGHBOR$1[B]&&!SAFE_COMMENT_NEIGHBOR$1[O]?R.slice(-1)===","?T=!1:R+=S[1]:T=!1):R+=S[1];if(!T){var U=w.reduce(function(q,J){return q+J[1]},"");v.raws[b]={raw:U,value:R}}v[b]=R},u.rule=function(v){v.pop();var b=new Rule$2$1;this.init(b,v[0][2]),b.raws.between=this.spacesAndCommentsFromEnd(v),this.raw(b,"selector",v),this.current=b},u.spacesAndCommentsFromEnd=function(v){for(var b,w="";v.length&&(b=v[v.length-1][0],!(b!=="space"&&b!=="comment"));)w=v.pop()[1]+w;return w},u.spacesAndCommentsFromStart=function(v){for(var b,w="";v.length&&(b=v[0][0],!(b!=="space"&&b!=="comment"));)w+=v.shift()[1];return w},u.spacesFromEnd=function(v){for(var b,w="";v.length&&(b=v[v.length-1][0],b==="space");)w=v.pop()[1]+w;return w},u.stringFrom=function(v,b){for(var w="",E=b;E<v.length;E++)w+=v[E][1];return v.splice(b,v.length-b),w},u.unclosedBlock=function(){var v=this.current.source.start;throw this.input.error("Unclosed block",v.line,v.column)},u.unclosedBracket=function(v){throw this.input.error("Unclosed bracket",{offset:v[2]},{offset:v[2]+1})},u.unexpectedClose=function(v){throw this.input.error("Unexpected }",{offset:v[2]},{offset:v[2]+1})},u.unknownWord=function(v){throw this.input.error("Unknown word",{offset:v[0][2]},{offset:v[0][2]+v[0][1].length})},u.unnamedAtrule=function(v,b){throw this.input.error("At-rule without name",{offset:b[2]},{offset:b[2]+b[1].length})},y})(),parser$1=Parser$1$1,Container$2$1=container$1,Parser2$1=parser$1,Input$2$1=input$1;function parse$3$1(y,u){var g=new Input$2$1(y,u),v=new Parser2$1(g);try{v.parse()}catch(b){throw b}return v.root}var parse_1$1=parse$3$1;parse$3$1.default=parse$3$1;Container$2$1.registerParse(parse$3$1);var isClean$3=symbols$1.isClean,my$3=symbols$1.my,MapGenerator$1$1=mapGenerator$1,stringify$2$1=stringify_1$1,Container$1$1=container$1,Document$2$1=document$1$1,Result$2$1=result$1,parse$2$1=parse_1$1,Root$3$1=root$1,TYPE_TO_CLASS_NAME$1={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},PLUGIN_PROPS$1={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},NOT_VISITORS$1={Once:!0,postcssPlugin:!0,prepare:!0},CHILDREN$1=0;function isPromise$1(y){return(typeof y>"u"?"undefined":_type_of(y))==="object"&&typeof y.then=="function"}function getEvents$1(y){var u=!1,g=TYPE_TO_CLASS_NAME$1[y.type];return y.type==="decl"?u=y.prop.toLowerCase():y.type==="atrule"&&(u=y.name.toLowerCase()),u&&y.append?[g,g+"-"+u,CHILDREN$1,g+"Exit",g+"Exit-"+u]:u?[g,g+"-"+u,g+"Exit",g+"Exit-"+u]:y.append?[g,CHILDREN$1,g+"Exit"]:[g,g+"Exit"]}function toStack$1(y){var u;return y.type==="document"?u=["Document",CHILDREN$1,"DocumentExit"]:y.type==="root"?u=["Root",CHILDREN$1,"RootExit"]:u=getEvents$1(y),{eventIndex:0,events:u,iterator:0,node:y,visitorIndex:0,visitors:[]}}function cleanMarks$1(y){return y[isClean$3]=!1,y.nodes&&y.nodes.forEach(function(u){return cleanMarks$1(u)}),y}var postcss$2$1={},LazyResult$2$1=(function(){function y(g,v,b){var w=this;this.stringified=!1,this.processed=!1;var E;if((typeof v>"u"?"undefined":_type_of(v))==="object"&&v!==null&&(v.type==="root"||v.type==="document"))E=cleanMarks$1(v);else if(_instanceof(v,y)||_instanceof(v,Result$2$1))E=cleanMarks$1(v.root),v.map&&(typeof b.map>"u"&&(b.map={}),b.map.inline||(b.map.inline=!1),b.map.prev=v.map);else{var S=parse$2$1;b.syntax&&(S=b.syntax.parse),b.parser&&(S=b.parser),S.parse&&(S=S.parse);try{E=S(v,b)}catch(A){this.processed=!0,this.error=A}E&&!E[my$3]&&Container$1$1.rebuild(E)}this.result=new Result$2$1(g,E,b),this.helpers=_extends({},postcss$2$1,{postcss:postcss$2$1,result:this.result}),this.plugins=this.processor.plugins.map(function(A){return(typeof A>"u"?"undefined":_type_of(A))==="object"&&A.prepare?_extends({},A,A.prepare(w.result)):A})}var u=y.prototype;return u.async=function(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)},u.catch=function(v){return this.async().catch(v)},u.finally=function(v){return this.async().then(v,v)},u.getAsyncError=function(){throw new Error("Use process(css).then(cb) to work with async plugins")},u.handleError=function(v,b){var w=this.result.lastPlugin;try{if(b&&b.addToError(v),this.error=v,v.name==="CssSyntaxError"&&!v.plugin)v.plugin=w.postcssPlugin,v.setMessage();else if(w.postcssVersion)var E,S,A,$,R}catch(T){console&&console.error&&console.error(T)}return v},u.prepareVisitors=function(){var v=this;this.listeners={};for(var b=function(R,T,O){v.listeners[T]||(v.listeners[T]=[]),v.listeners[T].push([R,O])},w=_create_for_of_iterator_helper_loose(this.plugins),E;!(E=w()).done;){var S=E.value;if((typeof S>"u"?"undefined":_type_of(S))==="object")for(var A in S){if(!PLUGIN_PROPS$1[A]&&/^[A-Z]/.test(A))throw new Error("Unknown event "+A+" in "+S.postcssPlugin+". Try to update PostCSS ("+this.processor.version+" now).");if(!NOT_VISITORS$1[A])if(_type_of(S[A])==="object")for(var $ in S[A])$==="*"?b(S,A,S[A][$]):b(S,A+"-"+$.toLowerCase(),S[A][$]);else typeof S[A]=="function"&&b(S,A,S[A])}}this.hasListener=Object.keys(this.listeners).length>0},u.runAsync=function(){var v=this;return _async_to_generator(function(){var b,w,E,S,A,$,R,T,O,B,F,U;return _ts_generator(this,function(q){switch(q.label){case 0:v.plugin=0,b=0,q.label=1;case 1:if(!(b<v.plugins.length))return[3,6];if(w=v.plugins[b],E=v.runOnRoot(w),!isPromise$1(E))return[3,5];q.label=2;case 2:return q.trys.push([2,4,,5]),[4,E];case 3:return q.sent(),[3,5];case 4:throw S=q.sent(),v.handleError(S);case 5:return b++,[3,1];case 6:if(v.prepareVisitors(),!v.hasListener)return[3,18];A=v.result.root,q.label=7;case 7:if(A[isClean$3])return[3,14];A[isClean$3]=!0,$=[toStack$1(A)],q.label=8;case 8:if(!($.length>0))return[3,13];if(R=v.visitTick($),!isPromise$1(R))return[3,12];q.label=9;case 9:return q.trys.push([9,11,,12]),[4,R];case 10:return q.sent(),[3,12];case 11:throw T=q.sent(),O=$[$.length-1].node,v.handleError(T,O);case 12:return[3,8];case 13:return[3,7];case 14:if(!v.listeners.OnceExit)return[3,18];B=function(){var J,ie,oe,le,de;return _ts_generator(this,function(fe){switch(fe.label){case 0:J=U.value,ie=J[0],oe=J[1],v.result.lastPlugin=ie,fe.label=1;case 1:return fe.trys.push([1,6,,7]),A.type!=="document"?[3,3]:(le=A.nodes.map(function(ye){return oe(ye,v.helpers)}),[4,Promise.all(le)]);case 2:return fe.sent(),[3,5];case 3:return[4,oe(A,v.helpers)];case 4:fe.sent(),fe.label=5;case 5:return[3,7];case 6:throw de=fe.sent(),v.handleError(de);case 7:return[2]}})},F=_create_for_of_iterator_helper_loose(v.listeners.OnceExit),q.label=15;case 15:return(U=F()).done?[3,18]:[5,_ts_values(B())];case 16:q.sent(),q.label=17;case 17:return[3,15];case 18:return v.processed=!0,[2,v.stringify()]}})})()},u.runOnRoot=function(v){var b=this;this.result.lastPlugin=v;try{if((typeof v>"u"?"undefined":_type_of(v))==="object"&&v.Once){if(this.result.root.type==="document"){var w=this.result.root.nodes.map(function(E){return v.Once(E,b.helpers)});return isPromise$1(w[0])?Promise.all(w):w}return v.Once(this.result.root,this.helpers)}else if(typeof v=="function")return v(this.result.root,this.result)}catch(E){throw this.handleError(E)}},u.stringify=function(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();var v=this.result.opts,b=stringify$2$1;v.syntax&&(b=v.syntax.stringify),v.stringifier&&(b=v.stringifier),b.stringify&&(b=b.stringify);var w=new MapGenerator$1$1(b,this.result.root,this.result.opts),E=w.generate();return this.result.css=E[0],this.result.map=E[1],this.result},u.sync=function(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(var v=_create_for_of_iterator_helper_loose(this.plugins),b;!(b=v()).done;){var w=b.value,E=this.runOnRoot(w);if(isPromise$1(E))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){for(var S=this.result.root;!S[isClean$3];)S[isClean$3]=!0,this.walkSync(S);if(this.listeners.OnceExit)if(S.type==="document")for(var A=_create_for_of_iterator_helper_loose(S.nodes),$;!($=A()).done;){var R=$.value;this.visitSync(this.listeners.OnceExit,R)}else this.visitSync(this.listeners.OnceExit,S)}return this.result},u.then=function(v,b){return this.async().then(v,b)},u.toString=function(){return this.css},u.visitSync=function(v,b){for(var w=_create_for_of_iterator_helper_loose(v),E;!(E=w()).done;){var S=E.value,A=S[0],$=S[1];this.result.lastPlugin=A;var R=void 0;try{R=$(b,this.helpers)}catch(T){throw this.handleError(T,b.proxyOf)}if(b.type!=="root"&&b.type!=="document"&&!b.parent)return!0;if(isPromise$1(R))throw this.getAsyncError()}},u.visitTick=function(v){var b=v[v.length-1],w=b.node,E=b.visitors;if(w.type!=="root"&&w.type!=="document"&&!w.parent){v.pop();return}if(E.length>0&&b.visitorIndex<E.length){var S=E[b.visitorIndex],A=S[0],$=S[1];b.visitorIndex+=1,b.visitorIndex===E.length&&(b.visitors=[],b.visitorIndex=0),this.result.lastPlugin=A;try{return $(w.toProxy(),this.helpers)}catch(F){throw this.handleError(F,w)}}if(b.iterator!==0){for(var R=b.iterator,T;T=w.nodes[w.indexes[R]];)if(w.indexes[R]+=1,!T[isClean$3]){T[isClean$3]=!0,v.push(toStack$1(T));return}b.iterator=0,delete w.indexes[R]}for(var O=b.events;b.eventIndex<O.length;){var B=O[b.eventIndex];if(b.eventIndex+=1,B===CHILDREN$1){w.nodes&&w.nodes.length&&(w[isClean$3]=!0,b.iterator=w.getIterator());return}else if(this.listeners[B]){b.visitors=this.listeners[B];return}}v.pop()},u.walkSync=function(v){var b=this;v[isClean$3]=!0;for(var w=getEvents$1(v),E=_create_for_of_iterator_helper_loose(w),S;!(S=E()).done;){var A=S.value;if(A===CHILDREN$1)v.nodes&&v.each(function(R){R[isClean$3]||b.walkSync(R)});else{var $=this.listeners[A];if($&&this.visitSync($,v.toProxy()))return}}},u.warnings=function(){return this.sync().warnings()},_create_class(y,[{key:"content",get:function(){return this.stringify().content}},{key:"css",get:function(){return this.stringify().css}},{key:"map",get:function(){return this.stringify().map}},{key:"messages",get:function(){return this.sync().messages}},{key:"opts",get:function(){return this.result.opts}},{key:"processor",get:function(){return this.result.processor}},{key:"root",get:function(){return this.sync().root}},{key:Symbol.toStringTag,get:function(){return"LazyResult"}}]),y})();LazyResult$2$1.registerPostcss=function(y){postcss$2$1=y};var lazyResult$1=LazyResult$2$1;LazyResult$2$1.default=LazyResult$2$1;Root$3$1.registerLazyResult(LazyResult$2$1);Document$2$1.registerLazyResult(LazyResult$2$1);var MapGenerator2$1=mapGenerator$1,stringify$1$1=stringify_1$1,parse$1$1=parse_1$1,Result$1$1=result$1,NoWorkResult$1$1=(function(){function y(g,v,b){v=v.toString(),this.stringified=!1,this._processor=g,this._css=v,this._opts=b,this._map=void 0;var w,E=stringify$1$1;this.result=new Result$1$1(this._processor,w,this._opts),this.result.css=v;var S=this;Object.defineProperty(this.result,"root",{get:function(){return S.root}});var A=new MapGenerator2$1(E,w,this._opts,v);if(A.isMap()){var $=A.generate(),R=$[0],T=$[1];R&&(this.result.css=R),T&&(this.result.map=T)}else A.clearAnnotation(),this.result.css=A.css}var u=y.prototype;return u.async=function(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)},u.catch=function(v){return this.async().catch(v)},u.finally=function(v){return this.async().then(v,v)},u.sync=function(){if(this.error)throw this.error;return this.result},u.then=function(v,b){return this.async().then(v,b)},u.toString=function(){return this._css},u.warnings=function(){return[]},_create_class(y,[{key:"content",get:function(){return this.result.css}},{key:"css",get:function(){return this.result.css}},{key:"map",get:function(){return this.result.map}},{key:"messages",get:function(){return[]}},{key:"opts",get:function(){return this.result.opts}},{key:"processor",get:function(){return this.result.processor}},{key:"root",get:function(){if(this._root)return this._root;var v,b=parse$1$1;try{v=b(this._css,this._opts)}catch(w){this.error=w}if(this.error)throw this.error;return this._root=v,v}},{key:Symbol.toStringTag,get:function(){return"NoWorkResult"}}]),y})(),noWorkResult$1=NoWorkResult$1$1;NoWorkResult$1$1.default=NoWorkResult$1$1;var NoWorkResult2$1=noWorkResult$1,LazyResult$1$1=lazyResult$1,Document$1$1=document$1$1,Root$2$1=root$1,Processor$1$1=(function(){function y(g){g===void 0&&(g=[]),this.version="8.4.38",this.plugins=this.normalize(g)}var u=y.prototype;return u.normalize=function(v){for(var b=[],w=_create_for_of_iterator_helper_loose(v),E;!(E=w()).done;){var S=E.value;if(S.postcss===!0?S=S():S.postcss&&(S=S.postcss),(typeof S>"u"?"undefined":_type_of(S))==="object"&&Array.isArray(S.plugins))b=b.concat(S.plugins);else if((typeof S>"u"?"undefined":_type_of(S))==="object"&&S.postcssPlugin)b.push(S);else if(typeof S=="function")b.push(S);else if(!((typeof S>"u"?"undefined":_type_of(S))==="object"&&(S.parse||S.stringify)))throw new Error(S+" is not a PostCSS plugin")}return b},u.process=function(v,b){return b===void 0&&(b={}),!this.plugins.length&&!b.parser&&!b.stringifier&&!b.syntax?new NoWorkResult2$1(this,v,b):new LazyResult$1$1(this,v,b)},u.use=function(v){return this.plugins=this.plugins.concat(this.normalize([v])),this},y})(),processor$1=Processor$1$1;Processor$1$1.default=Processor$1$1;Root$2$1.registerProcessor(Processor$1$1);Document$1$1.registerProcessor(Processor$1$1);var Declaration$1$1=declaration$1,PreviousMap2$1=previousMap$1,Comment$1$1=comment$1,AtRule$1$1=atRule$1,Input$1$1=input$1,Root$1$1=root$1,Rule$1$1=rule$1;function fromJSON$1$1(y,u){if(Array.isArray(y))return y.map(function(T){return fromJSON$1$1(T)});var g=y.inputs,v=_object_without_properties_loose(y,["inputs"]);if(g){u=[];for(var b=_create_for_of_iterator_helper_loose(g),w;!(w=b()).done;){var E=w.value,S=_extends({},E,{__proto__:Input$1$1.prototype});S.map&&(S.map=_extends({},S.map,{__proto__:PreviousMap2$1.prototype})),u.push(S)}}if(v.nodes&&(v.nodes=y.nodes.map(function(T){return fromJSON$1$1(T,u)})),v.source){var A=v.source,$=A.inputId,R=_object_without_properties_loose(A,["inputId"]);v.source=R,$!=null&&(v.source.input=u[$])}if(v.type==="root")return new Root$1$1(v);if(v.type==="decl")return new Declaration$1$1(v);if(v.type==="rule")return new Rule$1$1(v);if(v.type==="comment")return new Comment$1$1(v);if(v.type==="atrule")return new AtRule$1$1(v);throw new Error("Unknown node type: "+y.type)}var fromJSON_1$1=fromJSON$1$1;fromJSON$1$1.default=fromJSON$1$1;var CssSyntaxError2$1=cssSyntaxError$1,Declaration2$1=declaration$1,LazyResult2$1=lazyResult$1,Container2$1=container$1,Processor2$1=processor$1,stringify$5=stringify_1$1,fromJSON$2=fromJSON_1$1,Document22=document$1$1,Warning2$1=warning$1,Comment2$1=comment$1,AtRule2$1=atRule$1,Result2$1=result$1,Input2$1=input$1,parse$5=parse_1$1,list$3=list_1$1,Rule2$1=rule$1,Root2$1=root$1,Node2$1=node$1;function postcss$3(){for(var y=arguments.length,u=new Array(y),g=0;g<y;g++)u[g]=arguments[g];return u.length===1&&Array.isArray(u[0])&&(u=u[0]),new Processor2$1(u)}postcss$3.plugin=function y(u,g){var v=!1;function b(){for(var E=arguments.length,S=new Array(E),A=0;A<E;A++)S[A]=arguments[A];console&&console.warn&&!v&&(v=!0,console.warn(u+`: postcss.plugin was deprecated. Migration guide:
https://evilmartians.com/chronicles/postcss-8-plugin-migration`),define_process_env_default.LANG&&define_process_env_default.LANG.startsWith("cn")&&console.warn(u+`:  postcss.plugin . :
https://www.w3ctech.com/topic/2226`));var $=g.apply(void 0,[].concat(S));return $.postcssPlugin=u,$.postcssVersion=new Processor2$1().version,$}var w;return Object.defineProperty(b,"postcss",{get:function(){return w||(w=b()),w}}),b.process=function(E,S,A){return postcss$3([b(A)]).process(E,S)},b};postcss$3.stringify=stringify$5;postcss$3.parse=parse$5;postcss$3.fromJSON=fromJSON$2;postcss$3.list=list$3;postcss$3.comment=function(y){return new Comment2$1(y)};postcss$3.atRule=function(y){return new AtRule2$1(y)};postcss$3.decl=function(y){return new Declaration2$1(y)};postcss$3.rule=function(y){return new Rule2$1(y)};postcss$3.root=function(y){return new Root2$1(y)};postcss$3.document=function(y){return new Document22(y)};postcss$3.CssSyntaxError=CssSyntaxError2$1;postcss$3.Declaration=Declaration2$1;postcss$3.Container=Container2$1;postcss$3.Processor=Processor2$1;postcss$3.Document=Document22;postcss$3.Comment=Comment2$1;postcss$3.Warning=Warning2$1;postcss$3.AtRule=AtRule2$1;postcss$3.Result=Result2$1;postcss$3.Input=Input2$1;postcss$3.Rule=Rule2$1;postcss$3.Root=Root2$1;postcss$3.Node=Node2$1;LazyResult2$1.registerPostcss(postcss$3);var postcss_1$1=postcss$3;postcss$3.default=postcss$3;var postcss$1$1=getDefaultExportFromCjs$1(postcss_1$1);postcss$1$1.stringify;postcss$1$1.fromJSON;postcss$1$1.plugin;postcss$1$1.parse;postcss$1$1.list;postcss$1$1.document;postcss$1$1.comment;postcss$1$1.atRule;postcss$1$1.rule;postcss$1$1.decl;postcss$1$1.root;postcss$1$1.CssSyntaxError;postcss$1$1.Declaration;postcss$1$1.Container;postcss$1$1.Processor;postcss$1$1.Document;postcss$1$1.Comment;postcss$1$1.Warning;postcss$1$1.AtRule;postcss$1$1.Result;postcss$1$1.Input;postcss$1$1.Rule;postcss$1$1.Root;postcss$1$1.Node;var __defProp2=Object.defineProperty,__defNormalProp2=function(y,u,g){return u in y?__defProp2(y,u,{enumerable:!0,configurable:!0,writable:!0,value:g}):y[u]=g},__publicField2=function(y,u,g){return __defNormalProp2(y,(typeof u>"u"?"undefined":_type_of(u))!=="symbol"?u+"":u,g)};function getDefaultExportFromCjs(y){return y&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y}function getAugmentedNamespace(y){if(y.__esModule)return y;var u=y.default;if(typeof u=="function"){var g=function v(){return _instanceof(this,v)?Reflect.construct(u,arguments,this.constructor):u.apply(this,arguments)};g.prototype=u.prototype}else g={};return Object.defineProperty(g,"__esModule",{value:!0}),Object.keys(y).forEach(function(v){var b=Object.getOwnPropertyDescriptor(y,v);Object.defineProperty(g,v,b.get?b:{enumerable:!0,get:function(){return y[v]}})}),g}var picocolors_browser={exports:{}},x=String,create=function y(){return{isColorSupported:!1,reset:x,bold:x,dim:x,italic:x,underline:x,inverse:x,hidden:x,strikethrough:x,black:x,red:x,green:x,yellow:x,blue:x,magenta:x,cyan:x,white:x,gray:x,bgBlack:x,bgRed:x,bgGreen:x,bgYellow:x,bgBlue:x,bgMagenta:x,bgCyan:x,bgWhite:x}};picocolors_browser.exports=create();picocolors_browser.exports.createColors=create;var picocolors_browserExports=picocolors_browser.exports,__viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$2=getAugmentedNamespace(__viteBrowserExternal$1),pico=picocolors_browserExports,terminalHighlight$1=require$$2,CssSyntaxError$3=(function(y){_inherits(u,y);function u(v,b,w,E,S,A){var $;return $=y.call(this,v)||this,$.name="CssSyntaxError",$.reason=v,S&&($.file=S),E&&($.source=E),A&&($.plugin=A),typeof b<"u"&&typeof w<"u"&&(typeof b=="number"?($.line=b,$.column=w):($.line=b.line,$.column=b.column,$.endLine=w.line,$.endColumn=w.column)),$.setMessage(),Error.captureStackTrace&&Error.captureStackTrace($,u),$}var g=u.prototype;return g.setMessage=function(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",typeof this.line<"u"&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason},g.showSourceCode=function(b){var w=this;if(!this.source)return"";var E=this.source;b==null&&(b=pico.isColorSupported),terminalHighlight$1&&b&&(E=terminalHighlight$1(E));var S=E.split(/\r?\n/),A=Math.max(this.line-3,0),$=Math.min(this.line+2,S.length),R=String($).length,T,O;if(b){var B=pico.createColors(!0),F=B.bold,U=B.gray,q=B.red;T=function(J){return F(q(J))},O=function(J){return U(J)}}else T=O=function(J){return J};return S.slice(A,$).map(function(J,ie){var oe=A+1+ie,le=" "+(" "+oe).slice(-R)+" | ";if(oe===w.line){var de=O(le.replace(/\d/g," "))+J.slice(0,w.column-1).replace(/[^\t]/g," ");return T(">")+O(le)+J+`
 `+de+T("^")}return" "+O(le)+J}).join(`
`)},g.toString=function(){var b=this.showSourceCode();return b&&(b=`

`+b+`
`),this.name+": "+this.message+b},u})(_wrap_native_super(Error)),cssSyntaxError=CssSyntaxError$3;CssSyntaxError$3.default=CssSyntaxError$3;var symbols={};symbols.isClean=Symbol("isClean");symbols.my=Symbol("my");var DEFAULT_RAW={after:`
`,beforeClose:`
`,beforeComment:`
`,beforeDecl:`
`,beforeOpen:" ",beforeRule:`
`,colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};function capitalize(y){return y[0].toUpperCase()+y.slice(1)}var Stringifier$2=(function(){function y(g){this.builder=g}var u=y.prototype;return u.atrule=function(v,b){var w="@"+v.name,E=v.params?this.rawValue(v,"params"):"";if(typeof v.raws.afterName<"u"?w+=v.raws.afterName:E&&(w+=" "),v.nodes)this.block(v,w+E);else{var S=(v.raws.between||"")+(b?";":"");this.builder(w+E+S,v)}},u.beforeAfter=function(v,b){var w;v.type==="decl"?w=this.raw(v,null,"beforeDecl"):v.type==="comment"?w=this.raw(v,null,"beforeComment"):b==="before"?w=this.raw(v,null,"beforeRule"):w=this.raw(v,null,"beforeClose");for(var E=v.parent,S=0;E&&E.type!=="root";)S+=1,E=E.parent;if(w.includes(`
`)){var A=this.raw(v,null,"indent");if(A.length)for(var $=0;$<S;$++)w+=A}return w},u.block=function(v,b){var w=this.raw(v,"between","beforeOpen");this.builder(b+w+"{",v,"start");var E;v.nodes&&v.nodes.length?(this.body(v),E=this.raw(v,"after")):E=this.raw(v,"after","emptyBody"),E&&this.builder(E),this.builder("}",v,"end")},u.body=function(v){for(var b=v.nodes.length-1;b>0&&v.nodes[b].type==="comment";)b-=1;for(var w=this.raw(v,"semicolon"),E=0;E<v.nodes.length;E++){var S=v.nodes[E],A=this.raw(S,"before");A&&this.builder(A),this.stringify(S,b!==E||w)}},u.comment=function(v){var b=this.raw(v,"left","commentLeft"),w=this.raw(v,"right","commentRight");this.builder("/*"+b+v.text+w+"*/",v)},u.decl=function(v,b){var w=this.raw(v,"between","colon"),E=v.prop+w+this.rawValue(v,"value");v.important&&(E+=v.raws.important||" !important"),b&&(E+=";"),this.builder(E,v)},u.document=function(v){this.body(v)},u.raw=function(v,b,w){var E;if(w||(w=b),b&&(E=v.raws[b],typeof E<"u"))return E;var S=v.parent;if(w==="before"&&(!S||S.type==="root"&&S.first===v||S&&S.type==="document"))return"";if(!S)return DEFAULT_RAW[w];var A=v.root();if(A.rawCache||(A.rawCache={}),typeof A.rawCache[w]<"u")return A.rawCache[w];if(w==="before"||w==="after")return this.beforeAfter(v,w);var $="raw"+capitalize(w);return this[$]?E=this[$](A,v):A.walk(function(R){if(E=R.raws[b],typeof E<"u")return!1}),typeof E>"u"&&(E=DEFAULT_RAW[w]),A.rawCache[w]=E,E},u.rawBeforeClose=function(v){var b;return v.walk(function(w){if(w.nodes&&w.nodes.length>0&&typeof w.raws.after<"u")return b=w.raws.after,b.includes(`
`)&&(b=b.replace(/[^\n]+$/,"")),!1}),b&&(b=b.replace(/\S/g,"")),b},u.rawBeforeComment=function(v,b){var w;return v.walkComments(function(E){if(typeof E.raws.before<"u")return w=E.raws.before,w.includes(`
`)&&(w=w.replace(/[^\n]+$/,"")),!1}),typeof w>"u"?w=this.raw(b,null,"beforeDecl"):w&&(w=w.replace(/\S/g,"")),w},u.rawBeforeDecl=function(v,b){var w;return v.walkDecls(function(E){if(typeof E.raws.before<"u")return w=E.raws.before,w.includes(`
`)&&(w=w.replace(/[^\n]+$/,"")),!1}),typeof w>"u"?w=this.raw(b,null,"beforeRule"):w&&(w=w.replace(/\S/g,"")),w},u.rawBeforeOpen=function(v){var b;return v.walk(function(w){if(w.type!=="decl"&&(b=w.raws.between,typeof b<"u"))return!1}),b},u.rawBeforeRule=function(v){var b;return v.walk(function(w){if(w.nodes&&(w.parent!==v||v.first!==w)&&typeof w.raws.before<"u")return b=w.raws.before,b.includes(`
`)&&(b=b.replace(/[^\n]+$/,"")),!1}),b&&(b=b.replace(/\S/g,"")),b},u.rawColon=function(v){var b;return v.walkDecls(function(w){if(typeof w.raws.between<"u")return b=w.raws.between.replace(/[^\s:]/g,""),!1}),b},u.rawEmptyBody=function(v){var b;return v.walk(function(w){if(w.nodes&&w.nodes.length===0&&(b=w.raws.after,typeof b<"u"))return!1}),b},u.rawIndent=function(v){if(v.raws.indent)return v.raws.indent;var b;return v.walk(function(w){var E=w.parent;if(E&&E!==v&&E.parent&&E.parent===v&&typeof w.raws.before<"u"){var S=w.raws.before.split(`
`);return b=S[S.length-1],b=b.replace(/\S/g,""),!1}}),b},u.rawSemicolon=function(v){var b;return v.walk(function(w){if(w.nodes&&w.nodes.length&&w.last.type==="decl"&&(b=w.raws.semicolon,typeof b<"u"))return!1}),b},u.rawValue=function(v,b){var w=v[b],E=v.raws[b];return E&&E.value===w?E.raw:w},u.root=function(v){this.body(v),v.raws.after&&this.builder(v.raws.after)},u.rule=function(v){this.block(v,this.rawValue(v,"selector")),v.raws.ownSemicolon&&this.builder(v.raws.ownSemicolon,v,"end")},u.stringify=function(v,b){if(!this[v.type])throw new Error("Unknown AST node type "+v.type+". Maybe you need to change PostCSS stringifier.");this[v.type](v,b)},y})(),stringifier=Stringifier$2;Stringifier$2.default=Stringifier$2;var Stringifier$1=stringifier;function stringify$4(y,u){var g=new Stringifier$1(u);g.stringify(y)}var stringify_1=stringify$4;stringify$4.default=stringify$4;var isClean$2=symbols.isClean,my$2=symbols.my,CssSyntaxError$2=cssSyntaxError,Stringifier22=stringifier,stringify$3=stringify_1;function cloneNode(y,u){var g=new y.constructor;for(var v in y)if(Object.prototype.hasOwnProperty.call(y,v)&&v!=="proxyCache"){var b=y[v],w=typeof b>"u"?"undefined":_type_of(b);v==="parent"&&w==="object"?u&&(g[v]=u):v==="source"?g[v]=b:Array.isArray(b)?g[v]=b.map(function(E){return cloneNode(E,g)}):(w==="object"&&b!==null&&(b=cloneNode(b)),g[v]=b)}return g}var Node$4=(function(){function y(g){g===void 0&&(g={}),this.raws={},this[isClean$2]=!1,this[my$2]=!0;for(var v in g)if(v==="nodes"){this.nodes=[];for(var b=_create_for_of_iterator_helper_loose(g[v]),w;!(w=b()).done;){var E=w.value;typeof E.clone=="function"?this.append(E.clone()):this.append(E)}}else this[v]=g[v]}var u=y.prototype;return u.addToError=function(v){if(v.postcssNode=this,v.stack&&this.source&&/\n\s{4}at /.test(v.stack)){var b=this.source;v.stack=v.stack.replace(/\n\s{4}at /,"$&"+b.input.from+":"+b.start.line+":"+b.start.column+"$&")}return v},u.after=function(v){return this.parent.insertAfter(this,v),this},u.assign=function(v){v===void 0&&(v={});for(var b in v)this[b]=v[b];return this},u.before=function(v){return this.parent.insertBefore(this,v),this},u.cleanRaws=function(v){delete this.raws.before,delete this.raws.after,v||delete this.raws.between},u.clone=function(v){v===void 0&&(v={});var b=cloneNode(this);for(var w in v)b[w]=v[w];return b},u.cloneAfter=function(v){v===void 0&&(v={});var b=this.clone(v);return this.parent.insertAfter(this,b),b},u.cloneBefore=function(v){v===void 0&&(v={});var b=this.clone(v);return this.parent.insertBefore(this,b),b},u.error=function(v,b){if(b===void 0&&(b={}),this.source){var w=this.rangeBy(b),E=w.end,S=w.start;return this.source.input.error(v,{column:S.column,line:S.line},{column:E.column,line:E.line},b)}return new CssSyntaxError$2(v)},u.getProxyProcessor=function(){return{get:function(b,w){return w==="proxyOf"?b:w==="root"?function(){return b.root().toProxy()}:b[w]},set:function(b,w,E){return b[w]===E||(b[w]=E,(w==="prop"||w==="value"||w==="name"||w==="params"||w==="important"||w==="text")&&b.markDirty()),!0}}},u.markDirty=function(){if(this[isClean$2]){this[isClean$2]=!1;for(var v=this;v=v.parent;)v[isClean$2]=!1}},u.next=function(){if(this.parent){var v=this.parent.index(this);return this.parent.nodes[v+1]}},u.positionBy=function(v,b){var w=this.source.start;if(v.index)w=this.positionInside(v.index,b);else if(v.word){b=this.toString();var E=b.indexOf(v.word);E!==-1&&(w=this.positionInside(E,b))}return w},u.positionInside=function(v,b){for(var w=b||this.toString(),E=this.source.start.column,S=this.source.start.line,A=0;A<v;A++)w[A]===`
`?(E=1,S+=1):E+=1;return{column:E,line:S}},u.prev=function(){if(this.parent){var v=this.parent.index(this);return this.parent.nodes[v-1]}},u.rangeBy=function(v){var b={column:this.source.start.column,line:this.source.start.line},w=this.source.end?{column:this.source.end.column+1,line:this.source.end.line}:{column:b.column+1,line:b.line};if(v.word){var E=this.toString(),S=E.indexOf(v.word);S!==-1&&(b=this.positionInside(S,E),w=this.positionInside(S+v.word.length,E))}else v.start?b={column:v.start.column,line:v.start.line}:v.index&&(b=this.positionInside(v.index)),v.end?w={column:v.end.column,line:v.end.line}:typeof v.endIndex=="number"?w=this.positionInside(v.endIndex):v.index&&(w=this.positionInside(v.index+1));return(w.line<b.line||w.line===b.line&&w.column<=b.column)&&(w={column:b.column+1,line:b.line}),{end:w,start:b}},u.raw=function(v,b){var w=new Stringifier22;return w.raw(this,v,b)},u.remove=function(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this},u.replaceWith=function(){for(var v=arguments.length,b=new Array(v),w=0;w<v;w++)b[w]=arguments[w];if(this.parent){for(var E=this,S=!1,A=_create_for_of_iterator_helper_loose(b),$;!($=A()).done;){var R=$.value;R===this?S=!0:S?(this.parent.insertAfter(E,R),E=R):this.parent.insertBefore(E,R)}S||this.remove()}return this},u.root=function(){for(var v=this;v.parent&&v.parent.type!=="document";)v=v.parent;return v},u.toJSON=function(v,b){var w={},E=b==null;b=b||new Map;var S=0;for(var A in this)if(Object.prototype.hasOwnProperty.call(this,A)&&!(A==="parent"||A==="proxyCache")){var $=this[A];if(Array.isArray($))w[A]=$.map(function(T){return(typeof T>"u"?"undefined":_type_of(T))==="object"&&T.toJSON?T.toJSON(null,b):T});else if((typeof $>"u"?"undefined":_type_of($))==="object"&&$.toJSON)w[A]=$.toJSON(null,b);else if(A==="source"){var R=b.get($.input);R==null&&(R=S,b.set($.input,S),S++),w[A]={end:$.end,inputId:R,start:$.start}}else w[A]=$}return E&&(w.inputs=[].concat(b.keys()).map(function(T){return T.toJSON()})),w},u.toProxy=function(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache},u.toString=function(v){v===void 0&&(v=stringify$3),v.stringify&&(v=v.stringify);var b="";return v(this,function(w){b+=w}),b},u.warn=function(v,b,w){var E={node:this};for(var S in w)E[S]=w[S];return v.warn(b,E)},_create_class(y,[{key:"proxyOf",get:function(){return this}}]),y})(),node=Node$4;Node$4.default=Node$4;var Node$3=node,Declaration$4=(function(y){_inherits(u,y);function u(g){var v;return g&&typeof g.value<"u"&&typeof g.value!="string"&&(g=_extends({},g,{value:String(g.value)})),v=y.call(this,g)||this,v.type="decl",v}return _create_class(u,[{key:"variable",get:function(){return this.prop.startsWith("--")||this.prop[0]==="$"}}]),u})(Node$3),declaration=Declaration$4;Declaration$4.default=Declaration$4;var urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",nanoid$1=function(y){y===void 0&&(y=21);for(var u="",g=y;g--;)u+=urlAlphabet[Math.random()*64|0];return u},nonSecure={nanoid:nanoid$1},SourceMapConsumer$2=require$$2.SourceMapConsumer,SourceMapGenerator$2=require$$2.SourceMapGenerator,existsSync=require$$2.existsSync,readFileSync=require$$2.readFileSync,dirname$1=require$$2.dirname,join=require$$2.join;function fromBase64(y){return Buffer?Buffer.from(y,"base64").toString():window.atob(y)}var PreviousMap$2=(function(){function y(g,v){if(v.map!==!1){this.loadAnnotation(g),this.inline=this.startWith(this.annotation,"data:");var b=v.map?v.map.prev:void 0,w=this.loadMap(v.from,b);!this.mapFile&&v.from&&(this.mapFile=v.from),this.mapFile&&(this.root=dirname$1(this.mapFile)),w&&(this.text=w)}}var u=y.prototype;return u.consumer=function(){return this.consumerCache||(this.consumerCache=new SourceMapConsumer$2(this.text)),this.consumerCache},u.decodeInline=function(v){var b=/^data:application\/json;charset=utf-?8;base64,/,w=/^data:application\/json;base64,/,E=/^data:application\/json;charset=utf-?8,/,S=/^data:application\/json,/;if(E.test(v)||S.test(v))return decodeURIComponent(v.substr(RegExp.lastMatch.length));if(b.test(v)||w.test(v))return fromBase64(v.substr(RegExp.lastMatch.length));var A=v.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+A)},u.getAnnotationURL=function(v){return v.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()},u.isMap=function(v){return(typeof v>"u"?"undefined":_type_of(v))!=="object"?!1:typeof v.mappings=="string"||typeof v._mappings=="string"||Array.isArray(v.sections)},u.loadAnnotation=function(v){var b=v.match(/\/\*\s*# sourceMappingURL=/gm);if(b){var w=v.lastIndexOf(b.pop()),E=v.indexOf("*/",w);w>-1&&E>-1&&(this.annotation=this.getAnnotationURL(v.substring(w,E)))}},u.loadFile=function(v){if(this.root=dirname$1(v),existsSync(v))return this.mapFile=v,readFileSync(v,"utf-8").toString().trim()},u.loadMap=function(v,b){if(b===!1)return!1;if(b){if(typeof b=="string")return b;if(typeof b=="function"){var w=b(v);if(w){var E=this.loadFile(w);if(!E)throw new Error("Unable to load previous source map: "+w.toString());return E}}else{if(_instanceof(b,SourceMapConsumer$2))return SourceMapGenerator$2.fromSourceMap(b).toString();if(_instanceof(b,SourceMapGenerator$2))return b.toString();if(this.isMap(b))return JSON.stringify(b);throw new Error("Unsupported previous source map format: "+b.toString())}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){var S=this.annotation;return v&&(S=join(dirname$1(v),S)),this.loadFile(S)}}},u.startWith=function(v,b){return v?v.substr(0,b.length)===b:!1},u.withContent=function(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)},y})(),previousMap=PreviousMap$2;PreviousMap$2.default=PreviousMap$2;var SourceMapConsumer$1=require$$2.SourceMapConsumer,SourceMapGenerator$1=require$$2.SourceMapGenerator,fileURLToPath=require$$2.fileURLToPath,pathToFileURL$1=require$$2.pathToFileURL,isAbsolute=require$$2.isAbsolute,resolve$1=require$$2.resolve,nanoid=nonSecure.nanoid,terminalHighlight=require$$2,CssSyntaxError$1=cssSyntaxError,PreviousMap$1=previousMap,fromOffsetCache=Symbol("fromOffsetCache"),sourceMapAvailable$1=!!(SourceMapConsumer$1&&SourceMapGenerator$1),pathAvailable$1=!!(resolve$1&&isAbsolute),Input$4=(function(){function y(g,v){if(v===void 0&&(v={}),g===null||typeof g>"u"||(typeof g>"u"?"undefined":_type_of(g))==="object"&&!g.toString)throw new Error("PostCSS received "+g+" instead of CSS string");if(this.css=g.toString(),this.css[0]==="\uFEFF"||this.css[0]===""?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,v.from&&(!pathAvailable$1||/^\w+:\/\//.test(v.from)||isAbsolute(v.from)?this.file=v.from:this.file=resolve$1(v.from)),pathAvailable$1&&sourceMapAvailable$1){var b=new PreviousMap$1(this.css,v);if(b.text){this.map=b;var w=b.consumer().file;!this.file&&w&&(this.file=this.mapResolve(w))}}this.file||(this.id="<input css "+nanoid(6)+">"),this.map&&(this.map.file=this.from)}var u=y.prototype;return u.error=function(v,b,w,E){E===void 0&&(E={});var S,A,$;if(b&&(typeof b>"u"?"undefined":_type_of(b))==="object"){var R=b,T=w;if(typeof R.offset=="number"){var O=this.fromOffset(R.offset);b=O.line,w=O.col}else b=R.line,w=R.column;if(typeof T.offset=="number"){var B=this.fromOffset(T.offset);A=B.line,$=B.col}else A=T.line,$=T.column}else if(!w){var F=this.fromOffset(b);b=F.line,w=F.col}var U=this.origin(b,w,A,$);return U?S=new CssSyntaxError$1(v,U.endLine===void 0?U.line:{column:U.column,line:U.line},U.endLine===void 0?U.column:{column:U.endColumn,line:U.endLine},U.source,U.file,E.plugin):S=new CssSyntaxError$1(v,A===void 0?b:{column:w,line:b},A===void 0?w:{column:$,line:A},this.css,this.file,E.plugin),S.input={column:w,endColumn:$,endLine:A,line:b,source:this.css},this.file&&(pathToFileURL$1&&(S.input.url=pathToFileURL$1(this.file).toString()),S.input.file=this.file),S},u.fromOffset=function(v){var b,w;if(this[fromOffsetCache])w=this[fromOffsetCache];else{var E=this.css.split(`
`);w=new Array(E.length);for(var S=0,A=0,$=E.length;A<$;A++)w[A]=S,S+=E[A].length+1;this[fromOffsetCache]=w}b=w[w.length-1];var R=0;if(v>=b)R=w.length-1;else for(var T=w.length-2,O;R<T;)if(O=R+(T-R>>1),v<w[O])T=O-1;else if(v>=w[O+1])R=O+1;else{R=O;break}return{col:v-w[R]+1,line:R+1}},u.mapResolve=function(v){return/^\w+:\/\//.test(v)?v:resolve$1(this.map.consumer().sourceRoot||this.map.root||".",v)},u.origin=function(v,b,w,E){if(!this.map)return!1;var S=this.map.consumer(),A=S.originalPositionFor({column:b,line:v});if(!A.source)return!1;var $;typeof w=="number"&&($=S.originalPositionFor({column:E,line:w}));var R;isAbsolute(A.source)?R=pathToFileURL$1(A.source):R=new URL(A.source,this.map.consumer().sourceRoot||pathToFileURL$1(this.map.mapFile));var T={column:A.column,endColumn:$&&$.column,endLine:$&&$.line,line:A.line,url:R.toString()};if(R.protocol==="file:")if(fileURLToPath)T.file=fileURLToPath(R);else throw new Error("file: protocol is not available in this PostCSS build");var O=S.sourceContentFor(A.source);return O&&(T.source=O),T},u.toJSON=function(){for(var v={},b=0,w=["hasBOM","css","file","id"];b<w.length;b++){var E=w[b];this[E]!=null&&(v[E]=this[E])}return this.map&&(v.map=_extends({},this.map),v.map.consumerCache&&(v.map.consumerCache=void 0)),v},_create_class(y,[{key:"from",get:function(){return this.file||this.id}}]),y})(),input=Input$4;Input$4.default=Input$4;terminalHighlight&&terminalHighlight.registerInput&&terminalHighlight.registerInput(Input$4);var SourceMapConsumer=require$$2.SourceMapConsumer,SourceMapGenerator=require$$2.SourceMapGenerator,dirname=require$$2.dirname,relative=require$$2.relative,resolve$3=require$$2.resolve,sep=require$$2.sep,pathToFileURL=require$$2.pathToFileURL,Input$3=input,sourceMapAvailable=!!(SourceMapConsumer&&SourceMapGenerator),pathAvailable=!!(dirname&&resolve$3&&relative&&sep),MapGenerator$2=(function(){function y(g,v,b,w){this.stringify=g,this.mapOpts=b.map||{},this.root=v,this.opts=b,this.css=w,this.originalCSS=w,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}var u=y.prototype;return u.addAnnotation=function(){var v;this.isInline()?v="data:application/json;base64,"+this.toBase64(this.map.toString()):typeof this.mapOpts.annotation=="string"?v=this.mapOpts.annotation:typeof this.mapOpts.annotation=="function"?v=this.mapOpts.annotation(this.opts.to,this.root):v=this.outputFile()+".map";var b=`
`;this.css.includes(`\r
`)&&(b=`\r
`),this.css+=b+"/*# sourceMappingURL="+v+" */"},u.applyPrevMaps=function(){for(var v=_create_for_of_iterator_helper_loose(this.previous()),b;!(b=v()).done;){var w=b.value,E=this.toUrl(this.path(w.file)),S=w.root||dirname(w.file),A=void 0;this.mapOpts.sourcesContent===!1?(A=new SourceMapConsumer(w.text),A.sourcesContent&&(A.sourcesContent=null)):A=w.consumer(),this.map.applySourceMap(A,E,this.toUrl(this.path(S)))}},u.clearAnnotation=function(){if(this.mapOpts.annotation!==!1)if(this.root)for(var v,b=this.root.nodes.length-1;b>=0;b--)v=this.root.nodes[b],v.type==="comment"&&v.text.indexOf("# sourceMappingURL=")===0&&this.root.removeChild(b);else this.css&&(this.css=this.css.replace(/\n*?\/\*#[\S\s]*?\*\/$/gm,""))},u.generate=function(){if(this.clearAnnotation(),pathAvailable&&sourceMapAvailable&&this.isMap())return this.generateMap();var v="";return this.stringify(this.root,function(b){v+=b}),[v]},u.generateMap=function(){if(this.root)this.generateString();else if(this.previous().length===1){var v=this.previous()[0].consumer();v.file=this.outputFile(),this.map=SourceMapGenerator.fromSourceMap(v,{ignoreInvalidMapping:!0})}else this.map=new SourceMapGenerator({file:this.outputFile(),ignoreInvalidMapping:!0}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]},u.generateString=function(){var v=this;this.css="",this.map=new SourceMapGenerator({file:this.outputFile(),ignoreInvalidMapping:!0});var b=1,w=1,E="<no source>",S={generated:{column:0,line:0},original:{column:0,line:0},source:""},A,$;this.stringify(this.root,function(R,T,O){if(v.css+=R,T&&O!=="end"&&(S.generated.line=b,S.generated.column=w-1,T.source&&T.source.start?(S.source=v.sourcePath(T),S.original.line=T.source.start.line,S.original.column=T.source.start.column-1,v.map.addMapping(S)):(S.source=E,S.original.line=1,S.original.column=0,v.map.addMapping(S))),A=R.match(/\n/g),A?(b+=A.length,$=R.lastIndexOf(`
`),w=R.length-$):w+=R.length,T&&O!=="start"){var B=T.parent||{raws:{}},F=T.type==="decl"||T.type==="atrule"&&!T.nodes;(!F||T!==B.last||B.raws.semicolon)&&(T.source&&T.source.end?(S.source=v.sourcePath(T),S.original.line=T.source.end.line,S.original.column=T.source.end.column-1,S.generated.line=b,S.generated.column=w-2,v.map.addMapping(S)):(S.source=E,S.original.line=1,S.original.column=0,S.generated.line=b,S.generated.column=w-1,v.map.addMapping(S)))}})},u.isAnnotation=function(){return this.isInline()?!0:typeof this.mapOpts.annotation<"u"?this.mapOpts.annotation:this.previous().length?this.previous().some(function(v){return v.annotation}):!0},u.isInline=function(){if(typeof this.mapOpts.inline<"u")return this.mapOpts.inline;var v=this.mapOpts.annotation;return typeof v<"u"&&v!==!0?!1:this.previous().length?this.previous().some(function(b){return b.inline}):!0},u.isMap=function(){return typeof this.opts.map<"u"?!!this.opts.map:this.previous().length>0},u.isSourcesContent=function(){return typeof this.mapOpts.sourcesContent<"u"?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(function(v){return v.withContent()}):!0},u.outputFile=function(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"},u.path=function(v){if(this.mapOpts.absolute||v.charCodeAt(0)===60||/^\w+:\/\//.test(v))return v;var b=this.memoizedPaths.get(v);if(b)return b;var w=this.opts.to?dirname(this.opts.to):".";typeof this.mapOpts.annotation=="string"&&(w=dirname(resolve$3(w,this.mapOpts.annotation)));var E=relative(w,v);return this.memoizedPaths.set(v,E),E},u.previous=function(){var v=this;if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk(function(w){if(w.source&&w.source.input.map){var E=w.source.input.map;v.previousMaps.includes(E)||v.previousMaps.push(E)}});else{var b=new Input$3(this.originalCSS,this.opts);b.map&&this.previousMaps.push(b.map)}return this.previousMaps},u.setSourcesContent=function(){var v=this,b={};if(this.root)this.root.walk(function(E){if(E.source){var S=E.source.input.from;if(S&&!b[S]){b[S]=!0;var A=v.usesFileUrls?v.toFileUrl(S):v.toUrl(v.path(S));v.map.setSourceContent(A,E.source.input.css)}}});else if(this.css){var w=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(w,this.css)}},u.sourcePath=function(v){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(v.source.input.from):this.toUrl(this.path(v.source.input.from))},u.toBase64=function(v){return Buffer?Buffer.from(v).toString("base64"):window.btoa(unescape(encodeURIComponent(v)))},u.toFileUrl=function(v){var b=this.memoizedFileURLs.get(v);if(b)return b;if(pathToFileURL){var w=pathToFileURL(v).toString();return this.memoizedFileURLs.set(v,w),w}else throw new Error("`map.absolute` option is not available in this PostCSS build")},u.toUrl=function(v){var b=this.memoizedURLs.get(v);if(b)return b;sep==="\\"&&(v=v.replace(/\\/g,"/"));var w=encodeURI(v).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(v,w),w},y})(),mapGenerator=MapGenerator$2,Node$2=node,Comment$4=(function(y){_inherits(u,y);function u(g){var v;return v=y.call(this,g)||this,v.type="comment",v}return u})(Node$2),comment=Comment$4;Comment$4.default=Comment$4;var isClean$1=symbols.isClean,my$1=symbols.my,Declaration$3=declaration,Comment$3=comment,Node$1=node,parse$4,Rule$4,AtRule$4,Root$6;function cleanSource(y){return y.map(function(u){return u.nodes&&(u.nodes=cleanSource(u.nodes)),delete u.source,u})}function markDirtyUp(y){if(y[isClean$1]=!1,y.proxyOf.nodes)for(var u=_create_for_of_iterator_helper_loose(y.proxyOf.nodes),g;!(g=u()).done;){var v=g.value;markDirtyUp(v)}}var Container$7=(function(y){_inherits(u,y);function u(){return y.apply(this,arguments)||this}var g=u.prototype;return g.append=function(){for(var b=arguments.length,w=new Array(b),E=0;E<b;E++)w[E]=arguments[E];for(var S=_create_for_of_iterator_helper_loose(w),A;!(A=S()).done;)for(var $=A.value,R=this.normalize($,this.last),T=_create_for_of_iterator_helper_loose(R),O;!(O=T()).done;){var B=O.value;this.proxyOf.nodes.push(B)}return this.markDirty(),this},g.cleanRaws=function(b){if(y.prototype.cleanRaws.call(this,b),this.nodes)for(var w=_create_for_of_iterator_helper_loose(this.nodes),E;!(E=w()).done;){var S=E.value;S.cleanRaws(b)}},g.each=function(b){if(this.proxyOf.nodes){for(var w=this.getIterator(),E,S;this.indexes[w]<this.proxyOf.nodes.length&&(E=this.indexes[w],S=b(this.proxyOf.nodes[E],E),S!==!1);)this.indexes[w]+=1;return delete this.indexes[w],S}},g.every=function(b){return this.nodes.every(b)},g.getIterator=function(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;var b=this.lastEach;return this.indexes[b]=0,b},g.getProxyProcessor=function(){return{get:function(w,E){return E==="proxyOf"?w:w[E]?E==="each"||typeof E=="string"&&E.startsWith("walk")?function(){for(var S=arguments.length,A=new Array(S),$=0;$<S;$++)A[$]=arguments[$];var R;return(R=w)[E].apply(R,[].concat(A.map(function(T){return typeof T=="function"?function(O,B){return T(O.toProxy(),B)}:T})))}:E==="every"||E==="some"?function(S){return w[E](function(A){for(var $=arguments.length,R=new Array($>1?$-1:0),T=1;T<$;T++)R[T-1]=arguments[T];return S.apply(void 0,[].concat([A.toProxy()],R))})}:E==="root"?function(){return w.root().toProxy()}:E==="nodes"?w.nodes.map(function(S){return S.toProxy()}):E==="first"||E==="last"?w[E].toProxy():w[E]:w[E]},set:function(w,E,S){return w[E]===S||(w[E]=S,(E==="name"||E==="params"||E==="selector")&&w.markDirty()),!0}}},g.index=function(b){return typeof b=="number"?b:(b.proxyOf&&(b=b.proxyOf),this.proxyOf.nodes.indexOf(b))},g.insertAfter=function(b,w){var E=this.index(b),S=this.normalize(w,this.proxyOf.nodes[E]).reverse();E=this.index(b);for(var A=_create_for_of_iterator_helper_loose(S),$;!($=A()).done;){var R=$.value;this.proxyOf.nodes.splice(E+1,0,R)}var T;for(var O in this.indexes)T=this.indexes[O],E<T&&(this.indexes[O]=T+S.length);return this.markDirty(),this},g.insertBefore=function(b,w){var E=this.index(b),S=E===0?"prepend":!1,A=this.normalize(w,this.proxyOf.nodes[E],S).reverse();E=this.index(b);for(var $=_create_for_of_iterator_helper_loose(A),R;!(R=$()).done;){var T=R.value;this.proxyOf.nodes.splice(E,0,T)}var O;for(var B in this.indexes)O=this.indexes[B],E<=O&&(this.indexes[B]=O+A.length);return this.markDirty(),this},g.normalize=function(b,w){var E=this;if(typeof b=="string")b=cleanSource(parse$4(b).nodes);else if(typeof b>"u")b=[];else if(Array.isArray(b)){b=b.slice(0);for(var S=_create_for_of_iterator_helper_loose(b),A;!(A=S()).done;){var $=A.value;$.parent&&$.parent.removeChild($,"ignore")}}else if(b.type==="root"&&this.type!=="document"){b=b.nodes.slice(0);for(var R=_create_for_of_iterator_helper_loose(b),T;!(T=R()).done;){var O=T.value;O.parent&&O.parent.removeChild(O,"ignore")}}else if(b.type)b=[b];else if(b.prop){if(typeof b.value>"u")throw new Error("Value field is missed in node creation");typeof b.value!="string"&&(b.value=String(b.value)),b=[new Declaration$3(b)]}else if(b.selector)b=[new Rule$4(b)];else if(b.name)b=[new AtRule$4(b)];else if(b.text)b=[new Comment$3(b)];else throw new Error("Unknown node type in node creation");var B=b.map(function(F){return F[my$1]||u.rebuild(F),F=F.proxyOf,F.parent&&F.parent.removeChild(F),F[isClean$1]&&markDirtyUp(F),typeof F.raws.before>"u"&&w&&typeof w.raws.before<"u"&&(F.raws.before=w.raws.before.replace(/\S/g,"")),F.parent=E.proxyOf,F});return B},g.prepend=function(){for(var b=arguments.length,w=new Array(b),E=0;E<b;E++)w[E]=arguments[E];w=w.reverse();for(var S=_create_for_of_iterator_helper_loose(w),A;!(A=S()).done;){for(var $=A.value,R=this.normalize($,this.first,"prepend").reverse(),T=_create_for_of_iterator_helper_loose(R),O;!(O=T()).done;){var B=O.value;this.proxyOf.nodes.unshift(B)}for(var F in this.indexes)this.indexes[F]=this.indexes[F]+R.length}return this.markDirty(),this},g.push=function(b){return b.parent=this,this.proxyOf.nodes.push(b),this},g.removeAll=function(){for(var b=_create_for_of_iterator_helper_loose(this.proxyOf.nodes),w;!(w=b()).done;){var E=w.value;E.parent=void 0}return this.proxyOf.nodes=[],this.markDirty(),this},g.removeChild=function(b){b=this.index(b),this.proxyOf.nodes[b].parent=void 0,this.proxyOf.nodes.splice(b,1);var w;for(var E in this.indexes)w=this.indexes[E],w>=b&&(this.indexes[E]=w-1);return this.markDirty(),this},g.replaceValues=function(b,w,E){return E||(E=w,w={}),this.walkDecls(function(S){w.props&&!w.props.includes(S.prop)||w.fast&&!S.value.includes(w.fast)||(S.value=S.value.replace(b,E))}),this.markDirty(),this},g.some=function(b){return this.nodes.some(b)},g.walk=function(b){return this.each(function(w,E){var S;try{S=b(w,E)}catch(A){throw w.addToError(A)}return S!==!1&&w.walk&&(S=w.walk(b)),S})},g.walkAtRules=function(b,w){return w?_instanceof(b,RegExp)?this.walk(function(E,S){if(E.type==="atrule"&&b.test(E.name))return w(E,S)}):this.walk(function(E,S){if(E.type==="atrule"&&E.name===b)return w(E,S)}):(w=b,this.walk(function(E,S){if(E.type==="atrule")return w(E,S)}))},g.walkComments=function(b){return this.walk(function(w,E){if(w.type==="comment")return b(w,E)})},g.walkDecls=function(b,w){return w?_instanceof(b,RegExp)?this.walk(function(E,S){if(E.type==="decl"&&b.test(E.prop))return w(E,S)}):this.walk(function(E,S){if(E.type==="decl"&&E.prop===b)return w(E,S)}):(w=b,this.walk(function(E,S){if(E.type==="decl")return w(E,S)}))},g.walkRules=function(b,w){return w?_instanceof(b,RegExp)?this.walk(function(E,S){if(E.type==="rule"&&b.test(E.selector))return w(E,S)}):this.walk(function(E,S){if(E.type==="rule"&&E.selector===b)return w(E,S)}):(w=b,this.walk(function(E,S){if(E.type==="rule")return w(E,S)}))},_create_class(u,[{key:"first",get:function(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}},{key:"last",get:function(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}}]),u})(Node$1);Container$7.registerParse=function(y){parse$4=y};Container$7.registerRule=function(y){Rule$4=y};Container$7.registerAtRule=function(y){AtRule$4=y};Container$7.registerRoot=function(y){Root$6=y};var container=Container$7;Container$7.default=Container$7;Container$7.rebuild=function(y){y.type==="atrule"?Object.setPrototypeOf(y,AtRule$4.prototype):y.type==="rule"?Object.setPrototypeOf(y,Rule$4.prototype):y.type==="decl"?Object.setPrototypeOf(y,Declaration$3.prototype):y.type==="comment"?Object.setPrototypeOf(y,Comment$3.prototype):y.type==="root"&&Object.setPrototypeOf(y,Root$6.prototype),y[my$1]=!0,y.nodes&&y.nodes.forEach(function(u){Container$7.rebuild(u)})};var Container$6=container,LazyResult$4,Processor$3,Document$3=(function(y){_inherits(u,y);function u(v){var b;return b=y.call(this,_extends({type:"document"},v))||this,b.nodes||(b.nodes=[]),b}var g=u.prototype;return g.toResult=function(b){b===void 0&&(b={});var w=new LazyResult$4(new Processor$3,this,b);return w.stringify()},u})(Container$6);Document$3.registerLazyResult=function(y){LazyResult$4=y};Document$3.registerProcessor=function(y){Processor$3=y};var document$1$2=Document$3;Document$3.default=Document$3;var Warning$2=(function(){function y(g,v){if(v===void 0&&(v={}),this.type="warning",this.text=g,v.node&&v.node.source){var b=v.node.rangeBy(v);this.line=b.start.line,this.column=b.start.column,this.endLine=b.end.line,this.endColumn=b.end.column}for(var w in v)this[w]=v[w]}var u=y.prototype;return u.toString=function(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text},y})(),warning=Warning$2;Warning$2.default=Warning$2;var Warning$1=warning,Result$3=(function(){function y(g,v,b){this.processor=g,this.messages=[],this.root=v,this.opts=b,this.css=void 0,this.map=void 0}var u=y.prototype;return u.toString=function(){return this.css},u.warn=function(v,b){b===void 0&&(b={}),b.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(b.plugin=this.lastPlugin.postcssPlugin);var w=new Warning$1(v,b);return this.messages.push(w),w},u.warnings=function(){return this.messages.filter(function(v){return v.type==="warning"})},_create_class(y,[{key:"content",get:function(){return this.css}}]),y})(),result=Result$3;Result$3.default=Result$3;var SINGLE_QUOTE=39,DOUBLE_QUOTE=34,BACKSLASH=92,SLASH=47,NEWLINE=10,SPACE=32,FEED=12,TAB=9,CR=13,OPEN_SQUARE=91,CLOSE_SQUARE=93,OPEN_PARENTHESES=40,CLOSE_PARENTHESES=41,OPEN_CURLY=123,CLOSE_CURLY=125,SEMICOLON=59,ASTERISK=42,COLON=58,AT=64,RE_AT_END=/[\t\n\f\r "#'()/;[\\\]{}]/g,RE_WORD_END=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,RE_BAD_BRACKET=/.[\r\n"'(/\\]/,RE_HEX_ESCAPE=/[\da-f]/i,tokenize=function y(u,g){g===void 0&&(g={});var v=u.css.valueOf(),b=g.ignoreErrors,w,E,S,A,$,R,T,O,B,F,U=v.length,q=0,J=[],ie=[];function oe(){return q}function le(we){throw u.error("Unclosed "+we,q)}function de(){return ie.length===0&&q>=U}function fe(we){if(ie.length)return ie.pop();if(!(q>=U)){var pe=we?we.ignoreUnclosed:!1;switch(w=v.charCodeAt(q),w){case NEWLINE:case SPACE:case TAB:case CR:case FEED:{E=q;do E+=1,w=v.charCodeAt(E);while(w===SPACE||w===NEWLINE||w===TAB||w===CR||w===FEED);F=["space",v.slice(q,E)],q=E-1;break}case OPEN_SQUARE:case CLOSE_SQUARE:case OPEN_CURLY:case CLOSE_CURLY:case COLON:case SEMICOLON:case CLOSE_PARENTHESES:{var ve=String.fromCharCode(w);F=[ve,ve,q];break}case OPEN_PARENTHESES:{if(O=J.length?J.pop()[1]:"",B=v.charCodeAt(q+1),O==="url"&&B!==SINGLE_QUOTE&&B!==DOUBLE_QUOTE&&B!==SPACE&&B!==NEWLINE&&B!==TAB&&B!==FEED&&B!==CR){E=q;do{if(R=!1,E=v.indexOf(")",E+1),E===-1)if(b||pe){E=q;break}else le("bracket");for(T=E;v.charCodeAt(T-1)===BACKSLASH;)T-=1,R=!R}while(R);F=["brackets",v.slice(q,E+1),q,E],q=E}else E=v.indexOf(")",q+1),A=v.slice(q,E+1),E===-1||RE_BAD_BRACKET.test(A)?F=["(","(",q]:(F=["brackets",A,q,E],q=E);break}case SINGLE_QUOTE:case DOUBLE_QUOTE:{S=w===SINGLE_QUOTE?"'":'"',E=q;do{if(R=!1,E=v.indexOf(S,E+1),E===-1)if(b||pe){E=q+1;break}else le("string");for(T=E;v.charCodeAt(T-1)===BACKSLASH;)T-=1,R=!R}while(R);F=["string",v.slice(q,E+1),q,E],q=E;break}case AT:{RE_AT_END.lastIndex=q+1,RE_AT_END.test(v),RE_AT_END.lastIndex===0?E=v.length-1:E=RE_AT_END.lastIndex-2,F=["at-word",v.slice(q,E+1),q,E],q=E;break}case BACKSLASH:{for(E=q,$=!0;v.charCodeAt(E+1)===BACKSLASH;)E+=1,$=!$;if(w=v.charCodeAt(E+1),$&&w!==SLASH&&w!==SPACE&&w!==NEWLINE&&w!==TAB&&w!==CR&&w!==FEED&&(E+=1,RE_HEX_ESCAPE.test(v.charAt(E)))){for(;RE_HEX_ESCAPE.test(v.charAt(E+1));)E+=1;v.charCodeAt(E+1)===SPACE&&(E+=1)}F=["word",v.slice(q,E+1),q,E],q=E;break}default:{w===SLASH&&v.charCodeAt(q+1)===ASTERISK?(E=v.indexOf("*/",q+2)+1,E===0&&(b||pe?E=v.length:le("comment")),F=["comment",v.slice(q,E+1),q,E],q=E):(RE_WORD_END.lastIndex=q+1,RE_WORD_END.test(v),RE_WORD_END.lastIndex===0?E=v.length-1:E=RE_WORD_END.lastIndex-2,F=["word",v.slice(q,E+1),q,E],J.push(F),q=E);break}}return q++,F}}function ye(we){ie.push(we)}return{back:ye,endOfFile:de,nextToken:fe,position:oe}},Container$5=container,AtRule$3=(function(y){_inherits(u,y);function u(v){var b;return b=y.call(this,v)||this,b.type="atrule",b}var g=u.prototype;return g.append=function(){for(var b=arguments.length,w=new Array(b),E=0;E<b;E++)w[E]=arguments[E];var S;return this.proxyOf.nodes||(this.nodes=[]),(S=y.prototype.append).call.apply(S,[].concat([this],w))},g.prepend=function(){for(var b=arguments.length,w=new Array(b),E=0;E<b;E++)w[E]=arguments[E];var S;return this.proxyOf.nodes||(this.nodes=[]),(S=y.prototype.prepend).call.apply(S,[].concat([this],w))},u})(Container$5),atRule=AtRule$3;AtRule$3.default=AtRule$3;Container$5.registerAtRule(AtRule$3);var Container$4=container,LazyResult$3,Processor$2,Root$5=(function(y){_inherits(u,y);function u(v){var b;return b=y.call(this,v)||this,b.type="root",b.nodes||(b.nodes=[]),b}var g=u.prototype;return g.normalize=function(b,w,E){var S=y.prototype.normalize.call(this,b);if(w){if(E==="prepend")this.nodes.length>1?w.raws.before=this.nodes[1].raws.before:delete w.raws.before;else if(this.first!==w)for(var A=_create_for_of_iterator_helper_loose(S),$;!($=A()).done;){var R=$.value;R.raws.before=w.raws.before}}return S},g.removeChild=function(b,w){var E=this.index(b);return!w&&E===0&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[E].raws.before),y.prototype.removeChild.call(this,b)},g.toResult=function(b){b===void 0&&(b={});var w=new LazyResult$3(new Processor$2,this,b);return w.stringify()},u})(Container$4);Root$5.registerLazyResult=function(y){LazyResult$3=y};Root$5.registerProcessor=function(y){Processor$2=y};var root=Root$5;Root$5.default=Root$5;Container$4.registerRoot(Root$5);var list$2={comma:function y(u){return list$2.split(u,[","],!0)},space:function y(u){var g=[" ",`
`,"	"];return list$2.split(u,g)},split:function y(u,g,v){for(var b=[],w="",E=!1,S=0,A=!1,$="",R=!1,T=_create_for_of_iterator_helper_loose(u),O;!(O=T()).done;){var B=O.value;R?R=!1:B==="\\"?R=!0:A?B===$&&(A=!1):B==='"'||B==="'"?(A=!0,$=B):B==="("?S+=1:B===")"?S>0&&(S-=1):S===0&&g.includes(B)&&(E=!0),E?(w!==""&&b.push(w.trim()),w="",E=!1):w+=B}return(v||w!=="")&&b.push(w.trim()),b}},list_1=list$2;list$2.default=list$2;var Container$3=container,list$1=list_1,Rule$3=(function(y){_inherits(u,y);function u(g){var v;return v=y.call(this,g)||this,v.type="rule",v.nodes||(v.nodes=[]),v}return _create_class(u,[{key:"selectors",get:function(){return list$1.comma(this.selector)},set:function(v){var b=this.selector?this.selector.match(/,\s*/):null,w=b?b[0]:","+this.raw("between","beforeOpen");this.selector=v.join(w)}}]),u})(Container$3),rule=Rule$3;Rule$3.default=Rule$3;Container$3.registerRule(Rule$3);var Declaration$2=declaration,tokenizer22=tokenize,Comment$2=comment,AtRule$2=atRule,Root$4=root,Rule$2=rule,SAFE_COMMENT_NEIGHBOR={empty:!0,space:!0};function findLastWithPosition(y){for(var u=y.length-1;u>=0;u--){var g=y[u],v=g[3]||g[2];if(v)return v}}var Parser$1=(function(){function y(g){this.input=g,this.root=new Root$4,this.current=this.root,this.spaces="",this.semicolon=!1,this.createTokenizer(),this.root.source={input:g,start:{column:1,line:1,offset:0}}}var u=y.prototype;return u.atrule=function(v){var b=new AtRule$2;b.name=v[1].slice(1),b.name===""&&this.unnamedAtrule(b,v),this.init(b,v[2]);for(var w,E,S,A=!1,$=!1,R=[],T=[];!this.tokenizer.endOfFile();){if(v=this.tokenizer.nextToken(),w=v[0],w==="("||w==="["?T.push(w==="("?")":"]"):w==="{"&&T.length>0?T.push("}"):w===T[T.length-1]&&T.pop(),T.length===0)if(w===";"){b.source.end=this.getPosition(v[2]),b.source.end.offset++,this.semicolon=!0;break}else if(w==="{"){$=!0;break}else if(w==="}"){if(R.length>0){for(S=R.length-1,E=R[S];E&&E[0]==="space";)E=R[--S];E&&(b.source.end=this.getPosition(E[3]||E[2]),b.source.end.offset++)}this.end(v);break}else R.push(v);else R.push(v);if(this.tokenizer.endOfFile()){A=!0;break}}b.raws.between=this.spacesAndCommentsFromEnd(R),R.length?(b.raws.afterName=this.spacesAndCommentsFromStart(R),this.raw(b,"params",R),A&&(v=R[R.length-1],b.source.end=this.getPosition(v[3]||v[2]),b.source.end.offset++,this.spaces=b.raws.between,b.raws.between="")):(b.raws.afterName="",b.params=""),$&&(b.nodes=[],this.current=b)},u.checkMissedSemicolon=function(v){var b=this.colon(v);if(b!==!1){for(var w=0,E,S=b-1;S>=0&&(E=v[S],!(E[0]!=="space"&&(w+=1,w===2)));S--);throw this.input.error("Missed semicolon",E[0]==="word"?E[3]+1:E[2])}},u.colon=function(v){for(var b=0,w,E,S,A=_create_for_of_iterator_helper_loose(v.entries()),$;!($=A()).done;){var R=$.value,T=R[0],O=R[1];if(w=O,E=w[0],E==="("&&(b+=1),E===")"&&(b-=1),b===0&&E===":")if(!S)this.doubleColon(w);else{if(S[0]==="word"&&S[1]==="progid")continue;return T}S=w}return!1},u.comment=function(v){var b=new Comment$2;this.init(b,v[2]),b.source.end=this.getPosition(v[3]||v[2]),b.source.end.offset++;var w=v[1].slice(2,-2);if(/^\s*$/.test(w))b.text="",b.raws.left=w,b.raws.right="";else{var E=w.match(/^(\s*)([^]*\S)(\s*)$/);b.text=E[2],b.raws.left=E[1],b.raws.right=E[3]}},u.createTokenizer=function(){this.tokenizer=tokenizer22(this.input)},u.decl=function(v,b){var w=new Declaration$2;this.init(w,v[0][2]);var E=v[v.length-1];for(E[0]===";"&&(this.semicolon=!0,v.pop()),w.source.end=this.getPosition(E[3]||E[2]||findLastWithPosition(v)),w.source.end.offset++;v[0][0]!=="word";)v.length===1&&this.unknownWord(v),w.raws.before+=v.shift()[1];for(w.source.start=this.getPosition(v[0][2]),w.prop="";v.length;){var S=v[0][0];if(S===":"||S==="space"||S==="comment")break;w.prop+=v.shift()[1]}w.raws.between="";for(var A;v.length;)if(A=v.shift(),A[0]===":"){w.raws.between+=A[1];break}else A[0]==="word"&&/\w/.test(A[1])&&this.unknownWord([A]),w.raws.between+=A[1];(w.prop[0]==="_"||w.prop[0]==="*")&&(w.raws.before+=w.prop[0],w.prop=w.prop.slice(1));for(var $=[],R;v.length&&(R=v[0][0],!(R!=="space"&&R!=="comment"));)$.push(v.shift());this.precheckMissedSemicolon(v);for(var T=v.length-1;T>=0;T--){if(A=v[T],A[1].toLowerCase()==="!important"){w.important=!0;var O=this.stringFrom(v,T);O=this.spacesFromEnd(v)+O,O!==" !important"&&(w.raws.important=O);break}else if(A[1].toLowerCase()==="important"){for(var B=v.slice(0),F="",U=T;U>0;U--){var q=B[U][0];if(F.trim().indexOf("!")===0&&q!=="space")break;F=B.pop()[1]+F}F.trim().indexOf("!")===0&&(w.important=!0,w.raws.important=F,v=B)}if(A[0]!=="space"&&A[0]!=="comment")break}var J=v.some(function(ie){return ie[0]!=="space"&&ie[0]!=="comment"});J&&(w.raws.between+=$.map(function(ie){return ie[1]}).join(""),$=[]),this.raw(w,"value",$.concat(v),b),w.value.includes(":")&&!b&&this.checkMissedSemicolon(v)},u.doubleColon=function(v){throw this.input.error("Double colon",{offset:v[2]},{offset:v[2]+v[1].length})},u.emptyRule=function(v){var b=new Rule$2;this.init(b,v[2]),b.selector="",b.raws.between="",this.current=b},u.end=function(v){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(v[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(v)},u.endFile=function(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())},u.freeSemicolon=function(v){if(this.spaces+=v[1],this.current.nodes){var b=this.current.nodes[this.current.nodes.length-1];b&&b.type==="rule"&&!b.raws.ownSemicolon&&(b.raws.ownSemicolon=this.spaces,this.spaces="")}},u.getPosition=function(v){var b=this.input.fromOffset(v);return{column:b.col,line:b.line,offset:v}},u.init=function(v,b){this.current.push(v),v.source={input:this.input,start:this.getPosition(b)},v.raws.before=this.spaces,this.spaces="",v.type!=="comment"&&(this.semicolon=!1)},u.other=function(v){for(var b=!1,w=null,E=!1,S=null,A=[],$=v[1].startsWith("--"),R=[],T=v;T;){if(w=T[0],R.push(T),w==="("||w==="[")S||(S=T),A.push(w==="("?")":"]");else if($&&E&&w==="{")S||(S=T),A.push("}");else if(A.length===0)if(w===";")if(E){this.decl(R,$);return}else break;else if(w==="{"){this.rule(R);return}else if(w==="}"){this.tokenizer.back(R.pop()),b=!0;break}else w===":"&&(E=!0);else w===A[A.length-1]&&(A.pop(),A.length===0&&(S=null));T=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(b=!0),A.length>0&&this.unclosedBracket(S),b&&E){if(!$)for(;R.length&&(T=R[R.length-1][0],!(T!=="space"&&T!=="comment"));)this.tokenizer.back(R.pop());this.decl(R,$)}else this.unknownWord(R)},u.parse=function(){for(var v;!this.tokenizer.endOfFile();)switch(v=this.tokenizer.nextToken(),v[0]){case"space":this.spaces+=v[1];break;case";":this.freeSemicolon(v);break;case"}":this.end(v);break;case"comment":this.comment(v);break;case"at-word":this.atrule(v);break;case"{":this.emptyRule(v);break;default:this.other(v);break}this.endFile()},u.precheckMissedSemicolon=function(){},u.raw=function(v,b,w,E){for(var S,A,$=w.length,R="",T=!0,O,B,F=0;F<$;F+=1)S=w[F],A=S[0],A==="space"&&F===$-1&&!E?T=!1:A==="comment"?(B=w[F-1]?w[F-1][0]:"empty",O=w[F+1]?w[F+1][0]:"empty",!SAFE_COMMENT_NEIGHBOR[B]&&!SAFE_COMMENT_NEIGHBOR[O]?R.slice(-1)===","?T=!1:R+=S[1]:T=!1):R+=S[1];if(!T){var U=w.reduce(function(q,J){return q+J[1]},"");v.raws[b]={raw:U,value:R}}v[b]=R},u.rule=function(v){v.pop();var b=new Rule$2;this.init(b,v[0][2]),b.raws.between=this.spacesAndCommentsFromEnd(v),this.raw(b,"selector",v),this.current=b},u.spacesAndCommentsFromEnd=function(v){for(var b,w="";v.length&&(b=v[v.length-1][0],!(b!=="space"&&b!=="comment"));)w=v.pop()[1]+w;return w},u.spacesAndCommentsFromStart=function(v){for(var b,w="";v.length&&(b=v[0][0],!(b!=="space"&&b!=="comment"));)w+=v.shift()[1];return w},u.spacesFromEnd=function(v){for(var b,w="";v.length&&(b=v[v.length-1][0],b==="space");)w=v.pop()[1]+w;return w},u.stringFrom=function(v,b){for(var w="",E=b;E<v.length;E++)w+=v[E][1];return v.splice(b,v.length-b),w},u.unclosedBlock=function(){var v=this.current.source.start;throw this.input.error("Unclosed block",v.line,v.column)},u.unclosedBracket=function(v){throw this.input.error("Unclosed bracket",{offset:v[2]},{offset:v[2]+1})},u.unexpectedClose=function(v){throw this.input.error("Unexpected }",{offset:v[2]},{offset:v[2]+1})},u.unknownWord=function(v){throw this.input.error("Unknown word",{offset:v[0][2]},{offset:v[0][2]+v[0][1].length})},u.unnamedAtrule=function(v,b){throw this.input.error("At-rule without name",{offset:b[2]},{offset:b[2]+b[1].length})},y})(),parser=Parser$1,Container$2=container,Parser22=parser,Input$2=input;function parse$3(y,u){var g=new Input$2(y,u),v=new Parser22(g);try{v.parse()}catch(b){throw b}return v.root}var parse_1=parse$3;parse$3.default=parse$3;Container$2.registerParse(parse$3);var isClean=symbols.isClean,my=symbols.my,MapGenerator$1=mapGenerator,stringify$2=stringify_1,Container$1=container,Document$2=document$1$2,Result$2=result,parse$2=parse_1,Root$3=root,TYPE_TO_CLASS_NAME={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},PLUGIN_PROPS={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},NOT_VISITORS={Once:!0,postcssPlugin:!0,prepare:!0},CHILDREN=0;function isPromise(y){return(typeof y>"u"?"undefined":_type_of(y))==="object"&&typeof y.then=="function"}function getEvents(y){var u=!1,g=TYPE_TO_CLASS_NAME[y.type];return y.type==="decl"?u=y.prop.toLowerCase():y.type==="atrule"&&(u=y.name.toLowerCase()),u&&y.append?[g,g+"-"+u,CHILDREN,g+"Exit",g+"Exit-"+u]:u?[g,g+"-"+u,g+"Exit",g+"Exit-"+u]:y.append?[g,CHILDREN,g+"Exit"]:[g,g+"Exit"]}function toStack(y){var u;return y.type==="document"?u=["Document",CHILDREN,"DocumentExit"]:y.type==="root"?u=["Root",CHILDREN,"RootExit"]:u=getEvents(y),{eventIndex:0,events:u,iterator:0,node:y,visitorIndex:0,visitors:[]}}function cleanMarks(y){return y[isClean]=!1,y.nodes&&y.nodes.forEach(function(u){return cleanMarks(u)}),y}var postcss$2={},LazyResult$2=(function(){function y(g,v,b){var w=this;this.stringified=!1,this.processed=!1;var E;if((typeof v>"u"?"undefined":_type_of(v))==="object"&&v!==null&&(v.type==="root"||v.type==="document"))E=cleanMarks(v);else if(_instanceof(v,y)||_instanceof(v,Result$2))E=cleanMarks(v.root),v.map&&(typeof b.map>"u"&&(b.map={}),b.map.inline||(b.map.inline=!1),b.map.prev=v.map);else{var S=parse$2;b.syntax&&(S=b.syntax.parse),b.parser&&(S=b.parser),S.parse&&(S=S.parse);try{E=S(v,b)}catch(A){this.processed=!0,this.error=A}E&&!E[my]&&Container$1.rebuild(E)}this.result=new Result$2(g,E,b),this.helpers=_extends({},postcss$2,{postcss:postcss$2,result:this.result}),this.plugins=this.processor.plugins.map(function(A){return(typeof A>"u"?"undefined":_type_of(A))==="object"&&A.prepare?_extends({},A,A.prepare(w.result)):A})}var u=y.prototype;return u.async=function(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)},u.catch=function(v){return this.async().catch(v)},u.finally=function(v){return this.async().then(v,v)},u.getAsyncError=function(){throw new Error("Use process(css).then(cb) to work with async plugins")},u.handleError=function(v,b){var w=this.result.lastPlugin;try{if(b&&b.addToError(v),this.error=v,v.name==="CssSyntaxError"&&!v.plugin)v.plugin=w.postcssPlugin,v.setMessage();else if(w.postcssVersion)var E,S,A,$,R}catch(T){console&&console.error&&console.error(T)}return v},u.prepareVisitors=function(){var v=this;this.listeners={};for(var b=function(R,T,O){v.listeners[T]||(v.listeners[T]=[]),v.listeners[T].push([R,O])},w=_create_for_of_iterator_helper_loose(this.plugins),E;!(E=w()).done;){var S=E.value;if((typeof S>"u"?"undefined":_type_of(S))==="object")for(var A in S){if(!PLUGIN_PROPS[A]&&/^[A-Z]/.test(A))throw new Error("Unknown event "+A+" in "+S.postcssPlugin+". Try to update PostCSS ("+this.processor.version+" now).");if(!NOT_VISITORS[A])if(_type_of(S[A])==="object")for(var $ in S[A])$==="*"?b(S,A,S[A][$]):b(S,A+"-"+$.toLowerCase(),S[A][$]);else typeof S[A]=="function"&&b(S,A,S[A])}}this.hasListener=Object.keys(this.listeners).length>0},u.runAsync=function(){var v=this;return _async_to_generator(function(){var b,w,E,S,A,$,R,T,O,B,F,U;return _ts_generator(this,function(q){switch(q.label){case 0:v.plugin=0,b=0,q.label=1;case 1:if(!(b<v.plugins.length))return[3,6];if(w=v.plugins[b],E=v.runOnRoot(w),!isPromise(E))return[3,5];q.label=2;case 2:return q.trys.push([2,4,,5]),[4,E];case 3:return q.sent(),[3,5];case 4:throw S=q.sent(),v.handleError(S);case 5:return b++,[3,1];case 6:if(v.prepareVisitors(),!v.hasListener)return[3,18];A=v.result.root,q.label=7;case 7:if(A[isClean])return[3,14];A[isClean]=!0,$=[toStack(A)],q.label=8;case 8:if(!($.length>0))return[3,13];if(R=v.visitTick($),!isPromise(R))return[3,12];q.label=9;case 9:return q.trys.push([9,11,,12]),[4,R];case 10:return q.sent(),[3,12];case 11:throw T=q.sent(),O=$[$.length-1].node,v.handleError(T,O);case 12:return[3,8];case 13:return[3,7];case 14:if(!v.listeners.OnceExit)return[3,18];B=function(){var J,ie,oe,le,de;return _ts_generator(this,function(fe){switch(fe.label){case 0:J=U.value,ie=J[0],oe=J[1],v.result.lastPlugin=ie,fe.label=1;case 1:return fe.trys.push([1,6,,7]),A.type!=="document"?[3,3]:(le=A.nodes.map(function(ye){return oe(ye,v.helpers)}),[4,Promise.all(le)]);case 2:return fe.sent(),[3,5];case 3:return[4,oe(A,v.helpers)];case 4:fe.sent(),fe.label=5;case 5:return[3,7];case 6:throw de=fe.sent(),v.handleError(de);case 7:return[2]}})},F=_create_for_of_iterator_helper_loose(v.listeners.OnceExit),q.label=15;case 15:return(U=F()).done?[3,18]:[5,_ts_values(B())];case 16:q.sent(),q.label=17;case 17:return[3,15];case 18:return v.processed=!0,[2,v.stringify()]}})})()},u.runOnRoot=function(v){var b=this;this.result.lastPlugin=v;try{if((typeof v>"u"?"undefined":_type_of(v))==="object"&&v.Once){if(this.result.root.type==="document"){var w=this.result.root.nodes.map(function(E){return v.Once(E,b.helpers)});return isPromise(w[0])?Promise.all(w):w}return v.Once(this.result.root,this.helpers)}else if(typeof v=="function")return v(this.result.root,this.result)}catch(E){throw this.handleError(E)}},u.stringify=function(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();var v=this.result.opts,b=stringify$2;v.syntax&&(b=v.syntax.stringify),v.stringifier&&(b=v.stringifier),b.stringify&&(b=b.stringify);var w=new MapGenerator$1(b,this.result.root,this.result.opts),E=w.generate();return this.result.css=E[0],this.result.map=E[1],this.result},u.sync=function(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(var v=_create_for_of_iterator_helper_loose(this.plugins),b;!(b=v()).done;){var w=b.value,E=this.runOnRoot(w);if(isPromise(E))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){for(var S=this.result.root;!S[isClean];)S[isClean]=!0,this.walkSync(S);if(this.listeners.OnceExit)if(S.type==="document")for(var A=_create_for_of_iterator_helper_loose(S.nodes),$;!($=A()).done;){var R=$.value;this.visitSync(this.listeners.OnceExit,R)}else this.visitSync(this.listeners.OnceExit,S)}return this.result},u.then=function(v,b){return this.async().then(v,b)},u.toString=function(){return this.css},u.visitSync=function(v,b){for(var w=_create_for_of_iterator_helper_loose(v),E;!(E=w()).done;){var S=E.value,A=S[0],$=S[1];this.result.lastPlugin=A;var R=void 0;try{R=$(b,this.helpers)}catch(T){throw this.handleError(T,b.proxyOf)}if(b.type!=="root"&&b.type!=="document"&&!b.parent)return!0;if(isPromise(R))throw this.getAsyncError()}},u.visitTick=function(v){var b=v[v.length-1],w=b.node,E=b.visitors;if(w.type!=="root"&&w.type!=="document"&&!w.parent){v.pop();return}if(E.length>0&&b.visitorIndex<E.length){var S=E[b.visitorIndex],A=S[0],$=S[1];b.visitorIndex+=1,b.visitorIndex===E.length&&(b.visitors=[],b.visitorIndex=0),this.result.lastPlugin=A;try{return $(w.toProxy(),this.helpers)}catch(F){throw this.handleError(F,w)}}if(b.iterator!==0){for(var R=b.iterator,T;T=w.nodes[w.indexes[R]];)if(w.indexes[R]+=1,!T[isClean]){T[isClean]=!0,v.push(toStack(T));return}b.iterator=0,delete w.indexes[R]}for(var O=b.events;b.eventIndex<O.length;){var B=O[b.eventIndex];if(b.eventIndex+=1,B===CHILDREN){w.nodes&&w.nodes.length&&(w[isClean]=!0,b.iterator=w.getIterator());return}else if(this.listeners[B]){b.visitors=this.listeners[B];return}}v.pop()},u.walkSync=function(v){var b=this;v[isClean]=!0;for(var w=getEvents(v),E=_create_for_of_iterator_helper_loose(w),S;!(S=E()).done;){var A=S.value;if(A===CHILDREN)v.nodes&&v.each(function(R){R[isClean]||b.walkSync(R)});else{var $=this.listeners[A];if($&&this.visitSync($,v.toProxy()))return}}},u.warnings=function(){return this.sync().warnings()},_create_class(y,[{key:"content",get:function(){return this.stringify().content}},{key:"css",get:function(){return this.stringify().css}},{key:"map",get:function(){return this.stringify().map}},{key:"messages",get:function(){return this.sync().messages}},{key:"opts",get:function(){return this.result.opts}},{key:"processor",get:function(){return this.result.processor}},{key:"root",get:function(){return this.sync().root}},{key:Symbol.toStringTag,get:function(){return"LazyResult"}}]),y})();LazyResult$2.registerPostcss=function(y){postcss$2=y};var lazyResult=LazyResult$2;LazyResult$2.default=LazyResult$2;Root$3.registerLazyResult(LazyResult$2);Document$2.registerLazyResult(LazyResult$2);var MapGenerator22=mapGenerator,stringify$1=stringify_1,parse$1=parse_1,Result$1=result,NoWorkResult$1=(function(){function y(g,v,b){v=v.toString(),this.stringified=!1,this._processor=g,this._css=v,this._opts=b,this._map=void 0;var w,E=stringify$1;this.result=new Result$1(this._processor,w,this._opts),this.result.css=v;var S=this;Object.defineProperty(this.result,"root",{get:function(){return S.root}});var A=new MapGenerator22(E,w,this._opts,v);if(A.isMap()){var $=A.generate(),R=$[0],T=$[1];R&&(this.result.css=R),T&&(this.result.map=T)}else A.clearAnnotation(),this.result.css=A.css}var u=y.prototype;return u.async=function(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)},u.catch=function(v){return this.async().catch(v)},u.finally=function(v){return this.async().then(v,v)},u.sync=function(){if(this.error)throw this.error;return this.result},u.then=function(v,b){return this.async().then(v,b)},u.toString=function(){return this._css},u.warnings=function(){return[]},_create_class(y,[{key:"content",get:function(){return this.result.css}},{key:"css",get:function(){return this.result.css}},{key:"map",get:function(){return this.result.map}},{key:"messages",get:function(){return[]}},{key:"opts",get:function(){return this.result.opts}},{key:"processor",get:function(){return this.result.processor}},{key:"root",get:function(){if(this._root)return this._root;var v,b=parse$1;try{v=b(this._css,this._opts)}catch(w){this.error=w}if(this.error)throw this.error;return this._root=v,v}},{key:Symbol.toStringTag,get:function(){return"NoWorkResult"}}]),y})(),noWorkResult=NoWorkResult$1;NoWorkResult$1.default=NoWorkResult$1;var NoWorkResult22=noWorkResult,LazyResult$1=lazyResult,Document$1=document$1$2,Root$2=root,Processor$1=(function(){function y(g){g===void 0&&(g=[]),this.version="8.4.38",this.plugins=this.normalize(g)}var u=y.prototype;return u.normalize=function(v){for(var b=[],w=_create_for_of_iterator_helper_loose(v),E;!(E=w()).done;){var S=E.value;if(S.postcss===!0?S=S():S.postcss&&(S=S.postcss),(typeof S>"u"?"undefined":_type_of(S))==="object"&&Array.isArray(S.plugins))b=b.concat(S.plugins);else if((typeof S>"u"?"undefined":_type_of(S))==="object"&&S.postcssPlugin)b.push(S);else if(typeof S=="function")b.push(S);else if(!((typeof S>"u"?"undefined":_type_of(S))==="object"&&(S.parse||S.stringify)))throw new Error(S+" is not a PostCSS plugin")}return b},u.process=function(v,b){return b===void 0&&(b={}),!this.plugins.length&&!b.parser&&!b.stringifier&&!b.syntax?new NoWorkResult22(this,v,b):new LazyResult$1(this,v,b)},u.use=function(v){return this.plugins=this.plugins.concat(this.normalize([v])),this},y})(),processor=Processor$1;Processor$1.default=Processor$1;Root$2.registerProcessor(Processor$1);Document$1.registerProcessor(Processor$1);var Declaration$1=declaration,PreviousMap22=previousMap,Comment$1=comment,AtRule$1=atRule,Input$1=input,Root$1=root,Rule$1=rule;function fromJSON$1(y,u){if(Array.isArray(y))return y.map(function(T){return fromJSON$1(T)});var g=y.inputs,v=_object_without_properties_loose(y,["inputs"]);if(g){u=[];for(var b=_create_for_of_iterator_helper_loose(g),w;!(w=b()).done;){var E=w.value,S=_extends({},E,{__proto__:Input$1.prototype});S.map&&(S.map=_extends({},S.map,{__proto__:PreviousMap22.prototype})),u.push(S)}}if(v.nodes&&(v.nodes=y.nodes.map(function(T){return fromJSON$1(T,u)})),v.source){var A=v.source,$=A.inputId,R=_object_without_properties_loose(A,["inputId"]);v.source=R,$!=null&&(v.source.input=u[$])}if(v.type==="root")return new Root$1(v);if(v.type==="decl")return new Declaration$1(v);if(v.type==="rule")return new Rule$1(v);if(v.type==="comment")return new Comment$1(v);if(v.type==="atrule")return new AtRule$1(v);throw new Error("Unknown node type: "+y.type)}var fromJSON_1=fromJSON$1;fromJSON$1.default=fromJSON$1;var CssSyntaxError22=cssSyntaxError,Declaration22=declaration,LazyResult22=lazyResult,Container22=container,Processor22=processor,stringify$6=stringify_1,fromJSON=fromJSON_1,Document222=document$1$2,Warning22=warning,Comment22=comment,AtRule22=atRule,Result22=result,Input22=input,parse=parse_1,list=list_1,Rule22=rule,Root22=root,Node22=node;function postcss(){for(var y=arguments.length,u=new Array(y),g=0;g<y;g++)u[g]=arguments[g];return u.length===1&&Array.isArray(u[0])&&(u=u[0]),new Processor22(u)}postcss.plugin=function y(u,g){var v=!1;function b(){for(var E=arguments.length,S=new Array(E),A=0;A<E;A++)S[A]=arguments[A];console&&console.warn&&!v&&(v=!0,console.warn(u+`: postcss.plugin was deprecated. Migration guide:
https://evilmartians.com/chronicles/postcss-8-plugin-migration`),define_process_env_default.LANG&&define_process_env_default.LANG.startsWith("cn")&&console.warn(u+`:  postcss.plugin . :
https://www.w3ctech.com/topic/2226`));var $=g.apply(void 0,[].concat(S));return $.postcssPlugin=u,$.postcssVersion=new Processor22().version,$}var w;return Object.defineProperty(b,"postcss",{get:function(){return w||(w=b()),w}}),b.process=function(E,S,A){return postcss([b(A)]).process(E,S)},b};postcss.stringify=stringify$6;postcss.parse=parse;postcss.fromJSON=fromJSON;postcss.list=list;postcss.comment=function(y){return new Comment22(y)};postcss.atRule=function(y){return new AtRule22(y)};postcss.decl=function(y){return new Declaration22(y)};postcss.rule=function(y){return new Rule22(y)};postcss.root=function(y){return new Root22(y)};postcss.document=function(y){return new Document222(y)};postcss.CssSyntaxError=CssSyntaxError22;postcss.Declaration=Declaration22;postcss.Container=Container22;postcss.Processor=Processor22;postcss.Document=Document222;postcss.Comment=Comment22;postcss.Warning=Warning22;postcss.AtRule=AtRule22;postcss.Result=Result22;postcss.Input=Input22;postcss.Rule=Rule22;postcss.Root=Root22;postcss.Node=Node22;LazyResult22.registerPostcss(postcss);var postcss_1=postcss;postcss.default=postcss;var postcss$1=getDefaultExportFromCjs(postcss_1);postcss$1.stringify;postcss$1.fromJSON;postcss$1.plugin;postcss$1.parse;postcss$1.list;postcss$1.document;postcss$1.comment;postcss$1.atRule;postcss$1.rule;postcss$1.decl;postcss$1.root;postcss$1.CssSyntaxError;postcss$1.Declaration;postcss$1.Container;postcss$1.Processor;postcss$1.Document;postcss$1.Comment;postcss$1.Warning;postcss$1.AtRule;postcss$1.Result;postcss$1.Input;postcss$1.Rule;postcss$1.Root;postcss$1.Node;var BaseRRNode=(function(){function y(){for(var g=arguments.length,v=new Array(g),b=0;b<g;b++)v[b]=arguments[b];__publicField2(this,"parentElement",null),__publicField2(this,"parentNode",null),__publicField2(this,"ownerDocument"),__publicField2(this,"firstChild",null),__publicField2(this,"lastChild",null),__publicField2(this,"previousSibling",null),__publicField2(this,"nextSibling",null),__publicField2(this,"ELEMENT_NODE",1),__publicField2(this,"TEXT_NODE",3),__publicField2(this,"nodeType"),__publicField2(this,"nodeName"),__publicField2(this,"RRNodeType")}var u=y.prototype;return u.contains=function(v){if(_instanceof(v,y)){if(v.ownerDocument!==this.ownerDocument)return!1;if(v===this)return!0}else return!1;for(;v.parentNode;){if(v.parentNode===this)return!0;v=v.parentNode}return!1},u.appendChild=function(v){throw new Error("RRDomException: Failed to execute 'appendChild' on 'RRNode': This RRNode type does not support this method.")},u.insertBefore=function(v,b){throw new Error("RRDomException: Failed to execute 'insertBefore' on 'RRNode': This RRNode type does not support this method.")},u.removeChild=function(v){throw new Error("RRDomException: Failed to execute 'removeChild' on 'RRNode': This RRNode type does not support this method.")},u.toString=function(){return"RRNode"},_create_class(y,[{key:"childNodes",get:function(){for(var v=[],b=this.firstChild;b;)v.push(b),b=b.nextSibling;return v}}]),y})(),testableAccessors={Node:["childNodes","parentNode","parentElement","textContent"],ShadowRoot:["host","styleSheets"],Element:["shadowRoot","querySelector","querySelectorAll"],MutationObserver:[]},testableMethods={Node:["contains","getRootNode"],ShadowRoot:["getSelection"],Element:[],MutationObserver:["constructor"]},untaintedBasePrototype={},isAngularZonePresent=function(){return!!globalThis.Zone};function getUntaintedPrototype(y){if(untaintedBasePrototype[y])return untaintedBasePrototype[y];var u=globalThis[y],g=u.prototype,v=y in testableAccessors?testableAccessors[y]:void 0,b=!!(v&&v.every(function(R){var T,O;return!!((O=(T=Object.getOwnPropertyDescriptor(g,R))==null?void 0:T.get)!=null&&O.toString().includes("[native code]"))})),w=y in testableMethods?testableMethods[y]:void 0,E=!!(w&&w.every(function(R){var T;return typeof g[R]=="function"&&((T=g[R])==null?void 0:T.toString().includes("[native code]"))}));if(b&&E&&!isAngularZonePresent())return untaintedBasePrototype[y]=u.prototype,u.prototype;try{var S=document.createElement("iframe");document.body.appendChild(S);var A=S.contentWindow;if(!A)return u.prototype;var $=A[y].prototype;return document.body.removeChild(S),$?untaintedBasePrototype[y]=$:g}catch{return g}}var untaintedAccessorCache={};function getUntaintedAccessor(y,u,g){var v,b=y+"."+String(g);if(untaintedAccessorCache[b])return untaintedAccessorCache[b].call(u);var w=getUntaintedPrototype(y),E=(v=Object.getOwnPropertyDescriptor(w,g))==null?void 0:v.get;return E?(untaintedAccessorCache[b]=E,E.call(u)):u[g]}var untaintedMethodCache={};function getUntaintedMethod(y,u,g){var v=y+"."+String(g);if(untaintedMethodCache[v])return untaintedMethodCache[v].bind(u);var b=getUntaintedPrototype(y),w=b[g];return typeof w!="function"?u[g]:(untaintedMethodCache[v]=w,w.bind(u))}function childNodes(y){return getUntaintedAccessor("Node",y,"childNodes")}function parentNode(y){return getUntaintedAccessor("Node",y,"parentNode")}function parentElement(y){return getUntaintedAccessor("Node",y,"parentElement")}function textContent(y){return getUntaintedAccessor("Node",y,"textContent")}function contains(y,u){return getUntaintedMethod("Node",y,"contains")(u)}function getRootNode(y){return getUntaintedMethod("Node",y,"getRootNode")()}function host(y){return!y||!("host"in y)?null:getUntaintedAccessor("ShadowRoot",y,"host")}function styleSheets(y){return y.styleSheets}function shadowRoot(y){return!y||!("shadowRoot"in y)?null:getUntaintedAccessor("Element",y,"shadowRoot")}function querySelector(y,u){return getUntaintedAccessor("Element",y,"querySelector")(u)}function querySelectorAll(y,u){return getUntaintedAccessor("Element",y,"querySelectorAll")(u)}function mutationObserverCtor(){return getUntaintedPrototype("MutationObserver").constructor}function patch$2(y,u,g){try{if(!(u in y))return function(){};var v=y[u],b=g(v);return typeof b=="function"&&(b.prototype=b.prototype||{},Object.defineProperties(b,{__rrweb_original__:{enumerable:!1,value:v}})),y[u]=b,function(){y[u]=v}}catch{return function(){}}}var index={childNodes,parentNode,parentElement,textContent,contains,getRootNode,host,styleSheets,shadowRoot,querySelector,querySelectorAll,mutationObserver:mutationObserverCtor,patch:patch$2};function on(y,u,g){g===void 0&&(g=document);var v={capture:!0,passive:!0};return g.addEventListener(y,u,v),function(){return g.removeEventListener(y,u,v)}}var DEPARTED_MIRROR_ACCESS_WARNING=`Please stop import mirror directly. Instead of that,\r
now you can use replayer.getMirror() to access the mirror instance of a replayer,\r
or you can use record.mirror to access the mirror instance during recording.`,_mirror={map:{},getId:function y(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),-1},getNode:function y(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),null},removeNodeFromMap:function y(){console.error(DEPARTED_MIRROR_ACCESS_WARNING)},has:function y(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),!1},reset:function y(){console.error(DEPARTED_MIRROR_ACCESS_WARNING)}};typeof window<"u"&&window.Proxy&&window.Reflect&&(_mirror=new Proxy(_mirror,{get:function(u,g,v){return g==="map"&&console.error(DEPARTED_MIRROR_ACCESS_WARNING),Reflect.get(u,g,v)}}));function throttle(y,u,g){g===void 0&&(g={});var v=null,b=0;return function(){for(var w=arguments.length,E=new Array(w),S=0;S<w;S++)E[S]=arguments[S];var A=Date.now();!b&&g.leading===!1&&(b=A);var $=u-(A-b),R=this;$<=0||$>u?(v&&(clearTimeout(v),v=null),b=A,y.apply(R,E)):!v&&g.trailing!==!1&&(v=setTimeout(function(){b=g.leading===!1?0:Date.now(),v=null,y.apply(R,E)},$))}}function hookSetter(y,u,g,v,b){b===void 0&&(b=window);var w=b.Object.getOwnPropertyDescriptor(y,u);return b.Object.defineProperty(y,u,v?g:{set:function(S){var A=this;setTimeout(function(){g.set.call(A,S)},0),w&&w.set&&w.set.call(this,S)}}),function(){return hookSetter(y,u,w||{},!0)}}var nowTimestamp=Date.now;/[1-9][0-9]{12}/.test(Date.now().toString())||(nowTimestamp=function(){return new Date().getTime()});function getWindowScroll(y){var u,g,v,b,w=y.document;return{left:w.scrollingElement?w.scrollingElement.scrollLeft:y.pageXOffset!==void 0?y.pageXOffset:w.documentElement.scrollLeft||w?.body&&((u=index.parentElement(w.body))==null?void 0:u.scrollLeft)||((g=w?.body)==null?void 0:g.scrollLeft)||0,top:w.scrollingElement?w.scrollingElement.scrollTop:y.pageYOffset!==void 0?y.pageYOffset:w?.documentElement.scrollTop||w?.body&&((v=index.parentElement(w.body))==null?void 0:v.scrollTop)||((b=w?.body)==null?void 0:b.scrollTop)||0}}function getWindowHeight(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function getWindowWidth(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function closestElementOfNode(y){if(!y)return null;var u=y.nodeType===y.ELEMENT_NODE?y:index.parentElement(y);return u}function isBlocked(y,u,g,v){if(!y)return!1;var b=closestElementOfNode(y);if(!b)return!1;try{if(typeof u=="string"){if(b.classList.contains(u)||v&&b.closest("."+u)!==null)return!0}else if(classMatchesRegex(b,u,v))return!0}catch{}return!!(g&&(b.matches(g)||v&&b.closest(g)!==null))}function isSerialized(y,u){return u.getId(y)!==-1}function isIgnored(y,u,g){return y.tagName==="TITLE"&&g.headTitleMutations?!0:u.getId(y)===IGNORED_NODE}function isAncestorRemoved(y,u){if(isShadowRoot(y))return!1;var g=u.getId(y);if(!u.has(g))return!0;var v=index.parentNode(y);return v&&v.nodeType===y.DOCUMENT_NODE?!1:v?isAncestorRemoved(v,u):!0}function legacy_isTouchEvent(y){return!!y.changedTouches}function polyfill$1(y){y===void 0&&(y=window),"NodeList"in y&&!y.NodeList.prototype.forEach&&(y.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in y&&!y.DOMTokenList.prototype.forEach&&(y.DOMTokenList.prototype.forEach=Array.prototype.forEach)}function isSerializedIframe(y,u){return!!(y.nodeName==="IFRAME"&&u.getMeta(y))}function isSerializedStylesheet(y,u){return!!(y.nodeName==="LINK"&&y.nodeType===y.ELEMENT_NODE&&y.getAttribute&&y.getAttribute("rel")==="stylesheet"&&u.getMeta(y))}function hasShadowRoot(y){return y?_instanceof(y,BaseRRNode)&&"shadowRoot"in y?!!y.shadowRoot:!!index.shadowRoot(y):!1}var StyleSheetMirror=(function(){function y(){__publicField$1(this,"id",1),__publicField$1(this,"styleIDMap",new WeakMap),__publicField$1(this,"idStyleMap",new Map)}var u=y.prototype;return u.getId=function(v){var b;return(b=this.styleIDMap.get(v))!=null?b:-1},u.has=function(v){return this.styleIDMap.has(v)},u.add=function(v,b){if(this.has(v))return this.getId(v);var w;return b===void 0?w=this.id++:w=b,this.styleIDMap.set(v,w),this.idStyleMap.set(w,v),w},u.getStyle=function(v){return this.idStyleMap.get(v)||null},u.reset=function(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1},u.generateId=function(){return this.id++},y})();function getShadowHost(y){var u,g=null;return"getRootNode"in y&&((u=index.getRootNode(y))==null?void 0:u.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&index.host(index.getRootNode(y))&&(g=index.host(index.getRootNode(y))),g}function getRootShadowHost(y){for(var u=y,g;g=getShadowHost(u);)u=g;return u}function shadowHostInDom(y){var u=y.ownerDocument;if(!u)return!1;var g=getRootShadowHost(y);return index.contains(u,g)}function inDom(y){var u=y.ownerDocument;return u?index.contains(u,y)||shadowHostInDom(y):!1}var EventType=(function(y){return y[y.DomContentLoaded=0]="DomContentLoaded",y[y.Load=1]="Load",y[y.FullSnapshot=2]="FullSnapshot",y[y.IncrementalSnapshot=3]="IncrementalSnapshot",y[y.Meta=4]="Meta",y[y.Custom=5]="Custom",y[y.Plugin=6]="Plugin",y})(EventType||{}),IncrementalSource=(function(y){return y[y.Mutation=0]="Mutation",y[y.MouseMove=1]="MouseMove",y[y.MouseInteraction=2]="MouseInteraction",y[y.Scroll=3]="Scroll",y[y.ViewportResize=4]="ViewportResize",y[y.Input=5]="Input",y[y.TouchMove=6]="TouchMove",y[y.MediaInteraction=7]="MediaInteraction",y[y.StyleSheetRule=8]="StyleSheetRule",y[y.CanvasMutation=9]="CanvasMutation",y[y.Font=10]="Font",y[y.Log=11]="Log",y[y.Drag=12]="Drag",y[y.StyleDeclaration=13]="StyleDeclaration",y[y.Selection=14]="Selection",y[y.AdoptedStyleSheet=15]="AdoptedStyleSheet",y[y.CustomElement=16]="CustomElement",y})(IncrementalSource||{}),MouseInteractions=(function(y){return y[y.MouseUp=0]="MouseUp",y[y.MouseDown=1]="MouseDown",y[y.Click=2]="Click",y[y.ContextMenu=3]="ContextMenu",y[y.DblClick=4]="DblClick",y[y.Focus=5]="Focus",y[y.Blur=6]="Blur",y[y.TouchStart=7]="TouchStart",y[y.TouchMove_Departed=8]="TouchMove_Departed",y[y.TouchEnd=9]="TouchEnd",y[y.TouchCancel=10]="TouchCancel",y})(MouseInteractions||{}),PointerTypes=(function(y){return y[y.Mouse=0]="Mouse",y[y.Pen=1]="Pen",y[y.Touch=2]="Touch",y})(PointerTypes||{}),CanvasContext=(function(y){return y[y["2D"]=0]="2D",y[y.WebGL=1]="WebGL",y[y.WebGL2=2]="WebGL2",y})(CanvasContext||{}),MediaInteractions=(function(y){return y[y.Play=0]="Play",y[y.Pause=1]="Pause",y[y.Seeked=2]="Seeked",y[y.VolumeChange=3]="VolumeChange",y[y.RateChange=4]="RateChange",y})(MediaInteractions||{}),NodeType=(function(y){return y[y.Document=0]="Document",y[y.DocumentType=1]="DocumentType",y[y.Element=2]="Element",y[y.Text=3]="Text",y[y.CDATA=4]="CDATA",y[y.Comment=5]="Comment",y})(NodeType||{});function isNodeInLinkedList(y){return"__ln"in y}var DoubleLinkedList=(function(){function y(){__publicField$1(this,"length",0),__publicField$1(this,"head",null),__publicField$1(this,"tail",null)}var u=y.prototype;return u.get=function(v){if(v>=this.length)throw new Error("Position outside of list range");for(var b=this.head,w=0;w<v;w++)b=b?.next||null;return b},u.addNode=function(v){var b={value:v,previous:null,next:null};if(v.__ln=b,v.previousSibling&&isNodeInLinkedList(v.previousSibling)){var w=v.previousSibling.__ln.next;b.next=w,b.previous=v.previousSibling.__ln,v.previousSibling.__ln.next=b,w&&(w.previous=b)}else if(v.nextSibling&&isNodeInLinkedList(v.nextSibling)&&v.nextSibling.__ln.previous){var E=v.nextSibling.__ln.previous;b.previous=E,b.next=v.nextSibling.__ln,v.nextSibling.__ln.previous=b,E&&(E.next=b)}else this.head&&(this.head.previous=b),b.next=this.head,this.head=b;b.next===null&&(this.tail=b),this.length++},u.removeNode=function(v){var b=v.__ln;this.head&&(b.previous?(b.previous.next=b.next,b.next?b.next.previous=b.previous:this.tail=b.previous):(this.head=b.next,this.head?this.head.previous=null:this.tail=null),v.__ln&&delete v.__ln,this.length--)},y})(),moveKey=function(y,u){return y+"@"+u},MutationBuffer=(function(){function y(){var g=this;__publicField$1(this,"frozen",!1),__publicField$1(this,"locked",!1),__publicField$1(this,"texts",[]),__publicField$1(this,"attributes",[]),__publicField$1(this,"attributeMap",new WeakMap),__publicField$1(this,"removes",[]),__publicField$1(this,"mapRemoves",[]),__publicField$1(this,"movedMap",{}),__publicField$1(this,"addedSet",new Set),__publicField$1(this,"movedSet",new Set),__publicField$1(this,"droppedSet",new Set),__publicField$1(this,"removesSubTreeCache",new Set),__publicField$1(this,"mutationCb"),__publicField$1(this,"blockClass"),__publicField$1(this,"blockSelector"),__publicField$1(this,"maskTextClass"),__publicField$1(this,"maskTextSelector"),__publicField$1(this,"inlineStylesheet"),__publicField$1(this,"maskInputOptions"),__publicField$1(this,"maskTextFn"),__publicField$1(this,"maskInputFn"),__publicField$1(this,"keepIframeSrcFn"),__publicField$1(this,"recordCanvas"),__publicField$1(this,"inlineImages"),__publicField$1(this,"slimDOMOptions"),__publicField$1(this,"dataURLOptions"),__publicField$1(this,"doc"),__publicField$1(this,"mirror"),__publicField$1(this,"iframeManager"),__publicField$1(this,"stylesheetManager"),__publicField$1(this,"shadowDomManager"),__publicField$1(this,"canvasManager"),__publicField$1(this,"processedNodeManager"),__publicField$1(this,"unattachedDoc"),__publicField$1(this,"processMutations",function(v){v.forEach(g.processMutation),g.emit()}),__publicField$1(this,"emit",function(){if(!(g.frozen||g.locked)){for(var v=[],b=new Set,w=new DoubleLinkedList,E=function(he){for(var ae=he,Q=IGNORED_NODE;Q===IGNORED_NODE;)ae=ae&&ae.nextSibling,Q=ae&&g.mirror.getId(ae);return Q},S=function(he){var ae=index.parentNode(he);if(!(!ae||!inDom(he))){var Q=!1;if(he.nodeType===Node.TEXT_NODE){var j=ae.tagName;if(j==="TEXTAREA")return;j==="STYLE"&&g.addedSet.has(ae)&&(Q=!0)}var z=isShadowRoot(ae)?g.mirror.getId(getShadowHost(he)):g.mirror.getId(ae),re=E(he);if(z===-1||re===-1)return w.addNode(he);var Y=serializeNodeWithId(he,{doc:g.doc,mirror:g.mirror,blockClass:g.blockClass,blockSelector:g.blockSelector,maskTextClass:g.maskTextClass,maskTextSelector:g.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:g.inlineStylesheet,maskInputOptions:g.maskInputOptions,maskTextFn:g.maskTextFn,maskInputFn:g.maskInputFn,slimDOMOptions:g.slimDOMOptions,dataURLOptions:g.dataURLOptions,recordCanvas:g.recordCanvas,inlineImages:g.inlineImages,onSerialize:function(te){isSerializedIframe(te,g.mirror)&&g.iframeManager.addIframe(te),isSerializedStylesheet(te,g.mirror)&&g.stylesheetManager.trackLinkElement(te),hasShadowRoot(he)&&g.shadowDomManager.addShadowRoot(index.shadowRoot(he),g.doc)},onIframeLoad:function(te,ne){g.iframeManager.attachIframe(te,ne),g.shadowDomManager.observeAttachShadow(te)},onStylesheetLoad:function(te,ne){g.stylesheetManager.attachLinkElement(te,ne)},cssCaptured:Q});Y&&(v.push({parentId:z,nextId:re,node:Y}),b.add(Y.id))}};g.mapRemoves.length;)g.mirror.removeNodeFromMap(g.mapRemoves.shift());for(var A=_create_for_of_iterator_helper_loose(g.movedSet),$;!($=A()).done;){var R=$.value;isParentRemoved(g.removesSubTreeCache,R,g.mirror)&&!g.movedSet.has(index.parentNode(R))||S(R)}for(var T=_create_for_of_iterator_helper_loose(g.addedSet),O;!(O=T()).done;){var B=O.value;!isAncestorInSet(g.droppedSet,B)&&!isParentRemoved(g.removesSubTreeCache,B,g.mirror)||isAncestorInSet(g.movedSet,B)?S(B):g.droppedSet.add(B)}for(var F=null;w.length;){var U=null;if(F){var q=g.mirror.getId(index.parentNode(F.value)),J=E(F.value);q!==-1&&J!==-1&&(U=F)}if(!U)for(var ie=w.tail;ie;){var oe=ie;if(ie=ie.previous,oe){var le=g.mirror.getId(index.parentNode(oe.value)),de=E(oe.value);if(de===-1)continue;if(le!==-1){U=oe;break}else{var fe=oe.value,ye=index.parentNode(fe);if(ye&&ye.nodeType===Node.DOCUMENT_FRAGMENT_NODE){var we=index.host(ye),pe=g.mirror.getId(we);if(pe!==-1){U=oe;break}}}}}if(!U){for(;w.head;)w.removeNode(w.head.value);break}F=U.previous,w.removeNode(U.value),S(U.value)}var ve={texts:g.texts.map(function(he){var ae=he.node,Q=index.parentNode(ae);return Q&&Q.tagName==="TEXTAREA"&&g.genTextAreaValueMutation(Q),{id:g.mirror.getId(ae),value:he.value}}).filter(function(he){return!b.has(he.id)}).filter(function(he){return g.mirror.has(he.id)}),attributes:g.attributes.map(function(he){var ae=he.attributes;if(typeof ae.style=="string"){var Q=JSON.stringify(he.styleDiff),j=JSON.stringify(he._unchangedStyles);Q.length<ae.style.length&&(Q+j).split("var(").length===ae.style.split("var(").length&&(ae.style=he.styleDiff)}return{id:g.mirror.getId(he.node),attributes:ae}}).filter(function(he){return!b.has(he.id)}).filter(function(he){return g.mirror.has(he.id)}),removes:g.removes,adds:v};!ve.texts.length&&!ve.attributes.length&&!ve.removes.length&&!ve.adds.length||(g.texts=[],g.attributes=[],g.attributeMap=new WeakMap,g.removes=[],g.addedSet=new Set,g.movedSet=new Set,g.droppedSet=new Set,g.removesSubTreeCache=new Set,g.movedMap={},g.mutationCb(ve))}}),__publicField$1(this,"genTextAreaValueMutation",function(v){var b=g.attributeMap.get(v);b||(b={node:v,attributes:{},styleDiff:{},_unchangedStyles:{}},g.attributes.push(b),g.attributeMap.set(v,b));var w=Array.from(index.childNodes(v),function(E){return index.textContent(E)||""}).join("");b.attributes.value=maskInputValue({element:v,maskInputOptions:g.maskInputOptions,tagName:v.tagName,type:getInputType(v),value:w,maskInputFn:g.maskInputFn})}),__publicField$1(this,"processMutation",function(v){if(!isIgnored(v.target,g.mirror,g.slimDOMOptions))switch(v.type){case"characterData":{var b=index.textContent(v.target);!isBlocked(v.target,g.blockClass,g.blockSelector,!1)&&b!==v.oldValue&&g.texts.push({value:needMaskingText(v.target,g.maskTextClass,g.maskTextSelector,!0)&&b?g.maskTextFn?g.maskTextFn(b,closestElementOfNode(v.target)):b.replace(/[\S]/g,"*"):b,node:v.target});break}case"attributes":{var w=v.target,E=v.attributeName,S=v.target.getAttribute(E);if(E==="value"){var A=getInputType(w);S=maskInputValue({element:w,maskInputOptions:g.maskInputOptions,tagName:w.tagName,type:A,value:S,maskInputFn:g.maskInputFn})}if(isBlocked(v.target,g.blockClass,g.blockSelector,!1)||S===v.oldValue)return;var $=g.attributeMap.get(v.target);if(w.tagName==="IFRAME"&&E==="src"&&!g.keepIframeSrcFn(S))if(!w.contentDocument)E="rr_src";else return;if($||($={node:v.target,attributes:{},styleDiff:{},_unchangedStyles:{}},g.attributes.push($),g.attributeMap.set(v.target,$)),E==="type"&&w.tagName==="INPUT"&&(v.oldValue||"").toLowerCase()==="password"&&w.setAttribute("data-rr-is-password","true"),!ignoreAttribute(w.tagName,E))if($.attributes[E]=transformAttribute(g.doc,toLowerCase(w.tagName),toLowerCase(E),S),E==="style"){if(!g.unattachedDoc)try{g.unattachedDoc=document.implementation.createHTMLDocument()}catch{g.unattachedDoc=g.doc}var R=g.unattachedDoc.createElement("span");v.oldValue&&R.setAttribute("style",v.oldValue);for(var T=_create_for_of_iterator_helper_loose(Array.from(w.style)),O;!(O=T()).done;){var B=O.value,F=w.style.getPropertyValue(B),U=w.style.getPropertyPriority(B);F!==R.style.getPropertyValue(B)||U!==R.style.getPropertyPriority(B)?U===""?$.styleDiff[B]=F:$.styleDiff[B]=[F,U]:$._unchangedStyles[B]=[F,U]}for(var q=_create_for_of_iterator_helper_loose(Array.from(R.style)),J;!(J=q()).done;){var ie=J.value;w.style.getPropertyValue(ie)===""&&($.styleDiff[ie]=!1)}}else E==="open"&&w.tagName==="DIALOG"&&(w.matches("dialog:modal")?$.attributes.rr_open_mode="modal":$.attributes.rr_open_mode="non-modal");break}case"childList":{if(isBlocked(v.target,g.blockClass,g.blockSelector,!0))return;if(v.target.tagName==="TEXTAREA"){g.genTextAreaValueMutation(v.target);return}v.addedNodes.forEach(function(oe){return g.genAdds(oe,v.target)}),v.removedNodes.forEach(function(oe){var le=g.mirror.getId(oe),de=isShadowRoot(v.target)?g.mirror.getId(index.host(v.target)):g.mirror.getId(v.target);isBlocked(v.target,g.blockClass,g.blockSelector,!1)||isIgnored(oe,g.mirror,g.slimDOMOptions)||!isSerialized(oe,g.mirror)||(g.addedSet.has(oe)?(deepDelete(g.addedSet,oe),g.droppedSet.add(oe)):g.addedSet.has(v.target)&&le===-1||isAncestorRemoved(v.target,g.mirror)||(g.movedSet.has(oe)&&g.movedMap[moveKey(le,de)]?deepDelete(g.movedSet,oe):(g.removes.push({parentId:de,id:le,isShadow:isShadowRoot(v.target)&&isNativeShadowDom(v.target)?!0:void 0}),processRemoves(oe,g.removesSubTreeCache))),g.mapRemoves.push(oe))});break}}}),__publicField$1(this,"genAdds",function(v,b){if(!g.processedNodeManager.inOtherBuffer(v,g)&&!(g.addedSet.has(v)||g.movedSet.has(v))){if(g.mirror.hasNode(v)){if(isIgnored(v,g.mirror,g.slimDOMOptions))return;g.movedSet.add(v);var w=null;b&&g.mirror.hasNode(b)&&(w=g.mirror.getId(b)),w&&w!==-1&&(g.movedMap[moveKey(g.mirror.getId(v),w)]=!0)}else g.addedSet.add(v),g.droppedSet.delete(v);isBlocked(v,g.blockClass,g.blockSelector,!1)||(index.childNodes(v).forEach(function(E){return g.genAdds(E)}),hasShadowRoot(v)&&index.childNodes(index.shadowRoot(v)).forEach(function(E){g.processedNodeManager.add(E,g),g.genAdds(E,v)}))}})}var u=y.prototype;return u.init=function(v){var b=this;["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach(function(w){b[w]=v[w]})},u.freeze=function(){this.frozen=!0,this.canvasManager.freeze()},u.unfreeze=function(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()},u.isFrozen=function(){return this.frozen},u.lock=function(){this.locked=!0,this.canvasManager.lock()},u.unlock=function(){this.locked=!1,this.canvasManager.unlock(),this.emit()},u.reset=function(){this.shadowDomManager.reset(),this.canvasManager.reset()},y})();function deepDelete(y,u){y.delete(u),index.childNodes(u).forEach(function(g){return deepDelete(y,g)})}function processRemoves(y,u){for(var g=[y];g.length;){var v=g.pop();u.has(v)||(u.add(v),index.childNodes(v).forEach(function(b){return g.push(b)}))}}function isParentRemoved(y,u,g){return y.size===0?!1:_isParentRemoved(y,u)}function _isParentRemoved(y,u,g){var v=index.parentNode(u);return v?y.has(v):!1}function isAncestorInSet(y,u){return y.size===0?!1:_isAncestorInSet(y,u)}function _isAncestorInSet(y,u){var g=index.parentNode(u);return g?y.has(g)?!0:_isAncestorInSet(y,g):!1}var errorHandler;function registerErrorHandler(y){errorHandler=y}function unregisterErrorHandler(){errorHandler=void 0}var callbackWrapper=function(y){if(!errorHandler)return y;var u=function(){for(var g=arguments.length,v=new Array(g),b=0;b<g;b++)v[b]=arguments[b];try{return y.apply(void 0,[].concat(v))}catch(w){if(errorHandler&&errorHandler(w)===!0)return;throw w}};return u},mutationBuffers=[];function getEventTarget(y){try{if("composedPath"in y){var u=y.composedPath();if(u.length)return u[0]}else if("path"in y&&y.path.length)return y.path[0]}catch{}return y&&y.target}function initMutationObserver(y,u){var g=new MutationBuffer;mutationBuffers.push(g),g.init(y);var v=new(mutationObserverCtor())(callbackWrapper(g.processMutations.bind(g)));return v.observe(u,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),v}function initMoveObserver(y){var u=y.mousemoveCb,g=y.sampling,v=y.doc,b=y.mirror;if(g.mousemove===!1)return function(){};var w=typeof g.mousemove=="number"?g.mousemove:50,E=typeof g.mousemoveCallback=="number"?g.mousemoveCallback:500,S=[],A,$=throttle(callbackWrapper(function(O){var B=Date.now()-A;u(S.map(function(F){return F.timeOffset-=B,F}),O),S=[],A=null}),E),R=callbackWrapper(throttle(callbackWrapper(function(O){var B=getEventTarget(O),F=legacy_isTouchEvent(O)?O.changedTouches[0]:O,U=F.clientX,q=F.clientY;A||(A=nowTimestamp()),S.push({x:U,y:q,id:b.getId(B),timeOffset:nowTimestamp()-A}),$(typeof DragEvent<"u"&&_instanceof(O,DragEvent)?IncrementalSource.Drag:_instanceof(O,MouseEvent)?IncrementalSource.MouseMove:IncrementalSource.TouchMove)}),w,{trailing:!1})),T=[on("mousemove",R,v),on("touchmove",R,v),on("drag",R,v)];return callbackWrapper(function(){T.forEach(function(O){return O()})})}function initMouseInteractionObserver(y){var u=y.mouseInteractionCb,g=y.doc,v=y.mirror,b=y.blockClass,w=y.blockSelector,E=y.sampling;if(E.mouseInteraction===!1)return function(){};var S=E.mouseInteraction===!0||E.mouseInteraction===void 0?{}:E.mouseInteraction,A=[],$=null,R=function(T){return function(O){var B=getEventTarget(O);if(!isBlocked(B,b,w,!0)){var F=null,U=T;if("pointerType"in O){switch(O.pointerType){case"mouse":F=PointerTypes.Mouse;break;case"touch":F=PointerTypes.Touch;break;case"pen":F=PointerTypes.Pen;break}F===PointerTypes.Touch?MouseInteractions[T]===MouseInteractions.MouseDown?U="TouchStart":MouseInteractions[T]===MouseInteractions.MouseUp&&(U="TouchEnd"):PointerTypes.Pen}else legacy_isTouchEvent(O)&&(F=PointerTypes.Touch);F!==null?($=F,(U.startsWith("Touch")&&F===PointerTypes.Touch||U.startsWith("Mouse")&&F===PointerTypes.Mouse)&&(F=null)):MouseInteractions[T]===MouseInteractions.Click&&(F=$,$=null);var q=legacy_isTouchEvent(O)?O.changedTouches[0]:O;if(q){var J=v.getId(B),ie=q.clientX,oe=q.clientY;callbackWrapper(u)(_extends({type:MouseInteractions[U],id:J,x:ie,y:oe},F!==null&&{pointerType:F}))}}}};return Object.keys(MouseInteractions).filter(function(T){return Number.isNaN(Number(T))&&!T.endsWith("_Departed")&&S[T]!==!1}).forEach(function(T){var O=toLowerCase(T),B=R(T);if(window.PointerEvent)switch(MouseInteractions[T]){case MouseInteractions.MouseDown:case MouseInteractions.MouseUp:O=O.replace("mouse","pointer");break;case MouseInteractions.TouchStart:case MouseInteractions.TouchEnd:return}A.push(on(O,B,g))}),callbackWrapper(function(){A.forEach(function(T){return T()})})}function initScrollObserver(y){var u=y.scrollCb,g=y.doc,v=y.mirror,b=y.blockClass,w=y.blockSelector,E=y.sampling,S=callbackWrapper(throttle(callbackWrapper(function(A){var $=getEventTarget(A);if(!(!$||isBlocked($,b,w,!0))){var R=v.getId($);if($===g&&g.defaultView){var T=getWindowScroll(g.defaultView);u({id:R,x:T.left,y:T.top})}else u({id:R,x:$.scrollLeft,y:$.scrollTop})}}),E.scroll||100));return on("scroll",S,g)}function initViewportResizeObserver(y,u){var g=y.viewportResizeCb,v=u.win,b=-1,w=-1,E=callbackWrapper(throttle(callbackWrapper(function(){var S=getWindowHeight(),A=getWindowWidth();(b!==S||w!==A)&&(g({width:Number(A),height:Number(S)}),b=S,w=A)}),200));return on("resize",E,v)}var INPUT_TAGS=["INPUT","TEXTAREA","SELECT"],lastInputValueMap=new WeakMap;function initInputObserver(y){var u=y.inputCb,g=y.doc,v=y.mirror,b=y.blockClass,w=y.blockSelector,E=y.ignoreClass,S=y.ignoreSelector,A=y.maskInputOptions,$=y.maskInputFn,R=y.sampling,T=y.userTriggeredOnInput;function O(le){var de=getEventTarget(le),fe=le.isTrusted,ye=de&&de.tagName;if(de&&ye==="OPTION"&&(de=index.parentElement(de)),!(!de||!ye||INPUT_TAGS.indexOf(ye)<0||isBlocked(de,b,w,!0))&&!(de.classList.contains(E)||S&&de.matches(S))){var we=de.value,pe=!1,ve=getInputType(de)||"";ve==="radio"||ve==="checkbox"?pe=de.checked:(A[ye.toLowerCase()]||A[ve])&&(we=maskInputValue({element:de,maskInputOptions:A,tagName:ye,type:ve,value:we,maskInputFn:$})),B(de,T?{text:we,isChecked:pe,userTriggered:fe}:{text:we,isChecked:pe});var he=de.name;ve==="radio"&&he&&pe&&g.querySelectorAll('input[type="radio"][name="'+he+'"]').forEach(function(ae){if(ae!==de){var Q=ae.value;B(ae,T?{text:Q,isChecked:!pe,userTriggered:!1}:{text:Q,isChecked:!pe})}})}}function B(le,de){var fe=lastInputValueMap.get(le);if(!fe||fe.text!==de.text||fe.isChecked!==de.isChecked){lastInputValueMap.set(le,de);var ye=v.getId(le);callbackWrapper(u)(_extends({},de,{id:ye}))}}var F=R.input==="last"?["change"]:["input","change"],U=F.map(function(le){return on(le,callbackWrapper(O),g)}),q=g.defaultView;if(!q)return function(){U.forEach(function(le){return le()})};var J=q.Object.getOwnPropertyDescriptor(q.HTMLInputElement.prototype,"value"),ie=[[q.HTMLInputElement.prototype,"value"],[q.HTMLInputElement.prototype,"checked"],[q.HTMLSelectElement.prototype,"value"],[q.HTMLTextAreaElement.prototype,"value"],[q.HTMLSelectElement.prototype,"selectedIndex"],[q.HTMLOptionElement.prototype,"selected"]];if(J&&J.set){var oe;(oe=U).push.apply(oe,[].concat(ie.map(function(le){return hookSetter(le[0],le[1],{set:function(){callbackWrapper(O)({target:this,isTrusted:!1})}},!1,q)})))}return callbackWrapper(function(){U.forEach(function(le){return le()})})}function getNestedCSSRulePositions(y){var u=[];function g(v,b){if(hasNestedCSSRule("CSSGroupingRule")&&_instanceof(v.parentRule,CSSGroupingRule)||hasNestedCSSRule("CSSMediaRule")&&_instanceof(v.parentRule,CSSMediaRule)||hasNestedCSSRule("CSSSupportsRule")&&_instanceof(v.parentRule,CSSSupportsRule)||hasNestedCSSRule("CSSConditionRule")&&_instanceof(v.parentRule,CSSConditionRule)){var w=Array.from(v.parentRule.cssRules),E=w.indexOf(v);b.unshift(E)}else if(v.parentStyleSheet){var S=Array.from(v.parentStyleSheet.cssRules),A=S.indexOf(v);b.unshift(A)}return b}return g(y,u)}function getIdAndStyleId(y,u,g){var v,b;return y?(y.ownerNode?v=u.getId(y.ownerNode):b=g.getId(y),{styleId:b,id:v}):{}}function initStyleSheetObserver(y,u){var g=y.styleSheetRuleCb,v=y.mirror,b=y.stylesheetManager,w=u.win;if(!w.CSSStyleSheet||!w.CSSStyleSheet.prototype)return function(){};var E=w.CSSStyleSheet.prototype.insertRule;w.CSSStyleSheet.prototype.insertRule=new Proxy(E,{apply:callbackWrapper(function(O,B,F){var U=F[0],q=F[1],J=getIdAndStyleId(B,v,b.styleMirror),ie=J.id,oe=J.styleId;return(ie&&ie!==-1||oe&&oe!==-1)&&g({id:ie,styleId:oe,adds:[{rule:U,index:q}]}),O.apply(B,F)})}),w.CSSStyleSheet.prototype.addRule=function(O,B,F){F===void 0&&(F=this.cssRules.length);var U=O+" { "+B+" }";return w.CSSStyleSheet.prototype.insertRule.apply(this,[U,F])};var S=w.CSSStyleSheet.prototype.deleteRule;w.CSSStyleSheet.prototype.deleteRule=new Proxy(S,{apply:callbackWrapper(function(O,B,F){var U=F[0],q=getIdAndStyleId(B,v,b.styleMirror),J=q.id,ie=q.styleId;return(J&&J!==-1||ie&&ie!==-1)&&g({id:J,styleId:ie,removes:[{index:U}]}),O.apply(B,F)})}),w.CSSStyleSheet.prototype.removeRule=function(O){return w.CSSStyleSheet.prototype.deleteRule.apply(this,[O])};var A;w.CSSStyleSheet.prototype.replace&&(A=w.CSSStyleSheet.prototype.replace,w.CSSStyleSheet.prototype.replace=new Proxy(A,{apply:callbackWrapper(function(O,B,F){var U=F[0],q=getIdAndStyleId(B,v,b.styleMirror),J=q.id,ie=q.styleId;return(J&&J!==-1||ie&&ie!==-1)&&g({id:J,styleId:ie,replace:U}),O.apply(B,F)})}));var $;w.CSSStyleSheet.prototype.replaceSync&&($=w.CSSStyleSheet.prototype.replaceSync,w.CSSStyleSheet.prototype.replaceSync=new Proxy($,{apply:callbackWrapper(function(O,B,F){var U=F[0],q=getIdAndStyleId(B,v,b.styleMirror),J=q.id,ie=q.styleId;return(J&&J!==-1||ie&&ie!==-1)&&g({id:J,styleId:ie,replaceSync:U}),O.apply(B,F)})}));var R={};canMonkeyPatchNestedCSSRule("CSSGroupingRule")?R.CSSGroupingRule=w.CSSGroupingRule:(canMonkeyPatchNestedCSSRule("CSSMediaRule")&&(R.CSSMediaRule=w.CSSMediaRule),canMonkeyPatchNestedCSSRule("CSSConditionRule")&&(R.CSSConditionRule=w.CSSConditionRule),canMonkeyPatchNestedCSSRule("CSSSupportsRule")&&(R.CSSSupportsRule=w.CSSSupportsRule));var T={};return Object.entries(R).forEach(function(O){var B=O[0],F=O[1];T[B]={insertRule:F.prototype.insertRule,deleteRule:F.prototype.deleteRule},F.prototype.insertRule=new Proxy(T[B].insertRule,{apply:callbackWrapper(function(U,q,J){var ie=J[0],oe=J[1],le=getIdAndStyleId(q.parentStyleSheet,v,b.styleMirror),de=le.id,fe=le.styleId;return(de&&de!==-1||fe&&fe!==-1)&&g({id:de,styleId:fe,adds:[{rule:ie,index:[].concat(getNestedCSSRulePositions(q),[oe||0])}]}),U.apply(q,J)})}),F.prototype.deleteRule=new Proxy(T[B].deleteRule,{apply:callbackWrapper(function(U,q,J){var ie=J[0],oe=getIdAndStyleId(q.parentStyleSheet,v,b.styleMirror),le=oe.id,de=oe.styleId;return(le&&le!==-1||de&&de!==-1)&&g({id:le,styleId:de,removes:[{index:[].concat(getNestedCSSRulePositions(q),[ie])}]}),U.apply(q,J)})})}),callbackWrapper(function(){w.CSSStyleSheet.prototype.insertRule=E,w.CSSStyleSheet.prototype.deleteRule=S,A&&(w.CSSStyleSheet.prototype.replace=A),$&&(w.CSSStyleSheet.prototype.replaceSync=$),Object.entries(R).forEach(function(O){var B=O[0],F=O[1];F.prototype.insertRule=T[B].insertRule,F.prototype.deleteRule=T[B].deleteRule})})}function initAdoptedStyleSheetObserver(y,u){var g=y.mirror,v=y.stylesheetManager,b,w,E,S=null;u.nodeName==="#document"?S=g.getId(u):S=g.getId(index.host(u));var A=u.nodeName==="#document"?(b=u.defaultView)==null?void 0:b.Document:(E=(w=u.ownerDocument)==null?void 0:w.defaultView)==null?void 0:E.ShadowRoot,$=A?.prototype?Object.getOwnPropertyDescriptor(A?.prototype,"adoptedStyleSheets"):void 0;return S===null||S===-1||!A||!$?function(){}:(Object.defineProperty(u,"adoptedStyleSheets",{configurable:$.configurable,enumerable:$.enumerable,get:function(){var T;return(T=$.get)==null?void 0:T.call(this)},set:function(T){var O,B=(O=$.set)==null?void 0:O.call(this,T);if(S!==null&&S!==-1)try{v.adoptStyleSheets(T,S)}catch{}return B}}),callbackWrapper(function(){Object.defineProperty(u,"adoptedStyleSheets",{configurable:$.configurable,enumerable:$.enumerable,get:$.get,set:$.set})}))}function initStyleDeclarationObserver(y,u){var g=y.styleDeclarationCb,v=y.mirror,b=y.ignoreCSSAttributes,w=y.stylesheetManager,E=u.win,S=E.CSSStyleDeclaration.prototype.setProperty;E.CSSStyleDeclaration.prototype.setProperty=new Proxy(S,{apply:callbackWrapper(function($,R,T){var O,B=T[0],F=T[1],U=T[2];if(b.has(B))return S.apply(R,[B,F,U]);var q=getIdAndStyleId((O=R.parentRule)==null?void 0:O.parentStyleSheet,v,w.styleMirror),J=q.id,ie=q.styleId;return(J&&J!==-1||ie&&ie!==-1)&&g({id:J,styleId:ie,set:{property:B,value:F,priority:U},index:getNestedCSSRulePositions(R.parentRule)}),$.apply(R,T)})});var A=E.CSSStyleDeclaration.prototype.removeProperty;return E.CSSStyleDeclaration.prototype.removeProperty=new Proxy(A,{apply:callbackWrapper(function($,R,T){var O,B=T[0];if(b.has(B))return A.apply(R,[B]);var F=getIdAndStyleId((O=R.parentRule)==null?void 0:O.parentStyleSheet,v,w.styleMirror),U=F.id,q=F.styleId;return(U&&U!==-1||q&&q!==-1)&&g({id:U,styleId:q,remove:{property:B},index:getNestedCSSRulePositions(R.parentRule)}),$.apply(R,T)})}),callbackWrapper(function(){E.CSSStyleDeclaration.prototype.setProperty=S,E.CSSStyleDeclaration.prototype.removeProperty=A})}function initMediaInteractionObserver(y){var u=y.mediaInteractionCb,g=y.blockClass,v=y.blockSelector,b=y.mirror,w=y.sampling,E=y.doc,S=callbackWrapper(function($){return throttle(callbackWrapper(function(R){var T=getEventTarget(R);if(!(!T||isBlocked(T,g,v,!0))){var O=T.currentTime,B=T.volume,F=T.muted,U=T.playbackRate,q=T.loop;u({type:$,id:b.getId(T),currentTime:O,volume:B,muted:F,playbackRate:U,loop:q})}}),w.media||500)}),A=[on("play",S(MediaInteractions.Play),E),on("pause",S(MediaInteractions.Pause),E),on("seeked",S(MediaInteractions.Seeked),E),on("volumechange",S(MediaInteractions.VolumeChange),E),on("ratechange",S(MediaInteractions.RateChange),E)];return callbackWrapper(function(){A.forEach(function($){return $()})})}function initFontObserver(y){var u=y.fontCb,g=y.doc,v=g.defaultView;if(!v)return function(){};var b=[],w=new WeakMap,E=v.FontFace;v.FontFace=function($,R,T){var O=new E($,R,T);return w.set(O,{family:$,buffer:typeof R!="string",descriptors:T,fontSource:typeof R=="string"?R:JSON.stringify(Array.from(new Uint8Array(R)))}),O};var S=patch$2(g.fonts,"add",function(A){return function($){return setTimeout(callbackWrapper(function(){var R=w.get($);R&&(u(R),w.delete($))}),0),A.apply(this,[$])}});return b.push(function(){v.FontFace=E}),b.push(S),callbackWrapper(function(){b.forEach(function(A){return A()})})}function initSelectionObserver(y){var u=y.doc,g=y.mirror,v=y.blockClass,b=y.blockSelector,w=y.selectionCb,E=!0,S=callbackWrapper(function(){var A=u.getSelection();if(!(!A||E&&A?.isCollapsed)){E=A.isCollapsed||!1;for(var $=[],R=A.rangeCount||0,T=0;T<R;T++){var O=A.getRangeAt(T),B=O.startContainer,F=O.startOffset,U=O.endContainer,q=O.endOffset,J=isBlocked(B,v,b,!0)||isBlocked(U,v,b,!0);J||$.push({start:g.getId(B),startOffset:F,end:g.getId(U),endOffset:q})}w({ranges:$})}});return S(),on("selectionchange",S)}function initCustomElementObserver(y){var u=y.doc,g=y.customElementCb,v=u.defaultView;if(!v||!v.customElements)return function(){};var b=patch$2(v.customElements,"define",function(w){return function(E,S,A){try{g({define:{name:E}})}catch{console.warn("Custom element callback failed for "+E)}return w.apply(this,[E,S,A])}});return b}function mergeHooks(y,u){var g=y.mutationCb,v=y.mousemoveCb,b=y.mouseInteractionCb,w=y.scrollCb,E=y.viewportResizeCb,S=y.inputCb,A=y.mediaInteractionCb,$=y.styleSheetRuleCb,R=y.styleDeclarationCb,T=y.canvasMutationCb,O=y.fontCb,B=y.selectionCb,F=y.customElementCb;y.mutationCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.mutation){var ie;(ie=u).mutation.apply(ie,[].concat(q))}g.apply(void 0,[].concat(q))},y.mousemoveCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.mousemove){var ie;(ie=u).mousemove.apply(ie,[].concat(q))}v.apply(void 0,[].concat(q))},y.mouseInteractionCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.mouseInteraction){var ie;(ie=u).mouseInteraction.apply(ie,[].concat(q))}b.apply(void 0,[].concat(q))},y.scrollCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.scroll){var ie;(ie=u).scroll.apply(ie,[].concat(q))}w.apply(void 0,[].concat(q))},y.viewportResizeCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.viewportResize){var ie;(ie=u).viewportResize.apply(ie,[].concat(q))}E.apply(void 0,[].concat(q))},y.inputCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.input){var ie;(ie=u).input.apply(ie,[].concat(q))}S.apply(void 0,[].concat(q))},y.mediaInteractionCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.mediaInteaction){var ie;(ie=u).mediaInteaction.apply(ie,[].concat(q))}A.apply(void 0,[].concat(q))},y.styleSheetRuleCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.styleSheetRule){var ie;(ie=u).styleSheetRule.apply(ie,[].concat(q))}$.apply(void 0,[].concat(q))},y.styleDeclarationCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.styleDeclaration){var ie;(ie=u).styleDeclaration.apply(ie,[].concat(q))}R.apply(void 0,[].concat(q))},y.canvasMutationCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.canvasMutation){var ie;(ie=u).canvasMutation.apply(ie,[].concat(q))}T.apply(void 0,[].concat(q))},y.fontCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.font){var ie;(ie=u).font.apply(ie,[].concat(q))}O.apply(void 0,[].concat(q))},y.selectionCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.selection){var ie;(ie=u).selection.apply(ie,[].concat(q))}B.apply(void 0,[].concat(q))},y.customElementCb=function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];if(u.customElement){var ie;(ie=u).customElement.apply(ie,[].concat(q))}F.apply(void 0,[].concat(q))}}function initObservers(y,u){u===void 0&&(u={});var g=y.doc.defaultView;if(!g)return function(){};mergeHooks(y,u);var v;y.recordDOM&&(v=initMutationObserver(y,y.doc));var b=initMoveObserver(y),w=initMouseInteractionObserver(y),E=initScrollObserver(y),S=initViewportResizeObserver(y,{win:g}),A=initInputObserver(y),$=initMediaInteractionObserver(y),R=function(){},T=function(){},O=function(){},B=function(){};y.recordDOM&&(R=initStyleSheetObserver(y,{win:g}),T=initAdoptedStyleSheetObserver(y,y.doc),O=initStyleDeclarationObserver(y,{win:g}),y.collectFonts&&(B=initFontObserver(y)));for(var F=initSelectionObserver(y),U=initCustomElementObserver(y),q=[],J=_create_for_of_iterator_helper_loose(y.plugins),ie;!(ie=J()).done;){var oe=ie.value;q.push(oe.observer(oe.callback,g,oe.options))}return callbackWrapper(function(){mutationBuffers.forEach(function(le){return le.reset()}),v?.disconnect(),b(),w(),E(),S(),A(),$(),R(),T(),O(),B(),F(),U(),q.forEach(function(le){return le()})})}function hasNestedCSSRule(y){return typeof window[y]<"u"}function canMonkeyPatchNestedCSSRule(y){return!!(typeof window[y]<"u"&&window[y].prototype&&"insertRule"in window[y].prototype&&"deleteRule"in window[y].prototype)}var CrossOriginIframeMirror=(function(){function y(g){__publicField$1(this,"iframeIdToRemoteIdMap",new WeakMap),__publicField$1(this,"iframeRemoteIdToIdMap",new WeakMap),this.generateIdFn=g}var u=y.prototype;return u.getId=function(v,b,w,E){var S=w||this.getIdToRemoteIdMap(v),A=E||this.getRemoteIdToIdMap(v),$=S.get(b);return $||($=this.generateIdFn(),S.set(b,$),A.set($,b)),$},u.getIds=function(v,b){var w=this,E=this.getIdToRemoteIdMap(v),S=this.getRemoteIdToIdMap(v);return b.map(function(A){return w.getId(v,A,E,S)})},u.getRemoteId=function(v,b,w){var E=w||this.getRemoteIdToIdMap(v);if(typeof b!="number")return b;var S=E.get(b);return S||-1},u.getRemoteIds=function(v,b){var w=this,E=this.getRemoteIdToIdMap(v);return b.map(function(S){return w.getRemoteId(v,S,E)})},u.reset=function(v){if(!v){this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap;return}this.iframeIdToRemoteIdMap.delete(v),this.iframeRemoteIdToIdMap.delete(v)},u.getIdToRemoteIdMap=function(v){var b=this.iframeIdToRemoteIdMap.get(v);return b||(b=new Map,this.iframeIdToRemoteIdMap.set(v,b)),b},u.getRemoteIdToIdMap=function(v){var b=this.iframeRemoteIdToIdMap.get(v);return b||(b=new Map,this.iframeRemoteIdToIdMap.set(v,b)),b},y})(),IframeManager=(function(){function y(g){__publicField$1(this,"iframes",new WeakMap),__publicField$1(this,"crossOriginIframeMap",new WeakMap),__publicField$1(this,"crossOriginIframeMirror",new CrossOriginIframeMirror(genId)),__publicField$1(this,"crossOriginIframeStyleMirror"),__publicField$1(this,"crossOriginIframeRootIdMap",new WeakMap),__publicField$1(this,"mirror"),__publicField$1(this,"mutationCb"),__publicField$1(this,"wrappedEmit"),__publicField$1(this,"loadListener"),__publicField$1(this,"stylesheetManager"),__publicField$1(this,"recordCrossOriginIframes"),this.mutationCb=g.mutationCb,this.wrappedEmit=g.wrappedEmit,this.stylesheetManager=g.stylesheetManager,this.recordCrossOriginIframes=g.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new CrossOriginIframeMirror(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=g.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}var u=y.prototype;return u.addIframe=function(v){this.iframes.set(v,!0),v.contentWindow&&this.crossOriginIframeMap.set(v.contentWindow,v)},u.addLoadListener=function(v){this.loadListener=v},u.attachIframe=function(v,b){var w,E;this.mutationCb({adds:[{parentId:this.mirror.getId(v),nextId:null,node:b}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),this.recordCrossOriginIframes&&((w=v.contentWindow)==null||w.addEventListener("message",this.handleMessage.bind(this))),(E=this.loadListener)==null||E.call(this,v),v.contentDocument&&v.contentDocument.adoptedStyleSheets&&v.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(v.contentDocument.adoptedStyleSheets,this.mirror.getId(v.contentDocument))},u.handleMessage=function(v){var b=v;if(!(b.data.type!=="rrweb"||b.origin!==b.data.origin)){var w=v.source;if(w){var E=this.crossOriginIframeMap.get(v.source);if(E){var S=this.transformCrossOriginEvent(E,b.data.event);S&&this.wrappedEmit(S,b.data.isCheckout)}}}},u.transformCrossOriginEvent=function(v,b){var w=this,E;switch(b.type){case EventType.FullSnapshot:{this.crossOriginIframeMirror.reset(v),this.crossOriginIframeStyleMirror.reset(v),this.replaceIdOnNode(b.data.node,v);var S=b.data.node.id;return this.crossOriginIframeRootIdMap.set(v,S),this.patchRootIdOnNode(b.data.node,S),{timestamp:b.timestamp,type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.Mutation,adds:[{parentId:this.mirror.getId(v),nextId:null,node:b.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case EventType.Meta:case EventType.Load:case EventType.DomContentLoaded:return!1;case EventType.Plugin:return b;case EventType.Custom:return this.replaceIds(b.data.payload,v,["id","parentId","previousId","nextId"]),b;case EventType.IncrementalSnapshot:switch(b.data.source){case IncrementalSource.Mutation:return b.data.adds.forEach(function(A){w.replaceIds(A,v,["parentId","nextId","previousId"]),w.replaceIdOnNode(A.node,v);var $=w.crossOriginIframeRootIdMap.get(v);$&&w.patchRootIdOnNode(A.node,$)}),b.data.removes.forEach(function(A){w.replaceIds(A,v,["parentId","id"])}),b.data.attributes.forEach(function(A){w.replaceIds(A,v,["id"])}),b.data.texts.forEach(function(A){w.replaceIds(A,v,["id"])}),b;case IncrementalSource.Drag:case IncrementalSource.TouchMove:case IncrementalSource.MouseMove:return b.data.positions.forEach(function(A){w.replaceIds(A,v,["id"])}),b;case IncrementalSource.ViewportResize:return!1;case IncrementalSource.MediaInteraction:case IncrementalSource.MouseInteraction:case IncrementalSource.Scroll:case IncrementalSource.CanvasMutation:case IncrementalSource.Input:return this.replaceIds(b.data,v,["id"]),b;case IncrementalSource.StyleSheetRule:case IncrementalSource.StyleDeclaration:return this.replaceIds(b.data,v,["id"]),this.replaceStyleIds(b.data,v,["styleId"]),b;case IncrementalSource.Font:return b;case IncrementalSource.Selection:return b.data.ranges.forEach(function(A){w.replaceIds(A,v,["start","end"])}),b;case IncrementalSource.AdoptedStyleSheet:return this.replaceIds(b.data,v,["id"]),this.replaceStyleIds(b.data,v,["styleIds"]),(E=b.data.styles)==null||E.forEach(function(A){w.replaceStyleIds(A,v,["styleId"])}),b}}return!1},u.replace=function(v,b,w,E){for(var S=_create_for_of_iterator_helper_loose(E),A;!(A=S()).done;){var $=A.value;!Array.isArray(b[$])&&typeof b[$]!="number"||(Array.isArray(b[$])?b[$]=v.getIds(w,b[$]):b[$]=v.getId(w,b[$]))}return b},u.replaceIds=function(v,b,w){return this.replace(this.crossOriginIframeMirror,v,b,w)},u.replaceStyleIds=function(v,b,w){return this.replace(this.crossOriginIframeStyleMirror,v,b,w)},u.replaceIdOnNode=function(v,b){var w=this;this.replaceIds(v,b,["id","rootId"]),"childNodes"in v&&v.childNodes.forEach(function(E){w.replaceIdOnNode(E,b)})},u.patchRootIdOnNode=function(v,b){var w=this;v.type!==NodeType.Document&&!v.rootId&&(v.rootId=b),"childNodes"in v&&v.childNodes.forEach(function(E){w.patchRootIdOnNode(E,b)})},y})(),ShadowDomManager=(function(){function y(g){__publicField$1(this,"shadowDoms",new WeakSet),__publicField$1(this,"mutationCb"),__publicField$1(this,"scrollCb"),__publicField$1(this,"bypassOptions"),__publicField$1(this,"mirror"),__publicField$1(this,"restoreHandlers",[]),this.mutationCb=g.mutationCb,this.scrollCb=g.scrollCb,this.bypassOptions=g.bypassOptions,this.mirror=g.mirror,this.init()}var u=y.prototype;return u.init=function(){this.reset(),this.patchAttachShadow(Element,document)},u.addShadowRoot=function(v,b){var w=this;if(isNativeShadowDom(v)&&!this.shadowDoms.has(v)){this.shadowDoms.add(v);var E=initMutationObserver(_extends({},this.bypassOptions,{doc:b,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),v);this.restoreHandlers.push(function(){return E.disconnect()}),this.restoreHandlers.push(initScrollObserver(_extends({},this.bypassOptions,{scrollCb:this.scrollCb,doc:v,mirror:this.mirror}))),setTimeout(function(){v.adoptedStyleSheets&&v.adoptedStyleSheets.length>0&&w.bypassOptions.stylesheetManager.adoptStyleSheets(v.adoptedStyleSheets,w.mirror.getId(index.host(v))),w.restoreHandlers.push(initAdoptedStyleSheetObserver({mirror:w.mirror,stylesheetManager:w.bypassOptions.stylesheetManager},v))},0)}},u.observeAttachShadow=function(v){!v.contentWindow||!v.contentDocument||this.patchAttachShadow(v.contentWindow.Element,v.contentDocument)},u.patchAttachShadow=function(v,b){var w=this;this.restoreHandlers.push(patch$2(v.prototype,"attachShadow",function(E){return function(S){var A=E.call(this,S),$=index.shadowRoot(this);return $&&inDom(this)&&w.addShadowRoot($,b),A}}))},u.reset=function(){this.restoreHandlers.forEach(function(v){try{v()}catch{}}),this.restoreHandlers=[],this.shadowDoms=new WeakSet},y})(),chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var i$1=0;i$1<chars.length;i$1++)lookup[chars.charCodeAt(i$1)]=i$1;var encode=function y(u){var g=new Uint8Array(u),v,b=g.length,w="";for(v=0;v<b;v+=3)w+=chars[g[v]>>2],w+=chars[(g[v]&3)<<4|g[v+1]>>4],w+=chars[(g[v+1]&15)<<2|g[v+2]>>6],w+=chars[g[v+2]&63];return b%3===2?w=w.substring(0,w.length-1)+"=":b%3===1&&(w=w.substring(0,w.length-2)+"=="),w},canvasVarMap=new Map;function variableListFor$1(y,u){var g=canvasVarMap.get(y);return g||(g=new Map,canvasVarMap.set(y,g)),g.has(u)||g.set(u,[]),g.get(u)}var saveWebGLVar=function(y,u,g){if(!(!y||!(isInstanceOfWebGLObject(y,u)||(typeof y>"u"?"undefined":_type_of(y))==="object"))){var v=y.constructor.name,b=variableListFor$1(g,v),w=b.indexOf(y);return w===-1&&(w=b.length,b.push(y)),w}};function serializeArg(y,u,g){if(_instanceof(y,Array))return y.map(function(F){return serializeArg(F,u,g)});if(y===null)return y;if(_instanceof(y,Float32Array)||_instanceof(y,Float64Array)||_instanceof(y,Int32Array)||_instanceof(y,Uint32Array)||_instanceof(y,Uint8Array)||_instanceof(y,Uint16Array)||_instanceof(y,Int16Array)||_instanceof(y,Int8Array)||_instanceof(y,Uint8ClampedArray)){var v=y.constructor.name;return{rr_type:v,args:[Object.values(y)]}}else if(_instanceof(y,ArrayBuffer)){var b=y.constructor.name,w=encode(y);return{rr_type:b,base64:w}}else if(_instanceof(y,DataView)){var E=y.constructor.name;return{rr_type:E,args:[serializeArg(y.buffer,u,g),y.byteOffset,y.byteLength]}}else if(_instanceof(y,HTMLImageElement)){var S=y.constructor.name,A=y.src;return{rr_type:S,src:A}}else if(_instanceof(y,HTMLCanvasElement)){var $="HTMLImageElement",R=y.toDataURL();return{rr_type:$,src:R}}else if(_instanceof(y,ImageData)){var T=y.constructor.name;return{rr_type:T,args:[serializeArg(y.data,u,g),y.width,y.height]}}else if(isInstanceOfWebGLObject(y,u)||(typeof y>"u"?"undefined":_type_of(y))==="object"){var O=y.constructor.name,B=saveWebGLVar(y,u,g);return{rr_type:O,index:B}}return y}var serializeArgs=function(y,u,g){return y.map(function(v){return serializeArg(v,u,g)})},isInstanceOfWebGLObject=function(y,u){var g=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"],v=g.filter(function(b){return typeof u[b]=="function"});return!!v.find(function(b){return _instanceof(y,u[b])})};function initCanvas2DMutationObserver(y,u,g,v){for(var b=function(){var $=A.value;try{if(typeof u.CanvasRenderingContext2D.prototype[$]!="function")return"continue";var R=patch$2(u.CanvasRenderingContext2D.prototype,$,function(O){return function(){for(var B=this,F=arguments.length,U=new Array(F),q=0;q<F;q++)U[q]=arguments[q];return isBlocked(this.canvas,g,v,!0)||setTimeout(function(){var J=serializeArgs(U,u,B);y(B.canvas,{type:CanvasContext["2D"],property:$,args:J})},0),O.apply(this,U)}});w.push(R)}catch{var T=hookSetter(u.CanvasRenderingContext2D.prototype,$,{set:function(F){y(this.canvas,{type:CanvasContext["2D"],property:$,args:[F],setter:!0})}});w.push(T)}},w=[],E=Object.getOwnPropertyNames(u.CanvasRenderingContext2D.prototype),S=_create_for_of_iterator_helper_loose(E),A;!(A=S()).done;)b();return function(){w.forEach(function($){return $()})}}function getNormalizedContextName(y){return y==="experimental-webgl"?"webgl":y}function initCanvasContextObserver(y,u,g,v){var b=[];try{var w=patch$2(y.HTMLCanvasElement.prototype,"getContext",function(E){return function(S){for(var A=arguments.length,$=new Array(A>1?A-1:0),R=1;R<A;R++)$[R-1]=arguments[R];if(!isBlocked(this,u,g,!0)){var T=getNormalizedContextName(S);if("__context"in this||(this.__context=T),v&&["webgl","webgl2"].includes(T))if($[0]&&_type_of($[0])==="object"){var O=$[0];O.preserveDrawingBuffer||(O.preserveDrawingBuffer=!0)}else $.splice(0,1,{preserveDrawingBuffer:!0})}return E.apply(this,[].concat([S],$))}});b.push(w)}catch{console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return function(){b.forEach(function(E){return E()})}}function patchGLPrototype(y,u,g,v,b,w){for(var E=function(){var T=R.value;if(["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(T))return"continue";try{if(typeof y[T]!="function")return"continue";var O=patch$2(y,T,function(F){return function(){for(var U=arguments.length,q=new Array(U),J=0;J<U;J++)q[J]=arguments[J];var ie=F.apply(this,q);if(saveWebGLVar(ie,w,this),"tagName"in this.canvas&&!isBlocked(this.canvas,v,b,!0)){var oe=serializeArgs(q,w,this),le={type:u,property:T,args:oe};g(this.canvas,le)}return ie}});S.push(O)}catch{var B=hookSetter(y,T,{set:function(q){g(this.canvas,{type:u,property:T,args:[q],setter:!0})}});S.push(B)}},S=[],A=Object.getOwnPropertyNames(y),$=_create_for_of_iterator_helper_loose(A),R;!(R=$()).done;)E();return S}function initCanvasWebGLMutationObserver(y,u,g,v){var b,w=[];if((b=w).push.apply(b,[].concat(patchGLPrototype(u.WebGLRenderingContext.prototype,CanvasContext.WebGL,y,g,v,u))),typeof u.WebGL2RenderingContext<"u"){var E;(E=w).push.apply(E,[].concat(patchGLPrototype(u.WebGL2RenderingContext.prototype,CanvasContext.WebGL2,y,g,v,u)))}return function(){w.forEach(function(S){return S()})}}var encodedJs="KGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgY2hhcnMgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyI7CiAgdmFyIGxvb2t1cCA9IHR5cGVvZiBVaW50OEFycmF5ID09PSAidW5kZWZpbmVkIiA/IFtdIDogbmV3IFVpbnQ4QXJyYXkoMjU2KTsKICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYXJzLmxlbmd0aDsgaSsrKSB7CiAgICBsb29rdXBbY2hhcnMuY2hhckNvZGVBdChpKV0gPSBpOwogIH0KICB2YXIgZW5jb2RlID0gZnVuY3Rpb24oYXJyYXlidWZmZXIpIHsKICAgIHZhciBieXRlcyA9IG5ldyBVaW50OEFycmF5KGFycmF5YnVmZmVyKSwgaTIsIGxlbiA9IGJ5dGVzLmxlbmd0aCwgYmFzZTY0ID0gIiI7CiAgICBmb3IgKGkyID0gMDsgaTIgPCBsZW47IGkyICs9IDMpIHsKICAgICAgYmFzZTY0ICs9IGNoYXJzW2J5dGVzW2kyXSA+PiAyXTsKICAgICAgYmFzZTY0ICs9IGNoYXJzWyhieXRlc1tpMl0gJiAzKSA8PCA0IHwgYnl0ZXNbaTIgKyAxXSA+PiA0XTsKICAgICAgYmFzZTY0ICs9IGNoYXJzWyhieXRlc1tpMiArIDFdICYgMTUpIDw8IDIgfCBieXRlc1tpMiArIDJdID4+IDZdOwogICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaTIgKyAyXSAmIDYzXTsKICAgIH0KICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgIj0iOwogICAgfSBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgIj09IjsKICAgIH0KICAgIHJldHVybiBiYXNlNjQ7CiAgfTsKICBjb25zdCBsYXN0QmxvYk1hcCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICBhc3luYyBmdW5jdGlvbiBnZXRUcmFuc3BhcmVudEJsb2JGb3Iod2lkdGgsIGhlaWdodCwgZGF0YVVSTE9wdGlvbnMpIHsKICAgIGNvbnN0IGlkID0gYCR7d2lkdGh9LSR7aGVpZ2h0fWA7CiAgICBpZiAoIk9mZnNjcmVlbkNhbnZhcyIgaW4gZ2xvYmFsVGhpcykgewogICAgICBpZiAodHJhbnNwYXJlbnRCbG9iTWFwLmhhcyhpZCkpIHJldHVybiB0cmFuc3BhcmVudEJsb2JNYXAuZ2V0KGlkKTsKICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsKICAgICAgb2Zmc2NyZWVuLmdldENvbnRleHQoIjJkIik7CiAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBvZmZzY3JlZW4uY29udmVydFRvQmxvYihkYXRhVVJMT3B0aW9ucyk7CiAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgYmxvYi5hcnJheUJ1ZmZlcigpOwogICAgICBjb25zdCBiYXNlNjQgPSBlbmNvZGUoYXJyYXlCdWZmZXIpOwogICAgICB0cmFuc3BhcmVudEJsb2JNYXAuc2V0KGlkLCBiYXNlNjQpOwogICAgICByZXR1cm4gYmFzZTY0OwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICIiOwogICAgfQogIH0KICBjb25zdCB3b3JrZXIgPSBzZWxmOwogIHdvcmtlci5vbm1lc3NhZ2UgPSBhc3luYyBmdW5jdGlvbihlKSB7CiAgICBpZiAoIk9mZnNjcmVlbkNhbnZhcyIgaW4gZ2xvYmFsVGhpcykgewogICAgICBjb25zdCB7IGlkLCBiaXRtYXAsIHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zIH0gPSBlLmRhdGE7CiAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKAogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodCwKICAgICAgICBkYXRhVVJMT3B0aW9ucwogICAgICApOwogICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgICBjb25zdCBjdHggPSBvZmZzY3JlZW4uZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY3R4LmRyYXdJbWFnZShiaXRtYXAsIDAsIDApOwogICAgICBiaXRtYXAuY2xvc2UoKTsKICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IG9mZnNjcmVlbi5jb252ZXJ0VG9CbG9iKGRhdGFVUkxPcHRpb25zKTsKICAgICAgY29uc3QgdHlwZSA9IGJsb2IudHlwZTsKICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBibG9iLmFycmF5QnVmZmVyKCk7CiAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7CiAgICAgIGlmICghbGFzdEJsb2JNYXAuaGFzKGlkKSAmJiBhd2FpdCB0cmFuc3BhcmVudEJhc2U2NCA9PT0gYmFzZTY0KSB7CiAgICAgICAgbGFzdEJsb2JNYXAuc2V0KGlkLCBiYXNlNjQpOwogICAgICAgIHJldHVybiB3b3JrZXIucG9zdE1lc3NhZ2UoeyBpZCB9KTsKICAgICAgfQogICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KSByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7CiAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgaWQsCiAgICAgICAgdHlwZSwKICAgICAgICBiYXNlNjQsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH0pOwogICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsKICAgIH0KICB9Owp9KSgpOwovLyMgc291cmNlTWFwcGluZ1VSTD1pbWFnZS1iaXRtYXAtZGF0YS11cmwtd29ya2VyLUlKcEM3Z19iLmpzLm1hcAo=",decodeBase64=function(y){return Uint8Array.from(atob(y),function(u){return u.charCodeAt(0)})},blob=typeof window<"u"&&window.Blob&&new Blob([decodeBase64(encodedJs)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper(y){var u;try{if(u=blob&&(window.URL||window.webkitURL).createObjectURL(blob),!u)throw"";var g=new Worker(u,{name:y?.name});return g.addEventListener("error",function(){(window.URL||window.webkitURL).revokeObjectURL(u)}),g}catch{return new Worker("data:text/javascript;base64,"+encodedJs,{name:y?.name})}finally{u&&(window.URL||window.webkitURL).revokeObjectURL(u)}}var CanvasManager=(function(){function y(g){var v=this;__publicField$1(this,"pendingCanvasMutations",new Map),__publicField$1(this,"rafStamps",{latestId:0,invokeId:null}),__publicField$1(this,"mirror"),__publicField$1(this,"mutationCb"),__publicField$1(this,"resetObservers"),__publicField$1(this,"frozen",!1),__publicField$1(this,"locked",!1),__publicField$1(this,"processMutation",function(T,O){var B=v.rafStamps.invokeId&&v.rafStamps.latestId!==v.rafStamps.invokeId;(B||!v.rafStamps.invokeId)&&(v.rafStamps.invokeId=v.rafStamps.latestId),v.pendingCanvasMutations.has(T)||v.pendingCanvasMutations.set(T,[]),v.pendingCanvasMutations.get(T).push(O)});var b=g.sampling,w=b===void 0?"all":b,E=g.win,S=g.blockClass,A=g.blockSelector,$=g.recordCanvas,R=g.dataURLOptions;this.mutationCb=g.mutationCb,this.mirror=g.mirror,$&&w==="all"&&this.initCanvasMutationObserver(E,S,A),$&&typeof w=="number"&&this.initCanvasFPSObserver(w,E,S,A,{dataURLOptions:R})}var u=y.prototype;return u.reset=function(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()},u.freeze=function(){this.frozen=!0},u.unfreeze=function(){this.frozen=!1},u.lock=function(){this.locked=!0},u.unlock=function(){this.locked=!1},u.initCanvasFPSObserver=function(v,b,w,E,S){var A=this,$=initCanvasContextObserver(b,w,E,!0),R=new Map,T=new WorkerWrapper;T.onmessage=function(J){var ie=J.data.id;if(R.set(ie,!1),"base64"in J.data){var oe=J.data,le=oe.base64,de=oe.type,fe=oe.width,ye=oe.height;A.mutationCb({id:ie,type:CanvasContext["2D"],commands:[{property:"clearRect",args:[0,0,fe,ye]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:le}],type:de}]},0,0]}]})}};var O=1e3/v,B=0,F,U=function(){var J=[];return b.document.querySelectorAll("canvas").forEach(function(ie){isBlocked(ie,w,E,!0)||J.push(ie)}),J},q=function(J){if(B&&J-B<O){F=requestAnimationFrame(q);return}B=J;var ie=A;U().forEach(_async_to_generator(function(oe){var le,de,fe,ye;return _ts_generator(this,function(we){switch(we.label){case 0:return de=ie.mirror.getId(oe),R.get(de)?[2]:oe.width===0||oe.height===0?[2]:(R.set(de,!0),["webgl","webgl2"].includes(oe.__context)&&(fe=oe.getContext(oe.__context),((le=fe?.getContextAttributes())==null?void 0:le.preserveDrawingBuffer)===!1&&fe.clear(fe.COLOR_BUFFER_BIT)),[4,createImageBitmap(oe)]);case 1:return ye=we.sent(),T.postMessage({id:de,bitmap:ye,width:oe.width,height:oe.height,dataURLOptions:S.dataURLOptions},[ye]),[2]}})})),F=requestAnimationFrame(q)};F=requestAnimationFrame(q),this.resetObservers=function(){$(),cancelAnimationFrame(F)}},u.initCanvasMutationObserver=function(v,b,w){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();var E=initCanvasContextObserver(v,b,w,!1),S=initCanvas2DMutationObserver(this.processMutation.bind(this),v,b,w),A=initCanvasWebGLMutationObserver(this.processMutation.bind(this),v,b,w);this.resetObservers=function(){E(),S(),A()}},u.startPendingCanvasMutationFlusher=function(){var v=this;requestAnimationFrame(function(){return v.flushPendingCanvasMutations()})},u.startRAFTimestamping=function(){var v=this,b=function(w){v.rafStamps.latestId=w,requestAnimationFrame(b)};requestAnimationFrame(b)},u.flushPendingCanvasMutations=function(){var v=this;this.pendingCanvasMutations.forEach(function(b,w){var E=v.mirror.getId(w);v.flushPendingCanvasMutationFor(w,E)}),requestAnimationFrame(function(){return v.flushPendingCanvasMutations()})},u.flushPendingCanvasMutationFor=function(v,b){if(!(this.frozen||this.locked)){var w=this.pendingCanvasMutations.get(v);if(!(!w||b===-1)){var E=w.map(function(A){A.type;var $=_object_without_properties_loose(A,["type"]);return $}),S=w[0].type;this.mutationCb({id:b,type:S,commands:E}),this.pendingCanvasMutations.delete(v)}}},y})(),StylesheetManager=(function(){function y(g){__publicField$1(this,"trackedLinkElements",new WeakSet),__publicField$1(this,"mutationCb"),__publicField$1(this,"adoptedStyleSheetCb"),__publicField$1(this,"styleMirror",new StyleSheetMirror),this.mutationCb=g.mutationCb,this.adoptedStyleSheetCb=g.adoptedStyleSheetCb}var u=y.prototype;return u.attachLinkElement=function(v,b){"_cssText"in b.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:b.id,attributes:b.attributes}]}),this.trackLinkElement(v)},u.trackLinkElement=function(v){this.trackedLinkElements.has(v)||(this.trackedLinkElements.add(v),this.trackStylesheetInLinkElement(v))},u.adoptStyleSheets=function(v,b){var w,E=function(){var T=R.value,O=void 0;w.styleMirror.has(T)?O=w.styleMirror.getId(T):(O=w.styleMirror.add(T),A.push({styleId:O,rules:Array.from(T.rules||CSSRule,function(B,F){return{rule:stringifyRule(B,T.href),index:F}})})),S.styleIds.push(O)};if(v.length!==0){for(var S={id:b,styleIds:[]},A=[],$=_create_for_of_iterator_helper_loose(v),R;!(R=$()).done;)w=this,E();A.length>0&&(S.styles=A),this.adoptedStyleSheetCb(S)}},u.reset=function(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet},u.trackStylesheetInLinkElement=function(v){},y})(),ProcessedNodeManager=(function(){function y(){__publicField$1(this,"nodeMap",new WeakMap),__publicField$1(this,"active",!1)}var u=y.prototype;return u.inOtherBuffer=function(v,b){var w=this.nodeMap.get(v);return w&&Array.from(w).some(function(E){return E!==b})},u.add=function(v,b){var w=this;this.active||(this.active=!0,requestAnimationFrame(function(){w.nodeMap=new WeakMap,w.active=!1})),this.nodeMap.set(v,(this.nodeMap.get(v)||new Set).add(b))},u.destroy=function(){},y})(),wrappedEmit,takeFullSnapshot$1,canvasManager,recording=!1;try{if(Array.from([1],function(y){return y*2})[0]!==2){var cleanFrame=document.createElement("iframe");document.body.appendChild(cleanFrame),Array.from=((_a=cleanFrame.contentWindow)==null?void 0:_a.Array.from)||Array.from,document.body.removeChild(cleanFrame)}}catch(y){console.debug("Unable to override Array.from",y)}var mirror=createMirror$2();function record(y){y===void 0&&(y={});var u=y.emit,g=y.checkoutEveryNms,v=y.checkoutEveryNth,b=y.blockClass,w=b===void 0?"rr-block":b,E=y.blockSelector,S=E===void 0?null:E,A=y.ignoreClass,$=A===void 0?"rr-ignore":A,R=y.ignoreSelector,T=R===void 0?null:R,O=y.maskTextClass,B=O===void 0?"rr-mask":O,F=y.maskTextSelector,U=F===void 0?null:F,q=y.inlineStylesheet,J=q===void 0?!0:q,ie=y.maskAllInputs,oe=y.maskInputOptions,le=y.slimDOMOptions,de=y.maskInputFn,fe=y.maskTextFn,ye=y.hooks,we=y.packFn,pe=y.sampling,ve=pe===void 0?{}:pe,he=y.dataURLOptions,ae=he===void 0?{}:he,Q=y.mousemoveWait,j=y.recordDOM,z=j===void 0?!0:j,re=y.recordCanvas,Y=re===void 0?!1:re,te=y.recordCrossOriginIframes,ne=te===void 0?!1:te,se=y.recordAfter,ee=se===void 0?y.recordAfter==="DOMContentLoaded"?y.recordAfter:"load":se,Z=y.userTriggeredOnInput,ue=Z===void 0?!1:Z,_e=y.collectFonts,Re=_e===void 0?!1:_e,Ae=y.inlineImages,ge=Ae===void 0?!1:Ae,be=y.plugins,Te=y.keepIframeSrcFn,De=Te===void 0?function(){return!1}:Te,Ie=y.ignoreCSSAttributes,Se=Ie===void 0?new Set([]):Ie,Be=y.errorHandler;registerErrorHandler(Be);var Le=ne?window.parent===window:!0,qe=!1;if(!Le)try{window.parent.document&&(qe=!1)}catch{qe=!0}if(Le&&!u)throw new Error("emit function is required");if(!Le&&!qe)return function(){};Q!==void 0&&ve.mousemove===void 0&&(ve.mousemove=Q),mirror.reset();var Ke=ie===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0,hidden:!0}:oe!==void 0?oe:{password:!0},Ge=le===!0||le==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:le==="all",headMetaDescKeywords:le==="all",headTitleMutations:le==="all"}:le||{};polyfill$1();var Xe,ze=0,et=function(He){for(var Ve=_create_for_of_iterator_helper_loose(be||[]),dt;!(dt=Ve()).done;){var xt=dt.value;xt.eventProcessor&&(He=xt.eventProcessor(He))}return we&&!qe&&(He=we(He)),He};wrappedEmit=function(He,Ve){var dt,xt=He;if(xt.timestamp=nowTimestamp(),(dt=mutationBuffers[0])!=null&&dt.isFrozen()&&xt.type!==EventType.FullSnapshot&&!(xt.type===EventType.IncrementalSnapshot&&xt.data.source===IncrementalSource.Mutation)&&mutationBuffers.forEach(function(ht){return ht.unfreeze()}),Le)u?.(et(xt),Ve);else if(qe){var mt={type:"rrweb",event:et(xt),origin:window.location.origin,isCheckout:Ve};window.parent.postMessage(mt,"*")}if(xt.type===EventType.FullSnapshot)Xe=xt,ze=0;else if(xt.type===EventType.IncrementalSnapshot){if(xt.data.source===IncrementalSource.Mutation&&xt.data.isAttachIframe)return;ze++;var gt=v&&ze>=v,at=g&&xt.timestamp-Xe.timestamp>g;(gt||at)&&takeFullSnapshot$1(!0)}};for(var Ze=function(He){wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.Mutation},He)})},nt=function(He){return wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.Scroll},He)})},ut=function(He){return wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.CanvasMutation},He)})},ot=function(He){return wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.AdoptedStyleSheet},He)})},vt=new StylesheetManager({mutationCb:Ze,adoptedStyleSheetCb:ot}),bt=new IframeManager({mirror,mutationCb:Ze,stylesheetManager:vt,recordCrossOriginIframes:ne,wrappedEmit}),lt=_create_for_of_iterator_helper_loose(be||[]),kt;!(kt=lt()).done;){var Ct=kt.value;Ct.getMirror&&Ct.getMirror({nodeMirror:mirror,crossOriginIframeMirror:bt.crossOriginIframeMirror,crossOriginIframeStyleMirror:bt.crossOriginIframeStyleMirror})}var Me=new ProcessedNodeManager;canvasManager=new CanvasManager({recordCanvas:Y,mutationCb:ut,win:window,blockClass:w,blockSelector:S,mirror,sampling:ve.canvas,dataURLOptions:ae});var Ce=new ShadowDomManager({mutationCb:Ze,scrollCb:nt,bypassOptions:{blockClass:w,blockSelector:S,maskTextClass:B,maskTextSelector:U,inlineStylesheet:J,maskInputOptions:Ke,dataURLOptions:ae,maskTextFn:fe,maskInputFn:de,recordCanvas:Y,inlineImages:ge,sampling:ve,slimDOMOptions:Ge,iframeManager:bt,stylesheetManager:vt,canvasManager,keepIframeSrcFn:De,processedNodeManager:Me},mirror});takeFullSnapshot$1=function(He){if(He===void 0&&(He=!1),!!z){wrappedEmit({type:EventType.Meta,data:{href:window.location.href,width:getWindowWidth(),height:getWindowHeight()}},He),vt.reset(),Ce.init(),mutationBuffers.forEach(function(dt){return dt.lock()});var Ve=snapshot(document,{mirror,blockClass:w,blockSelector:S,maskTextClass:B,maskTextSelector:U,inlineStylesheet:J,maskAllInputs:Ke,maskTextFn:fe,maskInputFn:de,slimDOM:Ge,dataURLOptions:ae,recordCanvas:Y,inlineImages:ge,onSerialize:function(dt){isSerializedIframe(dt,mirror)&&bt.addIframe(dt),isSerializedStylesheet(dt,mirror)&&vt.trackLinkElement(dt),hasShadowRoot(dt)&&Ce.addShadowRoot(index.shadowRoot(dt),document)},onIframeLoad:function(dt,xt){bt.attachIframe(dt,xt),Ce.observeAttachShadow(dt)},onStylesheetLoad:function(dt,xt){vt.attachLinkElement(dt,xt)},keepIframeSrcFn:De});if(!Ve)return console.warn("Failed to snapshot the document");wrappedEmit({type:EventType.FullSnapshot,data:{node:Ve,initialOffset:getWindowScroll(window)}},He),mutationBuffers.forEach(function(dt){return dt.unlock()}),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&vt.adoptStyleSheets(document.adoptedStyleSheets,mirror.getId(document))}};try{var Ee=[],Pe=function(He){var Ve;return callbackWrapper(initObservers)({mutationCb:Ze,mousemoveCb:function(dt,xt){return wrappedEmit({type:EventType.IncrementalSnapshot,data:{source:xt,positions:dt}})},mouseInteractionCb:function(dt){return wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.MouseInteraction},dt)})},scrollCb:nt,viewportResizeCb:function(dt){return wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.ViewportResize},dt)})},inputCb:function(dt){return wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.Input},dt)})},mediaInteractionCb:function(dt){return wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.MediaInteraction},dt)})},styleSheetRuleCb:function(dt){return wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.StyleSheetRule},dt)})},styleDeclarationCb:function(dt){return wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.StyleDeclaration},dt)})},canvasMutationCb:ut,fontCb:function(dt){return wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.Font},dt)})},selectionCb:function(dt){wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.Selection},dt)})},customElementCb:function(dt){wrappedEmit({type:EventType.IncrementalSnapshot,data:_extends({source:IncrementalSource.CustomElement},dt)})},blockClass:w,ignoreClass:$,ignoreSelector:T,maskTextClass:B,maskTextSelector:U,maskInputOptions:Ke,inlineStylesheet:J,sampling:ve,recordDOM:z,recordCanvas:Y,inlineImages:ge,userTriggeredOnInput:ue,collectFonts:Re,doc:He,maskInputFn:de,maskTextFn:fe,keepIframeSrcFn:De,blockSelector:S,slimDOMOptions:Ge,dataURLOptions:ae,mirror,iframeManager:bt,stylesheetManager:vt,shadowDomManager:Ce,processedNodeManager:Me,canvasManager,ignoreCSSAttributes:Se,plugins:((Ve=be?.filter(function(dt){return dt.observer}))==null?void 0:Ve.map(function(dt){return{observer:dt.observer,options:dt.options,callback:function(xt){return wrappedEmit({type:EventType.Plugin,data:{plugin:dt.name,payload:xt}})}}}))||[]},ye)};bt.addLoadListener(function(He){try{Ee.push(Pe(He.contentDocument))}catch(Ve){console.warn(Ve)}});var je=function(){takeFullSnapshot$1(),Ee.push(Pe(document)),recording=!0};return document.readyState==="interactive"||document.readyState==="complete"?je():(Ee.push(on("DOMContentLoaded",function(){wrappedEmit({type:EventType.DomContentLoaded,data:{}}),ee==="DOMContentLoaded"&&je()})),Ee.push(on("load",function(){wrappedEmit({type:EventType.Load,data:{}}),ee==="load"&&je()},window))),function(){Ee.forEach(function(He){try{He()}catch(dt){var Ve=String(dt).toLowerCase();Ve.includes("cross-origin")||console.warn(dt)}}),Me.destroy(),recording=!1,unregisterErrorHandler()}}catch(He){console.warn(He)}}record.addCustomEvent=function(y,u){if(!recording)throw new Error("please add custom event after start recording");wrappedEmit({type:EventType.Custom,data:{tag:y,payload:u}})};record.freezePage=function(){mutationBuffers.forEach(function(y){return y.freeze()})};record.takeFullSnapshot=function(y){if(!recording)throw new Error("please take full snapshot after start recording");takeFullSnapshot$1(y)};record.mirror=mirror;var n;(function(y){y[y.NotStarted=0]="NotStarted",y[y.Running=1]="Running",y[y.Stopped=2]="Stopped"})(n||(n={}));record.addCustomEvent;record.freezePage;record.takeFullSnapshot;var __defProp=Object.defineProperty,__defNormalProp=function(y,u,g){return u in y?__defProp(y,u,{enumerable:!0,configurable:!0,writable:!0,value:g}):y[u]=g},__publicField=function(y,u,g){return __defNormalProp(y,(typeof u>"u"?"undefined":_type_of(u))!=="symbol"?u+"":u,g)};function patch(y,u,g){try{if(!(u in y))return function(){};var v=y[u],b=g(v);return typeof b=="function"&&(b.prototype=b.prototype||{},Object.defineProperties(b,{__rrweb_original__:{enumerable:!1,value:v}})),y[u]=b,function(){y[u]=v}}catch{return function(){}}}var StackFrame=(function(){function y(g){__publicField(this,"fileName"),__publicField(this,"functionName"),__publicField(this,"lineNumber"),__publicField(this,"columnNumber"),this.fileName=g.fileName||"",this.functionName=g.functionName||"",this.lineNumber=g.lineNumber,this.columnNumber=g.columnNumber}var u=y.prototype;return u.toString=function(){var v=this.lineNumber||"",b=this.columnNumber||"";return this.functionName?this.functionName+" ("+this.fileName+":"+v+":"+b+")":this.fileName+":"+v+":"+b},y})(),FIREFOX_SAFARI_STACK_REGEXP=/(^|@)\S+:\d+/,CHROME_IE_STACK_REGEXP=/^\s*at .*(\S+:\d+|\(native\))/m,SAFARI_NATIVE_CODE_REGEXP=/^(eval@)?(\[native code])?$/,ErrorStackParser={parse:function y(u){return u?typeof u.stacktrace<"u"||typeof u["opera#sourceloc"]<"u"?this.parseOpera(u):u.stack&&u.stack.match(CHROME_IE_STACK_REGEXP)?this.parseV8OrIE(u):u.stack?this.parseFFOrSafari(u):(console.warn("[console-record-plugin]: Failed to parse error object:",u),[]):[]},extractLocation:function y(u){if(u.indexOf(":")===-1)return[u];var g=/(.+?)(?::(\d+))?(?::(\d+))?$/,v=g.exec(u.replace(/[()]/g,""));if(!v)throw new Error("Cannot parse given url: "+u);return[v[1],v[2]||void 0,v[3]||void 0]},parseV8OrIE:function y(u){var g=u.stack.split(`
`).filter(function(v){return!!v.match(CHROME_IE_STACK_REGEXP)},this);return g.map(function(v){v.indexOf("(eval ")>-1&&(v=v.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(\),.*$)/g,""));var b=v.replace(/^\s+/,"").replace(/\(eval code/g,"("),w=b.match(/ (\((.+):(\d+):(\d+)\)$)/);b=w?b.replace(w[0],""):b;var E=b.split(/\s+/).slice(1),S=this.extractLocation(w?w[1]:E.pop()),A=E.join(" ")||void 0,$=["eval","<anonymous>"].indexOf(S[0])>-1?void 0:S[0];return new StackFrame({functionName:A,fileName:$,lineNumber:S[1],columnNumber:S[2]})},this)},parseFFOrSafari:function y(u){var g=u.stack.split(`
`).filter(function(v){return!v.match(SAFARI_NATIVE_CODE_REGEXP)},this);return g.map(function(v){if(v.indexOf(" > eval")>-1&&(v=v.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),v.indexOf("@")===-1&&v.indexOf(":")===-1)return new StackFrame({functionName:v});var b=/((.*".+"[^@]*)?[^@]*)(?:@)/,w=v.match(b),E=w&&w[1]?w[1]:void 0,S=this.extractLocation(v.replace(b,""));return new StackFrame({functionName:E,fileName:S[0],lineNumber:S[1],columnNumber:S[2]})},this)},parseOpera:function y(u){return!u.stacktrace||u.message.indexOf(`
`)>-1&&u.message.split(`
`).length>u.stacktrace.split(`
`).length?this.parseOpera9(u):u.stack?this.parseOpera11(u):this.parseOpera10(u)},parseOpera9:function y(u){for(var g=/Line (\d+).*script (?:in )?(\S+)/i,v=u.message.split(`
`),b=[],w=2,E=v.length;w<E;w+=2){var S=g.exec(v[w]);S&&b.push(new StackFrame({fileName:S[2],lineNumber:parseFloat(S[1])}))}return b},parseOpera10:function y(u){for(var g=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,v=u.stacktrace.split(`
`),b=[],w=0,E=v.length;w<E;w+=2){var S=g.exec(v[w]);S&&b.push(new StackFrame({functionName:S[3]||void 0,fileName:S[2],lineNumber:parseFloat(S[1])}))}return b},parseOpera11:function y(u){var g=u.stack.split(`
`).filter(function(v){return!!v.match(FIREFOX_SAFARI_STACK_REGEXP)&&!v.match(/^Error created at/)},this);return g.map(function(v){var b=v.split("@"),w=this.extractLocation(b.pop()),E=b.shift()||"",S=E.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;return new StackFrame({functionName:S,fileName:w[0],lineNumber:w[1],columnNumber:w[2]})},this)}};function pathToSelector(y){if(!y||!y.outerHTML)return"";for(var u="";y.parentElement;){var g=y.localName;if(!g)break;g=g.toLowerCase();var v=y.parentElement,b=[];if(v.children&&v.children.length>0)for(var w=0;w<v.children.length;w++){var E=v.children[w];E.localName&&E.localName.toLowerCase&&E.localName.toLowerCase()===g&&b.push(E)}b.length>1&&(g+=":eq("+b.indexOf(y)+")"),u=g+(u?">"+u:""),y=v}return u}function isObject(y){return Object.prototype.toString.call(y)==="[object Object]"}function isObjTooDeep(y,u){if(u===0)return!0;for(var g=Object.keys(y),v=_create_for_of_iterator_helper_loose(g),b;!(b=v()).done;){var w=b.value;if(isObject(y[w])&&isObjTooDeep(y[w],u-1))return!0}return!1}function stringify(y,u){var g={numOfKeysLimit:50,depthOfLimit:4};Object.assign(g,u);var v=[],b=[];return JSON.stringify(y,function(S,A){if(v.length>0){var $=v.indexOf(this);~$?v.splice($+1):v.push(this),~$?b.splice($,1/0,S):b.push(S),~v.indexOf(A)&&(v[0]===A?A="[Circular ~]":A="[Circular ~."+b.slice(0,v.indexOf(A)).join(".")+"]")}else v.push(A);if(A===null)return A;if(A===void 0)return"undefined";if(w(A))return E(A);if((typeof A>"u"?"undefined":_type_of(A))==="bigint")return A.toString()+"n";if(_instanceof(A,Event)){var R={};for(var T in A){var O=A[T];Array.isArray(O)?R[T]=pathToSelector(O.length?O[0]:null):R[T]=O}return R}else{if(_instanceof(A,Node))return _instanceof(A,HTMLElement)?A?A.outerHTML:"":A.nodeName;if(_instanceof(A,Error))return A.stack?A.stack+`
End of stack for Error object`:A.name+": "+A.message}return A});function w(S){return!!(isObject(S)&&Object.keys(S).length>g.numOfKeysLimit||typeof S=="function"||isObject(S)&&isObjTooDeep(S,g.depthOfLimit))}function E(S){var A=S.toString();return g.stringLengthLimit&&A.length>g.stringLengthLimit&&(A=""+A.slice(0,g.stringLengthLimit)+"..."),A}}var defaultLogOptions={level:["assert","clear","count","countReset","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","timeLog","trace","warn"],lengthThreshold:1e3,logger:"console"};function initLogObserver(y,u,g){var v=g?Object.assign({},defaultLogOptions,g):defaultLogOptions,b=v.logger;if(!b)return function(){};var w;typeof b=="string"?w=u[b]:w=b;var E=0,S=!1,A=[];if(v.level.includes("error")){var $=function(U){var q=U.message,J=U.error,ie=ErrorStackParser.parse(J).map(function(le){return le.toString()}),oe=[stringify(q,v.stringifyOptions)];y({level:"error",trace:ie,payload:oe})};u.addEventListener("error",$),A.push(function(){u.removeEventListener("error",$)});var R=function(U){var q,J;_instanceof(U.reason,Error)?(q=U.reason,J=[stringify("Uncaught (in promise) "+q.name+": "+q.message,v.stringifyOptions)]):(q=new Error,J=[stringify("Uncaught (in promise)",v.stringifyOptions),stringify(U.reason,v.stringifyOptions)]);var ie=ErrorStackParser.parse(q).map(function(oe){return oe.toString()});y({level:"error",trace:ie,payload:J})};u.addEventListener("unhandledrejection",R),A.push(function(){u.removeEventListener("unhandledrejection",R)})}for(var T=_create_for_of_iterator_helper_loose(v.level),O;!(O=T()).done;){var B=O.value;A.push(F(w,B))}return function(){A.forEach(function(U){return U()})};function F(U,q){var J=this;return U[q]?patch(U,q,function(ie){var oe=J;return function(){for(var le=arguments.length,de=new Array(le),fe=0;fe<le;fe++)de[fe]=arguments[fe];if(ie.apply(oe,de),!(q==="assert"&&de[0])&&!S){S=!0;try{var ye=ErrorStackParser.parse(new Error).map(function(ve){return ve.toString()}).splice(1),we=q==="assert"?de.slice(1):de,pe=we.map(function(ve){return stringify(ve,v.stringifyOptions)});E++,E<v.lengthThreshold?y({level:q,trace:ye,payload:pe}):E===v.lengthThreshold&&y({level:"warn",trace:[],payload:[stringify("The number of log records reached the threshold.")]})}catch(ve){ie.apply(void 0,[].concat(["rrweb logger error:",ve],de))}finally{S=!1}}}}):function(){}}}var PLUGIN_NAME="rrweb/console@1",getRecordConsolePlugin=function(y){return{name:PLUGIN_NAME,observer:initLogObserver,options:y}},setImmediate$1=win.setImmediate,builtInProp,cycle,schedulingQueue,ToString=Object.prototype.toString,timer=typeof setImmediate$1<"u"?function y(u){return setImmediate$1(u)}:setTimeout;try{Object.defineProperty({},"x",{}),builtInProp=function(u,g,v,b){return Object.defineProperty(u,g,{value:v,writable:!0,configurable:b!==!1})}}catch(y){builtInProp=function(g,v,b){return g[v]=b,g}}schedulingQueue=(function y(){var u,g,v;function b(w,E){this.fn=w,this.self=E,this.next=void 0}return{add:function(E,S){v=new b(E,S),g?g.next=v:u=v,g=v,v=void 0},drain:function(){var E=u;for(u=g=cycle=void 0;E;)E.fn.call(E.self),E=E.next}}})();function schedule(y,u){schedulingQueue.add(y,u),cycle||(cycle=timer(schedulingQueue.drain))}function isThenable(y){var u,g=typeof y;return y!==null&&(g==="object"||g==="function")&&(u=y.then),typeof u=="function"?u:!1}function notify(){for(var y=0;y<this.chain.length;y++)notifyIsolated(this,this.state===1?this.chain[y].success:this.chain[y].failure,this.chain[y]);this.chain.length=0}function notifyIsolated(y,u,g){var v,b;try{u===!1?g.reject(y.msg):(u===!0?v=y.msg:v=u.call(void 0,y.msg),v===g.promise?g.reject(TypeError("Promise-chain cycle")):(b=isThenable(v))?b.call(v,g.resolve,g.reject):g.resolve(v))}catch(w){g.reject(w)}}function resolve(y){var u,g=this;if(!g.triggered){g.triggered=!0,g.def&&(g=g.def);try{(u=isThenable(y))?schedule(function(){var v=new MakeDefWrapper(g);try{u.call(y,function(){resolve.apply(v,arguments)},function(){reject.apply(v,arguments)})}catch(b){reject.call(v,b)}}):(g.msg=y,g.state=1,g.chain.length>0&&schedule(notify,g))}catch(v){reject.call(new MakeDefWrapper(g),v)}}}function reject(y){var u=this;u.triggered||(u.triggered=!0,u.def&&(u=u.def),u.msg=y,u.state=2,u.chain.length>0&&schedule(notify,u))}function iteratePromises(y,u,g,v){for(var b=0;b<u.length;b++)(function(E){y.resolve(u[E]).then(function(A){g(E,A)},v)})(b)}function MakeDefWrapper(y){this.def=y,this.triggered=!1}function MakeDef(y){this.promise=y,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function NpoPromise(y){if(typeof y!="function")throw TypeError("Not a function");if(this.__NPO__!==0)throw TypeError("Not a promise");this.__NPO__=1;var u=new MakeDef(this);this.then=function(v,b){var w={success:typeof v=="function"?v:!0,failure:typeof b=="function"?b:!1};return w.promise=new this.constructor(function(S,A){if(typeof S!="function"||typeof A!="function")throw TypeError("Not a function");w.resolve=S,w.reject=A}),u.chain.push(w),u.state!==0&&schedule(notify,u),w.promise},this.catch=function(v){return this.then(void 0,v)};try{y.call(void 0,function(v){resolve.call(u,v)},function(v){reject.call(u,v)})}catch(g){reject.call(u,g)}}var PromisePrototype=builtInProp({},"constructor",NpoPromise,!1);NpoPromise.prototype=PromisePrototype;builtInProp(PromisePrototype,"__NPO__",0,!1);builtInProp(NpoPromise,"resolve",function y(u){var g=this;return u&&typeof u=="object"&&u.__NPO__===1?u:new g(function(b,w){if(typeof b!="function"||typeof w!="function")throw TypeError("Not a function");b(u)})});builtInProp(NpoPromise,"reject",function y(u){return new this(function(v,b){if(typeof v!="function"||typeof b!="function")throw TypeError("Not a function");b(u)})});builtInProp(NpoPromise,"all",function y(u){var g=this;return ToString.call(u)!=="[object Array]"?g.reject(TypeError("Not an array")):u.length===0?g.resolve([]):new g(function(b,w){if(typeof b!="function"||typeof w!="function")throw TypeError("Not a function");var E=u.length,S=Array(E),A=0;iteratePromises(g,u,function(R,T){S[R]=T,++A===E&&b(S)},w)})});builtInProp(NpoPromise,"race",function y(u){var g=this;return ToString.call(u)!=="[object Array]"?g.reject(TypeError("Not an array")):new g(function(b,w){if(typeof b!="function"||typeof w!="function")throw TypeError("Not a function");iteratePromises(g,u,function(S,A){b(A)},w)})});var PromisePolyfill;typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1?PromisePolyfill=Promise:PromisePolyfill=NpoPromise;var Config={DEBUG:!1,LIB_VERSION:"2.72.0"},MAX_RECORDING_MS=1440*60*1e3,MAX_VALUE_FOR_MIN_RECORDING_MS=8*1e3,ArrayProto=Array.prototype,FuncProto=Function.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,windowConsole=win.console,navigator$1=win.navigator,document$1=win.document,windowOpera=win.opera,screen=win.screen,userAgent=navigator$1.userAgent,nativeBind=FuncProto.bind,nativeForEach=ArrayProto.forEach,nativeIndexOf=ArrayProto.indexOf,nativeMap=ArrayProto.map,nativeIsArray=Array.isArray,breaker={},_={trim:function(y){return y.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},console$1={log:function(){if(Config.DEBUG&&!_.isUndefined(windowConsole)&&windowConsole)try{windowConsole.log.apply(windowConsole,arguments)}catch{_.each(arguments,function(u){windowConsole.log(u)})}},warn:function(){if(Config.DEBUG&&!_.isUndefined(windowConsole)&&windowConsole){var y=["Mixpanel warning:"].concat(_.toArray(arguments));try{windowConsole.warn.apply(windowConsole,y)}catch{_.each(y,function(g){windowConsole.warn(g)})}}},error:function(){if(Config.DEBUG&&!_.isUndefined(windowConsole)&&windowConsole){var y=["Mixpanel error:"].concat(_.toArray(arguments));try{windowConsole.error.apply(windowConsole,y)}catch{_.each(y,function(g){windowConsole.error(g)})}}},critical:function(){if(!_.isUndefined(windowConsole)&&windowConsole){var y=["Mixpanel error:"].concat(_.toArray(arguments));try{windowConsole.error.apply(windowConsole,y)}catch{_.each(y,function(g){windowConsole.error(g)})}}}},log_func_with_prefix=function(y,u){return function(){return arguments[0]="["+u+"] "+arguments[0],y.apply(console$1,arguments)}},console_with_prefix=function(y){return{log:log_func_with_prefix(console$1.log,y),error:log_func_with_prefix(console$1.error,y),critical:log_func_with_prefix(console$1.critical,y)}},safewrap=function(y){return function(){try{return y.apply(this,arguments)}catch(u){console$1.critical("Implementation error. Please turn on debug and contact support@mixpanel.com."),Config.DEBUG&&console$1.critical(u)}}},safewrapClass=function(y){var u=y.prototype;for(var g in u)typeof u[g]=="function"&&(u[g]=safewrap(u[g]))};_.bind=function(y,u){var g,v;if(nativeBind&&y.bind===nativeBind)return nativeBind.apply(y,slice.call(arguments,1));if(!_.isFunction(y))throw new TypeError;return g=slice.call(arguments,2),v=function(){if(!(this instanceof v))return y.apply(u,g.concat(slice.call(arguments)));var b={};b.prototype=y.prototype;var w=new b;b.prototype=null;var E=y.apply(w,g.concat(slice.call(arguments)));return Object(E)===E?E:w},v};_.each=function(y,u,g){if(y!=null){if(nativeForEach&&y.forEach===nativeForEach)y.forEach(u,g);else if(y.length===+y.length){for(var v=0,b=y.length;v<b;v++)if(v in y&&u.call(g,y[v],v,y)===breaker)return}else for(var w in y)if(hasOwnProperty.call(y,w)&&u.call(g,y[w],w,y)===breaker)return}};_.extend=function(y){return _.each(slice.call(arguments,1),function(u){for(var g in u)u[g]!==void 0&&(y[g]=u[g])}),y};_.isArray=nativeIsArray||function(y){return toString.call(y)==="[object Array]"};_.isFunction=function(y){try{return/^\s*\bfunction\b/.test(y)}catch{return!1}};_.isArguments=function(y){return!!(y&&hasOwnProperty.call(y,"callee"))};_.toArray=function(y){return y?y.toArray?y.toArray():_.isArray(y)||_.isArguments(y)?slice.call(y):_.values(y):[]};_.map=function(y,u,g){if(nativeMap&&y.map===nativeMap)return y.map(u,g);var v=[];return _.each(y,function(b){v.push(u.call(g,b))}),v};_.keys=function(y){var u=[];return y===null||_.each(y,function(g,v){u[u.length]=v}),u};_.values=function(y){var u=[];return y===null||_.each(y,function(g){u[u.length]=g}),u};_.include=function(y,u){var g=!1;return y===null?g:nativeIndexOf&&y.indexOf===nativeIndexOf?y.indexOf(u)!=-1:(_.each(y,function(v){if(g||(g=v===u))return breaker}),g)};_.includes=function(y,u){return y.indexOf(u)!==-1};_.inherit=function(y,u){return y.prototype=new u,y.prototype.constructor=y,y.superclass=u.prototype,y};_.isObject=function(y){return y===Object(y)&&!_.isArray(y)};_.isEmptyObject=function(y){if(_.isObject(y)){for(var u in y)if(hasOwnProperty.call(y,u))return!1;return!0}return!1};_.isUndefined=function(y){return y===void 0};_.isString=function(y){return toString.call(y)=="[object String]"};_.isDate=function(y){return toString.call(y)=="[object Date]"};_.isNumber=function(y){return toString.call(y)=="[object Number]"};_.isElement=function(y){return!!(y&&y.nodeType===1)};_.encodeDates=function(y){return _.each(y,function(u,g){_.isDate(u)?y[g]=_.formatDate(u):_.isObject(u)&&(y[g]=_.encodeDates(u))}),y};_.timestamp=function(){return Date.now=Date.now||function(){return+new Date},Date.now()};_.formatDate=function(y){function u(g){return g<10?"0"+g:g}return y.getUTCFullYear()+"-"+u(y.getUTCMonth()+1)+"-"+u(y.getUTCDate())+"T"+u(y.getUTCHours())+":"+u(y.getUTCMinutes())+":"+u(y.getUTCSeconds())};_.strip_empty_properties=function(y){var u={};return _.each(y,function(g,v){_.isString(g)&&g.length>0&&(u[v]=g)}),u};_.truncate=function(y,u){var g;return typeof y=="string"?g=y.slice(0,u):_.isArray(y)?(g=[],_.each(y,function(v){g.push(_.truncate(v,u))})):_.isObject(y)?(g={},_.each(y,function(v,b){g[b]=_.truncate(v,u)})):g=y,g};_.JSONEncode=(function(){return function(y){var u=y,g=function(b){var w=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,E={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return w.lastIndex=0,w.test(b)?'"'+b.replace(w,function(S){var A=E[S];return typeof A=="string"?A:"\\u"+("0000"+S.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'},v=function(b,w){var E="",S="    ",A=0,$="",R="",T=0,O=E,B=[],F=w[b];switch(F&&typeof F=="object"&&typeof F.toJSON=="function"&&(F=F.toJSON(b)),typeof F){case"string":return g(F);case"number":return isFinite(F)?String(F):"null";case"boolean":case"null":return String(F);case"object":if(!F)return"null";if(E+=S,B=[],toString.apply(F)==="[object Array]"){for(T=F.length,A=0;A<T;A+=1)B[A]=v(A,F)||"null";return R=B.length===0?"[]":E?`[
`+E+B.join(`,
`+E)+`
`+O+"]":"["+B.join(",")+"]",E=O,R}for($ in F)hasOwnProperty.call(F,$)&&(R=v($,F),R&&B.push(g($)+(E?": ":":")+R));return R=B.length===0?"{}":E?"{"+B.join(",")+O+"}":"{"+B.join(",")+"}",E=O,R}};return v("",{"":u})}})();_.JSONDecode=(function(){var y,u,g={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},v,b=function(B){var F=new SyntaxError(B);throw F.at=y,F.text=v,F},w=function(B){return B&&B!==u&&b("Expected '"+B+"' instead of '"+u+"'"),u=v.charAt(y),y+=1,u},E=function(){var B,F="";for(u==="-"&&(F="-",w("-"));u>="0"&&u<="9";)F+=u,w();if(u===".")for(F+=".";w()&&u>="0"&&u<="9";)F+=u;if(u==="e"||u==="E")for(F+=u,w(),(u==="-"||u==="+")&&(F+=u,w());u>="0"&&u<="9";)F+=u,w();if(B=+F,!isFinite(B))b("Bad number");else return B},S=function(){var B,F,U="",q;if(u==='"')for(;w();){if(u==='"')return w(),U;if(u==="\\")if(w(),u==="u"){for(q=0,F=0;F<4&&(B=parseInt(w(),16),!!isFinite(B));F+=1)q=q*16+B;U+=String.fromCharCode(q)}else if(typeof g[u]=="string")U+=g[u];else break;else U+=u}b("Bad string")},A=function(){for(;u&&u<=" ";)w()},$=function(){switch(u){case"t":return w("t"),w("r"),w("u"),w("e"),!0;case"f":return w("f"),w("a"),w("l"),w("s"),w("e"),!1;case"n":return w("n"),w("u"),w("l"),w("l"),null}b('Unexpected "'+u+'"')},R,T=function(){var B=[];if(u==="["){if(w("["),A(),u==="]")return w("]"),B;for(;u;){if(B.push(R()),A(),u==="]")return w("]"),B;w(","),A()}}b("Bad array")},O=function(){var B,F={};if(u==="{"){if(w("{"),A(),u==="}")return w("}"),F;for(;u;){if(B=S(),A(),w(":"),Object.hasOwnProperty.call(F,B)&&b('Duplicate key "'+B+'"'),F[B]=R(),A(),u==="}")return w("}"),F;w(","),A()}}b("Bad object")};return R=function(){switch(A(),u){case"{":return O();case"[":return T();case'"':return S();case"-":return E();default:return u>="0"&&u<="9"?E():$()}},function(B){var F;return v=B,y=0,u=" ",F=R(),A(),u&&b("Syntax error"),F}})();_.base64Encode=function(y){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g,v,b,w,E,S,A,$,R=0,T=0,O="",B=[];if(!y)return y;y=_.utf8Encode(y);do g=y.charCodeAt(R++),v=y.charCodeAt(R++),b=y.charCodeAt(R++),$=g<<16|v<<8|b,w=$>>18&63,E=$>>12&63,S=$>>6&63,A=$&63,B[T++]=u.charAt(w)+u.charAt(E)+u.charAt(S)+u.charAt(A);while(R<y.length);switch(O=B.join(""),y.length%3){case 1:O=O.slice(0,-2)+"==";break;case 2:O=O.slice(0,-1)+"=";break}return O};_.utf8Encode=function(y){y=(y+"").replace(/\r\n/g,`
`).replace(/\r/g,`
`);var u="",g,v,b=0,w;for(g=v=0,b=y.length,w=0;w<b;w++){var E=y.charCodeAt(w),S=null;E<128?v++:E>127&&E<2048?S=String.fromCharCode(E>>6|192,E&63|128):S=String.fromCharCode(E>>12|224,E>>6&63|128,E&63|128),S!==null&&(v>g&&(u+=y.substring(g,v)),u+=S,g=v=w+1)}return v>g&&(u+=y.substring(g,y.length)),u};_.UUID=function(){try{return win.crypto.randomUUID()}catch{for(var y=new Array(36),u=0;u<36;u++)y[u]=Math.floor(Math.random()*16);return y[14]=4,y[19]=y[19]&=-5,y[19]=y[19]|=8,y[8]=y[13]=y[18]=y[23]="-",_.map(y,function(v){return v.toString(16)}).join("")}};var BLOCKED_UA_STRS=["ahrefsbot","ahrefssiteaudit","amazonbot","baiduspider","bingbot","bingpreview","chrome-lighthouse","facebookexternal","petalbot","pinterest","screaming frog","yahoo! slurp","yandex","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google"];_.isBlockedUA=function(y){var u;for(y=y.toLowerCase(),u=0;u<BLOCKED_UA_STRS.length;u++)if(y.indexOf(BLOCKED_UA_STRS[u])!==-1)return!0;return!1};_.HTTPBuildQuery=function(y,u){var g,v,b=[];return _.isUndefined(u)&&(u="&"),_.each(y,function(w,E){g=encodeURIComponent(w.toString()),v=encodeURIComponent(E),b[b.length]=v+"="+g}),b.join(u)};_.getQueryParam=function(y,u){u=u.replace(/[[]/g,"\\[").replace(/[\]]/g,"\\]");var g="[\\?&]"+u+"=([^&#]*)",v=new RegExp(g),b=v.exec(y);if(b===null||b&&typeof b[1]!="string"&&b[1].length)return"";var w=b[1];try{w=decodeURIComponent(w)}catch{console$1.error("Skipping decoding for malformed query param: "+w)}return w.replace(/\+/g," ")};_.cookie={get:function(y){for(var u=y+"=",g=document$1.cookie.split(";"),v=0;v<g.length;v++){for(var b=g[v];b.charAt(0)==" ";)b=b.substring(1,b.length);if(b.indexOf(u)===0)return decodeURIComponent(b.substring(u.length,b.length))}return null},parse:function(y){var u;try{u=_.JSONDecode(_.cookie.get(y))||{}}catch{}return u},set_seconds:function(y,u,g,v,b,w,E){var S="",A="",$="";if(E)S="; domain="+E;else if(v){var R=extract_domain(document$1.location.hostname);S=R?"; domain=."+R:""}if(g){var T=new Date;T.setTime(T.getTime()+g*1e3),A="; expires="+T.toGMTString()}w&&(b=!0,$="; SameSite=None"),b&&($+="; secure"),document$1.cookie=y+"="+encodeURIComponent(u)+A+"; path=/"+S+$},set:function(y,u,g,v,b,w,E){var S="",A="",$="";if(E)S="; domain="+E;else if(v){var R=extract_domain(document$1.location.hostname);S=R?"; domain=."+R:""}if(g){var T=new Date;T.setTime(T.getTime()+g*24*60*60*1e3),A="; expires="+T.toGMTString()}w&&(b=!0,$="; SameSite=None"),b&&($+="; secure");var O=y+"="+encodeURIComponent(u)+A+"; path=/"+S+$;return document$1.cookie=O,O},remove:function(y,u,g){_.cookie.set(y,"",-1,u,!1,!1,g)}};var _testStorageSupported=function(y){var u=!0;try{var g="__mplss_"+cheap_guid(8),v="xyz";y.setItem(g,v),y.getItem(g)!==v&&(u=!1),y.removeItem(g)}catch{u=!1}return u},_localStorageSupported=null,localStorageSupported=function(y,u){return _localStorageSupported!==null&&!u?_localStorageSupported:_localStorageSupported=_testStorageSupported(y||win.localStorage)},_sessionStorageSupported=null,sessionStorageSupported=function(y,u){return _sessionStorageSupported!==null&&!u?_sessionStorageSupported:_sessionStorageSupported=_testStorageSupported(y||win.sessionStorage)};function _storageWrapper(y,u,g){var v=function(b){console$1.error(u+" error: "+b)};return{is_supported:function(b){var w=g(y,b);return w||console$1.error(u+" unsupported"),w},error:v,get:function(b){try{return y.getItem(b)}catch(w){v(w)}return null},parse:function(b){try{return _.JSONDecode(y.getItem(b))||{}}catch{}return null},set:function(b,w){try{y.setItem(b,w)}catch(E){v(E)}},remove:function(b){try{y.removeItem(b)}catch(w){v(w)}}}}_.localStorage=_storageWrapper(win.localStorage,"localStorage",localStorageSupported);_.sessionStorage=_storageWrapper(win.sessionStorage,"sessionStorage",sessionStorageSupported);_.register_event=(function(){var y=function(v,b,w,E,S){if(!v){console$1.error("No valid element provided to register_event");return}if(v.addEventListener&&!E)v.addEventListener(b,w,!!S);else{var A="on"+b,$=v[A];v[A]=u(v,w,$)}};function u(v,b,w){var E=function(S){if(S=S||g(win.event),!!S){var A=!0,$,R;return _.isFunction(w)&&($=w(S)),R=b.call(v,S),($===!1||R===!1)&&(A=!1),A}};return E}function g(v){return v&&(v.preventDefault=g.preventDefault,v.stopPropagation=g.stopPropagation),v}return g.preventDefault=function(){this.returnValue=!1},g.stopPropagation=function(){this.cancelBubble=!0},y})();var TOKEN_MATCH_REGEX=new RegExp('^(\\w*)\\[(\\w+)([=~\\|\\^\\$\\*]?)=?"?([^\\]"]*)"?\\]$');_.dom_query=(function(){function y(b){return b.all?b.all:b.getElementsByTagName("*")}var u=/[\t\r\n]/g;function g(b,w){var E=" "+w+" ";return(" "+b.className+" ").replace(u," ").indexOf(E)>=0}function v(b){if(!document$1.getElementsByTagName)return[];var w=b.split(" "),E,S,A,$,R,T,O,B,F,U,q=[document$1];for(T=0;T<w.length;T++){if(E=w[T].replace(/^\s+/,"").replace(/\s+$/,""),E.indexOf("#")>-1){S=E.split("#"),A=S[0];var J=S[1],ie=document$1.getElementById(J);if(!ie||A&&ie.nodeName.toLowerCase()!=A)return[];q=[ie];continue}if(E.indexOf(".")>-1){S=E.split("."),A=S[0];var oe=S[1];for(A||(A="*"),$=[],R=0,O=0;O<q.length;O++)for(A=="*"?F=y(q[O]):F=q[O].getElementsByTagName(A),B=0;B<F.length;B++)$[R++]=F[B];for(q=[],U=0,O=0;O<$.length;O++)$[O].className&&_.isString($[O].className)&&g($[O],oe)&&(q[U++]=$[O]);continue}var le=E.match(TOKEN_MATCH_REGEX);if(le){A=le[1];var de=le[2],fe=le[3],ye=le[4];for(A||(A="*"),$=[],R=0,O=0;O<q.length;O++)for(A=="*"?F=y(q[O]):F=q[O].getElementsByTagName(A),B=0;B<F.length;B++)$[R++]=F[B];q=[],U=0;var we;switch(fe){case"=":we=function(pe){return pe.getAttribute(de)==ye};break;case"~":we=function(pe){return pe.getAttribute(de).match(new RegExp("\\b"+ye+"\\b"))};break;case"|":we=function(pe){return pe.getAttribute(de).match(new RegExp("^"+ye+"-?"))};break;case"^":we=function(pe){return pe.getAttribute(de).indexOf(ye)===0};break;case"$":we=function(pe){return pe.getAttribute(de).lastIndexOf(ye)==pe.getAttribute(de).length-ye.length};break;case"*":we=function(pe){return pe.getAttribute(de).indexOf(ye)>-1};break;default:we=function(pe){return pe.getAttribute(de)}}for(q=[],U=0,O=0;O<$.length;O++)we($[O])&&(q[U++]=$[O]);continue}for(A=E,$=[],R=0,O=0;O<q.length;O++)for(F=q[O].getElementsByTagName(A),B=0;B<F.length;B++)$[R++]=F[B];q=$}return q}return function(b){return _.isElement(b)?[b]:_.isObject(b)&&!_.isUndefined(b.length)?b:v.call(this,b)}})();var CAMPAIGN_KEYWORDS=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","utm_id","utm_source_platform","utm_campaign_id","utm_creative_format","utm_marketing_tactic"],CLICK_IDS=["dclid","fbclid","gclid","ko_click_id","li_fat_id","msclkid","sccid","ttclid","twclid","wbraid"];_.info={campaignParams:function(y){var u="",g={};return _.each(CAMPAIGN_KEYWORDS,function(v){u=_.getQueryParam(document$1.URL,v),u.length?g[v]=u:y!==void 0&&(g[v]=y)}),g},clickParams:function(){var y="",u={};return _.each(CLICK_IDS,function(g){y=_.getQueryParam(document$1.URL,g),y.length&&(u[g]=y)}),u},marketingParams:function(){return _.extend(_.info.campaignParams(),_.info.clickParams())},searchEngine:function(y){return y.search("https?://(.*)google.([^/?]*)")===0?"google":y.search("https?://(.*)bing.com")===0?"bing":y.search("https?://(.*)yahoo.com")===0?"yahoo":y.search("https?://(.*)duckduckgo.com")===0?"duckduckgo":null},searchInfo:function(y){var u=_.info.searchEngine(y),g=u!="yahoo"?"q":"p",v={};if(u!==null){v.$search_engine=u;var b=_.getQueryParam(y,g);b.length&&(v.mp_keyword=b)}return v},browser:function(y,u,g){return u=u||"",g||_.includes(y," OPR/")?_.includes(y,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(y)?"BlackBerry":_.includes(y,"IEMobile")||_.includes(y,"WPDesktop")?"Internet Explorer Mobile":_.includes(y,"SamsungBrowser/")?"Samsung Internet":_.includes(y,"Edge")||_.includes(y,"Edg/")?"Microsoft Edge":_.includes(y,"FBIOS")?"Facebook Mobile":_.includes(y,"Whale/")?"Whale Browser":_.includes(y,"Chrome")?"Chrome":_.includes(y,"CriOS")?"Chrome iOS":_.includes(y,"UCWEB")||_.includes(y,"UCBrowser")?"UC Browser":_.includes(y,"FxiOS")?"Firefox iOS":_.includes(u,"Apple")?_.includes(y,"Mobile")?"Mobile Safari":"Safari":_.includes(y,"Android")?"Android Mobile":_.includes(y,"Konqueror")?"Konqueror":_.includes(y,"Firefox")?"Firefox":_.includes(y,"MSIE")||_.includes(y,"Trident/")?"Internet Explorer":_.includes(y,"Gecko")?"Mozilla":""},browserVersion:function(y,u,g){var v=_.info.browser(y,u,g),b={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge?\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Samsung Internet":/SamsungBrowser\/(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/,"Whale Browser":/Whale\/(\d+(\.\d+)?)/},w=b[v];if(w===void 0)return null;var E=y.match(w);return E?parseFloat(E[E.length-2]):null},os:function(){var y=userAgent;return/Windows/i.test(y)?/Phone/.test(y)||/WPDesktop/.test(y)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(y)?"iOS":/Android/.test(y)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(y)?"BlackBerry":/Mac/i.test(y)?"Mac OS X":/Linux/.test(y)?"Linux":/CrOS/.test(y)?"Chrome OS":""},device:function(y){return/Windows Phone/i.test(y)||/WPDesktop/.test(y)?"Windows Phone":/iPad/.test(y)?"iPad":/iPod/.test(y)?"iPod Touch":/iPhone/.test(y)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(y)?"BlackBerry":/Android/.test(y)?"Android":""},referringDomain:function(y){var u=y.split("/");return u.length>=3?u[2]:""},currentUrl:function(){return win.location.href},properties:function(y){return typeof y!="object"&&(y={}),_.extend(_.strip_empty_properties({$os:_.info.os(),$browser:_.info.browser(userAgent,navigator$1.vendor,windowOpera),$referrer:document$1.referrer,$referring_domain:_.info.referringDomain(document$1.referrer),$device:_.info.device(userAgent)}),{$current_url:_.info.currentUrl(),$browser_version:_.info.browserVersion(userAgent,navigator$1.vendor,windowOpera),$screen_height:screen.height,$screen_width:screen.width,mp_lib:"web",$lib_version:Config.LIB_VERSION,$insert_id:cheap_guid(),time:_.timestamp()/1e3},_.strip_empty_properties(y))},people_properties:function(){return _.extend(_.strip_empty_properties({$os:_.info.os(),$browser:_.info.browser(userAgent,navigator$1.vendor,windowOpera)}),{$browser_version:_.info.browserVersion(userAgent,navigator$1.vendor,windowOpera)})},mpPageViewProperties:function(){return _.strip_empty_properties({current_page_title:document$1.title,current_domain:win.location.hostname,current_url_path:win.location.pathname,current_url_protocol:win.location.protocol,current_url_search:win.location.search})}};var batchedThrottle=function(y,u){var g=null,v=[];return function(b){var w=this;return v.push(b),g||(g=new PromisePolyfill(function(E){setTimeout(function(){var S=y.apply(w,[v]);g=null,v=[],E(S)},u)})),g}},cheap_guid=function(y){var u=Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10);return y?u.substring(0,y):u},generateTraceparent=function(){var y=_.UUID().replace(/-/g,""),u=_.UUID().replace(/-/g,"").substring(0,16),g="01";return"00-"+y+"-"+u+"-"+g},SIMPLE_DOMAIN_MATCH_REGEX=/[a-z0-9][a-z0-9-]*\.[a-z]+$/i,DOMAIN_MATCH_REGEX=/[a-z0-9][a-z0-9-]+\.[a-z.]{2,6}$/i,extract_domain=function(y){var u=DOMAIN_MATCH_REGEX,g=y.split("."),v=g[g.length-1];(v.length>4||v==="com"||v==="org")&&(u=SIMPLE_DOMAIN_MATCH_REGEX);var b=y.match(u);return b?b[0]:""},isOnline=function(){var y=win.navigator.onLine;return _.isUndefined(y)||y},NOOP_FUNC=function(){},JSONStringify=null,JSONParse=null;typeof JSON<"u"&&(JSONStringify=JSON.stringify,JSONParse=JSON.parse);JSONStringify=JSONStringify||_.JSONEncode;JSONParse=JSONParse||_.JSONDecode;var canUseCompressionStream=function(y,u,g){if(!win.CompressionStream)return!1;var v=_.info.browser(y,u,g),b=_.info.browserVersion(y,u,g);return!((v==="Safari"||v==="Mobile Safari")&&b>=16.4&&b<16.6)};_.info=_.info;_.info.browser=_.info.browser;_.info.browserVersion=_.info.browserVersion;_.info.device=_.info.device;_.info.properties=_.info.properties;_.isBlockedUA=_.isBlockedUA;_.isEmptyObject=_.isEmptyObject;_.isObject=_.isObject;_.JSONDecode=_.JSONDecode;_.JSONEncode=_.JSONEncode;_.toArray=_.toArray;_.NPO=NpoPromise;var MIXPANEL_DB_NAME="mixpanelBrowserDb",RECORDING_EVENTS_STORE_NAME="mixpanelRecordingEvents",RECORDING_REGISTRY_STORE_NAME="mixpanelRecordingRegistry",DB_VERSION=1,OBJECT_STORES=[RECORDING_EVENTS_STORE_NAME,RECORDING_REGISTRY_STORE_NAME],IDBStorageWrapper=function(y){this.dbPromise=null,this.storeName=y};IDBStorageWrapper.prototype._openDb=function(){return new PromisePolyfill(function(y,u){var g=win.indexedDB.open(MIXPANEL_DB_NAME,DB_VERSION);g.onerror=function(){u(g.error)},g.onsuccess=function(){y(g.result)},g.onupgradeneeded=function(v){var b=v.target.result;OBJECT_STORES.forEach(function(w){b.createObjectStore(w)})}})};IDBStorageWrapper.prototype.init=function(){return win.indexedDB?(this.dbPromise||(this.dbPromise=this._openDb()),this.dbPromise.then(function(y){return y instanceof win.IDBDatabase?PromisePolyfill.resolve():PromisePolyfill.reject(y)})):PromisePolyfill.reject("indexedDB is not supported in this browser")};IDBStorageWrapper.prototype.isInitialized=function(){return!!this.dbPromise};IDBStorageWrapper.prototype.makeTransaction=function(y,u){var g=this.storeName,v=function(b){return new PromisePolyfill(function(w,E){var S=b.transaction(g,y);S.oncomplete=function(){w(S)},S.onabort=S.onerror=function(){E(S.error)},u(S.objectStore(g))})};return this.dbPromise.then(v).catch((function(b){return b&&b.name==="InvalidStateError"?(this.dbPromise=this._openDb(),this.dbPromise.then(v)):PromisePolyfill.reject(b)}).bind(this))};IDBStorageWrapper.prototype.setItem=function(y,u){return this.makeTransaction("readwrite",function(g){g.put(u,y)})};IDBStorageWrapper.prototype.getItem=function(y){var u;return this.makeTransaction("readonly",function(g){u=g.get(y)}).then(function(){return u.result})};IDBStorageWrapper.prototype.removeItem=function(y){return this.makeTransaction("readwrite",function(u){u.delete(y)})};IDBStorageWrapper.prototype.getAll=function(){var y;return this.makeTransaction("readonly",function(u){y=u.getAll()}).then(function(){return y.result})};var GDPR_DEFAULT_PERSISTENCE_PREFIX="__mp_opt_in_out_";function optIn(y,u){_optInOut(!0,y,u)}function optOut(y,u){_optInOut(!1,y,u)}function hasOptedIn(y,u){return _getStorageValue(y,u)==="1"}function hasOptedOut(y,u){if(_hasDoNotTrackFlagOn(u))return console$1.warn('This browser has "Do Not Track" enabled. This will prevent the Mixpanel SDK from sending any data. To ignore the "Do Not Track" browser setting, initialize the Mixpanel instance with the config "ignore_dnt: true"'),!0;var g=_getStorageValue(y,u)==="0";return g&&console$1.warn("You are opted out of Mixpanel tracking. This will prevent the Mixpanel SDK from sending any data."),g}function addOptOutCheckMixpanelLib(y){return _addOptOutCheck(y,function(u){return this.get_config(u)})}function addOptOutCheckMixpanelPeople(y){return _addOptOutCheck(y,function(u){return this._get_config(u)})}function addOptOutCheckMixpanelGroup(y){return _addOptOutCheck(y,function(u){return this._get_config(u)})}function clearOptInOut(y,u){u=u||{},_getStorage(u).remove(_getStorageKey(y,u),!!u.crossSubdomainCookie,u.cookieDomain)}function _getStorage(y){return y=y||{},y.persistenceType==="localStorage"?_.localStorage:_.cookie}function _getStorageKey(y,u){return u=u||{},(u.persistencePrefix||GDPR_DEFAULT_PERSISTENCE_PREFIX)+y}function _getStorageValue(y,u){return _getStorage(u).get(_getStorageKey(y,u))}function _hasDoNotTrackFlagOn(y){if(y&&y.ignoreDnt)return!1;var u=y&&y.window||win,g=u.navigator||{},v=!1;return _.each([g.doNotTrack,g.msDoNotTrack,u.doNotTrack],function(b){_.includes([!0,1,"1","yes"],b)&&(v=!0)}),v}function _optInOut(y,u,g){if(!_.isString(u)||!u.length){console$1.error("gdpr."+(y?"optIn":"optOut")+" called with an invalid token");return}g=g||{},_getStorage(g).set(_getStorageKey(u,g),y?1:0,_.isNumber(g.cookieExpiration)?g.cookieExpiration:null,!!g.crossSubdomainCookie,!!g.secureCookie,!!g.crossSiteCookie,g.cookieDomain),g.track&&y&&g.track(g.trackEventName||"$opt_in",g.trackProperties,{send_immediately:!0})}function _addOptOutCheck(y,u){return function(){var g=!1;try{var v=u.call(this,"token"),b=u.call(this,"ignore_dnt"),w=u.call(this,"opt_out_tracking_persistence_type"),E=u.call(this,"opt_out_tracking_cookie_prefix"),S=u.call(this,"window");v&&(g=hasOptedOut(v,{ignoreDnt:b,persistenceType:w,persistencePrefix:E,window:S}))}catch($){console$1.error("Unexpected error when checking tracking opt-out status: "+$)}if(!g)return y.apply(this,arguments);var A=arguments[arguments.length-1];typeof A=="function"&&A(0)}}var logger$6=console_with_prefix("lock"),SharedLock=function(y,u){u=u||{},this.storageKey=y,this.storage=u.storage||win.localStorage,this.pollIntervalMS=u.pollIntervalMS||100,this.timeoutMS=u.timeoutMS||2e3,this.promiseImpl=u.promiseImpl||PromisePolyfill};SharedLock.prototype.withLock=function(y,u){var g=this.promiseImpl;return new g(_.bind(function(v,b){var w=u||new Date().getTime()+"|"+Math.random(),E=new Date().getTime(),S=this.storageKey,A=this.pollIntervalMS,$=this.timeoutMS,R=this.storage,T=S+":X",O=S+":Y",B=S+":Z",F=function(oe){if(new Date().getTime()-E>$){logger$6.error("Timeout waiting for mutex on "+S+"; clearing lock. ["+w+"]"),R.removeItem(B),R.removeItem(O),J();return}setTimeout(function(){try{oe()}catch(le){b(le)}},A*(Math.random()+.1))},U=function(oe,le){oe()?le():F(function(){U(oe,le)})},q=function(){var oe=R.getItem(O);return oe&&oe!==w?!1:(R.setItem(O,w),R.getItem(O)===w?!0:(localStorageSupported(R,!0)||b(new Error("localStorage support dropped while acquiring lock")),!1))},J=function(){R.setItem(T,w),U(q,function(){if(R.getItem(T)===w){ie();return}F(function(){if(R.getItem(O)!==w){J();return}U(function(){return!R.getItem(B)},ie)})})},ie=function(){R.setItem(B,"1");var oe=function(){R.removeItem(B),R.getItem(O)===w&&R.removeItem(O),R.getItem(T)===w&&R.removeItem(T)};y().then(function(le){oe(),v(le)}).catch(function(le){oe(),b(le)})};try{if(localStorageSupported(R,!0))J();else throw new Error("localStorage support check failed")}catch(oe){b(oe)}},this))};var LocalStorageWrapper=function(y){this.storage=y||win.localStorage};LocalStorageWrapper.prototype.init=function(){return PromisePolyfill.resolve()};LocalStorageWrapper.prototype.isInitialized=function(){return!0};LocalStorageWrapper.prototype.setItem=function(y,u){return new PromisePolyfill(_.bind(function(g,v){try{this.storage.setItem(y,JSONStringify(u))}catch(b){v(b)}g()},this))};LocalStorageWrapper.prototype.getItem=function(y){return new PromisePolyfill(_.bind(function(u,g){var v;try{v=JSONParse(this.storage.getItem(y))}catch(b){g(b)}u(v)},this))};LocalStorageWrapper.prototype.removeItem=function(y){return new PromisePolyfill(_.bind(function(u,g){try{this.storage.removeItem(y)}catch(v){g(v)}u()},this))};var logger$5=console_with_prefix("batch"),RequestQueue=function(y,u){u=u||{},this.storageKey=y,this.usePersistence=u.usePersistence,this.usePersistence&&(this.queueStorage=u.queueStorage||new LocalStorageWrapper,this.lock=new SharedLock(y,{storage:u.sharedLockStorage||win.localStorage,timeoutMS:u.sharedLockTimeoutMS})),this.reportError=u.errorReporter||_.bind(logger$5.error,logger$5),this.pid=u.pid||null,this.memQueue=[],this.initialized=!1,u.enqueueThrottleMs?this.enqueuePersisted=batchedThrottle(_.bind(this._enqueuePersisted,this),u.enqueueThrottleMs):this.enqueuePersisted=_.bind(function(g){return this._enqueuePersisted([g])},this)};RequestQueue.prototype.ensureInit=function(){return this.initialized||!this.usePersistence?PromisePolyfill.resolve():this.queueStorage.init().then(_.bind(function(){this.initialized=!0},this)).catch(_.bind(function(y){this.reportError("Error initializing queue persistence. Disabling persistence",y),this.initialized=!0,this.usePersistence=!1},this))};RequestQueue.prototype.enqueue=function(y,u){var g={id:cheap_guid(),flushAfter:new Date().getTime()+u*2,payload:y};return this.usePersistence?this.enqueuePersisted(g):(this.memQueue.push(g),PromisePolyfill.resolve(!0))};RequestQueue.prototype._enqueuePersisted=function(y){var u=_.bind(function(){return this.ensureInit().then(_.bind(function(){return this.readFromStorage()},this)).then(_.bind(function(g){return this.saveToStorage(g.concat(y))},this)).then(_.bind(function(g){return g&&(this.memQueue=this.memQueue.concat(y)),g},this)).catch(_.bind(function(g){return this.reportError("Error enqueueing items",g,y),!1},this))},this);return this.lock.withLock(u,this.pid).catch(_.bind(function(g){return this.reportError("Error acquiring storage lock",g),!1},this))};RequestQueue.prototype.fillBatch=function(y){var u=this.memQueue.slice(0,y);return this.usePersistence&&u.length<y?this.ensureInit().then(_.bind(function(){return this.readFromStorage()},this)).then(_.bind(function(g){if(g.length){var v={};_.each(u,function(E){v[E.id]=!0});for(var b=0;b<g.length;b++){var w=g[b];if(new Date().getTime()>w.flushAfter&&!v[w.id]&&(w.orphaned=!0,u.push(w),u.length>=y))break}}return u},this)):PromisePolyfill.resolve(u)};var filterOutIDsAndInvalid=function(y,u){var g=[];return _.each(y,function(v){v.id&&!u[v.id]&&g.push(v)}),g};RequestQueue.prototype.removeItemsByID=function(y){var u={};if(_.each(y,function(v){u[v]=!0}),this.memQueue=filterOutIDsAndInvalid(this.memQueue,u),this.usePersistence){var g=_.bind(function(){return this.ensureInit().then(_.bind(function(){return this.readFromStorage()},this)).then(_.bind(function(v){return v=filterOutIDsAndInvalid(v,u),this.saveToStorage(v)},this)).then(_.bind(function(){return this.readFromStorage()},this)).then(_.bind(function(v){for(var b=0;b<v.length;b++){var w=v[b];if(w.id&&u[w.id])throw new Error("Item not removed from storage")}return!0},this)).catch(_.bind(function(v){return this.reportError("Error removing items",v,y),!1},this))},this);return this.lock.withLock(g,this.pid).catch(_.bind(function(v){return this.reportError("Error acquiring storage lock",v),localStorageSupported(this.lock.storage,!0)?!1:g().then(_.bind(function(b){return b||this.queueStorage.removeItem(this.storageKey).then(function(){return b})},this)).catch(_.bind(function(b){return this.reportError("Error clearing queue",b),!1},this))},this))}else return PromisePolyfill.resolve(!0)};var updatePayloads=function(y,u){var g=[];return _.each(y,function(v){var b=v.id;if(b in u){var w=u[b];w!==null&&(v.payload=w,g.push(v))}else g.push(v)}),g};RequestQueue.prototype.updatePayloads=function(y){return this.memQueue=updatePayloads(this.memQueue,y),this.usePersistence?this.lock.withLock(_.bind(function(){return this.ensureInit().then(_.bind(function(){return this.readFromStorage()},this)).then(_.bind(function(g){return g=updatePayloads(g,y),this.saveToStorage(g)},this)).catch(_.bind(function(g){return this.reportError("Error updating items",y,g),!1},this))},this),this.pid).catch(_.bind(function(u){return this.reportError("Error acquiring storage lock",u),!1},this)):PromisePolyfill.resolve(!0)};RequestQueue.prototype.readFromStorage=function(){return this.ensureInit().then(_.bind(function(){return this.queueStorage.getItem(this.storageKey)},this)).then(_.bind(function(y){return y&&(_.isArray(y)||(this.reportError("Invalid storage entry:",y),y=null)),y||[]},this)).catch(_.bind(function(y){return this.reportError("Error retrieving queue",y),[]},this))};RequestQueue.prototype.saveToStorage=function(y){return this.ensureInit().then(_.bind(function(){return this.queueStorage.setItem(this.storageKey,y)},this)).then(function(){return!0}).catch(_.bind(function(u){return this.reportError("Error saving queue",u),!1},this))};RequestQueue.prototype.clear=function(){return this.memQueue=[],this.usePersistence?this.ensureInit().then(_.bind(function(){return this.queueStorage.removeItem(this.storageKey)},this)):PromisePolyfill.resolve()};var MAX_RETRY_INTERVAL_MS=600*1e3,logger$4=console_with_prefix("batch"),RequestBatcher=function(y,u){this.errorReporter=u.errorReporter,this.queue=new RequestQueue(y,{errorReporter:_.bind(this.reportError,this),queueStorage:u.queueStorage,sharedLockStorage:u.sharedLockStorage,sharedLockTimeoutMS:u.sharedLockTimeoutMS,usePersistence:u.usePersistence,enqueueThrottleMs:u.enqueueThrottleMs}),this.libConfig=u.libConfig,this.sendRequest=u.sendRequestFunc,this.beforeSendHook=u.beforeSendHook,this.stopAllBatching=u.stopAllBatchingFunc,this.batchSize=this.libConfig.batch_size,this.flushInterval=this.libConfig.batch_flush_interval_ms,this.stopped=!this.libConfig.batch_autostart,this.consecutiveRemovalFailures=0,this.itemIdsSentSuccessfully={},this.flushOnlyOnInterval=u.flushOnlyOnInterval||!1,this._flushPromise=null};RequestBatcher.prototype.enqueue=function(y){return this.queue.enqueue(y,this.flushInterval)};RequestBatcher.prototype.start=function(){return this.stopped=!1,this.consecutiveRemovalFailures=0,this.flush()};RequestBatcher.prototype.stop=function(){this.stopped=!0,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=null)};RequestBatcher.prototype.clear=function(){return this.queue.clear()};RequestBatcher.prototype.resetBatchSize=function(){this.batchSize=this.libConfig.batch_size};RequestBatcher.prototype.resetFlush=function(){this.scheduleFlush(this.libConfig.batch_flush_interval_ms)};RequestBatcher.prototype.scheduleFlush=function(y){this.flushInterval=y,this.stopped||(this.timeoutID=setTimeout(_.bind(function(){this.stopped||(this._flushPromise=this.flush())},this),this.flushInterval))};RequestBatcher.prototype.sendRequestPromise=function(y,u){return new PromisePolyfill(_.bind(function(g){this.sendRequest(y,u,g)},this))};RequestBatcher.prototype.flush=function(y){if(this.requestInProgress)return logger$4.log("Flush: Request already in progress"),PromisePolyfill.resolve();this.requestInProgress=!0,y=y||{};var u=this.libConfig.batch_request_timeout_ms,g=new Date().getTime(),v=this.batchSize;return this.queue.fillBatch(v).then(_.bind(function(b){var w=b.length===v,E=[],S={};if(_.each(b,function(T){var O=T.payload;if(this.beforeSendHook&&!T.orphaned&&(O=this.beforeSendHook(O)),O){O.event&&O.properties&&(O.properties=_.extend({},O.properties,{mp_sent_by_lib_version:Config.LIB_VERSION}));var B=!0,F=T.id;F?(this.itemIdsSentSuccessfully[F]||0)>5&&(this.reportError("[dupe] item ID sent too many times, not sending",{item:T,batchSize:b.length,timesSent:this.itemIdsSentSuccessfully[F]}),B=!1):this.reportError("[dupe] found item with no ID",{item:T}),B&&E.push(O)}S[T.id]=O},this),E.length<1)return this.requestInProgress=!1,this.resetFlush(),PromisePolyfill.resolve();var A=_.bind(function(){return this.queue.removeItemsByID(_.map(b,function(T){return T.id})).then(_.bind(function(T){return _.each(b,_.bind(function(O){var B=O.id;B?(this.itemIdsSentSuccessfully[B]=this.itemIdsSentSuccessfully[B]||0,this.itemIdsSentSuccessfully[B]++,this.itemIdsSentSuccessfully[B]>5&&this.reportError("[dupe] item ID sent too many times",{item:O,batchSize:b.length,timesSent:this.itemIdsSentSuccessfully[B]})):this.reportError("[dupe] found item with no ID while removing",{item:O})},this)),T?(this.consecutiveRemovalFailures=0,this.flushOnlyOnInterval&&!w?(this.resetFlush(),PromisePolyfill.resolve()):this.flush()):(++this.consecutiveRemovalFailures>5?(this.reportError("Too many queue failures; disabling batching system."),this.stopAllBatching()):this.resetFlush(),PromisePolyfill.resolve())},this))},this),$=_.bind(function(T){this.requestInProgress=!1;try{if(y.unloading)return this.queue.updatePayloads(S);if(_.isObject(T)&&T.error==="timeout"&&new Date().getTime()-g>=u)return this.reportError("Network timeout; retrying"),this.flush();if(_.isObject(T)&&(T.httpStatusCode>=500||T.httpStatusCode===429||T.httpStatusCode<=0&&!isOnline()||T.error==="timeout")){var O=this.flushInterval*2;return T.retryAfter&&(O=parseInt(T.retryAfter,10)*1e3||O),O=Math.min(MAX_RETRY_INTERVAL_MS,O),this.reportError("Error; retry in "+O+" ms"),this.scheduleFlush(O),PromisePolyfill.resolve()}else if(_.isObject(T)&&T.httpStatusCode===413)if(b.length>1){var B=Math.max(1,Math.floor(v/2));return this.batchSize=Math.min(this.batchSize,B,b.length-1),this.reportError("413 response; reducing batch size to "+this.batchSize),this.resetFlush(),PromisePolyfill.resolve()}else return this.reportError("Single-event request too large; dropping",b),this.resetBatchSize(),A();else return A()}catch(F){this.reportError("Error handling API response",F),this.resetFlush()}},this),R={method:"POST",verbose:!0,ignore_json_errors:!0,timeout_ms:u};return y.unloading&&(R.transport="sendBeacon"),logger$4.log("MIXPANEL REQUEST:",E),this.sendRequestPromise(E,R).then($)},this)).catch(_.bind(function(b){this.reportError("Error flushing request queue",b),this.resetFlush()},this))};RequestBatcher.prototype.reportError=function(y,u){if(logger$4.error.apply(logger$4.error,arguments),this.errorReporter)try{u instanceof Error||(u=new Error(y)),this.errorReporter(y,u)}catch(g){logger$4.error(g)}};var isRecordingExpired=function(y){var u=Date.now();return!y||u>y.maxExpires||u>y.idleExpires},RECORD_ENQUEUE_THROTTLE_MS=250,logger$3=console_with_prefix("recorder"),CompressionStream$1=win.CompressionStream,RECORDER_BATCHER_LIB_CONFIG={batch_size:1e3,batch_flush_interval_ms:10*1e3,batch_request_timeout_ms:90*1e3,batch_autostart:!0},ACTIVE_SOURCES=new Set([IncrementalSource.MouseMove,IncrementalSource.MouseInteraction,IncrementalSource.Scroll,IncrementalSource.ViewportResize,IncrementalSource.Input,IncrementalSource.TouchMove,IncrementalSource.MediaInteraction,IncrementalSource.Drag,IncrementalSource.Selection]);function isUserEvent(y){return y.type===EventType.IncrementalSnapshot&&ACTIVE_SOURCES.has(y.data.source)}var SessionRecording=function(y){this._mixpanel=y.mixpanelInstance,this._onIdleTimeout=y.onIdleTimeout||NOOP_FUNC,this._onMaxLengthReached=y.onMaxLengthReached||NOOP_FUNC,this._onBatchSent=y.onBatchSent||NOOP_FUNC,this._rrwebRecord=y.rrwebRecord||null,this._stopRecording=null,this.replayId=y.replayId,this.batchStartUrl=y.batchStartUrl||null,this.replayStartUrl=y.replayStartUrl||null,this.idleExpires=y.idleExpires||null,this.maxExpires=y.maxExpires||null,this.replayStartTime=y.replayStartTime||null,this.lastEventTimestamp=y.lastEventTimestamp||null,this.seqNo=y.seqNo||0,this.idleTimeoutId=null,this.maxTimeoutId=null,this.recordMaxMs=MAX_RECORDING_MS,this.recordMinMs=0;var u=localStorageSupported(y.sharedLockStorage,!0)&&!this.getConfig("disable_persistence");this.batcherKey="__mprec_"+this.getConfig("name")+"_"+this.getConfig("token")+"_"+this.replayId,this.queueStorage=new IDBStorageWrapper(RECORDING_EVENTS_STORE_NAME),this.batcher=new RequestBatcher(this.batcherKey,{errorReporter:this.reportError.bind(this),flushOnlyOnInterval:!0,libConfig:RECORDER_BATCHER_LIB_CONFIG,sendRequestFunc:this.flushEventsWithOptOut.bind(this),queueStorage:this.queueStorage,sharedLockStorage:y.sharedLockStorage,usePersistence:u,stopAllBatchingFunc:this.stopRecording.bind(this),enqueueThrottleMs:RECORD_ENQUEUE_THROTTLE_MS,sharedLockTimeoutMS:10*1e3})};SessionRecording.prototype.getUserIdInfo=function(){if(this.finalFlushUserIdInfo)return this.finalFlushUserIdInfo;var y={distinct_id:String(this._mixpanel.get_distinct_id())},u=this._mixpanel.get_property("$device_id");u&&(y.$device_id=u);var g=this._mixpanel.get_property("$user_id");return g&&(y.$user_id=g),y};SessionRecording.prototype.unloadPersistedData=function(){return this.batcher.stop(),this.queueStorage.init().catch((function(){this.reportError("Error initializing IndexedDB storage for unloading persisted data.")}).bind(this)).then((function(){return this.getDurationMs()<this._getRecordMinMs()?this.queueStorage.removeItem(this.batcherKey):this.batcher.flush().then((function(){return this.queueStorage.removeItem(this.batcherKey)}).bind(this))}).bind(this))};SessionRecording.prototype.getConfig=function(y){return this._mixpanel.get_config(y)};SessionRecording.prototype.get_config=function(y){return this.getConfig(y)};SessionRecording.prototype.startRecording=function(y){if(this._rrwebRecord===null){this.reportError("rrweb record function not provided. ");return}if(this._stopRecording!==null){logger$3.log("Recording already in progress, skipping startRecording.");return}this.recordMaxMs=this.getConfig("record_max_ms"),this.recordMaxMs>MAX_RECORDING_MS&&(this.recordMaxMs=MAX_RECORDING_MS,logger$3.critical("record_max_ms cannot be greater than "+MAX_RECORDING_MS+"ms. Capping value.")),this.maxExpires||(this.maxExpires=new Date().getTime()+this.recordMaxMs),this.recordMinMs=this._getRecordMinMs(),this.replayStartTime||(this.replayStartTime=new Date().getTime(),this.batchStartUrl=_.info.currentUrl(),this.replayStartUrl=_.info.currentUrl()),y||this.recordMinMs>0?this.batcher.stop():this.batcher.start();var u=(function(){clearTimeout(this.idleTimeoutId);var b=this.getConfig("record_idle_timeout_ms");this.idleTimeoutId=setTimeout(this._onIdleTimeout,b),this.idleExpires=new Date().getTime()+b}).bind(this);u();var g=this.getConfig("record_block_selector");(g===""||g===null)&&(g=void 0);try{this._stopRecording=this._rrwebRecord({emit:(function(b){if(this.idleExpires&&this.idleExpires<b.timestamp){this._onIdleTimeout();return}isUserEvent(b)&&(this.batcher.stopped&&new Date().getTime()-this.replayStartTime>=this.recordMinMs&&this.batcher.start(),u()),this.__enqueuePromise=this.batcher.enqueue(b),(this.lastEventTimestamp===null||b.timestamp>this.lastEventTimestamp)&&(this.lastEventTimestamp=b.timestamp)}).bind(this),blockClass:this.getConfig("record_block_class"),blockSelector:g,collectFonts:this.getConfig("record_collect_fonts"),dataURLOptions:{type:"image/webp",quality:.6},maskAllInputs:!0,maskTextClass:this.getConfig("record_mask_text_class"),maskTextSelector:this.getConfig("record_mask_text_selector"),recordCanvas:this.getConfig("record_canvas"),sampling:{canvas:15},plugins:this.getConfig("record_console")?[getRecordConsolePlugin({stringifyOptions:{stringLengthLimit:1e3,numOfKeysLimit:50,depthOfLimit:2}})]:[]})}catch(b){this.reportError("Unexpected error when starting rrweb recording.",b)}if(typeof this._stopRecording!="function"){this.reportError("rrweb failed to start, skipping this recording."),this._stopRecording=null,this.stopRecording();return}var v=this.maxExpires-new Date().getTime();this.maxTimeoutId=setTimeout(this._onMaxLengthReached.bind(this),v)};SessionRecording.prototype.stopRecording=function(y){if(this.finalFlushUserIdInfo=this.getUserIdInfo(),!this.isRrwebStopped()){try{this._stopRecording()}catch(g){this.reportError("Error with rrweb stopRecording",g)}this._stopRecording=null}var u;return this.batcher.stopped?u=this.batcher.clear():y||(u=this.batcher.flush()),this.batcher.stop(),clearTimeout(this.idleTimeoutId),clearTimeout(this.maxTimeoutId),u};SessionRecording.prototype.isRrwebStopped=function(){return this._stopRecording===null};SessionRecording.prototype.flushEventsWithOptOut=function(y,u,g){var v=(function(b){b===0&&(this.stopRecording(),g({error:"Tracking has been opted out, stopping recording."}))}).bind(this);this._flushEvents(y,u,g,v)};SessionRecording.prototype.serialize=function(){var y;try{y=this._mixpanel.get_tab_id()}catch(u){this.reportError("Error getting tab ID for serialization ",u),y=null}return{replayId:this.replayId,seqNo:this.seqNo,replayStartTime:this.replayStartTime,batchStartUrl:this.batchStartUrl,replayStartUrl:this.replayStartUrl,lastEventTimestamp:this.lastEventTimestamp,idleExpires:this.idleExpires,maxExpires:this.maxExpires,tabId:y}};SessionRecording.deserialize=function(y,u){var g=new SessionRecording(_.extend({},u,{replayId:y.replayId,batchStartUrl:y.batchStartUrl,replayStartUrl:y.replayStartUrl,idleExpires:y.idleExpires,maxExpires:y.maxExpires,replayStartTime:y.replayStartTime,lastEventTimestamp:y.lastEventTimestamp,seqNo:y.seqNo,sharedLockStorage:u.sharedLockStorage}));return g};SessionRecording.prototype._sendRequest=function(y,u,g,v){var b=(function(E,S){E.status===200&&this.replayId===y&&(this.seqNo++,this.batchStartUrl=_.info.currentUrl()),this._onBatchSent(),v({status:0,httpStatusCode:E.status,responseBody:S,retryAfter:E.headers.get("Retry-After")})}).bind(this),w=this._mixpanel.get_api_host&&this._mixpanel.get_api_host("record")||this.getConfig("api_host");win.fetch(w+"/"+this.getConfig("api_routes").record+"?"+new URLSearchParams(u),{method:"POST",headers:{Authorization:"Basic "+btoa(this.getConfig("token")+":"),"Content-Type":"application/octet-stream"},body:g}).then(function(E){E.json().then(function(S){b(E,S)}).catch(function(S){v({error:S})})}).catch(function(E){v({error:E,httpStatusCode:0})})};SessionRecording.prototype._flushEvents=addOptOutCheckMixpanelLib(function(y,u,g){var v=y.length;if(v>0){for(var b=this.replayId,w=1/0,E=-1/0,S=!1,A=0;A<v;A++)w=Math.min(w,y[A].timestamp),E=Math.max(E,y[A].timestamp),y[A].type===EventType.FullSnapshot&&(S=!0);if(this.seqNo===0){if(!S){g({error:"First batch does not contain a full snapshot. Aborting recording."}),this.stopRecording(!0);return}this.replayStartTime=w}else this.replayStartTime||(this.reportError("Replay start time not set but seqNo is not 0. Using current batch start time as a fallback."),this.replayStartTime=w);var $=E-this.replayStartTime,R={$current_url:this.batchStartUrl,$lib_version:Config.LIB_VERSION,batch_start_time:w/1e3,mp_lib:"web",replay_id:b,replay_length_ms:$,replay_start_time:this.replayStartTime/1e3,replay_start_url:this.replayStartUrl,seq:this.seqNo},T=JSON.stringify(y);if(Object.assign(R,this.getUserIdInfo()),canUseCompressionStream(userAgent,navigator$1.vendor,windowOpera)){var O=new Blob([T],{type:"application/json"}).stream(),B=O.pipeThrough(new CompressionStream$1("gzip"));new Response(B).blob().then((function(F){R.format="gzip",this._sendRequest(b,R,F,g)}).bind(this))}else R.format="body",this._sendRequest(b,R,T,g)}});SessionRecording.prototype.reportError=function(y,u){logger$3.error.apply(logger$3.error,arguments);try{!u&&!(y instanceof Error)&&(y=new Error(y)),this.getConfig("error_reporter")(y,u)}catch(g){logger$3.error(g)}};SessionRecording.prototype.getDurationMs=function(){return this.replayStartTime===null?0:this.lastEventTimestamp===null?new Date().getTime()-this.replayStartTime:this.lastEventTimestamp-this.replayStartTime};SessionRecording.prototype._getRecordMinMs=function(){var y=this.getConfig("record_min_ms");return y>MAX_VALUE_FOR_MIN_RECORDING_MS?(logger$3.critical("record_min_ms cannot be greater than "+MAX_VALUE_FOR_MIN_RECORDING_MS+"ms. Capping value."),MAX_VALUE_FOR_MIN_RECORDING_MS):y};var RecordingRegistry=function(y){this.idb=new IDBStorageWrapper(RECORDING_REGISTRY_STORE_NAME),this.errorReporter=y.errorReporter,this.mixpanelInstance=y.mixpanelInstance,this.sharedLockStorage=y.sharedLockStorage};RecordingRegistry.prototype.isPersistenceEnabled=function(){return!this.mixpanelInstance.get_config("disable_persistence")};RecordingRegistry.prototype.handleError=function(y){this.errorReporter("IndexedDB error: ",y)};RecordingRegistry.prototype.setActiveRecording=function(y){if(!this.isPersistenceEnabled())return PromisePolyfill.resolve();var u=y.tabId;return u?this.idb.init().then((function(){return this.idb.setItem(u,y)}).bind(this)).catch(this.handleError.bind(this)):(console.warn("No tab ID is set, cannot persist recording metadata."),PromisePolyfill.resolve())};RecordingRegistry.prototype.getActiveRecording=function(){return this.isPersistenceEnabled()?this.idb.init().then((function(){return this.idb.getItem(this.mixpanelInstance.get_tab_id())}).bind(this)).then((function(y){return isRecordingExpired(y)?null:y}).bind(this)).catch(this.handleError.bind(this)):PromisePolyfill.resolve(null)};RecordingRegistry.prototype.clearActiveRecording=function(){return this.isPersistenceEnabled()?this.markActiveRecordingExpired():this.deleteActiveRecording()};RecordingRegistry.prototype.markActiveRecordingExpired=function(){return this.getActiveRecording().then((function(y){if(y)return y.maxExpires=0,this.setActiveRecording(y)}).bind(this)).catch(this.handleError.bind(this))};RecordingRegistry.prototype.deleteActiveRecording=function(){return this.idb.isInitialized()?this.idb.removeItem(this.mixpanelInstance.get_tab_id()).catch(this.handleError.bind(this)):PromisePolyfill.resolve()};RecordingRegistry.prototype.flushInactiveRecordings=function(){return this.isPersistenceEnabled()?this.idb.init().then((function(){return this.idb.getAll()}).bind(this)).then((function(y){var u=y.filter(function(g){return isRecordingExpired(g)}).map((function(g){var v=SessionRecording.deserialize(g,{mixpanelInstance:this.mixpanelInstance,sharedLockStorage:this.sharedLockStorage});return v.unloadPersistedData().then((function(){return this.idb.removeItem(g.tabId)}).bind(this)).catch(this.handleError.bind(this))}).bind(this));return PromisePolyfill.all(u)}).bind(this)).catch(this.handleError.bind(this)):PromisePolyfill.resolve([])};var logger$2=console_with_prefix("recorder"),MixpanelRecorder=function(y,u,g){this.mixpanelInstance=y,this.rrwebRecord=u||record,this.sharedLockStorage=g,this.recordingRegistry=new RecordingRegistry({mixpanelInstance:this.mixpanelInstance,errorReporter:logger$2.error,sharedLockStorage:g}),this._flushInactivePromise=this.recordingRegistry.flushInactiveRecordings(),this.activeRecording=null,this.stopRecordingInProgress=!1};MixpanelRecorder.prototype.startRecording=function(y){if(y=y||{},this.activeRecording&&!this.activeRecording.isRrwebStopped()){logger$2.log("Recording already in progress, skipping startRecording.");return}var u=(function(){logger$2.log("Idle timeout reached, restarting recording."),this.resetRecording()}).bind(this),g=(function(){logger$2.log("Max recording length reached, stopping recording."),this.resetRecording()}).bind(this),v=(function(){this.recordingRegistry.setActiveRecording(this.activeRecording.serialize()),this.__flushPromise=this.activeRecording.batcher._flushPromise}).bind(this),b={mixpanelInstance:this.mixpanelInstance,onBatchSent:v,onIdleTimeout:u,onMaxLengthReached:g,replayId:_.UUID(),rrwebRecord:this.rrwebRecord,sharedLockStorage:this.sharedLockStorage};return y.activeSerializedRecording?this.activeRecording=SessionRecording.deserialize(y.activeSerializedRecording,b):this.activeRecording=new SessionRecording(b),this.activeRecording.startRecording(y.shouldStopBatcher),this.recordingRegistry.setActiveRecording(this.activeRecording.serialize())};MixpanelRecorder.prototype.stopRecording=function(){return this.stopRecordingInProgress=!0,this._stopCurrentRecording(!1,!0).then((function(){return this.recordingRegistry.clearActiveRecording()}).bind(this)).then((function(){this.stopRecordingInProgress=!1}).bind(this))};MixpanelRecorder.prototype.pauseRecording=function(){return this._stopCurrentRecording(!1)};MixpanelRecorder.prototype._stopCurrentRecording=function(y,u){if(this.activeRecording){var g=this.activeRecording.stopRecording(y);return u&&(this.activeRecording=null),g}return PromisePolyfill.resolve()};MixpanelRecorder.prototype.resumeRecording=function(y){return this.activeRecording&&this.activeRecording.isRrwebStopped()?(this.activeRecording.startRecording(!1),PromisePolyfill.resolve(null)):this.recordingRegistry.getActiveRecording().then((function(u){return u&&!this.stopRecordingInProgress?this.startRecording({activeSerializedRecording:u}):y?this.startRecording({shouldStopBatcher:!1}):(logger$2.log("No resumable recording found."),null)}).bind(this))};MixpanelRecorder.prototype.resetRecording=function(){this.stopRecording(),this.startRecording({shouldStopBatcher:!0})};MixpanelRecorder.prototype.getActiveReplayId=function(){return this.activeRecording&&!this.activeRecording.isRrwebStopped()?this.activeRecording.replayId:null};Object.defineProperty(MixpanelRecorder.prototype,"replayId",{get:function(){return this.getActiveReplayId()}});win.__mp_recorder=MixpanelRecorder;var EV_CHANGE="change",EV_CLICK="click",EV_HASHCHANGE="hashchange",EV_INPUT="input",EV_LOAD="load",EV_MP_LOCATION_CHANGE="mp_locationchange",EV_POPSTATE="popstate",EV_SCROLLEND="scrollend",EV_SCROLL="scroll",EV_SELECT="select",EV_SUBMIT="submit",EV_TOGGLE="toggle",EV_VISIBILITYCHANGE="visibilitychange",CLICK_EVENT_PROPS=["clientX","clientY","offsetX","offsetY","pageX","pageY","screenX","screenY","x","y"],OPT_IN_CLASSES=["mp-include"],OPT_OUT_CLASSES=["mp-no-track"],SENSITIVE_DATA_CLASSES=OPT_OUT_CLASSES.concat(["mp-sensitive"]),TRACKED_ATTRS=["aria-label","aria-labelledby","aria-describedby","href","name","role","title","type"],INTERACTIVE_ARIA_ROLES={button:!0,checkbox:!0,combobox:!0,grid:!0,link:!0,listbox:!0,menu:!0,menubar:!0,menuitem:!0,menuitemcheckbox:!0,menuitemradio:!0,navigation:!0,option:!0,radio:!0,radiogroup:!0,searchbox:!0,slider:!0,spinbutton:!0,switch:!0,tab:!0,tablist:!0,textbox:!0,tree:!0,treegrid:!0,treeitem:!0},ALWAYS_NON_INTERACTIVE_TAGS={base:!0,head:!0,html:!0,link:!0,meta:!0,script:!0,style:!0,title:!0,br:!0,hr:!0,wbr:!0,noscript:!0,picture:!0,source:!0,template:!0,track:!0},TEXT_CONTAINER_TAGS={article:!0,div:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,p:!0,section:!0,span:!0},EVENT_HANDLER_ATTRIBUTES=["onclick","onmousedown","onmouseup","onpointerdown","onpointerup","ontouchend","ontouchstart"],MAX_DEPTH=5,logger$1=console_with_prefix("autocapture");function getClasses(y){for(var u={},g=getClassName(y).split(" "),v=0;v<g.length;v++){var b=g[v];b&&(u[b]=!0)}return u}function getClassName(y){switch(typeof y.className){case"string":return y.className;case"object":return y.className.baseVal||y.getAttribute("class")||"";default:return""}}function getPreviousElementSibling(y){if(y.previousElementSibling)return y.previousElementSibling;do y=y.previousSibling;while(y&&!isElementNode(y));return y}function getPropertiesFromElement(y,u,g,v,b,w){var E={$classes:getClassName(y).split(" "),$tag_name:y.tagName.toLowerCase()},S=y.id;S&&(E.$id=S),shouldTrackElementDetails(y,u,b,w)&&_.each(TRACKED_ATTRS.concat(v),function(T){if(y.hasAttribute(T)&&!g[T]){var O=y.getAttribute(T);shouldTrackValue(O)&&(E["$attr-"+T]=O)}});for(var A=1,$=1,R=y;R=getPreviousElementSibling(R);)A++,R.tagName===y.tagName&&$++;return E.$nth_child=A,E.$nth_of_type=$,E}function getPropsForDOMEvent(y,u){var g=u.allowElementCallback,v=u.allowSelectors||[],b=u.blockAttrs||[],w=u.blockElementCallback,E=u.blockSelectors||[],S=u.captureTextContent||!1,A=u.captureExtraAttrs||[],$=u.capturedForHeatMap||!1,R={};_.each(b,function(de){R[de]=!0});var T=null,O=typeof y.target>"u"?y.srcElement:y.target;if(isTextNode(O)&&(O=O.parentNode),shouldTrackDomEvent(O,y)&&isElementAllowed(O,y,g,v)&&!isElementBlocked(O,y,w,E)){for(var B=[O],F=O;F.parentNode&&!isTag(F,"body");)B.push(F.parentNode),F=F.parentNode;var U=[],q,J=!1;if(_.each(B,function(de){var fe=shouldTrackElementDetails(de,y,g,v);!R.href&&de.tagName.toLowerCase()==="a"&&(q=de.getAttribute("href"),q=fe&&shouldTrackValue(q)&&q),isElementBlocked(de,y,w,E)&&(J=!0),U.push(getPropertiesFromElement(de,y,R,A,g,v))},this),!J){var ie=document$1.documentElement;if(T={$event_type:y.type,$host:win.location.host,$pathname:win.location.pathname,$elements:U,$el_attr__href:q,$viewportHeight:Math.max(ie.clientHeight,win.innerHeight||0),$viewportWidth:Math.max(ie.clientWidth,win.innerWidth||0),$pageHeight:document$1.body.offsetHeight||0,$pageWidth:document$1.body.offsetWidth||0},_.each(A,function(de){if(!R[de]&&O.hasAttribute(de)){var fe=O.getAttribute(de);shouldTrackValue(fe)&&(T["$el_attr__"+de]=fe)}}),S&&(oe=getSafeText(O,y,g,v),oe&&oe.length&&(T.$el_text=oe)),y.type===EV_CLICK&&(_.each(CLICK_EVENT_PROPS,function(de){de in y&&(T["$"+de]=y[de])}),$&&(T.$captured_for_heatmap=!0),O=guessRealClickTarget(y)),S){var oe=getSafeText(O,y,g,v);oe&&oe.length&&(T.$el_text=oe)}if(O){if(!isElementAllowed(O,y,g,v)||isElementBlocked(O,y,w,E))return null;var le=getPropertiesFromElement(O,y,R,A,g,v);T.$target=le,T.$el_classes=le.$classes,_.extend(T,_.strip_empty_properties({$el_id:le.$id,$el_tag_name:le.$tag_name}))}}}return T}function getSafeText(y,u,g,v){var b="";return shouldTrackElementDetails(y,u,g,v)&&y.childNodes&&y.childNodes.length&&_.each(y.childNodes,function(w){isTextNode(w)&&w.textContent&&(b+=_.trim(w.textContent).split(/(\s+)/).filter(shouldTrackValue).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255))}),_.trim(b)}function guessRealClickTarget(y){for(var u=y.target,g=y.composedPath(),v=0;v<g.length;v++){var b=g[v];if(isTag(b,"a")||isTag(b,"button")||isTag(b,"input")||isTag(b,"select")||b.getAttribute&&b.getAttribute("role")==="button"){u=b;break}if(b===u)break}return u}function isElementAllowed(y,u,g,v){if(g)try{if(!g(y,u))return!1}catch(E){return logger$1.critical("Error while checking element in allowElementCallback",E),!1}if(!v.length)return!0;for(var b=0;b<v.length;b++){var w=v[b];try{if(y.matches(w))return!0}catch(E){logger$1.critical("Error while checking selector: "+w,E)}}return!1}function isElementBlocked(y,u,g,v){var b;if(g)try{if(g(y,u))return!0}catch(S){return logger$1.critical("Error while checking element in blockElementCallback",S),!0}if(v&&v.length)for(b=0;b<v.length;b++){var w=v[b];try{if(y.matches(w))return!0}catch(S){logger$1.critical("Error while checking selector: "+w,S)}}var E=getClasses(y);for(b=0;b<OPT_OUT_CLASSES.length;b++)if(E[OPT_OUT_CLASSES[b]])return!0;return!1}function isElementNode(y){return y&&y.nodeType===1}function isTag(y,u){return y&&y.tagName&&y.tagName.toLowerCase()===u.toLowerCase()}function isTextNode(y){return y&&y.nodeType===3}function minDOMApisSupported(){try{var y=document$1.createElement("div");return!!y.matches}catch{return!1}}function weakSetSupported(){return typeof WeakSet<"u"}function shouldTrackDomEvent(y,u){if(!y||isTag(y,"html")||!isElementNode(y))return!1;var g=y.tagName.toLowerCase();switch(g){case"form":return u.type===EV_SUBMIT;case"input":return["button","submit"].indexOf(y.getAttribute("type"))===-1?u.type===EV_CHANGE:u.type===EV_CLICK;case"select":case"textarea":return u.type===EV_CHANGE;default:return u.type===EV_CLICK}}function shouldTrackElementDetails(y,u,g,v){var b;if(!isElementAllowed(y,u,g,v))return!1;for(var w=y;w.parentNode&&!isTag(w,"body");w=w.parentNode){var E=getClasses(w);for(b=0;b<SENSITIVE_DATA_CLASSES.length;b++)if(E[SENSITIVE_DATA_CLASSES[b]])return!1}var S=getClasses(y);for(b=0;b<OPT_IN_CLASSES.length;b++)if(S[OPT_IN_CLASSES[b]])return!0;if(isTag(y,"input")||isTag(y,"select")||isTag(y,"textarea")||y.getAttribute("contenteditable")==="true")return!1;var A=y.type||"";if(typeof A=="string")switch(A.toLowerCase()){case"hidden":return!1;case"password":return!1}var $=y.name||y.id||"";if(typeof $=="string"){var R=/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i;if(R.test($.replace(/[^a-zA-Z0-9]/g,"")))return!1}return!0}function shouldTrackValue(y){if(y===null||_.isUndefined(y))return!1;if(typeof y=="string"){y=_.trim(y);var u=/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/;if(u.test((y||"").replace(/[- ]/g,"")))return!1;var g=/(^\d{3}-?\d{2}-?\d{4}$)/;if(g.test(y))return!1}return!0}function getPolyfillScrollEndFunction(y){var u="onscrollend"in win,g=safewrap(y),v=EV_SCROLLEND;if(!u){var b=null,w=100;g=safewrap(function(){clearTimeout(b),b=setTimeout(y,w)}),v=EV_SCROLL}return{listener:g,eventType:v}}function hasInlineEventHandlers(y){for(var u=0;u<EVENT_HANDLER_ATTRIBUTES.length;u++)if(y.hasAttribute(EVENT_HANDLER_ATTRIBUTES[u]))return!0;return!1}function hasInteractiveAriaRole(y){var u=y.getAttribute("role");if(!u)return!1;var g=u.trim().split(/\s+/)[0].toLowerCase();return INTERACTIVE_ARIA_ROLES[g]}function hasAnyInteractivityIndicators(y){var u=y.tagName.toLowerCase();return!!(u==="button"||u==="input"||u==="select"||u==="textarea"||u==="details"||u==="dialog"||y.isContentEditable||y.onclick||y.onmousedown||y.onmouseup||y.ontouchstart||y.ontouchend||hasInlineEventHandlers(y)||hasInteractiveAriaRole(y)||u==="a"&&y.hasAttribute("href")||y.hasAttribute("tabindex"))}function isDefinitelyNonInteractive(y){if(!y||!y.tagName)return!0;var u=y.tagName.toLowerCase();if(ALWAYS_NON_INTERACTIVE_TAGS[u])return!0;if(hasAnyInteractivityIndicators(y))return!1;for(var g=y.parentElement,v=0;g&&v<MAX_DEPTH;){if(hasAnyInteractivityIndicators(g))return!1;if(g.getRootNode&&g.getRootNode()!==document$1){var b=g.getRootNode();if(b.host&&hasAnyInteractivityIndicators(b.host))return!1}g=g.parentElement,v++}return!!TEXT_CONTAINER_TAGS[u]}function getClickEventComposedPath(y){return"composedPath"in y?y.composedPath():[]}function getClickEventTargetElement(y){var u=getClickEventComposedPath(y);return u&&u.length>0?u[0]:y.target||y.srcElement}var DEFAULT_RAGE_CLICK_THRESHOLD_PX=30,DEFAULT_RAGE_CLICK_TIMEOUT_MS=1e3,DEFAULT_RAGE_CLICK_CLICK_COUNT=4,DEFAULT_RAGE_CLICK_INTERACTIVE_ELEMENTS_ONLY=!1;function RageClickTracker(){this.clicks=[]}RageClickTracker.prototype.isRageClick=function(y,u){u=u||{};var g=u.threshold_px||DEFAULT_RAGE_CLICK_THRESHOLD_PX,v=u.timeout_ms||DEFAULT_RAGE_CLICK_TIMEOUT_MS,b=u.click_count||DEFAULT_RAGE_CLICK_CLICK_COUNT,w=u.interactive_elements_only||DEFAULT_RAGE_CLICK_INTERACTIVE_ELEMENTS_ONLY;if(w){var E=getClickEventTargetElement(y);if(!E||isDefinitelyNonInteractive(E))return!1}var S=Date.now(),A=y.pageX,$=y.pageY,R=this.clicks[this.clicks.length-1];if(R&&S-R.timestamp<v&&Math.sqrt(Math.pow(A-R.x,2)+Math.pow($-R.y,2))<g){if(this.clicks.push({x:A,y:$,timestamp:S}),this.clicks.length>=b)return this.clicks=[],!0}else this.clicks=[{x:A,y:$,timestamp:S}];return!1};function ShadowDOMObserver(y,u){this.changeCallback=y||function(){},this.observerConfig=u,this.observedShadowRoots=null,this.shadowObservers=[]}ShadowDOMObserver.prototype.getEventTarget=function(y){if(this.observedShadowRoots)return getClickEventTargetElement(y)};ShadowDOMObserver.prototype.observeFromEvent=function(y){if(this.observedShadowRoots)for(var u=getClickEventComposedPath(y),g=0;g<u.length;g++){var v=u[g];v&&v.shadowRoot&&this.observeShadowRoot(v.shadowRoot)}};ShadowDOMObserver.prototype.observeShadowRoot=function(y){if(!(!this.observedShadowRoots||this.observedShadowRoots.has(y))){var u=this;try{this.observedShadowRoots.add(y);var g=new window.MutationObserver(function(){u.changeCallback()});g.observe(y,this.observerConfig),this.shadowObservers.push(g)}catch(v){logger$1.critical("Error while observing shadow root",v)}}};ShadowDOMObserver.prototype.start=function(){if(!this.observedShadowRoots){if(!weakSetSupported()){logger$1.critical("Shadow DOM observation unavailable: WeakSet not supported");return}this.observedShadowRoots=new WeakSet}};ShadowDOMObserver.prototype.stop=function(){if(this.observedShadowRoots){for(var y=0;y<this.shadowObservers.length;y++)try{this.shadowObservers[y].disconnect()}catch(u){logger$1.critical("Error while disconnecting shadow DOM observer",u)}this.shadowObservers=[],this.observedShadowRoots=null}};var DEFAULT_DEAD_CLICK_TIMEOUT_MS=500,INTERACTION_EVENTS=[EV_CHANGE,EV_INPUT,EV_SUBMIT,EV_SELECT,EV_TOGGLE],LAYOUT_EVENTS=[EV_SCROLLEND],NAVIGATION_EVENTS=[EV_HASHCHANGE],MUTATION_OBSERVER_CONFIG={characterData:!0,childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class","hidden","checked","selected","value","display","visibility"]};function DeadClickTracker(y){this.eventListeners=[],this.mutationObserver=null,this.shadowDOMObserver=null,this.isTracking=!1,this.lastChangeEventTimestamp=0,this.pendingClicks=[],this.onDeadClickCallback=y,this.processingActive=!1,this.processingTimeout=null}DeadClickTracker.prototype.addClick=function(y){var u=this.shadowDOMObserver&&this.shadowDOMObserver.getEventTarget(y);return u||(u=y.target||y.srcElement),!u||isDefinitelyNonInteractive(u)?!1:(this.shadowDOMObserver&&this.shadowDOMObserver.observeFromEvent(y),this.pendingClicks.push({element:u,event:y,timestamp:Date.now()}),!0)};DeadClickTracker.prototype.trackClick=function(y,u){if(!this.isTracking)return!1;var g=this.addClick(y);return g&&this.triggerProcessing(u),g};DeadClickTracker.prototype.getDeadClicks=function(y){if(this.pendingClicks.length===0)return[];var u=y.timeout_ms,g=Date.now(),v=this.pendingClicks.slice();this.pendingClicks=[];for(var b=[],w=0;w<v.length;w++){var E=v[w];g-E.timestamp>=u?this.hasChangesAfter(E.timestamp)||b.push(E):this.pendingClicks.push(E)}return b};DeadClickTracker.prototype.hasChangesAfter=function(y){return this.lastChangeEventTimestamp>=y-100};DeadClickTracker.prototype.recordChangeEvent=function(){this.lastChangeEventTimestamp=Date.now()};DeadClickTracker.prototype.triggerProcessing=function(y){this.processingActive||(this.processingActive=!0,this.processRecursively(y))};DeadClickTracker.prototype.processRecursively=function(y){if(!this.isTracking||!this.onDeadClickCallback){this.processingActive=!1;return}var u=y.timeout_ms,g=this;this.processingTimeout=setTimeout(function(){if(g.processingActive){for(var v=g.getDeadClicks(y),b=0;b<v.length;b++)g.onDeadClickCallback(v[b].event);g.pendingClicks.length>0?g.processRecursively(y):g.processingActive=!1}},u)};DeadClickTracker.prototype.startTracking=function(){if(!this.isTracking){this.isTracking=!0;var y=this;INTERACTION_EVENTS.forEach(function(g){var v=function(){y.recordChangeEvent()};document.addEventListener(g,v,{capture:!0,passive:!0}),y.eventListeners.push({target:document,event:g,handler:v,options:{capture:!0,passive:!0}})}),NAVIGATION_EVENTS.forEach(function(g){var v=function(){y.recordChangeEvent()};window.addEventListener(g,v),y.eventListeners.push({target:window,event:g,handler:v})}),LAYOUT_EVENTS.forEach(function(g){var v=function(){y.recordChangeEvent()};window.addEventListener(g,v,{passive:!0}),y.eventListeners.push({target:window,event:g,handler:v,options:{passive:!0}})});var u=function(){y.recordChangeEvent()};if(document.addEventListener("selectionchange",u),y.eventListeners.push({target:document,event:"selectionchange",handler:u}),window.MutationObserver)try{this.mutationObserver=new window.MutationObserver(function(){y.recordChangeEvent()}),this.mutationObserver.observe(document.body||document.documentElement,MUTATION_OBSERVER_CONFIG)}catch(g){logger$1.critical("Error while setting up mutation observer",g)}if(window.customElements)try{this.shadowDOMObserver=new ShadowDOMObserver(function(){y.recordChangeEvent()},MUTATION_OBSERVER_CONFIG),this.shadowDOMObserver.start()}catch(g){logger$1.critical("Error while setting up shadow DOM observer",g),this.shadowDOMObserver=null}}};DeadClickTracker.prototype.stopTracking=function(){if(this.isTracking){this.isTracking=!1,this.pendingClicks=[],this.lastChangeEventTimestamp=0,this.processingActive=!1,this.processingTimeout&&(clearTimeout(this.processingTimeout),this.processingTimeout=null);for(var y=0;y<this.eventListeners.length;y++){var u=this.eventListeners[y];try{u.target.removeEventListener(u.event,u.handler,u.options)}catch(g){logger$1.critical("Error while removing event listener",g)}}if(this.eventListeners=[],this.mutationObserver){try{this.mutationObserver.disconnect()}catch(g){logger$1.critical("Error while disconnecting mutation observer",g)}this.mutationObserver=null}if(this.shadowDOMObserver){try{this.shadowDOMObserver.stop()}catch(g){logger$1.critical("Error while stopping shadow DOM observer",g)}this.shadowDOMObserver=null}}};var AUTOCAPTURE_CONFIG_KEY="autocapture",LEGACY_PAGEVIEW_CONFIG_KEY="track_pageview",PAGEVIEW_OPTION_FULL_URL="full-url",PAGEVIEW_OPTION_URL_WITH_PATH_AND_QUERY_STRING="url-with-path-and-query-string",PAGEVIEW_OPTION_URL_WITH_PATH="url-with-path",CONFIG_ALLOW_ELEMENT_CALLBACK="allow_element_callback",CONFIG_ALLOW_SELECTORS="allow_selectors",CONFIG_ALLOW_URL_REGEXES="allow_url_regexes",CONFIG_BLOCK_ATTRS="block_attrs",CONFIG_BLOCK_ELEMENT_CALLBACK="block_element_callback",CONFIG_BLOCK_SELECTORS="block_selectors",CONFIG_BLOCK_URL_REGEXES="block_url_regexes",CONFIG_CAPTURE_EXTRA_ATTRS="capture_extra_attrs",CONFIG_CAPTURE_TEXT_CONTENT="capture_text_content",CONFIG_SCROLL_CAPTURE_ALL="scroll_capture_all",CONFIG_SCROLL_CHECKPOINTS="scroll_depth_percent_checkpoints",CONFIG_TRACK_CLICK="click",CONFIG_TRACK_DEAD_CLICK="dead_click",CONFIG_TRACK_INPUT="input",CONFIG_TRACK_PAGEVIEW="pageview",CONFIG_TRACK_RAGE_CLICK="rage_click",CONFIG_TRACK_SCROLL="scroll",CONFIG_TRACK_PAGE_LEAVE="page_leave",CONFIG_TRACK_SUBMIT="submit",CONFIG_DEFAULTS$1={};CONFIG_DEFAULTS$1[CONFIG_ALLOW_SELECTORS]=[];CONFIG_DEFAULTS$1[CONFIG_ALLOW_URL_REGEXES]=[];CONFIG_DEFAULTS$1[CONFIG_BLOCK_ATTRS]=[];CONFIG_DEFAULTS$1[CONFIG_BLOCK_ELEMENT_CALLBACK]=null;CONFIG_DEFAULTS$1[CONFIG_BLOCK_SELECTORS]=[];CONFIG_DEFAULTS$1[CONFIG_BLOCK_URL_REGEXES]=[];CONFIG_DEFAULTS$1[CONFIG_CAPTURE_EXTRA_ATTRS]=[];CONFIG_DEFAULTS$1[CONFIG_CAPTURE_TEXT_CONTENT]=!1;CONFIG_DEFAULTS$1[CONFIG_SCROLL_CAPTURE_ALL]=!1;CONFIG_DEFAULTS$1[CONFIG_SCROLL_CHECKPOINTS]=[25,50,75,100];CONFIG_DEFAULTS$1[CONFIG_TRACK_CLICK]=!0;CONFIG_DEFAULTS$1[CONFIG_TRACK_DEAD_CLICK]=!0;CONFIG_DEFAULTS$1[CONFIG_TRACK_INPUT]=!0;CONFIG_DEFAULTS$1[CONFIG_TRACK_PAGEVIEW]=PAGEVIEW_OPTION_FULL_URL;CONFIG_DEFAULTS$1[CONFIG_TRACK_RAGE_CLICK]=!0;CONFIG_DEFAULTS$1[CONFIG_TRACK_SCROLL]=!0;CONFIG_DEFAULTS$1[CONFIG_TRACK_PAGE_LEAVE]=!1;CONFIG_DEFAULTS$1[CONFIG_TRACK_SUBMIT]=!0;var DEFAULT_PROPS={$mp_autocapture:!0},MP_EV_CLICK="$mp_click",MP_EV_DEAD_CLICK="$mp_dead_click",MP_EV_INPUT="$mp_input_change",MP_EV_RAGE_CLICK="$mp_rage_click",MP_EV_SCROLL="$mp_scroll",MP_EV_SUBMIT="$mp_submit",MP_EV_PAGE_LEAVE="$mp_page_leave",Autocapture=function(y){this.mp=y,this.maxScrollViewDepth=0,this.hasTrackedScrollSession=!1,this.previousScrollHeight=0};Autocapture.prototype.init=function(){if(!minDOMApisSupported()){logger$1.critical("Autocapture unavailable: missing required DOM APIs");return}this.initPageListeners(),this.initPageviewTracking(),this.initClickTracking(),this.initDeadClickTracking(),this.initInputTracking(),this.initScrollTracking(),this.initSubmitTracking(),this.initRageClickTracking(),this.initPageLeaveTracking()};Autocapture.prototype.getFullConfig=function(){var y=this.mp.get_config(AUTOCAPTURE_CONFIG_KEY);return y?_.isObject(y)?_.extend({},CONFIG_DEFAULTS$1,y):CONFIG_DEFAULTS$1:{}};Autocapture.prototype.getConfig=function(y){return this.getFullConfig()[y]};Autocapture.prototype.currentUrlBlocked=function(){var y,u=_.info.currentUrl(),g=this.getConfig(CONFIG_ALLOW_URL_REGEXES)||[];if(g.length){var v=!1;for(y=0;y<g.length;y++){var b=g[y];try{if(u.match(b)){v=!0;break}}catch(E){return logger$1.critical("Error while checking block URL regex: "+b,E),!0}}if(!v)return!0}var w=this.getConfig(CONFIG_BLOCK_URL_REGEXES)||[];if(!w||!w.length)return!1;for(y=0;y<w.length;y++)try{if(u.match(w[y]))return!0}catch(E){return logger$1.critical("Error while checking block URL regex: "+w[y],E),!0}return!1};Autocapture.prototype.pageviewTrackingConfig=function(){return this.mp.get_config(AUTOCAPTURE_CONFIG_KEY)?this.getConfig(CONFIG_TRACK_PAGEVIEW):this.mp.get_config(LEGACY_PAGEVIEW_CONFIG_KEY)};Autocapture.prototype.trackDomEvent=function(y,u){if(!this.currentUrlBlocked()){var g=this.mp.is_recording_heatmap_data()&&(u===MP_EV_CLICK&&!this.getConfig(CONFIG_TRACK_CLICK)||u===MP_EV_RAGE_CLICK&&!this._getClickTrackingConfig(CONFIG_TRACK_RAGE_CLICK)||u===MP_EV_DEAD_CLICK&&!this._getClickTrackingConfig(CONFIG_TRACK_DEAD_CLICK)),v=getPropsForDOMEvent(y,{allowElementCallback:this.getConfig(CONFIG_ALLOW_ELEMENT_CALLBACK),allowSelectors:this.getConfig(CONFIG_ALLOW_SELECTORS),blockAttrs:this.getConfig(CONFIG_BLOCK_ATTRS),blockElementCallback:this.getConfig(CONFIG_BLOCK_ELEMENT_CALLBACK),blockSelectors:this.getConfig(CONFIG_BLOCK_SELECTORS),captureExtraAttrs:this.getConfig(CONFIG_CAPTURE_EXTRA_ATTRS),captureTextContent:this.getConfig(CONFIG_CAPTURE_TEXT_CONTENT),capturedForHeatMap:g});v&&(_.extend(v,DEFAULT_PROPS),this.mp.track(u,v))}};Autocapture.prototype.initPageListeners=function(){if(win.removeEventListener(EV_POPSTATE,this.listenerPopstate),win.removeEventListener(EV_HASHCHANGE,this.listenerHashchange),!(!this.pageviewTrackingConfig()&&!this.getConfig(CONFIG_TRACK_PAGE_LEAVE)&&!this.mp.get_config("record_heatmap_data"))){this.listenerPopstate=function(){win.dispatchEvent(new Event(EV_MP_LOCATION_CHANGE))},this.listenerHashchange=function(){win.dispatchEvent(new Event(EV_MP_LOCATION_CHANGE))},win.addEventListener(EV_POPSTATE,this.listenerPopstate),win.addEventListener(EV_HASHCHANGE,this.listenerHashchange);var y=win.history.pushState;typeof y=="function"&&(win.history.pushState=function(g,v,b){y.call(win.history,g,v,b),win.dispatchEvent(new Event(EV_MP_LOCATION_CHANGE))});var u=win.history.replaceState;typeof u=="function"&&(win.history.replaceState=function(g,v,b){u.call(win.history,g,v,b),win.dispatchEvent(new Event(EV_MP_LOCATION_CHANGE))})}};Autocapture.prototype._getClickTrackingConfig=function(y){var u=this.getConfig(y);return u?u===!0?{}:typeof u=="object"?u:{}:null};Autocapture.prototype._trackPageLeave=function(y,u,g){if(!this.hasTrackedScrollSession&&!(!this.getConfig(CONFIG_TRACK_PAGE_LEAVE)&&!this.mp.is_recording_heatmap_data())){this.hasTrackedScrollSession=!0;var v=Math.max(document$1.documentElement.clientHeight,win.innerHeight||0),b=Math.round(Math.max(this.maxScrollViewDepth-v,0)/(g-v)*100),w=Math.round(v/g*100);g<=v&&(b=100,w=100);var E=_.extend({$max_scroll_view_depth:this.maxScrollViewDepth,$max_scroll_percentage:b,$fold_line_percentage:w,$scroll_height:g,$event_type:y.type,$current_url:u||_.info.currentUrl(),$viewportHeight:v,$viewportWidth:Math.max(document$1.documentElement.clientWidth,win.innerWidth||0),$captured_for_heatmap:this.mp.is_recording_heatmap_data()},DEFAULT_PROPS);this.mp.track(MP_EV_PAGE_LEAVE,E,{transport:"sendBeacon"})}};Autocapture.prototype._initScrollDepthTracking=function(){if(win.removeEventListener(EV_SCROLL,this.listenerScrollDepth),win.removeEventListener(EV_SCROLLEND,this.listenerScrollDepth),!!this.mp.get_config("record_heatmap_data")){logger$1.log("Initializing scroll depth tracking"),this.maxScrollViewDepth=Math.max(document$1.documentElement.clientHeight,win.innerHeight||0);var y=(function(){if(!this.currentUrlBlocked()){var g=Math.max(document$1.documentElement.clientHeight,win.innerHeight||0)+win.scrollY;g>this.maxScrollViewDepth&&(this.maxScrollViewDepth=g),this.previousScrollHeight=document$1.body.scrollHeight}}).bind(this),u=getPolyfillScrollEndFunction(y);this.listenerScrollDepth=u.listener,win.addEventListener(u.eventType,this.listenerScrollDepth)}};Autocapture.prototype.initClickTracking=function(){win.removeEventListener(EV_CLICK,this.listenerClick),!(!this.getConfig(CONFIG_TRACK_CLICK)&&!this.mp.get_config("record_heatmap_data"))&&(logger$1.log("Initializing click tracking"),this.listenerClick=(function(y){!this.getConfig(CONFIG_TRACK_CLICK)&&!this.mp.is_recording_heatmap_data()||this.trackDomEvent(y,MP_EV_CLICK)}).bind(this),win.addEventListener(EV_CLICK,this.listenerClick))};Autocapture.prototype.initDeadClickTracking=function(){var y=this._getClickTrackingConfig(CONFIG_TRACK_DEAD_CLICK);if(!y&&!this.mp.get_config("record_heatmap_data")){this.stopDeadClickTracking();return}logger$1.log("Initializing dead click tracking"),this._deadClickTracker||(this._deadClickTracker=new DeadClickTracker((function(u){this.trackDomEvent(u,MP_EV_DEAD_CLICK)}).bind(this)),this._deadClickTracker.startTracking()),this.listenerDeadClick||(this.listenerDeadClick=(function(u){var g=this._getClickTrackingConfig(CONFIG_TRACK_DEAD_CLICK);if(!(!g&&!this.mp.is_recording_heatmap_data())&&!this.currentUrlBlocked()){var v=g||{};v.timeout_ms||(v.timeout_ms=DEFAULT_DEAD_CLICK_TIMEOUT_MS),this._deadClickTracker.trackClick(u,v)}}).bind(this),win.addEventListener(EV_CLICK,this.listenerDeadClick))};Autocapture.prototype.initInputTracking=function(){win.removeEventListener(EV_CHANGE,this.listenerChange),this.getConfig(CONFIG_TRACK_INPUT)&&(logger$1.log("Initializing input tracking"),this.listenerChange=(function(y){this.getConfig(CONFIG_TRACK_INPUT)&&this.trackDomEvent(y,MP_EV_INPUT)}).bind(this),win.addEventListener(EV_CHANGE,this.listenerChange))};Autocapture.prototype.initPageviewTracking=function(){if(win.removeEventListener(EV_MP_LOCATION_CHANGE,this.listenerLocationchange),!!this.pageviewTrackingConfig()){logger$1.log("Initializing pageview tracking");var y="",u=!1;this.currentUrlBlocked()||(u=this.mp.track_pageview(DEFAULT_PROPS)),u&&(y=_.info.currentUrl()),this.listenerLocationchange=safewrap((function(){if(!this.currentUrlBlocked()){var g=_.info.currentUrl(),v=!1,b=g.split("#")[0].split("?")[0]!==y.split("#")[0].split("?")[0],w=this.pageviewTrackingConfig();if(w===PAGEVIEW_OPTION_FULL_URL?v=g!==y:w===PAGEVIEW_OPTION_URL_WITH_PATH_AND_QUERY_STRING?v=g.split("#")[0]!==y.split("#")[0]:w===PAGEVIEW_OPTION_URL_WITH_PATH&&(v=b),v){var E=this.mp.track_pageview(DEFAULT_PROPS);E&&(y=g),b&&(this.lastScrollCheckpoint=0,logger$1.log("Path change: re-initializing scroll depth checkpoints"))}}}).bind(this)),win.addEventListener(EV_MP_LOCATION_CHANGE,this.listenerLocationchange)}};Autocapture.prototype.initRageClickTracking=function(){win.removeEventListener(EV_CLICK,this.listenerRageClick);var y=this._getClickTrackingConfig(CONFIG_TRACK_RAGE_CLICK);!y&&!this.mp.get_config("record_heatmap_data")||(logger$1.log("Initializing rage click tracking"),this._rageClickTracker||(this._rageClickTracker=new RageClickTracker),this.listenerRageClick=(function(u){var g=this._getClickTrackingConfig(CONFIG_TRACK_RAGE_CLICK);!g&&!this.mp.is_recording_heatmap_data()||this.currentUrlBlocked()||this._rageClickTracker.isRageClick(u,g)&&this.trackDomEvent(u,MP_EV_RAGE_CLICK)}).bind(this),win.addEventListener(EV_CLICK,this.listenerRageClick))};Autocapture.prototype.initScrollTracking=function(){if(win.removeEventListener(EV_SCROLLEND,this.listenerScroll),win.removeEventListener(EV_SCROLL,this.listenerScroll),!!this.getConfig(CONFIG_TRACK_SCROLL)){logger$1.log("Initializing scroll tracking"),this.lastScrollCheckpoint=0;var y=(function(){if(this.getConfig(CONFIG_TRACK_SCROLL)&&!this.currentUrlBlocked()){var g=this.getConfig(CONFIG_SCROLL_CAPTURE_ALL),v=(this.getConfig(CONFIG_SCROLL_CHECKPOINTS)||[]).slice().sort(function(R,T){return R-T}),b=win.scrollY,w=_.extend({$scroll_top:b},DEFAULT_PROPS);try{var E=document$1.body.scrollHeight,S=Math.round(b/(E-win.innerHeight)*100);if(w.$scroll_height=E,w.$scroll_percentage=S,S>this.lastScrollCheckpoint)for(var A=0;A<v.length;A++){var $=v[A];S>=$&&this.lastScrollCheckpoint<$&&(w.$scroll_checkpoint=$,this.lastScrollCheckpoint=$,g=!0)}}catch(R){logger$1.critical("Error while calculating scroll percentage",R)}g&&this.mp.track(MP_EV_SCROLL,w)}}).bind(this),u=getPolyfillScrollEndFunction(y);this.listenerScroll=u.listener,win.addEventListener(u.eventType,this.listenerScroll)}};Autocapture.prototype.initSubmitTracking=function(){win.removeEventListener(EV_SUBMIT,this.listenerSubmit),this.getConfig(CONFIG_TRACK_SUBMIT)&&(logger$1.log("Initializing submit tracking"),this.listenerSubmit=(function(y){this.getConfig(CONFIG_TRACK_SUBMIT)&&this.trackDomEvent(y,MP_EV_SUBMIT)}).bind(this),win.addEventListener(EV_SUBMIT,this.listenerSubmit))};Autocapture.prototype.initPageLeaveTracking=function(){if(document$1.removeEventListener(EV_VISIBILITYCHANGE,this.listenerPageLeaveVisibilitychange),win.removeEventListener(EV_MP_LOCATION_CHANGE,this.listenerPageLeaveLocationchange),win.removeEventListener(EV_LOAD,this.listenerPageLoad),!(!this.getConfig(CONFIG_TRACK_PAGE_LEAVE)&&!this.mp.get_config("record_heatmap_data"))){logger$1.log("Initializing page visibility tracking."),this._initScrollDepthTracking();var y=_.info.currentUrl();this.listenerPageLoad=(function(){this.previousScrollHeight=document$1.body.scrollHeight}).bind(this),win.addEventListener(EV_LOAD,this.listenerPageLoad),this.listenerPageLeaveLocationchange=safewrap((function(u){if(!this.currentUrlBlocked()){var g=_.info.currentUrl(),v=g!==y;v&&(this._trackPageLeave(u,y,this.previousScrollHeight),y=g,this.maxScrollViewDepth=Math.max(document$1.documentElement.clientHeight,win.innerHeight||0),this.previousScrollHeight=document$1.body.scrollHeight,this.hasTrackedScrollSession=!1)}}).bind(this)),win.addEventListener(EV_MP_LOCATION_CHANGE,this.listenerPageLeaveLocationchange),this.listenerPageLeaveVisibilitychange=(function(u){document$1.hidden&&this._trackPageLeave(u,y,this.previousScrollHeight)}).bind(this),document$1.addEventListener(EV_VISIBILITYCHANGE,this.listenerPageLeaveVisibilitychange)}};Autocapture.prototype.stopDeadClickTracking=function(){this.listenerDeadClick&&(win.removeEventListener(EV_CLICK,this.listenerDeadClick),this.listenerDeadClick=null),this._deadClickTracker&&(this._deadClickTracker.stopTracking(),this._deadClickTracker=null)};safewrapClass(Autocapture);var logger=console_with_prefix("flags"),FLAGS_CONFIG_KEY="flags",CONFIG_CONTEXT="context",CONFIG_DEFAULTS={};CONFIG_DEFAULTS[CONFIG_CONTEXT]={};var FeatureFlagManager=function(y){this.fetch=win.fetch,this.getFullApiRoute=y.getFullApiRoute,this.getMpConfig=y.getConfigFunc,this.setMpConfig=y.setConfigFunc,this.getMpProperty=y.getPropertyFunc,this.track=y.trackingFunc};FeatureFlagManager.prototype.init=function(){if(!this.minApisSupported()){logger.critical("Feature Flags unavailable: missing minimum required APIs");return}this.flags=null,this.fetchFlags(),this.trackedFeatures=new Set};FeatureFlagManager.prototype.getFullConfig=function(){var y=this.getMpConfig(FLAGS_CONFIG_KEY);return y?_.isObject(y)?_.extend({},CONFIG_DEFAULTS,y):CONFIG_DEFAULTS:{}};FeatureFlagManager.prototype.getConfig=function(y){return this.getFullConfig()[y]};FeatureFlagManager.prototype.isSystemEnabled=function(){return!!this.getMpConfig(FLAGS_CONFIG_KEY)};FeatureFlagManager.prototype.updateContext=function(y,u){if(!this.isSystemEnabled())return logger.critical("Feature Flags not enabled, cannot update context"),Promise.resolve();var g=this.getMpConfig(FLAGS_CONFIG_KEY);_.isObject(g)||(g={});var v=u&&u.replace?{}:this.getConfig(CONFIG_CONTEXT);return g[CONFIG_CONTEXT]=_.extend({},v,y),this.setMpConfig(FLAGS_CONFIG_KEY,g),this.fetchFlags()};FeatureFlagManager.prototype.areFlagsReady=function(){return this.isSystemEnabled()||logger.error("Feature Flags not enabled"),!!this.flags};FeatureFlagManager.prototype.fetchFlags=function(){if(!this.isSystemEnabled())return Promise.resolve();var y=this.getMpProperty("distinct_id"),u=this.getMpProperty("$device_id"),g=generateTraceparent();logger.log("Fetching flags for distinct ID: "+y);var v=_.extend({distinct_id:y,device_id:u},this.getConfig(CONFIG_CONTEXT)),b=new URLSearchParams;b.set("context",JSON.stringify(v)),b.set("token",this.getMpConfig("token")),b.set("mp_lib","web"),b.set("$lib_version",Config.LIB_VERSION);var w=this.getFullApiRoute()+"?"+b.toString();return this._fetchInProgressStartTime=Date.now(),this.fetchPromise=this.fetch.call(win,w,{method:"GET",headers:{Authorization:"Basic "+btoa(this.getMpConfig("token")+":"),traceparent:g}}).then((function(E){return this.markFetchComplete(),E.json().then((function(S){var A=S.flags;if(!A)throw new Error("No flags in API response");var $=new Map;_.each(A,function(R,T){$.set(T,{key:R.variant_key,value:R.variant_value,experiment_id:R.experiment_id,is_experiment_active:R.is_experiment_active,is_qa_tester:R.is_qa_tester})}),this.flags=$,this._traceparent=g}).bind(this)).catch((function(S){this.markFetchComplete(),logger.error(S)}).bind(this))}).bind(this)).catch((function(E){this.markFetchComplete(),logger.error(E)}).bind(this)),this.fetchPromise};FeatureFlagManager.prototype.markFetchComplete=function(){if(!this._fetchInProgressStartTime){logger.error("Fetch in progress started time not set, cannot mark fetch complete");return}this._fetchStartTime=this._fetchInProgressStartTime,this._fetchCompleteTime=Date.now(),this._fetchLatency=this._fetchCompleteTime-this._fetchStartTime,this._fetchInProgressStartTime=null};FeatureFlagManager.prototype.getVariant=function(y,u){return this.fetchPromise?this.fetchPromise.then((function(){return this.getVariantSync(y,u)}).bind(this)).catch(function(g){return logger.error(g),u}):new Promise(function(g){logger.critical("Feature Flags not initialized"),g(u)})};FeatureFlagManager.prototype.getVariantSync=function(y,u){if(!this.areFlagsReady())return logger.log("Flags not loaded yet"),u;var g=this.flags.get(y);return g?(this.trackFeatureCheck(y,g),g):(logger.log('No flag found: "'+y+'"'),u)};FeatureFlagManager.prototype.getVariantValue=function(y,u){return this.getVariant(y,{value:u}).then(function(g){return g.value}).catch(function(g){return logger.error(g),u})};FeatureFlagManager.prototype.getFeatureData=function(y,u){return logger.critical("mixpanel.flags.get_feature_data() is deprecated and will be removed in a future release. Use mixpanel.flags.get_variant_value() instead."),this.getVariantValue(y,u)};FeatureFlagManager.prototype.getVariantValueSync=function(y,u){return this.getVariantSync(y,{value:u}).value};FeatureFlagManager.prototype.isEnabled=function(y,u){return this.getVariantValue(y).then((function(){return this.isEnabledSync(y,u)}).bind(this)).catch(function(g){return logger.error(g),u})};FeatureFlagManager.prototype.isEnabledSync=function(y,u){u=u||!1;var g=this.getVariantValueSync(y,u);return g!==!0&&g!==!1&&(logger.error('Feature flag "'+y+'" value: '+g+" is not a boolean; returning fallback value: "+u),g=u),g};FeatureFlagManager.prototype.trackFeatureCheck=function(y,u){if(!this.trackedFeatures.has(y)){this.trackedFeatures.add(y);var g={"Experiment name":y,"Variant name":u.key,$experiment_type:"feature_flag","Variant fetch start time":new Date(this._fetchStartTime).toISOString(),"Variant fetch complete time":new Date(this._fetchCompleteTime).toISOString(),"Variant fetch latency (ms)":this._fetchLatency,"Variant fetch traceparent":this._traceparent};u.experiment_id!=="undefined"&&(g.$experiment_id=u.experiment_id),u.is_experiment_active!=="undefined"&&(g.$is_experiment_active=u.is_experiment_active),u.is_qa_tester!=="undefined"&&(g.$is_qa_tester=u.is_qa_tester),this.track("$experiment_started",g)}};FeatureFlagManager.prototype.minApisSupported=function(){return!!this.fetch&&typeof Promise<"u"&&typeof Map<"u"&&typeof Set<"u"};safewrapClass(FeatureFlagManager);FeatureFlagManager.prototype.are_flags_ready=FeatureFlagManager.prototype.areFlagsReady;FeatureFlagManager.prototype.get_variant=FeatureFlagManager.prototype.getVariant;FeatureFlagManager.prototype.get_variant_sync=FeatureFlagManager.prototype.getVariantSync;FeatureFlagManager.prototype.get_variant_value=FeatureFlagManager.prototype.getVariantValue;FeatureFlagManager.prototype.get_variant_value_sync=FeatureFlagManager.prototype.getVariantValueSync;FeatureFlagManager.prototype.is_enabled=FeatureFlagManager.prototype.isEnabled;FeatureFlagManager.prototype.is_enabled_sync=FeatureFlagManager.prototype.isEnabledSync;FeatureFlagManager.prototype.update_context=FeatureFlagManager.prototype.updateContext;FeatureFlagManager.prototype.get_feature_data=FeatureFlagManager.prototype.getFeatureData;var DomTracker=function(){};DomTracker.prototype.create_properties=function(){};DomTracker.prototype.event_handler=function(){};DomTracker.prototype.after_track_handler=function(){};DomTracker.prototype.init=function(y){return this.mp=y,this};DomTracker.prototype.track=function(y,u,g,v){var b=this,w=_.dom_query(y);if(w.length===0){console$1.error("The DOM query ("+y+") returned 0 elements");return}return _.each(w,function(E){_.register_event(E,this.override_event,function(S){var A={},$=b.create_properties(g,this),R=b.mp.get_config("track_links_timeout");b.event_handler(S,this,A),window.setTimeout(b.track_callback(v,$,A,!0),R),b.mp.track(u,$,b.track_callback(v,$,A))})},this),!0};DomTracker.prototype.track_callback=function(y,u,g,v){v=v||!1;var b=this;return function(){g.callback_fired||(g.callback_fired=!0,!(y&&y(v,u)===!1)&&b.after_track_handler(u,g,v))}};DomTracker.prototype.create_properties=function(y,u){var g;return typeof y=="function"?g=y(u):g=_.extend({},y),g};var LinkTracker=function(){this.override_event="click"};_.inherit(LinkTracker,DomTracker);LinkTracker.prototype.create_properties=function(y,u){var g=LinkTracker.superclass.create_properties.apply(this,arguments);return u.href&&(g.url=u.href),g};LinkTracker.prototype.event_handler=function(y,u,g){g.new_tab=y.which===2||y.metaKey||y.ctrlKey||u.target==="_blank",g.href=u.href,g.new_tab||y.preventDefault()};LinkTracker.prototype.after_track_handler=function(y,u){u.new_tab||setTimeout(function(){window.location=u.href},0)};var FormTracker=function(){this.override_event="submit"};_.inherit(FormTracker,DomTracker);FormTracker.prototype.event_handler=function(y,u,g){g.element=u,y.preventDefault()};FormTracker.prototype.after_track_handler=function(y,u){setTimeout(function(){u.element.submit()},0)};var SET_ACTION="$set",SET_ONCE_ACTION="$set_once",UNSET_ACTION="$unset",ADD_ACTION="$add",APPEND_ACTION="$append",UNION_ACTION="$union",REMOVE_ACTION="$remove",DELETE_ACTION="$delete",apiActions={set_action:function(y,u){var g={},v={};return _.isObject(y)?_.each(y,function(b,w){this._is_reserved_property(w)||(v[w]=b)},this):v[y]=u,g[SET_ACTION]=v,g},unset_action:function(y){var u={},g=[];return _.isArray(y)||(y=[y]),_.each(y,function(v){this._is_reserved_property(v)||g.push(v)},this),u[UNSET_ACTION]=g,u},set_once_action:function(y,u){var g={},v={};return _.isObject(y)?_.each(y,function(b,w){this._is_reserved_property(w)||(v[w]=b)},this):v[y]=u,g[SET_ONCE_ACTION]=v,g},union_action:function(y,u){var g={},v={};return _.isObject(y)?_.each(y,function(b,w){this._is_reserved_property(w)||(v[w]=_.isArray(b)?b:[b])},this):v[y]=_.isArray(u)?u:[u],g[UNION_ACTION]=v,g},append_action:function(y,u){var g={},v={};return _.isObject(y)?_.each(y,function(b,w){this._is_reserved_property(w)||(v[w]=b)},this):v[y]=u,g[APPEND_ACTION]=v,g},remove_action:function(y,u){var g={},v={};return _.isObject(y)?_.each(y,function(b,w){this._is_reserved_property(w)||(v[w]=b)},this):v[y]=u,g[REMOVE_ACTION]=v,g},delete_action:function(){var y={};return y[DELETE_ACTION]="",y}},MixpanelGroup=function(){};_.extend(MixpanelGroup.prototype,apiActions);MixpanelGroup.prototype._init=function(y,u,g){this._mixpanel=y,this._group_key=u,this._group_id=g};MixpanelGroup.prototype.set=addOptOutCheckMixpanelGroup(function(y,u,g){var v=this.set_action(y,u);return _.isObject(y)&&(g=u),this._send_request(v,g)});MixpanelGroup.prototype.set_once=addOptOutCheckMixpanelGroup(function(y,u,g){var v=this.set_once_action(y,u);return _.isObject(y)&&(g=u),this._send_request(v,g)});MixpanelGroup.prototype.unset=addOptOutCheckMixpanelGroup(function(y,u){var g=this.unset_action(y);return this._send_request(g,u)});MixpanelGroup.prototype.union=addOptOutCheckMixpanelGroup(function(y,u,g){_.isObject(y)&&(g=u);var v=this.union_action(y,u);return this._send_request(v,g)});MixpanelGroup.prototype.delete=addOptOutCheckMixpanelGroup(function(y){var u=this.delete_action();return this._send_request(u,y)});MixpanelGroup.prototype.remove=addOptOutCheckMixpanelGroup(function(y,u,g){var v=this.remove_action(y,u);return this._send_request(v,g)});MixpanelGroup.prototype._send_request=function(y,u){y.$group_key=this._group_key,y.$group_id=this._group_id,y.$token=this._get_config("token");var g=_.encodeDates(y);return this._mixpanel._track_or_batch({type:"groups",data:g,endpoint:this._mixpanel.get_api_host("groups")+"/"+this._get_config("api_routes").groups,batcher:this._mixpanel.request_batchers.groups},u)};MixpanelGroup.prototype._is_reserved_property=function(y){return y==="$group_key"||y==="$group_id"};MixpanelGroup.prototype._get_config=function(y){return this._mixpanel.get_config(y)};MixpanelGroup.prototype.toString=function(){return this._mixpanel.toString()+".group."+this._group_key+"."+this._group_id};MixpanelGroup.prototype.remove=MixpanelGroup.prototype.remove;MixpanelGroup.prototype.set=MixpanelGroup.prototype.set;MixpanelGroup.prototype.set_once=MixpanelGroup.prototype.set_once;MixpanelGroup.prototype.union=MixpanelGroup.prototype.union;MixpanelGroup.prototype.unset=MixpanelGroup.prototype.unset;MixpanelGroup.prototype.toString=MixpanelGroup.prototype.toString;var MixpanelPeople=function(){};_.extend(MixpanelPeople.prototype,apiActions);MixpanelPeople.prototype._init=function(y){this._mixpanel=y};MixpanelPeople.prototype.set=addOptOutCheckMixpanelPeople(function(y,u,g){var v=this.set_action(y,u);return _.isObject(y)&&(g=u),this._get_config("save_referrer")&&this._mixpanel.persistence.update_referrer_info(document.referrer),v[SET_ACTION]=_.extend({},_.info.people_properties(),v[SET_ACTION]),this._send_request(v,g)});MixpanelPeople.prototype.set_once=addOptOutCheckMixpanelPeople(function(y,u,g){var v=this.set_once_action(y,u);return _.isObject(y)&&(g=u),this._send_request(v,g)});MixpanelPeople.prototype.unset=addOptOutCheckMixpanelPeople(function(y,u){var g=this.unset_action(y);return this._send_request(g,u)});MixpanelPeople.prototype.increment=addOptOutCheckMixpanelPeople(function(y,u,g){var v={},b={};return _.isObject(y)?(_.each(y,function(w,E){if(!this._is_reserved_property(E))if(isNaN(parseFloat(w))){console$1.error("Invalid increment value passed to mixpanel.people.increment - must be a number");return}else b[E]=w},this),g=u):(_.isUndefined(u)&&(u=1),b[y]=u),v[ADD_ACTION]=b,this._send_request(v,g)});MixpanelPeople.prototype.append=addOptOutCheckMixpanelPeople(function(y,u,g){_.isObject(y)&&(g=u);var v=this.append_action(y,u);return this._send_request(v,g)});MixpanelPeople.prototype.remove=addOptOutCheckMixpanelPeople(function(y,u,g){_.isObject(y)&&(g=u);var v=this.remove_action(y,u);return this._send_request(v,g)});MixpanelPeople.prototype.union=addOptOutCheckMixpanelPeople(function(y,u,g){_.isObject(y)&&(g=u);var v=this.union_action(y,u);return this._send_request(v,g)});MixpanelPeople.prototype.track_charge=addOptOutCheckMixpanelPeople(function(){console$1.error("mixpanel.people.track_charge() is deprecated and no longer has any effect.")});MixpanelPeople.prototype.clear_charges=function(y){return this.set("$transactions",[],y)};MixpanelPeople.prototype.delete_user=function(){if(!this._identify_called()){console$1.error("mixpanel.people.delete_user() requires you to call identify() first");return}var y={$delete:this._mixpanel.get_distinct_id()};return this._send_request(y)};MixpanelPeople.prototype.toString=function(){return this._mixpanel.toString()+".people"};MixpanelPeople.prototype._send_request=function(y,u){y.$token=this._get_config("token"),y.$distinct_id=this._mixpanel.get_distinct_id();var g=this._mixpanel.get_property("$device_id"),v=this._mixpanel.get_property("$user_id"),b=this._mixpanel.get_property("$had_persisted_distinct_id");g&&(y.$device_id=g),v&&(y.$user_id=v),b&&(y.$had_persisted_distinct_id=b);var w=_.encodeDates(y);return this._identify_called()?this._mixpanel._track_or_batch({type:"people",data:w,endpoint:this._mixpanel.get_api_host("people")+"/"+this._get_config("api_routes").engage,batcher:this._mixpanel.request_batchers.people},u):(this._enqueue(y),_.isUndefined(u)||(this._get_config("verbose")?u({status:-1,error:null}):u(-1)),_.truncate(w,255))};MixpanelPeople.prototype._get_config=function(y){return this._mixpanel.get_config(y)};MixpanelPeople.prototype._identify_called=function(){return this._mixpanel._flags.identify_called===!0};MixpanelPeople.prototype._enqueue=function(y){SET_ACTION in y?this._mixpanel.persistence._add_to_people_queue(SET_ACTION,y):SET_ONCE_ACTION in y?this._mixpanel.persistence._add_to_people_queue(SET_ONCE_ACTION,y):UNSET_ACTION in y?this._mixpanel.persistence._add_to_people_queue(UNSET_ACTION,y):ADD_ACTION in y?this._mixpanel.persistence._add_to_people_queue(ADD_ACTION,y):APPEND_ACTION in y?this._mixpanel.persistence._add_to_people_queue(APPEND_ACTION,y):REMOVE_ACTION in y?this._mixpanel.persistence._add_to_people_queue(REMOVE_ACTION,y):UNION_ACTION in y?this._mixpanel.persistence._add_to_people_queue(UNION_ACTION,y):console$1.error("Invalid call to _enqueue():",y)};MixpanelPeople.prototype._flush_one_queue=function(y,u,g,v){var b=this,w=_.extend({},this._mixpanel.persistence.load_queue(y)),E=w;!_.isUndefined(w)&&_.isObject(w)&&!_.isEmptyObject(w)&&(b._mixpanel.persistence._pop_from_people_queue(y,w),b._mixpanel.persistence.save(),v&&(E=v(w)),u.call(b,E,function(S,A){S===0&&b._mixpanel.persistence._add_to_people_queue(y,w),_.isUndefined(g)||g(S,A)}))};MixpanelPeople.prototype._flush=function(y,u,g,v,b,w,E){var S=this;this._flush_one_queue(SET_ACTION,this.set,y),this._flush_one_queue(SET_ONCE_ACTION,this.set_once,v),this._flush_one_queue(UNSET_ACTION,this.unset,w,function(q){return _.keys(q)}),this._flush_one_queue(ADD_ACTION,this.increment,u),this._flush_one_queue(UNION_ACTION,this.union,b);var A=this._mixpanel.persistence.load_queue(APPEND_ACTION);if(!_.isUndefined(A)&&_.isArray(A)&&A.length)for(var $,R=function(q,J){q===0&&S._mixpanel.persistence._add_to_people_queue(APPEND_ACTION,$),_.isUndefined(g)||g(q,J)},T=A.length-1;T>=0;T--)A=this._mixpanel.persistence.load_queue(APPEND_ACTION),$=A.pop(),S._mixpanel.persistence.save(),_.isEmptyObject($)||S.append($,R);var O=this._mixpanel.persistence.load_queue(REMOVE_ACTION);if(!_.isUndefined(O)&&_.isArray(O)&&O.length)for(var B,F=function(q,J){q===0&&S._mixpanel.persistence._add_to_people_queue(REMOVE_ACTION,B),_.isUndefined(E)||E(q,J)},U=O.length-1;U>=0;U--)O=this._mixpanel.persistence.load_queue(REMOVE_ACTION),B=O.pop(),S._mixpanel.persistence.save(),_.isEmptyObject(B)||S.remove(B,F)};MixpanelPeople.prototype._is_reserved_property=function(y){return y==="$distinct_id"||y==="$token"||y==="$device_id"||y==="$user_id"||y==="$had_persisted_distinct_id"};MixpanelPeople.prototype.set=MixpanelPeople.prototype.set;MixpanelPeople.prototype.set_once=MixpanelPeople.prototype.set_once;MixpanelPeople.prototype.unset=MixpanelPeople.prototype.unset;MixpanelPeople.prototype.increment=MixpanelPeople.prototype.increment;MixpanelPeople.prototype.append=MixpanelPeople.prototype.append;MixpanelPeople.prototype.remove=MixpanelPeople.prototype.remove;MixpanelPeople.prototype.union=MixpanelPeople.prototype.union;MixpanelPeople.prototype.track_charge=MixpanelPeople.prototype.track_charge;MixpanelPeople.prototype.clear_charges=MixpanelPeople.prototype.clear_charges;MixpanelPeople.prototype.delete_user=MixpanelPeople.prototype.delete_user;MixpanelPeople.prototype.toString=MixpanelPeople.prototype.toString;var SET_QUEUE_KEY="__mps",SET_ONCE_QUEUE_KEY="__mpso",UNSET_QUEUE_KEY="__mpus",ADD_QUEUE_KEY="__mpa",APPEND_QUEUE_KEY="__mpap",REMOVE_QUEUE_KEY="__mpr",UNION_QUEUE_KEY="__mpu",PEOPLE_DISTINCT_ID_KEY="$people_distinct_id",ALIAS_ID_KEY="__alias",EVENT_TIMERS_KEY="__timers",RESERVED_PROPERTIES=[SET_QUEUE_KEY,SET_ONCE_QUEUE_KEY,UNSET_QUEUE_KEY,ADD_QUEUE_KEY,APPEND_QUEUE_KEY,REMOVE_QUEUE_KEY,UNION_QUEUE_KEY,PEOPLE_DISTINCT_ID_KEY,ALIAS_ID_KEY,EVENT_TIMERS_KEY],MixpanelPersistence=function(y){this.props={},this.campaign_params_saved=!1,y.persistence_name?this.name="mp_"+y.persistence_name:this.name="mp_"+y.token+"_mixpanel";var u=y.persistence;u!=="cookie"&&u!=="localStorage"&&(console$1.critical("Unknown persistence type "+u+"; falling back to cookie"),u=y.persistence="cookie"),u==="localStorage"&&_.localStorage.is_supported()?this.storage=_.localStorage:this.storage=_.cookie,this.load(),this.update_config(y),this.upgrade(),this.save()};MixpanelPersistence.prototype.properties=function(){var y={};return this.load(),_.each(this.props,function(u,g){_.include(RESERVED_PROPERTIES,g)||(y[g]=u)}),y};MixpanelPersistence.prototype.load=function(){if(!this.disabled){var y=this.storage.parse(this.name);y&&(this.props=_.extend({},y))}};MixpanelPersistence.prototype.upgrade=function(){var y,u;this.storage===_.localStorage?(y=_.cookie.parse(this.name),_.cookie.remove(this.name),_.cookie.remove(this.name,!0),y&&this.register_once(y)):this.storage===_.cookie&&(u=_.localStorage.parse(this.name),_.localStorage.remove(this.name),u&&this.register_once(u))};MixpanelPersistence.prototype.save=function(){this.disabled||this.storage.set(this.name,JSONStringify(this.props),this.expire_days,this.cross_subdomain,this.secure,this.cross_site,this.cookie_domain)};MixpanelPersistence.prototype.load_prop=function(y){return this.load(),this.props[y]};MixpanelPersistence.prototype.remove=function(){this.storage.remove(this.name,!1,this.cookie_domain),this.storage.remove(this.name,!0,this.cookie_domain)};MixpanelPersistence.prototype.clear=function(){this.remove(),this.props={}};MixpanelPersistence.prototype.register_once=function(y,u,g){return _.isObject(y)?(typeof u>"u"&&(u="None"),this.expire_days=typeof g>"u"?this.default_expiry:g,this.load(),_.each(y,function(v,b){(!this.props.hasOwnProperty(b)||this.props[b]===u)&&(this.props[b]=v)},this),this.save(),!0):!1};MixpanelPersistence.prototype.register=function(y,u){return _.isObject(y)?(this.expire_days=typeof u>"u"?this.default_expiry:u,this.load(),_.extend(this.props,y),this.save(),!0):!1};MixpanelPersistence.prototype.unregister=function(y){this.load(),y in this.props&&(delete this.props[y],this.save())};MixpanelPersistence.prototype.update_search_keyword=function(y){this.register(_.info.searchInfo(y))};MixpanelPersistence.prototype.update_referrer_info=function(y){this.register_once({$initial_referrer:y||"$direct",$initial_referring_domain:_.info.referringDomain(y)||"$direct"},"")};MixpanelPersistence.prototype.get_referrer_info=function(){return _.strip_empty_properties({$initial_referrer:this.props.$initial_referrer,$initial_referring_domain:this.props.$initial_referring_domain})};MixpanelPersistence.prototype.update_config=function(y){this.default_expiry=this.expire_days=y.cookie_expiration,this.set_disabled(y.disable_persistence),this.set_cookie_domain(y.cookie_domain),this.set_cross_site(y.cross_site_cookie),this.set_cross_subdomain(y.cross_subdomain_cookie),this.set_secure(y.secure_cookie)};MixpanelPersistence.prototype.set_disabled=function(y){this.disabled=y,this.disabled?this.remove():this.save()};MixpanelPersistence.prototype.set_cookie_domain=function(y){y!==this.cookie_domain&&(this.remove(),this.cookie_domain=y,this.save())};MixpanelPersistence.prototype.set_cross_site=function(y){y!==this.cross_site&&(this.cross_site=y,this.remove(),this.save())};MixpanelPersistence.prototype.set_cross_subdomain=function(y){y!==this.cross_subdomain&&(this.cross_subdomain=y,this.remove(),this.save())};MixpanelPersistence.prototype.get_cross_subdomain=function(){return this.cross_subdomain};MixpanelPersistence.prototype.set_secure=function(y){y!==this.secure&&(this.secure=!!y,this.remove(),this.save())};MixpanelPersistence.prototype._add_to_people_queue=function(y,u){var g=this._get_queue_key(y),v=u[y],b=this._get_or_create_queue(SET_ACTION),w=this._get_or_create_queue(SET_ONCE_ACTION),E=this._get_or_create_queue(UNSET_ACTION),S=this._get_or_create_queue(ADD_ACTION),A=this._get_or_create_queue(UNION_ACTION),$=this._get_or_create_queue(REMOVE_ACTION,[]),R=this._get_or_create_queue(APPEND_ACTION,[]);g===SET_QUEUE_KEY?(_.extend(b,v),this._pop_from_people_queue(ADD_ACTION,v),this._pop_from_people_queue(UNION_ACTION,v),this._pop_from_people_queue(UNSET_ACTION,v)):g===SET_ONCE_QUEUE_KEY?(_.each(v,function(T,O){O in w||(w[O]=T)}),this._pop_from_people_queue(UNSET_ACTION,v)):g===UNSET_QUEUE_KEY?_.each(v,function(T){_.each([b,w,S,A],function(O){T in O&&delete O[T]}),_.each(R,function(O){T in O&&delete O[T]}),E[T]=!0}):g===ADD_QUEUE_KEY?(_.each(v,function(T,O){O in b?b[O]+=T:(O in S||(S[O]=0),S[O]+=T)},this),this._pop_from_people_queue(UNSET_ACTION,v)):g===UNION_QUEUE_KEY?(_.each(v,function(T,O){_.isArray(T)&&(O in A||(A[O]=[]),_.each(T,function(B){_.include(A[O],B)||A[O].push(B)}))}),this._pop_from_people_queue(UNSET_ACTION,v)):g===REMOVE_QUEUE_KEY?($.push(v),this._pop_from_people_queue(APPEND_ACTION,v)):g===APPEND_QUEUE_KEY&&(R.push(v),this._pop_from_people_queue(UNSET_ACTION,v)),console$1.log("MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):"),console$1.log(u),this.save()};MixpanelPersistence.prototype._pop_from_people_queue=function(y,u){var g=this.props[this._get_queue_key(y)];_.isUndefined(g)||_.each(u,function(v,b){y===APPEND_ACTION||y===REMOVE_ACTION?_.each(g,function(w){w[b]===v&&delete w[b]}):delete g[b]},this)};MixpanelPersistence.prototype.load_queue=function(y){return this.load_prop(this._get_queue_key(y))};MixpanelPersistence.prototype._get_queue_key=function(y){if(y===SET_ACTION)return SET_QUEUE_KEY;if(y===SET_ONCE_ACTION)return SET_ONCE_QUEUE_KEY;if(y===UNSET_ACTION)return UNSET_QUEUE_KEY;if(y===ADD_ACTION)return ADD_QUEUE_KEY;if(y===APPEND_ACTION)return APPEND_QUEUE_KEY;if(y===REMOVE_ACTION)return REMOVE_QUEUE_KEY;if(y===UNION_ACTION)return UNION_QUEUE_KEY;console$1.error("Invalid queue:",y)};MixpanelPersistence.prototype._get_or_create_queue=function(y,u){var g=this._get_queue_key(y);return u=_.isUndefined(u)?{}:u,this.props[g]||(this.props[g]=u)};MixpanelPersistence.prototype.set_event_timer=function(y,u){var g=this.load_prop(EVENT_TIMERS_KEY)||{};g[y]=u,this.props[EVENT_TIMERS_KEY]=g,this.save()};MixpanelPersistence.prototype.remove_event_timer=function(y){var u=this.load_prop(EVENT_TIMERS_KEY)||{},g=u[y];return _.isUndefined(g)||(delete this.props[EVENT_TIMERS_KEY][y],this.save()),g};var init_type,load_extra_bundle=function(y,u){throw new Error(y+" not available in this build.")},mixpanel_master,INIT_MODULE=0,INIT_SNIPPET=1,IDENTITY_FUNC=function(y){return y},PRIMARY_INSTANCE_NAME="mixpanel",PAYLOAD_TYPE_BASE64="base64",PAYLOAD_TYPE_JSON="json",DEVICE_ID_PREFIX="$device:",USE_XHR=win.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,ENQUEUE_REQUESTS=!USE_XHR&&userAgent.indexOf("MSIE")===-1&&userAgent.indexOf("Mozilla")===-1,sendBeacon=null;navigator$1.sendBeacon&&(sendBeacon=function(){return navigator$1.sendBeacon.apply(navigator$1,arguments)});var DEFAULT_API_ROUTES={track:"track/",engage:"engage/",groups:"groups/",record:"record/",flags:"flags/"},DEFAULT_CONFIG={api_host:"https://api-js.mixpanel.com",api_hosts:{},api_routes:DEFAULT_API_ROUTES,api_extra_query_params:{},api_method:"POST",api_transport:"XHR",api_payload_format:PAYLOAD_TYPE_BASE64,app_host:"https://mixpanel.com",autocapture:!1,cdn:"https://cdn.mxpnl.com",cross_site_cookie:!1,cross_subdomain_cookie:!0,error_reporter:NOOP_FUNC,flags:!1,persistence:"cookie",persistence_name:"",cookie_domain:"",cookie_name:"",loaded:NOOP_FUNC,mp_loader:null,track_marketing:!0,track_pageview:!1,skip_first_touch_marketing:!1,store_google:!0,stop_utm_persistence:!1,save_referrer:!0,test:!1,verbose:!1,img:!1,debug:!1,track_links_timeout:300,cookie_expiration:365,upgrade:!1,disable_persistence:!1,disable_cookie:!1,secure_cookie:!1,ip:!0,opt_out_tracking_by_default:!1,opt_out_persistence_by_default:!1,opt_out_tracking_persistence_type:"localStorage",opt_out_tracking_cookie_prefix:null,property_blacklist:[],xhr_headers:{},ignore_dnt:!1,batch_requests:!0,batch_size:50,batch_flush_interval_ms:5e3,batch_request_timeout_ms:9e4,batch_autostart:!0,hooks:{},record_block_class:new RegExp("^(mp-block|fs-exclude|amp-block|rr-block|ph-no-capture)$"),record_block_selector:"img, video, audio",record_canvas:!1,record_collect_fonts:!1,record_console:!0,record_heatmap_data:!1,record_idle_timeout_ms:1800*1e3,record_mask_text_class:new RegExp("^(mp-mask|fs-mask|amp-mask|rr-mask|ph-mask)$"),record_mask_text_selector:"*",record_max_ms:MAX_RECORDING_MS,record_min_ms:0,record_sessions_percent:0,recorder_src:"https://cdn.mxpnl.com/libs/mixpanel-recorder.min.js"},DOM_LOADED=!1,MixpanelLib=function(){},create_mplib=function(y,u,g){var v,b=g===PRIMARY_INSTANCE_NAME?mixpanel_master:mixpanel_master[g];if(b&&init_type===INIT_MODULE)v=b;else{if(b&&!_.isArray(b)){console$1.error("You have already initialized "+g);return}v=new MixpanelLib}if(v._cached_groups={},v._init(y,u,g),v.people=new MixpanelPeople,v.people._init(v),!v.get_config("skip_first_touch_marketing")){var w=_.info.campaignParams(null),E={},S=!1;_.each(w,function(A,$){E["initial_"+$]=A,A&&(S=!0)}),S&&v.people.set_once(E)}return Config.DEBUG=Config.DEBUG||v.get_config("debug"),!_.isUndefined(b)&&_.isArray(b)&&(v._execute_array.call(v.people,b.people),v._execute_array(b)),v};MixpanelLib.prototype.init=function(y,u,g){if(_.isUndefined(g)){this.report_error("You must name your new library: init(token, config, name)");return}if(g===PRIMARY_INSTANCE_NAME){this.report_error("You must initialize the main mixpanel object right after you include the Mixpanel js snippet");return}var v=create_mplib(y,u,g);return mixpanel_master[g]=v,v._loaded(),v};MixpanelLib.prototype._init=function(y,u,g){u=u||{},this.__loaded=!0,this.config={};var v={};if(!("api_payload_format"in u)){var b=u.api_host||DEFAULT_CONFIG.api_host;b.match(/\.mixpanel\.com/)&&(v.api_payload_format=PAYLOAD_TYPE_JSON)}if(this.set_config(_.extend({},DEFAULT_CONFIG,v,u,{name:g,token:y,callback_fn:(g===PRIMARY_INSTANCE_NAME?g:PRIMARY_INSTANCE_NAME+"."+g)+"._jsc"})),this._jsc=NOOP_FUNC,this.__dom_loaded_queue=[],this.__request_queue=[],this.__disabled_events=[],this._flags={disable_all_events:!1,identify_called:!1},this.request_batchers={},this._batch_requests=this.get_config("batch_requests"),this._batch_requests){if(!_.localStorage.is_supported(!0)||!USE_XHR)this._batch_requests=!1,console$1.log("Turning off Mixpanel request-queueing; needs XHR and localStorage support"),_.each(this.get_batcher_configs(),function(S){console$1.log("Clearing batch queue "+S.queue_key),_.localStorage.remove(S.queue_key)});else if(this.init_batchers(),sendBeacon&&win.addEventListener){var w=_.bind(function(){this.request_batchers.events.stopped||this.request_batchers.events.flush({unloading:!0})},this);win.addEventListener("pagehide",function(S){S.persisted&&w()}),win.addEventListener("visibilitychange",function(){document$1.visibilityState==="hidden"&&w()})}}this.persistence=this.cookie=new MixpanelPersistence(this.config),this.unpersisted_superprops={},this._gdpr_init();var E=_.UUID();this.get_distinct_id()||this.register_once({distinct_id:DEVICE_ID_PREFIX+E,$device_id:E},""),this.flags=new FeatureFlagManager({getFullApiRoute:_.bind(function(){return this.get_api_host("flags")+"/"+this.get_config("api_routes").flags},this),getConfigFunc:_.bind(this.get_config,this),setConfigFunc:_.bind(this.set_config,this),getPropertyFunc:_.bind(this.get_property,this),trackingFunc:_.bind(this.track,this)}),this.flags.init(),this.flags=this.flags,this.autocapture=new Autocapture(this),this.autocapture.init(),this._init_tab_id(),this._check_and_start_session_recording()};MixpanelLib.prototype._init_tab_id=function(){if(this.get_config("disable_persistence"))console$1.log("Tab ID initialization skipped due to disable_persistence config");else if(_.sessionStorage.is_supported())try{var y=this.get_config("name")+"_"+this.get_config("token"),u="mp_tab_id_"+y,g="mp_gen_new_tab_id_"+y;(_.sessionStorage.get(g)||!_.sessionStorage.get(u))&&_.sessionStorage.set(u,"$tab-"+_.UUID()),_.sessionStorage.set(g,"1"),this.tab_id=_.sessionStorage.get(u),win.addEventListener("beforeunload",function(){_.sessionStorage.remove(g)})}catch(v){this.report_error("Error initializing tab id",v)}else this.report_error("Session storage is not supported, cannot keep track of unique tab ID.")};MixpanelLib.prototype.get_tab_id=function(){return this.tab_id||null};MixpanelLib.prototype._should_load_recorder=function(){if(this.get_config("disable_persistence"))return console$1.log("Load recorder check skipped due to disable_persistence config"),Promise.resolve(!1);var y=new IDBStorageWrapper(RECORDING_REGISTRY_STORE_NAME),u=this.get_tab_id();return y.init().then(function(){return y.getAll()}).then(function(g){for(var v=0;v<g.length;v++)if(isRecordingExpired(g[v])||g[v].tabId===u)return!0;return!1}).catch(_.bind(function(g){this.report_error("Error checking recording registry",g)},this))};MixpanelLib.prototype._check_and_start_session_recording=addOptOutCheckMixpanelLib(function(y){if(!win.MutationObserver){console$1.critical("Browser does not support MutationObserver; skipping session recording");return}var u=_.bind(function(v){var b=_.bind(function(){this._recorder=this._recorder||new win.__mp_recorder(this),this._recorder.resumeRecording(v)},this);_.isUndefined(win.__mp_recorder)?load_extra_bundle(this.get_config("recorder_src"),b):b()},this),g=this.get_config("record_sessions_percent")>0&&Math.random()*100<=this.get_config("record_sessions_percent");y||g?u(!0):this._should_load_recorder().then(function(v){v&&u(!1)})});MixpanelLib.prototype.start_session_recording=function(){this._check_and_start_session_recording(!0)};MixpanelLib.prototype.stop_session_recording=function(){return this._recorder?this._recorder.stopRecording():Promise.resolve()};MixpanelLib.prototype.pause_session_recording=function(){return this._recorder?this._recorder.pauseRecording():Promise.resolve()};MixpanelLib.prototype.resume_session_recording=function(){return this._recorder?this._recorder.resumeRecording():Promise.resolve()};MixpanelLib.prototype.is_recording_heatmap_data=function(){return this._get_session_replay_id()&&this.get_config("record_heatmap_data")};MixpanelLib.prototype.get_session_recording_properties=function(){var y={},u=this._get_session_replay_id();return u&&(y.$mp_replay_id=u),y};MixpanelLib.prototype.get_session_replay_url=function(){var y=null,u=this._get_session_replay_id();if(u){var g=_.HTTPBuildQuery({replay_id:u,distinct_id:this.get_distinct_id(),token:this.get_config("token")});y="https://mixpanel.com/projects/replay-redirect?"+g}return y};MixpanelLib.prototype._get_session_replay_id=function(){var y=null;return this._recorder&&(y=this._recorder.replayId),y||null};MixpanelLib.prototype.__get_recorder=function(){return this._recorder};MixpanelLib.prototype._loaded=function(){if(this.get_config("loaded")(this),this._set_default_superprops(),this.people.set_once(this.persistence.get_referrer_info()),this.get_config("store_google")&&this.get_config("stop_utm_persistence")){var y=_.info.campaignParams(null);_.each(y,(function(u,g){this.unregister(g)}).bind(this))}};MixpanelLib.prototype._set_default_superprops=function(){this.persistence.update_search_keyword(document$1.referrer),this.get_config("store_google")&&!this.get_config("stop_utm_persistence")&&this.register(_.info.campaignParams()),this.get_config("save_referrer")&&this.persistence.update_referrer_info(document$1.referrer)};MixpanelLib.prototype._dom_loaded=function(){_.each(this.__dom_loaded_queue,function(y){this._track_dom.apply(this,y)},this),this.has_opted_out_tracking()||_.each(this.__request_queue,function(y){this._send_request.apply(this,y)},this),delete this.__dom_loaded_queue,delete this.__request_queue};MixpanelLib.prototype._track_dom=function(y,u){if(this.get_config("img"))return this.report_error("You can't use DOM tracking functions with img = true."),!1;if(!DOM_LOADED)return this.__dom_loaded_queue.push([y,u]),!1;var g=new y().init(this);return g.track.apply(g,u)};MixpanelLib.prototype._prepare_callback=function(y,u){if(_.isUndefined(y))return null;if(USE_XHR){var g=function(E){y(E,u)};return g}else{var v=this._jsc,b=""+Math.floor(Math.random()*1e8),w=this.get_config("callback_fn")+"["+b+"]";return v[b]=function(E){delete v[b],y(E,u)},w}};MixpanelLib.prototype._send_request=function(y,u,g,v){var b=!0;if(ENQUEUE_REQUESTS)return this.__request_queue.push(arguments),b;var w={method:this.get_config("api_method"),transport:this.get_config("api_transport"),verbose:this.get_config("verbose")},E=null;!v&&(_.isFunction(g)||typeof g=="string")&&(v=g,g=null),g=_.extend(w,g||{}),USE_XHR||(g.method="GET");var S=g.method==="POST",A=sendBeacon&&S&&g.transport.toLowerCase()==="sendbeacon",$=g.verbose;u.verbose&&($=!0),this.get_config("test")&&(u.test=1),$&&(u.verbose=1),this.get_config("img")&&(u.img=1),USE_XHR||(v?u.callback=v:($||this.get_config("test"))&&(u.callback="(function(){})")),u.ip=this.get_config("ip")?1:0,u._=new Date().getTime().toString(),S&&(E="data="+encodeURIComponent(u.data),delete u.data),_.extend(u,this.get_config("api_extra_query_params")),y+="?"+_.HTTPBuildQuery(u);var R=this;if("img"in u){var T=document$1.createElement("img");T.src=y,document$1.body.appendChild(T)}else if(A){try{b=sendBeacon(y,E)}catch(J){R.report_error(J),b=!1}try{v&&v(b?1:0)}catch(J){R.report_error(J)}}else if(USE_XHR)try{var O=new XMLHttpRequest;O.open(g.method,y,!0);var B=this.get_config("xhr_headers");if(S&&(B["Content-Type"]="application/x-www-form-urlencoded"),_.each(B,function(J,ie){O.setRequestHeader(ie,J)}),g.timeout_ms&&typeof O.timeout<"u"){O.timeout=g.timeout_ms;var F=new Date().getTime()}O.withCredentials=!0,O.onreadystatechange=function(){if(O.readyState===4)if(O.status===200){if(v)if($){var J;try{J=_.JSONDecode(O.responseText)}catch(le){if(R.report_error(le),g.ignore_json_errors)J=O.responseText;else return}v(J)}else v(Number(O.responseText))}else{var ie;if(O.timeout&&!O.status&&new Date().getTime()-F>=O.timeout?ie="timeout":ie="Bad HTTP status: "+O.status+" "+O.statusText,R.report_error(ie),v)if($){var oe=O.responseHeaders||{};v({status:0,httpStatusCode:O.status,error:ie,retryAfter:oe["Retry-After"]})}else v(0)}},O.send(E)}catch(J){R.report_error(J),b=!1}else{var U=document$1.createElement("script");U.type="text/javascript",U.async=!0,U.defer=!0,U.src=y;var q=document$1.getElementsByTagName("script")[0];q.parentNode.insertBefore(U,q)}return b};MixpanelLib.prototype._execute_array=function(y){var u,g=[],v=[],b=[];_.each(y,function(E){E&&(u=E[0],_.isArray(u)?b.push(E):typeof E=="function"?E.call(this):_.isArray(E)&&u==="alias"?g.push(E):_.isArray(E)&&u.indexOf("track")!==-1&&typeof this[u]=="function"?b.push(E):v.push(E))},this);var w=function(E,S){_.each(E,function(A){if(_.isArray(A[0])){var $=S;_.each(A,function(R){$=$[R[0]].apply($,R.slice(1))})}else this[A[0]].apply(this,A.slice(1))},S)};w(g,this),w(v,this),w(b,this)};MixpanelLib.prototype.are_batchers_initialized=function(){return!!this.request_batchers.events};MixpanelLib.prototype.get_batcher_configs=function(){var y="__mpq_"+this.get_config("token");return this._batcher_configs=this._batcher_configs||{events:{type:"events",api_name:"track",queue_key:y+"_ev"},people:{type:"people",api_name:"engage",queue_key:y+"_pp"},groups:{type:"groups",api_name:"groups",queue_key:y+"_gr"}},this._batcher_configs};MixpanelLib.prototype.init_batchers=function(){if(!this.are_batchers_initialized()){var y=_.bind(function(g){return new RequestBatcher(g.queue_key,{libConfig:this.config,errorReporter:this.get_config("error_reporter"),sendRequestFunc:_.bind(function(v,b,w){var E=this.get_config("api_routes");this._send_request(this.get_api_host(g.api_name)+"/"+E[g.api_name],this._encode_data_for_request(v),b,this._prepare_callback(w,v))},this),beforeSendHook:_.bind(function(v){return this._run_hook("before_send_"+g.type,v)},this),stopAllBatchingFunc:_.bind(this.stop_batch_senders,this),usePersistence:!0})},this),u=this.get_batcher_configs();this.request_batchers={events:y(u.events),people:y(u.people),groups:y(u.groups)}}this.get_config("batch_autostart")&&this.start_batch_senders()};MixpanelLib.prototype.start_batch_senders=function(){this._batchers_were_started=!0,this.are_batchers_initialized()&&(this._batch_requests=!0,_.each(this.request_batchers,function(y){y.start()}))};MixpanelLib.prototype.stop_batch_senders=function(){this._batch_requests=!1,_.each(this.request_batchers,function(y){y.stop(),y.clear()})};MixpanelLib.prototype.push=function(y){this._execute_array([y])};MixpanelLib.prototype.disable=function(y){typeof y>"u"?this._flags.disable_all_events=!0:this.__disabled_events=this.__disabled_events.concat(y)};MixpanelLib.prototype._encode_data_for_request=function(y){var u=JSONStringify(y);return this.get_config("api_payload_format")===PAYLOAD_TYPE_BASE64&&(u=_.base64Encode(u)),{data:u}};MixpanelLib.prototype._track_or_batch=function(y,u){var g=_.truncate(y.data,255),v=y.endpoint,b=y.batcher,w=y.should_send_immediately,E=y.send_request_options||{};u=u||NOOP_FUNC;var S=!0,A=_.bind(function(){return E.skip_hooks||(g=this._run_hook("before_send_"+y.type,g)),g?(console$1.log("MIXPANEL REQUEST:"),console$1.log(g),this._send_request(v,this._encode_data_for_request(g),E,this._prepare_callback(u,g))):null},this);return this._batch_requests&&!w?b.enqueue(g).then(function($){$?u(1,g):A()}):S=A(),S&&g};MixpanelLib.prototype.track=addOptOutCheckMixpanelLib(function(y,u,g,v){!v&&typeof g=="function"&&(v=g,g=null),g=g||{};var b=g.transport;b&&(g.transport=b);var w=g.send_immediately;if(typeof v!="function"&&(v=NOOP_FUNC),_.isUndefined(y)){this.report_error("No event name provided to mixpanel.track");return}if(this._event_is_disabled(y)){v(0);return}u=_.extend({},u),u.token=this.get_config("token");var E=this.persistence.remove_event_timer(y);if(!_.isUndefined(E)){var S=new Date().getTime()-E;u.$duration=parseFloat((S/1e3).toFixed(3))}this._set_default_superprops();var A=this.get_config("track_marketing")?_.info.marketingParams():{};u=_.extend({},_.info.properties({mp_loader:this.get_config("mp_loader")}),A,this.persistence.properties(),this.unpersisted_superprops,this.get_session_recording_properties(),u);var $=this.get_config("property_blacklist");_.isArray($)?_.each($,function(O){delete u[O]}):this.report_error("Invalid value for property_blacklist config: "+$);var R={event:y,properties:u},T=this._track_or_batch({type:"events",data:R,endpoint:this.get_api_host("events")+"/"+this.get_config("api_routes").track,batcher:this.request_batchers.events,should_send_immediately:w,send_request_options:g},v);return T});MixpanelLib.prototype.set_group=addOptOutCheckMixpanelLib(function(y,u,g){_.isArray(u)||(u=[u]);var v={};return v[y]=u,this.register(v),this.people.set(y,u,g)});MixpanelLib.prototype.add_group=addOptOutCheckMixpanelLib(function(y,u,g){var v=this.get_property(y),b={};return v===void 0?(b[y]=[u],this.register(b)):v.indexOf(u)===-1&&(v.push(u),b[y]=v,this.register(b)),this.people.union(y,u,g)});MixpanelLib.prototype.remove_group=addOptOutCheckMixpanelLib(function(y,u,g){var v=this.get_property(y);if(v!==void 0){var b=v.indexOf(u);b>-1&&(v.splice(b,1),this.register({group_key:v})),v.length===0&&this.unregister(y)}return this.people.remove(y,u,g)});MixpanelLib.prototype.track_with_groups=addOptOutCheckMixpanelLib(function(y,u,g,v){var b=_.extend({},u||{});return _.each(g,function(w,E){w!=null&&(b[E]=w)}),this.track(y,b,v)});MixpanelLib.prototype._create_map_key=function(y,u){return y+"_"+JSON.stringify(u)};MixpanelLib.prototype._remove_group_from_cache=function(y,u){delete this._cached_groups[this._create_map_key(y,u)]};MixpanelLib.prototype.get_group=function(y,u){var g=this._create_map_key(y,u),v=this._cached_groups[g];return(v===void 0||v._group_key!==y||v._group_id!==u)&&(v=new MixpanelGroup,v._init(this,y,u),this._cached_groups[g]=v),v};MixpanelLib.prototype.track_pageview=addOptOutCheckMixpanelLib(function(y,u){typeof y!="object"&&(y={}),u=u||{};var g=u.event_name||"$mp_web_page_view",v=_.extend(_.info.mpPageViewProperties(),_.info.campaignParams(),_.info.clickParams()),b=_.extend({},v,y);return this.track(g,b)});MixpanelLib.prototype.track_links=function(){return this._track_dom.call(this,LinkTracker,arguments)};MixpanelLib.prototype.track_forms=function(){return this._track_dom.call(this,FormTracker,arguments)};MixpanelLib.prototype.time_event=function(y){if(_.isUndefined(y)){this.report_error("No event name provided to mixpanel.time_event");return}this._event_is_disabled(y)||this.persistence.set_event_timer(y,new Date().getTime())};var REGISTER_DEFAULTS={persistent:!0},options_for_register=function(y){var u;return _.isObject(y)?u=y:_.isUndefined(y)?u={}:u={days:y},_.extend({},REGISTER_DEFAULTS,u)};MixpanelLib.prototype.register=function(y,u){var g=options_for_register(u);g.persistent?this.persistence.register(y,g.days):_.extend(this.unpersisted_superprops,y)};MixpanelLib.prototype.register_once=function(y,u,g){var v=options_for_register(g);v.persistent?this.persistence.register_once(y,u,v.days):(typeof u>"u"&&(u="None"),_.each(y,function(b,w){(!this.unpersisted_superprops.hasOwnProperty(w)||this.unpersisted_superprops[w]===u)&&(this.unpersisted_superprops[w]=b)},this))};MixpanelLib.prototype.unregister=function(y,u){u=options_for_register(u),u.persistent?this.persistence.unregister(y):delete this.unpersisted_superprops[y]};MixpanelLib.prototype._register_single=function(y,u){var g={};g[y]=u,this.register(g)};MixpanelLib.prototype.identify=function(y,u,g,v,b,w,E,S){var A=this.get_distinct_id();if(y&&A!==y){if(typeof y=="string"&&y.indexOf(DEVICE_ID_PREFIX)===0)return this.report_error("distinct_id cannot have $device: prefix"),-1;this.register({$user_id:y})}if(!this.get_property("$device_id")){var $=A;this.register_once({$had_persisted_distinct_id:!0,$device_id:$},"")}y!==A&&y!==this.get_property(ALIAS_ID_KEY)&&(this.unregister(ALIAS_ID_KEY),this.register({distinct_id:y})),this._flags.identify_called=!0,this.people._flush(u,g,v,b,w,E,S),y!==A&&this.track("$identify",{distinct_id:y,$anon_distinct_id:A},{skip_hooks:!0}),y!==A&&this.flags.fetchFlags()};MixpanelLib.prototype.reset=function(){this.stop_session_recording(),this.persistence.clear(),this._flags.identify_called=!1;var y=_.UUID();this.register_once({distinct_id:DEVICE_ID_PREFIX+y,$device_id:y},""),this._check_and_start_session_recording()};MixpanelLib.prototype.get_distinct_id=function(){return this.get_property("distinct_id")};MixpanelLib.prototype.alias=function(y,u){if(y===this.get_property(PEOPLE_DISTINCT_ID_KEY))return this.report_error("Attempting to create alias for existing People user - aborting."),-2;var g=this;return _.isUndefined(u)&&(u=this.get_distinct_id()),y!==u?(this._register_single(ALIAS_ID_KEY,y),this.track("$create_alias",{alias:y,distinct_id:u},{skip_hooks:!0},function(){g.identify(y)})):(this.report_error("alias matches current distinct_id - skipping api call."),this.identify(y),-1)};MixpanelLib.prototype.name_tag=function(y){this._register_single("mp_name_tag",y)};MixpanelLib.prototype.set_config=function(y){if(_.isObject(y)){_.extend(this.config,y);var u=y.batch_size;u&&_.each(this.request_batchers,function(g){g.resetBatchSize()}),this.get_config("persistence_name")||(this.config.persistence_name=this.config.cookie_name),this.get_config("disable_persistence")||(this.config.disable_persistence=this.config.disable_cookie),this.persistence&&this.persistence.update_config(this.config),Config.DEBUG=Config.DEBUG||this.get_config("debug"),("autocapture"in y||"record_heatmap_data"in y)&&this.autocapture&&this.autocapture.init()}};MixpanelLib.prototype.get_config=function(y){return this.config[y]};MixpanelLib.prototype._run_hook=function(y){var u=(this.config.hooks[y]||IDENTITY_FUNC).apply(this,slice.call(arguments,1));return typeof u>"u"&&(this.report_error(y+" hook did not return a value"),u=null),u};MixpanelLib.prototype.get_property=function(y){return this.persistence.load_prop([y])};MixpanelLib.prototype.get_api_host=function(y){return this.get_config("api_hosts")[y]||this.get_config("api_host")};MixpanelLib.prototype.toString=function(){var y=this.get_config("name");return y!==PRIMARY_INSTANCE_NAME&&(y=PRIMARY_INSTANCE_NAME+"."+y),y};MixpanelLib.prototype._event_is_disabled=function(y){return _.isBlockedUA(userAgent)||this._flags.disable_all_events||_.include(this.__disabled_events,y)};MixpanelLib.prototype._gdpr_init=function(){var y=this.get_config("opt_out_tracking_persistence_type")==="localStorage";y&&_.localStorage.is_supported()&&(!this.has_opted_in_tracking()&&this.has_opted_in_tracking({persistence_type:"cookie"})&&this.opt_in_tracking({enable_persistence:!1}),!this.has_opted_out_tracking()&&this.has_opted_out_tracking({persistence_type:"cookie"})&&this.opt_out_tracking({clear_persistence:!1}),this.clear_opt_in_out_tracking({persistence_type:"cookie",enable_persistence:!1})),this.has_opted_out_tracking()?this._gdpr_update_persistence({clear_persistence:!0}):!this.has_opted_in_tracking()&&(this.get_config("opt_out_tracking_by_default")||_.cookie.get("mp_optout"))&&(_.cookie.remove("mp_optout"),this.opt_out_tracking({clear_persistence:this.get_config("opt_out_persistence_by_default")}))};MixpanelLib.prototype._gdpr_update_persistence=function(y){var u;if(y&&y.clear_persistence)u=!0;else if(y&&y.enable_persistence)u=!1;else return;!this.get_config("disable_persistence")&&this.persistence.disabled!==u&&this.persistence.set_disabled(u),u?(this.stop_batch_senders(),this.stop_session_recording()):this._batchers_were_started&&this.start_batch_senders()};MixpanelLib.prototype._gdpr_call_func=function(y,u){return u=_.extend({track:_.bind(this.track,this),persistence_type:this.get_config("opt_out_tracking_persistence_type"),cookie_prefix:this.get_config("opt_out_tracking_cookie_prefix"),cookie_expiration:this.get_config("cookie_expiration"),cross_site_cookie:this.get_config("cross_site_cookie"),cross_subdomain_cookie:this.get_config("cross_subdomain_cookie"),cookie_domain:this.get_config("cookie_domain"),secure_cookie:this.get_config("secure_cookie"),ignore_dnt:this.get_config("ignore_dnt")},u),_.localStorage.is_supported()||(u.persistence_type="cookie"),y(this.get_config("token"),{track:u.track,trackEventName:u.track_event_name,trackProperties:u.track_properties,persistenceType:u.persistence_type,persistencePrefix:u.cookie_prefix,cookieDomain:u.cookie_domain,cookieExpiration:u.cookie_expiration,crossSiteCookie:u.cross_site_cookie,crossSubdomainCookie:u.cross_subdomain_cookie,secureCookie:u.secure_cookie,ignoreDnt:u.ignore_dnt})};MixpanelLib.prototype.opt_in_tracking=function(y){y=_.extend({enable_persistence:!0},y),this._gdpr_call_func(optIn,y),this._gdpr_update_persistence(y)};MixpanelLib.prototype.opt_out_tracking=function(y){y=_.extend({clear_persistence:!0,delete_user:!0},y),y.delete_user&&this.people&&this.people._identify_called()&&(this.people.delete_user(),this.people.clear_charges()),this._gdpr_call_func(optOut,y),this._gdpr_update_persistence(y)};MixpanelLib.prototype.has_opted_in_tracking=function(y){return this._gdpr_call_func(hasOptedIn,y)};MixpanelLib.prototype.has_opted_out_tracking=function(y){return this._gdpr_call_func(hasOptedOut,y)};MixpanelLib.prototype.clear_opt_in_out_tracking=function(y){y=_.extend({enable_persistence:!0},y),this._gdpr_call_func(clearOptInOut,y),this._gdpr_update_persistence(y)};MixpanelLib.prototype.report_error=function(y,u){console$1.error.apply(console$1.error,arguments);try{!u&&!(y instanceof Error)&&(y=new Error(y)),this.get_config("error_reporter")(y,u)}catch(g){console$1.error(g)}};MixpanelLib.prototype.init=MixpanelLib.prototype.init;MixpanelLib.prototype.reset=MixpanelLib.prototype.reset;MixpanelLib.prototype.disable=MixpanelLib.prototype.disable;MixpanelLib.prototype.time_event=MixpanelLib.prototype.time_event;MixpanelLib.prototype.track=MixpanelLib.prototype.track;MixpanelLib.prototype.track_links=MixpanelLib.prototype.track_links;MixpanelLib.prototype.track_forms=MixpanelLib.prototype.track_forms;MixpanelLib.prototype.track_pageview=MixpanelLib.prototype.track_pageview;MixpanelLib.prototype.register=MixpanelLib.prototype.register;MixpanelLib.prototype.register_once=MixpanelLib.prototype.register_once;MixpanelLib.prototype.unregister=MixpanelLib.prototype.unregister;MixpanelLib.prototype.identify=MixpanelLib.prototype.identify;MixpanelLib.prototype.alias=MixpanelLib.prototype.alias;MixpanelLib.prototype.name_tag=MixpanelLib.prototype.name_tag;MixpanelLib.prototype.set_config=MixpanelLib.prototype.set_config;MixpanelLib.prototype.get_config=MixpanelLib.prototype.get_config;MixpanelLib.prototype.get_api_host=MixpanelLib.prototype.get_api_host;MixpanelLib.prototype.get_property=MixpanelLib.prototype.get_property;MixpanelLib.prototype.get_distinct_id=MixpanelLib.prototype.get_distinct_id;MixpanelLib.prototype.toString=MixpanelLib.prototype.toString;MixpanelLib.prototype.opt_out_tracking=MixpanelLib.prototype.opt_out_tracking;MixpanelLib.prototype.opt_in_tracking=MixpanelLib.prototype.opt_in_tracking;MixpanelLib.prototype.has_opted_out_tracking=MixpanelLib.prototype.has_opted_out_tracking;MixpanelLib.prototype.has_opted_in_tracking=MixpanelLib.prototype.has_opted_in_tracking;MixpanelLib.prototype.clear_opt_in_out_tracking=MixpanelLib.prototype.clear_opt_in_out_tracking;MixpanelLib.prototype.get_group=MixpanelLib.prototype.get_group;MixpanelLib.prototype.set_group=MixpanelLib.prototype.set_group;MixpanelLib.prototype.add_group=MixpanelLib.prototype.add_group;MixpanelLib.prototype.remove_group=MixpanelLib.prototype.remove_group;MixpanelLib.prototype.track_with_groups=MixpanelLib.prototype.track_with_groups;MixpanelLib.prototype.start_batch_senders=MixpanelLib.prototype.start_batch_senders;MixpanelLib.prototype.stop_batch_senders=MixpanelLib.prototype.stop_batch_senders;MixpanelLib.prototype.start_session_recording=MixpanelLib.prototype.start_session_recording;MixpanelLib.prototype.stop_session_recording=MixpanelLib.prototype.stop_session_recording;MixpanelLib.prototype.pause_session_recording=MixpanelLib.prototype.pause_session_recording;MixpanelLib.prototype.resume_session_recording=MixpanelLib.prototype.resume_session_recording;MixpanelLib.prototype.get_session_recording_properties=MixpanelLib.prototype.get_session_recording_properties;MixpanelLib.prototype.get_session_replay_url=MixpanelLib.prototype.get_session_replay_url;MixpanelLib.prototype.get_tab_id=MixpanelLib.prototype.get_tab_id;MixpanelLib.prototype.DEFAULT_API_ROUTES=DEFAULT_API_ROUTES;MixpanelLib.prototype.__get_recorder=MixpanelLib.prototype.__get_recorder;MixpanelPersistence.prototype.properties=MixpanelPersistence.prototype.properties;MixpanelPersistence.prototype.update_search_keyword=MixpanelPersistence.prototype.update_search_keyword;MixpanelPersistence.prototype.update_referrer_info=MixpanelPersistence.prototype.update_referrer_info;MixpanelPersistence.prototype.get_cross_subdomain=MixpanelPersistence.prototype.get_cross_subdomain;MixpanelPersistence.prototype.clear=MixpanelPersistence.prototype.clear;var instances={},extend_mp=function(){_.each(instances,function(y,u){u!==PRIMARY_INSTANCE_NAME&&(mixpanel_master[u]=y)}),mixpanel_master._=_},override_mp_init_func=function(){mixpanel_master.init=function(y,u,g){if(g)return mixpanel_master[g]||(mixpanel_master[g]=instances[g]=create_mplib(y,u,g),mixpanel_master[g]._loaded()),mixpanel_master[g];var v=mixpanel_master;instances[PRIMARY_INSTANCE_NAME]?v=instances[PRIMARY_INSTANCE_NAME]:y&&(v=create_mplib(y,u,PRIMARY_INSTANCE_NAME),v._loaded(),instances[PRIMARY_INSTANCE_NAME]=v),mixpanel_master=v,init_type===INIT_SNIPPET&&(win[PRIMARY_INSTANCE_NAME]=mixpanel_master),extend_mp()}},add_dom_loaded_handler=function(){function y(){y.done||(y.done=!0,DOM_LOADED=!0,ENQUEUE_REQUESTS=!1,_.each(instances,function(v){v._dom_loaded()}))}function u(){try{document$1.documentElement.doScroll("left")}catch{setTimeout(u,1);return}y()}if(document$1.addEventListener)document$1.readyState==="complete"?y():document$1.addEventListener("DOMContentLoaded",y,!1);else if(document$1.attachEvent){document$1.attachEvent("onreadystatechange",y);var g=!1;try{g=win.frameElement===null}catch{}document$1.documentElement.doScroll&&g&&u()}_.register_event(win,"load",y,!0)};function init_as_module(y){return load_extra_bundle=y,init_type=INIT_MODULE,mixpanel_master=new MixpanelLib,override_mp_init_func(),mixpanel_master.init(),add_dom_loaded_handler(),mixpanel_master}function loadNoop(y,u){u()}var mixpanel=init_as_module(loadNoop);mixpanel.init("19d06212425213a4eeb34337016d0186",{autocapture:!0,record_sessions_percent:100,api_host:"https://api-eu.mixpanel.com"});const queryClient=new QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}});clientExports.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(QueryClientProvider,{client:queryClient,children:jsxRuntimeExports.jsx(ServicesProvider,{children:jsxRuntimeExports.jsx(ThemeInitializer,{children:jsxRuntimeExports.jsx(HashRouter,{children:jsxRuntimeExports.jsx(App,{})})})})})}));export{Buffer as B,requireUtil$1 as a,requireShams$1 as b,requireCallBound as c,requireEsObjectAtoms as d,requireCallBind as e,requireGetIntrinsic as f,getDefaultExportFromCjs$3 as g,requireDefineDataProperty as h,requireHasPropertyDescriptors as i,requireDist as j,requireStreamBrowserify as k,process$1 as p,requireCryptoBrowserify as r};
